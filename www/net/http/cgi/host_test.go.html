<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7537600">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7537655">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7537709">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7537760">//&nbsp;Tests&nbsp;for&nbsp;package&nbsp;cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7537786">package</span>&nbsp;<span class="ident" id="7537794">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7537799">import</span>&nbsp;<span class="op" id="7537806">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537809">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537818">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537825">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537831">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537838">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537850">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537871">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537877">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537888">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537905">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537916">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537927">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537938">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7537949">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7537956">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7537959">func</span>&nbsp;<span class="ident" id="7537964">newRequest</span><span class="op" id="7537974">(</span><span class="ident" id="7537975">httpreq</span>&nbsp;<span class="builtintype" id="7537983">string</span><span class="op" id="7537989">)</span>&nbsp;<span class="op" id="7537991">*</span><span class="ident" id="7537992"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7537996">.</span><span class="ident" id="7537997">Request</span>&nbsp;<span class="op" id="7538005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538008">buf</span>&nbsp;<span class="op" id="7538012">:=</span>&nbsp;<span class="ident" id="7538015"><a href="/net/http/cgi/host_test.go.html#7537809">bufio</a></span><span class="op" id="7538020">.</span><span class="ident" id="7538021">NewReader</span><span class="op" id="7538030">(</span><span class="ident" id="7538031"><a href="/net/http/cgi/host_test.go.html#7537927">strings</a></span><span class="op" id="7538038">.</span><span class="ident" id="7538039">NewReader</span><span class="op" id="7538048">(</span><span class="ident" id="7538049"><a href="/net/http/cgi/host_test.go.html#7537975">httpreq</a></span><span class="op" id="7538056">)</span><span class="op" id="7538057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538060">req</span><span class="op" id="7538063">,</span>&nbsp;<span class="ident" id="7538065">err</span>&nbsp;<span class="op" id="7538069">:=</span>&nbsp;<span class="ident" id="7538072"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7538076">.</span><span class="ident" id="7538077">ReadRequest</span><span class="op" id="7538088">(</span><span class="ident" id="7538089"><a href="/net/http/cgi/host_test.go.html#7538008">buf</a></span><span class="op" id="7538092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538095">if</span>&nbsp;<span class="ident" id="7538098"><a href="/net/http/cgi/host_test.go.html#7538065">err</a></span>&nbsp;<span class="op" id="7538102">!=</span>&nbsp;<span class="ident" id="7538105">nil</span>&nbsp;<span class="op" id="7538109">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7538113">panic</span><span class="op" id="7538118">(</span><span class="string" id="7538119">&#34;cgi:&nbsp;bogus&nbsp;http&nbsp;request&nbsp;in&nbsp;test:&nbsp;&#34;</span>&nbsp;<span class="op" id="7538155">+</span>&nbsp;<span class="ident" id="7538157"><a href="/net/http/cgi/host_test.go.html#7537975">httpreq</a></span><span class="op" id="7538164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538170"><a href="/net/http/cgi/host_test.go.html#7538060">req</a></span><span class="op" id="7538173">.</span><span class="ident" id="7538174">RemoteAddr</span>&nbsp;<span class="op" id="7538185">=</span>&nbsp;<span class="string" id="7538187">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538198">return</span>&nbsp;<span class="ident" id="7538205"><a href="/net/http/cgi/host_test.go.html#7538060">req</a></span><br>
<span class="lineno"></span><span class="op" id="7538209">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7538212">func</span>&nbsp;<span class="ident" id="7538217">runCgiTest</span><span class="op" id="7538227">(</span><span class="ident" id="7538228">t</span>&nbsp;<span class="op" id="7538230">*</span><span class="ident" id="7538231"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7538238">.</span><span class="ident" id="7538239">T</span><span class="op" id="7538240">,</span>&nbsp;<span class="ident" id="7538242">h</span>&nbsp;<span class="op" id="7538244">*</span><span class="ident" id="7538245"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7538252">,</span>&nbsp;<span class="ident" id="7538254">httpreq</span>&nbsp;<span class="builtintype" id="7538262">string</span><span class="op" id="7538268">,</span>&nbsp;<span class="ident" id="7538270">expectedMap</span>&nbsp;<span class="keyword" id="7538282">map</span><span class="op" id="7538285">[</span><span class="builtintype" id="7538286">string</span><span class="op" id="7538292">]</span><span class="builtintype" id="7538293">string</span><span class="op" id="7538299">)</span>&nbsp;<span class="op" id="7538301">*</span><span class="ident" id="7538302"><a href="/net/http/cgi/host_test.go.html#7537850">httptest</a></span><span class="op" id="7538310">.</span><span class="ident" id="7538311">ResponseRecorder</span>&nbsp;<span class="op" id="7538328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538331">rw</span>&nbsp;<span class="op" id="7538334">:=</span>&nbsp;<span class="ident" id="7538337"><a href="/net/http/cgi/host_test.go.html#7537850">httptest</a></span><span class="op" id="7538345">.</span><span class="ident" id="7538346">NewRecorder</span><span class="op" id="7538357">(</span><span class="op" id="7538358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538361">req</span>&nbsp;<span class="op" id="7538365">:=</span>&nbsp;<span class="ident" id="7538368"><a href="/net/http/cgi/host_test.go.html#7537964">newRequest</a></span><span class="op" id="7538378">(</span><span class="ident" id="7538379"><a href="/net/http/cgi/host_test.go.html#7538254">httpreq</a></span><span class="op" id="7538386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538389"><a href="/net/http/cgi/host_test.go.html#7538242">h</a></span><span class="op" id="7538390">.</span><span class="ident" id="7538391">ServeHTTP</span><span class="op" id="7538400">(</span><span class="ident" id="7538401"><a href="/net/http/cgi/host_test.go.html#7538331">rw</a></span><span class="op" id="7538403">,</span>&nbsp;<span class="ident" id="7538405"><a href="/net/http/cgi/host_test.go.html#7538361">req</a></span><span class="op" id="7538408">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7538412">//&nbsp;Make&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;the&nbsp;test&nbsp;map&nbsp;that&nbsp;the&nbsp;CGI&nbsp;returns.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538470">m</span>&nbsp;<span class="op" id="7538472">:=</span>&nbsp;<span class="builtinfunc" id="7538475">make</span><span class="op" id="7538479">(</span><span class="keyword" id="7538480">map</span><span class="op" id="7538483">[</span><span class="builtintype" id="7538484">string</span><span class="op" id="7538490">]</span><span class="builtintype" id="7538491">string</span><span class="op" id="7538497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538500"><a href="/net/http/cgi/host_test.go.html#7538470">m</a></span><span class="op" id="7538501">[</span><span class="string" id="7538502">&#34;_body&#34;</span><span class="op" id="7538509">]</span>&nbsp;<span class="op" id="7538511">=</span>&nbsp;<span class="ident" id="7538513"><a href="/net/http/cgi/host_test.go.html#7538331">rw</a></span><span class="op" id="7538515">.</span><span class="ident" id="7538516">Body</span><span class="op" id="7538520">.</span><span class="ident" id="7538521">String</span><span class="op" id="7538527">(</span><span class="op" id="7538528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538531">linesRead</span>&nbsp;<span class="op" id="7538541">:=</span>&nbsp;<span class="num" id="7538544">0</span><br>
<span class="lineno">45</span><span class="ident" id="7538546">readlines</span><span class="op" id="7538555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538558">for</span>&nbsp;<span class="op" id="7538562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538566">line</span><span class="op" id="7538570">,</span>&nbsp;<span class="ident" id="7538572">err</span>&nbsp;<span class="op" id="7538576">:=</span>&nbsp;<span class="ident" id="7538579"><a href="/net/http/cgi/host_test.go.html#7538331">rw</a></span><span class="op" id="7538581">.</span><span class="ident" id="7538582">Body</span><span class="op" id="7538586">.</span><span class="ident" id="7538587">ReadString</span><span class="op" id="7538597">(</span><span class="string" id="7538598">&#39;\n&#39;</span><span class="op" id="7538602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538606">switch</span>&nbsp;<span class="op" id="7538613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538617">case</span>&nbsp;<span class="ident" id="7538622"><a href="/net/http/cgi/host_test.go.html#7538572">err</a></span>&nbsp;<span class="op" id="7538626">==</span>&nbsp;<span class="ident" id="7538629"><a href="/net/http/cgi/host_test.go.html#7537825">io</a></span><span class="op" id="7538631">.</span><span class="ident" id="7538632">EOF</span><span class="op" id="7538635">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538640">break</span>&nbsp;<span class="ident" id="7538646">readlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538658">case</span>&nbsp;<span class="ident" id="7538663"><a href="/net/http/cgi/host_test.go.html#7538572">err</a></span>&nbsp;<span class="op" id="7538667">!=</span>&nbsp;<span class="ident" id="7538670">nil</span><span class="op" id="7538673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538678"><a href="/net/http/cgi/host_test.go.html#7538228">t</a></span><span class="op" id="7538679">.</span><span class="ident" id="7538680">Fatalf</span><span class="op" id="7538686">(</span><span class="string" id="7538687">&#34;unexpected&nbsp;error&nbsp;reading&nbsp;from&nbsp;CGI:&nbsp;%v&#34;</span><span class="op" id="7538726">,</span>&nbsp;<span class="ident" id="7538728"><a href="/net/http/cgi/host_test.go.html#7538572">err</a></span><span class="op" id="7538731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538739"><a href="/net/http/cgi/host_test.go.html#7538531">linesRead</a></span><span class="op" id="7538748">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538753">trimmedLine</span>&nbsp;<span class="op" id="7538765">:=</span>&nbsp;<span class="ident" id="7538768"><a href="/net/http/cgi/host_test.go.html#7537927">strings</a></span><span class="op" id="7538775">.</span><span class="ident" id="7538776">TrimRight</span><span class="op" id="7538785">(</span><span class="ident" id="7538786"><a href="/net/http/cgi/host_test.go.html#7538566">line</a></span><span class="op" id="7538790">,</span>&nbsp;<span class="string" id="7538792">&#34;\r\n&#34;</span><span class="op" id="7538798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538802">split</span>&nbsp;<span class="op" id="7538808">:=</span>&nbsp;<span class="ident" id="7538811"><a href="/net/http/cgi/host_test.go.html#7537927">strings</a></span><span class="op" id="7538818">.</span><span class="ident" id="7538819">SplitN</span><span class="op" id="7538825">(</span><span class="ident" id="7538826"><a href="/net/http/cgi/host_test.go.html#7538753">trimmedLine</a></span><span class="op" id="7538837">,</span>&nbsp;<span class="string" id="7538839">&#34;=&#34;</span><span class="op" id="7538842">,</span>&nbsp;<span class="num" id="7538844">2</span><span class="op" id="7538845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538849">if</span>&nbsp;<span class="builtinfunc" id="7538852">len</span><span class="op" id="7538855">(</span><span class="ident" id="7538856"><a href="/net/http/cgi/host_test.go.html#7538802">split</a></span><span class="op" id="7538861">)</span>&nbsp;<span class="op" id="7538863">!=</span>&nbsp;<span class="num" id="7538866">2</span>&nbsp;<span class="op" id="7538868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538873"><a href="/net/http/cgi/host_test.go.html#7538228">t</a></span><span class="op" id="7538874">.</span><span class="ident" id="7538875">Fatalf</span><span class="op" id="7538881">(</span><span class="string" id="7538882">&#34;Unexpected&nbsp;%d&nbsp;parts&nbsp;from&nbsp;invalid&nbsp;line&nbsp;number&nbsp;%v:&nbsp;%q;&nbsp;existing&nbsp;map=%v&#34;</span><span class="op" id="7538952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7538958">len</span><span class="op" id="7538961">(</span><span class="ident" id="7538962"><a href="/net/http/cgi/host_test.go.html#7538802">split</a></span><span class="op" id="7538967">)</span><span class="op" id="7538968">,</span>&nbsp;<span class="ident" id="7538970"><a href="/net/http/cgi/host_test.go.html#7538531">linesRead</a></span><span class="op" id="7538979">,</span>&nbsp;<span class="ident" id="7538981"><a href="/net/http/cgi/host_test.go.html#7538566">line</a></span><span class="op" id="7538985">,</span>&nbsp;<span class="ident" id="7538987"><a href="/net/http/cgi/host_test.go.html#7538470">m</a></span><span class="op" id="7538988">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538996"><a href="/net/http/cgi/host_test.go.html#7538470">m</a></span><span class="op" id="7538997">[</span><span class="ident" id="7538998"><a href="/net/http/cgi/host_test.go.html#7538802">split</a></span><span class="op" id="7539003">[</span><span class="num" id="7539004">0</span><span class="op" id="7539005">]</span><span class="op" id="7539006">]</span>&nbsp;<span class="op" id="7539008">=</span>&nbsp;<span class="ident" id="7539010"><a href="/net/http/cgi/host_test.go.html#7538802">split</a></span><span class="op" id="7539015">[</span><span class="num" id="7539016">1</span><span class="op" id="7539017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539024">for</span>&nbsp;<span class="ident" id="7539028">key</span><span class="op" id="7539031">,</span>&nbsp;<span class="ident" id="7539033">expected</span>&nbsp;<span class="op" id="7539042">:=</span>&nbsp;<span class="keyword" id="7539045">range</span>&nbsp;<span class="ident" id="7539051"><a href="/net/http/cgi/host_test.go.html#7538270">expectedMap</a></span>&nbsp;<span class="op" id="7539063">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539067">got</span>&nbsp;<span class="op" id="7539071">:=</span>&nbsp;<span class="ident" id="7539074"><a href="/net/http/cgi/host_test.go.html#7538470">m</a></span><span class="op" id="7539075">[</span><span class="ident" id="7539076"><a href="/net/http/cgi/host_test.go.html#7539028">key</a></span><span class="op" id="7539079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539083">if</span>&nbsp;<span class="ident" id="7539086"><a href="/net/http/cgi/host_test.go.html#7539028">key</a></span>&nbsp;<span class="op" id="7539090">==</span>&nbsp;<span class="string" id="7539093">&#34;cwd&#34;</span>&nbsp;<span class="op" id="7539099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7539104">//&nbsp;For&nbsp;Windows.&nbsp;golang.org/issue/4645.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539146">fi1</span><span class="op" id="7539149">,</span>&nbsp;<span class="ident" id="7539151">_</span>&nbsp;<span class="op" id="7539153">:=</span>&nbsp;<span class="ident" id="7539156"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7539158">.</span><span class="ident" id="7539159">Stat</span><span class="op" id="7539163">(</span><span class="ident" id="7539164"><a href="/net/http/cgi/host_test.go.html#7539067">got</a></span><span class="op" id="7539167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539172">fi2</span><span class="op" id="7539175">,</span>&nbsp;<span class="ident" id="7539177">_</span>&nbsp;<span class="op" id="7539179">:=</span>&nbsp;<span class="ident" id="7539182"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7539184">.</span><span class="ident" id="7539185">Stat</span><span class="op" id="7539189">(</span><span class="ident" id="7539190"><a href="/net/http/cgi/host_test.go.html#7539033">expected</a></span><span class="op" id="7539198">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539203">if</span>&nbsp;<span class="ident" id="7539206"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7539208">.</span><span class="ident" id="7539209">SameFile</span><span class="op" id="7539217">(</span><span class="ident" id="7539218"><a href="/net/http/cgi/host_test.go.html#7539146">fi1</a></span><span class="op" id="7539221">,</span>&nbsp;<span class="ident" id="7539223"><a href="/net/http/cgi/host_test.go.html#7539172">fi2</a></span><span class="op" id="7539226">)</span>&nbsp;<span class="op" id="7539228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539234"><a href="/net/http/cgi/host_test.go.html#7539067">got</a></span>&nbsp;<span class="op" id="7539238">=</span>&nbsp;<span class="ident" id="7539240"><a href="/net/http/cgi/host_test.go.html#7539033">expected</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539260">if</span>&nbsp;<span class="ident" id="7539263"><a href="/net/http/cgi/host_test.go.html#7539067">got</a></span>&nbsp;<span class="op" id="7539267">!=</span>&nbsp;<span class="ident" id="7539270"><a href="/net/http/cgi/host_test.go.html#7539033">expected</a></span>&nbsp;<span class="op" id="7539279">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539284"><a href="/net/http/cgi/host_test.go.html#7538228">t</a></span><span class="op" id="7539285">.</span><span class="ident" id="7539286">Errorf</span><span class="op" id="7539292">(</span><span class="string" id="7539293">&#34;for&nbsp;key&nbsp;%q&nbsp;got&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7539325">,</span>&nbsp;<span class="ident" id="7539327"><a href="/net/http/cgi/host_test.go.html#7539028">key</a></span><span class="op" id="7539330">,</span>&nbsp;<span class="ident" id="7539332"><a href="/net/http/cgi/host_test.go.html#7539067">got</a></span><span class="op" id="7539335">,</span>&nbsp;<span class="ident" id="7539337"><a href="/net/http/cgi/host_test.go.html#7539033">expected</a></span><span class="op" id="7539345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539355">return</span>&nbsp;<span class="ident" id="7539362"><a href="/net/http/cgi/host_test.go.html#7538331">rw</a></span><br>
<span class="lineno"></span><span class="op" id="7539365">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7539368">var</span>&nbsp;<span class="ident" id="7539372">cgiTested</span><span class="op" id="7539381">,</span>&nbsp;<span class="ident" id="7539383">cgiWorks</span>&nbsp;<span class="builtintype" id="7539392">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7539398">func</span>&nbsp;<span class="ident" id="7539403">check</span><span class="op" id="7539408">(</span><span class="ident" id="7539409">t</span>&nbsp;<span class="op" id="7539411">*</span><span class="ident" id="7539412"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7539419">.</span><span class="ident" id="7539420">T</span><span class="op" id="7539421">)</span>&nbsp;<span class="op" id="7539423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539426">if</span>&nbsp;<span class="op" id="7539429">!</span><span class="ident" id="7539430"><a href="/net/http/cgi/host_test.go.html#7539372">cgiTested</a></span>&nbsp;<span class="op" id="7539440">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539444"><a href="/net/http/cgi/host_test.go.html#7539372">cgiTested</a></span>&nbsp;<span class="op" id="7539454">=</span>&nbsp;<span class="ident" id="7539456">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539463"><a href="/net/http/cgi/host_test.go.html#7539383">cgiWorks</a></span>&nbsp;<span class="op" id="7539472">=</span>&nbsp;<span class="ident" id="7539474"><a href="/net/http/cgi/host_test.go.html#7537877">exec</a></span><span class="op" id="7539478">.</span><span class="ident" id="7539479">Command</span><span class="op" id="7539486">(</span><span class="string" id="7539487">&#34;./testdata/test.cgi&#34;</span><span class="op" id="7539508">)</span><span class="op" id="7539509">.</span><span class="ident" id="7539510">Run</span><span class="op" id="7539513">(</span><span class="op" id="7539514">)</span>&nbsp;<span class="op" id="7539516">==</span>&nbsp;<span class="ident" id="7539519">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539527">if</span>&nbsp;<span class="op" id="7539530">!</span><span class="ident" id="7539531"><a href="/net/http/cgi/host_test.go.html#7539383">cgiWorks</a></span>&nbsp;<span class="op" id="7539540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7539544">//&nbsp;No&nbsp;Perl&nbsp;on&nbsp;Windows,&nbsp;needed&nbsp;by&nbsp;test.cgi</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7539588">//&nbsp;TODO:&nbsp;make&nbsp;the&nbsp;child&nbsp;process&nbsp;be&nbsp;Go,&nbsp;not&nbsp;Perl.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539639"><a href="/net/http/cgi/host_test.go.html#7539409">t</a></span><span class="op" id="7539640">.</span><span class="ident" id="7539641">Skip</span><span class="op" id="7539645">(</span><span class="string" id="7539646">&#34;Skipping&nbsp;test:&nbsp;test.cgi&nbsp;failed.&#34;</span><span class="op" id="7539679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539682">}</span><br>
<span class="lineno"></span><span class="op" id="7539684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7539687">func</span>&nbsp;<span class="ident" id="7539692">TestCGIBasicGet</span><span class="op" id="7539707">(</span><span class="ident" id="7539708">t</span>&nbsp;<span class="op" id="7539710">*</span><span class="ident" id="7539711"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7539718">.</span><span class="ident" id="7539719">T</span><span class="op" id="7539720">)</span>&nbsp;<span class="op" id="7539722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539725"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7539730">(</span><span class="ident" id="7539731"><a href="/net/http/cgi/host_test.go.html#7539708">t</a></span><span class="op" id="7539732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539735">h</span>&nbsp;<span class="op" id="7539737">:=</span>&nbsp;<span class="op" id="7539740">&amp;</span><span class="ident" id="7539741"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7539748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539752">Path</span><span class="op" id="7539756">:</span>&nbsp;<span class="string" id="7539758">&#34;testdata/test.cgi&#34;</span><span class="op" id="7539777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539781">Root</span><span class="op" id="7539785">:</span>&nbsp;<span class="string" id="7539787">&#34;/test.cgi&#34;</span><span class="op" id="7539798">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539804">expectedMap</span>&nbsp;<span class="op" id="7539816">:=</span>&nbsp;<span class="keyword" id="7539819">map</span><span class="op" id="7539822">[</span><span class="builtintype" id="7539823">string</span><span class="op" id="7539829">]</span><span class="builtintype" id="7539830">string</span><span class="op" id="7539836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539840">&#34;test&#34;</span><span class="op" id="7539846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7539865">&#34;Hello&nbsp;CGI&#34;</span><span class="op" id="7539876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539880">&#34;param-a&#34;</span><span class="op" id="7539889">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7539905">&#34;b&#34;</span><span class="op" id="7539908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539912">&#34;param-foo&#34;</span><span class="op" id="7539923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7539937">&#34;bar&#34;</span><span class="op" id="7539942">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539946">&#34;env-GATEWAY_INTERFACE&#34;</span><span class="op" id="7539969">:</span>&nbsp;<span class="string" id="7539971">&#34;CGI/1.1&#34;</span><span class="op" id="7539980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539984">&#34;env-HTTP_HOST&#34;</span><span class="op" id="7539999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540009">&#34;example.com&#34;</span><span class="op" id="7540022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540026">&#34;env-PATH_INFO&#34;</span><span class="op" id="7540041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540051">&#34;&#34;</span><span class="op" id="7540053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540057">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7540075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540082">&#34;foo=bar&amp;a=b&#34;</span><span class="op" id="7540095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540099">&#34;env-REMOTE_ADDR&#34;</span><span class="op" id="7540116">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540124">&#34;1.2.3.4&#34;</span><span class="op" id="7540133">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540137">&#34;env-REMOTE_HOST&#34;</span><span class="op" id="7540154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540162">&#34;1.2.3.4&#34;</span><span class="op" id="7540171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540175">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7540195">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540200">&#34;GET&#34;</span><span class="op" id="7540205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540209">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7540226">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540234">&#34;/test.cgi?foo=bar&amp;a=b&#34;</span><span class="op" id="7540257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540261">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7540282">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7540286">&#34;testdata/test.cgi&#34;</span><span class="op" id="7540305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540309">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7540326">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540334">&#34;/test.cgi&#34;</span><span class="op" id="7540345">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540349">&#34;env-SERVER_NAME&#34;</span><span class="op" id="7540366">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540374">&#34;example.com&#34;</span><span class="op" id="7540387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540391">&#34;env-SERVER_PORT&#34;</span><span class="op" id="7540408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7540416">&#34;80&#34;</span><span class="op" id="7540420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7540424">&#34;env-SERVER_SOFTWARE&#34;</span><span class="op" id="7540445">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7540449">&#34;go&#34;</span><span class="op" id="7540453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540459">replay</span>&nbsp;<span class="op" id="7540466">:=</span>&nbsp;<span class="ident" id="7540469"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7540479">(</span><span class="ident" id="7540480"><a href="/net/http/cgi/host_test.go.html#7539708">t</a></span><span class="op" id="7540481">,</span>&nbsp;<span class="ident" id="7540483"><a href="/net/http/cgi/host_test.go.html#7539735">h</a></span><span class="op" id="7540484">,</span>&nbsp;<span class="string" id="7540486">&#34;GET&nbsp;/test.cgi?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7540545">,</span>&nbsp;<span class="ident" id="7540547"><a href="/net/http/cgi/host_test.go.html#7539804">expectedMap</a></span><span class="op" id="7540558">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540562">if</span>&nbsp;<span class="ident" id="7540565">expected</span><span class="op" id="7540573">,</span>&nbsp;<span class="ident" id="7540575">got</span>&nbsp;<span class="op" id="7540579">:=</span>&nbsp;<span class="string" id="7540582">&#34;text/html&#34;</span><span class="op" id="7540593">,</span>&nbsp;<span class="ident" id="7540595"><a href="/net/http/cgi/host_test.go.html#7540459">replay</a></span><span class="op" id="7540601">.</span><span class="ident" id="7540602">Header</span><span class="op" id="7540608">(</span><span class="op" id="7540609">)</span><span class="op" id="7540610">.</span><span class="ident" id="7540611">Get</span><span class="op" id="7540614">(</span><span class="string" id="7540615">&#34;Content-Type&#34;</span><span class="op" id="7540629">)</span><span class="op" id="7540630">;</span>&nbsp;<span class="ident" id="7540632"><a href="/net/http/cgi/host_test.go.html#7540575">got</a></span>&nbsp;<span class="op" id="7540636">!=</span>&nbsp;<span class="ident" id="7540639"><a href="/net/http/cgi/host_test.go.html#7540565">expected</a></span>&nbsp;<span class="op" id="7540648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540652"><a href="/net/http/cgi/host_test.go.html#7539708">t</a></span><span class="op" id="7540653">.</span><span class="ident" id="7540654">Errorf</span><span class="op" id="7540660">(</span><span class="string" id="7540661">&#34;got&nbsp;a&nbsp;Content-Type&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7540700">,</span>&nbsp;<span class="ident" id="7540702"><a href="/net/http/cgi/host_test.go.html#7540575">got</a></span><span class="op" id="7540705">,</span>&nbsp;<span class="ident" id="7540707"><a href="/net/http/cgi/host_test.go.html#7540565">expected</a></span><span class="op" id="7540715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540721">if</span>&nbsp;<span class="ident" id="7540724">expected</span><span class="op" id="7540732">,</span>&nbsp;<span class="ident" id="7540734">got</span>&nbsp;<span class="op" id="7540738">:=</span>&nbsp;<span class="string" id="7540741">&#34;X-Test-Value&#34;</span><span class="op" id="7540755">,</span>&nbsp;<span class="ident" id="7540757"><a href="/net/http/cgi/host_test.go.html#7540459">replay</a></span><span class="op" id="7540763">.</span><span class="ident" id="7540764">Header</span><span class="op" id="7540770">(</span><span class="op" id="7540771">)</span><span class="op" id="7540772">.</span><span class="ident" id="7540773">Get</span><span class="op" id="7540776">(</span><span class="string" id="7540777">&#34;X-Test-Header&#34;</span><span class="op" id="7540792">)</span><span class="op" id="7540793">;</span>&nbsp;<span class="ident" id="7540795"><a href="/net/http/cgi/host_test.go.html#7540734">got</a></span>&nbsp;<span class="op" id="7540799">!=</span>&nbsp;<span class="ident" id="7540802"><a href="/net/http/cgi/host_test.go.html#7540724">expected</a></span>&nbsp;<span class="op" id="7540811">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540815"><a href="/net/http/cgi/host_test.go.html#7539708">t</a></span><span class="op" id="7540816">.</span><span class="ident" id="7540817">Errorf</span><span class="op" id="7540823">(</span><span class="string" id="7540824">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7540864">,</span>&nbsp;<span class="ident" id="7540866"><a href="/net/http/cgi/host_test.go.html#7540734">got</a></span><span class="op" id="7540869">,</span>&nbsp;<span class="ident" id="7540871"><a href="/net/http/cgi/host_test.go.html#7540724">expected</a></span><span class="op" id="7540879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540882">}</span><br>
<span class="lineno"></span><span class="op" id="7540884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7540887">func</span>&nbsp;<span class="ident" id="7540892">TestCGIBasicGetAbsPath</span><span class="op" id="7540914">(</span><span class="ident" id="7540915">t</span>&nbsp;<span class="op" id="7540917">*</span><span class="ident" id="7540918"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7540925">.</span><span class="ident" id="7540926">T</span><span class="op" id="7540927">)</span>&nbsp;<span class="op" id="7540929">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540932"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7540937">(</span><span class="ident" id="7540938"><a href="/net/http/cgi/host_test.go.html#7540915">t</a></span><span class="op" id="7540939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540942">pwd</span><span class="op" id="7540945">,</span>&nbsp;<span class="ident" id="7540947">err</span>&nbsp;<span class="op" id="7540951">:=</span>&nbsp;<span class="ident" id="7540954"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7540956">.</span><span class="ident" id="7540957">Getwd</span><span class="op" id="7540962">(</span><span class="op" id="7540963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540966">if</span>&nbsp;<span class="ident" id="7540969"><a href="/net/http/cgi/host_test.go.html#7540947">err</a></span>&nbsp;<span class="op" id="7540973">!=</span>&nbsp;<span class="ident" id="7540976">nil</span>&nbsp;<span class="op" id="7540980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540984"><a href="/net/http/cgi/host_test.go.html#7540915">t</a></span><span class="op" id="7540985">.</span><span class="ident" id="7540986">Fatalf</span><span class="op" id="7540992">(</span><span class="string" id="7540993">&#34;getwd&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7541010">,</span>&nbsp;<span class="ident" id="7541012"><a href="/net/http/cgi/host_test.go.html#7540947">err</a></span><span class="op" id="7541015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541018">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541021">h</span>&nbsp;<span class="op" id="7541023">:=</span>&nbsp;<span class="op" id="7541026">&amp;</span><span class="ident" id="7541027"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7541034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541038">Path</span><span class="op" id="7541042">:</span>&nbsp;<span class="ident" id="7541044"><a href="/net/http/cgi/host_test.go.html#7540942">pwd</a></span>&nbsp;<span class="op" id="7541048">+</span>&nbsp;<span class="string" id="7541050">&#34;/testdata/test.cgi&#34;</span><span class="op" id="7541070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541074">Root</span><span class="op" id="7541078">:</span>&nbsp;<span class="string" id="7541080">&#34;/test.cgi&#34;</span><span class="op" id="7541091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541097">expectedMap</span>&nbsp;<span class="op" id="7541109">:=</span>&nbsp;<span class="keyword" id="7541112">map</span><span class="op" id="7541115">[</span><span class="builtintype" id="7541116">string</span><span class="op" id="7541122">]</span><span class="builtintype" id="7541123">string</span><span class="op" id="7541129">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541133">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7541150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541156">&#34;/test.cgi?foo=bar&amp;a=b&#34;</span><span class="op" id="7541179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541183">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7541204">:</span>&nbsp;<span class="ident" id="7541206"><a href="/net/http/cgi/host_test.go.html#7540942">pwd</a></span>&nbsp;<span class="op" id="7541210">+</span>&nbsp;<span class="string" id="7541212">&#34;/testdata/test.cgi&#34;</span><span class="op" id="7541232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541236">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7541253">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541259">&#34;/test.cgi&#34;</span><span class="op" id="7541270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541276"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7541286">(</span><span class="ident" id="7541287"><a href="/net/http/cgi/host_test.go.html#7540915">t</a></span><span class="op" id="7541288">,</span>&nbsp;<span class="ident" id="7541290"><a href="/net/http/cgi/host_test.go.html#7541021">h</a></span><span class="op" id="7541291">,</span>&nbsp;<span class="string" id="7541293">&#34;GET&nbsp;/test.cgi?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7541352">,</span>&nbsp;<span class="ident" id="7541354"><a href="/net/http/cgi/host_test.go.html#7541097">expectedMap</a></span><span class="op" id="7541365">)</span><br>
<span class="lineno">145</span><span class="op" id="7541367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7541370">func</span>&nbsp;<span class="ident" id="7541375">TestPathInfo</span><span class="op" id="7541387">(</span><span class="ident" id="7541388">t</span>&nbsp;<span class="op" id="7541390">*</span><span class="ident" id="7541391"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7541398">.</span><span class="ident" id="7541399">T</span><span class="op" id="7541400">)</span>&nbsp;<span class="op" id="7541402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541405"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7541410">(</span><span class="ident" id="7541411"><a href="/net/http/cgi/host_test.go.html#7541388">t</a></span><span class="op" id="7541412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541415">h</span>&nbsp;<span class="op" id="7541417">:=</span>&nbsp;<span class="op" id="7541420">&amp;</span><span class="ident" id="7541421"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7541428">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541432">Path</span><span class="op" id="7541436">:</span>&nbsp;<span class="string" id="7541438">&#34;testdata/test.cgi&#34;</span><span class="op" id="7541457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541461">Root</span><span class="op" id="7541465">:</span>&nbsp;<span class="string" id="7541467">&#34;/test.cgi&#34;</span><span class="op" id="7541478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541484">expectedMap</span>&nbsp;<span class="op" id="7541496">:=</span>&nbsp;<span class="keyword" id="7541499">map</span><span class="op" id="7541502">[</span><span class="builtintype" id="7541503">string</span><span class="op" id="7541509">]</span><span class="builtintype" id="7541510">string</span><span class="op" id="7541516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541520">&#34;param-a&#34;</span><span class="op" id="7541529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541543">&#34;b&#34;</span><span class="op" id="7541546">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541550">&#34;env-PATH_INFO&#34;</span><span class="op" id="7541565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541573">&#34;/extrapath&#34;</span><span class="op" id="7541585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541589">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7541607">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541612">&#34;a=b&#34;</span><span class="op" id="7541617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541621">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7541638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541644">&#34;/test.cgi/extrapath?a=b&#34;</span><span class="op" id="7541669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541673">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7541694">:</span>&nbsp;<span class="string" id="7541696">&#34;testdata/test.cgi&#34;</span><span class="op" id="7541715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7541719">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7541736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7541742">&#34;/test.cgi&#34;</span><span class="op" id="7541753">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541759"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7541769">(</span><span class="ident" id="7541770"><a href="/net/http/cgi/host_test.go.html#7541388">t</a></span><span class="op" id="7541771">,</span>&nbsp;<span class="ident" id="7541773"><a href="/net/http/cgi/host_test.go.html#7541415">h</a></span><span class="op" id="7541774">,</span>&nbsp;<span class="string" id="7541776">&#34;GET&nbsp;/test.cgi/extrapath?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7541837">,</span>&nbsp;<span class="ident" id="7541839"><a href="/net/http/cgi/host_test.go.html#7541484">expectedMap</a></span><span class="op" id="7541850">)</span><br>
<span class="lineno"></span><span class="op" id="7541852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7541855">func</span>&nbsp;<span class="ident" id="7541860">TestPathInfoDirRoot</span><span class="op" id="7541879">(</span><span class="ident" id="7541880">t</span>&nbsp;<span class="op" id="7541882">*</span><span class="ident" id="7541883"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7541890">.</span><span class="ident" id="7541891">T</span><span class="op" id="7541892">)</span>&nbsp;<span class="op" id="7541894">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541897"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7541902">(</span><span class="ident" id="7541903"><a href="/net/http/cgi/host_test.go.html#7541880">t</a></span><span class="op" id="7541904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541907">h</span>&nbsp;<span class="op" id="7541909">:=</span>&nbsp;<span class="op" id="7541912">&amp;</span><span class="ident" id="7541913"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7541920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541924">Path</span><span class="op" id="7541928">:</span>&nbsp;<span class="string" id="7541930">&#34;testdata/test.cgi&#34;</span><span class="op" id="7541949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541953">Root</span><span class="op" id="7541957">:</span>&nbsp;<span class="string" id="7541959">&#34;/myscript/&#34;</span><span class="op" id="7541971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541974">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541977">expectedMap</span>&nbsp;<span class="op" id="7541989">:=</span>&nbsp;<span class="keyword" id="7541992">map</span><span class="op" id="7541995">[</span><span class="builtintype" id="7541996">string</span><span class="op" id="7542002">]</span><span class="builtintype" id="7542003">string</span><span class="op" id="7542009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542013">&#34;env-PATH_INFO&#34;</span><span class="op" id="7542028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542036">&#34;bar&#34;</span><span class="op" id="7542041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542045">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7542063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542068">&#34;a=b&#34;</span><span class="op" id="7542073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542077">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7542094">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542100">&#34;/myscript/bar?a=b&#34;</span><span class="op" id="7542119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542123">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7542144">:</span>&nbsp;<span class="string" id="7542146">&#34;testdata/test.cgi&#34;</span><span class="op" id="7542165">,</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542169">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7542186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542192">&#34;/myscript/&#34;</span><span class="op" id="7542204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542210"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7542220">(</span><span class="ident" id="7542221"><a href="/net/http/cgi/host_test.go.html#7541880">t</a></span><span class="op" id="7542222">,</span>&nbsp;<span class="ident" id="7542224"><a href="/net/http/cgi/host_test.go.html#7541907">h</a></span><span class="op" id="7542225">,</span>&nbsp;<span class="string" id="7542227">&#34;GET&nbsp;/myscript/bar?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7542282">,</span>&nbsp;<span class="ident" id="7542284"><a href="/net/http/cgi/host_test.go.html#7541977">expectedMap</a></span><span class="op" id="7542295">)</span><br>
<span class="lineno"></span><span class="op" id="7542297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="7542300">func</span>&nbsp;<span class="ident" id="7542305">TestDupHeaders</span><span class="op" id="7542319">(</span><span class="ident" id="7542320">t</span>&nbsp;<span class="op" id="7542322">*</span><span class="ident" id="7542323"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7542330">.</span><span class="ident" id="7542331">T</span><span class="op" id="7542332">)</span>&nbsp;<span class="op" id="7542334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542337"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7542342">(</span><span class="ident" id="7542343"><a href="/net/http/cgi/host_test.go.html#7542320">t</a></span><span class="op" id="7542344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542347">h</span>&nbsp;<span class="op" id="7542349">:=</span>&nbsp;<span class="op" id="7542352">&amp;</span><span class="ident" id="7542353"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7542360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542364">Path</span><span class="op" id="7542368">:</span>&nbsp;<span class="string" id="7542370">&#34;testdata/test.cgi&#34;</span><span class="op" id="7542389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542392">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542395">expectedMap</span>&nbsp;<span class="op" id="7542407">:=</span>&nbsp;<span class="keyword" id="7542410">map</span><span class="op" id="7542413">[</span><span class="builtintype" id="7542414">string</span><span class="op" id="7542420">]</span><span class="builtintype" id="7542421">string</span><span class="op" id="7542427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542431">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7542448">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542454">&#34;/myscript/bar?a=b&#34;</span><span class="op" id="7542473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542477">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7542498">:</span>&nbsp;<span class="string" id="7542500">&#34;testdata/test.cgi&#34;</span><span class="op" id="7542519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542523">&#34;env-HTTP_COOKIE&#34;</span><span class="op" id="7542540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542546">&#34;nom=NOM;&nbsp;yum=YUM&#34;</span><span class="op" id="7542564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542568">&#34;env-HTTP_X_FOO&#34;</span><span class="op" id="7542584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542591">&#34;val1,&nbsp;val2&#34;</span><span class="op" id="7542603">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542609"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7542619">(</span><span class="ident" id="7542620"><a href="/net/http/cgi/host_test.go.html#7542320">t</a></span><span class="op" id="7542621">,</span>&nbsp;<span class="ident" id="7542623"><a href="/net/http/cgi/host_test.go.html#7542347">h</a></span><span class="op" id="7542624">,</span>&nbsp;<span class="string" id="7542626">&#34;GET&nbsp;/myscript/bar?a=b&nbsp;HTTP/1.0\n&#34;</span><span class="op" id="7542660">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542664">&#34;Cookie:&nbsp;nom=NOM\n&#34;</span><span class="op" id="7542683">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542687">&#34;Cookie:&nbsp;yum=YUM\n&#34;</span><span class="op" id="7542706">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542710">&#34;X-Foo:&nbsp;val1\n&#34;</span><span class="op" id="7542725">+</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542729">&#34;X-Foo:&nbsp;val2\n&#34;</span><span class="op" id="7542744">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542748">&#34;Host:&nbsp;example.com\n\n&#34;</span><span class="op" id="7542771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542775"><a href="/net/http/cgi/host_test.go.html#7542395">expectedMap</a></span><span class="op" id="7542786">)</span><br>
<span class="lineno"></span><span class="op" id="7542788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="7542791">func</span>&nbsp;<span class="ident" id="7542796">TestPathInfoNoRoot</span><span class="op" id="7542814">(</span><span class="ident" id="7542815">t</span>&nbsp;<span class="op" id="7542817">*</span><span class="ident" id="7542818"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7542825">.</span><span class="ident" id="7542826">T</span><span class="op" id="7542827">)</span>&nbsp;<span class="op" id="7542829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542832"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7542837">(</span><span class="ident" id="7542838"><a href="/net/http/cgi/host_test.go.html#7542815">t</a></span><span class="op" id="7542839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542842">h</span>&nbsp;<span class="op" id="7542844">:=</span>&nbsp;<span class="op" id="7542847">&amp;</span><span class="ident" id="7542848"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7542855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542859">Path</span><span class="op" id="7542863">:</span>&nbsp;<span class="string" id="7542865">&#34;testdata/test.cgi&#34;</span><span class="op" id="7542884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542888">Root</span><span class="op" id="7542892">:</span>&nbsp;<span class="string" id="7542894">&#34;&#34;</span><span class="op" id="7542896">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542902">expectedMap</span>&nbsp;<span class="op" id="7542914">:=</span>&nbsp;<span class="keyword" id="7542917">map</span><span class="op" id="7542920">[</span><span class="builtintype" id="7542921">string</span><span class="op" id="7542927">]</span><span class="builtintype" id="7542928">string</span><span class="op" id="7542934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542938">&#34;env-PATH_INFO&#34;</span><span class="op" id="7542953">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542961">&#34;/bar&#34;</span><span class="op" id="7542967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7542971">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7542989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7542994">&#34;a=b&#34;</span><span class="op" id="7542999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543003">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7543020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7543026">&#34;/bar?a=b&#34;</span><span class="op" id="7543036">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543040">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7543061">:</span>&nbsp;<span class="string" id="7543063">&#34;testdata/test.cgi&#34;</span><span class="op" id="7543082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543086">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7543103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7543109">&#34;/&#34;</span><span class="op" id="7543112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7543115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543118"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7543128">(</span><span class="ident" id="7543129"><a href="/net/http/cgi/host_test.go.html#7542815">t</a></span><span class="op" id="7543130">,</span>&nbsp;<span class="ident" id="7543132"><a href="/net/http/cgi/host_test.go.html#7542842">h</a></span><span class="op" id="7543133">,</span>&nbsp;<span class="string" id="7543135">&#34;GET&nbsp;/bar?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7543181">,</span>&nbsp;<span class="ident" id="7543183"><a href="/net/http/cgi/host_test.go.html#7542902">expectedMap</a></span><span class="op" id="7543194">)</span><br>
<span class="lineno"></span><span class="op" id="7543196">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7543199">func</span>&nbsp;<span class="ident" id="7543204">TestCGIBasicPost</span><span class="op" id="7543220">(</span><span class="ident" id="7543221">t</span>&nbsp;<span class="op" id="7543223">*</span><span class="ident" id="7543224"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7543231">.</span><span class="ident" id="7543232">T</span><span class="op" id="7543233">)</span>&nbsp;<span class="op" id="7543235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543238"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7543243">(</span><span class="ident" id="7543244"><a href="/net/http/cgi/host_test.go.html#7543221">t</a></span><span class="op" id="7543245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543248">postReq</span>&nbsp;<span class="op" id="7543256">:=</span>&nbsp;<span class="string" id="7543259">`POST&nbsp;/test.cgi?a=b&nbsp;HTTP/1.0<br>
<span class="lineno"></span>Host:&nbsp;example.com<br>
<span class="lineno">220</span>Content-Type:&nbsp;application/x-www-form-urlencoded<br>
<span class="lineno"></span>Content-Length:&nbsp;15<br>
<span class="lineno"></span><br>
<span class="lineno"></span>postfoo=postbar`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543392">h</span>&nbsp;<span class="op" id="7543394">:=</span>&nbsp;<span class="op" id="7543397">&amp;</span><span class="ident" id="7543398"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7543405">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543409">Path</span><span class="op" id="7543413">:</span>&nbsp;<span class="string" id="7543415">&#34;testdata/test.cgi&#34;</span><span class="op" id="7543434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543438">Root</span><span class="op" id="7543442">:</span>&nbsp;<span class="string" id="7543444">&#34;/test.cgi&#34;</span><span class="op" id="7543455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7543458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543461">expectedMap</span>&nbsp;<span class="op" id="7543473">:=</span>&nbsp;<span class="keyword" id="7543476">map</span><span class="op" id="7543479">[</span><span class="builtintype" id="7543480">string</span><span class="op" id="7543486">]</span><span class="builtintype" id="7543487">string</span><span class="op" id="7543493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543497">&#34;test&#34;</span><span class="op" id="7543503">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7543519">&#34;Hello&nbsp;CGI&#34;</span><span class="op" id="7543530">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543534">&#34;param-postfoo&#34;</span><span class="op" id="7543549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7543556">&#34;postbar&#34;</span><span class="op" id="7543565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543569">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7543589">:</span>&nbsp;<span class="string" id="7543591">&#34;POST&#34;</span><span class="op" id="7543597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543601">&#34;env-CONTENT_LENGTH&#34;</span><span class="op" id="7543621">:</span>&nbsp;<span class="string" id="7543623">&#34;15&#34;</span><span class="op" id="7543627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7543631">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7543648">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7543653">&#34;/test.cgi?a=b&#34;</span><span class="op" id="7543668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7543671">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543674"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7543684">(</span><span class="ident" id="7543685"><a href="/net/http/cgi/host_test.go.html#7543221">t</a></span><span class="op" id="7543686">,</span>&nbsp;<span class="ident" id="7543688"><a href="/net/http/cgi/host_test.go.html#7543392">h</a></span><span class="op" id="7543689">,</span>&nbsp;<span class="ident" id="7543691"><a href="/net/http/cgi/host_test.go.html#7543248">postReq</a></span><span class="op" id="7543698">,</span>&nbsp;<span class="ident" id="7543700"><a href="/net/http/cgi/host_test.go.html#7543461">expectedMap</a></span><span class="op" id="7543711">)</span><br>
<span class="lineno"></span><span class="op" id="7543713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7543716">func</span>&nbsp;<span class="ident" id="7543721">chunk</span><span class="op" id="7543726">(</span><span class="ident" id="7543727">s</span>&nbsp;<span class="builtintype" id="7543729">string</span><span class="op" id="7543735">)</span>&nbsp;<span class="builtintype" id="7543737">string</span>&nbsp;<span class="op" id="7543744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7543747">return</span>&nbsp;<span class="ident" id="7543754"><a href="/net/http/cgi/host_test.go.html#7537818">fmt</a></span><span class="op" id="7543757">.</span><span class="ident" id="7543758">Sprintf</span><span class="op" id="7543765">(</span><span class="string" id="7543766">&#34;%x\r\n%s\r\n&#34;</span><span class="op" id="7543780">,</span>&nbsp;<span class="builtinfunc" id="7543782">len</span><span class="op" id="7543785">(</span><span class="ident" id="7543786"><a href="/net/http/cgi/host_test.go.html#7543727">s</a></span><span class="op" id="7543787">)</span><span class="op" id="7543788">,</span>&nbsp;<span class="ident" id="7543790"><a href="/net/http/cgi/host_test.go.html#7543727">s</a></span><span class="op" id="7543791">)</span><br>
<span class="lineno">240</span><span class="op" id="7543793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7543796">//&nbsp;The&nbsp;CGI&nbsp;spec&nbsp;doesn&#39;t&nbsp;allow&nbsp;chunked&nbsp;requests.</span><br>
<span class="lineno"></span><span class="keyword" id="7543844">func</span>&nbsp;<span class="ident" id="7543849">TestCGIPostChunked</span><span class="op" id="7543867">(</span><span class="ident" id="7543868">t</span>&nbsp;<span class="op" id="7543870">*</span><span class="ident" id="7543871"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7543878">.</span><span class="ident" id="7543879">T</span><span class="op" id="7543880">)</span>&nbsp;<span class="op" id="7543882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543885"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7543890">(</span><span class="ident" id="7543891"><a href="/net/http/cgi/host_test.go.html#7543868">t</a></span><span class="op" id="7543892">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7543895">postReq</span>&nbsp;<span class="op" id="7543903">:=</span>&nbsp;<span class="string" id="7543906">`POST&nbsp;/test.cgi?a=b&nbsp;HTTP/1.1<br>
<span class="lineno"></span>Host:&nbsp;example.com<br>
<span class="lineno"></span>Content-Type:&nbsp;application/x-www-form-urlencoded<br>
<span class="lineno"></span>Transfer-Encoding:&nbsp;chunked<br>
<span class="lineno"></span><br>
<span class="lineno">250</span>`</span>&nbsp;<span class="op" id="7544031">+</span>&nbsp;<span class="ident" id="7544033"><a href="/net/http/cgi/host_test.go.html#7543721">chunk</a></span><span class="op" id="7544038">(</span><span class="string" id="7544039">&#34;postfoo&#34;</span><span class="op" id="7544048">)</span>&nbsp;<span class="op" id="7544050">+</span>&nbsp;<span class="ident" id="7544052"><a href="/net/http/cgi/host_test.go.html#7543721">chunk</a></span><span class="op" id="7544057">(</span><span class="string" id="7544058">&#34;=&#34;</span><span class="op" id="7544061">)</span>&nbsp;<span class="op" id="7544063">+</span>&nbsp;<span class="ident" id="7544065"><a href="/net/http/cgi/host_test.go.html#7543721">chunk</a></span><span class="op" id="7544070">(</span><span class="string" id="7544071">&#34;postbar&#34;</span><span class="op" id="7544080">)</span>&nbsp;<span class="op" id="7544082">+</span>&nbsp;<span class="ident" id="7544084"><a href="/net/http/cgi/host_test.go.html#7543721">chunk</a></span><span class="op" id="7544089">(</span><span class="string" id="7544090">&#34;&#34;</span><span class="op" id="7544092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544096">h</span>&nbsp;<span class="op" id="7544098">:=</span>&nbsp;<span class="op" id="7544101">&amp;</span><span class="ident" id="7544102"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7544109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544113">Path</span><span class="op" id="7544117">:</span>&nbsp;<span class="string" id="7544119">&#34;testdata/test.cgi&#34;</span><span class="op" id="7544138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544142">Root</span><span class="op" id="7544146">:</span>&nbsp;<span class="string" id="7544148">&#34;/test.cgi&#34;</span><span class="op" id="7544159">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7544162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544165">expectedMap</span>&nbsp;<span class="op" id="7544177">:=</span>&nbsp;<span class="keyword" id="7544180">map</span><span class="op" id="7544183">[</span><span class="builtintype" id="7544184">string</span><span class="op" id="7544190">]</span><span class="builtintype" id="7544191">string</span><span class="op" id="7544197">{</span><span class="op" id="7544198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544201">resp</span>&nbsp;<span class="op" id="7544206">:=</span>&nbsp;<span class="ident" id="7544209"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7544219">(</span><span class="ident" id="7544220"><a href="/net/http/cgi/host_test.go.html#7543868">t</a></span><span class="op" id="7544221">,</span>&nbsp;<span class="ident" id="7544223"><a href="/net/http/cgi/host_test.go.html#7544096">h</a></span><span class="op" id="7544224">,</span>&nbsp;<span class="ident" id="7544226"><a href="/net/http/cgi/host_test.go.html#7543895">postReq</a></span><span class="op" id="7544233">,</span>&nbsp;<span class="ident" id="7544235"><a href="/net/http/cgi/host_test.go.html#7544165">expectedMap</a></span><span class="op" id="7544246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7544249">if</span>&nbsp;<span class="ident" id="7544252">got</span><span class="op" id="7544255">,</span>&nbsp;<span class="ident" id="7544257">expected</span>&nbsp;<span class="op" id="7544266">:=</span>&nbsp;<span class="ident" id="7544269"><a href="/net/http/cgi/host_test.go.html#7544201">resp</a></span><span class="op" id="7544273">.</span><span class="ident" id="7544274">Code</span><span class="op" id="7544278">,</span>&nbsp;<span class="ident" id="7544280"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7544284">.</span><span class="ident" id="7544285">StatusBadRequest</span><span class="op" id="7544301">;</span>&nbsp;<span class="ident" id="7544303"><a href="/net/http/cgi/host_test.go.html#7544252">got</a></span>&nbsp;<span class="op" id="7544307">!=</span>&nbsp;<span class="ident" id="7544310"><a href="/net/http/cgi/host_test.go.html#7544257">expected</a></span>&nbsp;<span class="op" id="7544319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544323"><a href="/net/http/cgi/host_test.go.html#7543868">t</a></span><span class="op" id="7544324">.</span><span class="ident" id="7544325">Fatalf</span><span class="op" id="7544331">(</span><span class="string" id="7544332">&#34;Expected&nbsp;%v&nbsp;response&nbsp;code&nbsp;from&nbsp;chunked&nbsp;request&nbsp;body;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7544393">,</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544398"><a href="/net/http/cgi/host_test.go.html#7544257">expected</a></span><span class="op" id="7544406">,</span>&nbsp;<span class="ident" id="7544408"><a href="/net/http/cgi/host_test.go.html#7544252">got</a></span><span class="op" id="7544411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7544414">}</span><br>
<span class="lineno"></span><span class="op" id="7544416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7544419">func</span>&nbsp;<span class="ident" id="7544424">TestRedirect</span><span class="op" id="7544436">(</span><span class="ident" id="7544437">t</span>&nbsp;<span class="op" id="7544439">*</span><span class="ident" id="7544440"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7544447">.</span><span class="ident" id="7544448">T</span><span class="op" id="7544449">)</span>&nbsp;<span class="op" id="7544451">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544454"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7544459">(</span><span class="ident" id="7544460"><a href="/net/http/cgi/host_test.go.html#7544437">t</a></span><span class="op" id="7544461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544464">h</span>&nbsp;<span class="op" id="7544466">:=</span>&nbsp;<span class="op" id="7544469">&amp;</span><span class="ident" id="7544470"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7544477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544481">Path</span><span class="op" id="7544485">:</span>&nbsp;<span class="string" id="7544487">&#34;testdata/test.cgi&#34;</span><span class="op" id="7544506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544510">Root</span><span class="op" id="7544514">:</span>&nbsp;<span class="string" id="7544516">&#34;/test.cgi&#34;</span><span class="op" id="7544527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7544530">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544533">rec</span>&nbsp;<span class="op" id="7544537">:=</span>&nbsp;<span class="ident" id="7544540"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7544550">(</span><span class="ident" id="7544551"><a href="/net/http/cgi/host_test.go.html#7544437">t</a></span><span class="op" id="7544552">,</span>&nbsp;<span class="ident" id="7544554"><a href="/net/http/cgi/host_test.go.html#7544464">h</a></span><span class="op" id="7544555">,</span>&nbsp;<span class="string" id="7544557">&#34;GET&nbsp;/test.cgi?loc=http://foo.com/&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7544624">,</span>&nbsp;<span class="ident" id="7544626">nil</span><span class="op" id="7544629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7544632">if</span>&nbsp;<span class="ident" id="7544635">e</span><span class="op" id="7544636">,</span>&nbsp;<span class="ident" id="7544638">g</span>&nbsp;<span class="op" id="7544640">:=</span>&nbsp;<span class="num" id="7544643">302</span><span class="op" id="7544646">,</span>&nbsp;<span class="ident" id="7544648"><a href="/net/http/cgi/host_test.go.html#7544533">rec</a></span><span class="op" id="7544651">.</span><span class="ident" id="7544652">Code</span><span class="op" id="7544656">;</span>&nbsp;<span class="ident" id="7544658"><a href="/net/http/cgi/host_test.go.html#7544635">e</a></span>&nbsp;<span class="op" id="7544660">!=</span>&nbsp;<span class="ident" id="7544663"><a href="/net/http/cgi/host_test.go.html#7544638">g</a></span>&nbsp;<span class="op" id="7544665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544669"><a href="/net/http/cgi/host_test.go.html#7544437">t</a></span><span class="op" id="7544670">.</span><span class="ident" id="7544671">Errorf</span><span class="op" id="7544677">(</span><span class="string" id="7544678">&#34;expected&nbsp;status&nbsp;code&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7544711">,</span>&nbsp;<span class="ident" id="7544713"><a href="/net/http/cgi/host_test.go.html#7544635">e</a></span><span class="op" id="7544714">,</span>&nbsp;<span class="ident" id="7544716"><a href="/net/http/cgi/host_test.go.html#7544638">g</a></span><span class="op" id="7544717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7544720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7544723">if</span>&nbsp;<span class="ident" id="7544726">e</span><span class="op" id="7544727">,</span>&nbsp;<span class="ident" id="7544729">g</span>&nbsp;<span class="op" id="7544731">:=</span>&nbsp;<span class="string" id="7544734">&#34;http://foo.com/&#34;</span><span class="op" id="7544751">,</span>&nbsp;<span class="ident" id="7544753"><a href="/net/http/cgi/host_test.go.html#7544533">rec</a></span><span class="op" id="7544756">.</span><span class="ident" id="7544757">Header</span><span class="op" id="7544763">(</span><span class="op" id="7544764">)</span><span class="op" id="7544765">.</span><span class="ident" id="7544766">Get</span><span class="op" id="7544769">(</span><span class="string" id="7544770">&#34;Location&#34;</span><span class="op" id="7544780">)</span><span class="op" id="7544781">;</span>&nbsp;<span class="ident" id="7544783"><a href="/net/http/cgi/host_test.go.html#7544726">e</a></span>&nbsp;<span class="op" id="7544785">!=</span>&nbsp;<span class="ident" id="7544788"><a href="/net/http/cgi/host_test.go.html#7544729">g</a></span>&nbsp;<span class="op" id="7544790">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544794"><a href="/net/http/cgi/host_test.go.html#7544437">t</a></span><span class="op" id="7544795">.</span><span class="ident" id="7544796">Errorf</span><span class="op" id="7544802">(</span><span class="string" id="7544803">&#34;expected&nbsp;Location&nbsp;header&nbsp;of&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7544843">,</span>&nbsp;<span class="ident" id="7544845"><a href="/net/http/cgi/host_test.go.html#7544726">e</a></span><span class="op" id="7544846">,</span>&nbsp;<span class="ident" id="7544848"><a href="/net/http/cgi/host_test.go.html#7544729">g</a></span><span class="op" id="7544849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7544852">}</span><br>
<span class="lineno"></span><span class="op" id="7544854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7544857">func</span>&nbsp;<span class="ident" id="7544862">TestInternalRedirect</span><span class="op" id="7544882">(</span><span class="ident" id="7544883">t</span>&nbsp;<span class="op" id="7544885">*</span><span class="ident" id="7544886"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7544893">.</span><span class="ident" id="7544894">T</span><span class="op" id="7544895">)</span>&nbsp;<span class="op" id="7544897">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544900"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7544905">(</span><span class="ident" id="7544906"><a href="/net/http/cgi/host_test.go.html#7544883">t</a></span><span class="op" id="7544907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544910">baseHandler</span>&nbsp;<span class="op" id="7544922">:=</span>&nbsp;<span class="ident" id="7544925"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7544929">.</span><span class="ident" id="7544930">HandlerFunc</span><span class="op" id="7544941">(</span><span class="keyword" id="7544942">func</span><span class="op" id="7544946">(</span><span class="ident" id="7544947">rw</span>&nbsp;<span class="ident" id="7544950"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7544954">.</span><span class="ident" id="7544955">ResponseWriter</span><span class="op" id="7544969">,</span>&nbsp;<span class="ident" id="7544971">req</span>&nbsp;<span class="op" id="7544975">*</span><span class="ident" id="7544976"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7544980">.</span><span class="ident" id="7544981">Request</span><span class="op" id="7544988">)</span>&nbsp;<span class="op" id="7544990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7544994"><a href="/net/http/cgi/host_test.go.html#7537818">fmt</a></span><span class="op" id="7544997">.</span><span class="ident" id="7544998">Fprintf</span><span class="op" id="7545005">(</span><span class="ident" id="7545006"><a href="/net/http/cgi/host_test.go.html#7544947">rw</a></span><span class="op" id="7545008">,</span>&nbsp;<span class="string" id="7545010">&#34;basepath=%s\n&#34;</span><span class="op" id="7545025">,</span>&nbsp;<span class="ident" id="7545027"><a href="/net/http/cgi/host_test.go.html#7544971">req</a></span><span class="op" id="7545030">.</span><span class="ident" id="7545031">URL</span><span class="op" id="7545034">.</span><span class="ident" id="7545035">Path</span><span class="op" id="7545039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545043"><a href="/net/http/cgi/host_test.go.html#7537818">fmt</a></span><span class="op" id="7545046">.</span><span class="ident" id="7545047">Fprintf</span><span class="op" id="7545054">(</span><span class="ident" id="7545055"><a href="/net/http/cgi/host_test.go.html#7544947">rw</a></span><span class="op" id="7545057">,</span>&nbsp;<span class="string" id="7545059">&#34;remoteaddr=%s\n&#34;</span><span class="op" id="7545076">,</span>&nbsp;<span class="ident" id="7545078"><a href="/net/http/cgi/host_test.go.html#7544971">req</a></span><span class="op" id="7545081">.</span><span class="ident" id="7545082">RemoteAddr</span><span class="op" id="7545092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545095">}</span><span class="op" id="7545096">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545099">h</span>&nbsp;<span class="op" id="7545101">:=</span>&nbsp;<span class="op" id="7545104">&amp;</span><span class="ident" id="7545105"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7545112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545116">Path</span><span class="op" id="7545120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7545137">&#34;testdata/test.cgi&#34;</span><span class="op" id="7545156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545160">Root</span><span class="op" id="7545164">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7545181">&#34;/test.cgi&#34;</span><span class="op" id="7545192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545196">PathLocationHandler</span><span class="op" id="7545215">:</span>&nbsp;<span class="ident" id="7545217"><a href="/net/http/cgi/host_test.go.html#7544910">baseHandler</a></span><span class="op" id="7545228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545231">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545234">expectedMap</span>&nbsp;<span class="op" id="7545246">:=</span>&nbsp;<span class="keyword" id="7545249">map</span><span class="op" id="7545252">[</span><span class="builtintype" id="7545253">string</span><span class="op" id="7545259">]</span><span class="builtintype" id="7545260">string</span><span class="op" id="7545266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7545270">&#34;basepath&#34;</span><span class="op" id="7545280">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7545284">&#34;/foo&#34;</span><span class="op" id="7545290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7545294">&#34;remoteaddr&#34;</span><span class="op" id="7545306">:</span>&nbsp;<span class="string" id="7545308">&#34;1.2.3.4&#34;</span><span class="op" id="7545317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545323"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7545333">(</span><span class="ident" id="7545334"><a href="/net/http/cgi/host_test.go.html#7544883">t</a></span><span class="op" id="7545335">,</span>&nbsp;<span class="ident" id="7545337"><a href="/net/http/cgi/host_test.go.html#7545099">h</a></span><span class="op" id="7545338">,</span>&nbsp;<span class="string" id="7545340">&#34;GET&nbsp;/test.cgi?loc=/foo&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7545396">,</span>&nbsp;<span class="ident" id="7545398"><a href="/net/http/cgi/host_test.go.html#7545234">expectedMap</a></span><span class="op" id="7545409">)</span><br>
<span class="lineno">295</span><span class="op" id="7545411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7545414">//&nbsp;TestCopyError&nbsp;tests&nbsp;that&nbsp;we&nbsp;kill&nbsp;the&nbsp;process&nbsp;if&nbsp;there&#39;s&nbsp;an&nbsp;error&nbsp;copying</span><br>
<span class="lineno"></span><span class="comment" id="7545490">//&nbsp;its&nbsp;output.&nbsp;(for&nbsp;example,&nbsp;from&nbsp;the&nbsp;client&nbsp;having&nbsp;gone&nbsp;away)</span><br>
<span class="lineno"></span><span class="keyword" id="7545553">func</span>&nbsp;<span class="ident" id="7545558">TestCopyError</span><span class="op" id="7545571">(</span><span class="ident" id="7545572">t</span>&nbsp;<span class="op" id="7545574">*</span><span class="ident" id="7545575"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7545582">.</span><span class="ident" id="7545583">T</span><span class="op" id="7545584">)</span>&nbsp;<span class="op" id="7545586">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545589"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7545594">(</span><span class="ident" id="7545595"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7545596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7545599">if</span>&nbsp;<span class="ident" id="7545602"><a href="/net/http/cgi/host_test.go.html#7537905">runtime</a></span><span class="op" id="7545609">.</span><span class="ident" id="7545610">GOOS</span>&nbsp;<span class="op" id="7545615">==</span>&nbsp;<span class="string" id="7545618">&#34;windows&#34;</span>&nbsp;<span class="op" id="7545628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545632"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7545633">.</span><span class="ident" id="7545634">Skipf</span><span class="op" id="7545639">(</span><span class="string" id="7545640">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7545661">,</span>&nbsp;<span class="ident" id="7545663"><a href="/net/http/cgi/host_test.go.html#7537905">runtime</a></span><span class="op" id="7545670">.</span><span class="ident" id="7545671">GOOS</span><span class="op" id="7545675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545681">h</span>&nbsp;<span class="op" id="7545683">:=</span>&nbsp;<span class="op" id="7545686">&amp;</span><span class="ident" id="7545687"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7545694">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545698">Path</span><span class="op" id="7545702">:</span>&nbsp;<span class="string" id="7545704">&#34;testdata/test.cgi&#34;</span><span class="op" id="7545723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545727">Root</span><span class="op" id="7545731">:</span>&nbsp;<span class="string" id="7545733">&#34;/test.cgi&#34;</span><span class="op" id="7545744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545750">ts</span>&nbsp;<span class="op" id="7545753">:=</span>&nbsp;<span class="ident" id="7545756"><a href="/net/http/cgi/host_test.go.html#7537850">httptest</a></span><span class="op" id="7545764">.</span><span class="ident" id="7545765">NewServer</span><span class="op" id="7545774">(</span><span class="ident" id="7545775"><a href="/net/http/cgi/host_test.go.html#7545681">h</a></span><span class="op" id="7545776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7545779">defer</span>&nbsp;<span class="ident" id="7545785"><a href="/net/http/cgi/host_test.go.html#7545750">ts</a></span><span class="op" id="7545787">.</span><span class="ident" id="7545788">Close</span><span class="op" id="7545793">(</span><span class="op" id="7545794">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545798">conn</span><span class="op" id="7545802">,</span>&nbsp;<span class="ident" id="7545804">err</span>&nbsp;<span class="op" id="7545808">:=</span>&nbsp;<span class="ident" id="7545811"><a href="/net/http/cgi/host_test.go.html#7537831">net</a></span><span class="op" id="7545814">.</span><span class="ident" id="7545815">Dial</span><span class="op" id="7545819">(</span><span class="string" id="7545820">&#34;tcp&#34;</span><span class="op" id="7545825">,</span>&nbsp;<span class="ident" id="7545827"><a href="/net/http/cgi/host_test.go.html#7545750">ts</a></span><span class="op" id="7545829">.</span><span class="ident" id="7545830">Listener</span><span class="op" id="7545838">.</span><span class="ident" id="7545839">Addr</span><span class="op" id="7545843">(</span><span class="op" id="7545844">)</span><span class="op" id="7545845">.</span><span class="ident" id="7545846">String</span><span class="op" id="7545852">(</span><span class="op" id="7545853">)</span><span class="op" id="7545854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7545857">if</span>&nbsp;<span class="ident" id="7545860"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7545864">!=</span>&nbsp;<span class="ident" id="7545867">nil</span>&nbsp;<span class="op" id="7545871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545875"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7545876">.</span><span class="ident" id="7545877">Fatal</span><span class="op" id="7545882">(</span><span class="ident" id="7545883"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span><span class="op" id="7545886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7545889">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545892">req</span><span class="op" id="7545895">,</span>&nbsp;<span class="ident" id="7545897">_</span>&nbsp;<span class="op" id="7545899">:=</span>&nbsp;<span class="ident" id="7545902"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7545906">.</span><span class="ident" id="7545907">NewRequest</span><span class="op" id="7545917">(</span><span class="string" id="7545918">&#34;GET&#34;</span><span class="op" id="7545923">,</span>&nbsp;<span class="string" id="7545925">&#34;http://example.com/test.cgi?bigresponse=1&#34;</span><span class="op" id="7545968">,</span>&nbsp;<span class="ident" id="7545970">nil</span><span class="op" id="7545973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7545976"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7545980">=</span>&nbsp;<span class="ident" id="7545982"><a href="/net/http/cgi/host_test.go.html#7545892">req</a></span><span class="op" id="7545985">.</span><span class="ident" id="7545986">Write</span><span class="op" id="7545991">(</span><span class="ident" id="7545992"><a href="/net/http/cgi/host_test.go.html#7545798">conn</a></span><span class="op" id="7545996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7545999">if</span>&nbsp;<span class="ident" id="7546002"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546006">!=</span>&nbsp;<span class="ident" id="7546009">nil</span>&nbsp;<span class="op" id="7546013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546017"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546018">.</span><span class="ident" id="7546019">Fatalf</span><span class="op" id="7546025">(</span><span class="string" id="7546026">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7546037">,</span>&nbsp;<span class="ident" id="7546039"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span><span class="op" id="7546042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546045">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546049">res</span><span class="op" id="7546052">,</span>&nbsp;<span class="ident" id="7546054"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546058">:=</span>&nbsp;<span class="ident" id="7546061"><a href="/net/http/cgi/host_test.go.html#7537838">http</a></span><span class="op" id="7546065">.</span><span class="ident" id="7546066">ReadResponse</span><span class="op" id="7546078">(</span><span class="ident" id="7546079"><a href="/net/http/cgi/host_test.go.html#7537809">bufio</a></span><span class="op" id="7546084">.</span><span class="ident" id="7546085">NewReader</span><span class="op" id="7546094">(</span><span class="ident" id="7546095"><a href="/net/http/cgi/host_test.go.html#7545798">conn</a></span><span class="op" id="7546099">)</span><span class="op" id="7546100">,</span>&nbsp;<span class="ident" id="7546102"><a href="/net/http/cgi/host_test.go.html#7545892">req</a></span><span class="op" id="7546105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546108">if</span>&nbsp;<span class="ident" id="7546111"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546115">!=</span>&nbsp;<span class="ident" id="7546118">nil</span>&nbsp;<span class="op" id="7546122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546126"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546127">.</span><span class="ident" id="7546128">Fatalf</span><span class="op" id="7546134">(</span><span class="string" id="7546135">&#34;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7546153">,</span>&nbsp;<span class="ident" id="7546155"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span><span class="op" id="7546158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546161">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546165">pidstr</span>&nbsp;<span class="op" id="7546172">:=</span>&nbsp;<span class="ident" id="7546175"><a href="/net/http/cgi/host_test.go.html#7546049">res</a></span><span class="op" id="7546178">.</span><span class="ident" id="7546179">Header</span><span class="op" id="7546185">.</span><span class="ident" id="7546186">Get</span><span class="op" id="7546189">(</span><span class="string" id="7546190">&#34;X-CGI-Pid&#34;</span><span class="op" id="7546201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546204">if</span>&nbsp;<span class="ident" id="7546207"><a href="/net/http/cgi/host_test.go.html#7546165">pidstr</a></span>&nbsp;<span class="op" id="7546214">==</span>&nbsp;<span class="string" id="7546217">&#34;&#34;</span>&nbsp;<span class="op" id="7546220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546224"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546225">.</span><span class="ident" id="7546226">Fatalf</span><span class="op" id="7546232">(</span><span class="string" id="7546233">&#34;expected&nbsp;an&nbsp;X-CGI-Pid&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="7546275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546278">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546281">pid</span><span class="op" id="7546284">,</span>&nbsp;<span class="ident" id="7546286"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546290">:=</span>&nbsp;<span class="ident" id="7546293"><a href="/net/http/cgi/host_test.go.html#7537916">strconv</a></span><span class="op" id="7546300">.</span><span class="ident" id="7546301">Atoi</span><span class="op" id="7546305">(</span><span class="ident" id="7546306"><a href="/net/http/cgi/host_test.go.html#7546165">pidstr</a></span><span class="op" id="7546312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546315">if</span>&nbsp;<span class="ident" id="7546318"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546322">!=</span>&nbsp;<span class="ident" id="7546325">nil</span>&nbsp;<span class="op" id="7546329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546333"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546334">.</span><span class="ident" id="7546335">Fatalf</span><span class="op" id="7546341">(</span><span class="string" id="7546342">&#34;invalid&nbsp;X-CGI-Pid&nbsp;value&#34;</span><span class="op" id="7546367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546374">var</span>&nbsp;<span class="ident" id="7546378">buf</span>&nbsp;<span class="op" id="7546382">[</span><span class="num" id="7546383">5000</span><span class="op" id="7546387">]</span><span class="builtintype" id="7546388">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546394">n</span><span class="op" id="7546395">,</span>&nbsp;<span class="ident" id="7546397"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546401">:=</span>&nbsp;<span class="ident" id="7546404"><a href="/net/http/cgi/host_test.go.html#7537825">io</a></span><span class="op" id="7546406">.</span><span class="ident" id="7546407">ReadFull</span><span class="op" id="7546415">(</span><span class="ident" id="7546416"><a href="/net/http/cgi/host_test.go.html#7546049">res</a></span><span class="op" id="7546419">.</span><span class="ident" id="7546420">Body</span><span class="op" id="7546424">,</span>&nbsp;<span class="ident" id="7546426"><a href="/net/http/cgi/host_test.go.html#7546378">buf</a></span><span class="op" id="7546429">[</span><span class="op" id="7546430">:</span><span class="op" id="7546431">]</span><span class="op" id="7546432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546435">if</span>&nbsp;<span class="ident" id="7546438"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span>&nbsp;<span class="op" id="7546442">!=</span>&nbsp;<span class="ident" id="7546445">nil</span>&nbsp;<span class="op" id="7546449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546453"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546454">.</span><span class="ident" id="7546455">Fatalf</span><span class="op" id="7546461">(</span><span class="string" id="7546462">&#34;ReadFull:&nbsp;%d&nbsp;bytes,&nbsp;%v&#34;</span><span class="op" id="7546486">,</span>&nbsp;<span class="ident" id="7546488"><a href="/net/http/cgi/host_test.go.html#7546394">n</a></span><span class="op" id="7546489">,</span>&nbsp;<span class="ident" id="7546491"><a href="/net/http/cgi/host_test.go.html#7545804">err</a></span><span class="op" id="7546494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546497">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546501">childRunning</span>&nbsp;<span class="op" id="7546514">:=</span>&nbsp;<span class="keyword" id="7546517">func</span><span class="op" id="7546521">(</span><span class="op" id="7546522">)</span>&nbsp;<span class="builtintype" id="7546524">bool</span>&nbsp;<span class="op" id="7546529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546533">return</span>&nbsp;<span class="ident" id="7546540"><a href="/net/http/cgi/posix_test.go.html#7555395">isProcessRunning</a></span><span class="op" id="7546556">(</span><span class="ident" id="7546557"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546558">,</span>&nbsp;<span class="ident" id="7546560"><a href="/net/http/cgi/host_test.go.html#7546281">pid</a></span><span class="op" id="7546563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546570">if</span>&nbsp;<span class="op" id="7546573">!</span><span class="ident" id="7546574"><a href="/net/http/cgi/host_test.go.html#7546501">childRunning</a></span><span class="op" id="7546586">(</span><span class="op" id="7546587">)</span>&nbsp;<span class="op" id="7546589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546593"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546594">.</span><span class="ident" id="7546595">Fatalf</span><span class="op" id="7546601">(</span><span class="string" id="7546602">&#34;pre-conn.Close,&nbsp;expected&nbsp;child&nbsp;to&nbsp;be&nbsp;running&#34;</span><span class="op" id="7546648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546654"><a href="/net/http/cgi/host_test.go.html#7545798">conn</a></span><span class="op" id="7546658">.</span><span class="ident" id="7546659">Close</span><span class="op" id="7546664">(</span><span class="op" id="7546665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546669">tries</span>&nbsp;<span class="op" id="7546675">:=</span>&nbsp;<span class="num" id="7546678">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546681">for</span>&nbsp;<span class="ident" id="7546685"><a href="/net/http/cgi/host_test.go.html#7546669">tries</a></span>&nbsp;<span class="op" id="7546691">&lt;</span>&nbsp;<span class="num" id="7546693">25</span>&nbsp;<span class="op" id="7546696">&amp;&amp;</span>&nbsp;<span class="ident" id="7546699"><a href="/net/http/cgi/host_test.go.html#7546501">childRunning</a></span><span class="op" id="7546711">(</span><span class="op" id="7546712">)</span>&nbsp;<span class="op" id="7546714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546718"><a href="/net/http/cgi/host_test.go.html#7537949">time</a></span><span class="op" id="7546722">.</span><span class="ident" id="7546723">Sleep</span><span class="op" id="7546728">(</span><span class="num" id="7546729">50</span>&nbsp;<span class="op" id="7546732">*</span>&nbsp;<span class="ident" id="7546734"><a href="/net/http/cgi/host_test.go.html#7537949">time</a></span><span class="op" id="7546738">.</span><span class="ident" id="7546739">Millisecond</span>&nbsp;<span class="op" id="7546751">*</span>&nbsp;<span class="ident" id="7546753"><a href="/net/http/cgi/host_test.go.html#7537949">time</a></span><span class="op" id="7546757">.</span><span class="ident" id="7546758">Duration</span><span class="op" id="7546766">(</span><span class="ident" id="7546767"><a href="/net/http/cgi/host_test.go.html#7546669">tries</a></span><span class="op" id="7546772">)</span><span class="op" id="7546773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546777"><a href="/net/http/cgi/host_test.go.html#7546669">tries</a></span><span class="op" id="7546782">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546786">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546789">if</span>&nbsp;<span class="ident" id="7546792"><a href="/net/http/cgi/host_test.go.html#7546501">childRunning</a></span><span class="op" id="7546804">(</span><span class="op" id="7546805">)</span>&nbsp;<span class="op" id="7546807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546811"><a href="/net/http/cgi/host_test.go.html#7545572">t</a></span><span class="op" id="7546812">.</span><span class="ident" id="7546813">Fatalf</span><span class="op" id="7546819">(</span><span class="string" id="7546820">&#34;post-conn.Close,&nbsp;expected&nbsp;child&nbsp;to&nbsp;be&nbsp;gone&#34;</span><span class="op" id="7546864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546867">}</span><br>
<span class="lineno"></span><span class="op" id="7546869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7546872">func</span>&nbsp;<span class="ident" id="7546877">TestDirUnix</span><span class="op" id="7546888">(</span><span class="ident" id="7546889">t</span>&nbsp;<span class="op" id="7546891">*</span><span class="ident" id="7546892"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7546899">.</span><span class="ident" id="7546900">T</span><span class="op" id="7546901">)</span>&nbsp;<span class="op" id="7546903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546906"><a href="/net/http/cgi/host_test.go.html#7539403">check</a></span><span class="op" id="7546911">(</span><span class="ident" id="7546912"><a href="/net/http/cgi/host_test.go.html#7546889">t</a></span><span class="op" id="7546913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7546916">if</span>&nbsp;<span class="ident" id="7546919"><a href="/net/http/cgi/host_test.go.html#7537905">runtime</a></span><span class="op" id="7546926">.</span><span class="ident" id="7546927">GOOS</span>&nbsp;<span class="op" id="7546932">==</span>&nbsp;<span class="string" id="7546935">&#34;windows&#34;</span>&nbsp;<span class="op" id="7546945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546949"><a href="/net/http/cgi/host_test.go.html#7546889">t</a></span><span class="op" id="7546950">.</span><span class="ident" id="7546951">Skipf</span><span class="op" id="7546956">(</span><span class="string" id="7546957">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7546978">,</span>&nbsp;<span class="ident" id="7546980"><a href="/net/http/cgi/host_test.go.html#7537905">runtime</a></span><span class="op" id="7546987">.</span><span class="ident" id="7546988">GOOS</span><span class="op" id="7546992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7546995">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7546998">cwd</span><span class="op" id="7547001">,</span>&nbsp;<span class="ident" id="7547003">_</span>&nbsp;<span class="op" id="7547005">:=</span>&nbsp;<span class="ident" id="7547008"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7547010">.</span><span class="ident" id="7547011">Getwd</span><span class="op" id="7547016">(</span><span class="op" id="7547017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547020">h</span>&nbsp;<span class="op" id="7547022">:=</span>&nbsp;<span class="op" id="7547025">&amp;</span><span class="ident" id="7547026"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7547033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547037">Path</span><span class="op" id="7547041">:</span>&nbsp;<span class="string" id="7547043">&#34;testdata/test.cgi&#34;</span><span class="op" id="7547062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547066">Root</span><span class="op" id="7547070">:</span>&nbsp;<span class="string" id="7547072">&#34;/test.cgi&#34;</span><span class="op" id="7547083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547087">Dir</span><span class="op" id="7547090">:</span>&nbsp;&nbsp;<span class="ident" id="7547093"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span><span class="op" id="7547096">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547102">expectedMap</span>&nbsp;<span class="op" id="7547114">:=</span>&nbsp;<span class="keyword" id="7547117">map</span><span class="op" id="7547120">[</span><span class="builtintype" id="7547121">string</span><span class="op" id="7547127">]</span><span class="builtintype" id="7547128">string</span><span class="op" id="7547134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7547138">&#34;cwd&#34;</span><span class="op" id="7547143">:</span>&nbsp;<span class="ident" id="7547145"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span><span class="op" id="7547148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547154"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7547164">(</span><span class="ident" id="7547165"><a href="/net/http/cgi/host_test.go.html#7546889">t</a></span><span class="op" id="7547166">,</span>&nbsp;<span class="ident" id="7547168"><a href="/net/http/cgi/host_test.go.html#7547020">h</a></span><span class="op" id="7547169">,</span>&nbsp;<span class="string" id="7547171">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7547218">,</span>&nbsp;<span class="ident" id="7547220"><a href="/net/http/cgi/host_test.go.html#7547102">expectedMap</a></span><span class="op" id="7547231">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547235"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span><span class="op" id="7547238">,</span>&nbsp;<span class="ident" id="7547240">_</span>&nbsp;<span class="op" id="7547242">=</span>&nbsp;<span class="ident" id="7547244"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7547246">.</span><span class="ident" id="7547247">Getwd</span><span class="op" id="7547252">(</span><span class="op" id="7547253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547256"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span>&nbsp;<span class="op" id="7547260">=</span>&nbsp;<span class="ident" id="7547262"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7547270">.</span><span class="ident" id="7547271">Join</span><span class="op" id="7547275">(</span><span class="ident" id="7547276"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span><span class="op" id="7547279">,</span>&nbsp;<span class="string" id="7547281">&#34;testdata&#34;</span><span class="op" id="7547291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547294"><a href="/net/http/cgi/host_test.go.html#7547020">h</a></span>&nbsp;<span class="op" id="7547296">=</span>&nbsp;<span class="op" id="7547298">&amp;</span><span class="ident" id="7547299"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7547306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547310">Path</span><span class="op" id="7547314">:</span>&nbsp;<span class="string" id="7547316">&#34;testdata/test.cgi&#34;</span><span class="op" id="7547335">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547339">Root</span><span class="op" id="7547343">:</span>&nbsp;<span class="string" id="7547345">&#34;/test.cgi&#34;</span><span class="op" id="7547356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547362"><a href="/net/http/cgi/host_test.go.html#7547102">expectedMap</a></span>&nbsp;<span class="op" id="7547374">=</span>&nbsp;<span class="keyword" id="7547376">map</span><span class="op" id="7547379">[</span><span class="builtintype" id="7547380">string</span><span class="op" id="7547386">]</span><span class="builtintype" id="7547387">string</span><span class="op" id="7547393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7547397">&#34;cwd&#34;</span><span class="op" id="7547402">:</span>&nbsp;<span class="ident" id="7547404"><a href="/net/http/cgi/host_test.go.html#7546998">cwd</a></span><span class="op" id="7547407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547410">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547413"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7547423">(</span><span class="ident" id="7547424"><a href="/net/http/cgi/host_test.go.html#7546889">t</a></span><span class="op" id="7547425">,</span>&nbsp;<span class="ident" id="7547427"><a href="/net/http/cgi/host_test.go.html#7547020">h</a></span><span class="op" id="7547428">,</span>&nbsp;<span class="string" id="7547430">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7547477">,</span>&nbsp;<span class="ident" id="7547479"><a href="/net/http/cgi/host_test.go.html#7547102">expectedMap</a></span><span class="op" id="7547490">)</span><br>
<span class="lineno"></span><span class="op" id="7547492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7547495">func</span>&nbsp;<span class="ident" id="7547500">TestDirWindows</span><span class="op" id="7547514">(</span><span class="ident" id="7547515">t</span>&nbsp;<span class="op" id="7547517">*</span><span class="ident" id="7547518"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7547525">.</span><span class="ident" id="7547526">T</span><span class="op" id="7547527">)</span>&nbsp;<span class="op" id="7547529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7547532">if</span>&nbsp;<span class="ident" id="7547535"><a href="/net/http/cgi/host_test.go.html#7537905">runtime</a></span><span class="op" id="7547542">.</span><span class="ident" id="7547543">GOOS</span>&nbsp;<span class="op" id="7547548">!=</span>&nbsp;<span class="string" id="7547551">&#34;windows&#34;</span>&nbsp;<span class="op" id="7547561">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547565"><a href="/net/http/cgi/host_test.go.html#7547515">t</a></span><span class="op" id="7547566">.</span><span class="ident" id="7547567">Skip</span><span class="op" id="7547571">(</span><span class="string" id="7547572">&#34;Skipping&nbsp;windows&nbsp;specific&nbsp;test.&#34;</span><span class="op" id="7547605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547612">cgifile</span><span class="op" id="7547619">,</span>&nbsp;<span class="ident" id="7547621">_</span>&nbsp;<span class="op" id="7547623">:=</span>&nbsp;<span class="ident" id="7547626"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7547634">.</span><span class="ident" id="7547635">Abs</span><span class="op" id="7547638">(</span><span class="string" id="7547639">&#34;testdata/test.cgi&#34;</span><span class="op" id="7547658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7547662">var</span>&nbsp;<span class="ident" id="7547666">perl</span>&nbsp;<span class="builtintype" id="7547671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7547679">var</span>&nbsp;<span class="ident" id="7547683">err</span>&nbsp;<span class="builtintype" id="7547687">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547694"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7547698">,</span>&nbsp;<span class="ident" id="7547700"><a href="/net/http/cgi/host_test.go.html#7547683">err</a></span>&nbsp;<span class="op" id="7547704">=</span>&nbsp;<span class="ident" id="7547706"><a href="/net/http/cgi/host_test.go.html#7537877">exec</a></span><span class="op" id="7547710">.</span><span class="ident" id="7547711">LookPath</span><span class="op" id="7547719">(</span><span class="string" id="7547720">&#34;perl&#34;</span><span class="op" id="7547726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7547729">if</span>&nbsp;<span class="ident" id="7547732"><a href="/net/http/cgi/host_test.go.html#7547683">err</a></span>&nbsp;<span class="op" id="7547736">!=</span>&nbsp;<span class="ident" id="7547739">nil</span>&nbsp;<span class="op" id="7547743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547747"><a href="/net/http/cgi/host_test.go.html#7547515">t</a></span><span class="op" id="7547748">.</span><span class="ident" id="7547749">Skip</span><span class="op" id="7547753">(</span><span class="string" id="7547754">&#34;Skipping&nbsp;test:&nbsp;perl&nbsp;not&nbsp;found.&#34;</span><span class="op" id="7547786">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547792"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7547796">,</span>&nbsp;<span class="ident" id="7547798">_</span>&nbsp;<span class="op" id="7547800">=</span>&nbsp;<span class="ident" id="7547802"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7547810">.</span><span class="ident" id="7547811">Abs</span><span class="op" id="7547814">(</span><span class="ident" id="7547815"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7547819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547823">cwd</span><span class="op" id="7547826">,</span>&nbsp;<span class="ident" id="7547828">_</span>&nbsp;<span class="op" id="7547830">:=</span>&nbsp;<span class="ident" id="7547833"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7547835">.</span><span class="ident" id="7547836">Getwd</span><span class="op" id="7547841">(</span><span class="op" id="7547842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547845">h</span>&nbsp;<span class="op" id="7547847">:=</span>&nbsp;<span class="op" id="7547850">&amp;</span><span class="ident" id="7547851"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7547858">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547862">Path</span><span class="op" id="7547866">:</span>&nbsp;<span class="ident" id="7547868"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7547872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547876">Root</span><span class="op" id="7547880">:</span>&nbsp;<span class="string" id="7547882">&#34;/test.cgi&#34;</span><span class="op" id="7547893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547897">Dir</span><span class="op" id="7547900">:</span>&nbsp;&nbsp;<span class="ident" id="7547903"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7547906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547910">Args</span><span class="op" id="7547914">:</span>&nbsp;<span class="op" id="7547916">[</span><span class="op" id="7547917">]</span><span class="builtintype" id="7547918">string</span><span class="op" id="7547924">{</span><span class="ident" id="7547925"><a href="/net/http/cgi/host_test.go.html#7547612">cgifile</a></span><span class="op" id="7547932">}</span><span class="op" id="7547933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547937">Env</span><span class="op" id="7547940">:</span>&nbsp;&nbsp;<span class="op" id="7547943">[</span><span class="op" id="7547944">]</span><span class="builtintype" id="7547945">string</span><span class="op" id="7547951">{</span><span class="string" id="7547952">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7547971">+</span>&nbsp;<span class="ident" id="7547973"><a href="/net/http/cgi/host_test.go.html#7547612">cgifile</a></span><span class="op" id="7547980">}</span><span class="op" id="7547981">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7547984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7547987">expectedMap</span>&nbsp;<span class="op" id="7547999">:=</span>&nbsp;<span class="keyword" id="7548002">map</span><span class="op" id="7548005">[</span><span class="builtintype" id="7548006">string</span><span class="op" id="7548012">]</span><span class="builtintype" id="7548013">string</span><span class="op" id="7548019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7548023">&#34;cwd&#34;</span><span class="op" id="7548028">:</span>&nbsp;<span class="ident" id="7548030"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7548036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548039"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7548049">(</span><span class="ident" id="7548050"><a href="/net/http/cgi/host_test.go.html#7547515">t</a></span><span class="op" id="7548051">,</span>&nbsp;<span class="ident" id="7548053"><a href="/net/http/cgi/host_test.go.html#7547845">h</a></span><span class="op" id="7548054">,</span>&nbsp;<span class="string" id="7548056">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7548103">,</span>&nbsp;<span class="ident" id="7548105"><a href="/net/http/cgi/host_test.go.html#7547987">expectedMap</a></span><span class="op" id="7548116">)</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7548120">//&nbsp;If&nbsp;not&nbsp;specify&nbsp;Dir&nbsp;on&nbsp;windows,&nbsp;working&nbsp;directory&nbsp;should&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7548183">//&nbsp;base&nbsp;directory&nbsp;of&nbsp;perl.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548211"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548214">,</span>&nbsp;<span class="ident" id="7548216">_</span>&nbsp;<span class="op" id="7548218">=</span>&nbsp;<span class="ident" id="7548220"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7548228">.</span><span class="ident" id="7548229">Split</span><span class="op" id="7548234">(</span><span class="ident" id="7548235"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7548239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7548242">if</span>&nbsp;<span class="ident" id="7548245"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span>&nbsp;<span class="op" id="7548249">!=</span>&nbsp;<span class="string" id="7548252">&#34;&#34;</span>&nbsp;<span class="op" id="7548255">&amp;&amp;</span>&nbsp;<span class="ident" id="7548258"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548261">[</span><span class="builtinfunc" id="7548262">len</span><span class="op" id="7548265">(</span><span class="ident" id="7548266"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548269">)</span><span class="op" id="7548270">-</span><span class="num" id="7548271">1</span><span class="op" id="7548272">]</span>&nbsp;<span class="op" id="7548274">==</span>&nbsp;<span class="ident" id="7548277"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7548285">.</span><span class="ident" id="7548286">Separator</span>&nbsp;<span class="op" id="7548296">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548300"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span>&nbsp;<span class="op" id="7548304">=</span>&nbsp;<span class="ident" id="7548306"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548309">[</span><span class="op" id="7548310">:</span><span class="builtinfunc" id="7548311">len</span><span class="op" id="7548314">(</span><span class="ident" id="7548315"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548318">)</span><span class="op" id="7548319">-</span><span class="num" id="7548320">1</span><span class="op" id="7548321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7548324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548327"><a href="/net/http/cgi/host_test.go.html#7547845">h</a></span>&nbsp;<span class="op" id="7548329">=</span>&nbsp;<span class="op" id="7548331">&amp;</span><span class="ident" id="7548332"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7548339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548343">Path</span><span class="op" id="7548347">:</span>&nbsp;<span class="ident" id="7548349"><a href="/net/http/cgi/host_test.go.html#7547666">perl</a></span><span class="op" id="7548353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548357">Root</span><span class="op" id="7548361">:</span>&nbsp;<span class="string" id="7548363">&#34;/test.cgi&#34;</span><span class="op" id="7548374">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548378">Args</span><span class="op" id="7548382">:</span>&nbsp;<span class="op" id="7548384">[</span><span class="op" id="7548385">]</span><span class="builtintype" id="7548386">string</span><span class="op" id="7548392">{</span><span class="ident" id="7548393"><a href="/net/http/cgi/host_test.go.html#7547612">cgifile</a></span><span class="op" id="7548400">}</span><span class="op" id="7548401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548405">Env</span><span class="op" id="7548408">:</span>&nbsp;&nbsp;<span class="op" id="7548411">[</span><span class="op" id="7548412">]</span><span class="builtintype" id="7548413">string</span><span class="op" id="7548419">{</span><span class="string" id="7548420">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7548439">+</span>&nbsp;<span class="ident" id="7548441"><a href="/net/http/cgi/host_test.go.html#7547612">cgifile</a></span><span class="op" id="7548448">}</span><span class="op" id="7548449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7548452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548455"><a href="/net/http/cgi/host_test.go.html#7547987">expectedMap</a></span>&nbsp;<span class="op" id="7548467">=</span>&nbsp;<span class="keyword" id="7548469">map</span><span class="op" id="7548472">[</span><span class="builtintype" id="7548473">string</span><span class="op" id="7548479">]</span><span class="builtintype" id="7548480">string</span><span class="op" id="7548486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7548490">&#34;cwd&#34;</span><span class="op" id="7548495">:</span>&nbsp;<span class="ident" id="7548497"><a href="/net/http/cgi/host_test.go.html#7547823">cwd</a></span><span class="op" id="7548500">,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7548503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548506"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7548516">(</span><span class="ident" id="7548517"><a href="/net/http/cgi/host_test.go.html#7547515">t</a></span><span class="op" id="7548518">,</span>&nbsp;<span class="ident" id="7548520"><a href="/net/http/cgi/host_test.go.html#7547845">h</a></span><span class="op" id="7548521">,</span>&nbsp;<span class="string" id="7548523">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7548570">,</span>&nbsp;<span class="ident" id="7548572"><a href="/net/http/cgi/host_test.go.html#7547987">expectedMap</a></span><span class="op" id="7548583">)</span><br>
<span class="lineno"></span><span class="op" id="7548585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7548588">func</span>&nbsp;<span class="ident" id="7548593">TestEnvOverride</span><span class="op" id="7548608">(</span><span class="ident" id="7548609">t</span>&nbsp;<span class="op" id="7548611">*</span><span class="ident" id="7548612"><a href="/net/http/cgi/host_test.go.html#7537938">testing</a></span><span class="op" id="7548619">.</span><span class="ident" id="7548620">T</span><span class="op" id="7548621">)</span>&nbsp;<span class="op" id="7548623">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548626">cgifile</span><span class="op" id="7548633">,</span>&nbsp;<span class="ident" id="7548635">_</span>&nbsp;<span class="op" id="7548637">:=</span>&nbsp;<span class="ident" id="7548640"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7548648">.</span><span class="ident" id="7548649">Abs</span><span class="op" id="7548652">(</span><span class="string" id="7548653">&#34;testdata/test.cgi&#34;</span><span class="op" id="7548672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7548676">var</span>&nbsp;<span class="ident" id="7548680">perl</span>&nbsp;<span class="builtintype" id="7548685">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7548693">var</span>&nbsp;<span class="ident" id="7548697">err</span>&nbsp;<span class="builtintype" id="7548701">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548708"><a href="/net/http/cgi/host_test.go.html#7548680">perl</a></span><span class="op" id="7548712">,</span>&nbsp;<span class="ident" id="7548714"><a href="/net/http/cgi/host_test.go.html#7548697">err</a></span>&nbsp;<span class="op" id="7548718">=</span>&nbsp;<span class="ident" id="7548720"><a href="/net/http/cgi/host_test.go.html#7537877">exec</a></span><span class="op" id="7548724">.</span><span class="ident" id="7548725">LookPath</span><span class="op" id="7548733">(</span><span class="string" id="7548734">&#34;perl&#34;</span><span class="op" id="7548740">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7548743">if</span>&nbsp;<span class="ident" id="7548746"><a href="/net/http/cgi/host_test.go.html#7548697">err</a></span>&nbsp;<span class="op" id="7548750">!=</span>&nbsp;<span class="ident" id="7548753">nil</span>&nbsp;<span class="op" id="7548757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548761"><a href="/net/http/cgi/host_test.go.html#7548609">t</a></span><span class="op" id="7548762">.</span><span class="ident" id="7548763">Skipf</span><span class="op" id="7548768">(</span><span class="string" id="7548769">&#34;Skipping&nbsp;test:&nbsp;perl&nbsp;not&nbsp;found.&#34;</span><span class="op" id="7548801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7548804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548807"><a href="/net/http/cgi/host_test.go.html#7548680">perl</a></span><span class="op" id="7548811">,</span>&nbsp;<span class="ident" id="7548813">_</span>&nbsp;<span class="op" id="7548815">=</span>&nbsp;<span class="ident" id="7548817"><a href="/net/http/cgi/host_test.go.html#7537888">filepath</a></span><span class="op" id="7548825">.</span><span class="ident" id="7548826">Abs</span><span class="op" id="7548829">(</span><span class="ident" id="7548830"><a href="/net/http/cgi/host_test.go.html#7548680">perl</a></span><span class="op" id="7548834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548838">cwd</span><span class="op" id="7548841">,</span>&nbsp;<span class="ident" id="7548843">_</span>&nbsp;<span class="op" id="7548845">:=</span>&nbsp;<span class="ident" id="7548848"><a href="/net/http/cgi/host_test.go.html#7537871">os</a></span><span class="op" id="7548850">.</span><span class="ident" id="7548851">Getwd</span><span class="op" id="7548856">(</span><span class="op" id="7548857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548860">h</span>&nbsp;<span class="op" id="7548862">:=</span>&nbsp;<span class="op" id="7548865">&amp;</span><span class="ident" id="7548866"><a href="/net/http/cgi/host.go.html#5493520">Handler</a></span><span class="op" id="7548873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548877">Path</span><span class="op" id="7548881">:</span>&nbsp;<span class="ident" id="7548883"><a href="/net/http/cgi/host_test.go.html#7548680">perl</a></span><span class="op" id="7548887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548891">Root</span><span class="op" id="7548895">:</span>&nbsp;<span class="string" id="7548897">&#34;/test.cgi&#34;</span><span class="op" id="7548908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548912">Dir</span><span class="op" id="7548915">:</span>&nbsp;&nbsp;<span class="ident" id="7548918"><a href="/net/http/cgi/host_test.go.html#7548838">cwd</a></span><span class="op" id="7548921">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548925">Args</span><span class="op" id="7548929">:</span>&nbsp;<span class="op" id="7548931">[</span><span class="op" id="7548932">]</span><span class="builtintype" id="7548933">string</span><span class="op" id="7548939">{</span><span class="ident" id="7548940"><a href="/net/http/cgi/host_test.go.html#7548626">cgifile</a></span><span class="op" id="7548947">}</span><span class="op" id="7548948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7548952">Env</span><span class="op" id="7548955">:</span>&nbsp;<span class="op" id="7548957">[</span><span class="op" id="7548958">]</span><span class="builtintype" id="7548959">string</span><span class="op" id="7548965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7548970">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7548989">+</span>&nbsp;<span class="ident" id="7548991"><a href="/net/http/cgi/host_test.go.html#7548626">cgifile</a></span><span class="op" id="7548998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7549003">&#34;REQUEST_URI=/foo/bar&#34;</span><span class="op" id="7549025">}</span><span class="op" id="7549026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7549029">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7549032">expectedMap</span>&nbsp;<span class="op" id="7549044">:=</span>&nbsp;<span class="keyword" id="7549047">map</span><span class="op" id="7549050">[</span><span class="builtintype" id="7549051">string</span><span class="op" id="7549057">]</span><span class="builtintype" id="7549058">string</span><span class="op" id="7549064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7549068">&#34;cwd&#34;</span><span class="op" id="7549073">:</span>&nbsp;<span class="ident" id="7549075"><a href="/net/http/cgi/host_test.go.html#7548838">cwd</a></span><span class="op" id="7549078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7549082">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7549103">:</span>&nbsp;<span class="ident" id="7549105"><a href="/net/http/cgi/host_test.go.html#7548626">cgifile</a></span><span class="op" id="7549112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7549116">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7549133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7549139">&#34;/foo/bar&#34;</span><span class="op" id="7549149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7549152">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7549155"><a href="/net/http/cgi/host_test.go.html#7538217">runCgiTest</a></span><span class="op" id="7549165">(</span><span class="ident" id="7549166"><a href="/net/http/cgi/host_test.go.html#7548609">t</a></span><span class="op" id="7549167">,</span>&nbsp;<span class="ident" id="7549169"><a href="/net/http/cgi/host_test.go.html#7548860">h</a></span><span class="op" id="7549170">,</span>&nbsp;<span class="string" id="7549172">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7549219">,</span>&nbsp;<span class="ident" id="7549221"><a href="/net/http/cgi/host_test.go.html#7549032">expectedMap</a></span><span class="op" id="7549232">)</span><br>
<span class="lineno"></span><span class="op" id="7549234">}</span>
</div>
</body>
</html>
