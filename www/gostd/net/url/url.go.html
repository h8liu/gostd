<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3186579">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3186634">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3186688">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3186739">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3186797">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3186814">package</span>&nbsp;<span class="ident" id="3186822">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3186827">import</span>&nbsp;<span class="op" id="3186834">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3186837">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3186846">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3186856">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3186864">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3186875">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3186885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3186888">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3186956">type</span>&nbsp;<span class="ident" id="3186961">Error</span>&nbsp;<span class="keyword" id="3186967">struct</span>&nbsp;<span class="op" id="3186974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186977">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3186981">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186989">URL</span>&nbsp;<span class="builtintype" id="3186993">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187001">Err</span>&nbsp;<span class="builtintype" id="3187005">error</span><br>
<span class="lineno"></span><span class="op" id="3187011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187014">func</span>&nbsp;<span class="op" id="3187019">(</span><span class="ident" id="3187020">e</span>&nbsp;<span class="op" id="3187022">*</span><span class="ident" id="3187023">Error</span><span class="op" id="3187028">)</span>&nbsp;<span class="ident" id="3187030">Error</span><span class="op" id="3187035">(</span><span class="op" id="3187036">)</span>&nbsp;<span class="builtintype" id="3187038">string</span>&nbsp;<span class="op" id="3187045">{</span>&nbsp;<span class="keyword" id="3187047">return</span>&nbsp;<span class="ident" id="3187054">e</span><span class="op" id="3187055">.</span><span class="ident" id="3187056">Op</span>&nbsp;<span class="op" id="3187059">+</span>&nbsp;<span class="string" id="3187061">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3187065">+</span>&nbsp;<span class="ident" id="3187067">e</span><span class="op" id="3187068">.</span><span class="ident" id="3187069">URL</span>&nbsp;<span class="op" id="3187073">+</span>&nbsp;<span class="string" id="3187075">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3187080">+</span>&nbsp;<span class="ident" id="3187082">e</span><span class="op" id="3187083">.</span><span class="ident" id="3187084">Err</span><span class="op" id="3187087">.</span><span class="ident" id="3187088">Error</span><span class="op" id="3187093">(</span><span class="op" id="3187094">)</span>&nbsp;<span class="op" id="3187096">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3187099">func</span>&nbsp;<span class="ident" id="3187104">ishex</span><span class="op" id="3187109">(</span><span class="ident" id="3187110">c</span>&nbsp;<span class="builtintype" id="3187112">byte</span><span class="op" id="3187116">)</span>&nbsp;<span class="builtintype" id="3187118">bool</span>&nbsp;<span class="op" id="3187123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187126">switch</span>&nbsp;<span class="op" id="3187133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187136">case</span>&nbsp;<span class="string" id="3187141">&#39;0&#39;</span>&nbsp;<span class="op" id="3187145">&lt;=</span>&nbsp;<span class="ident" id="3187148">c</span>&nbsp;<span class="op" id="3187150">&amp;&amp;</span>&nbsp;<span class="ident" id="3187153">c</span>&nbsp;<span class="op" id="3187155">&lt;=</span>&nbsp;<span class="string" id="3187158">&#39;9&#39;</span><span class="op" id="3187161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187165">return</span>&nbsp;<span class="builtintype" id="3187172">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187178">case</span>&nbsp;<span class="string" id="3187183">&#39;a&#39;</span>&nbsp;<span class="op" id="3187187">&lt;=</span>&nbsp;<span class="ident" id="3187190">c</span>&nbsp;<span class="op" id="3187192">&amp;&amp;</span>&nbsp;<span class="ident" id="3187195">c</span>&nbsp;<span class="op" id="3187197">&lt;=</span>&nbsp;<span class="string" id="3187200">&#39;f&#39;</span><span class="op" id="3187203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187207">return</span>&nbsp;<span class="builtintype" id="3187214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187220">case</span>&nbsp;<span class="string" id="3187225">&#39;A&#39;</span>&nbsp;<span class="op" id="3187229">&lt;=</span>&nbsp;<span class="ident" id="3187232">c</span>&nbsp;<span class="op" id="3187234">&amp;&amp;</span>&nbsp;<span class="ident" id="3187237">c</span>&nbsp;<span class="op" id="3187239">&lt;=</span>&nbsp;<span class="string" id="3187242">&#39;F&#39;</span><span class="op" id="3187245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187249">return</span>&nbsp;<span class="builtintype" id="3187256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187262">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187265">return</span>&nbsp;<span class="builtintype" id="3187272">false</span><br>
<span class="lineno"></span><span class="op" id="3187278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187281">func</span>&nbsp;<span class="ident" id="3187286">unhex</span><span class="op" id="3187291">(</span><span class="ident" id="3187292">c</span>&nbsp;<span class="builtintype" id="3187294">byte</span><span class="op" id="3187298">)</span>&nbsp;<span class="builtintype" id="3187300">byte</span>&nbsp;<span class="op" id="3187305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187308">switch</span>&nbsp;<span class="op" id="3187315">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187318">case</span>&nbsp;<span class="string" id="3187323">&#39;0&#39;</span>&nbsp;<span class="op" id="3187327">&lt;=</span>&nbsp;<span class="ident" id="3187330">c</span>&nbsp;<span class="op" id="3187332">&amp;&amp;</span>&nbsp;<span class="ident" id="3187335">c</span>&nbsp;<span class="op" id="3187337">&lt;=</span>&nbsp;<span class="string" id="3187340">&#39;9&#39;</span><span class="op" id="3187343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187347">return</span>&nbsp;<span class="ident" id="3187354">c</span>&nbsp;<span class="op" id="3187356">-</span>&nbsp;<span class="string" id="3187358">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187363">case</span>&nbsp;<span class="string" id="3187368">&#39;a&#39;</span>&nbsp;<span class="op" id="3187372">&lt;=</span>&nbsp;<span class="ident" id="3187375">c</span>&nbsp;<span class="op" id="3187377">&amp;&amp;</span>&nbsp;<span class="ident" id="3187380">c</span>&nbsp;<span class="op" id="3187382">&lt;=</span>&nbsp;<span class="string" id="3187385">&#39;f&#39;</span><span class="op" id="3187388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187392">return</span>&nbsp;<span class="ident" id="3187399">c</span>&nbsp;<span class="op" id="3187401">-</span>&nbsp;<span class="string" id="3187403">&#39;a&#39;</span>&nbsp;<span class="op" id="3187407">+</span>&nbsp;<span class="num" id="3187409">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187413">case</span>&nbsp;<span class="string" id="3187418">&#39;A&#39;</span>&nbsp;<span class="op" id="3187422">&lt;=</span>&nbsp;<span class="ident" id="3187425">c</span>&nbsp;<span class="op" id="3187427">&amp;&amp;</span>&nbsp;<span class="ident" id="3187430">c</span>&nbsp;<span class="op" id="3187432">&lt;=</span>&nbsp;<span class="string" id="3187435">&#39;F&#39;</span><span class="op" id="3187438">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187442">return</span>&nbsp;<span class="ident" id="3187449">c</span>&nbsp;<span class="op" id="3187451">-</span>&nbsp;<span class="string" id="3187453">&#39;A&#39;</span>&nbsp;<span class="op" id="3187457">+</span>&nbsp;<span class="num" id="3187459">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187466">return</span>&nbsp;<span class="num" id="3187473">0</span><br>
<span class="lineno"></span><span class="op" id="3187475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3187478">type</span>&nbsp;<span class="ident" id="3187483">encoding</span>&nbsp;<span class="builtintype" id="3187492">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187497">const</span>&nbsp;<span class="op" id="3187503">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187506">encodePath</span>&nbsp;<span class="ident" id="3187517">encoding</span>&nbsp;<span class="op" id="3187526">=</span>&nbsp;<span class="num" id="3187528">1</span>&nbsp;<span class="op" id="3187530">+</span>&nbsp;<span class="ident" id="3187532">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187538">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187558">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187580">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3187595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187598">type</span>&nbsp;<span class="ident" id="3187603">EscapeError</span>&nbsp;<span class="builtintype" id="3187615">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3187623">func</span>&nbsp;<span class="op" id="3187628">(</span><span class="ident" id="3187629">e</span>&nbsp;<span class="ident" id="3187631">EscapeError</span><span class="op" id="3187642">)</span>&nbsp;<span class="ident" id="3187644">Error</span><span class="op" id="3187649">(</span><span class="op" id="3187650">)</span>&nbsp;<span class="builtintype" id="3187652">string</span>&nbsp;<span class="op" id="3187659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187662">return</span>&nbsp;<span class="string" id="3187669">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3187691">+</span>&nbsp;<span class="ident" id="3187693">strconv</span><span class="op" id="3187700">.</span><span class="ident" id="3187701">Quote</span><span class="op" id="3187706">(</span><span class="builtintype" id="3187707">string</span><span class="op" id="3187713">(</span><span class="ident" id="3187714">e</span><span class="op" id="3187715">)</span><span class="op" id="3187716">)</span><br>
<span class="lineno"></span><span class="op" id="3187718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3187721">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3187786">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3187839">func</span>&nbsp;<span class="ident" id="3187844">shouldEscape</span><span class="op" id="3187856">(</span><span class="ident" id="3187857">c</span>&nbsp;<span class="builtintype" id="3187859">byte</span><span class="op" id="3187863">,</span>&nbsp;<span class="ident" id="3187865">mode</span>&nbsp;<span class="ident" id="3187870">encoding</span><span class="op" id="3187878">)</span>&nbsp;<span class="builtintype" id="3187880">bool</span>&nbsp;<span class="op" id="3187885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187888">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187931">if</span>&nbsp;<span class="string" id="3187934">&#39;A&#39;</span>&nbsp;<span class="op" id="3187938">&lt;=</span>&nbsp;<span class="ident" id="3187941">c</span>&nbsp;<span class="op" id="3187943">&amp;&amp;</span>&nbsp;<span class="ident" id="3187946">c</span>&nbsp;<span class="op" id="3187948">&lt;=</span>&nbsp;<span class="string" id="3187951">&#39;Z&#39;</span>&nbsp;<span class="op" id="3187955">||</span>&nbsp;<span class="string" id="3187958">&#39;a&#39;</span>&nbsp;<span class="op" id="3187962">&lt;=</span>&nbsp;<span class="ident" id="3187965">c</span>&nbsp;<span class="op" id="3187967">&amp;&amp;</span>&nbsp;<span class="ident" id="3187970">c</span>&nbsp;<span class="op" id="3187972">&lt;=</span>&nbsp;<span class="string" id="3187975">&#39;z&#39;</span>&nbsp;<span class="op" id="3187979">||</span>&nbsp;<span class="string" id="3187982">&#39;0&#39;</span>&nbsp;<span class="op" id="3187986">&lt;=</span>&nbsp;<span class="ident" id="3187989">c</span>&nbsp;<span class="op" id="3187991">&amp;&amp;</span>&nbsp;<span class="ident" id="3187994">c</span>&nbsp;<span class="op" id="3187996">&lt;=</span>&nbsp;<span class="string" id="3187999">&#39;9&#39;</span>&nbsp;<span class="op" id="3188003">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188007">return</span>&nbsp;<span class="builtintype" id="3188014">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188025">switch</span>&nbsp;<span class="ident" id="3188032">c</span>&nbsp;<span class="op" id="3188034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188037">case</span>&nbsp;<span class="string" id="3188042">&#39;-&#39;</span><span class="op" id="3188045">,</span>&nbsp;<span class="string" id="3188047">&#39;_&#39;</span><span class="op" id="3188050">,</span>&nbsp;<span class="string" id="3188052">&#39;.&#39;</span><span class="op" id="3188055">,</span>&nbsp;<span class="string" id="3188057">&#39;~&#39;</span><span class="op" id="3188060">:</span>&nbsp;<span class="comment" id="3188062">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188102">return</span>&nbsp;<span class="builtintype" id="3188109">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188117">case</span>&nbsp;<span class="string" id="3188122">&#39;$&#39;</span><span class="op" id="3188125">,</span>&nbsp;<span class="string" id="3188127">&#39;&amp;&#39;</span><span class="op" id="3188130">,</span>&nbsp;<span class="string" id="3188132">&#39;+&#39;</span><span class="op" id="3188135">,</span>&nbsp;<span class="string" id="3188137">&#39;,&#39;</span><span class="op" id="3188140">,</span>&nbsp;<span class="string" id="3188142">&#39;/&#39;</span><span class="op" id="3188145">,</span>&nbsp;<span class="string" id="3188147">&#39;:&#39;</span><span class="op" id="3188150">,</span>&nbsp;<span class="string" id="3188152">&#39;;&#39;</span><span class="op" id="3188155">,</span>&nbsp;<span class="string" id="3188157">&#39;=&#39;</span><span class="op" id="3188160">,</span>&nbsp;<span class="string" id="3188162">&#39;?&#39;</span><span class="op" id="3188165">,</span>&nbsp;<span class="string" id="3188167">&#39;@&#39;</span><span class="op" id="3188170">:</span>&nbsp;<span class="comment" id="3188172">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188214">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188264">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188314">switch</span>&nbsp;<span class="ident" id="3188321">mode</span>&nbsp;<span class="op" id="3188326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188330">case</span>&nbsp;<span class="ident" id="3188335">encodePath</span><span class="op" id="3188345">:</span>&nbsp;<span class="comment" id="3188347">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188359">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188422">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188478">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188540">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188594">return</span>&nbsp;<span class="ident" id="3188601">c</span>&nbsp;<span class="op" id="3188603">==</span>&nbsp;<span class="string" id="3188606">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188613">case</span>&nbsp;<span class="ident" id="3188618">encodeUserPassword</span><span class="op" id="3188636">:</span>&nbsp;<span class="comment" id="3188638">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188652">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188714">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188772">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188842">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188858">return</span>&nbsp;<span class="ident" id="3188865">c</span>&nbsp;<span class="op" id="3188867">==</span>&nbsp;<span class="string" id="3188870">&#39;@&#39;</span>&nbsp;<span class="op" id="3188874">||</span>&nbsp;<span class="ident" id="3188877">c</span>&nbsp;<span class="op" id="3188879">==</span>&nbsp;<span class="string" id="3188882">&#39;/&#39;</span>&nbsp;<span class="op" id="3188886">||</span>&nbsp;<span class="ident" id="3188889">c</span>&nbsp;<span class="op" id="3188891">==</span>&nbsp;<span class="string" id="3188894">&#39;?&#39;</span>&nbsp;<span class="op" id="3188898">||</span>&nbsp;<span class="ident" id="3188901">c</span>&nbsp;<span class="op" id="3188903">==</span>&nbsp;<span class="string" id="3188906">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188913">case</span>&nbsp;<span class="ident" id="3188918">encodeQueryComponent</span><span class="op" id="3188938">:</span>&nbsp;<span class="comment" id="3188940">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188952">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189007">return</span>&nbsp;<span class="builtintype" id="3189014">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189022">case</span>&nbsp;<span class="ident" id="3189027">encodeFragment</span><span class="op" id="3189041">:</span>&nbsp;<span class="comment" id="3189043">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3189055">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3189107">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189144">return</span>&nbsp;<span class="builtintype" id="3189151">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189162">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3189166">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189203">return</span>&nbsp;<span class="builtintype" id="3189210">true</span><br>
<span class="lineno"></span><span class="op" id="3189215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3189218">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3189294">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3189369">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3189421">func</span>&nbsp;<span class="ident" id="3189426">QueryUnescape</span><span class="op" id="3189439">(</span><span class="ident" id="3189440">s</span>&nbsp;<span class="builtintype" id="3189442">string</span><span class="op" id="3189448">)</span>&nbsp;<span class="op" id="3189450">(</span><span class="builtintype" id="3189451">string</span><span class="op" id="3189457">,</span>&nbsp;<span class="builtintype" id="3189459">error</span><span class="op" id="3189464">)</span>&nbsp;<span class="op" id="3189466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189469">return</span>&nbsp;<span class="ident" id="3189476">unescape</span><span class="op" id="3189484">(</span><span class="ident" id="3189485">s</span><span class="op" id="3189486">,</span>&nbsp;<span class="ident" id="3189488">encodeQueryComponent</span><span class="op" id="3189508">)</span><br>
<span class="lineno">115</span><span class="op" id="3189510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3189513">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3189564">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3189619">func</span>&nbsp;<span class="ident" id="3189624">unescape</span><span class="op" id="3189632">(</span><span class="ident" id="3189633">s</span>&nbsp;<span class="builtintype" id="3189635">string</span><span class="op" id="3189641">,</span>&nbsp;<span class="ident" id="3189643">mode</span>&nbsp;<span class="ident" id="3189648">encoding</span><span class="op" id="3189656">)</span>&nbsp;<span class="op" id="3189658">(</span><span class="builtintype" id="3189659">string</span><span class="op" id="3189665">,</span>&nbsp;<span class="builtintype" id="3189667">error</span><span class="op" id="3189672">)</span>&nbsp;<span class="op" id="3189674">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3189677">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189722">n</span>&nbsp;<span class="op" id="3189724">:=</span>&nbsp;<span class="num" id="3189727">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189730">hasPlus</span>&nbsp;<span class="op" id="3189738">:=</span>&nbsp;<span class="builtintype" id="3189741">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189748">for</span>&nbsp;<span class="ident" id="3189752">i</span>&nbsp;<span class="op" id="3189754">:=</span>&nbsp;<span class="num" id="3189757">0</span><span class="op" id="3189758">;</span>&nbsp;<span class="ident" id="3189760">i</span>&nbsp;<span class="op" id="3189762">&lt;</span>&nbsp;<span class="builtinfunc" id="3189764">len</span><span class="op" id="3189767">(</span><span class="ident" id="3189768">s</span><span class="op" id="3189769">)</span><span class="op" id="3189770">;</span>&nbsp;<span class="op" id="3189772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189776">switch</span>&nbsp;<span class="ident" id="3189783">s</span><span class="op" id="3189784">[</span><span class="ident" id="3189785">i</span><span class="op" id="3189786">]</span>&nbsp;<span class="op" id="3189788">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189792">case</span>&nbsp;<span class="string" id="3189797">&#39;%&#39;</span><span class="op" id="3189800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189805">n</span><span class="op" id="3189806">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189812">if</span>&nbsp;<span class="ident" id="3189815">i</span><span class="op" id="3189816">+</span><span class="num" id="3189817">2</span>&nbsp;<span class="op" id="3189819">&gt;=</span>&nbsp;<span class="builtinfunc" id="3189822">len</span><span class="op" id="3189825">(</span><span class="ident" id="3189826">s</span><span class="op" id="3189827">)</span>&nbsp;<span class="op" id="3189829">||</span>&nbsp;<span class="op" id="3189832">!</span><span class="ident" id="3189833">ishex</span><span class="op" id="3189838">(</span><span class="ident" id="3189839">s</span><span class="op" id="3189840">[</span><span class="ident" id="3189841">i</span><span class="op" id="3189842">+</span><span class="num" id="3189843">1</span><span class="op" id="3189844">]</span><span class="op" id="3189845">)</span>&nbsp;<span class="op" id="3189847">||</span>&nbsp;<span class="op" id="3189850">!</span><span class="ident" id="3189851">ishex</span><span class="op" id="3189856">(</span><span class="ident" id="3189857">s</span><span class="op" id="3189858">[</span><span class="ident" id="3189859">i</span><span class="op" id="3189860">+</span><span class="num" id="3189861">2</span><span class="op" id="3189862">]</span><span class="op" id="3189863">)</span>&nbsp;<span class="op" id="3189865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189871">s</span>&nbsp;<span class="op" id="3189873">=</span>&nbsp;<span class="ident" id="3189875">s</span><span class="op" id="3189876">[</span><span class="ident" id="3189877">i</span><span class="op" id="3189878">:</span><span class="op" id="3189879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189885">if</span>&nbsp;<span class="builtinfunc" id="3189888">len</span><span class="op" id="3189891">(</span><span class="ident" id="3189892">s</span><span class="op" id="3189893">)</span>&nbsp;<span class="op" id="3189895">&gt;</span>&nbsp;<span class="num" id="3189897">3</span>&nbsp;<span class="op" id="3189899">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189906">s</span>&nbsp;<span class="op" id="3189908">=</span>&nbsp;<span class="ident" id="3189910">s</span><span class="op" id="3189911">[</span><span class="num" id="3189912">0</span><span class="op" id="3189913">:</span><span class="num" id="3189914">3</span><span class="op" id="3189915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189927">return</span>&nbsp;<span class="string" id="3189934">&#34;&#34;</span><span class="op" id="3189936">,</span>&nbsp;<span class="ident" id="3189938">EscapeError</span><span class="op" id="3189949">(</span><span class="ident" id="3189950">s</span><span class="op" id="3189951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189961">i</span>&nbsp;<span class="op" id="3189963">+=</span>&nbsp;<span class="num" id="3189966">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189970">case</span>&nbsp;<span class="string" id="3189975">&#39;+&#39;</span><span class="op" id="3189978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189983">hasPlus</span>&nbsp;<span class="op" id="3189991">=</span>&nbsp;<span class="ident" id="3189993">mode</span>&nbsp;<span class="op" id="3189998">==</span>&nbsp;<span class="ident" id="3190001">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190025">i</span><span class="op" id="3190026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190031">default</span><span class="op" id="3190038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190043">i</span><span class="op" id="3190044">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190056">if</span>&nbsp;<span class="ident" id="3190059">n</span>&nbsp;<span class="op" id="3190061">==</span>&nbsp;<span class="num" id="3190064">0</span>&nbsp;<span class="op" id="3190066">&amp;&amp;</span>&nbsp;<span class="op" id="3190069">!</span><span class="ident" id="3190070">hasPlus</span>&nbsp;<span class="op" id="3190078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190082">return</span>&nbsp;<span class="ident" id="3190089">s</span><span class="op" id="3190090">,</span>&nbsp;<span class="ident" id="3190092">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190101">t</span>&nbsp;<span class="op" id="3190103">:=</span>&nbsp;<span class="builtinfunc" id="3190106">make</span><span class="op" id="3190110">(</span><span class="op" id="3190111">[</span><span class="op" id="3190112">]</span><span class="builtintype" id="3190113">byte</span><span class="op" id="3190117">,</span>&nbsp;<span class="builtinfunc" id="3190119">len</span><span class="op" id="3190122">(</span><span class="ident" id="3190123">s</span><span class="op" id="3190124">)</span><span class="op" id="3190125">-</span><span class="num" id="3190126">2</span><span class="op" id="3190127">*</span><span class="ident" id="3190128">n</span><span class="op" id="3190129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190132">j</span>&nbsp;<span class="op" id="3190134">:=</span>&nbsp;<span class="num" id="3190137">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190140">for</span>&nbsp;<span class="ident" id="3190144">i</span>&nbsp;<span class="op" id="3190146">:=</span>&nbsp;<span class="num" id="3190149">0</span><span class="op" id="3190150">;</span>&nbsp;<span class="ident" id="3190152">i</span>&nbsp;<span class="op" id="3190154">&lt;</span>&nbsp;<span class="builtinfunc" id="3190156">len</span><span class="op" id="3190159">(</span><span class="ident" id="3190160">s</span><span class="op" id="3190161">)</span><span class="op" id="3190162">;</span>&nbsp;<span class="op" id="3190164">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190168">switch</span>&nbsp;<span class="ident" id="3190175">s</span><span class="op" id="3190176">[</span><span class="ident" id="3190177">i</span><span class="op" id="3190178">]</span>&nbsp;<span class="op" id="3190180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190184">case</span>&nbsp;<span class="string" id="3190189">&#39;%&#39;</span><span class="op" id="3190192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190197">t</span><span class="op" id="3190198">[</span><span class="ident" id="3190199">j</span><span class="op" id="3190200">]</span>&nbsp;<span class="op" id="3190202">=</span>&nbsp;<span class="ident" id="3190204">unhex</span><span class="op" id="3190209">(</span><span class="ident" id="3190210">s</span><span class="op" id="3190211">[</span><span class="ident" id="3190212">i</span><span class="op" id="3190213">+</span><span class="num" id="3190214">1</span><span class="op" id="3190215">]</span><span class="op" id="3190216">)</span><span class="op" id="3190217">&lt;&lt;</span><span class="num" id="3190219">4</span>&nbsp;<span class="op" id="3190221">|</span>&nbsp;<span class="ident" id="3190223">unhex</span><span class="op" id="3190228">(</span><span class="ident" id="3190229">s</span><span class="op" id="3190230">[</span><span class="ident" id="3190231">i</span><span class="op" id="3190232">+</span><span class="num" id="3190233">2</span><span class="op" id="3190234">]</span><span class="op" id="3190235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190240">j</span><span class="op" id="3190241">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190247">i</span>&nbsp;<span class="op" id="3190249">+=</span>&nbsp;<span class="num" id="3190252">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190256">case</span>&nbsp;<span class="string" id="3190261">&#39;+&#39;</span><span class="op" id="3190264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190269">if</span>&nbsp;<span class="ident" id="3190272">mode</span>&nbsp;<span class="op" id="3190277">==</span>&nbsp;<span class="ident" id="3190280">encodeQueryComponent</span>&nbsp;<span class="op" id="3190301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190307">t</span><span class="op" id="3190308">[</span><span class="ident" id="3190309">j</span><span class="op" id="3190310">]</span>&nbsp;<span class="op" id="3190312">=</span>&nbsp;<span class="string" id="3190314">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190321">}</span>&nbsp;<span class="keyword" id="3190323">else</span>&nbsp;<span class="op" id="3190328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190334">t</span><span class="op" id="3190335">[</span><span class="ident" id="3190336">j</span><span class="op" id="3190337">]</span>&nbsp;<span class="op" id="3190339">=</span>&nbsp;<span class="string" id="3190341">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190353">j</span><span class="op" id="3190354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190360">i</span><span class="op" id="3190361">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190366">default</span><span class="op" id="3190373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190378">t</span><span class="op" id="3190379">[</span><span class="ident" id="3190380">j</span><span class="op" id="3190381">]</span>&nbsp;<span class="op" id="3190383">=</span>&nbsp;<span class="ident" id="3190385">s</span><span class="op" id="3190386">[</span><span class="ident" id="3190387">i</span><span class="op" id="3190388">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190393">j</span><span class="op" id="3190394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190400">i</span><span class="op" id="3190401">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190412">return</span>&nbsp;<span class="builtintype" id="3190419">string</span><span class="op" id="3190425">(</span><span class="ident" id="3190426">t</span><span class="op" id="3190427">)</span><span class="op" id="3190428">,</span>&nbsp;<span class="ident" id="3190430">nil</span><br>
<span class="lineno">170</span><span class="op" id="3190434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3190437">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3190498">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3190521">func</span>&nbsp;<span class="ident" id="3190526">QueryEscape</span><span class="op" id="3190537">(</span><span class="ident" id="3190538">s</span>&nbsp;<span class="builtintype" id="3190540">string</span><span class="op" id="3190546">)</span>&nbsp;<span class="builtintype" id="3190548">string</span>&nbsp;<span class="op" id="3190555">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190558">return</span>&nbsp;<span class="ident" id="3190565">escape</span><span class="op" id="3190571">(</span><span class="ident" id="3190572">s</span><span class="op" id="3190573">,</span>&nbsp;<span class="ident" id="3190575">encodeQueryComponent</span><span class="op" id="3190595">)</span><br>
<span class="lineno"></span><span class="op" id="3190597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3190600">func</span>&nbsp;<span class="ident" id="3190605">escape</span><span class="op" id="3190611">(</span><span class="ident" id="3190612">s</span>&nbsp;<span class="builtintype" id="3190614">string</span><span class="op" id="3190620">,</span>&nbsp;<span class="ident" id="3190622">mode</span>&nbsp;<span class="ident" id="3190627">encoding</span><span class="op" id="3190635">)</span>&nbsp;<span class="builtintype" id="3190637">string</span>&nbsp;<span class="op" id="3190644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190647">spaceCount</span><span class="op" id="3190657">,</span>&nbsp;<span class="ident" id="3190659">hexCount</span>&nbsp;<span class="op" id="3190668">:=</span>&nbsp;<span class="num" id="3190671">0</span><span class="op" id="3190672">,</span>&nbsp;<span class="num" id="3190674">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190677">for</span>&nbsp;<span class="ident" id="3190681">i</span>&nbsp;<span class="op" id="3190683">:=</span>&nbsp;<span class="num" id="3190686">0</span><span class="op" id="3190687">;</span>&nbsp;<span class="ident" id="3190689">i</span>&nbsp;<span class="op" id="3190691">&lt;</span>&nbsp;<span class="builtinfunc" id="3190693">len</span><span class="op" id="3190696">(</span><span class="ident" id="3190697">s</span><span class="op" id="3190698">)</span><span class="op" id="3190699">;</span>&nbsp;<span class="ident" id="3190701">i</span><span class="op" id="3190702">++</span>&nbsp;<span class="op" id="3190705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190709">c</span>&nbsp;<span class="op" id="3190711">:=</span>&nbsp;<span class="ident" id="3190714">s</span><span class="op" id="3190715">[</span><span class="ident" id="3190716">i</span><span class="op" id="3190717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190721">if</span>&nbsp;<span class="ident" id="3190724">shouldEscape</span><span class="op" id="3190736">(</span><span class="ident" id="3190737">c</span><span class="op" id="3190738">,</span>&nbsp;<span class="ident" id="3190740">mode</span><span class="op" id="3190744">)</span>&nbsp;<span class="op" id="3190746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190751">if</span>&nbsp;<span class="ident" id="3190754">c</span>&nbsp;<span class="op" id="3190756">==</span>&nbsp;<span class="string" id="3190759">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3190763">&amp;&amp;</span>&nbsp;<span class="ident" id="3190766">mode</span>&nbsp;<span class="op" id="3190771">==</span>&nbsp;<span class="ident" id="3190774">encodeQueryComponent</span>&nbsp;<span class="op" id="3190795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190801">spaceCount</span><span class="op" id="3190811">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190817">}</span>&nbsp;<span class="keyword" id="3190819">else</span>&nbsp;<span class="op" id="3190824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190830">hexCount</span><span class="op" id="3190838">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190851">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190855">if</span>&nbsp;<span class="ident" id="3190858">spaceCount</span>&nbsp;<span class="op" id="3190869">==</span>&nbsp;<span class="num" id="3190872">0</span>&nbsp;<span class="op" id="3190874">&amp;&amp;</span>&nbsp;<span class="ident" id="3190877">hexCount</span>&nbsp;<span class="op" id="3190886">==</span>&nbsp;<span class="num" id="3190889">0</span>&nbsp;<span class="op" id="3190891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190895">return</span>&nbsp;<span class="ident" id="3190902">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190909">t</span>&nbsp;<span class="op" id="3190911">:=</span>&nbsp;<span class="builtinfunc" id="3190914">make</span><span class="op" id="3190918">(</span><span class="op" id="3190919">[</span><span class="op" id="3190920">]</span><span class="builtintype" id="3190921">byte</span><span class="op" id="3190925">,</span>&nbsp;<span class="builtinfunc" id="3190927">len</span><span class="op" id="3190930">(</span><span class="ident" id="3190931">s</span><span class="op" id="3190932">)</span><span class="op" id="3190933">+</span><span class="num" id="3190934">2</span><span class="op" id="3190935">*</span><span class="ident" id="3190936">hexCount</span><span class="op" id="3190944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190947">j</span>&nbsp;<span class="op" id="3190949">:=</span>&nbsp;<span class="num" id="3190952">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190955">for</span>&nbsp;<span class="ident" id="3190959">i</span>&nbsp;<span class="op" id="3190961">:=</span>&nbsp;<span class="num" id="3190964">0</span><span class="op" id="3190965">;</span>&nbsp;<span class="ident" id="3190967">i</span>&nbsp;<span class="op" id="3190969">&lt;</span>&nbsp;<span class="builtinfunc" id="3190971">len</span><span class="op" id="3190974">(</span><span class="ident" id="3190975">s</span><span class="op" id="3190976">)</span><span class="op" id="3190977">;</span>&nbsp;<span class="ident" id="3190979">i</span><span class="op" id="3190980">++</span>&nbsp;<span class="op" id="3190983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190987">switch</span>&nbsp;<span class="ident" id="3190994">c</span>&nbsp;<span class="op" id="3190996">:=</span>&nbsp;<span class="ident" id="3190999">s</span><span class="op" id="3191000">[</span><span class="ident" id="3191001">i</span><span class="op" id="3191002">]</span><span class="op" id="3191003">;</span>&nbsp;<span class="op" id="3191005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191009">case</span>&nbsp;<span class="ident" id="3191014">c</span>&nbsp;<span class="op" id="3191016">==</span>&nbsp;<span class="string" id="3191019">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3191023">&amp;&amp;</span>&nbsp;<span class="ident" id="3191026">mode</span>&nbsp;<span class="op" id="3191031">==</span>&nbsp;<span class="ident" id="3191034">encodeQueryComponent</span><span class="op" id="3191054">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191059">t</span><span class="op" id="3191060">[</span><span class="ident" id="3191061">j</span><span class="op" id="3191062">]</span>&nbsp;<span class="op" id="3191064">=</span>&nbsp;<span class="string" id="3191066">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191073">j</span><span class="op" id="3191074">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191079">case</span>&nbsp;<span class="ident" id="3191084">shouldEscape</span><span class="op" id="3191096">(</span><span class="ident" id="3191097">c</span><span class="op" id="3191098">,</span>&nbsp;<span class="ident" id="3191100">mode</span><span class="op" id="3191104">)</span><span class="op" id="3191105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191110">t</span><span class="op" id="3191111">[</span><span class="ident" id="3191112">j</span><span class="op" id="3191113">]</span>&nbsp;<span class="op" id="3191115">=</span>&nbsp;<span class="string" id="3191117">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191124">t</span><span class="op" id="3191125">[</span><span class="ident" id="3191126">j</span><span class="op" id="3191127">+</span><span class="num" id="3191128">1</span><span class="op" id="3191129">]</span>&nbsp;<span class="op" id="3191131">=</span>&nbsp;<span class="string" id="3191133">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3191151">[</span><span class="ident" id="3191152">c</span><span class="op" id="3191153">&gt;&gt;</span><span class="num" id="3191155">4</span><span class="op" id="3191156">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191161">t</span><span class="op" id="3191162">[</span><span class="ident" id="3191163">j</span><span class="op" id="3191164">+</span><span class="num" id="3191165">2</span><span class="op" id="3191166">]</span>&nbsp;<span class="op" id="3191168">=</span>&nbsp;<span class="string" id="3191170">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3191188">[</span><span class="ident" id="3191189">c</span><span class="op" id="3191190">&amp;</span><span class="num" id="3191191">15</span><span class="op" id="3191193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191198">j</span>&nbsp;<span class="op" id="3191200">+=</span>&nbsp;<span class="num" id="3191203">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191207">default</span><span class="op" id="3191214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191219">t</span><span class="op" id="3191220">[</span><span class="ident" id="3191221">j</span><span class="op" id="3191222">]</span>&nbsp;<span class="op" id="3191224">=</span>&nbsp;<span class="ident" id="3191226">s</span><span class="op" id="3191227">[</span><span class="ident" id="3191228">i</span><span class="op" id="3191229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191234">j</span><span class="op" id="3191235">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191246">return</span>&nbsp;<span class="builtintype" id="3191253">string</span><span class="op" id="3191259">(</span><span class="ident" id="3191260">t</span><span class="op" id="3191261">)</span><br>
<span class="lineno"></span><span class="op" id="3191263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3191266">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3191331">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3191367">//</span><br>
<span class="lineno"></span><span class="comment" id="3191370">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3191422">//</span><br>
<span class="lineno">220</span><span class="comment" id="3191425">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3191501">//</span><br>
<span class="lineno"></span><span class="comment" id="3191504">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3191540">//</span><br>
<span class="lineno"></span><span class="comment" id="3191543">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3191623">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3191704">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3191788">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3191873">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3191952">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3192034">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3192088">type</span>&nbsp;<span class="ident" id="3192093">URL</span>&nbsp;<span class="keyword" id="3192097">struct</span>&nbsp;<span class="op" id="3192104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192107">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3192116">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192124">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3192133">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192143">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192167">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3192176">*</span><span class="ident" id="3192177">Userinfo</span>&nbsp;<span class="comment" id="3192186">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192224">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3192233">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192243">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192265">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3192274">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192282">RawQuery</span>&nbsp;<span class="builtintype" id="3192291">string</span>&nbsp;<span class="comment" id="3192298">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192336">Fragment</span>&nbsp;<span class="builtintype" id="3192345">string</span>&nbsp;<span class="comment" id="3192352">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3192392">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3192395">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3192455">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3192479">func</span>&nbsp;<span class="ident" id="3192484">User</span><span class="op" id="3192488">(</span><span class="ident" id="3192489">username</span>&nbsp;<span class="builtintype" id="3192498">string</span><span class="op" id="3192504">)</span>&nbsp;<span class="op" id="3192506">*</span><span class="ident" id="3192507">Userinfo</span>&nbsp;<span class="op" id="3192516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192519">return</span>&nbsp;<span class="op" id="3192526">&amp;</span><span class="ident" id="3192527">Userinfo</span><span class="op" id="3192535">{</span><span class="ident" id="3192536">username</span><span class="op" id="3192544">,</span>&nbsp;<span class="string" id="3192546">&#34;&#34;</span><span class="op" id="3192548">,</span>&nbsp;<span class="builtintype" id="3192550">false</span><span class="op" id="3192555">}</span><br>
<span class="lineno">245</span><span class="op" id="3192557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3192560">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3192628">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3192645">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3192710">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3192764">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3192827">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3192889">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3192953">func</span>&nbsp;<span class="ident" id="3192958">UserPassword</span><span class="op" id="3192970">(</span><span class="ident" id="3192971">username</span><span class="op" id="3192979">,</span>&nbsp;<span class="ident" id="3192981">password</span>&nbsp;<span class="builtintype" id="3192990">string</span><span class="op" id="3192996">)</span>&nbsp;<span class="op" id="3192998">*</span><span class="ident" id="3192999">Userinfo</span>&nbsp;<span class="op" id="3193008">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193011">return</span>&nbsp;<span class="op" id="3193018">&amp;</span><span class="ident" id="3193019">Userinfo</span><span class="op" id="3193027">{</span><span class="ident" id="3193028">username</span><span class="op" id="3193036">,</span>&nbsp;<span class="ident" id="3193038">password</span><span class="op" id="3193046">,</span>&nbsp;<span class="builtintype" id="3193048">true</span><span class="op" id="3193052">}</span><br>
<span class="lineno"></span><span class="op" id="3193054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193057">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3193124">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3193196">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3193267">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3193297">type</span>&nbsp;<span class="ident" id="3193302">Userinfo</span>&nbsp;<span class="keyword" id="3193311">struct</span>&nbsp;<span class="op" id="3193318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193321">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3193333">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193341">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3193353">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193361">passwordSet</span>&nbsp;<span class="builtintype" id="3193373">bool</span><br>
<span class="lineno"></span><span class="op" id="3193378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193381">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3193415">func</span>&nbsp;<span class="op" id="3193420">(</span><span class="ident" id="3193421">u</span>&nbsp;<span class="op" id="3193423">*</span><span class="ident" id="3193424">Userinfo</span><span class="op" id="3193432">)</span>&nbsp;<span class="ident" id="3193434">Username</span><span class="op" id="3193442">(</span><span class="op" id="3193443">)</span>&nbsp;<span class="builtintype" id="3193445">string</span>&nbsp;<span class="op" id="3193452">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193455">return</span>&nbsp;<span class="ident" id="3193462">u</span><span class="op" id="3193463">.</span><span class="ident" id="3193464">username</span><br>
<span class="lineno"></span><span class="op" id="3193473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193476">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3193551">func</span>&nbsp;<span class="op" id="3193556">(</span><span class="ident" id="3193557">u</span>&nbsp;<span class="op" id="3193559">*</span><span class="ident" id="3193560">Userinfo</span><span class="op" id="3193568">)</span>&nbsp;<span class="ident" id="3193570">Password</span><span class="op" id="3193578">(</span><span class="op" id="3193579">)</span>&nbsp;<span class="op" id="3193581">(</span><span class="builtintype" id="3193582">string</span><span class="op" id="3193588">,</span>&nbsp;<span class="builtintype" id="3193590">bool</span><span class="op" id="3193594">)</span>&nbsp;<span class="op" id="3193596">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193599">if</span>&nbsp;<span class="ident" id="3193602">u</span><span class="op" id="3193603">.</span><span class="ident" id="3193604">passwordSet</span>&nbsp;<span class="op" id="3193616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193620">return</span>&nbsp;<span class="ident" id="3193627">u</span><span class="op" id="3193628">.</span><span class="ident" id="3193629">password</span><span class="op" id="3193637">,</span>&nbsp;<span class="builtintype" id="3193639">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193648">return</span>&nbsp;<span class="string" id="3193655">&#34;&#34;</span><span class="op" id="3193657">,</span>&nbsp;<span class="builtintype" id="3193659">false</span><br>
<span class="lineno"></span><span class="op" id="3193665">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3193668">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3193740">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3193769">func</span>&nbsp;<span class="op" id="3193774">(</span><span class="ident" id="3193775">u</span>&nbsp;<span class="op" id="3193777">*</span><span class="ident" id="3193778">Userinfo</span><span class="op" id="3193786">)</span>&nbsp;<span class="ident" id="3193788">String</span><span class="op" id="3193794">(</span><span class="op" id="3193795">)</span>&nbsp;<span class="builtintype" id="3193797">string</span>&nbsp;<span class="op" id="3193804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193807">s</span>&nbsp;<span class="op" id="3193809">:=</span>&nbsp;<span class="ident" id="3193812">escape</span><span class="op" id="3193818">(</span><span class="ident" id="3193819">u</span><span class="op" id="3193820">.</span><span class="ident" id="3193821">username</span><span class="op" id="3193829">,</span>&nbsp;<span class="ident" id="3193831">encodeUserPassword</span><span class="op" id="3193849">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193852">if</span>&nbsp;<span class="ident" id="3193855">u</span><span class="op" id="3193856">.</span><span class="ident" id="3193857">passwordSet</span>&nbsp;<span class="op" id="3193869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193873">s</span>&nbsp;<span class="op" id="3193875">+=</span>&nbsp;<span class="string" id="3193878">&#34;:&#34;</span>&nbsp;<span class="op" id="3193882">+</span>&nbsp;<span class="ident" id="3193884">escape</span><span class="op" id="3193890">(</span><span class="ident" id="3193891">u</span><span class="op" id="3193892">.</span><span class="ident" id="3193893">password</span><span class="op" id="3193901">,</span>&nbsp;<span class="ident" id="3193903">encodeUserPassword</span><span class="op" id="3193921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193927">return</span>&nbsp;<span class="ident" id="3193934">s</span><br>
<span class="lineno"></span><span class="op" id="3193936">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3193939">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3193983">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3194027">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3194082">func</span>&nbsp;<span class="ident" id="3194087">getscheme</span><span class="op" id="3194096">(</span><span class="ident" id="3194097">rawurl</span>&nbsp;<span class="builtintype" id="3194104">string</span><span class="op" id="3194110">)</span>&nbsp;<span class="op" id="3194112">(</span><span class="ident" id="3194113">scheme</span><span class="op" id="3194119">,</span>&nbsp;<span class="ident" id="3194121">path</span>&nbsp;<span class="builtintype" id="3194126">string</span><span class="op" id="3194132">,</span>&nbsp;<span class="ident" id="3194134">err</span>&nbsp;<span class="builtintype" id="3194138">error</span><span class="op" id="3194143">)</span>&nbsp;<span class="op" id="3194145">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194148">for</span>&nbsp;<span class="ident" id="3194152">i</span>&nbsp;<span class="op" id="3194154">:=</span>&nbsp;<span class="num" id="3194157">0</span><span class="op" id="3194158">;</span>&nbsp;<span class="ident" id="3194160">i</span>&nbsp;<span class="op" id="3194162">&lt;</span>&nbsp;<span class="builtinfunc" id="3194164">len</span><span class="op" id="3194167">(</span><span class="ident" id="3194168">rawurl</span><span class="op" id="3194174">)</span><span class="op" id="3194175">;</span>&nbsp;<span class="ident" id="3194177">i</span><span class="op" id="3194178">++</span>&nbsp;<span class="op" id="3194181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194185">c</span>&nbsp;<span class="op" id="3194187">:=</span>&nbsp;<span class="ident" id="3194190">rawurl</span><span class="op" id="3194196">[</span><span class="ident" id="3194197">i</span><span class="op" id="3194198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194202">switch</span>&nbsp;<span class="op" id="3194209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194213">case</span>&nbsp;<span class="string" id="3194218">&#39;a&#39;</span>&nbsp;<span class="op" id="3194222">&lt;=</span>&nbsp;<span class="ident" id="3194225">c</span>&nbsp;<span class="op" id="3194227">&amp;&amp;</span>&nbsp;<span class="ident" id="3194230">c</span>&nbsp;<span class="op" id="3194232">&lt;=</span>&nbsp;<span class="string" id="3194235">&#39;z&#39;</span>&nbsp;<span class="op" id="3194239">||</span>&nbsp;<span class="string" id="3194242">&#39;A&#39;</span>&nbsp;<span class="op" id="3194246">&lt;=</span>&nbsp;<span class="ident" id="3194249">c</span>&nbsp;<span class="op" id="3194251">&amp;&amp;</span>&nbsp;<span class="ident" id="3194254">c</span>&nbsp;<span class="op" id="3194256">&lt;=</span>&nbsp;<span class="string" id="3194259">&#39;Z&#39;</span><span class="op" id="3194262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194266">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194282">case</span>&nbsp;<span class="string" id="3194287">&#39;0&#39;</span>&nbsp;<span class="op" id="3194291">&lt;=</span>&nbsp;<span class="ident" id="3194294">c</span>&nbsp;<span class="op" id="3194296">&amp;&amp;</span>&nbsp;<span class="ident" id="3194299">c</span>&nbsp;<span class="op" id="3194301">&lt;=</span>&nbsp;<span class="string" id="3194304">&#39;9&#39;</span>&nbsp;<span class="op" id="3194308">||</span>&nbsp;<span class="ident" id="3194311">c</span>&nbsp;<span class="op" id="3194313">==</span>&nbsp;<span class="string" id="3194316">&#39;+&#39;</span>&nbsp;<span class="op" id="3194320">||</span>&nbsp;<span class="ident" id="3194323">c</span>&nbsp;<span class="op" id="3194325">==</span>&nbsp;<span class="string" id="3194328">&#39;-&#39;</span>&nbsp;<span class="op" id="3194332">||</span>&nbsp;<span class="ident" id="3194335">c</span>&nbsp;<span class="op" id="3194337">==</span>&nbsp;<span class="string" id="3194340">&#39;.&#39;</span><span class="op" id="3194343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194348">if</span>&nbsp;<span class="ident" id="3194351">i</span>&nbsp;<span class="op" id="3194353">==</span>&nbsp;<span class="num" id="3194356">0</span>&nbsp;<span class="op" id="3194358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194364">return</span>&nbsp;<span class="string" id="3194371">&#34;&#34;</span><span class="op" id="3194373">,</span>&nbsp;<span class="ident" id="3194375">rawurl</span><span class="op" id="3194381">,</span>&nbsp;<span class="ident" id="3194383">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194394">case</span>&nbsp;<span class="ident" id="3194399">c</span>&nbsp;<span class="op" id="3194401">==</span>&nbsp;<span class="string" id="3194404">&#39;:&#39;</span><span class="op" id="3194407">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194412">if</span>&nbsp;<span class="ident" id="3194415">i</span>&nbsp;<span class="op" id="3194417">==</span>&nbsp;<span class="num" id="3194420">0</span>&nbsp;<span class="op" id="3194422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194428">return</span>&nbsp;<span class="string" id="3194435">&#34;&#34;</span><span class="op" id="3194437">,</span>&nbsp;<span class="string" id="3194439">&#34;&#34;</span><span class="op" id="3194441">,</span>&nbsp;<span class="ident" id="3194443">errors</span><span class="op" id="3194449">.</span><span class="ident" id="3194450">New</span><span class="op" id="3194453">(</span><span class="string" id="3194454">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3194479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194489">return</span>&nbsp;<span class="ident" id="3194496">rawurl</span><span class="op" id="3194502">[</span><span class="num" id="3194503">0</span><span class="op" id="3194504">:</span><span class="ident" id="3194505">i</span><span class="op" id="3194506">]</span><span class="op" id="3194507">,</span>&nbsp;<span class="ident" id="3194509">rawurl</span><span class="op" id="3194515">[</span><span class="ident" id="3194516">i</span><span class="op" id="3194517">+</span><span class="num" id="3194518">1</span><span class="op" id="3194519">:</span><span class="op" id="3194520">]</span><span class="op" id="3194521">,</span>&nbsp;<span class="ident" id="3194523">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194529">default</span><span class="op" id="3194536">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194541">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194589">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194623">return</span>&nbsp;<span class="string" id="3194630">&#34;&#34;</span><span class="op" id="3194632">,</span>&nbsp;<span class="ident" id="3194634">rawurl</span><span class="op" id="3194640">,</span>&nbsp;<span class="ident" id="3194642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194651">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194654">return</span>&nbsp;<span class="string" id="3194661">&#34;&#34;</span><span class="op" id="3194663">,</span>&nbsp;<span class="ident" id="3194665">rawurl</span><span class="op" id="3194671">,</span>&nbsp;<span class="ident" id="3194673">nil</span><br>
<span class="lineno"></span><span class="op" id="3194677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3194680">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3194713">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3194764">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3194789">func</span>&nbsp;<span class="ident" id="3194794">split</span><span class="op" id="3194799">(</span><span class="ident" id="3194800">s</span>&nbsp;<span class="builtintype" id="3194802">string</span><span class="op" id="3194808">,</span>&nbsp;<span class="ident" id="3194810">c</span>&nbsp;<span class="builtintype" id="3194812">string</span><span class="op" id="3194818">,</span>&nbsp;<span class="ident" id="3194820">cutc</span>&nbsp;<span class="builtintype" id="3194825">bool</span><span class="op" id="3194829">)</span>&nbsp;<span class="op" id="3194831">(</span><span class="builtintype" id="3194832">string</span><span class="op" id="3194838">,</span>&nbsp;<span class="builtintype" id="3194840">string</span><span class="op" id="3194846">)</span>&nbsp;<span class="op" id="3194848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194851">i</span>&nbsp;<span class="op" id="3194853">:=</span>&nbsp;<span class="ident" id="3194856">strings</span><span class="op" id="3194863">.</span><span class="ident" id="3194864">Index</span><span class="op" id="3194869">(</span><span class="ident" id="3194870">s</span><span class="op" id="3194871">,</span>&nbsp;<span class="ident" id="3194873">c</span><span class="op" id="3194874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194877">if</span>&nbsp;<span class="ident" id="3194880">i</span>&nbsp;<span class="op" id="3194882">&lt;</span>&nbsp;<span class="num" id="3194884">0</span>&nbsp;<span class="op" id="3194886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194890">return</span>&nbsp;<span class="ident" id="3194897">s</span><span class="op" id="3194898">,</span>&nbsp;<span class="string" id="3194900">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194907">if</span>&nbsp;<span class="ident" id="3194910">cutc</span>&nbsp;<span class="op" id="3194915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194919">return</span>&nbsp;<span class="ident" id="3194926">s</span><span class="op" id="3194927">[</span><span class="num" id="3194928">0</span><span class="op" id="3194929">:</span><span class="ident" id="3194930">i</span><span class="op" id="3194931">]</span><span class="op" id="3194932">,</span>&nbsp;<span class="ident" id="3194934">s</span><span class="op" id="3194935">[</span><span class="ident" id="3194936">i</span><span class="op" id="3194937">+</span><span class="builtinfunc" id="3194938">len</span><span class="op" id="3194941">(</span><span class="ident" id="3194942">c</span><span class="op" id="3194943">)</span><span class="op" id="3194944">:</span><span class="op" id="3194945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194951">return</span>&nbsp;<span class="ident" id="3194958">s</span><span class="op" id="3194959">[</span><span class="num" id="3194960">0</span><span class="op" id="3194961">:</span><span class="ident" id="3194962">i</span><span class="op" id="3194963">]</span><span class="op" id="3194964">,</span>&nbsp;<span class="ident" id="3194966">s</span><span class="op" id="3194967">[</span><span class="ident" id="3194968">i</span><span class="op" id="3194969">:</span><span class="op" id="3194970">]</span><br>
<span class="lineno">330</span><span class="op" id="3194972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3194975">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3195020">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3195063">func</span>&nbsp;<span class="ident" id="3195068">Parse</span><span class="op" id="3195073">(</span><span class="ident" id="3195074">rawurl</span>&nbsp;<span class="builtintype" id="3195081">string</span><span class="op" id="3195087">)</span>&nbsp;<span class="op" id="3195089">(</span><span class="ident" id="3195090">url</span>&nbsp;<span class="op" id="3195094">*</span><span class="ident" id="3195095">URL</span><span class="op" id="3195098">,</span>&nbsp;<span class="ident" id="3195100">err</span>&nbsp;<span class="builtintype" id="3195104">error</span><span class="op" id="3195109">)</span>&nbsp;<span class="op" id="3195111">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3195114">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195132">u</span><span class="op" id="3195133">,</span>&nbsp;<span class="ident" id="3195135">frag</span>&nbsp;<span class="op" id="3195140">:=</span>&nbsp;<span class="ident" id="3195143">split</span><span class="op" id="3195148">(</span><span class="ident" id="3195149">rawurl</span><span class="op" id="3195155">,</span>&nbsp;<span class="string" id="3195157">&#34;#&#34;</span><span class="op" id="3195160">,</span>&nbsp;<span class="builtintype" id="3195162">true</span><span class="op" id="3195166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195169">if</span>&nbsp;<span class="ident" id="3195172">url</span><span class="op" id="3195175">,</span>&nbsp;<span class="ident" id="3195177">err</span>&nbsp;<span class="op" id="3195181">=</span>&nbsp;<span class="ident" id="3195183">parse</span><span class="op" id="3195188">(</span><span class="ident" id="3195189">u</span><span class="op" id="3195190">,</span>&nbsp;<span class="builtintype" id="3195192">false</span><span class="op" id="3195197">)</span><span class="op" id="3195198">;</span>&nbsp;<span class="ident" id="3195200">err</span>&nbsp;<span class="op" id="3195204">!=</span>&nbsp;<span class="ident" id="3195207">nil</span>&nbsp;<span class="op" id="3195211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195215">return</span>&nbsp;<span class="ident" id="3195222">nil</span><span class="op" id="3195225">,</span>&nbsp;<span class="ident" id="3195227">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195232">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195235">if</span>&nbsp;<span class="ident" id="3195238">frag</span>&nbsp;<span class="op" id="3195243">==</span>&nbsp;<span class="string" id="3195246">&#34;&#34;</span>&nbsp;<span class="op" id="3195249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195253">return</span>&nbsp;<span class="ident" id="3195260">url</span><span class="op" id="3195263">,</span>&nbsp;<span class="ident" id="3195265">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195273">if</span>&nbsp;<span class="ident" id="3195276">url</span><span class="op" id="3195279">.</span><span class="ident" id="3195280">Fragment</span><span class="op" id="3195288">,</span>&nbsp;<span class="ident" id="3195290">err</span>&nbsp;<span class="op" id="3195294">=</span>&nbsp;<span class="ident" id="3195296">unescape</span><span class="op" id="3195304">(</span><span class="ident" id="3195305">frag</span><span class="op" id="3195309">,</span>&nbsp;<span class="ident" id="3195311">encodeFragment</span><span class="op" id="3195325">)</span><span class="op" id="3195326">;</span>&nbsp;<span class="ident" id="3195328">err</span>&nbsp;<span class="op" id="3195332">!=</span>&nbsp;<span class="ident" id="3195335">nil</span>&nbsp;<span class="op" id="3195339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195343">return</span>&nbsp;<span class="ident" id="3195350">nil</span><span class="op" id="3195353">,</span>&nbsp;<span class="op" id="3195355">&amp;</span><span class="ident" id="3195356">Error</span><span class="op" id="3195361">{</span><span class="string" id="3195362">&#34;parse&#34;</span><span class="op" id="3195369">,</span>&nbsp;<span class="ident" id="3195371">rawurl</span><span class="op" id="3195377">,</span>&nbsp;<span class="ident" id="3195379">err</span><span class="op" id="3195382">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195388">return</span>&nbsp;<span class="ident" id="3195395">url</span><span class="op" id="3195398">,</span>&nbsp;<span class="ident" id="3195400">nil</span><br>
<span class="lineno"></span><span class="op" id="3195404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195407">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3195479">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3195551">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3195599">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3195663">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3195737">func</span>&nbsp;<span class="ident" id="3195742">ParseRequestURI</span><span class="op" id="3195757">(</span><span class="ident" id="3195758">rawurl</span>&nbsp;<span class="builtintype" id="3195765">string</span><span class="op" id="3195771">)</span>&nbsp;<span class="op" id="3195773">(</span><span class="ident" id="3195774">url</span>&nbsp;<span class="op" id="3195778">*</span><span class="ident" id="3195779">URL</span><span class="op" id="3195782">,</span>&nbsp;<span class="ident" id="3195784">err</span>&nbsp;<span class="builtintype" id="3195788">error</span><span class="op" id="3195793">)</span>&nbsp;<span class="op" id="3195795">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195798">return</span>&nbsp;<span class="ident" id="3195805">parse</span><span class="op" id="3195810">(</span><span class="ident" id="3195811">rawurl</span><span class="op" id="3195817">,</span>&nbsp;<span class="builtintype" id="3195819">true</span><span class="op" id="3195823">)</span><br>
<span class="lineno"></span><span class="op" id="3195825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195828">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3195892">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3195971">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3196051">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3196118">func</span>&nbsp;<span class="ident" id="3196123">parse</span><span class="op" id="3196128">(</span><span class="ident" id="3196129">rawurl</span>&nbsp;<span class="builtintype" id="3196136">string</span><span class="op" id="3196142">,</span>&nbsp;<span class="ident" id="3196144">viaRequest</span>&nbsp;<span class="builtintype" id="3196155">bool</span><span class="op" id="3196159">)</span>&nbsp;<span class="op" id="3196161">(</span><span class="ident" id="3196162">url</span>&nbsp;<span class="op" id="3196166">*</span><span class="ident" id="3196167">URL</span><span class="op" id="3196170">,</span>&nbsp;<span class="ident" id="3196172">err</span>&nbsp;<span class="builtintype" id="3196176">error</span><span class="op" id="3196181">)</span>&nbsp;<span class="op" id="3196183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196186">var</span>&nbsp;<span class="ident" id="3196190">rest</span>&nbsp;<span class="builtintype" id="3196195">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196204">if</span>&nbsp;<span class="ident" id="3196207">rawurl</span>&nbsp;<span class="op" id="3196214">==</span>&nbsp;<span class="string" id="3196217">&#34;&#34;</span>&nbsp;<span class="op" id="3196220">&amp;&amp;</span>&nbsp;<span class="ident" id="3196223">viaRequest</span>&nbsp;<span class="op" id="3196234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196238">err</span>&nbsp;<span class="op" id="3196242">=</span>&nbsp;<span class="ident" id="3196244">errors</span><span class="op" id="3196250">.</span><span class="ident" id="3196251">New</span><span class="op" id="3196254">(</span><span class="string" id="3196255">&#34;empty&nbsp;url&#34;</span><span class="op" id="3196266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196270">goto</span>&nbsp;<span class="ident" id="3196275">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196285">url</span>&nbsp;<span class="op" id="3196289">=</span>&nbsp;<span class="builtinfunc" id="3196291">new</span><span class="op" id="3196294">(</span><span class="ident" id="3196295">URL</span><span class="op" id="3196298">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196302">if</span>&nbsp;<span class="ident" id="3196305">rawurl</span>&nbsp;<span class="op" id="3196312">==</span>&nbsp;<span class="string" id="3196315">&#34;*&#34;</span>&nbsp;<span class="op" id="3196319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196323">url</span><span class="op" id="3196326">.</span><span class="ident" id="3196327">Path</span>&nbsp;<span class="op" id="3196332">=</span>&nbsp;<span class="string" id="3196334">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196340">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196348">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196352">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196408">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196447">if</span>&nbsp;<span class="ident" id="3196450">url</span><span class="op" id="3196453">.</span><span class="ident" id="3196454">Scheme</span><span class="op" id="3196460">,</span>&nbsp;<span class="ident" id="3196462">rest</span><span class="op" id="3196466">,</span>&nbsp;<span class="ident" id="3196468">err</span>&nbsp;<span class="op" id="3196472">=</span>&nbsp;<span class="ident" id="3196474">getscheme</span><span class="op" id="3196483">(</span><span class="ident" id="3196484">rawurl</span><span class="op" id="3196490">)</span><span class="op" id="3196491">;</span>&nbsp;<span class="ident" id="3196493">err</span>&nbsp;<span class="op" id="3196497">!=</span>&nbsp;<span class="ident" id="3196500">nil</span>&nbsp;<span class="op" id="3196504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196508">goto</span>&nbsp;<span class="ident" id="3196513">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196523">url</span><span class="op" id="3196526">.</span><span class="ident" id="3196527">Scheme</span>&nbsp;<span class="op" id="3196534">=</span>&nbsp;<span class="ident" id="3196536">strings</span><span class="op" id="3196543">.</span><span class="ident" id="3196544">ToLower</span><span class="op" id="3196551">(</span><span class="ident" id="3196552">url</span><span class="op" id="3196555">.</span><span class="ident" id="3196556">Scheme</span><span class="op" id="3196562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196566">rest</span><span class="op" id="3196570">,</span>&nbsp;<span class="ident" id="3196572">url</span><span class="op" id="3196575">.</span><span class="ident" id="3196576">RawQuery</span>&nbsp;<span class="op" id="3196585">=</span>&nbsp;<span class="ident" id="3196587">split</span><span class="op" id="3196592">(</span><span class="ident" id="3196593">rest</span><span class="op" id="3196597">,</span>&nbsp;<span class="string" id="3196599">&#34;?&#34;</span><span class="op" id="3196602">,</span>&nbsp;<span class="builtintype" id="3196604">true</span><span class="op" id="3196608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196612">if</span>&nbsp;<span class="op" id="3196615">!</span><span class="ident" id="3196616">strings</span><span class="op" id="3196623">.</span><span class="ident" id="3196624">HasPrefix</span><span class="op" id="3196633">(</span><span class="ident" id="3196634">rest</span><span class="op" id="3196638">,</span>&nbsp;<span class="string" id="3196640">&#34;/&#34;</span><span class="op" id="3196643">)</span>&nbsp;<span class="op" id="3196645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196649">if</span>&nbsp;<span class="ident" id="3196652">url</span><span class="op" id="3196655">.</span><span class="ident" id="3196656">Scheme</span>&nbsp;<span class="op" id="3196663">!=</span>&nbsp;<span class="string" id="3196666">&#34;&#34;</span>&nbsp;<span class="op" id="3196669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196674">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196731">url</span><span class="op" id="3196734">.</span><span class="ident" id="3196735">Opaque</span>&nbsp;<span class="op" id="3196742">=</span>&nbsp;<span class="ident" id="3196744">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196752">return</span>&nbsp;<span class="ident" id="3196759">url</span><span class="op" id="3196762">,</span>&nbsp;<span class="ident" id="3196764">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196774">if</span>&nbsp;<span class="ident" id="3196777">viaRequest</span>&nbsp;<span class="op" id="3196788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196793">err</span>&nbsp;<span class="op" id="3196797">=</span>&nbsp;<span class="ident" id="3196799">errors</span><span class="op" id="3196805">.</span><span class="ident" id="3196806">New</span><span class="op" id="3196809">(</span><span class="string" id="3196810">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3196835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196840">goto</span>&nbsp;<span class="ident" id="3196845">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196853">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196860">if</span>&nbsp;<span class="op" id="3196863">(</span><span class="ident" id="3196864">url</span><span class="op" id="3196867">.</span><span class="ident" id="3196868">Scheme</span>&nbsp;<span class="op" id="3196875">!=</span>&nbsp;<span class="string" id="3196878">&#34;&#34;</span>&nbsp;<span class="op" id="3196881">||</span>&nbsp;<span class="op" id="3196884">!</span><span class="ident" id="3196885">viaRequest</span>&nbsp;<span class="op" id="3196896">&amp;&amp;</span>&nbsp;<span class="op" id="3196899">!</span><span class="ident" id="3196900">strings</span><span class="op" id="3196907">.</span><span class="ident" id="3196908">HasPrefix</span><span class="op" id="3196917">(</span><span class="ident" id="3196918">rest</span><span class="op" id="3196922">,</span>&nbsp;<span class="string" id="3196924">&#34;///&#34;</span><span class="op" id="3196929">)</span><span class="op" id="3196930">)</span>&nbsp;<span class="op" id="3196932">&amp;&amp;</span>&nbsp;<span class="ident" id="3196935">strings</span><span class="op" id="3196942">.</span><span class="ident" id="3196943">HasPrefix</span><span class="op" id="3196952">(</span><span class="ident" id="3196953">rest</span><span class="op" id="3196957">,</span>&nbsp;<span class="string" id="3196959">&#34;//&#34;</span><span class="op" id="3196963">)</span>&nbsp;<span class="op" id="3196965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196969">var</span>&nbsp;<span class="ident" id="3196973">authority</span>&nbsp;<span class="builtintype" id="3196983">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196992">authority</span><span class="op" id="3197001">,</span>&nbsp;<span class="ident" id="3197003">rest</span>&nbsp;<span class="op" id="3197008">=</span>&nbsp;<span class="ident" id="3197010">split</span><span class="op" id="3197015">(</span><span class="ident" id="3197016">rest</span><span class="op" id="3197020">[</span><span class="num" id="3197021">2</span><span class="op" id="3197022">:</span><span class="op" id="3197023">]</span><span class="op" id="3197024">,</span>&nbsp;<span class="string" id="3197026">&#34;/&#34;</span><span class="op" id="3197029">,</span>&nbsp;<span class="builtintype" id="3197031">false</span><span class="op" id="3197036">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197040">url</span><span class="op" id="3197043">.</span><span class="ident" id="3197044">User</span><span class="op" id="3197048">,</span>&nbsp;<span class="ident" id="3197050">url</span><span class="op" id="3197053">.</span><span class="ident" id="3197054">Host</span><span class="op" id="3197058">,</span>&nbsp;<span class="ident" id="3197060">err</span>&nbsp;<span class="op" id="3197064">=</span>&nbsp;<span class="ident" id="3197066">parseAuthority</span><span class="op" id="3197080">(</span><span class="ident" id="3197081">authority</span><span class="op" id="3197090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197094">if</span>&nbsp;<span class="ident" id="3197097">err</span>&nbsp;<span class="op" id="3197101">!=</span>&nbsp;<span class="ident" id="3197104">nil</span>&nbsp;<span class="op" id="3197108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197113">goto</span>&nbsp;<span class="ident" id="3197118">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197130">if</span>&nbsp;<span class="ident" id="3197133">strings</span><span class="op" id="3197140">.</span><span class="ident" id="3197141">Contains</span><span class="op" id="3197149">(</span><span class="ident" id="3197150">url</span><span class="op" id="3197153">.</span><span class="ident" id="3197154">Host</span><span class="op" id="3197158">,</span>&nbsp;<span class="string" id="3197160">&#34;%&#34;</span><span class="op" id="3197163">)</span>&nbsp;<span class="op" id="3197165">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197170">err</span>&nbsp;<span class="op" id="3197174">=</span>&nbsp;<span class="ident" id="3197176">errors</span><span class="op" id="3197182">.</span><span class="ident" id="3197183">New</span><span class="op" id="3197186">(</span><span class="string" id="3197187">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3197215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197220">goto</span>&nbsp;<span class="ident" id="3197225">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197239">if</span>&nbsp;<span class="ident" id="3197242">url</span><span class="op" id="3197245">.</span><span class="ident" id="3197246">Path</span><span class="op" id="3197250">,</span>&nbsp;<span class="ident" id="3197252">err</span>&nbsp;<span class="op" id="3197256">=</span>&nbsp;<span class="ident" id="3197258">unescape</span><span class="op" id="3197266">(</span><span class="ident" id="3197267">rest</span><span class="op" id="3197271">,</span>&nbsp;<span class="ident" id="3197273">encodePath</span><span class="op" id="3197283">)</span><span class="op" id="3197284">;</span>&nbsp;<span class="ident" id="3197286">err</span>&nbsp;<span class="op" id="3197290">!=</span>&nbsp;<span class="ident" id="3197293">nil</span>&nbsp;<span class="op" id="3197297">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197301">goto</span>&nbsp;<span class="ident" id="3197306">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197316">return</span>&nbsp;<span class="ident" id="3197323">url</span><span class="op" id="3197326">,</span>&nbsp;<span class="ident" id="3197328">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3197333">Error</span><span class="op" id="3197338">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197341">return</span>&nbsp;<span class="ident" id="3197348">nil</span><span class="op" id="3197351">,</span>&nbsp;<span class="op" id="3197353">&amp;</span><span class="ident" id="3197354">Error</span><span class="op" id="3197359">{</span><span class="string" id="3197360">&#34;parse&#34;</span><span class="op" id="3197367">,</span>&nbsp;<span class="ident" id="3197369">rawurl</span><span class="op" id="3197375">,</span>&nbsp;<span class="ident" id="3197377">err</span><span class="op" id="3197380">}</span><br>
<span class="lineno"></span><span class="op" id="3197382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3197385">func</span>&nbsp;<span class="ident" id="3197390">parseAuthority</span><span class="op" id="3197404">(</span><span class="ident" id="3197405">authority</span>&nbsp;<span class="builtintype" id="3197415">string</span><span class="op" id="3197421">)</span>&nbsp;<span class="op" id="3197423">(</span><span class="ident" id="3197424">user</span>&nbsp;<span class="op" id="3197429">*</span><span class="ident" id="3197430">Userinfo</span><span class="op" id="3197438">,</span>&nbsp;<span class="ident" id="3197440">host</span>&nbsp;<span class="builtintype" id="3197445">string</span><span class="op" id="3197451">,</span>&nbsp;<span class="ident" id="3197453">err</span>&nbsp;<span class="builtintype" id="3197457">error</span><span class="op" id="3197462">)</span>&nbsp;<span class="op" id="3197464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197467">i</span>&nbsp;<span class="op" id="3197469">:=</span>&nbsp;<span class="ident" id="3197472">strings</span><span class="op" id="3197479">.</span><span class="ident" id="3197480">LastIndex</span><span class="op" id="3197489">(</span><span class="ident" id="3197490">authority</span><span class="op" id="3197499">,</span>&nbsp;<span class="string" id="3197501">&#34;@&#34;</span><span class="op" id="3197504">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197507">if</span>&nbsp;<span class="ident" id="3197510">i</span>&nbsp;<span class="op" id="3197512">&lt;</span>&nbsp;<span class="num" id="3197514">0</span>&nbsp;<span class="op" id="3197516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197520">host</span>&nbsp;<span class="op" id="3197525">=</span>&nbsp;<span class="ident" id="3197527">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197550">userinfo</span><span class="op" id="3197558">,</span>&nbsp;<span class="ident" id="3197560">host</span>&nbsp;<span class="op" id="3197565">:=</span>&nbsp;<span class="ident" id="3197568">authority</span><span class="op" id="3197577">[</span><span class="op" id="3197578">:</span><span class="ident" id="3197579">i</span><span class="op" id="3197580">]</span><span class="op" id="3197581">,</span>&nbsp;<span class="ident" id="3197583">authority</span><span class="op" id="3197592">[</span><span class="ident" id="3197593">i</span><span class="op" id="3197594">+</span><span class="num" id="3197595">1</span><span class="op" id="3197596">:</span><span class="op" id="3197597">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197600">if</span>&nbsp;<span class="ident" id="3197603">strings</span><span class="op" id="3197610">.</span><span class="ident" id="3197611">Index</span><span class="op" id="3197616">(</span><span class="ident" id="3197617">userinfo</span><span class="op" id="3197625">,</span>&nbsp;<span class="string" id="3197627">&#34;:&#34;</span><span class="op" id="3197630">)</span>&nbsp;<span class="op" id="3197632">&lt;</span>&nbsp;<span class="num" id="3197634">0</span>&nbsp;<span class="op" id="3197636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197640">if</span>&nbsp;<span class="ident" id="3197643">userinfo</span><span class="op" id="3197651">,</span>&nbsp;<span class="ident" id="3197653">err</span>&nbsp;<span class="op" id="3197657">=</span>&nbsp;<span class="ident" id="3197659">unescape</span><span class="op" id="3197667">(</span><span class="ident" id="3197668">userinfo</span><span class="op" id="3197676">,</span>&nbsp;<span class="ident" id="3197678">encodeUserPassword</span><span class="op" id="3197696">)</span><span class="op" id="3197697">;</span>&nbsp;<span class="ident" id="3197699">err</span>&nbsp;<span class="op" id="3197703">!=</span>&nbsp;<span class="ident" id="3197706">nil</span>&nbsp;<span class="op" id="3197710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197715">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197728">user</span>&nbsp;<span class="op" id="3197733">=</span>&nbsp;<span class="ident" id="3197735">User</span><span class="op" id="3197739">(</span><span class="ident" id="3197740">userinfo</span><span class="op" id="3197748">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197751">}</span>&nbsp;<span class="keyword" id="3197753">else</span>&nbsp;<span class="op" id="3197758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197762">username</span><span class="op" id="3197770">,</span>&nbsp;<span class="ident" id="3197772">password</span>&nbsp;<span class="op" id="3197781">:=</span>&nbsp;<span class="ident" id="3197784">split</span><span class="op" id="3197789">(</span><span class="ident" id="3197790">userinfo</span><span class="op" id="3197798">,</span>&nbsp;<span class="string" id="3197800">&#34;:&#34;</span><span class="op" id="3197803">,</span>&nbsp;<span class="builtintype" id="3197805">true</span><span class="op" id="3197809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197813">if</span>&nbsp;<span class="ident" id="3197816">username</span><span class="op" id="3197824">,</span>&nbsp;<span class="ident" id="3197826">err</span>&nbsp;<span class="op" id="3197830">=</span>&nbsp;<span class="ident" id="3197832">unescape</span><span class="op" id="3197840">(</span><span class="ident" id="3197841">username</span><span class="op" id="3197849">,</span>&nbsp;<span class="ident" id="3197851">encodeUserPassword</span><span class="op" id="3197869">)</span><span class="op" id="3197870">;</span>&nbsp;<span class="ident" id="3197872">err</span>&nbsp;<span class="op" id="3197876">!=</span>&nbsp;<span class="ident" id="3197879">nil</span>&nbsp;<span class="op" id="3197883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197888">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197897">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197901">if</span>&nbsp;<span class="ident" id="3197904">password</span><span class="op" id="3197912">,</span>&nbsp;<span class="ident" id="3197914">err</span>&nbsp;<span class="op" id="3197918">=</span>&nbsp;<span class="ident" id="3197920">unescape</span><span class="op" id="3197928">(</span><span class="ident" id="3197929">password</span><span class="op" id="3197937">,</span>&nbsp;<span class="ident" id="3197939">encodeUserPassword</span><span class="op" id="3197957">)</span><span class="op" id="3197958">;</span>&nbsp;<span class="ident" id="3197960">err</span>&nbsp;<span class="op" id="3197964">!=</span>&nbsp;<span class="ident" id="3197967">nil</span>&nbsp;<span class="op" id="3197971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197976">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197989">user</span>&nbsp;<span class="op" id="3197994">=</span>&nbsp;<span class="ident" id="3197996">UserPassword</span><span class="op" id="3198008">(</span><span class="ident" id="3198009">username</span><span class="op" id="3198017">,</span>&nbsp;<span class="ident" id="3198019">password</span><span class="op" id="3198027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198030">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198033">return</span><br>
<span class="lineno"></span><span class="op" id="3198040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3198043">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3198098">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3198143">//</span><br>
<span class="lineno"></span><span class="comment" id="3198146">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3198163">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3198209">//</span><br>
<span class="lineno"></span><span class="comment" id="3198212">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3198269">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3198307">//</span><br>
<span class="lineno"></span><span class="comment" id="3198310">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3198360">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3198407">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3198452">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3198495">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3198552">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3198605">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3198661">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3198710">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3198758">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3198809">func</span>&nbsp;<span class="op" id="3198814">(</span><span class="ident" id="3198815">u</span>&nbsp;<span class="op" id="3198817">*</span><span class="ident" id="3198818">URL</span><span class="op" id="3198821">)</span>&nbsp;<span class="ident" id="3198823">String</span><span class="op" id="3198829">(</span><span class="op" id="3198830">)</span>&nbsp;<span class="builtintype" id="3198832">string</span>&nbsp;<span class="op" id="3198839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198842">var</span>&nbsp;<span class="ident" id="3198846">buf</span>&nbsp;<span class="ident" id="3198850">bytes</span><span class="op" id="3198855">.</span><span class="ident" id="3198856">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198864">if</span>&nbsp;<span class="ident" id="3198867">u</span><span class="op" id="3198868">.</span><span class="ident" id="3198869">Scheme</span>&nbsp;<span class="op" id="3198876">!=</span>&nbsp;<span class="string" id="3198879">&#34;&#34;</span>&nbsp;<span class="op" id="3198882">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3198886">buf</span><span class="op" id="3198889">.</span><span class="ident" id="3198890">WriteString</span><span class="op" id="3198901">(</span><span class="ident" id="3198902">u</span><span class="op" id="3198903">.</span><span class="ident" id="3198904">Scheme</span><span class="op" id="3198910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3198914">buf</span><span class="op" id="3198917">.</span><span class="ident" id="3198918">WriteByte</span><span class="op" id="3198927">(</span><span class="string" id="3198928">&#39;:&#39;</span><span class="op" id="3198931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198937">if</span>&nbsp;<span class="ident" id="3198940">u</span><span class="op" id="3198941">.</span><span class="ident" id="3198942">Opaque</span>&nbsp;<span class="op" id="3198949">!=</span>&nbsp;<span class="string" id="3198952">&#34;&#34;</span>&nbsp;<span class="op" id="3198955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3198959">buf</span><span class="op" id="3198962">.</span><span class="ident" id="3198963">WriteString</span><span class="op" id="3198974">(</span><span class="ident" id="3198975">u</span><span class="op" id="3198976">.</span><span class="ident" id="3198977">Opaque</span><span class="op" id="3198983">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198986">}</span>&nbsp;<span class="keyword" id="3198988">else</span>&nbsp;<span class="op" id="3198993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198997">if</span>&nbsp;<span class="ident" id="3199000">u</span><span class="op" id="3199001">.</span><span class="ident" id="3199002">Scheme</span>&nbsp;<span class="op" id="3199009">!=</span>&nbsp;<span class="string" id="3199012">&#34;&#34;</span>&nbsp;<span class="op" id="3199015">||</span>&nbsp;<span class="ident" id="3199018">u</span><span class="op" id="3199019">.</span><span class="ident" id="3199020">Host</span>&nbsp;<span class="op" id="3199025">!=</span>&nbsp;<span class="string" id="3199028">&#34;&#34;</span>&nbsp;<span class="op" id="3199031">||</span>&nbsp;<span class="ident" id="3199034">u</span><span class="op" id="3199035">.</span><span class="ident" id="3199036">User</span>&nbsp;<span class="op" id="3199041">!=</span>&nbsp;<span class="ident" id="3199044">nil</span>&nbsp;<span class="op" id="3199048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199053">buf</span><span class="op" id="3199056">.</span><span class="ident" id="3199057">WriteString</span><span class="op" id="3199068">(</span><span class="string" id="3199069">&#34;//&#34;</span><span class="op" id="3199073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199078">if</span>&nbsp;<span class="ident" id="3199081">ui</span>&nbsp;<span class="op" id="3199084">:=</span>&nbsp;<span class="ident" id="3199087">u</span><span class="op" id="3199088">.</span><span class="ident" id="3199089">User</span><span class="op" id="3199093">;</span>&nbsp;<span class="ident" id="3199095">ui</span>&nbsp;<span class="op" id="3199098">!=</span>&nbsp;<span class="ident" id="3199101">nil</span>&nbsp;<span class="op" id="3199105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199111">buf</span><span class="op" id="3199114">.</span><span class="ident" id="3199115">WriteString</span><span class="op" id="3199126">(</span><span class="ident" id="3199127">ui</span><span class="op" id="3199129">.</span><span class="ident" id="3199130">String</span><span class="op" id="3199136">(</span><span class="op" id="3199137">)</span><span class="op" id="3199138">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199144">buf</span><span class="op" id="3199147">.</span><span class="ident" id="3199148">WriteByte</span><span class="op" id="3199157">(</span><span class="string" id="3199158">&#39;@&#39;</span><span class="op" id="3199161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199171">if</span>&nbsp;<span class="ident" id="3199174">h</span>&nbsp;<span class="op" id="3199176">:=</span>&nbsp;<span class="ident" id="3199179">u</span><span class="op" id="3199180">.</span><span class="ident" id="3199181">Host</span><span class="op" id="3199185">;</span>&nbsp;<span class="ident" id="3199187">h</span>&nbsp;<span class="op" id="3199189">!=</span>&nbsp;<span class="string" id="3199192">&#34;&#34;</span>&nbsp;<span class="op" id="3199195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199201">buf</span><span class="op" id="3199204">.</span><span class="ident" id="3199205">WriteString</span><span class="op" id="3199216">(</span><span class="ident" id="3199217">h</span><span class="op" id="3199218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199223">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199231">if</span>&nbsp;<span class="ident" id="3199234">u</span><span class="op" id="3199235">.</span><span class="ident" id="3199236">Path</span>&nbsp;<span class="op" id="3199241">!=</span>&nbsp;<span class="string" id="3199244">&#34;&#34;</span>&nbsp;<span class="op" id="3199247">&amp;&amp;</span>&nbsp;<span class="ident" id="3199250">u</span><span class="op" id="3199251">.</span><span class="ident" id="3199252">Path</span><span class="op" id="3199256">[</span><span class="num" id="3199257">0</span><span class="op" id="3199258">]</span>&nbsp;<span class="op" id="3199260">!=</span>&nbsp;<span class="string" id="3199263">&#39;/&#39;</span>&nbsp;<span class="op" id="3199267">&amp;&amp;</span>&nbsp;<span class="ident" id="3199270">u</span><span class="op" id="3199271">.</span><span class="ident" id="3199272">Host</span>&nbsp;<span class="op" id="3199277">!=</span>&nbsp;<span class="string" id="3199280">&#34;&#34;</span>&nbsp;<span class="op" id="3199283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199288">buf</span><span class="op" id="3199291">.</span><span class="ident" id="3199292">WriteByte</span><span class="op" id="3199301">(</span><span class="string" id="3199302">&#39;/&#39;</span><span class="op" id="3199305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199313">buf</span><span class="op" id="3199316">.</span><span class="ident" id="3199317">WriteString</span><span class="op" id="3199328">(</span><span class="ident" id="3199329">escape</span><span class="op" id="3199335">(</span><span class="ident" id="3199336">u</span><span class="op" id="3199337">.</span><span class="ident" id="3199338">Path</span><span class="op" id="3199342">,</span>&nbsp;<span class="ident" id="3199344">encodePath</span><span class="op" id="3199354">)</span><span class="op" id="3199355">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199361">if</span>&nbsp;<span class="ident" id="3199364">u</span><span class="op" id="3199365">.</span><span class="ident" id="3199366">RawQuery</span>&nbsp;<span class="op" id="3199375">!=</span>&nbsp;<span class="string" id="3199378">&#34;&#34;</span>&nbsp;<span class="op" id="3199381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199385">buf</span><span class="op" id="3199388">.</span><span class="ident" id="3199389">WriteByte</span><span class="op" id="3199398">(</span><span class="string" id="3199399">&#39;?&#39;</span><span class="op" id="3199402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199406">buf</span><span class="op" id="3199409">.</span><span class="ident" id="3199410">WriteString</span><span class="op" id="3199421">(</span><span class="ident" id="3199422">u</span><span class="op" id="3199423">.</span><span class="ident" id="3199424">RawQuery</span><span class="op" id="3199432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199435">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199438">if</span>&nbsp;<span class="ident" id="3199441">u</span><span class="op" id="3199442">.</span><span class="ident" id="3199443">Fragment</span>&nbsp;<span class="op" id="3199452">!=</span>&nbsp;<span class="string" id="3199455">&#34;&#34;</span>&nbsp;<span class="op" id="3199458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199462">buf</span><span class="op" id="3199465">.</span><span class="ident" id="3199466">WriteByte</span><span class="op" id="3199475">(</span><span class="string" id="3199476">&#39;#&#39;</span><span class="op" id="3199479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199483">buf</span><span class="op" id="3199486">.</span><span class="ident" id="3199487">WriteString</span><span class="op" id="3199498">(</span><span class="ident" id="3199499">escape</span><span class="op" id="3199505">(</span><span class="ident" id="3199506">u</span><span class="op" id="3199507">.</span><span class="ident" id="3199508">Fragment</span><span class="op" id="3199516">,</span>&nbsp;<span class="ident" id="3199518">encodeFragment</span><span class="op" id="3199532">)</span><span class="op" id="3199533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199539">return</span>&nbsp;<span class="ident" id="3199546">buf</span><span class="op" id="3199549">.</span><span class="ident" id="3199550">String</span><span class="op" id="3199556">(</span><span class="op" id="3199557">)</span><br>
<span class="lineno">495</span><span class="op" id="3199559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3199562">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3199611">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3199673">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3199732">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3199755">type</span>&nbsp;<span class="ident" id="3199760">Values</span>&nbsp;<span class="keyword" id="3199767">map</span><span class="op" id="3199770">[</span><span class="builtintype" id="3199771">string</span><span class="op" id="3199777">]</span><span class="op" id="3199778">[</span><span class="op" id="3199779">]</span><span class="builtintype" id="3199780">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3199788">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3199847">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3199910">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3199970">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3199983">func</span>&nbsp;<span class="op" id="3199988">(</span><span class="ident" id="3199989">v</span>&nbsp;<span class="ident" id="3199991">Values</span><span class="op" id="3199997">)</span>&nbsp;<span class="ident" id="3199999">Get</span><span class="op" id="3200002">(</span><span class="ident" id="3200003">key</span>&nbsp;<span class="builtintype" id="3200007">string</span><span class="op" id="3200013">)</span>&nbsp;<span class="builtintype" id="3200015">string</span>&nbsp;<span class="op" id="3200022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200025">if</span>&nbsp;<span class="ident" id="3200028">v</span>&nbsp;<span class="op" id="3200030">==</span>&nbsp;<span class="ident" id="3200033">nil</span>&nbsp;<span class="op" id="3200037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200041">return</span>&nbsp;<span class="string" id="3200048">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200055">vs</span><span class="op" id="3200057">,</span>&nbsp;<span class="ident" id="3200059">ok</span>&nbsp;<span class="op" id="3200062">:=</span>&nbsp;<span class="ident" id="3200065">v</span><span class="op" id="3200066">[</span><span class="ident" id="3200067">key</span><span class="op" id="3200070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200073">if</span>&nbsp;<span class="op" id="3200076">!</span><span class="ident" id="3200077">ok</span>&nbsp;<span class="op" id="3200080">||</span>&nbsp;<span class="builtinfunc" id="3200083">len</span><span class="op" id="3200086">(</span><span class="ident" id="3200087">vs</span><span class="op" id="3200089">)</span>&nbsp;<span class="op" id="3200091">==</span>&nbsp;<span class="num" id="3200094">0</span>&nbsp;<span class="op" id="3200096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200100">return</span>&nbsp;<span class="string" id="3200107">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200111">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200114">return</span>&nbsp;<span class="ident" id="3200121">vs</span><span class="op" id="3200123">[</span><span class="num" id="3200124">0</span><span class="op" id="3200125">]</span><br>
<span class="lineno"></span><span class="op" id="3200127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3200130">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3200185">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3200196">func</span>&nbsp;<span class="op" id="3200201">(</span><span class="ident" id="3200202">v</span>&nbsp;<span class="ident" id="3200204">Values</span><span class="op" id="3200210">)</span>&nbsp;<span class="ident" id="3200212">Set</span><span class="op" id="3200215">(</span><span class="ident" id="3200216">key</span><span class="op" id="3200219">,</span>&nbsp;<span class="ident" id="3200221">value</span>&nbsp;<span class="builtintype" id="3200227">string</span><span class="op" id="3200233">)</span>&nbsp;<span class="op" id="3200235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200238">v</span><span class="op" id="3200239">[</span><span class="ident" id="3200240">key</span><span class="op" id="3200243">]</span>&nbsp;<span class="op" id="3200245">=</span>&nbsp;<span class="op" id="3200247">[</span><span class="op" id="3200248">]</span><span class="builtintype" id="3200249">string</span><span class="op" id="3200255">{</span><span class="ident" id="3200256">value</span><span class="op" id="3200261">}</span><br>
<span class="lineno"></span><span class="op" id="3200263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3200266">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3200323">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3200354">func</span>&nbsp;<span class="op" id="3200359">(</span><span class="ident" id="3200360">v</span>&nbsp;<span class="ident" id="3200362">Values</span><span class="op" id="3200368">)</span>&nbsp;<span class="ident" id="3200370">Add</span><span class="op" id="3200373">(</span><span class="ident" id="3200374">key</span><span class="op" id="3200377">,</span>&nbsp;<span class="ident" id="3200379">value</span>&nbsp;<span class="builtintype" id="3200385">string</span><span class="op" id="3200391">)</span>&nbsp;<span class="op" id="3200393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200396">v</span><span class="op" id="3200397">[</span><span class="ident" id="3200398">key</span><span class="op" id="3200401">]</span>&nbsp;<span class="op" id="3200403">=</span>&nbsp;<span class="builtinfunc" id="3200405">append</span><span class="op" id="3200411">(</span><span class="ident" id="3200412">v</span><span class="op" id="3200413">[</span><span class="ident" id="3200414">key</span><span class="op" id="3200417">]</span><span class="op" id="3200418">,</span>&nbsp;<span class="ident" id="3200420">value</span><span class="op" id="3200425">)</span><br>
<span class="lineno"></span><span class="op" id="3200427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3200430">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3200477">func</span>&nbsp;<span class="op" id="3200482">(</span><span class="ident" id="3200483">v</span>&nbsp;<span class="ident" id="3200485">Values</span><span class="op" id="3200491">)</span>&nbsp;<span class="ident" id="3200493">Del</span><span class="op" id="3200496">(</span><span class="ident" id="3200497">key</span>&nbsp;<span class="builtintype" id="3200501">string</span><span class="op" id="3200507">)</span>&nbsp;<span class="op" id="3200509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3200512">delete</span><span class="op" id="3200518">(</span><span class="ident" id="3200519">v</span><span class="op" id="3200520">,</span>&nbsp;<span class="ident" id="3200522">key</span><span class="op" id="3200525">)</span><br>
<span class="lineno"></span><span class="op" id="3200527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3200530">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3200592">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3200644">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3200706">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3200778">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3200802">func</span>&nbsp;<span class="ident" id="3200807">ParseQuery</span><span class="op" id="3200817">(</span><span class="ident" id="3200818">query</span>&nbsp;<span class="builtintype" id="3200824">string</span><span class="op" id="3200830">)</span>&nbsp;<span class="op" id="3200832">(</span><span class="ident" id="3200833">m</span>&nbsp;<span class="ident" id="3200835">Values</span><span class="op" id="3200841">,</span>&nbsp;<span class="ident" id="3200843">err</span>&nbsp;<span class="builtintype" id="3200847">error</span><span class="op" id="3200852">)</span>&nbsp;<span class="op" id="3200854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200857">m</span>&nbsp;<span class="op" id="3200859">=</span>&nbsp;<span class="builtinfunc" id="3200861">make</span><span class="op" id="3200865">(</span><span class="ident" id="3200866">Values</span><span class="op" id="3200872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200875">err</span>&nbsp;<span class="op" id="3200879">=</span>&nbsp;<span class="ident" id="3200881">parseQuery</span><span class="op" id="3200891">(</span><span class="ident" id="3200892">m</span><span class="op" id="3200893">,</span>&nbsp;<span class="ident" id="3200895">query</span><span class="op" id="3200900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200903">return</span><br>
<span class="lineno"></span><span class="op" id="3200910">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3200913">func</span>&nbsp;<span class="ident" id="3200918">parseQuery</span><span class="op" id="3200928">(</span><span class="ident" id="3200929">m</span>&nbsp;<span class="ident" id="3200931">Values</span><span class="op" id="3200937">,</span>&nbsp;<span class="ident" id="3200939">query</span>&nbsp;<span class="builtintype" id="3200945">string</span><span class="op" id="3200951">)</span>&nbsp;<span class="op" id="3200953">(</span><span class="ident" id="3200954">err</span>&nbsp;<span class="builtintype" id="3200958">error</span><span class="op" id="3200963">)</span>&nbsp;<span class="op" id="3200965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200968">for</span>&nbsp;<span class="ident" id="3200972">query</span>&nbsp;<span class="op" id="3200978">!=</span>&nbsp;<span class="string" id="3200981">&#34;&#34;</span>&nbsp;<span class="op" id="3200984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200988">key</span>&nbsp;<span class="op" id="3200992">:=</span>&nbsp;<span class="ident" id="3200995">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201003">if</span>&nbsp;<span class="ident" id="3201006">i</span>&nbsp;<span class="op" id="3201008">:=</span>&nbsp;<span class="ident" id="3201011">strings</span><span class="op" id="3201018">.</span><span class="ident" id="3201019">IndexAny</span><span class="op" id="3201027">(</span><span class="ident" id="3201028">key</span><span class="op" id="3201031">,</span>&nbsp;<span class="string" id="3201033">&#34;&amp;;&#34;</span><span class="op" id="3201037">)</span><span class="op" id="3201038">;</span>&nbsp;<span class="ident" id="3201040">i</span>&nbsp;<span class="op" id="3201042">&gt;=</span>&nbsp;<span class="num" id="3201045">0</span>&nbsp;<span class="op" id="3201047">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201052">key</span><span class="op" id="3201055">,</span>&nbsp;<span class="ident" id="3201057">query</span>&nbsp;<span class="op" id="3201063">=</span>&nbsp;<span class="ident" id="3201065">key</span><span class="op" id="3201068">[</span><span class="op" id="3201069">:</span><span class="ident" id="3201070">i</span><span class="op" id="3201071">]</span><span class="op" id="3201072">,</span>&nbsp;<span class="ident" id="3201074">key</span><span class="op" id="3201077">[</span><span class="ident" id="3201078">i</span><span class="op" id="3201079">+</span><span class="num" id="3201080">1</span><span class="op" id="3201081">:</span><span class="op" id="3201082">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201086">}</span>&nbsp;<span class="keyword" id="3201088">else</span>&nbsp;<span class="op" id="3201093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201098">query</span>&nbsp;<span class="op" id="3201104">=</span>&nbsp;<span class="string" id="3201106">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201115">if</span>&nbsp;<span class="ident" id="3201118">key</span>&nbsp;<span class="op" id="3201122">==</span>&nbsp;<span class="string" id="3201125">&#34;&#34;</span>&nbsp;<span class="op" id="3201128">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201133">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201148">value</span>&nbsp;<span class="op" id="3201154">:=</span>&nbsp;<span class="string" id="3201157">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201162">if</span>&nbsp;<span class="ident" id="3201165">i</span>&nbsp;<span class="op" id="3201167">:=</span>&nbsp;<span class="ident" id="3201170">strings</span><span class="op" id="3201177">.</span><span class="ident" id="3201178">Index</span><span class="op" id="3201183">(</span><span class="ident" id="3201184">key</span><span class="op" id="3201187">,</span>&nbsp;<span class="string" id="3201189">&#34;=&#34;</span><span class="op" id="3201192">)</span><span class="op" id="3201193">;</span>&nbsp;<span class="ident" id="3201195">i</span>&nbsp;<span class="op" id="3201197">&gt;=</span>&nbsp;<span class="num" id="3201200">0</span>&nbsp;<span class="op" id="3201202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201207">key</span><span class="op" id="3201210">,</span>&nbsp;<span class="ident" id="3201212">value</span>&nbsp;<span class="op" id="3201218">=</span>&nbsp;<span class="ident" id="3201220">key</span><span class="op" id="3201223">[</span><span class="op" id="3201224">:</span><span class="ident" id="3201225">i</span><span class="op" id="3201226">]</span><span class="op" id="3201227">,</span>&nbsp;<span class="ident" id="3201229">key</span><span class="op" id="3201232">[</span><span class="ident" id="3201233">i</span><span class="op" id="3201234">+</span><span class="num" id="3201235">1</span><span class="op" id="3201236">:</span><span class="op" id="3201237">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201245">key</span><span class="op" id="3201248">,</span>&nbsp;<span class="ident" id="3201250">err1</span>&nbsp;<span class="op" id="3201255">:=</span>&nbsp;<span class="ident" id="3201258">QueryUnescape</span><span class="op" id="3201271">(</span><span class="ident" id="3201272">key</span><span class="op" id="3201275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201279">if</span>&nbsp;<span class="ident" id="3201282">err1</span>&nbsp;<span class="op" id="3201287">!=</span>&nbsp;<span class="ident" id="3201290">nil</span>&nbsp;<span class="op" id="3201294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201299">if</span>&nbsp;<span class="ident" id="3201302">err</span>&nbsp;<span class="op" id="3201306">==</span>&nbsp;<span class="ident" id="3201309">nil</span>&nbsp;<span class="op" id="3201313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201319">err</span>&nbsp;<span class="op" id="3201323">=</span>&nbsp;<span class="ident" id="3201325">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201338">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201353">value</span><span class="op" id="3201358">,</span>&nbsp;<span class="ident" id="3201360">err1</span>&nbsp;<span class="op" id="3201365">=</span>&nbsp;<span class="ident" id="3201367">QueryUnescape</span><span class="op" id="3201380">(</span><span class="ident" id="3201381">value</span><span class="op" id="3201386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201390">if</span>&nbsp;<span class="ident" id="3201393">err1</span>&nbsp;<span class="op" id="3201398">!=</span>&nbsp;<span class="ident" id="3201401">nil</span>&nbsp;<span class="op" id="3201405">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201410">if</span>&nbsp;<span class="ident" id="3201413">err</span>&nbsp;<span class="op" id="3201417">==</span>&nbsp;<span class="ident" id="3201420">nil</span>&nbsp;<span class="op" id="3201424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201430">err</span>&nbsp;<span class="op" id="3201434">=</span>&nbsp;<span class="ident" id="3201436">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201449">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201460">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201464">m</span><span class="op" id="3201465">[</span><span class="ident" id="3201466">key</span><span class="op" id="3201469">]</span>&nbsp;<span class="op" id="3201471">=</span>&nbsp;<span class="builtinfunc" id="3201473">append</span><span class="op" id="3201479">(</span><span class="ident" id="3201480">m</span><span class="op" id="3201481">[</span><span class="ident" id="3201482">key</span><span class="op" id="3201485">]</span><span class="op" id="3201486">,</span>&nbsp;<span class="ident" id="3201488">value</span><span class="op" id="3201493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201499">return</span>&nbsp;<span class="ident" id="3201506">err</span><br>
<span class="lineno"></span><span class="op" id="3201510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3201513">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3201568">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3201607">func</span>&nbsp;<span class="op" id="3201612">(</span><span class="ident" id="3201613">v</span>&nbsp;<span class="ident" id="3201615">Values</span><span class="op" id="3201621">)</span>&nbsp;<span class="ident" id="3201623">Encode</span><span class="op" id="3201629">(</span><span class="op" id="3201630">)</span>&nbsp;<span class="builtintype" id="3201632">string</span>&nbsp;<span class="op" id="3201639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201642">if</span>&nbsp;<span class="ident" id="3201645">v</span>&nbsp;<span class="op" id="3201647">==</span>&nbsp;<span class="ident" id="3201650">nil</span>&nbsp;<span class="op" id="3201654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201658">return</span>&nbsp;<span class="string" id="3201665">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201672">var</span>&nbsp;<span class="ident" id="3201676">buf</span>&nbsp;<span class="ident" id="3201680">bytes</span><span class="op" id="3201685">.</span><span class="ident" id="3201686">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201694">keys</span>&nbsp;<span class="op" id="3201699">:=</span>&nbsp;<span class="builtinfunc" id="3201702">make</span><span class="op" id="3201706">(</span><span class="op" id="3201707">[</span><span class="op" id="3201708">]</span><span class="builtintype" id="3201709">string</span><span class="op" id="3201715">,</span>&nbsp;<span class="num" id="3201717">0</span><span class="op" id="3201718">,</span>&nbsp;<span class="builtinfunc" id="3201720">len</span><span class="op" id="3201723">(</span><span class="ident" id="3201724">v</span><span class="op" id="3201725">)</span><span class="op" id="3201726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201729">for</span>&nbsp;<span class="ident" id="3201733">k</span>&nbsp;<span class="op" id="3201735">:=</span>&nbsp;<span class="keyword" id="3201738">range</span>&nbsp;<span class="ident" id="3201744">v</span>&nbsp;<span class="op" id="3201746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201750">keys</span>&nbsp;<span class="op" id="3201755">=</span>&nbsp;<span class="builtinfunc" id="3201757">append</span><span class="op" id="3201763">(</span><span class="ident" id="3201764">keys</span><span class="op" id="3201768">,</span>&nbsp;<span class="ident" id="3201770">k</span><span class="op" id="3201771">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201777">sort</span><span class="op" id="3201781">.</span><span class="ident" id="3201782">Strings</span><span class="op" id="3201789">(</span><span class="ident" id="3201790">keys</span><span class="op" id="3201794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201797">for</span>&nbsp;<span class="ident" id="3201801">_</span><span class="op" id="3201802">,</span>&nbsp;<span class="ident" id="3201804">k</span>&nbsp;<span class="op" id="3201806">:=</span>&nbsp;<span class="keyword" id="3201809">range</span>&nbsp;<span class="ident" id="3201815">keys</span>&nbsp;<span class="op" id="3201820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201824">vs</span>&nbsp;<span class="op" id="3201827">:=</span>&nbsp;<span class="ident" id="3201830">v</span><span class="op" id="3201831">[</span><span class="ident" id="3201832">k</span><span class="op" id="3201833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201837">prefix</span>&nbsp;<span class="op" id="3201844">:=</span>&nbsp;<span class="ident" id="3201847">QueryEscape</span><span class="op" id="3201858">(</span><span class="ident" id="3201859">k</span><span class="op" id="3201860">)</span>&nbsp;<span class="op" id="3201862">+</span>&nbsp;<span class="string" id="3201864">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201870">for</span>&nbsp;<span class="ident" id="3201874">_</span><span class="op" id="3201875">,</span>&nbsp;<span class="ident" id="3201877">v</span>&nbsp;<span class="op" id="3201879">:=</span>&nbsp;<span class="keyword" id="3201882">range</span>&nbsp;<span class="ident" id="3201888">vs</span>&nbsp;<span class="op" id="3201891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3201896">if</span>&nbsp;<span class="ident" id="3201899">buf</span><span class="op" id="3201902">.</span><span class="ident" id="3201903">Len</span><span class="op" id="3201906">(</span><span class="op" id="3201907">)</span>&nbsp;<span class="op" id="3201909">&gt;</span>&nbsp;<span class="num" id="3201911">0</span>&nbsp;<span class="op" id="3201913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201919">buf</span><span class="op" id="3201922">.</span><span class="ident" id="3201923">WriteByte</span><span class="op" id="3201932">(</span><span class="string" id="3201933">&#39;&amp;&#39;</span><span class="op" id="3201936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3201941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201946">buf</span><span class="op" id="3201949">.</span><span class="ident" id="3201950">WriteString</span><span class="op" id="3201961">(</span><span class="ident" id="3201962">prefix</span><span class="op" id="3201968">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3201973">buf</span><span class="op" id="3201976">.</span><span class="ident" id="3201977">WriteString</span><span class="op" id="3201988">(</span><span class="ident" id="3201989">QueryEscape</span><span class="op" id="3202000">(</span><span class="ident" id="3202001">v</span><span class="op" id="3202002">)</span><span class="op" id="3202003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202013">return</span>&nbsp;<span class="ident" id="3202020">buf</span><span class="op" id="3202023">.</span><span class="ident" id="3202024">String</span><span class="op" id="3202030">(</span><span class="op" id="3202031">)</span><br>
<span class="lineno"></span><span class="op" id="3202033">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3202036">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3202103">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3202134">func</span>&nbsp;<span class="ident" id="3202139">resolvePath</span><span class="op" id="3202150">(</span><span class="ident" id="3202151">base</span><span class="op" id="3202155">,</span>&nbsp;<span class="ident" id="3202157">ref</span>&nbsp;<span class="builtintype" id="3202161">string</span><span class="op" id="3202167">)</span>&nbsp;<span class="builtintype" id="3202169">string</span>&nbsp;<span class="op" id="3202176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202179">var</span>&nbsp;<span class="ident" id="3202183">full</span>&nbsp;<span class="builtintype" id="3202188">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202196">if</span>&nbsp;<span class="ident" id="3202199">ref</span>&nbsp;<span class="op" id="3202203">==</span>&nbsp;<span class="string" id="3202206">&#34;&#34;</span>&nbsp;<span class="op" id="3202209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202213">full</span>&nbsp;<span class="op" id="3202218">=</span>&nbsp;<span class="ident" id="3202220">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202226">}</span>&nbsp;<span class="keyword" id="3202228">else</span>&nbsp;<span class="keyword" id="3202233">if</span>&nbsp;<span class="ident" id="3202236">ref</span><span class="op" id="3202239">[</span><span class="num" id="3202240">0</span><span class="op" id="3202241">]</span>&nbsp;<span class="op" id="3202243">!=</span>&nbsp;<span class="string" id="3202246">&#39;/&#39;</span>&nbsp;<span class="op" id="3202250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202254">i</span>&nbsp;<span class="op" id="3202256">:=</span>&nbsp;<span class="ident" id="3202259">strings</span><span class="op" id="3202266">.</span><span class="ident" id="3202267">LastIndex</span><span class="op" id="3202276">(</span><span class="ident" id="3202277">base</span><span class="op" id="3202281">,</span>&nbsp;<span class="string" id="3202283">&#34;/&#34;</span><span class="op" id="3202286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202290">full</span>&nbsp;<span class="op" id="3202295">=</span>&nbsp;<span class="ident" id="3202297">base</span><span class="op" id="3202301">[</span><span class="op" id="3202302">:</span><span class="ident" id="3202303">i</span><span class="op" id="3202304">+</span><span class="num" id="3202305">1</span><span class="op" id="3202306">]</span>&nbsp;<span class="op" id="3202308">+</span>&nbsp;<span class="ident" id="3202310">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202315">}</span>&nbsp;<span class="keyword" id="3202317">else</span>&nbsp;<span class="op" id="3202322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202326">full</span>&nbsp;<span class="op" id="3202331">=</span>&nbsp;<span class="ident" id="3202333">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202341">if</span>&nbsp;<span class="ident" id="3202344">full</span>&nbsp;<span class="op" id="3202349">==</span>&nbsp;<span class="string" id="3202352">&#34;&#34;</span>&nbsp;<span class="op" id="3202355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202359">return</span>&nbsp;<span class="string" id="3202366">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202373">var</span>&nbsp;<span class="ident" id="3202377">dst</span>&nbsp;<span class="op" id="3202381">[</span><span class="op" id="3202382">]</span><span class="builtintype" id="3202383">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202391">src</span>&nbsp;<span class="op" id="3202395">:=</span>&nbsp;<span class="ident" id="3202398">strings</span><span class="op" id="3202405">.</span><span class="ident" id="3202406">Split</span><span class="op" id="3202411">(</span><span class="ident" id="3202412">full</span><span class="op" id="3202416">,</span>&nbsp;<span class="string" id="3202418">&#34;/&#34;</span><span class="op" id="3202421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202424">for</span>&nbsp;<span class="ident" id="3202428">_</span><span class="op" id="3202429">,</span>&nbsp;<span class="ident" id="3202431">elem</span>&nbsp;<span class="op" id="3202436">:=</span>&nbsp;<span class="keyword" id="3202439">range</span>&nbsp;<span class="ident" id="3202445">src</span>&nbsp;<span class="op" id="3202449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202453">switch</span>&nbsp;<span class="ident" id="3202460">elem</span>&nbsp;<span class="op" id="3202465">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202469">case</span>&nbsp;<span class="string" id="3202474">&#34;.&#34;</span><span class="op" id="3202477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3202482">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202492">case</span>&nbsp;<span class="string" id="3202497">&#34;..&#34;</span><span class="op" id="3202501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202506">if</span>&nbsp;<span class="builtinfunc" id="3202509">len</span><span class="op" id="3202512">(</span><span class="ident" id="3202513">dst</span><span class="op" id="3202516">)</span>&nbsp;<span class="op" id="3202518">&gt;</span>&nbsp;<span class="num" id="3202520">0</span>&nbsp;<span class="op" id="3202522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202528">dst</span>&nbsp;<span class="op" id="3202532">=</span>&nbsp;<span class="ident" id="3202534">dst</span><span class="op" id="3202537">[</span><span class="op" id="3202538">:</span><span class="builtinfunc" id="3202539">len</span><span class="op" id="3202542">(</span><span class="ident" id="3202543">dst</span><span class="op" id="3202546">)</span><span class="op" id="3202547">-</span><span class="num" id="3202548">1</span><span class="op" id="3202549">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202558">default</span><span class="op" id="3202565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202570">dst</span>&nbsp;<span class="op" id="3202574">=</span>&nbsp;<span class="builtinfunc" id="3202576">append</span><span class="op" id="3202582">(</span><span class="ident" id="3202583">dst</span><span class="op" id="3202586">,</span>&nbsp;<span class="ident" id="3202588">elem</span><span class="op" id="3202592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202599">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202602">if</span>&nbsp;<span class="ident" id="3202605">last</span>&nbsp;<span class="op" id="3202610">:=</span>&nbsp;<span class="ident" id="3202613">src</span><span class="op" id="3202616">[</span><span class="builtinfunc" id="3202617">len</span><span class="op" id="3202620">(</span><span class="ident" id="3202621">src</span><span class="op" id="3202624">)</span><span class="op" id="3202625">-</span><span class="num" id="3202626">1</span><span class="op" id="3202627">]</span><span class="op" id="3202628">;</span>&nbsp;<span class="ident" id="3202630">last</span>&nbsp;<span class="op" id="3202635">==</span>&nbsp;<span class="string" id="3202638">&#34;.&#34;</span>&nbsp;<span class="op" id="3202642">||</span>&nbsp;<span class="ident" id="3202645">last</span>&nbsp;<span class="op" id="3202650">==</span>&nbsp;<span class="string" id="3202653">&#34;..&#34;</span>&nbsp;<span class="op" id="3202658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3202662">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3202703">dst</span>&nbsp;<span class="op" id="3202707">=</span>&nbsp;<span class="builtinfunc" id="3202709">append</span><span class="op" id="3202715">(</span><span class="ident" id="3202716">dst</span><span class="op" id="3202719">,</span>&nbsp;<span class="string" id="3202721">&#34;&#34;</span><span class="op" id="3202723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3202726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202729">return</span>&nbsp;<span class="string" id="3202736">&#34;/&#34;</span>&nbsp;<span class="op" id="3202740">+</span>&nbsp;<span class="ident" id="3202742">strings</span><span class="op" id="3202749">.</span><span class="ident" id="3202750">TrimLeft</span><span class="op" id="3202758">(</span><span class="ident" id="3202759">strings</span><span class="op" id="3202766">.</span><span class="ident" id="3202767">Join</span><span class="op" id="3202771">(</span><span class="ident" id="3202772">dst</span><span class="op" id="3202775">,</span>&nbsp;<span class="string" id="3202777">&#34;/&#34;</span><span class="op" id="3202780">)</span><span class="op" id="3202781">,</span>&nbsp;<span class="string" id="3202783">&#34;/&#34;</span><span class="op" id="3202786">)</span><br>
<span class="lineno">640</span><span class="op" id="3202788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3202791">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3202837">func</span>&nbsp;<span class="op" id="3202842">(</span><span class="ident" id="3202843">u</span>&nbsp;<span class="op" id="3202845">*</span><span class="ident" id="3202846">URL</span><span class="op" id="3202849">)</span>&nbsp;<span class="ident" id="3202851">IsAbs</span><span class="op" id="3202856">(</span><span class="op" id="3202857">)</span>&nbsp;<span class="builtintype" id="3202859">bool</span>&nbsp;<span class="op" id="3202864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3202867">return</span>&nbsp;<span class="ident" id="3202874">u</span><span class="op" id="3202875">.</span><span class="ident" id="3202876">Scheme</span>&nbsp;<span class="op" id="3202883">!=</span>&nbsp;<span class="string" id="3202886">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3202889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3202892">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3202964">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3203029">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3203101">func</span>&nbsp;<span class="op" id="3203106">(</span><span class="ident" id="3203107">u</span>&nbsp;<span class="op" id="3203109">*</span><span class="ident" id="3203110">URL</span><span class="op" id="3203113">)</span>&nbsp;<span class="ident" id="3203115">Parse</span><span class="op" id="3203120">(</span><span class="ident" id="3203121">ref</span>&nbsp;<span class="builtintype" id="3203125">string</span><span class="op" id="3203131">)</span>&nbsp;<span class="op" id="3203133">(</span><span class="op" id="3203134">*</span><span class="ident" id="3203135">URL</span><span class="op" id="3203138">,</span>&nbsp;<span class="builtintype" id="3203140">error</span><span class="op" id="3203145">)</span>&nbsp;<span class="op" id="3203147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203150">refurl</span><span class="op" id="3203156">,</span>&nbsp;<span class="ident" id="3203158">err</span>&nbsp;<span class="op" id="3203162">:=</span>&nbsp;<span class="ident" id="3203165">Parse</span><span class="op" id="3203170">(</span><span class="ident" id="3203171">ref</span><span class="op" id="3203174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203177">if</span>&nbsp;<span class="ident" id="3203180">err</span>&nbsp;<span class="op" id="3203184">!=</span>&nbsp;<span class="ident" id="3203187">nil</span>&nbsp;<span class="op" id="3203191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203195">return</span>&nbsp;<span class="ident" id="3203202">nil</span><span class="op" id="3203205">,</span>&nbsp;<span class="ident" id="3203207">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3203212">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203215">return</span>&nbsp;<span class="ident" id="3203222">u</span><span class="op" id="3203223">.</span><span class="ident" id="3203224">ResolveReference</span><span class="op" id="3203240">(</span><span class="ident" id="3203241">refurl</span><span class="op" id="3203247">)</span><span class="op" id="3203248">,</span>&nbsp;<span class="ident" id="3203250">nil</span><br>
<span class="lineno"></span><span class="op" id="3203254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3203257">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3203326">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3203396">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3203467">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3203536">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3203607">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3203650">func</span>&nbsp;<span class="op" id="3203655">(</span><span class="ident" id="3203656">u</span>&nbsp;<span class="op" id="3203658">*</span><span class="ident" id="3203659">URL</span><span class="op" id="3203662">)</span>&nbsp;<span class="ident" id="3203664">ResolveReference</span><span class="op" id="3203680">(</span><span class="ident" id="3203681">ref</span>&nbsp;<span class="op" id="3203685">*</span><span class="ident" id="3203686">URL</span><span class="op" id="3203689">)</span>&nbsp;<span class="op" id="3203691">*</span><span class="ident" id="3203692">URL</span>&nbsp;<span class="op" id="3203696">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203699">url</span>&nbsp;<span class="op" id="3203703">:=</span>&nbsp;<span class="op" id="3203706">*</span><span class="ident" id="3203707">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203712">if</span>&nbsp;<span class="ident" id="3203715">ref</span><span class="op" id="3203718">.</span><span class="ident" id="3203719">Scheme</span>&nbsp;<span class="op" id="3203726">==</span>&nbsp;<span class="string" id="3203729">&#34;&#34;</span>&nbsp;<span class="op" id="3203732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203736">url</span><span class="op" id="3203739">.</span><span class="ident" id="3203740">Scheme</span>&nbsp;<span class="op" id="3203747">=</span>&nbsp;<span class="ident" id="3203749">u</span><span class="op" id="3203750">.</span><span class="ident" id="3203751">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3203759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203762">if</span>&nbsp;<span class="ident" id="3203765">ref</span><span class="op" id="3203768">.</span><span class="ident" id="3203769">Scheme</span>&nbsp;<span class="op" id="3203776">!=</span>&nbsp;<span class="string" id="3203779">&#34;&#34;</span>&nbsp;<span class="op" id="3203782">||</span>&nbsp;<span class="ident" id="3203785">ref</span><span class="op" id="3203788">.</span><span class="ident" id="3203789">Host</span>&nbsp;<span class="op" id="3203794">!=</span>&nbsp;<span class="string" id="3203797">&#34;&#34;</span>&nbsp;<span class="op" id="3203800">||</span>&nbsp;<span class="ident" id="3203803">ref</span><span class="op" id="3203806">.</span><span class="ident" id="3203807">User</span>&nbsp;<span class="op" id="3203812">!=</span>&nbsp;<span class="ident" id="3203815">nil</span>&nbsp;<span class="op" id="3203819">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3203823">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203867">url</span><span class="op" id="3203870">.</span><span class="ident" id="3203871">Path</span>&nbsp;<span class="op" id="3203876">=</span>&nbsp;<span class="ident" id="3203878">resolvePath</span><span class="op" id="3203889">(</span><span class="ident" id="3203890">ref</span><span class="op" id="3203893">.</span><span class="ident" id="3203894">Path</span><span class="op" id="3203898">,</span>&nbsp;<span class="string" id="3203900">&#34;&#34;</span><span class="op" id="3203902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203906">return</span>&nbsp;<span class="op" id="3203913">&amp;</span><span class="ident" id="3203914">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3203919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203922">if</span>&nbsp;<span class="ident" id="3203925">ref</span><span class="op" id="3203928">.</span><span class="ident" id="3203929">Opaque</span>&nbsp;<span class="op" id="3203936">!=</span>&nbsp;<span class="string" id="3203939">&#34;&#34;</span>&nbsp;<span class="op" id="3203942">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203946">url</span><span class="op" id="3203949">.</span><span class="ident" id="3203950">User</span>&nbsp;<span class="op" id="3203955">=</span>&nbsp;<span class="ident" id="3203957">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203963">url</span><span class="op" id="3203966">.</span><span class="ident" id="3203967">Host</span>&nbsp;<span class="op" id="3203972">=</span>&nbsp;<span class="string" id="3203974">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3203979">url</span><span class="op" id="3203982">.</span><span class="ident" id="3203983">Path</span>&nbsp;<span class="op" id="3203988">=</span>&nbsp;<span class="string" id="3203990">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3203995">return</span>&nbsp;<span class="op" id="3204002">&amp;</span><span class="ident" id="3204003">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204008">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204011">if</span>&nbsp;<span class="ident" id="3204014">ref</span><span class="op" id="3204017">.</span><span class="ident" id="3204018">Path</span>&nbsp;<span class="op" id="3204023">==</span>&nbsp;<span class="string" id="3204026">&#34;&#34;</span>&nbsp;<span class="op" id="3204029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204033">if</span>&nbsp;<span class="ident" id="3204036">ref</span><span class="op" id="3204039">.</span><span class="ident" id="3204040">RawQuery</span>&nbsp;<span class="op" id="3204049">==</span>&nbsp;<span class="string" id="3204052">&#34;&#34;</span>&nbsp;<span class="op" id="3204055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204060">url</span><span class="op" id="3204063">.</span><span class="ident" id="3204064">RawQuery</span>&nbsp;<span class="op" id="3204073">=</span>&nbsp;<span class="ident" id="3204075">u</span><span class="op" id="3204076">.</span><span class="ident" id="3204077">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204089">if</span>&nbsp;<span class="ident" id="3204092">ref</span><span class="op" id="3204095">.</span><span class="ident" id="3204096">Fragment</span>&nbsp;<span class="op" id="3204105">==</span>&nbsp;<span class="string" id="3204108">&#34;&#34;</span>&nbsp;<span class="op" id="3204111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204117">url</span><span class="op" id="3204120">.</span><span class="ident" id="3204121">Fragment</span>&nbsp;<span class="op" id="3204130">=</span>&nbsp;<span class="ident" id="3204132">u</span><span class="op" id="3204133">.</span><span class="ident" id="3204134">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3204156">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204196">url</span><span class="op" id="3204199">.</span><span class="ident" id="3204200">Host</span>&nbsp;<span class="op" id="3204205">=</span>&nbsp;<span class="ident" id="3204207">u</span><span class="op" id="3204208">.</span><span class="ident" id="3204209">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204215">url</span><span class="op" id="3204218">.</span><span class="ident" id="3204219">User</span>&nbsp;<span class="op" id="3204224">=</span>&nbsp;<span class="ident" id="3204226">u</span><span class="op" id="3204227">.</span><span class="ident" id="3204228">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204234">url</span><span class="op" id="3204237">.</span><span class="ident" id="3204238">Path</span>&nbsp;<span class="op" id="3204243">=</span>&nbsp;<span class="ident" id="3204245">resolvePath</span><span class="op" id="3204256">(</span><span class="ident" id="3204257">u</span><span class="op" id="3204258">.</span><span class="ident" id="3204259">Path</span><span class="op" id="3204263">,</span>&nbsp;<span class="ident" id="3204265">ref</span><span class="op" id="3204268">.</span><span class="ident" id="3204269">Path</span><span class="op" id="3204273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204276">return</span>&nbsp;<span class="op" id="3204283">&amp;</span><span class="ident" id="3204284">url</span><br>
<span class="lineno"></span><span class="op" id="3204288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3204291">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3204354">func</span>&nbsp;<span class="op" id="3204359">(</span><span class="ident" id="3204360">u</span>&nbsp;<span class="op" id="3204362">*</span><span class="ident" id="3204363">URL</span><span class="op" id="3204366">)</span>&nbsp;<span class="ident" id="3204368">Query</span><span class="op" id="3204373">(</span><span class="op" id="3204374">)</span>&nbsp;<span class="ident" id="3204376">Values</span>&nbsp;<span class="op" id="3204383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204386">v</span><span class="op" id="3204387">,</span>&nbsp;<span class="ident" id="3204389">_</span>&nbsp;<span class="op" id="3204391">:=</span>&nbsp;<span class="ident" id="3204394">ParseQuery</span><span class="op" id="3204404">(</span><span class="ident" id="3204405">u</span><span class="op" id="3204406">.</span><span class="ident" id="3204407">RawQuery</span><span class="op" id="3204415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204418">return</span>&nbsp;<span class="ident" id="3204425">v</span><br>
<span class="lineno"></span><span class="op" id="3204427">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3204430">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3204491">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3204546">func</span>&nbsp;<span class="op" id="3204551">(</span><span class="ident" id="3204552">u</span>&nbsp;<span class="op" id="3204554">*</span><span class="ident" id="3204555">URL</span><span class="op" id="3204558">)</span>&nbsp;<span class="ident" id="3204560">RequestURI</span><span class="op" id="3204570">(</span><span class="op" id="3204571">)</span>&nbsp;<span class="builtintype" id="3204573">string</span>&nbsp;<span class="op" id="3204580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204583">result</span>&nbsp;<span class="op" id="3204590">:=</span>&nbsp;<span class="ident" id="3204593">u</span><span class="op" id="3204594">.</span><span class="ident" id="3204595">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204603">if</span>&nbsp;<span class="ident" id="3204606">result</span>&nbsp;<span class="op" id="3204613">==</span>&nbsp;<span class="string" id="3204616">&#34;&#34;</span>&nbsp;<span class="op" id="3204619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204623">result</span>&nbsp;<span class="op" id="3204630">=</span>&nbsp;<span class="ident" id="3204632">escape</span><span class="op" id="3204638">(</span><span class="ident" id="3204639">u</span><span class="op" id="3204640">.</span><span class="ident" id="3204641">Path</span><span class="op" id="3204645">,</span>&nbsp;<span class="ident" id="3204647">encodePath</span><span class="op" id="3204657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204661">if</span>&nbsp;<span class="ident" id="3204664">result</span>&nbsp;<span class="op" id="3204671">==</span>&nbsp;<span class="string" id="3204674">&#34;&#34;</span>&nbsp;<span class="op" id="3204677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204682">result</span>&nbsp;<span class="op" id="3204689">=</span>&nbsp;<span class="string" id="3204691">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204697">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204700">}</span>&nbsp;<span class="keyword" id="3204702">else</span>&nbsp;<span class="op" id="3204707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204711">if</span>&nbsp;<span class="ident" id="3204714">strings</span><span class="op" id="3204721">.</span><span class="ident" id="3204722">HasPrefix</span><span class="op" id="3204731">(</span><span class="ident" id="3204732">result</span><span class="op" id="3204738">,</span>&nbsp;<span class="string" id="3204740">&#34;//&#34;</span><span class="op" id="3204744">)</span>&nbsp;<span class="op" id="3204746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204751">result</span>&nbsp;<span class="op" id="3204758">=</span>&nbsp;<span class="ident" id="3204760">u</span><span class="op" id="3204761">.</span><span class="ident" id="3204762">Scheme</span>&nbsp;<span class="op" id="3204769">+</span>&nbsp;<span class="string" id="3204771">&#34;:&#34;</span>&nbsp;<span class="op" id="3204775">+</span>&nbsp;<span class="ident" id="3204777">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204789">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204792">if</span>&nbsp;<span class="ident" id="3204795">u</span><span class="op" id="3204796">.</span><span class="ident" id="3204797">RawQuery</span>&nbsp;<span class="op" id="3204806">!=</span>&nbsp;<span class="string" id="3204809">&#34;&#34;</span>&nbsp;<span class="op" id="3204812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3204816">result</span>&nbsp;<span class="op" id="3204823">+=</span>&nbsp;<span class="string" id="3204826">&#34;?&#34;</span>&nbsp;<span class="op" id="3204830">+</span>&nbsp;<span class="ident" id="3204832">u</span><span class="op" id="3204833">.</span><span class="ident" id="3204834">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3204844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3204847">return</span>&nbsp;<span class="ident" id="3204854">result</span><br>
<span class="lineno"></span><span class="op" id="3204861">}</span>
</div>
</body>
</html>
