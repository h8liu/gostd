<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6254031">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6254086">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6254140">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6254191">package</span>&nbsp;<span class="ident" id="6254199">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6254204">import</span>&nbsp;<span class="op" id="6254211">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6254214">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6254223">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6254229">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6254240">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6254251">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6254266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6254269">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6254319">//</span><br>
<span class="lineno"></span><span class="comment" id="6254322">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6254391">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6254467">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6254547">//</span><br>
<span class="lineno"></span><span class="comment" id="6254550">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6254583">//</span><br>
<span class="lineno"></span><span class="comment" id="6254586">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6254662">type</span>&nbsp;<span class="ident" id="6254667">Writer</span>&nbsp;<span class="keyword" id="6254674">struct</span>&nbsp;<span class="op" id="6254681">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254684">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254692">rune</span>&nbsp;<span class="comment" id="6254697">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254743">UseCRLF</span>&nbsp;<span class="builtintype" id="6254751">bool</span>&nbsp;<span class="comment" id="6254756">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254800">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254808">*</span><span class="ident" id="6254809">bufio</span><span class="op" id="6254814">.</span><span class="ident" id="6254815">Writer</span><br>
<span class="lineno"></span><span class="op" id="6254822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6254825">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6254877">func</span>&nbsp;<span class="ident" id="6254882">NewWriter</span><span class="op" id="6254891">(</span><span class="ident" id="6254892">w</span>&nbsp;<span class="ident" id="6254894">io</span><span class="op" id="6254896">.</span><span class="ident" id="6254897">Writer</span><span class="op" id="6254903">)</span>&nbsp;<span class="op" id="6254905">*</span><span class="ident" id="6254906">Writer</span>&nbsp;<span class="op" id="6254913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6254916">return</span>&nbsp;<span class="op" id="6254923">&amp;</span><span class="ident" id="6254924">Writer</span><span class="op" id="6254930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254934">Comma</span><span class="op" id="6254939">:</span>&nbsp;<span class="string" id="6254941">&#39;,&#39;</span><span class="op" id="6254944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254948">w</span><span class="op" id="6254949">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6254955">bufio</span><span class="op" id="6254960">.</span><span class="ident" id="6254961">NewWriter</span><span class="op" id="6254970">(</span><span class="ident" id="6254971">w</span><span class="op" id="6254972">)</span><span class="op" id="6254973">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254976">}</span><br>
<span class="lineno"></span><span class="op" id="6254978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254981">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6255057">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6255125">func</span>&nbsp;<span class="op" id="6255130">(</span><span class="ident" id="6255131">w</span>&nbsp;<span class="op" id="6255133">*</span><span class="ident" id="6255134">Writer</span><span class="op" id="6255140">)</span>&nbsp;<span class="ident" id="6255142">Write</span><span class="op" id="6255147">(</span><span class="ident" id="6255148">record</span>&nbsp;<span class="op" id="6255155">[</span><span class="op" id="6255156">]</span><span class="builtintype" id="6255157">string</span><span class="op" id="6255163">)</span>&nbsp;<span class="op" id="6255165">(</span><span class="ident" id="6255166">err</span>&nbsp;<span class="builtintype" id="6255170">error</span><span class="op" id="6255175">)</span>&nbsp;<span class="op" id="6255177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255180">for</span>&nbsp;<span class="ident" id="6255184">n</span><span class="op" id="6255185">,</span>&nbsp;<span class="ident" id="6255187">field</span>&nbsp;<span class="op" id="6255193">:=</span>&nbsp;<span class="keyword" id="6255196">range</span>&nbsp;<span class="ident" id="6255202">record</span>&nbsp;<span class="op" id="6255209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255213">if</span>&nbsp;<span class="ident" id="6255216">n</span>&nbsp;<span class="op" id="6255218">&gt;</span>&nbsp;<span class="num" id="6255220">0</span>&nbsp;<span class="op" id="6255222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255227">if</span>&nbsp;<span class="ident" id="6255230">_</span><span class="op" id="6255231">,</span>&nbsp;<span class="ident" id="6255233">err</span>&nbsp;<span class="op" id="6255237">=</span>&nbsp;<span class="ident" id="6255239">w</span><span class="op" id="6255240">.</span><span class="ident" id="6255241">w</span><span class="op" id="6255242">.</span><span class="ident" id="6255243">WriteRune</span><span class="op" id="6255252">(</span><span class="ident" id="6255253">w</span><span class="op" id="6255254">.</span><span class="ident" id="6255255">Comma</span><span class="op" id="6255260">)</span><span class="op" id="6255261">;</span>&nbsp;<span class="ident" id="6255263">err</span>&nbsp;<span class="op" id="6255267">!=</span>&nbsp;<span class="builtintype" id="6255270">nil</span>&nbsp;<span class="op" id="6255274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255280">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6255299">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6255354">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255411">if</span>&nbsp;<span class="op" id="6255414">!</span><span class="ident" id="6255415">w</span><span class="op" id="6255416">.</span><span class="ident" id="6255417">fieldNeedsQuotes</span><span class="op" id="6255433">(</span><span class="ident" id="6255434">field</span><span class="op" id="6255439">)</span>&nbsp;<span class="op" id="6255441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255446">if</span>&nbsp;<span class="ident" id="6255449">_</span><span class="op" id="6255450">,</span>&nbsp;<span class="ident" id="6255452">err</span>&nbsp;<span class="op" id="6255456">=</span>&nbsp;<span class="ident" id="6255458">w</span><span class="op" id="6255459">.</span><span class="ident" id="6255460">w</span><span class="op" id="6255461">.</span><span class="ident" id="6255462">WriteString</span><span class="op" id="6255473">(</span><span class="ident" id="6255474">field</span><span class="op" id="6255479">)</span><span class="op" id="6255480">;</span>&nbsp;<span class="ident" id="6255482">err</span>&nbsp;<span class="op" id="6255486">!=</span>&nbsp;<span class="builtintype" id="6255489">nil</span>&nbsp;<span class="op" id="6255493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255499">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255514">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255529">if</span>&nbsp;<span class="ident" id="6255532">err</span>&nbsp;<span class="op" id="6255536">=</span>&nbsp;<span class="ident" id="6255538">w</span><span class="op" id="6255539">.</span><span class="ident" id="6255540">w</span><span class="op" id="6255541">.</span><span class="ident" id="6255542">WriteByte</span><span class="op" id="6255551">(</span><span class="string" id="6255552">&#39;&#34;&#39;</span><span class="op" id="6255555">)</span><span class="op" id="6255556">;</span>&nbsp;<span class="ident" id="6255558">err</span>&nbsp;<span class="op" id="6255562">!=</span>&nbsp;<span class="builtintype" id="6255565">nil</span>&nbsp;<span class="op" id="6255569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255574">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255588">for</span>&nbsp;<span class="ident" id="6255592">_</span><span class="op" id="6255593">,</span>&nbsp;<span class="ident" id="6255595">r1</span>&nbsp;<span class="op" id="6255598">:=</span>&nbsp;<span class="keyword" id="6255601">range</span>&nbsp;<span class="ident" id="6255607">field</span>&nbsp;<span class="op" id="6255613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255618">switch</span>&nbsp;<span class="ident" id="6255625">r1</span>&nbsp;<span class="op" id="6255628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255633">case</span>&nbsp;<span class="string" id="6255638">&#39;&#34;&#39;</span><span class="op" id="6255641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255647">_</span><span class="op" id="6255648">,</span>&nbsp;<span class="ident" id="6255650">err</span>&nbsp;<span class="op" id="6255654">=</span>&nbsp;<span class="ident" id="6255656">w</span><span class="op" id="6255657">.</span><span class="ident" id="6255658">w</span><span class="op" id="6255659">.</span><span class="ident" id="6255660">WriteString</span><span class="op" id="6255671">(</span><span class="string" id="6255672">`&#34;&#34;`</span><span class="op" id="6255676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255681">case</span>&nbsp;<span class="string" id="6255686">&#39;\r&#39;</span><span class="op" id="6255690">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255696">if</span>&nbsp;<span class="op" id="6255699">!</span><span class="ident" id="6255700">w</span><span class="op" id="6255701">.</span><span class="ident" id="6255702">UseCRLF</span>&nbsp;<span class="op" id="6255710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255717">err</span>&nbsp;<span class="op" id="6255721">=</span>&nbsp;<span class="ident" id="6255723">w</span><span class="op" id="6255724">.</span><span class="ident" id="6255725">w</span><span class="op" id="6255726">.</span><span class="ident" id="6255727">WriteByte</span><span class="op" id="6255736">(</span><span class="string" id="6255737">&#39;\r&#39;</span><span class="op" id="6255741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255752">case</span>&nbsp;<span class="string" id="6255757">&#39;\n&#39;</span><span class="op" id="6255761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255767">if</span>&nbsp;<span class="ident" id="6255770">w</span><span class="op" id="6255771">.</span><span class="ident" id="6255772">UseCRLF</span>&nbsp;<span class="op" id="6255780">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255787">_</span><span class="op" id="6255788">,</span>&nbsp;<span class="ident" id="6255790">err</span>&nbsp;<span class="op" id="6255794">=</span>&nbsp;<span class="ident" id="6255796">w</span><span class="op" id="6255797">.</span><span class="ident" id="6255798">w</span><span class="op" id="6255799">.</span><span class="ident" id="6255800">WriteString</span><span class="op" id="6255811">(</span><span class="string" id="6255812">&#34;\r\n&#34;</span><span class="op" id="6255818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255824">}</span>&nbsp;<span class="keyword" id="6255826">else</span>&nbsp;<span class="op" id="6255831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255838">err</span>&nbsp;<span class="op" id="6255842">=</span>&nbsp;<span class="ident" id="6255844">w</span><span class="op" id="6255845">.</span><span class="ident" id="6255846">w</span><span class="op" id="6255847">.</span><span class="ident" id="6255848">WriteByte</span><span class="op" id="6255857">(</span><span class="string" id="6255858">&#39;\n&#39;</span><span class="op" id="6255862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255873">default</span><span class="op" id="6255880">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255886">_</span><span class="op" id="6255887">,</span>&nbsp;<span class="ident" id="6255889">err</span>&nbsp;<span class="op" id="6255893">=</span>&nbsp;<span class="ident" id="6255895">w</span><span class="op" id="6255896">.</span><span class="ident" id="6255897">w</span><span class="op" id="6255898">.</span><span class="ident" id="6255899">WriteRune</span><span class="op" id="6255908">(</span><span class="ident" id="6255909">r1</span><span class="op" id="6255911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255921">if</span>&nbsp;<span class="ident" id="6255924">err</span>&nbsp;<span class="op" id="6255928">!=</span>&nbsp;<span class="builtintype" id="6255931">nil</span>&nbsp;<span class="op" id="6255935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255951">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6255955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6255960">if</span>&nbsp;<span class="ident" id="6255963">err</span>&nbsp;<span class="op" id="6255967">=</span>&nbsp;<span class="ident" id="6255969">w</span><span class="op" id="6255970">.</span><span class="ident" id="6255971">w</span><span class="op" id="6255972">.</span><span class="ident" id="6255973">WriteByte</span><span class="op" id="6255982">(</span><span class="string" id="6255983">&#39;&#34;&#39;</span><span class="op" id="6255986">)</span><span class="op" id="6255987">;</span>&nbsp;<span class="ident" id="6255989">err</span>&nbsp;<span class="op" id="6255993">!=</span>&nbsp;<span class="builtintype" id="6255996">nil</span>&nbsp;<span class="op" id="6256000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256005">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256014">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256020">if</span>&nbsp;<span class="ident" id="6256023">w</span><span class="op" id="6256024">.</span><span class="ident" id="6256025">UseCRLF</span>&nbsp;<span class="op" id="6256033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256037">_</span><span class="op" id="6256038">,</span>&nbsp;<span class="ident" id="6256040">err</span>&nbsp;<span class="op" id="6256044">=</span>&nbsp;<span class="ident" id="6256046">w</span><span class="op" id="6256047">.</span><span class="ident" id="6256048">w</span><span class="op" id="6256049">.</span><span class="ident" id="6256050">WriteString</span><span class="op" id="6256061">(</span><span class="string" id="6256062">&#34;\r\n&#34;</span><span class="op" id="6256068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256071">}</span>&nbsp;<span class="keyword" id="6256073">else</span>&nbsp;<span class="op" id="6256078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256082">err</span>&nbsp;<span class="op" id="6256086">=</span>&nbsp;<span class="ident" id="6256088">w</span><span class="op" id="6256089">.</span><span class="ident" id="6256090">w</span><span class="op" id="6256091">.</span><span class="ident" id="6256092">WriteByte</span><span class="op" id="6256101">(</span><span class="string" id="6256102">&#39;\n&#39;</span><span class="op" id="6256106">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256112">return</span><br>
<span class="lineno"></span><span class="op" id="6256119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6256122">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6256185">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6256248">func</span>&nbsp;<span class="op" id="6256253">(</span><span class="ident" id="6256254">w</span>&nbsp;<span class="op" id="6256256">*</span><span class="ident" id="6256257">Writer</span><span class="op" id="6256263">)</span>&nbsp;<span class="ident" id="6256265">Flush</span><span class="op" id="6256270">(</span><span class="op" id="6256271">)</span>&nbsp;<span class="op" id="6256273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256276">w</span><span class="op" id="6256277">.</span><span class="ident" id="6256278">w</span><span class="op" id="6256279">.</span><span class="ident" id="6256280">Flush</span><span class="op" id="6256285">(</span><span class="op" id="6256286">)</span><br>
<span class="lineno"></span><span class="op" id="6256288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6256291">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6256370">func</span>&nbsp;<span class="op" id="6256375">(</span><span class="ident" id="6256376">w</span>&nbsp;<span class="op" id="6256378">*</span><span class="ident" id="6256379">Writer</span><span class="op" id="6256385">)</span>&nbsp;<span class="ident" id="6256387">Error</span><span class="op" id="6256392">(</span><span class="op" id="6256393">)</span>&nbsp;<span class="builtintype" id="6256395">error</span>&nbsp;<span class="op" id="6256401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256404">_</span><span class="op" id="6256405">,</span>&nbsp;<span class="ident" id="6256407">err</span>&nbsp;<span class="op" id="6256411">:=</span>&nbsp;<span class="ident" id="6256414">w</span><span class="op" id="6256415">.</span><span class="ident" id="6256416">w</span><span class="op" id="6256417">.</span><span class="ident" id="6256418">Write</span><span class="op" id="6256423">(</span><span class="builtintype" id="6256424">nil</span><span class="op" id="6256427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256430">return</span>&nbsp;<span class="ident" id="6256437">err</span><br>
<span class="lineno"></span><span class="op" id="6256441">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6256444">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6256523">func</span>&nbsp;<span class="op" id="6256528">(</span><span class="ident" id="6256529">w</span>&nbsp;<span class="op" id="6256531">*</span><span class="ident" id="6256532">Writer</span><span class="op" id="6256538">)</span>&nbsp;<span class="ident" id="6256540">WriteAll</span><span class="op" id="6256548">(</span><span class="ident" id="6256549">records</span>&nbsp;<span class="op" id="6256557">[</span><span class="op" id="6256558">]</span><span class="op" id="6256559">[</span><span class="op" id="6256560">]</span><span class="builtintype" id="6256561">string</span><span class="op" id="6256567">)</span>&nbsp;<span class="op" id="6256569">(</span><span class="ident" id="6256570">err</span>&nbsp;<span class="builtintype" id="6256574">error</span><span class="op" id="6256579">)</span>&nbsp;<span class="op" id="6256581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256584">for</span>&nbsp;<span class="ident" id="6256588">_</span><span class="op" id="6256589">,</span>&nbsp;<span class="ident" id="6256591">record</span>&nbsp;<span class="op" id="6256598">:=</span>&nbsp;<span class="keyword" id="6256601">range</span>&nbsp;<span class="ident" id="6256607">records</span>&nbsp;<span class="op" id="6256615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256619">err</span>&nbsp;<span class="op" id="6256623">=</span>&nbsp;<span class="ident" id="6256625">w</span><span class="op" id="6256626">.</span><span class="ident" id="6256627">Write</span><span class="op" id="6256632">(</span><span class="ident" id="6256633">record</span><span class="op" id="6256639">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256643">if</span>&nbsp;<span class="ident" id="6256646">err</span>&nbsp;<span class="op" id="6256650">!=</span>&nbsp;<span class="builtintype" id="6256653">nil</span>&nbsp;<span class="op" id="6256657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256662">return</span>&nbsp;<span class="ident" id="6256669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6256678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6256681">return</span>&nbsp;<span class="ident" id="6256688">w</span><span class="op" id="6256689">.</span><span class="ident" id="6256690">w</span><span class="op" id="6256691">.</span><span class="ident" id="6256692">Flush</span><span class="op" id="6256697">(</span><span class="op" id="6256698">)</span><br>
<span class="lineno">115</span><span class="op" id="6256700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6256703">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6256777">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6256837">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6256900">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6256973">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6257049">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6257122">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6257194">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6257263">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6257318">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6257393">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6257433">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6257488">func</span>&nbsp;<span class="op" id="6257493">(</span><span class="ident" id="6257494">w</span>&nbsp;<span class="op" id="6257496">*</span><span class="ident" id="6257497">Writer</span><span class="op" id="6257503">)</span>&nbsp;<span class="ident" id="6257505">fieldNeedsQuotes</span><span class="op" id="6257521">(</span><span class="ident" id="6257522">field</span>&nbsp;<span class="builtintype" id="6257528">string</span><span class="op" id="6257534">)</span>&nbsp;<span class="builtintype" id="6257536">bool</span>&nbsp;<span class="op" id="6257541">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6257544">if</span>&nbsp;<span class="ident" id="6257547">field</span>&nbsp;<span class="op" id="6257553">==</span>&nbsp;<span class="string" id="6257556">&#34;&#34;</span>&nbsp;<span class="op" id="6257559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6257563">return</span>&nbsp;<span class="builtintype" id="6257570">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6257577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6257580">if</span>&nbsp;<span class="ident" id="6257583">field</span>&nbsp;<span class="op" id="6257589">==</span>&nbsp;<span class="string" id="6257592">`\.`</span>&nbsp;<span class="op" id="6257597">||</span>&nbsp;<span class="ident" id="6257600">strings</span><span class="op" id="6257607">.</span><span class="ident" id="6257608">IndexRune</span><span class="op" id="6257617">(</span><span class="ident" id="6257618">field</span><span class="op" id="6257623">,</span>&nbsp;<span class="ident" id="6257625">w</span><span class="op" id="6257626">.</span><span class="ident" id="6257627">Comma</span><span class="op" id="6257632">)</span>&nbsp;<span class="op" id="6257634">&gt;=</span>&nbsp;<span class="num" id="6257637">0</span>&nbsp;<span class="op" id="6257639">||</span>&nbsp;<span class="ident" id="6257642">strings</span><span class="op" id="6257649">.</span><span class="ident" id="6257650">IndexAny</span><span class="op" id="6257658">(</span><span class="ident" id="6257659">field</span><span class="op" id="6257664">,</span>&nbsp;<span class="string" id="6257666">&#34;\&#34;\r\n&#34;</span><span class="op" id="6257674">)</span>&nbsp;<span class="op" id="6257676">&gt;=</span>&nbsp;<span class="num" id="6257679">0</span>&nbsp;<span class="op" id="6257681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6257685">return</span>&nbsp;<span class="builtintype" id="6257692">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6257698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6257702">r1</span><span class="op" id="6257704">,</span>&nbsp;<span class="ident" id="6257706">_</span>&nbsp;<span class="op" id="6257708">:=</span>&nbsp;<span class="ident" id="6257711">utf8</span><span class="op" id="6257715">.</span><span class="ident" id="6257716">DecodeRuneInString</span><span class="op" id="6257734">(</span><span class="ident" id="6257735">field</span><span class="op" id="6257740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6257743">return</span>&nbsp;<span class="ident" id="6257750">unicode</span><span class="op" id="6257757">.</span><span class="ident" id="6257758">IsSpace</span><span class="op" id="6257765">(</span><span class="ident" id="6257766">r1</span><span class="op" id="6257768">)</span><br>
<span class="lineno"></span><span class="op" id="6257770">}</span>
</div>
</body>
</html>
