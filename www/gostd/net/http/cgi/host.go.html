<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html" class="current">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5636255">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5636310">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5636364">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5636415">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5636481">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5636502">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5636572">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5636588">//</span><br>
<span class="lineno"></span><span class="comment" id="5636591">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5636658">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5636717">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5636781">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5636821">package</span>&nbsp;<span class="ident" id="5636829">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636834">import</span>&nbsp;<span class="op" id="5636841">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636844">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636853">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636860">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636866">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636873">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636885">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636891">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636902">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636919">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636929">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636940">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5636951">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5636961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636964">var</span>&nbsp;<span class="ident" id="5636968">trailingPort</span>&nbsp;<span class="op" id="5636981">=</span>&nbsp;<span class="ident" id="5636983">regexp</span><span class="op" id="5636989">.</span><span class="ident" id="5636990">MustCompile</span><span class="op" id="5637001">(</span><span class="string" id="5637002">`:([0-9]+)$`</span><span class="op" id="5637014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5637017">var</span>&nbsp;<span class="ident" id="5637021">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5637041">=</span>&nbsp;<span class="keyword" id="5637043">map</span><span class="op" id="5637046">[</span><span class="builtintype" id="5637047">string</span><span class="op" id="5637053">]</span><span class="op" id="5637054">[</span><span class="op" id="5637055">]</span><span class="builtintype" id="5637056">string</span><span class="op" id="5637062">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637065">&#34;darwin&#34;</span><span class="op" id="5637073">:</span>&nbsp;&nbsp;<span class="op" id="5637076">{</span><span class="string" id="5637077">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5637096">}</span><span class="op" id="5637097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637100">&#34;freebsd&#34;</span><span class="op" id="5637109">:</span>&nbsp;<span class="op" id="5637111">{</span><span class="string" id="5637112">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637129">}</span><span class="op" id="5637130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637133">&#34;hpux&#34;</span><span class="op" id="5637139">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637144">{</span><span class="string" id="5637145">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637162">,</span>&nbsp;<span class="string" id="5637164">&#34;SHLIB_PATH&#34;</span><span class="op" id="5637176">}</span><span class="op" id="5637177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637180">&#34;irix&#34;</span><span class="op" id="5637186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637191">{</span><span class="string" id="5637192">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637209">,</span>&nbsp;<span class="string" id="5637211">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5637231">,</span>&nbsp;<span class="string" id="5637233">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5637252">}</span><span class="op" id="5637253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637256">&#34;linux&#34;</span><span class="op" id="5637263">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5637267">{</span><span class="string" id="5637268">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637285">}</span><span class="op" id="5637286">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637289">&#34;openbsd&#34;</span><span class="op" id="5637298">:</span>&nbsp;<span class="op" id="5637300">{</span><span class="string" id="5637301">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637318">}</span><span class="op" id="5637319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637322">&#34;solaris&#34;</span><span class="op" id="5637331">:</span>&nbsp;<span class="op" id="5637333">{</span><span class="string" id="5637334">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5637351">,</span>&nbsp;<span class="string" id="5637353">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5637373">,</span>&nbsp;<span class="string" id="5637375">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5637395">}</span><span class="op" id="5637396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5637399">&#34;windows&#34;</span><span class="op" id="5637408">:</span>&nbsp;<span class="op" id="5637410">{</span><span class="string" id="5637411">&#34;SystemRoot&#34;</span><span class="op" id="5637423">,</span>&nbsp;<span class="string" id="5637425">&#34;COMSPEC&#34;</span><span class="op" id="5637434">,</span>&nbsp;<span class="string" id="5637436">&#34;PATHEXT&#34;</span><span class="op" id="5637445">,</span>&nbsp;<span class="string" id="5637447">&#34;WINDIR&#34;</span><span class="op" id="5637455">}</span><span class="op" id="5637456">,</span><br>
<span class="lineno"></span><span class="op" id="5637458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5637461">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5637531">type</span>&nbsp;<span class="ident" id="5637536">Handler</span>&nbsp;<span class="keyword" id="5637544">struct</span>&nbsp;<span class="op" id="5637551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637554">Path</span>&nbsp;<span class="builtintype" id="5637559">string</span>&nbsp;<span class="comment" id="5637566">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637597">Root</span>&nbsp;<span class="builtintype" id="5637602">string</span>&nbsp;<span class="comment" id="5637609">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637658">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637716">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637773">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637828">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637851">Dir</span>&nbsp;<span class="builtintype" id="5637855">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637864">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637875">[</span><span class="op" id="5637876">]</span><span class="builtintype" id="5637877">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5637887">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637950">InheritEnv</span>&nbsp;<span class="op" id="5637961">[</span><span class="op" id="5637962">]</span><span class="builtintype" id="5637963">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5637973">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638030">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638041">*</span><span class="ident" id="5638042">log</span><span class="op" id="5638045">.</span><span class="ident" id="5638046">Logger</span>&nbsp;<span class="comment" id="5638053">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638105">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638116">[</span><span class="op" id="5638117">]</span><span class="builtintype" id="5638118">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5638128">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638177">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638238">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638296">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638356">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;§&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638412">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638438">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638442">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638507">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638561">PathLocationHandler</span>&nbsp;<span class="ident" id="5638581">http</span><span class="op" id="5638585">.</span><span class="ident" id="5638586">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5638594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5638597">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5638666">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5638723">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5638742">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5638754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5638804">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5638812">func</span>&nbsp;<span class="ident" id="5638817">removeLeadingDuplicates</span><span class="op" id="5638840">(</span><span class="ident" id="5638841">env</span>&nbsp;<span class="op" id="5638845">[</span><span class="op" id="5638846">]</span><span class="builtintype" id="5638847">string</span><span class="op" id="5638853">)</span>&nbsp;<span class="op" id="5638855">(</span><span class="ident" id="5638856">ret</span>&nbsp;<span class="op" id="5638860">[</span><span class="op" id="5638861">]</span><span class="builtintype" id="5638862">string</span><span class="op" id="5638868">)</span>&nbsp;<span class="op" id="5638870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638873">n</span>&nbsp;<span class="op" id="5638875">:=</span>&nbsp;<span class="builtinfunc" id="5638878">len</span><span class="op" id="5638881">(</span><span class="ident" id="5638882">env</span><span class="op" id="5638885">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638888">for</span>&nbsp;<span class="ident" id="5638892">i</span>&nbsp;<span class="op" id="5638894">:=</span>&nbsp;<span class="num" id="5638897">0</span><span class="op" id="5638898">;</span>&nbsp;<span class="ident" id="5638900">i</span>&nbsp;<span class="op" id="5638902">&lt;</span>&nbsp;<span class="ident" id="5638904">n</span><span class="op" id="5638905">;</span>&nbsp;<span class="ident" id="5638907">i</span><span class="op" id="5638908">++</span>&nbsp;<span class="op" id="5638911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638915">e</span>&nbsp;<span class="op" id="5638917">:=</span>&nbsp;<span class="ident" id="5638920">env</span><span class="op" id="5638923">[</span><span class="ident" id="5638924">i</span><span class="op" id="5638925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638929">s</span>&nbsp;<span class="op" id="5638931">:=</span>&nbsp;<span class="ident" id="5638934">strings</span><span class="op" id="5638941">.</span><span class="ident" id="5638942">SplitN</span><span class="op" id="5638948">(</span><span class="ident" id="5638949">e</span><span class="op" id="5638950">,</span>&nbsp;<span class="string" id="5638952">&#34;=&#34;</span><span class="op" id="5638955">,</span>&nbsp;<span class="num" id="5638957">2</span><span class="op" id="5638958">)</span><span class="op" id="5638959">[</span><span class="num" id="5638960">0</span><span class="op" id="5638961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638965">found</span>&nbsp;<span class="op" id="5638971">:=</span>&nbsp;<span class="builtintype" id="5638974">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638982">for</span>&nbsp;<span class="ident" id="5638986">j</span>&nbsp;<span class="op" id="5638988">:=</span>&nbsp;<span class="ident" id="5638991">i</span>&nbsp;<span class="op" id="5638993">+</span>&nbsp;<span class="num" id="5638995">1</span><span class="op" id="5638996">;</span>&nbsp;<span class="ident" id="5638998">j</span>&nbsp;<span class="op" id="5639000">&lt;</span>&nbsp;<span class="ident" id="5639002">n</span><span class="op" id="5639003">;</span>&nbsp;<span class="ident" id="5639005">j</span><span class="op" id="5639006">++</span>&nbsp;<span class="op" id="5639009">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639014">if</span>&nbsp;<span class="ident" id="5639017">s</span>&nbsp;<span class="op" id="5639019">==</span>&nbsp;<span class="ident" id="5639022">strings</span><span class="op" id="5639029">.</span><span class="ident" id="5639030">SplitN</span><span class="op" id="5639036">(</span><span class="ident" id="5639037">env</span><span class="op" id="5639040">[</span><span class="ident" id="5639041">j</span><span class="op" id="5639042">]</span><span class="op" id="5639043">,</span>&nbsp;<span class="string" id="5639045">&#34;=&#34;</span><span class="op" id="5639048">,</span>&nbsp;<span class="num" id="5639050">2</span><span class="op" id="5639051">)</span><span class="op" id="5639052">[</span><span class="num" id="5639053">0</span><span class="op" id="5639054">]</span>&nbsp;<span class="op" id="5639056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639062">found</span>&nbsp;<span class="op" id="5639068">=</span>&nbsp;<span class="builtintype" id="5639070">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639079">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639092">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639096">if</span>&nbsp;<span class="op" id="5639099">!</span><span class="ident" id="5639100">found</span>&nbsp;<span class="op" id="5639106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639111">ret</span>&nbsp;<span class="op" id="5639115">=</span>&nbsp;<span class="builtinfunc" id="5639117">append</span><span class="op" id="5639123">(</span><span class="ident" id="5639124">ret</span><span class="op" id="5639127">,</span>&nbsp;<span class="ident" id="5639129">e</span><span class="op" id="5639130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639140">return</span><br>
<span class="lineno">95</span><span class="op" id="5639147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5639150">func</span>&nbsp;<span class="op" id="5639155">(</span><span class="ident" id="5639156">h</span>&nbsp;<span class="op" id="5639158">*</span><span class="ident" id="5639159">Handler</span><span class="op" id="5639166">)</span>&nbsp;<span class="ident" id="5639168">ServeHTTP</span><span class="op" id="5639177">(</span><span class="ident" id="5639178">rw</span>&nbsp;<span class="ident" id="5639181">http</span><span class="op" id="5639185">.</span><span class="ident" id="5639186">ResponseWriter</span><span class="op" id="5639200">,</span>&nbsp;<span class="ident" id="5639202">req</span>&nbsp;<span class="op" id="5639206">*</span><span class="ident" id="5639207">http</span><span class="op" id="5639211">.</span><span class="ident" id="5639212">Request</span><span class="op" id="5639219">)</span>&nbsp;<span class="op" id="5639221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639224">root</span>&nbsp;<span class="op" id="5639229">:=</span>&nbsp;<span class="ident" id="5639232">h</span><span class="op" id="5639233">.</span><span class="ident" id="5639234">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639240">if</span>&nbsp;<span class="ident" id="5639243">root</span>&nbsp;<span class="op" id="5639248">==</span>&nbsp;<span class="string" id="5639251">&#34;&#34;</span>&nbsp;<span class="op" id="5639254">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639258">root</span>&nbsp;<span class="op" id="5639263">=</span>&nbsp;<span class="string" id="5639265">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639274">if</span>&nbsp;<span class="builtinfunc" id="5639277">len</span><span class="op" id="5639280">(</span><span class="ident" id="5639281">req</span><span class="op" id="5639284">.</span><span class="ident" id="5639285">TransferEncoding</span><span class="op" id="5639301">)</span>&nbsp;<span class="op" id="5639303">&gt;</span>&nbsp;<span class="num" id="5639305">0</span>&nbsp;<span class="op" id="5639307">&amp;&amp;</span>&nbsp;<span class="ident" id="5639310">req</span><span class="op" id="5639313">.</span><span class="ident" id="5639314">TransferEncoding</span><span class="op" id="5639330">[</span><span class="num" id="5639331">0</span><span class="op" id="5639332">]</span>&nbsp;<span class="op" id="5639334">==</span>&nbsp;<span class="string" id="5639337">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5639347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639351">rw</span><span class="op" id="5639353">.</span><span class="ident" id="5639354">WriteHeader</span><span class="op" id="5639365">(</span><span class="ident" id="5639366">http</span><span class="op" id="5639370">.</span><span class="ident" id="5639371">StatusBadRequest</span><span class="op" id="5639387">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639391">rw</span><span class="op" id="5639393">.</span><span class="ident" id="5639394">Write</span><span class="op" id="5639399">(</span><span class="op" id="5639400">[</span><span class="op" id="5639401">]</span><span class="builtintype" id="5639402">byte</span><span class="op" id="5639406">(</span><span class="string" id="5639407">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5639457">)</span><span class="op" id="5639458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639462">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639474">pathInfo</span>&nbsp;<span class="op" id="5639483">:=</span>&nbsp;<span class="ident" id="5639486">req</span><span class="op" id="5639489">.</span><span class="ident" id="5639490">URL</span><span class="op" id="5639493">.</span><span class="ident" id="5639494">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639500">if</span>&nbsp;<span class="ident" id="5639503">root</span>&nbsp;<span class="op" id="5639508">!=</span>&nbsp;<span class="string" id="5639511">&#34;/&#34;</span>&nbsp;<span class="op" id="5639515">&amp;&amp;</span>&nbsp;<span class="ident" id="5639518">strings</span><span class="op" id="5639525">.</span><span class="ident" id="5639526">HasPrefix</span><span class="op" id="5639535">(</span><span class="ident" id="5639536">pathInfo</span><span class="op" id="5639544">,</span>&nbsp;<span class="ident" id="5639546">root</span><span class="op" id="5639550">)</span>&nbsp;<span class="op" id="5639552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639556">pathInfo</span>&nbsp;<span class="op" id="5639565">=</span>&nbsp;<span class="ident" id="5639567">pathInfo</span><span class="op" id="5639575">[</span><span class="builtinfunc" id="5639576">len</span><span class="op" id="5639579">(</span><span class="ident" id="5639580">root</span><span class="op" id="5639584">)</span><span class="op" id="5639585">:</span><span class="op" id="5639586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639593">port</span>&nbsp;<span class="op" id="5639598">:=</span>&nbsp;<span class="string" id="5639601">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639607">if</span>&nbsp;<span class="ident" id="5639610">matches</span>&nbsp;<span class="op" id="5639618">:=</span>&nbsp;<span class="ident" id="5639621">trailingPort</span><span class="op" id="5639633">.</span><span class="ident" id="5639634">FindStringSubmatch</span><span class="op" id="5639652">(</span><span class="ident" id="5639653">req</span><span class="op" id="5639656">.</span><span class="ident" id="5639657">Host</span><span class="op" id="5639661">)</span><span class="op" id="5639662">;</span>&nbsp;<span class="builtinfunc" id="5639664">len</span><span class="op" id="5639667">(</span><span class="ident" id="5639668">matches</span><span class="op" id="5639675">)</span>&nbsp;<span class="op" id="5639677">!=</span>&nbsp;<span class="num" id="5639680">0</span>&nbsp;<span class="op" id="5639682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639686">port</span>&nbsp;<span class="op" id="5639691">=</span>&nbsp;<span class="ident" id="5639693">matches</span><span class="op" id="5639700">[</span><span class="num" id="5639701">1</span><span class="op" id="5639702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639709">env</span>&nbsp;<span class="op" id="5639713">:=</span>&nbsp;<span class="op" id="5639716">[</span><span class="op" id="5639717">]</span><span class="builtintype" id="5639718">string</span><span class="op" id="5639724">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639728">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5639748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639752">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5639767">+</span>&nbsp;<span class="ident" id="5639769">req</span><span class="op" id="5639772">.</span><span class="ident" id="5639773">Host</span><span class="op" id="5639777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639781">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5639807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639811">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5639824">+</span>&nbsp;<span class="ident" id="5639826">req</span><span class="op" id="5639829">.</span><span class="ident" id="5639830">Host</span><span class="op" id="5639834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639838">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5639865">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639869">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5639887">+</span>&nbsp;<span class="ident" id="5639889">req</span><span class="op" id="5639892">.</span><span class="ident" id="5639893">Method</span><span class="op" id="5639899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639903">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5639919">+</span>&nbsp;<span class="ident" id="5639921">req</span><span class="op" id="5639924">.</span><span class="ident" id="5639925">URL</span><span class="op" id="5639928">.</span><span class="ident" id="5639929">RawQuery</span><span class="op" id="5639937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639941">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5639956">+</span>&nbsp;<span class="ident" id="5639958">req</span><span class="op" id="5639961">.</span><span class="ident" id="5639962">URL</span><span class="op" id="5639965">.</span><span class="ident" id="5639966">RequestURI</span><span class="op" id="5639976">(</span><span class="op" id="5639977">)</span><span class="op" id="5639978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5639982">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5639995">+</span>&nbsp;<span class="ident" id="5639997">pathInfo</span><span class="op" id="5640005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640009">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5640024">+</span>&nbsp;<span class="ident" id="5640026">root</span><span class="op" id="5640030">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640034">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5640053">+</span>&nbsp;<span class="ident" id="5640055">h</span><span class="op" id="5640056">.</span><span class="ident" id="5640057">Path</span><span class="op" id="5640061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640065">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5640080">+</span>&nbsp;<span class="ident" id="5640082">req</span><span class="op" id="5640085">.</span><span class="ident" id="5640086">RemoteAddr</span><span class="op" id="5640096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640100">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5640115">+</span>&nbsp;<span class="ident" id="5640117">req</span><span class="op" id="5640120">.</span><span class="ident" id="5640121">RemoteAddr</span><span class="op" id="5640131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640135">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5640150">+</span>&nbsp;<span class="ident" id="5640152">port</span><span class="op" id="5640156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640159">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640163">if</span>&nbsp;<span class="ident" id="5640166">req</span><span class="op" id="5640169">.</span><span class="ident" id="5640170">TLS</span>&nbsp;<span class="op" id="5640174">!=</span>&nbsp;<span class="ident" id="5640177">nil</span>&nbsp;<span class="op" id="5640181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640185">env</span>&nbsp;<span class="op" id="5640189">=</span>&nbsp;<span class="builtinfunc" id="5640191">append</span><span class="op" id="5640197">(</span><span class="ident" id="5640198">env</span><span class="op" id="5640201">,</span>&nbsp;<span class="string" id="5640203">&#34;HTTPS=on&#34;</span><span class="op" id="5640213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640220">for</span>&nbsp;<span class="ident" id="5640224">k</span><span class="op" id="5640225">,</span>&nbsp;<span class="ident" id="5640227">v</span>&nbsp;<span class="op" id="5640229">:=</span>&nbsp;<span class="keyword" id="5640232">range</span>&nbsp;<span class="ident" id="5640238">req</span><span class="op" id="5640241">.</span><span class="ident" id="5640242">Header</span>&nbsp;<span class="op" id="5640249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640253">k</span>&nbsp;<span class="op" id="5640255">=</span>&nbsp;<span class="ident" id="5640257">strings</span><span class="op" id="5640264">.</span><span class="ident" id="5640265">Map</span><span class="op" id="5640268">(</span><span class="ident" id="5640269">upperCaseAndUnderscore</span><span class="op" id="5640291">,</span>&nbsp;<span class="ident" id="5640293">k</span><span class="op" id="5640294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640298">joinStr</span>&nbsp;<span class="op" id="5640306">:=</span>&nbsp;<span class="string" id="5640309">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640316">if</span>&nbsp;<span class="ident" id="5640319">k</span>&nbsp;<span class="op" id="5640321">==</span>&nbsp;<span class="string" id="5640324">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5640333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640338">joinStr</span>&nbsp;<span class="op" id="5640346">=</span>&nbsp;<span class="string" id="5640348">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640359">env</span>&nbsp;<span class="op" id="5640363">=</span>&nbsp;<span class="builtinfunc" id="5640365">append</span><span class="op" id="5640371">(</span><span class="ident" id="5640372">env</span><span class="op" id="5640375">,</span>&nbsp;<span class="string" id="5640377">&#34;HTTP_&#34;</span><span class="op" id="5640384">+</span><span class="ident" id="5640385">k</span><span class="op" id="5640386">+</span><span class="string" id="5640387">&#34;=&#34;</span><span class="op" id="5640390">+</span><span class="ident" id="5640391">strings</span><span class="op" id="5640398">.</span><span class="ident" id="5640399">Join</span><span class="op" id="5640403">(</span><span class="ident" id="5640404">v</span><span class="op" id="5640405">,</span>&nbsp;<span class="ident" id="5640407">joinStr</span><span class="op" id="5640414">)</span><span class="op" id="5640415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640422">if</span>&nbsp;<span class="ident" id="5640425">req</span><span class="op" id="5640428">.</span><span class="ident" id="5640429">ContentLength</span>&nbsp;<span class="op" id="5640443">&gt;</span>&nbsp;<span class="num" id="5640445">0</span>&nbsp;<span class="op" id="5640447">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640451">env</span>&nbsp;<span class="op" id="5640455">=</span>&nbsp;<span class="builtinfunc" id="5640457">append</span><span class="op" id="5640463">(</span><span class="ident" id="5640464">env</span><span class="op" id="5640467">,</span>&nbsp;<span class="ident" id="5640469">fmt</span><span class="op" id="5640472">.</span><span class="ident" id="5640473">Sprintf</span><span class="op" id="5640480">(</span><span class="string" id="5640481">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5640500">,</span>&nbsp;<span class="ident" id="5640502">req</span><span class="op" id="5640505">.</span><span class="ident" id="5640506">ContentLength</span><span class="op" id="5640519">)</span><span class="op" id="5640520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640526">if</span>&nbsp;<span class="ident" id="5640529">ctype</span>&nbsp;<span class="op" id="5640535">:=</span>&nbsp;<span class="ident" id="5640538">req</span><span class="op" id="5640541">.</span><span class="ident" id="5640542">Header</span><span class="op" id="5640548">.</span><span class="ident" id="5640549">Get</span><span class="op" id="5640552">(</span><span class="string" id="5640553">&#34;Content-Type&#34;</span><span class="op" id="5640567">)</span><span class="op" id="5640568">;</span>&nbsp;<span class="ident" id="5640570">ctype</span>&nbsp;<span class="op" id="5640576">!=</span>&nbsp;<span class="string" id="5640579">&#34;&#34;</span>&nbsp;<span class="op" id="5640582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640586">env</span>&nbsp;<span class="op" id="5640590">=</span>&nbsp;<span class="builtinfunc" id="5640592">append</span><span class="op" id="5640598">(</span><span class="ident" id="5640599">env</span><span class="op" id="5640602">,</span>&nbsp;<span class="string" id="5640604">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5640619">+</span><span class="ident" id="5640620">ctype</span><span class="op" id="5640625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640628">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640632">if</span>&nbsp;<span class="ident" id="5640635">h</span><span class="op" id="5640636">.</span><span class="ident" id="5640637">Env</span>&nbsp;<span class="op" id="5640641">!=</span>&nbsp;<span class="ident" id="5640644">nil</span>&nbsp;<span class="op" id="5640648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640652">env</span>&nbsp;<span class="op" id="5640656">=</span>&nbsp;<span class="builtinfunc" id="5640658">append</span><span class="op" id="5640664">(</span><span class="ident" id="5640665">env</span><span class="op" id="5640668">,</span>&nbsp;<span class="ident" id="5640670">h</span><span class="op" id="5640671">.</span><span class="ident" id="5640672">Env</span><span class="op" id="5640675">...</span><span class="op" id="5640678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640685">envPath</span>&nbsp;<span class="op" id="5640693">:=</span>&nbsp;<span class="ident" id="5640696">os</span><span class="op" id="5640698">.</span><span class="ident" id="5640699">Getenv</span><span class="op" id="5640705">(</span><span class="string" id="5640706">&#34;PATH&#34;</span><span class="op" id="5640712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640715">if</span>&nbsp;<span class="ident" id="5640718">envPath</span>&nbsp;<span class="op" id="5640726">==</span>&nbsp;<span class="string" id="5640729">&#34;&#34;</span>&nbsp;<span class="op" id="5640732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640736">envPath</span>&nbsp;<span class="op" id="5640744">=</span>&nbsp;<span class="string" id="5640746">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640799">env</span>&nbsp;<span class="op" id="5640803">=</span>&nbsp;<span class="builtinfunc" id="5640805">append</span><span class="op" id="5640811">(</span><span class="ident" id="5640812">env</span><span class="op" id="5640815">,</span>&nbsp;<span class="string" id="5640817">&#34;PATH=&#34;</span><span class="op" id="5640824">+</span><span class="ident" id="5640825">envPath</span><span class="op" id="5640832">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640836">for</span>&nbsp;<span class="ident" id="5640840">_</span><span class="op" id="5640841">,</span>&nbsp;<span class="ident" id="5640843">e</span>&nbsp;<span class="op" id="5640845">:=</span>&nbsp;<span class="keyword" id="5640848">range</span>&nbsp;<span class="ident" id="5640854">h</span><span class="op" id="5640855">.</span><span class="ident" id="5640856">InheritEnv</span>&nbsp;<span class="op" id="5640867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640871">if</span>&nbsp;<span class="ident" id="5640874">v</span>&nbsp;<span class="op" id="5640876">:=</span>&nbsp;<span class="ident" id="5640879">os</span><span class="op" id="5640881">.</span><span class="ident" id="5640882">Getenv</span><span class="op" id="5640888">(</span><span class="ident" id="5640889">e</span><span class="op" id="5640890">)</span><span class="op" id="5640891">;</span>&nbsp;<span class="ident" id="5640893">v</span>&nbsp;<span class="op" id="5640895">!=</span>&nbsp;<span class="string" id="5640898">&#34;&#34;</span>&nbsp;<span class="op" id="5640901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640906">env</span>&nbsp;<span class="op" id="5640910">=</span>&nbsp;<span class="builtinfunc" id="5640912">append</span><span class="op" id="5640918">(</span><span class="ident" id="5640919">env</span><span class="op" id="5640922">,</span>&nbsp;<span class="ident" id="5640924">e</span><span class="op" id="5640925">+</span><span class="string" id="5640926">&#34;=&#34;</span><span class="op" id="5640929">+</span><span class="ident" id="5640930">v</span><span class="op" id="5640931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640935">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640942">for</span>&nbsp;<span class="ident" id="5640946">_</span><span class="op" id="5640947">,</span>&nbsp;<span class="ident" id="5640949">e</span>&nbsp;<span class="op" id="5640951">:=</span>&nbsp;<span class="keyword" id="5640954">range</span>&nbsp;<span class="ident" id="5640960">osDefaultInheritEnv</span><span class="op" id="5640979">[</span><span class="ident" id="5640980">runtime</span><span class="op" id="5640987">.</span><span class="ident" id="5640988">GOOS</span><span class="op" id="5640992">]</span>&nbsp;<span class="op" id="5640994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640998">if</span>&nbsp;<span class="ident" id="5641001">v</span>&nbsp;<span class="op" id="5641003">:=</span>&nbsp;<span class="ident" id="5641006">os</span><span class="op" id="5641008">.</span><span class="ident" id="5641009">Getenv</span><span class="op" id="5641015">(</span><span class="ident" id="5641016">e</span><span class="op" id="5641017">)</span><span class="op" id="5641018">;</span>&nbsp;<span class="ident" id="5641020">v</span>&nbsp;<span class="op" id="5641022">!=</span>&nbsp;<span class="string" id="5641025">&#34;&#34;</span>&nbsp;<span class="op" id="5641028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641033">env</span>&nbsp;<span class="op" id="5641037">=</span>&nbsp;<span class="builtinfunc" id="5641039">append</span><span class="op" id="5641045">(</span><span class="ident" id="5641046">env</span><span class="op" id="5641049">,</span>&nbsp;<span class="ident" id="5641051">e</span><span class="op" id="5641052">+</span><span class="string" id="5641053">&#34;=&#34;</span><span class="op" id="5641056">+</span><span class="ident" id="5641057">v</span><span class="op" id="5641058">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641069">env</span>&nbsp;<span class="op" id="5641073">=</span>&nbsp;<span class="ident" id="5641075">removeLeadingDuplicates</span><span class="op" id="5641098">(</span><span class="ident" id="5641099">env</span><span class="op" id="5641102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641106">var</span>&nbsp;<span class="ident" id="5641110">cwd</span><span class="op" id="5641113">,</span>&nbsp;<span class="ident" id="5641115">path</span>&nbsp;<span class="builtintype" id="5641120">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641128">if</span>&nbsp;<span class="ident" id="5641131">h</span><span class="op" id="5641132">.</span><span class="ident" id="5641133">Dir</span>&nbsp;<span class="op" id="5641137">!=</span>&nbsp;<span class="string" id="5641140">&#34;&#34;</span>&nbsp;<span class="op" id="5641143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641147">path</span>&nbsp;<span class="op" id="5641152">=</span>&nbsp;<span class="ident" id="5641154">h</span><span class="op" id="5641155">.</span><span class="ident" id="5641156">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641163">cwd</span>&nbsp;<span class="op" id="5641167">=</span>&nbsp;<span class="ident" id="5641169">h</span><span class="op" id="5641170">.</span><span class="ident" id="5641171">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641176">}</span>&nbsp;<span class="keyword" id="5641178">else</span>&nbsp;<span class="op" id="5641183">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641187">cwd</span><span class="op" id="5641190">,</span>&nbsp;<span class="ident" id="5641192">path</span>&nbsp;<span class="op" id="5641197">=</span>&nbsp;<span class="ident" id="5641199">filepath</span><span class="op" id="5641207">.</span><span class="ident" id="5641208">Split</span><span class="op" id="5641213">(</span><span class="ident" id="5641214">h</span><span class="op" id="5641215">.</span><span class="ident" id="5641216">Path</span><span class="op" id="5641220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641226">if</span>&nbsp;<span class="ident" id="5641229">cwd</span>&nbsp;<span class="op" id="5641233">==</span>&nbsp;<span class="string" id="5641236">&#34;&#34;</span>&nbsp;<span class="op" id="5641239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641243">cwd</span>&nbsp;<span class="op" id="5641247">=</span>&nbsp;<span class="string" id="5641249">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641254">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641258">internalError</span>&nbsp;<span class="op" id="5641272">:=</span>&nbsp;<span class="keyword" id="5641275">func</span><span class="op" id="5641279">(</span><span class="ident" id="5641280">err</span>&nbsp;<span class="builtintype" id="5641284">error</span><span class="op" id="5641289">)</span>&nbsp;<span class="op" id="5641291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641295">rw</span><span class="op" id="5641297">.</span><span class="ident" id="5641298">WriteHeader</span><span class="op" id="5641309">(</span><span class="ident" id="5641310">http</span><span class="op" id="5641314">.</span><span class="ident" id="5641315">StatusInternalServerError</span><span class="op" id="5641340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641344">h</span><span class="op" id="5641345">.</span><span class="ident" id="5641346">printf</span><span class="op" id="5641352">(</span><span class="string" id="5641353">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5641368">,</span>&nbsp;<span class="ident" id="5641370">err</span><span class="op" id="5641373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641376">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641380">cmd</span>&nbsp;<span class="op" id="5641384">:=</span>&nbsp;<span class="op" id="5641387">&amp;</span><span class="ident" id="5641388">exec</span><span class="op" id="5641392">.</span><span class="ident" id="5641393">Cmd</span><span class="op" id="5641396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641400">Path</span><span class="op" id="5641404">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5641408">path</span><span class="op" id="5641412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641416">Args</span><span class="op" id="5641420">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5641424">append</span><span class="op" id="5641430">(</span><span class="op" id="5641431">[</span><span class="op" id="5641432">]</span><span class="builtintype" id="5641433">string</span><span class="op" id="5641439">{</span><span class="ident" id="5641440">h</span><span class="op" id="5641441">.</span><span class="ident" id="5641442">Path</span><span class="op" id="5641446">}</span><span class="op" id="5641447">,</span>&nbsp;<span class="ident" id="5641449">h</span><span class="op" id="5641450">.</span><span class="ident" id="5641451">Args</span><span class="op" id="5641455">...</span><span class="op" id="5641458">)</span><span class="op" id="5641459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641463">Dir</span><span class="op" id="5641466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641471">cwd</span><span class="op" id="5641474">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641478">Env</span><span class="op" id="5641481">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641486">env</span><span class="op" id="5641489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641493">Stderr</span><span class="op" id="5641499">:</span>&nbsp;<span class="ident" id="5641501">os</span><span class="op" id="5641503">.</span><span class="ident" id="5641504">Stderr</span><span class="op" id="5641510">,</span>&nbsp;<span class="comment" id="5641512">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641527">if</span>&nbsp;<span class="ident" id="5641530">req</span><span class="op" id="5641533">.</span><span class="ident" id="5641534">ContentLength</span>&nbsp;<span class="op" id="5641548">!=</span>&nbsp;<span class="num" id="5641551">0</span>&nbsp;<span class="op" id="5641553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641557">cmd</span><span class="op" id="5641560">.</span><span class="ident" id="5641561">Stdin</span>&nbsp;<span class="op" id="5641567">=</span>&nbsp;<span class="ident" id="5641569">req</span><span class="op" id="5641572">.</span><span class="ident" id="5641573">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641582">stdoutRead</span><span class="op" id="5641592">,</span>&nbsp;<span class="ident" id="5641594">err</span>&nbsp;<span class="op" id="5641598">:=</span>&nbsp;<span class="ident" id="5641601">cmd</span><span class="op" id="5641604">.</span><span class="ident" id="5641605">StdoutPipe</span><span class="op" id="5641615">(</span><span class="op" id="5641616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641619">if</span>&nbsp;<span class="ident" id="5641622">err</span>&nbsp;<span class="op" id="5641626">!=</span>&nbsp;<span class="ident" id="5641629">nil</span>&nbsp;<span class="op" id="5641633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641637">internalError</span><span class="op" id="5641650">(</span><span class="ident" id="5641651">err</span><span class="op" id="5641654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641658">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641670">err</span>&nbsp;<span class="op" id="5641674">=</span>&nbsp;<span class="ident" id="5641676">cmd</span><span class="op" id="5641679">.</span><span class="ident" id="5641680">Start</span><span class="op" id="5641685">(</span><span class="op" id="5641686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641689">if</span>&nbsp;<span class="ident" id="5641692">err</span>&nbsp;<span class="op" id="5641696">!=</span>&nbsp;<span class="ident" id="5641699">nil</span>&nbsp;<span class="op" id="5641703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641707">internalError</span><span class="op" id="5641720">(</span><span class="ident" id="5641721">err</span><span class="op" id="5641724">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641728">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641739">if</span>&nbsp;<span class="ident" id="5641742">hook</span>&nbsp;<span class="op" id="5641747">:=</span>&nbsp;<span class="ident" id="5641750">testHookStartProcess</span><span class="op" id="5641770">;</span>&nbsp;<span class="ident" id="5641772">hook</span>&nbsp;<span class="op" id="5641777">!=</span>&nbsp;<span class="ident" id="5641780">nil</span>&nbsp;<span class="op" id="5641784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641788">hook</span><span class="op" id="5641792">(</span><span class="ident" id="5641793">cmd</span><span class="op" id="5641796">.</span><span class="ident" id="5641797">Process</span><span class="op" id="5641804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641807">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641810">defer</span>&nbsp;<span class="ident" id="5641816">cmd</span><span class="op" id="5641819">.</span><span class="ident" id="5641820">Wait</span><span class="op" id="5641824">(</span><span class="op" id="5641825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641828">defer</span>&nbsp;<span class="ident" id="5641834">stdoutRead</span><span class="op" id="5641844">.</span><span class="ident" id="5641845">Close</span><span class="op" id="5641850">(</span><span class="op" id="5641851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641855">linebody</span>&nbsp;<span class="op" id="5641864">:=</span>&nbsp;<span class="ident" id="5641867">bufio</span><span class="op" id="5641872">.</span><span class="ident" id="5641873">NewReaderSize</span><span class="op" id="5641886">(</span><span class="ident" id="5641887">stdoutRead</span><span class="op" id="5641897">,</span>&nbsp;<span class="num" id="5641899">1024</span><span class="op" id="5641903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641906">headers</span>&nbsp;<span class="op" id="5641914">:=</span>&nbsp;<span class="builtinfunc" id="5641917">make</span><span class="op" id="5641921">(</span><span class="ident" id="5641922">http</span><span class="op" id="5641926">.</span><span class="ident" id="5641927">Header</span><span class="op" id="5641933">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641936">statusCode</span>&nbsp;<span class="op" id="5641947">:=</span>&nbsp;<span class="num" id="5641950">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641953">headerLines</span>&nbsp;<span class="op" id="5641965">:=</span>&nbsp;<span class="num" id="5641968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641971">sawBlankLine</span>&nbsp;<span class="op" id="5641984">:=</span>&nbsp;<span class="builtintype" id="5641987">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641994">for</span>&nbsp;<span class="op" id="5641998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642002">line</span><span class="op" id="5642006">,</span>&nbsp;<span class="ident" id="5642008">isPrefix</span><span class="op" id="5642016">,</span>&nbsp;<span class="ident" id="5642018">err</span>&nbsp;<span class="op" id="5642022">:=</span>&nbsp;<span class="ident" id="5642025">linebody</span><span class="op" id="5642033">.</span><span class="ident" id="5642034">ReadLine</span><span class="op" id="5642042">(</span><span class="op" id="5642043">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642047">if</span>&nbsp;<span class="ident" id="5642050">isPrefix</span>&nbsp;<span class="op" id="5642059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642064">rw</span><span class="op" id="5642066">.</span><span class="ident" id="5642067">WriteHeader</span><span class="op" id="5642078">(</span><span class="ident" id="5642079">http</span><span class="op" id="5642083">.</span><span class="ident" id="5642084">StatusInternalServerError</span><span class="op" id="5642109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642114">h</span><span class="op" id="5642115">.</span><span class="ident" id="5642116">printf</span><span class="op" id="5642122">(</span><span class="string" id="5642123">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5642163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642177">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642181">if</span>&nbsp;<span class="ident" id="5642184">err</span>&nbsp;<span class="op" id="5642188">==</span>&nbsp;<span class="ident" id="5642191">io</span><span class="op" id="5642193">.</span><span class="ident" id="5642194">EOF</span>&nbsp;<span class="op" id="5642198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642203">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642215">if</span>&nbsp;<span class="ident" id="5642218">err</span>&nbsp;<span class="op" id="5642222">!=</span>&nbsp;<span class="ident" id="5642225">nil</span>&nbsp;<span class="op" id="5642229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642234">rw</span><span class="op" id="5642236">.</span><span class="ident" id="5642237">WriteHeader</span><span class="op" id="5642248">(</span><span class="ident" id="5642249">http</span><span class="op" id="5642253">.</span><span class="ident" id="5642254">StatusInternalServerError</span><span class="op" id="5642279">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642284">h</span><span class="op" id="5642285">.</span><span class="ident" id="5642286">printf</span><span class="op" id="5642292">(</span><span class="string" id="5642293">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5642325">,</span>&nbsp;<span class="ident" id="5642327">err</span><span class="op" id="5642330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642335">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642348">if</span>&nbsp;<span class="builtinfunc" id="5642351">len</span><span class="op" id="5642354">(</span><span class="ident" id="5642355">line</span><span class="op" id="5642359">)</span>&nbsp;<span class="op" id="5642361">==</span>&nbsp;<span class="num" id="5642364">0</span>&nbsp;<span class="op" id="5642366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642371">sawBlankLine</span>&nbsp;<span class="op" id="5642384">=</span>&nbsp;<span class="builtintype" id="5642386">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642394">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642406">headerLines</span><span class="op" id="5642417">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642422">parts</span>&nbsp;<span class="op" id="5642428">:=</span>&nbsp;<span class="ident" id="5642431">strings</span><span class="op" id="5642438">.</span><span class="ident" id="5642439">SplitN</span><span class="op" id="5642445">(</span><span class="builtintype" id="5642446">string</span><span class="op" id="5642452">(</span><span class="ident" id="5642453">line</span><span class="op" id="5642457">)</span><span class="op" id="5642458">,</span>&nbsp;<span class="string" id="5642460">&#34;:&#34;</span><span class="op" id="5642463">,</span>&nbsp;<span class="num" id="5642465">2</span><span class="op" id="5642466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642470">if</span>&nbsp;<span class="builtinfunc" id="5642473">len</span><span class="op" id="5642476">(</span><span class="ident" id="5642477">parts</span><span class="op" id="5642482">)</span>&nbsp;<span class="op" id="5642484">&lt;</span>&nbsp;<span class="num" id="5642486">2</span>&nbsp;<span class="op" id="5642488">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642493">h</span><span class="op" id="5642494">.</span><span class="ident" id="5642495">printf</span><span class="op" id="5642501">(</span><span class="string" id="5642502">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5642530">,</span>&nbsp;<span class="builtintype" id="5642532">string</span><span class="op" id="5642538">(</span><span class="ident" id="5642539">line</span><span class="op" id="5642543">)</span><span class="op" id="5642544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642549">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642564">header</span><span class="op" id="5642570">,</span>&nbsp;<span class="ident" id="5642572">val</span>&nbsp;<span class="op" id="5642576">:=</span>&nbsp;<span class="ident" id="5642579">parts</span><span class="op" id="5642584">[</span><span class="num" id="5642585">0</span><span class="op" id="5642586">]</span><span class="op" id="5642587">,</span>&nbsp;<span class="ident" id="5642589">parts</span><span class="op" id="5642594">[</span><span class="num" id="5642595">1</span><span class="op" id="5642596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642600">header</span>&nbsp;<span class="op" id="5642607">=</span>&nbsp;<span class="ident" id="5642609">strings</span><span class="op" id="5642616">.</span><span class="ident" id="5642617">TrimSpace</span><span class="op" id="5642626">(</span><span class="ident" id="5642627">header</span><span class="op" id="5642633">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642637">val</span>&nbsp;<span class="op" id="5642641">=</span>&nbsp;<span class="ident" id="5642643">strings</span><span class="op" id="5642650">.</span><span class="ident" id="5642651">TrimSpace</span><span class="op" id="5642660">(</span><span class="ident" id="5642661">val</span><span class="op" id="5642664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642668">switch</span>&nbsp;<span class="op" id="5642675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642679">case</span>&nbsp;<span class="ident" id="5642684">header</span>&nbsp;<span class="op" id="5642691">==</span>&nbsp;<span class="string" id="5642694">&#34;Status&#34;</span><span class="op" id="5642702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642707">if</span>&nbsp;<span class="builtinfunc" id="5642710">len</span><span class="op" id="5642713">(</span><span class="ident" id="5642714">val</span><span class="op" id="5642717">)</span>&nbsp;<span class="op" id="5642719">&lt;</span>&nbsp;<span class="num" id="5642721">3</span>&nbsp;<span class="op" id="5642723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642729">h</span><span class="op" id="5642730">.</span><span class="ident" id="5642731">printf</span><span class="op" id="5642737">(</span><span class="string" id="5642738">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5642769">,</span>&nbsp;<span class="ident" id="5642771">val</span><span class="op" id="5642774">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642780">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642795">code</span><span class="op" id="5642799">,</span>&nbsp;<span class="ident" id="5642801">err</span>&nbsp;<span class="op" id="5642805">:=</span>&nbsp;<span class="ident" id="5642808">strconv</span><span class="op" id="5642815">.</span><span class="ident" id="5642816">Atoi</span><span class="op" id="5642820">(</span><span class="ident" id="5642821">val</span><span class="op" id="5642824">[</span><span class="num" id="5642825">0</span><span class="op" id="5642826">:</span><span class="num" id="5642827">3</span><span class="op" id="5642828">]</span><span class="op" id="5642829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642834">if</span>&nbsp;<span class="ident" id="5642837">err</span>&nbsp;<span class="op" id="5642841">!=</span>&nbsp;<span class="ident" id="5642844">nil</span>&nbsp;<span class="op" id="5642848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642854">h</span><span class="op" id="5642855">.</span><span class="ident" id="5642856">printf</span><span class="op" id="5642862">(</span><span class="string" id="5642863">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5642886">,</span>&nbsp;<span class="ident" id="5642888">val</span><span class="op" id="5642891">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642897">h</span><span class="op" id="5642898">.</span><span class="ident" id="5642899">printf</span><span class="op" id="5642905">(</span><span class="string" id="5642906">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5642924">,</span>&nbsp;<span class="ident" id="5642926">line</span><span class="op" id="5642930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642951">statusCode</span>&nbsp;<span class="op" id="5642962">=</span>&nbsp;<span class="ident" id="5642964">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642971">default</span><span class="op" id="5642978">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642983">headers</span><span class="op" id="5642990">.</span><span class="ident" id="5642991">Add</span><span class="op" id="5642994">(</span><span class="ident" id="5642995">header</span><span class="op" id="5643001">,</span>&nbsp;<span class="ident" id="5643003">val</span><span class="op" id="5643006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643016">if</span>&nbsp;<span class="ident" id="5643019">headerLines</span>&nbsp;<span class="op" id="5643031">==</span>&nbsp;<span class="num" id="5643034">0</span>&nbsp;<span class="op" id="5643036">||</span>&nbsp;<span class="op" id="5643039">!</span><span class="ident" id="5643040">sawBlankLine</span>&nbsp;<span class="op" id="5643053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643057">rw</span><span class="op" id="5643059">.</span><span class="ident" id="5643060">WriteHeader</span><span class="op" id="5643071">(</span><span class="ident" id="5643072">http</span><span class="op" id="5643076">.</span><span class="ident" id="5643077">StatusInternalServerError</span><span class="op" id="5643102">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643106">h</span><span class="op" id="5643107">.</span><span class="ident" id="5643108">printf</span><span class="op" id="5643114">(</span><span class="string" id="5643115">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5643132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643136">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643148">if</span>&nbsp;<span class="ident" id="5643151">loc</span>&nbsp;<span class="op" id="5643155">:=</span>&nbsp;<span class="ident" id="5643158">headers</span><span class="op" id="5643165">.</span><span class="ident" id="5643166">Get</span><span class="op" id="5643169">(</span><span class="string" id="5643170">&#34;Location&#34;</span><span class="op" id="5643180">)</span><span class="op" id="5643181">;</span>&nbsp;<span class="ident" id="5643183">loc</span>&nbsp;<span class="op" id="5643187">!=</span>&nbsp;<span class="string" id="5643190">&#34;&#34;</span>&nbsp;<span class="op" id="5643193">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643197">if</span>&nbsp;<span class="ident" id="5643200">strings</span><span class="op" id="5643207">.</span><span class="ident" id="5643208">HasPrefix</span><span class="op" id="5643217">(</span><span class="ident" id="5643218">loc</span><span class="op" id="5643221">,</span>&nbsp;<span class="string" id="5643223">&#34;/&#34;</span><span class="op" id="5643226">)</span>&nbsp;<span class="op" id="5643228">&amp;&amp;</span>&nbsp;<span class="ident" id="5643231">h</span><span class="op" id="5643232">.</span><span class="ident" id="5643233">PathLocationHandler</span>&nbsp;<span class="op" id="5643253">!=</span>&nbsp;<span class="ident" id="5643256">nil</span>&nbsp;<span class="op" id="5643260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643265">h</span><span class="op" id="5643266">.</span><span class="ident" id="5643267">handleInternalRedirect</span><span class="op" id="5643289">(</span><span class="ident" id="5643290">rw</span><span class="op" id="5643292">,</span>&nbsp;<span class="ident" id="5643294">req</span><span class="op" id="5643297">,</span>&nbsp;<span class="ident" id="5643299">loc</span><span class="op" id="5643302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643307">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643320">if</span>&nbsp;<span class="ident" id="5643323">statusCode</span>&nbsp;<span class="op" id="5643334">==</span>&nbsp;<span class="num" id="5643337">0</span>&nbsp;<span class="op" id="5643339">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643344">statusCode</span>&nbsp;<span class="op" id="5643355">=</span>&nbsp;<span class="ident" id="5643357">http</span><span class="op" id="5643361">.</span><span class="ident" id="5643362">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643383">if</span>&nbsp;<span class="ident" id="5643386">statusCode</span>&nbsp;<span class="op" id="5643397">==</span>&nbsp;<span class="num" id="5643400">0</span>&nbsp;<span class="op" id="5643402">&amp;&amp;</span>&nbsp;<span class="ident" id="5643405">headers</span><span class="op" id="5643412">.</span><span class="ident" id="5643413">Get</span><span class="op" id="5643416">(</span><span class="string" id="5643417">&#34;Content-Type&#34;</span><span class="op" id="5643431">)</span>&nbsp;<span class="op" id="5643433">==</span>&nbsp;<span class="string" id="5643436">&#34;&#34;</span>&nbsp;<span class="op" id="5643439">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643443">rw</span><span class="op" id="5643445">.</span><span class="ident" id="5643446">WriteHeader</span><span class="op" id="5643457">(</span><span class="ident" id="5643458">http</span><span class="op" id="5643462">.</span><span class="ident" id="5643463">StatusInternalServerError</span><span class="op" id="5643488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643492">h</span><span class="op" id="5643493">.</span><span class="ident" id="5643494">printf</span><span class="op" id="5643500">(</span><span class="string" id="5643501">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5643548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643552">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643564">if</span>&nbsp;<span class="ident" id="5643567">statusCode</span>&nbsp;<span class="op" id="5643578">==</span>&nbsp;<span class="num" id="5643581">0</span>&nbsp;<span class="op" id="5643583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643587">statusCode</span>&nbsp;<span class="op" id="5643598">=</span>&nbsp;<span class="ident" id="5643600">http</span><span class="op" id="5643604">.</span><span class="ident" id="5643605">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643619">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643680">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643740">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643774">for</span>&nbsp;<span class="ident" id="5643778">k</span><span class="op" id="5643779">,</span>&nbsp;<span class="ident" id="5643781">vv</span>&nbsp;<span class="op" id="5643784">:=</span>&nbsp;<span class="keyword" id="5643787">range</span>&nbsp;<span class="ident" id="5643793">headers</span>&nbsp;<span class="op" id="5643801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643805">for</span>&nbsp;<span class="ident" id="5643809">_</span><span class="op" id="5643810">,</span>&nbsp;<span class="ident" id="5643812">v</span>&nbsp;<span class="op" id="5643814">:=</span>&nbsp;<span class="keyword" id="5643817">range</span>&nbsp;<span class="ident" id="5643823">vv</span>&nbsp;<span class="op" id="5643826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643831">rw</span><span class="op" id="5643833">.</span><span class="ident" id="5643834">Header</span><span class="op" id="5643840">(</span><span class="op" id="5643841">)</span><span class="op" id="5643842">.</span><span class="ident" id="5643843">Add</span><span class="op" id="5643846">(</span><span class="ident" id="5643847">k</span><span class="op" id="5643848">,</span>&nbsp;<span class="ident" id="5643850">v</span><span class="op" id="5643851">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643862">rw</span><span class="op" id="5643864">.</span><span class="ident" id="5643865">WriteHeader</span><span class="op" id="5643876">(</span><span class="ident" id="5643877">statusCode</span><span class="op" id="5643887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643891">_</span><span class="op" id="5643892">,</span>&nbsp;<span class="ident" id="5643894">err</span>&nbsp;<span class="op" id="5643898">=</span>&nbsp;<span class="ident" id="5643900">io</span><span class="op" id="5643902">.</span><span class="ident" id="5643903">Copy</span><span class="op" id="5643907">(</span><span class="ident" id="5643908">rw</span><span class="op" id="5643910">,</span>&nbsp;<span class="ident" id="5643912">linebody</span><span class="op" id="5643920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643923">if</span>&nbsp;<span class="ident" id="5643926">err</span>&nbsp;<span class="op" id="5643930">!=</span>&nbsp;<span class="ident" id="5643933">nil</span>&nbsp;<span class="op" id="5643937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643941">h</span><span class="op" id="5643942">.</span><span class="ident" id="5643943">printf</span><span class="op" id="5643949">(</span><span class="string" id="5643950">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5643971">,</span>&nbsp;<span class="ident" id="5643973">err</span><span class="op" id="5643976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643980">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644036">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644091">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644147">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644200">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644258">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644302">cmd</span><span class="op" id="5644305">.</span><span class="ident" id="5644306">Process</span><span class="op" id="5644313">.</span><span class="ident" id="5644314">Kill</span><span class="op" id="5644318">(</span><span class="op" id="5644319">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644322">}</span><br>
<span class="lineno"></span><span class="op" id="5644324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5644327">func</span>&nbsp;<span class="op" id="5644332">(</span><span class="ident" id="5644333">h</span>&nbsp;<span class="op" id="5644335">*</span><span class="ident" id="5644336">Handler</span><span class="op" id="5644343">)</span>&nbsp;<span class="ident" id="5644345">printf</span><span class="op" id="5644351">(</span><span class="ident" id="5644352">format</span>&nbsp;<span class="builtintype" id="5644359">string</span><span class="op" id="5644365">,</span>&nbsp;<span class="ident" id="5644367">v</span>&nbsp;<span class="op" id="5644369">...</span><span class="keyword" id="5644372">interface</span><span class="op" id="5644381">{</span><span class="op" id="5644382">}</span><span class="op" id="5644383">)</span>&nbsp;<span class="op" id="5644385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644388">if</span>&nbsp;<span class="ident" id="5644391">h</span><span class="op" id="5644392">.</span><span class="ident" id="5644393">Logger</span>&nbsp;<span class="op" id="5644400">!=</span>&nbsp;<span class="ident" id="5644403">nil</span>&nbsp;<span class="op" id="5644407">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644411">h</span><span class="op" id="5644412">.</span><span class="ident" id="5644413">Logger</span><span class="op" id="5644419">.</span><span class="ident" id="5644420">Printf</span><span class="op" id="5644426">(</span><span class="ident" id="5644427">format</span><span class="op" id="5644433">,</span>&nbsp;<span class="ident" id="5644435">v</span><span class="op" id="5644436">...</span><span class="op" id="5644439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644442">}</span>&nbsp;<span class="keyword" id="5644444">else</span>&nbsp;<span class="op" id="5644449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644453">log</span><span class="op" id="5644456">.</span><span class="ident" id="5644457">Printf</span><span class="op" id="5644463">(</span><span class="ident" id="5644464">format</span><span class="op" id="5644470">,</span>&nbsp;<span class="ident" id="5644472">v</span><span class="op" id="5644473">...</span><span class="op" id="5644476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644479">}</span><br>
<span class="lineno"></span><span class="op" id="5644481">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5644484">func</span>&nbsp;<span class="op" id="5644489">(</span><span class="ident" id="5644490">h</span>&nbsp;<span class="op" id="5644492">*</span><span class="ident" id="5644493">Handler</span><span class="op" id="5644500">)</span>&nbsp;<span class="ident" id="5644502">handleInternalRedirect</span><span class="op" id="5644524">(</span><span class="ident" id="5644525">rw</span>&nbsp;<span class="ident" id="5644528">http</span><span class="op" id="5644532">.</span><span class="ident" id="5644533">ResponseWriter</span><span class="op" id="5644547">,</span>&nbsp;<span class="ident" id="5644549">req</span>&nbsp;<span class="op" id="5644553">*</span><span class="ident" id="5644554">http</span><span class="op" id="5644558">.</span><span class="ident" id="5644559">Request</span><span class="op" id="5644566">,</span>&nbsp;<span class="ident" id="5644568">path</span>&nbsp;<span class="builtintype" id="5644573">string</span><span class="op" id="5644579">)</span>&nbsp;<span class="op" id="5644581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644584">url</span><span class="op" id="5644587">,</span>&nbsp;<span class="ident" id="5644589">err</span>&nbsp;<span class="op" id="5644593">:=</span>&nbsp;<span class="ident" id="5644596">req</span><span class="op" id="5644599">.</span><span class="ident" id="5644600">URL</span><span class="op" id="5644603">.</span><span class="ident" id="5644604">Parse</span><span class="op" id="5644609">(</span><span class="ident" id="5644610">path</span><span class="op" id="5644614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644617">if</span>&nbsp;<span class="ident" id="5644620">err</span>&nbsp;<span class="op" id="5644624">!=</span>&nbsp;<span class="ident" id="5644627">nil</span>&nbsp;<span class="op" id="5644631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644635">rw</span><span class="op" id="5644637">.</span><span class="ident" id="5644638">WriteHeader</span><span class="op" id="5644649">(</span><span class="ident" id="5644650">http</span><span class="op" id="5644654">.</span><span class="ident" id="5644655">StatusInternalServerError</span><span class="op" id="5644680">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644684">h</span><span class="op" id="5644685">.</span><span class="ident" id="5644686">printf</span><span class="op" id="5644692">(</span><span class="string" id="5644693">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5644737">,</span>&nbsp;<span class="ident" id="5644739">path</span><span class="op" id="5644743">,</span>&nbsp;<span class="ident" id="5644745">err</span><span class="op" id="5644748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644763">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644827">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644888">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644950">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645011">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645073">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645134">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645187">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645249">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645269">newReq</span>&nbsp;<span class="op" id="5645276">:=</span>&nbsp;<span class="op" id="5645279">&amp;</span><span class="ident" id="5645280">http</span><span class="op" id="5645284">.</span><span class="ident" id="5645285">Request</span><span class="op" id="5645292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645296">Method</span><span class="op" id="5645302">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5645308">&#34;GET&#34;</span><span class="op" id="5645313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645317">URL</span><span class="op" id="5645320">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645329">url</span><span class="op" id="5645332">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645336">Proto</span><span class="op" id="5645341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5645348">&#34;HTTP/1.1&#34;</span><span class="op" id="5645358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645362">ProtoMajor</span><span class="op" id="5645372">:</span>&nbsp;<span class="num" id="5645374">1</span><span class="op" id="5645375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645379">ProtoMinor</span><span class="op" id="5645389">:</span>&nbsp;<span class="num" id="5645391">1</span><span class="op" id="5645392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645396">Header</span><span class="op" id="5645402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5645408">make</span><span class="op" id="5645412">(</span><span class="ident" id="5645413">http</span><span class="op" id="5645417">.</span><span class="ident" id="5645418">Header</span><span class="op" id="5645424">)</span><span class="op" id="5645425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645429">Host</span><span class="op" id="5645433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645441">url</span><span class="op" id="5645444">.</span><span class="ident" id="5645445">Host</span><span class="op" id="5645449">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645453">RemoteAddr</span><span class="op" id="5645463">:</span>&nbsp;<span class="ident" id="5645465">req</span><span class="op" id="5645468">.</span><span class="ident" id="5645469">RemoteAddr</span><span class="op" id="5645479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645483">TLS</span><span class="op" id="5645486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645495">req</span><span class="op" id="5645498">.</span><span class="ident" id="5645499">TLS</span><span class="op" id="5645502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645508">h</span><span class="op" id="5645509">.</span><span class="ident" id="5645510">PathLocationHandler</span><span class="op" id="5645529">.</span><span class="ident" id="5645530">ServeHTTP</span><span class="op" id="5645539">(</span><span class="ident" id="5645540">rw</span><span class="op" id="5645542">,</span>&nbsp;<span class="ident" id="5645544">newReq</span><span class="op" id="5645550">)</span><br>
<span class="lineno"></span><span class="op" id="5645552">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5645555">func</span>&nbsp;<span class="ident" id="5645560">upperCaseAndUnderscore</span><span class="op" id="5645582">(</span><span class="ident" id="5645583">r</span>&nbsp;<span class="builtintype" id="5645585">rune</span><span class="op" id="5645589">)</span>&nbsp;<span class="builtintype" id="5645591">rune</span>&nbsp;<span class="op" id="5645596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645599">switch</span>&nbsp;<span class="op" id="5645606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645609">case</span>&nbsp;<span class="ident" id="5645614">r</span>&nbsp;<span class="op" id="5645616">&gt;=</span>&nbsp;<span class="string" id="5645619">&#39;a&#39;</span>&nbsp;<span class="op" id="5645623">&amp;&amp;</span>&nbsp;<span class="ident" id="5645626">r</span>&nbsp;<span class="op" id="5645628">&lt;=</span>&nbsp;<span class="string" id="5645631">&#39;z&#39;</span><span class="op" id="5645634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645638">return</span>&nbsp;<span class="ident" id="5645645">r</span>&nbsp;<span class="op" id="5645647">-</span>&nbsp;<span class="op" id="5645649">(</span><span class="string" id="5645650">&#39;a&#39;</span>&nbsp;<span class="op" id="5645654">-</span>&nbsp;<span class="string" id="5645656">&#39;A&#39;</span><span class="op" id="5645659">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645662">case</span>&nbsp;<span class="ident" id="5645667">r</span>&nbsp;<span class="op" id="5645669">==</span>&nbsp;<span class="string" id="5645672">&#39;-&#39;</span><span class="op" id="5645675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645679">return</span>&nbsp;<span class="string" id="5645686">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645691">case</span>&nbsp;<span class="ident" id="5645696">r</span>&nbsp;<span class="op" id="5645698">==</span>&nbsp;<span class="string" id="5645701">&#39;=&#39;</span><span class="op" id="5645704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645708">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645764">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645819">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645871">return</span>&nbsp;<span class="string" id="5645878">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645886">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645939">return</span>&nbsp;<span class="ident" id="5645946">r</span><br>
<span class="lineno">375</span><span class="op" id="5645948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5645951">var</span>&nbsp;<span class="ident" id="5645955">testHookStartProcess</span>&nbsp;<span class="keyword" id="5645976">func</span><span class="op" id="5645980">(</span><span class="op" id="5645981">*</span><span class="ident" id="5645982">os</span><span class="op" id="5645984">.</span><span class="ident" id="5645985">Process</span><span class="op" id="5645992">)</span>&nbsp;<span class="comment" id="5645994">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
