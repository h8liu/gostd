<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5224046">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5224101">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5224155">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5224206">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="5224262">//</span><br>
<span class="lineno"></span><span class="comment" id="5224265">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5224327">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="5224388">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="5224457">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="5224517">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5224555">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="5224580">//</span><br>
<span class="lineno"></span><span class="comment" id="5224583">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="5224640">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5224702">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="5224760">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5224825">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5224853">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="5224898">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="5224936">//</span><br>
<span class="lineno"></span><span class="comment" id="5224939">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="5224988">//</span><br>
<span class="lineno"></span><span class="comment" id="5224991">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="5225070">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="5225144">//</span><br>
<span class="lineno"></span><span class="comment" id="5225147">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="5225189">//</span><br>
<span class="lineno"></span><span class="comment" id="5225192">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="5225263">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5225336">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5225413">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="5225491">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5225566">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="5225589">//</span><br>
<span class="lineno"></span><span class="comment" id="5225592">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5225669">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="5225725">//</span><br>
<span class="lineno"></span><span class="comment" id="5225728">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="5225801">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5225871">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5225947">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="5226018">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5226095">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="5226161">//</span><br>
<span class="lineno"></span><span class="comment" id="5226164">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="5226242">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5226320">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5226395">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="5226469">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5226540">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5226596">//</span><br>
<span class="lineno"></span><span class="comment" id="5226599">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="5226673">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="5226695">//</span><br>
<span class="lineno"></span><span class="comment" id="5226698">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="5226755">//</span><br>
<span class="lineno"></span><span class="comment" id="5226758">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5226830">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="5226903">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="5226975">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="5226996">//</span><br>
<span class="lineno"></span><span class="comment" id="5226999">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="5227066">//</span><br>
<span class="lineno">65</span><span class="keyword" id="5227069">package</span>&nbsp;<span class="ident" id="5227077">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5227085">import</span>&nbsp;<span class="op" id="5227092">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227095">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227104">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227110">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227127">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227138">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227149">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227157">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5227168">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5227183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5227186">var</span>&nbsp;<span class="ident" id="5227190">debug</span>&nbsp;<span class="op" id="5227196">=</span>&nbsp;<span class="builtintype" id="5227198">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5227205">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5227271">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5227334">type</span>&nbsp;<span class="ident" id="5227339">Regexp</span>&nbsp;<span class="keyword" id="5227346">struct</span>&nbsp;<span class="op" id="5227353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227356">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227384">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227399">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227414">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227439">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227454">*</span><span class="ident" id="5227455">syntax</span><span class="op" id="5227461">.</span><span class="ident" id="5227462">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5227469">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227490">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227505">*</span><span class="ident" id="5227506">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5227520">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227546">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227561">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227576">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227618">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227633">[</span><span class="op" id="5227634">]</span><span class="builtintype" id="5227635">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227648">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227672">prefixComplete</span>&nbsp;<span class="builtintype" id="5227687">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227702">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227734">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227749">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227764">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227789">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227804">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227819">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227850">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227865">syntax</span><span class="op" id="5227871">.</span><span class="ident" id="5227872">EmptyOp</span>&nbsp;<span class="comment" id="5227880">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227934">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227949">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227954">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227969">[</span><span class="op" id="5227970">]</span><span class="builtintype" id="5227971">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227979">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227994">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228001">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228042">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228050">sync</span><span class="op" id="5228054">.</span><span class="ident" id="5228055">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228062">machine</span>&nbsp;<span class="op" id="5228070">[</span><span class="op" id="5228071">]</span><span class="op" id="5228072">*</span><span class="ident" id="5228073">machine</span><br>
<span class="lineno">100</span><span class="op" id="5228081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228084">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5228158">func</span>&nbsp;<span class="op" id="5228163">(</span><span class="ident" id="5228164">re</span>&nbsp;<span class="op" id="5228167">*</span><span class="ident" id="5228168">Regexp</span><span class="op" id="5228174">)</span>&nbsp;<span class="ident" id="5228176">String</span><span class="op" id="5228182">(</span><span class="op" id="5228183">)</span>&nbsp;<span class="builtintype" id="5228185">string</span>&nbsp;<span class="op" id="5228192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228195">return</span>&nbsp;<span class="ident" id="5228202">re</span><span class="op" id="5228204">.</span><span class="ident" id="5228205">expr</span><br>
<span class="lineno">105</span><span class="op" id="5228210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228213">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="5228280">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5228339">//</span><br>
<span class="lineno">110</span><span class="comment" id="5228342">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5228405">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5228477">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="5228550">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5228614">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="5228681">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="5228743">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="5228801">func</span>&nbsp;<span class="ident" id="5228806">Compile</span><span class="op" id="5228813">(</span><span class="ident" id="5228814">expr</span>&nbsp;<span class="builtintype" id="5228819">string</span><span class="op" id="5228825">)</span>&nbsp;<span class="op" id="5228827">(</span><span class="op" id="5228828">*</span><span class="ident" id="5228829">Regexp</span><span class="op" id="5228835">,</span>&nbsp;<span class="builtintype" id="5228837">error</span><span class="op" id="5228842">)</span>&nbsp;<span class="op" id="5228844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228847">return</span>&nbsp;<span class="ident" id="5228854">compile</span><span class="op" id="5228861">(</span><span class="ident" id="5228862">expr</span><span class="op" id="5228866">,</span>&nbsp;<span class="ident" id="5228868">syntax</span><span class="op" id="5228874">.</span><span class="ident" id="5228875">Perl</span><span class="op" id="5228879">,</span>&nbsp;<span class="builtintype" id="5228881">false</span><span class="op" id="5228886">)</span><br>
<span class="lineno"></span><span class="op" id="5228888">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5228891">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5228960">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5229026">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="5229047">//</span><br>
<span class="lineno">125</span><span class="comment" id="5229050">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5229122">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5229194">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="5229245">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5229311">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="5229380">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="5229394">//</span><br>
<span class="lineno"></span><span class="comment" id="5229397">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="5229472">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="5229536">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="5229605">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="5229679">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5229753">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="5229818">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="5229894">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="5229962">func</span>&nbsp;<span class="ident" id="5229967">CompilePOSIX</span><span class="op" id="5229979">(</span><span class="ident" id="5229980">expr</span>&nbsp;<span class="builtintype" id="5229985">string</span><span class="op" id="5229991">)</span>&nbsp;<span class="op" id="5229993">(</span><span class="op" id="5229994">*</span><span class="ident" id="5229995">Regexp</span><span class="op" id="5230001">,</span>&nbsp;<span class="builtintype" id="5230003">error</span><span class="op" id="5230008">)</span>&nbsp;<span class="op" id="5230010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230013">return</span>&nbsp;<span class="ident" id="5230020">compile</span><span class="op" id="5230027">(</span><span class="ident" id="5230028">expr</span><span class="op" id="5230032">,</span>&nbsp;<span class="ident" id="5230034">syntax</span><span class="op" id="5230040">.</span><span class="ident" id="5230041">POSIX</span><span class="op" id="5230046">,</span>&nbsp;<span class="builtintype" id="5230048">true</span><span class="op" id="5230052">)</span><br>
<span class="lineno"></span><span class="op" id="5230054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230057">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="5230125">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5230197">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5230269">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5230320">func</span>&nbsp;<span class="op" id="5230325">(</span><span class="ident" id="5230326">re</span>&nbsp;<span class="op" id="5230329">*</span><span class="ident" id="5230330">Regexp</span><span class="op" id="5230336">)</span>&nbsp;<span class="ident" id="5230338">Longest</span><span class="op" id="5230345">(</span><span class="op" id="5230346">)</span>&nbsp;<span class="op" id="5230348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230351">re</span><span class="op" id="5230353">.</span><span class="ident" id="5230354">longest</span>&nbsp;<span class="op" id="5230362">=</span>&nbsp;<span class="builtintype" id="5230364">true</span><br>
<span class="lineno">150</span><span class="op" id="5230369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5230372">func</span>&nbsp;<span class="ident" id="5230377">compile</span><span class="op" id="5230384">(</span><span class="ident" id="5230385">expr</span>&nbsp;<span class="builtintype" id="5230390">string</span><span class="op" id="5230396">,</span>&nbsp;<span class="ident" id="5230398">mode</span>&nbsp;<span class="ident" id="5230403">syntax</span><span class="op" id="5230409">.</span><span class="ident" id="5230410">Flags</span><span class="op" id="5230415">,</span>&nbsp;<span class="ident" id="5230417">longest</span>&nbsp;<span class="builtintype" id="5230425">bool</span><span class="op" id="5230429">)</span>&nbsp;<span class="op" id="5230431">(</span><span class="op" id="5230432">*</span><span class="ident" id="5230433">Regexp</span><span class="op" id="5230439">,</span>&nbsp;<span class="builtintype" id="5230441">error</span><span class="op" id="5230446">)</span>&nbsp;<span class="op" id="5230448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230451">re</span><span class="op" id="5230453">,</span>&nbsp;<span class="ident" id="5230455">err</span>&nbsp;<span class="op" id="5230459">:=</span>&nbsp;<span class="ident" id="5230462">syntax</span><span class="op" id="5230468">.</span><span class="ident" id="5230469">Parse</span><span class="op" id="5230474">(</span><span class="ident" id="5230475">expr</span><span class="op" id="5230479">,</span>&nbsp;<span class="ident" id="5230481">mode</span><span class="op" id="5230485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230488">if</span>&nbsp;<span class="ident" id="5230491">err</span>&nbsp;<span class="op" id="5230495">!=</span>&nbsp;<span class="ident" id="5230498">nil</span>&nbsp;<span class="op" id="5230502">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230506">return</span>&nbsp;<span class="ident" id="5230513">nil</span><span class="op" id="5230516">,</span>&nbsp;<span class="ident" id="5230518">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230526">maxCap</span>&nbsp;<span class="op" id="5230533">:=</span>&nbsp;<span class="ident" id="5230536">re</span><span class="op" id="5230538">.</span><span class="ident" id="5230539">MaxCap</span><span class="op" id="5230545">(</span><span class="op" id="5230546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230549">capNames</span>&nbsp;<span class="op" id="5230558">:=</span>&nbsp;<span class="ident" id="5230561">re</span><span class="op" id="5230563">.</span><span class="ident" id="5230564">CapNames</span><span class="op" id="5230572">(</span><span class="op" id="5230573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230577">re</span>&nbsp;<span class="op" id="5230580">=</span>&nbsp;<span class="ident" id="5230582">re</span><span class="op" id="5230584">.</span><span class="ident" id="5230585">Simplify</span><span class="op" id="5230593">(</span><span class="op" id="5230594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230597">prog</span><span class="op" id="5230601">,</span>&nbsp;<span class="ident" id="5230603">err</span>&nbsp;<span class="op" id="5230607">:=</span>&nbsp;<span class="ident" id="5230610">syntax</span><span class="op" id="5230616">.</span><span class="ident" id="5230617">Compile</span><span class="op" id="5230624">(</span><span class="ident" id="5230625">re</span><span class="op" id="5230627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230630">if</span>&nbsp;<span class="ident" id="5230633">err</span>&nbsp;<span class="op" id="5230637">!=</span>&nbsp;<span class="ident" id="5230640">nil</span>&nbsp;<span class="op" id="5230644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230648">return</span>&nbsp;<span class="ident" id="5230655">nil</span><span class="op" id="5230658">,</span>&nbsp;<span class="ident" id="5230660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230665">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230668">regexp</span>&nbsp;<span class="op" id="5230675">:=</span>&nbsp;<span class="op" id="5230678">&amp;</span><span class="ident" id="5230679">Regexp</span><span class="op" id="5230685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230689">expr</span><span class="op" id="5230693">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230702">expr</span><span class="op" id="5230706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230710">prog</span><span class="op" id="5230714">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230723">prog</span><span class="op" id="5230727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230731">onepass</span><span class="op" id="5230738">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230744">compileOnePass</span><span class="op" id="5230758">(</span><span class="ident" id="5230759">prog</span><span class="op" id="5230763">)</span><span class="op" id="5230764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230768">numSubexp</span><span class="op" id="5230777">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5230781">maxCap</span><span class="op" id="5230787">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230791">subexpNames</span><span class="op" id="5230802">:</span>&nbsp;<span class="ident" id="5230804">capNames</span><span class="op" id="5230812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230816">cond</span><span class="op" id="5230820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230829">prog</span><span class="op" id="5230833">.</span><span class="ident" id="5230834">StartCond</span><span class="op" id="5230843">(</span><span class="op" id="5230844">)</span><span class="op" id="5230845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230849">longest</span><span class="op" id="5230856">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230862">longest</span><span class="op" id="5230869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230875">if</span>&nbsp;<span class="ident" id="5230878">regexp</span><span class="op" id="5230884">.</span><span class="ident" id="5230885">onepass</span>&nbsp;<span class="op" id="5230893">==</span>&nbsp;<span class="ident" id="5230896">notOnePass</span>&nbsp;<span class="op" id="5230907">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230911">regexp</span><span class="op" id="5230917">.</span><span class="ident" id="5230918">prefix</span><span class="op" id="5230924">,</span>&nbsp;<span class="ident" id="5230926">regexp</span><span class="op" id="5230932">.</span><span class="ident" id="5230933">prefixComplete</span>&nbsp;<span class="op" id="5230948">=</span>&nbsp;<span class="ident" id="5230950">prog</span><span class="op" id="5230954">.</span><span class="ident" id="5230955">Prefix</span><span class="op" id="5230961">(</span><span class="op" id="5230962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230965">}</span>&nbsp;<span class="keyword" id="5230967">else</span>&nbsp;<span class="op" id="5230972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230976">regexp</span><span class="op" id="5230982">.</span><span class="ident" id="5230983">prefix</span><span class="op" id="5230989">,</span>&nbsp;<span class="ident" id="5230991">regexp</span><span class="op" id="5230997">.</span><span class="ident" id="5230998">prefixComplete</span><span class="op" id="5231012">,</span>&nbsp;<span class="ident" id="5231014">regexp</span><span class="op" id="5231020">.</span><span class="ident" id="5231021">prefixEnd</span>&nbsp;<span class="op" id="5231031">=</span>&nbsp;<span class="ident" id="5231033">onePassPrefix</span><span class="op" id="5231046">(</span><span class="ident" id="5231047">prog</span><span class="op" id="5231051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231057">if</span>&nbsp;<span class="ident" id="5231060">regexp</span><span class="op" id="5231066">.</span><span class="ident" id="5231067">prefix</span>&nbsp;<span class="op" id="5231074">!=</span>&nbsp;<span class="string" id="5231077">&#34;&#34;</span>&nbsp;<span class="op" id="5231080">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231084">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231133">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231168">regexp</span><span class="op" id="5231174">.</span><span class="ident" id="5231175">prefixBytes</span>&nbsp;<span class="op" id="5231187">=</span>&nbsp;<span class="op" id="5231189">[</span><span class="op" id="5231190">]</span><span class="builtintype" id="5231191">byte</span><span class="op" id="5231195">(</span><span class="ident" id="5231196">regexp</span><span class="op" id="5231202">.</span><span class="ident" id="5231203">prefix</span><span class="op" id="5231209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231213">regexp</span><span class="op" id="5231219">.</span><span class="ident" id="5231220">prefixRune</span><span class="op" id="5231230">,</span>&nbsp;<span class="ident" id="5231232">_</span>&nbsp;<span class="op" id="5231234">=</span>&nbsp;<span class="ident" id="5231236">utf8</span><span class="op" id="5231240">.</span><span class="ident" id="5231241">DecodeRuneInString</span><span class="op" id="5231259">(</span><span class="ident" id="5231260">regexp</span><span class="op" id="5231266">.</span><span class="ident" id="5231267">prefix</span><span class="op" id="5231273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231276">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231279">return</span>&nbsp;<span class="ident" id="5231286">regexp</span><span class="op" id="5231292">,</span>&nbsp;<span class="ident" id="5231294">nil</span><br>
<span class="lineno"></span><span class="op" id="5231298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5231301">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5231350">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="5231406">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5231433">func</span>&nbsp;<span class="op" id="5231438">(</span><span class="ident" id="5231439">re</span>&nbsp;<span class="op" id="5231442">*</span><span class="ident" id="5231443">Regexp</span><span class="op" id="5231449">)</span>&nbsp;<span class="ident" id="5231451">get</span><span class="op" id="5231454">(</span><span class="op" id="5231455">)</span>&nbsp;<span class="op" id="5231457">*</span><span class="ident" id="5231458">machine</span>&nbsp;<span class="op" id="5231466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231469">re</span><span class="op" id="5231471">.</span><span class="ident" id="5231472">mu</span><span class="op" id="5231474">.</span><span class="ident" id="5231475">Lock</span><span class="op" id="5231479">(</span><span class="op" id="5231480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231483">if</span>&nbsp;<span class="ident" id="5231486">n</span>&nbsp;<span class="op" id="5231488">:=</span>&nbsp;<span class="builtinfunc" id="5231491">len</span><span class="op" id="5231494">(</span><span class="ident" id="5231495">re</span><span class="op" id="5231497">.</span><span class="ident" id="5231498">machine</span><span class="op" id="5231505">)</span><span class="op" id="5231506">;</span>&nbsp;<span class="ident" id="5231508">n</span>&nbsp;<span class="op" id="5231510">&gt;</span>&nbsp;<span class="num" id="5231512">0</span>&nbsp;<span class="op" id="5231514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231518">z</span>&nbsp;<span class="op" id="5231520">:=</span>&nbsp;<span class="ident" id="5231523">re</span><span class="op" id="5231525">.</span><span class="ident" id="5231526">machine</span><span class="op" id="5231533">[</span><span class="ident" id="5231534">n</span><span class="op" id="5231535">-</span><span class="num" id="5231536">1</span><span class="op" id="5231537">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231541">re</span><span class="op" id="5231543">.</span><span class="ident" id="5231544">machine</span>&nbsp;<span class="op" id="5231552">=</span>&nbsp;<span class="ident" id="5231554">re</span><span class="op" id="5231556">.</span><span class="ident" id="5231557">machine</span><span class="op" id="5231564">[</span><span class="op" id="5231565">:</span><span class="ident" id="5231566">n</span><span class="op" id="5231567">-</span><span class="num" id="5231568">1</span><span class="op" id="5231569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231573">re</span><span class="op" id="5231575">.</span><span class="ident" id="5231576">mu</span><span class="op" id="5231578">.</span><span class="ident" id="5231579">Unlock</span><span class="op" id="5231585">(</span><span class="op" id="5231586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231590">return</span>&nbsp;<span class="ident" id="5231597">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231603">re</span><span class="op" id="5231605">.</span><span class="ident" id="5231606">mu</span><span class="op" id="5231608">.</span><span class="ident" id="5231609">Unlock</span><span class="op" id="5231615">(</span><span class="op" id="5231616">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231619">z</span>&nbsp;<span class="op" id="5231621">:=</span>&nbsp;<span class="ident" id="5231624">progMachine</span><span class="op" id="5231635">(</span><span class="ident" id="5231636">re</span><span class="op" id="5231638">.</span><span class="ident" id="5231639">prog</span><span class="op" id="5231643">,</span>&nbsp;<span class="ident" id="5231645">re</span><span class="op" id="5231647">.</span><span class="ident" id="5231648">onepass</span><span class="op" id="5231655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231658">z</span><span class="op" id="5231659">.</span><span class="ident" id="5231660">re</span>&nbsp;<span class="op" id="5231663">=</span>&nbsp;<span class="ident" id="5231665">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231669">return</span>&nbsp;<span class="ident" id="5231676">z</span><br>
<span class="lineno"></span><span class="op" id="5231678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5231681">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="5231733">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5231799">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5231853">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="5231923">func</span>&nbsp;<span class="op" id="5231928">(</span><span class="ident" id="5231929">re</span>&nbsp;<span class="op" id="5231932">*</span><span class="ident" id="5231933">Regexp</span><span class="op" id="5231939">)</span>&nbsp;<span class="ident" id="5231941">put</span><span class="op" id="5231944">(</span><span class="ident" id="5231945">z</span>&nbsp;<span class="op" id="5231947">*</span><span class="ident" id="5231948">machine</span><span class="op" id="5231955">)</span>&nbsp;<span class="op" id="5231957">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231960">re</span><span class="op" id="5231962">.</span><span class="ident" id="5231963">mu</span><span class="op" id="5231965">.</span><span class="ident" id="5231966">Lock</span><span class="op" id="5231970">(</span><span class="op" id="5231971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231974">re</span><span class="op" id="5231976">.</span><span class="ident" id="5231977">machine</span>&nbsp;<span class="op" id="5231985">=</span>&nbsp;<span class="builtinfunc" id="5231987">append</span><span class="op" id="5231993">(</span><span class="ident" id="5231994">re</span><span class="op" id="5231996">.</span><span class="ident" id="5231997">machine</span><span class="op" id="5232004">,</span>&nbsp;<span class="ident" id="5232006">z</span><span class="op" id="5232007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232010">re</span><span class="op" id="5232012">.</span><span class="ident" id="5232013">mu</span><span class="op" id="5232015">.</span><span class="ident" id="5232016">Unlock</span><span class="op" id="5232022">(</span><span class="op" id="5232023">)</span><br>
<span class="lineno"></span><span class="op" id="5232025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5232028">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5232106">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5232188">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5232204">func</span>&nbsp;<span class="ident" id="5232209">MustCompile</span><span class="op" id="5232220">(</span><span class="ident" id="5232221">str</span>&nbsp;<span class="builtintype" id="5232225">string</span><span class="op" id="5232231">)</span>&nbsp;<span class="op" id="5232233">*</span><span class="ident" id="5232234">Regexp</span>&nbsp;<span class="op" id="5232241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232244">regexp</span><span class="op" id="5232250">,</span>&nbsp;<span class="builtintype" id="5232252">error</span>&nbsp;<span class="op" id="5232258">:=</span>&nbsp;<span class="ident" id="5232261">Compile</span><span class="op" id="5232268">(</span><span class="ident" id="5232269">str</span><span class="op" id="5232272">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232275">if</span>&nbsp;<span class="builtintype" id="5232278">error</span>&nbsp;<span class="op" id="5232284">!=</span>&nbsp;<span class="ident" id="5232287">nil</span>&nbsp;<span class="op" id="5232291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5232295">panic</span><span class="op" id="5232300">(</span><span class="string" id="5232301">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="5232320">+</span>&nbsp;<span class="ident" id="5232322">quote</span><span class="op" id="5232327">(</span><span class="ident" id="5232328">str</span><span class="op" id="5232331">)</span>&nbsp;<span class="op" id="5232333">+</span>&nbsp;<span class="string" id="5232335">`):&nbsp;`</span>&nbsp;<span class="op" id="5232341">+</span>&nbsp;<span class="builtintype" id="5232343">error</span><span class="op" id="5232348">.</span><span class="ident" id="5232349">Error</span><span class="op" id="5232354">(</span><span class="op" id="5232355">)</span><span class="op" id="5232356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232362">return</span>&nbsp;<span class="ident" id="5232369">regexp</span><br>
<span class="lineno"></span><span class="op" id="5232376">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5232379">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5232467">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5232549">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5232565">func</span>&nbsp;<span class="ident" id="5232570">MustCompilePOSIX</span><span class="op" id="5232586">(</span><span class="ident" id="5232587">str</span>&nbsp;<span class="builtintype" id="5232591">string</span><span class="op" id="5232597">)</span>&nbsp;<span class="op" id="5232599">*</span><span class="ident" id="5232600">Regexp</span>&nbsp;<span class="op" id="5232607">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232610">regexp</span><span class="op" id="5232616">,</span>&nbsp;<span class="builtintype" id="5232618">error</span>&nbsp;<span class="op" id="5232624">:=</span>&nbsp;<span class="ident" id="5232627">CompilePOSIX</span><span class="op" id="5232639">(</span><span class="ident" id="5232640">str</span><span class="op" id="5232643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232646">if</span>&nbsp;<span class="builtintype" id="5232649">error</span>&nbsp;<span class="op" id="5232655">!=</span>&nbsp;<span class="ident" id="5232658">nil</span>&nbsp;<span class="op" id="5232662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5232666">panic</span><span class="op" id="5232671">(</span><span class="string" id="5232672">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="5232696">+</span>&nbsp;<span class="ident" id="5232698">quote</span><span class="op" id="5232703">(</span><span class="ident" id="5232704">str</span><span class="op" id="5232707">)</span>&nbsp;<span class="op" id="5232709">+</span>&nbsp;<span class="string" id="5232711">`):&nbsp;`</span>&nbsp;<span class="op" id="5232717">+</span>&nbsp;<span class="builtintype" id="5232719">error</span><span class="op" id="5232724">.</span><span class="ident" id="5232725">Error</span><span class="op" id="5232730">(</span><span class="op" id="5232731">)</span><span class="op" id="5232732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232738">return</span>&nbsp;<span class="ident" id="5232745">regexp</span><br>
<span class="lineno">235</span><span class="op" id="5232752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5232755">func</span>&nbsp;<span class="ident" id="5232760">quote</span><span class="op" id="5232765">(</span><span class="ident" id="5232766">s</span>&nbsp;<span class="builtintype" id="5232768">string</span><span class="op" id="5232774">)</span>&nbsp;<span class="builtintype" id="5232776">string</span>&nbsp;<span class="op" id="5232783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232786">if</span>&nbsp;<span class="ident" id="5232789">strconv</span><span class="op" id="5232796">.</span><span class="ident" id="5232797">CanBackquote</span><span class="op" id="5232809">(</span><span class="ident" id="5232810">s</span><span class="op" id="5232811">)</span>&nbsp;<span class="op" id="5232813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232817">return</span>&nbsp;<span class="string" id="5232824">&#34;`&#34;</span>&nbsp;<span class="op" id="5232828">+</span>&nbsp;<span class="ident" id="5232830">s</span>&nbsp;<span class="op" id="5232832">+</span>&nbsp;<span class="string" id="5232834">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232842">return</span>&nbsp;<span class="ident" id="5232849">strconv</span><span class="op" id="5232856">.</span><span class="ident" id="5232857">Quote</span><span class="op" id="5232862">(</span><span class="ident" id="5232863">s</span><span class="op" id="5232864">)</span><br>
<span class="lineno"></span><span class="op" id="5232866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5232869">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="5232949">func</span>&nbsp;<span class="op" id="5232954">(</span><span class="ident" id="5232955">re</span>&nbsp;<span class="op" id="5232958">*</span><span class="ident" id="5232959">Regexp</span><span class="op" id="5232965">)</span>&nbsp;<span class="ident" id="5232967">NumSubexp</span><span class="op" id="5232976">(</span><span class="op" id="5232977">)</span>&nbsp;<span class="builtintype" id="5232979">int</span>&nbsp;<span class="op" id="5232983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232986">return</span>&nbsp;<span class="ident" id="5232993">re</span><span class="op" id="5232995">.</span><span class="ident" id="5232996">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="5233006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5233009">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="5233078">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="5233149">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="5233222">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="5233289">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="5233345">func</span>&nbsp;<span class="op" id="5233350">(</span><span class="ident" id="5233351">re</span>&nbsp;<span class="op" id="5233354">*</span><span class="ident" id="5233355">Regexp</span><span class="op" id="5233361">)</span>&nbsp;<span class="ident" id="5233363">SubexpNames</span><span class="op" id="5233374">(</span><span class="op" id="5233375">)</span>&nbsp;<span class="op" id="5233377">[</span><span class="op" id="5233378">]</span><span class="builtintype" id="5233379">string</span>&nbsp;<span class="op" id="5233386">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233389">return</span>&nbsp;<span class="ident" id="5233396">re</span><span class="op" id="5233398">.</span><span class="ident" id="5233399">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="5233411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5233414">const</span>&nbsp;<span class="ident" id="5233420">endOfText</span>&nbsp;<span class="builtintype" id="5233430">rune</span>&nbsp;<span class="op" id="5233435">=</span>&nbsp;<span class="op" id="5233437">-</span><span class="num" id="5233438">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5233441">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="5233517">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="5233545">type</span>&nbsp;<span class="ident" id="5233550">input</span>&nbsp;<span class="keyword" id="5233556">interface</span>&nbsp;<span class="op" id="5233566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233569">step</span><span class="op" id="5233573">(</span><span class="ident" id="5233574">pos</span>&nbsp;<span class="builtintype" id="5233578">int</span><span class="op" id="5233581">)</span>&nbsp;<span class="op" id="5233583">(</span><span class="ident" id="5233584">r</span>&nbsp;<span class="builtintype" id="5233586">rune</span><span class="op" id="5233590">,</span>&nbsp;<span class="ident" id="5233592">width</span>&nbsp;<span class="builtintype" id="5233598">int</span><span class="op" id="5233601">)</span>&nbsp;<span class="comment" id="5233603">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233624">canCheckPrefix</span><span class="op" id="5233638">(</span><span class="op" id="5233639">)</span>&nbsp;<span class="builtintype" id="5233641">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233658">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233701">hasPrefix</span><span class="op" id="5233710">(</span><span class="ident" id="5233711">re</span>&nbsp;<span class="op" id="5233714">*</span><span class="ident" id="5233715">Regexp</span><span class="op" id="5233721">)</span>&nbsp;<span class="builtintype" id="5233723">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233729">index</span><span class="op" id="5233734">(</span><span class="ident" id="5233735">re</span>&nbsp;<span class="op" id="5233738">*</span><span class="ident" id="5233739">Regexp</span><span class="op" id="5233745">,</span>&nbsp;<span class="ident" id="5233747">pos</span>&nbsp;<span class="builtintype" id="5233751">int</span><span class="op" id="5233754">)</span>&nbsp;<span class="builtintype" id="5233756">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233761">context</span><span class="op" id="5233768">(</span><span class="ident" id="5233769">pos</span>&nbsp;<span class="builtintype" id="5233773">int</span><span class="op" id="5233776">)</span>&nbsp;<span class="ident" id="5233778">syntax</span><span class="op" id="5233784">.</span><span class="ident" id="5233785">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="5233793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5233796">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5233827">type</span>&nbsp;<span class="ident" id="5233832">inputString</span>&nbsp;<span class="keyword" id="5233844">struct</span>&nbsp;<span class="op" id="5233851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233854">str</span>&nbsp;<span class="builtintype" id="5233858">string</span><br>
<span class="lineno"></span><span class="op" id="5233865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5233868">func</span>&nbsp;<span class="op" id="5233873">(</span><span class="ident" id="5233874">i</span>&nbsp;<span class="op" id="5233876">*</span><span class="ident" id="5233877">inputString</span><span class="op" id="5233888">)</span>&nbsp;<span class="ident" id="5233890">step</span><span class="op" id="5233894">(</span><span class="ident" id="5233895">pos</span>&nbsp;<span class="builtintype" id="5233899">int</span><span class="op" id="5233902">)</span>&nbsp;<span class="op" id="5233904">(</span><span class="builtintype" id="5233905">rune</span><span class="op" id="5233909">,</span>&nbsp;<span class="builtintype" id="5233911">int</span><span class="op" id="5233914">)</span>&nbsp;<span class="op" id="5233916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233919">if</span>&nbsp;<span class="ident" id="5233922">pos</span>&nbsp;<span class="op" id="5233926">&lt;</span>&nbsp;<span class="builtinfunc" id="5233928">len</span><span class="op" id="5233931">(</span><span class="ident" id="5233932">i</span><span class="op" id="5233933">.</span><span class="ident" id="5233934">str</span><span class="op" id="5233937">)</span>&nbsp;<span class="op" id="5233939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233943">c</span>&nbsp;<span class="op" id="5233945">:=</span>&nbsp;<span class="ident" id="5233948">i</span><span class="op" id="5233949">.</span><span class="ident" id="5233950">str</span><span class="op" id="5233953">[</span><span class="ident" id="5233954">pos</span><span class="op" id="5233957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233961">if</span>&nbsp;<span class="ident" id="5233964">c</span>&nbsp;<span class="op" id="5233966">&lt;</span>&nbsp;<span class="ident" id="5233968">utf8</span><span class="op" id="5233972">.</span><span class="ident" id="5233973">RuneSelf</span>&nbsp;<span class="op" id="5233982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233987">return</span>&nbsp;<span class="builtintype" id="5233994">rune</span><span class="op" id="5233998">(</span><span class="ident" id="5233999">c</span><span class="op" id="5234000">)</span><span class="op" id="5234001">,</span>&nbsp;<span class="num" id="5234003">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234011">return</span>&nbsp;<span class="ident" id="5234018">utf8</span><span class="op" id="5234022">.</span><span class="ident" id="5234023">DecodeRuneInString</span><span class="op" id="5234041">(</span><span class="ident" id="5234042">i</span><span class="op" id="5234043">.</span><span class="ident" id="5234044">str</span><span class="op" id="5234047">[</span><span class="ident" id="5234048">pos</span><span class="op" id="5234051">:</span><span class="op" id="5234052">]</span><span class="op" id="5234053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234059">return</span>&nbsp;<span class="ident" id="5234066">endOfText</span><span class="op" id="5234075">,</span>&nbsp;<span class="num" id="5234077">0</span><br>
<span class="lineno"></span><span class="op" id="5234079">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5234082">func</span>&nbsp;<span class="op" id="5234087">(</span><span class="ident" id="5234088">i</span>&nbsp;<span class="op" id="5234090">*</span><span class="ident" id="5234091">inputString</span><span class="op" id="5234102">)</span>&nbsp;<span class="ident" id="5234104">canCheckPrefix</span><span class="op" id="5234118">(</span><span class="op" id="5234119">)</span>&nbsp;<span class="builtintype" id="5234121">bool</span>&nbsp;<span class="op" id="5234126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234129">return</span>&nbsp;<span class="builtintype" id="5234136">true</span><br>
<span class="lineno"></span><span class="op" id="5234141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="5234144">func</span>&nbsp;<span class="op" id="5234149">(</span><span class="ident" id="5234150">i</span>&nbsp;<span class="op" id="5234152">*</span><span class="ident" id="5234153">inputString</span><span class="op" id="5234164">)</span>&nbsp;<span class="ident" id="5234166">hasPrefix</span><span class="op" id="5234175">(</span><span class="ident" id="5234176">re</span>&nbsp;<span class="op" id="5234179">*</span><span class="ident" id="5234180">Regexp</span><span class="op" id="5234186">)</span>&nbsp;<span class="builtintype" id="5234188">bool</span>&nbsp;<span class="op" id="5234193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234196">return</span>&nbsp;<span class="ident" id="5234203">strings</span><span class="op" id="5234210">.</span><span class="ident" id="5234211">HasPrefix</span><span class="op" id="5234220">(</span><span class="ident" id="5234221">i</span><span class="op" id="5234222">.</span><span class="ident" id="5234223">str</span><span class="op" id="5234226">,</span>&nbsp;<span class="ident" id="5234228">re</span><span class="op" id="5234230">.</span><span class="ident" id="5234231">prefix</span><span class="op" id="5234237">)</span><br>
<span class="lineno"></span><span class="op" id="5234239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5234242">func</span>&nbsp;<span class="op" id="5234247">(</span><span class="ident" id="5234248">i</span>&nbsp;<span class="op" id="5234250">*</span><span class="ident" id="5234251">inputString</span><span class="op" id="5234262">)</span>&nbsp;<span class="ident" id="5234264">index</span><span class="op" id="5234269">(</span><span class="ident" id="5234270">re</span>&nbsp;<span class="op" id="5234273">*</span><span class="ident" id="5234274">Regexp</span><span class="op" id="5234280">,</span>&nbsp;<span class="ident" id="5234282">pos</span>&nbsp;<span class="builtintype" id="5234286">int</span><span class="op" id="5234289">)</span>&nbsp;<span class="builtintype" id="5234291">int</span>&nbsp;<span class="op" id="5234295">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234298">return</span>&nbsp;<span class="ident" id="5234305">strings</span><span class="op" id="5234312">.</span><span class="ident" id="5234313">Index</span><span class="op" id="5234318">(</span><span class="ident" id="5234319">i</span><span class="op" id="5234320">.</span><span class="ident" id="5234321">str</span><span class="op" id="5234324">[</span><span class="ident" id="5234325">pos</span><span class="op" id="5234328">:</span><span class="op" id="5234329">]</span><span class="op" id="5234330">,</span>&nbsp;<span class="ident" id="5234332">re</span><span class="op" id="5234334">.</span><span class="ident" id="5234335">prefix</span><span class="op" id="5234341">)</span><br>
<span class="lineno"></span><span class="op" id="5234343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5234346">func</span>&nbsp;<span class="op" id="5234351">(</span><span class="ident" id="5234352">i</span>&nbsp;<span class="op" id="5234354">*</span><span class="ident" id="5234355">inputString</span><span class="op" id="5234366">)</span>&nbsp;<span class="ident" id="5234368">context</span><span class="op" id="5234375">(</span><span class="ident" id="5234376">pos</span>&nbsp;<span class="builtintype" id="5234380">int</span><span class="op" id="5234383">)</span>&nbsp;<span class="ident" id="5234385">syntax</span><span class="op" id="5234391">.</span><span class="ident" id="5234392">EmptyOp</span>&nbsp;<span class="op" id="5234400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234403">r1</span><span class="op" id="5234405">,</span>&nbsp;<span class="ident" id="5234407">r2</span>&nbsp;<span class="op" id="5234410">:=</span>&nbsp;<span class="ident" id="5234413">endOfText</span><span class="op" id="5234422">,</span>&nbsp;<span class="ident" id="5234424">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234435">if</span>&nbsp;<span class="ident" id="5234438">pos</span>&nbsp;<span class="op" id="5234442">&gt;</span>&nbsp;<span class="num" id="5234444">0</span>&nbsp;<span class="op" id="5234446">&amp;&amp;</span>&nbsp;<span class="ident" id="5234449">pos</span>&nbsp;<span class="op" id="5234453">&lt;=</span>&nbsp;<span class="builtinfunc" id="5234456">len</span><span class="op" id="5234459">(</span><span class="ident" id="5234460">i</span><span class="op" id="5234461">.</span><span class="ident" id="5234462">str</span><span class="op" id="5234465">)</span>&nbsp;<span class="op" id="5234467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234471">r1</span><span class="op" id="5234473">,</span>&nbsp;<span class="ident" id="5234475">_</span>&nbsp;<span class="op" id="5234477">=</span>&nbsp;<span class="ident" id="5234479">utf8</span><span class="op" id="5234483">.</span><span class="ident" id="5234484">DecodeLastRuneInString</span><span class="op" id="5234506">(</span><span class="ident" id="5234507">i</span><span class="op" id="5234508">.</span><span class="ident" id="5234509">str</span><span class="op" id="5234512">[</span><span class="op" id="5234513">:</span><span class="ident" id="5234514">pos</span><span class="op" id="5234517">]</span><span class="op" id="5234518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234524">if</span>&nbsp;<span class="ident" id="5234527">pos</span>&nbsp;<span class="op" id="5234531">&lt;</span>&nbsp;<span class="builtinfunc" id="5234533">len</span><span class="op" id="5234536">(</span><span class="ident" id="5234537">i</span><span class="op" id="5234538">.</span><span class="ident" id="5234539">str</span><span class="op" id="5234542">)</span>&nbsp;<span class="op" id="5234544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234548">r2</span><span class="op" id="5234550">,</span>&nbsp;<span class="ident" id="5234552">_</span>&nbsp;<span class="op" id="5234554">=</span>&nbsp;<span class="ident" id="5234556">utf8</span><span class="op" id="5234560">.</span><span class="ident" id="5234561">DecodeRuneInString</span><span class="op" id="5234579">(</span><span class="ident" id="5234580">i</span><span class="op" id="5234581">.</span><span class="ident" id="5234582">str</span><span class="op" id="5234585">[</span><span class="ident" id="5234586">pos</span><span class="op" id="5234589">:</span><span class="op" id="5234590">]</span><span class="op" id="5234591">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234597">return</span>&nbsp;<span class="ident" id="5234604">syntax</span><span class="op" id="5234610">.</span><span class="ident" id="5234611">EmptyOpContext</span><span class="op" id="5234625">(</span><span class="ident" id="5234626">r1</span><span class="op" id="5234628">,</span>&nbsp;<span class="ident" id="5234630">r2</span><span class="op" id="5234632">)</span><br>
<span class="lineno"></span><span class="op" id="5234634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5234637">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="5234671">type</span>&nbsp;<span class="ident" id="5234676">inputBytes</span>&nbsp;<span class="keyword" id="5234687">struct</span>&nbsp;<span class="op" id="5234694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234697">str</span>&nbsp;<span class="op" id="5234701">[</span><span class="op" id="5234702">]</span><span class="builtintype" id="5234703">byte</span><br>
<span class="lineno"></span><span class="op" id="5234708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5234711">func</span>&nbsp;<span class="op" id="5234716">(</span><span class="ident" id="5234717">i</span>&nbsp;<span class="op" id="5234719">*</span><span class="ident" id="5234720">inputBytes</span><span class="op" id="5234730">)</span>&nbsp;<span class="ident" id="5234732">step</span><span class="op" id="5234736">(</span><span class="ident" id="5234737">pos</span>&nbsp;<span class="builtintype" id="5234741">int</span><span class="op" id="5234744">)</span>&nbsp;<span class="op" id="5234746">(</span><span class="builtintype" id="5234747">rune</span><span class="op" id="5234751">,</span>&nbsp;<span class="builtintype" id="5234753">int</span><span class="op" id="5234756">)</span>&nbsp;<span class="op" id="5234758">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234761">if</span>&nbsp;<span class="ident" id="5234764">pos</span>&nbsp;<span class="op" id="5234768">&lt;</span>&nbsp;<span class="builtinfunc" id="5234770">len</span><span class="op" id="5234773">(</span><span class="ident" id="5234774">i</span><span class="op" id="5234775">.</span><span class="ident" id="5234776">str</span><span class="op" id="5234779">)</span>&nbsp;<span class="op" id="5234781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234785">c</span>&nbsp;<span class="op" id="5234787">:=</span>&nbsp;<span class="ident" id="5234790">i</span><span class="op" id="5234791">.</span><span class="ident" id="5234792">str</span><span class="op" id="5234795">[</span><span class="ident" id="5234796">pos</span><span class="op" id="5234799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234803">if</span>&nbsp;<span class="ident" id="5234806">c</span>&nbsp;<span class="op" id="5234808">&lt;</span>&nbsp;<span class="ident" id="5234810">utf8</span><span class="op" id="5234814">.</span><span class="ident" id="5234815">RuneSelf</span>&nbsp;<span class="op" id="5234824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234829">return</span>&nbsp;<span class="builtintype" id="5234836">rune</span><span class="op" id="5234840">(</span><span class="ident" id="5234841">c</span><span class="op" id="5234842">)</span><span class="op" id="5234843">,</span>&nbsp;<span class="num" id="5234845">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234849">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234853">return</span>&nbsp;<span class="ident" id="5234860">utf8</span><span class="op" id="5234864">.</span><span class="ident" id="5234865">DecodeRune</span><span class="op" id="5234875">(</span><span class="ident" id="5234876">i</span><span class="op" id="5234877">.</span><span class="ident" id="5234878">str</span><span class="op" id="5234881">[</span><span class="ident" id="5234882">pos</span><span class="op" id="5234885">:</span><span class="op" id="5234886">]</span><span class="op" id="5234887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234893">return</span>&nbsp;<span class="ident" id="5234900">endOfText</span><span class="op" id="5234909">,</span>&nbsp;<span class="num" id="5234911">0</span><br>
<span class="lineno"></span><span class="op" id="5234913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="5234916">func</span>&nbsp;<span class="op" id="5234921">(</span><span class="ident" id="5234922">i</span>&nbsp;<span class="op" id="5234924">*</span><span class="ident" id="5234925">inputBytes</span><span class="op" id="5234935">)</span>&nbsp;<span class="ident" id="5234937">canCheckPrefix</span><span class="op" id="5234951">(</span><span class="op" id="5234952">)</span>&nbsp;<span class="builtintype" id="5234954">bool</span>&nbsp;<span class="op" id="5234959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234962">return</span>&nbsp;<span class="builtintype" id="5234969">true</span><br>
<span class="lineno"></span><span class="op" id="5234974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5234977">func</span>&nbsp;<span class="op" id="5234982">(</span><span class="ident" id="5234983">i</span>&nbsp;<span class="op" id="5234985">*</span><span class="ident" id="5234986">inputBytes</span><span class="op" id="5234996">)</span>&nbsp;<span class="ident" id="5234998">hasPrefix</span><span class="op" id="5235007">(</span><span class="ident" id="5235008">re</span>&nbsp;<span class="op" id="5235011">*</span><span class="ident" id="5235012">Regexp</span><span class="op" id="5235018">)</span>&nbsp;<span class="builtintype" id="5235020">bool</span>&nbsp;<span class="op" id="5235025">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235028">return</span>&nbsp;<span class="ident" id="5235035">bytes</span><span class="op" id="5235040">.</span><span class="ident" id="5235041">HasPrefix</span><span class="op" id="5235050">(</span><span class="ident" id="5235051">i</span><span class="op" id="5235052">.</span><span class="ident" id="5235053">str</span><span class="op" id="5235056">,</span>&nbsp;<span class="ident" id="5235058">re</span><span class="op" id="5235060">.</span><span class="ident" id="5235061">prefixBytes</span><span class="op" id="5235072">)</span><br>
<span class="lineno"></span><span class="op" id="5235074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235077">func</span>&nbsp;<span class="op" id="5235082">(</span><span class="ident" id="5235083">i</span>&nbsp;<span class="op" id="5235085">*</span><span class="ident" id="5235086">inputBytes</span><span class="op" id="5235096">)</span>&nbsp;<span class="ident" id="5235098">index</span><span class="op" id="5235103">(</span><span class="ident" id="5235104">re</span>&nbsp;<span class="op" id="5235107">*</span><span class="ident" id="5235108">Regexp</span><span class="op" id="5235114">,</span>&nbsp;<span class="ident" id="5235116">pos</span>&nbsp;<span class="builtintype" id="5235120">int</span><span class="op" id="5235123">)</span>&nbsp;<span class="builtintype" id="5235125">int</span>&nbsp;<span class="op" id="5235129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235132">return</span>&nbsp;<span class="ident" id="5235139">bytes</span><span class="op" id="5235144">.</span><span class="ident" id="5235145">Index</span><span class="op" id="5235150">(</span><span class="ident" id="5235151">i</span><span class="op" id="5235152">.</span><span class="ident" id="5235153">str</span><span class="op" id="5235156">[</span><span class="ident" id="5235157">pos</span><span class="op" id="5235160">:</span><span class="op" id="5235161">]</span><span class="op" id="5235162">,</span>&nbsp;<span class="ident" id="5235164">re</span><span class="op" id="5235166">.</span><span class="ident" id="5235167">prefixBytes</span><span class="op" id="5235178">)</span><br>
<span class="lineno">335</span><span class="op" id="5235180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235183">func</span>&nbsp;<span class="op" id="5235188">(</span><span class="ident" id="5235189">i</span>&nbsp;<span class="op" id="5235191">*</span><span class="ident" id="5235192">inputBytes</span><span class="op" id="5235202">)</span>&nbsp;<span class="ident" id="5235204">context</span><span class="op" id="5235211">(</span><span class="ident" id="5235212">pos</span>&nbsp;<span class="builtintype" id="5235216">int</span><span class="op" id="5235219">)</span>&nbsp;<span class="ident" id="5235221">syntax</span><span class="op" id="5235227">.</span><span class="ident" id="5235228">EmptyOp</span>&nbsp;<span class="op" id="5235236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235239">r1</span><span class="op" id="5235241">,</span>&nbsp;<span class="ident" id="5235243">r2</span>&nbsp;<span class="op" id="5235246">:=</span>&nbsp;<span class="ident" id="5235249">endOfText</span><span class="op" id="5235258">,</span>&nbsp;<span class="ident" id="5235260">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235271">if</span>&nbsp;<span class="ident" id="5235274">pos</span>&nbsp;<span class="op" id="5235278">&gt;</span>&nbsp;<span class="num" id="5235280">0</span>&nbsp;<span class="op" id="5235282">&amp;&amp;</span>&nbsp;<span class="ident" id="5235285">pos</span>&nbsp;<span class="op" id="5235289">&lt;=</span>&nbsp;<span class="builtinfunc" id="5235292">len</span><span class="op" id="5235295">(</span><span class="ident" id="5235296">i</span><span class="op" id="5235297">.</span><span class="ident" id="5235298">str</span><span class="op" id="5235301">)</span>&nbsp;<span class="op" id="5235303">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235307">r1</span><span class="op" id="5235309">,</span>&nbsp;<span class="ident" id="5235311">_</span>&nbsp;<span class="op" id="5235313">=</span>&nbsp;<span class="ident" id="5235315">utf8</span><span class="op" id="5235319">.</span><span class="ident" id="5235320">DecodeLastRune</span><span class="op" id="5235334">(</span><span class="ident" id="5235335">i</span><span class="op" id="5235336">.</span><span class="ident" id="5235337">str</span><span class="op" id="5235340">[</span><span class="op" id="5235341">:</span><span class="ident" id="5235342">pos</span><span class="op" id="5235345">]</span><span class="op" id="5235346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235352">if</span>&nbsp;<span class="ident" id="5235355">pos</span>&nbsp;<span class="op" id="5235359">&lt;</span>&nbsp;<span class="builtinfunc" id="5235361">len</span><span class="op" id="5235364">(</span><span class="ident" id="5235365">i</span><span class="op" id="5235366">.</span><span class="ident" id="5235367">str</span><span class="op" id="5235370">)</span>&nbsp;<span class="op" id="5235372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235376">r2</span><span class="op" id="5235378">,</span>&nbsp;<span class="ident" id="5235380">_</span>&nbsp;<span class="op" id="5235382">=</span>&nbsp;<span class="ident" id="5235384">utf8</span><span class="op" id="5235388">.</span><span class="ident" id="5235389">DecodeRune</span><span class="op" id="5235399">(</span><span class="ident" id="5235400">i</span><span class="op" id="5235401">.</span><span class="ident" id="5235402">str</span><span class="op" id="5235405">[</span><span class="ident" id="5235406">pos</span><span class="op" id="5235409">:</span><span class="op" id="5235410">]</span><span class="op" id="5235411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235414">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235417">return</span>&nbsp;<span class="ident" id="5235424">syntax</span><span class="op" id="5235430">.</span><span class="ident" id="5235431">EmptyOpContext</span><span class="op" id="5235445">(</span><span class="ident" id="5235446">r1</span><span class="op" id="5235448">,</span>&nbsp;<span class="ident" id="5235450">r2</span><span class="op" id="5235452">)</span><br>
<span class="lineno"></span><span class="op" id="5235454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5235457">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5235492">type</span>&nbsp;<span class="ident" id="5235497">inputReader</span>&nbsp;<span class="keyword" id="5235509">struct</span>&nbsp;<span class="op" id="5235516">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235519">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235525">io</span><span class="op" id="5235527">.</span><span class="ident" id="5235528">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235540">atEOT</span>&nbsp;<span class="builtintype" id="5235546">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235552">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5235558">int</span><br>
<span class="lineno"></span><span class="op" id="5235562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5235565">func</span>&nbsp;<span class="op" id="5235570">(</span><span class="ident" id="5235571">i</span>&nbsp;<span class="op" id="5235573">*</span><span class="ident" id="5235574">inputReader</span><span class="op" id="5235585">)</span>&nbsp;<span class="ident" id="5235587">step</span><span class="op" id="5235591">(</span><span class="ident" id="5235592">pos</span>&nbsp;<span class="builtintype" id="5235596">int</span><span class="op" id="5235599">)</span>&nbsp;<span class="op" id="5235601">(</span><span class="builtintype" id="5235602">rune</span><span class="op" id="5235606">,</span>&nbsp;<span class="builtintype" id="5235608">int</span><span class="op" id="5235611">)</span>&nbsp;<span class="op" id="5235613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235616">if</span>&nbsp;<span class="op" id="5235619">!</span><span class="ident" id="5235620">i</span><span class="op" id="5235621">.</span><span class="ident" id="5235622">atEOT</span>&nbsp;<span class="op" id="5235628">&amp;&amp;</span>&nbsp;<span class="ident" id="5235631">pos</span>&nbsp;<span class="op" id="5235635">!=</span>&nbsp;<span class="ident" id="5235638">i</span><span class="op" id="5235639">.</span><span class="ident" id="5235640">pos</span>&nbsp;<span class="op" id="5235644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235648">return</span>&nbsp;<span class="ident" id="5235655">endOfText</span><span class="op" id="5235664">,</span>&nbsp;<span class="num" id="5235666">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235670">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235673">r</span><span class="op" id="5235674">,</span>&nbsp;<span class="ident" id="5235676">w</span><span class="op" id="5235677">,</span>&nbsp;<span class="ident" id="5235679">err</span>&nbsp;<span class="op" id="5235683">:=</span>&nbsp;<span class="ident" id="5235686">i</span><span class="op" id="5235687">.</span><span class="ident" id="5235688">r</span><span class="op" id="5235689">.</span><span class="ident" id="5235690">ReadRune</span><span class="op" id="5235698">(</span><span class="op" id="5235699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235702">if</span>&nbsp;<span class="ident" id="5235705">err</span>&nbsp;<span class="op" id="5235709">!=</span>&nbsp;<span class="ident" id="5235712">nil</span>&nbsp;<span class="op" id="5235716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235720">i</span><span class="op" id="5235721">.</span><span class="ident" id="5235722">atEOT</span>&nbsp;<span class="op" id="5235728">=</span>&nbsp;<span class="builtintype" id="5235730">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235737">return</span>&nbsp;<span class="ident" id="5235744">endOfText</span><span class="op" id="5235753">,</span>&nbsp;<span class="num" id="5235755">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235758">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235761">i</span><span class="op" id="5235762">.</span><span class="ident" id="5235763">pos</span>&nbsp;<span class="op" id="5235767">+=</span>&nbsp;<span class="ident" id="5235770">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235773">return</span>&nbsp;<span class="ident" id="5235780">r</span><span class="op" id="5235781">,</span>&nbsp;<span class="ident" id="5235783">w</span><br>
<span class="lineno"></span><span class="op" id="5235785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235788">func</span>&nbsp;<span class="op" id="5235793">(</span><span class="ident" id="5235794">i</span>&nbsp;<span class="op" id="5235796">*</span><span class="ident" id="5235797">inputReader</span><span class="op" id="5235808">)</span>&nbsp;<span class="ident" id="5235810">canCheckPrefix</span><span class="op" id="5235824">(</span><span class="op" id="5235825">)</span>&nbsp;<span class="builtintype" id="5235827">bool</span>&nbsp;<span class="op" id="5235832">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235835">return</span>&nbsp;<span class="builtintype" id="5235842">false</span><br>
<span class="lineno"></span><span class="op" id="5235848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235851">func</span>&nbsp;<span class="op" id="5235856">(</span><span class="ident" id="5235857">i</span>&nbsp;<span class="op" id="5235859">*</span><span class="ident" id="5235860">inputReader</span><span class="op" id="5235871">)</span>&nbsp;<span class="ident" id="5235873">hasPrefix</span><span class="op" id="5235882">(</span><span class="ident" id="5235883">re</span>&nbsp;<span class="op" id="5235886">*</span><span class="ident" id="5235887">Regexp</span><span class="op" id="5235893">)</span>&nbsp;<span class="builtintype" id="5235895">bool</span>&nbsp;<span class="op" id="5235900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235903">return</span>&nbsp;<span class="builtintype" id="5235910">false</span><br>
<span class="lineno">375</span><span class="op" id="5235916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235919">func</span>&nbsp;<span class="op" id="5235924">(</span><span class="ident" id="5235925">i</span>&nbsp;<span class="op" id="5235927">*</span><span class="ident" id="5235928">inputReader</span><span class="op" id="5235939">)</span>&nbsp;<span class="ident" id="5235941">index</span><span class="op" id="5235946">(</span><span class="ident" id="5235947">re</span>&nbsp;<span class="op" id="5235950">*</span><span class="ident" id="5235951">Regexp</span><span class="op" id="5235957">,</span>&nbsp;<span class="ident" id="5235959">pos</span>&nbsp;<span class="builtintype" id="5235963">int</span><span class="op" id="5235966">)</span>&nbsp;<span class="builtintype" id="5235968">int</span>&nbsp;<span class="op" id="5235972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235975">return</span>&nbsp;<span class="op" id="5235982">-</span><span class="num" id="5235983">1</span><br>
<span class="lineno"></span><span class="op" id="5235985">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5235988">func</span>&nbsp;<span class="op" id="5235993">(</span><span class="ident" id="5235994">i</span>&nbsp;<span class="op" id="5235996">*</span><span class="ident" id="5235997">inputReader</span><span class="op" id="5236008">)</span>&nbsp;<span class="ident" id="5236010">context</span><span class="op" id="5236017">(</span><span class="ident" id="5236018">pos</span>&nbsp;<span class="builtintype" id="5236022">int</span><span class="op" id="5236025">)</span>&nbsp;<span class="ident" id="5236027">syntax</span><span class="op" id="5236033">.</span><span class="ident" id="5236034">EmptyOp</span>&nbsp;<span class="op" id="5236042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236045">return</span>&nbsp;<span class="num" id="5236052">0</span><br>
<span class="lineno"></span><span class="op" id="5236054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5236057">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5236125">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5236194">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5236253">func</span>&nbsp;<span class="op" id="5236258">(</span><span class="ident" id="5236259">re</span>&nbsp;<span class="op" id="5236262">*</span><span class="ident" id="5236263">Regexp</span><span class="op" id="5236269">)</span>&nbsp;<span class="ident" id="5236271">LiteralPrefix</span><span class="op" id="5236284">(</span><span class="op" id="5236285">)</span>&nbsp;<span class="op" id="5236287">(</span><span class="ident" id="5236288">prefix</span>&nbsp;<span class="builtintype" id="5236295">string</span><span class="op" id="5236301">,</span>&nbsp;<span class="ident" id="5236303">complete</span>&nbsp;<span class="builtintype" id="5236312">bool</span><span class="op" id="5236316">)</span>&nbsp;<span class="op" id="5236318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236321">return</span>&nbsp;<span class="ident" id="5236328">re</span><span class="op" id="5236330">.</span><span class="ident" id="5236331">prefix</span><span class="op" id="5236337">,</span>&nbsp;<span class="ident" id="5236339">re</span><span class="op" id="5236341">.</span><span class="ident" id="5236342">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="5236357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5236360">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5236431">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5236446">func</span>&nbsp;<span class="op" id="5236451">(</span><span class="ident" id="5236452">re</span>&nbsp;<span class="op" id="5236455">*</span><span class="ident" id="5236456">Regexp</span><span class="op" id="5236462">)</span>&nbsp;<span class="ident" id="5236464">MatchReader</span><span class="op" id="5236475">(</span><span class="ident" id="5236476">r</span>&nbsp;<span class="ident" id="5236478">io</span><span class="op" id="5236480">.</span><span class="ident" id="5236481">RuneReader</span><span class="op" id="5236491">)</span>&nbsp;<span class="builtintype" id="5236493">bool</span>&nbsp;<span class="op" id="5236498">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236501">return</span>&nbsp;<span class="ident" id="5236508">re</span><span class="op" id="5236510">.</span><span class="ident" id="5236511">doExecute</span><span class="op" id="5236520">(</span><span class="ident" id="5236521">r</span><span class="op" id="5236522">,</span>&nbsp;<span class="ident" id="5236524">nil</span><span class="op" id="5236527">,</span>&nbsp;<span class="string" id="5236529">&#34;&#34;</span><span class="op" id="5236531">,</span>&nbsp;<span class="num" id="5236533">0</span><span class="op" id="5236534">,</span>&nbsp;<span class="num" id="5236536">0</span><span class="op" id="5236537">)</span>&nbsp;<span class="op" id="5236539">!=</span>&nbsp;<span class="ident" id="5236542">nil</span><br>
<span class="lineno"></span><span class="op" id="5236546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5236549">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5236613">func</span>&nbsp;<span class="op" id="5236618">(</span><span class="ident" id="5236619">re</span>&nbsp;<span class="op" id="5236622">*</span><span class="ident" id="5236623">Regexp</span><span class="op" id="5236629">)</span>&nbsp;<span class="ident" id="5236631">MatchString</span><span class="op" id="5236642">(</span><span class="ident" id="5236643">s</span>&nbsp;<span class="builtintype" id="5236645">string</span><span class="op" id="5236651">)</span>&nbsp;<span class="builtintype" id="5236653">bool</span>&nbsp;<span class="op" id="5236658">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236661">return</span>&nbsp;<span class="ident" id="5236668">re</span><span class="op" id="5236670">.</span><span class="ident" id="5236671">doExecute</span><span class="op" id="5236680">(</span><span class="ident" id="5236681">nil</span><span class="op" id="5236684">,</span>&nbsp;<span class="ident" id="5236686">nil</span><span class="op" id="5236689">,</span>&nbsp;<span class="ident" id="5236691">s</span><span class="op" id="5236692">,</span>&nbsp;<span class="num" id="5236694">0</span><span class="op" id="5236695">,</span>&nbsp;<span class="num" id="5236697">0</span><span class="op" id="5236698">)</span>&nbsp;<span class="op" id="5236700">!=</span>&nbsp;<span class="ident" id="5236703">nil</span><br>
<span class="lineno"></span><span class="op" id="5236707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5236710">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5236772">func</span>&nbsp;<span class="op" id="5236777">(</span><span class="ident" id="5236778">re</span>&nbsp;<span class="op" id="5236781">*</span><span class="ident" id="5236782">Regexp</span><span class="op" id="5236788">)</span>&nbsp;<span class="ident" id="5236790">Match</span><span class="op" id="5236795">(</span><span class="ident" id="5236796">b</span>&nbsp;<span class="op" id="5236798">[</span><span class="op" id="5236799">]</span><span class="builtintype" id="5236800">byte</span><span class="op" id="5236804">)</span>&nbsp;<span class="builtintype" id="5236806">bool</span>&nbsp;<span class="op" id="5236811">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236814">return</span>&nbsp;<span class="ident" id="5236821">re</span><span class="op" id="5236823">.</span><span class="ident" id="5236824">doExecute</span><span class="op" id="5236833">(</span><span class="ident" id="5236834">nil</span><span class="op" id="5236837">,</span>&nbsp;<span class="ident" id="5236839">b</span><span class="op" id="5236840">,</span>&nbsp;<span class="string" id="5236842">&#34;&#34;</span><span class="op" id="5236844">,</span>&nbsp;<span class="num" id="5236846">0</span><span class="op" id="5236847">,</span>&nbsp;<span class="num" id="5236849">0</span><span class="op" id="5236850">)</span>&nbsp;<span class="op" id="5236852">!=</span>&nbsp;<span class="ident" id="5236855">nil</span><br>
<span class="lineno"></span><span class="op" id="5236859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5236862">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="5236938">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="5237015">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5237045">func</span>&nbsp;<span class="ident" id="5237050">MatchReader</span><span class="op" id="5237061">(</span><span class="ident" id="5237062">pattern</span>&nbsp;<span class="builtintype" id="5237070">string</span><span class="op" id="5237076">,</span>&nbsp;<span class="ident" id="5237078">r</span>&nbsp;<span class="ident" id="5237080">io</span><span class="op" id="5237082">.</span><span class="ident" id="5237083">RuneReader</span><span class="op" id="5237093">)</span>&nbsp;<span class="op" id="5237095">(</span><span class="ident" id="5237096">matched</span>&nbsp;<span class="builtintype" id="5237104">bool</span><span class="op" id="5237108">,</span>&nbsp;<span class="ident" id="5237110">err</span>&nbsp;<span class="builtintype" id="5237114">error</span><span class="op" id="5237119">)</span>&nbsp;<span class="op" id="5237121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237124">re</span><span class="op" id="5237126">,</span>&nbsp;<span class="ident" id="5237128">err</span>&nbsp;<span class="op" id="5237132">:=</span>&nbsp;<span class="ident" id="5237135">Compile</span><span class="op" id="5237142">(</span><span class="ident" id="5237143">pattern</span><span class="op" id="5237150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237153">if</span>&nbsp;<span class="ident" id="5237156">err</span>&nbsp;<span class="op" id="5237160">!=</span>&nbsp;<span class="ident" id="5237163">nil</span>&nbsp;<span class="op" id="5237167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237171">return</span>&nbsp;<span class="builtintype" id="5237178">false</span><span class="op" id="5237183">,</span>&nbsp;<span class="ident" id="5237185">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237193">return</span>&nbsp;<span class="ident" id="5237200">re</span><span class="op" id="5237202">.</span><span class="ident" id="5237203">MatchReader</span><span class="op" id="5237214">(</span><span class="ident" id="5237215">r</span><span class="op" id="5237216">)</span><span class="op" id="5237217">,</span>&nbsp;<span class="ident" id="5237219">nil</span><br>
<span class="lineno"></span><span class="op" id="5237223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5237226">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="5237285">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5237337">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5237386">func</span>&nbsp;<span class="ident" id="5237391">MatchString</span><span class="op" id="5237402">(</span><span class="ident" id="5237403">pattern</span>&nbsp;<span class="builtintype" id="5237411">string</span><span class="op" id="5237417">,</span>&nbsp;<span class="ident" id="5237419">s</span>&nbsp;<span class="builtintype" id="5237421">string</span><span class="op" id="5237427">)</span>&nbsp;<span class="op" id="5237429">(</span><span class="ident" id="5237430">matched</span>&nbsp;<span class="builtintype" id="5237438">bool</span><span class="op" id="5237442">,</span>&nbsp;<span class="ident" id="5237444">err</span>&nbsp;<span class="builtintype" id="5237448">error</span><span class="op" id="5237453">)</span>&nbsp;<span class="op" id="5237455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237458">re</span><span class="op" id="5237460">,</span>&nbsp;<span class="ident" id="5237462">err</span>&nbsp;<span class="op" id="5237466">:=</span>&nbsp;<span class="ident" id="5237469">Compile</span><span class="op" id="5237476">(</span><span class="ident" id="5237477">pattern</span><span class="op" id="5237484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237487">if</span>&nbsp;<span class="ident" id="5237490">err</span>&nbsp;<span class="op" id="5237494">!=</span>&nbsp;<span class="ident" id="5237497">nil</span>&nbsp;<span class="op" id="5237501">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237505">return</span>&nbsp;<span class="builtintype" id="5237512">false</span><span class="op" id="5237517">,</span>&nbsp;<span class="ident" id="5237519">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237527">return</span>&nbsp;<span class="ident" id="5237534">re</span><span class="op" id="5237536">.</span><span class="ident" id="5237537">MatchString</span><span class="op" id="5237548">(</span><span class="ident" id="5237549">s</span><span class="op" id="5237550">)</span><span class="op" id="5237551">,</span>&nbsp;<span class="ident" id="5237553">nil</span><br>
<span class="lineno"></span><span class="op" id="5237557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="5237560">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5237613">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5237669">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5237718">func</span>&nbsp;<span class="ident" id="5237723">Match</span><span class="op" id="5237728">(</span><span class="ident" id="5237729">pattern</span>&nbsp;<span class="builtintype" id="5237737">string</span><span class="op" id="5237743">,</span>&nbsp;<span class="ident" id="5237745">b</span>&nbsp;<span class="op" id="5237747">[</span><span class="op" id="5237748">]</span><span class="builtintype" id="5237749">byte</span><span class="op" id="5237753">)</span>&nbsp;<span class="op" id="5237755">(</span><span class="ident" id="5237756">matched</span>&nbsp;<span class="builtintype" id="5237764">bool</span><span class="op" id="5237768">,</span>&nbsp;<span class="ident" id="5237770">err</span>&nbsp;<span class="builtintype" id="5237774">error</span><span class="op" id="5237779">)</span>&nbsp;<span class="op" id="5237781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237784">re</span><span class="op" id="5237786">,</span>&nbsp;<span class="ident" id="5237788">err</span>&nbsp;<span class="op" id="5237792">:=</span>&nbsp;<span class="ident" id="5237795">Compile</span><span class="op" id="5237802">(</span><span class="ident" id="5237803">pattern</span><span class="op" id="5237810">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237813">if</span>&nbsp;<span class="ident" id="5237816">err</span>&nbsp;<span class="op" id="5237820">!=</span>&nbsp;<span class="ident" id="5237823">nil</span>&nbsp;<span class="op" id="5237827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237831">return</span>&nbsp;<span class="builtintype" id="5237838">false</span><span class="op" id="5237843">,</span>&nbsp;<span class="ident" id="5237845">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237853">return</span>&nbsp;<span class="ident" id="5237860">re</span><span class="op" id="5237862">.</span><span class="ident" id="5237863">Match</span><span class="op" id="5237868">(</span><span class="ident" id="5237869">b</span><span class="op" id="5237870">)</span><span class="op" id="5237871">,</span>&nbsp;<span class="ident" id="5237873">nil</span><br>
<span class="lineno"></span><span class="op" id="5237877">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="5237880">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5237955">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5238033">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5238109">func</span>&nbsp;<span class="op" id="5238114">(</span><span class="ident" id="5238115">re</span>&nbsp;<span class="op" id="5238118">*</span><span class="ident" id="5238119">Regexp</span><span class="op" id="5238125">)</span>&nbsp;<span class="ident" id="5238127">ReplaceAllString</span><span class="op" id="5238143">(</span><span class="ident" id="5238144">src</span><span class="op" id="5238147">,</span>&nbsp;<span class="ident" id="5238149">repl</span>&nbsp;<span class="builtintype" id="5238154">string</span><span class="op" id="5238160">)</span>&nbsp;<span class="builtintype" id="5238162">string</span>&nbsp;<span class="op" id="5238169">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238172">n</span>&nbsp;<span class="op" id="5238174">:=</span>&nbsp;<span class="num" id="5238177">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238180">if</span>&nbsp;<span class="ident" id="5238183">strings</span><span class="op" id="5238190">.</span><span class="ident" id="5238191">Index</span><span class="op" id="5238196">(</span><span class="ident" id="5238197">repl</span><span class="op" id="5238201">,</span>&nbsp;<span class="string" id="5238203">&#34;$&#34;</span><span class="op" id="5238206">)</span>&nbsp;<span class="op" id="5238208">&gt;=</span>&nbsp;<span class="num" id="5238211">0</span>&nbsp;<span class="op" id="5238213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238217">n</span>&nbsp;<span class="op" id="5238219">=</span>&nbsp;<span class="num" id="5238221">2</span>&nbsp;<span class="op" id="5238223">*</span>&nbsp;<span class="op" id="5238225">(</span><span class="ident" id="5238226">re</span><span class="op" id="5238228">.</span><span class="ident" id="5238229">numSubexp</span>&nbsp;<span class="op" id="5238239">+</span>&nbsp;<span class="num" id="5238241">1</span><span class="op" id="5238242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238248">b</span>&nbsp;<span class="op" id="5238250">:=</span>&nbsp;<span class="ident" id="5238253">re</span><span class="op" id="5238255">.</span><span class="ident" id="5238256">replaceAll</span><span class="op" id="5238266">(</span><span class="ident" id="5238267">nil</span><span class="op" id="5238270">,</span>&nbsp;<span class="ident" id="5238272">src</span><span class="op" id="5238275">,</span>&nbsp;<span class="ident" id="5238277">n</span><span class="op" id="5238278">,</span>&nbsp;<span class="keyword" id="5238280">func</span><span class="op" id="5238284">(</span><span class="ident" id="5238285">dst</span>&nbsp;<span class="op" id="5238289">[</span><span class="op" id="5238290">]</span><span class="builtintype" id="5238291">byte</span><span class="op" id="5238295">,</span>&nbsp;<span class="ident" id="5238297">match</span>&nbsp;<span class="op" id="5238303">[</span><span class="op" id="5238304">]</span><span class="builtintype" id="5238305">int</span><span class="op" id="5238308">)</span>&nbsp;<span class="op" id="5238310">[</span><span class="op" id="5238311">]</span><span class="builtintype" id="5238312">byte</span>&nbsp;<span class="op" id="5238317">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238321">return</span>&nbsp;<span class="ident" id="5238328">re</span><span class="op" id="5238330">.</span><span class="ident" id="5238331">expand</span><span class="op" id="5238337">(</span><span class="ident" id="5238338">dst</span><span class="op" id="5238341">,</span>&nbsp;<span class="ident" id="5238343">repl</span><span class="op" id="5238347">,</span>&nbsp;<span class="ident" id="5238349">nil</span><span class="op" id="5238352">,</span>&nbsp;<span class="ident" id="5238354">src</span><span class="op" id="5238357">,</span>&nbsp;<span class="ident" id="5238359">match</span><span class="op" id="5238364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238367">}</span><span class="op" id="5238368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238371">return</span>&nbsp;<span class="builtintype" id="5238378">string</span><span class="op" id="5238384">(</span><span class="ident" id="5238385">b</span><span class="op" id="5238386">)</span><br>
<span class="lineno"></span><span class="op" id="5238388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="5238391">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5238473">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="5238557">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5238582">func</span>&nbsp;<span class="op" id="5238587">(</span><span class="ident" id="5238588">re</span>&nbsp;<span class="op" id="5238591">*</span><span class="ident" id="5238592">Regexp</span><span class="op" id="5238598">)</span>&nbsp;<span class="ident" id="5238600">ReplaceAllLiteralString</span><span class="op" id="5238623">(</span><span class="ident" id="5238624">src</span><span class="op" id="5238627">,</span>&nbsp;<span class="ident" id="5238629">repl</span>&nbsp;<span class="builtintype" id="5238634">string</span><span class="op" id="5238640">)</span>&nbsp;<span class="builtintype" id="5238642">string</span>&nbsp;<span class="op" id="5238649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238652">return</span>&nbsp;<span class="builtintype" id="5238659">string</span><span class="op" id="5238665">(</span><span class="ident" id="5238666">re</span><span class="op" id="5238668">.</span><span class="ident" id="5238669">replaceAll</span><span class="op" id="5238679">(</span><span class="ident" id="5238680">nil</span><span class="op" id="5238683">,</span>&nbsp;<span class="ident" id="5238685">src</span><span class="op" id="5238688">,</span>&nbsp;<span class="num" id="5238690">2</span><span class="op" id="5238691">,</span>&nbsp;<span class="keyword" id="5238693">func</span><span class="op" id="5238697">(</span><span class="ident" id="5238698">dst</span>&nbsp;<span class="op" id="5238702">[</span><span class="op" id="5238703">]</span><span class="builtintype" id="5238704">byte</span><span class="op" id="5238708">,</span>&nbsp;<span class="ident" id="5238710">match</span>&nbsp;<span class="op" id="5238716">[</span><span class="op" id="5238717">]</span><span class="builtintype" id="5238718">int</span><span class="op" id="5238721">)</span>&nbsp;<span class="op" id="5238723">[</span><span class="op" id="5238724">]</span><span class="builtintype" id="5238725">byte</span>&nbsp;<span class="op" id="5238730">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238734">return</span>&nbsp;<span class="builtinfunc" id="5238741">append</span><span class="op" id="5238747">(</span><span class="ident" id="5238748">dst</span><span class="op" id="5238751">,</span>&nbsp;<span class="ident" id="5238753">repl</span><span class="op" id="5238757">...</span><span class="op" id="5238760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238763">}</span><span class="op" id="5238764">)</span><span class="op" id="5238765">)</span><br>
<span class="lineno"></span><span class="op" id="5238767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5238770">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="5238844">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5238918">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="5238996">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5239031">func</span>&nbsp;<span class="op" id="5239036">(</span><span class="ident" id="5239037">re</span>&nbsp;<span class="op" id="5239040">*</span><span class="ident" id="5239041">Regexp</span><span class="op" id="5239047">)</span>&nbsp;<span class="ident" id="5239049">ReplaceAllStringFunc</span><span class="op" id="5239069">(</span><span class="ident" id="5239070">src</span>&nbsp;<span class="builtintype" id="5239074">string</span><span class="op" id="5239080">,</span>&nbsp;<span class="ident" id="5239082">repl</span>&nbsp;<span class="keyword" id="5239087">func</span><span class="op" id="5239091">(</span><span class="builtintype" id="5239092">string</span><span class="op" id="5239098">)</span>&nbsp;<span class="builtintype" id="5239100">string</span><span class="op" id="5239106">)</span>&nbsp;<span class="builtintype" id="5239108">string</span>&nbsp;<span class="op" id="5239115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239118">b</span>&nbsp;<span class="op" id="5239120">:=</span>&nbsp;<span class="ident" id="5239123">re</span><span class="op" id="5239125">.</span><span class="ident" id="5239126">replaceAll</span><span class="op" id="5239136">(</span><span class="ident" id="5239137">nil</span><span class="op" id="5239140">,</span>&nbsp;<span class="ident" id="5239142">src</span><span class="op" id="5239145">,</span>&nbsp;<span class="num" id="5239147">2</span><span class="op" id="5239148">,</span>&nbsp;<span class="keyword" id="5239150">func</span><span class="op" id="5239154">(</span><span class="ident" id="5239155">dst</span>&nbsp;<span class="op" id="5239159">[</span><span class="op" id="5239160">]</span><span class="builtintype" id="5239161">byte</span><span class="op" id="5239165">,</span>&nbsp;<span class="ident" id="5239167">match</span>&nbsp;<span class="op" id="5239173">[</span><span class="op" id="5239174">]</span><span class="builtintype" id="5239175">int</span><span class="op" id="5239178">)</span>&nbsp;<span class="op" id="5239180">[</span><span class="op" id="5239181">]</span><span class="builtintype" id="5239182">byte</span>&nbsp;<span class="op" id="5239187">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239191">return</span>&nbsp;<span class="builtinfunc" id="5239198">append</span><span class="op" id="5239204">(</span><span class="ident" id="5239205">dst</span><span class="op" id="5239208">,</span>&nbsp;<span class="ident" id="5239210">repl</span><span class="op" id="5239214">(</span><span class="ident" id="5239215">src</span><span class="op" id="5239218">[</span><span class="ident" id="5239219">match</span><span class="op" id="5239224">[</span><span class="num" id="5239225">0</span><span class="op" id="5239226">]</span><span class="op" id="5239227">:</span><span class="ident" id="5239228">match</span><span class="op" id="5239233">[</span><span class="num" id="5239234">1</span><span class="op" id="5239235">]</span><span class="op" id="5239236">]</span><span class="op" id="5239237">)</span><span class="op" id="5239238">...</span><span class="op" id="5239241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239244">}</span><span class="op" id="5239245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239248">return</span>&nbsp;<span class="builtintype" id="5239255">string</span><span class="op" id="5239261">(</span><span class="ident" id="5239262">b</span><span class="op" id="5239263">)</span><br>
<span class="lineno"></span><span class="op" id="5239265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="5239268">func</span>&nbsp;<span class="op" id="5239273">(</span><span class="ident" id="5239274">re</span>&nbsp;<span class="op" id="5239277">*</span><span class="ident" id="5239278">Regexp</span><span class="op" id="5239284">)</span>&nbsp;<span class="ident" id="5239286">replaceAll</span><span class="op" id="5239296">(</span><span class="ident" id="5239297">bsrc</span>&nbsp;<span class="op" id="5239302">[</span><span class="op" id="5239303">]</span><span class="builtintype" id="5239304">byte</span><span class="op" id="5239308">,</span>&nbsp;<span class="ident" id="5239310">src</span>&nbsp;<span class="builtintype" id="5239314">string</span><span class="op" id="5239320">,</span>&nbsp;<span class="ident" id="5239322">nmatch</span>&nbsp;<span class="builtintype" id="5239329">int</span><span class="op" id="5239332">,</span>&nbsp;<span class="ident" id="5239334">repl</span>&nbsp;<span class="keyword" id="5239339">func</span><span class="op" id="5239343">(</span><span class="ident" id="5239344">dst</span>&nbsp;<span class="op" id="5239348">[</span><span class="op" id="5239349">]</span><span class="builtintype" id="5239350">byte</span><span class="op" id="5239354">,</span>&nbsp;<span class="ident" id="5239356">m</span>&nbsp;<span class="op" id="5239358">[</span><span class="op" id="5239359">]</span><span class="builtintype" id="5239360">int</span><span class="op" id="5239363">)</span>&nbsp;<span class="op" id="5239365">[</span><span class="op" id="5239366">]</span><span class="builtintype" id="5239367">byte</span><span class="op" id="5239371">)</span>&nbsp;<span class="op" id="5239373">[</span><span class="op" id="5239374">]</span><span class="builtintype" id="5239375">byte</span>&nbsp;<span class="op" id="5239380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239383">lastMatchEnd</span>&nbsp;<span class="op" id="5239396">:=</span>&nbsp;<span class="num" id="5239399">0</span>&nbsp;<span class="comment" id="5239401">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239443">searchPos</span>&nbsp;<span class="op" id="5239453">:=</span>&nbsp;<span class="num" id="5239456">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239461">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239505">var</span>&nbsp;<span class="ident" id="5239509">buf</span>&nbsp;<span class="op" id="5239513">[</span><span class="op" id="5239514">]</span><span class="builtintype" id="5239515">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239521">var</span>&nbsp;<span class="ident" id="5239525">endPos</span>&nbsp;<span class="builtintype" id="5239532">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239537">if</span>&nbsp;<span class="ident" id="5239540">bsrc</span>&nbsp;<span class="op" id="5239545">!=</span>&nbsp;<span class="ident" id="5239548">nil</span>&nbsp;<span class="op" id="5239552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239556">endPos</span>&nbsp;<span class="op" id="5239563">=</span>&nbsp;<span class="builtinfunc" id="5239565">len</span><span class="op" id="5239568">(</span><span class="ident" id="5239569">bsrc</span><span class="op" id="5239573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239576">}</span>&nbsp;<span class="keyword" id="5239578">else</span>&nbsp;<span class="op" id="5239583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239587">endPos</span>&nbsp;<span class="op" id="5239594">=</span>&nbsp;<span class="builtinfunc" id="5239596">len</span><span class="op" id="5239599">(</span><span class="ident" id="5239600">src</span><span class="op" id="5239603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239606">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239609">for</span>&nbsp;<span class="ident" id="5239613">searchPos</span>&nbsp;<span class="op" id="5239623">&lt;=</span>&nbsp;<span class="ident" id="5239626">endPos</span>&nbsp;<span class="op" id="5239633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239637">a</span>&nbsp;<span class="op" id="5239639">:=</span>&nbsp;<span class="ident" id="5239642">re</span><span class="op" id="5239644">.</span><span class="ident" id="5239645">doExecute</span><span class="op" id="5239654">(</span><span class="ident" id="5239655">nil</span><span class="op" id="5239658">,</span>&nbsp;<span class="ident" id="5239660">bsrc</span><span class="op" id="5239664">,</span>&nbsp;<span class="ident" id="5239666">src</span><span class="op" id="5239669">,</span>&nbsp;<span class="ident" id="5239671">searchPos</span><span class="op" id="5239680">,</span>&nbsp;<span class="ident" id="5239682">nmatch</span><span class="op" id="5239688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239692">if</span>&nbsp;<span class="builtinfunc" id="5239695">len</span><span class="op" id="5239698">(</span><span class="ident" id="5239699">a</span><span class="op" id="5239700">)</span>&nbsp;<span class="op" id="5239702">==</span>&nbsp;<span class="num" id="5239705">0</span>&nbsp;<span class="op" id="5239707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239712">break</span>&nbsp;<span class="comment" id="5239718">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239739">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5239744">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5239798">if</span>&nbsp;<span class="ident" id="5239801">bsrc</span>&nbsp;<span class="op" id="5239806">!=</span>&nbsp;<span class="ident" id="5239809">nil</span>&nbsp;<span class="op" id="5239813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239818">buf</span>&nbsp;<span class="op" id="5239822">=</span>&nbsp;<span class="builtinfunc" id="5239824">append</span><span class="op" id="5239830">(</span><span class="ident" id="5239831">buf</span><span class="op" id="5239834">,</span>&nbsp;<span class="ident" id="5239836">bsrc</span><span class="op" id="5239840">[</span><span class="ident" id="5239841">lastMatchEnd</span><span class="op" id="5239853">:</span><span class="ident" id="5239854">a</span><span class="op" id="5239855">[</span><span class="num" id="5239856">0</span><span class="op" id="5239857">]</span><span class="op" id="5239858">]</span><span class="op" id="5239859">...</span><span class="op" id="5239862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239866">}</span>&nbsp;<span class="keyword" id="5239868">else</span>&nbsp;<span class="op" id="5239873">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5239878">buf</span>&nbsp;<span class="op" id="5239882">=</span>&nbsp;<span class="builtinfunc" id="5239884">append</span><span class="op" id="5239890">(</span><span class="ident" id="5239891">buf</span><span class="op" id="5239894">,</span>&nbsp;<span class="ident" id="5239896">src</span><span class="op" id="5239899">[</span><span class="ident" id="5239900">lastMatchEnd</span><span class="op" id="5239912">:</span><span class="ident" id="5239913">a</span><span class="op" id="5239914">[</span><span class="num" id="5239915">0</span><span class="op" id="5239916">]</span><span class="op" id="5239917">]</span><span class="op" id="5239918">...</span><span class="op" id="5239921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5239925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5239930">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5239994">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240058">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240119">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240164">if</span>&nbsp;<span class="ident" id="5240167">a</span><span class="op" id="5240168">[</span><span class="num" id="5240169">1</span><span class="op" id="5240170">]</span>&nbsp;<span class="op" id="5240172">&gt;</span>&nbsp;<span class="ident" id="5240174">lastMatchEnd</span>&nbsp;<span class="op" id="5240187">||</span>&nbsp;<span class="ident" id="5240190">a</span><span class="op" id="5240191">[</span><span class="num" id="5240192">0</span><span class="op" id="5240193">]</span>&nbsp;<span class="op" id="5240195">==</span>&nbsp;<span class="num" id="5240198">0</span>&nbsp;<span class="op" id="5240200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240205">buf</span>&nbsp;<span class="op" id="5240209">=</span>&nbsp;<span class="ident" id="5240211">repl</span><span class="op" id="5240215">(</span><span class="ident" id="5240216">buf</span><span class="op" id="5240219">,</span>&nbsp;<span class="ident" id="5240221">a</span><span class="op" id="5240222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240226">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240230">lastMatchEnd</span>&nbsp;<span class="op" id="5240243">=</span>&nbsp;<span class="ident" id="5240245">a</span><span class="op" id="5240246">[</span><span class="num" id="5240247">1</span><span class="op" id="5240248">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240253">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240322">var</span>&nbsp;<span class="ident" id="5240326">width</span>&nbsp;<span class="builtintype" id="5240332">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240338">if</span>&nbsp;<span class="ident" id="5240341">bsrc</span>&nbsp;<span class="op" id="5240346">!=</span>&nbsp;<span class="ident" id="5240349">nil</span>&nbsp;<span class="op" id="5240353">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240358">_</span><span class="op" id="5240359">,</span>&nbsp;<span class="ident" id="5240361">width</span>&nbsp;<span class="op" id="5240367">=</span>&nbsp;<span class="ident" id="5240369">utf8</span><span class="op" id="5240373">.</span><span class="ident" id="5240374">DecodeRune</span><span class="op" id="5240384">(</span><span class="ident" id="5240385">bsrc</span><span class="op" id="5240389">[</span><span class="ident" id="5240390">searchPos</span><span class="op" id="5240399">:</span><span class="op" id="5240400">]</span><span class="op" id="5240401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240405">}</span>&nbsp;<span class="keyword" id="5240407">else</span>&nbsp;<span class="op" id="5240412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240417">_</span><span class="op" id="5240418">,</span>&nbsp;<span class="ident" id="5240420">width</span>&nbsp;<span class="op" id="5240426">=</span>&nbsp;<span class="ident" id="5240428">utf8</span><span class="op" id="5240432">.</span><span class="ident" id="5240433">DecodeRuneInString</span><span class="op" id="5240451">(</span><span class="ident" id="5240452">src</span><span class="op" id="5240455">[</span><span class="ident" id="5240456">searchPos</span><span class="op" id="5240465">:</span><span class="op" id="5240466">]</span><span class="op" id="5240467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240475">if</span>&nbsp;<span class="ident" id="5240478">searchPos</span><span class="op" id="5240487">+</span><span class="ident" id="5240488">width</span>&nbsp;<span class="op" id="5240494">&gt;</span>&nbsp;<span class="ident" id="5240496">a</span><span class="op" id="5240497">[</span><span class="num" id="5240498">1</span><span class="op" id="5240499">]</span>&nbsp;<span class="op" id="5240501">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240506">searchPos</span>&nbsp;<span class="op" id="5240516">+=</span>&nbsp;<span class="ident" id="5240519">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240527">}</span>&nbsp;<span class="keyword" id="5240529">else</span>&nbsp;<span class="keyword" id="5240534">if</span>&nbsp;<span class="ident" id="5240537">searchPos</span><span class="op" id="5240546">+</span><span class="num" id="5240547">1</span>&nbsp;<span class="op" id="5240549">&gt;</span>&nbsp;<span class="ident" id="5240551">a</span><span class="op" id="5240552">[</span><span class="num" id="5240553">1</span><span class="op" id="5240554">]</span>&nbsp;<span class="op" id="5240556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240561">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240618">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240683">searchPos</span><span class="op" id="5240692">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240697">}</span>&nbsp;<span class="keyword" id="5240699">else</span>&nbsp;<span class="op" id="5240704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240709">searchPos</span>&nbsp;<span class="op" id="5240719">=</span>&nbsp;<span class="ident" id="5240721">a</span><span class="op" id="5240722">[</span><span class="num" id="5240723">1</span><span class="op" id="5240724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5240735">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240791">if</span>&nbsp;<span class="ident" id="5240794">bsrc</span>&nbsp;<span class="op" id="5240799">!=</span>&nbsp;<span class="ident" id="5240802">nil</span>&nbsp;<span class="op" id="5240806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240810">buf</span>&nbsp;<span class="op" id="5240814">=</span>&nbsp;<span class="builtinfunc" id="5240816">append</span><span class="op" id="5240822">(</span><span class="ident" id="5240823">buf</span><span class="op" id="5240826">,</span>&nbsp;<span class="ident" id="5240828">bsrc</span><span class="op" id="5240832">[</span><span class="ident" id="5240833">lastMatchEnd</span><span class="op" id="5240845">:</span><span class="op" id="5240846">]</span><span class="op" id="5240847">...</span><span class="op" id="5240850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240853">}</span>&nbsp;<span class="keyword" id="5240855">else</span>&nbsp;<span class="op" id="5240860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5240864">buf</span>&nbsp;<span class="op" id="5240868">=</span>&nbsp;<span class="builtinfunc" id="5240870">append</span><span class="op" id="5240876">(</span><span class="ident" id="5240877">buf</span><span class="op" id="5240880">,</span>&nbsp;<span class="ident" id="5240882">src</span><span class="op" id="5240885">[</span><span class="ident" id="5240886">lastMatchEnd</span><span class="op" id="5240898">:</span><span class="op" id="5240899">]</span><span class="op" id="5240900">...</span><span class="op" id="5240903">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5240906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5240910">return</span>&nbsp;<span class="ident" id="5240917">buf</span><br>
<span class="lineno"></span><span class="op" id="5240921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="5240924">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5240993">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5241069">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5241145">func</span>&nbsp;<span class="op" id="5241150">(</span><span class="ident" id="5241151">re</span>&nbsp;<span class="op" id="5241154">*</span><span class="ident" id="5241155">Regexp</span><span class="op" id="5241161">)</span>&nbsp;<span class="ident" id="5241163">ReplaceAll</span><span class="op" id="5241173">(</span><span class="ident" id="5241174">src</span><span class="op" id="5241177">,</span>&nbsp;<span class="ident" id="5241179">repl</span>&nbsp;<span class="op" id="5241184">[</span><span class="op" id="5241185">]</span><span class="builtintype" id="5241186">byte</span><span class="op" id="5241190">)</span>&nbsp;<span class="op" id="5241192">[</span><span class="op" id="5241193">]</span><span class="builtintype" id="5241194">byte</span>&nbsp;<span class="op" id="5241199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5241202">n</span>&nbsp;<span class="op" id="5241204">:=</span>&nbsp;<span class="num" id="5241207">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241210">if</span>&nbsp;<span class="ident" id="5241213">bytes</span><span class="op" id="5241218">.</span><span class="ident" id="5241219">IndexByte</span><span class="op" id="5241228">(</span><span class="ident" id="5241229">repl</span><span class="op" id="5241233">,</span>&nbsp;<span class="string" id="5241235">&#39;$&#39;</span><span class="op" id="5241238">)</span>&nbsp;<span class="op" id="5241240">&gt;=</span>&nbsp;<span class="num" id="5241243">0</span>&nbsp;<span class="op" id="5241245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5241249">n</span>&nbsp;<span class="op" id="5241251">=</span>&nbsp;<span class="num" id="5241253">2</span>&nbsp;<span class="op" id="5241255">*</span>&nbsp;<span class="op" id="5241257">(</span><span class="ident" id="5241258">re</span><span class="op" id="5241260">.</span><span class="ident" id="5241261">numSubexp</span>&nbsp;<span class="op" id="5241271">+</span>&nbsp;<span class="num" id="5241273">1</span><span class="op" id="5241274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5241277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5241280">srepl</span>&nbsp;<span class="op" id="5241286">:=</span>&nbsp;<span class="string" id="5241289">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5241293">b</span>&nbsp;<span class="op" id="5241295">:=</span>&nbsp;<span class="ident" id="5241298">re</span><span class="op" id="5241300">.</span><span class="ident" id="5241301">replaceAll</span><span class="op" id="5241311">(</span><span class="ident" id="5241312">src</span><span class="op" id="5241315">,</span>&nbsp;<span class="string" id="5241317">&#34;&#34;</span><span class="op" id="5241319">,</span>&nbsp;<span class="ident" id="5241321">n</span><span class="op" id="5241322">,</span>&nbsp;<span class="keyword" id="5241324">func</span><span class="op" id="5241328">(</span><span class="ident" id="5241329">dst</span>&nbsp;<span class="op" id="5241333">[</span><span class="op" id="5241334">]</span><span class="builtintype" id="5241335">byte</span><span class="op" id="5241339">,</span>&nbsp;<span class="ident" id="5241341">match</span>&nbsp;<span class="op" id="5241347">[</span><span class="op" id="5241348">]</span><span class="builtintype" id="5241349">int</span><span class="op" id="5241352">)</span>&nbsp;<span class="op" id="5241354">[</span><span class="op" id="5241355">]</span><span class="builtintype" id="5241356">byte</span>&nbsp;<span class="op" id="5241361">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241365">if</span>&nbsp;<span class="builtinfunc" id="5241368">len</span><span class="op" id="5241371">(</span><span class="ident" id="5241372">srepl</span><span class="op" id="5241377">)</span>&nbsp;<span class="op" id="5241379">!=</span>&nbsp;<span class="builtinfunc" id="5241382">len</span><span class="op" id="5241385">(</span><span class="ident" id="5241386">repl</span><span class="op" id="5241390">)</span>&nbsp;<span class="op" id="5241392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5241397">srepl</span>&nbsp;<span class="op" id="5241403">=</span>&nbsp;<span class="builtintype" id="5241405">string</span><span class="op" id="5241411">(</span><span class="ident" id="5241412">repl</span><span class="op" id="5241416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5241420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241424">return</span>&nbsp;<span class="ident" id="5241431">re</span><span class="op" id="5241433">.</span><span class="ident" id="5241434">expand</span><span class="op" id="5241440">(</span><span class="ident" id="5241441">dst</span><span class="op" id="5241444">,</span>&nbsp;<span class="ident" id="5241446">srepl</span><span class="op" id="5241451">,</span>&nbsp;<span class="ident" id="5241453">src</span><span class="op" id="5241456">,</span>&nbsp;<span class="string" id="5241458">&#34;&#34;</span><span class="op" id="5241460">,</span>&nbsp;<span class="ident" id="5241462">match</span><span class="op" id="5241467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5241470">}</span><span class="op" id="5241471">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241474">return</span>&nbsp;<span class="ident" id="5241481">b</span><br>
<span class="lineno"></span><span class="op" id="5241483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241486">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5241562">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="5241645">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5241670">func</span>&nbsp;<span class="op" id="5241675">(</span><span class="ident" id="5241676">re</span>&nbsp;<span class="op" id="5241679">*</span><span class="ident" id="5241680">Regexp</span><span class="op" id="5241686">)</span>&nbsp;<span class="ident" id="5241688">ReplaceAllLiteral</span><span class="op" id="5241705">(</span><span class="ident" id="5241706">src</span><span class="op" id="5241709">,</span>&nbsp;<span class="ident" id="5241711">repl</span>&nbsp;<span class="op" id="5241716">[</span><span class="op" id="5241717">]</span><span class="builtintype" id="5241718">byte</span><span class="op" id="5241722">)</span>&nbsp;<span class="op" id="5241724">[</span><span class="op" id="5241725">]</span><span class="builtintype" id="5241726">byte</span>&nbsp;<span class="op" id="5241731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241734">return</span>&nbsp;<span class="ident" id="5241741">re</span><span class="op" id="5241743">.</span><span class="ident" id="5241744">replaceAll</span><span class="op" id="5241754">(</span><span class="ident" id="5241755">src</span><span class="op" id="5241758">,</span>&nbsp;<span class="string" id="5241760">&#34;&#34;</span><span class="op" id="5241762">,</span>&nbsp;<span class="num" id="5241764">2</span><span class="op" id="5241765">,</span>&nbsp;<span class="keyword" id="5241767">func</span><span class="op" id="5241771">(</span><span class="ident" id="5241772">dst</span>&nbsp;<span class="op" id="5241776">[</span><span class="op" id="5241777">]</span><span class="builtintype" id="5241778">byte</span><span class="op" id="5241782">,</span>&nbsp;<span class="ident" id="5241784">match</span>&nbsp;<span class="op" id="5241790">[</span><span class="op" id="5241791">]</span><span class="builtintype" id="5241792">int</span><span class="op" id="5241795">)</span>&nbsp;<span class="op" id="5241797">[</span><span class="op" id="5241798">]</span><span class="builtintype" id="5241799">byte</span>&nbsp;<span class="op" id="5241804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5241808">return</span>&nbsp;<span class="builtinfunc" id="5241815">append</span><span class="op" id="5241821">(</span><span class="ident" id="5241822">dst</span><span class="op" id="5241825">,</span>&nbsp;<span class="ident" id="5241827">repl</span><span class="op" id="5241831">...</span><span class="op" id="5241834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5241837">}</span><span class="op" id="5241838">)</span><br>
<span class="lineno">560</span><span class="op" id="5241840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241843">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5241911">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5241985">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="5242064">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5242099">func</span>&nbsp;<span class="op" id="5242104">(</span><span class="ident" id="5242105">re</span>&nbsp;<span class="op" id="5242108">*</span><span class="ident" id="5242109">Regexp</span><span class="op" id="5242115">)</span>&nbsp;<span class="ident" id="5242117">ReplaceAllFunc</span><span class="op" id="5242131">(</span><span class="ident" id="5242132">src</span>&nbsp;<span class="op" id="5242136">[</span><span class="op" id="5242137">]</span><span class="builtintype" id="5242138">byte</span><span class="op" id="5242142">,</span>&nbsp;<span class="ident" id="5242144">repl</span>&nbsp;<span class="keyword" id="5242149">func</span><span class="op" id="5242153">(</span><span class="op" id="5242154">[</span><span class="op" id="5242155">]</span><span class="builtintype" id="5242156">byte</span><span class="op" id="5242160">)</span>&nbsp;<span class="op" id="5242162">[</span><span class="op" id="5242163">]</span><span class="builtintype" id="5242164">byte</span><span class="op" id="5242168">)</span>&nbsp;<span class="op" id="5242170">[</span><span class="op" id="5242171">]</span><span class="builtintype" id="5242172">byte</span>&nbsp;<span class="op" id="5242177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242180">return</span>&nbsp;<span class="ident" id="5242187">re</span><span class="op" id="5242189">.</span><span class="ident" id="5242190">replaceAll</span><span class="op" id="5242200">(</span><span class="ident" id="5242201">src</span><span class="op" id="5242204">,</span>&nbsp;<span class="string" id="5242206">&#34;&#34;</span><span class="op" id="5242208">,</span>&nbsp;<span class="num" id="5242210">2</span><span class="op" id="5242211">,</span>&nbsp;<span class="keyword" id="5242213">func</span><span class="op" id="5242217">(</span><span class="ident" id="5242218">dst</span>&nbsp;<span class="op" id="5242222">[</span><span class="op" id="5242223">]</span><span class="builtintype" id="5242224">byte</span><span class="op" id="5242228">,</span>&nbsp;<span class="ident" id="5242230">match</span>&nbsp;<span class="op" id="5242236">[</span><span class="op" id="5242237">]</span><span class="builtintype" id="5242238">int</span><span class="op" id="5242241">)</span>&nbsp;<span class="op" id="5242243">[</span><span class="op" id="5242244">]</span><span class="builtintype" id="5242245">byte</span>&nbsp;<span class="op" id="5242250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242254">return</span>&nbsp;<span class="builtinfunc" id="5242261">append</span><span class="op" id="5242267">(</span><span class="ident" id="5242268">dst</span><span class="op" id="5242271">,</span>&nbsp;<span class="ident" id="5242273">repl</span><span class="op" id="5242277">(</span><span class="ident" id="5242278">src</span><span class="op" id="5242281">[</span><span class="ident" id="5242282">match</span><span class="op" id="5242287">[</span><span class="num" id="5242288">0</span><span class="op" id="5242289">]</span><span class="op" id="5242290">:</span><span class="ident" id="5242291">match</span><span class="op" id="5242296">[</span><span class="num" id="5242297">1</span><span class="op" id="5242298">]</span><span class="op" id="5242299">]</span><span class="op" id="5242300">)</span><span class="op" id="5242301">...</span><span class="op" id="5242304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5242307">}</span><span class="op" id="5242308">)</span><br>
<span class="lineno">570</span><span class="op" id="5242310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5242313">var</span>&nbsp;<span class="ident" id="5242317">specialBytes</span>&nbsp;<span class="op" id="5242330">=</span>&nbsp;<span class="op" id="5242332">[</span><span class="op" id="5242333">]</span><span class="builtintype" id="5242334">byte</span><span class="op" id="5242338">(</span><span class="string" id="5242339">`\.+*?()|[]{}^$`</span><span class="op" id="5242355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5242358">func</span>&nbsp;<span class="ident" id="5242363">special</span><span class="op" id="5242370">(</span><span class="ident" id="5242371">b</span>&nbsp;<span class="builtintype" id="5242373">byte</span><span class="op" id="5242377">)</span>&nbsp;<span class="builtintype" id="5242379">bool</span>&nbsp;<span class="op" id="5242384">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242387">return</span>&nbsp;<span class="ident" id="5242394">bytes</span><span class="op" id="5242399">.</span><span class="ident" id="5242400">IndexByte</span><span class="op" id="5242409">(</span><span class="ident" id="5242410">specialBytes</span><span class="op" id="5242422">,</span>&nbsp;<span class="ident" id="5242424">b</span><span class="op" id="5242425">)</span>&nbsp;<span class="op" id="5242427">&gt;=</span>&nbsp;<span class="num" id="5242430">0</span><br>
<span class="lineno"></span><span class="op" id="5242432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5242435">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="5242515">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="5242597">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="5242670">func</span>&nbsp;<span class="ident" id="5242675">QuoteMeta</span><span class="op" id="5242684">(</span><span class="ident" id="5242685">s</span>&nbsp;<span class="builtintype" id="5242687">string</span><span class="op" id="5242693">)</span>&nbsp;<span class="builtintype" id="5242695">string</span>&nbsp;<span class="op" id="5242702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242705">b</span>&nbsp;<span class="op" id="5242707">:=</span>&nbsp;<span class="builtinfunc" id="5242710">make</span><span class="op" id="5242714">(</span><span class="op" id="5242715">[</span><span class="op" id="5242716">]</span><span class="builtintype" id="5242717">byte</span><span class="op" id="5242721">,</span>&nbsp;<span class="num" id="5242723">2</span><span class="op" id="5242724">*</span><span class="builtinfunc" id="5242725">len</span><span class="op" id="5242728">(</span><span class="ident" id="5242729">s</span><span class="op" id="5242730">)</span><span class="op" id="5242731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5242735">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242800">j</span>&nbsp;<span class="op" id="5242802">:=</span>&nbsp;<span class="num" id="5242805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242808">for</span>&nbsp;<span class="ident" id="5242812">i</span>&nbsp;<span class="op" id="5242814">:=</span>&nbsp;<span class="num" id="5242817">0</span><span class="op" id="5242818">;</span>&nbsp;<span class="ident" id="5242820">i</span>&nbsp;<span class="op" id="5242822">&lt;</span>&nbsp;<span class="builtinfunc" id="5242824">len</span><span class="op" id="5242827">(</span><span class="ident" id="5242828">s</span><span class="op" id="5242829">)</span><span class="op" id="5242830">;</span>&nbsp;<span class="ident" id="5242832">i</span><span class="op" id="5242833">++</span>&nbsp;<span class="op" id="5242836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242840">if</span>&nbsp;<span class="ident" id="5242843">special</span><span class="op" id="5242850">(</span><span class="ident" id="5242851">s</span><span class="op" id="5242852">[</span><span class="ident" id="5242853">i</span><span class="op" id="5242854">]</span><span class="op" id="5242855">)</span>&nbsp;<span class="op" id="5242857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242862">b</span><span class="op" id="5242863">[</span><span class="ident" id="5242864">j</span><span class="op" id="5242865">]</span>&nbsp;<span class="op" id="5242867">=</span>&nbsp;<span class="string" id="5242869">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242877">j</span><span class="op" id="5242878">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5242883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242887">b</span><span class="op" id="5242888">[</span><span class="ident" id="5242889">j</span><span class="op" id="5242890">]</span>&nbsp;<span class="op" id="5242892">=</span>&nbsp;<span class="ident" id="5242894">s</span><span class="op" id="5242895">[</span><span class="ident" id="5242896">i</span><span class="op" id="5242897">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5242901">j</span><span class="op" id="5242902">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5242906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5242909">return</span>&nbsp;<span class="builtintype" id="5242916">string</span><span class="op" id="5242922">(</span><span class="ident" id="5242923">b</span><span class="op" id="5242924">[</span><span class="num" id="5242925">0</span><span class="op" id="5242926">:</span><span class="ident" id="5242927">j</span><span class="op" id="5242928">]</span><span class="op" id="5242929">)</span><br>
<span class="lineno">595</span><span class="op" id="5242931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5242934">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5242996">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="5243054">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="5243115">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5243176">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5243244">func</span>&nbsp;<span class="op" id="5243249">(</span><span class="ident" id="5243250">re</span>&nbsp;<span class="op" id="5243253">*</span><span class="ident" id="5243254">Regexp</span><span class="op" id="5243260">)</span>&nbsp;<span class="ident" id="5243262">pad</span><span class="op" id="5243265">(</span><span class="ident" id="5243266">a</span>&nbsp;<span class="op" id="5243268">[</span><span class="op" id="5243269">]</span><span class="builtintype" id="5243270">int</span><span class="op" id="5243273">)</span>&nbsp;<span class="op" id="5243275">[</span><span class="op" id="5243276">]</span><span class="builtintype" id="5243277">int</span>&nbsp;<span class="op" id="5243281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243284">if</span>&nbsp;<span class="ident" id="5243287">a</span>&nbsp;<span class="op" id="5243289">==</span>&nbsp;<span class="ident" id="5243292">nil</span>&nbsp;<span class="op" id="5243296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5243300">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243315">return</span>&nbsp;<span class="ident" id="5243322">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5243327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243330">n</span>&nbsp;<span class="op" id="5243332">:=</span>&nbsp;<span class="op" id="5243335">(</span><span class="num" id="5243336">1</span>&nbsp;<span class="op" id="5243338">+</span>&nbsp;<span class="ident" id="5243340">re</span><span class="op" id="5243342">.</span><span class="ident" id="5243343">numSubexp</span><span class="op" id="5243352">)</span>&nbsp;<span class="op" id="5243354">*</span>&nbsp;<span class="num" id="5243356">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243359">for</span>&nbsp;<span class="builtinfunc" id="5243363">len</span><span class="op" id="5243366">(</span><span class="ident" id="5243367">a</span><span class="op" id="5243368">)</span>&nbsp;<span class="op" id="5243370">&lt;</span>&nbsp;<span class="ident" id="5243372">n</span>&nbsp;<span class="op" id="5243374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243378">a</span>&nbsp;<span class="op" id="5243380">=</span>&nbsp;<span class="builtinfunc" id="5243382">append</span><span class="op" id="5243388">(</span><span class="ident" id="5243389">a</span><span class="op" id="5243390">,</span>&nbsp;<span class="op" id="5243392">-</span><span class="num" id="5243393">1</span><span class="op" id="5243394">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5243397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243400">return</span>&nbsp;<span class="ident" id="5243407">a</span><br>
<span class="lineno"></span><span class="op" id="5243409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5243412">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="5243492">func</span>&nbsp;<span class="op" id="5243497">(</span><span class="ident" id="5243498">re</span>&nbsp;<span class="op" id="5243501">*</span><span class="ident" id="5243502">Regexp</span><span class="op" id="5243508">)</span>&nbsp;<span class="ident" id="5243510">allMatches</span><span class="op" id="5243520">(</span><span class="ident" id="5243521">s</span>&nbsp;<span class="builtintype" id="5243523">string</span><span class="op" id="5243529">,</span>&nbsp;<span class="ident" id="5243531">b</span>&nbsp;<span class="op" id="5243533">[</span><span class="op" id="5243534">]</span><span class="builtintype" id="5243535">byte</span><span class="op" id="5243539">,</span>&nbsp;<span class="ident" id="5243541">n</span>&nbsp;<span class="builtintype" id="5243543">int</span><span class="op" id="5243546">,</span>&nbsp;<span class="ident" id="5243548">deliver</span>&nbsp;<span class="keyword" id="5243556">func</span><span class="op" id="5243560">(</span><span class="op" id="5243561">[</span><span class="op" id="5243562">]</span><span class="builtintype" id="5243563">int</span><span class="op" id="5243566">)</span><span class="op" id="5243567">)</span>&nbsp;<span class="op" id="5243569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243572">var</span>&nbsp;<span class="ident" id="5243576">end</span>&nbsp;<span class="builtintype" id="5243580">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243585">if</span>&nbsp;<span class="ident" id="5243588">b</span>&nbsp;<span class="op" id="5243590">==</span>&nbsp;<span class="ident" id="5243593">nil</span>&nbsp;<span class="op" id="5243597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243601">end</span>&nbsp;<span class="op" id="5243605">=</span>&nbsp;<span class="builtinfunc" id="5243607">len</span><span class="op" id="5243610">(</span><span class="ident" id="5243611">s</span><span class="op" id="5243612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5243615">}</span>&nbsp;<span class="keyword" id="5243617">else</span>&nbsp;<span class="op" id="5243622">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243626">end</span>&nbsp;<span class="op" id="5243630">=</span>&nbsp;<span class="builtinfunc" id="5243632">len</span><span class="op" id="5243635">(</span><span class="ident" id="5243636">b</span><span class="op" id="5243637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5243640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243644">for</span>&nbsp;<span class="ident" id="5243648">pos</span><span class="op" id="5243651">,</span>&nbsp;<span class="ident" id="5243653">i</span><span class="op" id="5243654">,</span>&nbsp;<span class="ident" id="5243656">prevMatchEnd</span>&nbsp;<span class="op" id="5243669">:=</span>&nbsp;<span class="num" id="5243672">0</span><span class="op" id="5243673">,</span>&nbsp;<span class="num" id="5243675">0</span><span class="op" id="5243676">,</span>&nbsp;<span class="op" id="5243678">-</span><span class="num" id="5243679">1</span><span class="op" id="5243680">;</span>&nbsp;<span class="ident" id="5243682">i</span>&nbsp;<span class="op" id="5243684">&lt;</span>&nbsp;<span class="ident" id="5243686">n</span>&nbsp;<span class="op" id="5243688">&amp;&amp;</span>&nbsp;<span class="ident" id="5243691">pos</span>&nbsp;<span class="op" id="5243695">&lt;=</span>&nbsp;<span class="ident" id="5243698">end</span><span class="op" id="5243701">;</span>&nbsp;<span class="op" id="5243703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243707">matches</span>&nbsp;<span class="op" id="5243715">:=</span>&nbsp;<span class="ident" id="5243718">re</span><span class="op" id="5243720">.</span><span class="ident" id="5243721">doExecute</span><span class="op" id="5243730">(</span><span class="ident" id="5243731">nil</span><span class="op" id="5243734">,</span>&nbsp;<span class="ident" id="5243736">b</span><span class="op" id="5243737">,</span>&nbsp;<span class="ident" id="5243739">s</span><span class="op" id="5243740">,</span>&nbsp;<span class="ident" id="5243742">pos</span><span class="op" id="5243745">,</span>&nbsp;<span class="ident" id="5243747">re</span><span class="op" id="5243749">.</span><span class="ident" id="5243750">prog</span><span class="op" id="5243754">.</span><span class="ident" id="5243755">NumCap</span><span class="op" id="5243761">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243765">if</span>&nbsp;<span class="builtinfunc" id="5243768">len</span><span class="op" id="5243771">(</span><span class="ident" id="5243772">matches</span><span class="op" id="5243779">)</span>&nbsp;<span class="op" id="5243781">==</span>&nbsp;<span class="num" id="5243784">0</span>&nbsp;<span class="op" id="5243786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243791">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5243799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5243804">accept</span>&nbsp;<span class="op" id="5243811">:=</span>&nbsp;<span class="builtintype" id="5243814">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243821">if</span>&nbsp;<span class="ident" id="5243824">matches</span><span class="op" id="5243831">[</span><span class="num" id="5243832">1</span><span class="op" id="5243833">]</span>&nbsp;<span class="op" id="5243835">==</span>&nbsp;<span class="ident" id="5243838">pos</span>&nbsp;<span class="op" id="5243842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5243847">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5243881">if</span>&nbsp;<span class="ident" id="5243884">matches</span><span class="op" id="5243891">[</span><span class="num" id="5243892">0</span><span class="op" id="5243893">]</span>&nbsp;<span class="op" id="5243895">==</span>&nbsp;<span class="ident" id="5243898">prevMatchEnd</span>&nbsp;<span class="op" id="5243911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5243917">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5243960">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244005">accept</span>&nbsp;<span class="op" id="5244012">=</span>&nbsp;<span class="builtintype" id="5244014">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244028">var</span>&nbsp;<span class="ident" id="5244032">width</span>&nbsp;<span class="builtintype" id="5244038">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5244045">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244068">if</span>&nbsp;<span class="ident" id="5244071">b</span>&nbsp;<span class="op" id="5244073">==</span>&nbsp;<span class="ident" id="5244076">nil</span>&nbsp;<span class="op" id="5244080">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244086">_</span><span class="op" id="5244087">,</span>&nbsp;<span class="ident" id="5244089">width</span>&nbsp;<span class="op" id="5244095">=</span>&nbsp;<span class="ident" id="5244097">utf8</span><span class="op" id="5244101">.</span><span class="ident" id="5244102">DecodeRuneInString</span><span class="op" id="5244120">(</span><span class="ident" id="5244121">s</span><span class="op" id="5244122">[</span><span class="ident" id="5244123">pos</span><span class="op" id="5244126">:</span><span class="ident" id="5244127">end</span><span class="op" id="5244130">]</span><span class="op" id="5244131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244136">}</span>&nbsp;<span class="keyword" id="5244138">else</span>&nbsp;<span class="op" id="5244143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244149">_</span><span class="op" id="5244150">,</span>&nbsp;<span class="ident" id="5244152">width</span>&nbsp;<span class="op" id="5244158">=</span>&nbsp;<span class="ident" id="5244160">utf8</span><span class="op" id="5244164">.</span><span class="ident" id="5244165">DecodeRune</span><span class="op" id="5244175">(</span><span class="ident" id="5244176">b</span><span class="op" id="5244177">[</span><span class="ident" id="5244178">pos</span><span class="op" id="5244181">:</span><span class="ident" id="5244182">end</span><span class="op" id="5244185">]</span><span class="op" id="5244186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244196">if</span>&nbsp;<span class="ident" id="5244199">width</span>&nbsp;<span class="op" id="5244205">&gt;</span>&nbsp;<span class="num" id="5244207">0</span>&nbsp;<span class="op" id="5244209">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244215">pos</span>&nbsp;<span class="op" id="5244219">+=</span>&nbsp;<span class="ident" id="5244222">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244231">}</span>&nbsp;<span class="keyword" id="5244233">else</span>&nbsp;<span class="op" id="5244238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244244">pos</span>&nbsp;<span class="op" id="5244248">=</span>&nbsp;<span class="ident" id="5244250">end</span>&nbsp;<span class="op" id="5244254">+</span>&nbsp;<span class="num" id="5244256">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244265">}</span>&nbsp;<span class="keyword" id="5244267">else</span>&nbsp;<span class="op" id="5244272">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244277">pos</span>&nbsp;<span class="op" id="5244281">=</span>&nbsp;<span class="ident" id="5244283">matches</span><span class="op" id="5244290">[</span><span class="num" id="5244291">1</span><span class="op" id="5244292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244300">prevMatchEnd</span>&nbsp;<span class="op" id="5244313">=</span>&nbsp;<span class="ident" id="5244315">matches</span><span class="op" id="5244322">[</span><span class="num" id="5244323">1</span><span class="op" id="5244324">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244329">if</span>&nbsp;<span class="ident" id="5244332">accept</span>&nbsp;<span class="op" id="5244339">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244344">deliver</span><span class="op" id="5244351">(</span><span class="ident" id="5244352">re</span><span class="op" id="5244354">.</span><span class="ident" id="5244355">pad</span><span class="op" id="5244358">(</span><span class="ident" id="5244359">matches</span><span class="op" id="5244366">)</span><span class="op" id="5244367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244372">i</span><span class="op" id="5244373">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244381">}</span><br>
<span class="lineno"></span><span class="op" id="5244383">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5244386">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5244481">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5244526">func</span>&nbsp;<span class="op" id="5244531">(</span><span class="ident" id="5244532">re</span>&nbsp;<span class="op" id="5244535">*</span><span class="ident" id="5244536">Regexp</span><span class="op" id="5244542">)</span>&nbsp;<span class="ident" id="5244544">Find</span><span class="op" id="5244548">(</span><span class="ident" id="5244549">b</span>&nbsp;<span class="op" id="5244551">[</span><span class="op" id="5244552">]</span><span class="builtintype" id="5244553">byte</span><span class="op" id="5244557">)</span>&nbsp;<span class="op" id="5244559">[</span><span class="op" id="5244560">]</span><span class="builtintype" id="5244561">byte</span>&nbsp;<span class="op" id="5244566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244569">a</span>&nbsp;<span class="op" id="5244571">:=</span>&nbsp;<span class="ident" id="5244574">re</span><span class="op" id="5244576">.</span><span class="ident" id="5244577">doExecute</span><span class="op" id="5244586">(</span><span class="ident" id="5244587">nil</span><span class="op" id="5244590">,</span>&nbsp;<span class="ident" id="5244592">b</span><span class="op" id="5244593">,</span>&nbsp;<span class="string" id="5244595">&#34;&#34;</span><span class="op" id="5244597">,</span>&nbsp;<span class="num" id="5244599">0</span><span class="op" id="5244600">,</span>&nbsp;<span class="num" id="5244602">2</span><span class="op" id="5244603">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244606">if</span>&nbsp;<span class="ident" id="5244609">a</span>&nbsp;<span class="op" id="5244611">==</span>&nbsp;<span class="ident" id="5244614">nil</span>&nbsp;<span class="op" id="5244618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244622">return</span>&nbsp;<span class="ident" id="5244629">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5244634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244637">return</span>&nbsp;<span class="ident" id="5244644">b</span><span class="op" id="5244645">[</span><span class="ident" id="5244646">a</span><span class="op" id="5244647">[</span><span class="num" id="5244648">0</span><span class="op" id="5244649">]</span><span class="op" id="5244650">:</span><span class="ident" id="5244651">a</span><span class="op" id="5244652">[</span><span class="num" id="5244653">1</span><span class="op" id="5244654">]</span><span class="op" id="5244655">]</span><br>
<span class="lineno"></span><span class="op" id="5244657">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5244660">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5244738">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5244816">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5244837">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="5244882">func</span>&nbsp;<span class="op" id="5244887">(</span><span class="ident" id="5244888">re</span>&nbsp;<span class="op" id="5244891">*</span><span class="ident" id="5244892">Regexp</span><span class="op" id="5244898">)</span>&nbsp;<span class="ident" id="5244900">FindIndex</span><span class="op" id="5244909">(</span><span class="ident" id="5244910">b</span>&nbsp;<span class="op" id="5244912">[</span><span class="op" id="5244913">]</span><span class="builtintype" id="5244914">byte</span><span class="op" id="5244918">)</span>&nbsp;<span class="op" id="5244920">(</span><span class="ident" id="5244921">loc</span>&nbsp;<span class="op" id="5244925">[</span><span class="op" id="5244926">]</span><span class="builtintype" id="5244927">int</span><span class="op" id="5244930">)</span>&nbsp;<span class="op" id="5244932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5244935">a</span>&nbsp;<span class="op" id="5244937">:=</span>&nbsp;<span class="ident" id="5244940">re</span><span class="op" id="5244942">.</span><span class="ident" id="5244943">doExecute</span><span class="op" id="5244952">(</span><span class="ident" id="5244953">nil</span><span class="op" id="5244956">,</span>&nbsp;<span class="ident" id="5244958">b</span><span class="op" id="5244959">,</span>&nbsp;<span class="string" id="5244961">&#34;&#34;</span><span class="op" id="5244963">,</span>&nbsp;<span class="num" id="5244965">0</span><span class="op" id="5244966">,</span>&nbsp;<span class="num" id="5244968">2</span><span class="op" id="5244969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244972">if</span>&nbsp;<span class="ident" id="5244975">a</span>&nbsp;<span class="op" id="5244977">==</span>&nbsp;<span class="ident" id="5244980">nil</span>&nbsp;<span class="op" id="5244984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5244988">return</span>&nbsp;<span class="ident" id="5244995">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5245000">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245003">return</span>&nbsp;<span class="ident" id="5245010">a</span><span class="op" id="5245011">[</span><span class="num" id="5245012">0</span><span class="op" id="5245013">:</span><span class="num" id="5245014">2</span><span class="op" id="5245015">]</span><br>
<span class="lineno"></span><span class="op" id="5245017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5245020">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5245110">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="5245185">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5245261">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5245333">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="5245374">func</span>&nbsp;<span class="op" id="5245379">(</span><span class="ident" id="5245380">re</span>&nbsp;<span class="op" id="5245383">*</span><span class="ident" id="5245384">Regexp</span><span class="op" id="5245390">)</span>&nbsp;<span class="ident" id="5245392">FindString</span><span class="op" id="5245402">(</span><span class="ident" id="5245403">s</span>&nbsp;<span class="builtintype" id="5245405">string</span><span class="op" id="5245411">)</span>&nbsp;<span class="builtintype" id="5245413">string</span>&nbsp;<span class="op" id="5245420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5245423">a</span>&nbsp;<span class="op" id="5245425">:=</span>&nbsp;<span class="ident" id="5245428">re</span><span class="op" id="5245430">.</span><span class="ident" id="5245431">doExecute</span><span class="op" id="5245440">(</span><span class="ident" id="5245441">nil</span><span class="op" id="5245444">,</span>&nbsp;<span class="ident" id="5245446">nil</span><span class="op" id="5245449">,</span>&nbsp;<span class="ident" id="5245451">s</span><span class="op" id="5245452">,</span>&nbsp;<span class="num" id="5245454">0</span><span class="op" id="5245455">,</span>&nbsp;<span class="num" id="5245457">2</span><span class="op" id="5245458">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245461">if</span>&nbsp;<span class="ident" id="5245464">a</span>&nbsp;<span class="op" id="5245466">==</span>&nbsp;<span class="ident" id="5245469">nil</span>&nbsp;<span class="op" id="5245473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245477">return</span>&nbsp;<span class="string" id="5245484">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5245488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245491">return</span>&nbsp;<span class="ident" id="5245498">s</span><span class="op" id="5245499">[</span><span class="ident" id="5245500">a</span><span class="op" id="5245501">[</span><span class="num" id="5245502">0</span><span class="op" id="5245503">]</span><span class="op" id="5245504">:</span><span class="ident" id="5245505">a</span><span class="op" id="5245506">[</span><span class="num" id="5245507">1</span><span class="op" id="5245508">]</span><span class="op" id="5245509">]</span><br>
<span class="lineno"></span><span class="op" id="5245511">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5245514">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5245586">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5245663">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5245697">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="5245742">func</span>&nbsp;<span class="op" id="5245747">(</span><span class="ident" id="5245748">re</span>&nbsp;<span class="op" id="5245751">*</span><span class="ident" id="5245752">Regexp</span><span class="op" id="5245758">)</span>&nbsp;<span class="ident" id="5245760">FindStringIndex</span><span class="op" id="5245775">(</span><span class="ident" id="5245776">s</span>&nbsp;<span class="builtintype" id="5245778">string</span><span class="op" id="5245784">)</span>&nbsp;<span class="op" id="5245786">(</span><span class="ident" id="5245787">loc</span>&nbsp;<span class="op" id="5245791">[</span><span class="op" id="5245792">]</span><span class="builtintype" id="5245793">int</span><span class="op" id="5245796">)</span>&nbsp;<span class="op" id="5245798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5245801">a</span>&nbsp;<span class="op" id="5245803">:=</span>&nbsp;<span class="ident" id="5245806">re</span><span class="op" id="5245808">.</span><span class="ident" id="5245809">doExecute</span><span class="op" id="5245818">(</span><span class="ident" id="5245819">nil</span><span class="op" id="5245822">,</span>&nbsp;<span class="ident" id="5245824">nil</span><span class="op" id="5245827">,</span>&nbsp;<span class="ident" id="5245829">s</span><span class="op" id="5245830">,</span>&nbsp;<span class="num" id="5245832">0</span><span class="op" id="5245833">,</span>&nbsp;<span class="num" id="5245835">2</span><span class="op" id="5245836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245839">if</span>&nbsp;<span class="ident" id="5245842">a</span>&nbsp;<span class="op" id="5245844">==</span>&nbsp;<span class="ident" id="5245847">nil</span>&nbsp;<span class="op" id="5245851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245855">return</span>&nbsp;<span class="ident" id="5245862">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5245867">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5245870">return</span>&nbsp;<span class="ident" id="5245877">a</span><span class="op" id="5245878">[</span><span class="num" id="5245879">0</span><span class="op" id="5245880">:</span><span class="num" id="5245881">2</span><span class="op" id="5245882">]</span><br>
<span class="lineno"></span><span class="op" id="5245884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5245887">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5245959">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="5246037">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5246105">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="5246145">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5246190">func</span>&nbsp;<span class="op" id="5246195">(</span><span class="ident" id="5246196">re</span>&nbsp;<span class="op" id="5246199">*</span><span class="ident" id="5246200">Regexp</span><span class="op" id="5246206">)</span>&nbsp;<span class="ident" id="5246208">FindReaderIndex</span><span class="op" id="5246223">(</span><span class="ident" id="5246224">r</span>&nbsp;<span class="ident" id="5246226">io</span><span class="op" id="5246228">.</span><span class="ident" id="5246229">RuneReader</span><span class="op" id="5246239">)</span>&nbsp;<span class="op" id="5246241">(</span><span class="ident" id="5246242">loc</span>&nbsp;<span class="op" id="5246246">[</span><span class="op" id="5246247">]</span><span class="builtintype" id="5246248">int</span><span class="op" id="5246251">)</span>&nbsp;<span class="op" id="5246253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246256">a</span>&nbsp;<span class="op" id="5246258">:=</span>&nbsp;<span class="ident" id="5246261">re</span><span class="op" id="5246263">.</span><span class="ident" id="5246264">doExecute</span><span class="op" id="5246273">(</span><span class="ident" id="5246274">r</span><span class="op" id="5246275">,</span>&nbsp;<span class="ident" id="5246277">nil</span><span class="op" id="5246280">,</span>&nbsp;<span class="string" id="5246282">&#34;&#34;</span><span class="op" id="5246284">,</span>&nbsp;<span class="num" id="5246286">0</span><span class="op" id="5246287">,</span>&nbsp;<span class="num" id="5246289">2</span><span class="op" id="5246290">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246293">if</span>&nbsp;<span class="ident" id="5246296">a</span>&nbsp;<span class="op" id="5246298">==</span>&nbsp;<span class="ident" id="5246301">nil</span>&nbsp;<span class="op" id="5246305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246309">return</span>&nbsp;<span class="ident" id="5246316">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246324">return</span>&nbsp;<span class="ident" id="5246331">a</span><span class="op" id="5246332">[</span><span class="num" id="5246333">0</span><span class="op" id="5246334">:</span><span class="num" id="5246335">2</span><span class="op" id="5246336">]</span><br>
<span class="lineno"></span><span class="op" id="5246338">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="5246341">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="5246416">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5246488">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5246564">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="5246576">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5246621">func</span>&nbsp;<span class="op" id="5246626">(</span><span class="ident" id="5246627">re</span>&nbsp;<span class="op" id="5246630">*</span><span class="ident" id="5246631">Regexp</span><span class="op" id="5246637">)</span>&nbsp;<span class="ident" id="5246639">FindSubmatch</span><span class="op" id="5246651">(</span><span class="ident" id="5246652">b</span>&nbsp;<span class="op" id="5246654">[</span><span class="op" id="5246655">]</span><span class="builtintype" id="5246656">byte</span><span class="op" id="5246660">)</span>&nbsp;<span class="op" id="5246662">[</span><span class="op" id="5246663">]</span><span class="op" id="5246664">[</span><span class="op" id="5246665">]</span><span class="builtintype" id="5246666">byte</span>&nbsp;<span class="op" id="5246671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246674">a</span>&nbsp;<span class="op" id="5246676">:=</span>&nbsp;<span class="ident" id="5246679">re</span><span class="op" id="5246681">.</span><span class="ident" id="5246682">doExecute</span><span class="op" id="5246691">(</span><span class="ident" id="5246692">nil</span><span class="op" id="5246695">,</span>&nbsp;<span class="ident" id="5246697">b</span><span class="op" id="5246698">,</span>&nbsp;<span class="string" id="5246700">&#34;&#34;</span><span class="op" id="5246702">,</span>&nbsp;<span class="num" id="5246704">0</span><span class="op" id="5246705">,</span>&nbsp;<span class="ident" id="5246707">re</span><span class="op" id="5246709">.</span><span class="ident" id="5246710">prog</span><span class="op" id="5246714">.</span><span class="ident" id="5246715">NumCap</span><span class="op" id="5246721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246724">if</span>&nbsp;<span class="ident" id="5246727">a</span>&nbsp;<span class="op" id="5246729">==</span>&nbsp;<span class="ident" id="5246732">nil</span>&nbsp;<span class="op" id="5246736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246740">return</span>&nbsp;<span class="ident" id="5246747">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246755">ret</span>&nbsp;<span class="op" id="5246759">:=</span>&nbsp;<span class="builtinfunc" id="5246762">make</span><span class="op" id="5246766">(</span><span class="op" id="5246767">[</span><span class="op" id="5246768">]</span><span class="op" id="5246769">[</span><span class="op" id="5246770">]</span><span class="builtintype" id="5246771">byte</span><span class="op" id="5246775">,</span>&nbsp;<span class="num" id="5246777">1</span><span class="op" id="5246778">+</span><span class="ident" id="5246779">re</span><span class="op" id="5246781">.</span><span class="ident" id="5246782">numSubexp</span><span class="op" id="5246791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246794">for</span>&nbsp;<span class="ident" id="5246798">i</span>&nbsp;<span class="op" id="5246800">:=</span>&nbsp;<span class="keyword" id="5246803">range</span>&nbsp;<span class="ident" id="5246809">ret</span>&nbsp;<span class="op" id="5246813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246817">if</span>&nbsp;<span class="num" id="5246820">2</span><span class="op" id="5246821">*</span><span class="ident" id="5246822">i</span>&nbsp;<span class="op" id="5246824">&lt;</span>&nbsp;<span class="builtinfunc" id="5246826">len</span><span class="op" id="5246829">(</span><span class="ident" id="5246830">a</span><span class="op" id="5246831">)</span>&nbsp;<span class="op" id="5246833">&amp;&amp;</span>&nbsp;<span class="ident" id="5246836">a</span><span class="op" id="5246837">[</span><span class="num" id="5246838">2</span><span class="op" id="5246839">*</span><span class="ident" id="5246840">i</span><span class="op" id="5246841">]</span>&nbsp;<span class="op" id="5246843">&gt;=</span>&nbsp;<span class="num" id="5246846">0</span>&nbsp;<span class="op" id="5246848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5246853">ret</span><span class="op" id="5246856">[</span><span class="ident" id="5246857">i</span><span class="op" id="5246858">]</span>&nbsp;<span class="op" id="5246860">=</span>&nbsp;<span class="ident" id="5246862">b</span><span class="op" id="5246863">[</span><span class="ident" id="5246864">a</span><span class="op" id="5246865">[</span><span class="num" id="5246866">2</span><span class="op" id="5246867">*</span><span class="ident" id="5246868">i</span><span class="op" id="5246869">]</span><span class="op" id="5246870">:</span><span class="ident" id="5246871">a</span><span class="op" id="5246872">[</span><span class="num" id="5246873">2</span><span class="op" id="5246874">*</span><span class="ident" id="5246875">i</span><span class="op" id="5246876">+</span><span class="num" id="5246877">1</span><span class="op" id="5246878">]</span><span class="op" id="5246879">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5246886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5246889">return</span>&nbsp;<span class="ident" id="5246896">ret</span><br>
<span class="lineno"></span><span class="op" id="5246900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5246903">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5246972">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5247044">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5247117">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="5247139">//</span><br>
<span class="lineno">745</span><span class="comment" id="5247142">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5247211">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="5247279">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5247348">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5247415">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="5247480">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5247553">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="5247623">//</span><br>
<span class="lineno"></span><span class="comment" id="5247626">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5247696">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="5247775">//</span><br>
<span class="lineno"></span><span class="comment" id="5247778">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5247842">func</span>&nbsp;<span class="op" id="5247847">(</span><span class="ident" id="5247848">re</span>&nbsp;<span class="op" id="5247851">*</span><span class="ident" id="5247852">Regexp</span><span class="op" id="5247858">)</span>&nbsp;<span class="ident" id="5247860">Expand</span><span class="op" id="5247866">(</span><span class="ident" id="5247867">dst</span>&nbsp;<span class="op" id="5247871">[</span><span class="op" id="5247872">]</span><span class="builtintype" id="5247873">byte</span><span class="op" id="5247877">,</span>&nbsp;<span class="ident" id="5247879">template</span>&nbsp;<span class="op" id="5247888">[</span><span class="op" id="5247889">]</span><span class="builtintype" id="5247890">byte</span><span class="op" id="5247894">,</span>&nbsp;<span class="ident" id="5247896">src</span>&nbsp;<span class="op" id="5247900">[</span><span class="op" id="5247901">]</span><span class="builtintype" id="5247902">byte</span><span class="op" id="5247906">,</span>&nbsp;<span class="ident" id="5247908">match</span>&nbsp;<span class="op" id="5247914">[</span><span class="op" id="5247915">]</span><span class="builtintype" id="5247916">int</span><span class="op" id="5247919">)</span>&nbsp;<span class="op" id="5247921">[</span><span class="op" id="5247922">]</span><span class="builtintype" id="5247923">byte</span>&nbsp;<span class="op" id="5247928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247931">return</span>&nbsp;<span class="ident" id="5247938">re</span><span class="op" id="5247940">.</span><span class="ident" id="5247941">expand</span><span class="op" id="5247947">(</span><span class="ident" id="5247948">dst</span><span class="op" id="5247951">,</span>&nbsp;<span class="builtintype" id="5247953">string</span><span class="op" id="5247959">(</span><span class="ident" id="5247960">template</span><span class="op" id="5247968">)</span><span class="op" id="5247969">,</span>&nbsp;<span class="ident" id="5247971">src</span><span class="op" id="5247974">,</span>&nbsp;<span class="string" id="5247976">&#34;&#34;</span><span class="op" id="5247978">,</span>&nbsp;<span class="ident" id="5247980">match</span><span class="op" id="5247985">)</span><br>
<span class="lineno"></span><span class="op" id="5247987">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="5247990">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="5248062">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5248133">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5248166">func</span>&nbsp;<span class="op" id="5248171">(</span><span class="ident" id="5248172">re</span>&nbsp;<span class="op" id="5248175">*</span><span class="ident" id="5248176">Regexp</span><span class="op" id="5248182">)</span>&nbsp;<span class="ident" id="5248184">ExpandString</span><span class="op" id="5248196">(</span><span class="ident" id="5248197">dst</span>&nbsp;<span class="op" id="5248201">[</span><span class="op" id="5248202">]</span><span class="builtintype" id="5248203">byte</span><span class="op" id="5248207">,</span>&nbsp;<span class="ident" id="5248209">template</span>&nbsp;<span class="builtintype" id="5248218">string</span><span class="op" id="5248224">,</span>&nbsp;<span class="ident" id="5248226">src</span>&nbsp;<span class="builtintype" id="5248230">string</span><span class="op" id="5248236">,</span>&nbsp;<span class="ident" id="5248238">match</span>&nbsp;<span class="op" id="5248244">[</span><span class="op" id="5248245">]</span><span class="builtintype" id="5248246">int</span><span class="op" id="5248249">)</span>&nbsp;<span class="op" id="5248251">[</span><span class="op" id="5248252">]</span><span class="builtintype" id="5248253">byte</span>&nbsp;<span class="op" id="5248258">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248261">return</span>&nbsp;<span class="ident" id="5248268">re</span><span class="op" id="5248270">.</span><span class="ident" id="5248271">expand</span><span class="op" id="5248277">(</span><span class="ident" id="5248278">dst</span><span class="op" id="5248281">,</span>&nbsp;<span class="ident" id="5248283">template</span><span class="op" id="5248291">,</span>&nbsp;<span class="ident" id="5248293">nil</span><span class="op" id="5248296">,</span>&nbsp;<span class="ident" id="5248298">src</span><span class="op" id="5248301">,</span>&nbsp;<span class="ident" id="5248303">match</span><span class="op" id="5248308">)</span><br>
<span class="lineno"></span><span class="op" id="5248310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5248313">func</span>&nbsp;<span class="op" id="5248318">(</span><span class="ident" id="5248319">re</span>&nbsp;<span class="op" id="5248322">*</span><span class="ident" id="5248323">Regexp</span><span class="op" id="5248329">)</span>&nbsp;<span class="ident" id="5248331">expand</span><span class="op" id="5248337">(</span><span class="ident" id="5248338">dst</span>&nbsp;<span class="op" id="5248342">[</span><span class="op" id="5248343">]</span><span class="builtintype" id="5248344">byte</span><span class="op" id="5248348">,</span>&nbsp;<span class="ident" id="5248350">template</span>&nbsp;<span class="builtintype" id="5248359">string</span><span class="op" id="5248365">,</span>&nbsp;<span class="ident" id="5248367">bsrc</span>&nbsp;<span class="op" id="5248372">[</span><span class="op" id="5248373">]</span><span class="builtintype" id="5248374">byte</span><span class="op" id="5248378">,</span>&nbsp;<span class="ident" id="5248380">src</span>&nbsp;<span class="builtintype" id="5248384">string</span><span class="op" id="5248390">,</span>&nbsp;<span class="ident" id="5248392">match</span>&nbsp;<span class="op" id="5248398">[</span><span class="op" id="5248399">]</span><span class="builtintype" id="5248400">int</span><span class="op" id="5248403">)</span>&nbsp;<span class="op" id="5248405">[</span><span class="op" id="5248406">]</span><span class="builtintype" id="5248407">byte</span>&nbsp;<span class="op" id="5248412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248415">for</span>&nbsp;<span class="builtinfunc" id="5248419">len</span><span class="op" id="5248422">(</span><span class="ident" id="5248423">template</span><span class="op" id="5248431">)</span>&nbsp;<span class="op" id="5248433">&gt;</span>&nbsp;<span class="num" id="5248435">0</span>&nbsp;<span class="op" id="5248437">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248441">i</span>&nbsp;<span class="op" id="5248443">:=</span>&nbsp;<span class="ident" id="5248446">strings</span><span class="op" id="5248453">.</span><span class="ident" id="5248454">Index</span><span class="op" id="5248459">(</span><span class="ident" id="5248460">template</span><span class="op" id="5248468">,</span>&nbsp;<span class="string" id="5248470">&#34;$&#34;</span><span class="op" id="5248473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248477">if</span>&nbsp;<span class="ident" id="5248480">i</span>&nbsp;<span class="op" id="5248482">&lt;</span>&nbsp;<span class="num" id="5248484">0</span>&nbsp;<span class="op" id="5248486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248491">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248503">dst</span>&nbsp;<span class="op" id="5248507">=</span>&nbsp;<span class="builtinfunc" id="5248509">append</span><span class="op" id="5248515">(</span><span class="ident" id="5248516">dst</span><span class="op" id="5248519">,</span>&nbsp;<span class="ident" id="5248521">template</span><span class="op" id="5248529">[</span><span class="op" id="5248530">:</span><span class="ident" id="5248531">i</span><span class="op" id="5248532">]</span><span class="op" id="5248533">...</span><span class="op" id="5248536">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248540">template</span>&nbsp;<span class="op" id="5248549">=</span>&nbsp;<span class="ident" id="5248551">template</span><span class="op" id="5248559">[</span><span class="ident" id="5248560">i</span><span class="op" id="5248561">:</span><span class="op" id="5248562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248566">if</span>&nbsp;<span class="builtinfunc" id="5248569">len</span><span class="op" id="5248572">(</span><span class="ident" id="5248573">template</span><span class="op" id="5248581">)</span>&nbsp;<span class="op" id="5248583">&gt;</span>&nbsp;<span class="num" id="5248585">1</span>&nbsp;<span class="op" id="5248587">&amp;&amp;</span>&nbsp;<span class="ident" id="5248590">template</span><span class="op" id="5248598">[</span><span class="num" id="5248599">1</span><span class="op" id="5248600">]</span>&nbsp;<span class="op" id="5248602">==</span>&nbsp;<span class="string" id="5248605">&#39;$&#39;</span>&nbsp;<span class="op" id="5248609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5248614">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248635">dst</span>&nbsp;<span class="op" id="5248639">=</span>&nbsp;<span class="builtinfunc" id="5248641">append</span><span class="op" id="5248647">(</span><span class="ident" id="5248648">dst</span><span class="op" id="5248651">,</span>&nbsp;<span class="string" id="5248653">&#39;$&#39;</span><span class="op" id="5248656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248661">template</span>&nbsp;<span class="op" id="5248670">=</span>&nbsp;<span class="ident" id="5248672">template</span><span class="op" id="5248680">[</span><span class="num" id="5248681">2</span><span class="op" id="5248682">:</span><span class="op" id="5248683">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248688">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248703">name</span><span class="op" id="5248707">,</span>&nbsp;<span class="ident" id="5248709">num</span><span class="op" id="5248712">,</span>&nbsp;<span class="ident" id="5248714">rest</span><span class="op" id="5248718">,</span>&nbsp;<span class="ident" id="5248720">ok</span>&nbsp;<span class="op" id="5248723">:=</span>&nbsp;<span class="ident" id="5248726">extract</span><span class="op" id="5248733">(</span><span class="ident" id="5248734">template</span><span class="op" id="5248742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248746">if</span>&nbsp;<span class="op" id="5248749">!</span><span class="ident" id="5248750">ok</span>&nbsp;<span class="op" id="5248753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5248758">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248796">dst</span>&nbsp;<span class="op" id="5248800">=</span>&nbsp;<span class="builtinfunc" id="5248802">append</span><span class="op" id="5248808">(</span><span class="ident" id="5248809">dst</span><span class="op" id="5248812">,</span>&nbsp;<span class="string" id="5248814">&#39;$&#39;</span><span class="op" id="5248817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248822">template</span>&nbsp;<span class="op" id="5248831">=</span>&nbsp;<span class="ident" id="5248833">template</span><span class="op" id="5248841">[</span><span class="num" id="5248842">1</span><span class="op" id="5248843">:</span><span class="op" id="5248844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248849">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248864">template</span>&nbsp;<span class="op" id="5248873">=</span>&nbsp;<span class="ident" id="5248875">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248882">if</span>&nbsp;<span class="ident" id="5248885">num</span>&nbsp;<span class="op" id="5248889">&gt;=</span>&nbsp;<span class="num" id="5248892">0</span>&nbsp;<span class="op" id="5248894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248899">if</span>&nbsp;<span class="num" id="5248902">2</span><span class="op" id="5248903">*</span><span class="ident" id="5248904">num</span><span class="op" id="5248907">+</span><span class="num" id="5248908">1</span>&nbsp;<span class="op" id="5248910">&lt;</span>&nbsp;<span class="builtinfunc" id="5248912">len</span><span class="op" id="5248915">(</span><span class="ident" id="5248916">match</span><span class="op" id="5248921">)</span>&nbsp;<span class="op" id="5248923">&amp;&amp;</span>&nbsp;<span class="ident" id="5248926">match</span><span class="op" id="5248931">[</span><span class="num" id="5248932">2</span><span class="op" id="5248933">*</span><span class="ident" id="5248934">num</span><span class="op" id="5248937">]</span>&nbsp;<span class="op" id="5248939">&gt;=</span>&nbsp;<span class="num" id="5248942">0</span>&nbsp;<span class="op" id="5248944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248950">if</span>&nbsp;<span class="ident" id="5248953">bsrc</span>&nbsp;<span class="op" id="5248958">!=</span>&nbsp;<span class="ident" id="5248961">nil</span>&nbsp;<span class="op" id="5248965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248972">dst</span>&nbsp;<span class="op" id="5248976">=</span>&nbsp;<span class="builtinfunc" id="5248978">append</span><span class="op" id="5248984">(</span><span class="ident" id="5248985">dst</span><span class="op" id="5248988">,</span>&nbsp;<span class="ident" id="5248990">bsrc</span><span class="op" id="5248994">[</span><span class="ident" id="5248995">match</span><span class="op" id="5249000">[</span><span class="num" id="5249001">2</span><span class="op" id="5249002">*</span><span class="ident" id="5249003">num</span><span class="op" id="5249006">]</span><span class="op" id="5249007">:</span><span class="ident" id="5249008">match</span><span class="op" id="5249013">[</span><span class="num" id="5249014">2</span><span class="op" id="5249015">*</span><span class="ident" id="5249016">num</span><span class="op" id="5249019">+</span><span class="num" id="5249020">1</span><span class="op" id="5249021">]</span><span class="op" id="5249022">]</span><span class="op" id="5249023">...</span><span class="op" id="5249026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249032">}</span>&nbsp;<span class="keyword" id="5249034">else</span>&nbsp;<span class="op" id="5249039">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249046">dst</span>&nbsp;<span class="op" id="5249050">=</span>&nbsp;<span class="builtinfunc" id="5249052">append</span><span class="op" id="5249058">(</span><span class="ident" id="5249059">dst</span><span class="op" id="5249062">,</span>&nbsp;<span class="ident" id="5249064">src</span><span class="op" id="5249067">[</span><span class="ident" id="5249068">match</span><span class="op" id="5249073">[</span><span class="num" id="5249074">2</span><span class="op" id="5249075">*</span><span class="ident" id="5249076">num</span><span class="op" id="5249079">]</span><span class="op" id="5249080">:</span><span class="ident" id="5249081">match</span><span class="op" id="5249086">[</span><span class="num" id="5249087">2</span><span class="op" id="5249088">*</span><span class="ident" id="5249089">num</span><span class="op" id="5249092">+</span><span class="num" id="5249093">1</span><span class="op" id="5249094">]</span><span class="op" id="5249095">]</span><span class="op" id="5249096">...</span><span class="op" id="5249099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249114">}</span>&nbsp;<span class="keyword" id="5249116">else</span>&nbsp;<span class="op" id="5249121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249126">for</span>&nbsp;<span class="ident" id="5249130">i</span><span class="op" id="5249131">,</span>&nbsp;<span class="ident" id="5249133">namei</span>&nbsp;<span class="op" id="5249139">:=</span>&nbsp;<span class="keyword" id="5249142">range</span>&nbsp;<span class="ident" id="5249148">re</span><span class="op" id="5249150">.</span><span class="ident" id="5249151">subexpNames</span>&nbsp;<span class="op" id="5249163">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249169">if</span>&nbsp;<span class="ident" id="5249172">name</span>&nbsp;<span class="op" id="5249177">==</span>&nbsp;<span class="ident" id="5249180">namei</span>&nbsp;<span class="op" id="5249186">&amp;&amp;</span>&nbsp;<span class="num" id="5249189">2</span><span class="op" id="5249190">*</span><span class="ident" id="5249191">i</span><span class="op" id="5249192">+</span><span class="num" id="5249193">1</span>&nbsp;<span class="op" id="5249195">&lt;</span>&nbsp;<span class="builtinfunc" id="5249197">len</span><span class="op" id="5249200">(</span><span class="ident" id="5249201">match</span><span class="op" id="5249206">)</span>&nbsp;<span class="op" id="5249208">&amp;&amp;</span>&nbsp;<span class="ident" id="5249211">match</span><span class="op" id="5249216">[</span><span class="num" id="5249217">2</span><span class="op" id="5249218">*</span><span class="ident" id="5249219">i</span><span class="op" id="5249220">]</span>&nbsp;<span class="op" id="5249222">&gt;=</span>&nbsp;<span class="num" id="5249225">0</span>&nbsp;<span class="op" id="5249227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249234">if</span>&nbsp;<span class="ident" id="5249237">bsrc</span>&nbsp;<span class="op" id="5249242">!=</span>&nbsp;<span class="ident" id="5249245">nil</span>&nbsp;<span class="op" id="5249249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249257">dst</span>&nbsp;<span class="op" id="5249261">=</span>&nbsp;<span class="builtinfunc" id="5249263">append</span><span class="op" id="5249269">(</span><span class="ident" id="5249270">dst</span><span class="op" id="5249273">,</span>&nbsp;<span class="ident" id="5249275">bsrc</span><span class="op" id="5249279">[</span><span class="ident" id="5249280">match</span><span class="op" id="5249285">[</span><span class="num" id="5249286">2</span><span class="op" id="5249287">*</span><span class="ident" id="5249288">i</span><span class="op" id="5249289">]</span><span class="op" id="5249290">:</span><span class="ident" id="5249291">match</span><span class="op" id="5249296">[</span><span class="num" id="5249297">2</span><span class="op" id="5249298">*</span><span class="ident" id="5249299">i</span><span class="op" id="5249300">+</span><span class="num" id="5249301">1</span><span class="op" id="5249302">]</span><span class="op" id="5249303">]</span><span class="op" id="5249304">...</span><span class="op" id="5249307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249314">}</span>&nbsp;<span class="keyword" id="5249316">else</span>&nbsp;<span class="op" id="5249321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249329">dst</span>&nbsp;<span class="op" id="5249333">=</span>&nbsp;<span class="builtinfunc" id="5249335">append</span><span class="op" id="5249341">(</span><span class="ident" id="5249342">dst</span><span class="op" id="5249345">,</span>&nbsp;<span class="ident" id="5249347">src</span><span class="op" id="5249350">[</span><span class="ident" id="5249351">match</span><span class="op" id="5249356">[</span><span class="num" id="5249357">2</span><span class="op" id="5249358">*</span><span class="ident" id="5249359">i</span><span class="op" id="5249360">]</span><span class="op" id="5249361">:</span><span class="ident" id="5249362">match</span><span class="op" id="5249367">[</span><span class="num" id="5249368">2</span><span class="op" id="5249369">*</span><span class="ident" id="5249370">i</span><span class="op" id="5249371">+</span><span class="num" id="5249372">1</span><span class="op" id="5249373">]</span><span class="op" id="5249374">]</span><span class="op" id="5249375">...</span><span class="op" id="5249378">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249392">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249411">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249417">dst</span>&nbsp;<span class="op" id="5249421">=</span>&nbsp;<span class="builtinfunc" id="5249423">append</span><span class="op" id="5249429">(</span><span class="ident" id="5249430">dst</span><span class="op" id="5249433">,</span>&nbsp;<span class="ident" id="5249435">template</span><span class="op" id="5249443">...</span><span class="op" id="5249446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249449">return</span>&nbsp;<span class="ident" id="5249456">dst</span><br>
<span class="lineno"></span><span class="op" id="5249460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="5249463">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="5249535">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5249617">func</span>&nbsp;<span class="ident" id="5249622">extract</span><span class="op" id="5249629">(</span><span class="ident" id="5249630">str</span>&nbsp;<span class="builtintype" id="5249634">string</span><span class="op" id="5249640">)</span>&nbsp;<span class="op" id="5249642">(</span><span class="ident" id="5249643">name</span>&nbsp;<span class="builtintype" id="5249648">string</span><span class="op" id="5249654">,</span>&nbsp;<span class="ident" id="5249656">num</span>&nbsp;<span class="builtintype" id="5249660">int</span><span class="op" id="5249663">,</span>&nbsp;<span class="ident" id="5249665">rest</span>&nbsp;<span class="builtintype" id="5249670">string</span><span class="op" id="5249676">,</span>&nbsp;<span class="ident" id="5249678">ok</span>&nbsp;<span class="builtintype" id="5249681">bool</span><span class="op" id="5249685">)</span>&nbsp;<span class="op" id="5249687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249690">if</span>&nbsp;<span class="builtinfunc" id="5249693">len</span><span class="op" id="5249696">(</span><span class="ident" id="5249697">str</span><span class="op" id="5249700">)</span>&nbsp;<span class="op" id="5249702">&lt;</span>&nbsp;<span class="num" id="5249704">2</span>&nbsp;<span class="op" id="5249706">||</span>&nbsp;<span class="ident" id="5249709">str</span><span class="op" id="5249712">[</span><span class="num" id="5249713">0</span><span class="op" id="5249714">]</span>&nbsp;<span class="op" id="5249716">!=</span>&nbsp;<span class="string" id="5249719">&#39;$&#39;</span>&nbsp;<span class="op" id="5249723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249727">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249738">brace</span>&nbsp;<span class="op" id="5249744">:=</span>&nbsp;<span class="builtintype" id="5249747">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249754">if</span>&nbsp;<span class="ident" id="5249757">str</span><span class="op" id="5249760">[</span><span class="num" id="5249761">1</span><span class="op" id="5249762">]</span>&nbsp;<span class="op" id="5249764">==</span>&nbsp;<span class="string" id="5249767">&#39;{&#39;</span>&nbsp;<span class="op" id="5249771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249775">brace</span>&nbsp;<span class="op" id="5249781">=</span>&nbsp;<span class="builtintype" id="5249783">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249790">str</span>&nbsp;<span class="op" id="5249794">=</span>&nbsp;<span class="ident" id="5249796">str</span><span class="op" id="5249799">[</span><span class="num" id="5249800">2</span><span class="op" id="5249801">:</span><span class="op" id="5249802">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249805">}</span>&nbsp;<span class="keyword" id="5249807">else</span>&nbsp;<span class="op" id="5249812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249816">str</span>&nbsp;<span class="op" id="5249820">=</span>&nbsp;<span class="ident" id="5249822">str</span><span class="op" id="5249825">[</span><span class="num" id="5249826">1</span><span class="op" id="5249827">:</span><span class="op" id="5249828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249834">i</span>&nbsp;<span class="op" id="5249836">:=</span>&nbsp;<span class="num" id="5249839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249842">for</span>&nbsp;<span class="ident" id="5249846">i</span>&nbsp;<span class="op" id="5249848">&lt;</span>&nbsp;<span class="builtinfunc" id="5249850">len</span><span class="op" id="5249853">(</span><span class="ident" id="5249854">str</span><span class="op" id="5249857">)</span>&nbsp;<span class="op" id="5249859">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5249863">rune</span><span class="op" id="5249867">,</span>&nbsp;<span class="ident" id="5249869">size</span>&nbsp;<span class="op" id="5249874">:=</span>&nbsp;<span class="ident" id="5249877">utf8</span><span class="op" id="5249881">.</span><span class="ident" id="5249882">DecodeRuneInString</span><span class="op" id="5249900">(</span><span class="ident" id="5249901">str</span><span class="op" id="5249904">[</span><span class="ident" id="5249905">i</span><span class="op" id="5249906">:</span><span class="op" id="5249907">]</span><span class="op" id="5249908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249912">if</span>&nbsp;<span class="op" id="5249915">!</span><span class="ident" id="5249916">unicode</span><span class="op" id="5249923">.</span><span class="ident" id="5249924">IsLetter</span><span class="op" id="5249932">(</span><span class="builtintype" id="5249933">rune</span><span class="op" id="5249937">)</span>&nbsp;<span class="op" id="5249939">&amp;&amp;</span>&nbsp;<span class="op" id="5249942">!</span><span class="ident" id="5249943">unicode</span><span class="op" id="5249950">.</span><span class="ident" id="5249951">IsDigit</span><span class="op" id="5249958">(</span><span class="builtintype" id="5249959">rune</span><span class="op" id="5249963">)</span>&nbsp;<span class="op" id="5249965">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5249968">rune</span>&nbsp;<span class="op" id="5249973">!=</span>&nbsp;<span class="string" id="5249976">&#39;_&#39;</span>&nbsp;<span class="op" id="5249980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249985">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249997">i</span>&nbsp;<span class="op" id="5249999">+=</span>&nbsp;<span class="ident" id="5250002">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250011">if</span>&nbsp;<span class="ident" id="5250014">i</span>&nbsp;<span class="op" id="5250016">==</span>&nbsp;<span class="num" id="5250019">0</span>&nbsp;<span class="op" id="5250021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5250025">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250061">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250064">name</span>&nbsp;<span class="op" id="5250069">=</span>&nbsp;<span class="ident" id="5250071">str</span><span class="op" id="5250074">[</span><span class="op" id="5250075">:</span><span class="ident" id="5250076">i</span><span class="op" id="5250077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250080">if</span>&nbsp;<span class="ident" id="5250083">brace</span>&nbsp;<span class="op" id="5250089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250093">if</span>&nbsp;<span class="ident" id="5250096">i</span>&nbsp;<span class="op" id="5250098">&gt;=</span>&nbsp;<span class="builtinfunc" id="5250101">len</span><span class="op" id="5250104">(</span><span class="ident" id="5250105">str</span><span class="op" id="5250108">)</span>&nbsp;<span class="op" id="5250110">||</span>&nbsp;<span class="ident" id="5250113">str</span><span class="op" id="5250116">[</span><span class="ident" id="5250117">i</span><span class="op" id="5250118">]</span>&nbsp;<span class="op" id="5250120">!=</span>&nbsp;<span class="string" id="5250123">&#39;}&#39;</span>&nbsp;<span class="op" id="5250127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5250132">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250160">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250173">i</span><span class="op" id="5250174">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5250182">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250200">num</span>&nbsp;<span class="op" id="5250204">=</span>&nbsp;<span class="num" id="5250206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250209">for</span>&nbsp;<span class="ident" id="5250213">i</span>&nbsp;<span class="op" id="5250215">:=</span>&nbsp;<span class="num" id="5250218">0</span><span class="op" id="5250219">;</span>&nbsp;<span class="ident" id="5250221">i</span>&nbsp;<span class="op" id="5250223">&lt;</span>&nbsp;<span class="builtinfunc" id="5250225">len</span><span class="op" id="5250228">(</span><span class="ident" id="5250229">name</span><span class="op" id="5250233">)</span><span class="op" id="5250234">;</span>&nbsp;<span class="ident" id="5250236">i</span><span class="op" id="5250237">++</span>&nbsp;<span class="op" id="5250240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250244">if</span>&nbsp;<span class="ident" id="5250247">name</span><span class="op" id="5250251">[</span><span class="ident" id="5250252">i</span><span class="op" id="5250253">]</span>&nbsp;<span class="op" id="5250255">&lt;</span>&nbsp;<span class="string" id="5250257">&#39;0&#39;</span>&nbsp;<span class="op" id="5250261">||</span>&nbsp;<span class="string" id="5250264">&#39;9&#39;</span>&nbsp;<span class="op" id="5250268">&lt;</span>&nbsp;<span class="ident" id="5250270">name</span><span class="op" id="5250274">[</span><span class="ident" id="5250275">i</span><span class="op" id="5250276">]</span>&nbsp;<span class="op" id="5250278">||</span>&nbsp;<span class="ident" id="5250281">num</span>&nbsp;<span class="op" id="5250285">&gt;=</span>&nbsp;<span class="num" id="5250288">1e8</span>&nbsp;<span class="op" id="5250292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250297">num</span>&nbsp;<span class="op" id="5250301">=</span>&nbsp;<span class="op" id="5250303">-</span><span class="num" id="5250304">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250309">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250321">num</span>&nbsp;<span class="op" id="5250325">=</span>&nbsp;<span class="ident" id="5250327">num</span><span class="op" id="5250330">*</span><span class="num" id="5250331">10</span>&nbsp;<span class="op" id="5250334">+</span>&nbsp;<span class="builtintype" id="5250336">int</span><span class="op" id="5250339">(</span><span class="ident" id="5250340">name</span><span class="op" id="5250344">[</span><span class="ident" id="5250345">i</span><span class="op" id="5250346">]</span><span class="op" id="5250347">)</span>&nbsp;<span class="op" id="5250349">-</span>&nbsp;<span class="string" id="5250351">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5250359">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250387">if</span>&nbsp;<span class="ident" id="5250390">name</span><span class="op" id="5250394">[</span><span class="num" id="5250395">0</span><span class="op" id="5250396">]</span>&nbsp;<span class="op" id="5250398">==</span>&nbsp;<span class="string" id="5250401">&#39;0&#39;</span>&nbsp;<span class="op" id="5250405">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5250408">len</span><span class="op" id="5250411">(</span><span class="ident" id="5250412">name</span><span class="op" id="5250416">)</span>&nbsp;<span class="op" id="5250418">&gt;</span>&nbsp;<span class="num" id="5250420">1</span>&nbsp;<span class="op" id="5250422">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250426">num</span>&nbsp;<span class="op" id="5250430">=</span>&nbsp;<span class="op" id="5250432">-</span><span class="num" id="5250433">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250440">rest</span>&nbsp;<span class="op" id="5250445">=</span>&nbsp;<span class="ident" id="5250447">str</span><span class="op" id="5250450">[</span><span class="ident" id="5250451">i</span><span class="op" id="5250452">:</span><span class="op" id="5250453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250456">ok</span>&nbsp;<span class="op" id="5250459">=</span>&nbsp;<span class="builtintype" id="5250461">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250467">return</span><br>
<span class="lineno"></span><span class="op" id="5250474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250477">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5250554">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="5250631">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="5250708">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5250735">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5250780">func</span>&nbsp;<span class="op" id="5250785">(</span><span class="ident" id="5250786">re</span>&nbsp;<span class="op" id="5250789">*</span><span class="ident" id="5250790">Regexp</span><span class="op" id="5250796">)</span>&nbsp;<span class="ident" id="5250798">FindSubmatchIndex</span><span class="op" id="5250815">(</span><span class="ident" id="5250816">b</span>&nbsp;<span class="op" id="5250818">[</span><span class="op" id="5250819">]</span><span class="builtintype" id="5250820">byte</span><span class="op" id="5250824">)</span>&nbsp;<span class="op" id="5250826">[</span><span class="op" id="5250827">]</span><span class="builtintype" id="5250828">int</span>&nbsp;<span class="op" id="5250832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250835">return</span>&nbsp;<span class="ident" id="5250842">re</span><span class="op" id="5250844">.</span><span class="ident" id="5250845">pad</span><span class="op" id="5250848">(</span><span class="ident" id="5250849">re</span><span class="op" id="5250851">.</span><span class="ident" id="5250852">doExecute</span><span class="op" id="5250861">(</span><span class="ident" id="5250862">nil</span><span class="op" id="5250865">,</span>&nbsp;<span class="ident" id="5250867">b</span><span class="op" id="5250868">,</span>&nbsp;<span class="string" id="5250870">&#34;&#34;</span><span class="op" id="5250872">,</span>&nbsp;<span class="num" id="5250874">0</span><span class="op" id="5250875">,</span>&nbsp;<span class="ident" id="5250877">re</span><span class="op" id="5250879">.</span><span class="ident" id="5250880">prog</span><span class="op" id="5250884">.</span><span class="ident" id="5250885">NumCap</span><span class="op" id="5250891">)</span><span class="op" id="5250892">)</span><br>
<span class="lineno">875</span><span class="op" id="5250894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250897">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5250970">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5251047">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="5251118">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5251138">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5251183">func</span>&nbsp;<span class="op" id="5251188">(</span><span class="ident" id="5251189">re</span>&nbsp;<span class="op" id="5251192">*</span><span class="ident" id="5251193">Regexp</span><span class="op" id="5251199">)</span>&nbsp;<span class="ident" id="5251201">FindStringSubmatch</span><span class="op" id="5251219">(</span><span class="ident" id="5251220">s</span>&nbsp;<span class="builtintype" id="5251222">string</span><span class="op" id="5251228">)</span>&nbsp;<span class="op" id="5251230">[</span><span class="op" id="5251231">]</span><span class="builtintype" id="5251232">string</span>&nbsp;<span class="op" id="5251239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251242">a</span>&nbsp;<span class="op" id="5251244">:=</span>&nbsp;<span class="ident" id="5251247">re</span><span class="op" id="5251249">.</span><span class="ident" id="5251250">doExecute</span><span class="op" id="5251259">(</span><span class="ident" id="5251260">nil</span><span class="op" id="5251263">,</span>&nbsp;<span class="ident" id="5251265">nil</span><span class="op" id="5251268">,</span>&nbsp;<span class="ident" id="5251270">s</span><span class="op" id="5251271">,</span>&nbsp;<span class="num" id="5251273">0</span><span class="op" id="5251274">,</span>&nbsp;<span class="ident" id="5251276">re</span><span class="op" id="5251278">.</span><span class="ident" id="5251279">prog</span><span class="op" id="5251283">.</span><span class="ident" id="5251284">NumCap</span><span class="op" id="5251290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251293">if</span>&nbsp;<span class="ident" id="5251296">a</span>&nbsp;<span class="op" id="5251298">==</span>&nbsp;<span class="ident" id="5251301">nil</span>&nbsp;<span class="op" id="5251305">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251309">return</span>&nbsp;<span class="ident" id="5251316">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251324">ret</span>&nbsp;<span class="op" id="5251328">:=</span>&nbsp;<span class="builtinfunc" id="5251331">make</span><span class="op" id="5251335">(</span><span class="op" id="5251336">[</span><span class="op" id="5251337">]</span><span class="builtintype" id="5251338">string</span><span class="op" id="5251344">,</span>&nbsp;<span class="num" id="5251346">1</span><span class="op" id="5251347">+</span><span class="ident" id="5251348">re</span><span class="op" id="5251350">.</span><span class="ident" id="5251351">numSubexp</span><span class="op" id="5251360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251363">for</span>&nbsp;<span class="ident" id="5251367">i</span>&nbsp;<span class="op" id="5251369">:=</span>&nbsp;<span class="keyword" id="5251372">range</span>&nbsp;<span class="ident" id="5251378">ret</span>&nbsp;<span class="op" id="5251382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251386">if</span>&nbsp;<span class="num" id="5251389">2</span><span class="op" id="5251390">*</span><span class="ident" id="5251391">i</span>&nbsp;<span class="op" id="5251393">&lt;</span>&nbsp;<span class="builtinfunc" id="5251395">len</span><span class="op" id="5251398">(</span><span class="ident" id="5251399">a</span><span class="op" id="5251400">)</span>&nbsp;<span class="op" id="5251402">&amp;&amp;</span>&nbsp;<span class="ident" id="5251405">a</span><span class="op" id="5251406">[</span><span class="num" id="5251407">2</span><span class="op" id="5251408">*</span><span class="ident" id="5251409">i</span><span class="op" id="5251410">]</span>&nbsp;<span class="op" id="5251412">&gt;=</span>&nbsp;<span class="num" id="5251415">0</span>&nbsp;<span class="op" id="5251417">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251422">ret</span><span class="op" id="5251425">[</span><span class="ident" id="5251426">i</span><span class="op" id="5251427">]</span>&nbsp;<span class="op" id="5251429">=</span>&nbsp;<span class="ident" id="5251431">s</span><span class="op" id="5251432">[</span><span class="ident" id="5251433">a</span><span class="op" id="5251434">[</span><span class="num" id="5251435">2</span><span class="op" id="5251436">*</span><span class="ident" id="5251437">i</span><span class="op" id="5251438">]</span><span class="op" id="5251439">:</span><span class="ident" id="5251440">a</span><span class="op" id="5251441">[</span><span class="num" id="5251442">2</span><span class="op" id="5251443">*</span><span class="ident" id="5251444">i</span><span class="op" id="5251445">+</span><span class="num" id="5251446">1</span><span class="op" id="5251447">]</span><span class="op" id="5251448">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251458">return</span>&nbsp;<span class="ident" id="5251465">ret</span><br>
<span class="lineno"></span><span class="op" id="5251469">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="5251472">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5251539">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5251612">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5251688">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="5251736">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5251781">func</span>&nbsp;<span class="op" id="5251786">(</span><span class="ident" id="5251787">re</span>&nbsp;<span class="op" id="5251790">*</span><span class="ident" id="5251791">Regexp</span><span class="op" id="5251797">)</span>&nbsp;<span class="ident" id="5251799">FindStringSubmatchIndex</span><span class="op" id="5251822">(</span><span class="ident" id="5251823">s</span>&nbsp;<span class="builtintype" id="5251825">string</span><span class="op" id="5251831">)</span>&nbsp;<span class="op" id="5251833">[</span><span class="op" id="5251834">]</span><span class="builtintype" id="5251835">int</span>&nbsp;<span class="op" id="5251839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251842">return</span>&nbsp;<span class="ident" id="5251849">re</span><span class="op" id="5251851">.</span><span class="ident" id="5251852">pad</span><span class="op" id="5251855">(</span><span class="ident" id="5251856">re</span><span class="op" id="5251858">.</span><span class="ident" id="5251859">doExecute</span><span class="op" id="5251868">(</span><span class="ident" id="5251869">nil</span><span class="op" id="5251872">,</span>&nbsp;<span class="ident" id="5251874">nil</span><span class="op" id="5251877">,</span>&nbsp;<span class="ident" id="5251879">s</span><span class="op" id="5251880">,</span>&nbsp;<span class="num" id="5251882">0</span><span class="op" id="5251883">,</span>&nbsp;<span class="ident" id="5251885">re</span><span class="op" id="5251887">.</span><span class="ident" id="5251888">prog</span><span class="op" id="5251892">.</span><span class="ident" id="5251893">NumCap</span><span class="op" id="5251899">)</span><span class="op" id="5251900">)</span><br>
<span class="lineno"></span><span class="op" id="5251902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5251905">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5251972">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5252048">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="5252126">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="5252199">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="5252242">func</span>&nbsp;<span class="op" id="5252247">(</span><span class="ident" id="5252248">re</span>&nbsp;<span class="op" id="5252251">*</span><span class="ident" id="5252252">Regexp</span><span class="op" id="5252258">)</span>&nbsp;<span class="ident" id="5252260">FindReaderSubmatchIndex</span><span class="op" id="5252283">(</span><span class="ident" id="5252284">r</span>&nbsp;<span class="ident" id="5252286">io</span><span class="op" id="5252288">.</span><span class="ident" id="5252289">RuneReader</span><span class="op" id="5252299">)</span>&nbsp;<span class="op" id="5252301">[</span><span class="op" id="5252302">]</span><span class="builtintype" id="5252303">int</span>&nbsp;<span class="op" id="5252307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252310">return</span>&nbsp;<span class="ident" id="5252317">re</span><span class="op" id="5252319">.</span><span class="ident" id="5252320">pad</span><span class="op" id="5252323">(</span><span class="ident" id="5252324">re</span><span class="op" id="5252326">.</span><span class="ident" id="5252327">doExecute</span><span class="op" id="5252336">(</span><span class="ident" id="5252337">r</span><span class="op" id="5252338">,</span>&nbsp;<span class="ident" id="5252340">nil</span><span class="op" id="5252343">,</span>&nbsp;<span class="string" id="5252345">&#34;&#34;</span><span class="op" id="5252347">,</span>&nbsp;<span class="num" id="5252349">0</span><span class="op" id="5252350">,</span>&nbsp;<span class="ident" id="5252352">re</span><span class="op" id="5252354">.</span><span class="ident" id="5252355">prog</span><span class="op" id="5252359">.</span><span class="ident" id="5252360">NumCap</span><span class="op" id="5252366">)</span><span class="op" id="5252367">)</span><br>
<span class="lineno"></span><span class="op" id="5252369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5252372">const</span>&nbsp;<span class="ident" id="5252378">startSize</span>&nbsp;<span class="op" id="5252388">=</span>&nbsp;<span class="num" id="5252390">10</span>&nbsp;<span class="comment" id="5252393">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="5252455">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5252533">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5252606">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5252626">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="5252671">func</span>&nbsp;<span class="op" id="5252676">(</span><span class="ident" id="5252677">re</span>&nbsp;<span class="op" id="5252680">*</span><span class="ident" id="5252681">Regexp</span><span class="op" id="5252687">)</span>&nbsp;<span class="ident" id="5252689">FindAll</span><span class="op" id="5252696">(</span><span class="ident" id="5252697">b</span>&nbsp;<span class="op" id="5252699">[</span><span class="op" id="5252700">]</span><span class="builtintype" id="5252701">byte</span><span class="op" id="5252705">,</span>&nbsp;<span class="ident" id="5252707">n</span>&nbsp;<span class="builtintype" id="5252709">int</span><span class="op" id="5252712">)</span>&nbsp;<span class="op" id="5252714">[</span><span class="op" id="5252715">]</span><span class="op" id="5252716">[</span><span class="op" id="5252717">]</span><span class="builtintype" id="5252718">byte</span>&nbsp;<span class="op" id="5252723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252726">if</span>&nbsp;<span class="ident" id="5252729">n</span>&nbsp;<span class="op" id="5252731">&lt;</span>&nbsp;<span class="num" id="5252733">0</span>&nbsp;<span class="op" id="5252735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252739">n</span>&nbsp;<span class="op" id="5252741">=</span>&nbsp;<span class="builtinfunc" id="5252743">len</span><span class="op" id="5252746">(</span><span class="ident" id="5252747">b</span><span class="op" id="5252748">)</span>&nbsp;<span class="op" id="5252750">+</span>&nbsp;<span class="num" id="5252752">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252758">result</span>&nbsp;<span class="op" id="5252765">:=</span>&nbsp;<span class="builtinfunc" id="5252768">make</span><span class="op" id="5252772">(</span><span class="op" id="5252773">[</span><span class="op" id="5252774">]</span><span class="op" id="5252775">[</span><span class="op" id="5252776">]</span><span class="builtintype" id="5252777">byte</span><span class="op" id="5252781">,</span>&nbsp;<span class="num" id="5252783">0</span><span class="op" id="5252784">,</span>&nbsp;<span class="ident" id="5252786">startSize</span><span class="op" id="5252795">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252798">re</span><span class="op" id="5252800">.</span><span class="ident" id="5252801">allMatches</span><span class="op" id="5252811">(</span><span class="string" id="5252812">&#34;&#34;</span><span class="op" id="5252814">,</span>&nbsp;<span class="ident" id="5252816">b</span><span class="op" id="5252817">,</span>&nbsp;<span class="ident" id="5252819">n</span><span class="op" id="5252820">,</span>&nbsp;<span class="keyword" id="5252822">func</span><span class="op" id="5252826">(</span><span class="ident" id="5252827">match</span>&nbsp;<span class="op" id="5252833">[</span><span class="op" id="5252834">]</span><span class="builtintype" id="5252835">int</span><span class="op" id="5252838">)</span>&nbsp;<span class="op" id="5252840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252844">result</span>&nbsp;<span class="op" id="5252851">=</span>&nbsp;<span class="builtinfunc" id="5252853">append</span><span class="op" id="5252859">(</span><span class="ident" id="5252860">result</span><span class="op" id="5252866">,</span>&nbsp;<span class="ident" id="5252868">b</span><span class="op" id="5252869">[</span><span class="ident" id="5252870">match</span><span class="op" id="5252875">[</span><span class="num" id="5252876">0</span><span class="op" id="5252877">]</span><span class="op" id="5252878">:</span><span class="ident" id="5252879">match</span><span class="op" id="5252884">[</span><span class="num" id="5252885">1</span><span class="op" id="5252886">]</span><span class="op" id="5252887">]</span><span class="op" id="5252888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252891">}</span><span class="op" id="5252892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252895">if</span>&nbsp;<span class="builtinfunc" id="5252898">len</span><span class="op" id="5252901">(</span><span class="ident" id="5252902">result</span><span class="op" id="5252908">)</span>&nbsp;<span class="op" id="5252910">==</span>&nbsp;<span class="num" id="5252913">0</span>&nbsp;<span class="op" id="5252915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252919">return</span>&nbsp;<span class="ident" id="5252926">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252934">return</span>&nbsp;<span class="ident" id="5252941">result</span><br>
<span class="lineno"></span><span class="op" id="5252948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5252951">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="5253028">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5253105">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5253132">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5253177">func</span>&nbsp;<span class="op" id="5253182">(</span><span class="ident" id="5253183">re</span>&nbsp;<span class="op" id="5253186">*</span><span class="ident" id="5253187">Regexp</span><span class="op" id="5253193">)</span>&nbsp;<span class="ident" id="5253195">FindAllIndex</span><span class="op" id="5253207">(</span><span class="ident" id="5253208">b</span>&nbsp;<span class="op" id="5253210">[</span><span class="op" id="5253211">]</span><span class="builtintype" id="5253212">byte</span><span class="op" id="5253216">,</span>&nbsp;<span class="ident" id="5253218">n</span>&nbsp;<span class="builtintype" id="5253220">int</span><span class="op" id="5253223">)</span>&nbsp;<span class="op" id="5253225">[</span><span class="op" id="5253226">]</span><span class="op" id="5253227">[</span><span class="op" id="5253228">]</span><span class="builtintype" id="5253229">int</span>&nbsp;<span class="op" id="5253233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253236">if</span>&nbsp;<span class="ident" id="5253239">n</span>&nbsp;<span class="op" id="5253241">&lt;</span>&nbsp;<span class="num" id="5253243">0</span>&nbsp;<span class="op" id="5253245">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253249">n</span>&nbsp;<span class="op" id="5253251">=</span>&nbsp;<span class="builtinfunc" id="5253253">len</span><span class="op" id="5253256">(</span><span class="ident" id="5253257">b</span><span class="op" id="5253258">)</span>&nbsp;<span class="op" id="5253260">+</span>&nbsp;<span class="num" id="5253262">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253268">result</span>&nbsp;<span class="op" id="5253275">:=</span>&nbsp;<span class="builtinfunc" id="5253278">make</span><span class="op" id="5253282">(</span><span class="op" id="5253283">[</span><span class="op" id="5253284">]</span><span class="op" id="5253285">[</span><span class="op" id="5253286">]</span><span class="builtintype" id="5253287">int</span><span class="op" id="5253290">,</span>&nbsp;<span class="num" id="5253292">0</span><span class="op" id="5253293">,</span>&nbsp;<span class="ident" id="5253295">startSize</span><span class="op" id="5253304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253307">re</span><span class="op" id="5253309">.</span><span class="ident" id="5253310">allMatches</span><span class="op" id="5253320">(</span><span class="string" id="5253321">&#34;&#34;</span><span class="op" id="5253323">,</span>&nbsp;<span class="ident" id="5253325">b</span><span class="op" id="5253326">,</span>&nbsp;<span class="ident" id="5253328">n</span><span class="op" id="5253329">,</span>&nbsp;<span class="keyword" id="5253331">func</span><span class="op" id="5253335">(</span><span class="ident" id="5253336">match</span>&nbsp;<span class="op" id="5253342">[</span><span class="op" id="5253343">]</span><span class="builtintype" id="5253344">int</span><span class="op" id="5253347">)</span>&nbsp;<span class="op" id="5253349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253353">result</span>&nbsp;<span class="op" id="5253360">=</span>&nbsp;<span class="builtinfunc" id="5253362">append</span><span class="op" id="5253368">(</span><span class="ident" id="5253369">result</span><span class="op" id="5253375">,</span>&nbsp;<span class="ident" id="5253377">match</span><span class="op" id="5253382">[</span><span class="num" id="5253383">0</span><span class="op" id="5253384">:</span><span class="num" id="5253385">2</span><span class="op" id="5253386">]</span><span class="op" id="5253387">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253390">}</span><span class="op" id="5253391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253394">if</span>&nbsp;<span class="builtinfunc" id="5253397">len</span><span class="op" id="5253400">(</span><span class="ident" id="5253401">result</span><span class="op" id="5253407">)</span>&nbsp;<span class="op" id="5253409">==</span>&nbsp;<span class="num" id="5253412">0</span>&nbsp;<span class="op" id="5253414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253418">return</span>&nbsp;<span class="ident" id="5253425">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253433">return</span>&nbsp;<span class="ident" id="5253440">result</span><br>
<span class="lineno">950</span><span class="op" id="5253447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5253450">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5253529">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5253606">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="5253633">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5253678">func</span>&nbsp;<span class="op" id="5253683">(</span><span class="ident" id="5253684">re</span>&nbsp;<span class="op" id="5253687">*</span><span class="ident" id="5253688">Regexp</span><span class="op" id="5253694">)</span>&nbsp;<span class="ident" id="5253696">FindAllString</span><span class="op" id="5253709">(</span><span class="ident" id="5253710">s</span>&nbsp;<span class="builtintype" id="5253712">string</span><span class="op" id="5253718">,</span>&nbsp;<span class="ident" id="5253720">n</span>&nbsp;<span class="builtintype" id="5253722">int</span><span class="op" id="5253725">)</span>&nbsp;<span class="op" id="5253727">[</span><span class="op" id="5253728">]</span><span class="builtintype" id="5253729">string</span>&nbsp;<span class="op" id="5253736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253739">if</span>&nbsp;<span class="ident" id="5253742">n</span>&nbsp;<span class="op" id="5253744">&lt;</span>&nbsp;<span class="num" id="5253746">0</span>&nbsp;<span class="op" id="5253748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253752">n</span>&nbsp;<span class="op" id="5253754">=</span>&nbsp;<span class="builtinfunc" id="5253756">len</span><span class="op" id="5253759">(</span><span class="ident" id="5253760">s</span><span class="op" id="5253761">)</span>&nbsp;<span class="op" id="5253763">+</span>&nbsp;<span class="num" id="5253765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253768">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253771">result</span>&nbsp;<span class="op" id="5253778">:=</span>&nbsp;<span class="builtinfunc" id="5253781">make</span><span class="op" id="5253785">(</span><span class="op" id="5253786">[</span><span class="op" id="5253787">]</span><span class="builtintype" id="5253788">string</span><span class="op" id="5253794">,</span>&nbsp;<span class="num" id="5253796">0</span><span class="op" id="5253797">,</span>&nbsp;<span class="ident" id="5253799">startSize</span><span class="op" id="5253808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253811">re</span><span class="op" id="5253813">.</span><span class="ident" id="5253814">allMatches</span><span class="op" id="5253824">(</span><span class="ident" id="5253825">s</span><span class="op" id="5253826">,</span>&nbsp;<span class="ident" id="5253828">nil</span><span class="op" id="5253831">,</span>&nbsp;<span class="ident" id="5253833">n</span><span class="op" id="5253834">,</span>&nbsp;<span class="keyword" id="5253836">func</span><span class="op" id="5253840">(</span><span class="ident" id="5253841">match</span>&nbsp;<span class="op" id="5253847">[</span><span class="op" id="5253848">]</span><span class="builtintype" id="5253849">int</span><span class="op" id="5253852">)</span>&nbsp;<span class="op" id="5253854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253858">result</span>&nbsp;<span class="op" id="5253865">=</span>&nbsp;<span class="builtinfunc" id="5253867">append</span><span class="op" id="5253873">(</span><span class="ident" id="5253874">result</span><span class="op" id="5253880">,</span>&nbsp;<span class="ident" id="5253882">s</span><span class="op" id="5253883">[</span><span class="ident" id="5253884">match</span><span class="op" id="5253889">[</span><span class="num" id="5253890">0</span><span class="op" id="5253891">]</span><span class="op" id="5253892">:</span><span class="ident" id="5253893">match</span><span class="op" id="5253898">[</span><span class="num" id="5253899">1</span><span class="op" id="5253900">]</span><span class="op" id="5253901">]</span><span class="op" id="5253902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253905">}</span><span class="op" id="5253906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253909">if</span>&nbsp;<span class="builtinfunc" id="5253912">len</span><span class="op" id="5253915">(</span><span class="ident" id="5253916">result</span><span class="op" id="5253922">)</span>&nbsp;<span class="op" id="5253924">==</span>&nbsp;<span class="num" id="5253927">0</span>&nbsp;<span class="op" id="5253929">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253933">return</span>&nbsp;<span class="ident" id="5253940">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253948">return</span>&nbsp;<span class="ident" id="5253955">result</span><br>
<span class="lineno"></span><span class="op" id="5253962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="5253965">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5254041">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="5254119">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5254158">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5254203">func</span>&nbsp;<span class="op" id="5254208">(</span><span class="ident" id="5254209">re</span>&nbsp;<span class="op" id="5254212">*</span><span class="ident" id="5254213">Regexp</span><span class="op" id="5254219">)</span>&nbsp;<span class="ident" id="5254221">FindAllStringIndex</span><span class="op" id="5254239">(</span><span class="ident" id="5254240">s</span>&nbsp;<span class="builtintype" id="5254242">string</span><span class="op" id="5254248">,</span>&nbsp;<span class="ident" id="5254250">n</span>&nbsp;<span class="builtintype" id="5254252">int</span><span class="op" id="5254255">)</span>&nbsp;<span class="op" id="5254257">[</span><span class="op" id="5254258">]</span><span class="op" id="5254259">[</span><span class="op" id="5254260">]</span><span class="builtintype" id="5254261">int</span>&nbsp;<span class="op" id="5254265">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254268">if</span>&nbsp;<span class="ident" id="5254271">n</span>&nbsp;<span class="op" id="5254273">&lt;</span>&nbsp;<span class="num" id="5254275">0</span>&nbsp;<span class="op" id="5254277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254281">n</span>&nbsp;<span class="op" id="5254283">=</span>&nbsp;<span class="builtinfunc" id="5254285">len</span><span class="op" id="5254288">(</span><span class="ident" id="5254289">s</span><span class="op" id="5254290">)</span>&nbsp;<span class="op" id="5254292">+</span>&nbsp;<span class="num" id="5254294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254300">result</span>&nbsp;<span class="op" id="5254307">:=</span>&nbsp;<span class="builtinfunc" id="5254310">make</span><span class="op" id="5254314">(</span><span class="op" id="5254315">[</span><span class="op" id="5254316">]</span><span class="op" id="5254317">[</span><span class="op" id="5254318">]</span><span class="builtintype" id="5254319">int</span><span class="op" id="5254322">,</span>&nbsp;<span class="num" id="5254324">0</span><span class="op" id="5254325">,</span>&nbsp;<span class="ident" id="5254327">startSize</span><span class="op" id="5254336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254339">re</span><span class="op" id="5254341">.</span><span class="ident" id="5254342">allMatches</span><span class="op" id="5254352">(</span><span class="ident" id="5254353">s</span><span class="op" id="5254354">,</span>&nbsp;<span class="ident" id="5254356">nil</span><span class="op" id="5254359">,</span>&nbsp;<span class="ident" id="5254361">n</span><span class="op" id="5254362">,</span>&nbsp;<span class="keyword" id="5254364">func</span><span class="op" id="5254368">(</span><span class="ident" id="5254369">match</span>&nbsp;<span class="op" id="5254375">[</span><span class="op" id="5254376">]</span><span class="builtintype" id="5254377">int</span><span class="op" id="5254380">)</span>&nbsp;<span class="op" id="5254382">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254386">result</span>&nbsp;<span class="op" id="5254393">=</span>&nbsp;<span class="builtinfunc" id="5254395">append</span><span class="op" id="5254401">(</span><span class="ident" id="5254402">result</span><span class="op" id="5254408">,</span>&nbsp;<span class="ident" id="5254410">match</span><span class="op" id="5254415">[</span><span class="num" id="5254416">0</span><span class="op" id="5254417">:</span><span class="num" id="5254418">2</span><span class="op" id="5254419">]</span><span class="op" id="5254420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254423">}</span><span class="op" id="5254424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254427">if</span>&nbsp;<span class="builtinfunc" id="5254430">len</span><span class="op" id="5254433">(</span><span class="ident" id="5254434">result</span><span class="op" id="5254440">)</span>&nbsp;<span class="op" id="5254442">==</span>&nbsp;<span class="num" id="5254445">0</span>&nbsp;<span class="op" id="5254447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254451">return</span>&nbsp;<span class="ident" id="5254458">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254463">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254466">return</span>&nbsp;<span class="ident" id="5254473">result</span><br>
<span class="lineno"></span><span class="op" id="5254480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5254483">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5254559">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="5254631">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5254670">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5254715">func</span>&nbsp;<span class="op" id="5254720">(</span><span class="ident" id="5254721">re</span>&nbsp;<span class="op" id="5254724">*</span><span class="ident" id="5254725">Regexp</span><span class="op" id="5254731">)</span>&nbsp;<span class="ident" id="5254733">FindAllSubmatch</span><span class="op" id="5254748">(</span><span class="ident" id="5254749">b</span>&nbsp;<span class="op" id="5254751">[</span><span class="op" id="5254752">]</span><span class="builtintype" id="5254753">byte</span><span class="op" id="5254757">,</span>&nbsp;<span class="ident" id="5254759">n</span>&nbsp;<span class="builtintype" id="5254761">int</span><span class="op" id="5254764">)</span>&nbsp;<span class="op" id="5254766">[</span><span class="op" id="5254767">]</span><span class="op" id="5254768">[</span><span class="op" id="5254769">]</span><span class="op" id="5254770">[</span><span class="op" id="5254771">]</span><span class="builtintype" id="5254772">byte</span>&nbsp;<span class="op" id="5254777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254780">if</span>&nbsp;<span class="ident" id="5254783">n</span>&nbsp;<span class="op" id="5254785">&lt;</span>&nbsp;<span class="num" id="5254787">0</span>&nbsp;<span class="op" id="5254789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254793">n</span>&nbsp;<span class="op" id="5254795">=</span>&nbsp;<span class="builtinfunc" id="5254797">len</span><span class="op" id="5254800">(</span><span class="ident" id="5254801">b</span><span class="op" id="5254802">)</span>&nbsp;<span class="op" id="5254804">+</span>&nbsp;<span class="num" id="5254806">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254812">result</span>&nbsp;<span class="op" id="5254819">:=</span>&nbsp;<span class="builtinfunc" id="5254822">make</span><span class="op" id="5254826">(</span><span class="op" id="5254827">[</span><span class="op" id="5254828">]</span><span class="op" id="5254829">[</span><span class="op" id="5254830">]</span><span class="op" id="5254831">[</span><span class="op" id="5254832">]</span><span class="builtintype" id="5254833">byte</span><span class="op" id="5254837">,</span>&nbsp;<span class="num" id="5254839">0</span><span class="op" id="5254840">,</span>&nbsp;<span class="ident" id="5254842">startSize</span><span class="op" id="5254851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254854">re</span><span class="op" id="5254856">.</span><span class="ident" id="5254857">allMatches</span><span class="op" id="5254867">(</span><span class="string" id="5254868">&#34;&#34;</span><span class="op" id="5254870">,</span>&nbsp;<span class="ident" id="5254872">b</span><span class="op" id="5254873">,</span>&nbsp;<span class="ident" id="5254875">n</span><span class="op" id="5254876">,</span>&nbsp;<span class="keyword" id="5254878">func</span><span class="op" id="5254882">(</span><span class="ident" id="5254883">match</span>&nbsp;<span class="op" id="5254889">[</span><span class="op" id="5254890">]</span><span class="builtintype" id="5254891">int</span><span class="op" id="5254894">)</span>&nbsp;<span class="op" id="5254896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254900">slice</span>&nbsp;<span class="op" id="5254906">:=</span>&nbsp;<span class="builtinfunc" id="5254909">make</span><span class="op" id="5254913">(</span><span class="op" id="5254914">[</span><span class="op" id="5254915">]</span><span class="op" id="5254916">[</span><span class="op" id="5254917">]</span><span class="builtintype" id="5254918">byte</span><span class="op" id="5254922">,</span>&nbsp;<span class="builtinfunc" id="5254924">len</span><span class="op" id="5254927">(</span><span class="ident" id="5254928">match</span><span class="op" id="5254933">)</span><span class="op" id="5254934">/</span><span class="num" id="5254935">2</span><span class="op" id="5254936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254940">for</span>&nbsp;<span class="ident" id="5254944">j</span>&nbsp;<span class="op" id="5254946">:=</span>&nbsp;<span class="keyword" id="5254949">range</span>&nbsp;<span class="ident" id="5254955">slice</span>&nbsp;<span class="op" id="5254961">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254966">if</span>&nbsp;<span class="ident" id="5254969">match</span><span class="op" id="5254974">[</span><span class="num" id="5254975">2</span><span class="op" id="5254976">*</span><span class="ident" id="5254977">j</span><span class="op" id="5254978">]</span>&nbsp;<span class="op" id="5254980">&gt;=</span>&nbsp;<span class="num" id="5254983">0</span>&nbsp;<span class="op" id="5254985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254991">slice</span><span class="op" id="5254996">[</span><span class="ident" id="5254997">j</span><span class="op" id="5254998">]</span>&nbsp;<span class="op" id="5255000">=</span>&nbsp;<span class="ident" id="5255002">b</span><span class="op" id="5255003">[</span><span class="ident" id="5255004">match</span><span class="op" id="5255009">[</span><span class="num" id="5255010">2</span><span class="op" id="5255011">*</span><span class="ident" id="5255012">j</span><span class="op" id="5255013">]</span><span class="op" id="5255014">:</span><span class="ident" id="5255015">match</span><span class="op" id="5255020">[</span><span class="num" id="5255021">2</span><span class="op" id="5255022">*</span><span class="ident" id="5255023">j</span><span class="op" id="5255024">+</span><span class="num" id="5255025">1</span><span class="op" id="5255026">]</span><span class="op" id="5255027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255040">result</span>&nbsp;<span class="op" id="5255047">=</span>&nbsp;<span class="builtinfunc" id="5255049">append</span><span class="op" id="5255055">(</span><span class="ident" id="5255056">result</span><span class="op" id="5255062">,</span>&nbsp;<span class="ident" id="5255064">slice</span><span class="op" id="5255069">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255072">}</span><span class="op" id="5255073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255076">if</span>&nbsp;<span class="builtinfunc" id="5255079">len</span><span class="op" id="5255082">(</span><span class="ident" id="5255083">result</span><span class="op" id="5255089">)</span>&nbsp;<span class="op" id="5255091">==</span>&nbsp;<span class="num" id="5255094">0</span>&nbsp;<span class="op" id="5255096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255100">return</span>&nbsp;<span class="ident" id="5255107">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255115">return</span>&nbsp;<span class="ident" id="5255122">result</span><br>
<span class="lineno">1010</span><span class="op" id="5255129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5255132">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5255210">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5255284">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="5255329">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5255374">func</span>&nbsp;<span class="op" id="5255379">(</span><span class="ident" id="5255380">re</span>&nbsp;<span class="op" id="5255383">*</span><span class="ident" id="5255384">Regexp</span><span class="op" id="5255390">)</span>&nbsp;<span class="ident" id="5255392">FindAllSubmatchIndex</span><span class="op" id="5255412">(</span><span class="ident" id="5255413">b</span>&nbsp;<span class="op" id="5255415">[</span><span class="op" id="5255416">]</span><span class="builtintype" id="5255417">byte</span><span class="op" id="5255421">,</span>&nbsp;<span class="ident" id="5255423">n</span>&nbsp;<span class="builtintype" id="5255425">int</span><span class="op" id="5255428">)</span>&nbsp;<span class="op" id="5255430">[</span><span class="op" id="5255431">]</span><span class="op" id="5255432">[</span><span class="op" id="5255433">]</span><span class="builtintype" id="5255434">int</span>&nbsp;<span class="op" id="5255438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255441">if</span>&nbsp;<span class="ident" id="5255444">n</span>&nbsp;<span class="op" id="5255446">&lt;</span>&nbsp;<span class="num" id="5255448">0</span>&nbsp;<span class="op" id="5255450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255454">n</span>&nbsp;<span class="op" id="5255456">=</span>&nbsp;<span class="builtinfunc" id="5255458">len</span><span class="op" id="5255461">(</span><span class="ident" id="5255462">b</span><span class="op" id="5255463">)</span>&nbsp;<span class="op" id="5255465">+</span>&nbsp;<span class="num" id="5255467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255470">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255473">result</span>&nbsp;<span class="op" id="5255480">:=</span>&nbsp;<span class="builtinfunc" id="5255483">make</span><span class="op" id="5255487">(</span><span class="op" id="5255488">[</span><span class="op" id="5255489">]</span><span class="op" id="5255490">[</span><span class="op" id="5255491">]</span><span class="builtintype" id="5255492">int</span><span class="op" id="5255495">,</span>&nbsp;<span class="num" id="5255497">0</span><span class="op" id="5255498">,</span>&nbsp;<span class="ident" id="5255500">startSize</span><span class="op" id="5255509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255512">re</span><span class="op" id="5255514">.</span><span class="ident" id="5255515">allMatches</span><span class="op" id="5255525">(</span><span class="string" id="5255526">&#34;&#34;</span><span class="op" id="5255528">,</span>&nbsp;<span class="ident" id="5255530">b</span><span class="op" id="5255531">,</span>&nbsp;<span class="ident" id="5255533">n</span><span class="op" id="5255534">,</span>&nbsp;<span class="keyword" id="5255536">func</span><span class="op" id="5255540">(</span><span class="ident" id="5255541">match</span>&nbsp;<span class="op" id="5255547">[</span><span class="op" id="5255548">]</span><span class="builtintype" id="5255549">int</span><span class="op" id="5255552">)</span>&nbsp;<span class="op" id="5255554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255558">result</span>&nbsp;<span class="op" id="5255565">=</span>&nbsp;<span class="builtinfunc" id="5255567">append</span><span class="op" id="5255573">(</span><span class="ident" id="5255574">result</span><span class="op" id="5255580">,</span>&nbsp;<span class="ident" id="5255582">match</span><span class="op" id="5255587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255590">}</span><span class="op" id="5255591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255594">if</span>&nbsp;<span class="builtinfunc" id="5255597">len</span><span class="op" id="5255600">(</span><span class="ident" id="5255601">result</span><span class="op" id="5255607">)</span>&nbsp;<span class="op" id="5255609">==</span>&nbsp;<span class="num" id="5255612">0</span>&nbsp;<span class="op" id="5255614">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255618">return</span>&nbsp;<span class="ident" id="5255625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255633">return</span>&nbsp;<span class="ident" id="5255640">result</span><br>
<span class="lineno"></span><span class="op" id="5255647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="5255650">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5255722">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5255800">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5255849">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5255894">func</span>&nbsp;<span class="op" id="5255899">(</span><span class="ident" id="5255900">re</span>&nbsp;<span class="op" id="5255903">*</span><span class="ident" id="5255904">Regexp</span><span class="op" id="5255910">)</span>&nbsp;<span class="ident" id="5255912">FindAllStringSubmatch</span><span class="op" id="5255933">(</span><span class="ident" id="5255934">s</span>&nbsp;<span class="builtintype" id="5255936">string</span><span class="op" id="5255942">,</span>&nbsp;<span class="ident" id="5255944">n</span>&nbsp;<span class="builtintype" id="5255946">int</span><span class="op" id="5255949">)</span>&nbsp;<span class="op" id="5255951">[</span><span class="op" id="5255952">]</span><span class="op" id="5255953">[</span><span class="op" id="5255954">]</span><span class="builtintype" id="5255955">string</span>&nbsp;<span class="op" id="5255962">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255965">if</span>&nbsp;<span class="ident" id="5255968">n</span>&nbsp;<span class="op" id="5255970">&lt;</span>&nbsp;<span class="num" id="5255972">0</span>&nbsp;<span class="op" id="5255974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255978">n</span>&nbsp;<span class="op" id="5255980">=</span>&nbsp;<span class="builtinfunc" id="5255982">len</span><span class="op" id="5255985">(</span><span class="ident" id="5255986">s</span><span class="op" id="5255987">)</span>&nbsp;<span class="op" id="5255989">+</span>&nbsp;<span class="num" id="5255991">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255997">result</span>&nbsp;<span class="op" id="5256004">:=</span>&nbsp;<span class="builtinfunc" id="5256007">make</span><span class="op" id="5256011">(</span><span class="op" id="5256012">[</span><span class="op" id="5256013">]</span><span class="op" id="5256014">[</span><span class="op" id="5256015">]</span><span class="builtintype" id="5256016">string</span><span class="op" id="5256022">,</span>&nbsp;<span class="num" id="5256024">0</span><span class="op" id="5256025">,</span>&nbsp;<span class="ident" id="5256027">startSize</span><span class="op" id="5256036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256039">re</span><span class="op" id="5256041">.</span><span class="ident" id="5256042">allMatches</span><span class="op" id="5256052">(</span><span class="ident" id="5256053">s</span><span class="op" id="5256054">,</span>&nbsp;<span class="ident" id="5256056">nil</span><span class="op" id="5256059">,</span>&nbsp;<span class="ident" id="5256061">n</span><span class="op" id="5256062">,</span>&nbsp;<span class="keyword" id="5256064">func</span><span class="op" id="5256068">(</span><span class="ident" id="5256069">match</span>&nbsp;<span class="op" id="5256075">[</span><span class="op" id="5256076">]</span><span class="builtintype" id="5256077">int</span><span class="op" id="5256080">)</span>&nbsp;<span class="op" id="5256082">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256086">slice</span>&nbsp;<span class="op" id="5256092">:=</span>&nbsp;<span class="builtinfunc" id="5256095">make</span><span class="op" id="5256099">(</span><span class="op" id="5256100">[</span><span class="op" id="5256101">]</span><span class="builtintype" id="5256102">string</span><span class="op" id="5256108">,</span>&nbsp;<span class="builtinfunc" id="5256110">len</span><span class="op" id="5256113">(</span><span class="ident" id="5256114">match</span><span class="op" id="5256119">)</span><span class="op" id="5256120">/</span><span class="num" id="5256121">2</span><span class="op" id="5256122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256126">for</span>&nbsp;<span class="ident" id="5256130">j</span>&nbsp;<span class="op" id="5256132">:=</span>&nbsp;<span class="keyword" id="5256135">range</span>&nbsp;<span class="ident" id="5256141">slice</span>&nbsp;<span class="op" id="5256147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256152">if</span>&nbsp;<span class="ident" id="5256155">match</span><span class="op" id="5256160">[</span><span class="num" id="5256161">2</span><span class="op" id="5256162">*</span><span class="ident" id="5256163">j</span><span class="op" id="5256164">]</span>&nbsp;<span class="op" id="5256166">&gt;=</span>&nbsp;<span class="num" id="5256169">0</span>&nbsp;<span class="op" id="5256171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256177">slice</span><span class="op" id="5256182">[</span><span class="ident" id="5256183">j</span><span class="op" id="5256184">]</span>&nbsp;<span class="op" id="5256186">=</span>&nbsp;<span class="ident" id="5256188">s</span><span class="op" id="5256189">[</span><span class="ident" id="5256190">match</span><span class="op" id="5256195">[</span><span class="num" id="5256196">2</span><span class="op" id="5256197">*</span><span class="ident" id="5256198">j</span><span class="op" id="5256199">]</span><span class="op" id="5256200">:</span><span class="ident" id="5256201">match</span><span class="op" id="5256206">[</span><span class="num" id="5256207">2</span><span class="op" id="5256208">*</span><span class="ident" id="5256209">j</span><span class="op" id="5256210">+</span><span class="num" id="5256211">1</span><span class="op" id="5256212">]</span><span class="op" id="5256213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256218">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256226">result</span>&nbsp;<span class="op" id="5256233">=</span>&nbsp;<span class="builtinfunc" id="5256235">append</span><span class="op" id="5256241">(</span><span class="ident" id="5256242">result</span><span class="op" id="5256248">,</span>&nbsp;<span class="ident" id="5256250">slice</span><span class="op" id="5256255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256258">}</span><span class="op" id="5256259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256262">if</span>&nbsp;<span class="builtinfunc" id="5256265">len</span><span class="op" id="5256268">(</span><span class="ident" id="5256269">result</span><span class="op" id="5256275">)</span>&nbsp;<span class="op" id="5256277">==</span>&nbsp;<span class="num" id="5256280">0</span>&nbsp;<span class="op" id="5256282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256286">return</span>&nbsp;<span class="ident" id="5256293">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256301">return</span>&nbsp;<span class="ident" id="5256308">result</span><br>
<span class="lineno"></span><span class="op" id="5256315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256318">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="5256372">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5256448">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5256518">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5256530">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5256575">func</span>&nbsp;<span class="op" id="5256580">(</span><span class="ident" id="5256581">re</span>&nbsp;<span class="op" id="5256584">*</span><span class="ident" id="5256585">Regexp</span><span class="op" id="5256591">)</span>&nbsp;<span class="ident" id="5256593">FindAllStringSubmatchIndex</span><span class="op" id="5256619">(</span><span class="ident" id="5256620">s</span>&nbsp;<span class="builtintype" id="5256622">string</span><span class="op" id="5256628">,</span>&nbsp;<span class="ident" id="5256630">n</span>&nbsp;<span class="builtintype" id="5256632">int</span><span class="op" id="5256635">)</span>&nbsp;<span class="op" id="5256637">[</span><span class="op" id="5256638">]</span><span class="op" id="5256639">[</span><span class="op" id="5256640">]</span><span class="builtintype" id="5256641">int</span>&nbsp;<span class="op" id="5256645">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256648">if</span>&nbsp;<span class="ident" id="5256651">n</span>&nbsp;<span class="op" id="5256653">&lt;</span>&nbsp;<span class="num" id="5256655">0</span>&nbsp;<span class="op" id="5256657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256661">n</span>&nbsp;<span class="op" id="5256663">=</span>&nbsp;<span class="builtinfunc" id="5256665">len</span><span class="op" id="5256668">(</span><span class="ident" id="5256669">s</span><span class="op" id="5256670">)</span>&nbsp;<span class="op" id="5256672">+</span>&nbsp;<span class="num" id="5256674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256680">result</span>&nbsp;<span class="op" id="5256687">:=</span>&nbsp;<span class="builtinfunc" id="5256690">make</span><span class="op" id="5256694">(</span><span class="op" id="5256695">[</span><span class="op" id="5256696">]</span><span class="op" id="5256697">[</span><span class="op" id="5256698">]</span><span class="builtintype" id="5256699">int</span><span class="op" id="5256702">,</span>&nbsp;<span class="num" id="5256704">0</span><span class="op" id="5256705">,</span>&nbsp;<span class="ident" id="5256707">startSize</span><span class="op" id="5256716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256719">re</span><span class="op" id="5256721">.</span><span class="ident" id="5256722">allMatches</span><span class="op" id="5256732">(</span><span class="ident" id="5256733">s</span><span class="op" id="5256734">,</span>&nbsp;<span class="ident" id="5256736">nil</span><span class="op" id="5256739">,</span>&nbsp;<span class="ident" id="5256741">n</span><span class="op" id="5256742">,</span>&nbsp;<span class="keyword" id="5256744">func</span><span class="op" id="5256748">(</span><span class="ident" id="5256749">match</span>&nbsp;<span class="op" id="5256755">[</span><span class="op" id="5256756">]</span><span class="builtintype" id="5256757">int</span><span class="op" id="5256760">)</span>&nbsp;<span class="op" id="5256762">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256766">result</span>&nbsp;<span class="op" id="5256773">=</span>&nbsp;<span class="builtinfunc" id="5256775">append</span><span class="op" id="5256781">(</span><span class="ident" id="5256782">result</span><span class="op" id="5256788">,</span>&nbsp;<span class="ident" id="5256790">match</span><span class="op" id="5256795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256798">}</span><span class="op" id="5256799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256802">if</span>&nbsp;<span class="builtinfunc" id="5256805">len</span><span class="op" id="5256808">(</span><span class="ident" id="5256809">result</span><span class="op" id="5256815">)</span>&nbsp;<span class="op" id="5256817">==</span>&nbsp;<span class="num" id="5256820">0</span>&nbsp;<span class="op" id="5256822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256826">return</span>&nbsp;<span class="ident" id="5256833">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256838">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256841">return</span>&nbsp;<span class="ident" id="5256848">result</span><br>
<span class="lineno"></span><span class="op" id="5256855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256858">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5256943">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="5256995">//</span><br>
<span class="lineno"></span><span class="comment" id="5256998">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5257071">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5257157">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="5257229">//</span><br>
<span class="lineno">1080</span><span class="comment" id="5257232">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="5257244">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="5257306">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="5257348">//</span><br>
<span class="lineno"></span><span class="comment" id="5257351">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="5257411">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="5257495">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="5257544">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="5257571">func</span>&nbsp;<span class="op" id="5257576">(</span><span class="ident" id="5257577">re</span>&nbsp;<span class="op" id="5257580">*</span><span class="ident" id="5257581">Regexp</span><span class="op" id="5257587">)</span>&nbsp;<span class="ident" id="5257589">Split</span><span class="op" id="5257594">(</span><span class="ident" id="5257595">s</span>&nbsp;<span class="builtintype" id="5257597">string</span><span class="op" id="5257603">,</span>&nbsp;<span class="ident" id="5257605">n</span>&nbsp;<span class="builtintype" id="5257607">int</span><span class="op" id="5257610">)</span>&nbsp;<span class="op" id="5257612">[</span><span class="op" id="5257613">]</span><span class="builtintype" id="5257614">string</span>&nbsp;<span class="op" id="5257621">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257625">if</span>&nbsp;<span class="ident" id="5257628">n</span>&nbsp;<span class="op" id="5257630">==</span>&nbsp;<span class="num" id="5257633">0</span>&nbsp;<span class="op" id="5257635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257639">return</span>&nbsp;<span class="ident" id="5257646">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257655">if</span>&nbsp;<span class="builtinfunc" id="5257658">len</span><span class="op" id="5257661">(</span><span class="ident" id="5257662">re</span><span class="op" id="5257664">.</span><span class="ident" id="5257665">expr</span><span class="op" id="5257669">)</span>&nbsp;<span class="op" id="5257671">&gt;</span>&nbsp;<span class="num" id="5257673">0</span>&nbsp;<span class="op" id="5257675">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5257678">len</span><span class="op" id="5257681">(</span><span class="ident" id="5257682">s</span><span class="op" id="5257683">)</span>&nbsp;<span class="op" id="5257685">==</span>&nbsp;<span class="num" id="5257688">0</span>&nbsp;<span class="op" id="5257690">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257694">return</span>&nbsp;<span class="op" id="5257701">[</span><span class="op" id="5257702">]</span><span class="builtintype" id="5257703">string</span><span class="op" id="5257709">{</span><span class="string" id="5257710">&#34;&#34;</span><span class="op" id="5257712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257719">matches</span>&nbsp;<span class="op" id="5257727">:=</span>&nbsp;<span class="ident" id="5257730">re</span><span class="op" id="5257732">.</span><span class="ident" id="5257733">FindAllStringIndex</span><span class="op" id="5257751">(</span><span class="ident" id="5257752">s</span><span class="op" id="5257753">,</span>&nbsp;<span class="ident" id="5257755">n</span><span class="op" id="5257756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257759">strings</span>&nbsp;<span class="op" id="5257767">:=</span>&nbsp;<span class="builtinfunc" id="5257770">make</span><span class="op" id="5257774">(</span><span class="op" id="5257775">[</span><span class="op" id="5257776">]</span><span class="builtintype" id="5257777">string</span><span class="op" id="5257783">,</span>&nbsp;<span class="num" id="5257785">0</span><span class="op" id="5257786">,</span>&nbsp;<span class="builtinfunc" id="5257788">len</span><span class="op" id="5257791">(</span><span class="ident" id="5257792">matches</span><span class="op" id="5257799">)</span><span class="op" id="5257800">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257804">beg</span>&nbsp;<span class="op" id="5257808">:=</span>&nbsp;<span class="num" id="5257811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257814">end</span>&nbsp;<span class="op" id="5257818">:=</span>&nbsp;<span class="num" id="5257821">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257824">for</span>&nbsp;<span class="ident" id="5257828">_</span><span class="op" id="5257829">,</span>&nbsp;<span class="ident" id="5257831">match</span>&nbsp;<span class="op" id="5257837">:=</span>&nbsp;<span class="keyword" id="5257840">range</span>&nbsp;<span class="ident" id="5257846">matches</span>&nbsp;<span class="op" id="5257854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257858">if</span>&nbsp;<span class="ident" id="5257861">n</span>&nbsp;<span class="op" id="5257863">&gt;</span>&nbsp;<span class="num" id="5257865">0</span>&nbsp;<span class="op" id="5257867">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5257870">len</span><span class="op" id="5257873">(</span><span class="ident" id="5257874">strings</span><span class="op" id="5257881">)</span>&nbsp;<span class="op" id="5257883">&gt;=</span>&nbsp;<span class="ident" id="5257886">n</span><span class="op" id="5257887">-</span><span class="num" id="5257888">1</span>&nbsp;<span class="op" id="5257890">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257895">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257908">end</span>&nbsp;<span class="op" id="5257912">=</span>&nbsp;<span class="ident" id="5257914">match</span><span class="op" id="5257919">[</span><span class="num" id="5257920">0</span><span class="op" id="5257921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257925">if</span>&nbsp;<span class="ident" id="5257928">match</span><span class="op" id="5257933">[</span><span class="num" id="5257934">1</span><span class="op" id="5257935">]</span>&nbsp;<span class="op" id="5257937">!=</span>&nbsp;<span class="num" id="5257940">0</span>&nbsp;<span class="op" id="5257942">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257947">strings</span>&nbsp;<span class="op" id="5257955">=</span>&nbsp;<span class="builtinfunc" id="5257957">append</span><span class="op" id="5257963">(</span><span class="ident" id="5257964">strings</span><span class="op" id="5257971">,</span>&nbsp;<span class="ident" id="5257973">s</span><span class="op" id="5257974">[</span><span class="ident" id="5257975">beg</span><span class="op" id="5257978">:</span><span class="ident" id="5257979">end</span><span class="op" id="5257982">]</span><span class="op" id="5257983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257991">beg</span>&nbsp;<span class="op" id="5257995">=</span>&nbsp;<span class="ident" id="5257997">match</span><span class="op" id="5258002">[</span><span class="num" id="5258003">1</span><span class="op" id="5258004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258011">if</span>&nbsp;<span class="ident" id="5258014">end</span>&nbsp;<span class="op" id="5258018">!=</span>&nbsp;<span class="builtinfunc" id="5258021">len</span><span class="op" id="5258024">(</span><span class="ident" id="5258025">s</span><span class="op" id="5258026">)</span>&nbsp;<span class="op" id="5258028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258032">strings</span>&nbsp;<span class="op" id="5258040">=</span>&nbsp;<span class="builtinfunc" id="5258042">append</span><span class="op" id="5258048">(</span><span class="ident" id="5258049">strings</span><span class="op" id="5258056">,</span>&nbsp;<span class="ident" id="5258058">s</span><span class="op" id="5258059">[</span><span class="ident" id="5258060">beg</span><span class="op" id="5258063">:</span><span class="op" id="5258064">]</span><span class="op" id="5258065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258072">return</span>&nbsp;<span class="ident" id="5258079">strings</span><br>
<span class="lineno">1120</span><span class="op" id="5258087">}</span>
</div>
</body>
</html>
