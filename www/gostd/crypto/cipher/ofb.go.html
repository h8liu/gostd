<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html" class="current">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4382634">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4382689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4382743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4382794">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4382826">package</span>&nbsp;<span class="ident" id="4382834">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4382842">type</span>&nbsp;<span class="ident" id="4382847">ofb</span>&nbsp;<span class="keyword" id="4382851">struct</span>&nbsp;<span class="op" id="4382858">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382861">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382869">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382876">cipher</span>&nbsp;&nbsp;<span class="op" id="4382884">[</span><span class="op" id="4382885">]</span><span class="builtintype" id="4382886">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382892">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382900">[</span><span class="op" id="4382901">]</span><span class="builtintype" id="4382902">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382908">outUsed</span>&nbsp;<span class="builtintype" id="4382916">int</span><br>
<span class="lineno"></span><span class="op" id="4382920">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4382923">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="4383001">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="4383081">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="4383103">func</span>&nbsp;<span class="ident" id="4383108">NewOFB</span><span class="op" id="4383114">(</span><span class="ident" id="4383115">b</span>&nbsp;<span class="ident" id="4383117">Block</span><span class="op" id="4383122">,</span>&nbsp;<span class="ident" id="4383124">iv</span>&nbsp;<span class="op" id="4383127">[</span><span class="op" id="4383128">]</span><span class="builtintype" id="4383129">byte</span><span class="op" id="4383133">)</span>&nbsp;<span class="ident" id="4383135">Stream</span>&nbsp;<span class="op" id="4383142">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383145">blockSize</span>&nbsp;<span class="op" id="4383155">:=</span>&nbsp;<span class="ident" id="4383158">b</span><span class="op" id="4383159">.</span><span class="ident" id="4383160">BlockSize</span><span class="op" id="4383169">(</span><span class="op" id="4383170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383173">if</span>&nbsp;<span class="builtinfunc" id="4383176">len</span><span class="op" id="4383179">(</span><span class="ident" id="4383180">iv</span><span class="op" id="4383182">)</span>&nbsp;<span class="op" id="4383184">!=</span>&nbsp;<span class="ident" id="4383187">blockSize</span>&nbsp;<span class="op" id="4383197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383201">return</span>&nbsp;<span class="ident" id="4383208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383216">bufSize</span>&nbsp;<span class="op" id="4383224">:=</span>&nbsp;<span class="ident" id="4383227">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383245">if</span>&nbsp;<span class="ident" id="4383248">bufSize</span>&nbsp;<span class="op" id="4383256">&lt;</span>&nbsp;<span class="ident" id="4383258">blockSize</span>&nbsp;<span class="op" id="4383268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383272">bufSize</span>&nbsp;<span class="op" id="4383280">=</span>&nbsp;<span class="ident" id="4383282">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383296">x</span>&nbsp;<span class="op" id="4383298">:=</span>&nbsp;<span class="op" id="4383301">&amp;</span><span class="ident" id="4383302">ofb</span><span class="op" id="4383305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383309">b</span><span class="op" id="4383310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383318">b</span><span class="op" id="4383319">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383323">cipher</span><span class="op" id="4383329">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4383332">make</span><span class="op" id="4383336">(</span><span class="op" id="4383337">[</span><span class="op" id="4383338">]</span><span class="builtintype" id="4383339">byte</span><span class="op" id="4383343">,</span>&nbsp;<span class="ident" id="4383345">blockSize</span><span class="op" id="4383354">)</span><span class="op" id="4383355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383359">out</span><span class="op" id="4383362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4383368">make</span><span class="op" id="4383372">(</span><span class="op" id="4383373">[</span><span class="op" id="4383374">]</span><span class="builtintype" id="4383375">byte</span><span class="op" id="4383379">,</span>&nbsp;<span class="num" id="4383381">0</span><span class="op" id="4383382">,</span>&nbsp;<span class="ident" id="4383384">bufSize</span><span class="op" id="4383391">)</span><span class="op" id="4383392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383396">outUsed</span><span class="op" id="4383403">:</span>&nbsp;<span class="num" id="4383405">0</span><span class="op" id="4383406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4383413">copy</span><span class="op" id="4383417">(</span><span class="ident" id="4383418">x</span><span class="op" id="4383419">.</span><span class="ident" id="4383420">cipher</span><span class="op" id="4383426">,</span>&nbsp;<span class="ident" id="4383428">iv</span><span class="op" id="4383430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383433">return</span>&nbsp;<span class="ident" id="4383440">x</span><br>
<span class="lineno"></span><span class="op" id="4383442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4383445">func</span>&nbsp;<span class="op" id="4383450">(</span><span class="ident" id="4383451">x</span>&nbsp;<span class="op" id="4383453">*</span><span class="ident" id="4383454">ofb</span><span class="op" id="4383457">)</span>&nbsp;<span class="ident" id="4383459">refill</span><span class="op" id="4383465">(</span><span class="op" id="4383466">)</span>&nbsp;<span class="op" id="4383468">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383471">bs</span>&nbsp;<span class="op" id="4383474">:=</span>&nbsp;<span class="ident" id="4383477">x</span><span class="op" id="4383478">.</span><span class="ident" id="4383479">b</span><span class="op" id="4383480">.</span><span class="ident" id="4383481">BlockSize</span><span class="op" id="4383490">(</span><span class="op" id="4383491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383494">remain</span>&nbsp;<span class="op" id="4383501">:=</span>&nbsp;<span class="builtinfunc" id="4383504">len</span><span class="op" id="4383507">(</span><span class="ident" id="4383508">x</span><span class="op" id="4383509">.</span><span class="ident" id="4383510">out</span><span class="op" id="4383513">)</span>&nbsp;<span class="op" id="4383515">-</span>&nbsp;<span class="ident" id="4383517">x</span><span class="op" id="4383518">.</span><span class="ident" id="4383519">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383528">if</span>&nbsp;<span class="ident" id="4383531">remain</span>&nbsp;<span class="op" id="4383538">&gt;</span>&nbsp;<span class="ident" id="4383540">x</span><span class="op" id="4383541">.</span><span class="ident" id="4383542">outUsed</span>&nbsp;<span class="op" id="4383550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383562">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4383565">copy</span><span class="op" id="4383569">(</span><span class="ident" id="4383570">x</span><span class="op" id="4383571">.</span><span class="ident" id="4383572">out</span><span class="op" id="4383575">,</span>&nbsp;<span class="ident" id="4383577">x</span><span class="op" id="4383578">.</span><span class="ident" id="4383579">out</span><span class="op" id="4383582">[</span><span class="ident" id="4383583">x</span><span class="op" id="4383584">.</span><span class="ident" id="4383585">outUsed</span><span class="op" id="4383592">:</span><span class="op" id="4383593">]</span><span class="op" id="4383594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383597">x</span><span class="op" id="4383598">.</span><span class="ident" id="4383599">out</span>&nbsp;<span class="op" id="4383603">=</span>&nbsp;<span class="ident" id="4383605">x</span><span class="op" id="4383606">.</span><span class="ident" id="4383607">out</span><span class="op" id="4383610">[</span><span class="op" id="4383611">:</span><span class="builtinfunc" id="4383612">cap</span><span class="op" id="4383615">(</span><span class="ident" id="4383616">x</span><span class="op" id="4383617">.</span><span class="ident" id="4383618">out</span><span class="op" id="4383621">)</span><span class="op" id="4383622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383625">for</span>&nbsp;<span class="ident" id="4383629">remain</span>&nbsp;<span class="op" id="4383636">&lt;</span>&nbsp;<span class="builtinfunc" id="4383638">len</span><span class="op" id="4383641">(</span><span class="ident" id="4383642">x</span><span class="op" id="4383643">.</span><span class="ident" id="4383644">out</span><span class="op" id="4383647">)</span><span class="op" id="4383648">-</span><span class="ident" id="4383649">bs</span>&nbsp;<span class="op" id="4383652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383656">x</span><span class="op" id="4383657">.</span><span class="ident" id="4383658">b</span><span class="op" id="4383659">.</span><span class="ident" id="4383660">Encrypt</span><span class="op" id="4383667">(</span><span class="ident" id="4383668">x</span><span class="op" id="4383669">.</span><span class="ident" id="4383670">cipher</span><span class="op" id="4383676">,</span>&nbsp;<span class="ident" id="4383678">x</span><span class="op" id="4383679">.</span><span class="ident" id="4383680">cipher</span><span class="op" id="4383686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4383690">copy</span><span class="op" id="4383694">(</span><span class="ident" id="4383695">x</span><span class="op" id="4383696">.</span><span class="ident" id="4383697">out</span><span class="op" id="4383700">[</span><span class="ident" id="4383701">remain</span><span class="op" id="4383707">:</span><span class="op" id="4383708">]</span><span class="op" id="4383709">,</span>&nbsp;<span class="ident" id="4383711">x</span><span class="op" id="4383712">.</span><span class="ident" id="4383713">cipher</span><span class="op" id="4383719">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383723">remain</span>&nbsp;<span class="op" id="4383730">+=</span>&nbsp;<span class="ident" id="4383733">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383740">x</span><span class="op" id="4383741">.</span><span class="ident" id="4383742">out</span>&nbsp;<span class="op" id="4383746">=</span>&nbsp;<span class="ident" id="4383748">x</span><span class="op" id="4383749">.</span><span class="ident" id="4383750">out</span><span class="op" id="4383753">[</span><span class="op" id="4383754">:</span><span class="ident" id="4383755">remain</span><span class="op" id="4383761">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383764">x</span><span class="op" id="4383765">.</span><span class="ident" id="4383766">outUsed</span>&nbsp;<span class="op" id="4383774">=</span>&nbsp;<span class="num" id="4383776">0</span><br>
<span class="lineno"></span><span class="op" id="4383778">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="4383781">func</span>&nbsp;<span class="op" id="4383786">(</span><span class="ident" id="4383787">x</span>&nbsp;<span class="op" id="4383789">*</span><span class="ident" id="4383790">ofb</span><span class="op" id="4383793">)</span>&nbsp;<span class="ident" id="4383795">XORKeyStream</span><span class="op" id="4383807">(</span><span class="ident" id="4383808">dst</span><span class="op" id="4383811">,</span>&nbsp;<span class="ident" id="4383813">src</span>&nbsp;<span class="op" id="4383817">[</span><span class="op" id="4383818">]</span><span class="builtintype" id="4383819">byte</span><span class="op" id="4383823">)</span>&nbsp;<span class="op" id="4383825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383828">for</span>&nbsp;<span class="builtinfunc" id="4383832">len</span><span class="op" id="4383835">(</span><span class="ident" id="4383836">src</span><span class="op" id="4383839">)</span>&nbsp;<span class="op" id="4383841">&gt;</span>&nbsp;<span class="num" id="4383843">0</span>&nbsp;<span class="op" id="4383845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383849">if</span>&nbsp;<span class="ident" id="4383852">x</span><span class="op" id="4383853">.</span><span class="ident" id="4383854">outUsed</span>&nbsp;<span class="op" id="4383862">&gt;=</span>&nbsp;<span class="builtinfunc" id="4383865">len</span><span class="op" id="4383868">(</span><span class="ident" id="4383869">x</span><span class="op" id="4383870">.</span><span class="ident" id="4383871">out</span><span class="op" id="4383874">)</span><span class="op" id="4383875">-</span><span class="ident" id="4383876">x</span><span class="op" id="4383877">.</span><span class="ident" id="4383878">b</span><span class="op" id="4383879">.</span><span class="ident" id="4383880">BlockSize</span><span class="op" id="4383889">(</span><span class="op" id="4383890">)</span>&nbsp;<span class="op" id="4383892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383897">x</span><span class="op" id="4383898">.</span><span class="ident" id="4383899">refill</span><span class="op" id="4383905">(</span><span class="op" id="4383906">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383914">n</span>&nbsp;<span class="op" id="4383916">:=</span>&nbsp;<span class="ident" id="4383919">xorBytes</span><span class="op" id="4383927">(</span><span class="ident" id="4383928">dst</span><span class="op" id="4383931">,</span>&nbsp;<span class="ident" id="4383933">src</span><span class="op" id="4383936">,</span>&nbsp;<span class="ident" id="4383938">x</span><span class="op" id="4383939">.</span><span class="ident" id="4383940">out</span><span class="op" id="4383943">[</span><span class="ident" id="4383944">x</span><span class="op" id="4383945">.</span><span class="ident" id="4383946">outUsed</span><span class="op" id="4383953">:</span><span class="op" id="4383954">]</span><span class="op" id="4383955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383959">dst</span>&nbsp;<span class="op" id="4383963">=</span>&nbsp;<span class="ident" id="4383965">dst</span><span class="op" id="4383968">[</span><span class="ident" id="4383969">n</span><span class="op" id="4383970">:</span><span class="op" id="4383971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383975">src</span>&nbsp;<span class="op" id="4383979">=</span>&nbsp;<span class="ident" id="4383981">src</span><span class="op" id="4383984">[</span><span class="ident" id="4383985">n</span><span class="op" id="4383986">:</span><span class="op" id="4383987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383991">x</span><span class="op" id="4383992">.</span><span class="ident" id="4383993">outUsed</span>&nbsp;<span class="op" id="4384001">+=</span>&nbsp;<span class="ident" id="4384004">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384007">}</span><br>
<span class="lineno"></span><span class="op" id="4384009">}</span>
</div>
</body>
</html>
