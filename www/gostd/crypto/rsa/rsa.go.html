<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4031202">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4031257">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4031311">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4031362">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4031427">package</span>&nbsp;<span class="ident" id="4031435">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031440">import</span>&nbsp;<span class="op" id="4031447">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031450">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031460">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031475">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031492">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031502">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031510">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031516">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4031527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031530">var</span>&nbsp;<span class="ident" id="4031534">bigZero</span>&nbsp;<span class="op" id="4031542">=</span>&nbsp;<span class="ident" id="4031544">big</span><span class="op" id="4031547">.</span><span class="ident" id="4031548">NewInt</span><span class="op" id="4031554">(</span><span class="num" id="4031555">0</span><span class="op" id="4031556">)</span><br>
<span class="lineno"></span><span class="keyword" id="4031558">var</span>&nbsp;<span class="ident" id="4031562">bigOne</span>&nbsp;<span class="op" id="4031569">=</span>&nbsp;<span class="ident" id="4031571">big</span><span class="op" id="4031574">.</span><span class="ident" id="4031575">NewInt</span><span class="op" id="4031581">(</span><span class="num" id="4031582">1</span><span class="op" id="4031583">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4031586">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4031643">type</span>&nbsp;<span class="ident" id="4031648">PublicKey</span>&nbsp;<span class="keyword" id="4031658">struct</span>&nbsp;<span class="op" id="4031665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031668">N</span>&nbsp;<span class="op" id="4031670">*</span><span class="ident" id="4031671">big</span><span class="op" id="4031674">.</span><span class="ident" id="4031675">Int</span>&nbsp;<span class="comment" id="4031679">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031691">E</span>&nbsp;<span class="builtintype" id="4031693">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4031702">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4031721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031724">var</span>&nbsp;<span class="op" id="4031728">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031731">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031754">=</span>&nbsp;<span class="ident" id="4031756">errors</span><span class="op" id="4031762">.</span><span class="ident" id="4031763">New</span><span class="op" id="4031766">(</span><span class="string" id="4031767">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4031803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031806">errPublicExponentSmall</span>&nbsp;<span class="op" id="4031829">=</span>&nbsp;<span class="ident" id="4031831">errors</span><span class="op" id="4031837">.</span><span class="ident" id="4031838">New</span><span class="op" id="4031841">(</span><span class="string" id="4031842">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4031881">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031884">errPublicExponentLarge</span>&nbsp;<span class="op" id="4031907">=</span>&nbsp;<span class="ident" id="4031909">errors</span><span class="op" id="4031915">.</span><span class="ident" id="4031916">New</span><span class="op" id="4031919">(</span><span class="string" id="4031920">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4031959">)</span><br>
<span class="lineno"></span><span class="op" id="4031961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4031964">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4032023">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4032083">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4032138">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4032172">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4032227">func</span>&nbsp;<span class="ident" id="4032232">checkPub</span><span class="op" id="4032240">(</span><span class="ident" id="4032241">pub</span>&nbsp;<span class="op" id="4032245">*</span><span class="ident" id="4032246">PublicKey</span><span class="op" id="4032255">)</span>&nbsp;<span class="builtintype" id="4032257">error</span>&nbsp;<span class="op" id="4032263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032266">if</span>&nbsp;<span class="ident" id="4032269">pub</span><span class="op" id="4032272">.</span><span class="ident" id="4032273">N</span>&nbsp;<span class="op" id="4032275">==</span>&nbsp;<span class="builtintype" id="4032278">nil</span>&nbsp;<span class="op" id="4032282">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032286">return</span>&nbsp;<span class="ident" id="4032293">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032314">if</span>&nbsp;<span class="ident" id="4032317">pub</span><span class="op" id="4032320">.</span><span class="ident" id="4032321">E</span>&nbsp;<span class="op" id="4032323">&lt;</span>&nbsp;<span class="num" id="4032325">2</span>&nbsp;<span class="op" id="4032327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032331">return</span>&nbsp;<span class="ident" id="4032338">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032362">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032365">if</span>&nbsp;<span class="ident" id="4032368">pub</span><span class="op" id="4032371">.</span><span class="ident" id="4032372">E</span>&nbsp;<span class="op" id="4032374">&gt;</span>&nbsp;<span class="num" id="4032376">1</span><span class="op" id="4032377">&lt;&lt;</span><span class="num" id="4032379">31</span><span class="op" id="4032381">-</span><span class="num" id="4032382">1</span>&nbsp;<span class="op" id="4032384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032388">return</span>&nbsp;<span class="ident" id="4032395">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032422">return</span>&nbsp;<span class="builtintype" id="4032429">nil</span><br>
<span class="lineno"></span><span class="op" id="4032433">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4032436">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4032474">type</span>&nbsp;<span class="ident" id="4032479">PrivateKey</span>&nbsp;<span class="keyword" id="4032490">struct</span>&nbsp;<span class="op" id="4032497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4032500">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4032521">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4032538">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032548">*</span><span class="ident" id="4032549">big</span><span class="op" id="4032552">.</span><span class="ident" id="4032553">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4032559">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4032580">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032590">[</span><span class="op" id="4032591">]</span><span class="op" id="4032592">*</span><span class="ident" id="4032593">big</span><span class="op" id="4032596">.</span><span class="ident" id="4032597">Int</span>&nbsp;<span class="comment" id="4032601">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4032645">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4032711">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4032741">Precomputed</span>&nbsp;<span class="ident" id="4032753">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4032771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4032774">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4032830">func</span>&nbsp;<span class="op" id="4032835">(</span><span class="ident" id="4032836">priv</span>&nbsp;<span class="op" id="4032841">*</span><span class="ident" id="4032842">PrivateKey</span><span class="op" id="4032852">)</span>&nbsp;<span class="ident" id="4032854">Public</span><span class="op" id="4032860">(</span><span class="op" id="4032861">)</span>&nbsp;<span class="ident" id="4032863">crypto</span><span class="op" id="4032869">.</span><span class="ident" id="4032870">PublicKey</span>&nbsp;<span class="op" id="4032880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032883">return</span>&nbsp;<span class="op" id="4032890">&amp;</span><span class="ident" id="4032891">priv</span><span class="op" id="4032895">.</span><span class="ident" id="4032896">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4032906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4032909">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4032981">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4033060">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4033138">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4033215">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4033245">func</span>&nbsp;<span class="op" id="4033250">(</span><span class="ident" id="4033251">priv</span>&nbsp;<span class="op" id="4033256">*</span><span class="ident" id="4033257">PrivateKey</span><span class="op" id="4033267">)</span>&nbsp;<span class="ident" id="4033269">Sign</span><span class="op" id="4033273">(</span><span class="ident" id="4033274">rand</span>&nbsp;<span class="ident" id="4033279">io</span><span class="op" id="4033281">.</span><span class="ident" id="4033282">Reader</span><span class="op" id="4033288">,</span>&nbsp;<span class="ident" id="4033290">msg</span>&nbsp;<span class="op" id="4033294">[</span><span class="op" id="4033295">]</span><span class="builtintype" id="4033296">byte</span><span class="op" id="4033300">,</span>&nbsp;<span class="ident" id="4033302">opts</span>&nbsp;<span class="ident" id="4033307">crypto</span><span class="op" id="4033313">.</span><span class="ident" id="4033314">SignerOpts</span><span class="op" id="4033324">)</span>&nbsp;<span class="op" id="4033326">(</span><span class="op" id="4033327">[</span><span class="op" id="4033328">]</span><span class="builtintype" id="4033329">byte</span><span class="op" id="4033333">,</span>&nbsp;<span class="builtintype" id="4033335">error</span><span class="op" id="4033340">)</span>&nbsp;<span class="op" id="4033342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033345">if</span>&nbsp;<span class="ident" id="4033348">pssOpts</span><span class="op" id="4033355">,</span>&nbsp;<span class="ident" id="4033357">ok</span>&nbsp;<span class="op" id="4033360">:=</span>&nbsp;<span class="ident" id="4033363">opts</span><span class="op" id="4033367">.</span><span class="op" id="4033368">(</span><span class="op" id="4033369">*</span><span class="ident" id="4033370">PSSOptions</span><span class="op" id="4033380">)</span><span class="op" id="4033381">;</span>&nbsp;<span class="ident" id="4033383">ok</span>&nbsp;<span class="op" id="4033386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033390">return</span>&nbsp;<span class="ident" id="4033397">SignPSS</span><span class="op" id="4033404">(</span><span class="ident" id="4033405">rand</span><span class="op" id="4033409">,</span>&nbsp;<span class="ident" id="4033411">priv</span><span class="op" id="4033415">,</span>&nbsp;<span class="ident" id="4033417">pssOpts</span><span class="op" id="4033424">.</span><span class="ident" id="4033425">Hash</span><span class="op" id="4033429">,</span>&nbsp;<span class="ident" id="4033431">msg</span><span class="op" id="4033434">,</span>&nbsp;<span class="ident" id="4033436">pssOpts</span><span class="op" id="4033443">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4033446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033450">return</span>&nbsp;<span class="ident" id="4033457">SignPKCS1v15</span><span class="op" id="4033469">(</span><span class="ident" id="4033470">rand</span><span class="op" id="4033474">,</span>&nbsp;<span class="ident" id="4033476">priv</span><span class="op" id="4033480">,</span>&nbsp;<span class="ident" id="4033482">opts</span><span class="op" id="4033486">.</span><span class="ident" id="4033487">HashFunc</span><span class="op" id="4033495">(</span><span class="op" id="4033496">)</span><span class="op" id="4033497">,</span>&nbsp;<span class="ident" id="4033499">msg</span><span class="op" id="4033502">)</span><br>
<span class="lineno"></span><span class="op" id="4033504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4033507">type</span>&nbsp;<span class="ident" id="4033512">PrecomputedValues</span>&nbsp;<span class="keyword" id="4033530">struct</span>&nbsp;<span class="op" id="4033537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033540">Dp</span><span class="op" id="4033542">,</span>&nbsp;<span class="ident" id="4033544">Dq</span>&nbsp;<span class="op" id="4033547">*</span><span class="ident" id="4033548">big</span><span class="op" id="4033551">.</span><span class="ident" id="4033552">Int</span>&nbsp;<span class="comment" id="4033556">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033585">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4033592">*</span><span class="ident" id="4033593">big</span><span class="op" id="4033596">.</span><span class="ident" id="4033597">Int</span>&nbsp;<span class="comment" id="4033601">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4033617">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4033683">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4033752">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4033815">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033850">CRTValues</span>&nbsp;<span class="op" id="4033860">[</span><span class="op" id="4033861">]</span><span class="ident" id="4033862">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4033871">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4033874">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4033945">type</span>&nbsp;<span class="ident" id="4033950">CRTValue</span>&nbsp;<span class="keyword" id="4033959">struct</span>&nbsp;<span class="op" id="4033966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033969">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4033975">*</span><span class="ident" id="4033976">big</span><span class="op" id="4033979">.</span><span class="ident" id="4033980">Int</span>&nbsp;<span class="comment" id="4033984">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034005">Coeff</span>&nbsp;<span class="op" id="4034011">*</span><span class="ident" id="4034012">big</span><span class="op" id="4034015">.</span><span class="ident" id="4034016">Int</span>&nbsp;<span class="comment" id="4034020">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034050">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034056">*</span><span class="ident" id="4034057">big</span><span class="op" id="4034060">.</span><span class="ident" id="4034061">Int</span>&nbsp;<span class="comment" id="4034065">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4034115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4034118">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4034171">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4034249">func</span>&nbsp;<span class="op" id="4034254">(</span><span class="ident" id="4034255">priv</span>&nbsp;<span class="op" id="4034260">*</span><span class="ident" id="4034261">PrivateKey</span><span class="op" id="4034271">)</span>&nbsp;<span class="ident" id="4034273">Validate</span><span class="op" id="4034281">(</span><span class="op" id="4034282">)</span>&nbsp;<span class="builtintype" id="4034284">error</span>&nbsp;<span class="op" id="4034290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034293">if</span>&nbsp;<span class="ident" id="4034296">err</span>&nbsp;<span class="op" id="4034300">:=</span>&nbsp;<span class="ident" id="4034303">checkPub</span><span class="op" id="4034311">(</span><span class="op" id="4034312">&amp;</span><span class="ident" id="4034313">priv</span><span class="op" id="4034317">.</span><span class="ident" id="4034318">PublicKey</span><span class="op" id="4034327">)</span><span class="op" id="4034328">;</span>&nbsp;<span class="ident" id="4034330">err</span>&nbsp;<span class="op" id="4034334">!=</span>&nbsp;<span class="builtintype" id="4034337">nil</span>&nbsp;<span class="op" id="4034341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034345">return</span>&nbsp;<span class="ident" id="4034352">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034361">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034432">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034494">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034564">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034631">for</span>&nbsp;<span class="ident" id="4034635">_</span><span class="op" id="4034636">,</span>&nbsp;<span class="ident" id="4034638">prime</span>&nbsp;<span class="op" id="4034644">:=</span>&nbsp;<span class="keyword" id="4034647">range</span>&nbsp;<span class="ident" id="4034653">priv</span><span class="op" id="4034657">.</span><span class="ident" id="4034658">Primes</span>&nbsp;<span class="op" id="4034665">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034669">if</span>&nbsp;<span class="op" id="4034672">!</span><span class="ident" id="4034673">prime</span><span class="op" id="4034678">.</span><span class="ident" id="4034679">ProbablyPrime</span><span class="op" id="4034692">(</span><span class="num" id="4034693">20</span><span class="op" id="4034695">)</span>&nbsp;<span class="op" id="4034697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034702">return</span>&nbsp;<span class="ident" id="4034709">errors</span><span class="op" id="4034715">.</span><span class="ident" id="4034716">New</span><span class="op" id="4034719">(</span><span class="string" id="4034720">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4034759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034770">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034800">modulus</span>&nbsp;<span class="op" id="4034808">:=</span>&nbsp;<span class="builtinfunc" id="4034811">new</span><span class="op" id="4034814">(</span><span class="ident" id="4034815">big</span><span class="op" id="4034818">.</span><span class="ident" id="4034819">Int</span><span class="op" id="4034822">)</span><span class="op" id="4034823">.</span><span class="ident" id="4034824">Set</span><span class="op" id="4034827">(</span><span class="ident" id="4034828">bigOne</span><span class="op" id="4034834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034837">for</span>&nbsp;<span class="ident" id="4034841">_</span><span class="op" id="4034842">,</span>&nbsp;<span class="ident" id="4034844">prime</span>&nbsp;<span class="op" id="4034850">:=</span>&nbsp;<span class="keyword" id="4034853">range</span>&nbsp;<span class="ident" id="4034859">priv</span><span class="op" id="4034863">.</span><span class="ident" id="4034864">Primes</span>&nbsp;<span class="op" id="4034871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034875">modulus</span><span class="op" id="4034882">.</span><span class="ident" id="4034883">Mul</span><span class="op" id="4034886">(</span><span class="ident" id="4034887">modulus</span><span class="op" id="4034894">,</span>&nbsp;<span class="ident" id="4034896">prime</span><span class="op" id="4034901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034904">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034907">if</span>&nbsp;<span class="ident" id="4034910">modulus</span><span class="op" id="4034917">.</span><span class="ident" id="4034918">Cmp</span><span class="op" id="4034921">(</span><span class="ident" id="4034922">priv</span><span class="op" id="4034926">.</span><span class="ident" id="4034927">N</span><span class="op" id="4034928">)</span>&nbsp;<span class="op" id="4034930">!=</span>&nbsp;<span class="num" id="4034933">0</span>&nbsp;<span class="op" id="4034935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034939">return</span>&nbsp;<span class="ident" id="4034946">errors</span><span class="op" id="4034952">.</span><span class="ident" id="4034953">New</span><span class="op" id="4034956">(</span><span class="string" id="4034957">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4034986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4034993">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4035042">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4035115">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4035177">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4035256">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035326">congruence</span>&nbsp;<span class="op" id="4035337">:=</span>&nbsp;<span class="builtinfunc" id="4035340">new</span><span class="op" id="4035343">(</span><span class="ident" id="4035344">big</span><span class="op" id="4035347">.</span><span class="ident" id="4035348">Int</span><span class="op" id="4035351">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035354">de</span>&nbsp;<span class="op" id="4035357">:=</span>&nbsp;<span class="builtinfunc" id="4035360">new</span><span class="op" id="4035363">(</span><span class="ident" id="4035364">big</span><span class="op" id="4035367">.</span><span class="ident" id="4035368">Int</span><span class="op" id="4035371">)</span><span class="op" id="4035372">.</span><span class="ident" id="4035373">SetInt64</span><span class="op" id="4035381">(</span><span class="ident" id="4035382">int64</span><span class="op" id="4035387">(</span><span class="ident" id="4035388">priv</span><span class="op" id="4035392">.</span><span class="ident" id="4035393">E</span><span class="op" id="4035394">)</span><span class="op" id="4035395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035398">de</span><span class="op" id="4035400">.</span><span class="ident" id="4035401">Mul</span><span class="op" id="4035404">(</span><span class="ident" id="4035405">de</span><span class="op" id="4035407">,</span>&nbsp;<span class="ident" id="4035409">priv</span><span class="op" id="4035413">.</span><span class="ident" id="4035414">D</span><span class="op" id="4035415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035418">for</span>&nbsp;<span class="ident" id="4035422">_</span><span class="op" id="4035423">,</span>&nbsp;<span class="ident" id="4035425">prime</span>&nbsp;<span class="op" id="4035431">:=</span>&nbsp;<span class="keyword" id="4035434">range</span>&nbsp;<span class="ident" id="4035440">priv</span><span class="op" id="4035444">.</span><span class="ident" id="4035445">Primes</span>&nbsp;<span class="op" id="4035452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035456">pminus1</span>&nbsp;<span class="op" id="4035464">:=</span>&nbsp;<span class="builtinfunc" id="4035467">new</span><span class="op" id="4035470">(</span><span class="ident" id="4035471">big</span><span class="op" id="4035474">.</span><span class="ident" id="4035475">Int</span><span class="op" id="4035478">)</span><span class="op" id="4035479">.</span><span class="ident" id="4035480">Sub</span><span class="op" id="4035483">(</span><span class="ident" id="4035484">prime</span><span class="op" id="4035489">,</span>&nbsp;<span class="ident" id="4035491">bigOne</span><span class="op" id="4035497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035501">congruence</span><span class="op" id="4035511">.</span><span class="ident" id="4035512">Mod</span><span class="op" id="4035515">(</span><span class="ident" id="4035516">de</span><span class="op" id="4035518">,</span>&nbsp;<span class="ident" id="4035520">pminus1</span><span class="op" id="4035527">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035531">if</span>&nbsp;<span class="ident" id="4035534">congruence</span><span class="op" id="4035544">.</span><span class="ident" id="4035545">Cmp</span><span class="op" id="4035548">(</span><span class="ident" id="4035549">bigOne</span><span class="op" id="4035555">)</span>&nbsp;<span class="op" id="4035557">!=</span>&nbsp;<span class="num" id="4035560">0</span>&nbsp;<span class="op" id="4035562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035567">return</span>&nbsp;<span class="ident" id="4035574">errors</span><span class="op" id="4035580">.</span><span class="ident" id="4035581">New</span><span class="op" id="4035584">(</span><span class="string" id="4035585">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4035616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035626">return</span>&nbsp;<span class="builtintype" id="4035633">nil</span><br>
<span class="lineno">140</span><span class="op" id="4035637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4035640">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4035712">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4035771">func</span>&nbsp;<span class="ident" id="4035776">GenerateKey</span><span class="op" id="4035787">(</span><span class="ident" id="4035788">random</span>&nbsp;<span class="ident" id="4035795">io</span><span class="op" id="4035797">.</span><span class="ident" id="4035798">Reader</span><span class="op" id="4035804">,</span>&nbsp;<span class="ident" id="4035806">bits</span>&nbsp;<span class="builtintype" id="4035811">int</span><span class="op" id="4035814">)</span>&nbsp;<span class="op" id="4035816">(</span><span class="ident" id="4035817">priv</span>&nbsp;<span class="op" id="4035822">*</span><span class="ident" id="4035823">PrivateKey</span><span class="op" id="4035833">,</span>&nbsp;<span class="ident" id="4035835">err</span>&nbsp;<span class="builtintype" id="4035839">error</span><span class="op" id="4035844">)</span>&nbsp;<span class="op" id="4035846">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035849">return</span>&nbsp;<span class="ident" id="4035856">GenerateMultiPrimeKey</span><span class="op" id="4035877">(</span><span class="ident" id="4035878">random</span><span class="op" id="4035884">,</span>&nbsp;<span class="num" id="4035886">2</span><span class="op" id="4035887">,</span>&nbsp;<span class="ident" id="4035889">bits</span><span class="op" id="4035893">)</span><br>
<span class="lineno"></span><span class="op" id="4035895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4035898">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4035976">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4036054">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4036130">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4036209">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4036286">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4036295">//</span><br>
<span class="lineno">155</span><span class="comment" id="4036298">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4036369">//</span><br>
<span class="lineno"></span><span class="comment" id="4036372">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4036413">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4036487">func</span>&nbsp;<span class="ident" id="4036492">GenerateMultiPrimeKey</span><span class="op" id="4036513">(</span><span class="ident" id="4036514">random</span>&nbsp;<span class="ident" id="4036521">io</span><span class="op" id="4036523">.</span><span class="ident" id="4036524">Reader</span><span class="op" id="4036530">,</span>&nbsp;<span class="ident" id="4036532">nprimes</span>&nbsp;<span class="builtintype" id="4036540">int</span><span class="op" id="4036543">,</span>&nbsp;<span class="ident" id="4036545">bits</span>&nbsp;<span class="builtintype" id="4036550">int</span><span class="op" id="4036553">)</span>&nbsp;<span class="op" id="4036555">(</span><span class="ident" id="4036556">priv</span>&nbsp;<span class="op" id="4036561">*</span><span class="ident" id="4036562">PrivateKey</span><span class="op" id="4036572">,</span>&nbsp;<span class="ident" id="4036574">err</span>&nbsp;<span class="builtintype" id="4036578">error</span><span class="op" id="4036583">)</span>&nbsp;<span class="op" id="4036585">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4036588">priv</span>&nbsp;<span class="op" id="4036593">=</span>&nbsp;<span class="builtinfunc" id="4036595">new</span><span class="op" id="4036598">(</span><span class="ident" id="4036599">PrivateKey</span><span class="op" id="4036609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4036612">priv</span><span class="op" id="4036616">.</span><span class="ident" id="4036617">E</span>&nbsp;<span class="op" id="4036619">=</span>&nbsp;<span class="num" id="4036621">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036629">if</span>&nbsp;<span class="ident" id="4036632">nprimes</span>&nbsp;<span class="op" id="4036640">&lt;</span>&nbsp;<span class="num" id="4036642">2</span>&nbsp;<span class="op" id="4036644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036648">return</span>&nbsp;<span class="builtintype" id="4036655">nil</span><span class="op" id="4036658">,</span>&nbsp;<span class="ident" id="4036660">errors</span><span class="op" id="4036666">.</span><span class="ident" id="4036667">New</span><span class="op" id="4036670">(</span><span class="string" id="4036671">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4036728">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4036735">primes</span>&nbsp;<span class="op" id="4036742">:=</span>&nbsp;<span class="builtinfunc" id="4036745">make</span><span class="op" id="4036749">(</span><span class="op" id="4036750">[</span><span class="op" id="4036751">]</span><span class="op" id="4036752">*</span><span class="ident" id="4036753">big</span><span class="op" id="4036756">.</span><span class="ident" id="4036757">Int</span><span class="op" id="4036760">,</span>&nbsp;<span class="ident" id="4036762">nprimes</span><span class="op" id="4036769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4036772">NextSetOfPrimes</span><span class="op" id="4036787">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036790">for</span>&nbsp;<span class="op" id="4036794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4036798">todo</span>&nbsp;<span class="op" id="4036803">:=</span>&nbsp;<span class="ident" id="4036806">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4036813">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4036873">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4036907">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4036958">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4036983">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037007">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037075">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037080">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037144">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037215">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037280">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037309">if</span>&nbsp;<span class="ident" id="4037312">nprimes</span>&nbsp;<span class="op" id="4037320">&gt;=</span>&nbsp;<span class="num" id="4037323">7</span>&nbsp;<span class="op" id="4037325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037330">todo</span>&nbsp;<span class="op" id="4037335">+=</span>&nbsp;<span class="op" id="4037338">(</span><span class="ident" id="4037339">nprimes</span>&nbsp;<span class="op" id="4037347">-</span>&nbsp;<span class="num" id="4037349">2</span><span class="op" id="4037350">)</span>&nbsp;<span class="op" id="4037352">/</span>&nbsp;<span class="num" id="4037354">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037362">for</span>&nbsp;<span class="ident" id="4037366">i</span>&nbsp;<span class="op" id="4037368">:=</span>&nbsp;<span class="num" id="4037371">0</span><span class="op" id="4037372">;</span>&nbsp;<span class="ident" id="4037374">i</span>&nbsp;<span class="op" id="4037376">&lt;</span>&nbsp;<span class="ident" id="4037378">nprimes</span><span class="op" id="4037385">;</span>&nbsp;<span class="ident" id="4037387">i</span><span class="op" id="4037388">++</span>&nbsp;<span class="op" id="4037391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037396">primes</span><span class="op" id="4037402">[</span><span class="ident" id="4037403">i</span><span class="op" id="4037404">]</span><span class="op" id="4037405">,</span>&nbsp;<span class="ident" id="4037407">err</span>&nbsp;<span class="op" id="4037411">=</span>&nbsp;<span class="ident" id="4037413">rand</span><span class="op" id="4037417">.</span><span class="ident" id="4037418">Prime</span><span class="op" id="4037423">(</span><span class="ident" id="4037424">random</span><span class="op" id="4037430">,</span>&nbsp;<span class="ident" id="4037432">todo</span><span class="op" id="4037436">/</span><span class="op" id="4037437">(</span><span class="ident" id="4037438">nprimes</span><span class="op" id="4037445">-</span><span class="ident" id="4037446">i</span><span class="op" id="4037447">)</span><span class="op" id="4037448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037453">if</span>&nbsp;<span class="ident" id="4037456">err</span>&nbsp;<span class="op" id="4037460">!=</span>&nbsp;<span class="builtintype" id="4037463">nil</span>&nbsp;<span class="op" id="4037467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037473">return</span>&nbsp;<span class="builtintype" id="4037480">nil</span><span class="op" id="4037483">,</span>&nbsp;<span class="ident" id="4037485">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037497">todo</span>&nbsp;<span class="op" id="4037502">-=</span>&nbsp;<span class="ident" id="4037505">primes</span><span class="op" id="4037511">[</span><span class="ident" id="4037512">i</span><span class="op" id="4037513">]</span><span class="op" id="4037514">.</span><span class="ident" id="4037515">BitLen</span><span class="op" id="4037521">(</span><span class="op" id="4037522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037531">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037579">for</span>&nbsp;<span class="ident" id="4037583">i</span><span class="op" id="4037584">,</span>&nbsp;<span class="ident" id="4037586">prime</span>&nbsp;<span class="op" id="4037592">:=</span>&nbsp;<span class="keyword" id="4037595">range</span>&nbsp;<span class="ident" id="4037601">primes</span>&nbsp;<span class="op" id="4037608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037613">for</span>&nbsp;<span class="ident" id="4037617">j</span>&nbsp;<span class="op" id="4037619">:=</span>&nbsp;<span class="num" id="4037622">0</span><span class="op" id="4037623">;</span>&nbsp;<span class="ident" id="4037625">j</span>&nbsp;<span class="op" id="4037627">&lt;</span>&nbsp;<span class="ident" id="4037629">i</span><span class="op" id="4037630">;</span>&nbsp;<span class="ident" id="4037632">j</span><span class="op" id="4037633">++</span>&nbsp;<span class="op" id="4037636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037642">if</span>&nbsp;<span class="ident" id="4037645">prime</span><span class="op" id="4037650">.</span><span class="ident" id="4037651">Cmp</span><span class="op" id="4037654">(</span><span class="ident" id="4037655">primes</span><span class="op" id="4037661">[</span><span class="ident" id="4037662">j</span><span class="op" id="4037663">]</span><span class="op" id="4037664">)</span>&nbsp;<span class="op" id="4037666">==</span>&nbsp;<span class="num" id="4037669">0</span>&nbsp;<span class="op" id="4037671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037678">continue</span>&nbsp;<span class="ident" id="4037687">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037707">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037721">n</span>&nbsp;<span class="op" id="4037723">:=</span>&nbsp;<span class="builtinfunc" id="4037726">new</span><span class="op" id="4037729">(</span><span class="ident" id="4037730">big</span><span class="op" id="4037733">.</span><span class="ident" id="4037734">Int</span><span class="op" id="4037737">)</span><span class="op" id="4037738">.</span><span class="ident" id="4037739">Set</span><span class="op" id="4037742">(</span><span class="ident" id="4037743">bigOne</span><span class="op" id="4037749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037753">totient</span>&nbsp;<span class="op" id="4037761">:=</span>&nbsp;<span class="builtinfunc" id="4037764">new</span><span class="op" id="4037767">(</span><span class="ident" id="4037768">big</span><span class="op" id="4037771">.</span><span class="ident" id="4037772">Int</span><span class="op" id="4037775">)</span><span class="op" id="4037776">.</span><span class="ident" id="4037777">Set</span><span class="op" id="4037780">(</span><span class="ident" id="4037781">bigOne</span><span class="op" id="4037787">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037791">pminus1</span>&nbsp;<span class="op" id="4037799">:=</span>&nbsp;<span class="builtinfunc" id="4037802">new</span><span class="op" id="4037805">(</span><span class="ident" id="4037806">big</span><span class="op" id="4037809">.</span><span class="ident" id="4037810">Int</span><span class="op" id="4037813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037817">for</span>&nbsp;<span class="ident" id="4037821">_</span><span class="op" id="4037822">,</span>&nbsp;<span class="ident" id="4037824">prime</span>&nbsp;<span class="op" id="4037830">:=</span>&nbsp;<span class="keyword" id="4037833">range</span>&nbsp;<span class="ident" id="4037839">primes</span>&nbsp;<span class="op" id="4037846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037851">n</span><span class="op" id="4037852">.</span><span class="ident" id="4037853">Mul</span><span class="op" id="4037856">(</span><span class="ident" id="4037857">n</span><span class="op" id="4037858">,</span>&nbsp;<span class="ident" id="4037860">prime</span><span class="op" id="4037865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037870">pminus1</span><span class="op" id="4037877">.</span><span class="ident" id="4037878">Sub</span><span class="op" id="4037881">(</span><span class="ident" id="4037882">prime</span><span class="op" id="4037887">,</span>&nbsp;<span class="ident" id="4037889">bigOne</span><span class="op" id="4037895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037900">totient</span><span class="op" id="4037907">.</span><span class="ident" id="4037908">Mul</span><span class="op" id="4037911">(</span><span class="ident" id="4037912">totient</span><span class="op" id="4037919">,</span>&nbsp;<span class="ident" id="4037921">pminus1</span><span class="op" id="4037928">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037936">if</span>&nbsp;<span class="ident" id="4037939">n</span><span class="op" id="4037940">.</span><span class="ident" id="4037941">BitLen</span><span class="op" id="4037947">(</span><span class="op" id="4037948">)</span>&nbsp;<span class="op" id="4037950">!=</span>&nbsp;<span class="ident" id="4037953">bits</span>&nbsp;<span class="op" id="4037958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4037963">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4038019">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4038080">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038136">continue</span>&nbsp;<span class="ident" id="4038145">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038168">g</span>&nbsp;<span class="op" id="4038170">:=</span>&nbsp;<span class="builtinfunc" id="4038173">new</span><span class="op" id="4038176">(</span><span class="ident" id="4038177">big</span><span class="op" id="4038180">.</span><span class="ident" id="4038181">Int</span><span class="op" id="4038184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038188">priv</span><span class="op" id="4038192">.</span><span class="ident" id="4038193">D</span>&nbsp;<span class="op" id="4038195">=</span>&nbsp;<span class="builtinfunc" id="4038197">new</span><span class="op" id="4038200">(</span><span class="ident" id="4038201">big</span><span class="op" id="4038204">.</span><span class="ident" id="4038205">Int</span><span class="op" id="4038208">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038212">y</span>&nbsp;<span class="op" id="4038214">:=</span>&nbsp;<span class="builtinfunc" id="4038217">new</span><span class="op" id="4038220">(</span><span class="ident" id="4038221">big</span><span class="op" id="4038224">.</span><span class="ident" id="4038225">Int</span><span class="op" id="4038228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038232">e</span>&nbsp;<span class="op" id="4038234">:=</span>&nbsp;<span class="ident" id="4038237">big</span><span class="op" id="4038240">.</span><span class="ident" id="4038241">NewInt</span><span class="op" id="4038247">(</span><span class="ident" id="4038248">int64</span><span class="op" id="4038253">(</span><span class="ident" id="4038254">priv</span><span class="op" id="4038258">.</span><span class="ident" id="4038259">E</span><span class="op" id="4038260">)</span><span class="op" id="4038261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038265">g</span><span class="op" id="4038266">.</span><span class="ident" id="4038267">GCD</span><span class="op" id="4038270">(</span><span class="ident" id="4038271">priv</span><span class="op" id="4038275">.</span><span class="ident" id="4038276">D</span><span class="op" id="4038277">,</span>&nbsp;<span class="ident" id="4038279">y</span><span class="op" id="4038280">,</span>&nbsp;<span class="ident" id="4038282">e</span><span class="op" id="4038283">,</span>&nbsp;<span class="ident" id="4038285">totient</span><span class="op" id="4038292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038297">if</span>&nbsp;<span class="ident" id="4038300">g</span><span class="op" id="4038301">.</span><span class="ident" id="4038302">Cmp</span><span class="op" id="4038305">(</span><span class="ident" id="4038306">bigOne</span><span class="op" id="4038312">)</span>&nbsp;<span class="op" id="4038314">==</span>&nbsp;<span class="num" id="4038317">0</span>&nbsp;<span class="op" id="4038319">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038324">if</span>&nbsp;<span class="ident" id="4038327">priv</span><span class="op" id="4038331">.</span><span class="ident" id="4038332">D</span><span class="op" id="4038333">.</span><span class="ident" id="4038334">Sign</span><span class="op" id="4038338">(</span><span class="op" id="4038339">)</span>&nbsp;<span class="op" id="4038341">&lt;</span>&nbsp;<span class="num" id="4038343">0</span>&nbsp;<span class="op" id="4038345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038351">priv</span><span class="op" id="4038355">.</span><span class="ident" id="4038356">D</span><span class="op" id="4038357">.</span><span class="ident" id="4038358">Add</span><span class="op" id="4038361">(</span><span class="ident" id="4038362">priv</span><span class="op" id="4038366">.</span><span class="ident" id="4038367">D</span><span class="op" id="4038368">,</span>&nbsp;<span class="ident" id="4038370">totient</span><span class="op" id="4038377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038387">priv</span><span class="op" id="4038391">.</span><span class="ident" id="4038392">Primes</span>&nbsp;<span class="op" id="4038399">=</span>&nbsp;<span class="ident" id="4038401">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038411">priv</span><span class="op" id="4038415">.</span><span class="ident" id="4038416">N</span>&nbsp;<span class="op" id="4038418">=</span>&nbsp;<span class="ident" id="4038420">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038426">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038441">priv</span><span class="op" id="4038445">.</span><span class="ident" id="4038446">Precompute</span><span class="op" id="4038456">(</span><span class="op" id="4038457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038460">return</span><br>
<span class="lineno"></span><span class="op" id="4038467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4038470">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4038528">func</span>&nbsp;<span class="ident" id="4038533">incCounter</span><span class="op" id="4038543">(</span><span class="ident" id="4038544">c</span>&nbsp;<span class="op" id="4038546">*</span><span class="op" id="4038547">[</span><span class="num" id="4038548">4</span><span class="op" id="4038549">]</span><span class="builtintype" id="4038550">byte</span><span class="op" id="4038554">)</span>&nbsp;<span class="op" id="4038556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038559">if</span>&nbsp;<span class="ident" id="4038562">c</span><span class="op" id="4038563">[</span><span class="num" id="4038564">3</span><span class="op" id="4038565">]</span><span class="op" id="4038566">++</span><span class="op" id="4038568">;</span>&nbsp;<span class="ident" id="4038570">c</span><span class="op" id="4038571">[</span><span class="num" id="4038572">3</span><span class="op" id="4038573">]</span>&nbsp;<span class="op" id="4038575">!=</span>&nbsp;<span class="num" id="4038578">0</span>&nbsp;<span class="op" id="4038580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038584">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038595">if</span>&nbsp;<span class="ident" id="4038598">c</span><span class="op" id="4038599">[</span><span class="num" id="4038600">2</span><span class="op" id="4038601">]</span><span class="op" id="4038602">++</span><span class="op" id="4038604">;</span>&nbsp;<span class="ident" id="4038606">c</span><span class="op" id="4038607">[</span><span class="num" id="4038608">2</span><span class="op" id="4038609">]</span>&nbsp;<span class="op" id="4038611">!=</span>&nbsp;<span class="num" id="4038614">0</span>&nbsp;<span class="op" id="4038616">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038620">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038631">if</span>&nbsp;<span class="ident" id="4038634">c</span><span class="op" id="4038635">[</span><span class="num" id="4038636">1</span><span class="op" id="4038637">]</span><span class="op" id="4038638">++</span><span class="op" id="4038640">;</span>&nbsp;<span class="ident" id="4038642">c</span><span class="op" id="4038643">[</span><span class="num" id="4038644">1</span><span class="op" id="4038645">]</span>&nbsp;<span class="op" id="4038647">!=</span>&nbsp;<span class="num" id="4038650">0</span>&nbsp;<span class="op" id="4038652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038656">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038664">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038667">c</span><span class="op" id="4038668">[</span><span class="num" id="4038669">0</span><span class="op" id="4038670">]</span><span class="op" id="4038671">++</span><br>
<span class="lineno"></span><span class="op" id="4038674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4038677">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4038756">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4038785">func</span>&nbsp;<span class="ident" id="4038790">mgf1XOR</span><span class="op" id="4038797">(</span><span class="ident" id="4038798">out</span>&nbsp;<span class="op" id="4038802">[</span><span class="op" id="4038803">]</span><span class="builtintype" id="4038804">byte</span><span class="op" id="4038808">,</span>&nbsp;<span class="ident" id="4038810">hash</span>&nbsp;<span class="ident" id="4038815">hash</span><span class="op" id="4038819">.</span><span class="ident" id="4038820">Hash</span><span class="op" id="4038824">,</span>&nbsp;<span class="ident" id="4038826">seed</span>&nbsp;<span class="op" id="4038831">[</span><span class="op" id="4038832">]</span><span class="builtintype" id="4038833">byte</span><span class="op" id="4038837">)</span>&nbsp;<span class="op" id="4038839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038842">var</span>&nbsp;<span class="ident" id="4038846">counter</span>&nbsp;<span class="op" id="4038854">[</span><span class="num" id="4038855">4</span><span class="op" id="4038856">]</span><span class="builtintype" id="4038857">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038863">var</span>&nbsp;<span class="ident" id="4038867">digest</span>&nbsp;<span class="op" id="4038874">[</span><span class="op" id="4038875">]</span><span class="builtintype" id="4038876">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038883">done</span>&nbsp;<span class="op" id="4038888">:=</span>&nbsp;<span class="num" id="4038891">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038894">for</span>&nbsp;<span class="ident" id="4038898">done</span>&nbsp;<span class="op" id="4038903">&lt;</span>&nbsp;<span class="builtinfunc" id="4038905">len</span><span class="op" id="4038908">(</span><span class="ident" id="4038909">out</span><span class="op" id="4038912">)</span>&nbsp;<span class="op" id="4038914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038918">hash</span><span class="op" id="4038922">.</span><span class="ident" id="4038923">Write</span><span class="op" id="4038928">(</span><span class="ident" id="4038929">seed</span><span class="op" id="4038933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038937">hash</span><span class="op" id="4038941">.</span><span class="ident" id="4038942">Write</span><span class="op" id="4038947">(</span><span class="ident" id="4038948">counter</span><span class="op" id="4038955">[</span><span class="num" id="4038956">0</span><span class="op" id="4038957">:</span><span class="num" id="4038958">4</span><span class="op" id="4038959">]</span><span class="op" id="4038960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038964">digest</span>&nbsp;<span class="op" id="4038971">=</span>&nbsp;<span class="ident" id="4038973">hash</span><span class="op" id="4038977">.</span><span class="ident" id="4038978">Sum</span><span class="op" id="4038981">(</span><span class="ident" id="4038982">digest</span><span class="op" id="4038988">[</span><span class="op" id="4038989">:</span><span class="num" id="4038990">0</span><span class="op" id="4038991">]</span><span class="op" id="4038992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038996">hash</span><span class="op" id="4039000">.</span><span class="ident" id="4039001">Reset</span><span class="op" id="4039006">(</span><span class="op" id="4039007">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039012">for</span>&nbsp;<span class="ident" id="4039016">i</span>&nbsp;<span class="op" id="4039018">:=</span>&nbsp;<span class="num" id="4039021">0</span><span class="op" id="4039022">;</span>&nbsp;<span class="ident" id="4039024">i</span>&nbsp;<span class="op" id="4039026">&lt;</span>&nbsp;<span class="builtinfunc" id="4039028">len</span><span class="op" id="4039031">(</span><span class="ident" id="4039032">digest</span><span class="op" id="4039038">)</span>&nbsp;<span class="op" id="4039040">&amp;&amp;</span>&nbsp;<span class="ident" id="4039043">done</span>&nbsp;<span class="op" id="4039048">&lt;</span>&nbsp;<span class="builtinfunc" id="4039050">len</span><span class="op" id="4039053">(</span><span class="ident" id="4039054">out</span><span class="op" id="4039057">)</span><span class="op" id="4039058">;</span>&nbsp;<span class="ident" id="4039060">i</span><span class="op" id="4039061">++</span>&nbsp;<span class="op" id="4039064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039069">out</span><span class="op" id="4039072">[</span><span class="ident" id="4039073">done</span><span class="op" id="4039077">]</span>&nbsp;<span class="op" id="4039079">^=</span>&nbsp;<span class="ident" id="4039082">digest</span><span class="op" id="4039088">[</span><span class="ident" id="4039089">i</span><span class="op" id="4039090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039095">done</span><span class="op" id="4039099">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039104">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039108">incCounter</span><span class="op" id="4039118">(</span><span class="op" id="4039119">&amp;</span><span class="ident" id="4039120">counter</span><span class="op" id="4039127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039130">}</span><br>
<span class="lineno"></span><span class="op" id="4039132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4039135">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4039214">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4039259">var</span>&nbsp;<span class="ident" id="4039263">ErrMessageTooLong</span>&nbsp;<span class="op" id="4039281">=</span>&nbsp;<span class="ident" id="4039283">errors</span><span class="op" id="4039289">.</span><span class="ident" id="4039290">New</span><span class="op" id="4039293">(</span><span class="string" id="4039294">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4039348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4039351">func</span>&nbsp;<span class="ident" id="4039356">encrypt</span><span class="op" id="4039363">(</span><span class="ident" id="4039364">c</span>&nbsp;<span class="op" id="4039366">*</span><span class="ident" id="4039367">big</span><span class="op" id="4039370">.</span><span class="ident" id="4039371">Int</span><span class="op" id="4039374">,</span>&nbsp;<span class="ident" id="4039376">pub</span>&nbsp;<span class="op" id="4039380">*</span><span class="ident" id="4039381">PublicKey</span><span class="op" id="4039390">,</span>&nbsp;<span class="ident" id="4039392">m</span>&nbsp;<span class="op" id="4039394">*</span><span class="ident" id="4039395">big</span><span class="op" id="4039398">.</span><span class="ident" id="4039399">Int</span><span class="op" id="4039402">)</span>&nbsp;<span class="op" id="4039404">*</span><span class="ident" id="4039405">big</span><span class="op" id="4039408">.</span><span class="ident" id="4039409">Int</span>&nbsp;<span class="op" id="4039413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039416">e</span>&nbsp;<span class="op" id="4039418">:=</span>&nbsp;<span class="ident" id="4039421">big</span><span class="op" id="4039424">.</span><span class="ident" id="4039425">NewInt</span><span class="op" id="4039431">(</span><span class="ident" id="4039432">int64</span><span class="op" id="4039437">(</span><span class="ident" id="4039438">pub</span><span class="op" id="4039441">.</span><span class="ident" id="4039442">E</span><span class="op" id="4039443">)</span><span class="op" id="4039444">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039447">c</span><span class="op" id="4039448">.</span><span class="ident" id="4039449">Exp</span><span class="op" id="4039452">(</span><span class="ident" id="4039453">m</span><span class="op" id="4039454">,</span>&nbsp;<span class="ident" id="4039456">e</span><span class="op" id="4039457">,</span>&nbsp;<span class="ident" id="4039459">pub</span><span class="op" id="4039462">.</span><span class="ident" id="4039463">N</span><span class="op" id="4039464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039467">return</span>&nbsp;<span class="ident" id="4039474">c</span><br>
<span class="lineno"></span><span class="op" id="4039476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4039479">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4039536">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4039612">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4039645">func</span>&nbsp;<span class="ident" id="4039650">EncryptOAEP</span><span class="op" id="4039661">(</span><span class="ident" id="4039662">hash</span>&nbsp;<span class="ident" id="4039667">hash</span><span class="op" id="4039671">.</span><span class="ident" id="4039672">Hash</span><span class="op" id="4039676">,</span>&nbsp;<span class="ident" id="4039678">random</span>&nbsp;<span class="ident" id="4039685">io</span><span class="op" id="4039687">.</span><span class="ident" id="4039688">Reader</span><span class="op" id="4039694">,</span>&nbsp;<span class="ident" id="4039696">pub</span>&nbsp;<span class="op" id="4039700">*</span><span class="ident" id="4039701">PublicKey</span><span class="op" id="4039710">,</span>&nbsp;<span class="ident" id="4039712">msg</span>&nbsp;<span class="op" id="4039716">[</span><span class="op" id="4039717">]</span><span class="builtintype" id="4039718">byte</span><span class="op" id="4039722">,</span>&nbsp;<span class="ident" id="4039724">label</span>&nbsp;<span class="op" id="4039730">[</span><span class="op" id="4039731">]</span><span class="builtintype" id="4039732">byte</span><span class="op" id="4039736">)</span>&nbsp;<span class="op" id="4039738">(</span><span class="ident" id="4039739">out</span>&nbsp;<span class="op" id="4039743">[</span><span class="op" id="4039744">]</span><span class="builtintype" id="4039745">byte</span><span class="op" id="4039749">,</span>&nbsp;<span class="ident" id="4039751">err</span>&nbsp;<span class="builtintype" id="4039755">error</span><span class="op" id="4039760">)</span>&nbsp;<span class="op" id="4039762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039765">if</span>&nbsp;<span class="ident" id="4039768">err</span>&nbsp;<span class="op" id="4039772">:=</span>&nbsp;<span class="ident" id="4039775">checkPub</span><span class="op" id="4039783">(</span><span class="ident" id="4039784">pub</span><span class="op" id="4039787">)</span><span class="op" id="4039788">;</span>&nbsp;<span class="ident" id="4039790">err</span>&nbsp;<span class="op" id="4039794">!=</span>&nbsp;<span class="builtintype" id="4039797">nil</span>&nbsp;<span class="op" id="4039801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039805">return</span>&nbsp;<span class="builtintype" id="4039812">nil</span><span class="op" id="4039815">,</span>&nbsp;<span class="ident" id="4039817">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039825">hash</span><span class="op" id="4039829">.</span><span class="ident" id="4039830">Reset</span><span class="op" id="4039835">(</span><span class="op" id="4039836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039839">k</span>&nbsp;<span class="op" id="4039841">:=</span>&nbsp;<span class="op" id="4039844">(</span><span class="ident" id="4039845">pub</span><span class="op" id="4039848">.</span><span class="ident" id="4039849">N</span><span class="op" id="4039850">.</span><span class="ident" id="4039851">BitLen</span><span class="op" id="4039857">(</span><span class="op" id="4039858">)</span>&nbsp;<span class="op" id="4039860">+</span>&nbsp;<span class="num" id="4039862">7</span><span class="op" id="4039863">)</span>&nbsp;<span class="op" id="4039865">/</span>&nbsp;<span class="num" id="4039867">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039870">if</span>&nbsp;<span class="builtinfunc" id="4039873">len</span><span class="op" id="4039876">(</span><span class="ident" id="4039877">msg</span><span class="op" id="4039880">)</span>&nbsp;<span class="op" id="4039882">&gt;</span>&nbsp;<span class="ident" id="4039884">k</span><span class="op" id="4039885">-</span><span class="num" id="4039886">2</span><span class="op" id="4039887">*</span><span class="ident" id="4039888">hash</span><span class="op" id="4039892">.</span><span class="ident" id="4039893">Size</span><span class="op" id="4039897">(</span><span class="op" id="4039898">)</span><span class="op" id="4039899">-</span><span class="num" id="4039900">2</span>&nbsp;<span class="op" id="4039902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039906">err</span>&nbsp;<span class="op" id="4039910">=</span>&nbsp;<span class="ident" id="4039912">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039932">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039944">hash</span><span class="op" id="4039948">.</span><span class="ident" id="4039949">Write</span><span class="op" id="4039954">(</span><span class="ident" id="4039955">label</span><span class="op" id="4039960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039963">lHash</span>&nbsp;<span class="op" id="4039969">:=</span>&nbsp;<span class="ident" id="4039972">hash</span><span class="op" id="4039976">.</span><span class="ident" id="4039977">Sum</span><span class="op" id="4039980">(</span><span class="builtintype" id="4039981">nil</span><span class="op" id="4039984">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039987">hash</span><span class="op" id="4039991">.</span><span class="ident" id="4039992">Reset</span><span class="op" id="4039997">(</span><span class="op" id="4039998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040002">em</span>&nbsp;<span class="op" id="4040005">:=</span>&nbsp;<span class="builtinfunc" id="4040008">make</span><span class="op" id="4040012">(</span><span class="op" id="4040013">[</span><span class="op" id="4040014">]</span><span class="builtintype" id="4040015">byte</span><span class="op" id="4040019">,</span>&nbsp;<span class="ident" id="4040021">k</span><span class="op" id="4040022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040025">seed</span>&nbsp;<span class="op" id="4040030">:=</span>&nbsp;<span class="ident" id="4040033">em</span><span class="op" id="4040035">[</span><span class="num" id="4040036">1</span>&nbsp;<span class="op" id="4040038">:</span>&nbsp;<span class="num" id="4040040">1</span><span class="op" id="4040041">+</span><span class="ident" id="4040042">hash</span><span class="op" id="4040046">.</span><span class="ident" id="4040047">Size</span><span class="op" id="4040051">(</span><span class="op" id="4040052">)</span><span class="op" id="4040053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040056">db</span>&nbsp;<span class="op" id="4040059">:=</span>&nbsp;<span class="ident" id="4040062">em</span><span class="op" id="4040064">[</span><span class="num" id="4040065">1</span><span class="op" id="4040066">+</span><span class="ident" id="4040067">hash</span><span class="op" id="4040071">.</span><span class="ident" id="4040072">Size</span><span class="op" id="4040076">(</span><span class="op" id="4040077">)</span><span class="op" id="4040078">:</span><span class="op" id="4040079">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4040083">copy</span><span class="op" id="4040087">(</span><span class="ident" id="4040088">db</span><span class="op" id="4040090">[</span><span class="num" id="4040091">0</span><span class="op" id="4040092">:</span><span class="ident" id="4040093">hash</span><span class="op" id="4040097">.</span><span class="ident" id="4040098">Size</span><span class="op" id="4040102">(</span><span class="op" id="4040103">)</span><span class="op" id="4040104">]</span><span class="op" id="4040105">,</span>&nbsp;<span class="ident" id="4040107">lHash</span><span class="op" id="4040112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040115">db</span><span class="op" id="4040117">[</span><span class="builtinfunc" id="4040118">len</span><span class="op" id="4040121">(</span><span class="ident" id="4040122">db</span><span class="op" id="4040124">)</span><span class="op" id="4040125">-</span><span class="builtinfunc" id="4040126">len</span><span class="op" id="4040129">(</span><span class="ident" id="4040130">msg</span><span class="op" id="4040133">)</span><span class="op" id="4040134">-</span><span class="num" id="4040135">1</span><span class="op" id="4040136">]</span>&nbsp;<span class="op" id="4040138">=</span>&nbsp;<span class="num" id="4040140">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4040143">copy</span><span class="op" id="4040147">(</span><span class="ident" id="4040148">db</span><span class="op" id="4040150">[</span><span class="builtinfunc" id="4040151">len</span><span class="op" id="4040154">(</span><span class="ident" id="4040155">db</span><span class="op" id="4040157">)</span><span class="op" id="4040158">-</span><span class="builtinfunc" id="4040159">len</span><span class="op" id="4040162">(</span><span class="ident" id="4040163">msg</span><span class="op" id="4040166">)</span><span class="op" id="4040167">:</span><span class="op" id="4040168">]</span><span class="op" id="4040169">,</span>&nbsp;<span class="ident" id="4040171">msg</span><span class="op" id="4040174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040178">_</span><span class="op" id="4040179">,</span>&nbsp;<span class="ident" id="4040181">err</span>&nbsp;<span class="op" id="4040185">=</span>&nbsp;<span class="ident" id="4040187">io</span><span class="op" id="4040189">.</span><span class="ident" id="4040190">ReadFull</span><span class="op" id="4040198">(</span><span class="ident" id="4040199">random</span><span class="op" id="4040205">,</span>&nbsp;<span class="ident" id="4040207">seed</span><span class="op" id="4040211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040214">if</span>&nbsp;<span class="ident" id="4040217">err</span>&nbsp;<span class="op" id="4040221">!=</span>&nbsp;<span class="builtintype" id="4040224">nil</span>&nbsp;<span class="op" id="4040228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040244">mgf1XOR</span><span class="op" id="4040251">(</span><span class="ident" id="4040252">db</span><span class="op" id="4040254">,</span>&nbsp;<span class="ident" id="4040256">hash</span><span class="op" id="4040260">,</span>&nbsp;<span class="ident" id="4040262">seed</span><span class="op" id="4040266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040269">mgf1XOR</span><span class="op" id="4040276">(</span><span class="ident" id="4040277">seed</span><span class="op" id="4040281">,</span>&nbsp;<span class="ident" id="4040283">hash</span><span class="op" id="4040287">,</span>&nbsp;<span class="ident" id="4040289">db</span><span class="op" id="4040291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040295">m</span>&nbsp;<span class="op" id="4040297">:=</span>&nbsp;<span class="builtinfunc" id="4040300">new</span><span class="op" id="4040303">(</span><span class="ident" id="4040304">big</span><span class="op" id="4040307">.</span><span class="ident" id="4040308">Int</span><span class="op" id="4040311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040314">m</span><span class="op" id="4040315">.</span><span class="ident" id="4040316">SetBytes</span><span class="op" id="4040324">(</span><span class="ident" id="4040325">em</span><span class="op" id="4040327">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040330">c</span>&nbsp;<span class="op" id="4040332">:=</span>&nbsp;<span class="ident" id="4040335">encrypt</span><span class="op" id="4040342">(</span><span class="builtinfunc" id="4040343">new</span><span class="op" id="4040346">(</span><span class="ident" id="4040347">big</span><span class="op" id="4040350">.</span><span class="ident" id="4040351">Int</span><span class="op" id="4040354">)</span><span class="op" id="4040355">,</span>&nbsp;<span class="ident" id="4040357">pub</span><span class="op" id="4040360">,</span>&nbsp;<span class="ident" id="4040362">m</span><span class="op" id="4040363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040366">out</span>&nbsp;<span class="op" id="4040370">=</span>&nbsp;<span class="ident" id="4040372">c</span><span class="op" id="4040373">.</span><span class="ident" id="4040374">Bytes</span><span class="op" id="4040379">(</span><span class="op" id="4040380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040384">if</span>&nbsp;<span class="builtinfunc" id="4040387">len</span><span class="op" id="4040390">(</span><span class="ident" id="4040391">out</span><span class="op" id="4040394">)</span>&nbsp;<span class="op" id="4040396">&lt;</span>&nbsp;<span class="ident" id="4040398">k</span>&nbsp;<span class="op" id="4040400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4040404">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040469">t</span>&nbsp;<span class="op" id="4040471">:=</span>&nbsp;<span class="builtinfunc" id="4040474">make</span><span class="op" id="4040478">(</span><span class="op" id="4040479">[</span><span class="op" id="4040480">]</span><span class="builtintype" id="4040481">byte</span><span class="op" id="4040485">,</span>&nbsp;<span class="ident" id="4040487">k</span><span class="op" id="4040488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4040492">copy</span><span class="op" id="4040496">(</span><span class="ident" id="4040497">t</span><span class="op" id="4040498">[</span><span class="ident" id="4040499">k</span><span class="op" id="4040500">-</span><span class="builtinfunc" id="4040501">len</span><span class="op" id="4040504">(</span><span class="ident" id="4040505">out</span><span class="op" id="4040508">)</span><span class="op" id="4040509">:</span><span class="op" id="4040510">]</span><span class="op" id="4040511">,</span>&nbsp;<span class="ident" id="4040513">out</span><span class="op" id="4040516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040520">out</span>&nbsp;<span class="op" id="4040524">=</span>&nbsp;<span class="ident" id="4040526">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040533">return</span><br>
<span class="lineno"></span><span class="op" id="4040540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4040543">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4040603">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4040658">var</span>&nbsp;<span class="ident" id="4040662">ErrDecryption</span>&nbsp;<span class="op" id="4040676">=</span>&nbsp;<span class="ident" id="4040678">errors</span><span class="op" id="4040684">.</span><span class="ident" id="4040685">New</span><span class="op" id="4040688">(</span><span class="string" id="4040689">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4040719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4040722">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4040785">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4040840">var</span>&nbsp;<span class="ident" id="4040844">ErrVerification</span>&nbsp;<span class="op" id="4040860">=</span>&nbsp;<span class="ident" id="4040862">errors</span><span class="op" id="4040868">.</span><span class="ident" id="4040869">New</span><span class="op" id="4040872">(</span><span class="string" id="4040873">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4040905">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4040908">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4040988">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4041064">func</span>&nbsp;<span class="ident" id="4041069">modInverse</span><span class="op" id="4041079">(</span><span class="ident" id="4041080">a</span><span class="op" id="4041081">,</span>&nbsp;<span class="ident" id="4041083">n</span>&nbsp;<span class="op" id="4041085">*</span><span class="ident" id="4041086">big</span><span class="op" id="4041089">.</span><span class="ident" id="4041090">Int</span><span class="op" id="4041093">)</span>&nbsp;<span class="op" id="4041095">(</span><span class="ident" id="4041096">ia</span>&nbsp;<span class="op" id="4041099">*</span><span class="ident" id="4041100">big</span><span class="op" id="4041103">.</span><span class="ident" id="4041104">Int</span><span class="op" id="4041107">,</span>&nbsp;<span class="ident" id="4041109">ok</span>&nbsp;<span class="builtintype" id="4041112">bool</span><span class="op" id="4041116">)</span>&nbsp;<span class="op" id="4041118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041121">g</span>&nbsp;<span class="op" id="4041123">:=</span>&nbsp;<span class="builtinfunc" id="4041126">new</span><span class="op" id="4041129">(</span><span class="ident" id="4041130">big</span><span class="op" id="4041133">.</span><span class="ident" id="4041134">Int</span><span class="op" id="4041137">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041140">x</span>&nbsp;<span class="op" id="4041142">:=</span>&nbsp;<span class="builtinfunc" id="4041145">new</span><span class="op" id="4041148">(</span><span class="ident" id="4041149">big</span><span class="op" id="4041152">.</span><span class="ident" id="4041153">Int</span><span class="op" id="4041156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041159">y</span>&nbsp;<span class="op" id="4041161">:=</span>&nbsp;<span class="builtinfunc" id="4041164">new</span><span class="op" id="4041167">(</span><span class="ident" id="4041168">big</span><span class="op" id="4041171">.</span><span class="ident" id="4041172">Int</span><span class="op" id="4041175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041178">g</span><span class="op" id="4041179">.</span><span class="ident" id="4041180">GCD</span><span class="op" id="4041183">(</span><span class="ident" id="4041184">x</span><span class="op" id="4041185">,</span>&nbsp;<span class="ident" id="4041187">y</span><span class="op" id="4041188">,</span>&nbsp;<span class="ident" id="4041190">a</span><span class="op" id="4041191">,</span>&nbsp;<span class="ident" id="4041193">n</span><span class="op" id="4041194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041197">if</span>&nbsp;<span class="ident" id="4041200">g</span><span class="op" id="4041201">.</span><span class="ident" id="4041202">Cmp</span><span class="op" id="4041205">(</span><span class="ident" id="4041206">bigOne</span><span class="op" id="4041212">)</span>&nbsp;<span class="op" id="4041214">!=</span>&nbsp;<span class="num" id="4041217">0</span>&nbsp;<span class="op" id="4041219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041223">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041289">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041355">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041418">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041430">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041438">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041442">if</span>&nbsp;<span class="ident" id="4041445">x</span><span class="op" id="4041446">.</span><span class="ident" id="4041447">Cmp</span><span class="op" id="4041450">(</span><span class="ident" id="4041451">bigOne</span><span class="op" id="4041457">)</span>&nbsp;<span class="op" id="4041459">&lt;</span>&nbsp;<span class="num" id="4041461">0</span>&nbsp;<span class="op" id="4041463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041467">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4041532">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041562">x</span><span class="op" id="4041563">.</span><span class="ident" id="4041564">Add</span><span class="op" id="4041567">(</span><span class="ident" id="4041568">x</span><span class="op" id="4041569">,</span>&nbsp;<span class="ident" id="4041571">n</span><span class="op" id="4041572">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041579">return</span>&nbsp;<span class="ident" id="4041586">x</span><span class="op" id="4041587">,</span>&nbsp;<span class="builtintype" id="4041589">true</span><br>
<span class="lineno"></span><span class="op" id="4041594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4041597">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4041675">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4041693">func</span>&nbsp;<span class="op" id="4041698">(</span><span class="ident" id="4041699">priv</span>&nbsp;<span class="op" id="4041704">*</span><span class="ident" id="4041705">PrivateKey</span><span class="op" id="4041715">)</span>&nbsp;<span class="ident" id="4041717">Precompute</span><span class="op" id="4041727">(</span><span class="op" id="4041728">)</span>&nbsp;<span class="op" id="4041730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041733">if</span>&nbsp;<span class="ident" id="4041736">priv</span><span class="op" id="4041740">.</span><span class="ident" id="4041741">Precomputed</span><span class="op" id="4041752">.</span><span class="ident" id="4041753">Dp</span>&nbsp;<span class="op" id="4041756">!=</span>&nbsp;<span class="builtintype" id="4041759">nil</span>&nbsp;<span class="op" id="4041763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041767">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041779">priv</span><span class="op" id="4041783">.</span><span class="ident" id="4041784">Precomputed</span><span class="op" id="4041795">.</span><span class="ident" id="4041796">Dp</span>&nbsp;<span class="op" id="4041799">=</span>&nbsp;<span class="builtinfunc" id="4041801">new</span><span class="op" id="4041804">(</span><span class="ident" id="4041805">big</span><span class="op" id="4041808">.</span><span class="ident" id="4041809">Int</span><span class="op" id="4041812">)</span><span class="op" id="4041813">.</span><span class="ident" id="4041814">Sub</span><span class="op" id="4041817">(</span><span class="ident" id="4041818">priv</span><span class="op" id="4041822">.</span><span class="ident" id="4041823">Primes</span><span class="op" id="4041829">[</span><span class="num" id="4041830">0</span><span class="op" id="4041831">]</span><span class="op" id="4041832">,</span>&nbsp;<span class="ident" id="4041834">bigOne</span><span class="op" id="4041840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041843">priv</span><span class="op" id="4041847">.</span><span class="ident" id="4041848">Precomputed</span><span class="op" id="4041859">.</span><span class="ident" id="4041860">Dp</span><span class="op" id="4041862">.</span><span class="ident" id="4041863">Mod</span><span class="op" id="4041866">(</span><span class="ident" id="4041867">priv</span><span class="op" id="4041871">.</span><span class="ident" id="4041872">D</span><span class="op" id="4041873">,</span>&nbsp;<span class="ident" id="4041875">priv</span><span class="op" id="4041879">.</span><span class="ident" id="4041880">Precomputed</span><span class="op" id="4041891">.</span><span class="ident" id="4041892">Dp</span><span class="op" id="4041894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041898">priv</span><span class="op" id="4041902">.</span><span class="ident" id="4041903">Precomputed</span><span class="op" id="4041914">.</span><span class="ident" id="4041915">Dq</span>&nbsp;<span class="op" id="4041918">=</span>&nbsp;<span class="builtinfunc" id="4041920">new</span><span class="op" id="4041923">(</span><span class="ident" id="4041924">big</span><span class="op" id="4041927">.</span><span class="ident" id="4041928">Int</span><span class="op" id="4041931">)</span><span class="op" id="4041932">.</span><span class="ident" id="4041933">Sub</span><span class="op" id="4041936">(</span><span class="ident" id="4041937">priv</span><span class="op" id="4041941">.</span><span class="ident" id="4041942">Primes</span><span class="op" id="4041948">[</span><span class="num" id="4041949">1</span><span class="op" id="4041950">]</span><span class="op" id="4041951">,</span>&nbsp;<span class="ident" id="4041953">bigOne</span><span class="op" id="4041959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041962">priv</span><span class="op" id="4041966">.</span><span class="ident" id="4041967">Precomputed</span><span class="op" id="4041978">.</span><span class="ident" id="4041979">Dq</span><span class="op" id="4041981">.</span><span class="ident" id="4041982">Mod</span><span class="op" id="4041985">(</span><span class="ident" id="4041986">priv</span><span class="op" id="4041990">.</span><span class="ident" id="4041991">D</span><span class="op" id="4041992">,</span>&nbsp;<span class="ident" id="4041994">priv</span><span class="op" id="4041998">.</span><span class="ident" id="4041999">Precomputed</span><span class="op" id="4042010">.</span><span class="ident" id="4042011">Dq</span><span class="op" id="4042013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042017">priv</span><span class="op" id="4042021">.</span><span class="ident" id="4042022">Precomputed</span><span class="op" id="4042033">.</span><span class="ident" id="4042034">Qinv</span>&nbsp;<span class="op" id="4042039">=</span>&nbsp;<span class="builtinfunc" id="4042041">new</span><span class="op" id="4042044">(</span><span class="ident" id="4042045">big</span><span class="op" id="4042048">.</span><span class="ident" id="4042049">Int</span><span class="op" id="4042052">)</span><span class="op" id="4042053">.</span><span class="ident" id="4042054">ModInverse</span><span class="op" id="4042064">(</span><span class="ident" id="4042065">priv</span><span class="op" id="4042069">.</span><span class="ident" id="4042070">Primes</span><span class="op" id="4042076">[</span><span class="num" id="4042077">1</span><span class="op" id="4042078">]</span><span class="op" id="4042079">,</span>&nbsp;<span class="ident" id="4042081">priv</span><span class="op" id="4042085">.</span><span class="ident" id="4042086">Primes</span><span class="op" id="4042092">[</span><span class="num" id="4042093">0</span><span class="op" id="4042094">]</span><span class="op" id="4042095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042099">r</span>&nbsp;<span class="op" id="4042101">:=</span>&nbsp;<span class="builtinfunc" id="4042104">new</span><span class="op" id="4042107">(</span><span class="ident" id="4042108">big</span><span class="op" id="4042111">.</span><span class="ident" id="4042112">Int</span><span class="op" id="4042115">)</span><span class="op" id="4042116">.</span><span class="ident" id="4042117">Mul</span><span class="op" id="4042120">(</span><span class="ident" id="4042121">priv</span><span class="op" id="4042125">.</span><span class="ident" id="4042126">Primes</span><span class="op" id="4042132">[</span><span class="num" id="4042133">0</span><span class="op" id="4042134">]</span><span class="op" id="4042135">,</span>&nbsp;<span class="ident" id="4042137">priv</span><span class="op" id="4042141">.</span><span class="ident" id="4042142">Primes</span><span class="op" id="4042148">[</span><span class="num" id="4042149">1</span><span class="op" id="4042150">]</span><span class="op" id="4042151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042154">priv</span><span class="op" id="4042158">.</span><span class="ident" id="4042159">Precomputed</span><span class="op" id="4042170">.</span><span class="ident" id="4042171">CRTValues</span>&nbsp;<span class="op" id="4042181">=</span>&nbsp;<span class="builtinfunc" id="4042183">make</span><span class="op" id="4042187">(</span><span class="op" id="4042188">[</span><span class="op" id="4042189">]</span><span class="ident" id="4042190">CRTValue</span><span class="op" id="4042198">,</span>&nbsp;<span class="builtinfunc" id="4042200">len</span><span class="op" id="4042203">(</span><span class="ident" id="4042204">priv</span><span class="op" id="4042208">.</span><span class="ident" id="4042209">Primes</span><span class="op" id="4042215">)</span><span class="op" id="4042216">-</span><span class="num" id="4042217">2</span><span class="op" id="4042218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042221">for</span>&nbsp;<span class="ident" id="4042225">i</span>&nbsp;<span class="op" id="4042227">:=</span>&nbsp;<span class="num" id="4042230">2</span><span class="op" id="4042231">;</span>&nbsp;<span class="ident" id="4042233">i</span>&nbsp;<span class="op" id="4042235">&lt;</span>&nbsp;<span class="builtinfunc" id="4042237">len</span><span class="op" id="4042240">(</span><span class="ident" id="4042241">priv</span><span class="op" id="4042245">.</span><span class="ident" id="4042246">Primes</span><span class="op" id="4042252">)</span><span class="op" id="4042253">;</span>&nbsp;<span class="ident" id="4042255">i</span><span class="op" id="4042256">++</span>&nbsp;<span class="op" id="4042259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042263">prime</span>&nbsp;<span class="op" id="4042269">:=</span>&nbsp;<span class="ident" id="4042272">priv</span><span class="op" id="4042276">.</span><span class="ident" id="4042277">Primes</span><span class="op" id="4042283">[</span><span class="ident" id="4042284">i</span><span class="op" id="4042285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042289">values</span>&nbsp;<span class="op" id="4042296">:=</span>&nbsp;<span class="op" id="4042299">&amp;</span><span class="ident" id="4042300">priv</span><span class="op" id="4042304">.</span><span class="ident" id="4042305">Precomputed</span><span class="op" id="4042316">.</span><span class="ident" id="4042317">CRTValues</span><span class="op" id="4042326">[</span><span class="ident" id="4042327">i</span><span class="op" id="4042328">-</span><span class="num" id="4042329">2</span><span class="op" id="4042330">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042335">values</span><span class="op" id="4042341">.</span><span class="ident" id="4042342">Exp</span>&nbsp;<span class="op" id="4042346">=</span>&nbsp;<span class="builtinfunc" id="4042348">new</span><span class="op" id="4042351">(</span><span class="ident" id="4042352">big</span><span class="op" id="4042355">.</span><span class="ident" id="4042356">Int</span><span class="op" id="4042359">)</span><span class="op" id="4042360">.</span><span class="ident" id="4042361">Sub</span><span class="op" id="4042364">(</span><span class="ident" id="4042365">prime</span><span class="op" id="4042370">,</span>&nbsp;<span class="ident" id="4042372">bigOne</span><span class="op" id="4042378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042382">values</span><span class="op" id="4042388">.</span><span class="ident" id="4042389">Exp</span><span class="op" id="4042392">.</span><span class="ident" id="4042393">Mod</span><span class="op" id="4042396">(</span><span class="ident" id="4042397">priv</span><span class="op" id="4042401">.</span><span class="ident" id="4042402">D</span><span class="op" id="4042403">,</span>&nbsp;<span class="ident" id="4042405">values</span><span class="op" id="4042411">.</span><span class="ident" id="4042412">Exp</span><span class="op" id="4042415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042420">values</span><span class="op" id="4042426">.</span><span class="ident" id="4042427">R</span>&nbsp;<span class="op" id="4042429">=</span>&nbsp;<span class="builtinfunc" id="4042431">new</span><span class="op" id="4042434">(</span><span class="ident" id="4042435">big</span><span class="op" id="4042438">.</span><span class="ident" id="4042439">Int</span><span class="op" id="4042442">)</span><span class="op" id="4042443">.</span><span class="ident" id="4042444">Set</span><span class="op" id="4042447">(</span><span class="ident" id="4042448">r</span><span class="op" id="4042449">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042453">values</span><span class="op" id="4042459">.</span><span class="ident" id="4042460">Coeff</span>&nbsp;<span class="op" id="4042466">=</span>&nbsp;<span class="builtinfunc" id="4042468">new</span><span class="op" id="4042471">(</span><span class="ident" id="4042472">big</span><span class="op" id="4042475">.</span><span class="ident" id="4042476">Int</span><span class="op" id="4042479">)</span><span class="op" id="4042480">.</span><span class="ident" id="4042481">ModInverse</span><span class="op" id="4042491">(</span><span class="ident" id="4042492">r</span><span class="op" id="4042493">,</span>&nbsp;<span class="ident" id="4042495">prime</span><span class="op" id="4042500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042505">r</span><span class="op" id="4042506">.</span><span class="ident" id="4042507">Mul</span><span class="op" id="4042510">(</span><span class="ident" id="4042511">r</span><span class="op" id="4042512">,</span>&nbsp;<span class="ident" id="4042514">prime</span><span class="op" id="4042519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4042522">}</span><br>
<span class="lineno"></span><span class="op" id="4042524">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4042527">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4042605">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4042654">func</span>&nbsp;<span class="ident" id="4042659">decrypt</span><span class="op" id="4042666">(</span><span class="ident" id="4042667">random</span>&nbsp;<span class="ident" id="4042674">io</span><span class="op" id="4042676">.</span><span class="ident" id="4042677">Reader</span><span class="op" id="4042683">,</span>&nbsp;<span class="ident" id="4042685">priv</span>&nbsp;<span class="op" id="4042690">*</span><span class="ident" id="4042691">PrivateKey</span><span class="op" id="4042701">,</span>&nbsp;<span class="ident" id="4042703">c</span>&nbsp;<span class="op" id="4042705">*</span><span class="ident" id="4042706">big</span><span class="op" id="4042709">.</span><span class="ident" id="4042710">Int</span><span class="op" id="4042713">)</span>&nbsp;<span class="op" id="4042715">(</span><span class="ident" id="4042716">m</span>&nbsp;<span class="op" id="4042718">*</span><span class="ident" id="4042719">big</span><span class="op" id="4042722">.</span><span class="ident" id="4042723">Int</span><span class="op" id="4042726">,</span>&nbsp;<span class="ident" id="4042728">err</span>&nbsp;<span class="builtintype" id="4042732">error</span><span class="op" id="4042737">)</span>&nbsp;<span class="op" id="4042739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042742">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042794">if</span>&nbsp;<span class="ident" id="4042797">c</span><span class="op" id="4042798">.</span><span class="ident" id="4042799">Cmp</span><span class="op" id="4042802">(</span><span class="ident" id="4042803">priv</span><span class="op" id="4042807">.</span><span class="ident" id="4042808">N</span><span class="op" id="4042809">)</span>&nbsp;<span class="op" id="4042811">&gt;</span>&nbsp;<span class="num" id="4042813">0</span>&nbsp;<span class="op" id="4042815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042819">err</span>&nbsp;<span class="op" id="4042823">=</span>&nbsp;<span class="ident" id="4042825">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4042849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042853">var</span>&nbsp;<span class="ident" id="4042857">ir</span>&nbsp;<span class="op" id="4042860">*</span><span class="ident" id="4042861">big</span><span class="op" id="4042864">.</span><span class="ident" id="4042865">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042870">if</span>&nbsp;<span class="ident" id="4042873">random</span>&nbsp;<span class="op" id="4042880">!=</span>&nbsp;<span class="builtintype" id="4042883">nil</span>&nbsp;<span class="op" id="4042887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042891">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042954">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043018">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043082">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043139">var</span>&nbsp;<span class="ident" id="4043143">r</span>&nbsp;<span class="op" id="4043145">*</span><span class="ident" id="4043146">big</span><span class="op" id="4043149">.</span><span class="ident" id="4043150">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043157">for</span>&nbsp;<span class="op" id="4043161">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043166">r</span><span class="op" id="4043167">,</span>&nbsp;<span class="ident" id="4043169">err</span>&nbsp;<span class="op" id="4043173">=</span>&nbsp;<span class="ident" id="4043175">rand</span><span class="op" id="4043179">.</span><span class="ident" id="4043180">Int</span><span class="op" id="4043183">(</span><span class="ident" id="4043184">random</span><span class="op" id="4043190">,</span>&nbsp;<span class="ident" id="4043192">priv</span><span class="op" id="4043196">.</span><span class="ident" id="4043197">N</span><span class="op" id="4043198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043203">if</span>&nbsp;<span class="ident" id="4043206">err</span>&nbsp;<span class="op" id="4043210">!=</span>&nbsp;<span class="builtintype" id="4043213">nil</span>&nbsp;<span class="op" id="4043217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043223">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043238">if</span>&nbsp;<span class="ident" id="4043241">r</span><span class="op" id="4043242">.</span><span class="ident" id="4043243">Cmp</span><span class="op" id="4043246">(</span><span class="ident" id="4043247">bigZero</span><span class="op" id="4043254">)</span>&nbsp;<span class="op" id="4043256">==</span>&nbsp;<span class="num" id="4043259">0</span>&nbsp;<span class="op" id="4043261">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043267">r</span>&nbsp;<span class="op" id="4043269">=</span>&nbsp;<span class="ident" id="4043271">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043286">var</span>&nbsp;<span class="ident" id="4043290">ok</span>&nbsp;<span class="builtintype" id="4043293">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043301">ir</span><span class="op" id="4043303">,</span>&nbsp;<span class="ident" id="4043305">ok</span>&nbsp;<span class="op" id="4043308">=</span>&nbsp;<span class="ident" id="4043310">modInverse</span><span class="op" id="4043320">(</span><span class="ident" id="4043321">r</span><span class="op" id="4043322">,</span>&nbsp;<span class="ident" id="4043324">priv</span><span class="op" id="4043328">.</span><span class="ident" id="4043329">N</span><span class="op" id="4043330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043335">if</span>&nbsp;<span class="ident" id="4043338">ok</span>&nbsp;<span class="op" id="4043341">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043347">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043364">bigE</span>&nbsp;<span class="op" id="4043369">:=</span>&nbsp;<span class="ident" id="4043372">big</span><span class="op" id="4043375">.</span><span class="ident" id="4043376">NewInt</span><span class="op" id="4043382">(</span><span class="ident" id="4043383">int64</span><span class="op" id="4043388">(</span><span class="ident" id="4043389">priv</span><span class="op" id="4043393">.</span><span class="ident" id="4043394">E</span><span class="op" id="4043395">)</span><span class="op" id="4043396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043400">rpowe</span>&nbsp;<span class="op" id="4043406">:=</span>&nbsp;<span class="builtinfunc" id="4043409">new</span><span class="op" id="4043412">(</span><span class="ident" id="4043413">big</span><span class="op" id="4043416">.</span><span class="ident" id="4043417">Int</span><span class="op" id="4043420">)</span><span class="op" id="4043421">.</span><span class="ident" id="4043422">Exp</span><span class="op" id="4043425">(</span><span class="ident" id="4043426">r</span><span class="op" id="4043427">,</span>&nbsp;<span class="ident" id="4043429">bigE</span><span class="op" id="4043433">,</span>&nbsp;<span class="ident" id="4043435">priv</span><span class="op" id="4043439">.</span><span class="ident" id="4043440">N</span><span class="op" id="4043441">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043445">cCopy</span>&nbsp;<span class="op" id="4043451">:=</span>&nbsp;<span class="builtinfunc" id="4043454">new</span><span class="op" id="4043457">(</span><span class="ident" id="4043458">big</span><span class="op" id="4043461">.</span><span class="ident" id="4043462">Int</span><span class="op" id="4043465">)</span><span class="op" id="4043466">.</span><span class="ident" id="4043467">Set</span><span class="op" id="4043470">(</span><span class="ident" id="4043471">c</span><span class="op" id="4043472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043476">cCopy</span><span class="op" id="4043481">.</span><span class="ident" id="4043482">Mul</span><span class="op" id="4043485">(</span><span class="ident" id="4043486">cCopy</span><span class="op" id="4043491">,</span>&nbsp;<span class="ident" id="4043493">rpowe</span><span class="op" id="4043498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043502">cCopy</span><span class="op" id="4043507">.</span><span class="ident" id="4043508">Mod</span><span class="op" id="4043511">(</span><span class="ident" id="4043512">cCopy</span><span class="op" id="4043517">,</span>&nbsp;<span class="ident" id="4043519">priv</span><span class="op" id="4043523">.</span><span class="ident" id="4043524">N</span><span class="op" id="4043525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043529">c</span>&nbsp;<span class="op" id="4043531">=</span>&nbsp;<span class="ident" id="4043533">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043540">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043544">if</span>&nbsp;<span class="ident" id="4043547">priv</span><span class="op" id="4043551">.</span><span class="ident" id="4043552">Precomputed</span><span class="op" id="4043563">.</span><span class="ident" id="4043564">Dp</span>&nbsp;<span class="op" id="4043567">==</span>&nbsp;<span class="builtintype" id="4043570">nil</span>&nbsp;<span class="op" id="4043574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043578">m</span>&nbsp;<span class="op" id="4043580">=</span>&nbsp;<span class="builtinfunc" id="4043582">new</span><span class="op" id="4043585">(</span><span class="ident" id="4043586">big</span><span class="op" id="4043589">.</span><span class="ident" id="4043590">Int</span><span class="op" id="4043593">)</span><span class="op" id="4043594">.</span><span class="ident" id="4043595">Exp</span><span class="op" id="4043598">(</span><span class="ident" id="4043599">c</span><span class="op" id="4043600">,</span>&nbsp;<span class="ident" id="4043602">priv</span><span class="op" id="4043606">.</span><span class="ident" id="4043607">D</span><span class="op" id="4043608">,</span>&nbsp;<span class="ident" id="4043610">priv</span><span class="op" id="4043614">.</span><span class="ident" id="4043615">N</span><span class="op" id="4043616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043619">}</span>&nbsp;<span class="keyword" id="4043621">else</span>&nbsp;<span class="op" id="4043626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043630">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043688">m</span>&nbsp;<span class="op" id="4043690">=</span>&nbsp;<span class="builtinfunc" id="4043692">new</span><span class="op" id="4043695">(</span><span class="ident" id="4043696">big</span><span class="op" id="4043699">.</span><span class="ident" id="4043700">Int</span><span class="op" id="4043703">)</span><span class="op" id="4043704">.</span><span class="ident" id="4043705">Exp</span><span class="op" id="4043708">(</span><span class="ident" id="4043709">c</span><span class="op" id="4043710">,</span>&nbsp;<span class="ident" id="4043712">priv</span><span class="op" id="4043716">.</span><span class="ident" id="4043717">Precomputed</span><span class="op" id="4043728">.</span><span class="ident" id="4043729">Dp</span><span class="op" id="4043731">,</span>&nbsp;<span class="ident" id="4043733">priv</span><span class="op" id="4043737">.</span><span class="ident" id="4043738">Primes</span><span class="op" id="4043744">[</span><span class="num" id="4043745">0</span><span class="op" id="4043746">]</span><span class="op" id="4043747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043751">m2</span>&nbsp;<span class="op" id="4043754">:=</span>&nbsp;<span class="builtinfunc" id="4043757">new</span><span class="op" id="4043760">(</span><span class="ident" id="4043761">big</span><span class="op" id="4043764">.</span><span class="ident" id="4043765">Int</span><span class="op" id="4043768">)</span><span class="op" id="4043769">.</span><span class="ident" id="4043770">Exp</span><span class="op" id="4043773">(</span><span class="ident" id="4043774">c</span><span class="op" id="4043775">,</span>&nbsp;<span class="ident" id="4043777">priv</span><span class="op" id="4043781">.</span><span class="ident" id="4043782">Precomputed</span><span class="op" id="4043793">.</span><span class="ident" id="4043794">Dq</span><span class="op" id="4043796">,</span>&nbsp;<span class="ident" id="4043798">priv</span><span class="op" id="4043802">.</span><span class="ident" id="4043803">Primes</span><span class="op" id="4043809">[</span><span class="num" id="4043810">1</span><span class="op" id="4043811">]</span><span class="op" id="4043812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043816">m</span><span class="op" id="4043817">.</span><span class="ident" id="4043818">Sub</span><span class="op" id="4043821">(</span><span class="ident" id="4043822">m</span><span class="op" id="4043823">,</span>&nbsp;<span class="ident" id="4043825">m2</span><span class="op" id="4043827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043831">if</span>&nbsp;<span class="ident" id="4043834">m</span><span class="op" id="4043835">.</span><span class="ident" id="4043836">Sign</span><span class="op" id="4043840">(</span><span class="op" id="4043841">)</span>&nbsp;<span class="op" id="4043843">&lt;</span>&nbsp;<span class="num" id="4043845">0</span>&nbsp;<span class="op" id="4043847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043852">m</span><span class="op" id="4043853">.</span><span class="ident" id="4043854">Add</span><span class="op" id="4043857">(</span><span class="ident" id="4043858">m</span><span class="op" id="4043859">,</span>&nbsp;<span class="ident" id="4043861">priv</span><span class="op" id="4043865">.</span><span class="ident" id="4043866">Primes</span><span class="op" id="4043872">[</span><span class="num" id="4043873">0</span><span class="op" id="4043874">]</span><span class="op" id="4043875">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043883">m</span><span class="op" id="4043884">.</span><span class="ident" id="4043885">Mul</span><span class="op" id="4043888">(</span><span class="ident" id="4043889">m</span><span class="op" id="4043890">,</span>&nbsp;<span class="ident" id="4043892">priv</span><span class="op" id="4043896">.</span><span class="ident" id="4043897">Precomputed</span><span class="op" id="4043908">.</span><span class="ident" id="4043909">Qinv</span><span class="op" id="4043913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043917">m</span><span class="op" id="4043918">.</span><span class="ident" id="4043919">Mod</span><span class="op" id="4043922">(</span><span class="ident" id="4043923">m</span><span class="op" id="4043924">,</span>&nbsp;<span class="ident" id="4043926">priv</span><span class="op" id="4043930">.</span><span class="ident" id="4043931">Primes</span><span class="op" id="4043937">[</span><span class="num" id="4043938">0</span><span class="op" id="4043939">]</span><span class="op" id="4043940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043944">m</span><span class="op" id="4043945">.</span><span class="ident" id="4043946">Mul</span><span class="op" id="4043949">(</span><span class="ident" id="4043950">m</span><span class="op" id="4043951">,</span>&nbsp;<span class="ident" id="4043953">priv</span><span class="op" id="4043957">.</span><span class="ident" id="4043958">Primes</span><span class="op" id="4043964">[</span><span class="num" id="4043965">1</span><span class="op" id="4043966">]</span><span class="op" id="4043967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043971">m</span><span class="op" id="4043972">.</span><span class="ident" id="4043973">Add</span><span class="op" id="4043976">(</span><span class="ident" id="4043977">m</span><span class="op" id="4043978">,</span>&nbsp;<span class="ident" id="4043980">m2</span><span class="op" id="4043982">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043987">for</span>&nbsp;<span class="ident" id="4043991">i</span><span class="op" id="4043992">,</span>&nbsp;<span class="ident" id="4043994">values</span>&nbsp;<span class="op" id="4044001">:=</span>&nbsp;<span class="keyword" id="4044004">range</span>&nbsp;<span class="ident" id="4044010">priv</span><span class="op" id="4044014">.</span><span class="ident" id="4044015">Precomputed</span><span class="op" id="4044026">.</span><span class="ident" id="4044027">CRTValues</span>&nbsp;<span class="op" id="4044037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044042">prime</span>&nbsp;<span class="op" id="4044048">:=</span>&nbsp;<span class="ident" id="4044051">priv</span><span class="op" id="4044055">.</span><span class="ident" id="4044056">Primes</span><span class="op" id="4044062">[</span><span class="num" id="4044063">2</span><span class="op" id="4044064">+</span><span class="ident" id="4044065">i</span><span class="op" id="4044066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044071">m2</span><span class="op" id="4044073">.</span><span class="ident" id="4044074">Exp</span><span class="op" id="4044077">(</span><span class="ident" id="4044078">c</span><span class="op" id="4044079">,</span>&nbsp;<span class="ident" id="4044081">values</span><span class="op" id="4044087">.</span><span class="ident" id="4044088">Exp</span><span class="op" id="4044091">,</span>&nbsp;<span class="ident" id="4044093">prime</span><span class="op" id="4044098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044103">m2</span><span class="op" id="4044105">.</span><span class="ident" id="4044106">Sub</span><span class="op" id="4044109">(</span><span class="ident" id="4044110">m2</span><span class="op" id="4044112">,</span>&nbsp;<span class="ident" id="4044114">m</span><span class="op" id="4044115">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044120">m2</span><span class="op" id="4044122">.</span><span class="ident" id="4044123">Mul</span><span class="op" id="4044126">(</span><span class="ident" id="4044127">m2</span><span class="op" id="4044129">,</span>&nbsp;<span class="ident" id="4044131">values</span><span class="op" id="4044137">.</span><span class="ident" id="4044138">Coeff</span><span class="op" id="4044143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044148">m2</span><span class="op" id="4044150">.</span><span class="ident" id="4044151">Mod</span><span class="op" id="4044154">(</span><span class="ident" id="4044155">m2</span><span class="op" id="4044157">,</span>&nbsp;<span class="ident" id="4044159">prime</span><span class="op" id="4044164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044169">if</span>&nbsp;<span class="ident" id="4044172">m2</span><span class="op" id="4044174">.</span><span class="ident" id="4044175">Sign</span><span class="op" id="4044179">(</span><span class="op" id="4044180">)</span>&nbsp;<span class="op" id="4044182">&lt;</span>&nbsp;<span class="num" id="4044184">0</span>&nbsp;<span class="op" id="4044186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044192">m2</span><span class="op" id="4044194">.</span><span class="ident" id="4044195">Add</span><span class="op" id="4044198">(</span><span class="ident" id="4044199">m2</span><span class="op" id="4044201">,</span>&nbsp;<span class="ident" id="4044203">prime</span><span class="op" id="4044208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044213">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044218">m2</span><span class="op" id="4044220">.</span><span class="ident" id="4044221">Mul</span><span class="op" id="4044224">(</span><span class="ident" id="4044225">m2</span><span class="op" id="4044227">,</span>&nbsp;<span class="ident" id="4044229">values</span><span class="op" id="4044235">.</span><span class="ident" id="4044236">R</span><span class="op" id="4044237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044242">m</span><span class="op" id="4044243">.</span><span class="ident" id="4044244">Add</span><span class="op" id="4044247">(</span><span class="ident" id="4044248">m</span><span class="op" id="4044249">,</span>&nbsp;<span class="ident" id="4044251">m2</span><span class="op" id="4044253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044264">if</span>&nbsp;<span class="ident" id="4044267">ir</span>&nbsp;<span class="op" id="4044270">!=</span>&nbsp;<span class="builtintype" id="4044273">nil</span>&nbsp;<span class="op" id="4044277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044281">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044295">m</span><span class="op" id="4044296">.</span><span class="ident" id="4044297">Mul</span><span class="op" id="4044300">(</span><span class="ident" id="4044301">m</span><span class="op" id="4044302">,</span>&nbsp;<span class="ident" id="4044304">ir</span><span class="op" id="4044306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044310">m</span><span class="op" id="4044311">.</span><span class="ident" id="4044312">Mod</span><span class="op" id="4044315">(</span><span class="ident" id="4044316">m</span><span class="op" id="4044317">,</span>&nbsp;<span class="ident" id="4044319">priv</span><span class="op" id="4044323">.</span><span class="ident" id="4044324">N</span><span class="op" id="4044325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044328">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044332">return</span><br>
<span class="lineno"></span><span class="op" id="4044339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044342">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4044393">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4044482">func</span>&nbsp;<span class="ident" id="4044487">DecryptOAEP</span><span class="op" id="4044498">(</span><span class="ident" id="4044499">hash</span>&nbsp;<span class="ident" id="4044504">hash</span><span class="op" id="4044508">.</span><span class="ident" id="4044509">Hash</span><span class="op" id="4044513">,</span>&nbsp;<span class="ident" id="4044515">random</span>&nbsp;<span class="ident" id="4044522">io</span><span class="op" id="4044524">.</span><span class="ident" id="4044525">Reader</span><span class="op" id="4044531">,</span>&nbsp;<span class="ident" id="4044533">priv</span>&nbsp;<span class="op" id="4044538">*</span><span class="ident" id="4044539">PrivateKey</span><span class="op" id="4044549">,</span>&nbsp;<span class="ident" id="4044551">ciphertext</span>&nbsp;<span class="op" id="4044562">[</span><span class="op" id="4044563">]</span><span class="builtintype" id="4044564">byte</span><span class="op" id="4044568">,</span>&nbsp;<span class="ident" id="4044570">label</span>&nbsp;<span class="op" id="4044576">[</span><span class="op" id="4044577">]</span><span class="builtintype" id="4044578">byte</span><span class="op" id="4044582">)</span>&nbsp;<span class="op" id="4044584">(</span><span class="ident" id="4044585">msg</span>&nbsp;<span class="op" id="4044589">[</span><span class="op" id="4044590">]</span><span class="builtintype" id="4044591">byte</span><span class="op" id="4044595">,</span>&nbsp;<span class="ident" id="4044597">err</span>&nbsp;<span class="builtintype" id="4044601">error</span><span class="op" id="4044606">)</span>&nbsp;<span class="op" id="4044608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044611">if</span>&nbsp;<span class="ident" id="4044614">err</span>&nbsp;<span class="op" id="4044618">:=</span>&nbsp;<span class="ident" id="4044621">checkPub</span><span class="op" id="4044629">(</span><span class="op" id="4044630">&amp;</span><span class="ident" id="4044631">priv</span><span class="op" id="4044635">.</span><span class="ident" id="4044636">PublicKey</span><span class="op" id="4044645">)</span><span class="op" id="4044646">;</span>&nbsp;<span class="ident" id="4044648">err</span>&nbsp;<span class="op" id="4044652">!=</span>&nbsp;<span class="builtintype" id="4044655">nil</span>&nbsp;<span class="op" id="4044659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044663">return</span>&nbsp;<span class="builtintype" id="4044670">nil</span><span class="op" id="4044673">,</span>&nbsp;<span class="ident" id="4044675">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044680">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044683">k</span>&nbsp;<span class="op" id="4044685">:=</span>&nbsp;<span class="op" id="4044688">(</span><span class="ident" id="4044689">priv</span><span class="op" id="4044693">.</span><span class="ident" id="4044694">N</span><span class="op" id="4044695">.</span><span class="ident" id="4044696">BitLen</span><span class="op" id="4044702">(</span><span class="op" id="4044703">)</span>&nbsp;<span class="op" id="4044705">+</span>&nbsp;<span class="num" id="4044707">7</span><span class="op" id="4044708">)</span>&nbsp;<span class="op" id="4044710">/</span>&nbsp;<span class="num" id="4044712">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044715">if</span>&nbsp;<span class="builtinfunc" id="4044718">len</span><span class="op" id="4044721">(</span><span class="ident" id="4044722">ciphertext</span><span class="op" id="4044732">)</span>&nbsp;<span class="op" id="4044734">&gt;</span>&nbsp;<span class="ident" id="4044736">k</span>&nbsp;<span class="op" id="4044738">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044743">k</span>&nbsp;<span class="op" id="4044745">&lt;</span>&nbsp;<span class="ident" id="4044747">hash</span><span class="op" id="4044751">.</span><span class="ident" id="4044752">Size</span><span class="op" id="4044756">(</span><span class="op" id="4044757">)</span><span class="op" id="4044758">*</span><span class="num" id="4044759">2</span><span class="op" id="4044760">+</span><span class="num" id="4044761">2</span>&nbsp;<span class="op" id="4044763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044767">err</span>&nbsp;<span class="op" id="4044771">=</span>&nbsp;<span class="ident" id="4044773">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044789">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044801">c</span>&nbsp;<span class="op" id="4044803">:=</span>&nbsp;<span class="builtinfunc" id="4044806">new</span><span class="op" id="4044809">(</span><span class="ident" id="4044810">big</span><span class="op" id="4044813">.</span><span class="ident" id="4044814">Int</span><span class="op" id="4044817">)</span><span class="op" id="4044818">.</span><span class="ident" id="4044819">SetBytes</span><span class="op" id="4044827">(</span><span class="ident" id="4044828">ciphertext</span><span class="op" id="4044838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044842">m</span><span class="op" id="4044843">,</span>&nbsp;<span class="ident" id="4044845">err</span>&nbsp;<span class="op" id="4044849">:=</span>&nbsp;<span class="ident" id="4044852">decrypt</span><span class="op" id="4044859">(</span><span class="ident" id="4044860">random</span><span class="op" id="4044866">,</span>&nbsp;<span class="ident" id="4044868">priv</span><span class="op" id="4044872">,</span>&nbsp;<span class="ident" id="4044874">c</span><span class="op" id="4044875">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044878">if</span>&nbsp;<span class="ident" id="4044881">err</span>&nbsp;<span class="op" id="4044885">!=</span>&nbsp;<span class="builtintype" id="4044888">nil</span>&nbsp;<span class="op" id="4044892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044908">hash</span><span class="op" id="4044912">.</span><span class="ident" id="4044913">Write</span><span class="op" id="4044918">(</span><span class="ident" id="4044919">label</span><span class="op" id="4044924">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044927">lHash</span>&nbsp;<span class="op" id="4044933">:=</span>&nbsp;<span class="ident" id="4044936">hash</span><span class="op" id="4044940">.</span><span class="ident" id="4044941">Sum</span><span class="op" id="4044944">(</span><span class="builtintype" id="4044945">nil</span><span class="op" id="4044948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044951">hash</span><span class="op" id="4044955">.</span><span class="ident" id="4044956">Reset</span><span class="op" id="4044961">(</span><span class="op" id="4044962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044966">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045026">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045099">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045168">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045236">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045262">em</span>&nbsp;<span class="op" id="4045265">:=</span>&nbsp;<span class="ident" id="4045268">leftPad</span><span class="op" id="4045275">(</span><span class="ident" id="4045276">m</span><span class="op" id="4045277">.</span><span class="ident" id="4045278">Bytes</span><span class="op" id="4045283">(</span><span class="op" id="4045284">)</span><span class="op" id="4045285">,</span>&nbsp;<span class="ident" id="4045287">k</span><span class="op" id="4045288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045292">firstByteIsZero</span>&nbsp;<span class="op" id="4045308">:=</span>&nbsp;<span class="ident" id="4045311">subtle</span><span class="op" id="4045317">.</span><span class="ident" id="4045318">ConstantTimeByteEq</span><span class="op" id="4045336">(</span><span class="ident" id="4045337">em</span><span class="op" id="4045339">[</span><span class="num" id="4045340">0</span><span class="op" id="4045341">]</span><span class="op" id="4045342">,</span>&nbsp;<span class="num" id="4045344">0</span><span class="op" id="4045345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045349">seed</span>&nbsp;<span class="op" id="4045354">:=</span>&nbsp;<span class="ident" id="4045357">em</span><span class="op" id="4045359">[</span><span class="num" id="4045360">1</span>&nbsp;<span class="op" id="4045362">:</span>&nbsp;<span class="ident" id="4045364">hash</span><span class="op" id="4045368">.</span><span class="ident" id="4045369">Size</span><span class="op" id="4045373">(</span><span class="op" id="4045374">)</span><span class="op" id="4045375">+</span><span class="num" id="4045376">1</span><span class="op" id="4045377">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045380">db</span>&nbsp;<span class="op" id="4045383">:=</span>&nbsp;<span class="ident" id="4045386">em</span><span class="op" id="4045388">[</span><span class="ident" id="4045389">hash</span><span class="op" id="4045393">.</span><span class="ident" id="4045394">Size</span><span class="op" id="4045398">(</span><span class="op" id="4045399">)</span><span class="op" id="4045400">+</span><span class="num" id="4045401">1</span><span class="op" id="4045402">:</span><span class="op" id="4045403">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045407">mgf1XOR</span><span class="op" id="4045414">(</span><span class="ident" id="4045415">seed</span><span class="op" id="4045419">,</span>&nbsp;<span class="ident" id="4045421">hash</span><span class="op" id="4045425">,</span>&nbsp;<span class="ident" id="4045427">db</span><span class="op" id="4045429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045432">mgf1XOR</span><span class="op" id="4045439">(</span><span class="ident" id="4045440">db</span><span class="op" id="4045442">,</span>&nbsp;<span class="ident" id="4045444">hash</span><span class="op" id="4045448">,</span>&nbsp;<span class="ident" id="4045450">seed</span><span class="op" id="4045454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045458">lHash2</span>&nbsp;<span class="op" id="4045465">:=</span>&nbsp;<span class="ident" id="4045468">db</span><span class="op" id="4045470">[</span><span class="num" id="4045471">0</span><span class="op" id="4045472">:</span><span class="ident" id="4045473">hash</span><span class="op" id="4045477">.</span><span class="ident" id="4045478">Size</span><span class="op" id="4045482">(</span><span class="op" id="4045483">)</span><span class="op" id="4045484">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045488">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045561">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045632">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045700">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045756">lHash2Good</span>&nbsp;<span class="op" id="4045767">:=</span>&nbsp;<span class="ident" id="4045770">subtle</span><span class="op" id="4045776">.</span><span class="ident" id="4045777">ConstantTimeCompare</span><span class="op" id="4045796">(</span><span class="ident" id="4045797">lHash</span><span class="op" id="4045802">,</span>&nbsp;<span class="ident" id="4045804">lHash2</span><span class="op" id="4045810">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045814">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045885">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045923">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045986">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046033">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046094">var</span>&nbsp;<span class="ident" id="4046098">lookingForIndex</span><span class="op" id="4046113">,</span>&nbsp;<span class="ident" id="4046115">index</span><span class="op" id="4046120">,</span>&nbsp;<span class="ident" id="4046122">invalid</span>&nbsp;<span class="builtintype" id="4046130">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046135">lookingForIndex</span>&nbsp;<span class="op" id="4046151">=</span>&nbsp;<span class="num" id="4046153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046156">rest</span>&nbsp;<span class="op" id="4046161">:=</span>&nbsp;<span class="ident" id="4046164">db</span><span class="op" id="4046166">[</span><span class="ident" id="4046167">hash</span><span class="op" id="4046171">.</span><span class="ident" id="4046172">Size</span><span class="op" id="4046176">(</span><span class="op" id="4046177">)</span><span class="op" id="4046178">:</span><span class="op" id="4046179">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046183">for</span>&nbsp;<span class="ident" id="4046187">i</span>&nbsp;<span class="op" id="4046189">:=</span>&nbsp;<span class="num" id="4046192">0</span><span class="op" id="4046193">;</span>&nbsp;<span class="ident" id="4046195">i</span>&nbsp;<span class="op" id="4046197">&lt;</span>&nbsp;<span class="builtinfunc" id="4046199">len</span><span class="op" id="4046202">(</span><span class="ident" id="4046203">rest</span><span class="op" id="4046207">)</span><span class="op" id="4046208">;</span>&nbsp;<span class="ident" id="4046210">i</span><span class="op" id="4046211">++</span>&nbsp;<span class="op" id="4046214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046218">equals0</span>&nbsp;<span class="op" id="4046226">:=</span>&nbsp;<span class="ident" id="4046229">subtle</span><span class="op" id="4046235">.</span><span class="ident" id="4046236">ConstantTimeByteEq</span><span class="op" id="4046254">(</span><span class="ident" id="4046255">rest</span><span class="op" id="4046259">[</span><span class="ident" id="4046260">i</span><span class="op" id="4046261">]</span><span class="op" id="4046262">,</span>&nbsp;<span class="num" id="4046264">0</span><span class="op" id="4046265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046269">equals1</span>&nbsp;<span class="op" id="4046277">:=</span>&nbsp;<span class="ident" id="4046280">subtle</span><span class="op" id="4046286">.</span><span class="ident" id="4046287">ConstantTimeByteEq</span><span class="op" id="4046305">(</span><span class="ident" id="4046306">rest</span><span class="op" id="4046310">[</span><span class="ident" id="4046311">i</span><span class="op" id="4046312">]</span><span class="op" id="4046313">,</span>&nbsp;<span class="num" id="4046315">1</span><span class="op" id="4046316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046320">index</span>&nbsp;<span class="op" id="4046326">=</span>&nbsp;<span class="ident" id="4046328">subtle</span><span class="op" id="4046334">.</span><span class="ident" id="4046335">ConstantTimeSelect</span><span class="op" id="4046353">(</span><span class="ident" id="4046354">lookingForIndex</span><span class="op" id="4046369">&amp;</span><span class="ident" id="4046370">equals1</span><span class="op" id="4046377">,</span>&nbsp;<span class="ident" id="4046379">i</span><span class="op" id="4046380">,</span>&nbsp;<span class="ident" id="4046382">index</span><span class="op" id="4046387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046391">lookingForIndex</span>&nbsp;<span class="op" id="4046407">=</span>&nbsp;<span class="ident" id="4046409">subtle</span><span class="op" id="4046415">.</span><span class="ident" id="4046416">ConstantTimeSelect</span><span class="op" id="4046434">(</span><span class="ident" id="4046435">equals1</span><span class="op" id="4046442">,</span>&nbsp;<span class="num" id="4046444">0</span><span class="op" id="4046445">,</span>&nbsp;<span class="ident" id="4046447">lookingForIndex</span><span class="op" id="4046462">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046466">invalid</span>&nbsp;<span class="op" id="4046474">=</span>&nbsp;<span class="ident" id="4046476">subtle</span><span class="op" id="4046482">.</span><span class="ident" id="4046483">ConstantTimeSelect</span><span class="op" id="4046501">(</span><span class="ident" id="4046502">lookingForIndex</span><span class="op" id="4046517">&amp;^</span><span class="ident" id="4046519">equals0</span><span class="op" id="4046526">,</span>&nbsp;<span class="num" id="4046528">1</span><span class="op" id="4046529">,</span>&nbsp;<span class="ident" id="4046531">invalid</span><span class="op" id="4046538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046545">if</span>&nbsp;<span class="ident" id="4046548">firstByteIsZero</span><span class="op" id="4046563">&amp;</span><span class="ident" id="4046564">lHash2Good</span><span class="op" id="4046574">&amp;^</span><span class="ident" id="4046576">invalid</span><span class="op" id="4046583">&amp;^</span><span class="ident" id="4046585">lookingForIndex</span>&nbsp;<span class="op" id="4046601">!=</span>&nbsp;<span class="num" id="4046604">1</span>&nbsp;<span class="op" id="4046606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046610">err</span>&nbsp;<span class="op" id="4046614">=</span>&nbsp;<span class="ident" id="4046616">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046632">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046644">msg</span>&nbsp;<span class="op" id="4046648">=</span>&nbsp;<span class="ident" id="4046650">rest</span><span class="op" id="4046654">[</span><span class="ident" id="4046655">index</span><span class="op" id="4046660">+</span><span class="num" id="4046661">1</span><span class="op" id="4046662">:</span><span class="op" id="4046663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046666">return</span><br>
<span class="lineno">545</span><span class="op" id="4046673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4046676">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4046755">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4046784">func</span>&nbsp;<span class="ident" id="4046789">leftPad</span><span class="op" id="4046796">(</span><span class="ident" id="4046797">input</span>&nbsp;<span class="op" id="4046803">[</span><span class="op" id="4046804">]</span><span class="builtintype" id="4046805">byte</span><span class="op" id="4046809">,</span>&nbsp;<span class="ident" id="4046811">size</span>&nbsp;<span class="builtintype" id="4046816">int</span><span class="op" id="4046819">)</span>&nbsp;<span class="op" id="4046821">(</span><span class="ident" id="4046822">out</span>&nbsp;<span class="op" id="4046826">[</span><span class="op" id="4046827">]</span><span class="builtintype" id="4046828">byte</span><span class="op" id="4046832">)</span>&nbsp;<span class="op" id="4046834">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046837">n</span>&nbsp;<span class="op" id="4046839">:=</span>&nbsp;<span class="builtinfunc" id="4046842">len</span><span class="op" id="4046845">(</span><span class="ident" id="4046846">input</span><span class="op" id="4046851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046854">if</span>&nbsp;<span class="ident" id="4046857">n</span>&nbsp;<span class="op" id="4046859">&gt;</span>&nbsp;<span class="ident" id="4046861">size</span>&nbsp;<span class="op" id="4046866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046870">n</span>&nbsp;<span class="op" id="4046872">=</span>&nbsp;<span class="ident" id="4046874">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046883">out</span>&nbsp;<span class="op" id="4046887">=</span>&nbsp;<span class="builtinfunc" id="4046889">make</span><span class="op" id="4046893">(</span><span class="op" id="4046894">[</span><span class="op" id="4046895">]</span><span class="builtintype" id="4046896">byte</span><span class="op" id="4046900">,</span>&nbsp;<span class="ident" id="4046902">size</span><span class="op" id="4046906">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4046909">copy</span><span class="op" id="4046913">(</span><span class="ident" id="4046914">out</span><span class="op" id="4046917">[</span><span class="builtinfunc" id="4046918">len</span><span class="op" id="4046921">(</span><span class="ident" id="4046922">out</span><span class="op" id="4046925">)</span><span class="op" id="4046926">-</span><span class="ident" id="4046927">n</span><span class="op" id="4046928">:</span><span class="op" id="4046929">]</span><span class="op" id="4046930">,</span>&nbsp;<span class="ident" id="4046932">input</span><span class="op" id="4046937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046940">return</span><br>
<span class="lineno"></span><span class="op" id="4046947">}</span>
</div>
</body>
</html>
