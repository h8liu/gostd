<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5409358">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5409413">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5409467">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5409518">package</span>&nbsp;<span class="ident" id="5409526">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409531">import</span>&nbsp;<span class="op" id="5409538">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5409541">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5409550">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5409556">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5409567">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5409578">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5409593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5409596">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5409646">//</span><br>
<span class="lineno"></span><span class="comment" id="5409649">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5409718">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5409794">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="5409874">//</span><br>
<span class="lineno"></span><span class="comment" id="5409877">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="5409910">//</span><br>
<span class="lineno"></span><span class="comment" id="5409913">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="5409989">type</span>&nbsp;<span class="ident" id="5409994">Writer</span>&nbsp;<span class="keyword" id="5410001">struct</span>&nbsp;<span class="op" id="5410008">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410011">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5410019">rune</span>&nbsp;<span class="comment" id="5410024">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410070">UseCRLF</span>&nbsp;<span class="builtintype" id="5410078">bool</span>&nbsp;<span class="comment" id="5410083">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410127">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410135">*</span><span class="ident" id="5410136">bufio</span><span class="op" id="5410141">.</span><span class="ident" id="5410142">Writer</span><br>
<span class="lineno"></span><span class="op" id="5410149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5410152">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5410204">func</span>&nbsp;<span class="ident" id="5410209">NewWriter</span><span class="op" id="5410218">(</span><span class="ident" id="5410219">w</span>&nbsp;<span class="ident" id="5410221">io</span><span class="op" id="5410223">.</span><span class="ident" id="5410224">Writer</span><span class="op" id="5410230">)</span>&nbsp;<span class="op" id="5410232">*</span><span class="ident" id="5410233">Writer</span>&nbsp;<span class="op" id="5410240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410243">return</span>&nbsp;<span class="op" id="5410250">&amp;</span><span class="ident" id="5410251">Writer</span><span class="op" id="5410257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410261">Comma</span><span class="op" id="5410266">:</span>&nbsp;<span class="string" id="5410268">&#39;,&#39;</span><span class="op" id="5410271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410275">w</span><span class="op" id="5410276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410282">bufio</span><span class="op" id="5410287">.</span><span class="ident" id="5410288">NewWriter</span><span class="op" id="5410297">(</span><span class="ident" id="5410298">w</span><span class="op" id="5410299">)</span><span class="op" id="5410300">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410303">}</span><br>
<span class="lineno"></span><span class="op" id="5410305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410308">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="5410384">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="5410452">func</span>&nbsp;<span class="op" id="5410457">(</span><span class="ident" id="5410458">w</span>&nbsp;<span class="op" id="5410460">*</span><span class="ident" id="5410461">Writer</span><span class="op" id="5410467">)</span>&nbsp;<span class="ident" id="5410469">Write</span><span class="op" id="5410474">(</span><span class="ident" id="5410475">record</span>&nbsp;<span class="op" id="5410482">[</span><span class="op" id="5410483">]</span><span class="builtintype" id="5410484">string</span><span class="op" id="5410490">)</span>&nbsp;<span class="op" id="5410492">(</span><span class="ident" id="5410493">err</span>&nbsp;<span class="builtintype" id="5410497">error</span><span class="op" id="5410502">)</span>&nbsp;<span class="op" id="5410504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410507">for</span>&nbsp;<span class="ident" id="5410511">n</span><span class="op" id="5410512">,</span>&nbsp;<span class="ident" id="5410514">field</span>&nbsp;<span class="op" id="5410520">:=</span>&nbsp;<span class="keyword" id="5410523">range</span>&nbsp;<span class="ident" id="5410529">record</span>&nbsp;<span class="op" id="5410536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410540">if</span>&nbsp;<span class="ident" id="5410543">n</span>&nbsp;<span class="op" id="5410545">&gt;</span>&nbsp;<span class="num" id="5410547">0</span>&nbsp;<span class="op" id="5410549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410554">if</span>&nbsp;<span class="ident" id="5410557">_</span><span class="op" id="5410558">,</span>&nbsp;<span class="ident" id="5410560">err</span>&nbsp;<span class="op" id="5410564">=</span>&nbsp;<span class="ident" id="5410566">w</span><span class="op" id="5410567">.</span><span class="ident" id="5410568">w</span><span class="op" id="5410569">.</span><span class="ident" id="5410570">WriteRune</span><span class="op" id="5410579">(</span><span class="ident" id="5410580">w</span><span class="op" id="5410581">.</span><span class="ident" id="5410582">Comma</span><span class="op" id="5410587">)</span><span class="op" id="5410588">;</span>&nbsp;<span class="ident" id="5410590">err</span>&nbsp;<span class="op" id="5410594">!=</span>&nbsp;<span class="ident" id="5410597">nil</span>&nbsp;<span class="op" id="5410601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410607">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410626">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410681">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410738">if</span>&nbsp;<span class="op" id="5410741">!</span><span class="ident" id="5410742">w</span><span class="op" id="5410743">.</span><span class="ident" id="5410744">fieldNeedsQuotes</span><span class="op" id="5410760">(</span><span class="ident" id="5410761">field</span><span class="op" id="5410766">)</span>&nbsp;<span class="op" id="5410768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410773">if</span>&nbsp;<span class="ident" id="5410776">_</span><span class="op" id="5410777">,</span>&nbsp;<span class="ident" id="5410779">err</span>&nbsp;<span class="op" id="5410783">=</span>&nbsp;<span class="ident" id="5410785">w</span><span class="op" id="5410786">.</span><span class="ident" id="5410787">w</span><span class="op" id="5410788">.</span><span class="ident" id="5410789">WriteString</span><span class="op" id="5410800">(</span><span class="ident" id="5410801">field</span><span class="op" id="5410806">)</span><span class="op" id="5410807">;</span>&nbsp;<span class="ident" id="5410809">err</span>&nbsp;<span class="op" id="5410813">!=</span>&nbsp;<span class="ident" id="5410816">nil</span>&nbsp;<span class="op" id="5410820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410841">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410856">if</span>&nbsp;<span class="ident" id="5410859">err</span>&nbsp;<span class="op" id="5410863">=</span>&nbsp;<span class="ident" id="5410865">w</span><span class="op" id="5410866">.</span><span class="ident" id="5410867">w</span><span class="op" id="5410868">.</span><span class="ident" id="5410869">WriteByte</span><span class="op" id="5410878">(</span><span class="string" id="5410879">&#39;&#34;&#39;</span><span class="op" id="5410882">)</span><span class="op" id="5410883">;</span>&nbsp;<span class="ident" id="5410885">err</span>&nbsp;<span class="op" id="5410889">!=</span>&nbsp;<span class="ident" id="5410892">nil</span>&nbsp;<span class="op" id="5410896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410915">for</span>&nbsp;<span class="ident" id="5410919">_</span><span class="op" id="5410920">,</span>&nbsp;<span class="ident" id="5410922">r1</span>&nbsp;<span class="op" id="5410925">:=</span>&nbsp;<span class="keyword" id="5410928">range</span>&nbsp;<span class="ident" id="5410934">field</span>&nbsp;<span class="op" id="5410940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410945">switch</span>&nbsp;<span class="ident" id="5410952">r1</span>&nbsp;<span class="op" id="5410955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410960">case</span>&nbsp;<span class="string" id="5410965">&#39;&#34;&#39;</span><span class="op" id="5410968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410974">_</span><span class="op" id="5410975">,</span>&nbsp;<span class="ident" id="5410977">err</span>&nbsp;<span class="op" id="5410981">=</span>&nbsp;<span class="ident" id="5410983">w</span><span class="op" id="5410984">.</span><span class="ident" id="5410985">w</span><span class="op" id="5410986">.</span><span class="ident" id="5410987">WriteString</span><span class="op" id="5410998">(</span><span class="string" id="5410999">`&#34;&#34;`</span><span class="op" id="5411003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411008">case</span>&nbsp;<span class="string" id="5411013">&#39;\r&#39;</span><span class="op" id="5411017">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411023">if</span>&nbsp;<span class="op" id="5411026">!</span><span class="ident" id="5411027">w</span><span class="op" id="5411028">.</span><span class="ident" id="5411029">UseCRLF</span>&nbsp;<span class="op" id="5411037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411044">err</span>&nbsp;<span class="op" id="5411048">=</span>&nbsp;<span class="ident" id="5411050">w</span><span class="op" id="5411051">.</span><span class="ident" id="5411052">w</span><span class="op" id="5411053">.</span><span class="ident" id="5411054">WriteByte</span><span class="op" id="5411063">(</span><span class="string" id="5411064">&#39;\r&#39;</span><span class="op" id="5411068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411079">case</span>&nbsp;<span class="string" id="5411084">&#39;\n&#39;</span><span class="op" id="5411088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411094">if</span>&nbsp;<span class="ident" id="5411097">w</span><span class="op" id="5411098">.</span><span class="ident" id="5411099">UseCRLF</span>&nbsp;<span class="op" id="5411107">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411114">_</span><span class="op" id="5411115">,</span>&nbsp;<span class="ident" id="5411117">err</span>&nbsp;<span class="op" id="5411121">=</span>&nbsp;<span class="ident" id="5411123">w</span><span class="op" id="5411124">.</span><span class="ident" id="5411125">w</span><span class="op" id="5411126">.</span><span class="ident" id="5411127">WriteString</span><span class="op" id="5411138">(</span><span class="string" id="5411139">&#34;\r\n&#34;</span><span class="op" id="5411145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411151">}</span>&nbsp;<span class="keyword" id="5411153">else</span>&nbsp;<span class="op" id="5411158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411165">err</span>&nbsp;<span class="op" id="5411169">=</span>&nbsp;<span class="ident" id="5411171">w</span><span class="op" id="5411172">.</span><span class="ident" id="5411173">w</span><span class="op" id="5411174">.</span><span class="ident" id="5411175">WriteByte</span><span class="op" id="5411184">(</span><span class="string" id="5411185">&#39;\n&#39;</span><span class="op" id="5411189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411200">default</span><span class="op" id="5411207">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411213">_</span><span class="op" id="5411214">,</span>&nbsp;<span class="ident" id="5411216">err</span>&nbsp;<span class="op" id="5411220">=</span>&nbsp;<span class="ident" id="5411222">w</span><span class="op" id="5411223">.</span><span class="ident" id="5411224">w</span><span class="op" id="5411225">.</span><span class="ident" id="5411226">WriteRune</span><span class="op" id="5411235">(</span><span class="ident" id="5411236">r1</span><span class="op" id="5411238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411248">if</span>&nbsp;<span class="ident" id="5411251">err</span>&nbsp;<span class="op" id="5411255">!=</span>&nbsp;<span class="ident" id="5411258">nil</span>&nbsp;<span class="op" id="5411262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411278">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411287">if</span>&nbsp;<span class="ident" id="5411290">err</span>&nbsp;<span class="op" id="5411294">=</span>&nbsp;<span class="ident" id="5411296">w</span><span class="op" id="5411297">.</span><span class="ident" id="5411298">w</span><span class="op" id="5411299">.</span><span class="ident" id="5411300">WriteByte</span><span class="op" id="5411309">(</span><span class="string" id="5411310">&#39;&#34;&#39;</span><span class="op" id="5411313">)</span><span class="op" id="5411314">;</span>&nbsp;<span class="ident" id="5411316">err</span>&nbsp;<span class="op" id="5411320">!=</span>&nbsp;<span class="ident" id="5411323">nil</span>&nbsp;<span class="op" id="5411327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411332">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411341">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411347">if</span>&nbsp;<span class="ident" id="5411350">w</span><span class="op" id="5411351">.</span><span class="ident" id="5411352">UseCRLF</span>&nbsp;<span class="op" id="5411360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411364">_</span><span class="op" id="5411365">,</span>&nbsp;<span class="ident" id="5411367">err</span>&nbsp;<span class="op" id="5411371">=</span>&nbsp;<span class="ident" id="5411373">w</span><span class="op" id="5411374">.</span><span class="ident" id="5411375">w</span><span class="op" id="5411376">.</span><span class="ident" id="5411377">WriteString</span><span class="op" id="5411388">(</span><span class="string" id="5411389">&#34;\r\n&#34;</span><span class="op" id="5411395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411398">}</span>&nbsp;<span class="keyword" id="5411400">else</span>&nbsp;<span class="op" id="5411405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411409">err</span>&nbsp;<span class="op" id="5411413">=</span>&nbsp;<span class="ident" id="5411415">w</span><span class="op" id="5411416">.</span><span class="ident" id="5411417">w</span><span class="op" id="5411418">.</span><span class="ident" id="5411419">WriteByte</span><span class="op" id="5411428">(</span><span class="string" id="5411429">&#39;\n&#39;</span><span class="op" id="5411433">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411439">return</span><br>
<span class="lineno"></span><span class="op" id="5411446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5411449">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="5411512">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="5411575">func</span>&nbsp;<span class="op" id="5411580">(</span><span class="ident" id="5411581">w</span>&nbsp;<span class="op" id="5411583">*</span><span class="ident" id="5411584">Writer</span><span class="op" id="5411590">)</span>&nbsp;<span class="ident" id="5411592">Flush</span><span class="op" id="5411597">(</span><span class="op" id="5411598">)</span>&nbsp;<span class="op" id="5411600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411603">w</span><span class="op" id="5411604">.</span><span class="ident" id="5411605">w</span><span class="op" id="5411606">.</span><span class="ident" id="5411607">Flush</span><span class="op" id="5411612">(</span><span class="op" id="5411613">)</span><br>
<span class="lineno"></span><span class="op" id="5411615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5411618">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5411697">func</span>&nbsp;<span class="op" id="5411702">(</span><span class="ident" id="5411703">w</span>&nbsp;<span class="op" id="5411705">*</span><span class="ident" id="5411706">Writer</span><span class="op" id="5411712">)</span>&nbsp;<span class="ident" id="5411714">Error</span><span class="op" id="5411719">(</span><span class="op" id="5411720">)</span>&nbsp;<span class="builtintype" id="5411722">error</span>&nbsp;<span class="op" id="5411728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411731">_</span><span class="op" id="5411732">,</span>&nbsp;<span class="ident" id="5411734">err</span>&nbsp;<span class="op" id="5411738">:=</span>&nbsp;<span class="ident" id="5411741">w</span><span class="op" id="5411742">.</span><span class="ident" id="5411743">w</span><span class="op" id="5411744">.</span><span class="ident" id="5411745">Write</span><span class="op" id="5411750">(</span><span class="ident" id="5411751">nil</span><span class="op" id="5411754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411757">return</span>&nbsp;<span class="ident" id="5411764">err</span><br>
<span class="lineno"></span><span class="op" id="5411768">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5411771">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5411850">func</span>&nbsp;<span class="op" id="5411855">(</span><span class="ident" id="5411856">w</span>&nbsp;<span class="op" id="5411858">*</span><span class="ident" id="5411859">Writer</span><span class="op" id="5411865">)</span>&nbsp;<span class="ident" id="5411867">WriteAll</span><span class="op" id="5411875">(</span><span class="ident" id="5411876">records</span>&nbsp;<span class="op" id="5411884">[</span><span class="op" id="5411885">]</span><span class="op" id="5411886">[</span><span class="op" id="5411887">]</span><span class="builtintype" id="5411888">string</span><span class="op" id="5411894">)</span>&nbsp;<span class="op" id="5411896">(</span><span class="ident" id="5411897">err</span>&nbsp;<span class="builtintype" id="5411901">error</span><span class="op" id="5411906">)</span>&nbsp;<span class="op" id="5411908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411911">for</span>&nbsp;<span class="ident" id="5411915">_</span><span class="op" id="5411916">,</span>&nbsp;<span class="ident" id="5411918">record</span>&nbsp;<span class="op" id="5411925">:=</span>&nbsp;<span class="keyword" id="5411928">range</span>&nbsp;<span class="ident" id="5411934">records</span>&nbsp;<span class="op" id="5411942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411946">err</span>&nbsp;<span class="op" id="5411950">=</span>&nbsp;<span class="ident" id="5411952">w</span><span class="op" id="5411953">.</span><span class="ident" id="5411954">Write</span><span class="op" id="5411959">(</span><span class="ident" id="5411960">record</span><span class="op" id="5411966">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411970">if</span>&nbsp;<span class="ident" id="5411973">err</span>&nbsp;<span class="op" id="5411977">!=</span>&nbsp;<span class="ident" id="5411980">nil</span>&nbsp;<span class="op" id="5411984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411989">return</span>&nbsp;<span class="ident" id="5411996">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412008">return</span>&nbsp;<span class="ident" id="5412015">w</span><span class="op" id="5412016">.</span><span class="ident" id="5412017">w</span><span class="op" id="5412018">.</span><span class="ident" id="5412019">Flush</span><span class="op" id="5412024">(</span><span class="op" id="5412025">)</span><br>
<span class="lineno">115</span><span class="op" id="5412027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412030">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="5412104">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5412164">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="5412227">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="5412300">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="5412376">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5412449">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5412521">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="5412590">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="5412645">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="5412720">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="5412760">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="5412815">func</span>&nbsp;<span class="op" id="5412820">(</span><span class="ident" id="5412821">w</span>&nbsp;<span class="op" id="5412823">*</span><span class="ident" id="5412824">Writer</span><span class="op" id="5412830">)</span>&nbsp;<span class="ident" id="5412832">fieldNeedsQuotes</span><span class="op" id="5412848">(</span><span class="ident" id="5412849">field</span>&nbsp;<span class="builtintype" id="5412855">string</span><span class="op" id="5412861">)</span>&nbsp;<span class="builtintype" id="5412863">bool</span>&nbsp;<span class="op" id="5412868">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412871">if</span>&nbsp;<span class="ident" id="5412874">field</span>&nbsp;<span class="op" id="5412880">==</span>&nbsp;<span class="string" id="5412883">&#34;&#34;</span>&nbsp;<span class="op" id="5412886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412890">return</span>&nbsp;<span class="builtintype" id="5412897">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412907">if</span>&nbsp;<span class="ident" id="5412910">field</span>&nbsp;<span class="op" id="5412916">==</span>&nbsp;<span class="string" id="5412919">`\.`</span>&nbsp;<span class="op" id="5412924">||</span>&nbsp;<span class="ident" id="5412927">strings</span><span class="op" id="5412934">.</span><span class="ident" id="5412935">IndexRune</span><span class="op" id="5412944">(</span><span class="ident" id="5412945">field</span><span class="op" id="5412950">,</span>&nbsp;<span class="ident" id="5412952">w</span><span class="op" id="5412953">.</span><span class="ident" id="5412954">Comma</span><span class="op" id="5412959">)</span>&nbsp;<span class="op" id="5412961">&gt;=</span>&nbsp;<span class="num" id="5412964">0</span>&nbsp;<span class="op" id="5412966">||</span>&nbsp;<span class="ident" id="5412969">strings</span><span class="op" id="5412976">.</span><span class="ident" id="5412977">IndexAny</span><span class="op" id="5412985">(</span><span class="ident" id="5412986">field</span><span class="op" id="5412991">,</span>&nbsp;<span class="string" id="5412993">&#34;\&#34;\r\n&#34;</span><span class="op" id="5413001">)</span>&nbsp;<span class="op" id="5413003">&gt;=</span>&nbsp;<span class="num" id="5413006">0</span>&nbsp;<span class="op" id="5413008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413012">return</span>&nbsp;<span class="builtintype" id="5413019">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413029">r1</span><span class="op" id="5413031">,</span>&nbsp;<span class="ident" id="5413033">_</span>&nbsp;<span class="op" id="5413035">:=</span>&nbsp;<span class="ident" id="5413038">utf8</span><span class="op" id="5413042">.</span><span class="ident" id="5413043">DecodeRuneInString</span><span class="op" id="5413061">(</span><span class="ident" id="5413062">field</span><span class="op" id="5413067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413070">return</span>&nbsp;<span class="ident" id="5413077">unicode</span><span class="op" id="5413084">.</span><span class="ident" id="5413085">IsSpace</span><span class="op" id="5413092">(</span><span class="ident" id="5413093">r1</span><span class="op" id="5413095">)</span><br>
<span class="lineno"></span><span class="op" id="5413097">}</span>
</div>
</body>
</html>
