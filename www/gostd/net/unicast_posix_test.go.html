<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8522264">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8522320">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8522374">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8522425">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8522443">package</span>&nbsp;<span class="ident" id="8522451">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8522456">import</span>&nbsp;<span class="op" id="8522463">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8522466">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8522477">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8522488">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8522498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8522501">var</span>&nbsp;<span class="ident" id="8522505">listenerTests</span>&nbsp;<span class="op" id="8522519">=</span>&nbsp;<span class="op" id="8522521">[</span><span class="op" id="8522522">]</span><span class="keyword" id="8522523">struct</span>&nbsp;<span class="op" id="8522530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8522533">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8522542">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8522550">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8522559">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8522567">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8522576">bool</span>&nbsp;<span class="comment" id="8522581">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8522622">wildcard</span>&nbsp;<span class="builtintype" id="8522631">bool</span>&nbsp;<span class="comment" id="8522636">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="8522666">}</span><span class="op" id="8522667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522670">{</span><span class="ident" id="8522671">net</span><span class="op" id="8522674">:</span>&nbsp;<span class="string" id="8522676">&#34;tcp&#34;</span><span class="op" id="8522681">,</span>&nbsp;<span class="ident" id="8522683">laddr</span><span class="op" id="8522688">:</span>&nbsp;<span class="string" id="8522690">&#34;&#34;</span><span class="op" id="8522692">,</span>&nbsp;<span class="ident" id="8522694">wildcard</span><span class="op" id="8522702">:</span>&nbsp;<span class="builtintype" id="8522704">true</span><span class="op" id="8522708">}</span><span class="op" id="8522709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522712">{</span><span class="ident" id="8522713">net</span><span class="op" id="8522716">:</span>&nbsp;<span class="string" id="8522718">&#34;tcp&#34;</span><span class="op" id="8522723">,</span>&nbsp;<span class="ident" id="8522725">laddr</span><span class="op" id="8522730">:</span>&nbsp;<span class="string" id="8522732">&#34;0.0.0.0&#34;</span><span class="op" id="8522741">,</span>&nbsp;<span class="ident" id="8522743">wildcard</span><span class="op" id="8522751">:</span>&nbsp;<span class="builtintype" id="8522753">true</span><span class="op" id="8522757">}</span><span class="op" id="8522758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522761">{</span><span class="ident" id="8522762">net</span><span class="op" id="8522765">:</span>&nbsp;<span class="string" id="8522767">&#34;tcp&#34;</span><span class="op" id="8522772">,</span>&nbsp;<span class="ident" id="8522774">laddr</span><span class="op" id="8522779">:</span>&nbsp;<span class="string" id="8522781">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8522799">,</span>&nbsp;<span class="ident" id="8522801">wildcard</span><span class="op" id="8522809">:</span>&nbsp;<span class="builtintype" id="8522811">true</span><span class="op" id="8522815">}</span><span class="op" id="8522816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522819">{</span><span class="ident" id="8522820">net</span><span class="op" id="8522823">:</span>&nbsp;<span class="string" id="8522825">&#34;tcp&#34;</span><span class="op" id="8522830">,</span>&nbsp;<span class="ident" id="8522832">laddr</span><span class="op" id="8522837">:</span>&nbsp;<span class="string" id="8522839">&#34;[::]&#34;</span><span class="op" id="8522845">,</span>&nbsp;<span class="ident" id="8522847">ipv6</span><span class="op" id="8522851">:</span>&nbsp;<span class="builtintype" id="8522853">true</span><span class="op" id="8522857">,</span>&nbsp;<span class="ident" id="8522859">wildcard</span><span class="op" id="8522867">:</span>&nbsp;<span class="builtintype" id="8522869">true</span><span class="op" id="8522873">}</span><span class="op" id="8522874">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522878">{</span><span class="ident" id="8522879">net</span><span class="op" id="8522882">:</span>&nbsp;<span class="string" id="8522884">&#34;tcp&#34;</span><span class="op" id="8522889">,</span>&nbsp;<span class="ident" id="8522891">laddr</span><span class="op" id="8522896">:</span>&nbsp;<span class="string" id="8522898">&#34;127.0.0.1&#34;</span><span class="op" id="8522909">}</span><span class="op" id="8522910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522913">{</span><span class="ident" id="8522914">net</span><span class="op" id="8522917">:</span>&nbsp;<span class="string" id="8522919">&#34;tcp&#34;</span><span class="op" id="8522924">,</span>&nbsp;<span class="ident" id="8522926">laddr</span><span class="op" id="8522931">:</span>&nbsp;<span class="string" id="8522933">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8522953">}</span><span class="op" id="8522954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8522957">{</span><span class="ident" id="8522958">net</span><span class="op" id="8522961">:</span>&nbsp;<span class="string" id="8522963">&#34;tcp&#34;</span><span class="op" id="8522968">,</span>&nbsp;<span class="ident" id="8522970">laddr</span><span class="op" id="8522975">:</span>&nbsp;<span class="string" id="8522977">&#34;[::1]&#34;</span><span class="op" id="8522984">,</span>&nbsp;<span class="ident" id="8522986">ipv6</span><span class="op" id="8522990">:</span>&nbsp;<span class="builtintype" id="8522992">true</span><span class="op" id="8522996">}</span><span class="op" id="8522997">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523001">{</span><span class="ident" id="8523002">net</span><span class="op" id="8523005">:</span>&nbsp;<span class="string" id="8523007">&#34;tcp4&#34;</span><span class="op" id="8523013">,</span>&nbsp;<span class="ident" id="8523015">laddr</span><span class="op" id="8523020">:</span>&nbsp;<span class="string" id="8523022">&#34;&#34;</span><span class="op" id="8523024">,</span>&nbsp;<span class="ident" id="8523026">wildcard</span><span class="op" id="8523034">:</span>&nbsp;<span class="builtintype" id="8523036">true</span><span class="op" id="8523040">}</span><span class="op" id="8523041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523044">{</span><span class="ident" id="8523045">net</span><span class="op" id="8523048">:</span>&nbsp;<span class="string" id="8523050">&#34;tcp4&#34;</span><span class="op" id="8523056">,</span>&nbsp;<span class="ident" id="8523058">laddr</span><span class="op" id="8523063">:</span>&nbsp;<span class="string" id="8523065">&#34;0.0.0.0&#34;</span><span class="op" id="8523074">,</span>&nbsp;<span class="ident" id="8523076">wildcard</span><span class="op" id="8523084">:</span>&nbsp;<span class="builtintype" id="8523086">true</span><span class="op" id="8523090">}</span><span class="op" id="8523091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523094">{</span><span class="ident" id="8523095">net</span><span class="op" id="8523098">:</span>&nbsp;<span class="string" id="8523100">&#34;tcp4&#34;</span><span class="op" id="8523106">,</span>&nbsp;<span class="ident" id="8523108">laddr</span><span class="op" id="8523113">:</span>&nbsp;<span class="string" id="8523115">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8523133">,</span>&nbsp;<span class="ident" id="8523135">wildcard</span><span class="op" id="8523143">:</span>&nbsp;<span class="builtintype" id="8523145">true</span><span class="op" id="8523149">}</span><span class="op" id="8523150">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523154">{</span><span class="ident" id="8523155">net</span><span class="op" id="8523158">:</span>&nbsp;<span class="string" id="8523160">&#34;tcp4&#34;</span><span class="op" id="8523166">,</span>&nbsp;<span class="ident" id="8523168">laddr</span><span class="op" id="8523173">:</span>&nbsp;<span class="string" id="8523175">&#34;127.0.0.1&#34;</span><span class="op" id="8523186">}</span><span class="op" id="8523187">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523190">{</span><span class="ident" id="8523191">net</span><span class="op" id="8523194">:</span>&nbsp;<span class="string" id="8523196">&#34;tcp4&#34;</span><span class="op" id="8523202">,</span>&nbsp;<span class="ident" id="8523204">laddr</span><span class="op" id="8523209">:</span>&nbsp;<span class="string" id="8523211">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8523231">}</span><span class="op" id="8523232">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523236">{</span><span class="ident" id="8523237">net</span><span class="op" id="8523240">:</span>&nbsp;<span class="string" id="8523242">&#34;tcp6&#34;</span><span class="op" id="8523248">,</span>&nbsp;<span class="ident" id="8523250">laddr</span><span class="op" id="8523255">:</span>&nbsp;<span class="string" id="8523257">&#34;&#34;</span><span class="op" id="8523259">,</span>&nbsp;<span class="ident" id="8523261">ipv6</span><span class="op" id="8523265">:</span>&nbsp;<span class="builtintype" id="8523267">true</span><span class="op" id="8523271">,</span>&nbsp;<span class="ident" id="8523273">wildcard</span><span class="op" id="8523281">:</span>&nbsp;<span class="builtintype" id="8523283">true</span><span class="op" id="8523287">}</span><span class="op" id="8523288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523291">{</span><span class="ident" id="8523292">net</span><span class="op" id="8523295">:</span>&nbsp;<span class="string" id="8523297">&#34;tcp6&#34;</span><span class="op" id="8523303">,</span>&nbsp;<span class="ident" id="8523305">laddr</span><span class="op" id="8523310">:</span>&nbsp;<span class="string" id="8523312">&#34;[::]&#34;</span><span class="op" id="8523318">,</span>&nbsp;<span class="ident" id="8523320">ipv6</span><span class="op" id="8523324">:</span>&nbsp;<span class="builtintype" id="8523326">true</span><span class="op" id="8523330">,</span>&nbsp;<span class="ident" id="8523332">wildcard</span><span class="op" id="8523340">:</span>&nbsp;<span class="builtintype" id="8523342">true</span><span class="op" id="8523346">}</span><span class="op" id="8523347">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523351">{</span><span class="ident" id="8523352">net</span><span class="op" id="8523355">:</span>&nbsp;<span class="string" id="8523357">&#34;tcp6&#34;</span><span class="op" id="8523363">,</span>&nbsp;<span class="ident" id="8523365">laddr</span><span class="op" id="8523370">:</span>&nbsp;<span class="string" id="8523372">&#34;[::1]&#34;</span><span class="op" id="8523379">,</span>&nbsp;<span class="ident" id="8523381">ipv6</span><span class="op" id="8523385">:</span>&nbsp;<span class="builtintype" id="8523387">true</span><span class="op" id="8523391">}</span><span class="op" id="8523392">,</span><br>
<span class="lineno"></span><span class="op" id="8523394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8523397">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8523462">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="8523527">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8523541">func</span>&nbsp;<span class="ident" id="8523546">TestTCPListener</span><span class="op" id="8523561">(</span><span class="ident" id="8523562">t</span>&nbsp;<span class="op" id="8523564">*</span><span class="ident" id="8523565">testing</span><span class="op" id="8523572">.</span><span class="ident" id="8523573">T</span><span class="op" id="8523574">)</span>&nbsp;<span class="op" id="8523576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523579">switch</span>&nbsp;<span class="ident" id="8523586">runtime</span><span class="op" id="8523593">.</span><span class="ident" id="8523594">GOOS</span>&nbsp;<span class="op" id="8523599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523602">case</span>&nbsp;<span class="string" id="8523607">&#34;plan9&#34;</span><span class="op" id="8523614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8523618">t</span><span class="op" id="8523619">.</span><span class="ident" id="8523620">Skipf</span><span class="op" id="8523625">(</span><span class="string" id="8523626">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8523647">,</span>&nbsp;<span class="ident" id="8523649">runtime</span><span class="op" id="8523656">.</span><span class="ident" id="8523657">GOOS</span><span class="op" id="8523661">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523668">for</span>&nbsp;<span class="ident" id="8523672">_</span><span class="op" id="8523673">,</span>&nbsp;<span class="ident" id="8523675">tt</span>&nbsp;<span class="op" id="8523678">:=</span>&nbsp;<span class="keyword" id="8523681">range</span>&nbsp;<span class="ident" id="8523687">listenerTests</span>&nbsp;<span class="op" id="8523701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523705">if</span>&nbsp;<span class="ident" id="8523708">tt</span><span class="op" id="8523710">.</span><span class="ident" id="8523711">wildcard</span>&nbsp;<span class="op" id="8523720">&amp;&amp;</span>&nbsp;<span class="op" id="8523723">(</span><span class="ident" id="8523724">testing</span><span class="op" id="8523731">.</span><span class="ident" id="8523732">Short</span><span class="op" id="8523737">(</span><span class="op" id="8523738">)</span>&nbsp;<span class="op" id="8523740">||</span>&nbsp;<span class="op" id="8523743">!</span><span class="op" id="8523744">*</span><span class="ident" id="8523745">testExternal</span><span class="op" id="8523757">)</span>&nbsp;<span class="op" id="8523759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523764">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523779">if</span>&nbsp;<span class="ident" id="8523782">tt</span><span class="op" id="8523784">.</span><span class="ident" id="8523785">ipv6</span>&nbsp;<span class="op" id="8523790">&amp;&amp;</span>&nbsp;<span class="op" id="8523793">!</span><span class="ident" id="8523794">supportsIPv6</span>&nbsp;<span class="op" id="8523807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8523812">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8523823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8523827">l1</span><span class="op" id="8523829">,</span>&nbsp;<span class="ident" id="8523831">port</span>&nbsp;<span class="op" id="8523836">:=</span>&nbsp;<span class="ident" id="8523839">usableListenPort</span><span class="op" id="8523855">(</span><span class="ident" id="8523856">t</span><span class="op" id="8523857">,</span>&nbsp;<span class="ident" id="8523859">tt</span><span class="op" id="8523861">.</span><span class="ident" id="8523862">net</span><span class="op" id="8523865">,</span>&nbsp;<span class="ident" id="8523867">tt</span><span class="op" id="8523869">.</span><span class="ident" id="8523870">laddr</span><span class="op" id="8523875">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8523879">checkFirstListener</span><span class="op" id="8523897">(</span><span class="ident" id="8523898">t</span><span class="op" id="8523899">,</span>&nbsp;<span class="ident" id="8523901">tt</span><span class="op" id="8523903">.</span><span class="ident" id="8523904">net</span><span class="op" id="8523907">,</span>&nbsp;<span class="ident" id="8523909">tt</span><span class="op" id="8523911">.</span><span class="ident" id="8523912">laddr</span><span class="op" id="8523917">+</span><span class="string" id="8523918">&#34;:&#34;</span><span class="op" id="8523921">+</span><span class="ident" id="8523922">port</span><span class="op" id="8523926">,</span>&nbsp;<span class="ident" id="8523928">l1</span><span class="op" id="8523930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8523934">l2</span><span class="op" id="8523936">,</span>&nbsp;<span class="ident" id="8523938">err</span>&nbsp;<span class="op" id="8523942">:=</span>&nbsp;<span class="ident" id="8523945">Listen</span><span class="op" id="8523951">(</span><span class="ident" id="8523952">tt</span><span class="op" id="8523954">.</span><span class="ident" id="8523955">net</span><span class="op" id="8523958">,</span>&nbsp;<span class="ident" id="8523960">tt</span><span class="op" id="8523962">.</span><span class="ident" id="8523963">laddr</span><span class="op" id="8523968">+</span><span class="string" id="8523969">&#34;:&#34;</span><span class="op" id="8523972">+</span><span class="ident" id="8523973">port</span><span class="op" id="8523977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8523981">checkSecondListener</span><span class="op" id="8524000">(</span><span class="ident" id="8524001">t</span><span class="op" id="8524002">,</span>&nbsp;<span class="ident" id="8524004">tt</span><span class="op" id="8524006">.</span><span class="ident" id="8524007">net</span><span class="op" id="8524010">,</span>&nbsp;<span class="ident" id="8524012">tt</span><span class="op" id="8524014">.</span><span class="ident" id="8524015">laddr</span><span class="op" id="8524020">+</span><span class="string" id="8524021">&#34;:&#34;</span><span class="op" id="8524024">+</span><span class="ident" id="8524025">port</span><span class="op" id="8524029">,</span>&nbsp;<span class="ident" id="8524031">err</span><span class="op" id="8524034">,</span>&nbsp;<span class="ident" id="8524036">l2</span><span class="op" id="8524038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524042">l1</span><span class="op" id="8524044">.</span><span class="ident" id="8524045">Close</span><span class="op" id="8524050">(</span><span class="op" id="8524051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524054">}</span><br>
<span class="lineno">65</span><span class="op" id="8524056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8524059">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8524124">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8524189">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="8524203">func</span>&nbsp;<span class="ident" id="8524208">TestUDPListener</span><span class="op" id="8524223">(</span><span class="ident" id="8524224">t</span>&nbsp;<span class="op" id="8524226">*</span><span class="ident" id="8524227">testing</span><span class="op" id="8524234">.</span><span class="ident" id="8524235">T</span><span class="op" id="8524236">)</span>&nbsp;<span class="op" id="8524238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524241">switch</span>&nbsp;<span class="ident" id="8524248">runtime</span><span class="op" id="8524255">.</span><span class="ident" id="8524256">GOOS</span>&nbsp;<span class="op" id="8524261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524264">case</span>&nbsp;<span class="string" id="8524269">&#34;plan9&#34;</span><span class="op" id="8524276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524280">t</span><span class="op" id="8524281">.</span><span class="ident" id="8524282">Skipf</span><span class="op" id="8524287">(</span><span class="string" id="8524288">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8524309">,</span>&nbsp;<span class="ident" id="8524311">runtime</span><span class="op" id="8524318">.</span><span class="ident" id="8524319">GOOS</span><span class="op" id="8524323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524326">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524330">toudpnet</span>&nbsp;<span class="op" id="8524339">:=</span>&nbsp;<span class="keyword" id="8524342">func</span><span class="op" id="8524346">(</span><span class="ident" id="8524347">net</span>&nbsp;<span class="builtintype" id="8524351">string</span><span class="op" id="8524357">)</span>&nbsp;<span class="builtintype" id="8524359">string</span>&nbsp;<span class="op" id="8524366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524370">switch</span>&nbsp;<span class="ident" id="8524377">net</span>&nbsp;<span class="op" id="8524381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524385">case</span>&nbsp;<span class="string" id="8524390">&#34;tcp&#34;</span><span class="op" id="8524395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524400">return</span>&nbsp;<span class="string" id="8524407">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524415">case</span>&nbsp;<span class="string" id="8524420">&#34;tcp4&#34;</span><span class="op" id="8524426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524431">return</span>&nbsp;<span class="string" id="8524438">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524447">case</span>&nbsp;<span class="string" id="8524452">&#34;tcp6&#34;</span><span class="op" id="8524458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524463">return</span>&nbsp;<span class="string" id="8524470">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524479">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524483">return</span>&nbsp;<span class="string" id="8524490">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524503">for</span>&nbsp;<span class="ident" id="8524507">_</span><span class="op" id="8524508">,</span>&nbsp;<span class="ident" id="8524510">tt</span>&nbsp;<span class="op" id="8524513">:=</span>&nbsp;<span class="keyword" id="8524516">range</span>&nbsp;<span class="ident" id="8524522">listenerTests</span>&nbsp;<span class="op" id="8524536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524540">if</span>&nbsp;<span class="ident" id="8524543">tt</span><span class="op" id="8524545">.</span><span class="ident" id="8524546">wildcard</span>&nbsp;<span class="op" id="8524555">&amp;&amp;</span>&nbsp;<span class="op" id="8524558">(</span><span class="ident" id="8524559">testing</span><span class="op" id="8524566">.</span><span class="ident" id="8524567">Short</span><span class="op" id="8524572">(</span><span class="op" id="8524573">)</span>&nbsp;<span class="op" id="8524575">||</span>&nbsp;<span class="op" id="8524578">!</span><span class="op" id="8524579">*</span><span class="ident" id="8524580">testExternal</span><span class="op" id="8524592">)</span>&nbsp;<span class="op" id="8524594">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524599">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524614">if</span>&nbsp;<span class="ident" id="8524617">tt</span><span class="op" id="8524619">.</span><span class="ident" id="8524620">ipv6</span>&nbsp;<span class="op" id="8524625">&amp;&amp;</span>&nbsp;<span class="op" id="8524628">!</span><span class="ident" id="8524629">supportsIPv6</span>&nbsp;<span class="op" id="8524642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8524647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524658">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524662">tt</span><span class="op" id="8524664">.</span><span class="ident" id="8524665">net</span>&nbsp;<span class="op" id="8524669">=</span>&nbsp;<span class="ident" id="8524671">toudpnet</span><span class="op" id="8524679">(</span><span class="ident" id="8524680">tt</span><span class="op" id="8524682">.</span><span class="ident" id="8524683">net</span><span class="op" id="8524686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524690">l1</span><span class="op" id="8524692">,</span>&nbsp;<span class="ident" id="8524694">port</span>&nbsp;<span class="op" id="8524699">:=</span>&nbsp;<span class="ident" id="8524702">usableListenPacketPort</span><span class="op" id="8524724">(</span><span class="ident" id="8524725">t</span><span class="op" id="8524726">,</span>&nbsp;<span class="ident" id="8524728">tt</span><span class="op" id="8524730">.</span><span class="ident" id="8524731">net</span><span class="op" id="8524734">,</span>&nbsp;<span class="ident" id="8524736">tt</span><span class="op" id="8524738">.</span><span class="ident" id="8524739">laddr</span><span class="op" id="8524744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524748">checkFirstListener</span><span class="op" id="8524766">(</span><span class="ident" id="8524767">t</span><span class="op" id="8524768">,</span>&nbsp;<span class="ident" id="8524770">tt</span><span class="op" id="8524772">.</span><span class="ident" id="8524773">net</span><span class="op" id="8524776">,</span>&nbsp;<span class="ident" id="8524778">tt</span><span class="op" id="8524780">.</span><span class="ident" id="8524781">laddr</span><span class="op" id="8524786">+</span><span class="string" id="8524787">&#34;:&#34;</span><span class="op" id="8524790">+</span><span class="ident" id="8524791">port</span><span class="op" id="8524795">,</span>&nbsp;<span class="ident" id="8524797">l1</span><span class="op" id="8524799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524803">l2</span><span class="op" id="8524805">,</span>&nbsp;<span class="ident" id="8524807">err</span>&nbsp;<span class="op" id="8524811">:=</span>&nbsp;<span class="ident" id="8524814">ListenPacket</span><span class="op" id="8524826">(</span><span class="ident" id="8524827">tt</span><span class="op" id="8524829">.</span><span class="ident" id="8524830">net</span><span class="op" id="8524833">,</span>&nbsp;<span class="ident" id="8524835">tt</span><span class="op" id="8524837">.</span><span class="ident" id="8524838">laddr</span><span class="op" id="8524843">+</span><span class="string" id="8524844">&#34;:&#34;</span><span class="op" id="8524847">+</span><span class="ident" id="8524848">port</span><span class="op" id="8524852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524856">checkSecondListener</span><span class="op" id="8524875">(</span><span class="ident" id="8524876">t</span><span class="op" id="8524877">,</span>&nbsp;<span class="ident" id="8524879">tt</span><span class="op" id="8524881">.</span><span class="ident" id="8524882">net</span><span class="op" id="8524885">,</span>&nbsp;<span class="ident" id="8524887">tt</span><span class="op" id="8524889">.</span><span class="ident" id="8524890">laddr</span><span class="op" id="8524895">+</span><span class="string" id="8524896">&#34;:&#34;</span><span class="op" id="8524899">+</span><span class="ident" id="8524900">port</span><span class="op" id="8524904">,</span>&nbsp;<span class="ident" id="8524906">err</span><span class="op" id="8524909">,</span>&nbsp;<span class="ident" id="8524911">l2</span><span class="op" id="8524913">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524917">l1</span><span class="op" id="8524919">.</span><span class="ident" id="8524920">Close</span><span class="op" id="8524925">(</span><span class="op" id="8524926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8524929">}</span><br>
<span class="lineno"></span><span class="op" id="8524931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8524934">var</span>&nbsp;<span class="ident" id="8524938">dualStackListenerTests</span>&nbsp;<span class="op" id="8524961">=</span>&nbsp;<span class="op" id="8524963">[</span><span class="op" id="8524964">]</span><span class="keyword" id="8524965">struct</span>&nbsp;<span class="op" id="8524972">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8524975">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524984">string</span>&nbsp;<span class="comment" id="8524991">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525010">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8525019">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525027">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8525036">string</span>&nbsp;<span class="comment" id="8525043">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525063">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8525072">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525080">wildcard</span>&nbsp;<span class="builtintype" id="8525089">bool</span>&nbsp;&nbsp;<span class="comment" id="8525095">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8525126">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8525135">error</span>&nbsp;<span class="comment" id="8525141">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="8525179">}</span><span class="op" id="8525180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525183">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525265">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525354">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525443">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525529">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525615">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525701">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525790">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525877">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8525964">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526051">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526138">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526225">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526312">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526401">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526488">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526575">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526662">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526749">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526838">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8526925">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527012">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527099">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527186">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527190">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527227">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527261">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527334">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527366">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527439">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527471">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527543">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8527575">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8527630">{</span><span class="ident" id="8527631">net1</span><span class="op" id="8527635">:</span>&nbsp;<span class="string" id="8527637">&#34;tcp&#34;</span><span class="op" id="8527642">,</span>&nbsp;<span class="ident" id="8527644">laddr1</span><span class="op" id="8527650">:</span>&nbsp;<span class="string" id="8527652">&#34;&#34;</span><span class="op" id="8527654">,</span>&nbsp;<span class="ident" id="8527656">net2</span><span class="op" id="8527660">:</span>&nbsp;<span class="string" id="8527662">&#34;tcp&#34;</span><span class="op" id="8527667">,</span>&nbsp;<span class="ident" id="8527669">laddr2</span><span class="op" id="8527675">:</span>&nbsp;<span class="string" id="8527677">&#34;&#34;</span><span class="op" id="8527679">,</span>&nbsp;<span class="ident" id="8527681">wildcard</span><span class="op" id="8527689">:</span>&nbsp;<span class="builtintype" id="8527691">true</span><span class="op" id="8527695">,</span>&nbsp;<span class="ident" id="8527697">xerr</span><span class="op" id="8527701">:</span>&nbsp;<span class="ident" id="8527703">syscall</span><span class="op" id="8527710">.</span><span class="ident" id="8527711">EADDRINUSE</span><span class="op" id="8527721">}</span><span class="op" id="8527722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8527725">{</span><span class="ident" id="8527726">net1</span><span class="op" id="8527730">:</span>&nbsp;<span class="string" id="8527732">&#34;tcp&#34;</span><span class="op" id="8527737">,</span>&nbsp;<span class="ident" id="8527739">laddr1</span><span class="op" id="8527745">:</span>&nbsp;<span class="string" id="8527747">&#34;&#34;</span><span class="op" id="8527749">,</span>&nbsp;<span class="ident" id="8527751">net2</span><span class="op" id="8527755">:</span>&nbsp;<span class="string" id="8527757">&#34;tcp&#34;</span><span class="op" id="8527762">,</span>&nbsp;<span class="ident" id="8527764">laddr2</span><span class="op" id="8527770">:</span>&nbsp;<span class="string" id="8527772">&#34;0.0.0.0&#34;</span><span class="op" id="8527781">,</span>&nbsp;<span class="ident" id="8527783">wildcard</span><span class="op" id="8527791">:</span>&nbsp;<span class="builtintype" id="8527793">true</span><span class="op" id="8527797">,</span>&nbsp;<span class="ident" id="8527799">xerr</span><span class="op" id="8527803">:</span>&nbsp;<span class="ident" id="8527805">syscall</span><span class="op" id="8527812">.</span><span class="ident" id="8527813">EADDRINUSE</span><span class="op" id="8527823">}</span><span class="op" id="8527824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8527827">{</span><span class="ident" id="8527828">net1</span><span class="op" id="8527832">:</span>&nbsp;<span class="string" id="8527834">&#34;tcp&#34;</span><span class="op" id="8527839">,</span>&nbsp;<span class="ident" id="8527841">laddr1</span><span class="op" id="8527847">:</span>&nbsp;<span class="string" id="8527849">&#34;0.0.0.0&#34;</span><span class="op" id="8527858">,</span>&nbsp;<span class="ident" id="8527860">net2</span><span class="op" id="8527864">:</span>&nbsp;<span class="string" id="8527866">&#34;tcp&#34;</span><span class="op" id="8527871">,</span>&nbsp;<span class="ident" id="8527873">laddr2</span><span class="op" id="8527879">:</span>&nbsp;<span class="string" id="8527881">&#34;&#34;</span><span class="op" id="8527883">,</span>&nbsp;<span class="ident" id="8527885">wildcard</span><span class="op" id="8527893">:</span>&nbsp;<span class="builtintype" id="8527895">true</span><span class="op" id="8527899">,</span>&nbsp;<span class="ident" id="8527901">xerr</span><span class="op" id="8527905">:</span>&nbsp;<span class="ident" id="8527907">syscall</span><span class="op" id="8527914">.</span><span class="ident" id="8527915">EADDRINUSE</span><span class="op" id="8527925">}</span><span class="op" id="8527926">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8527930">{</span><span class="ident" id="8527931">net1</span><span class="op" id="8527935">:</span>&nbsp;<span class="string" id="8527937">&#34;tcp&#34;</span><span class="op" id="8527942">,</span>&nbsp;<span class="ident" id="8527944">laddr1</span><span class="op" id="8527950">:</span>&nbsp;<span class="string" id="8527952">&#34;&#34;</span><span class="op" id="8527954">,</span>&nbsp;<span class="ident" id="8527956">net2</span><span class="op" id="8527960">:</span>&nbsp;<span class="string" id="8527962">&#34;tcp&#34;</span><span class="op" id="8527967">,</span>&nbsp;<span class="ident" id="8527969">laddr2</span><span class="op" id="8527975">:</span>&nbsp;<span class="string" id="8527977">&#34;[::]&#34;</span><span class="op" id="8527983">,</span>&nbsp;<span class="ident" id="8527985">wildcard</span><span class="op" id="8527993">:</span>&nbsp;<span class="builtintype" id="8527995">true</span><span class="op" id="8527999">,</span>&nbsp;<span class="ident" id="8528001">xerr</span><span class="op" id="8528005">:</span>&nbsp;<span class="ident" id="8528007">syscall</span><span class="op" id="8528014">.</span><span class="ident" id="8528015">EADDRINUSE</span><span class="op" id="8528025">}</span><span class="op" id="8528026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528029">{</span><span class="ident" id="8528030">net1</span><span class="op" id="8528034">:</span>&nbsp;<span class="string" id="8528036">&#34;tcp&#34;</span><span class="op" id="8528041">,</span>&nbsp;<span class="ident" id="8528043">laddr1</span><span class="op" id="8528049">:</span>&nbsp;<span class="string" id="8528051">&#34;[::]&#34;</span><span class="op" id="8528057">,</span>&nbsp;<span class="ident" id="8528059">net2</span><span class="op" id="8528063">:</span>&nbsp;<span class="string" id="8528065">&#34;tcp&#34;</span><span class="op" id="8528070">,</span>&nbsp;<span class="ident" id="8528072">laddr2</span><span class="op" id="8528078">:</span>&nbsp;<span class="string" id="8528080">&#34;&#34;</span><span class="op" id="8528082">,</span>&nbsp;<span class="ident" id="8528084">wildcard</span><span class="op" id="8528092">:</span>&nbsp;<span class="builtintype" id="8528094">true</span><span class="op" id="8528098">,</span>&nbsp;<span class="ident" id="8528100">xerr</span><span class="op" id="8528104">:</span>&nbsp;<span class="ident" id="8528106">syscall</span><span class="op" id="8528113">.</span><span class="ident" id="8528114">EADDRINUSE</span><span class="op" id="8528124">}</span><span class="op" id="8528125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528128">{</span><span class="ident" id="8528129">net1</span><span class="op" id="8528133">:</span>&nbsp;<span class="string" id="8528135">&#34;tcp&#34;</span><span class="op" id="8528140">,</span>&nbsp;<span class="ident" id="8528142">laddr1</span><span class="op" id="8528148">:</span>&nbsp;<span class="string" id="8528150">&#34;0.0.0.0&#34;</span><span class="op" id="8528159">,</span>&nbsp;<span class="ident" id="8528161">net2</span><span class="op" id="8528165">:</span>&nbsp;<span class="string" id="8528167">&#34;tcp&#34;</span><span class="op" id="8528172">,</span>&nbsp;<span class="ident" id="8528174">laddr2</span><span class="op" id="8528180">:</span>&nbsp;<span class="string" id="8528182">&#34;[::]&#34;</span><span class="op" id="8528188">,</span>&nbsp;<span class="ident" id="8528190">wildcard</span><span class="op" id="8528198">:</span>&nbsp;<span class="builtintype" id="8528200">true</span><span class="op" id="8528204">,</span>&nbsp;<span class="ident" id="8528206">xerr</span><span class="op" id="8528210">:</span>&nbsp;<span class="ident" id="8528212">syscall</span><span class="op" id="8528219">.</span><span class="ident" id="8528220">EADDRINUSE</span><span class="op" id="8528230">}</span><span class="op" id="8528231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528234">{</span><span class="ident" id="8528235">net1</span><span class="op" id="8528239">:</span>&nbsp;<span class="string" id="8528241">&#34;tcp&#34;</span><span class="op" id="8528246">,</span>&nbsp;<span class="ident" id="8528248">laddr1</span><span class="op" id="8528254">:</span>&nbsp;<span class="string" id="8528256">&#34;[::]&#34;</span><span class="op" id="8528262">,</span>&nbsp;<span class="ident" id="8528264">net2</span><span class="op" id="8528268">:</span>&nbsp;<span class="string" id="8528270">&#34;tcp&#34;</span><span class="op" id="8528275">,</span>&nbsp;<span class="ident" id="8528277">laddr2</span><span class="op" id="8528283">:</span>&nbsp;<span class="string" id="8528285">&#34;0.0.0.0&#34;</span><span class="op" id="8528294">,</span>&nbsp;<span class="ident" id="8528296">wildcard</span><span class="op" id="8528304">:</span>&nbsp;<span class="builtintype" id="8528306">true</span><span class="op" id="8528310">,</span>&nbsp;<span class="ident" id="8528312">xerr</span><span class="op" id="8528316">:</span>&nbsp;<span class="ident" id="8528318">syscall</span><span class="op" id="8528325">.</span><span class="ident" id="8528326">EADDRINUSE</span><span class="op" id="8528336">}</span><span class="op" id="8528337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528340">{</span><span class="ident" id="8528341">net1</span><span class="op" id="8528345">:</span>&nbsp;<span class="string" id="8528347">&#34;tcp&#34;</span><span class="op" id="8528352">,</span>&nbsp;<span class="ident" id="8528354">laddr1</span><span class="op" id="8528360">:</span>&nbsp;<span class="string" id="8528362">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8528380">,</span>&nbsp;<span class="ident" id="8528382">net2</span><span class="op" id="8528386">:</span>&nbsp;<span class="string" id="8528388">&#34;tcp&#34;</span><span class="op" id="8528393">,</span>&nbsp;<span class="ident" id="8528395">laddr2</span><span class="op" id="8528401">:</span>&nbsp;<span class="string" id="8528403">&#34;[::]&#34;</span><span class="op" id="8528409">,</span>&nbsp;<span class="ident" id="8528411">wildcard</span><span class="op" id="8528419">:</span>&nbsp;<span class="builtintype" id="8528421">true</span><span class="op" id="8528425">,</span>&nbsp;<span class="ident" id="8528427">xerr</span><span class="op" id="8528431">:</span>&nbsp;<span class="ident" id="8528433">syscall</span><span class="op" id="8528440">.</span><span class="ident" id="8528441">EADDRINUSE</span><span class="op" id="8528451">}</span><span class="op" id="8528452">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528455">{</span><span class="ident" id="8528456">net1</span><span class="op" id="8528460">:</span>&nbsp;<span class="string" id="8528462">&#34;tcp&#34;</span><span class="op" id="8528467">,</span>&nbsp;<span class="ident" id="8528469">laddr1</span><span class="op" id="8528475">:</span>&nbsp;<span class="string" id="8528477">&#34;[::]&#34;</span><span class="op" id="8528483">,</span>&nbsp;<span class="ident" id="8528485">net2</span><span class="op" id="8528489">:</span>&nbsp;<span class="string" id="8528491">&#34;tcp&#34;</span><span class="op" id="8528496">,</span>&nbsp;<span class="ident" id="8528498">laddr2</span><span class="op" id="8528504">:</span>&nbsp;<span class="string" id="8528506">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8528524">,</span>&nbsp;<span class="ident" id="8528526">wildcard</span><span class="op" id="8528534">:</span>&nbsp;<span class="builtintype" id="8528536">true</span><span class="op" id="8528540">,</span>&nbsp;<span class="ident" id="8528542">xerr</span><span class="op" id="8528546">:</span>&nbsp;<span class="ident" id="8528548">syscall</span><span class="op" id="8528555">.</span><span class="ident" id="8528556">EADDRINUSE</span><span class="op" id="8528566">}</span><span class="op" id="8528567">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528571">{</span><span class="ident" id="8528572">net1</span><span class="op" id="8528576">:</span>&nbsp;<span class="string" id="8528578">&#34;tcp4&#34;</span><span class="op" id="8528584">,</span>&nbsp;<span class="ident" id="8528586">laddr1</span><span class="op" id="8528592">:</span>&nbsp;<span class="string" id="8528594">&#34;&#34;</span><span class="op" id="8528596">,</span>&nbsp;<span class="ident" id="8528598">net2</span><span class="op" id="8528602">:</span>&nbsp;<span class="string" id="8528604">&#34;tcp6&#34;</span><span class="op" id="8528610">,</span>&nbsp;<span class="ident" id="8528612">laddr2</span><span class="op" id="8528618">:</span>&nbsp;<span class="string" id="8528620">&#34;&#34;</span><span class="op" id="8528622">,</span>&nbsp;<span class="ident" id="8528624">wildcard</span><span class="op" id="8528632">:</span>&nbsp;<span class="builtintype" id="8528634">true</span><span class="op" id="8528638">}</span><span class="op" id="8528639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528642">{</span><span class="ident" id="8528643">net1</span><span class="op" id="8528647">:</span>&nbsp;<span class="string" id="8528649">&#34;tcp6&#34;</span><span class="op" id="8528655">,</span>&nbsp;<span class="ident" id="8528657">laddr1</span><span class="op" id="8528663">:</span>&nbsp;<span class="string" id="8528665">&#34;&#34;</span><span class="op" id="8528667">,</span>&nbsp;<span class="ident" id="8528669">net2</span><span class="op" id="8528673">:</span>&nbsp;<span class="string" id="8528675">&#34;tcp4&#34;</span><span class="op" id="8528681">,</span>&nbsp;<span class="ident" id="8528683">laddr2</span><span class="op" id="8528689">:</span>&nbsp;<span class="string" id="8528691">&#34;&#34;</span><span class="op" id="8528693">,</span>&nbsp;<span class="ident" id="8528695">wildcard</span><span class="op" id="8528703">:</span>&nbsp;<span class="builtintype" id="8528705">true</span><span class="op" id="8528709">}</span><span class="op" id="8528710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528713">{</span><span class="ident" id="8528714">net1</span><span class="op" id="8528718">:</span>&nbsp;<span class="string" id="8528720">&#34;tcp4&#34;</span><span class="op" id="8528726">,</span>&nbsp;<span class="ident" id="8528728">laddr1</span><span class="op" id="8528734">:</span>&nbsp;<span class="string" id="8528736">&#34;0.0.0.0&#34;</span><span class="op" id="8528745">,</span>&nbsp;<span class="ident" id="8528747">net2</span><span class="op" id="8528751">:</span>&nbsp;<span class="string" id="8528753">&#34;tcp6&#34;</span><span class="op" id="8528759">,</span>&nbsp;<span class="ident" id="8528761">laddr2</span><span class="op" id="8528767">:</span>&nbsp;<span class="string" id="8528769">&#34;[::]&#34;</span><span class="op" id="8528775">,</span>&nbsp;<span class="ident" id="8528777">wildcard</span><span class="op" id="8528785">:</span>&nbsp;<span class="builtintype" id="8528787">true</span><span class="op" id="8528791">}</span><span class="op" id="8528792">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528795">{</span><span class="ident" id="8528796">net1</span><span class="op" id="8528800">:</span>&nbsp;<span class="string" id="8528802">&#34;tcp6&#34;</span><span class="op" id="8528808">,</span>&nbsp;<span class="ident" id="8528810">laddr1</span><span class="op" id="8528816">:</span>&nbsp;<span class="string" id="8528818">&#34;[::]&#34;</span><span class="op" id="8528824">,</span>&nbsp;<span class="ident" id="8528826">net2</span><span class="op" id="8528830">:</span>&nbsp;<span class="string" id="8528832">&#34;tcp4&#34;</span><span class="op" id="8528838">,</span>&nbsp;<span class="ident" id="8528840">laddr2</span><span class="op" id="8528846">:</span>&nbsp;<span class="string" id="8528848">&#34;0.0.0.0&#34;</span><span class="op" id="8528857">,</span>&nbsp;<span class="ident" id="8528859">wildcard</span><span class="op" id="8528867">:</span>&nbsp;<span class="builtintype" id="8528869">true</span><span class="op" id="8528873">}</span><span class="op" id="8528874">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528878">{</span><span class="ident" id="8528879">net1</span><span class="op" id="8528883">:</span>&nbsp;<span class="string" id="8528885">&#34;tcp&#34;</span><span class="op" id="8528890">,</span>&nbsp;<span class="ident" id="8528892">laddr1</span><span class="op" id="8528898">:</span>&nbsp;<span class="string" id="8528900">&#34;127.0.0.1&#34;</span><span class="op" id="8528911">,</span>&nbsp;<span class="ident" id="8528913">net2</span><span class="op" id="8528917">:</span>&nbsp;<span class="string" id="8528919">&#34;tcp&#34;</span><span class="op" id="8528924">,</span>&nbsp;<span class="ident" id="8528926">laddr2</span><span class="op" id="8528932">:</span>&nbsp;<span class="string" id="8528934">&#34;[::1]&#34;</span><span class="op" id="8528941">}</span><span class="op" id="8528942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8528945">{</span><span class="ident" id="8528946">net1</span><span class="op" id="8528950">:</span>&nbsp;<span class="string" id="8528952">&#34;tcp&#34;</span><span class="op" id="8528957">,</span>&nbsp;<span class="ident" id="8528959">laddr1</span><span class="op" id="8528965">:</span>&nbsp;<span class="string" id="8528967">&#34;[::1]&#34;</span><span class="op" id="8528974">,</span>&nbsp;<span class="ident" id="8528976">net2</span><span class="op" id="8528980">:</span>&nbsp;<span class="string" id="8528982">&#34;tcp&#34;</span><span class="op" id="8528987">,</span>&nbsp;<span class="ident" id="8528989">laddr2</span><span class="op" id="8528995">:</span>&nbsp;<span class="string" id="8528997">&#34;127.0.0.1&#34;</span><span class="op" id="8529008">}</span><span class="op" id="8529009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529012">{</span><span class="ident" id="8529013">net1</span><span class="op" id="8529017">:</span>&nbsp;<span class="string" id="8529019">&#34;tcp4&#34;</span><span class="op" id="8529025">,</span>&nbsp;<span class="ident" id="8529027">laddr1</span><span class="op" id="8529033">:</span>&nbsp;<span class="string" id="8529035">&#34;127.0.0.1&#34;</span><span class="op" id="8529046">,</span>&nbsp;<span class="ident" id="8529048">net2</span><span class="op" id="8529052">:</span>&nbsp;<span class="string" id="8529054">&#34;tcp6&#34;</span><span class="op" id="8529060">,</span>&nbsp;<span class="ident" id="8529062">laddr2</span><span class="op" id="8529068">:</span>&nbsp;<span class="string" id="8529070">&#34;[::1]&#34;</span><span class="op" id="8529077">}</span><span class="op" id="8529078">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529081">{</span><span class="ident" id="8529082">net1</span><span class="op" id="8529086">:</span>&nbsp;<span class="string" id="8529088">&#34;tcp6&#34;</span><span class="op" id="8529094">,</span>&nbsp;<span class="ident" id="8529096">laddr1</span><span class="op" id="8529102">:</span>&nbsp;<span class="string" id="8529104">&#34;[::1]&#34;</span><span class="op" id="8529111">,</span>&nbsp;<span class="ident" id="8529113">net2</span><span class="op" id="8529117">:</span>&nbsp;<span class="string" id="8529119">&#34;tcp4&#34;</span><span class="op" id="8529125">,</span>&nbsp;<span class="ident" id="8529127">laddr2</span><span class="op" id="8529133">:</span>&nbsp;<span class="string" id="8529135">&#34;127.0.0.1&#34;</span><span class="op" id="8529146">}</span><span class="op" id="8529147">,</span><br>
<span class="lineno"></span><span class="op" id="8529149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8529152">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8529216">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="8529279">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8529315">func</span>&nbsp;<span class="ident" id="8529320">TestDualStackTCPListener</span><span class="op" id="8529344">(</span><span class="ident" id="8529345">t</span>&nbsp;<span class="op" id="8529347">*</span><span class="ident" id="8529348">testing</span><span class="op" id="8529355">.</span><span class="ident" id="8529356">T</span><span class="op" id="8529357">)</span>&nbsp;<span class="op" id="8529359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529362">if</span>&nbsp;<span class="ident" id="8529365">testing</span><span class="op" id="8529372">.</span><span class="ident" id="8529373">Short</span><span class="op" id="8529378">(</span><span class="op" id="8529379">)</span>&nbsp;<span class="op" id="8529381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529385">t</span><span class="op" id="8529386">.</span><span class="ident" id="8529387">Skip</span><span class="op" id="8529391">(</span><span class="string" id="8529392">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8529433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529436">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529439">switch</span>&nbsp;<span class="ident" id="8529446">runtime</span><span class="op" id="8529453">.</span><span class="ident" id="8529454">GOOS</span>&nbsp;<span class="op" id="8529459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529462">case</span>&nbsp;<span class="string" id="8529467">&#34;plan9&#34;</span><span class="op" id="8529474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529478">t</span><span class="op" id="8529479">.</span><span class="ident" id="8529480">Skipf</span><span class="op" id="8529485">(</span><span class="string" id="8529486">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8529507">,</span>&nbsp;<span class="ident" id="8529509">runtime</span><span class="op" id="8529516">.</span><span class="ident" id="8529517">GOOS</span><span class="op" id="8529521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529527">if</span>&nbsp;<span class="op" id="8529530">!</span><span class="ident" id="8529531">supportsIPv6</span>&nbsp;<span class="op" id="8529544">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529548">t</span><span class="op" id="8529549">.</span><span class="ident" id="8529550">Skip</span><span class="op" id="8529554">(</span><span class="string" id="8529555">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8529578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529585">for</span>&nbsp;<span class="ident" id="8529589">_</span><span class="op" id="8529590">,</span>&nbsp;<span class="ident" id="8529592">tt</span>&nbsp;<span class="op" id="8529595">:=</span>&nbsp;<span class="keyword" id="8529598">range</span>&nbsp;<span class="ident" id="8529604">dualStackListenerTests</span>&nbsp;<span class="op" id="8529627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529631">if</span>&nbsp;<span class="ident" id="8529634">tt</span><span class="op" id="8529636">.</span><span class="ident" id="8529637">wildcard</span>&nbsp;<span class="op" id="8529646">&amp;&amp;</span>&nbsp;<span class="op" id="8529649">!</span><span class="op" id="8529650">*</span><span class="ident" id="8529651">testExternal</span>&nbsp;<span class="op" id="8529664">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529669">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529684">switch</span>&nbsp;<span class="ident" id="8529691">runtime</span><span class="op" id="8529698">.</span><span class="ident" id="8529699">GOOS</span>&nbsp;<span class="op" id="8529704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529708">case</span>&nbsp;<span class="string" id="8529713">&#34;openbsd&#34;</span><span class="op" id="8529722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8529727">if</span>&nbsp;<span class="ident" id="8529730">tt</span><span class="op" id="8529732">.</span><span class="ident" id="8529733">wildcard</span>&nbsp;<span class="op" id="8529742">&amp;&amp;</span>&nbsp;<span class="ident" id="8529745">differentWildcardAddr</span><span class="op" id="8529766">(</span><span class="ident" id="8529767">tt</span><span class="op" id="8529769">.</span><span class="ident" id="8529770">laddr1</span><span class="op" id="8529776">,</span>&nbsp;<span class="ident" id="8529778">tt</span><span class="op" id="8529780">.</span><span class="ident" id="8529781">laddr2</span><span class="op" id="8529787">)</span>&nbsp;<span class="op" id="8529789">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529795">tt</span><span class="op" id="8529797">.</span><span class="ident" id="8529798">xerr</span>&nbsp;<span class="op" id="8529803">=</span>&nbsp;<span class="ident" id="8529805">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8529816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529820">l1</span><span class="op" id="8529822">,</span>&nbsp;<span class="ident" id="8529824">port</span>&nbsp;<span class="op" id="8529829">:=</span>&nbsp;<span class="ident" id="8529832">usableListenPort</span><span class="op" id="8529848">(</span><span class="ident" id="8529849">t</span><span class="op" id="8529850">,</span>&nbsp;<span class="ident" id="8529852">tt</span><span class="op" id="8529854">.</span><span class="ident" id="8529855">net1</span><span class="op" id="8529859">,</span>&nbsp;<span class="ident" id="8529861">tt</span><span class="op" id="8529863">.</span><span class="ident" id="8529864">laddr1</span><span class="op" id="8529870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529874">laddr</span>&nbsp;<span class="op" id="8529880">:=</span>&nbsp;<span class="ident" id="8529883">tt</span><span class="op" id="8529885">.</span><span class="ident" id="8529886">laddr1</span>&nbsp;<span class="op" id="8529893">+</span>&nbsp;<span class="string" id="8529895">&#34;:&#34;</span>&nbsp;<span class="op" id="8529899">+</span>&nbsp;<span class="ident" id="8529901">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529908">checkFirstListener</span><span class="op" id="8529926">(</span><span class="ident" id="8529927">t</span><span class="op" id="8529928">,</span>&nbsp;<span class="ident" id="8529930">tt</span><span class="op" id="8529932">.</span><span class="ident" id="8529933">net1</span><span class="op" id="8529937">,</span>&nbsp;<span class="ident" id="8529939">laddr</span><span class="op" id="8529944">,</span>&nbsp;<span class="ident" id="8529946">l1</span><span class="op" id="8529948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529952">laddr</span>&nbsp;<span class="op" id="8529958">=</span>&nbsp;<span class="ident" id="8529960">tt</span><span class="op" id="8529962">.</span><span class="ident" id="8529963">laddr2</span>&nbsp;<span class="op" id="8529970">+</span>&nbsp;<span class="string" id="8529972">&#34;:&#34;</span>&nbsp;<span class="op" id="8529976">+</span>&nbsp;<span class="ident" id="8529978">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8529985">l2</span><span class="op" id="8529987">,</span>&nbsp;<span class="ident" id="8529989">err</span>&nbsp;<span class="op" id="8529993">:=</span>&nbsp;<span class="ident" id="8529996">Listen</span><span class="op" id="8530002">(</span><span class="ident" id="8530003">tt</span><span class="op" id="8530005">.</span><span class="ident" id="8530006">net2</span><span class="op" id="8530010">,</span>&nbsp;<span class="ident" id="8530012">laddr</span><span class="op" id="8530017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530021">checkDualStackSecondListener</span><span class="op" id="8530049">(</span><span class="ident" id="8530050">t</span><span class="op" id="8530051">,</span>&nbsp;<span class="ident" id="8530053">tt</span><span class="op" id="8530055">.</span><span class="ident" id="8530056">net2</span><span class="op" id="8530060">,</span>&nbsp;<span class="ident" id="8530062">laddr</span><span class="op" id="8530067">,</span>&nbsp;<span class="ident" id="8530069">tt</span><span class="op" id="8530071">.</span><span class="ident" id="8530072">xerr</span><span class="op" id="8530076">,</span>&nbsp;<span class="ident" id="8530078">err</span><span class="op" id="8530081">,</span>&nbsp;<span class="ident" id="8530083">l2</span><span class="op" id="8530085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530089">l1</span><span class="op" id="8530091">.</span><span class="ident" id="8530092">Close</span><span class="op" id="8530097">(</span><span class="op" id="8530098">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530101">}</span><br>
<span class="lineno"></span><span class="op" id="8530103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8530106">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8530170">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="8530233">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8530269">func</span>&nbsp;<span class="ident" id="8530274">TestDualStackUDPListener</span><span class="op" id="8530298">(</span><span class="ident" id="8530299">t</span>&nbsp;<span class="op" id="8530301">*</span><span class="ident" id="8530302">testing</span><span class="op" id="8530309">.</span><span class="ident" id="8530310">T</span><span class="op" id="8530311">)</span>&nbsp;<span class="op" id="8530313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530316">if</span>&nbsp;<span class="ident" id="8530319">testing</span><span class="op" id="8530326">.</span><span class="ident" id="8530327">Short</span><span class="op" id="8530332">(</span><span class="op" id="8530333">)</span>&nbsp;<span class="op" id="8530335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530339">t</span><span class="op" id="8530340">.</span><span class="ident" id="8530341">Skip</span><span class="op" id="8530345">(</span><span class="string" id="8530346">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8530387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530390">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530393">switch</span>&nbsp;<span class="ident" id="8530400">runtime</span><span class="op" id="8530407">.</span><span class="ident" id="8530408">GOOS</span>&nbsp;<span class="op" id="8530413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530416">case</span>&nbsp;<span class="string" id="8530421">&#34;plan9&#34;</span><span class="op" id="8530428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530432">t</span><span class="op" id="8530433">.</span><span class="ident" id="8530434">Skipf</span><span class="op" id="8530439">(</span><span class="string" id="8530440">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8530461">,</span>&nbsp;<span class="ident" id="8530463">runtime</span><span class="op" id="8530470">.</span><span class="ident" id="8530471">GOOS</span><span class="op" id="8530475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530481">if</span>&nbsp;<span class="op" id="8530484">!</span><span class="ident" id="8530485">supportsIPv6</span>&nbsp;<span class="op" id="8530498">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530502">t</span><span class="op" id="8530503">.</span><span class="ident" id="8530504">Skip</span><span class="op" id="8530508">(</span><span class="string" id="8530509">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8530532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530539">toudpnet</span>&nbsp;<span class="op" id="8530548">:=</span>&nbsp;<span class="keyword" id="8530551">func</span><span class="op" id="8530555">(</span><span class="ident" id="8530556">net</span>&nbsp;<span class="builtintype" id="8530560">string</span><span class="op" id="8530566">)</span>&nbsp;<span class="builtintype" id="8530568">string</span>&nbsp;<span class="op" id="8530575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530579">switch</span>&nbsp;<span class="ident" id="8530586">net</span>&nbsp;<span class="op" id="8530590">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530594">case</span>&nbsp;<span class="string" id="8530599">&#34;tcp&#34;</span><span class="op" id="8530604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530609">return</span>&nbsp;<span class="string" id="8530616">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530624">case</span>&nbsp;<span class="string" id="8530629">&#34;tcp4&#34;</span><span class="op" id="8530635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530640">return</span>&nbsp;<span class="string" id="8530647">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530656">case</span>&nbsp;<span class="string" id="8530661">&#34;tcp6&#34;</span><span class="op" id="8530667">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530672">return</span>&nbsp;<span class="string" id="8530679">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530692">return</span>&nbsp;<span class="string" id="8530699">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530712">for</span>&nbsp;<span class="ident" id="8530716">_</span><span class="op" id="8530717">,</span>&nbsp;<span class="ident" id="8530719">tt</span>&nbsp;<span class="op" id="8530722">:=</span>&nbsp;<span class="keyword" id="8530725">range</span>&nbsp;<span class="ident" id="8530731">dualStackListenerTests</span>&nbsp;<span class="op" id="8530754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530758">if</span>&nbsp;<span class="ident" id="8530761">tt</span><span class="op" id="8530763">.</span><span class="ident" id="8530764">wildcard</span>&nbsp;<span class="op" id="8530773">&amp;&amp;</span>&nbsp;<span class="op" id="8530776">(</span><span class="ident" id="8530777">testing</span><span class="op" id="8530784">.</span><span class="ident" id="8530785">Short</span><span class="op" id="8530790">(</span><span class="op" id="8530791">)</span>&nbsp;<span class="op" id="8530793">||</span>&nbsp;<span class="op" id="8530796">!</span><span class="op" id="8530797">*</span><span class="ident" id="8530798">testExternal</span><span class="op" id="8530810">)</span>&nbsp;<span class="op" id="8530812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530817">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8530828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530832">tt</span><span class="op" id="8530834">.</span><span class="ident" id="8530835">net1</span>&nbsp;<span class="op" id="8530840">=</span>&nbsp;<span class="ident" id="8530842">toudpnet</span><span class="op" id="8530850">(</span><span class="ident" id="8530851">tt</span><span class="op" id="8530853">.</span><span class="ident" id="8530854">net1</span><span class="op" id="8530858">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8530862">tt</span><span class="op" id="8530864">.</span><span class="ident" id="8530865">net2</span>&nbsp;<span class="op" id="8530870">=</span>&nbsp;<span class="ident" id="8530872">toudpnet</span><span class="op" id="8530880">(</span><span class="ident" id="8530881">tt</span><span class="op" id="8530883">.</span><span class="ident" id="8530884">net2</span><span class="op" id="8530888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530892">switch</span>&nbsp;<span class="ident" id="8530899">runtime</span><span class="op" id="8530906">.</span><span class="ident" id="8530907">GOOS</span>&nbsp;<span class="op" id="8530912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530916">case</span>&nbsp;<span class="string" id="8530921">&#34;openbsd&#34;</span><span class="op" id="8530930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8530935">if</span>&nbsp;<span class="ident" id="8530938">tt</span><span class="op" id="8530940">.</span><span class="ident" id="8530941">wildcard</span>&nbsp;<span class="op" id="8530950">&amp;&amp;</span>&nbsp;<span class="ident" id="8530953">differentWildcardAddr</span><span class="op" id="8530974">(</span><span class="ident" id="8530975">tt</span><span class="op" id="8530977">.</span><span class="ident" id="8530978">laddr1</span><span class="op" id="8530984">,</span>&nbsp;<span class="ident" id="8530986">tt</span><span class="op" id="8530988">.</span><span class="ident" id="8530989">laddr2</span><span class="op" id="8530995">)</span>&nbsp;<span class="op" id="8530997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531003">tt</span><span class="op" id="8531005">.</span><span class="ident" id="8531006">xerr</span>&nbsp;<span class="op" id="8531011">=</span>&nbsp;<span class="ident" id="8531013">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531028">l1</span><span class="op" id="8531030">,</span>&nbsp;<span class="ident" id="8531032">port</span>&nbsp;<span class="op" id="8531037">:=</span>&nbsp;<span class="ident" id="8531040">usableListenPacketPort</span><span class="op" id="8531062">(</span><span class="ident" id="8531063">t</span><span class="op" id="8531064">,</span>&nbsp;<span class="ident" id="8531066">tt</span><span class="op" id="8531068">.</span><span class="ident" id="8531069">net1</span><span class="op" id="8531073">,</span>&nbsp;<span class="ident" id="8531075">tt</span><span class="op" id="8531077">.</span><span class="ident" id="8531078">laddr1</span><span class="op" id="8531084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531088">laddr</span>&nbsp;<span class="op" id="8531094">:=</span>&nbsp;<span class="ident" id="8531097">tt</span><span class="op" id="8531099">.</span><span class="ident" id="8531100">laddr1</span>&nbsp;<span class="op" id="8531107">+</span>&nbsp;<span class="string" id="8531109">&#34;:&#34;</span>&nbsp;<span class="op" id="8531113">+</span>&nbsp;<span class="ident" id="8531115">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531122">checkFirstListener</span><span class="op" id="8531140">(</span><span class="ident" id="8531141">t</span><span class="op" id="8531142">,</span>&nbsp;<span class="ident" id="8531144">tt</span><span class="op" id="8531146">.</span><span class="ident" id="8531147">net1</span><span class="op" id="8531151">,</span>&nbsp;<span class="ident" id="8531153">laddr</span><span class="op" id="8531158">,</span>&nbsp;<span class="ident" id="8531160">l1</span><span class="op" id="8531162">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531166">laddr</span>&nbsp;<span class="op" id="8531172">=</span>&nbsp;<span class="ident" id="8531174">tt</span><span class="op" id="8531176">.</span><span class="ident" id="8531177">laddr2</span>&nbsp;<span class="op" id="8531184">+</span>&nbsp;<span class="string" id="8531186">&#34;:&#34;</span>&nbsp;<span class="op" id="8531190">+</span>&nbsp;<span class="ident" id="8531192">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531199">l2</span><span class="op" id="8531201">,</span>&nbsp;<span class="ident" id="8531203">err</span>&nbsp;<span class="op" id="8531207">:=</span>&nbsp;<span class="ident" id="8531210">ListenPacket</span><span class="op" id="8531222">(</span><span class="ident" id="8531223">tt</span><span class="op" id="8531225">.</span><span class="ident" id="8531226">net2</span><span class="op" id="8531230">,</span>&nbsp;<span class="ident" id="8531232">laddr</span><span class="op" id="8531237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531241">checkDualStackSecondListener</span><span class="op" id="8531269">(</span><span class="ident" id="8531270">t</span><span class="op" id="8531271">,</span>&nbsp;<span class="ident" id="8531273">tt</span><span class="op" id="8531275">.</span><span class="ident" id="8531276">net2</span><span class="op" id="8531280">,</span>&nbsp;<span class="ident" id="8531282">laddr</span><span class="op" id="8531287">,</span>&nbsp;<span class="ident" id="8531289">tt</span><span class="op" id="8531291">.</span><span class="ident" id="8531292">xerr</span><span class="op" id="8531296">,</span>&nbsp;<span class="ident" id="8531298">err</span><span class="op" id="8531301">,</span>&nbsp;<span class="ident" id="8531303">l2</span><span class="op" id="8531305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531309">l1</span><span class="op" id="8531311">.</span><span class="ident" id="8531312">Close</span><span class="op" id="8531317">(</span><span class="op" id="8531318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531321">}</span><br>
<span class="lineno">250</span><span class="op" id="8531323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8531326">func</span>&nbsp;<span class="ident" id="8531331">usableListenPort</span><span class="op" id="8531347">(</span><span class="ident" id="8531348">t</span>&nbsp;<span class="op" id="8531350">*</span><span class="ident" id="8531351">testing</span><span class="op" id="8531358">.</span><span class="ident" id="8531359">T</span><span class="op" id="8531360">,</span>&nbsp;<span class="ident" id="8531362">net</span><span class="op" id="8531365">,</span>&nbsp;<span class="ident" id="8531367">laddr</span>&nbsp;<span class="builtintype" id="8531373">string</span><span class="op" id="8531379">)</span>&nbsp;<span class="op" id="8531381">(</span><span class="ident" id="8531382">l</span>&nbsp;<span class="ident" id="8531384">Listener</span><span class="op" id="8531392">,</span>&nbsp;<span class="ident" id="8531394">port</span>&nbsp;<span class="builtintype" id="8531399">string</span><span class="op" id="8531405">)</span>&nbsp;<span class="op" id="8531407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531410">var</span>&nbsp;<span class="ident" id="8531414">nladdr</span>&nbsp;<span class="builtintype" id="8531421">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531429">var</span>&nbsp;<span class="ident" id="8531433">err</span>&nbsp;<span class="builtintype" id="8531437">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531444">switch</span>&nbsp;<span class="ident" id="8531451">net</span>&nbsp;<span class="op" id="8531455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531458">default</span><span class="op" id="8531465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8531469">panic</span><span class="op" id="8531474">(</span><span class="string" id="8531475">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8531499">+</span>&nbsp;<span class="ident" id="8531501">net</span><span class="op" id="8531504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531507">case</span>&nbsp;<span class="string" id="8531512">&#34;tcp&#34;</span><span class="op" id="8531517">,</span>&nbsp;<span class="string" id="8531519">&#34;tcp4&#34;</span><span class="op" id="8531525">,</span>&nbsp;<span class="string" id="8531527">&#34;tcp6&#34;</span><span class="op" id="8531533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531537">l</span><span class="op" id="8531538">,</span>&nbsp;<span class="ident" id="8531540">err</span>&nbsp;<span class="op" id="8531544">=</span>&nbsp;<span class="ident" id="8531546">Listen</span><span class="op" id="8531552">(</span><span class="ident" id="8531553">net</span><span class="op" id="8531556">,</span>&nbsp;<span class="ident" id="8531558">laddr</span><span class="op" id="8531563">+</span><span class="string" id="8531564">&#34;:0&#34;</span><span class="op" id="8531568">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531572">if</span>&nbsp;<span class="ident" id="8531575">err</span>&nbsp;<span class="op" id="8531579">!=</span>&nbsp;<span class="ident" id="8531582">nil</span>&nbsp;<span class="op" id="8531586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531591">t</span><span class="op" id="8531592">.</span><span class="ident" id="8531593">Fatalf</span><span class="op" id="8531599">(</span><span class="string" id="8531600">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8531633">,</span>&nbsp;<span class="ident" id="8531635">net</span><span class="op" id="8531638">,</span>&nbsp;<span class="ident" id="8531640">laddr</span><span class="op" id="8531645">,</span>&nbsp;<span class="ident" id="8531647">err</span><span class="op" id="8531650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531658">nladdr</span>&nbsp;<span class="op" id="8531665">=</span>&nbsp;<span class="ident" id="8531667">l</span><span class="op" id="8531668">.</span><span class="op" id="8531669">(</span><span class="op" id="8531670">*</span><span class="ident" id="8531671">TCPListener</span><span class="op" id="8531682">)</span><span class="op" id="8531683">.</span><span class="ident" id="8531684">Addr</span><span class="op" id="8531688">(</span><span class="op" id="8531689">)</span><span class="op" id="8531690">.</span><span class="ident" id="8531691">String</span><span class="op" id="8531697">(</span><span class="op" id="8531698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531701">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531704">_</span><span class="op" id="8531705">,</span>&nbsp;<span class="ident" id="8531707">port</span><span class="op" id="8531711">,</span>&nbsp;<span class="ident" id="8531713">err</span>&nbsp;<span class="op" id="8531717">=</span>&nbsp;<span class="ident" id="8531719">SplitHostPort</span><span class="op" id="8531732">(</span><span class="ident" id="8531733">nladdr</span><span class="op" id="8531739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531742">if</span>&nbsp;<span class="ident" id="8531745">err</span>&nbsp;<span class="op" id="8531749">!=</span>&nbsp;<span class="ident" id="8531752">nil</span>&nbsp;<span class="op" id="8531756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8531760">t</span><span class="op" id="8531761">.</span><span class="ident" id="8531762">Fatalf</span><span class="op" id="8531768">(</span><span class="string" id="8531769">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8531795">,</span>&nbsp;<span class="ident" id="8531797">err</span><span class="op" id="8531800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8531803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531806">return</span>&nbsp;<span class="ident" id="8531813">l</span><span class="op" id="8531814">,</span>&nbsp;<span class="ident" id="8531816">port</span><br>
<span class="lineno">270</span><span class="op" id="8531821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8531824">func</span>&nbsp;<span class="ident" id="8531829">usableListenPacketPort</span><span class="op" id="8531851">(</span><span class="ident" id="8531852">t</span>&nbsp;<span class="op" id="8531854">*</span><span class="ident" id="8531855">testing</span><span class="op" id="8531862">.</span><span class="ident" id="8531863">T</span><span class="op" id="8531864">,</span>&nbsp;<span class="ident" id="8531866">net</span><span class="op" id="8531869">,</span>&nbsp;<span class="ident" id="8531871">laddr</span>&nbsp;<span class="builtintype" id="8531877">string</span><span class="op" id="8531883">)</span>&nbsp;<span class="op" id="8531885">(</span><span class="ident" id="8531886">l</span>&nbsp;<span class="ident" id="8531888">PacketConn</span><span class="op" id="8531898">,</span>&nbsp;<span class="ident" id="8531900">port</span>&nbsp;<span class="builtintype" id="8531905">string</span><span class="op" id="8531911">)</span>&nbsp;<span class="op" id="8531913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531916">var</span>&nbsp;<span class="ident" id="8531920">nladdr</span>&nbsp;<span class="builtintype" id="8531927">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531935">var</span>&nbsp;<span class="ident" id="8531939">err</span>&nbsp;<span class="builtintype" id="8531943">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531950">switch</span>&nbsp;<span class="ident" id="8531957">net</span>&nbsp;<span class="op" id="8531961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8531964">default</span><span class="op" id="8531971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8531975">panic</span><span class="op" id="8531980">(</span><span class="string" id="8531981">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8532011">+</span>&nbsp;<span class="ident" id="8532013">net</span><span class="op" id="8532016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532019">case</span>&nbsp;<span class="string" id="8532024">&#34;udp&#34;</span><span class="op" id="8532029">,</span>&nbsp;<span class="string" id="8532031">&#34;udp4&#34;</span><span class="op" id="8532037">,</span>&nbsp;<span class="string" id="8532039">&#34;udp6&#34;</span><span class="op" id="8532045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532049">l</span><span class="op" id="8532050">,</span>&nbsp;<span class="ident" id="8532052">err</span>&nbsp;<span class="op" id="8532056">=</span>&nbsp;<span class="ident" id="8532058">ListenPacket</span><span class="op" id="8532070">(</span><span class="ident" id="8532071">net</span><span class="op" id="8532074">,</span>&nbsp;<span class="ident" id="8532076">laddr</span><span class="op" id="8532081">+</span><span class="string" id="8532082">&#34;:0&#34;</span><span class="op" id="8532086">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532090">if</span>&nbsp;<span class="ident" id="8532093">err</span>&nbsp;<span class="op" id="8532097">!=</span>&nbsp;<span class="ident" id="8532100">nil</span>&nbsp;<span class="op" id="8532104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532109">t</span><span class="op" id="8532110">.</span><span class="ident" id="8532111">Fatalf</span><span class="op" id="8532117">(</span><span class="string" id="8532118">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8532157">,</span>&nbsp;<span class="ident" id="8532159">net</span><span class="op" id="8532162">,</span>&nbsp;<span class="ident" id="8532164">laddr</span><span class="op" id="8532169">,</span>&nbsp;<span class="ident" id="8532171">err</span><span class="op" id="8532174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532182">nladdr</span>&nbsp;<span class="op" id="8532189">=</span>&nbsp;<span class="ident" id="8532191">l</span><span class="op" id="8532192">.</span><span class="op" id="8532193">(</span><span class="op" id="8532194">*</span><span class="ident" id="8532195">UDPConn</span><span class="op" id="8532202">)</span><span class="op" id="8532203">.</span><span class="ident" id="8532204">LocalAddr</span><span class="op" id="8532213">(</span><span class="op" id="8532214">)</span><span class="op" id="8532215">.</span><span class="ident" id="8532216">String</span><span class="op" id="8532222">(</span><span class="op" id="8532223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532226">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532229">_</span><span class="op" id="8532230">,</span>&nbsp;<span class="ident" id="8532232">port</span><span class="op" id="8532236">,</span>&nbsp;<span class="ident" id="8532238">err</span>&nbsp;<span class="op" id="8532242">=</span>&nbsp;<span class="ident" id="8532244">SplitHostPort</span><span class="op" id="8532257">(</span><span class="ident" id="8532258">nladdr</span><span class="op" id="8532264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532267">if</span>&nbsp;<span class="ident" id="8532270">err</span>&nbsp;<span class="op" id="8532274">!=</span>&nbsp;<span class="ident" id="8532277">nil</span>&nbsp;<span class="op" id="8532281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532285">t</span><span class="op" id="8532286">.</span><span class="ident" id="8532287">Fatalf</span><span class="op" id="8532293">(</span><span class="string" id="8532294">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8532320">,</span>&nbsp;<span class="ident" id="8532322">err</span><span class="op" id="8532325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532331">return</span>&nbsp;<span class="ident" id="8532338">l</span><span class="op" id="8532339">,</span>&nbsp;<span class="ident" id="8532341">port</span><br>
<span class="lineno">290</span><span class="op" id="8532346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532349">func</span>&nbsp;<span class="ident" id="8532354">differentWildcardAddr</span><span class="op" id="8532375">(</span><span class="ident" id="8532376">i</span><span class="op" id="8532377">,</span>&nbsp;<span class="ident" id="8532379">j</span>&nbsp;<span class="builtintype" id="8532381">string</span><span class="op" id="8532387">)</span>&nbsp;<span class="builtintype" id="8532389">bool</span>&nbsp;<span class="op" id="8532394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532397">if</span>&nbsp;<span class="op" id="8532400">(</span><span class="ident" id="8532401">i</span>&nbsp;<span class="op" id="8532403">==</span>&nbsp;<span class="string" id="8532406">&#34;&#34;</span>&nbsp;<span class="op" id="8532409">||</span>&nbsp;<span class="ident" id="8532412">i</span>&nbsp;<span class="op" id="8532414">==</span>&nbsp;<span class="string" id="8532417">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8532427">||</span>&nbsp;<span class="ident" id="8532430">i</span>&nbsp;<span class="op" id="8532432">==</span>&nbsp;<span class="string" id="8532435">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8532451">)</span>&nbsp;<span class="op" id="8532453">&amp;&amp;</span>&nbsp;<span class="op" id="8532456">(</span><span class="ident" id="8532457">j</span>&nbsp;<span class="op" id="8532459">==</span>&nbsp;<span class="string" id="8532462">&#34;&#34;</span>&nbsp;<span class="op" id="8532465">||</span>&nbsp;<span class="ident" id="8532468">j</span>&nbsp;<span class="op" id="8532470">==</span>&nbsp;<span class="string" id="8532473">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8532483">||</span>&nbsp;<span class="ident" id="8532486">j</span>&nbsp;<span class="op" id="8532488">==</span>&nbsp;<span class="string" id="8532491">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8532507">)</span>&nbsp;<span class="op" id="8532509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532513">return</span>&nbsp;<span class="builtintype" id="8532520">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532530">if</span>&nbsp;<span class="ident" id="8532533">i</span>&nbsp;<span class="op" id="8532535">==</span>&nbsp;<span class="string" id="8532538">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8532545">&amp;&amp;</span>&nbsp;<span class="ident" id="8532548">j</span>&nbsp;<span class="op" id="8532550">==</span>&nbsp;<span class="string" id="8532553">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8532560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532564">return</span>&nbsp;<span class="builtintype" id="8532571">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532581">return</span>&nbsp;<span class="builtintype" id="8532588">true</span><br>
<span class="lineno">300</span><span class="op" id="8532593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532596">func</span>&nbsp;<span class="ident" id="8532601">checkFirstListener</span><span class="op" id="8532619">(</span><span class="ident" id="8532620">t</span>&nbsp;<span class="op" id="8532622">*</span><span class="ident" id="8532623">testing</span><span class="op" id="8532630">.</span><span class="ident" id="8532631">T</span><span class="op" id="8532632">,</span>&nbsp;<span class="ident" id="8532634">net</span><span class="op" id="8532637">,</span>&nbsp;<span class="ident" id="8532639">laddr</span>&nbsp;<span class="builtintype" id="8532645">string</span><span class="op" id="8532651">,</span>&nbsp;<span class="ident" id="8532653">l</span>&nbsp;<span class="keyword" id="8532655">interface</span><span class="op" id="8532664">{</span><span class="op" id="8532665">}</span><span class="op" id="8532666">)</span>&nbsp;<span class="op" id="8532668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532671">switch</span>&nbsp;<span class="ident" id="8532678">net</span>&nbsp;<span class="op" id="8532682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532685">case</span>&nbsp;<span class="string" id="8532690">&#34;tcp&#34;</span><span class="op" id="8532695">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532699">fd</span>&nbsp;<span class="op" id="8532702">:=</span>&nbsp;<span class="ident" id="8532705">l</span><span class="op" id="8532706">.</span><span class="op" id="8532707">(</span><span class="op" id="8532708">*</span><span class="ident" id="8532709">TCPListener</span><span class="op" id="8532720">)</span><span class="op" id="8532721">.</span><span class="ident" id="8532722">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532727">checkDualStackAddrFamily</span><span class="op" id="8532751">(</span><span class="ident" id="8532752">t</span><span class="op" id="8532753">,</span>&nbsp;<span class="ident" id="8532755">net</span><span class="op" id="8532758">,</span>&nbsp;<span class="ident" id="8532760">laddr</span><span class="op" id="8532765">,</span>&nbsp;<span class="ident" id="8532767">fd</span><span class="op" id="8532769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532772">case</span>&nbsp;<span class="string" id="8532777">&#34;tcp4&#34;</span><span class="op" id="8532783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532787">fd</span>&nbsp;<span class="op" id="8532790">:=</span>&nbsp;<span class="ident" id="8532793">l</span><span class="op" id="8532794">.</span><span class="op" id="8532795">(</span><span class="op" id="8532796">*</span><span class="ident" id="8532797">TCPListener</span><span class="op" id="8532808">)</span><span class="op" id="8532809">.</span><span class="ident" id="8532810">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532815">if</span>&nbsp;<span class="ident" id="8532818">fd</span><span class="op" id="8532820">.</span><span class="ident" id="8532821">family</span>&nbsp;<span class="op" id="8532828">!=</span>&nbsp;<span class="ident" id="8532831">syscall</span><span class="op" id="8532838">.</span><span class="ident" id="8532839">AF_INET</span>&nbsp;<span class="op" id="8532847">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532852">t</span><span class="op" id="8532853">.</span><span class="ident" id="8532854">Fatalf</span><span class="op" id="8532860">(</span><span class="string" id="8532861">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8532922">,</span>&nbsp;<span class="ident" id="8532924">net</span><span class="op" id="8532927">,</span>&nbsp;<span class="ident" id="8532929">laddr</span><span class="op" id="8532934">,</span>&nbsp;<span class="ident" id="8532936">fd</span><span class="op" id="8532938">.</span><span class="ident" id="8532939">family</span><span class="op" id="8532945">,</span>&nbsp;<span class="ident" id="8532947">syscall</span><span class="op" id="8532954">.</span><span class="ident" id="8532955">AF_INET</span><span class="op" id="8532962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8532966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8532969">case</span>&nbsp;<span class="string" id="8532974">&#34;tcp6&#34;</span><span class="op" id="8532980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8532984">fd</span>&nbsp;<span class="op" id="8532987">:=</span>&nbsp;<span class="ident" id="8532990">l</span><span class="op" id="8532991">.</span><span class="op" id="8532992">(</span><span class="op" id="8532993">*</span><span class="ident" id="8532994">TCPListener</span><span class="op" id="8533005">)</span><span class="op" id="8533006">.</span><span class="ident" id="8533007">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533012">if</span>&nbsp;<span class="ident" id="8533015">fd</span><span class="op" id="8533017">.</span><span class="ident" id="8533018">family</span>&nbsp;<span class="op" id="8533025">!=</span>&nbsp;<span class="ident" id="8533028">syscall</span><span class="op" id="8533035">.</span><span class="ident" id="8533036">AF_INET6</span>&nbsp;<span class="op" id="8533045">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533050">t</span><span class="op" id="8533051">.</span><span class="ident" id="8533052">Fatalf</span><span class="op" id="8533058">(</span><span class="string" id="8533059">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8533120">,</span>&nbsp;<span class="ident" id="8533122">net</span><span class="op" id="8533125">,</span>&nbsp;<span class="ident" id="8533127">laddr</span><span class="op" id="8533132">,</span>&nbsp;<span class="ident" id="8533134">fd</span><span class="op" id="8533136">.</span><span class="ident" id="8533137">family</span><span class="op" id="8533143">,</span>&nbsp;<span class="ident" id="8533145">syscall</span><span class="op" id="8533152">.</span><span class="ident" id="8533153">AF_INET6</span><span class="op" id="8533161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8533165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533168">case</span>&nbsp;<span class="string" id="8533173">&#34;udp&#34;</span><span class="op" id="8533178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533182">fd</span>&nbsp;<span class="op" id="8533185">:=</span>&nbsp;<span class="ident" id="8533188">l</span><span class="op" id="8533189">.</span><span class="op" id="8533190">(</span><span class="op" id="8533191">*</span><span class="ident" id="8533192">UDPConn</span><span class="op" id="8533199">)</span><span class="op" id="8533200">.</span><span class="ident" id="8533201">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533206">checkDualStackAddrFamily</span><span class="op" id="8533230">(</span><span class="ident" id="8533231">t</span><span class="op" id="8533232">,</span>&nbsp;<span class="ident" id="8533234">net</span><span class="op" id="8533237">,</span>&nbsp;<span class="ident" id="8533239">laddr</span><span class="op" id="8533244">,</span>&nbsp;<span class="ident" id="8533246">fd</span><span class="op" id="8533248">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533251">case</span>&nbsp;<span class="string" id="8533256">&#34;udp4&#34;</span><span class="op" id="8533262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533266">fd</span>&nbsp;<span class="op" id="8533269">:=</span>&nbsp;<span class="ident" id="8533272">l</span><span class="op" id="8533273">.</span><span class="op" id="8533274">(</span><span class="op" id="8533275">*</span><span class="ident" id="8533276">UDPConn</span><span class="op" id="8533283">)</span><span class="op" id="8533284">.</span><span class="ident" id="8533285">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533290">if</span>&nbsp;<span class="ident" id="8533293">fd</span><span class="op" id="8533295">.</span><span class="ident" id="8533296">family</span>&nbsp;<span class="op" id="8533303">!=</span>&nbsp;<span class="ident" id="8533306">syscall</span><span class="op" id="8533313">.</span><span class="ident" id="8533314">AF_INET</span>&nbsp;<span class="op" id="8533322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533327">t</span><span class="op" id="8533328">.</span><span class="ident" id="8533329">Fatalf</span><span class="op" id="8533335">(</span><span class="string" id="8533336">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8533403">,</span>&nbsp;<span class="ident" id="8533405">net</span><span class="op" id="8533408">,</span>&nbsp;<span class="ident" id="8533410">laddr</span><span class="op" id="8533415">,</span>&nbsp;<span class="ident" id="8533417">fd</span><span class="op" id="8533419">.</span><span class="ident" id="8533420">family</span><span class="op" id="8533426">,</span>&nbsp;<span class="ident" id="8533428">syscall</span><span class="op" id="8533435">.</span><span class="ident" id="8533436">AF_INET</span><span class="op" id="8533443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8533447">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533450">case</span>&nbsp;<span class="string" id="8533455">&#34;udp6&#34;</span><span class="op" id="8533461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533465">fd</span>&nbsp;<span class="op" id="8533468">:=</span>&nbsp;<span class="ident" id="8533471">l</span><span class="op" id="8533472">.</span><span class="op" id="8533473">(</span><span class="op" id="8533474">*</span><span class="ident" id="8533475">UDPConn</span><span class="op" id="8533482">)</span><span class="op" id="8533483">.</span><span class="ident" id="8533484">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533489">if</span>&nbsp;<span class="ident" id="8533492">fd</span><span class="op" id="8533494">.</span><span class="ident" id="8533495">family</span>&nbsp;<span class="op" id="8533502">!=</span>&nbsp;<span class="ident" id="8533505">syscall</span><span class="op" id="8533512">.</span><span class="ident" id="8533513">AF_INET6</span>&nbsp;<span class="op" id="8533522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533527">t</span><span class="op" id="8533528">.</span><span class="ident" id="8533529">Fatalf</span><span class="op" id="8533535">(</span><span class="string" id="8533536">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8533603">,</span>&nbsp;<span class="ident" id="8533605">net</span><span class="op" id="8533608">,</span>&nbsp;<span class="ident" id="8533610">laddr</span><span class="op" id="8533615">,</span>&nbsp;<span class="ident" id="8533617">fd</span><span class="op" id="8533619">.</span><span class="ident" id="8533620">family</span><span class="op" id="8533626">,</span>&nbsp;<span class="ident" id="8533628">syscall</span><span class="op" id="8533635">.</span><span class="ident" id="8533636">AF_INET6</span><span class="op" id="8533644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8533648">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533651">default</span><span class="op" id="8533658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533662">t</span><span class="op" id="8533663">.</span><span class="ident" id="8533664">Fatalf</span><span class="op" id="8533670">(</span><span class="string" id="8533671">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8533695">,</span>&nbsp;<span class="ident" id="8533697">net</span><span class="op" id="8533700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8533703">}</span><br>
<span class="lineno"></span><span class="op" id="8533705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="8533708">func</span>&nbsp;<span class="ident" id="8533713">checkSecondListener</span><span class="op" id="8533732">(</span><span class="ident" id="8533733">t</span>&nbsp;<span class="op" id="8533735">*</span><span class="ident" id="8533736">testing</span><span class="op" id="8533743">.</span><span class="ident" id="8533744">T</span><span class="op" id="8533745">,</span>&nbsp;<span class="ident" id="8533747">net</span><span class="op" id="8533750">,</span>&nbsp;<span class="ident" id="8533752">laddr</span>&nbsp;<span class="builtintype" id="8533758">string</span><span class="op" id="8533764">,</span>&nbsp;<span class="ident" id="8533766">err</span>&nbsp;<span class="builtintype" id="8533770">error</span><span class="op" id="8533775">,</span>&nbsp;<span class="ident" id="8533777">l</span>&nbsp;<span class="keyword" id="8533779">interface</span><span class="op" id="8533788">{</span><span class="op" id="8533789">}</span><span class="op" id="8533790">)</span>&nbsp;<span class="op" id="8533792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533795">switch</span>&nbsp;<span class="ident" id="8533802">net</span>&nbsp;<span class="op" id="8533806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533809">case</span>&nbsp;<span class="string" id="8533814">&#34;tcp&#34;</span><span class="op" id="8533819">,</span>&nbsp;<span class="string" id="8533821">&#34;tcp4&#34;</span><span class="op" id="8533827">,</span>&nbsp;<span class="string" id="8533829">&#34;tcp6&#34;</span><span class="op" id="8533835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533839">if</span>&nbsp;<span class="ident" id="8533842">err</span>&nbsp;<span class="op" id="8533846">==</span>&nbsp;<span class="ident" id="8533849">nil</span>&nbsp;<span class="op" id="8533853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533858">l</span><span class="op" id="8533859">.</span><span class="op" id="8533860">(</span><span class="op" id="8533861">*</span><span class="ident" id="8533862">TCPListener</span><span class="op" id="8533873">)</span><span class="op" id="8533874">.</span><span class="ident" id="8533875">Close</span><span class="op" id="8533880">(</span><span class="op" id="8533881">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533886">t</span><span class="op" id="8533887">.</span><span class="ident" id="8533888">Fatalf</span><span class="op" id="8533894">(</span><span class="string" id="8533895">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8533930">,</span>&nbsp;<span class="ident" id="8533932">net</span><span class="op" id="8533935">,</span>&nbsp;<span class="ident" id="8533937">laddr</span><span class="op" id="8533942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8533946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533949">case</span>&nbsp;<span class="string" id="8533954">&#34;udp&#34;</span><span class="op" id="8533959">,</span>&nbsp;<span class="string" id="8533961">&#34;udp4&#34;</span><span class="op" id="8533967">,</span>&nbsp;<span class="string" id="8533969">&#34;udp6&#34;</span><span class="op" id="8533975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8533979">if</span>&nbsp;<span class="ident" id="8533982">err</span>&nbsp;<span class="op" id="8533986">==</span>&nbsp;<span class="ident" id="8533989">nil</span>&nbsp;<span class="op" id="8533993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8533998">l</span><span class="op" id="8533999">.</span><span class="op" id="8534000">(</span><span class="op" id="8534001">*</span><span class="ident" id="8534002">UDPConn</span><span class="op" id="8534009">)</span><span class="op" id="8534010">.</span><span class="ident" id="8534011">Close</span><span class="op" id="8534016">(</span><span class="op" id="8534017">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534022">t</span><span class="op" id="8534023">.</span><span class="ident" id="8534024">Fatalf</span><span class="op" id="8534030">(</span><span class="string" id="8534031">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8534072">,</span>&nbsp;<span class="ident" id="8534074">net</span><span class="op" id="8534077">,</span>&nbsp;<span class="ident" id="8534079">laddr</span><span class="op" id="8534084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534091">default</span><span class="op" id="8534098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534102">t</span><span class="op" id="8534103">.</span><span class="ident" id="8534104">Fatalf</span><span class="op" id="8534110">(</span><span class="string" id="8534111">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8534135">,</span>&nbsp;<span class="ident" id="8534137">net</span><span class="op" id="8534140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534143">}</span><br>
<span class="lineno">350</span><span class="op" id="8534145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8534148">func</span>&nbsp;<span class="ident" id="8534153">checkDualStackSecondListener</span><span class="op" id="8534181">(</span><span class="ident" id="8534182">t</span>&nbsp;<span class="op" id="8534184">*</span><span class="ident" id="8534185">testing</span><span class="op" id="8534192">.</span><span class="ident" id="8534193">T</span><span class="op" id="8534194">,</span>&nbsp;<span class="ident" id="8534196">net</span><span class="op" id="8534199">,</span>&nbsp;<span class="ident" id="8534201">laddr</span>&nbsp;<span class="builtintype" id="8534207">string</span><span class="op" id="8534213">,</span>&nbsp;<span class="ident" id="8534215">xerr</span><span class="op" id="8534219">,</span>&nbsp;<span class="ident" id="8534221">err</span>&nbsp;<span class="builtintype" id="8534225">error</span><span class="op" id="8534230">,</span>&nbsp;<span class="ident" id="8534232">l</span>&nbsp;<span class="keyword" id="8534234">interface</span><span class="op" id="8534243">{</span><span class="op" id="8534244">}</span><span class="op" id="8534245">)</span>&nbsp;<span class="op" id="8534247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534250">switch</span>&nbsp;<span class="ident" id="8534257">net</span>&nbsp;<span class="op" id="8534261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534264">case</span>&nbsp;<span class="string" id="8534269">&#34;tcp&#34;</span><span class="op" id="8534274">,</span>&nbsp;<span class="string" id="8534276">&#34;tcp4&#34;</span><span class="op" id="8534282">,</span>&nbsp;<span class="string" id="8534284">&#34;tcp6&#34;</span><span class="op" id="8534290">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534294">if</span>&nbsp;<span class="ident" id="8534297">xerr</span>&nbsp;<span class="op" id="8534302">==</span>&nbsp;<span class="ident" id="8534305">nil</span>&nbsp;<span class="op" id="8534309">&amp;&amp;</span>&nbsp;<span class="ident" id="8534312">err</span>&nbsp;<span class="op" id="8534316">!=</span>&nbsp;<span class="ident" id="8534319">nil</span>&nbsp;<span class="op" id="8534323">||</span>&nbsp;<span class="ident" id="8534326">xerr</span>&nbsp;<span class="op" id="8534331">!=</span>&nbsp;<span class="ident" id="8534334">nil</span>&nbsp;<span class="op" id="8534338">&amp;&amp;</span>&nbsp;<span class="ident" id="8534341">err</span>&nbsp;<span class="op" id="8534345">==</span>&nbsp;<span class="ident" id="8534348">nil</span>&nbsp;<span class="op" id="8534352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534357">t</span><span class="op" id="8534358">.</span><span class="ident" id="8534359">Fatalf</span><span class="op" id="8534365">(</span><span class="string" id="8534366">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8534413">,</span>&nbsp;<span class="ident" id="8534415">net</span><span class="op" id="8534418">,</span>&nbsp;<span class="ident" id="8534420">laddr</span><span class="op" id="8534425">,</span>&nbsp;<span class="ident" id="8534427">err</span><span class="op" id="8534430">,</span>&nbsp;<span class="ident" id="8534432">xerr</span><span class="op" id="8534436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534444">if</span>&nbsp;<span class="ident" id="8534447">err</span>&nbsp;<span class="op" id="8534451">==</span>&nbsp;<span class="ident" id="8534454">nil</span>&nbsp;<span class="op" id="8534458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534463">l</span><span class="op" id="8534464">.</span><span class="op" id="8534465">(</span><span class="op" id="8534466">*</span><span class="ident" id="8534467">TCPListener</span><span class="op" id="8534478">)</span><span class="op" id="8534479">.</span><span class="ident" id="8534480">Close</span><span class="op" id="8534485">(</span><span class="op" id="8534486">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534493">case</span>&nbsp;<span class="string" id="8534498">&#34;udp&#34;</span><span class="op" id="8534503">,</span>&nbsp;<span class="string" id="8534505">&#34;udp4&#34;</span><span class="op" id="8534511">,</span>&nbsp;<span class="string" id="8534513">&#34;udp6&#34;</span><span class="op" id="8534519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534523">if</span>&nbsp;<span class="ident" id="8534526">xerr</span>&nbsp;<span class="op" id="8534531">==</span>&nbsp;<span class="ident" id="8534534">nil</span>&nbsp;<span class="op" id="8534538">&amp;&amp;</span>&nbsp;<span class="ident" id="8534541">err</span>&nbsp;<span class="op" id="8534545">!=</span>&nbsp;<span class="ident" id="8534548">nil</span>&nbsp;<span class="op" id="8534552">||</span>&nbsp;<span class="ident" id="8534555">xerr</span>&nbsp;<span class="op" id="8534560">!=</span>&nbsp;<span class="ident" id="8534563">nil</span>&nbsp;<span class="op" id="8534567">&amp;&amp;</span>&nbsp;<span class="ident" id="8534570">err</span>&nbsp;<span class="op" id="8534574">==</span>&nbsp;<span class="ident" id="8534577">nil</span>&nbsp;<span class="op" id="8534581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534586">t</span><span class="op" id="8534587">.</span><span class="ident" id="8534588">Fatalf</span><span class="op" id="8534594">(</span><span class="string" id="8534595">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8534648">,</span>&nbsp;<span class="ident" id="8534650">net</span><span class="op" id="8534653">,</span>&nbsp;<span class="ident" id="8534655">laddr</span><span class="op" id="8534660">,</span>&nbsp;<span class="ident" id="8534662">err</span><span class="op" id="8534665">,</span>&nbsp;<span class="ident" id="8534667">xerr</span><span class="op" id="8534671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534675">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534679">if</span>&nbsp;<span class="ident" id="8534682">err</span>&nbsp;<span class="op" id="8534686">==</span>&nbsp;<span class="ident" id="8534689">nil</span>&nbsp;<span class="op" id="8534693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534698">l</span><span class="op" id="8534699">.</span><span class="op" id="8534700">(</span><span class="op" id="8534701">*</span><span class="ident" id="8534702">UDPConn</span><span class="op" id="8534709">)</span><span class="op" id="8534710">.</span><span class="ident" id="8534711">Close</span><span class="op" id="8534716">(</span><span class="op" id="8534717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534724">default</span><span class="op" id="8534731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8534735">t</span><span class="op" id="8534736">.</span><span class="ident" id="8534737">Fatalf</span><span class="op" id="8534743">(</span><span class="string" id="8534744">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8534768">,</span>&nbsp;<span class="ident" id="8534770">net</span><span class="op" id="8534773">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8534776">}</span><br>
<span class="lineno"></span><span class="op" id="8534778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8534781">func</span>&nbsp;<span class="ident" id="8534786">checkDualStackAddrFamily</span><span class="op" id="8534810">(</span><span class="ident" id="8534811">t</span>&nbsp;<span class="op" id="8534813">*</span><span class="ident" id="8534814">testing</span><span class="op" id="8534821">.</span><span class="ident" id="8534822">T</span><span class="op" id="8534823">,</span>&nbsp;<span class="ident" id="8534825">net</span><span class="op" id="8534828">,</span>&nbsp;<span class="ident" id="8534830">laddr</span>&nbsp;<span class="builtintype" id="8534836">string</span><span class="op" id="8534842">,</span>&nbsp;<span class="ident" id="8534844">fd</span>&nbsp;<span class="op" id="8534847">*</span><span class="ident" id="8534848">netFD</span><span class="op" id="8534853">)</span>&nbsp;<span class="op" id="8534855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534858">switch</span>&nbsp;<span class="ident" id="8534865">a</span>&nbsp;<span class="op" id="8534867">:=</span>&nbsp;<span class="ident" id="8534870">fd</span><span class="op" id="8534872">.</span><span class="ident" id="8534873">laddr</span><span class="op" id="8534878">.</span><span class="op" id="8534879">(</span><span class="keyword" id="8534880">type</span><span class="op" id="8534884">)</span>&nbsp;<span class="op" id="8534886">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8534889">case</span>&nbsp;<span class="op" id="8534894">*</span><span class="ident" id="8534895">TCPAddr</span><span class="op" id="8534902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8534906">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8534962">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535015">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535072">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535094">if</span>&nbsp;<span class="ident" id="8535097">supportsIPv4map</span>&nbsp;<span class="op" id="8535113">&amp;&amp;</span>&nbsp;<span class="ident" id="8535116">fd</span><span class="op" id="8535118">.</span><span class="ident" id="8535119">laddr</span><span class="op" id="8535124">.</span><span class="op" id="8535125">(</span><span class="op" id="8535126">*</span><span class="ident" id="8535127">TCPAddr</span><span class="op" id="8535134">)</span><span class="op" id="8535135">.</span><span class="ident" id="8535136">isWildcard</span><span class="op" id="8535146">(</span><span class="op" id="8535147">)</span>&nbsp;<span class="op" id="8535149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535154">if</span>&nbsp;<span class="ident" id="8535157">fd</span><span class="op" id="8535159">.</span><span class="ident" id="8535160">family</span>&nbsp;<span class="op" id="8535167">!=</span>&nbsp;<span class="ident" id="8535170">syscall</span><span class="op" id="8535177">.</span><span class="ident" id="8535178">AF_INET6</span>&nbsp;<span class="op" id="8535187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8535193">t</span><span class="op" id="8535194">.</span><span class="ident" id="8535195">Fatalf</span><span class="op" id="8535201">(</span><span class="string" id="8535202">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8535257">,</span>&nbsp;<span class="ident" id="8535259">net</span><span class="op" id="8535262">,</span>&nbsp;<span class="ident" id="8535264">laddr</span><span class="op" id="8535269">,</span>&nbsp;<span class="ident" id="8535271">fd</span><span class="op" id="8535273">.</span><span class="ident" id="8535274">family</span><span class="op" id="8535280">,</span>&nbsp;<span class="ident" id="8535282">syscall</span><span class="op" id="8535289">.</span><span class="ident" id="8535290">AF_INET6</span><span class="op" id="8535298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535307">}</span>&nbsp;<span class="keyword" id="8535309">else</span>&nbsp;<span class="op" id="8535314">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535319">if</span>&nbsp;<span class="ident" id="8535322">fd</span><span class="op" id="8535324">.</span><span class="ident" id="8535325">family</span>&nbsp;<span class="op" id="8535332">!=</span>&nbsp;<span class="ident" id="8535335">a</span><span class="op" id="8535336">.</span><span class="ident" id="8535337">family</span><span class="op" id="8535343">(</span><span class="op" id="8535344">)</span>&nbsp;<span class="op" id="8535346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8535352">t</span><span class="op" id="8535353">.</span><span class="ident" id="8535354">Fatalf</span><span class="op" id="8535360">(</span><span class="string" id="8535361">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8535416">,</span>&nbsp;<span class="ident" id="8535418">net</span><span class="op" id="8535421">,</span>&nbsp;<span class="ident" id="8535423">laddr</span><span class="op" id="8535428">,</span>&nbsp;<span class="ident" id="8535430">fd</span><span class="op" id="8535432">.</span><span class="ident" id="8535433">family</span><span class="op" id="8535439">,</span>&nbsp;<span class="ident" id="8535441">a</span><span class="op" id="8535442">.</span><span class="ident" id="8535443">family</span><span class="op" id="8535449">(</span><span class="op" id="8535450">)</span><span class="op" id="8535451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535463">case</span>&nbsp;<span class="op" id="8535468">*</span><span class="ident" id="8535469">UDPAddr</span><span class="op" id="8535476">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535480">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535536">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535589">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8535646">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535668">if</span>&nbsp;<span class="ident" id="8535671">supportsIPv4map</span>&nbsp;<span class="op" id="8535687">&amp;&amp;</span>&nbsp;<span class="ident" id="8535690">fd</span><span class="op" id="8535692">.</span><span class="ident" id="8535693">laddr</span><span class="op" id="8535698">.</span><span class="op" id="8535699">(</span><span class="op" id="8535700">*</span><span class="ident" id="8535701">UDPAddr</span><span class="op" id="8535708">)</span><span class="op" id="8535709">.</span><span class="ident" id="8535710">isWildcard</span><span class="op" id="8535720">(</span><span class="op" id="8535721">)</span>&nbsp;<span class="op" id="8535723">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535728">if</span>&nbsp;<span class="ident" id="8535731">fd</span><span class="op" id="8535733">.</span><span class="ident" id="8535734">family</span>&nbsp;<span class="op" id="8535741">!=</span>&nbsp;<span class="ident" id="8535744">syscall</span><span class="op" id="8535751">.</span><span class="ident" id="8535752">AF_INET6</span>&nbsp;<span class="op" id="8535761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8535767">t</span><span class="op" id="8535768">.</span><span class="ident" id="8535769">Fatalf</span><span class="op" id="8535775">(</span><span class="string" id="8535776">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8535837">,</span>&nbsp;<span class="ident" id="8535839">net</span><span class="op" id="8535842">,</span>&nbsp;<span class="ident" id="8535844">laddr</span><span class="op" id="8535849">,</span>&nbsp;<span class="ident" id="8535851">fd</span><span class="op" id="8535853">.</span><span class="ident" id="8535854">family</span><span class="op" id="8535860">,</span>&nbsp;<span class="ident" id="8535862">syscall</span><span class="op" id="8535869">.</span><span class="ident" id="8535870">AF_INET6</span><span class="op" id="8535878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8535887">}</span>&nbsp;<span class="keyword" id="8535889">else</span>&nbsp;<span class="op" id="8535894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8535899">if</span>&nbsp;<span class="ident" id="8535902">fd</span><span class="op" id="8535904">.</span><span class="ident" id="8535905">family</span>&nbsp;<span class="op" id="8535912">!=</span>&nbsp;<span class="ident" id="8535915">a</span><span class="op" id="8535916">.</span><span class="ident" id="8535917">family</span><span class="op" id="8535923">(</span><span class="op" id="8535924">)</span>&nbsp;<span class="op" id="8535926">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8535932">t</span><span class="op" id="8535933">.</span><span class="ident" id="8535934">Fatalf</span><span class="op" id="8535940">(</span><span class="string" id="8535941">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8536002">,</span>&nbsp;<span class="ident" id="8536004">net</span><span class="op" id="8536007">,</span>&nbsp;<span class="ident" id="8536009">laddr</span><span class="op" id="8536014">,</span>&nbsp;<span class="ident" id="8536016">fd</span><span class="op" id="8536018">.</span><span class="ident" id="8536019">family</span><span class="op" id="8536025">,</span>&nbsp;<span class="ident" id="8536027">a</span><span class="op" id="8536028">.</span><span class="ident" id="8536029">family</span><span class="op" id="8536035">(</span><span class="op" id="8536036">)</span><span class="op" id="8536037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536049">default</span><span class="op" id="8536056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536060">t</span><span class="op" id="8536061">.</span><span class="ident" id="8536062">Fatalf</span><span class="op" id="8536068">(</span><span class="string" id="8536069">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="8536107">,</span>&nbsp;<span class="ident" id="8536109">a</span><span class="op" id="8536110">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536113">}</span><br>
<span class="lineno"></span><span class="op" id="8536115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8536118">var</span>&nbsp;<span class="ident" id="8536122">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8536149">=</span>&nbsp;<span class="op" id="8536151">[</span><span class="op" id="8536152">]</span><span class="keyword" id="8536153">struct</span>&nbsp;<span class="op" id="8536160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536163">net</span>&nbsp;&nbsp;<span class="builtintype" id="8536168">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536176">addr</span>&nbsp;<span class="builtintype" id="8536181">string</span><br>
<span class="lineno"></span><span class="op" id="8536188">}</span><span class="op" id="8536189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536192">{</span><span class="string" id="8536193">&#34;tcp6&#34;</span><span class="op" id="8536199">,</span>&nbsp;<span class="string" id="8536201">&#34;127.0.0.1&#34;</span><span class="op" id="8536212">}</span><span class="op" id="8536213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536216">{</span><span class="string" id="8536217">&#34;tcp6&#34;</span><span class="op" id="8536223">,</span>&nbsp;<span class="string" id="8536225">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8536245">}</span><span class="op" id="8536246">,</span><br>
<span class="lineno"></span><span class="op" id="8536248">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="8536251">func</span>&nbsp;<span class="ident" id="8536256">TestProhibitionaryDialArgs</span><span class="op" id="8536282">(</span><span class="ident" id="8536283">t</span>&nbsp;<span class="op" id="8536285">*</span><span class="ident" id="8536286">testing</span><span class="op" id="8536293">.</span><span class="ident" id="8536294">T</span><span class="op" id="8536295">)</span>&nbsp;<span class="op" id="8536297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536300">switch</span>&nbsp;<span class="ident" id="8536307">runtime</span><span class="op" id="8536314">.</span><span class="ident" id="8536315">GOOS</span>&nbsp;<span class="op" id="8536320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536323">case</span>&nbsp;<span class="string" id="8536328">&#34;plan9&#34;</span><span class="op" id="8536335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536339">t</span><span class="op" id="8536340">.</span><span class="ident" id="8536341">Skipf</span><span class="op" id="8536346">(</span><span class="string" id="8536347">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8536368">,</span>&nbsp;<span class="ident" id="8536370">runtime</span><span class="op" id="8536377">.</span><span class="ident" id="8536378">GOOS</span><span class="op" id="8536382">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8536388">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536458">if</span>&nbsp;<span class="op" id="8536461">!</span><span class="ident" id="8536462">supportsIPv4map</span>&nbsp;<span class="op" id="8536478">||</span>&nbsp;<span class="ident" id="8536481">testing</span><span class="op" id="8536488">.</span><span class="ident" id="8536489">Short</span><span class="op" id="8536494">(</span><span class="op" id="8536495">)</span>&nbsp;<span class="op" id="8536497">||</span>&nbsp;<span class="op" id="8536500">!</span><span class="op" id="8536501">*</span><span class="ident" id="8536502">testExternal</span>&nbsp;<span class="op" id="8536515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536519">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536527">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536531">l</span><span class="op" id="8536532">,</span>&nbsp;<span class="ident" id="8536534">port</span>&nbsp;<span class="op" id="8536539">:=</span>&nbsp;<span class="ident" id="8536542">usableListenPort</span><span class="op" id="8536558">(</span><span class="ident" id="8536559">t</span><span class="op" id="8536560">,</span>&nbsp;<span class="string" id="8536562">&#34;tcp&#34;</span><span class="op" id="8536567">,</span>&nbsp;<span class="string" id="8536569">&#34;[::]&#34;</span><span class="op" id="8536575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536578">defer</span>&nbsp;<span class="ident" id="8536584">l</span><span class="op" id="8536585">.</span><span class="ident" id="8536586">Close</span><span class="op" id="8536591">(</span><span class="op" id="8536592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536596">for</span>&nbsp;<span class="ident" id="8536600">_</span><span class="op" id="8536601">,</span>&nbsp;<span class="ident" id="8536603">tt</span>&nbsp;<span class="op" id="8536606">:=</span>&nbsp;<span class="keyword" id="8536609">range</span>&nbsp;<span class="ident" id="8536615">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8536642">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536646">c</span><span class="op" id="8536647">,</span>&nbsp;<span class="ident" id="8536649">err</span>&nbsp;<span class="op" id="8536653">:=</span>&nbsp;<span class="ident" id="8536656">Dial</span><span class="op" id="8536660">(</span><span class="ident" id="8536661">tt</span><span class="op" id="8536663">.</span><span class="ident" id="8536664">net</span><span class="op" id="8536667">,</span>&nbsp;<span class="ident" id="8536669">tt</span><span class="op" id="8536671">.</span><span class="ident" id="8536672">addr</span><span class="op" id="8536676">+</span><span class="string" id="8536677">&#34;:&#34;</span><span class="op" id="8536680">+</span><span class="ident" id="8536681">port</span><span class="op" id="8536685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536689">if</span>&nbsp;<span class="ident" id="8536692">err</span>&nbsp;<span class="op" id="8536696">==</span>&nbsp;<span class="ident" id="8536699">nil</span>&nbsp;<span class="op" id="8536703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536708">c</span><span class="op" id="8536709">.</span><span class="ident" id="8536710">Close</span><span class="op" id="8536715">(</span><span class="op" id="8536716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536721">t</span><span class="op" id="8536722">.</span><span class="ident" id="8536723">Fatalf</span><span class="op" id="8536729">(</span><span class="string" id="8536730">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8536756">,</span>&nbsp;<span class="ident" id="8536758">tt</span><span class="op" id="8536760">.</span><span class="ident" id="8536761">net</span><span class="op" id="8536764">,</span>&nbsp;<span class="ident" id="8536766">tt</span><span class="op" id="8536768">.</span><span class="ident" id="8536769">addr</span><span class="op" id="8536773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536777">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536780">}</span><br>
<span class="lineno"></span><span class="op" id="8536782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8536785">func</span>&nbsp;<span class="ident" id="8536790">TestWildWildcardListener</span><span class="op" id="8536814">(</span><span class="ident" id="8536815">t</span>&nbsp;<span class="op" id="8536817">*</span><span class="ident" id="8536818">testing</span><span class="op" id="8536825">.</span><span class="ident" id="8536826">T</span><span class="op" id="8536827">)</span>&nbsp;<span class="op" id="8536829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536832">switch</span>&nbsp;<span class="ident" id="8536839">runtime</span><span class="op" id="8536846">.</span><span class="ident" id="8536847">GOOS</span>&nbsp;<span class="op" id="8536852">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536855">case</span>&nbsp;<span class="string" id="8536860">&#34;plan9&#34;</span><span class="op" id="8536867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536871">t</span><span class="op" id="8536872">.</span><span class="ident" id="8536873">Skipf</span><span class="op" id="8536878">(</span><span class="string" id="8536879">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8536900">,</span>&nbsp;<span class="ident" id="8536902">runtime</span><span class="op" id="8536909">.</span><span class="ident" id="8536910">GOOS</span><span class="op" id="8536914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8536917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8536921">if</span>&nbsp;<span class="ident" id="8536924">testing</span><span class="op" id="8536931">.</span><span class="ident" id="8536932">Short</span><span class="op" id="8536937">(</span><span class="op" id="8536938">)</span>&nbsp;<span class="op" id="8536940">||</span>&nbsp;<span class="op" id="8536943">!</span><span class="op" id="8536944">*</span><span class="ident" id="8536945">testExternal</span>&nbsp;<span class="op" id="8536958">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8536962">t</span><span class="op" id="8536963">.</span><span class="ident" id="8536964">Skip</span><span class="op" id="8536968">(</span><span class="string" id="8536969">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8537010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537017">defer</span>&nbsp;<span class="keyword" id="8537023">func</span><span class="op" id="8537027">(</span><span class="op" id="8537028">)</span>&nbsp;<span class="op" id="8537030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537034">if</span>&nbsp;<span class="ident" id="8537037">p</span>&nbsp;<span class="op" id="8537039">:=</span>&nbsp;<span class="builtinfunc" id="8537042">recover</span><span class="op" id="8537049">(</span><span class="op" id="8537050">)</span><span class="op" id="8537051">;</span>&nbsp;<span class="ident" id="8537053">p</span>&nbsp;<span class="op" id="8537055">!=</span>&nbsp;<span class="ident" id="8537058">nil</span>&nbsp;<span class="op" id="8537062">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537067">t</span><span class="op" id="8537068">.</span><span class="ident" id="8537069">Fatalf</span><span class="op" id="8537075">(</span><span class="string" id="8537076">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8537139">,</span>&nbsp;<span class="ident" id="8537141">p</span><span class="op" id="8537142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537149">}</span><span class="op" id="8537150">(</span><span class="op" id="8537151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537155">if</span>&nbsp;<span class="ident" id="8537158">ln</span><span class="op" id="8537160">,</span>&nbsp;<span class="ident" id="8537162">err</span>&nbsp;<span class="op" id="8537166">:=</span>&nbsp;<span class="ident" id="8537169">Listen</span><span class="op" id="8537175">(</span><span class="string" id="8537176">&#34;tcp&#34;</span><span class="op" id="8537181">,</span>&nbsp;<span class="string" id="8537183">&#34;&#34;</span><span class="op" id="8537185">)</span><span class="op" id="8537186">;</span>&nbsp;<span class="ident" id="8537188">err</span>&nbsp;<span class="op" id="8537192">==</span>&nbsp;<span class="ident" id="8537195">nil</span>&nbsp;<span class="op" id="8537199">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537203">ln</span><span class="op" id="8537205">.</span><span class="ident" id="8537206">Close</span><span class="op" id="8537211">(</span><span class="op" id="8537212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537218">if</span>&nbsp;<span class="ident" id="8537221">ln</span><span class="op" id="8537223">,</span>&nbsp;<span class="ident" id="8537225">err</span>&nbsp;<span class="op" id="8537229">:=</span>&nbsp;<span class="ident" id="8537232">ListenPacket</span><span class="op" id="8537244">(</span><span class="string" id="8537245">&#34;udp&#34;</span><span class="op" id="8537250">,</span>&nbsp;<span class="string" id="8537252">&#34;&#34;</span><span class="op" id="8537254">)</span><span class="op" id="8537255">;</span>&nbsp;<span class="ident" id="8537257">err</span>&nbsp;<span class="op" id="8537261">==</span>&nbsp;<span class="ident" id="8537264">nil</span>&nbsp;<span class="op" id="8537268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537272">ln</span><span class="op" id="8537274">.</span><span class="ident" id="8537275">Close</span><span class="op" id="8537280">(</span><span class="op" id="8537281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537284">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537287">if</span>&nbsp;<span class="ident" id="8537290">ln</span><span class="op" id="8537292">,</span>&nbsp;<span class="ident" id="8537294">err</span>&nbsp;<span class="op" id="8537298">:=</span>&nbsp;<span class="ident" id="8537301">ListenTCP</span><span class="op" id="8537310">(</span><span class="string" id="8537311">&#34;tcp&#34;</span><span class="op" id="8537316">,</span>&nbsp;<span class="ident" id="8537318">nil</span><span class="op" id="8537321">)</span><span class="op" id="8537322">;</span>&nbsp;<span class="ident" id="8537324">err</span>&nbsp;<span class="op" id="8537328">==</span>&nbsp;<span class="ident" id="8537331">nil</span>&nbsp;<span class="op" id="8537335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537339">ln</span><span class="op" id="8537341">.</span><span class="ident" id="8537342">Close</span><span class="op" id="8537347">(</span><span class="op" id="8537348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537354">if</span>&nbsp;<span class="ident" id="8537357">ln</span><span class="op" id="8537359">,</span>&nbsp;<span class="ident" id="8537361">err</span>&nbsp;<span class="op" id="8537365">:=</span>&nbsp;<span class="ident" id="8537368">ListenUDP</span><span class="op" id="8537377">(</span><span class="string" id="8537378">&#34;udp&#34;</span><span class="op" id="8537383">,</span>&nbsp;<span class="ident" id="8537385">nil</span><span class="op" id="8537388">)</span><span class="op" id="8537389">;</span>&nbsp;<span class="ident" id="8537391">err</span>&nbsp;<span class="op" id="8537395">==</span>&nbsp;<span class="ident" id="8537398">nil</span>&nbsp;<span class="op" id="8537402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537406">ln</span><span class="op" id="8537408">.</span><span class="ident" id="8537409">Close</span><span class="op" id="8537414">(</span><span class="op" id="8537415">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537421">if</span>&nbsp;<span class="ident" id="8537424">ln</span><span class="op" id="8537426">,</span>&nbsp;<span class="ident" id="8537428">err</span>&nbsp;<span class="op" id="8537432">:=</span>&nbsp;<span class="ident" id="8537435">ListenIP</span><span class="op" id="8537443">(</span><span class="string" id="8537444">&#34;ip:icmp&#34;</span><span class="op" id="8537453">,</span>&nbsp;<span class="ident" id="8537455">nil</span><span class="op" id="8537458">)</span><span class="op" id="8537459">;</span>&nbsp;<span class="ident" id="8537461">err</span>&nbsp;<span class="op" id="8537465">==</span>&nbsp;<span class="ident" id="8537468">nil</span>&nbsp;<span class="op" id="8537472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537476">ln</span><span class="op" id="8537478">.</span><span class="ident" id="8537479">Close</span><span class="op" id="8537484">(</span><span class="op" id="8537485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537488">}</span><br>
<span class="lineno"></span><span class="op" id="8537490">}</span>
</div>
</body>
</html>
