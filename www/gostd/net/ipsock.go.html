<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3192516">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3192572">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3192626">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3192677">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3192714">package</span>&nbsp;<span class="ident" id="3192722">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3192727">import</span>&nbsp;<span class="op" id="3192734">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3192737">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3192747">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3192754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3192757">var</span>&nbsp;<span class="op" id="3192761">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192764">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192824">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192854">supportsIPv4</span>&nbsp;<span class="builtintype" id="3192867">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192874">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192934">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192964">supportsIPv6</span>&nbsp;<span class="builtintype" id="3192977">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192984">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193042">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193106">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193165">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3193181">bool</span><br>
<span class="lineno"></span><span class="op" id="3193186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193189">func</span>&nbsp;<span class="ident" id="3193194">init</span><span class="op" id="3193198">(</span><span class="op" id="3193199">)</span>&nbsp;<span class="op" id="3193201">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193204">sysInit</span><span class="op" id="3193211">(</span><span class="op" id="3193212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193215">supportsIPv4</span>&nbsp;<span class="op" id="3193228">=</span>&nbsp;<span class="ident" id="3193230">probeIPv4Stack</span><span class="op" id="3193244">(</span><span class="op" id="3193245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193248">supportsIPv6</span><span class="op" id="3193260">,</span>&nbsp;<span class="ident" id="3193262">supportsIPv4map</span>&nbsp;<span class="op" id="3193278">=</span>&nbsp;<span class="ident" id="3193280">probeIPv6Stack</span><span class="op" id="3193294">(</span><span class="op" id="3193295">)</span><br>
<span class="lineno"></span><span class="op" id="3193297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3193300">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3193364">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3193395">type</span>&nbsp;<span class="ident" id="3193400">netaddr</span>&nbsp;<span class="keyword" id="3193408">interface</span>&nbsp;<span class="op" id="3193418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193421">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193483">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193539">toAddr</span><span class="op" id="3193545">(</span><span class="op" id="3193546">)</span>&nbsp;<span class="ident" id="3193548">Addr</span><br>
<span class="lineno"></span><span class="op" id="3193553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193556">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3193620">type</span>&nbsp;<span class="ident" id="3193625">addrList</span>&nbsp;<span class="op" id="3193634">[</span><span class="op" id="3193635">]</span><span class="ident" id="3193636">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3193645">func</span>&nbsp;<span class="op" id="3193650">(</span><span class="ident" id="3193651">al</span>&nbsp;<span class="ident" id="3193654">addrList</span><span class="op" id="3193662">)</span>&nbsp;<span class="ident" id="3193664">toAddr</span><span class="op" id="3193670">(</span><span class="op" id="3193671">)</span>&nbsp;<span class="ident" id="3193673">Addr</span>&nbsp;<span class="op" id="3193678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193681">switch</span>&nbsp;<span class="builtinfunc" id="3193688">len</span><span class="op" id="3193691">(</span><span class="ident" id="3193692">al</span><span class="op" id="3193694">)</span>&nbsp;<span class="op" id="3193696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193699">case</span>&nbsp;<span class="num" id="3193704">0</span><span class="op" id="3193705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193709">return</span>&nbsp;<span class="ident" id="3193716">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193721">case</span>&nbsp;<span class="num" id="3193726">1</span><span class="op" id="3193727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193731">return</span>&nbsp;<span class="ident" id="3193738">al</span><span class="op" id="3193740">[</span><span class="num" id="3193741">0</span><span class="op" id="3193742">]</span><span class="op" id="3193743">.</span><span class="ident" id="3193744">toAddr</span><span class="op" id="3193750">(</span><span class="op" id="3193751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193754">default</span><span class="op" id="3193761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193765">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193816">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193870">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193924">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193942">return</span>&nbsp;<span class="ident" id="3193949">al</span><span class="op" id="3193951">[</span><span class="num" id="3193952">0</span><span class="op" id="3193953">]</span><span class="op" id="3193954">.</span><span class="ident" id="3193955">toAddr</span><span class="op" id="3193961">(</span><span class="op" id="3193962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193965">}</span><br>
<span class="lineno"></span><span class="op" id="3193967">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3193970">var</span>&nbsp;<span class="ident" id="3193974">errNoSuitableAddress</span>&nbsp;<span class="op" id="3193995">=</span>&nbsp;<span class="ident" id="3193997">errors</span><span class="op" id="3194003">.</span><span class="ident" id="3194004">New</span><span class="op" id="3194007">(</span><span class="string" id="3194008">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3194035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3194038">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3194106">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3194174">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3194245">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3194297">func</span>&nbsp;<span class="ident" id="3194302">firstFavoriteAddr</span><span class="op" id="3194319">(</span><span class="ident" id="3194320">filter</span>&nbsp;<span class="keyword" id="3194327">func</span><span class="op" id="3194331">(</span><span class="ident" id="3194332">IP</span><span class="op" id="3194334">)</span>&nbsp;<span class="ident" id="3194336">IP</span><span class="op" id="3194338">,</span>&nbsp;<span class="ident" id="3194340">ips</span>&nbsp;<span class="op" id="3194344">[</span><span class="op" id="3194345">]</span><span class="ident" id="3194346">IP</span><span class="op" id="3194348">,</span>&nbsp;<span class="ident" id="3194350">inetaddr</span>&nbsp;<span class="keyword" id="3194359">func</span><span class="op" id="3194363">(</span><span class="ident" id="3194364">IP</span><span class="op" id="3194366">)</span>&nbsp;<span class="ident" id="3194368">netaddr</span><span class="op" id="3194375">)</span>&nbsp;<span class="op" id="3194377">(</span><span class="ident" id="3194378">netaddr</span><span class="op" id="3194385">,</span>&nbsp;<span class="builtintype" id="3194387">error</span><span class="op" id="3194392">)</span>&nbsp;<span class="op" id="3194394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194397">if</span>&nbsp;<span class="ident" id="3194400">filter</span>&nbsp;<span class="op" id="3194407">!=</span>&nbsp;<span class="ident" id="3194410">nil</span>&nbsp;<span class="op" id="3194414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194418">return</span>&nbsp;<span class="ident" id="3194425">firstSupportedAddr</span><span class="op" id="3194443">(</span><span class="ident" id="3194444">filter</span><span class="op" id="3194450">,</span>&nbsp;<span class="ident" id="3194452">ips</span><span class="op" id="3194455">,</span>&nbsp;<span class="ident" id="3194457">inetaddr</span><span class="op" id="3194465">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194471">var</span>&nbsp;<span class="op" id="3194475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194479">ipv4</span><span class="op" id="3194483">,</span>&nbsp;<span class="ident" id="3194485">ipv6</span><span class="op" id="3194489">,</span>&nbsp;<span class="ident" id="3194491">swap</span>&nbsp;<span class="builtintype" id="3194496">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194503">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194520">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194530">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194533">for</span>&nbsp;<span class="ident" id="3194537">_</span><span class="op" id="3194538">,</span>&nbsp;<span class="ident" id="3194540">ip</span>&nbsp;<span class="op" id="3194543">:=</span>&nbsp;<span class="keyword" id="3194546">range</span>&nbsp;<span class="ident" id="3194552">ips</span>&nbsp;<span class="op" id="3194556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194560">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194614">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194660">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194711">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194767">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194822">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194874">if</span>&nbsp;<span class="ident" id="3194877">ip4</span>&nbsp;<span class="op" id="3194881">:=</span>&nbsp;<span class="ident" id="3194884">ipv4only</span><span class="op" id="3194892">(</span><span class="ident" id="3194893">ip</span><span class="op" id="3194895">)</span><span class="op" id="3194896">;</span>&nbsp;<span class="ident" id="3194898">ip4</span>&nbsp;<span class="op" id="3194902">!=</span>&nbsp;<span class="ident" id="3194905">nil</span>&nbsp;<span class="op" id="3194909">&amp;&amp;</span>&nbsp;<span class="op" id="3194912">!</span><span class="ident" id="3194913">ipv4</span>&nbsp;<span class="op" id="3194918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194923">list</span>&nbsp;<span class="op" id="3194928">=</span>&nbsp;<span class="builtinfunc" id="3194930">append</span><span class="op" id="3194936">(</span><span class="ident" id="3194937">list</span><span class="op" id="3194941">,</span>&nbsp;<span class="ident" id="3194943">inetaddr</span><span class="op" id="3194951">(</span><span class="ident" id="3194952">ip4</span><span class="op" id="3194955">)</span><span class="op" id="3194956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194961">ipv4</span>&nbsp;<span class="op" id="3194966">=</span>&nbsp;<span class="builtintype" id="3194968">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194976">if</span>&nbsp;<span class="ident" id="3194979">ipv6</span>&nbsp;<span class="op" id="3194984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194990">swap</span>&nbsp;<span class="op" id="3194995">=</span>&nbsp;<span class="builtintype" id="3194997">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195009">}</span>&nbsp;<span class="keyword" id="3195011">else</span>&nbsp;<span class="keyword" id="3195016">if</span>&nbsp;<span class="ident" id="3195019">ip6</span>&nbsp;<span class="op" id="3195023">:=</span>&nbsp;<span class="ident" id="3195026">ipv6only</span><span class="op" id="3195034">(</span><span class="ident" id="3195035">ip</span><span class="op" id="3195037">)</span><span class="op" id="3195038">;</span>&nbsp;<span class="ident" id="3195040">ip6</span>&nbsp;<span class="op" id="3195044">!=</span>&nbsp;<span class="ident" id="3195047">nil</span>&nbsp;<span class="op" id="3195051">&amp;&amp;</span>&nbsp;<span class="op" id="3195054">!</span><span class="ident" id="3195055">ipv6</span>&nbsp;<span class="op" id="3195060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195065">list</span>&nbsp;<span class="op" id="3195070">=</span>&nbsp;<span class="builtinfunc" id="3195072">append</span><span class="op" id="3195078">(</span><span class="ident" id="3195079">list</span><span class="op" id="3195083">,</span>&nbsp;<span class="ident" id="3195085">inetaddr</span><span class="op" id="3195093">(</span><span class="ident" id="3195094">ip6</span><span class="op" id="3195097">)</span><span class="op" id="3195098">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195103">ipv6</span>&nbsp;<span class="op" id="3195108">=</span>&nbsp;<span class="builtintype" id="3195110">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195121">if</span>&nbsp;<span class="ident" id="3195124">ipv4</span>&nbsp;<span class="op" id="3195129">&amp;&amp;</span>&nbsp;<span class="ident" id="3195132">ipv6</span>&nbsp;<span class="op" id="3195137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195142">if</span>&nbsp;<span class="ident" id="3195145">swap</span>&nbsp;<span class="op" id="3195150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195156">list</span><span class="op" id="3195160">[</span><span class="num" id="3195161">0</span><span class="op" id="3195162">]</span><span class="op" id="3195163">,</span>&nbsp;<span class="ident" id="3195165">list</span><span class="op" id="3195169">[</span><span class="num" id="3195170">1</span><span class="op" id="3195171">]</span>&nbsp;<span class="op" id="3195173">=</span>&nbsp;<span class="ident" id="3195175">list</span><span class="op" id="3195179">[</span><span class="num" id="3195180">1</span><span class="op" id="3195181">]</span><span class="op" id="3195182">,</span>&nbsp;<span class="ident" id="3195184">list</span><span class="op" id="3195188">[</span><span class="num" id="3195189">0</span><span class="op" id="3195190">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195200">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195214">switch</span>&nbsp;<span class="builtinfunc" id="3195221">len</span><span class="op" id="3195224">(</span><span class="ident" id="3195225">list</span><span class="op" id="3195229">)</span>&nbsp;<span class="op" id="3195231">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195234">case</span>&nbsp;<span class="num" id="3195239">0</span><span class="op" id="3195240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195244">return</span>&nbsp;<span class="ident" id="3195251">nil</span><span class="op" id="3195254">,</span>&nbsp;<span class="ident" id="3195256">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195278">case</span>&nbsp;<span class="num" id="3195283">1</span><span class="op" id="3195284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195288">return</span>&nbsp;<span class="ident" id="3195295">list</span><span class="op" id="3195299">[</span><span class="num" id="3195300">0</span><span class="op" id="3195301">]</span><span class="op" id="3195302">,</span>&nbsp;<span class="ident" id="3195304">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195309">default</span><span class="op" id="3195316">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195320">return</span>&nbsp;<span class="ident" id="3195327">list</span><span class="op" id="3195331">,</span>&nbsp;<span class="ident" id="3195333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195338">}</span><br>
<span class="lineno"></span><span class="op" id="3195340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3195343">func</span>&nbsp;<span class="ident" id="3195348">firstSupportedAddr</span><span class="op" id="3195366">(</span><span class="ident" id="3195367">filter</span>&nbsp;<span class="keyword" id="3195374">func</span><span class="op" id="3195378">(</span><span class="ident" id="3195379">IP</span><span class="op" id="3195381">)</span>&nbsp;<span class="ident" id="3195383">IP</span><span class="op" id="3195385">,</span>&nbsp;<span class="ident" id="3195387">ips</span>&nbsp;<span class="op" id="3195391">[</span><span class="op" id="3195392">]</span><span class="ident" id="3195393">IP</span><span class="op" id="3195395">,</span>&nbsp;<span class="ident" id="3195397">inetaddr</span>&nbsp;<span class="keyword" id="3195406">func</span><span class="op" id="3195410">(</span><span class="ident" id="3195411">IP</span><span class="op" id="3195413">)</span>&nbsp;<span class="ident" id="3195415">netaddr</span><span class="op" id="3195422">)</span>&nbsp;<span class="op" id="3195424">(</span><span class="ident" id="3195425">netaddr</span><span class="op" id="3195432">,</span>&nbsp;<span class="builtintype" id="3195434">error</span><span class="op" id="3195439">)</span>&nbsp;<span class="op" id="3195441">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195444">for</span>&nbsp;<span class="ident" id="3195448">_</span><span class="op" id="3195449">,</span>&nbsp;<span class="ident" id="3195451">ip</span>&nbsp;<span class="op" id="3195454">:=</span>&nbsp;<span class="keyword" id="3195457">range</span>&nbsp;<span class="ident" id="3195463">ips</span>&nbsp;<span class="op" id="3195467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195471">if</span>&nbsp;<span class="ident" id="3195474">ip</span>&nbsp;<span class="op" id="3195477">:=</span>&nbsp;<span class="ident" id="3195480">filter</span><span class="op" id="3195486">(</span><span class="ident" id="3195487">ip</span><span class="op" id="3195489">)</span><span class="op" id="3195490">;</span>&nbsp;<span class="ident" id="3195492">ip</span>&nbsp;<span class="op" id="3195495">!=</span>&nbsp;<span class="ident" id="3195498">nil</span>&nbsp;<span class="op" id="3195502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195507">return</span>&nbsp;<span class="ident" id="3195514">inetaddr</span><span class="op" id="3195522">(</span><span class="ident" id="3195523">ip</span><span class="op" id="3195525">)</span><span class="op" id="3195526">,</span>&nbsp;<span class="ident" id="3195528">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195537">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195540">return</span>&nbsp;<span class="ident" id="3195547">nil</span><span class="op" id="3195550">,</span>&nbsp;<span class="ident" id="3195552">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3195573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195576">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3195645">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3195718">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3195747">func</span>&nbsp;<span class="ident" id="3195752">ipv4only</span><span class="op" id="3195760">(</span><span class="ident" id="3195761">ip</span>&nbsp;<span class="ident" id="3195764">IP</span><span class="op" id="3195766">)</span>&nbsp;<span class="ident" id="3195768">IP</span>&nbsp;<span class="op" id="3195771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195774">if</span>&nbsp;<span class="ident" id="3195777">supportsIPv4</span>&nbsp;<span class="op" id="3195790">&amp;&amp;</span>&nbsp;<span class="ident" id="3195793">ip</span><span class="op" id="3195795">.</span><span class="ident" id="3195796">To4</span><span class="op" id="3195799">(</span><span class="op" id="3195800">)</span>&nbsp;<span class="op" id="3195802">!=</span>&nbsp;<span class="ident" id="3195805">nil</span>&nbsp;<span class="op" id="3195809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195813">return</span>&nbsp;<span class="ident" id="3195820">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195824">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195827">return</span>&nbsp;<span class="ident" id="3195834">nil</span><br>
<span class="lineno"></span><span class="op" id="3195838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195841">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3195910">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3195978">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3196042">func</span>&nbsp;<span class="ident" id="3196047">ipv6only</span><span class="op" id="3196055">(</span><span class="ident" id="3196056">ip</span>&nbsp;<span class="ident" id="3196059">IP</span><span class="op" id="3196061">)</span>&nbsp;<span class="ident" id="3196063">IP</span>&nbsp;<span class="op" id="3196066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196069">if</span>&nbsp;<span class="ident" id="3196072">supportsIPv6</span>&nbsp;<span class="op" id="3196085">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3196088">len</span><span class="op" id="3196091">(</span><span class="ident" id="3196092">ip</span><span class="op" id="3196094">)</span>&nbsp;<span class="op" id="3196096">==</span>&nbsp;<span class="ident" id="3196099">IPv6len</span>&nbsp;<span class="op" id="3196107">&amp;&amp;</span>&nbsp;<span class="ident" id="3196110">ip</span><span class="op" id="3196112">.</span><span class="ident" id="3196113">To4</span><span class="op" id="3196116">(</span><span class="op" id="3196117">)</span>&nbsp;<span class="op" id="3196119">==</span>&nbsp;<span class="ident" id="3196122">nil</span>&nbsp;<span class="op" id="3196126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196130">return</span>&nbsp;<span class="ident" id="3196137">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196141">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196144">return</span>&nbsp;<span class="ident" id="3196151">nil</span><br>
<span class="lineno"></span><span class="op" id="3196155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3196158">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3196225">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3196282">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3196351">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3196409">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3196457">func</span>&nbsp;<span class="ident" id="3196462">SplitHostPort</span><span class="op" id="3196475">(</span><span class="ident" id="3196476">hostport</span>&nbsp;<span class="builtintype" id="3196485">string</span><span class="op" id="3196491">)</span>&nbsp;<span class="op" id="3196493">(</span><span class="ident" id="3196494">host</span><span class="op" id="3196498">,</span>&nbsp;<span class="ident" id="3196500">port</span>&nbsp;<span class="builtintype" id="3196505">string</span><span class="op" id="3196511">,</span>&nbsp;<span class="ident" id="3196513">err</span>&nbsp;<span class="builtintype" id="3196517">error</span><span class="op" id="3196522">)</span>&nbsp;<span class="op" id="3196524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196527">j</span><span class="op" id="3196528">,</span>&nbsp;<span class="ident" id="3196530">k</span>&nbsp;<span class="op" id="3196532">:=</span>&nbsp;<span class="num" id="3196535">0</span><span class="op" id="3196536">,</span>&nbsp;<span class="num" id="3196538">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196542">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196584">i</span>&nbsp;<span class="op" id="3196586">:=</span>&nbsp;<span class="ident" id="3196589">last</span><span class="op" id="3196593">(</span><span class="ident" id="3196594">hostport</span><span class="op" id="3196602">,</span>&nbsp;<span class="string" id="3196604">&#39;:&#39;</span><span class="op" id="3196607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196610">if</span>&nbsp;<span class="ident" id="3196613">i</span>&nbsp;<span class="op" id="3196615">&lt;</span>&nbsp;<span class="num" id="3196617">0</span>&nbsp;<span class="op" id="3196619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196623">goto</span>&nbsp;<span class="ident" id="3196628">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196645">if</span>&nbsp;<span class="ident" id="3196648">hostport</span><span class="op" id="3196656">[</span><span class="num" id="3196657">0</span><span class="op" id="3196658">]</span>&nbsp;<span class="op" id="3196660">==</span>&nbsp;<span class="string" id="3196663">&#39;[&#39;</span>&nbsp;<span class="op" id="3196667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196671">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196723">end</span>&nbsp;<span class="op" id="3196727">:=</span>&nbsp;<span class="ident" id="3196730">byteIndex</span><span class="op" id="3196739">(</span><span class="ident" id="3196740">hostport</span><span class="op" id="3196748">,</span>&nbsp;<span class="string" id="3196750">&#39;]&#39;</span><span class="op" id="3196753">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196757">if</span>&nbsp;<span class="ident" id="3196760">end</span>&nbsp;<span class="op" id="3196764">&lt;</span>&nbsp;<span class="num" id="3196766">0</span>&nbsp;<span class="op" id="3196768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3196773">err</span>&nbsp;<span class="op" id="3196777">=</span>&nbsp;<span class="op" id="3196779">&amp;</span><span class="ident" id="3196780">AddrError</span><span class="op" id="3196789">{</span><span class="string" id="3196790">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3196814">,</span>&nbsp;<span class="ident" id="3196816">hostport</span><span class="op" id="3196824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196829">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3196838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196842">switch</span>&nbsp;<span class="ident" id="3196849">end</span>&nbsp;<span class="op" id="3196853">+</span>&nbsp;<span class="num" id="3196855">1</span>&nbsp;<span class="op" id="3196857">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196861">case</span>&nbsp;<span class="builtinfunc" id="3196866">len</span><span class="op" id="3196869">(</span><span class="ident" id="3196870">hostport</span><span class="op" id="3196878">)</span><span class="op" id="3196879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196884">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196931">goto</span>&nbsp;<span class="ident" id="3196936">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196950">case</span>&nbsp;<span class="ident" id="3196955">i</span><span class="op" id="3196956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196961">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3196987">default</span><span class="op" id="3196994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3196999">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3197052">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197104">if</span>&nbsp;<span class="ident" id="3197107">hostport</span><span class="op" id="3197115">[</span><span class="ident" id="3197116">end</span><span class="op" id="3197119">+</span><span class="num" id="3197120">1</span><span class="op" id="3197121">]</span>&nbsp;<span class="op" id="3197123">==</span>&nbsp;<span class="string" id="3197126">&#39;:&#39;</span>&nbsp;<span class="op" id="3197130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197136">goto</span>&nbsp;<span class="ident" id="3197141">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197163">goto</span>&nbsp;<span class="ident" id="3197168">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197186">host</span>&nbsp;<span class="op" id="3197191">=</span>&nbsp;<span class="ident" id="3197193">hostport</span><span class="op" id="3197201">[</span><span class="num" id="3197202">1</span><span class="op" id="3197203">:</span><span class="ident" id="3197204">end</span><span class="op" id="3197207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197211">j</span><span class="op" id="3197212">,</span>&nbsp;<span class="ident" id="3197214">k</span>&nbsp;<span class="op" id="3197216">=</span>&nbsp;<span class="num" id="3197218">1</span><span class="op" id="3197219">,</span>&nbsp;<span class="ident" id="3197221">end</span><span class="op" id="3197224">+</span><span class="num" id="3197225">1</span>&nbsp;<span class="comment" id="3197227">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197285">}</span>&nbsp;<span class="keyword" id="3197287">else</span>&nbsp;<span class="op" id="3197292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197296">host</span>&nbsp;<span class="op" id="3197301">=</span>&nbsp;<span class="ident" id="3197303">hostport</span><span class="op" id="3197311">[</span><span class="op" id="3197312">:</span><span class="ident" id="3197313">i</span><span class="op" id="3197314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197318">if</span>&nbsp;<span class="ident" id="3197321">byteIndex</span><span class="op" id="3197330">(</span><span class="ident" id="3197331">host</span><span class="op" id="3197335">,</span>&nbsp;<span class="string" id="3197337">&#39;:&#39;</span><span class="op" id="3197340">)</span>&nbsp;<span class="op" id="3197342">&gt;=</span>&nbsp;<span class="num" id="3197345">0</span>&nbsp;<span class="op" id="3197347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197352">goto</span>&nbsp;<span class="ident" id="3197357">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197373">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197377">if</span>&nbsp;<span class="ident" id="3197380">byteIndex</span><span class="op" id="3197389">(</span><span class="ident" id="3197390">host</span><span class="op" id="3197394">,</span>&nbsp;<span class="string" id="3197396">&#39;%&#39;</span><span class="op" id="3197399">)</span>&nbsp;<span class="op" id="3197401">&gt;=</span>&nbsp;<span class="num" id="3197404">0</span>&nbsp;<span class="op" id="3197406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197411">goto</span>&nbsp;<span class="ident" id="3197416">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197440">if</span>&nbsp;<span class="ident" id="3197443">byteIndex</span><span class="op" id="3197452">(</span><span class="ident" id="3197453">hostport</span><span class="op" id="3197461">[</span><span class="ident" id="3197462">j</span><span class="op" id="3197463">:</span><span class="op" id="3197464">]</span><span class="op" id="3197465">,</span>&nbsp;<span class="string" id="3197467">&#39;[&#39;</span><span class="op" id="3197470">)</span>&nbsp;<span class="op" id="3197472">&gt;=</span>&nbsp;<span class="num" id="3197475">0</span>&nbsp;<span class="op" id="3197477">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197481">err</span>&nbsp;<span class="op" id="3197485">=</span>&nbsp;<span class="op" id="3197487">&amp;</span><span class="ident" id="3197488">AddrError</span><span class="op" id="3197497">{</span><span class="string" id="3197498">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3197525">,</span>&nbsp;<span class="ident" id="3197527">hostport</span><span class="op" id="3197535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197550">if</span>&nbsp;<span class="ident" id="3197553">byteIndex</span><span class="op" id="3197562">(</span><span class="ident" id="3197563">hostport</span><span class="op" id="3197571">[</span><span class="ident" id="3197572">k</span><span class="op" id="3197573">:</span><span class="op" id="3197574">]</span><span class="op" id="3197575">,</span>&nbsp;<span class="string" id="3197577">&#39;]&#39;</span><span class="op" id="3197580">)</span>&nbsp;<span class="op" id="3197582">&gt;=</span>&nbsp;<span class="num" id="3197585">0</span>&nbsp;<span class="op" id="3197587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197591">err</span>&nbsp;<span class="op" id="3197595">=</span>&nbsp;<span class="op" id="3197597">&amp;</span><span class="ident" id="3197598">AddrError</span><span class="op" id="3197607">{</span><span class="string" id="3197608">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3197635">,</span>&nbsp;<span class="ident" id="3197637">hostport</span><span class="op" id="3197645">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197649">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3197657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197661">port</span>&nbsp;<span class="op" id="3197666">=</span>&nbsp;<span class="ident" id="3197668">hostport</span><span class="op" id="3197676">[</span><span class="ident" id="3197677">i</span><span class="op" id="3197678">+</span><span class="num" id="3197679">1</span><span class="op" id="3197680">:</span><span class="op" id="3197681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197684">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3197692">missingPort</span><span class="op" id="3197703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197706">err</span>&nbsp;<span class="op" id="3197710">=</span>&nbsp;<span class="op" id="3197712">&amp;</span><span class="ident" id="3197713">AddrError</span><span class="op" id="3197722">{</span><span class="string" id="3197723">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3197748">,</span>&nbsp;<span class="ident" id="3197750">hostport</span><span class="op" id="3197758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197761">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3197769">tooManyColons</span><span class="op" id="3197782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197785">err</span>&nbsp;<span class="op" id="3197789">=</span>&nbsp;<span class="op" id="3197791">&amp;</span><span class="ident" id="3197792">AddrError</span><span class="op" id="3197801">{</span><span class="string" id="3197802">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3197830">,</span>&nbsp;<span class="ident" id="3197832">hostport</span><span class="op" id="3197840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197843">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3197851">missingBrackets</span><span class="op" id="3197866">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3197869">err</span>&nbsp;<span class="op" id="3197873">=</span>&nbsp;<span class="op" id="3197875">&amp;</span><span class="ident" id="3197876">AddrError</span><span class="op" id="3197885">{</span><span class="string" id="3197886">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3197915">,</span>&nbsp;<span class="ident" id="3197917">hostport</span><span class="op" id="3197925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3197928">return</span><br>
<span class="lineno"></span><span class="op" id="3197935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3197938">func</span>&nbsp;<span class="ident" id="3197943">splitHostZone</span><span class="op" id="3197956">(</span><span class="ident" id="3197957">s</span>&nbsp;<span class="builtintype" id="3197959">string</span><span class="op" id="3197965">)</span>&nbsp;<span class="op" id="3197967">(</span><span class="ident" id="3197968">host</span><span class="op" id="3197972">,</span>&nbsp;<span class="ident" id="3197974">zone</span>&nbsp;<span class="builtintype" id="3197979">string</span><span class="op" id="3197985">)</span>&nbsp;<span class="op" id="3197987">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3197990">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3198054">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198077">if</span>&nbsp;<span class="ident" id="3198080">i</span>&nbsp;<span class="op" id="3198082">:=</span>&nbsp;<span class="ident" id="3198085">last</span><span class="op" id="3198089">(</span><span class="ident" id="3198090">s</span><span class="op" id="3198091">,</span>&nbsp;<span class="string" id="3198093">&#39;%&#39;</span><span class="op" id="3198096">)</span><span class="op" id="3198097">;</span>&nbsp;<span class="ident" id="3198099">i</span>&nbsp;<span class="op" id="3198101">&gt;</span>&nbsp;<span class="num" id="3198103">0</span>&nbsp;<span class="op" id="3198105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3198109">host</span><span class="op" id="3198113">,</span>&nbsp;<span class="ident" id="3198115">zone</span>&nbsp;<span class="op" id="3198120">=</span>&nbsp;<span class="ident" id="3198122">s</span><span class="op" id="3198123">[</span><span class="op" id="3198124">:</span><span class="ident" id="3198125">i</span><span class="op" id="3198126">]</span><span class="op" id="3198127">,</span>&nbsp;<span class="ident" id="3198129">s</span><span class="op" id="3198130">[</span><span class="ident" id="3198131">i</span><span class="op" id="3198132">+</span><span class="num" id="3198133">1</span><span class="op" id="3198134">:</span><span class="op" id="3198135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198138">}</span>&nbsp;<span class="keyword" id="3198140">else</span>&nbsp;<span class="op" id="3198145">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3198149">host</span>&nbsp;<span class="op" id="3198154">=</span>&nbsp;<span class="ident" id="3198156">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198162">return</span><br>
<span class="lineno"></span><span class="op" id="3198169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3198172">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3198241">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3198309">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3198327">func</span>&nbsp;<span class="ident" id="3198332">JoinHostPort</span><span class="op" id="3198344">(</span><span class="ident" id="3198345">host</span><span class="op" id="3198349">,</span>&nbsp;<span class="ident" id="3198351">port</span>&nbsp;<span class="builtintype" id="3198356">string</span><span class="op" id="3198362">)</span>&nbsp;<span class="builtintype" id="3198364">string</span>&nbsp;<span class="op" id="3198371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3198374">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198436">if</span>&nbsp;<span class="ident" id="3198439">byteIndex</span><span class="op" id="3198448">(</span><span class="ident" id="3198449">host</span><span class="op" id="3198453">,</span>&nbsp;<span class="string" id="3198455">&#39;:&#39;</span><span class="op" id="3198458">)</span>&nbsp;<span class="op" id="3198460">&gt;=</span>&nbsp;<span class="num" id="3198463">0</span>&nbsp;<span class="op" id="3198465">||</span>&nbsp;<span class="ident" id="3198468">byteIndex</span><span class="op" id="3198477">(</span><span class="ident" id="3198478">host</span><span class="op" id="3198482">,</span>&nbsp;<span class="string" id="3198484">&#39;%&#39;</span><span class="op" id="3198487">)</span>&nbsp;<span class="op" id="3198489">&gt;=</span>&nbsp;<span class="num" id="3198492">0</span>&nbsp;<span class="op" id="3198494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198498">return</span>&nbsp;<span class="string" id="3198505">&#34;[&#34;</span>&nbsp;<span class="op" id="3198509">+</span>&nbsp;<span class="ident" id="3198511">host</span>&nbsp;<span class="op" id="3198516">+</span>&nbsp;<span class="string" id="3198518">&#34;]:&#34;</span>&nbsp;<span class="op" id="3198523">+</span>&nbsp;<span class="ident" id="3198525">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3198531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3198534">return</span>&nbsp;<span class="ident" id="3198541">host</span>&nbsp;<span class="op" id="3198546">+</span>&nbsp;<span class="string" id="3198548">&#34;:&#34;</span>&nbsp;<span class="op" id="3198552">+</span>&nbsp;<span class="ident" id="3198554">port</span><br>
<span class="lineno"></span><span class="op" id="3198559">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3198562">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3198627">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3198692">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3198756">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3198825">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3198894">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3198924">func</span>&nbsp;<span class="ident" id="3198929">resolveInternetAddr</span><span class="op" id="3198948">(</span><span class="ident" id="3198949">net</span><span class="op" id="3198952">,</span>&nbsp;<span class="ident" id="3198954">addr</span>&nbsp;<span class="builtintype" id="3198959">string</span><span class="op" id="3198965">,</span>&nbsp;<span class="ident" id="3198967">deadline</span>&nbsp;<span class="ident" id="3198976">time</span><span class="op" id="3198980">.</span><span class="ident" id="3198981">Time</span><span class="op" id="3198985">)</span>&nbsp;<span class="op" id="3198987">(</span><span class="ident" id="3198988">netaddr</span><span class="op" id="3198995">,</span>&nbsp;<span class="builtintype" id="3198997">error</span><span class="op" id="3199002">)</span>&nbsp;<span class="op" id="3199004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199007">var</span>&nbsp;<span class="op" id="3199011">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199015">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3199032">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199040">host</span><span class="op" id="3199044">,</span>&nbsp;<span class="ident" id="3199046">port</span><span class="op" id="3199050">,</span>&nbsp;<span class="ident" id="3199052">zone</span>&nbsp;<span class="builtintype" id="3199057">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199066">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3199083">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199091">switch</span>&nbsp;<span class="ident" id="3199098">net</span>&nbsp;<span class="op" id="3199102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199105">case</span>&nbsp;<span class="string" id="3199110">&#34;tcp&#34;</span><span class="op" id="3199115">,</span>&nbsp;<span class="string" id="3199117">&#34;tcp4&#34;</span><span class="op" id="3199123">,</span>&nbsp;<span class="string" id="3199125">&#34;tcp6&#34;</span><span class="op" id="3199131">,</span>&nbsp;<span class="string" id="3199133">&#34;udp&#34;</span><span class="op" id="3199138">,</span>&nbsp;<span class="string" id="3199140">&#34;udp4&#34;</span><span class="op" id="3199146">,</span>&nbsp;<span class="string" id="3199148">&#34;udp6&#34;</span><span class="op" id="3199154">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199158">if</span>&nbsp;<span class="ident" id="3199161">addr</span>&nbsp;<span class="op" id="3199166">!=</span>&nbsp;<span class="string" id="3199169">&#34;&#34;</span>&nbsp;<span class="op" id="3199172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199177">if</span>&nbsp;<span class="ident" id="3199180">host</span><span class="op" id="3199184">,</span>&nbsp;<span class="ident" id="3199186">port</span><span class="op" id="3199190">,</span>&nbsp;<span class="ident" id="3199192">err</span>&nbsp;<span class="op" id="3199196">=</span>&nbsp;<span class="ident" id="3199198">SplitHostPort</span><span class="op" id="3199211">(</span><span class="ident" id="3199212">addr</span><span class="op" id="3199216">)</span><span class="op" id="3199217">;</span>&nbsp;<span class="ident" id="3199219">err</span>&nbsp;<span class="op" id="3199223">!=</span>&nbsp;<span class="ident" id="3199226">nil</span>&nbsp;<span class="op" id="3199230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199236">return</span>&nbsp;<span class="ident" id="3199243">nil</span><span class="op" id="3199246">,</span>&nbsp;<span class="ident" id="3199248">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199260">if</span>&nbsp;<span class="ident" id="3199263">portnum</span><span class="op" id="3199270">,</span>&nbsp;<span class="ident" id="3199272">err</span>&nbsp;<span class="op" id="3199276">=</span>&nbsp;<span class="ident" id="3199278">parsePort</span><span class="op" id="3199287">(</span><span class="ident" id="3199288">net</span><span class="op" id="3199291">,</span>&nbsp;<span class="ident" id="3199293">port</span><span class="op" id="3199297">)</span><span class="op" id="3199298">;</span>&nbsp;<span class="ident" id="3199300">err</span>&nbsp;<span class="op" id="3199304">!=</span>&nbsp;<span class="ident" id="3199307">nil</span>&nbsp;<span class="op" id="3199311">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199317">return</span>&nbsp;<span class="ident" id="3199324">nil</span><span class="op" id="3199327">,</span>&nbsp;<span class="ident" id="3199329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199343">case</span>&nbsp;<span class="string" id="3199348">&#34;ip&#34;</span><span class="op" id="3199352">,</span>&nbsp;<span class="string" id="3199354">&#34;ip4&#34;</span><span class="op" id="3199359">,</span>&nbsp;<span class="string" id="3199361">&#34;ip6&#34;</span><span class="op" id="3199366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199370">if</span>&nbsp;<span class="ident" id="3199373">addr</span>&nbsp;<span class="op" id="3199378">!=</span>&nbsp;<span class="string" id="3199381">&#34;&#34;</span>&nbsp;<span class="op" id="3199384">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199389">host</span>&nbsp;<span class="op" id="3199394">=</span>&nbsp;<span class="ident" id="3199396">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199406">default</span><span class="op" id="3199413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199417">return</span>&nbsp;<span class="ident" id="3199424">nil</span><span class="op" id="3199427">,</span>&nbsp;<span class="ident" id="3199429">UnknownNetworkError</span><span class="op" id="3199448">(</span><span class="ident" id="3199449">net</span><span class="op" id="3199452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199455">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3199458">inetaddr</span>&nbsp;<span class="op" id="3199467">:=</span>&nbsp;<span class="keyword" id="3199470">func</span><span class="op" id="3199474">(</span><span class="ident" id="3199475">ip</span>&nbsp;<span class="ident" id="3199478">IP</span><span class="op" id="3199480">)</span>&nbsp;<span class="ident" id="3199482">netaddr</span>&nbsp;<span class="op" id="3199490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199494">switch</span>&nbsp;<span class="ident" id="3199501">net</span>&nbsp;<span class="op" id="3199505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199509">case</span>&nbsp;<span class="string" id="3199514">&#34;tcp&#34;</span><span class="op" id="3199519">,</span>&nbsp;<span class="string" id="3199521">&#34;tcp4&#34;</span><span class="op" id="3199527">,</span>&nbsp;<span class="string" id="3199529">&#34;tcp6&#34;</span><span class="op" id="3199535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199540">return</span>&nbsp;<span class="op" id="3199547">&amp;</span><span class="ident" id="3199548">TCPAddr</span><span class="op" id="3199555">{</span><span class="ident" id="3199556">IP</span><span class="op" id="3199558">:</span>&nbsp;<span class="ident" id="3199560">ip</span><span class="op" id="3199562">,</span>&nbsp;<span class="ident" id="3199564">Port</span><span class="op" id="3199568">:</span>&nbsp;<span class="ident" id="3199570">portnum</span><span class="op" id="3199577">,</span>&nbsp;<span class="ident" id="3199579">Zone</span><span class="op" id="3199583">:</span>&nbsp;<span class="ident" id="3199585">zone</span><span class="op" id="3199589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199593">case</span>&nbsp;<span class="string" id="3199598">&#34;udp&#34;</span><span class="op" id="3199603">,</span>&nbsp;<span class="string" id="3199605">&#34;udp4&#34;</span><span class="op" id="3199611">,</span>&nbsp;<span class="string" id="3199613">&#34;udp6&#34;</span><span class="op" id="3199619">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199624">return</span>&nbsp;<span class="op" id="3199631">&amp;</span><span class="ident" id="3199632">UDPAddr</span><span class="op" id="3199639">{</span><span class="ident" id="3199640">IP</span><span class="op" id="3199642">:</span>&nbsp;<span class="ident" id="3199644">ip</span><span class="op" id="3199646">,</span>&nbsp;<span class="ident" id="3199648">Port</span><span class="op" id="3199652">:</span>&nbsp;<span class="ident" id="3199654">portnum</span><span class="op" id="3199661">,</span>&nbsp;<span class="ident" id="3199663">Zone</span><span class="op" id="3199667">:</span>&nbsp;<span class="ident" id="3199669">zone</span><span class="op" id="3199673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199677">case</span>&nbsp;<span class="string" id="3199682">&#34;ip&#34;</span><span class="op" id="3199686">,</span>&nbsp;<span class="string" id="3199688">&#34;ip4&#34;</span><span class="op" id="3199693">,</span>&nbsp;<span class="string" id="3199695">&#34;ip6&#34;</span><span class="op" id="3199700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199705">return</span>&nbsp;<span class="op" id="3199712">&amp;</span><span class="ident" id="3199713">IPAddr</span><span class="op" id="3199719">{</span><span class="ident" id="3199720">IP</span><span class="op" id="3199722">:</span>&nbsp;<span class="ident" id="3199724">ip</span><span class="op" id="3199726">,</span>&nbsp;<span class="ident" id="3199728">Zone</span><span class="op" id="3199732">:</span>&nbsp;<span class="ident" id="3199734">zone</span><span class="op" id="3199738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199742">default</span><span class="op" id="3199749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3199754">panic</span><span class="op" id="3199759">(</span><span class="string" id="3199760">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3199783">+</span>&nbsp;<span class="ident" id="3199785">net</span><span class="op" id="3199788">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199798">if</span>&nbsp;<span class="ident" id="3199801">host</span>&nbsp;<span class="op" id="3199806">==</span>&nbsp;<span class="string" id="3199809">&#34;&#34;</span>&nbsp;<span class="op" id="3199812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199816">return</span>&nbsp;<span class="ident" id="3199823">inetaddr</span><span class="op" id="3199831">(</span><span class="ident" id="3199832">nil</span><span class="op" id="3199835">)</span><span class="op" id="3199836">,</span>&nbsp;<span class="ident" id="3199838">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199843">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3199846">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199879">var</span>&nbsp;<span class="ident" id="3199883">ip</span>&nbsp;<span class="ident" id="3199886">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199890">if</span>&nbsp;<span class="ident" id="3199893">ip</span>&nbsp;<span class="op" id="3199896">=</span>&nbsp;<span class="ident" id="3199898">parseIPv4</span><span class="op" id="3199907">(</span><span class="ident" id="3199908">host</span><span class="op" id="3199912">)</span><span class="op" id="3199913">;</span>&nbsp;<span class="ident" id="3199915">ip</span>&nbsp;<span class="op" id="3199918">!=</span>&nbsp;<span class="ident" id="3199921">nil</span>&nbsp;<span class="op" id="3199925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199929">return</span>&nbsp;<span class="ident" id="3199936">inetaddr</span><span class="op" id="3199944">(</span><span class="ident" id="3199945">ip</span><span class="op" id="3199947">)</span><span class="op" id="3199948">,</span>&nbsp;<span class="ident" id="3199950">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3199955">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3199958">if</span>&nbsp;<span class="ident" id="3199961">ip</span><span class="op" id="3199963">,</span>&nbsp;<span class="ident" id="3199965">zone</span>&nbsp;<span class="op" id="3199970">=</span>&nbsp;<span class="ident" id="3199972">parseIPv6</span><span class="op" id="3199981">(</span><span class="ident" id="3199982">host</span><span class="op" id="3199986">,</span>&nbsp;<span class="builtintype" id="3199988">true</span><span class="op" id="3199992">)</span><span class="op" id="3199993">;</span>&nbsp;<span class="ident" id="3199995">ip</span>&nbsp;<span class="op" id="3199998">!=</span>&nbsp;<span class="ident" id="3200001">nil</span>&nbsp;<span class="op" id="3200005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200009">return</span>&nbsp;<span class="ident" id="3200016">inetaddr</span><span class="op" id="3200024">(</span><span class="ident" id="3200025">ip</span><span class="op" id="3200027">)</span><span class="op" id="3200028">,</span>&nbsp;<span class="ident" id="3200030">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3200038">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200061">host</span><span class="op" id="3200065">,</span>&nbsp;<span class="ident" id="3200067">zone</span>&nbsp;<span class="op" id="3200072">=</span>&nbsp;<span class="ident" id="3200074">splitHostZone</span><span class="op" id="3200087">(</span><span class="ident" id="3200088">host</span><span class="op" id="3200092">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200095">ips</span><span class="op" id="3200098">,</span>&nbsp;<span class="ident" id="3200100">err</span>&nbsp;<span class="op" id="3200104">:=</span>&nbsp;<span class="ident" id="3200107">lookupIPDeadline</span><span class="op" id="3200123">(</span><span class="ident" id="3200124">host</span><span class="op" id="3200128">,</span>&nbsp;<span class="ident" id="3200130">deadline</span><span class="op" id="3200138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200141">if</span>&nbsp;<span class="ident" id="3200144">err</span>&nbsp;<span class="op" id="3200148">!=</span>&nbsp;<span class="ident" id="3200151">nil</span>&nbsp;<span class="op" id="3200155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200159">return</span>&nbsp;<span class="ident" id="3200166">nil</span><span class="op" id="3200169">,</span>&nbsp;<span class="ident" id="3200171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200179">var</span>&nbsp;<span class="ident" id="3200183">filter</span>&nbsp;<span class="keyword" id="3200190">func</span><span class="op" id="3200194">(</span><span class="ident" id="3200195">IP</span><span class="op" id="3200197">)</span>&nbsp;<span class="ident" id="3200199">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200203">if</span>&nbsp;<span class="ident" id="3200206">net</span>&nbsp;<span class="op" id="3200210">!=</span>&nbsp;<span class="string" id="3200213">&#34;&#34;</span>&nbsp;<span class="op" id="3200216">&amp;&amp;</span>&nbsp;<span class="ident" id="3200219">net</span><span class="op" id="3200222">[</span><span class="builtinfunc" id="3200223">len</span><span class="op" id="3200226">(</span><span class="ident" id="3200227">net</span><span class="op" id="3200230">)</span><span class="op" id="3200231">-</span><span class="num" id="3200232">1</span><span class="op" id="3200233">]</span>&nbsp;<span class="op" id="3200235">==</span>&nbsp;<span class="string" id="3200238">&#39;4&#39;</span>&nbsp;<span class="op" id="3200242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200246">filter</span>&nbsp;<span class="op" id="3200253">=</span>&nbsp;<span class="ident" id="3200255">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200268">if</span>&nbsp;<span class="ident" id="3200271">net</span>&nbsp;<span class="op" id="3200275">!=</span>&nbsp;<span class="string" id="3200278">&#34;&#34;</span>&nbsp;<span class="op" id="3200281">&amp;&amp;</span>&nbsp;<span class="ident" id="3200284">net</span><span class="op" id="3200287">[</span><span class="builtinfunc" id="3200288">len</span><span class="op" id="3200291">(</span><span class="ident" id="3200292">net</span><span class="op" id="3200295">)</span><span class="op" id="3200296">-</span><span class="num" id="3200297">1</span><span class="op" id="3200298">]</span>&nbsp;<span class="op" id="3200300">==</span>&nbsp;<span class="string" id="3200303">&#39;6&#39;</span>&nbsp;<span class="op" id="3200307">||</span>&nbsp;<span class="ident" id="3200310">zone</span>&nbsp;<span class="op" id="3200315">!=</span>&nbsp;<span class="string" id="3200318">&#34;&#34;</span>&nbsp;<span class="op" id="3200321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200325">filter</span>&nbsp;<span class="op" id="3200332">=</span>&nbsp;<span class="ident" id="3200334">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200347">return</span>&nbsp;<span class="ident" id="3200354">firstFavoriteAddr</span><span class="op" id="3200371">(</span><span class="ident" id="3200372">filter</span><span class="op" id="3200378">,</span>&nbsp;<span class="ident" id="3200380">ips</span><span class="op" id="3200383">,</span>&nbsp;<span class="ident" id="3200385">inetaddr</span><span class="op" id="3200393">)</span><br>
<span class="lineno"></span><span class="op" id="3200395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3200398">func</span>&nbsp;<span class="ident" id="3200403">zoneToString</span><span class="op" id="3200415">(</span><span class="ident" id="3200416">zone</span>&nbsp;<span class="builtintype" id="3200421">int</span><span class="op" id="3200424">)</span>&nbsp;<span class="builtintype" id="3200426">string</span>&nbsp;<span class="op" id="3200433">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200436">if</span>&nbsp;<span class="ident" id="3200439">zone</span>&nbsp;<span class="op" id="3200444">==</span>&nbsp;<span class="num" id="3200447">0</span>&nbsp;<span class="op" id="3200449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200453">return</span>&nbsp;<span class="string" id="3200460">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200467">if</span>&nbsp;<span class="ident" id="3200470">ifi</span><span class="op" id="3200473">,</span>&nbsp;<span class="ident" id="3200475">err</span>&nbsp;<span class="op" id="3200479">:=</span>&nbsp;<span class="ident" id="3200482">InterfaceByIndex</span><span class="op" id="3200498">(</span><span class="ident" id="3200499">zone</span><span class="op" id="3200503">)</span><span class="op" id="3200504">;</span>&nbsp;<span class="ident" id="3200506">err</span>&nbsp;<span class="op" id="3200510">==</span>&nbsp;<span class="ident" id="3200513">nil</span>&nbsp;<span class="op" id="3200517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200521">return</span>&nbsp;<span class="ident" id="3200528">ifi</span><span class="op" id="3200531">.</span><span class="ident" id="3200532">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200541">return</span>&nbsp;<span class="ident" id="3200548">itod</span><span class="op" id="3200552">(</span><span class="builtintype" id="3200553">uint</span><span class="op" id="3200557">(</span><span class="ident" id="3200558">zone</span><span class="op" id="3200562">)</span><span class="op" id="3200563">)</span><br>
<span class="lineno"></span><span class="op" id="3200565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3200568">func</span>&nbsp;<span class="ident" id="3200573">zoneToInt</span><span class="op" id="3200582">(</span><span class="ident" id="3200583">zone</span>&nbsp;<span class="builtintype" id="3200588">string</span><span class="op" id="3200594">)</span>&nbsp;<span class="builtintype" id="3200596">int</span>&nbsp;<span class="op" id="3200600">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200603">if</span>&nbsp;<span class="ident" id="3200606">zone</span>&nbsp;<span class="op" id="3200611">==</span>&nbsp;<span class="string" id="3200614">&#34;&#34;</span>&nbsp;<span class="op" id="3200617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200621">return</span>&nbsp;<span class="num" id="3200628">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200634">if</span>&nbsp;<span class="ident" id="3200637">ifi</span><span class="op" id="3200640">,</span>&nbsp;<span class="ident" id="3200642">err</span>&nbsp;<span class="op" id="3200646">:=</span>&nbsp;<span class="ident" id="3200649">InterfaceByName</span><span class="op" id="3200664">(</span><span class="ident" id="3200665">zone</span><span class="op" id="3200669">)</span><span class="op" id="3200670">;</span>&nbsp;<span class="ident" id="3200672">err</span>&nbsp;<span class="op" id="3200676">==</span>&nbsp;<span class="ident" id="3200679">nil</span>&nbsp;<span class="op" id="3200683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200687">return</span>&nbsp;<span class="ident" id="3200694">ifi</span><span class="op" id="3200697">.</span><span class="ident" id="3200698">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3200705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3200708">n</span><span class="op" id="3200709">,</span>&nbsp;<span class="ident" id="3200711">_</span><span class="op" id="3200712">,</span>&nbsp;<span class="ident" id="3200714">_</span>&nbsp;<span class="op" id="3200716">:=</span>&nbsp;<span class="ident" id="3200719">dtoi</span><span class="op" id="3200723">(</span><span class="ident" id="3200724">zone</span><span class="op" id="3200728">,</span>&nbsp;<span class="num" id="3200730">0</span><span class="op" id="3200731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3200734">return</span>&nbsp;<span class="ident" id="3200741">n</span><br>
<span class="lineno"></span><span class="op" id="3200743">}</span>
</div>
</body>
</html>
