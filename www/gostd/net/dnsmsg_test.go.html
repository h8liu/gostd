<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8197520">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8197575">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8197629">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8197680">package</span>&nbsp;<span class="ident" id="8197688">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8197693">import</span>&nbsp;<span class="op" id="8197700">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8197703">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8197719">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8197730">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8197740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8197743">func</span>&nbsp;<span class="ident" id="8197748">TestDNSParseSRVReply</span><span class="op" id="8197768">(</span><span class="ident" id="8197769">t</span>&nbsp;<span class="op" id="8197771">*</span><span class="ident" id="8197772">testing</span><span class="op" id="8197779">.</span><span class="ident" id="8197780">T</span><span class="op" id="8197781">)</span>&nbsp;<span class="op" id="8197783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197786">data</span><span class="op" id="8197790">,</span>&nbsp;<span class="ident" id="8197792">err</span>&nbsp;<span class="op" id="8197796">:=</span>&nbsp;<span class="ident" id="8197799">hex</span><span class="op" id="8197802">.</span><span class="ident" id="8197803">DecodeString</span><span class="op" id="8197815">(</span><span class="ident" id="8197816">dnsSRVReply</span><span class="op" id="8197827">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197830">if</span>&nbsp;<span class="ident" id="8197833">err</span>&nbsp;<span class="op" id="8197837">!=</span>&nbsp;<span class="ident" id="8197840">nil</span>&nbsp;<span class="op" id="8197844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197848">t</span><span class="op" id="8197849">.</span><span class="ident" id="8197850">Fatal</span><span class="op" id="8197855">(</span><span class="ident" id="8197856">err</span><span class="op" id="8197859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197865">msg</span>&nbsp;<span class="op" id="8197869">:=</span>&nbsp;<span class="builtinfunc" id="8197872">new</span><span class="op" id="8197875">(</span><span class="ident" id="8197876">dnsMsg</span><span class="op" id="8197882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197885">ok</span>&nbsp;<span class="op" id="8197888">:=</span>&nbsp;<span class="ident" id="8197891">msg</span><span class="op" id="8197894">.</span><span class="ident" id="8197895">Unpack</span><span class="op" id="8197901">(</span><span class="ident" id="8197902">data</span><span class="op" id="8197906">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197909">if</span>&nbsp;<span class="op" id="8197912">!</span><span class="ident" id="8197913">ok</span>&nbsp;<span class="op" id="8197916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197920">t</span><span class="op" id="8197921">.</span><span class="ident" id="8197922">Fatalf</span><span class="op" id="8197928">(</span><span class="string" id="8197929">&#34;unpacking&nbsp;packet&nbsp;failed&#34;</span><span class="op" id="8197954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197960">msg</span><span class="op" id="8197963">.</span><span class="ident" id="8197964">String</span><span class="op" id="8197970">(</span><span class="op" id="8197971">)</span>&nbsp;<span class="comment" id="8197973">//&nbsp;exercise&nbsp;this&nbsp;code&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198001">if</span>&nbsp;<span class="ident" id="8198004">g</span><span class="op" id="8198005">,</span>&nbsp;<span class="ident" id="8198007">e</span>&nbsp;<span class="op" id="8198009">:=</span>&nbsp;<span class="builtinfunc" id="8198012">len</span><span class="op" id="8198015">(</span><span class="ident" id="8198016">msg</span><span class="op" id="8198019">.</span><span class="ident" id="8198020">answer</span><span class="op" id="8198026">)</span><span class="op" id="8198027">,</span>&nbsp;<span class="num" id="8198029">5</span><span class="op" id="8198030">;</span>&nbsp;<span class="ident" id="8198032">g</span>&nbsp;<span class="op" id="8198034">!=</span>&nbsp;<span class="ident" id="8198037">e</span>&nbsp;<span class="op" id="8198039">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198043">t</span><span class="op" id="8198044">.</span><span class="ident" id="8198045">Errorf</span><span class="op" id="8198051">(</span><span class="string" id="8198052">&#34;len(msg.answer)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8198083">,</span>&nbsp;<span class="ident" id="8198085">g</span><span class="op" id="8198086">,</span>&nbsp;<span class="ident" id="8198088">e</span><span class="op" id="8198089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198095">for</span>&nbsp;<span class="ident" id="8198099">idx</span><span class="op" id="8198102">,</span>&nbsp;<span class="ident" id="8198104">rr</span>&nbsp;<span class="op" id="8198107">:=</span>&nbsp;<span class="keyword" id="8198110">range</span>&nbsp;<span class="ident" id="8198116">msg</span><span class="op" id="8198119">.</span><span class="ident" id="8198120">answer</span>&nbsp;<span class="op" id="8198127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198131">if</span>&nbsp;<span class="ident" id="8198134">g</span><span class="op" id="8198135">,</span>&nbsp;<span class="ident" id="8198137">e</span>&nbsp;<span class="op" id="8198139">:=</span>&nbsp;<span class="ident" id="8198142">rr</span><span class="op" id="8198144">.</span><span class="ident" id="8198145">Header</span><span class="op" id="8198151">(</span><span class="op" id="8198152">)</span><span class="op" id="8198153">.</span><span class="ident" id="8198154">Rrtype</span><span class="op" id="8198160">,</span>&nbsp;<span class="builtintype" id="8198162">uint16</span><span class="op" id="8198168">(</span><span class="ident" id="8198169">dnsTypeSRV</span><span class="op" id="8198179">)</span><span class="op" id="8198180">;</span>&nbsp;<span class="ident" id="8198182">g</span>&nbsp;<span class="op" id="8198184">!=</span>&nbsp;<span class="ident" id="8198187">e</span>&nbsp;<span class="op" id="8198189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198194">t</span><span class="op" id="8198195">.</span><span class="ident" id="8198196">Errorf</span><span class="op" id="8198202">(</span><span class="string" id="8198203">&#34;rr[%d].Header().Rrtype&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8198241">,</span>&nbsp;<span class="ident" id="8198243">idx</span><span class="op" id="8198246">,</span>&nbsp;<span class="ident" id="8198248">g</span><span class="op" id="8198249">,</span>&nbsp;<span class="ident" id="8198251">e</span><span class="op" id="8198252">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198260">if</span>&nbsp;<span class="ident" id="8198263">_</span><span class="op" id="8198264">,</span>&nbsp;<span class="ident" id="8198266">ok</span>&nbsp;<span class="op" id="8198269">:=</span>&nbsp;<span class="ident" id="8198272">rr</span><span class="op" id="8198274">.</span><span class="op" id="8198275">(</span><span class="op" id="8198276">*</span><span class="ident" id="8198277">dnsRR_SRV</span><span class="op" id="8198286">)</span><span class="op" id="8198287">;</span>&nbsp;<span class="op" id="8198289">!</span><span class="ident" id="8198290">ok</span>&nbsp;<span class="op" id="8198293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198298">t</span><span class="op" id="8198299">.</span><span class="ident" id="8198300">Errorf</span><span class="op" id="8198306">(</span><span class="string" id="8198307">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_SRV&#34;</span><span class="op" id="8198341">,</span>&nbsp;<span class="ident" id="8198343">idx</span><span class="op" id="8198346">,</span>&nbsp;<span class="ident" id="8198348">rr</span><span class="op" id="8198350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198357">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198360">_</span><span class="op" id="8198361">,</span>&nbsp;<span class="ident" id="8198363">addrs</span><span class="op" id="8198368">,</span>&nbsp;<span class="ident" id="8198370">err</span>&nbsp;<span class="op" id="8198374">:=</span>&nbsp;<span class="ident" id="8198377">answer</span><span class="op" id="8198383">(</span><span class="string" id="8198384">&#34;_xmpp-server._tcp.google.com.&#34;</span><span class="op" id="8198415">,</span>&nbsp;<span class="string" id="8198417">&#34;foo:53&#34;</span><span class="op" id="8198425">,</span>&nbsp;<span class="ident" id="8198427">msg</span><span class="op" id="8198430">,</span>&nbsp;<span class="builtintype" id="8198432">uint16</span><span class="op" id="8198438">(</span><span class="ident" id="8198439">dnsTypeSRV</span><span class="op" id="8198449">)</span><span class="op" id="8198450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198453">if</span>&nbsp;<span class="ident" id="8198456">err</span>&nbsp;<span class="op" id="8198460">!=</span>&nbsp;<span class="ident" id="8198463">nil</span>&nbsp;<span class="op" id="8198467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198471">t</span><span class="op" id="8198472">.</span><span class="ident" id="8198473">Fatalf</span><span class="op" id="8198479">(</span><span class="string" id="8198480">&#34;answer:&nbsp;%v&#34;</span><span class="op" id="8198492">,</span>&nbsp;<span class="ident" id="8198494">err</span><span class="op" id="8198497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198503">if</span>&nbsp;<span class="ident" id="8198506">g</span><span class="op" id="8198507">,</span>&nbsp;<span class="ident" id="8198509">e</span>&nbsp;<span class="op" id="8198511">:=</span>&nbsp;<span class="builtinfunc" id="8198514">len</span><span class="op" id="8198517">(</span><span class="ident" id="8198518">addrs</span><span class="op" id="8198523">)</span><span class="op" id="8198524">,</span>&nbsp;<span class="num" id="8198526">5</span><span class="op" id="8198527">;</span>&nbsp;<span class="ident" id="8198529">g</span>&nbsp;<span class="op" id="8198531">!=</span>&nbsp;<span class="ident" id="8198534">e</span>&nbsp;<span class="op" id="8198536">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198540">t</span><span class="op" id="8198541">.</span><span class="ident" id="8198542">Errorf</span><span class="op" id="8198548">(</span><span class="string" id="8198549">&#34;len(addrs)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8198575">,</span>&nbsp;<span class="ident" id="8198577">g</span><span class="op" id="8198578">,</span>&nbsp;<span class="ident" id="8198580">e</span><span class="op" id="8198581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198585">t</span><span class="op" id="8198586">.</span><span class="ident" id="8198587">Logf</span><span class="op" id="8198591">(</span><span class="string" id="8198592">&#34;addrs&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="8198605">,</span>&nbsp;<span class="ident" id="8198607">addrs</span><span class="op" id="8198612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198618">//&nbsp;repack&nbsp;and&nbsp;unpack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198641">data2</span><span class="op" id="8198646">,</span>&nbsp;<span class="ident" id="8198648">ok</span>&nbsp;<span class="op" id="8198651">:=</span>&nbsp;<span class="ident" id="8198654">msg</span><span class="op" id="8198657">.</span><span class="ident" id="8198658">Pack</span><span class="op" id="8198662">(</span><span class="op" id="8198663">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198666">msg2</span>&nbsp;<span class="op" id="8198671">:=</span>&nbsp;<span class="builtinfunc" id="8198674">new</span><span class="op" id="8198677">(</span><span class="ident" id="8198678">dnsMsg</span><span class="op" id="8198684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198687">msg2</span><span class="op" id="8198691">.</span><span class="ident" id="8198692">Unpack</span><span class="op" id="8198698">(</span><span class="ident" id="8198699">data2</span><span class="op" id="8198704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198707">switch</span>&nbsp;<span class="op" id="8198714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198717">case</span>&nbsp;<span class="op" id="8198722">!</span><span class="ident" id="8198723">ok</span><span class="op" id="8198725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198729">t</span><span class="op" id="8198730">.</span><span class="ident" id="8198731">Errorf</span><span class="op" id="8198737">(</span><span class="string" id="8198738">&#34;failed&nbsp;to&nbsp;repack&nbsp;message&#34;</span><span class="op" id="8198764">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198767">case</span>&nbsp;<span class="op" id="8198772">!</span><span class="ident" id="8198773">reflect</span><span class="op" id="8198780">.</span><span class="ident" id="8198781">DeepEqual</span><span class="op" id="8198790">(</span><span class="ident" id="8198791">msg</span><span class="op" id="8198794">,</span>&nbsp;<span class="ident" id="8198796">msg2</span><span class="op" id="8198800">)</span><span class="op" id="8198801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198805">t</span><span class="op" id="8198806">.</span><span class="ident" id="8198807">Errorf</span><span class="op" id="8198813">(</span><span class="string" id="8198814">&#34;repacked&nbsp;message&nbsp;differs&nbsp;from&nbsp;original&#34;</span><span class="op" id="8198854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198857">}</span><br>
<span class="lineno"></span><span class="op" id="8198859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8198862">func</span>&nbsp;<span class="ident" id="8198867">TestDNSParseCorruptSRVReply</span><span class="op" id="8198894">(</span><span class="ident" id="8198895">t</span>&nbsp;<span class="op" id="8198897">*</span><span class="ident" id="8198898">testing</span><span class="op" id="8198905">.</span><span class="ident" id="8198906">T</span><span class="op" id="8198907">)</span>&nbsp;<span class="op" id="8198909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198912">data</span><span class="op" id="8198916">,</span>&nbsp;<span class="ident" id="8198918">err</span>&nbsp;<span class="op" id="8198922">:=</span>&nbsp;<span class="ident" id="8198925">hex</span><span class="op" id="8198928">.</span><span class="ident" id="8198929">DecodeString</span><span class="op" id="8198941">(</span><span class="ident" id="8198942">dnsSRVCorruptReply</span><span class="op" id="8198960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198963">if</span>&nbsp;<span class="ident" id="8198966">err</span>&nbsp;<span class="op" id="8198970">!=</span>&nbsp;<span class="ident" id="8198973">nil</span>&nbsp;<span class="op" id="8198977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198981">t</span><span class="op" id="8198982">.</span><span class="ident" id="8198983">Fatal</span><span class="op" id="8198988">(</span><span class="ident" id="8198989">err</span><span class="op" id="8198992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198995">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198998">msg</span>&nbsp;<span class="op" id="8199002">:=</span>&nbsp;<span class="builtinfunc" id="8199005">new</span><span class="op" id="8199008">(</span><span class="ident" id="8199009">dnsMsg</span><span class="op" id="8199015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199018">ok</span>&nbsp;<span class="op" id="8199021">:=</span>&nbsp;<span class="ident" id="8199024">msg</span><span class="op" id="8199027">.</span><span class="ident" id="8199028">Unpack</span><span class="op" id="8199034">(</span><span class="ident" id="8199035">data</span><span class="op" id="8199039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199042">if</span>&nbsp;<span class="op" id="8199045">!</span><span class="ident" id="8199046">ok</span>&nbsp;<span class="op" id="8199049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199053">t</span><span class="op" id="8199054">.</span><span class="ident" id="8199055">Fatalf</span><span class="op" id="8199061">(</span><span class="string" id="8199062">&#34;unpacking&nbsp;packet&nbsp;failed&#34;</span><span class="op" id="8199087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199090">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199093">msg</span><span class="op" id="8199096">.</span><span class="ident" id="8199097">String</span><span class="op" id="8199103">(</span><span class="op" id="8199104">)</span>&nbsp;<span class="comment" id="8199106">//&nbsp;exercise&nbsp;this&nbsp;code&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199134">if</span>&nbsp;<span class="ident" id="8199137">g</span><span class="op" id="8199138">,</span>&nbsp;<span class="ident" id="8199140">e</span>&nbsp;<span class="op" id="8199142">:=</span>&nbsp;<span class="builtinfunc" id="8199145">len</span><span class="op" id="8199148">(</span><span class="ident" id="8199149">msg</span><span class="op" id="8199152">.</span><span class="ident" id="8199153">answer</span><span class="op" id="8199159">)</span><span class="op" id="8199160">,</span>&nbsp;<span class="num" id="8199162">5</span><span class="op" id="8199163">;</span>&nbsp;<span class="ident" id="8199165">g</span>&nbsp;<span class="op" id="8199167">!=</span>&nbsp;<span class="ident" id="8199170">e</span>&nbsp;<span class="op" id="8199172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199176">t</span><span class="op" id="8199177">.</span><span class="ident" id="8199178">Errorf</span><span class="op" id="8199184">(</span><span class="string" id="8199185">&#34;len(msg.answer)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8199216">,</span>&nbsp;<span class="ident" id="8199218">g</span><span class="op" id="8199219">,</span>&nbsp;<span class="ident" id="8199221">e</span><span class="op" id="8199222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199228">for</span>&nbsp;<span class="ident" id="8199232">idx</span><span class="op" id="8199235">,</span>&nbsp;<span class="ident" id="8199237">rr</span>&nbsp;<span class="op" id="8199240">:=</span>&nbsp;<span class="keyword" id="8199243">range</span>&nbsp;<span class="ident" id="8199249">msg</span><span class="op" id="8199252">.</span><span class="ident" id="8199253">answer</span>&nbsp;<span class="op" id="8199260">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199264">if</span>&nbsp;<span class="ident" id="8199267">g</span><span class="op" id="8199268">,</span>&nbsp;<span class="ident" id="8199270">e</span>&nbsp;<span class="op" id="8199272">:=</span>&nbsp;<span class="ident" id="8199275">rr</span><span class="op" id="8199277">.</span><span class="ident" id="8199278">Header</span><span class="op" id="8199284">(</span><span class="op" id="8199285">)</span><span class="op" id="8199286">.</span><span class="ident" id="8199287">Rrtype</span><span class="op" id="8199293">,</span>&nbsp;<span class="builtintype" id="8199295">uint16</span><span class="op" id="8199301">(</span><span class="ident" id="8199302">dnsTypeSRV</span><span class="op" id="8199312">)</span><span class="op" id="8199313">;</span>&nbsp;<span class="ident" id="8199315">g</span>&nbsp;<span class="op" id="8199317">!=</span>&nbsp;<span class="ident" id="8199320">e</span>&nbsp;<span class="op" id="8199322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199327">t</span><span class="op" id="8199328">.</span><span class="ident" id="8199329">Errorf</span><span class="op" id="8199335">(</span><span class="string" id="8199336">&#34;rr[%d].Header().Rrtype&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8199374">,</span>&nbsp;<span class="ident" id="8199376">idx</span><span class="op" id="8199379">,</span>&nbsp;<span class="ident" id="8199381">g</span><span class="op" id="8199382">,</span>&nbsp;<span class="ident" id="8199384">e</span><span class="op" id="8199385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199393">if</span>&nbsp;<span class="ident" id="8199396">idx</span>&nbsp;<span class="op" id="8199400">==</span>&nbsp;<span class="num" id="8199403">4</span>&nbsp;<span class="op" id="8199405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199410">if</span>&nbsp;<span class="ident" id="8199413">_</span><span class="op" id="8199414">,</span>&nbsp;<span class="ident" id="8199416">ok</span>&nbsp;<span class="op" id="8199419">:=</span>&nbsp;<span class="ident" id="8199422">rr</span><span class="op" id="8199424">.</span><span class="op" id="8199425">(</span><span class="op" id="8199426">*</span><span class="ident" id="8199427">dnsRR_Header</span><span class="op" id="8199439">)</span><span class="op" id="8199440">;</span>&nbsp;<span class="op" id="8199442">!</span><span class="ident" id="8199443">ok</span>&nbsp;<span class="op" id="8199446">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199452">t</span><span class="op" id="8199453">.</span><span class="ident" id="8199454">Errorf</span><span class="op" id="8199460">(</span><span class="string" id="8199461">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_Header&#34;</span><span class="op" id="8199498">,</span>&nbsp;<span class="ident" id="8199500">idx</span><span class="op" id="8199503">,</span>&nbsp;<span class="ident" id="8199505">rr</span><span class="op" id="8199507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199516">}</span>&nbsp;<span class="keyword" id="8199518">else</span>&nbsp;<span class="op" id="8199523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199528">if</span>&nbsp;<span class="ident" id="8199531">_</span><span class="op" id="8199532">,</span>&nbsp;<span class="ident" id="8199534">ok</span>&nbsp;<span class="op" id="8199537">:=</span>&nbsp;<span class="ident" id="8199540">rr</span><span class="op" id="8199542">.</span><span class="op" id="8199543">(</span><span class="op" id="8199544">*</span><span class="ident" id="8199545">dnsRR_SRV</span><span class="op" id="8199554">)</span><span class="op" id="8199555">;</span>&nbsp;<span class="op" id="8199557">!</span><span class="ident" id="8199558">ok</span>&nbsp;<span class="op" id="8199561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199567">t</span><span class="op" id="8199568">.</span><span class="ident" id="8199569">Errorf</span><span class="op" id="8199575">(</span><span class="string" id="8199576">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_SRV&#34;</span><span class="op" id="8199610">,</span>&nbsp;<span class="ident" id="8199612">idx</span><span class="op" id="8199615">,</span>&nbsp;<span class="ident" id="8199617">rr</span><span class="op" id="8199619">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199634">_</span><span class="op" id="8199635">,</span>&nbsp;<span class="ident" id="8199637">addrs</span><span class="op" id="8199642">,</span>&nbsp;<span class="ident" id="8199644">err</span>&nbsp;<span class="op" id="8199648">:=</span>&nbsp;<span class="ident" id="8199651">answer</span><span class="op" id="8199657">(</span><span class="string" id="8199658">&#34;_xmpp-server._tcp.google.com.&#34;</span><span class="op" id="8199689">,</span>&nbsp;<span class="string" id="8199691">&#34;foo:53&#34;</span><span class="op" id="8199699">,</span>&nbsp;<span class="ident" id="8199701">msg</span><span class="op" id="8199704">,</span>&nbsp;<span class="builtintype" id="8199706">uint16</span><span class="op" id="8199712">(</span><span class="ident" id="8199713">dnsTypeSRV</span><span class="op" id="8199723">)</span><span class="op" id="8199724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199727">if</span>&nbsp;<span class="ident" id="8199730">err</span>&nbsp;<span class="op" id="8199734">!=</span>&nbsp;<span class="ident" id="8199737">nil</span>&nbsp;<span class="op" id="8199741">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199745">t</span><span class="op" id="8199746">.</span><span class="ident" id="8199747">Fatalf</span><span class="op" id="8199753">(</span><span class="string" id="8199754">&#34;answer:&nbsp;%v&#34;</span><span class="op" id="8199766">,</span>&nbsp;<span class="ident" id="8199768">err</span><span class="op" id="8199771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199777">if</span>&nbsp;<span class="ident" id="8199780">g</span><span class="op" id="8199781">,</span>&nbsp;<span class="ident" id="8199783">e</span>&nbsp;<span class="op" id="8199785">:=</span>&nbsp;<span class="builtinfunc" id="8199788">len</span><span class="op" id="8199791">(</span><span class="ident" id="8199792">addrs</span><span class="op" id="8199797">)</span><span class="op" id="8199798">,</span>&nbsp;<span class="num" id="8199800">4</span><span class="op" id="8199801">;</span>&nbsp;<span class="ident" id="8199803">g</span>&nbsp;<span class="op" id="8199805">!=</span>&nbsp;<span class="ident" id="8199808">e</span>&nbsp;<span class="op" id="8199810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199814">t</span><span class="op" id="8199815">.</span><span class="ident" id="8199816">Errorf</span><span class="op" id="8199822">(</span><span class="string" id="8199823">&#34;len(addrs)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8199849">,</span>&nbsp;<span class="ident" id="8199851">g</span><span class="op" id="8199852">,</span>&nbsp;<span class="ident" id="8199854">e</span><span class="op" id="8199855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199859">t</span><span class="op" id="8199860">.</span><span class="ident" id="8199861">Logf</span><span class="op" id="8199865">(</span><span class="string" id="8199866">&#34;addrs&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="8199879">,</span>&nbsp;<span class="ident" id="8199881">addrs</span><span class="op" id="8199886">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199889">}</span><br>
<span class="lineno"></span><span class="op" id="8199891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8199894">//&nbsp;Valid&nbsp;DNS&nbsp;SRV&nbsp;reply</span><br>
<span class="lineno"></span><span class="keyword" id="8199917">const</span>&nbsp;<span class="ident" id="8199923">dnsSRVReply</span>&nbsp;<span class="op" id="8199935">=</span>&nbsp;<span class="string" id="8199937">&#34;0901818000010005000000000c5f786d70702d736572766572045f74637006676f6f67&#34;</span>&nbsp;<span class="op" id="8200010">+</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200013">&#34;6c6503636f6d0000210001c00c002100010000012c00210014000014950c786d70702d&#34;</span>&nbsp;<span class="op" id="8200086">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200089">&#34;73657276657234016c06676f6f676c6503636f6d00c00c002100010000012c00210014&#34;</span>&nbsp;<span class="op" id="8200162">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200165">&#34;000014950c786d70702d73657276657232016c06676f6f676c6503636f6d00c00c0021&#34;</span>&nbsp;<span class="op" id="8200238">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200241">&#34;00010000012c00210014000014950c786d70702d73657276657233016c06676f6f676c&#34;</span>&nbsp;<span class="op" id="8200314">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200317">&#34;6503636f6d00c00c002100010000012c00200005000014950b786d70702d7365727665&#34;</span>&nbsp;<span class="op" id="8200390">+</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200393">&#34;72016c06676f6f676c6503636f6d00c00c002100010000012c00210014000014950c78&#34;</span>&nbsp;<span class="op" id="8200466">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200469">&#34;6d70702d73657276657231016c06676f6f676c6503636f6d00&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8200523">//&nbsp;Corrupt&nbsp;DNS&nbsp;SRV&nbsp;reply,&nbsp;with&nbsp;its&nbsp;final&nbsp;RR&nbsp;having&nbsp;a&nbsp;bogus&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="8200589">//&nbsp;(perhaps&nbsp;it&nbsp;was&nbsp;truncated,&nbsp;or&nbsp;it&#39;s&nbsp;malicious)&nbsp;The&nbsp;mutation&nbsp;is&nbsp;the</span><br>
<span class="lineno">105</span><span class="comment" id="8200658">//&nbsp;capital&nbsp;&#34;FF&#34;&nbsp;below,&nbsp;instead&nbsp;of&nbsp;the&nbsp;proper&nbsp;&#34;21&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="8200709">const</span>&nbsp;<span class="ident" id="8200715">dnsSRVCorruptReply</span>&nbsp;<span class="op" id="8200734">=</span>&nbsp;<span class="string" id="8200736">&#34;0901818000010005000000000c5f786d70702d736572766572045f74637006676f6f67&#34;</span>&nbsp;<span class="op" id="8200809">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200812">&#34;6c6503636f6d0000210001c00c002100010000012c00210014000014950c786d70702d&#34;</span>&nbsp;<span class="op" id="8200885">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200888">&#34;73657276657234016c06676f6f676c6503636f6d00c00c002100010000012c00210014&#34;</span>&nbsp;<span class="op" id="8200961">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8200964">&#34;000014950c786d70702d73657276657232016c06676f6f676c6503636f6d00c00c0021&#34;</span>&nbsp;<span class="op" id="8201037">+</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201040">&#34;00010000012c00210014000014950c786d70702d73657276657233016c06676f6f676c&#34;</span>&nbsp;<span class="op" id="8201113">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201116">&#34;6503636f6d00c00c002100010000012c00200005000014950b786d70702d7365727665&#34;</span>&nbsp;<span class="op" id="8201189">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201192">&#34;72016c06676f6f676c6503636f6d00c00c002100010000012c00FF0014000014950c78&#34;</span>&nbsp;<span class="op" id="8201265">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201268">&#34;6d70702d73657276657231016c06676f6f676c6503636f6d00&#34;</span>
</div>
</body>
</html>
