<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5949108">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5949163">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5949217">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5949268">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes;&nbsp;specifically</span><br>
<span class="lineno"></span><span class="comment" id="5949328">//&nbsp;expressions,&nbsp;statements,&nbsp;declarations,&nbsp;and&nbsp;files.&nbsp;It&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="5949389">//&nbsp;the&nbsp;print&nbsp;functionality&nbsp;implemented&nbsp;in&nbsp;printer.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949444">package</span>&nbsp;<span class="ident" id="5949452">printer</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5949461">import</span>&nbsp;<span class="op" id="5949468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5949471">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5949480">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5949490">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5949502">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5949517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5949520">//&nbsp;Formatting&nbsp;issues:</span><br>
<span class="lineno"></span><span class="comment" id="5949542">//&nbsp;-&nbsp;better&nbsp;comment&nbsp;formatting&nbsp;for&nbsp;/*-style&nbsp;comments&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;(e.g.&nbsp;a&nbsp;declaration)</span><br>
<span class="lineno">20</span><span class="comment" id="5949637">//&nbsp;&nbsp;&nbsp;when&nbsp;the&nbsp;comment&nbsp;spans&nbsp;multiple&nbsp;lines;&nbsp;if&nbsp;such&nbsp;a&nbsp;comment&nbsp;is&nbsp;just&nbsp;two&nbsp;lines,&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5949732">//&nbsp;&nbsp;&nbsp;not&nbsp;idempotent</span><br>
<span class="lineno"></span><span class="comment" id="5949752">//&nbsp;-&nbsp;formatting&nbsp;of&nbsp;expression&nbsp;lists</span><br>
<span class="lineno"></span><span class="comment" id="5949788">//&nbsp;-&nbsp;should&nbsp;use&nbsp;blank&nbsp;instead&nbsp;of&nbsp;tab&nbsp;to&nbsp;separate&nbsp;one-line&nbsp;function&nbsp;bodies&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5949867">//&nbsp;&nbsp;&nbsp;the&nbsp;function&nbsp;header&nbsp;unless&nbsp;there&nbsp;is&nbsp;a&nbsp;group&nbsp;of&nbsp;consecutive&nbsp;one-liners</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5949943">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5950023">//&nbsp;Common&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5950045">//&nbsp;Print&nbsp;as&nbsp;many&nbsp;newlines&nbsp;as&nbsp;necessary&nbsp;(but&nbsp;at&nbsp;least&nbsp;min&nbsp;newlines)&nbsp;to&nbsp;get&nbsp;to</span><br>
<span class="lineno">30</span><span class="comment" id="5950122">//&nbsp;the&nbsp;current&nbsp;line.&nbsp;ws&nbsp;is&nbsp;printed&nbsp;before&nbsp;the&nbsp;first&nbsp;line&nbsp;break.&nbsp;If&nbsp;newSection</span><br>
<span class="lineno"></span><span class="comment" id="5950200">//&nbsp;is&nbsp;set,&nbsp;the&nbsp;first&nbsp;line&nbsp;break&nbsp;is&nbsp;printed&nbsp;as&nbsp;formfeed.&nbsp;Returns&nbsp;true&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5950276">//&nbsp;line&nbsp;break&nbsp;was&nbsp;printed;&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5950328">//</span><br>
<span class="lineno"></span><span class="comment" id="5950331">//&nbsp;TODO(gri):&nbsp;linebreak&nbsp;may&nbsp;add&nbsp;too&nbsp;many&nbsp;lines&nbsp;if&nbsp;the&nbsp;next&nbsp;statement&nbsp;at&nbsp;&#34;line&#34;</span><br>
<span class="lineno">35</span><span class="comment" id="5950410">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;preceded&nbsp;by&nbsp;comments&nbsp;because&nbsp;the&nbsp;computation&nbsp;of&nbsp;n&nbsp;assumes</span><br>
<span class="lineno"></span><span class="comment" id="5950485">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;position&nbsp;before&nbsp;the&nbsp;comment&nbsp;and&nbsp;the&nbsp;target&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5950563">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;the&nbsp;comment.&nbsp;Thus,&nbsp;after&nbsp;interspersing&nbsp;such&nbsp;comments,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5950641">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;space&nbsp;taken&nbsp;up&nbsp;by&nbsp;them&nbsp;is&nbsp;not&nbsp;considered&nbsp;to&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5950720">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linebreaks.&nbsp;At&nbsp;the&nbsp;moment&nbsp;there&nbsp;is&nbsp;no&nbsp;easy&nbsp;way&nbsp;to&nbsp;know&nbsp;about</span><br>
<span class="lineno">40</span><span class="comment" id="5950795">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;(not&nbsp;yet&nbsp;interspersed)&nbsp;comments&nbsp;in&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5950866">//</span><br>
<span class="lineno"></span><span class="keyword" id="5950869">func</span>&nbsp;<span class="op" id="5950874">(</span><span class="ident" id="5950875">p</span>&nbsp;<span class="op" id="5950877">*</span><span class="ident" id="5950878">printer</span><span class="op" id="5950885">)</span>&nbsp;<span class="ident" id="5950887">linebreak</span><span class="op" id="5950896">(</span><span class="ident" id="5950897">line</span><span class="op" id="5950901">,</span>&nbsp;<span class="ident" id="5950903">min</span>&nbsp;<span class="builtintype" id="5950907">int</span><span class="op" id="5950910">,</span>&nbsp;<span class="ident" id="5950912">ws</span>&nbsp;<span class="ident" id="5950915">whiteSpace</span><span class="op" id="5950925">,</span>&nbsp;<span class="ident" id="5950927">newSection</span>&nbsp;<span class="builtintype" id="5950938">bool</span><span class="op" id="5950942">)</span>&nbsp;<span class="op" id="5950944">(</span><span class="ident" id="5950945">printedBreak</span>&nbsp;<span class="builtintype" id="5950958">bool</span><span class="op" id="5950962">)</span>&nbsp;<span class="op" id="5950964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950967">n</span>&nbsp;<span class="op" id="5950969">:=</span>&nbsp;<span class="ident" id="5950972">nlimit</span><span class="op" id="5950978">(</span><span class="ident" id="5950979">line</span>&nbsp;<span class="op" id="5950984">-</span>&nbsp;<span class="ident" id="5950986">p</span><span class="op" id="5950987">.</span><span class="ident" id="5950988">pos</span><span class="op" id="5950991">.</span><span class="ident" id="5950992">Line</span><span class="op" id="5950996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950999">if</span>&nbsp;<span class="ident" id="5951002">n</span>&nbsp;<span class="op" id="5951004">&lt;</span>&nbsp;<span class="ident" id="5951006">min</span>&nbsp;<span class="op" id="5951010">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951014">n</span>&nbsp;<span class="op" id="5951016">=</span>&nbsp;<span class="ident" id="5951018">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951026">if</span>&nbsp;<span class="ident" id="5951029">n</span>&nbsp;<span class="op" id="5951031">&gt;</span>&nbsp;<span class="num" id="5951033">0</span>&nbsp;<span class="op" id="5951035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951039">p</span><span class="op" id="5951040">.</span><span class="builtinfunc" id="5951041">print</span><span class="op" id="5951046">(</span><span class="ident" id="5951047">ws</span><span class="op" id="5951049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951053">if</span>&nbsp;<span class="ident" id="5951056">newSection</span>&nbsp;<span class="op" id="5951067">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951072">p</span><span class="op" id="5951073">.</span><span class="builtinfunc" id="5951074">print</span><span class="op" id="5951079">(</span><span class="ident" id="5951080">formfeed</span><span class="op" id="5951088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951093">n</span><span class="op" id="5951094">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951103">for</span>&nbsp;<span class="op" id="5951107">;</span>&nbsp;<span class="ident" id="5951109">n</span>&nbsp;<span class="op" id="5951111">&gt;</span>&nbsp;<span class="num" id="5951113">0</span><span class="op" id="5951114">;</span>&nbsp;<span class="ident" id="5951116">n</span><span class="op" id="5951117">--</span>&nbsp;<span class="op" id="5951120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951125">p</span><span class="op" id="5951126">.</span><span class="builtinfunc" id="5951127">print</span><span class="op" id="5951132">(</span><span class="ident" id="5951133">newline</span><span class="op" id="5951140">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951148">printedBreak</span>&nbsp;<span class="op" id="5951161">=</span>&nbsp;<span class="builtintype" id="5951163">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951172">return</span><br>
<span class="lineno"></span><span class="op" id="5951179">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5951182">//&nbsp;setComment&nbsp;sets&nbsp;g&nbsp;as&nbsp;the&nbsp;next&nbsp;comment&nbsp;if&nbsp;g&nbsp;!=&nbsp;nil&nbsp;and&nbsp;if&nbsp;node&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5951256">//&nbsp;are&nbsp;enabled&nbsp;-&nbsp;this&nbsp;mode&nbsp;is&nbsp;used&nbsp;when&nbsp;printing&nbsp;source&nbsp;code&nbsp;fragments&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5951332">//&nbsp;as&nbsp;exports&nbsp;only.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;pending&nbsp;comment&nbsp;in&nbsp;p.comments</span><br>
<span class="lineno"></span><span class="comment" id="5951410">//&nbsp;and&nbsp;at&nbsp;most&nbsp;one&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache.</span><br>
<span class="lineno">65</span><span class="keyword" id="5951469">func</span>&nbsp;<span class="op" id="5951474">(</span><span class="ident" id="5951475">p</span>&nbsp;<span class="op" id="5951477">*</span><span class="ident" id="5951478">printer</span><span class="op" id="5951485">)</span>&nbsp;<span class="ident" id="5951487">setComment</span><span class="op" id="5951497">(</span><span class="ident" id="5951498">g</span>&nbsp;<span class="op" id="5951500">*</span><span class="ident" id="5951501">ast</span><span class="op" id="5951504">.</span><span class="ident" id="5951505">CommentGroup</span><span class="op" id="5951517">)</span>&nbsp;<span class="op" id="5951519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951522">if</span>&nbsp;<span class="ident" id="5951525">g</span>&nbsp;<span class="op" id="5951527">==</span>&nbsp;<span class="ident" id="5951530">nil</span>&nbsp;<span class="op" id="5951534">||</span>&nbsp;<span class="op" id="5951537">!</span><span class="ident" id="5951538">p</span><span class="op" id="5951539">.</span><span class="ident" id="5951540">useNodeComments</span>&nbsp;<span class="op" id="5951556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951571">if</span>&nbsp;<span class="ident" id="5951574">p</span><span class="op" id="5951575">.</span><span class="ident" id="5951576">comments</span>&nbsp;<span class="op" id="5951585">==</span>&nbsp;<span class="ident" id="5951588">nil</span>&nbsp;<span class="op" id="5951592">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951596">//&nbsp;initialize&nbsp;p.comments&nbsp;lazily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951630">p</span><span class="op" id="5951631">.</span><span class="ident" id="5951632">comments</span>&nbsp;<span class="op" id="5951641">=</span>&nbsp;<span class="builtinfunc" id="5951643">make</span><span class="op" id="5951647">(</span><span class="op" id="5951648">[</span><span class="op" id="5951649">]</span><span class="op" id="5951650">*</span><span class="ident" id="5951651">ast</span><span class="op" id="5951654">.</span><span class="ident" id="5951655">CommentGroup</span><span class="op" id="5951667">,</span>&nbsp;<span class="num" id="5951669">1</span><span class="op" id="5951670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951673">}</span>&nbsp;<span class="keyword" id="5951675">else</span>&nbsp;<span class="keyword" id="5951680">if</span>&nbsp;<span class="ident" id="5951683">p</span><span class="op" id="5951684">.</span><span class="ident" id="5951685">cindex</span>&nbsp;<span class="op" id="5951692">&lt;</span>&nbsp;<span class="builtinfunc" id="5951694">len</span><span class="op" id="5951697">(</span><span class="ident" id="5951698">p</span><span class="op" id="5951699">.</span><span class="ident" id="5951700">comments</span><span class="op" id="5951708">)</span>&nbsp;<span class="op" id="5951710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951714">//&nbsp;for&nbsp;some&nbsp;reason&nbsp;there&nbsp;are&nbsp;pending&nbsp;comments;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951768">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;-&nbsp;handle&nbsp;gracefully&nbsp;and&nbsp;flush</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951823">//&nbsp;all&nbsp;comments&nbsp;up&nbsp;to&nbsp;g,&nbsp;ignore&nbsp;anything&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951877">p</span><span class="op" id="5951878">.</span><span class="ident" id="5951879">flush</span><span class="op" id="5951884">(</span><span class="ident" id="5951885">p</span><span class="op" id="5951886">.</span><span class="ident" id="5951887">posFor</span><span class="op" id="5951893">(</span><span class="ident" id="5951894">g</span><span class="op" id="5951895">.</span><span class="ident" id="5951896">List</span><span class="op" id="5951900">[</span><span class="num" id="5951901">0</span><span class="op" id="5951902">]</span><span class="op" id="5951903">.</span><span class="ident" id="5951904">Pos</span><span class="op" id="5951907">(</span><span class="op" id="5951908">)</span><span class="op" id="5951909">)</span><span class="op" id="5951910">,</span>&nbsp;<span class="ident" id="5951912">token</span><span class="op" id="5951917">.</span><span class="ident" id="5951918">ILLEGAL</span><span class="op" id="5951925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951929">p</span><span class="op" id="5951930">.</span><span class="ident" id="5951931">comments</span>&nbsp;<span class="op" id="5951940">=</span>&nbsp;<span class="ident" id="5951942">p</span><span class="op" id="5951943">.</span><span class="ident" id="5951944">comments</span><span class="op" id="5951952">[</span><span class="num" id="5951953">0</span><span class="op" id="5951954">:</span><span class="num" id="5951955">1</span><span class="op" id="5951956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951960">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;report&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951993">p</span><span class="op" id="5951994">.</span><span class="ident" id="5951995">internalError</span><span class="op" id="5952008">(</span><span class="string" id="5952009">&#34;setComment&nbsp;found&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5952044">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952050">p</span><span class="op" id="5952051">.</span><span class="ident" id="5952052">comments</span><span class="op" id="5952060">[</span><span class="num" id="5952061">0</span><span class="op" id="5952062">]</span>&nbsp;<span class="op" id="5952064">=</span>&nbsp;<span class="ident" id="5952066">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952069">p</span><span class="op" id="5952070">.</span><span class="ident" id="5952071">cindex</span>&nbsp;<span class="op" id="5952078">=</span>&nbsp;<span class="num" id="5952080">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952083">//&nbsp;don&#39;t&nbsp;overwrite&nbsp;any&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952146">//&nbsp;(there&nbsp;may&nbsp;be&nbsp;a&nbsp;pending&nbsp;comment&nbsp;when&nbsp;a&nbsp;line&nbsp;comment&nbsp;is</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952205">//&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;lead&nbsp;comment&nbsp;with&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952262">//&nbsp;tokens&nbsp;between)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952282">if</span>&nbsp;<span class="ident" id="5952285">p</span><span class="op" id="5952286">.</span><span class="ident" id="5952287">commentOffset</span>&nbsp;<span class="op" id="5952301">==</span>&nbsp;<span class="ident" id="5952304">infinity</span>&nbsp;<span class="op" id="5952313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952317">p</span><span class="op" id="5952318">.</span><span class="ident" id="5952319">nextComment</span><span class="op" id="5952330">(</span><span class="op" id="5952331">)</span>&nbsp;<span class="comment" id="5952333">//&nbsp;get&nbsp;comment&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952363">}</span><br>
<span class="lineno">90</span><span class="op" id="5952365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952368">type</span>&nbsp;<span class="ident" id="5952373">exprListMode</span>&nbsp;<span class="builtintype" id="5952386">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952392">const</span>&nbsp;<span class="op" id="5952398">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952401">commaTerm</span>&nbsp;<span class="ident" id="5952411">exprListMode</span>&nbsp;<span class="op" id="5952424">=</span>&nbsp;<span class="num" id="5952426">1</span>&nbsp;<span class="op" id="5952428">&lt;&lt;</span>&nbsp;<span class="ident" id="5952431">iota</span>&nbsp;<span class="comment" id="5952436">//&nbsp;list&nbsp;is&nbsp;optionally&nbsp;terminated&nbsp;by&nbsp;a&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952481">noIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952516">//&nbsp;no&nbsp;extra&nbsp;indentation&nbsp;in&nbsp;multi-line&nbsp;lists</span><br>
<span class="lineno"></span><span class="op" id="5952560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5952563">//&nbsp;If&nbsp;indent&nbsp;is&nbsp;set,&nbsp;a&nbsp;multi-line&nbsp;identifier&nbsp;list&nbsp;is&nbsp;indented&nbsp;after&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5952635">//&nbsp;first&nbsp;linebreak&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="5952667">func</span>&nbsp;<span class="op" id="5952672">(</span><span class="ident" id="5952673">p</span>&nbsp;<span class="op" id="5952675">*</span><span class="ident" id="5952676">printer</span><span class="op" id="5952683">)</span>&nbsp;<span class="ident" id="5952685">identList</span><span class="op" id="5952694">(</span><span class="ident" id="5952695">list</span>&nbsp;<span class="op" id="5952700">[</span><span class="op" id="5952701">]</span><span class="op" id="5952702">*</span><span class="ident" id="5952703">ast</span><span class="op" id="5952706">.</span><span class="ident" id="5952707">Ident</span><span class="op" id="5952712">,</span>&nbsp;<span class="ident" id="5952714">indent</span>&nbsp;<span class="builtintype" id="5952721">bool</span><span class="op" id="5952725">)</span>&nbsp;<span class="op" id="5952727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952730">//&nbsp;convert&nbsp;into&nbsp;an&nbsp;expression&nbsp;list&nbsp;so&nbsp;we&nbsp;can&nbsp;re-use&nbsp;exprList&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952803">xlist</span>&nbsp;<span class="op" id="5952809">:=</span>&nbsp;<span class="builtinfunc" id="5952812">make</span><span class="op" id="5952816">(</span><span class="op" id="5952817">[</span><span class="op" id="5952818">]</span><span class="ident" id="5952819">ast</span><span class="op" id="5952822">.</span><span class="ident" id="5952823">Expr</span><span class="op" id="5952827">,</span>&nbsp;<span class="builtinfunc" id="5952829">len</span><span class="op" id="5952832">(</span><span class="ident" id="5952833">list</span><span class="op" id="5952837">)</span><span class="op" id="5952838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952841">for</span>&nbsp;<span class="ident" id="5952845">i</span><span class="op" id="5952846">,</span>&nbsp;<span class="ident" id="5952848">x</span>&nbsp;<span class="op" id="5952850">:=</span>&nbsp;<span class="keyword" id="5952853">range</span>&nbsp;<span class="ident" id="5952859">list</span>&nbsp;<span class="op" id="5952864">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952868">xlist</span><span class="op" id="5952873">[</span><span class="ident" id="5952874">i</span><span class="op" id="5952875">]</span>&nbsp;<span class="op" id="5952877">=</span>&nbsp;<span class="ident" id="5952879">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952885">var</span>&nbsp;<span class="ident" id="5952889">mode</span>&nbsp;<span class="ident" id="5952894">exprListMode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952908">if</span>&nbsp;<span class="op" id="5952911">!</span><span class="ident" id="5952912">indent</span>&nbsp;<span class="op" id="5952919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952923">mode</span>&nbsp;<span class="op" id="5952928">=</span>&nbsp;<span class="ident" id="5952930">noIndent</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952943">p</span><span class="op" id="5952944">.</span><span class="ident" id="5952945">exprList</span><span class="op" id="5952953">(</span><span class="ident" id="5952954">token</span><span class="op" id="5952959">.</span><span class="ident" id="5952960">NoPos</span><span class="op" id="5952965">,</span>&nbsp;<span class="ident" id="5952967">xlist</span><span class="op" id="5952972">,</span>&nbsp;<span class="num" id="5952974">1</span><span class="op" id="5952975">,</span>&nbsp;<span class="ident" id="5952977">mode</span><span class="op" id="5952981">,</span>&nbsp;<span class="ident" id="5952983">token</span><span class="op" id="5952988">.</span><span class="ident" id="5952989">NoPos</span><span class="op" id="5952994">)</span><br>
<span class="lineno"></span><span class="op" id="5952996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5952999">//&nbsp;Print&nbsp;a&nbsp;list&nbsp;of&nbsp;expressions.&nbsp;If&nbsp;the&nbsp;list&nbsp;spans&nbsp;multiple</span><br>
<span class="lineno">115</span><span class="comment" id="5953058">//&nbsp;source&nbsp;lines,&nbsp;the&nbsp;original&nbsp;line&nbsp;breaks&nbsp;are&nbsp;respected&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5953122">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5953138">//</span><br>
<span class="lineno"></span><span class="comment" id="5953141">//&nbsp;TODO(gri)&nbsp;Consider&nbsp;rewriting&nbsp;this&nbsp;to&nbsp;be&nbsp;independent&nbsp;of&nbsp;[]ast.Expr</span><br>
<span class="lineno"></span><span class="comment" id="5953210">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;algorithm&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;list</span><br>
<span class="lineno">120</span><span class="comment" id="5953277">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.,&nbsp;pass&nbsp;list&nbsp;via&nbsp;a&nbsp;channel&nbsp;over&nbsp;which&nbsp;to&nbsp;range).</span><br>
<span class="lineno"></span><span class="keyword" id="5953343">func</span>&nbsp;<span class="op" id="5953348">(</span><span class="ident" id="5953349">p</span>&nbsp;<span class="op" id="5953351">*</span><span class="ident" id="5953352">printer</span><span class="op" id="5953359">)</span>&nbsp;<span class="ident" id="5953361">exprList</span><span class="op" id="5953369">(</span><span class="ident" id="5953370">prev0</span>&nbsp;<span class="ident" id="5953376">token</span><span class="op" id="5953381">.</span><span class="ident" id="5953382">Pos</span><span class="op" id="5953385">,</span>&nbsp;<span class="ident" id="5953387">list</span>&nbsp;<span class="op" id="5953392">[</span><span class="op" id="5953393">]</span><span class="ident" id="5953394">ast</span><span class="op" id="5953397">.</span><span class="ident" id="5953398">Expr</span><span class="op" id="5953402">,</span>&nbsp;<span class="ident" id="5953404">depth</span>&nbsp;<span class="builtintype" id="5953410">int</span><span class="op" id="5953413">,</span>&nbsp;<span class="ident" id="5953415">mode</span>&nbsp;<span class="ident" id="5953420">exprListMode</span><span class="op" id="5953432">,</span>&nbsp;<span class="ident" id="5953434">next0</span>&nbsp;<span class="ident" id="5953440">token</span><span class="op" id="5953445">.</span><span class="ident" id="5953446">Pos</span><span class="op" id="5953449">)</span>&nbsp;<span class="op" id="5953451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953454">if</span>&nbsp;<span class="builtinfunc" id="5953457">len</span><span class="op" id="5953460">(</span><span class="ident" id="5953461">list</span><span class="op" id="5953465">)</span>&nbsp;<span class="op" id="5953467">==</span>&nbsp;<span class="num" id="5953470">0</span>&nbsp;<span class="op" id="5953472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953476">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953484">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953488">prev</span>&nbsp;<span class="op" id="5953493">:=</span>&nbsp;<span class="ident" id="5953496">p</span><span class="op" id="5953497">.</span><span class="ident" id="5953498">posFor</span><span class="op" id="5953504">(</span><span class="ident" id="5953505">prev0</span><span class="op" id="5953510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953513">next</span>&nbsp;<span class="op" id="5953518">:=</span>&nbsp;<span class="ident" id="5953521">p</span><span class="op" id="5953522">.</span><span class="ident" id="5953523">posFor</span><span class="op" id="5953529">(</span><span class="ident" id="5953530">next0</span><span class="op" id="5953535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953538">line</span>&nbsp;<span class="op" id="5953543">:=</span>&nbsp;<span class="ident" id="5953546">p</span><span class="op" id="5953547">.</span><span class="ident" id="5953548">lineFor</span><span class="op" id="5953555">(</span><span class="ident" id="5953556">list</span><span class="op" id="5953560">[</span><span class="num" id="5953561">0</span><span class="op" id="5953562">]</span><span class="op" id="5953563">.</span><span class="ident" id="5953564">Pos</span><span class="op" id="5953567">(</span><span class="op" id="5953568">)</span><span class="op" id="5953569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953572">endLine</span>&nbsp;<span class="op" id="5953580">:=</span>&nbsp;<span class="ident" id="5953583">p</span><span class="op" id="5953584">.</span><span class="ident" id="5953585">lineFor</span><span class="op" id="5953592">(</span><span class="ident" id="5953593">list</span><span class="op" id="5953597">[</span><span class="builtinfunc" id="5953598">len</span><span class="op" id="5953601">(</span><span class="ident" id="5953602">list</span><span class="op" id="5953606">)</span><span class="op" id="5953607">-</span><span class="num" id="5953608">1</span><span class="op" id="5953609">]</span><span class="op" id="5953610">.</span><span class="ident" id="5953611">End</span><span class="op" id="5953614">(</span><span class="op" id="5953615">)</span><span class="op" id="5953616">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953620">if</span>&nbsp;<span class="ident" id="5953623">prev</span><span class="op" id="5953627">.</span><span class="ident" id="5953628">IsValid</span><span class="op" id="5953635">(</span><span class="op" id="5953636">)</span>&nbsp;<span class="op" id="5953638">&amp;&amp;</span>&nbsp;<span class="ident" id="5953641">prev</span><span class="op" id="5953645">.</span><span class="ident" id="5953646">Line</span>&nbsp;<span class="op" id="5953651">==</span>&nbsp;<span class="ident" id="5953654">line</span>&nbsp;<span class="op" id="5953659">&amp;&amp;</span>&nbsp;<span class="ident" id="5953662">line</span>&nbsp;<span class="op" id="5953667">==</span>&nbsp;<span class="ident" id="5953670">endLine</span>&nbsp;<span class="op" id="5953678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953682">//&nbsp;all&nbsp;list&nbsp;entries&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953721">for</span>&nbsp;<span class="ident" id="5953725">i</span><span class="op" id="5953726">,</span>&nbsp;<span class="ident" id="5953728">x</span>&nbsp;<span class="op" id="5953730">:=</span>&nbsp;<span class="keyword" id="5953733">range</span>&nbsp;<span class="ident" id="5953739">list</span>&nbsp;<span class="op" id="5953744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953749">if</span>&nbsp;<span class="ident" id="5953752">i</span>&nbsp;<span class="op" id="5953754">&gt;</span>&nbsp;<span class="num" id="5953756">0</span>&nbsp;<span class="op" id="5953758">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953764">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953821">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953873">p</span><span class="op" id="5953874">.</span><span class="builtinfunc" id="5953875">print</span><span class="op" id="5953880">(</span><span class="ident" id="5953881">x</span><span class="op" id="5953882">.</span><span class="ident" id="5953883">Pos</span><span class="op" id="5953886">(</span><span class="op" id="5953887">)</span><span class="op" id="5953888">,</span>&nbsp;<span class="ident" id="5953890">token</span><span class="op" id="5953895">.</span><span class="ident" id="5953896">COMMA</span><span class="op" id="5953901">,</span>&nbsp;<span class="ident" id="5953903">blank</span><span class="op" id="5953908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953918">p</span><span class="op" id="5953919">.</span><span class="ident" id="5953920">expr0</span><span class="op" id="5953925">(</span><span class="ident" id="5953926">x</span><span class="op" id="5953927">,</span>&nbsp;<span class="ident" id="5953929">depth</span><span class="op" id="5953934">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953942">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953954">//&nbsp;list&nbsp;entries&nbsp;span&nbsp;multiple&nbsp;lines;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953992">//&nbsp;use&nbsp;source&nbsp;code&nbsp;positions&nbsp;to&nbsp;guide&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954044">//&nbsp;don&#39;t&nbsp;add&nbsp;extra&nbsp;indentation&nbsp;if&nbsp;noIndent&nbsp;is&nbsp;set;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954096">//&nbsp;i.e.,&nbsp;pretend&nbsp;that&nbsp;the&nbsp;first&nbsp;line&nbsp;is&nbsp;already&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954154">ws</span>&nbsp;<span class="op" id="5954157">:=</span>&nbsp;<span class="ident" id="5954160">ignore</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954168">if</span>&nbsp;<span class="ident" id="5954171">mode</span><span class="op" id="5954175">&amp;</span><span class="ident" id="5954176">noIndent</span>&nbsp;<span class="op" id="5954185">==</span>&nbsp;<span class="num" id="5954188">0</span>&nbsp;<span class="op" id="5954190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954194">ws</span>&nbsp;<span class="op" id="5954197">=</span>&nbsp;<span class="ident" id="5954199">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954211">//&nbsp;the&nbsp;first&nbsp;linebreak&nbsp;is&nbsp;always&nbsp;a&nbsp;formfeed&nbsp;since&nbsp;this&nbsp;section&nbsp;must&nbsp;not</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954284">//&nbsp;depend&nbsp;on&nbsp;any&nbsp;previous&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954322">prevBreak</span>&nbsp;<span class="op" id="5954332">:=</span>&nbsp;<span class="op" id="5954335">-</span><span class="num" id="5954336">1</span>&nbsp;<span class="comment" id="5954338">//&nbsp;index&nbsp;of&nbsp;last&nbsp;expression&nbsp;that&nbsp;was&nbsp;followed&nbsp;by&nbsp;a&nbsp;linebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954400">if</span>&nbsp;<span class="ident" id="5954403">prev</span><span class="op" id="5954407">.</span><span class="ident" id="5954408">IsValid</span><span class="op" id="5954415">(</span><span class="op" id="5954416">)</span>&nbsp;<span class="op" id="5954418">&amp;&amp;</span>&nbsp;<span class="ident" id="5954421">prev</span><span class="op" id="5954425">.</span><span class="ident" id="5954426">Line</span>&nbsp;<span class="op" id="5954431">&lt;</span>&nbsp;<span class="ident" id="5954433">line</span>&nbsp;<span class="op" id="5954438">&amp;&amp;</span>&nbsp;<span class="ident" id="5954441">p</span><span class="op" id="5954442">.</span><span class="ident" id="5954443">linebreak</span><span class="op" id="5954452">(</span><span class="ident" id="5954453">line</span><span class="op" id="5954457">,</span>&nbsp;<span class="num" id="5954459">0</span><span class="op" id="5954460">,</span>&nbsp;<span class="ident" id="5954462">ws</span><span class="op" id="5954464">,</span>&nbsp;<span class="builtintype" id="5954466">true</span><span class="op" id="5954470">)</span>&nbsp;<span class="op" id="5954472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954476">ws</span>&nbsp;<span class="op" id="5954479">=</span>&nbsp;<span class="ident" id="5954481">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954490">prevBreak</span>&nbsp;<span class="op" id="5954500">=</span>&nbsp;<span class="num" id="5954502">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954509">//&nbsp;initialize&nbsp;expression/key&nbsp;size:&nbsp;a&nbsp;zero&nbsp;value&nbsp;indicates&nbsp;expr/key&nbsp;doesn&#39;t&nbsp;fit&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954606">size</span>&nbsp;<span class="op" id="5954611">:=</span>&nbsp;<span class="num" id="5954614">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954618">//&nbsp;print&nbsp;all&nbsp;list&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954646">prevLine</span>&nbsp;<span class="op" id="5954655">:=</span>&nbsp;<span class="ident" id="5954658">prev</span><span class="op" id="5954662">.</span><span class="ident" id="5954663">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954669">for</span>&nbsp;<span class="ident" id="5954673">i</span><span class="op" id="5954674">,</span>&nbsp;<span class="ident" id="5954676">x</span>&nbsp;<span class="op" id="5954678">:=</span>&nbsp;<span class="keyword" id="5954681">range</span>&nbsp;<span class="ident" id="5954687">list</span>&nbsp;<span class="op" id="5954692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954696">line</span>&nbsp;<span class="op" id="5954701">=</span>&nbsp;<span class="ident" id="5954703">p</span><span class="op" id="5954704">.</span><span class="ident" id="5954705">lineFor</span><span class="op" id="5954712">(</span><span class="ident" id="5954713">x</span><span class="op" id="5954714">.</span><span class="ident" id="5954715">Pos</span><span class="op" id="5954718">(</span><span class="op" id="5954719">)</span><span class="op" id="5954720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954725">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;next&nbsp;linebreak,&nbsp;if&nbsp;any,&nbsp;needs&nbsp;to&nbsp;use&nbsp;formfeed:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954794">//&nbsp;in&nbsp;general,&nbsp;use&nbsp;the&nbsp;entire&nbsp;node&nbsp;size&nbsp;to&nbsp;make&nbsp;the&nbsp;decision;&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954862">//&nbsp;key:value&nbsp;expressions,&nbsp;use&nbsp;the&nbsp;key&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954907">//&nbsp;TODO(gri)&nbsp;for&nbsp;a&nbsp;better&nbsp;result,&nbsp;should&nbsp;probably&nbsp;incorporate&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5954976">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;key&nbsp;and&nbsp;the&nbsp;node&nbsp;size&nbsp;into&nbsp;the&nbsp;decision&nbsp;process</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955043">useFF</span>&nbsp;<span class="op" id="5955049">:=</span>&nbsp;<span class="builtintype" id="5955052">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955060">//&nbsp;determine&nbsp;element&nbsp;size:&nbsp;all&nbsp;bets&nbsp;are&nbsp;off&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955123">//&nbsp;position&nbsp;information&nbsp;for&nbsp;the&nbsp;previous&nbsp;and&nbsp;next&nbsp;token&nbsp;(likely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955189">//&nbsp;generated&nbsp;code&nbsp;-&nbsp;simply&nbsp;ignore&nbsp;the&nbsp;size&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;setting</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955258">//&nbsp;it&nbsp;to&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955272">prevSize</span>&nbsp;<span class="op" id="5955281">:=</span>&nbsp;<span class="ident" id="5955284">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955291">const</span>&nbsp;<span class="ident" id="5955297">infinity</span>&nbsp;<span class="op" id="5955306">=</span>&nbsp;<span class="num" id="5955308">1e6</span>&nbsp;<span class="comment" id="5955312">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;source&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955345">size</span>&nbsp;<span class="op" id="5955350">=</span>&nbsp;<span class="ident" id="5955352">p</span><span class="op" id="5955353">.</span><span class="ident" id="5955354">nodeSize</span><span class="op" id="5955362">(</span><span class="ident" id="5955363">x</span><span class="op" id="5955364">,</span>&nbsp;<span class="ident" id="5955366">infinity</span><span class="op" id="5955374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955378">pair</span><span class="op" id="5955382">,</span>&nbsp;<span class="ident" id="5955384">isPair</span>&nbsp;<span class="op" id="5955391">:=</span>&nbsp;<span class="ident" id="5955394">x</span><span class="op" id="5955395">.</span><span class="op" id="5955396">(</span><span class="op" id="5955397">*</span><span class="ident" id="5955398">ast</span><span class="op" id="5955401">.</span><span class="ident" id="5955402">KeyValueExpr</span><span class="op" id="5955414">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955418">if</span>&nbsp;<span class="ident" id="5955421">size</span>&nbsp;<span class="op" id="5955426">&lt;=</span>&nbsp;<span class="ident" id="5955429">infinity</span>&nbsp;<span class="op" id="5955438">&amp;&amp;</span>&nbsp;<span class="ident" id="5955441">prev</span><span class="op" id="5955445">.</span><span class="ident" id="5955446">IsValid</span><span class="op" id="5955453">(</span><span class="op" id="5955454">)</span>&nbsp;<span class="op" id="5955456">&amp;&amp;</span>&nbsp;<span class="ident" id="5955459">next</span><span class="op" id="5955463">.</span><span class="ident" id="5955464">IsValid</span><span class="op" id="5955471">(</span><span class="op" id="5955472">)</span>&nbsp;<span class="op" id="5955474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955479">//&nbsp;x&nbsp;fits&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955509">if</span>&nbsp;<span class="ident" id="5955512">isPair</span>&nbsp;<span class="op" id="5955519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955525">size</span>&nbsp;<span class="op" id="5955530">=</span>&nbsp;<span class="ident" id="5955532">p</span><span class="op" id="5955533">.</span><span class="ident" id="5955534">nodeSize</span><span class="op" id="5955542">(</span><span class="ident" id="5955543">pair</span><span class="op" id="5955547">.</span><span class="ident" id="5955548">Key</span><span class="op" id="5955551">,</span>&nbsp;<span class="ident" id="5955553">infinity</span><span class="op" id="5955561">)</span>&nbsp;<span class="comment" id="5955563">//&nbsp;size&nbsp;&lt;=&nbsp;infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955586">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955590">}</span>&nbsp;<span class="keyword" id="5955592">else</span>&nbsp;<span class="op" id="5955597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955602">//&nbsp;size&nbsp;too&nbsp;large&nbsp;or&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;good&nbsp;layout&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955664">size</span>&nbsp;<span class="op" id="5955669">=</span>&nbsp;<span class="num" id="5955671">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955680">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;line&nbsp;and&nbsp;the&nbsp;current&nbsp;line&nbsp;had&nbsp;single-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955739">//&nbsp;line-expressions&nbsp;and&nbsp;the&nbsp;key&nbsp;sizes&nbsp;are&nbsp;small&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955796">//&nbsp;the&nbsp;ratio&nbsp;between&nbsp;the&nbsp;key&nbsp;sizes&nbsp;does&nbsp;not&nbsp;exceed&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955851">//&nbsp;threshold,&nbsp;align&nbsp;columns&nbsp;and&nbsp;do&nbsp;not&nbsp;use&nbsp;formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955905">if</span>&nbsp;<span class="ident" id="5955908">prevSize</span>&nbsp;<span class="op" id="5955917">&gt;</span>&nbsp;<span class="num" id="5955919">0</span>&nbsp;<span class="op" id="5955921">&amp;&amp;</span>&nbsp;<span class="ident" id="5955924">size</span>&nbsp;<span class="op" id="5955929">&gt;</span>&nbsp;<span class="num" id="5955931">0</span>&nbsp;<span class="op" id="5955933">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955938">const</span>&nbsp;<span class="ident" id="5955944">smallSize</span>&nbsp;<span class="op" id="5955954">=</span>&nbsp;<span class="num" id="5955956">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955962">if</span>&nbsp;<span class="ident" id="5955965">prevSize</span>&nbsp;<span class="op" id="5955974">&lt;=</span>&nbsp;<span class="ident" id="5955977">smallSize</span>&nbsp;<span class="op" id="5955987">&amp;&amp;</span>&nbsp;<span class="ident" id="5955990">size</span>&nbsp;<span class="op" id="5955995">&lt;=</span>&nbsp;<span class="ident" id="5955998">smallSize</span>&nbsp;<span class="op" id="5956008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956014">useFF</span>&nbsp;<span class="op" id="5956020">=</span>&nbsp;<span class="builtintype" id="5956022">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956031">}</span>&nbsp;<span class="keyword" id="5956033">else</span>&nbsp;<span class="op" id="5956038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956044">const</span>&nbsp;<span class="ident" id="5956050">r</span>&nbsp;<span class="op" id="5956052">=</span>&nbsp;<span class="num" id="5956054">4</span>&nbsp;<span class="comment" id="5956056">//&nbsp;threshold</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956073">ratio</span>&nbsp;<span class="op" id="5956079">:=</span>&nbsp;<span class="builtintype" id="5956082">float64</span><span class="op" id="5956089">(</span><span class="ident" id="5956090">size</span><span class="op" id="5956094">)</span>&nbsp;<span class="op" id="5956096">/</span>&nbsp;<span class="builtintype" id="5956098">float64</span><span class="op" id="5956105">(</span><span class="ident" id="5956106">prevSize</span><span class="op" id="5956114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956120">useFF</span>&nbsp;<span class="op" id="5956126">=</span>&nbsp;<span class="ident" id="5956128">ratio</span>&nbsp;<span class="op" id="5956134">&lt;=</span>&nbsp;<span class="num" id="5956137">1.0</span><span class="op" id="5956140">/</span><span class="ident" id="5956141">r</span>&nbsp;<span class="op" id="5956143">||</span>&nbsp;<span class="ident" id="5956146">r</span>&nbsp;<span class="op" id="5956148">&lt;=</span>&nbsp;<span class="ident" id="5956151">ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956169">needsLinebreak</span>&nbsp;<span class="op" id="5956184">:=</span>&nbsp;<span class="num" id="5956187">0</span>&nbsp;<span class="op" id="5956189">&lt;</span>&nbsp;<span class="ident" id="5956191">prevLine</span>&nbsp;<span class="op" id="5956200">&amp;&amp;</span>&nbsp;<span class="ident" id="5956203">prevLine</span>&nbsp;<span class="op" id="5956212">&lt;</span>&nbsp;<span class="ident" id="5956214">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956221">if</span>&nbsp;<span class="ident" id="5956224">i</span>&nbsp;<span class="op" id="5956226">&gt;</span>&nbsp;<span class="num" id="5956228">0</span>&nbsp;<span class="op" id="5956230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956235">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956291">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956347">//&nbsp;only&nbsp;if&nbsp;the&nbsp;expression&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956396">if</span>&nbsp;<span class="op" id="5956399">!</span><span class="ident" id="5956400">needsLinebreak</span>&nbsp;<span class="op" id="5956415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956421">p</span><span class="op" id="5956422">.</span><span class="builtinfunc" id="5956423">print</span><span class="op" id="5956428">(</span><span class="ident" id="5956429">x</span><span class="op" id="5956430">.</span><span class="ident" id="5956431">Pos</span><span class="op" id="5956434">(</span><span class="op" id="5956435">)</span><span class="op" id="5956436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956446">p</span><span class="op" id="5956447">.</span><span class="builtinfunc" id="5956448">print</span><span class="op" id="5956453">(</span><span class="ident" id="5956454">token</span><span class="op" id="5956459">.</span><span class="ident" id="5956460">COMMA</span><span class="op" id="5956465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956470">needsBlank</span>&nbsp;<span class="op" id="5956481">:=</span>&nbsp;<span class="builtintype" id="5956484">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956492">if</span>&nbsp;<span class="ident" id="5956495">needsLinebreak</span>&nbsp;<span class="op" id="5956510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956516">//&nbsp;lines&nbsp;are&nbsp;broken&nbsp;using&nbsp;newlines&nbsp;so&nbsp;comments&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956582">//&nbsp;unless&nbsp;forceFF&nbsp;is&nbsp;set&nbsp;or&nbsp;there&nbsp;are&nbsp;multiple&nbsp;expressions&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956648">//&nbsp;the&nbsp;same&nbsp;line&nbsp;in&nbsp;which&nbsp;case&nbsp;formfeed&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956700">if</span>&nbsp;<span class="ident" id="5956703">p</span><span class="op" id="5956704">.</span><span class="ident" id="5956705">linebreak</span><span class="op" id="5956714">(</span><span class="ident" id="5956715">line</span><span class="op" id="5956719">,</span>&nbsp;<span class="num" id="5956721">0</span><span class="op" id="5956722">,</span>&nbsp;<span class="ident" id="5956724">ws</span><span class="op" id="5956726">,</span>&nbsp;<span class="ident" id="5956728">useFF</span>&nbsp;<span class="op" id="5956734">||</span>&nbsp;<span class="ident" id="5956737">prevBreak</span><span class="op" id="5956746">+</span><span class="num" id="5956747">1</span>&nbsp;<span class="op" id="5956749">&lt;</span>&nbsp;<span class="ident" id="5956751">i</span><span class="op" id="5956752">)</span>&nbsp;<span class="op" id="5956754">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956761">ws</span>&nbsp;<span class="op" id="5956764">=</span>&nbsp;<span class="ident" id="5956766">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956778">prevBreak</span>&nbsp;<span class="op" id="5956788">=</span>&nbsp;<span class="ident" id="5956790">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956797">needsBlank</span>&nbsp;<span class="op" id="5956808">=</span>&nbsp;<span class="builtintype" id="5956810">false</span>&nbsp;<span class="comment" id="5956816">//&nbsp;we&nbsp;got&nbsp;a&nbsp;line&nbsp;break&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956856">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956861">if</span>&nbsp;<span class="ident" id="5956864">needsBlank</span>&nbsp;<span class="op" id="5956875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956881">p</span><span class="op" id="5956882">.</span><span class="builtinfunc" id="5956883">print</span><span class="op" id="5956888">(</span><span class="ident" id="5956889">blank</span><span class="op" id="5956894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956908">if</span>&nbsp;<span class="builtinfunc" id="5956911">len</span><span class="op" id="5956914">(</span><span class="ident" id="5956915">list</span><span class="op" id="5956919">)</span>&nbsp;<span class="op" id="5956921">&gt;</span>&nbsp;<span class="num" id="5956923">1</span>&nbsp;<span class="op" id="5956925">&amp;&amp;</span>&nbsp;<span class="ident" id="5956928">isPair</span>&nbsp;<span class="op" id="5956935">&amp;&amp;</span>&nbsp;<span class="ident" id="5956938">size</span>&nbsp;<span class="op" id="5956943">&gt;</span>&nbsp;<span class="num" id="5956945">0</span>&nbsp;<span class="op" id="5956947">&amp;&amp;</span>&nbsp;<span class="ident" id="5956950">needsLinebreak</span>&nbsp;<span class="op" id="5956965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956970">//&nbsp;we&nbsp;have&nbsp;a&nbsp;key:value&nbsp;expression&nbsp;that&nbsp;fits&nbsp;onto&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957031">//&nbsp;and&nbsp;it&#39;s&nbsp;not&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;prior&nbsp;expression:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957092">//&nbsp;use&nbsp;a&nbsp;column&nbsp;for&nbsp;the&nbsp;key&nbsp;such&nbsp;that&nbsp;consecutive&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957153">//&nbsp;can&nbsp;align&nbsp;if&nbsp;possible</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957181">//&nbsp;(needsLinebreak&nbsp;is&nbsp;set&nbsp;if&nbsp;we&nbsp;started&nbsp;a&nbsp;new&nbsp;line&nbsp;before)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957243">p</span><span class="op" id="5957244">.</span><span class="ident" id="5957245">expr</span><span class="op" id="5957249">(</span><span class="ident" id="5957250">pair</span><span class="op" id="5957254">.</span><span class="ident" id="5957255">Key</span><span class="op" id="5957258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957263">p</span><span class="op" id="5957264">.</span><span class="builtinfunc" id="5957265">print</span><span class="op" id="5957270">(</span><span class="ident" id="5957271">pair</span><span class="op" id="5957275">.</span><span class="ident" id="5957276">Colon</span><span class="op" id="5957281">,</span>&nbsp;<span class="ident" id="5957283">token</span><span class="op" id="5957288">.</span><span class="ident" id="5957289">COLON</span><span class="op" id="5957294">,</span>&nbsp;<span class="ident" id="5957296">vtab</span><span class="op" id="5957300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957305">p</span><span class="op" id="5957306">.</span><span class="ident" id="5957307">expr</span><span class="op" id="5957311">(</span><span class="ident" id="5957312">pair</span><span class="op" id="5957316">.</span><span class="ident" id="5957317">Value</span><span class="op" id="5957322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957326">}</span>&nbsp;<span class="keyword" id="5957328">else</span>&nbsp;<span class="op" id="5957333">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957338">p</span><span class="op" id="5957339">.</span><span class="ident" id="5957340">expr0</span><span class="op" id="5957345">(</span><span class="ident" id="5957346">x</span><span class="op" id="5957347">,</span>&nbsp;<span class="ident" id="5957349">depth</span><span class="op" id="5957354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957363">prevLine</span>&nbsp;<span class="op" id="5957372">=</span>&nbsp;<span class="ident" id="5957374">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957380">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957384">if</span>&nbsp;<span class="ident" id="5957387">mode</span><span class="op" id="5957391">&amp;</span><span class="ident" id="5957392">commaTerm</span>&nbsp;<span class="op" id="5957402">!=</span>&nbsp;<span class="num" id="5957405">0</span>&nbsp;<span class="op" id="5957407">&amp;&amp;</span>&nbsp;<span class="ident" id="5957410">next</span><span class="op" id="5957414">.</span><span class="ident" id="5957415">IsValid</span><span class="op" id="5957422">(</span><span class="op" id="5957423">)</span>&nbsp;<span class="op" id="5957425">&amp;&amp;</span>&nbsp;<span class="ident" id="5957428">p</span><span class="op" id="5957429">.</span><span class="ident" id="5957430">pos</span><span class="op" id="5957433">.</span><span class="ident" id="5957434">Line</span>&nbsp;<span class="op" id="5957439">&lt;</span>&nbsp;<span class="ident" id="5957441">next</span><span class="op" id="5957445">.</span><span class="ident" id="5957446">Line</span>&nbsp;<span class="op" id="5957451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957455">//&nbsp;print&nbsp;a&nbsp;terminating&nbsp;comma&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957521">p</span><span class="op" id="5957522">.</span><span class="builtinfunc" id="5957523">print</span><span class="op" id="5957528">(</span><span class="ident" id="5957529">token</span><span class="op" id="5957534">.</span><span class="ident" id="5957535">COMMA</span><span class="op" id="5957540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957544">if</span>&nbsp;<span class="ident" id="5957547">ws</span>&nbsp;<span class="op" id="5957550">==</span>&nbsp;<span class="ident" id="5957553">ignore</span>&nbsp;<span class="op" id="5957560">&amp;&amp;</span>&nbsp;<span class="ident" id="5957563">mode</span><span class="op" id="5957567">&amp;</span><span class="ident" id="5957568">noIndent</span>&nbsp;<span class="op" id="5957577">==</span>&nbsp;<span class="num" id="5957580">0</span>&nbsp;<span class="op" id="5957582">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957587">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957617">p</span><span class="op" id="5957618">.</span><span class="builtinfunc" id="5957619">print</span><span class="op" id="5957624">(</span><span class="ident" id="5957625">unindent</span><span class="op" id="5957633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957641">p</span><span class="op" id="5957642">.</span><span class="builtinfunc" id="5957643">print</span><span class="op" id="5957648">(</span><span class="ident" id="5957649">formfeed</span><span class="op" id="5957657">)</span>&nbsp;<span class="comment" id="5957659">//&nbsp;terminating&nbsp;comma&nbsp;needs&nbsp;a&nbsp;line&nbsp;break&nbsp;to&nbsp;look&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957714">return</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957726">if</span>&nbsp;<span class="ident" id="5957729">ws</span>&nbsp;<span class="op" id="5957732">==</span>&nbsp;<span class="ident" id="5957735">ignore</span>&nbsp;<span class="op" id="5957742">&amp;&amp;</span>&nbsp;<span class="ident" id="5957745">mode</span><span class="op" id="5957749">&amp;</span><span class="ident" id="5957750">noIndent</span>&nbsp;<span class="op" id="5957759">==</span>&nbsp;<span class="num" id="5957762">0</span>&nbsp;<span class="op" id="5957764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957768">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957797">p</span><span class="op" id="5957798">.</span><span class="builtinfunc" id="5957799">print</span><span class="op" id="5957804">(</span><span class="ident" id="5957805">unindent</span><span class="op" id="5957813">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957816">}</span><br>
<span class="lineno"></span><span class="op" id="5957818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957821">func</span>&nbsp;<span class="op" id="5957826">(</span><span class="ident" id="5957827">p</span>&nbsp;<span class="op" id="5957829">*</span><span class="ident" id="5957830">printer</span><span class="op" id="5957837">)</span>&nbsp;<span class="ident" id="5957839">parameters</span><span class="op" id="5957849">(</span><span class="ident" id="5957850">fields</span>&nbsp;<span class="op" id="5957857">*</span><span class="ident" id="5957858">ast</span><span class="op" id="5957861">.</span><span class="ident" id="5957862">FieldList</span><span class="op" id="5957871">)</span>&nbsp;<span class="op" id="5957873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957876">p</span><span class="op" id="5957877">.</span><span class="builtinfunc" id="5957878">print</span><span class="op" id="5957883">(</span><span class="ident" id="5957884">fields</span><span class="op" id="5957890">.</span><span class="ident" id="5957891">Opening</span><span class="op" id="5957898">,</span>&nbsp;<span class="ident" id="5957900">token</span><span class="op" id="5957905">.</span><span class="ident" id="5957906">LPAREN</span><span class="op" id="5957912">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957915">if</span>&nbsp;<span class="builtinfunc" id="5957918">len</span><span class="op" id="5957921">(</span><span class="ident" id="5957922">fields</span><span class="op" id="5957928">.</span><span class="ident" id="5957929">List</span><span class="op" id="5957933">)</span>&nbsp;<span class="op" id="5957935">&gt;</span>&nbsp;<span class="num" id="5957937">0</span>&nbsp;<span class="op" id="5957939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957943">prevLine</span>&nbsp;<span class="op" id="5957952">:=</span>&nbsp;<span class="ident" id="5957955">p</span><span class="op" id="5957956">.</span><span class="ident" id="5957957">lineFor</span><span class="op" id="5957964">(</span><span class="ident" id="5957965">fields</span><span class="op" id="5957971">.</span><span class="ident" id="5957972">Opening</span><span class="op" id="5957979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957983">ws</span>&nbsp;<span class="op" id="5957986">:=</span>&nbsp;<span class="ident" id="5957989">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957998">for</span>&nbsp;<span class="ident" id="5958002">i</span><span class="op" id="5958003">,</span>&nbsp;<span class="ident" id="5958005">par</span>&nbsp;<span class="op" id="5958009">:=</span>&nbsp;<span class="keyword" id="5958012">range</span>&nbsp;<span class="ident" id="5958018">fields</span><span class="op" id="5958024">.</span><span class="ident" id="5958025">List</span>&nbsp;<span class="op" id="5958030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958035">//&nbsp;determine&nbsp;par&nbsp;begin&nbsp;and&nbsp;end&nbsp;line&nbsp;(may&nbsp;be&nbsp;different</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958092">//&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;parameter&nbsp;names&nbsp;for&nbsp;this&nbsp;par</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958149">//&nbsp;or&nbsp;the&nbsp;type&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958190">var</span>&nbsp;<span class="ident" id="5958194">parLineBeg</span>&nbsp;<span class="builtintype" id="5958205">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958212">if</span>&nbsp;<span class="builtinfunc" id="5958215">len</span><span class="op" id="5958218">(</span><span class="ident" id="5958219">par</span><span class="op" id="5958222">.</span><span class="ident" id="5958223">Names</span><span class="op" id="5958228">)</span>&nbsp;<span class="op" id="5958230">&gt;</span>&nbsp;<span class="num" id="5958232">0</span>&nbsp;<span class="op" id="5958234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958240">parLineBeg</span>&nbsp;<span class="op" id="5958251">=</span>&nbsp;<span class="ident" id="5958253">p</span><span class="op" id="5958254">.</span><span class="ident" id="5958255">lineFor</span><span class="op" id="5958262">(</span><span class="ident" id="5958263">par</span><span class="op" id="5958266">.</span><span class="ident" id="5958267">Names</span><span class="op" id="5958272">[</span><span class="num" id="5958273">0</span><span class="op" id="5958274">]</span><span class="op" id="5958275">.</span><span class="ident" id="5958276">Pos</span><span class="op" id="5958279">(</span><span class="op" id="5958280">)</span><span class="op" id="5958281">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958286">}</span>&nbsp;<span class="keyword" id="5958288">else</span>&nbsp;<span class="op" id="5958293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958299">parLineBeg</span>&nbsp;<span class="op" id="5958310">=</span>&nbsp;<span class="ident" id="5958312">p</span><span class="op" id="5958313">.</span><span class="ident" id="5958314">lineFor</span><span class="op" id="5958321">(</span><span class="ident" id="5958322">par</span><span class="op" id="5958325">.</span><span class="ident" id="5958326">Type</span><span class="op" id="5958330">.</span><span class="ident" id="5958331">Pos</span><span class="op" id="5958334">(</span><span class="op" id="5958335">)</span><span class="op" id="5958336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958346">var</span>&nbsp;<span class="ident" id="5958350">parLineEnd</span>&nbsp;<span class="op" id="5958361">=</span>&nbsp;<span class="ident" id="5958363">p</span><span class="op" id="5958364">.</span><span class="ident" id="5958365">lineFor</span><span class="op" id="5958372">(</span><span class="ident" id="5958373">par</span><span class="op" id="5958376">.</span><span class="ident" id="5958377">Type</span><span class="op" id="5958381">.</span><span class="ident" id="5958382">End</span><span class="op" id="5958385">(</span><span class="op" id="5958386">)</span><span class="op" id="5958387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958392">//&nbsp;separating&nbsp;&#34;,&#34;&nbsp;if&nbsp;needed</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958423">needsLinebreak</span>&nbsp;<span class="op" id="5958438">:=</span>&nbsp;<span class="num" id="5958441">0</span>&nbsp;<span class="op" id="5958443">&lt;</span>&nbsp;<span class="ident" id="5958445">prevLine</span>&nbsp;<span class="op" id="5958454">&amp;&amp;</span>&nbsp;<span class="ident" id="5958457">prevLine</span>&nbsp;<span class="op" id="5958466">&lt;</span>&nbsp;<span class="ident" id="5958468">parLineBeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958482">if</span>&nbsp;<span class="ident" id="5958485">i</span>&nbsp;<span class="op" id="5958487">&gt;</span>&nbsp;<span class="num" id="5958489">0</span>&nbsp;<span class="op" id="5958491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958497">//&nbsp;use&nbsp;position&nbsp;of&nbsp;parameter&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958553">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comma&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958608">//&nbsp;only&nbsp;if&nbsp;the&nbsp;next&nbsp;parameter&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958662">if</span>&nbsp;<span class="op" id="5958665">!</span><span class="ident" id="5958666">needsLinebreak</span>&nbsp;<span class="op" id="5958681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958688">p</span><span class="op" id="5958689">.</span><span class="builtinfunc" id="5958690">print</span><span class="op" id="5958695">(</span><span class="ident" id="5958696">par</span><span class="op" id="5958699">.</span><span class="ident" id="5958700">Pos</span><span class="op" id="5958703">(</span><span class="op" id="5958704">)</span><span class="op" id="5958705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958717">p</span><span class="op" id="5958718">.</span><span class="builtinfunc" id="5958719">print</span><span class="op" id="5958724">(</span><span class="ident" id="5958725">token</span><span class="op" id="5958730">.</span><span class="ident" id="5958731">COMMA</span><span class="op" id="5958736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958741">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958746">//&nbsp;separator&nbsp;if&nbsp;needed&nbsp;(linebreak&nbsp;or&nbsp;blank)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958793">if</span>&nbsp;<span class="ident" id="5958796">needsLinebreak</span>&nbsp;<span class="op" id="5958811">&amp;&amp;</span>&nbsp;<span class="ident" id="5958814">p</span><span class="op" id="5958815">.</span><span class="ident" id="5958816">linebreak</span><span class="op" id="5958825">(</span><span class="ident" id="5958826">parLineBeg</span><span class="op" id="5958836">,</span>&nbsp;<span class="num" id="5958838">0</span><span class="op" id="5958839">,</span>&nbsp;<span class="ident" id="5958841">ws</span><span class="op" id="5958843">,</span>&nbsp;<span class="builtintype" id="5958845">true</span><span class="op" id="5958849">)</span>&nbsp;<span class="op" id="5958851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958857">//&nbsp;break&nbsp;line&nbsp;if&nbsp;the&nbsp;opening&nbsp;&#34;(&#34;&nbsp;or&nbsp;previous&nbsp;parameter&nbsp;ended&nbsp;on&nbsp;a&nbsp;different&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958942">ws</span>&nbsp;<span class="op" id="5958945">=</span>&nbsp;<span class="ident" id="5958947">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958957">}</span>&nbsp;<span class="keyword" id="5958959">else</span>&nbsp;<span class="keyword" id="5958964">if</span>&nbsp;<span class="ident" id="5958967">i</span>&nbsp;<span class="op" id="5958969">&gt;</span>&nbsp;<span class="num" id="5958971">0</span>&nbsp;<span class="op" id="5958973">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958979">p</span><span class="op" id="5958980">.</span><span class="builtinfunc" id="5958981">print</span><span class="op" id="5958986">(</span><span class="ident" id="5958987">blank</span><span class="op" id="5958992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959002">//&nbsp;parameter&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959024">if</span>&nbsp;<span class="builtinfunc" id="5959027">len</span><span class="op" id="5959030">(</span><span class="ident" id="5959031">par</span><span class="op" id="5959034">.</span><span class="ident" id="5959035">Names</span><span class="op" id="5959040">)</span>&nbsp;<span class="op" id="5959042">&gt;</span>&nbsp;<span class="num" id="5959044">0</span>&nbsp;<span class="op" id="5959046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959052">//&nbsp;Very&nbsp;subtle:&nbsp;If&nbsp;we&nbsp;indented&nbsp;before&nbsp;(ws&nbsp;==&nbsp;ignore),&nbsp;identList</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959120">//&nbsp;won&#39;t&nbsp;indent&nbsp;again.&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;(ws&nbsp;==&nbsp;indent),&nbsp;identList&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959191">//&nbsp;indent&nbsp;if&nbsp;the&nbsp;identList&nbsp;spans&nbsp;multiple&nbsp;lines,&nbsp;and&nbsp;it&nbsp;will&nbsp;outdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959264">//&nbsp;again&nbsp;at&nbsp;the&nbsp;end&nbsp;(and&nbsp;still&nbsp;ws&nbsp;==&nbsp;indent).&nbsp;Thus,&nbsp;a&nbsp;subsequent&nbsp;indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959340">//&nbsp;by&nbsp;a&nbsp;linebreak&nbsp;call&nbsp;after&nbsp;a&nbsp;type,&nbsp;or&nbsp;in&nbsp;the&nbsp;next&nbsp;multi-line&nbsp;identList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959417">//&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959449">p</span><span class="op" id="5959450">.</span><span class="ident" id="5959451">identList</span><span class="op" id="5959460">(</span><span class="ident" id="5959461">par</span><span class="op" id="5959464">.</span><span class="ident" id="5959465">Names</span><span class="op" id="5959470">,</span>&nbsp;<span class="ident" id="5959472">ws</span>&nbsp;<span class="op" id="5959475">==</span>&nbsp;<span class="ident" id="5959478">indent</span><span class="op" id="5959484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959490">p</span><span class="op" id="5959491">.</span><span class="builtinfunc" id="5959492">print</span><span class="op" id="5959497">(</span><span class="ident" id="5959498">blank</span><span class="op" id="5959503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959513">//&nbsp;parameter&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959534">p</span><span class="op" id="5959535">.</span><span class="ident" id="5959536">expr</span><span class="op" id="5959540">(</span><span class="ident" id="5959541">stripParensAlways</span><span class="op" id="5959558">(</span><span class="ident" id="5959559">par</span><span class="op" id="5959562">.</span><span class="ident" id="5959563">Type</span><span class="op" id="5959567">)</span><span class="op" id="5959568">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959573">prevLine</span>&nbsp;<span class="op" id="5959582">=</span>&nbsp;<span class="ident" id="5959584">parLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959601">//&nbsp;if&nbsp;the&nbsp;closing&nbsp;&#34;)&#34;&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line&nbsp;from&nbsp;the&nbsp;last&nbsp;parameter,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959672">//&nbsp;print&nbsp;an&nbsp;additional&nbsp;&#34;,&#34;&nbsp;and&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959716">if</span>&nbsp;<span class="ident" id="5959719">closing</span>&nbsp;<span class="op" id="5959727">:=</span>&nbsp;<span class="ident" id="5959730">p</span><span class="op" id="5959731">.</span><span class="ident" id="5959732">lineFor</span><span class="op" id="5959739">(</span><span class="ident" id="5959740">fields</span><span class="op" id="5959746">.</span><span class="ident" id="5959747">Closing</span><span class="op" id="5959754">)</span><span class="op" id="5959755">;</span>&nbsp;<span class="num" id="5959757">0</span>&nbsp;<span class="op" id="5959759">&lt;</span>&nbsp;<span class="ident" id="5959761">prevLine</span>&nbsp;<span class="op" id="5959770">&amp;&amp;</span>&nbsp;<span class="ident" id="5959773">prevLine</span>&nbsp;<span class="op" id="5959782">&lt;</span>&nbsp;<span class="ident" id="5959784">closing</span>&nbsp;<span class="op" id="5959792">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959797">p</span><span class="op" id="5959798">.</span><span class="builtinfunc" id="5959799">print</span><span class="op" id="5959804">(</span><span class="ident" id="5959805">token</span><span class="op" id="5959810">.</span><span class="ident" id="5959811">COMMA</span><span class="op" id="5959816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959821">p</span><span class="op" id="5959822">.</span><span class="ident" id="5959823">linebreak</span><span class="op" id="5959832">(</span><span class="ident" id="5959833">closing</span><span class="op" id="5959840">,</span>&nbsp;<span class="num" id="5959842">0</span><span class="op" id="5959843">,</span>&nbsp;<span class="ident" id="5959845">ignore</span><span class="op" id="5959851">,</span>&nbsp;<span class="builtintype" id="5959853">true</span><span class="op" id="5959857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959865">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959894">if</span>&nbsp;<span class="ident" id="5959897">ws</span>&nbsp;<span class="op" id="5959900">==</span>&nbsp;<span class="ident" id="5959903">ignore</span>&nbsp;<span class="op" id="5959910">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959915">p</span><span class="op" id="5959916">.</span><span class="builtinfunc" id="5959917">print</span><span class="op" id="5959922">(</span><span class="ident" id="5959923">unindent</span><span class="op" id="5959931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959941">p</span><span class="op" id="5959942">.</span><span class="builtinfunc" id="5959943">print</span><span class="op" id="5959948">(</span><span class="ident" id="5959949">fields</span><span class="op" id="5959955">.</span><span class="ident" id="5959956">Closing</span><span class="op" id="5959963">,</span>&nbsp;<span class="ident" id="5959965">token</span><span class="op" id="5959970">.</span><span class="ident" id="5959971">RPAREN</span><span class="op" id="5959977">)</span><br>
<span class="lineno"></span><span class="op" id="5959979">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5959982">func</span>&nbsp;<span class="op" id="5959987">(</span><span class="ident" id="5959988">p</span>&nbsp;<span class="op" id="5959990">*</span><span class="ident" id="5959991">printer</span><span class="op" id="5959998">)</span>&nbsp;<span class="ident" id="5960000">signature</span><span class="op" id="5960009">(</span><span class="ident" id="5960010">params</span><span class="op" id="5960016">,</span>&nbsp;<span class="ident" id="5960018">result</span>&nbsp;<span class="op" id="5960025">*</span><span class="ident" id="5960026">ast</span><span class="op" id="5960029">.</span><span class="ident" id="5960030">FieldList</span><span class="op" id="5960039">)</span>&nbsp;<span class="op" id="5960041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960044">if</span>&nbsp;<span class="ident" id="5960047">params</span>&nbsp;<span class="op" id="5960054">!=</span>&nbsp;<span class="ident" id="5960057">nil</span>&nbsp;<span class="op" id="5960061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960065">p</span><span class="op" id="5960066">.</span><span class="ident" id="5960067">parameters</span><span class="op" id="5960077">(</span><span class="ident" id="5960078">params</span><span class="op" id="5960084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960087">}</span>&nbsp;<span class="keyword" id="5960089">else</span>&nbsp;<span class="op" id="5960094">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960098">p</span><span class="op" id="5960099">.</span><span class="builtinfunc" id="5960100">print</span><span class="op" id="5960105">(</span><span class="ident" id="5960106">token</span><span class="op" id="5960111">.</span><span class="ident" id="5960112">LPAREN</span><span class="op" id="5960118">,</span>&nbsp;<span class="ident" id="5960120">token</span><span class="op" id="5960125">.</span><span class="ident" id="5960126">RPAREN</span><span class="op" id="5960132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960138">n</span>&nbsp;<span class="op" id="5960140">:=</span>&nbsp;<span class="ident" id="5960143">result</span><span class="op" id="5960149">.</span><span class="ident" id="5960150">NumFields</span><span class="op" id="5960159">(</span><span class="op" id="5960160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960163">if</span>&nbsp;<span class="ident" id="5960166">n</span>&nbsp;<span class="op" id="5960168">&gt;</span>&nbsp;<span class="num" id="5960170">0</span>&nbsp;<span class="op" id="5960172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960176">//&nbsp;result&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960195">p</span><span class="op" id="5960196">.</span><span class="builtinfunc" id="5960197">print</span><span class="op" id="5960202">(</span><span class="ident" id="5960203">blank</span><span class="op" id="5960208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960212">if</span>&nbsp;<span class="ident" id="5960215">n</span>&nbsp;<span class="op" id="5960217">==</span>&nbsp;<span class="num" id="5960220">1</span>&nbsp;<span class="op" id="5960222">&amp;&amp;</span>&nbsp;<span class="ident" id="5960225">result</span><span class="op" id="5960231">.</span><span class="ident" id="5960232">List</span><span class="op" id="5960236">[</span><span class="num" id="5960237">0</span><span class="op" id="5960238">]</span><span class="op" id="5960239">.</span><span class="ident" id="5960240">Names</span>&nbsp;<span class="op" id="5960246">==</span>&nbsp;<span class="ident" id="5960249">nil</span>&nbsp;<span class="op" id="5960253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960258">//&nbsp;single&nbsp;anonymous&nbsp;result;&nbsp;no&nbsp;()&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960297">p</span><span class="op" id="5960298">.</span><span class="ident" id="5960299">expr</span><span class="op" id="5960303">(</span><span class="ident" id="5960304">stripParensAlways</span><span class="op" id="5960321">(</span><span class="ident" id="5960322">result</span><span class="op" id="5960328">.</span><span class="ident" id="5960329">List</span><span class="op" id="5960333">[</span><span class="num" id="5960334">0</span><span class="op" id="5960335">]</span><span class="op" id="5960336">.</span><span class="ident" id="5960337">Type</span><span class="op" id="5960341">)</span><span class="op" id="5960342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960347">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960360">p</span><span class="op" id="5960361">.</span><span class="ident" id="5960362">parameters</span><span class="op" id="5960372">(</span><span class="ident" id="5960373">result</span><span class="op" id="5960379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960382">}</span><br>
<span class="lineno"></span><span class="op" id="5960384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5960387">func</span>&nbsp;<span class="ident" id="5960392">identListSize</span><span class="op" id="5960405">(</span><span class="ident" id="5960406">list</span>&nbsp;<span class="op" id="5960411">[</span><span class="op" id="5960412">]</span><span class="op" id="5960413">*</span><span class="ident" id="5960414">ast</span><span class="op" id="5960417">.</span><span class="ident" id="5960418">Ident</span><span class="op" id="5960423">,</span>&nbsp;<span class="ident" id="5960425">maxSize</span>&nbsp;<span class="builtintype" id="5960433">int</span><span class="op" id="5960436">)</span>&nbsp;<span class="op" id="5960438">(</span><span class="ident" id="5960439">size</span>&nbsp;<span class="builtintype" id="5960444">int</span><span class="op" id="5960447">)</span>&nbsp;<span class="op" id="5960449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960452">for</span>&nbsp;<span class="ident" id="5960456">i</span><span class="op" id="5960457">,</span>&nbsp;<span class="ident" id="5960459">x</span>&nbsp;<span class="op" id="5960461">:=</span>&nbsp;<span class="keyword" id="5960464">range</span>&nbsp;<span class="ident" id="5960470">list</span>&nbsp;<span class="op" id="5960475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960479">if</span>&nbsp;<span class="ident" id="5960482">i</span>&nbsp;<span class="op" id="5960484">&gt;</span>&nbsp;<span class="num" id="5960486">0</span>&nbsp;<span class="op" id="5960488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960493">size</span>&nbsp;<span class="op" id="5960498">+=</span>&nbsp;<span class="builtinfunc" id="5960501">len</span><span class="op" id="5960504">(</span><span class="string" id="5960505">&#34;,&nbsp;&#34;</span><span class="op" id="5960509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960513">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960517">size</span>&nbsp;<span class="op" id="5960522">+=</span>&nbsp;<span class="ident" id="5960525">utf8</span><span class="op" id="5960529">.</span><span class="ident" id="5960530">RuneCountInString</span><span class="op" id="5960547">(</span><span class="ident" id="5960548">x</span><span class="op" id="5960549">.</span><span class="ident" id="5960550">Name</span><span class="op" id="5960554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960558">if</span>&nbsp;<span class="ident" id="5960561">size</span>&nbsp;<span class="op" id="5960566">&gt;=</span>&nbsp;<span class="ident" id="5960569">maxSize</span>&nbsp;<span class="op" id="5960577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960593">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960596">return</span><br>
<span class="lineno"></span><span class="op" id="5960603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5960606">func</span>&nbsp;<span class="op" id="5960611">(</span><span class="ident" id="5960612">p</span>&nbsp;<span class="op" id="5960614">*</span><span class="ident" id="5960615">printer</span><span class="op" id="5960622">)</span>&nbsp;<span class="ident" id="5960624">isOneLineFieldList</span><span class="op" id="5960642">(</span><span class="ident" id="5960643">list</span>&nbsp;<span class="op" id="5960648">[</span><span class="op" id="5960649">]</span><span class="op" id="5960650">*</span><span class="ident" id="5960651">ast</span><span class="op" id="5960654">.</span><span class="ident" id="5960655">Field</span><span class="op" id="5960660">)</span>&nbsp;<span class="builtintype" id="5960662">bool</span>&nbsp;<span class="op" id="5960667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960670">if</span>&nbsp;<span class="builtinfunc" id="5960673">len</span><span class="op" id="5960676">(</span><span class="ident" id="5960677">list</span><span class="op" id="5960681">)</span>&nbsp;<span class="op" id="5960683">!=</span>&nbsp;<span class="num" id="5960686">1</span>&nbsp;<span class="op" id="5960688">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960692">return</span>&nbsp;<span class="builtintype" id="5960699">false</span>&nbsp;<span class="comment" id="5960705">//&nbsp;allow&nbsp;only&nbsp;one&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960733">f</span>&nbsp;<span class="op" id="5960735">:=</span>&nbsp;<span class="ident" id="5960738">list</span><span class="op" id="5960742">[</span><span class="num" id="5960743">0</span><span class="op" id="5960744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960747">if</span>&nbsp;<span class="ident" id="5960750">f</span><span class="op" id="5960751">.</span><span class="ident" id="5960752">Tag</span>&nbsp;<span class="op" id="5960756">!=</span>&nbsp;<span class="ident" id="5960759">nil</span>&nbsp;<span class="op" id="5960763">||</span>&nbsp;<span class="ident" id="5960766">f</span><span class="op" id="5960767">.</span><span class="ident" id="5960768">Comment</span>&nbsp;<span class="op" id="5960776">!=</span>&nbsp;<span class="ident" id="5960779">nil</span>&nbsp;<span class="op" id="5960783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960787">return</span>&nbsp;<span class="builtintype" id="5960794">false</span>&nbsp;<span class="comment" id="5960800">//&nbsp;don&#39;t&nbsp;allow&nbsp;tags&nbsp;or&nbsp;comments</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960836">//&nbsp;only&nbsp;name(s)&nbsp;and&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960862">const</span>&nbsp;<span class="ident" id="5960868">maxSize</span>&nbsp;<span class="op" id="5960876">=</span>&nbsp;<span class="num" id="5960878">30</span>&nbsp;<span class="comment" id="5960881">//&nbsp;adjust&nbsp;as&nbsp;appropriate,&nbsp;this&nbsp;is&nbsp;an&nbsp;approximate&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960937">namesSize</span>&nbsp;<span class="op" id="5960947">:=</span>&nbsp;<span class="ident" id="5960950">identListSize</span><span class="op" id="5960963">(</span><span class="ident" id="5960964">f</span><span class="op" id="5960965">.</span><span class="ident" id="5960966">Names</span><span class="op" id="5960971">,</span>&nbsp;<span class="ident" id="5960973">maxSize</span><span class="op" id="5960980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960983">if</span>&nbsp;<span class="ident" id="5960986">namesSize</span>&nbsp;<span class="op" id="5960996">&gt;</span>&nbsp;<span class="num" id="5960998">0</span>&nbsp;<span class="op" id="5961000">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961004">namesSize</span>&nbsp;<span class="op" id="5961014">=</span>&nbsp;<span class="num" id="5961016">1</span>&nbsp;<span class="comment" id="5961018">//&nbsp;blank&nbsp;between&nbsp;names&nbsp;and&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961055">typeSize</span>&nbsp;<span class="op" id="5961064">:=</span>&nbsp;<span class="ident" id="5961067">p</span><span class="op" id="5961068">.</span><span class="ident" id="5961069">nodeSize</span><span class="op" id="5961077">(</span><span class="ident" id="5961078">f</span><span class="op" id="5961079">.</span><span class="ident" id="5961080">Type</span><span class="op" id="5961084">,</span>&nbsp;<span class="ident" id="5961086">maxSize</span><span class="op" id="5961093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961096">return</span>&nbsp;<span class="ident" id="5961103">namesSize</span><span class="op" id="5961112">+</span><span class="ident" id="5961113">typeSize</span>&nbsp;<span class="op" id="5961122">&lt;=</span>&nbsp;<span class="ident" id="5961125">maxSize</span><br>
<span class="lineno"></span><span class="op" id="5961133">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5961136">func</span>&nbsp;<span class="op" id="5961141">(</span><span class="ident" id="5961142">p</span>&nbsp;<span class="op" id="5961144">*</span><span class="ident" id="5961145">printer</span><span class="op" id="5961152">)</span>&nbsp;<span class="ident" id="5961154">setLineComment</span><span class="op" id="5961168">(</span><span class="ident" id="5961169">text</span>&nbsp;<span class="builtintype" id="5961174">string</span><span class="op" id="5961180">)</span>&nbsp;<span class="op" id="5961182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961185">p</span><span class="op" id="5961186">.</span><span class="ident" id="5961187">setComment</span><span class="op" id="5961197">(</span><span class="op" id="5961198">&amp;</span><span class="ident" id="5961199">ast</span><span class="op" id="5961202">.</span><span class="ident" id="5961203">CommentGroup</span><span class="op" id="5961215">{</span><span class="ident" id="5961216">List</span><span class="op" id="5961220">:</span>&nbsp;<span class="op" id="5961222">[</span><span class="op" id="5961223">]</span><span class="op" id="5961224">*</span><span class="ident" id="5961225">ast</span><span class="op" id="5961228">.</span><span class="ident" id="5961229">Comment</span><span class="op" id="5961236">{</span><span class="op" id="5961237">{</span><span class="ident" id="5961238">Slash</span><span class="op" id="5961243">:</span>&nbsp;<span class="ident" id="5961245">token</span><span class="op" id="5961250">.</span><span class="ident" id="5961251">NoPos</span><span class="op" id="5961256">,</span>&nbsp;<span class="ident" id="5961258">Text</span><span class="op" id="5961262">:</span>&nbsp;<span class="ident" id="5961264">text</span><span class="op" id="5961268">}</span><span class="op" id="5961269">}</span><span class="op" id="5961270">}</span><span class="op" id="5961271">)</span><br>
<span class="lineno"></span><span class="op" id="5961273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5961276">func</span>&nbsp;<span class="op" id="5961281">(</span><span class="ident" id="5961282">p</span>&nbsp;<span class="op" id="5961284">*</span><span class="ident" id="5961285">printer</span><span class="op" id="5961292">)</span>&nbsp;<span class="ident" id="5961294">fieldList</span><span class="op" id="5961303">(</span><span class="ident" id="5961304">fields</span>&nbsp;<span class="op" id="5961311">*</span><span class="ident" id="5961312">ast</span><span class="op" id="5961315">.</span><span class="ident" id="5961316">FieldList</span><span class="op" id="5961325">,</span>&nbsp;<span class="ident" id="5961327">isStruct</span><span class="op" id="5961335">,</span>&nbsp;<span class="ident" id="5961337">isIncomplete</span>&nbsp;<span class="builtintype" id="5961350">bool</span><span class="op" id="5961354">)</span>&nbsp;<span class="op" id="5961356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961359">lbrace</span>&nbsp;<span class="op" id="5961366">:=</span>&nbsp;<span class="ident" id="5961369">fields</span><span class="op" id="5961375">.</span><span class="ident" id="5961376">Opening</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961385">list</span>&nbsp;<span class="op" id="5961390">:=</span>&nbsp;<span class="ident" id="5961393">fields</span><span class="op" id="5961399">.</span><span class="ident" id="5961400">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961406">rbrace</span>&nbsp;<span class="op" id="5961413">:=</span>&nbsp;<span class="ident" id="5961416">fields</span><span class="op" id="5961422">.</span><span class="ident" id="5961423">Closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961432">hasComments</span>&nbsp;<span class="op" id="5961444">:=</span>&nbsp;<span class="ident" id="5961447">isIncomplete</span>&nbsp;<span class="op" id="5961460">||</span>&nbsp;<span class="ident" id="5961463">p</span><span class="op" id="5961464">.</span><span class="ident" id="5961465">commentBefore</span><span class="op" id="5961478">(</span><span class="ident" id="5961479">p</span><span class="op" id="5961480">.</span><span class="ident" id="5961481">posFor</span><span class="op" id="5961487">(</span><span class="ident" id="5961488">rbrace</span><span class="op" id="5961494">)</span><span class="op" id="5961495">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961498">srcIsOneLine</span>&nbsp;<span class="op" id="5961511">:=</span>&nbsp;<span class="ident" id="5961514">lbrace</span><span class="op" id="5961520">.</span><span class="ident" id="5961521">IsValid</span><span class="op" id="5961528">(</span><span class="op" id="5961529">)</span>&nbsp;<span class="op" id="5961531">&amp;&amp;</span>&nbsp;<span class="ident" id="5961534">rbrace</span><span class="op" id="5961540">.</span><span class="ident" id="5961541">IsValid</span><span class="op" id="5961548">(</span><span class="op" id="5961549">)</span>&nbsp;<span class="op" id="5961551">&amp;&amp;</span>&nbsp;<span class="ident" id="5961554">p</span><span class="op" id="5961555">.</span><span class="ident" id="5961556">lineFor</span><span class="op" id="5961563">(</span><span class="ident" id="5961564">lbrace</span><span class="op" id="5961570">)</span>&nbsp;<span class="op" id="5961572">==</span>&nbsp;<span class="ident" id="5961575">p</span><span class="op" id="5961576">.</span><span class="ident" id="5961577">lineFor</span><span class="op" id="5961584">(</span><span class="ident" id="5961585">rbrace</span><span class="op" id="5961591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961595">if</span>&nbsp;<span class="op" id="5961598">!</span><span class="ident" id="5961599">hasComments</span>&nbsp;<span class="op" id="5961611">&amp;&amp;</span>&nbsp;<span class="ident" id="5961614">srcIsOneLine</span>&nbsp;<span class="op" id="5961627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961631">//&nbsp;possibly&nbsp;a&nbsp;one-line&nbsp;struct/interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961673">if</span>&nbsp;<span class="builtinfunc" id="5961676">len</span><span class="op" id="5961679">(</span><span class="ident" id="5961680">list</span><span class="op" id="5961684">)</span>&nbsp;<span class="op" id="5961686">==</span>&nbsp;<span class="num" id="5961689">0</span>&nbsp;<span class="op" id="5961691">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961696">//&nbsp;no&nbsp;blank&nbsp;between&nbsp;keyword&nbsp;and&nbsp;{}&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961747">p</span><span class="op" id="5961748">.</span><span class="builtinfunc" id="5961749">print</span><span class="op" id="5961754">(</span><span class="ident" id="5961755">lbrace</span><span class="op" id="5961761">,</span>&nbsp;<span class="ident" id="5961763">token</span><span class="op" id="5961768">.</span><span class="ident" id="5961769">LBRACE</span><span class="op" id="5961775">,</span>&nbsp;<span class="ident" id="5961777">rbrace</span><span class="op" id="5961783">,</span>&nbsp;<span class="ident" id="5961785">token</span><span class="op" id="5961790">.</span><span class="ident" id="5961791">RBRACE</span><span class="op" id="5961797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961802">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961811">}</span>&nbsp;<span class="keyword" id="5961813">else</span>&nbsp;<span class="keyword" id="5961818">if</span>&nbsp;<span class="ident" id="5961821">isStruct</span>&nbsp;<span class="op" id="5961830">&amp;&amp;</span>&nbsp;<span class="ident" id="5961833">p</span><span class="op" id="5961834">.</span><span class="ident" id="5961835">isOneLineFieldList</span><span class="op" id="5961853">(</span><span class="ident" id="5961854">list</span><span class="op" id="5961858">)</span>&nbsp;<span class="op" id="5961860">{</span>&nbsp;<span class="comment" id="5961862">//&nbsp;for&nbsp;now&nbsp;ignore&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961894">//&nbsp;small&nbsp;enough&nbsp;-&nbsp;print&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961933">//&nbsp;(don&#39;t&nbsp;use&nbsp;identList&nbsp;and&nbsp;ignore&nbsp;source&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961991">p</span><span class="op" id="5961992">.</span><span class="builtinfunc" id="5961993">print</span><span class="op" id="5961998">(</span><span class="ident" id="5961999">lbrace</span><span class="op" id="5962005">,</span>&nbsp;<span class="ident" id="5962007">token</span><span class="op" id="5962012">.</span><span class="ident" id="5962013">LBRACE</span><span class="op" id="5962019">,</span>&nbsp;<span class="ident" id="5962021">blank</span><span class="op" id="5962026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962031">f</span>&nbsp;<span class="op" id="5962033">:=</span>&nbsp;<span class="ident" id="5962036">list</span><span class="op" id="5962040">[</span><span class="num" id="5962041">0</span><span class="op" id="5962042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962047">for</span>&nbsp;<span class="ident" id="5962051">i</span><span class="op" id="5962052">,</span>&nbsp;<span class="ident" id="5962054">x</span>&nbsp;<span class="op" id="5962056">:=</span>&nbsp;<span class="keyword" id="5962059">range</span>&nbsp;<span class="ident" id="5962065">f</span><span class="op" id="5962066">.</span><span class="ident" id="5962067">Names</span>&nbsp;<span class="op" id="5962073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962079">if</span>&nbsp;<span class="ident" id="5962082">i</span>&nbsp;<span class="op" id="5962084">&gt;</span>&nbsp;<span class="num" id="5962086">0</span>&nbsp;<span class="op" id="5962088">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962095">//&nbsp;no&nbsp;comments&nbsp;so&nbsp;no&nbsp;need&nbsp;for&nbsp;comma&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962145">p</span><span class="op" id="5962146">.</span><span class="builtinfunc" id="5962147">print</span><span class="op" id="5962152">(</span><span class="ident" id="5962153">token</span><span class="op" id="5962158">.</span><span class="ident" id="5962159">COMMA</span><span class="op" id="5962164">,</span>&nbsp;<span class="ident" id="5962166">blank</span><span class="op" id="5962171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962183">p</span><span class="op" id="5962184">.</span><span class="ident" id="5962185">expr</span><span class="op" id="5962189">(</span><span class="ident" id="5962190">x</span><span class="op" id="5962191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962196">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962201">if</span>&nbsp;<span class="builtinfunc" id="5962204">len</span><span class="op" id="5962207">(</span><span class="ident" id="5962208">f</span><span class="op" id="5962209">.</span><span class="ident" id="5962210">Names</span><span class="op" id="5962215">)</span>&nbsp;<span class="op" id="5962217">&gt;</span>&nbsp;<span class="num" id="5962219">0</span>&nbsp;<span class="op" id="5962221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962227">p</span><span class="op" id="5962228">.</span><span class="builtinfunc" id="5962229">print</span><span class="op" id="5962234">(</span><span class="ident" id="5962235">blank</span><span class="op" id="5962240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962250">p</span><span class="op" id="5962251">.</span><span class="ident" id="5962252">expr</span><span class="op" id="5962256">(</span><span class="ident" id="5962257">f</span><span class="op" id="5962258">.</span><span class="ident" id="5962259">Type</span><span class="op" id="5962263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962268">p</span><span class="op" id="5962269">.</span><span class="builtinfunc" id="5962270">print</span><span class="op" id="5962275">(</span><span class="ident" id="5962276">blank</span><span class="op" id="5962281">,</span>&nbsp;<span class="ident" id="5962283">rbrace</span><span class="op" id="5962289">,</span>&nbsp;<span class="ident" id="5962291">token</span><span class="op" id="5962296">.</span><span class="ident" id="5962297">RBRACE</span><span class="op" id="5962303">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962308">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962323">//&nbsp;hasComments&nbsp;||&nbsp;!srcIsOneLine</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962357">p</span><span class="op" id="5962358">.</span><span class="builtinfunc" id="5962359">print</span><span class="op" id="5962364">(</span><span class="ident" id="5962365">blank</span><span class="op" id="5962370">,</span>&nbsp;<span class="ident" id="5962372">lbrace</span><span class="op" id="5962378">,</span>&nbsp;<span class="ident" id="5962380">token</span><span class="op" id="5962385">.</span><span class="ident" id="5962386">LBRACE</span><span class="op" id="5962392">,</span>&nbsp;<span class="ident" id="5962394">indent</span><span class="op" id="5962400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962403">if</span>&nbsp;<span class="ident" id="5962406">hasComments</span>&nbsp;<span class="op" id="5962418">||</span>&nbsp;<span class="builtinfunc" id="5962421">len</span><span class="op" id="5962424">(</span><span class="ident" id="5962425">list</span><span class="op" id="5962429">)</span>&nbsp;<span class="op" id="5962431">&gt;</span>&nbsp;<span class="num" id="5962433">0</span>&nbsp;<span class="op" id="5962435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962439">p</span><span class="op" id="5962440">.</span><span class="builtinfunc" id="5962441">print</span><span class="op" id="5962446">(</span><span class="ident" id="5962447">formfeed</span><span class="op" id="5962455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962462">if</span>&nbsp;<span class="ident" id="5962465">isStruct</span>&nbsp;<span class="op" id="5962474">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962479">sep</span>&nbsp;<span class="op" id="5962483">:=</span>&nbsp;<span class="ident" id="5962486">vtab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962493">if</span>&nbsp;<span class="builtinfunc" id="5962496">len</span><span class="op" id="5962499">(</span><span class="ident" id="5962500">list</span><span class="op" id="5962504">)</span>&nbsp;<span class="op" id="5962506">==</span>&nbsp;<span class="num" id="5962509">1</span>&nbsp;<span class="op" id="5962511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962516">sep</span>&nbsp;<span class="op" id="5962520">=</span>&nbsp;<span class="ident" id="5962522">blank</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962534">var</span>&nbsp;<span class="ident" id="5962538">line</span>&nbsp;<span class="builtintype" id="5962543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962549">for</span>&nbsp;<span class="ident" id="5962553">i</span><span class="op" id="5962554">,</span>&nbsp;<span class="ident" id="5962556">f</span>&nbsp;<span class="op" id="5962558">:=</span>&nbsp;<span class="keyword" id="5962561">range</span>&nbsp;<span class="ident" id="5962567">list</span>&nbsp;<span class="op" id="5962572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962577">if</span>&nbsp;<span class="ident" id="5962580">i</span>&nbsp;<span class="op" id="5962582">&gt;</span>&nbsp;<span class="num" id="5962584">0</span>&nbsp;<span class="op" id="5962586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962592">p</span><span class="op" id="5962593">.</span><span class="ident" id="5962594">linebreak</span><span class="op" id="5962603">(</span><span class="ident" id="5962604">p</span><span class="op" id="5962605">.</span><span class="ident" id="5962606">lineFor</span><span class="op" id="5962613">(</span><span class="ident" id="5962614">f</span><span class="op" id="5962615">.</span><span class="ident" id="5962616">Pos</span><span class="op" id="5962619">(</span><span class="op" id="5962620">)</span><span class="op" id="5962621">)</span><span class="op" id="5962622">,</span>&nbsp;<span class="num" id="5962624">1</span><span class="op" id="5962625">,</span>&nbsp;<span class="ident" id="5962627">ignore</span><span class="op" id="5962633">,</span>&nbsp;<span class="ident" id="5962635">p</span><span class="op" id="5962636">.</span><span class="ident" id="5962637">linesFrom</span><span class="op" id="5962646">(</span><span class="ident" id="5962647">line</span><span class="op" id="5962651">)</span>&nbsp;<span class="op" id="5962653">&gt;</span>&nbsp;<span class="num" id="5962655">0</span><span class="op" id="5962656">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962666">extraTabs</span>&nbsp;<span class="op" id="5962676">:=</span>&nbsp;<span class="num" id="5962679">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962684">p</span><span class="op" id="5962685">.</span><span class="ident" id="5962686">setComment</span><span class="op" id="5962696">(</span><span class="ident" id="5962697">f</span><span class="op" id="5962698">.</span><span class="ident" id="5962699">Doc</span><span class="op" id="5962702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962707">p</span><span class="op" id="5962708">.</span><span class="ident" id="5962709">recordLine</span><span class="op" id="5962719">(</span><span class="op" id="5962720">&amp;</span><span class="ident" id="5962721">line</span><span class="op" id="5962725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962730">if</span>&nbsp;<span class="builtinfunc" id="5962733">len</span><span class="op" id="5962736">(</span><span class="ident" id="5962737">f</span><span class="op" id="5962738">.</span><span class="ident" id="5962739">Names</span><span class="op" id="5962744">)</span>&nbsp;<span class="op" id="5962746">&gt;</span>&nbsp;<span class="num" id="5962748">0</span>&nbsp;<span class="op" id="5962750">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962756">//&nbsp;named&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962776">p</span><span class="op" id="5962777">.</span><span class="ident" id="5962778">identList</span><span class="op" id="5962787">(</span><span class="ident" id="5962788">f</span><span class="op" id="5962789">.</span><span class="ident" id="5962790">Names</span><span class="op" id="5962795">,</span>&nbsp;<span class="builtintype" id="5962797">false</span><span class="op" id="5962802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962808">p</span><span class="op" id="5962809">.</span><span class="builtinfunc" id="5962810">print</span><span class="op" id="5962815">(</span><span class="ident" id="5962816">sep</span><span class="op" id="5962819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962825">p</span><span class="op" id="5962826">.</span><span class="ident" id="5962827">expr</span><span class="op" id="5962831">(</span><span class="ident" id="5962832">f</span><span class="op" id="5962833">.</span><span class="ident" id="5962834">Type</span><span class="op" id="5962838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962844">extraTabs</span>&nbsp;<span class="op" id="5962854">=</span>&nbsp;<span class="num" id="5962856">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962861">}</span>&nbsp;<span class="keyword" id="5962863">else</span>&nbsp;<span class="op" id="5962868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962874">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962897">p</span><span class="op" id="5962898">.</span><span class="ident" id="5962899">expr</span><span class="op" id="5962903">(</span><span class="ident" id="5962904">f</span><span class="op" id="5962905">.</span><span class="ident" id="5962906">Type</span><span class="op" id="5962910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962916">extraTabs</span>&nbsp;<span class="op" id="5962926">=</span>&nbsp;<span class="num" id="5962928">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962933">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962938">if</span>&nbsp;<span class="ident" id="5962941">f</span><span class="op" id="5962942">.</span><span class="ident" id="5962943">Tag</span>&nbsp;<span class="op" id="5962947">!=</span>&nbsp;<span class="ident" id="5962950">nil</span>&nbsp;<span class="op" id="5962954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962960">if</span>&nbsp;<span class="builtinfunc" id="5962963">len</span><span class="op" id="5962966">(</span><span class="ident" id="5962967">f</span><span class="op" id="5962968">.</span><span class="ident" id="5962969">Names</span><span class="op" id="5962974">)</span>&nbsp;<span class="op" id="5962976">&gt;</span>&nbsp;<span class="num" id="5962978">0</span>&nbsp;<span class="op" id="5962980">&amp;&amp;</span>&nbsp;<span class="ident" id="5962983">sep</span>&nbsp;<span class="op" id="5962987">==</span>&nbsp;<span class="ident" id="5962990">vtab</span>&nbsp;<span class="op" id="5962995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963002">p</span><span class="op" id="5963003">.</span><span class="builtinfunc" id="5963004">print</span><span class="op" id="5963009">(</span><span class="ident" id="5963010">sep</span><span class="op" id="5963013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963025">p</span><span class="op" id="5963026">.</span><span class="builtinfunc" id="5963027">print</span><span class="op" id="5963032">(</span><span class="ident" id="5963033">sep</span><span class="op" id="5963036">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963042">p</span><span class="op" id="5963043">.</span><span class="ident" id="5963044">expr</span><span class="op" id="5963048">(</span><span class="ident" id="5963049">f</span><span class="op" id="5963050">.</span><span class="ident" id="5963051">Tag</span><span class="op" id="5963054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963060">extraTabs</span>&nbsp;<span class="op" id="5963070">=</span>&nbsp;<span class="num" id="5963072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963082">if</span>&nbsp;<span class="ident" id="5963085">f</span><span class="op" id="5963086">.</span><span class="ident" id="5963087">Comment</span>&nbsp;<span class="op" id="5963095">!=</span>&nbsp;<span class="ident" id="5963098">nil</span>&nbsp;<span class="op" id="5963102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963108">for</span>&nbsp;<span class="op" id="5963112">;</span>&nbsp;<span class="ident" id="5963114">extraTabs</span>&nbsp;<span class="op" id="5963124">&gt;</span>&nbsp;<span class="num" id="5963126">0</span><span class="op" id="5963127">;</span>&nbsp;<span class="ident" id="5963129">extraTabs</span><span class="op" id="5963138">--</span>&nbsp;<span class="op" id="5963141">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963148">p</span><span class="op" id="5963149">.</span><span class="builtinfunc" id="5963150">print</span><span class="op" id="5963155">(</span><span class="ident" id="5963156">sep</span><span class="op" id="5963159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963171">p</span><span class="op" id="5963172">.</span><span class="ident" id="5963173">setComment</span><span class="op" id="5963183">(</span><span class="ident" id="5963184">f</span><span class="op" id="5963185">.</span><span class="ident" id="5963186">Comment</span><span class="op" id="5963193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963202">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963206">if</span>&nbsp;<span class="ident" id="5963209">isIncomplete</span>&nbsp;<span class="op" id="5963222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963227">if</span>&nbsp;<span class="builtinfunc" id="5963230">len</span><span class="op" id="5963233">(</span><span class="ident" id="5963234">list</span><span class="op" id="5963238">)</span>&nbsp;<span class="op" id="5963240">&gt;</span>&nbsp;<span class="num" id="5963242">0</span>&nbsp;<span class="op" id="5963244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963250">p</span><span class="op" id="5963251">.</span><span class="builtinfunc" id="5963252">print</span><span class="op" id="5963257">(</span><span class="ident" id="5963258">formfeed</span><span class="op" id="5963266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963276">p</span><span class="op" id="5963277">.</span><span class="ident" id="5963278">flush</span><span class="op" id="5963283">(</span><span class="ident" id="5963284">p</span><span class="op" id="5963285">.</span><span class="ident" id="5963286">posFor</span><span class="op" id="5963292">(</span><span class="ident" id="5963293">rbrace</span><span class="op" id="5963299">)</span><span class="op" id="5963300">,</span>&nbsp;<span class="ident" id="5963302">token</span><span class="op" id="5963307">.</span><span class="ident" id="5963308">RBRACE</span><span class="op" id="5963314">)</span>&nbsp;<span class="comment" id="5963316">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963368">p</span><span class="op" id="5963369">.</span><span class="ident" id="5963370">setLineComment</span><span class="op" id="5963384">(</span><span class="string" id="5963385">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;fields&#34;</span><span class="op" id="5963428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963436">}</span>&nbsp;<span class="keyword" id="5963438">else</span>&nbsp;<span class="op" id="5963443">{</span>&nbsp;<span class="comment" id="5963445">//&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963461">var</span>&nbsp;<span class="ident" id="5963465">line</span>&nbsp;<span class="builtintype" id="5963470">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963476">for</span>&nbsp;<span class="ident" id="5963480">i</span><span class="op" id="5963481">,</span>&nbsp;<span class="ident" id="5963483">f</span>&nbsp;<span class="op" id="5963485">:=</span>&nbsp;<span class="keyword" id="5963488">range</span>&nbsp;<span class="ident" id="5963494">list</span>&nbsp;<span class="op" id="5963499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963504">if</span>&nbsp;<span class="ident" id="5963507">i</span>&nbsp;<span class="op" id="5963509">&gt;</span>&nbsp;<span class="num" id="5963511">0</span>&nbsp;<span class="op" id="5963513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963519">p</span><span class="op" id="5963520">.</span><span class="ident" id="5963521">linebreak</span><span class="op" id="5963530">(</span><span class="ident" id="5963531">p</span><span class="op" id="5963532">.</span><span class="ident" id="5963533">lineFor</span><span class="op" id="5963540">(</span><span class="ident" id="5963541">f</span><span class="op" id="5963542">.</span><span class="ident" id="5963543">Pos</span><span class="op" id="5963546">(</span><span class="op" id="5963547">)</span><span class="op" id="5963548">)</span><span class="op" id="5963549">,</span>&nbsp;<span class="num" id="5963551">1</span><span class="op" id="5963552">,</span>&nbsp;<span class="ident" id="5963554">ignore</span><span class="op" id="5963560">,</span>&nbsp;<span class="ident" id="5963562">p</span><span class="op" id="5963563">.</span><span class="ident" id="5963564">linesFrom</span><span class="op" id="5963573">(</span><span class="ident" id="5963574">line</span><span class="op" id="5963578">)</span>&nbsp;<span class="op" id="5963580">&gt;</span>&nbsp;<span class="num" id="5963582">0</span><span class="op" id="5963583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963588">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963593">p</span><span class="op" id="5963594">.</span><span class="ident" id="5963595">setComment</span><span class="op" id="5963605">(</span><span class="ident" id="5963606">f</span><span class="op" id="5963607">.</span><span class="ident" id="5963608">Doc</span><span class="op" id="5963611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963616">p</span><span class="op" id="5963617">.</span><span class="ident" id="5963618">recordLine</span><span class="op" id="5963628">(</span><span class="op" id="5963629">&amp;</span><span class="ident" id="5963630">line</span><span class="op" id="5963634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963639">if</span>&nbsp;<span class="ident" id="5963642">ftyp</span><span class="op" id="5963646">,</span>&nbsp;<span class="ident" id="5963648">isFtyp</span>&nbsp;<span class="op" id="5963655">:=</span>&nbsp;<span class="ident" id="5963658">f</span><span class="op" id="5963659">.</span><span class="ident" id="5963660">Type</span><span class="op" id="5963664">.</span><span class="op" id="5963665">(</span><span class="op" id="5963666">*</span><span class="ident" id="5963667">ast</span><span class="op" id="5963670">.</span><span class="ident" id="5963671">FuncType</span><span class="op" id="5963679">)</span><span class="op" id="5963680">;</span>&nbsp;<span class="ident" id="5963682">isFtyp</span>&nbsp;<span class="op" id="5963689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963695">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963709">p</span><span class="op" id="5963710">.</span><span class="ident" id="5963711">expr</span><span class="op" id="5963715">(</span><span class="ident" id="5963716">f</span><span class="op" id="5963717">.</span><span class="ident" id="5963718">Names</span><span class="op" id="5963723">[</span><span class="num" id="5963724">0</span><span class="op" id="5963725">]</span><span class="op" id="5963726">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963732">p</span><span class="op" id="5963733">.</span><span class="ident" id="5963734">signature</span><span class="op" id="5963743">(</span><span class="ident" id="5963744">ftyp</span><span class="op" id="5963748">.</span><span class="ident" id="5963749">Params</span><span class="op" id="5963755">,</span>&nbsp;<span class="ident" id="5963757">ftyp</span><span class="op" id="5963761">.</span><span class="ident" id="5963762">Results</span><span class="op" id="5963769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963774">}</span>&nbsp;<span class="keyword" id="5963776">else</span>&nbsp;<span class="op" id="5963781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963787">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963813">p</span><span class="op" id="5963814">.</span><span class="ident" id="5963815">expr</span><span class="op" id="5963819">(</span><span class="ident" id="5963820">f</span><span class="op" id="5963821">.</span><span class="ident" id="5963822">Type</span><span class="op" id="5963826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963831">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963836">p</span><span class="op" id="5963837">.</span><span class="ident" id="5963838">setComment</span><span class="op" id="5963848">(</span><span class="ident" id="5963849">f</span><span class="op" id="5963850">.</span><span class="ident" id="5963851">Comment</span><span class="op" id="5963858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963866">if</span>&nbsp;<span class="ident" id="5963869">isIncomplete</span>&nbsp;<span class="op" id="5963882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963887">if</span>&nbsp;<span class="builtinfunc" id="5963890">len</span><span class="op" id="5963893">(</span><span class="ident" id="5963894">list</span><span class="op" id="5963898">)</span>&nbsp;<span class="op" id="5963900">&gt;</span>&nbsp;<span class="num" id="5963902">0</span>&nbsp;<span class="op" id="5963904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963910">p</span><span class="op" id="5963911">.</span><span class="builtinfunc" id="5963912">print</span><span class="op" id="5963917">(</span><span class="ident" id="5963918">formfeed</span><span class="op" id="5963926">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963936">p</span><span class="op" id="5963937">.</span><span class="ident" id="5963938">flush</span><span class="op" id="5963943">(</span><span class="ident" id="5963944">p</span><span class="op" id="5963945">.</span><span class="ident" id="5963946">posFor</span><span class="op" id="5963952">(</span><span class="ident" id="5963953">rbrace</span><span class="op" id="5963959">)</span><span class="op" id="5963960">,</span>&nbsp;<span class="ident" id="5963962">token</span><span class="op" id="5963967">.</span><span class="ident" id="5963968">RBRACE</span><span class="op" id="5963974">)</span>&nbsp;<span class="comment" id="5963976">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964028">p</span><span class="op" id="5964029">.</span><span class="ident" id="5964030">setLineComment</span><span class="op" id="5964044">(</span><span class="string" id="5964045">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;methods&#34;</span><span class="op" id="5964089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964100">p</span><span class="op" id="5964101">.</span><span class="builtinfunc" id="5964102">print</span><span class="op" id="5964107">(</span><span class="ident" id="5964108">unindent</span><span class="op" id="5964116">,</span>&nbsp;<span class="ident" id="5964118">formfeed</span><span class="op" id="5964126">,</span>&nbsp;<span class="ident" id="5964128">rbrace</span><span class="op" id="5964134">,</span>&nbsp;<span class="ident" id="5964136">token</span><span class="op" id="5964141">.</span><span class="ident" id="5964142">RBRACE</span><span class="op" id="5964148">)</span><br>
<span class="lineno"></span><span class="op" id="5964150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964153">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">505</span><span class="comment" id="5964233">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5964249">func</span>&nbsp;<span class="ident" id="5964254">walkBinary</span><span class="op" id="5964264">(</span><span class="ident" id="5964265">e</span>&nbsp;<span class="op" id="5964267">*</span><span class="ident" id="5964268">ast</span><span class="op" id="5964271">.</span><span class="ident" id="5964272">BinaryExpr</span><span class="op" id="5964282">)</span>&nbsp;<span class="op" id="5964284">(</span><span class="ident" id="5964285">has4</span><span class="op" id="5964289">,</span>&nbsp;<span class="ident" id="5964291">has5</span>&nbsp;<span class="builtintype" id="5964296">bool</span><span class="op" id="5964300">,</span>&nbsp;<span class="ident" id="5964302">maxProblem</span>&nbsp;<span class="builtintype" id="5964313">int</span><span class="op" id="5964316">)</span>&nbsp;<span class="op" id="5964318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964321">switch</span>&nbsp;<span class="ident" id="5964328">e</span><span class="op" id="5964329">.</span><span class="ident" id="5964330">Op</span><span class="op" id="5964332">.</span><span class="ident" id="5964333">Precedence</span><span class="op" id="5964343">(</span><span class="op" id="5964344">)</span>&nbsp;<span class="op" id="5964346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964349">case</span>&nbsp;<span class="num" id="5964354">4</span><span class="op" id="5964355">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964359">has4</span>&nbsp;<span class="op" id="5964364">=</span>&nbsp;<span class="builtintype" id="5964366">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964372">case</span>&nbsp;<span class="num" id="5964377">5</span><span class="op" id="5964378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964382">has5</span>&nbsp;<span class="op" id="5964387">=</span>&nbsp;<span class="builtintype" id="5964389">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964399">switch</span>&nbsp;<span class="ident" id="5964406">l</span>&nbsp;<span class="op" id="5964408">:=</span>&nbsp;<span class="ident" id="5964411">e</span><span class="op" id="5964412">.</span><span class="ident" id="5964413">X</span><span class="op" id="5964414">.</span><span class="op" id="5964415">(</span><span class="keyword" id="5964416">type</span><span class="op" id="5964420">)</span>&nbsp;<span class="op" id="5964422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964425">case</span>&nbsp;<span class="op" id="5964430">*</span><span class="ident" id="5964431">ast</span><span class="op" id="5964434">.</span><span class="ident" id="5964435">BinaryExpr</span><span class="op" id="5964445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964449">if</span>&nbsp;<span class="ident" id="5964452">l</span><span class="op" id="5964453">.</span><span class="ident" id="5964454">Op</span><span class="op" id="5964456">.</span><span class="ident" id="5964457">Precedence</span><span class="op" id="5964467">(</span><span class="op" id="5964468">)</span>&nbsp;<span class="op" id="5964470">&lt;</span>&nbsp;<span class="ident" id="5964472">e</span><span class="op" id="5964473">.</span><span class="ident" id="5964474">Op</span><span class="op" id="5964476">.</span><span class="ident" id="5964477">Precedence</span><span class="op" id="5964487">(</span><span class="op" id="5964488">)</span>&nbsp;<span class="op" id="5964490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964495">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964526">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964594">h4</span><span class="op" id="5964596">,</span>&nbsp;<span class="ident" id="5964598">h5</span><span class="op" id="5964600">,</span>&nbsp;<span class="ident" id="5964602">mp</span>&nbsp;<span class="op" id="5964605">:=</span>&nbsp;<span class="ident" id="5964608">walkBinary</span><span class="op" id="5964618">(</span><span class="ident" id="5964619">l</span><span class="op" id="5964620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964624">has4</span>&nbsp;<span class="op" id="5964629">=</span>&nbsp;<span class="ident" id="5964631">has4</span>&nbsp;<span class="op" id="5964636">||</span>&nbsp;<span class="ident" id="5964639">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964644">has5</span>&nbsp;<span class="op" id="5964649">=</span>&nbsp;<span class="ident" id="5964651">has5</span>&nbsp;<span class="op" id="5964656">||</span>&nbsp;<span class="ident" id="5964659">h5</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964664">if</span>&nbsp;<span class="ident" id="5964667">maxProblem</span>&nbsp;<span class="op" id="5964678">&lt;</span>&nbsp;<span class="ident" id="5964680">mp</span>&nbsp;<span class="op" id="5964683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964688">maxProblem</span>&nbsp;<span class="op" id="5964699">=</span>&nbsp;<span class="ident" id="5964701">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964713">switch</span>&nbsp;<span class="ident" id="5964720">r</span>&nbsp;<span class="op" id="5964722">:=</span>&nbsp;<span class="ident" id="5964725">e</span><span class="op" id="5964726">.</span><span class="ident" id="5964727">Y</span><span class="op" id="5964728">.</span><span class="op" id="5964729">(</span><span class="keyword" id="5964730">type</span><span class="op" id="5964734">)</span>&nbsp;<span class="op" id="5964736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964739">case</span>&nbsp;<span class="op" id="5964744">*</span><span class="ident" id="5964745">ast</span><span class="op" id="5964748">.</span><span class="ident" id="5964749">BinaryExpr</span><span class="op" id="5964759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964763">if</span>&nbsp;<span class="ident" id="5964766">r</span><span class="op" id="5964767">.</span><span class="ident" id="5964768">Op</span><span class="op" id="5964770">.</span><span class="ident" id="5964771">Precedence</span><span class="op" id="5964781">(</span><span class="op" id="5964782">)</span>&nbsp;<span class="op" id="5964784">&lt;=</span>&nbsp;<span class="ident" id="5964787">e</span><span class="op" id="5964788">.</span><span class="ident" id="5964789">Op</span><span class="op" id="5964791">.</span><span class="ident" id="5964792">Precedence</span><span class="op" id="5964802">(</span><span class="op" id="5964803">)</span>&nbsp;<span class="op" id="5964805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964810">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964841">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964897">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964909">h4</span><span class="op" id="5964911">,</span>&nbsp;<span class="ident" id="5964913">h5</span><span class="op" id="5964915">,</span>&nbsp;<span class="ident" id="5964917">mp</span>&nbsp;<span class="op" id="5964920">:=</span>&nbsp;<span class="ident" id="5964923">walkBinary</span><span class="op" id="5964933">(</span><span class="ident" id="5964934">r</span><span class="op" id="5964935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964939">has4</span>&nbsp;<span class="op" id="5964944">=</span>&nbsp;<span class="ident" id="5964946">has4</span>&nbsp;<span class="op" id="5964951">||</span>&nbsp;<span class="ident" id="5964954">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964959">has5</span>&nbsp;<span class="op" id="5964964">=</span>&nbsp;<span class="ident" id="5964966">has5</span>&nbsp;<span class="op" id="5964971">||</span>&nbsp;<span class="ident" id="5964974">h5</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964979">if</span>&nbsp;<span class="ident" id="5964982">maxProblem</span>&nbsp;<span class="op" id="5964993">&lt;</span>&nbsp;<span class="ident" id="5964995">mp</span>&nbsp;<span class="op" id="5964998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965003">maxProblem</span>&nbsp;<span class="op" id="5965014">=</span>&nbsp;<span class="ident" id="5965016">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965025">case</span>&nbsp;<span class="op" id="5965030">*</span><span class="ident" id="5965031">ast</span><span class="op" id="5965034">.</span><span class="ident" id="5965035">StarExpr</span><span class="op" id="5965043">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965047">if</span>&nbsp;<span class="ident" id="5965050">e</span><span class="op" id="5965051">.</span><span class="ident" id="5965052">Op</span>&nbsp;<span class="op" id="5965055">==</span>&nbsp;<span class="ident" id="5965058">token</span><span class="op" id="5965063">.</span><span class="ident" id="5965064">QUO</span>&nbsp;<span class="op" id="5965068">{</span>&nbsp;<span class="comment" id="5965070">//&nbsp;`*/`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965081">maxProblem</span>&nbsp;<span class="op" id="5965092">=</span>&nbsp;<span class="num" id="5965094">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965102">case</span>&nbsp;<span class="op" id="5965107">*</span><span class="ident" id="5965108">ast</span><span class="op" id="5965111">.</span><span class="ident" id="5965112">UnaryExpr</span><span class="op" id="5965121">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965125">switch</span>&nbsp;<span class="ident" id="5965132">e</span><span class="op" id="5965133">.</span><span class="ident" id="5965134">Op</span><span class="op" id="5965136">.</span><span class="ident" id="5965137">String</span><span class="op" id="5965143">(</span><span class="op" id="5965144">)</span>&nbsp;<span class="op" id="5965146">+</span>&nbsp;<span class="ident" id="5965148">r</span><span class="op" id="5965149">.</span><span class="ident" id="5965150">Op</span><span class="op" id="5965152">.</span><span class="ident" id="5965153">String</span><span class="op" id="5965159">(</span><span class="op" id="5965160">)</span>&nbsp;<span class="op" id="5965162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965166">case</span>&nbsp;<span class="string" id="5965171">&#34;/*&#34;</span><span class="op" id="5965175">,</span>&nbsp;<span class="string" id="5965177">&#34;&amp;&amp;&#34;</span><span class="op" id="5965181">,</span>&nbsp;<span class="string" id="5965183">&#34;&amp;^&#34;</span><span class="op" id="5965187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965192">maxProblem</span>&nbsp;<span class="op" id="5965203">=</span>&nbsp;<span class="num" id="5965205">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965209">case</span>&nbsp;<span class="string" id="5965214">&#34;++&#34;</span><span class="op" id="5965218">,</span>&nbsp;<span class="string" id="5965220">&#34;--&#34;</span><span class="op" id="5965224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965229">if</span>&nbsp;<span class="ident" id="5965232">maxProblem</span>&nbsp;<span class="op" id="5965243">&lt;</span>&nbsp;<span class="num" id="5965245">4</span>&nbsp;<span class="op" id="5965247">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965253">maxProblem</span>&nbsp;<span class="op" id="5965264">=</span>&nbsp;<span class="num" id="5965266">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965281">return</span><br>
<span class="lineno">560</span><span class="op" id="5965288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965291">func</span>&nbsp;<span class="ident" id="5965296">cutoff</span><span class="op" id="5965302">(</span><span class="ident" id="5965303">e</span>&nbsp;<span class="op" id="5965305">*</span><span class="ident" id="5965306">ast</span><span class="op" id="5965309">.</span><span class="ident" id="5965310">BinaryExpr</span><span class="op" id="5965320">,</span>&nbsp;<span class="ident" id="5965322">depth</span>&nbsp;<span class="builtintype" id="5965328">int</span><span class="op" id="5965331">)</span>&nbsp;<span class="builtintype" id="5965333">int</span>&nbsp;<span class="op" id="5965337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965340">has4</span><span class="op" id="5965344">,</span>&nbsp;<span class="ident" id="5965346">has5</span><span class="op" id="5965350">,</span>&nbsp;<span class="ident" id="5965352">maxProblem</span>&nbsp;<span class="op" id="5965363">:=</span>&nbsp;<span class="ident" id="5965366">walkBinary</span><span class="op" id="5965376">(</span><span class="ident" id="5965377">e</span><span class="op" id="5965378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965381">if</span>&nbsp;<span class="ident" id="5965384">maxProblem</span>&nbsp;<span class="op" id="5965395">&gt;</span>&nbsp;<span class="num" id="5965397">0</span>&nbsp;<span class="op" id="5965399">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965403">return</span>&nbsp;<span class="ident" id="5965410">maxProblem</span>&nbsp;<span class="op" id="5965421">+</span>&nbsp;<span class="num" id="5965423">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965429">if</span>&nbsp;<span class="ident" id="5965432">has4</span>&nbsp;<span class="op" id="5965437">&amp;&amp;</span>&nbsp;<span class="ident" id="5965440">has5</span>&nbsp;<span class="op" id="5965445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965449">if</span>&nbsp;<span class="ident" id="5965452">depth</span>&nbsp;<span class="op" id="5965458">==</span>&nbsp;<span class="num" id="5965461">1</span>&nbsp;<span class="op" id="5965463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965468">return</span>&nbsp;<span class="num" id="5965475">5</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965483">return</span>&nbsp;<span class="num" id="5965490">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965496">if</span>&nbsp;<span class="ident" id="5965499">depth</span>&nbsp;<span class="op" id="5965505">==</span>&nbsp;<span class="num" id="5965508">1</span>&nbsp;<span class="op" id="5965510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965514">return</span>&nbsp;<span class="num" id="5965521">6</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965527">return</span>&nbsp;<span class="num" id="5965534">4</span><br>
<span class="lineno"></span><span class="op" id="5965536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965539">func</span>&nbsp;<span class="ident" id="5965544">diffPrec</span><span class="op" id="5965552">(</span><span class="ident" id="5965553">expr</span>&nbsp;<span class="ident" id="5965558">ast</span><span class="op" id="5965561">.</span><span class="ident" id="5965562">Expr</span><span class="op" id="5965566">,</span>&nbsp;<span class="ident" id="5965568">prec</span>&nbsp;<span class="builtintype" id="5965573">int</span><span class="op" id="5965576">)</span>&nbsp;<span class="builtintype" id="5965578">int</span>&nbsp;<span class="op" id="5965582">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965585">x</span><span class="op" id="5965586">,</span>&nbsp;<span class="ident" id="5965588">ok</span>&nbsp;<span class="op" id="5965591">:=</span>&nbsp;<span class="ident" id="5965594">expr</span><span class="op" id="5965598">.</span><span class="op" id="5965599">(</span><span class="op" id="5965600">*</span><span class="ident" id="5965601">ast</span><span class="op" id="5965604">.</span><span class="ident" id="5965605">BinaryExpr</span><span class="op" id="5965615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965618">if</span>&nbsp;<span class="op" id="5965621">!</span><span class="ident" id="5965622">ok</span>&nbsp;<span class="op" id="5965625">||</span>&nbsp;<span class="ident" id="5965628">prec</span>&nbsp;<span class="op" id="5965633">!=</span>&nbsp;<span class="ident" id="5965636">x</span><span class="op" id="5965637">.</span><span class="ident" id="5965638">Op</span><span class="op" id="5965640">.</span><span class="ident" id="5965641">Precedence</span><span class="op" id="5965651">(</span><span class="op" id="5965652">)</span>&nbsp;<span class="op" id="5965654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965658">return</span>&nbsp;<span class="num" id="5965665">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965671">return</span>&nbsp;<span class="num" id="5965678">0</span><br>
<span class="lineno">585</span><span class="op" id="5965680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965683">func</span>&nbsp;<span class="ident" id="5965688">reduceDepth</span><span class="op" id="5965699">(</span><span class="ident" id="5965700">depth</span>&nbsp;<span class="builtintype" id="5965706">int</span><span class="op" id="5965709">)</span>&nbsp;<span class="builtintype" id="5965711">int</span>&nbsp;<span class="op" id="5965715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965718">depth</span><span class="op" id="5965723">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965727">if</span>&nbsp;<span class="ident" id="5965730">depth</span>&nbsp;<span class="op" id="5965736">&lt;</span>&nbsp;<span class="num" id="5965738">1</span>&nbsp;<span class="op" id="5965740">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965744">depth</span>&nbsp;<span class="op" id="5965750">=</span>&nbsp;<span class="num" id="5965752">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965758">return</span>&nbsp;<span class="ident" id="5965765">depth</span><br>
<span class="lineno"></span><span class="op" id="5965771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5965774">//&nbsp;Format&nbsp;the&nbsp;binary&nbsp;expression:&nbsp;decide&nbsp;the&nbsp;cutoff&nbsp;and&nbsp;then&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5965842">//&nbsp;Let&#39;s&nbsp;call&nbsp;depth&nbsp;==&nbsp;1&nbsp;Normal&nbsp;mode,&nbsp;and&nbsp;depth&nbsp;&gt;&nbsp;1&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5965908">//&nbsp;(Algorithm&nbsp;suggestion&nbsp;by&nbsp;Russ&nbsp;Cox.)</span><br>
<span class="lineno"></span><span class="comment" id="5965947">//</span><br>
<span class="lineno"></span><span class="comment" id="5965950">//&nbsp;The&nbsp;precedences&nbsp;are:</span><br>
<span class="lineno">600</span><span class="comment" id="5965974">//&nbsp;&nbsp;&nbsp;&nbsp5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;/&nbsp;&nbsp;%&nbsp;&nbsp;&lt;&lt;&nbsp;&nbsp;&gt;&gt;&nbsp;&nbsp;&amp;&nbsp;&nbsp;&amp;^</span><br>
<span class="lineno"></span><span class="comment" id="5966014">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;-&nbsp;&nbsp;|&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5966042">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==&nbsp;&nbsp;!=&nbsp;&nbsp;&lt;&nbsp;&nbsp;&lt;=&nbsp;&nbsp;&gt;&nbsp;&nbsp;&gt;=</span><br>
<span class="lineno"></span><span class="comment" id="5966080">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;</span><br>
<span class="lineno"></span><span class="comment" id="5966100">//&nbsp;&nbsp;&nbsp;&nbsp1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="lineno">605</span><span class="comment" id="5966120">//</span><br>
<span class="lineno"></span><span class="comment" id="5966123">//&nbsp;The&nbsp;only&nbsp;decision&nbsp;is&nbsp;whether&nbsp;there&nbsp;will&nbsp;be&nbsp;spaces&nbsp;around&nbsp;levels&nbsp;4&nbsp;and&nbsp;5.</span><br>
<span class="lineno"></span><span class="comment" id="5966199">//&nbsp;There&nbsp;are&nbsp;never&nbsp;spaces&nbsp;at&nbsp;level&nbsp;6&nbsp;(unary),&nbsp;and&nbsp;always&nbsp;spaces&nbsp;at&nbsp;levels&nbsp;3&nbsp;and&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="5966286">//</span><br>
<span class="lineno"></span><span class="comment" id="5966289">//&nbsp;To&nbsp;choose&nbsp;the&nbsp;cutoff,&nbsp;look&nbsp;at&nbsp;the&nbsp;whole&nbsp;expression&nbsp;but&nbsp;excluding&nbsp;primary</span><br>
<span class="lineno">610</span><span class="comment" id="5966365">//&nbsp;expressions&nbsp;(function&nbsp;calls,&nbsp;parenthesized&nbsp;exprs),&nbsp;and&nbsp;apply&nbsp;these&nbsp;rules:</span><br>
<span class="lineno"></span><span class="comment" id="5966442">//</span><br>
<span class="lineno"></span><span class="comment" id="5966445">//&nbsp;&nbsp;&nbsp;&nbsp1)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;binary&nbsp;operator&nbsp;with&nbsp;a&nbsp;right&nbsp;side&nbsp;unary&nbsp;operand</span><br>
<span class="lineno"></span><span class="comment" id="5966513">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;would&nbsp;clash&nbsp;without&nbsp;a&nbsp;space,&nbsp;the&nbsp;cutoff&nbsp;must&nbsp;be&nbsp;(in&nbsp;order):</span><br>
<span class="lineno"></span><span class="comment" id="5966584">//</span><br>
<span class="lineno">615</span><span class="comment" id="5966587">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/*&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5966596">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5966605">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&amp;^&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5966614">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp++&nbsp;&nbsp;&nbsp;&nbsp5</span><br>
<span class="lineno"></span><span class="comment" id="5966623">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp--&nbsp;&nbsp;&nbsp;&nbsp5</span><br>
<span class="lineno">620</span><span class="comment" id="5966632">//</span><br>
<span class="lineno"></span><span class="comment" id="5966635">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Comparison&nbsp;operators&nbsp;always&nbsp;have&nbsp;spaces&nbsp;around&nbsp;them.)</span><br>
<span class="lineno"></span><span class="comment" id="5966701">//</span><br>
<span class="lineno"></span><span class="comment" id="5966704">//&nbsp;&nbsp;&nbsp;&nbsp2)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;mix&nbsp;of&nbsp;level&nbsp;5&nbsp;and&nbsp;level&nbsp;4&nbsp;operators,&nbsp;then&nbsp;the&nbsp;cutoff</span><br>
<span class="lineno"></span><span class="comment" id="5966778">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;is&nbsp;5&nbsp;(use&nbsp;spaces&nbsp;to&nbsp;distinguish&nbsp;precedence)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno">625</span><span class="comment" id="5966843">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5966891">//</span><br>
<span class="lineno"></span><span class="comment" id="5966894">//&nbsp;&nbsp;&nbsp;&nbsp3)&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;level&nbsp;4&nbsp;operators&nbsp;or&nbsp;no&nbsp;level&nbsp;5&nbsp;operators,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5966968">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;cutoff&nbsp;is&nbsp;6&nbsp;(always&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno"></span><span class="comment" id="5967021">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno">630</span><span class="comment" id="5967069">//</span><br>
<span class="lineno"></span><span class="keyword" id="5967072">func</span>&nbsp;<span class="op" id="5967077">(</span><span class="ident" id="5967078">p</span>&nbsp;<span class="op" id="5967080">*</span><span class="ident" id="5967081">printer</span><span class="op" id="5967088">)</span>&nbsp;<span class="ident" id="5967090">binaryExpr</span><span class="op" id="5967100">(</span><span class="ident" id="5967101">x</span>&nbsp;<span class="op" id="5967103">*</span><span class="ident" id="5967104">ast</span><span class="op" id="5967107">.</span><span class="ident" id="5967108">BinaryExpr</span><span class="op" id="5967118">,</span>&nbsp;<span class="ident" id="5967120">prec1</span><span class="op" id="5967125">,</span>&nbsp;<span class="ident" id="5967127">cutoff</span><span class="op" id="5967133">,</span>&nbsp;<span class="ident" id="5967135">depth</span>&nbsp;<span class="builtintype" id="5967141">int</span><span class="op" id="5967144">)</span>&nbsp;<span class="op" id="5967146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967149">prec</span>&nbsp;<span class="op" id="5967154">:=</span>&nbsp;<span class="ident" id="5967157">x</span><span class="op" id="5967158">.</span><span class="ident" id="5967159">Op</span><span class="op" id="5967161">.</span><span class="ident" id="5967162">Precedence</span><span class="op" id="5967172">(</span><span class="op" id="5967173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967176">if</span>&nbsp;<span class="ident" id="5967179">prec</span>&nbsp;<span class="op" id="5967184">&lt;</span>&nbsp;<span class="ident" id="5967186">prec1</span>&nbsp;<span class="op" id="5967192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967196">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967220">//&nbsp;Note:&nbsp;The&nbsp;parser&nbsp;inserts&nbsp;an&nbsp;ast.ParenExpr&nbsp;node;&nbsp;thus&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967288">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;occur&nbsp;if&nbsp;the&nbsp;AST&nbsp;is&nbsp;created&nbsp;in&nbsp;a&nbsp;different&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967356">p</span><span class="op" id="5967357">.</span><span class="builtinfunc" id="5967358">print</span><span class="op" id="5967363">(</span><span class="ident" id="5967364">token</span><span class="op" id="5967369">.</span><span class="ident" id="5967370">LPAREN</span><span class="op" id="5967376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967380">p</span><span class="op" id="5967381">.</span><span class="ident" id="5967382">expr0</span><span class="op" id="5967387">(</span><span class="ident" id="5967388">x</span><span class="op" id="5967389">,</span>&nbsp;<span class="ident" id="5967391">reduceDepth</span><span class="op" id="5967402">(</span><span class="ident" id="5967403">depth</span><span class="op" id="5967408">)</span><span class="op" id="5967409">)</span>&nbsp;<span class="comment" id="5967411">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967452">p</span><span class="op" id="5967453">.</span><span class="builtinfunc" id="5967454">print</span><span class="op" id="5967459">(</span><span class="ident" id="5967460">token</span><span class="op" id="5967465">.</span><span class="ident" id="5967466">RPAREN</span><span class="op" id="5967472">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967476">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967488">printBlank</span>&nbsp;<span class="op" id="5967499">:=</span>&nbsp;<span class="ident" id="5967502">prec</span>&nbsp;<span class="op" id="5967507">&lt;</span>&nbsp;<span class="ident" id="5967509">cutoff</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967518">ws</span>&nbsp;<span class="op" id="5967521">:=</span>&nbsp;<span class="ident" id="5967524">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967532">p</span><span class="op" id="5967533">.</span><span class="ident" id="5967534">expr1</span><span class="op" id="5967539">(</span><span class="ident" id="5967540">x</span><span class="op" id="5967541">.</span><span class="ident" id="5967542">X</span><span class="op" id="5967543">,</span>&nbsp;<span class="ident" id="5967545">prec</span><span class="op" id="5967549">,</span>&nbsp;<span class="ident" id="5967551">depth</span><span class="op" id="5967556">+</span><span class="ident" id="5967557">diffPrec</span><span class="op" id="5967565">(</span><span class="ident" id="5967566">x</span><span class="op" id="5967567">.</span><span class="ident" id="5967568">X</span><span class="op" id="5967569">,</span>&nbsp;<span class="ident" id="5967571">prec</span><span class="op" id="5967575">)</span><span class="op" id="5967576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967579">if</span>&nbsp;<span class="ident" id="5967582">printBlank</span>&nbsp;<span class="op" id="5967593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967597">p</span><span class="op" id="5967598">.</span><span class="builtinfunc" id="5967599">print</span><span class="op" id="5967604">(</span><span class="ident" id="5967605">blank</span><span class="op" id="5967610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967613">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967616">xline</span>&nbsp;<span class="op" id="5967622">:=</span>&nbsp;<span class="ident" id="5967625">p</span><span class="op" id="5967626">.</span><span class="ident" id="5967627">pos</span><span class="op" id="5967630">.</span><span class="ident" id="5967631">Line</span>&nbsp;<span class="comment" id="5967636">//&nbsp;before&nbsp;the&nbsp;operator&nbsp;(it&nbsp;may&nbsp;be&nbsp;on&nbsp;the&nbsp;next&nbsp;line!)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967690">yline</span>&nbsp;<span class="op" id="5967696">:=</span>&nbsp;<span class="ident" id="5967699">p</span><span class="op" id="5967700">.</span><span class="ident" id="5967701">lineFor</span><span class="op" id="5967708">(</span><span class="ident" id="5967709">x</span><span class="op" id="5967710">.</span><span class="ident" id="5967711">Y</span><span class="op" id="5967712">.</span><span class="ident" id="5967713">Pos</span><span class="op" id="5967716">(</span><span class="op" id="5967717">)</span><span class="op" id="5967718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967721">p</span><span class="op" id="5967722">.</span><span class="builtinfunc" id="5967723">print</span><span class="op" id="5967728">(</span><span class="ident" id="5967729">x</span><span class="op" id="5967730">.</span><span class="ident" id="5967731">OpPos</span><span class="op" id="5967736">,</span>&nbsp;<span class="ident" id="5967738">x</span><span class="op" id="5967739">.</span><span class="ident" id="5967740">Op</span><span class="op" id="5967742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967745">if</span>&nbsp;<span class="ident" id="5967748">xline</span>&nbsp;<span class="op" id="5967754">!=</span>&nbsp;<span class="ident" id="5967757">yline</span>&nbsp;<span class="op" id="5967763">&amp;&amp;</span>&nbsp;<span class="ident" id="5967766">xline</span>&nbsp;<span class="op" id="5967772">&gt;</span>&nbsp;<span class="num" id="5967774">0</span>&nbsp;<span class="op" id="5967776">&amp;&amp;</span>&nbsp;<span class="ident" id="5967779">yline</span>&nbsp;<span class="op" id="5967785">&gt;</span>&nbsp;<span class="num" id="5967787">0</span>&nbsp;<span class="op" id="5967789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967793">//&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break,&nbsp;but&nbsp;respect&nbsp;an&nbsp;extra&nbsp;empty&nbsp;line</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967855">//&nbsp;in&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967874">if</span>&nbsp;<span class="ident" id="5967877">p</span><span class="op" id="5967878">.</span><span class="ident" id="5967879">linebreak</span><span class="op" id="5967888">(</span><span class="ident" id="5967889">yline</span><span class="op" id="5967894">,</span>&nbsp;<span class="num" id="5967896">1</span><span class="op" id="5967897">,</span>&nbsp;<span class="ident" id="5967899">ws</span><span class="op" id="5967901">,</span>&nbsp;<span class="builtintype" id="5967903">true</span><span class="op" id="5967907">)</span>&nbsp;<span class="op" id="5967909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967914">ws</span>&nbsp;<span class="op" id="5967917">=</span>&nbsp;<span class="ident" id="5967919">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967929">printBlank</span>&nbsp;<span class="op" id="5967940">=</span>&nbsp;<span class="builtintype" id="5967942">false</span>&nbsp;<span class="comment" id="5967948">//&nbsp;no&nbsp;blank&nbsp;after&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967979">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967985">if</span>&nbsp;<span class="ident" id="5967988">printBlank</span>&nbsp;<span class="op" id="5967999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968003">p</span><span class="op" id="5968004">.</span><span class="builtinfunc" id="5968005">print</span><span class="op" id="5968010">(</span><span class="ident" id="5968011">blank</span><span class="op" id="5968016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968022">p</span><span class="op" id="5968023">.</span><span class="ident" id="5968024">expr1</span><span class="op" id="5968029">(</span><span class="ident" id="5968030">x</span><span class="op" id="5968031">.</span><span class="ident" id="5968032">Y</span><span class="op" id="5968033">,</span>&nbsp;<span class="ident" id="5968035">prec</span><span class="op" id="5968039">+</span><span class="num" id="5968040">1</span><span class="op" id="5968041">,</span>&nbsp;<span class="ident" id="5968043">depth</span><span class="op" id="5968048">+</span><span class="num" id="5968049">1</span><span class="op" id="5968050">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968053">if</span>&nbsp;<span class="ident" id="5968056">ws</span>&nbsp;<span class="op" id="5968059">==</span>&nbsp;<span class="ident" id="5968062">ignore</span>&nbsp;<span class="op" id="5968069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968073">p</span><span class="op" id="5968074">.</span><span class="builtinfunc" id="5968075">print</span><span class="op" id="5968080">(</span><span class="ident" id="5968081">unindent</span><span class="op" id="5968089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968092">}</span><br>
<span class="lineno"></span><span class="op" id="5968094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">670</span><span class="keyword" id="5968097">func</span>&nbsp;<span class="ident" id="5968102">isBinary</span><span class="op" id="5968110">(</span><span class="ident" id="5968111">expr</span>&nbsp;<span class="ident" id="5968116">ast</span><span class="op" id="5968119">.</span><span class="ident" id="5968120">Expr</span><span class="op" id="5968124">)</span>&nbsp;<span class="builtintype" id="5968126">bool</span>&nbsp;<span class="op" id="5968131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968134">_</span><span class="op" id="5968135">,</span>&nbsp;<span class="ident" id="5968137">ok</span>&nbsp;<span class="op" id="5968140">:=</span>&nbsp;<span class="ident" id="5968143">expr</span><span class="op" id="5968147">.</span><span class="op" id="5968148">(</span><span class="op" id="5968149">*</span><span class="ident" id="5968150">ast</span><span class="op" id="5968153">.</span><span class="ident" id="5968154">BinaryExpr</span><span class="op" id="5968164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968167">return</span>&nbsp;<span class="ident" id="5968174">ok</span><br>
<span class="lineno"></span><span class="op" id="5968177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5968180">func</span>&nbsp;<span class="op" id="5968185">(</span><span class="ident" id="5968186">p</span>&nbsp;<span class="op" id="5968188">*</span><span class="ident" id="5968189">printer</span><span class="op" id="5968196">)</span>&nbsp;<span class="ident" id="5968198">expr1</span><span class="op" id="5968203">(</span><span class="ident" id="5968204">expr</span>&nbsp;<span class="ident" id="5968209">ast</span><span class="op" id="5968212">.</span><span class="ident" id="5968213">Expr</span><span class="op" id="5968217">,</span>&nbsp;<span class="ident" id="5968219">prec1</span><span class="op" id="5968224">,</span>&nbsp;<span class="ident" id="5968226">depth</span>&nbsp;<span class="builtintype" id="5968232">int</span><span class="op" id="5968235">)</span>&nbsp;<span class="op" id="5968237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968240">p</span><span class="op" id="5968241">.</span><span class="builtinfunc" id="5968242">print</span><span class="op" id="5968247">(</span><span class="ident" id="5968248">expr</span><span class="op" id="5968252">.</span><span class="ident" id="5968253">Pos</span><span class="op" id="5968256">(</span><span class="op" id="5968257">)</span><span class="op" id="5968258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968262">switch</span>&nbsp;<span class="ident" id="5968269">x</span>&nbsp;<span class="op" id="5968271">:=</span>&nbsp;<span class="ident" id="5968274">expr</span><span class="op" id="5968278">.</span><span class="op" id="5968279">(</span><span class="keyword" id="5968280">type</span><span class="op" id="5968284">)</span>&nbsp;<span class="op" id="5968286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968289">case</span>&nbsp;<span class="op" id="5968294">*</span><span class="ident" id="5968295">ast</span><span class="op" id="5968298">.</span><span class="ident" id="5968299">BadExpr</span><span class="op" id="5968306">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968310">p</span><span class="op" id="5968311">.</span><span class="builtinfunc" id="5968312">print</span><span class="op" id="5968317">(</span><span class="string" id="5968318">&#34;BadExpr&#34;</span><span class="op" id="5968327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968331">case</span>&nbsp;<span class="op" id="5968336">*</span><span class="ident" id="5968337">ast</span><span class="op" id="5968340">.</span><span class="ident" id="5968341">Ident</span><span class="op" id="5968346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968350">p</span><span class="op" id="5968351">.</span><span class="builtinfunc" id="5968352">print</span><span class="op" id="5968357">(</span><span class="ident" id="5968358">x</span><span class="op" id="5968359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968363">case</span>&nbsp;<span class="op" id="5968368">*</span><span class="ident" id="5968369">ast</span><span class="op" id="5968372">.</span><span class="ident" id="5968373">BinaryExpr</span><span class="op" id="5968383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968387">if</span>&nbsp;<span class="ident" id="5968390">depth</span>&nbsp;<span class="op" id="5968396">&lt;</span>&nbsp;<span class="num" id="5968398">1</span>&nbsp;<span class="op" id="5968400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968405">p</span><span class="op" id="5968406">.</span><span class="ident" id="5968407">internalError</span><span class="op" id="5968420">(</span><span class="string" id="5968421">&#34;depth&nbsp;&lt;&nbsp;1:&#34;</span><span class="op" id="5968433">,</span>&nbsp;<span class="ident" id="5968435">depth</span><span class="op" id="5968440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968445">depth</span>&nbsp;<span class="op" id="5968451">=</span>&nbsp;<span class="num" id="5968453">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968457">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968461">p</span><span class="op" id="5968462">.</span><span class="ident" id="5968463">binaryExpr</span><span class="op" id="5968473">(</span><span class="ident" id="5968474">x</span><span class="op" id="5968475">,</span>&nbsp;<span class="ident" id="5968477">prec1</span><span class="op" id="5968482">,</span>&nbsp;<span class="ident" id="5968484">cutoff</span><span class="op" id="5968490">(</span><span class="ident" id="5968491">x</span><span class="op" id="5968492">,</span>&nbsp;<span class="ident" id="5968494">depth</span><span class="op" id="5968499">)</span><span class="op" id="5968500">,</span>&nbsp;<span class="ident" id="5968502">depth</span><span class="op" id="5968507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968511">case</span>&nbsp;<span class="op" id="5968516">*</span><span class="ident" id="5968517">ast</span><span class="op" id="5968520">.</span><span class="ident" id="5968521">KeyValueExpr</span><span class="op" id="5968533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968537">p</span><span class="op" id="5968538">.</span><span class="ident" id="5968539">expr</span><span class="op" id="5968543">(</span><span class="ident" id="5968544">x</span><span class="op" id="5968545">.</span><span class="ident" id="5968546">Key</span><span class="op" id="5968549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968553">p</span><span class="op" id="5968554">.</span><span class="builtinfunc" id="5968555">print</span><span class="op" id="5968560">(</span><span class="ident" id="5968561">x</span><span class="op" id="5968562">.</span><span class="ident" id="5968563">Colon</span><span class="op" id="5968568">,</span>&nbsp;<span class="ident" id="5968570">token</span><span class="op" id="5968575">.</span><span class="ident" id="5968576">COLON</span><span class="op" id="5968581">,</span>&nbsp;<span class="ident" id="5968583">blank</span><span class="op" id="5968588">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968592">p</span><span class="op" id="5968593">.</span><span class="ident" id="5968594">expr</span><span class="op" id="5968598">(</span><span class="ident" id="5968599">x</span><span class="op" id="5968600">.</span><span class="ident" id="5968601">Value</span><span class="op" id="5968606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968610">case</span>&nbsp;<span class="op" id="5968615">*</span><span class="ident" id="5968616">ast</span><span class="op" id="5968619">.</span><span class="ident" id="5968620">StarExpr</span><span class="op" id="5968628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968632">const</span>&nbsp;<span class="ident" id="5968638">prec</span>&nbsp;<span class="op" id="5968643">=</span>&nbsp;<span class="ident" id="5968645">token</span><span class="op" id="5968650">.</span><span class="ident" id="5968651">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968663">if</span>&nbsp;<span class="ident" id="5968666">prec</span>&nbsp;<span class="op" id="5968671">&lt;</span>&nbsp;<span class="ident" id="5968673">prec1</span>&nbsp;<span class="op" id="5968679">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968684">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968709">p</span><span class="op" id="5968710">.</span><span class="builtinfunc" id="5968711">print</span><span class="op" id="5968716">(</span><span class="ident" id="5968717">token</span><span class="op" id="5968722">.</span><span class="ident" id="5968723">LPAREN</span><span class="op" id="5968729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968734">p</span><span class="op" id="5968735">.</span><span class="builtinfunc" id="5968736">print</span><span class="op" id="5968741">(</span><span class="ident" id="5968742">token</span><span class="op" id="5968747">.</span><span class="ident" id="5968748">MUL</span><span class="op" id="5968751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968756">p</span><span class="op" id="5968757">.</span><span class="ident" id="5968758">expr</span><span class="op" id="5968762">(</span><span class="ident" id="5968763">x</span><span class="op" id="5968764">.</span><span class="ident" id="5968765">X</span><span class="op" id="5968766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968771">p</span><span class="op" id="5968772">.</span><span class="builtinfunc" id="5968773">print</span><span class="op" id="5968778">(</span><span class="ident" id="5968779">token</span><span class="op" id="5968784">.</span><span class="ident" id="5968785">RPAREN</span><span class="op" id="5968791">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968795">}</span>&nbsp;<span class="keyword" id="5968797">else</span>&nbsp;<span class="op" id="5968802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968807">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968835">p</span><span class="op" id="5968836">.</span><span class="builtinfunc" id="5968837">print</span><span class="op" id="5968842">(</span><span class="ident" id="5968843">token</span><span class="op" id="5968848">.</span><span class="ident" id="5968849">MUL</span><span class="op" id="5968852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968857">p</span><span class="op" id="5968858">.</span><span class="ident" id="5968859">expr</span><span class="op" id="5968863">(</span><span class="ident" id="5968864">x</span><span class="op" id="5968865">.</span><span class="ident" id="5968866">X</span><span class="op" id="5968867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968871">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968875">case</span>&nbsp;<span class="op" id="5968880">*</span><span class="ident" id="5968881">ast</span><span class="op" id="5968884">.</span><span class="ident" id="5968885">UnaryExpr</span><span class="op" id="5968894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968898">const</span>&nbsp;<span class="ident" id="5968904">prec</span>&nbsp;<span class="op" id="5968909">=</span>&nbsp;<span class="ident" id="5968911">token</span><span class="op" id="5968916">.</span><span class="ident" id="5968917">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968929">if</span>&nbsp;<span class="ident" id="5968932">prec</span>&nbsp;<span class="op" id="5968937">&lt;</span>&nbsp;<span class="ident" id="5968939">prec1</span>&nbsp;<span class="op" id="5968945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968950">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968975">p</span><span class="op" id="5968976">.</span><span class="builtinfunc" id="5968977">print</span><span class="op" id="5968982">(</span><span class="ident" id="5968983">token</span><span class="op" id="5968988">.</span><span class="ident" id="5968989">LPAREN</span><span class="op" id="5968995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969000">p</span><span class="op" id="5969001">.</span><span class="ident" id="5969002">expr</span><span class="op" id="5969006">(</span><span class="ident" id="5969007">x</span><span class="op" id="5969008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969013">p</span><span class="op" id="5969014">.</span><span class="builtinfunc" id="5969015">print</span><span class="op" id="5969020">(</span><span class="ident" id="5969021">token</span><span class="op" id="5969026">.</span><span class="ident" id="5969027">RPAREN</span><span class="op" id="5969033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969037">}</span>&nbsp;<span class="keyword" id="5969039">else</span>&nbsp;<span class="op" id="5969044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969049">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969077">p</span><span class="op" id="5969078">.</span><span class="builtinfunc" id="5969079">print</span><span class="op" id="5969084">(</span><span class="ident" id="5969085">x</span><span class="op" id="5969086">.</span><span class="ident" id="5969087">Op</span><span class="op" id="5969089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969094">if</span>&nbsp;<span class="ident" id="5969097">x</span><span class="op" id="5969098">.</span><span class="ident" id="5969099">Op</span>&nbsp;<span class="op" id="5969102">==</span>&nbsp;<span class="ident" id="5969105">token</span><span class="op" id="5969110">.</span><span class="ident" id="5969111">RANGE</span>&nbsp;<span class="op" id="5969117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969123">//&nbsp;TODO(gri)&nbsp;Remove&nbsp;this&nbsp;code&nbsp;if&nbsp;it&nbsp;cannot&nbsp;be&nbsp;reached.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969182">p</span><span class="op" id="5969183">.</span><span class="builtinfunc" id="5969184">print</span><span class="op" id="5969189">(</span><span class="ident" id="5969190">blank</span><span class="op" id="5969195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969200">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969205">p</span><span class="op" id="5969206">.</span><span class="ident" id="5969207">expr1</span><span class="op" id="5969212">(</span><span class="ident" id="5969213">x</span><span class="op" id="5969214">.</span><span class="ident" id="5969215">X</span><span class="op" id="5969216">,</span>&nbsp;<span class="ident" id="5969218">prec</span><span class="op" id="5969222">,</span>&nbsp;<span class="ident" id="5969224">depth</span><span class="op" id="5969229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969237">case</span>&nbsp;<span class="op" id="5969242">*</span><span class="ident" id="5969243">ast</span><span class="op" id="5969246">.</span><span class="ident" id="5969247">BasicLit</span><span class="op" id="5969255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969259">p</span><span class="op" id="5969260">.</span><span class="builtinfunc" id="5969261">print</span><span class="op" id="5969266">(</span><span class="ident" id="5969267">x</span><span class="op" id="5969268">)</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969272">case</span>&nbsp;<span class="op" id="5969277">*</span><span class="ident" id="5969278">ast</span><span class="op" id="5969281">.</span><span class="ident" id="5969282">FuncLit</span><span class="op" id="5969289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969293">p</span><span class="op" id="5969294">.</span><span class="ident" id="5969295">expr</span><span class="op" id="5969299">(</span><span class="ident" id="5969300">x</span><span class="op" id="5969301">.</span><span class="ident" id="5969302">Type</span><span class="op" id="5969306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969310">p</span><span class="op" id="5969311">.</span><span class="ident" id="5969312">adjBlock</span><span class="op" id="5969320">(</span><span class="ident" id="5969321">p</span><span class="op" id="5969322">.</span><span class="ident" id="5969323">distanceFrom</span><span class="op" id="5969335">(</span><span class="ident" id="5969336">x</span><span class="op" id="5969337">.</span><span class="ident" id="5969338">Type</span><span class="op" id="5969342">.</span><span class="ident" id="5969343">Pos</span><span class="op" id="5969346">(</span><span class="op" id="5969347">)</span><span class="op" id="5969348">)</span><span class="op" id="5969349">,</span>&nbsp;<span class="ident" id="5969351">blank</span><span class="op" id="5969356">,</span>&nbsp;<span class="ident" id="5969358">x</span><span class="op" id="5969359">.</span><span class="ident" id="5969360">Body</span><span class="op" id="5969364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969368">case</span>&nbsp;<span class="op" id="5969373">*</span><span class="ident" id="5969374">ast</span><span class="op" id="5969377">.</span><span class="ident" id="5969378">ParenExpr</span><span class="op" id="5969387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969391">if</span>&nbsp;<span class="ident" id="5969394">_</span><span class="op" id="5969395">,</span>&nbsp;<span class="ident" id="5969397">hasParens</span>&nbsp;<span class="op" id="5969407">:=</span>&nbsp;<span class="ident" id="5969410">x</span><span class="op" id="5969411">.</span><span class="ident" id="5969412">X</span><span class="op" id="5969413">.</span><span class="op" id="5969414">(</span><span class="op" id="5969415">*</span><span class="ident" id="5969416">ast</span><span class="op" id="5969419">.</span><span class="ident" id="5969420">ParenExpr</span><span class="op" id="5969429">)</span><span class="op" id="5969430">;</span>&nbsp;<span class="ident" id="5969432">hasParens</span>&nbsp;<span class="op" id="5969442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969447">//&nbsp;don&#39;t&nbsp;print&nbsp;parentheses&nbsp;around&nbsp;an&nbsp;already&nbsp;parenthesized&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969520">//&nbsp;TODO(gri)&nbsp;consider&nbsp;making&nbsp;this&nbsp;more&nbsp;general&nbsp;and&nbsp;incorporate&nbsp;precedence&nbsp;levels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969604">p</span><span class="op" id="5969605">.</span><span class="ident" id="5969606">expr0</span><span class="op" id="5969611">(</span><span class="ident" id="5969612">x</span><span class="op" id="5969613">.</span><span class="ident" id="5969614">X</span><span class="op" id="5969615">,</span>&nbsp;<span class="ident" id="5969617">depth</span><span class="op" id="5969622">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969626">}</span>&nbsp;<span class="keyword" id="5969628">else</span>&nbsp;<span class="op" id="5969633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969638">p</span><span class="op" id="5969639">.</span><span class="builtinfunc" id="5969640">print</span><span class="op" id="5969645">(</span><span class="ident" id="5969646">token</span><span class="op" id="5969651">.</span><span class="ident" id="5969652">LPAREN</span><span class="op" id="5969658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969663">p</span><span class="op" id="5969664">.</span><span class="ident" id="5969665">expr0</span><span class="op" id="5969670">(</span><span class="ident" id="5969671">x</span><span class="op" id="5969672">.</span><span class="ident" id="5969673">X</span><span class="op" id="5969674">,</span>&nbsp;<span class="ident" id="5969676">reduceDepth</span><span class="op" id="5969687">(</span><span class="ident" id="5969688">depth</span><span class="op" id="5969693">)</span><span class="op" id="5969694">)</span>&nbsp;<span class="comment" id="5969696">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969738">p</span><span class="op" id="5969739">.</span><span class="builtinfunc" id="5969740">print</span><span class="op" id="5969745">(</span><span class="ident" id="5969746">x</span><span class="op" id="5969747">.</span><span class="ident" id="5969748">Rparen</span><span class="op" id="5969754">,</span>&nbsp;<span class="ident" id="5969756">token</span><span class="op" id="5969761">.</span><span class="ident" id="5969762">RPAREN</span><span class="op" id="5969768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969772">}</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969776">case</span>&nbsp;<span class="op" id="5969781">*</span><span class="ident" id="5969782">ast</span><span class="op" id="5969785">.</span><span class="ident" id="5969786">SelectorExpr</span><span class="op" id="5969798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969802">p</span><span class="op" id="5969803">.</span><span class="ident" id="5969804">expr1</span><span class="op" id="5969809">(</span><span class="ident" id="5969810">x</span><span class="op" id="5969811">.</span><span class="ident" id="5969812">X</span><span class="op" id="5969813">,</span>&nbsp;<span class="ident" id="5969815">token</span><span class="op" id="5969820">.</span><span class="ident" id="5969821">HighestPrec</span><span class="op" id="5969832">,</span>&nbsp;<span class="ident" id="5969834">depth</span><span class="op" id="5969839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969843">p</span><span class="op" id="5969844">.</span><span class="builtinfunc" id="5969845">print</span><span class="op" id="5969850">(</span><span class="ident" id="5969851">token</span><span class="op" id="5969856">.</span><span class="ident" id="5969857">PERIOD</span><span class="op" id="5969863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969867">if</span>&nbsp;<span class="ident" id="5969870">line</span>&nbsp;<span class="op" id="5969875">:=</span>&nbsp;<span class="ident" id="5969878">p</span><span class="op" id="5969879">.</span><span class="ident" id="5969880">lineFor</span><span class="op" id="5969887">(</span><span class="ident" id="5969888">x</span><span class="op" id="5969889">.</span><span class="ident" id="5969890">Sel</span><span class="op" id="5969893">.</span><span class="ident" id="5969894">Pos</span><span class="op" id="5969897">(</span><span class="op" id="5969898">)</span><span class="op" id="5969899">)</span><span class="op" id="5969900">;</span>&nbsp;<span class="ident" id="5969902">p</span><span class="op" id="5969903">.</span><span class="ident" id="5969904">pos</span><span class="op" id="5969907">.</span><span class="ident" id="5969908">IsValid</span><span class="op" id="5969915">(</span><span class="op" id="5969916">)</span>&nbsp;<span class="op" id="5969918">&amp;&amp;</span>&nbsp;<span class="ident" id="5969921">p</span><span class="op" id="5969922">.</span><span class="ident" id="5969923">pos</span><span class="op" id="5969926">.</span><span class="ident" id="5969927">Line</span>&nbsp;<span class="op" id="5969932">&lt;</span>&nbsp;<span class="ident" id="5969934">line</span>&nbsp;<span class="op" id="5969939">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969944">p</span><span class="op" id="5969945">.</span><span class="builtinfunc" id="5969946">print</span><span class="op" id="5969951">(</span><span class="ident" id="5969952">indent</span><span class="op" id="5969958">,</span>&nbsp;<span class="ident" id="5969960">newline</span><span class="op" id="5969967">,</span>&nbsp;<span class="ident" id="5969969">x</span><span class="op" id="5969970">.</span><span class="ident" id="5969971">Sel</span><span class="op" id="5969974">.</span><span class="ident" id="5969975">Pos</span><span class="op" id="5969978">(</span><span class="op" id="5969979">)</span><span class="op" id="5969980">,</span>&nbsp;<span class="ident" id="5969982">x</span><span class="op" id="5969983">.</span><span class="ident" id="5969984">Sel</span><span class="op" id="5969987">,</span>&nbsp;<span class="ident" id="5969989">unindent</span><span class="op" id="5969997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970001">}</span>&nbsp;<span class="keyword" id="5970003">else</span>&nbsp;<span class="op" id="5970008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970013">p</span><span class="op" id="5970014">.</span><span class="builtinfunc" id="5970015">print</span><span class="op" id="5970020">(</span><span class="ident" id="5970021">x</span><span class="op" id="5970022">.</span><span class="ident" id="5970023">Sel</span><span class="op" id="5970026">.</span><span class="ident" id="5970027">Pos</span><span class="op" id="5970030">(</span><span class="op" id="5970031">)</span><span class="op" id="5970032">,</span>&nbsp;<span class="ident" id="5970034">x</span><span class="op" id="5970035">.</span><span class="ident" id="5970036">Sel</span><span class="op" id="5970039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970047">case</span>&nbsp;<span class="op" id="5970052">*</span><span class="ident" id="5970053">ast</span><span class="op" id="5970056">.</span><span class="ident" id="5970057">TypeAssertExpr</span><span class="op" id="5970071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970075">p</span><span class="op" id="5970076">.</span><span class="ident" id="5970077">expr1</span><span class="op" id="5970082">(</span><span class="ident" id="5970083">x</span><span class="op" id="5970084">.</span><span class="ident" id="5970085">X</span><span class="op" id="5970086">,</span>&nbsp;<span class="ident" id="5970088">token</span><span class="op" id="5970093">.</span><span class="ident" id="5970094">HighestPrec</span><span class="op" id="5970105">,</span>&nbsp;<span class="ident" id="5970107">depth</span><span class="op" id="5970112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970116">p</span><span class="op" id="5970117">.</span><span class="builtinfunc" id="5970118">print</span><span class="op" id="5970123">(</span><span class="ident" id="5970124">token</span><span class="op" id="5970129">.</span><span class="ident" id="5970130">PERIOD</span><span class="op" id="5970136">,</span>&nbsp;<span class="ident" id="5970138">x</span><span class="op" id="5970139">.</span><span class="ident" id="5970140">Lparen</span><span class="op" id="5970146">,</span>&nbsp;<span class="ident" id="5970148">token</span><span class="op" id="5970153">.</span><span class="ident" id="5970154">LPAREN</span><span class="op" id="5970160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970164">if</span>&nbsp;<span class="ident" id="5970167">x</span><span class="op" id="5970168">.</span><span class="ident" id="5970169">Type</span>&nbsp;<span class="op" id="5970174">!=</span>&nbsp;<span class="ident" id="5970177">nil</span>&nbsp;<span class="op" id="5970181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970186">p</span><span class="op" id="5970187">.</span><span class="ident" id="5970188">expr</span><span class="op" id="5970192">(</span><span class="ident" id="5970193">x</span><span class="op" id="5970194">.</span><span class="ident" id="5970195">Type</span><span class="op" id="5970199">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970203">}</span>&nbsp;<span class="keyword" id="5970205">else</span>&nbsp;<span class="op" id="5970210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970215">p</span><span class="op" id="5970216">.</span><span class="builtinfunc" id="5970217">print</span><span class="op" id="5970222">(</span><span class="ident" id="5970223">token</span><span class="op" id="5970228">.</span><span class="ident" id="5970229">TYPE</span><span class="op" id="5970233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970241">p</span><span class="op" id="5970242">.</span><span class="builtinfunc" id="5970243">print</span><span class="op" id="5970248">(</span><span class="ident" id="5970249">x</span><span class="op" id="5970250">.</span><span class="ident" id="5970251">Rparen</span><span class="op" id="5970257">,</span>&nbsp;<span class="ident" id="5970259">token</span><span class="op" id="5970264">.</span><span class="ident" id="5970265">RPAREN</span><span class="op" id="5970271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970275">case</span>&nbsp;<span class="op" id="5970280">*</span><span class="ident" id="5970281">ast</span><span class="op" id="5970284">.</span><span class="ident" id="5970285">IndexExpr</span><span class="op" id="5970294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970298">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970374">p</span><span class="op" id="5970375">.</span><span class="ident" id="5970376">expr1</span><span class="op" id="5970381">(</span><span class="ident" id="5970382">x</span><span class="op" id="5970383">.</span><span class="ident" id="5970384">X</span><span class="op" id="5970385">,</span>&nbsp;<span class="ident" id="5970387">token</span><span class="op" id="5970392">.</span><span class="ident" id="5970393">HighestPrec</span><span class="op" id="5970404">,</span>&nbsp;<span class="num" id="5970406">1</span><span class="op" id="5970407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970411">p</span><span class="op" id="5970412">.</span><span class="builtinfunc" id="5970413">print</span><span class="op" id="5970418">(</span><span class="ident" id="5970419">x</span><span class="op" id="5970420">.</span><span class="ident" id="5970421">Lbrack</span><span class="op" id="5970427">,</span>&nbsp;<span class="ident" id="5970429">token</span><span class="op" id="5970434">.</span><span class="ident" id="5970435">LBRACK</span><span class="op" id="5970441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970445">p</span><span class="op" id="5970446">.</span><span class="ident" id="5970447">expr0</span><span class="op" id="5970452">(</span><span class="ident" id="5970453">x</span><span class="op" id="5970454">.</span><span class="ident" id="5970455">Index</span><span class="op" id="5970460">,</span>&nbsp;<span class="ident" id="5970462">depth</span><span class="op" id="5970467">+</span><span class="num" id="5970468">1</span><span class="op" id="5970469">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970473">p</span><span class="op" id="5970474">.</span><span class="builtinfunc" id="5970475">print</span><span class="op" id="5970480">(</span><span class="ident" id="5970481">x</span><span class="op" id="5970482">.</span><span class="ident" id="5970483">Rbrack</span><span class="op" id="5970489">,</span>&nbsp;<span class="ident" id="5970491">token</span><span class="op" id="5970496">.</span><span class="ident" id="5970497">RBRACK</span><span class="op" id="5970503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970507">case</span>&nbsp;<span class="op" id="5970512">*</span><span class="ident" id="5970513">ast</span><span class="op" id="5970516">.</span><span class="ident" id="5970517">SliceExpr</span><span class="op" id="5970526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970530">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970606">p</span><span class="op" id="5970607">.</span><span class="ident" id="5970608">expr1</span><span class="op" id="5970613">(</span><span class="ident" id="5970614">x</span><span class="op" id="5970615">.</span><span class="ident" id="5970616">X</span><span class="op" id="5970617">,</span>&nbsp;<span class="ident" id="5970619">token</span><span class="op" id="5970624">.</span><span class="ident" id="5970625">HighestPrec</span><span class="op" id="5970636">,</span>&nbsp;<span class="num" id="5970638">1</span><span class="op" id="5970639">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970643">p</span><span class="op" id="5970644">.</span><span class="builtinfunc" id="5970645">print</span><span class="op" id="5970650">(</span><span class="ident" id="5970651">x</span><span class="op" id="5970652">.</span><span class="ident" id="5970653">Lbrack</span><span class="op" id="5970659">,</span>&nbsp;<span class="ident" id="5970661">token</span><span class="op" id="5970666">.</span><span class="ident" id="5970667">LBRACK</span><span class="op" id="5970673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970677">indices</span>&nbsp;<span class="op" id="5970685">:=</span>&nbsp;<span class="op" id="5970688">[</span><span class="op" id="5970689">]</span><span class="ident" id="5970690">ast</span><span class="op" id="5970693">.</span><span class="ident" id="5970694">Expr</span><span class="op" id="5970698">{</span><span class="ident" id="5970699">x</span><span class="op" id="5970700">.</span><span class="ident" id="5970701">Low</span><span class="op" id="5970704">,</span>&nbsp;<span class="ident" id="5970706">x</span><span class="op" id="5970707">.</span><span class="ident" id="5970708">High</span><span class="op" id="5970712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970716">if</span>&nbsp;<span class="ident" id="5970719">x</span><span class="op" id="5970720">.</span><span class="ident" id="5970721">Max</span>&nbsp;<span class="op" id="5970725">!=</span>&nbsp;<span class="ident" id="5970728">nil</span>&nbsp;<span class="op" id="5970732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970737">indices</span>&nbsp;<span class="op" id="5970745">=</span>&nbsp;<span class="builtinfunc" id="5970747">append</span><span class="op" id="5970753">(</span><span class="ident" id="5970754">indices</span><span class="op" id="5970761">,</span>&nbsp;<span class="ident" id="5970763">x</span><span class="op" id="5970764">.</span><span class="ident" id="5970765">Max</span><span class="op" id="5970768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970772">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970776">for</span>&nbsp;<span class="ident" id="5970780">i</span><span class="op" id="5970781">,</span>&nbsp;<span class="ident" id="5970783">y</span>&nbsp;<span class="op" id="5970785">:=</span>&nbsp;<span class="keyword" id="5970788">range</span>&nbsp;<span class="ident" id="5970794">indices</span>&nbsp;<span class="op" id="5970802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970807">if</span>&nbsp;<span class="ident" id="5970810">i</span>&nbsp;<span class="op" id="5970812">&gt;</span>&nbsp;<span class="num" id="5970814">0</span>&nbsp;<span class="op" id="5970816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970822">//&nbsp;blanks&nbsp;around&nbsp;&#34;:&#34;&nbsp;if&nbsp;both&nbsp;sides&nbsp;exist&nbsp;and&nbsp;either&nbsp;side&nbsp;is&nbsp;a&nbsp;binary&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970906">//&nbsp;TODO(gri)&nbsp;once&nbsp;we&nbsp;have&nbsp;committed&nbsp;a&nbsp;variant&nbsp;of&nbsp;a[i:j:k]&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;fine-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970989">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tune&nbsp;the&nbsp;formatting&nbsp;here</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971031">x</span>&nbsp;<span class="op" id="5971033">:=</span>&nbsp;<span class="ident" id="5971036">indices</span><span class="op" id="5971043">[</span><span class="ident" id="5971044">i</span><span class="op" id="5971045">-</span><span class="num" id="5971046">1</span><span class="op" id="5971047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971053">if</span>&nbsp;<span class="ident" id="5971056">depth</span>&nbsp;<span class="op" id="5971062">&lt;=</span>&nbsp;<span class="num" id="5971065">1</span>&nbsp;<span class="op" id="5971067">&amp;&amp;</span>&nbsp;<span class="ident" id="5971070">x</span>&nbsp;<span class="op" id="5971072">!=</span>&nbsp;<span class="ident" id="5971075">nil</span>&nbsp;<span class="op" id="5971079">&amp;&amp;</span>&nbsp;<span class="ident" id="5971082">y</span>&nbsp;<span class="op" id="5971084">!=</span>&nbsp;<span class="ident" id="5971087">nil</span>&nbsp;<span class="op" id="5971091">&amp;&amp;</span>&nbsp;<span class="op" id="5971094">(</span><span class="ident" id="5971095">isBinary</span><span class="op" id="5971103">(</span><span class="ident" id="5971104">x</span><span class="op" id="5971105">)</span>&nbsp;<span class="op" id="5971107">||</span>&nbsp;<span class="ident" id="5971110">isBinary</span><span class="op" id="5971118">(</span><span class="ident" id="5971119">y</span><span class="op" id="5971120">)</span><span class="op" id="5971121">)</span>&nbsp;<span class="op" id="5971123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971130">p</span><span class="op" id="5971131">.</span><span class="builtinfunc" id="5971132">print</span><span class="op" id="5971137">(</span><span class="ident" id="5971138">blank</span><span class="op" id="5971143">,</span>&nbsp;<span class="ident" id="5971145">token</span><span class="op" id="5971150">.</span><span class="ident" id="5971151">COLON</span><span class="op" id="5971156">,</span>&nbsp;<span class="ident" id="5971158">blank</span><span class="op" id="5971163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971169">}</span>&nbsp;<span class="keyword" id="5971171">else</span>&nbsp;<span class="op" id="5971176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971183">p</span><span class="op" id="5971184">.</span><span class="builtinfunc" id="5971185">print</span><span class="op" id="5971190">(</span><span class="ident" id="5971191">token</span><span class="op" id="5971196">.</span><span class="ident" id="5971197">COLON</span><span class="op" id="5971202">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971218">if</span>&nbsp;<span class="ident" id="5971221">y</span>&nbsp;<span class="op" id="5971223">!=</span>&nbsp;<span class="ident" id="5971226">nil</span>&nbsp;<span class="op" id="5971230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971236">p</span><span class="op" id="5971237">.</span><span class="ident" id="5971238">expr0</span><span class="op" id="5971243">(</span><span class="ident" id="5971244">y</span><span class="op" id="5971245">,</span>&nbsp;<span class="ident" id="5971247">depth</span><span class="op" id="5971252">+</span><span class="num" id="5971253">1</span><span class="op" id="5971254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971259">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971267">p</span><span class="op" id="5971268">.</span><span class="builtinfunc" id="5971269">print</span><span class="op" id="5971274">(</span><span class="ident" id="5971275">x</span><span class="op" id="5971276">.</span><span class="ident" id="5971277">Rbrack</span><span class="op" id="5971283">,</span>&nbsp;<span class="ident" id="5971285">token</span><span class="op" id="5971290">.</span><span class="ident" id="5971291">RBRACK</span><span class="op" id="5971297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971301">case</span>&nbsp;<span class="op" id="5971306">*</span><span class="ident" id="5971307">ast</span><span class="op" id="5971310">.</span><span class="ident" id="5971311">CallExpr</span><span class="op" id="5971319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971323">if</span>&nbsp;<span class="builtinfunc" id="5971326">len</span><span class="op" id="5971329">(</span><span class="ident" id="5971330">x</span><span class="op" id="5971331">.</span><span class="ident" id="5971332">Args</span><span class="op" id="5971336">)</span>&nbsp;<span class="op" id="5971338">&gt;</span>&nbsp;<span class="num" id="5971340">1</span>&nbsp;<span class="op" id="5971342">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971347">depth</span><span class="op" id="5971352">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971361">if</span>&nbsp;<span class="ident" id="5971364">_</span><span class="op" id="5971365">,</span>&nbsp;<span class="ident" id="5971367">ok</span>&nbsp;<span class="op" id="5971370">:=</span>&nbsp;<span class="ident" id="5971373">x</span><span class="op" id="5971374">.</span><span class="ident" id="5971375">Fun</span><span class="op" id="5971378">.</span><span class="op" id="5971379">(</span><span class="op" id="5971380">*</span><span class="ident" id="5971381">ast</span><span class="op" id="5971384">.</span><span class="ident" id="5971385">FuncType</span><span class="op" id="5971393">)</span><span class="op" id="5971394">;</span>&nbsp;<span class="ident" id="5971396">ok</span>&nbsp;<span class="op" id="5971399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971404">//&nbsp;conversions&nbsp;to&nbsp;literal&nbsp;function&nbsp;types&nbsp;require&nbsp;parentheses&nbsp;around&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971484">p</span><span class="op" id="5971485">.</span><span class="builtinfunc" id="5971486">print</span><span class="op" id="5971491">(</span><span class="ident" id="5971492">token</span><span class="op" id="5971497">.</span><span class="ident" id="5971498">LPAREN</span><span class="op" id="5971504">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971509">p</span><span class="op" id="5971510">.</span><span class="ident" id="5971511">expr1</span><span class="op" id="5971516">(</span><span class="ident" id="5971517">x</span><span class="op" id="5971518">.</span><span class="ident" id="5971519">Fun</span><span class="op" id="5971522">,</span>&nbsp;<span class="ident" id="5971524">token</span><span class="op" id="5971529">.</span><span class="ident" id="5971530">HighestPrec</span><span class="op" id="5971541">,</span>&nbsp;<span class="ident" id="5971543">depth</span><span class="op" id="5971548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971553">p</span><span class="op" id="5971554">.</span><span class="builtinfunc" id="5971555">print</span><span class="op" id="5971560">(</span><span class="ident" id="5971561">token</span><span class="op" id="5971566">.</span><span class="ident" id="5971567">RPAREN</span><span class="op" id="5971573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971577">}</span>&nbsp;<span class="keyword" id="5971579">else</span>&nbsp;<span class="op" id="5971584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971589">p</span><span class="op" id="5971590">.</span><span class="ident" id="5971591">expr1</span><span class="op" id="5971596">(</span><span class="ident" id="5971597">x</span><span class="op" id="5971598">.</span><span class="ident" id="5971599">Fun</span><span class="op" id="5971602">,</span>&nbsp;<span class="ident" id="5971604">token</span><span class="op" id="5971609">.</span><span class="ident" id="5971610">HighestPrec</span><span class="op" id="5971621">,</span>&nbsp;<span class="ident" id="5971623">depth</span><span class="op" id="5971628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971632">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971636">p</span><span class="op" id="5971637">.</span><span class="builtinfunc" id="5971638">print</span><span class="op" id="5971643">(</span><span class="ident" id="5971644">x</span><span class="op" id="5971645">.</span><span class="ident" id="5971646">Lparen</span><span class="op" id="5971652">,</span>&nbsp;<span class="ident" id="5971654">token</span><span class="op" id="5971659">.</span><span class="ident" id="5971660">LPAREN</span><span class="op" id="5971666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971670">if</span>&nbsp;<span class="ident" id="5971673">x</span><span class="op" id="5971674">.</span><span class="ident" id="5971675">Ellipsis</span><span class="op" id="5971683">.</span><span class="ident" id="5971684">IsValid</span><span class="op" id="5971691">(</span><span class="op" id="5971692">)</span>&nbsp;<span class="op" id="5971694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971699">p</span><span class="op" id="5971700">.</span><span class="ident" id="5971701">exprList</span><span class="op" id="5971709">(</span><span class="ident" id="5971710">x</span><span class="op" id="5971711">.</span><span class="ident" id="5971712">Lparen</span><span class="op" id="5971718">,</span>&nbsp;<span class="ident" id="5971720">x</span><span class="op" id="5971721">.</span><span class="ident" id="5971722">Args</span><span class="op" id="5971726">,</span>&nbsp;<span class="ident" id="5971728">depth</span><span class="op" id="5971733">,</span>&nbsp;<span class="num" id="5971735">0</span><span class="op" id="5971736">,</span>&nbsp;<span class="ident" id="5971738">x</span><span class="op" id="5971739">.</span><span class="ident" id="5971740">Ellipsis</span><span class="op" id="5971748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971753">p</span><span class="op" id="5971754">.</span><span class="builtinfunc" id="5971755">print</span><span class="op" id="5971760">(</span><span class="ident" id="5971761">x</span><span class="op" id="5971762">.</span><span class="ident" id="5971763">Ellipsis</span><span class="op" id="5971771">,</span>&nbsp;<span class="ident" id="5971773">token</span><span class="op" id="5971778">.</span><span class="ident" id="5971779">ELLIPSIS</span><span class="op" id="5971787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971792">if</span>&nbsp;<span class="ident" id="5971795">x</span><span class="op" id="5971796">.</span><span class="ident" id="5971797">Rparen</span><span class="op" id="5971803">.</span><span class="ident" id="5971804">IsValid</span><span class="op" id="5971811">(</span><span class="op" id="5971812">)</span>&nbsp;<span class="op" id="5971814">&amp;&amp;</span>&nbsp;<span class="ident" id="5971817">p</span><span class="op" id="5971818">.</span><span class="ident" id="5971819">lineFor</span><span class="op" id="5971826">(</span><span class="ident" id="5971827">x</span><span class="op" id="5971828">.</span><span class="ident" id="5971829">Ellipsis</span><span class="op" id="5971837">)</span>&nbsp;<span class="op" id="5971839">&lt;</span>&nbsp;<span class="ident" id="5971841">p</span><span class="op" id="5971842">.</span><span class="ident" id="5971843">lineFor</span><span class="op" id="5971850">(</span><span class="ident" id="5971851">x</span><span class="op" id="5971852">.</span><span class="ident" id="5971853">Rparen</span><span class="op" id="5971859">)</span>&nbsp;<span class="op" id="5971861">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971867">p</span><span class="op" id="5971868">.</span><span class="builtinfunc" id="5971869">print</span><span class="op" id="5971874">(</span><span class="ident" id="5971875">token</span><span class="op" id="5971880">.</span><span class="ident" id="5971881">COMMA</span><span class="op" id="5971886">,</span>&nbsp;<span class="ident" id="5971888">formfeed</span><span class="op" id="5971896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971905">}</span>&nbsp;<span class="keyword" id="5971907">else</span>&nbsp;<span class="op" id="5971912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971917">p</span><span class="op" id="5971918">.</span><span class="ident" id="5971919">exprList</span><span class="op" id="5971927">(</span><span class="ident" id="5971928">x</span><span class="op" id="5971929">.</span><span class="ident" id="5971930">Lparen</span><span class="op" id="5971936">,</span>&nbsp;<span class="ident" id="5971938">x</span><span class="op" id="5971939">.</span><span class="ident" id="5971940">Args</span><span class="op" id="5971944">,</span>&nbsp;<span class="ident" id="5971946">depth</span><span class="op" id="5971951">,</span>&nbsp;<span class="ident" id="5971953">commaTerm</span><span class="op" id="5971962">,</span>&nbsp;<span class="ident" id="5971964">x</span><span class="op" id="5971965">.</span><span class="ident" id="5971966">Rparen</span><span class="op" id="5971972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971976">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971980">p</span><span class="op" id="5971981">.</span><span class="builtinfunc" id="5971982">print</span><span class="op" id="5971987">(</span><span class="ident" id="5971988">x</span><span class="op" id="5971989">.</span><span class="ident" id="5971990">Rparen</span><span class="op" id="5971996">,</span>&nbsp;<span class="ident" id="5971998">token</span><span class="op" id="5972003">.</span><span class="ident" id="5972004">RPAREN</span><span class="op" id="5972010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972014">case</span>&nbsp;<span class="op" id="5972019">*</span><span class="ident" id="5972020">ast</span><span class="op" id="5972023">.</span><span class="ident" id="5972024">CompositeLit</span><span class="op" id="5972036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972040">//&nbsp;composite&nbsp;literal&nbsp;elements&nbsp;that&nbsp;are&nbsp;composite&nbsp;literals&nbsp;themselves&nbsp;may&nbsp;have&nbsp;the&nbsp;type&nbsp;omitted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972137">if</span>&nbsp;<span class="ident" id="5972140">x</span><span class="op" id="5972141">.</span><span class="ident" id="5972142">Type</span>&nbsp;<span class="op" id="5972147">!=</span>&nbsp;<span class="ident" id="5972150">nil</span>&nbsp;<span class="op" id="5972154">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972159">p</span><span class="op" id="5972160">.</span><span class="ident" id="5972161">expr1</span><span class="op" id="5972166">(</span><span class="ident" id="5972167">x</span><span class="op" id="5972168">.</span><span class="ident" id="5972169">Type</span><span class="op" id="5972173">,</span>&nbsp;<span class="ident" id="5972175">token</span><span class="op" id="5972180">.</span><span class="ident" id="5972181">HighestPrec</span><span class="op" id="5972192">,</span>&nbsp;<span class="ident" id="5972194">depth</span><span class="op" id="5972199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972207">p</span><span class="op" id="5972208">.</span><span class="builtinfunc" id="5972209">print</span><span class="op" id="5972214">(</span><span class="ident" id="5972215">x</span><span class="op" id="5972216">.</span><span class="ident" id="5972217">Lbrace</span><span class="op" id="5972223">,</span>&nbsp;<span class="ident" id="5972225">token</span><span class="op" id="5972230">.</span><span class="ident" id="5972231">LBRACE</span><span class="op" id="5972237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972241">p</span><span class="op" id="5972242">.</span><span class="ident" id="5972243">exprList</span><span class="op" id="5972251">(</span><span class="ident" id="5972252">x</span><span class="op" id="5972253">.</span><span class="ident" id="5972254">Lbrace</span><span class="op" id="5972260">,</span>&nbsp;<span class="ident" id="5972262">x</span><span class="op" id="5972263">.</span><span class="ident" id="5972264">Elts</span><span class="op" id="5972268">,</span>&nbsp;<span class="num" id="5972270">1</span><span class="op" id="5972271">,</span>&nbsp;<span class="ident" id="5972273">commaTerm</span><span class="op" id="5972282">,</span>&nbsp;<span class="ident" id="5972284">x</span><span class="op" id="5972285">.</span><span class="ident" id="5972286">Rbrace</span><span class="op" id="5972292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972296">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;line&nbsp;break&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972361">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;as&nbsp;it&nbsp;might&nbsp;break&nbsp;the&nbsp;code&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972425">//&nbsp;is&nbsp;no&nbsp;trailing&nbsp;&#39;,&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972449">mode</span>&nbsp;<span class="op" id="5972454">:=</span>&nbsp;<span class="ident" id="5972457">noExtraLinebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972476">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;blank&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972536">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;the&nbsp;literal&nbsp;is&nbsp;empty</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972592">if</span>&nbsp;<span class="builtinfunc" id="5972595">len</span><span class="op" id="5972598">(</span><span class="ident" id="5972599">x</span><span class="op" id="5972600">.</span><span class="ident" id="5972601">Elts</span><span class="op" id="5972605">)</span>&nbsp;<span class="op" id="5972607">&gt;</span>&nbsp;<span class="num" id="5972609">0</span>&nbsp;<span class="op" id="5972611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972616">mode</span>&nbsp;<span class="op" id="5972621">|=</span>&nbsp;<span class="ident" id="5972624">noExtraBlank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972643">p</span><span class="op" id="5972644">.</span><span class="builtinfunc" id="5972645">print</span><span class="op" id="5972650">(</span><span class="ident" id="5972651">mode</span><span class="op" id="5972655">,</span>&nbsp;<span class="ident" id="5972657">x</span><span class="op" id="5972658">.</span><span class="ident" id="5972659">Rbrace</span><span class="op" id="5972665">,</span>&nbsp;<span class="ident" id="5972667">token</span><span class="op" id="5972672">.</span><span class="ident" id="5972673">RBRACE</span><span class="op" id="5972679">,</span>&nbsp;<span class="ident" id="5972681">mode</span><span class="op" id="5972685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972689">case</span>&nbsp;<span class="op" id="5972694">*</span><span class="ident" id="5972695">ast</span><span class="op" id="5972698">.</span><span class="ident" id="5972699">Ellipsis</span><span class="op" id="5972707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972711">p</span><span class="op" id="5972712">.</span><span class="builtinfunc" id="5972713">print</span><span class="op" id="5972718">(</span><span class="ident" id="5972719">token</span><span class="op" id="5972724">.</span><span class="ident" id="5972725">ELLIPSIS</span><span class="op" id="5972733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972737">if</span>&nbsp;<span class="ident" id="5972740">x</span><span class="op" id="5972741">.</span><span class="ident" id="5972742">Elt</span>&nbsp;<span class="op" id="5972746">!=</span>&nbsp;<span class="ident" id="5972749">nil</span>&nbsp;<span class="op" id="5972753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972758">p</span><span class="op" id="5972759">.</span><span class="ident" id="5972760">expr</span><span class="op" id="5972764">(</span><span class="ident" id="5972765">x</span><span class="op" id="5972766">.</span><span class="ident" id="5972767">Elt</span><span class="op" id="5972770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972774">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972778">case</span>&nbsp;<span class="op" id="5972783">*</span><span class="ident" id="5972784">ast</span><span class="op" id="5972787">.</span><span class="ident" id="5972788">ArrayType</span><span class="op" id="5972797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972801">p</span><span class="op" id="5972802">.</span><span class="builtinfunc" id="5972803">print</span><span class="op" id="5972808">(</span><span class="ident" id="5972809">token</span><span class="op" id="5972814">.</span><span class="ident" id="5972815">LBRACK</span><span class="op" id="5972821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972825">if</span>&nbsp;<span class="ident" id="5972828">x</span><span class="op" id="5972829">.</span><span class="ident" id="5972830">Len</span>&nbsp;<span class="op" id="5972834">!=</span>&nbsp;<span class="ident" id="5972837">nil</span>&nbsp;<span class="op" id="5972841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972846">p</span><span class="op" id="5972847">.</span><span class="ident" id="5972848">expr</span><span class="op" id="5972852">(</span><span class="ident" id="5972853">x</span><span class="op" id="5972854">.</span><span class="ident" id="5972855">Len</span><span class="op" id="5972858">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972866">p</span><span class="op" id="5972867">.</span><span class="builtinfunc" id="5972868">print</span><span class="op" id="5972873">(</span><span class="ident" id="5972874">token</span><span class="op" id="5972879">.</span><span class="ident" id="5972880">RBRACK</span><span class="op" id="5972886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972890">p</span><span class="op" id="5972891">.</span><span class="ident" id="5972892">expr</span><span class="op" id="5972896">(</span><span class="ident" id="5972897">x</span><span class="op" id="5972898">.</span><span class="ident" id="5972899">Elt</span><span class="op" id="5972902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972906">case</span>&nbsp;<span class="op" id="5972911">*</span><span class="ident" id="5972912">ast</span><span class="op" id="5972915">.</span><span class="ident" id="5972916">StructType</span><span class="op" id="5972926">:</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972930">p</span><span class="op" id="5972931">.</span><span class="builtinfunc" id="5972932">print</span><span class="op" id="5972937">(</span><span class="ident" id="5972938">token</span><span class="op" id="5972943">.</span><span class="ident" id="5972944">STRUCT</span><span class="op" id="5972950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972954">p</span><span class="op" id="5972955">.</span><span class="ident" id="5972956">fieldList</span><span class="op" id="5972965">(</span><span class="ident" id="5972966">x</span><span class="op" id="5972967">.</span><span class="ident" id="5972968">Fields</span><span class="op" id="5972974">,</span>&nbsp;<span class="builtintype" id="5972976">true</span><span class="op" id="5972980">,</span>&nbsp;<span class="ident" id="5972982">x</span><span class="op" id="5972983">.</span><span class="ident" id="5972984">Incomplete</span><span class="op" id="5972994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972998">case</span>&nbsp;<span class="op" id="5973003">*</span><span class="ident" id="5973004">ast</span><span class="op" id="5973007">.</span><span class="ident" id="5973008">FuncType</span><span class="op" id="5973016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973020">p</span><span class="op" id="5973021">.</span><span class="builtinfunc" id="5973022">print</span><span class="op" id="5973027">(</span><span class="ident" id="5973028">token</span><span class="op" id="5973033">.</span><span class="ident" id="5973034">FUNC</span><span class="op" id="5973038">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973042">p</span><span class="op" id="5973043">.</span><span class="ident" id="5973044">signature</span><span class="op" id="5973053">(</span><span class="ident" id="5973054">x</span><span class="op" id="5973055">.</span><span class="ident" id="5973056">Params</span><span class="op" id="5973062">,</span>&nbsp;<span class="ident" id="5973064">x</span><span class="op" id="5973065">.</span><span class="ident" id="5973066">Results</span><span class="op" id="5973073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973077">case</span>&nbsp;<span class="op" id="5973082">*</span><span class="ident" id="5973083">ast</span><span class="op" id="5973086">.</span><span class="ident" id="5973087">InterfaceType</span><span class="op" id="5973100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973104">p</span><span class="op" id="5973105">.</span><span class="builtinfunc" id="5973106">print</span><span class="op" id="5973111">(</span><span class="ident" id="5973112">token</span><span class="op" id="5973117">.</span><span class="ident" id="5973118">INTERFACE</span><span class="op" id="5973127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973131">p</span><span class="op" id="5973132">.</span><span class="ident" id="5973133">fieldList</span><span class="op" id="5973142">(</span><span class="ident" id="5973143">x</span><span class="op" id="5973144">.</span><span class="ident" id="5973145">Methods</span><span class="op" id="5973152">,</span>&nbsp;<span class="builtintype" id="5973154">false</span><span class="op" id="5973159">,</span>&nbsp;<span class="ident" id="5973161">x</span><span class="op" id="5973162">.</span><span class="ident" id="5973163">Incomplete</span><span class="op" id="5973173">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973177">case</span>&nbsp;<span class="op" id="5973182">*</span><span class="ident" id="5973183">ast</span><span class="op" id="5973186">.</span><span class="ident" id="5973187">MapType</span><span class="op" id="5973194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973198">p</span><span class="op" id="5973199">.</span><span class="builtinfunc" id="5973200">print</span><span class="op" id="5973205">(</span><span class="ident" id="5973206">token</span><span class="op" id="5973211">.</span><span class="ident" id="5973212">MAP</span><span class="op" id="5973215">,</span>&nbsp;<span class="ident" id="5973217">token</span><span class="op" id="5973222">.</span><span class="ident" id="5973223">LBRACK</span><span class="op" id="5973229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973233">p</span><span class="op" id="5973234">.</span><span class="ident" id="5973235">expr</span><span class="op" id="5973239">(</span><span class="ident" id="5973240">x</span><span class="op" id="5973241">.</span><span class="ident" id="5973242">Key</span><span class="op" id="5973245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973249">p</span><span class="op" id="5973250">.</span><span class="builtinfunc" id="5973251">print</span><span class="op" id="5973256">(</span><span class="ident" id="5973257">token</span><span class="op" id="5973262">.</span><span class="ident" id="5973263">RBRACK</span><span class="op" id="5973269">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973273">p</span><span class="op" id="5973274">.</span><span class="ident" id="5973275">expr</span><span class="op" id="5973279">(</span><span class="ident" id="5973280">x</span><span class="op" id="5973281">.</span><span class="ident" id="5973282">Value</span><span class="op" id="5973287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973291">case</span>&nbsp;<span class="op" id="5973296">*</span><span class="ident" id="5973297">ast</span><span class="op" id="5973300">.</span><span class="ident" id="5973301">ChanType</span><span class="op" id="5973309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973313">switch</span>&nbsp;<span class="ident" id="5973320">x</span><span class="op" id="5973321">.</span><span class="ident" id="5973322">Dir</span>&nbsp;<span class="op" id="5973326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973330">case</span>&nbsp;<span class="ident" id="5973335">ast</span><span class="op" id="5973338">.</span><span class="ident" id="5973339">SEND</span>&nbsp;<span class="op" id="5973344">|</span>&nbsp;<span class="ident" id="5973346">ast</span><span class="op" id="5973349">.</span><span class="ident" id="5973350">RECV</span><span class="op" id="5973354">:</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973359">p</span><span class="op" id="5973360">.</span><span class="builtinfunc" id="5973361">print</span><span class="op" id="5973366">(</span><span class="ident" id="5973367">token</span><span class="op" id="5973372">.</span><span class="ident" id="5973373">CHAN</span><span class="op" id="5973377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973381">case</span>&nbsp;<span class="ident" id="5973386">ast</span><span class="op" id="5973389">.</span><span class="ident" id="5973390">RECV</span><span class="op" id="5973394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973399">p</span><span class="op" id="5973400">.</span><span class="builtinfunc" id="5973401">print</span><span class="op" id="5973406">(</span><span class="ident" id="5973407">token</span><span class="op" id="5973412">.</span><span class="ident" id="5973413">ARROW</span><span class="op" id="5973418">,</span>&nbsp;<span class="ident" id="5973420">token</span><span class="op" id="5973425">.</span><span class="ident" id="5973426">CHAN</span><span class="op" id="5973430">)</span>&nbsp;<span class="comment" id="5973432">//&nbsp;x.Arrow&nbsp;and&nbsp;x.Pos()&nbsp;are&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973470">case</span>&nbsp;<span class="ident" id="5973475">ast</span><span class="op" id="5973478">.</span><span class="ident" id="5973479">SEND</span><span class="op" id="5973483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973488">p</span><span class="op" id="5973489">.</span><span class="builtinfunc" id="5973490">print</span><span class="op" id="5973495">(</span><span class="ident" id="5973496">token</span><span class="op" id="5973501">.</span><span class="ident" id="5973502">CHAN</span><span class="op" id="5973506">,</span>&nbsp;<span class="ident" id="5973508">x</span><span class="op" id="5973509">.</span><span class="ident" id="5973510">Arrow</span><span class="op" id="5973515">,</span>&nbsp;<span class="ident" id="5973517">token</span><span class="op" id="5973522">.</span><span class="ident" id="5973523">ARROW</span><span class="op" id="5973528">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973536">p</span><span class="op" id="5973537">.</span><span class="builtinfunc" id="5973538">print</span><span class="op" id="5973543">(</span><span class="ident" id="5973544">blank</span><span class="op" id="5973549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973553">p</span><span class="op" id="5973554">.</span><span class="ident" id="5973555">expr</span><span class="op" id="5973559">(</span><span class="ident" id="5973560">x</span><span class="op" id="5973561">.</span><span class="ident" id="5973562">Value</span><span class="op" id="5973567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973571">default</span><span class="op" id="5973578">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5973582">panic</span><span class="op" id="5973587">(</span><span class="string" id="5973588">&#34;unreachable&#34;</span><span class="op" id="5973601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973608">return</span><br>
<span class="lineno"></span><span class="op" id="5973615">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="keyword" id="5973618">func</span>&nbsp;<span class="op" id="5973623">(</span><span class="ident" id="5973624">p</span>&nbsp;<span class="op" id="5973626">*</span><span class="ident" id="5973627">printer</span><span class="op" id="5973634">)</span>&nbsp;<span class="ident" id="5973636">expr0</span><span class="op" id="5973641">(</span><span class="ident" id="5973642">x</span>&nbsp;<span class="ident" id="5973644">ast</span><span class="op" id="5973647">.</span><span class="ident" id="5973648">Expr</span><span class="op" id="5973652">,</span>&nbsp;<span class="ident" id="5973654">depth</span>&nbsp;<span class="builtintype" id="5973660">int</span><span class="op" id="5973663">)</span>&nbsp;<span class="op" id="5973665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973668">p</span><span class="op" id="5973669">.</span><span class="ident" id="5973670">expr1</span><span class="op" id="5973675">(</span><span class="ident" id="5973676">x</span><span class="op" id="5973677">,</span>&nbsp;<span class="ident" id="5973679">token</span><span class="op" id="5973684">.</span><span class="ident" id="5973685">LowestPrec</span><span class="op" id="5973695">,</span>&nbsp;<span class="ident" id="5973697">depth</span><span class="op" id="5973702">)</span><br>
<span class="lineno"></span><span class="op" id="5973704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">895</span><span class="keyword" id="5973707">func</span>&nbsp;<span class="op" id="5973712">(</span><span class="ident" id="5973713">p</span>&nbsp;<span class="op" id="5973715">*</span><span class="ident" id="5973716">printer</span><span class="op" id="5973723">)</span>&nbsp;<span class="ident" id="5973725">expr</span><span class="op" id="5973729">(</span><span class="ident" id="5973730">x</span>&nbsp;<span class="ident" id="5973732">ast</span><span class="op" id="5973735">.</span><span class="ident" id="5973736">Expr</span><span class="op" id="5973740">)</span>&nbsp;<span class="op" id="5973742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973745">const</span>&nbsp;<span class="ident" id="5973751">depth</span>&nbsp;<span class="op" id="5973757">=</span>&nbsp;<span class="num" id="5973759">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973762">p</span><span class="op" id="5973763">.</span><span class="ident" id="5973764">expr1</span><span class="op" id="5973769">(</span><span class="ident" id="5973770">x</span><span class="op" id="5973771">,</span>&nbsp;<span class="ident" id="5973773">token</span><span class="op" id="5973778">.</span><span class="ident" id="5973779">LowestPrec</span><span class="op" id="5973789">,</span>&nbsp;<span class="ident" id="5973791">depth</span><span class="op" id="5973796">)</span><br>
<span class="lineno"></span><span class="op" id="5973798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span><span class="comment" id="5973801">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5973881">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5973896">//&nbsp;Print&nbsp;the&nbsp;statement&nbsp;list&nbsp;indented,&nbsp;but&nbsp;without&nbsp;a&nbsp;newline&nbsp;after&nbsp;the&nbsp;last&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5973982">//&nbsp;Extra&nbsp;line&nbsp;breaks&nbsp;between&nbsp;statements&nbsp;in&nbsp;the&nbsp;source&nbsp;are&nbsp;respected&nbsp;but&nbsp;at&nbsp;most&nbsp;one</span><br>
<span class="lineno">905</span><span class="comment" id="5974066">//&nbsp;empty&nbsp;line&nbsp;is&nbsp;printed&nbsp;between&nbsp;statements.</span><br>
<span class="lineno"></span><span class="keyword" id="5974111">func</span>&nbsp;<span class="op" id="5974116">(</span><span class="ident" id="5974117">p</span>&nbsp;<span class="op" id="5974119">*</span><span class="ident" id="5974120">printer</span><span class="op" id="5974127">)</span>&nbsp;<span class="ident" id="5974129">stmtList</span><span class="op" id="5974137">(</span><span class="ident" id="5974138">list</span>&nbsp;<span class="op" id="5974143">[</span><span class="op" id="5974144">]</span><span class="ident" id="5974145">ast</span><span class="op" id="5974148">.</span><span class="ident" id="5974149">Stmt</span><span class="op" id="5974153">,</span>&nbsp;<span class="ident" id="5974155">nindent</span>&nbsp;<span class="builtintype" id="5974163">int</span><span class="op" id="5974166">,</span>&nbsp;<span class="ident" id="5974168">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5974181">bool</span><span class="op" id="5974185">)</span>&nbsp;<span class="op" id="5974187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974190">if</span>&nbsp;<span class="ident" id="5974193">nindent</span>&nbsp;<span class="op" id="5974201">&gt;</span>&nbsp;<span class="num" id="5974203">0</span>&nbsp;<span class="op" id="5974205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974209">p</span><span class="op" id="5974210">.</span><span class="builtinfunc" id="5974211">print</span><span class="op" id="5974216">(</span><span class="ident" id="5974217">indent</span><span class="op" id="5974223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974226">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974229">var</span>&nbsp;<span class="ident" id="5974233">line</span>&nbsp;<span class="builtintype" id="5974238">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974243">i</span>&nbsp;<span class="op" id="5974245">:=</span>&nbsp;<span class="num" id="5974248">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974251">for</span>&nbsp;<span class="ident" id="5974255">_</span><span class="op" id="5974256">,</span>&nbsp;<span class="ident" id="5974258">s</span>&nbsp;<span class="op" id="5974260">:=</span>&nbsp;<span class="keyword" id="5974263">range</span>&nbsp;<span class="ident" id="5974269">list</span>&nbsp;<span class="op" id="5974274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974278">//&nbsp;ignore&nbsp;empty&nbsp;statements&nbsp;(was&nbsp;issue&nbsp;3466)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974324">if</span>&nbsp;<span class="ident" id="5974327">_</span><span class="op" id="5974328">,</span>&nbsp;<span class="ident" id="5974330">isEmpty</span>&nbsp;<span class="op" id="5974338">:=</span>&nbsp;<span class="ident" id="5974341">s</span><span class="op" id="5974342">.</span><span class="op" id="5974343">(</span><span class="op" id="5974344">*</span><span class="ident" id="5974345">ast</span><span class="op" id="5974348">.</span><span class="ident" id="5974349">EmptyStmt</span><span class="op" id="5974358">)</span><span class="op" id="5974359">;</span>&nbsp;<span class="op" id="5974361">!</span><span class="ident" id="5974362">isEmpty</span>&nbsp;<span class="op" id="5974370">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974375">//&nbsp;nindent&nbsp;==&nbsp;0&nbsp;only&nbsp;for&nbsp;lists&nbsp;of&nbsp;switch/select&nbsp;case&nbsp;clauses;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974440">//&nbsp;in&nbsp;those&nbsp;cases&nbsp;each&nbsp;clause&nbsp;is&nbsp;a&nbsp;new&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974490">if</span>&nbsp;<span class="builtinfunc" id="5974493">len</span><span class="op" id="5974496">(</span><span class="ident" id="5974497">p</span><span class="op" id="5974498">.</span><span class="ident" id="5974499">output</span><span class="op" id="5974505">)</span>&nbsp;<span class="op" id="5974507">&gt;</span>&nbsp;<span class="num" id="5974509">0</span>&nbsp;<span class="op" id="5974511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974517">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974591">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974649">p</span><span class="op" id="5974650">.</span><span class="ident" id="5974651">linebreak</span><span class="op" id="5974660">(</span><span class="ident" id="5974661">p</span><span class="op" id="5974662">.</span><span class="ident" id="5974663">lineFor</span><span class="op" id="5974670">(</span><span class="ident" id="5974671">s</span><span class="op" id="5974672">.</span><span class="ident" id="5974673">Pos</span><span class="op" id="5974676">(</span><span class="op" id="5974677">)</span><span class="op" id="5974678">)</span><span class="op" id="5974679">,</span>&nbsp;<span class="num" id="5974681">1</span><span class="op" id="5974682">,</span>&nbsp;<span class="ident" id="5974684">ignore</span><span class="op" id="5974690">,</span>&nbsp;<span class="ident" id="5974692">i</span>&nbsp;<span class="op" id="5974694">==</span>&nbsp;<span class="num" id="5974697">0</span>&nbsp;<span class="op" id="5974699">||</span>&nbsp;<span class="ident" id="5974702">nindent</span>&nbsp;<span class="op" id="5974710">==</span>&nbsp;<span class="num" id="5974713">0</span>&nbsp;<span class="op" id="5974715">||</span>&nbsp;<span class="ident" id="5974718">p</span><span class="op" id="5974719">.</span><span class="ident" id="5974720">linesFrom</span><span class="op" id="5974729">(</span><span class="ident" id="5974730">line</span><span class="op" id="5974734">)</span>&nbsp;<span class="op" id="5974736">&gt;</span>&nbsp;<span class="num" id="5974738">0</span><span class="op" id="5974739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974749">p</span><span class="op" id="5974750">.</span><span class="ident" id="5974751">recordLine</span><span class="op" id="5974761">(</span><span class="op" id="5974762">&amp;</span><span class="ident" id="5974763">line</span><span class="op" id="5974767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974772">p</span><span class="op" id="5974773">.</span><span class="ident" id="5974774">stmt</span><span class="op" id="5974778">(</span><span class="ident" id="5974779">s</span><span class="op" id="5974780">,</span>&nbsp;<span class="ident" id="5974782">nextIsRBrace</span>&nbsp;<span class="op" id="5974795">&amp;&amp;</span>&nbsp;<span class="ident" id="5974798">i</span>&nbsp;<span class="op" id="5974800">==</span>&nbsp;<span class="builtinfunc" id="5974803">len</span><span class="op" id="5974806">(</span><span class="ident" id="5974807">list</span><span class="op" id="5974811">)</span><span class="op" id="5974812">-</span><span class="num" id="5974813">1</span><span class="op" id="5974814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974819">//&nbsp;labeled&nbsp;statements&nbsp;put&nbsp;labels&nbsp;on&nbsp;a&nbsp;separate&nbsp;line,&nbsp;but&nbsp;here</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974884">//&nbsp;we&nbsp;only&nbsp;care&nbsp;about&nbsp;the&nbsp;start&nbsp;line&nbsp;of&nbsp;the&nbsp;actual&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5974948">//&nbsp;without&nbsp;label&nbsp;-&nbsp;correct&nbsp;line&nbsp;for&nbsp;each&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974998">for</span>&nbsp;<span class="ident" id="5975002">t</span>&nbsp;<span class="op" id="5975004">:=</span>&nbsp;<span class="ident" id="5975007">s</span><span class="op" id="5975008">;</span>&nbsp;<span class="op" id="5975010">;</span>&nbsp;<span class="op" id="5975012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975018">lt</span><span class="op" id="5975020">,</span>&nbsp;<span class="ident" id="5975022">_</span>&nbsp;<span class="op" id="5975024">:=</span>&nbsp;<span class="ident" id="5975027">t</span><span class="op" id="5975028">.</span><span class="op" id="5975029">(</span><span class="op" id="5975030">*</span><span class="ident" id="5975031">ast</span><span class="op" id="5975034">.</span><span class="ident" id="5975035">LabeledStmt</span><span class="op" id="5975046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975052">if</span>&nbsp;<span class="ident" id="5975055">lt</span>&nbsp;<span class="op" id="5975058">==</span>&nbsp;<span class="ident" id="5975061">nil</span>&nbsp;<span class="op" id="5975065">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975072">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975088">line</span><span class="op" id="5975092">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975099">t</span>&nbsp;<span class="op" id="5975101">=</span>&nbsp;<span class="ident" id="5975103">lt</span><span class="op" id="5975105">.</span><span class="ident" id="5975106">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975114">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975119">i</span><span class="op" id="5975120">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975131">if</span>&nbsp;<span class="ident" id="5975134">nindent</span>&nbsp;<span class="op" id="5975142">&gt;</span>&nbsp;<span class="num" id="5975144">0</span>&nbsp;<span class="op" id="5975146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975150">p</span><span class="op" id="5975151">.</span><span class="builtinfunc" id="5975152">print</span><span class="op" id="5975157">(</span><span class="ident" id="5975158">unindent</span><span class="op" id="5975166">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975169">}</span><br>
<span class="lineno"></span><span class="op" id="5975171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975174">//&nbsp;block&nbsp;prints&nbsp;an&nbsp;*ast.BlockStmt;&nbsp;it&nbsp;always&nbsp;spans&nbsp;at&nbsp;least&nbsp;two&nbsp;lines.</span><br>
<span class="lineno"></span><span class="keyword" id="5975245">func</span>&nbsp;<span class="op" id="5975250">(</span><span class="ident" id="5975251">p</span>&nbsp;<span class="op" id="5975253">*</span><span class="ident" id="5975254">printer</span><span class="op" id="5975261">)</span>&nbsp;<span class="ident" id="5975263">block</span><span class="op" id="5975268">(</span><span class="ident" id="5975269">b</span>&nbsp;<span class="op" id="5975271">*</span><span class="ident" id="5975272">ast</span><span class="op" id="5975275">.</span><span class="ident" id="5975276">BlockStmt</span><span class="op" id="5975285">,</span>&nbsp;<span class="ident" id="5975287">nindent</span>&nbsp;<span class="builtintype" id="5975295">int</span><span class="op" id="5975298">)</span>&nbsp;<span class="op" id="5975300">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975303">p</span><span class="op" id="5975304">.</span><span class="builtinfunc" id="5975305">print</span><span class="op" id="5975310">(</span><span class="ident" id="5975311">b</span><span class="op" id="5975312">.</span><span class="ident" id="5975313">Lbrace</span><span class="op" id="5975319">,</span>&nbsp;<span class="ident" id="5975321">token</span><span class="op" id="5975326">.</span><span class="ident" id="5975327">LBRACE</span><span class="op" id="5975333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975336">p</span><span class="op" id="5975337">.</span><span class="ident" id="5975338">stmtList</span><span class="op" id="5975346">(</span><span class="ident" id="5975347">b</span><span class="op" id="5975348">.</span><span class="ident" id="5975349">List</span><span class="op" id="5975353">,</span>&nbsp;<span class="ident" id="5975355">nindent</span><span class="op" id="5975362">,</span>&nbsp;<span class="builtintype" id="5975364">true</span><span class="op" id="5975368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975371">p</span><span class="op" id="5975372">.</span><span class="ident" id="5975373">linebreak</span><span class="op" id="5975382">(</span><span class="ident" id="5975383">p</span><span class="op" id="5975384">.</span><span class="ident" id="5975385">lineFor</span><span class="op" id="5975392">(</span><span class="ident" id="5975393">b</span><span class="op" id="5975394">.</span><span class="ident" id="5975395">Rbrace</span><span class="op" id="5975401">)</span><span class="op" id="5975402">,</span>&nbsp;<span class="num" id="5975404">1</span><span class="op" id="5975405">,</span>&nbsp;<span class="ident" id="5975407">ignore</span><span class="op" id="5975413">,</span>&nbsp;<span class="builtintype" id="5975415">true</span><span class="op" id="5975419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975422">p</span><span class="op" id="5975423">.</span><span class="builtinfunc" id="5975424">print</span><span class="op" id="5975429">(</span><span class="ident" id="5975430">b</span><span class="op" id="5975431">.</span><span class="ident" id="5975432">Rbrace</span><span class="op" id="5975438">,</span>&nbsp;<span class="ident" id="5975440">token</span><span class="op" id="5975445">.</span><span class="ident" id="5975446">RBRACE</span><span class="op" id="5975452">)</span><br>
<span class="lineno"></span><span class="op" id="5975454">}</span><br>
<span class="lineno">950</span><br>
<span class="lineno"></span><span class="keyword" id="5975457">func</span>&nbsp;<span class="ident" id="5975462">isTypeName</span><span class="op" id="5975472">(</span><span class="ident" id="5975473">x</span>&nbsp;<span class="ident" id="5975475">ast</span><span class="op" id="5975478">.</span><span class="ident" id="5975479">Expr</span><span class="op" id="5975483">)</span>&nbsp;<span class="builtintype" id="5975485">bool</span>&nbsp;<span class="op" id="5975490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975493">switch</span>&nbsp;<span class="ident" id="5975500">t</span>&nbsp;<span class="op" id="5975502">:=</span>&nbsp;<span class="ident" id="5975505">x</span><span class="op" id="5975506">.</span><span class="op" id="5975507">(</span><span class="keyword" id="5975508">type</span><span class="op" id="5975512">)</span>&nbsp;<span class="op" id="5975514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975517">case</span>&nbsp;<span class="op" id="5975522">*</span><span class="ident" id="5975523">ast</span><span class="op" id="5975526">.</span><span class="ident" id="5975527">Ident</span><span class="op" id="5975532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975536">return</span>&nbsp;<span class="builtintype" id="5975543">true</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975549">case</span>&nbsp;<span class="op" id="5975554">*</span><span class="ident" id="5975555">ast</span><span class="op" id="5975558">.</span><span class="ident" id="5975559">SelectorExpr</span><span class="op" id="5975571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975575">return</span>&nbsp;<span class="ident" id="5975582">isTypeName</span><span class="op" id="5975592">(</span><span class="ident" id="5975593">t</span><span class="op" id="5975594">.</span><span class="ident" id="5975595">X</span><span class="op" id="5975596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975602">return</span>&nbsp;<span class="builtintype" id="5975609">false</span><br>
<span class="lineno"></span><span class="op" id="5975615">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span><span class="keyword" id="5975618">func</span>&nbsp;<span class="ident" id="5975623">stripParens</span><span class="op" id="5975634">(</span><span class="ident" id="5975635">x</span>&nbsp;<span class="ident" id="5975637">ast</span><span class="op" id="5975640">.</span><span class="ident" id="5975641">Expr</span><span class="op" id="5975645">)</span>&nbsp;<span class="ident" id="5975647">ast</span><span class="op" id="5975650">.</span><span class="ident" id="5975651">Expr</span>&nbsp;<span class="op" id="5975656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975659">if</span>&nbsp;<span class="ident" id="5975662">px</span><span class="op" id="5975664">,</span>&nbsp;<span class="ident" id="5975666">strip</span>&nbsp;<span class="op" id="5975672">:=</span>&nbsp;<span class="ident" id="5975675">x</span><span class="op" id="5975676">.</span><span class="op" id="5975677">(</span><span class="op" id="5975678">*</span><span class="ident" id="5975679">ast</span><span class="op" id="5975682">.</span><span class="ident" id="5975683">ParenExpr</span><span class="op" id="5975692">)</span><span class="op" id="5975693">;</span>&nbsp;<span class="ident" id="5975695">strip</span>&nbsp;<span class="op" id="5975701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975705">//&nbsp;parentheses&nbsp;must&nbsp;not&nbsp;be&nbsp;stripped&nbsp;if&nbsp;there&nbsp;are&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975760">//&nbsp;unparenthesized&nbsp;composite&nbsp;literals&nbsp;starting&nbsp;with</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975814">//&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975831">ast</span><span class="op" id="5975834">.</span><span class="ident" id="5975835">Inspect</span><span class="op" id="5975842">(</span><span class="ident" id="5975843">px</span><span class="op" id="5975845">.</span><span class="ident" id="5975846">X</span><span class="op" id="5975847">,</span>&nbsp;<span class="keyword" id="5975849">func</span><span class="op" id="5975853">(</span><span class="ident" id="5975854">node</span>&nbsp;<span class="ident" id="5975859">ast</span><span class="op" id="5975862">.</span><span class="ident" id="5975863">Node</span><span class="op" id="5975867">)</span>&nbsp;<span class="builtintype" id="5975869">bool</span>&nbsp;<span class="op" id="5975874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975879">switch</span>&nbsp;<span class="ident" id="5975886">x</span>&nbsp;<span class="op" id="5975888">:=</span>&nbsp;<span class="ident" id="5975891">node</span><span class="op" id="5975895">.</span><span class="op" id="5975896">(</span><span class="keyword" id="5975897">type</span><span class="op" id="5975901">)</span>&nbsp;<span class="op" id="5975903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975908">case</span>&nbsp;<span class="op" id="5975913">*</span><span class="ident" id="5975914">ast</span><span class="op" id="5975917">.</span><span class="ident" id="5975918">ParenExpr</span><span class="op" id="5975927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975933">//&nbsp;parentheses&nbsp;protect&nbsp;enclosed&nbsp;composite&nbsp;literals</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975988">return</span>&nbsp;<span class="builtintype" id="5975995">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976004">case</span>&nbsp;<span class="op" id="5976009">*</span><span class="ident" id="5976010">ast</span><span class="op" id="5976013">.</span><span class="ident" id="5976014">CompositeLit</span><span class="op" id="5976026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976032">if</span>&nbsp;<span class="ident" id="5976035">isTypeName</span><span class="op" id="5976045">(</span><span class="ident" id="5976046">x</span><span class="op" id="5976047">.</span><span class="ident" id="5976048">Type</span><span class="op" id="5976052">)</span>&nbsp;<span class="op" id="5976054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976061">strip</span>&nbsp;<span class="op" id="5976067">=</span>&nbsp;<span class="builtintype" id="5976069">false</span>&nbsp;<span class="comment" id="5976075">//&nbsp;do&nbsp;not&nbsp;strip&nbsp;parentheses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976107">}</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976113">return</span>&nbsp;<span class="builtintype" id="5976120">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976134">//&nbsp;in&nbsp;all&nbsp;other&nbsp;cases,&nbsp;keep&nbsp;inspecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976176">return</span>&nbsp;<span class="builtintype" id="5976183">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976190">}</span><span class="op" id="5976191">)</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976195">if</span>&nbsp;<span class="ident" id="5976198">strip</span>&nbsp;<span class="op" id="5976204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976209">return</span>&nbsp;<span class="ident" id="5976216">stripParens</span><span class="op" id="5976227">(</span><span class="ident" id="5976228">px</span><span class="op" id="5976230">.</span><span class="ident" id="5976231">X</span><span class="op" id="5976232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976242">return</span>&nbsp;<span class="ident" id="5976249">x</span><br>
<span class="lineno">985</span><span class="op" id="5976251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976254">func</span>&nbsp;<span class="ident" id="5976259">stripParensAlways</span><span class="op" id="5976276">(</span><span class="ident" id="5976277">x</span>&nbsp;<span class="ident" id="5976279">ast</span><span class="op" id="5976282">.</span><span class="ident" id="5976283">Expr</span><span class="op" id="5976287">)</span>&nbsp;<span class="ident" id="5976289">ast</span><span class="op" id="5976292">.</span><span class="ident" id="5976293">Expr</span>&nbsp;<span class="op" id="5976298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976301">if</span>&nbsp;<span class="ident" id="5976304">x</span><span class="op" id="5976305">,</span>&nbsp;<span class="ident" id="5976307">ok</span>&nbsp;<span class="op" id="5976310">:=</span>&nbsp;<span class="ident" id="5976313">x</span><span class="op" id="5976314">.</span><span class="op" id="5976315">(</span><span class="op" id="5976316">*</span><span class="ident" id="5976317">ast</span><span class="op" id="5976320">.</span><span class="ident" id="5976321">ParenExpr</span><span class="op" id="5976330">)</span><span class="op" id="5976331">;</span>&nbsp;<span class="ident" id="5976333">ok</span>&nbsp;<span class="op" id="5976336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976340">return</span>&nbsp;<span class="ident" id="5976347">stripParensAlways</span><span class="op" id="5976364">(</span><span class="ident" id="5976365">x</span><span class="op" id="5976366">.</span><span class="ident" id="5976367">X</span><span class="op" id="5976368">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976374">return</span>&nbsp;<span class="ident" id="5976381">x</span><br>
<span class="lineno"></span><span class="op" id="5976383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976386">func</span>&nbsp;<span class="op" id="5976391">(</span><span class="ident" id="5976392">p</span>&nbsp;<span class="op" id="5976394">*</span><span class="ident" id="5976395">printer</span><span class="op" id="5976402">)</span>&nbsp;<span class="ident" id="5976404">controlClause</span><span class="op" id="5976417">(</span><span class="ident" id="5976418">isForStmt</span>&nbsp;<span class="builtintype" id="5976428">bool</span><span class="op" id="5976432">,</span>&nbsp;<span class="ident" id="5976434">init</span>&nbsp;<span class="ident" id="5976439">ast</span><span class="op" id="5976442">.</span><span class="ident" id="5976443">Stmt</span><span class="op" id="5976447">,</span>&nbsp;<span class="ident" id="5976449">expr</span>&nbsp;<span class="ident" id="5976454">ast</span><span class="op" id="5976457">.</span><span class="ident" id="5976458">Expr</span><span class="op" id="5976462">,</span>&nbsp;<span class="ident" id="5976464">post</span>&nbsp;<span class="ident" id="5976469">ast</span><span class="op" id="5976472">.</span><span class="ident" id="5976473">Stmt</span><span class="op" id="5976477">)</span>&nbsp;<span class="op" id="5976479">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976482">p</span><span class="op" id="5976483">.</span><span class="builtinfunc" id="5976484">print</span><span class="op" id="5976489">(</span><span class="ident" id="5976490">blank</span><span class="op" id="5976495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976498">needsBlank</span>&nbsp;<span class="op" id="5976509">:=</span>&nbsp;<span class="builtintype" id="5976512">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976519">if</span>&nbsp;<span class="ident" id="5976522">init</span>&nbsp;<span class="op" id="5976527">==</span>&nbsp;<span class="ident" id="5976530">nil</span>&nbsp;<span class="op" id="5976534">&amp;&amp;</span>&nbsp;<span class="ident" id="5976537">post</span>&nbsp;<span class="op" id="5976542">==</span>&nbsp;<span class="ident" id="5976545">nil</span>&nbsp;<span class="op" id="5976549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976553">//&nbsp;no&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976581">if</span>&nbsp;<span class="ident" id="5976584">expr</span>&nbsp;<span class="op" id="5976589">!=</span>&nbsp;<span class="ident" id="5976592">nil</span>&nbsp;<span class="op" id="5976596">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976601">p</span><span class="op" id="5976602">.</span><span class="ident" id="5976603">expr</span><span class="op" id="5976607">(</span><span class="ident" id="5976608">stripParens</span><span class="op" id="5976619">(</span><span class="ident" id="5976620">expr</span><span class="op" id="5976624">)</span><span class="op" id="5976625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976630">needsBlank</span>&nbsp;<span class="op" id="5976641">=</span>&nbsp;<span class="builtintype" id="5976643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976653">}</span>&nbsp;<span class="keyword" id="5976655">else</span>&nbsp;<span class="op" id="5976660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976664">//&nbsp;all&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976693">//&nbsp;(they&nbsp;are&nbsp;not&nbsp;separators,&nbsp;print&nbsp;them&nbsp;explicitly)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976747">if</span>&nbsp;<span class="ident" id="5976750">init</span>&nbsp;<span class="op" id="5976755">!=</span>&nbsp;<span class="ident" id="5976758">nil</span>&nbsp;<span class="op" id="5976762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976767">p</span><span class="op" id="5976768">.</span><span class="ident" id="5976769">stmt</span><span class="op" id="5976773">(</span><span class="ident" id="5976774">init</span><span class="op" id="5976778">,</span>&nbsp;<span class="builtintype" id="5976780">false</span><span class="op" id="5976785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976793">p</span><span class="op" id="5976794">.</span><span class="builtinfunc" id="5976795">print</span><span class="op" id="5976800">(</span><span class="ident" id="5976801">token</span><span class="op" id="5976806">.</span><span class="ident" id="5976807">SEMICOLON</span><span class="op" id="5976816">,</span>&nbsp;<span class="ident" id="5976818">blank</span><span class="op" id="5976823">)</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976827">if</span>&nbsp;<span class="ident" id="5976830">expr</span>&nbsp;<span class="op" id="5976835">!=</span>&nbsp;<span class="ident" id="5976838">nil</span>&nbsp;<span class="op" id="5976842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976847">p</span><span class="op" id="5976848">.</span><span class="ident" id="5976849">expr</span><span class="op" id="5976853">(</span><span class="ident" id="5976854">stripParens</span><span class="op" id="5976865">(</span><span class="ident" id="5976866">expr</span><span class="op" id="5976870">)</span><span class="op" id="5976871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976876">needsBlank</span>&nbsp;<span class="op" id="5976887">=</span>&nbsp;<span class="builtintype" id="5976889">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976900">if</span>&nbsp;<span class="ident" id="5976903">isForStmt</span>&nbsp;<span class="op" id="5976913">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976918">p</span><span class="op" id="5976919">.</span><span class="builtinfunc" id="5976920">print</span><span class="op" id="5976925">(</span><span class="ident" id="5976926">token</span><span class="op" id="5976931">.</span><span class="ident" id="5976932">SEMICOLON</span><span class="op" id="5976941">,</span>&nbsp;<span class="ident" id="5976943">blank</span><span class="op" id="5976948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976953">needsBlank</span>&nbsp;<span class="op" id="5976964">=</span>&nbsp;<span class="builtintype" id="5976966">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976975">if</span>&nbsp;<span class="ident" id="5976978">post</span>&nbsp;<span class="op" id="5976983">!=</span>&nbsp;<span class="ident" id="5976986">nil</span>&nbsp;<span class="op" id="5976990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976996">p</span><span class="op" id="5976997">.</span><span class="ident" id="5976998">stmt</span><span class="op" id="5977002">(</span><span class="ident" id="5977003">post</span><span class="op" id="5977007">,</span>&nbsp;<span class="builtintype" id="5977009">false</span><span class="op" id="5977014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977020">needsBlank</span>&nbsp;<span class="op" id="5977031">=</span>&nbsp;<span class="builtintype" id="5977033">true</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977051">if</span>&nbsp;<span class="ident" id="5977054">needsBlank</span>&nbsp;<span class="op" id="5977065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977069">p</span><span class="op" id="5977070">.</span><span class="builtinfunc" id="5977071">print</span><span class="op" id="5977076">(</span><span class="ident" id="5977077">blank</span><span class="op" id="5977082">)</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977085">}</span><br>
<span class="lineno"></span><span class="op" id="5977087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5977090">//&nbsp;indentList&nbsp;reports&nbsp;whether&nbsp;an&nbsp;expression&nbsp;list&nbsp;would&nbsp;look&nbsp;better&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5977163">//&nbsp;were&nbsp;indented&nbsp;wholesale&nbsp;(starting&nbsp;with&nbsp;the&nbsp;very&nbsp;first&nbsp;element,&nbsp;rather</span><br>
<span class="lineno">1030</span><span class="comment" id="5977236">//&nbsp;than&nbsp;starting&nbsp;at&nbsp;the&nbsp;first&nbsp;line&nbsp;break).</span><br>
<span class="lineno"></span><span class="comment" id="5977279">//</span><br>
<span class="lineno"></span><span class="keyword" id="5977282">func</span>&nbsp;<span class="op" id="5977287">(</span><span class="ident" id="5977288">p</span>&nbsp;<span class="op" id="5977290">*</span><span class="ident" id="5977291">printer</span><span class="op" id="5977298">)</span>&nbsp;<span class="ident" id="5977300">indentList</span><span class="op" id="5977310">(</span><span class="ident" id="5977311">list</span>&nbsp;<span class="op" id="5977316">[</span><span class="op" id="5977317">]</span><span class="ident" id="5977318">ast</span><span class="op" id="5977321">.</span><span class="ident" id="5977322">Expr</span><span class="op" id="5977326">)</span>&nbsp;<span class="builtintype" id="5977328">bool</span>&nbsp;<span class="op" id="5977333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977336">//&nbsp;Heuristic:&nbsp;indentList&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;one&nbsp;multi-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977409">//&nbsp;line&nbsp;element&nbsp;in&nbsp;the&nbsp;list,&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;element&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977478">//&nbsp;starting&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ends.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977534">if</span>&nbsp;<span class="builtinfunc" id="5977537">len</span><span class="op" id="5977540">(</span><span class="ident" id="5977541">list</span><span class="op" id="5977545">)</span>&nbsp;<span class="op" id="5977547">&gt;=</span>&nbsp;<span class="num" id="5977550">2</span>&nbsp;<span class="op" id="5977552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977556">var</span>&nbsp;<span class="ident" id="5977560">b</span>&nbsp;<span class="op" id="5977562">=</span>&nbsp;<span class="ident" id="5977564">p</span><span class="op" id="5977565">.</span><span class="ident" id="5977566">lineFor</span><span class="op" id="5977573">(</span><span class="ident" id="5977574">list</span><span class="op" id="5977578">[</span><span class="num" id="5977579">0</span><span class="op" id="5977580">]</span><span class="op" id="5977581">.</span><span class="ident" id="5977582">Pos</span><span class="op" id="5977585">(</span><span class="op" id="5977586">)</span><span class="op" id="5977587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977591">var</span>&nbsp;<span class="ident" id="5977595">e</span>&nbsp;<span class="op" id="5977597">=</span>&nbsp;<span class="ident" id="5977599">p</span><span class="op" id="5977600">.</span><span class="ident" id="5977601">lineFor</span><span class="op" id="5977608">(</span><span class="ident" id="5977609">list</span><span class="op" id="5977613">[</span><span class="builtinfunc" id="5977614">len</span><span class="op" id="5977617">(</span><span class="ident" id="5977618">list</span><span class="op" id="5977622">)</span><span class="op" id="5977623">-</span><span class="num" id="5977624">1</span><span class="op" id="5977625">]</span><span class="op" id="5977626">.</span><span class="ident" id="5977627">End</span><span class="op" id="5977630">(</span><span class="op" id="5977631">)</span><span class="op" id="5977632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977636">if</span>&nbsp;<span class="num" id="5977639">0</span>&nbsp;<span class="op" id="5977641">&lt;</span>&nbsp;<span class="ident" id="5977643">b</span>&nbsp;<span class="op" id="5977645">&amp;&amp;</span>&nbsp;<span class="ident" id="5977648">b</span>&nbsp;<span class="op" id="5977650">&lt;</span>&nbsp;<span class="ident" id="5977652">e</span>&nbsp;<span class="op" id="5977654">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977659">//&nbsp;list&nbsp;spans&nbsp;multiple&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977691">n</span>&nbsp;<span class="op" id="5977693">:=</span>&nbsp;<span class="num" id="5977696">0</span>&nbsp;<span class="comment" id="5977698">//&nbsp;multi-line&nbsp;element&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977729">line</span>&nbsp;<span class="op" id="5977734">:=</span>&nbsp;<span class="ident" id="5977737">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977742">for</span>&nbsp;<span class="ident" id="5977746">_</span><span class="op" id="5977747">,</span>&nbsp;<span class="ident" id="5977749">x</span>&nbsp;<span class="op" id="5977751">:=</span>&nbsp;<span class="keyword" id="5977754">range</span>&nbsp;<span class="ident" id="5977760">list</span>&nbsp;<span class="op" id="5977765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977771">xb</span>&nbsp;<span class="op" id="5977774">:=</span>&nbsp;<span class="ident" id="5977777">p</span><span class="op" id="5977778">.</span><span class="ident" id="5977779">lineFor</span><span class="op" id="5977786">(</span><span class="ident" id="5977787">x</span><span class="op" id="5977788">.</span><span class="ident" id="5977789">Pos</span><span class="op" id="5977792">(</span><span class="op" id="5977793">)</span><span class="op" id="5977794">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977800">xe</span>&nbsp;<span class="op" id="5977803">:=</span>&nbsp;<span class="ident" id="5977806">p</span><span class="op" id="5977807">.</span><span class="ident" id="5977808">lineFor</span><span class="op" id="5977815">(</span><span class="ident" id="5977816">x</span><span class="op" id="5977817">.</span><span class="ident" id="5977818">End</span><span class="op" id="5977821">(</span><span class="op" id="5977822">)</span><span class="op" id="5977823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977829">if</span>&nbsp;<span class="ident" id="5977832">line</span>&nbsp;<span class="op" id="5977837">&lt;</span>&nbsp;<span class="ident" id="5977839">xb</span>&nbsp;<span class="op" id="5977842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977849">//&nbsp;x&nbsp;is&nbsp;not&nbsp;starting&nbsp;on&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977887">//&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ended</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977926">return</span>&nbsp;<span class="builtintype" id="5977933">true</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977948">if</span>&nbsp;<span class="ident" id="5977951">xb</span>&nbsp;<span class="op" id="5977954">&lt;</span>&nbsp;<span class="ident" id="5977956">xe</span>&nbsp;<span class="op" id="5977959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977966">//&nbsp;x&nbsp;is&nbsp;a&nbsp;multi-line&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978000">n</span><span class="op" id="5978001">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978008">}</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978014">line</span>&nbsp;<span class="op" id="5978019">=</span>&nbsp;<span class="ident" id="5978021">xe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978032">return</span>&nbsp;<span class="ident" id="5978039">n</span>&nbsp;<span class="op" id="5978041">&gt;</span>&nbsp;<span class="num" id="5978043">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978050">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978053">return</span>&nbsp;<span class="builtintype" id="5978060">false</span><br>
<span class="lineno"></span><span class="op" id="5978066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978069">func</span>&nbsp;<span class="op" id="5978074">(</span><span class="ident" id="5978075">p</span>&nbsp;<span class="op" id="5978077">*</span><span class="ident" id="5978078">printer</span><span class="op" id="5978085">)</span>&nbsp;<span class="ident" id="5978087">stmt</span><span class="op" id="5978091">(</span><span class="ident" id="5978092">stmt</span>&nbsp;<span class="ident" id="5978097">ast</span><span class="op" id="5978100">.</span><span class="ident" id="5978101">Stmt</span><span class="op" id="5978105">,</span>&nbsp;<span class="ident" id="5978107">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5978120">bool</span><span class="op" id="5978124">)</span>&nbsp;<span class="op" id="5978126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978129">p</span><span class="op" id="5978130">.</span><span class="builtinfunc" id="5978131">print</span><span class="op" id="5978136">(</span><span class="ident" id="5978137">stmt</span><span class="op" id="5978141">.</span><span class="ident" id="5978142">Pos</span><span class="op" id="5978145">(</span><span class="op" id="5978146">)</span><span class="op" id="5978147">)</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978151">switch</span>&nbsp;<span class="ident" id="5978158">s</span>&nbsp;<span class="op" id="5978160">:=</span>&nbsp;<span class="ident" id="5978163">stmt</span><span class="op" id="5978167">.</span><span class="op" id="5978168">(</span><span class="keyword" id="5978169">type</span><span class="op" id="5978173">)</span>&nbsp;<span class="op" id="5978175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978178">case</span>&nbsp;<span class="op" id="5978183">*</span><span class="ident" id="5978184">ast</span><span class="op" id="5978187">.</span><span class="ident" id="5978188">BadStmt</span><span class="op" id="5978195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978199">p</span><span class="op" id="5978200">.</span><span class="builtinfunc" id="5978201">print</span><span class="op" id="5978206">(</span><span class="string" id="5978207">&#34;BadStmt&#34;</span><span class="op" id="5978216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978220">case</span>&nbsp;<span class="op" id="5978225">*</span><span class="ident" id="5978226">ast</span><span class="op" id="5978229">.</span><span class="ident" id="5978230">DeclStmt</span><span class="op" id="5978238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978242">p</span><span class="op" id="5978243">.</span><span class="ident" id="5978244">decl</span><span class="op" id="5978248">(</span><span class="ident" id="5978249">s</span><span class="op" id="5978250">.</span><span class="ident" id="5978251">Decl</span><span class="op" id="5978255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978259">case</span>&nbsp;<span class="op" id="5978264">*</span><span class="ident" id="5978265">ast</span><span class="op" id="5978268">.</span><span class="ident" id="5978269">EmptyStmt</span><span class="op" id="5978278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5978282">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978301">case</span>&nbsp;<span class="op" id="5978306">*</span><span class="ident" id="5978307">ast</span><span class="op" id="5978310">.</span><span class="ident" id="5978311">LabeledStmt</span><span class="op" id="5978322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5978326">//&nbsp;a&nbsp;&#34;correcting&#34;&nbsp;unindent&nbsp;immediately&nbsp;following&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5978390">//&nbsp;is&nbsp;applied&nbsp;before&nbsp;the&nbsp;line&nbsp;break&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5978451">//&nbsp;between&nbsp;(see&nbsp;writeWhitespace)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978486">p</span><span class="op" id="5978487">.</span><span class="builtinfunc" id="5978488">print</span><span class="op" id="5978493">(</span><span class="ident" id="5978494">unindent</span><span class="op" id="5978502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978506">p</span><span class="op" id="5978507">.</span><span class="ident" id="5978508">expr</span><span class="op" id="5978512">(</span><span class="ident" id="5978513">s</span><span class="op" id="5978514">.</span><span class="ident" id="5978515">Label</span><span class="op" id="5978520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978524">p</span><span class="op" id="5978525">.</span><span class="builtinfunc" id="5978526">print</span><span class="op" id="5978531">(</span><span class="ident" id="5978532">s</span><span class="op" id="5978533">.</span><span class="ident" id="5978534">Colon</span><span class="op" id="5978539">,</span>&nbsp;<span class="ident" id="5978541">token</span><span class="op" id="5978546">.</span><span class="ident" id="5978547">COLON</span><span class="op" id="5978552">,</span>&nbsp;<span class="ident" id="5978554">indent</span><span class="op" id="5978560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978564">if</span>&nbsp;<span class="ident" id="5978567">e</span><span class="op" id="5978568">,</span>&nbsp;<span class="ident" id="5978570">isEmpty</span>&nbsp;<span class="op" id="5978578">:=</span>&nbsp;<span class="ident" id="5978581">s</span><span class="op" id="5978582">.</span><span class="ident" id="5978583">Stmt</span><span class="op" id="5978587">.</span><span class="op" id="5978588">(</span><span class="op" id="5978589">*</span><span class="ident" id="5978590">ast</span><span class="op" id="5978593">.</span><span class="ident" id="5978594">EmptyStmt</span><span class="op" id="5978603">)</span><span class="op" id="5978604">;</span>&nbsp;<span class="ident" id="5978606">isEmpty</span>&nbsp;<span class="op" id="5978614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978619">if</span>&nbsp;<span class="op" id="5978622">!</span><span class="ident" id="5978623">nextIsRBrace</span>&nbsp;<span class="op" id="5978636">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978642">p</span><span class="op" id="5978643">.</span><span class="builtinfunc" id="5978644">print</span><span class="op" id="5978649">(</span><span class="ident" id="5978650">newline</span><span class="op" id="5978657">,</span>&nbsp;<span class="ident" id="5978659">e</span><span class="op" id="5978660">.</span><span class="ident" id="5978661">Pos</span><span class="op" id="5978664">(</span><span class="op" id="5978665">)</span><span class="op" id="5978666">,</span>&nbsp;<span class="ident" id="5978668">token</span><span class="op" id="5978673">.</span><span class="ident" id="5978674">SEMICOLON</span><span class="op" id="5978683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978689">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978702">}</span>&nbsp;<span class="keyword" id="5978704">else</span>&nbsp;<span class="op" id="5978709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978714">p</span><span class="op" id="5978715">.</span><span class="ident" id="5978716">linebreak</span><span class="op" id="5978725">(</span><span class="ident" id="5978726">p</span><span class="op" id="5978727">.</span><span class="ident" id="5978728">lineFor</span><span class="op" id="5978735">(</span><span class="ident" id="5978736">s</span><span class="op" id="5978737">.</span><span class="ident" id="5978738">Stmt</span><span class="op" id="5978742">.</span><span class="ident" id="5978743">Pos</span><span class="op" id="5978746">(</span><span class="op" id="5978747">)</span><span class="op" id="5978748">)</span><span class="op" id="5978749">,</span>&nbsp;<span class="num" id="5978751">1</span><span class="op" id="5978752">,</span>&nbsp;<span class="ident" id="5978754">ignore</span><span class="op" id="5978760">,</span>&nbsp;<span class="builtintype" id="5978762">true</span><span class="op" id="5978766">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978774">p</span><span class="op" id="5978775">.</span><span class="ident" id="5978776">stmt</span><span class="op" id="5978780">(</span><span class="ident" id="5978781">s</span><span class="op" id="5978782">.</span><span class="ident" id="5978783">Stmt</span><span class="op" id="5978787">,</span>&nbsp;<span class="ident" id="5978789">nextIsRBrace</span><span class="op" id="5978801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978805">case</span>&nbsp;<span class="op" id="5978810">*</span><span class="ident" id="5978811">ast</span><span class="op" id="5978814">.</span><span class="ident" id="5978815">ExprStmt</span><span class="op" id="5978823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978827">const</span>&nbsp;<span class="ident" id="5978833">depth</span>&nbsp;<span class="op" id="5978839">=</span>&nbsp;<span class="num" id="5978841">1</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978845">p</span><span class="op" id="5978846">.</span><span class="ident" id="5978847">expr0</span><span class="op" id="5978852">(</span><span class="ident" id="5978853">s</span><span class="op" id="5978854">.</span><span class="ident" id="5978855">X</span><span class="op" id="5978856">,</span>&nbsp;<span class="ident" id="5978858">depth</span><span class="op" id="5978863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978867">case</span>&nbsp;<span class="op" id="5978872">*</span><span class="ident" id="5978873">ast</span><span class="op" id="5978876">.</span><span class="ident" id="5978877">SendStmt</span><span class="op" id="5978885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978889">const</span>&nbsp;<span class="ident" id="5978895">depth</span>&nbsp;<span class="op" id="5978901">=</span>&nbsp;<span class="num" id="5978903">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978907">p</span><span class="op" id="5978908">.</span><span class="ident" id="5978909">expr0</span><span class="op" id="5978914">(</span><span class="ident" id="5978915">s</span><span class="op" id="5978916">.</span><span class="ident" id="5978917">Chan</span><span class="op" id="5978921">,</span>&nbsp;<span class="ident" id="5978923">depth</span><span class="op" id="5978928">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978932">p</span><span class="op" id="5978933">.</span><span class="builtinfunc" id="5978934">print</span><span class="op" id="5978939">(</span><span class="ident" id="5978940">blank</span><span class="op" id="5978945">,</span>&nbsp;<span class="ident" id="5978947">s</span><span class="op" id="5978948">.</span><span class="ident" id="5978949">Arrow</span><span class="op" id="5978954">,</span>&nbsp;<span class="ident" id="5978956">token</span><span class="op" id="5978961">.</span><span class="ident" id="5978962">ARROW</span><span class="op" id="5978967">,</span>&nbsp;<span class="ident" id="5978969">blank</span><span class="op" id="5978974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978978">p</span><span class="op" id="5978979">.</span><span class="ident" id="5978980">expr0</span><span class="op" id="5978985">(</span><span class="ident" id="5978986">s</span><span class="op" id="5978987">.</span><span class="ident" id="5978988">Value</span><span class="op" id="5978993">,</span>&nbsp;<span class="ident" id="5978995">depth</span><span class="op" id="5979000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979004">case</span>&nbsp;<span class="op" id="5979009">*</span><span class="ident" id="5979010">ast</span><span class="op" id="5979013">.</span><span class="ident" id="5979014">IncDecStmt</span><span class="op" id="5979024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979028">const</span>&nbsp;<span class="ident" id="5979034">depth</span>&nbsp;<span class="op" id="5979040">=</span>&nbsp;<span class="num" id="5979042">1</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979046">p</span><span class="op" id="5979047">.</span><span class="ident" id="5979048">expr0</span><span class="op" id="5979053">(</span><span class="ident" id="5979054">s</span><span class="op" id="5979055">.</span><span class="ident" id="5979056">X</span><span class="op" id="5979057">,</span>&nbsp;<span class="ident" id="5979059">depth</span><span class="op" id="5979064">+</span><span class="num" id="5979065">1</span><span class="op" id="5979066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979070">p</span><span class="op" id="5979071">.</span><span class="builtinfunc" id="5979072">print</span><span class="op" id="5979077">(</span><span class="ident" id="5979078">s</span><span class="op" id="5979079">.</span><span class="ident" id="5979080">TokPos</span><span class="op" id="5979086">,</span>&nbsp;<span class="ident" id="5979088">s</span><span class="op" id="5979089">.</span><span class="ident" id="5979090">Tok</span><span class="op" id="5979093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979097">case</span>&nbsp;<span class="op" id="5979102">*</span><span class="ident" id="5979103">ast</span><span class="op" id="5979106">.</span><span class="ident" id="5979107">AssignStmt</span><span class="op" id="5979117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979121">var</span>&nbsp;<span class="ident" id="5979125">depth</span>&nbsp;<span class="op" id="5979131">=</span>&nbsp;<span class="num" id="5979133">1</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979137">if</span>&nbsp;<span class="builtinfunc" id="5979140">len</span><span class="op" id="5979143">(</span><span class="ident" id="5979144">s</span><span class="op" id="5979145">.</span><span class="ident" id="5979146">Lhs</span><span class="op" id="5979149">)</span>&nbsp;<span class="op" id="5979151">&gt;</span>&nbsp;<span class="num" id="5979153">1</span>&nbsp;<span class="op" id="5979155">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5979158">len</span><span class="op" id="5979161">(</span><span class="ident" id="5979162">s</span><span class="op" id="5979163">.</span><span class="ident" id="5979164">Rhs</span><span class="op" id="5979167">)</span>&nbsp;<span class="op" id="5979169">&gt;</span>&nbsp;<span class="num" id="5979171">1</span>&nbsp;<span class="op" id="5979173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979178">depth</span><span class="op" id="5979183">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979192">p</span><span class="op" id="5979193">.</span><span class="ident" id="5979194">exprList</span><span class="op" id="5979202">(</span><span class="ident" id="5979203">s</span><span class="op" id="5979204">.</span><span class="ident" id="5979205">Pos</span><span class="op" id="5979208">(</span><span class="op" id="5979209">)</span><span class="op" id="5979210">,</span>&nbsp;<span class="ident" id="5979212">s</span><span class="op" id="5979213">.</span><span class="ident" id="5979214">Lhs</span><span class="op" id="5979217">,</span>&nbsp;<span class="ident" id="5979219">depth</span><span class="op" id="5979224">,</span>&nbsp;<span class="num" id="5979226">0</span><span class="op" id="5979227">,</span>&nbsp;<span class="ident" id="5979229">s</span><span class="op" id="5979230">.</span><span class="ident" id="5979231">TokPos</span><span class="op" id="5979237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979241">p</span><span class="op" id="5979242">.</span><span class="builtinfunc" id="5979243">print</span><span class="op" id="5979248">(</span><span class="ident" id="5979249">blank</span><span class="op" id="5979254">,</span>&nbsp;<span class="ident" id="5979256">s</span><span class="op" id="5979257">.</span><span class="ident" id="5979258">TokPos</span><span class="op" id="5979264">,</span>&nbsp;<span class="ident" id="5979266">s</span><span class="op" id="5979267">.</span><span class="ident" id="5979268">Tok</span><span class="op" id="5979271">,</span>&nbsp;<span class="ident" id="5979273">blank</span><span class="op" id="5979278">)</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979282">p</span><span class="op" id="5979283">.</span><span class="ident" id="5979284">exprList</span><span class="op" id="5979292">(</span><span class="ident" id="5979293">s</span><span class="op" id="5979294">.</span><span class="ident" id="5979295">TokPos</span><span class="op" id="5979301">,</span>&nbsp;<span class="ident" id="5979303">s</span><span class="op" id="5979304">.</span><span class="ident" id="5979305">Rhs</span><span class="op" id="5979308">,</span>&nbsp;<span class="ident" id="5979310">depth</span><span class="op" id="5979315">,</span>&nbsp;<span class="num" id="5979317">0</span><span class="op" id="5979318">,</span>&nbsp;<span class="ident" id="5979320">token</span><span class="op" id="5979325">.</span><span class="ident" id="5979326">NoPos</span><span class="op" id="5979331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979335">case</span>&nbsp;<span class="op" id="5979340">*</span><span class="ident" id="5979341">ast</span><span class="op" id="5979344">.</span><span class="ident" id="5979345">GoStmt</span><span class="op" id="5979351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979355">p</span><span class="op" id="5979356">.</span><span class="builtinfunc" id="5979357">print</span><span class="op" id="5979362">(</span><span class="ident" id="5979363">token</span><span class="op" id="5979368">.</span><span class="ident" id="5979369">GO</span><span class="op" id="5979371">,</span>&nbsp;<span class="ident" id="5979373">blank</span><span class="op" id="5979378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979382">p</span><span class="op" id="5979383">.</span><span class="ident" id="5979384">expr</span><span class="op" id="5979388">(</span><span class="ident" id="5979389">s</span><span class="op" id="5979390">.</span><span class="ident" id="5979391">Call</span><span class="op" id="5979395">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979399">case</span>&nbsp;<span class="op" id="5979404">*</span><span class="ident" id="5979405">ast</span><span class="op" id="5979408">.</span><span class="ident" id="5979409">DeferStmt</span><span class="op" id="5979418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979422">p</span><span class="op" id="5979423">.</span><span class="builtinfunc" id="5979424">print</span><span class="op" id="5979429">(</span><span class="ident" id="5979430">token</span><span class="op" id="5979435">.</span><span class="ident" id="5979436">DEFER</span><span class="op" id="5979441">,</span>&nbsp;<span class="ident" id="5979443">blank</span><span class="op" id="5979448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979452">p</span><span class="op" id="5979453">.</span><span class="ident" id="5979454">expr</span><span class="op" id="5979458">(</span><span class="ident" id="5979459">s</span><span class="op" id="5979460">.</span><span class="ident" id="5979461">Call</span><span class="op" id="5979465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979469">case</span>&nbsp;<span class="op" id="5979474">*</span><span class="ident" id="5979475">ast</span><span class="op" id="5979478">.</span><span class="ident" id="5979479">ReturnStmt</span><span class="op" id="5979489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979493">p</span><span class="op" id="5979494">.</span><span class="builtinfunc" id="5979495">print</span><span class="op" id="5979500">(</span><span class="ident" id="5979501">token</span><span class="op" id="5979506">.</span><span class="ident" id="5979507">RETURN</span><span class="op" id="5979513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979517">if</span>&nbsp;<span class="ident" id="5979520">s</span><span class="op" id="5979521">.</span><span class="ident" id="5979522">Results</span>&nbsp;<span class="op" id="5979530">!=</span>&nbsp;<span class="ident" id="5979533">nil</span>&nbsp;<span class="op" id="5979537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979542">p</span><span class="op" id="5979543">.</span><span class="builtinfunc" id="5979544">print</span><span class="op" id="5979549">(</span><span class="ident" id="5979550">blank</span><span class="op" id="5979555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979560">//&nbsp;Use&nbsp;indentList&nbsp;heuristic&nbsp;to&nbsp;make&nbsp;corner&nbsp;cases&nbsp;look</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979617">//&nbsp;better&nbsp;(issue&nbsp;1207).&nbsp;A&nbsp;more&nbsp;systematic&nbsp;approach&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979677">//&nbsp;always&nbsp;indent,&nbsp;but&nbsp;this&nbsp;would&nbsp;cause&nbsp;significant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979731">//&nbsp;reformatting&nbsp;of&nbsp;the&nbsp;code&nbsp;base&nbsp;and&nbsp;not&nbsp;necessarily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979787">//&nbsp;lead&nbsp;to&nbsp;more&nbsp;nicely&nbsp;formatted&nbsp;code&nbsp;in&nbsp;general.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979840">if</span>&nbsp;<span class="ident" id="5979843">p</span><span class="op" id="5979844">.</span><span class="ident" id="5979845">indentList</span><span class="op" id="5979855">(</span><span class="ident" id="5979856">s</span><span class="op" id="5979857">.</span><span class="ident" id="5979858">Results</span><span class="op" id="5979865">)</span>&nbsp;<span class="op" id="5979867">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979873">p</span><span class="op" id="5979874">.</span><span class="builtinfunc" id="5979875">print</span><span class="op" id="5979880">(</span><span class="ident" id="5979881">indent</span><span class="op" id="5979887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979893">p</span><span class="op" id="5979894">.</span><span class="ident" id="5979895">exprList</span><span class="op" id="5979903">(</span><span class="ident" id="5979904">s</span><span class="op" id="5979905">.</span><span class="ident" id="5979906">Pos</span><span class="op" id="5979909">(</span><span class="op" id="5979910">)</span><span class="op" id="5979911">,</span>&nbsp;<span class="ident" id="5979913">s</span><span class="op" id="5979914">.</span><span class="ident" id="5979915">Results</span><span class="op" id="5979922">,</span>&nbsp;<span class="num" id="5979924">1</span><span class="op" id="5979925">,</span>&nbsp;<span class="ident" id="5979927">noIndent</span><span class="op" id="5979935">,</span>&nbsp;<span class="ident" id="5979937">token</span><span class="op" id="5979942">.</span><span class="ident" id="5979943">NoPos</span><span class="op" id="5979948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979954">p</span><span class="op" id="5979955">.</span><span class="builtinfunc" id="5979956">print</span><span class="op" id="5979961">(</span><span class="ident" id="5979962">unindent</span><span class="op" id="5979970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979975">}</span>&nbsp;<span class="keyword" id="5979977">else</span>&nbsp;<span class="op" id="5979982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979988">p</span><span class="op" id="5979989">.</span><span class="ident" id="5979990">exprList</span><span class="op" id="5979998">(</span><span class="ident" id="5979999">s</span><span class="op" id="5980000">.</span><span class="ident" id="5980001">Pos</span><span class="op" id="5980004">(</span><span class="op" id="5980005">)</span><span class="op" id="5980006">,</span>&nbsp;<span class="ident" id="5980008">s</span><span class="op" id="5980009">.</span><span class="ident" id="5980010">Results</span><span class="op" id="5980017">,</span>&nbsp;<span class="num" id="5980019">1</span><span class="op" id="5980020">,</span>&nbsp;<span class="num" id="5980022">0</span><span class="op" id="5980023">,</span>&nbsp;<span class="ident" id="5980025">token</span><span class="op" id="5980030">.</span><span class="ident" id="5980031">NoPos</span><span class="op" id="5980036">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980049">case</span>&nbsp;<span class="op" id="5980054">*</span><span class="ident" id="5980055">ast</span><span class="op" id="5980058">.</span><span class="ident" id="5980059">BranchStmt</span><span class="op" id="5980069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980073">p</span><span class="op" id="5980074">.</span><span class="builtinfunc" id="5980075">print</span><span class="op" id="5980080">(</span><span class="ident" id="5980081">s</span><span class="op" id="5980082">.</span><span class="ident" id="5980083">Tok</span><span class="op" id="5980086">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980090">if</span>&nbsp;<span class="ident" id="5980093">s</span><span class="op" id="5980094">.</span><span class="ident" id="5980095">Label</span>&nbsp;<span class="op" id="5980101">!=</span>&nbsp;<span class="ident" id="5980104">nil</span>&nbsp;<span class="op" id="5980108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980113">p</span><span class="op" id="5980114">.</span><span class="builtinfunc" id="5980115">print</span><span class="op" id="5980120">(</span><span class="ident" id="5980121">blank</span><span class="op" id="5980126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980131">p</span><span class="op" id="5980132">.</span><span class="ident" id="5980133">expr</span><span class="op" id="5980137">(</span><span class="ident" id="5980138">s</span><span class="op" id="5980139">.</span><span class="ident" id="5980140">Label</span><span class="op" id="5980145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980153">case</span>&nbsp;<span class="op" id="5980158">*</span><span class="ident" id="5980159">ast</span><span class="op" id="5980162">.</span><span class="ident" id="5980163">BlockStmt</span><span class="op" id="5980172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980176">p</span><span class="op" id="5980177">.</span><span class="ident" id="5980178">block</span><span class="op" id="5980183">(</span><span class="ident" id="5980184">s</span><span class="op" id="5980185">,</span>&nbsp;<span class="num" id="5980187">1</span><span class="op" id="5980188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980192">case</span>&nbsp;<span class="op" id="5980197">*</span><span class="ident" id="5980198">ast</span><span class="op" id="5980201">.</span><span class="ident" id="5980202">IfStmt</span><span class="op" id="5980208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980212">p</span><span class="op" id="5980213">.</span><span class="builtinfunc" id="5980214">print</span><span class="op" id="5980219">(</span><span class="ident" id="5980220">token</span><span class="op" id="5980225">.</span><span class="ident" id="5980226">IF</span><span class="op" id="5980228">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980232">p</span><span class="op" id="5980233">.</span><span class="ident" id="5980234">controlClause</span><span class="op" id="5980247">(</span><span class="builtintype" id="5980248">false</span><span class="op" id="5980253">,</span>&nbsp;<span class="ident" id="5980255">s</span><span class="op" id="5980256">.</span><span class="ident" id="5980257">Init</span><span class="op" id="5980261">,</span>&nbsp;<span class="ident" id="5980263">s</span><span class="op" id="5980264">.</span><span class="ident" id="5980265">Cond</span><span class="op" id="5980269">,</span>&nbsp;<span class="ident" id="5980271">nil</span><span class="op" id="5980274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980278">p</span><span class="op" id="5980279">.</span><span class="ident" id="5980280">block</span><span class="op" id="5980285">(</span><span class="ident" id="5980286">s</span><span class="op" id="5980287">.</span><span class="ident" id="5980288">Body</span><span class="op" id="5980292">,</span>&nbsp;<span class="num" id="5980294">1</span><span class="op" id="5980295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980299">if</span>&nbsp;<span class="ident" id="5980302">s</span><span class="op" id="5980303">.</span><span class="ident" id="5980304">Else</span>&nbsp;<span class="op" id="5980309">!=</span>&nbsp;<span class="ident" id="5980312">nil</span>&nbsp;<span class="op" id="5980316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980321">p</span><span class="op" id="5980322">.</span><span class="builtinfunc" id="5980323">print</span><span class="op" id="5980328">(</span><span class="ident" id="5980329">blank</span><span class="op" id="5980334">,</span>&nbsp;<span class="ident" id="5980336">token</span><span class="op" id="5980341">.</span><span class="ident" id="5980342">ELSE</span><span class="op" id="5980346">,</span>&nbsp;<span class="ident" id="5980348">blank</span><span class="op" id="5980353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980358">switch</span>&nbsp;<span class="ident" id="5980365">s</span><span class="op" id="5980366">.</span><span class="ident" id="5980367">Else</span><span class="op" id="5980371">.</span><span class="op" id="5980372">(</span><span class="keyword" id="5980373">type</span><span class="op" id="5980377">)</span>&nbsp;<span class="op" id="5980379">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980384">case</span>&nbsp;<span class="op" id="5980389">*</span><span class="ident" id="5980390">ast</span><span class="op" id="5980393">.</span><span class="ident" id="5980394">BlockStmt</span><span class="op" id="5980403">,</span>&nbsp;<span class="op" id="5980405">*</span><span class="ident" id="5980406">ast</span><span class="op" id="5980409">.</span><span class="ident" id="5980410">IfStmt</span><span class="op" id="5980416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980422">p</span><span class="op" id="5980423">.</span><span class="ident" id="5980424">stmt</span><span class="op" id="5980428">(</span><span class="ident" id="5980429">s</span><span class="op" id="5980430">.</span><span class="ident" id="5980431">Else</span><span class="op" id="5980435">,</span>&nbsp;<span class="ident" id="5980437">nextIsRBrace</span><span class="op" id="5980449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980454">default</span><span class="op" id="5980461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980467">p</span><span class="op" id="5980468">.</span><span class="builtinfunc" id="5980469">print</span><span class="op" id="5980474">(</span><span class="ident" id="5980475">token</span><span class="op" id="5980480">.</span><span class="ident" id="5980481">LBRACE</span><span class="op" id="5980487">,</span>&nbsp;<span class="ident" id="5980489">indent</span><span class="op" id="5980495">,</span>&nbsp;<span class="ident" id="5980497">formfeed</span><span class="op" id="5980505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980511">p</span><span class="op" id="5980512">.</span><span class="ident" id="5980513">stmt</span><span class="op" id="5980517">(</span><span class="ident" id="5980518">s</span><span class="op" id="5980519">.</span><span class="ident" id="5980520">Else</span><span class="op" id="5980524">,</span>&nbsp;<span class="builtintype" id="5980526">true</span><span class="op" id="5980530">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980536">p</span><span class="op" id="5980537">.</span><span class="builtinfunc" id="5980538">print</span><span class="op" id="5980543">(</span><span class="ident" id="5980544">unindent</span><span class="op" id="5980552">,</span>&nbsp;<span class="ident" id="5980554">formfeed</span><span class="op" id="5980562">,</span>&nbsp;<span class="ident" id="5980564">token</span><span class="op" id="5980569">.</span><span class="ident" id="5980570">RBRACE</span><span class="op" id="5980576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980589">case</span>&nbsp;<span class="op" id="5980594">*</span><span class="ident" id="5980595">ast</span><span class="op" id="5980598">.</span><span class="ident" id="5980599">CaseClause</span><span class="op" id="5980609">:</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980613">if</span>&nbsp;<span class="ident" id="5980616">s</span><span class="op" id="5980617">.</span><span class="ident" id="5980618">List</span>&nbsp;<span class="op" id="5980623">!=</span>&nbsp;<span class="ident" id="5980626">nil</span>&nbsp;<span class="op" id="5980630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980635">p</span><span class="op" id="5980636">.</span><span class="builtinfunc" id="5980637">print</span><span class="op" id="5980642">(</span><span class="ident" id="5980643">token</span><span class="op" id="5980648">.</span><span class="ident" id="5980649">CASE</span><span class="op" id="5980653">,</span>&nbsp;<span class="ident" id="5980655">blank</span><span class="op" id="5980660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980665">p</span><span class="op" id="5980666">.</span><span class="ident" id="5980667">exprList</span><span class="op" id="5980675">(</span><span class="ident" id="5980676">s</span><span class="op" id="5980677">.</span><span class="ident" id="5980678">Pos</span><span class="op" id="5980681">(</span><span class="op" id="5980682">)</span><span class="op" id="5980683">,</span>&nbsp;<span class="ident" id="5980685">s</span><span class="op" id="5980686">.</span><span class="ident" id="5980687">List</span><span class="op" id="5980691">,</span>&nbsp;<span class="num" id="5980693">1</span><span class="op" id="5980694">,</span>&nbsp;<span class="num" id="5980696">0</span><span class="op" id="5980697">,</span>&nbsp;<span class="ident" id="5980699">s</span><span class="op" id="5980700">.</span><span class="ident" id="5980701">Colon</span><span class="op" id="5980706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980710">}</span>&nbsp;<span class="keyword" id="5980712">else</span>&nbsp;<span class="op" id="5980717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980722">p</span><span class="op" id="5980723">.</span><span class="builtinfunc" id="5980724">print</span><span class="op" id="5980729">(</span><span class="ident" id="5980730">token</span><span class="op" id="5980735">.</span><span class="ident" id="5980736">DEFAULT</span><span class="op" id="5980743">)</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980751">p</span><span class="op" id="5980752">.</span><span class="builtinfunc" id="5980753">print</span><span class="op" id="5980758">(</span><span class="ident" id="5980759">s</span><span class="op" id="5980760">.</span><span class="ident" id="5980761">Colon</span><span class="op" id="5980766">,</span>&nbsp;<span class="ident" id="5980768">token</span><span class="op" id="5980773">.</span><span class="ident" id="5980774">COLON</span><span class="op" id="5980779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980783">p</span><span class="op" id="5980784">.</span><span class="ident" id="5980785">stmtList</span><span class="op" id="5980793">(</span><span class="ident" id="5980794">s</span><span class="op" id="5980795">.</span><span class="ident" id="5980796">Body</span><span class="op" id="5980800">,</span>&nbsp;<span class="num" id="5980802">1</span><span class="op" id="5980803">,</span>&nbsp;<span class="ident" id="5980805">nextIsRBrace</span><span class="op" id="5980817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980821">case</span>&nbsp;<span class="op" id="5980826">*</span><span class="ident" id="5980827">ast</span><span class="op" id="5980830">.</span><span class="ident" id="5980831">SwitchStmt</span><span class="op" id="5980841">:</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980845">p</span><span class="op" id="5980846">.</span><span class="builtinfunc" id="5980847">print</span><span class="op" id="5980852">(</span><span class="ident" id="5980853">token</span><span class="op" id="5980858">.</span><span class="ident" id="5980859">SWITCH</span><span class="op" id="5980865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980869">p</span><span class="op" id="5980870">.</span><span class="ident" id="5980871">controlClause</span><span class="op" id="5980884">(</span><span class="builtintype" id="5980885">false</span><span class="op" id="5980890">,</span>&nbsp;<span class="ident" id="5980892">s</span><span class="op" id="5980893">.</span><span class="ident" id="5980894">Init</span><span class="op" id="5980898">,</span>&nbsp;<span class="ident" id="5980900">s</span><span class="op" id="5980901">.</span><span class="ident" id="5980902">Tag</span><span class="op" id="5980905">,</span>&nbsp;<span class="ident" id="5980907">nil</span><span class="op" id="5980910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980914">p</span><span class="op" id="5980915">.</span><span class="ident" id="5980916">block</span><span class="op" id="5980921">(</span><span class="ident" id="5980922">s</span><span class="op" id="5980923">.</span><span class="ident" id="5980924">Body</span><span class="op" id="5980928">,</span>&nbsp;<span class="num" id="5980930">0</span><span class="op" id="5980931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980935">case</span>&nbsp;<span class="op" id="5980940">*</span><span class="ident" id="5980941">ast</span><span class="op" id="5980944">.</span><span class="ident" id="5980945">TypeSwitchStmt</span><span class="op" id="5980959">:</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980963">p</span><span class="op" id="5980964">.</span><span class="builtinfunc" id="5980965">print</span><span class="op" id="5980970">(</span><span class="ident" id="5980971">token</span><span class="op" id="5980976">.</span><span class="ident" id="5980977">SWITCH</span><span class="op" id="5980983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980987">if</span>&nbsp;<span class="ident" id="5980990">s</span><span class="op" id="5980991">.</span><span class="ident" id="5980992">Init</span>&nbsp;<span class="op" id="5980997">!=</span>&nbsp;<span class="ident" id="5981000">nil</span>&nbsp;<span class="op" id="5981004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981009">p</span><span class="op" id="5981010">.</span><span class="builtinfunc" id="5981011">print</span><span class="op" id="5981016">(</span><span class="ident" id="5981017">blank</span><span class="op" id="5981022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981027">p</span><span class="op" id="5981028">.</span><span class="ident" id="5981029">stmt</span><span class="op" id="5981033">(</span><span class="ident" id="5981034">s</span><span class="op" id="5981035">.</span><span class="ident" id="5981036">Init</span><span class="op" id="5981040">,</span>&nbsp;<span class="builtintype" id="5981042">false</span><span class="op" id="5981047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981052">p</span><span class="op" id="5981053">.</span><span class="builtinfunc" id="5981054">print</span><span class="op" id="5981059">(</span><span class="ident" id="5981060">token</span><span class="op" id="5981065">.</span><span class="ident" id="5981066">SEMICOLON</span><span class="op" id="5981075">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981083">p</span><span class="op" id="5981084">.</span><span class="builtinfunc" id="5981085">print</span><span class="op" id="5981090">(</span><span class="ident" id="5981091">blank</span><span class="op" id="5981096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981100">p</span><span class="op" id="5981101">.</span><span class="ident" id="5981102">stmt</span><span class="op" id="5981106">(</span><span class="ident" id="5981107">s</span><span class="op" id="5981108">.</span><span class="ident" id="5981109">Assign</span><span class="op" id="5981115">,</span>&nbsp;<span class="builtintype" id="5981117">false</span><span class="op" id="5981122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981126">p</span><span class="op" id="5981127">.</span><span class="builtinfunc" id="5981128">print</span><span class="op" id="5981133">(</span><span class="ident" id="5981134">blank</span><span class="op" id="5981139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981143">p</span><span class="op" id="5981144">.</span><span class="ident" id="5981145">block</span><span class="op" id="5981150">(</span><span class="ident" id="5981151">s</span><span class="op" id="5981152">.</span><span class="ident" id="5981153">Body</span><span class="op" id="5981157">,</span>&nbsp;<span class="num" id="5981159">0</span><span class="op" id="5981160">)</span><br>
<span class="lineno">1195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981164">case</span>&nbsp;<span class="op" id="5981169">*</span><span class="ident" id="5981170">ast</span><span class="op" id="5981173">.</span><span class="ident" id="5981174">CommClause</span><span class="op" id="5981184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981188">if</span>&nbsp;<span class="ident" id="5981191">s</span><span class="op" id="5981192">.</span><span class="ident" id="5981193">Comm</span>&nbsp;<span class="op" id="5981198">!=</span>&nbsp;<span class="ident" id="5981201">nil</span>&nbsp;<span class="op" id="5981205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981210">p</span><span class="op" id="5981211">.</span><span class="builtinfunc" id="5981212">print</span><span class="op" id="5981217">(</span><span class="ident" id="5981218">token</span><span class="op" id="5981223">.</span><span class="ident" id="5981224">CASE</span><span class="op" id="5981228">,</span>&nbsp;<span class="ident" id="5981230">blank</span><span class="op" id="5981235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981240">p</span><span class="op" id="5981241">.</span><span class="ident" id="5981242">stmt</span><span class="op" id="5981246">(</span><span class="ident" id="5981247">s</span><span class="op" id="5981248">.</span><span class="ident" id="5981249">Comm</span><span class="op" id="5981253">,</span>&nbsp;<span class="builtintype" id="5981255">false</span><span class="op" id="5981260">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981264">}</span>&nbsp;<span class="keyword" id="5981266">else</span>&nbsp;<span class="op" id="5981271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981276">p</span><span class="op" id="5981277">.</span><span class="builtinfunc" id="5981278">print</span><span class="op" id="5981283">(</span><span class="ident" id="5981284">token</span><span class="op" id="5981289">.</span><span class="ident" id="5981290">DEFAULT</span><span class="op" id="5981297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981305">p</span><span class="op" id="5981306">.</span><span class="builtinfunc" id="5981307">print</span><span class="op" id="5981312">(</span><span class="ident" id="5981313">s</span><span class="op" id="5981314">.</span><span class="ident" id="5981315">Colon</span><span class="op" id="5981320">,</span>&nbsp;<span class="ident" id="5981322">token</span><span class="op" id="5981327">.</span><span class="ident" id="5981328">COLON</span><span class="op" id="5981333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981337">p</span><span class="op" id="5981338">.</span><span class="ident" id="5981339">stmtList</span><span class="op" id="5981347">(</span><span class="ident" id="5981348">s</span><span class="op" id="5981349">.</span><span class="ident" id="5981350">Body</span><span class="op" id="5981354">,</span>&nbsp;<span class="num" id="5981356">1</span><span class="op" id="5981357">,</span>&nbsp;<span class="ident" id="5981359">nextIsRBrace</span><span class="op" id="5981371">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981375">case</span>&nbsp;<span class="op" id="5981380">*</span><span class="ident" id="5981381">ast</span><span class="op" id="5981384">.</span><span class="ident" id="5981385">SelectStmt</span><span class="op" id="5981395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981399">p</span><span class="op" id="5981400">.</span><span class="builtinfunc" id="5981401">print</span><span class="op" id="5981406">(</span><span class="ident" id="5981407">token</span><span class="op" id="5981412">.</span><span class="ident" id="5981413">SELECT</span><span class="op" id="5981419">,</span>&nbsp;<span class="ident" id="5981421">blank</span><span class="op" id="5981426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981430">body</span>&nbsp;<span class="op" id="5981435">:=</span>&nbsp;<span class="ident" id="5981438">s</span><span class="op" id="5981439">.</span><span class="ident" id="5981440">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981447">if</span>&nbsp;<span class="builtinfunc" id="5981450">len</span><span class="op" id="5981453">(</span><span class="ident" id="5981454">body</span><span class="op" id="5981458">.</span><span class="ident" id="5981459">List</span><span class="op" id="5981463">)</span>&nbsp;<span class="op" id="5981465">==</span>&nbsp;<span class="num" id="5981468">0</span>&nbsp;<span class="op" id="5981470">&amp;&amp;</span>&nbsp;<span class="op" id="5981473">!</span><span class="ident" id="5981474">p</span><span class="op" id="5981475">.</span><span class="ident" id="5981476">commentBefore</span><span class="op" id="5981489">(</span><span class="ident" id="5981490">p</span><span class="op" id="5981491">.</span><span class="ident" id="5981492">posFor</span><span class="op" id="5981498">(</span><span class="ident" id="5981499">body</span><span class="op" id="5981503">.</span><span class="ident" id="5981504">Rbrace</span><span class="op" id="5981510">)</span><span class="op" id="5981511">)</span>&nbsp;<span class="op" id="5981513">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981518">//&nbsp;print&nbsp;empty&nbsp;select&nbsp;statement&nbsp;w/o&nbsp;comments&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981578">p</span><span class="op" id="5981579">.</span><span class="builtinfunc" id="5981580">print</span><span class="op" id="5981585">(</span><span class="ident" id="5981586">body</span><span class="op" id="5981590">.</span><span class="ident" id="5981591">Lbrace</span><span class="op" id="5981597">,</span>&nbsp;<span class="ident" id="5981599">token</span><span class="op" id="5981604">.</span><span class="ident" id="5981605">LBRACE</span><span class="op" id="5981611">,</span>&nbsp;<span class="ident" id="5981613">body</span><span class="op" id="5981617">.</span><span class="ident" id="5981618">Rbrace</span><span class="op" id="5981624">,</span>&nbsp;<span class="ident" id="5981626">token</span><span class="op" id="5981631">.</span><span class="ident" id="5981632">RBRACE</span><span class="op" id="5981638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981642">}</span>&nbsp;<span class="keyword" id="5981644">else</span>&nbsp;<span class="op" id="5981649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981654">p</span><span class="op" id="5981655">.</span><span class="ident" id="5981656">block</span><span class="op" id="5981661">(</span><span class="ident" id="5981662">body</span><span class="op" id="5981666">,</span>&nbsp;<span class="num" id="5981668">0</span><span class="op" id="5981669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981673">}</span><br>
<span class="lineno">1215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981677">case</span>&nbsp;<span class="op" id="5981682">*</span><span class="ident" id="5981683">ast</span><span class="op" id="5981686">.</span><span class="ident" id="5981687">ForStmt</span><span class="op" id="5981694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981698">p</span><span class="op" id="5981699">.</span><span class="builtinfunc" id="5981700">print</span><span class="op" id="5981705">(</span><span class="ident" id="5981706">token</span><span class="op" id="5981711">.</span><span class="ident" id="5981712">FOR</span><span class="op" id="5981715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981719">p</span><span class="op" id="5981720">.</span><span class="ident" id="5981721">controlClause</span><span class="op" id="5981734">(</span><span class="builtintype" id="5981735">true</span><span class="op" id="5981739">,</span>&nbsp;<span class="ident" id="5981741">s</span><span class="op" id="5981742">.</span><span class="ident" id="5981743">Init</span><span class="op" id="5981747">,</span>&nbsp;<span class="ident" id="5981749">s</span><span class="op" id="5981750">.</span><span class="ident" id="5981751">Cond</span><span class="op" id="5981755">,</span>&nbsp;<span class="ident" id="5981757">s</span><span class="op" id="5981758">.</span><span class="ident" id="5981759">Post</span><span class="op" id="5981763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981767">p</span><span class="op" id="5981768">.</span><span class="ident" id="5981769">block</span><span class="op" id="5981774">(</span><span class="ident" id="5981775">s</span><span class="op" id="5981776">.</span><span class="ident" id="5981777">Body</span><span class="op" id="5981781">,</span>&nbsp;<span class="num" id="5981783">1</span><span class="op" id="5981784">)</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981788">case</span>&nbsp;<span class="op" id="5981793">*</span><span class="ident" id="5981794">ast</span><span class="op" id="5981797">.</span><span class="ident" id="5981798">RangeStmt</span><span class="op" id="5981807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981811">p</span><span class="op" id="5981812">.</span><span class="builtinfunc" id="5981813">print</span><span class="op" id="5981818">(</span><span class="ident" id="5981819">token</span><span class="op" id="5981824">.</span><span class="ident" id="5981825">FOR</span><span class="op" id="5981828">,</span>&nbsp;<span class="ident" id="5981830">blank</span><span class="op" id="5981835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981839">if</span>&nbsp;<span class="ident" id="5981842">s</span><span class="op" id="5981843">.</span><span class="ident" id="5981844">Key</span>&nbsp;<span class="op" id="5981848">!=</span>&nbsp;<span class="ident" id="5981851">nil</span>&nbsp;<span class="op" id="5981855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981860">p</span><span class="op" id="5981861">.</span><span class="ident" id="5981862">expr</span><span class="op" id="5981866">(</span><span class="ident" id="5981867">s</span><span class="op" id="5981868">.</span><span class="ident" id="5981869">Key</span><span class="op" id="5981872">)</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981877">if</span>&nbsp;<span class="ident" id="5981880">s</span><span class="op" id="5981881">.</span><span class="ident" id="5981882">Value</span>&nbsp;<span class="op" id="5981888">!=</span>&nbsp;<span class="ident" id="5981891">nil</span>&nbsp;<span class="op" id="5981895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981901">//&nbsp;use&nbsp;position&nbsp;of&nbsp;value&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981953">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982005">p</span><span class="op" id="5982006">.</span><span class="builtinfunc" id="5982007">print</span><span class="op" id="5982012">(</span><span class="ident" id="5982013">s</span><span class="op" id="5982014">.</span><span class="ident" id="5982015">Value</span><span class="op" id="5982020">.</span><span class="ident" id="5982021">Pos</span><span class="op" id="5982024">(</span><span class="op" id="5982025">)</span><span class="op" id="5982026">,</span>&nbsp;<span class="ident" id="5982028">token</span><span class="op" id="5982033">.</span><span class="ident" id="5982034">COMMA</span><span class="op" id="5982039">,</span>&nbsp;<span class="ident" id="5982041">blank</span><span class="op" id="5982046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982052">p</span><span class="op" id="5982053">.</span><span class="ident" id="5982054">expr</span><span class="op" id="5982058">(</span><span class="ident" id="5982059">s</span><span class="op" id="5982060">.</span><span class="ident" id="5982061">Value</span><span class="op" id="5982066">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982076">p</span><span class="op" id="5982077">.</span><span class="builtinfunc" id="5982078">print</span><span class="op" id="5982083">(</span><span class="ident" id="5982084">blank</span><span class="op" id="5982089">,</span>&nbsp;<span class="ident" id="5982091">s</span><span class="op" id="5982092">.</span><span class="ident" id="5982093">TokPos</span><span class="op" id="5982099">,</span>&nbsp;<span class="ident" id="5982101">s</span><span class="op" id="5982102">.</span><span class="ident" id="5982103">Tok</span><span class="op" id="5982106">,</span>&nbsp;<span class="ident" id="5982108">blank</span><span class="op" id="5982113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982121">p</span><span class="op" id="5982122">.</span><span class="builtinfunc" id="5982123">print</span><span class="op" id="5982128">(</span><span class="ident" id="5982129">token</span><span class="op" id="5982134">.</span><span class="ident" id="5982135">RANGE</span><span class="op" id="5982140">,</span>&nbsp;<span class="ident" id="5982142">blank</span><span class="op" id="5982147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982151">p</span><span class="op" id="5982152">.</span><span class="ident" id="5982153">expr</span><span class="op" id="5982157">(</span><span class="ident" id="5982158">stripParens</span><span class="op" id="5982169">(</span><span class="ident" id="5982170">s</span><span class="op" id="5982171">.</span><span class="ident" id="5982172">X</span><span class="op" id="5982173">)</span><span class="op" id="5982174">)</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982178">p</span><span class="op" id="5982179">.</span><span class="builtinfunc" id="5982180">print</span><span class="op" id="5982185">(</span><span class="ident" id="5982186">blank</span><span class="op" id="5982191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982195">p</span><span class="op" id="5982196">.</span><span class="ident" id="5982197">block</span><span class="op" id="5982202">(</span><span class="ident" id="5982203">s</span><span class="op" id="5982204">.</span><span class="ident" id="5982205">Body</span><span class="op" id="5982209">,</span>&nbsp;<span class="num" id="5982211">1</span><span class="op" id="5982212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982216">default</span><span class="op" id="5982223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5982227">panic</span><span class="op" id="5982232">(</span><span class="string" id="5982233">&#34;unreachable&#34;</span><span class="op" id="5982246">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982253">return</span><br>
<span class="lineno"></span><span class="op" id="5982260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1245</span><span class="comment" id="5982263">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5982343">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982360">//&nbsp;The&nbsp;keepTypeColumn&nbsp;function&nbsp;determines&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;of&nbsp;a&nbsp;series&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5982436">//&nbsp;consecutive&nbsp;const&nbsp;or&nbsp;var&nbsp;declarations&nbsp;must&nbsp;be&nbsp;kept,&nbsp;or&nbsp;if&nbsp;initialization</span><br>
<span class="lineno">1250</span><span class="comment" id="5982512">//&nbsp;values&nbsp;(V)&nbsp;can&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;type&nbsp;column&nbsp;(T)&nbsp;instead.&nbsp;The&nbsp;i&#39;th&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5982587">//&nbsp;in&nbsp;the&nbsp;result&nbsp;slice&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;in&nbsp;spec[i]&nbsp;must&nbsp;be&nbsp;kept.</span><br>
<span class="lineno"></span><span class="comment" id="5982662">//</span><br>
<span class="lineno"></span><span class="comment" id="5982665">//&nbsp;For&nbsp;example,&nbsp;the&nbsp;declaration:</span><br>
<span class="lineno"></span><span class="comment" id="5982698">//</span><br>
<span class="lineno">1255</span><span class="comment" id="5982701">//&nbsp;&nbsp;&nbsp;&nbspconst&nbsp;(</span><br>
<span class="lineno"></span><span class="comment" id="5982712">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfoobar&nbsp;int&nbsp;=&nbsp;42&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5982743">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7&nbsp;&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5982774">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfoo</span><br>
<span class="lineno"></span><span class="comment" id="5982782">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;991</span><br>
<span class="lineno">1260</span><span class="comment" id="5982808">//&nbsp;&nbsp;&nbsp;&nbsp)</span><br>
<span class="lineno"></span><span class="comment" id="5982813">//</span><br>
<span class="lineno"></span><span class="comment" id="5982816">//&nbsp;leads&nbsp;to&nbsp;the&nbsp;type/values&nbsp;matrix&nbsp;below.&nbsp;A&nbsp;run&nbsp;of&nbsp;value&nbsp;columns&nbsp;(V)&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5982889">//&nbsp;be&nbsp;moved&nbsp;into&nbsp;the&nbsp;type&nbsp;column&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;type&nbsp;for&nbsp;any&nbsp;of&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5982964">//&nbsp;in&nbsp;that&nbsp;column&nbsp;(we&nbsp;only&nbsp;move&nbsp;entire&nbsp;columns&nbsp;so&nbsp;that&nbsp;they&nbsp;align&nbsp;properly).</span><br>
<span class="lineno">1265</span><span class="comment" id="5983041">//</span><br>
<span class="lineno"></span><span class="comment" id="5983044">//&nbsp;&nbsp;&nbsp;&nbspmatrix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatted&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="5983082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix</span><br>
<span class="lineno"></span><span class="comment" id="5983111">//&nbsp;&nbsp;&nbsp;&nbspT&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;a&nbsp;T&nbsp;and&nbsp;so&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5983181">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno">1270</span><span class="comment" id="5983242">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="5983279">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;is&nbsp;moved&nbsp;into&nbsp;T&nbsp;column</span><br>
<span class="lineno"></span><span class="comment" id="5983345">//</span><br>
<span class="lineno"></span><span class="keyword" id="5983348">func</span>&nbsp;<span class="ident" id="5983353">keepTypeColumn</span><span class="op" id="5983367">(</span><span class="ident" id="5983368">specs</span>&nbsp;<span class="op" id="5983374">[</span><span class="op" id="5983375">]</span><span class="ident" id="5983376">ast</span><span class="op" id="5983379">.</span><span class="ident" id="5983380">Spec</span><span class="op" id="5983384">)</span>&nbsp;<span class="op" id="5983386">[</span><span class="op" id="5983387">]</span><span class="builtintype" id="5983388">bool</span>&nbsp;<span class="op" id="5983393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983396">m</span>&nbsp;<span class="op" id="5983398">:=</span>&nbsp;<span class="builtinfunc" id="5983401">make</span><span class="op" id="5983405">(</span><span class="op" id="5983406">[</span><span class="op" id="5983407">]</span><span class="builtintype" id="5983408">bool</span><span class="op" id="5983412">,</span>&nbsp;<span class="builtinfunc" id="5983414">len</span><span class="op" id="5983417">(</span><span class="ident" id="5983418">specs</span><span class="op" id="5983423">)</span><span class="op" id="5983424">)</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983428">populate</span>&nbsp;<span class="op" id="5983437">:=</span>&nbsp;<span class="keyword" id="5983440">func</span><span class="op" id="5983444">(</span><span class="ident" id="5983445">i</span><span class="op" id="5983446">,</span>&nbsp;<span class="ident" id="5983448">j</span>&nbsp;<span class="builtintype" id="5983450">int</span><span class="op" id="5983453">,</span>&nbsp;<span class="ident" id="5983455">keepType</span>&nbsp;<span class="builtintype" id="5983464">bool</span><span class="op" id="5983468">)</span>&nbsp;<span class="op" id="5983470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983474">if</span>&nbsp;<span class="ident" id="5983477">keepType</span>&nbsp;<span class="op" id="5983486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983491">for</span>&nbsp;<span class="op" id="5983495">;</span>&nbsp;<span class="ident" id="5983497">i</span>&nbsp;<span class="op" id="5983499">&lt;</span>&nbsp;<span class="ident" id="5983501">j</span><span class="op" id="5983502">;</span>&nbsp;<span class="ident" id="5983504">i</span><span class="op" id="5983505">++</span>&nbsp;<span class="op" id="5983508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983514">m</span><span class="op" id="5983515">[</span><span class="ident" id="5983516">i</span><span class="op" id="5983517">]</span>&nbsp;<span class="op" id="5983519">=</span>&nbsp;<span class="builtintype" id="5983521">true</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983540">i0</span>&nbsp;<span class="op" id="5983543">:=</span>&nbsp;<span class="op" id="5983546">-</span><span class="num" id="5983547">1</span>&nbsp;<span class="comment" id="5983549">//&nbsp;if&nbsp;i0&nbsp;&gt;=&nbsp;0&nbsp;we&nbsp;are&nbsp;in&nbsp;a&nbsp;run&nbsp;and&nbsp;i0&nbsp;is&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;run</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983611">var</span>&nbsp;<span class="ident" id="5983615">keepType</span>&nbsp;<span class="builtintype" id="5983624">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983630">for</span>&nbsp;<span class="ident" id="5983634">i</span><span class="op" id="5983635">,</span>&nbsp;<span class="ident" id="5983637">s</span>&nbsp;<span class="op" id="5983639">:=</span>&nbsp;<span class="keyword" id="5983642">range</span>&nbsp;<span class="ident" id="5983648">specs</span>&nbsp;<span class="op" id="5983654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983658">t</span>&nbsp;<span class="op" id="5983660">:=</span>&nbsp;<span class="ident" id="5983663">s</span><span class="op" id="5983664">.</span><span class="op" id="5983665">(</span><span class="op" id="5983666">*</span><span class="ident" id="5983667">ast</span><span class="op" id="5983670">.</span><span class="ident" id="5983671">ValueSpec</span><span class="op" id="5983680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983684">if</span>&nbsp;<span class="ident" id="5983687">t</span><span class="op" id="5983688">.</span><span class="ident" id="5983689">Values</span>&nbsp;<span class="op" id="5983696">!=</span>&nbsp;<span class="ident" id="5983699">nil</span>&nbsp;<span class="op" id="5983703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983708">if</span>&nbsp;<span class="ident" id="5983711">i0</span>&nbsp;<span class="op" id="5983714">&lt;</span>&nbsp;<span class="num" id="5983716">0</span>&nbsp;<span class="op" id="5983718">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983724">//&nbsp;start&nbsp;of&nbsp;a&nbsp;run&nbsp;of&nbsp;ValueSpecs&nbsp;with&nbsp;non-nil&nbsp;Values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983780">i0</span>&nbsp;<span class="op" id="5983783">=</span>&nbsp;<span class="ident" id="5983785">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983791">keepType</span>&nbsp;<span class="op" id="5983800">=</span>&nbsp;<span class="builtintype" id="5983802">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983815">}</span>&nbsp;<span class="keyword" id="5983817">else</span>&nbsp;<span class="op" id="5983822">{</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983827">if</span>&nbsp;<span class="ident" id="5983830">i0</span>&nbsp;<span class="op" id="5983833">&gt;=</span>&nbsp;<span class="num" id="5983836">0</span>&nbsp;<span class="op" id="5983838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983844">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983864">populate</span><span class="op" id="5983872">(</span><span class="ident" id="5983873">i0</span><span class="op" id="5983875">,</span>&nbsp;<span class="ident" id="5983877">i</span><span class="op" id="5983878">,</span>&nbsp;<span class="ident" id="5983880">keepType</span><span class="op" id="5983888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983894">i0</span>&nbsp;<span class="op" id="5983897">=</span>&nbsp;<span class="op" id="5983899">-</span><span class="num" id="5983900">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983905">}</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983913">if</span>&nbsp;<span class="ident" id="5983916">t</span><span class="op" id="5983917">.</span><span class="ident" id="5983918">Type</span>&nbsp;<span class="op" id="5983923">!=</span>&nbsp;<span class="ident" id="5983926">nil</span>&nbsp;<span class="op" id="5983930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983935">keepType</span>&nbsp;<span class="op" id="5983944">=</span>&nbsp;<span class="builtintype" id="5983946">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983956">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983959">if</span>&nbsp;<span class="ident" id="5983962">i0</span>&nbsp;<span class="op" id="5983965">&gt;=</span>&nbsp;<span class="num" id="5983968">0</span>&nbsp;<span class="op" id="5983970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5983974">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983992">populate</span><span class="op" id="5984000">(</span><span class="ident" id="5984001">i0</span><span class="op" id="5984003">,</span>&nbsp;<span class="builtinfunc" id="5984005">len</span><span class="op" id="5984008">(</span><span class="ident" id="5984009">specs</span><span class="op" id="5984014">)</span><span class="op" id="5984015">,</span>&nbsp;<span class="ident" id="5984017">keepType</span><span class="op" id="5984025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984032">return</span>&nbsp;<span class="ident" id="5984039">m</span><br>
<span class="lineno"></span><span class="op" id="5984041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984044">func</span>&nbsp;<span class="op" id="5984049">(</span><span class="ident" id="5984050">p</span>&nbsp;<span class="op" id="5984052">*</span><span class="ident" id="5984053">printer</span><span class="op" id="5984060">)</span>&nbsp;<span class="ident" id="5984062">valueSpec</span><span class="op" id="5984071">(</span><span class="ident" id="5984072">s</span>&nbsp;<span class="op" id="5984074">*</span><span class="ident" id="5984075">ast</span><span class="op" id="5984078">.</span><span class="ident" id="5984079">ValueSpec</span><span class="op" id="5984088">,</span>&nbsp;<span class="ident" id="5984090">keepType</span>&nbsp;<span class="builtintype" id="5984099">bool</span><span class="op" id="5984103">)</span>&nbsp;<span class="op" id="5984105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984108">p</span><span class="op" id="5984109">.</span><span class="ident" id="5984110">setComment</span><span class="op" id="5984120">(</span><span class="ident" id="5984121">s</span><span class="op" id="5984122">.</span><span class="ident" id="5984123">Doc</span><span class="op" id="5984126">)</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984129">p</span><span class="op" id="5984130">.</span><span class="ident" id="5984131">identList</span><span class="op" id="5984140">(</span><span class="ident" id="5984141">s</span><span class="op" id="5984142">.</span><span class="ident" id="5984143">Names</span><span class="op" id="5984148">,</span>&nbsp;<span class="builtintype" id="5984150">false</span><span class="op" id="5984155">)</span>&nbsp;<span class="comment" id="5984157">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984176">extraTabs</span>&nbsp;<span class="op" id="5984186">:=</span>&nbsp;<span class="num" id="5984189">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984192">if</span>&nbsp;<span class="ident" id="5984195">s</span><span class="op" id="5984196">.</span><span class="ident" id="5984197">Type</span>&nbsp;<span class="op" id="5984202">!=</span>&nbsp;<span class="ident" id="5984205">nil</span>&nbsp;<span class="op" id="5984209">||</span>&nbsp;<span class="ident" id="5984212">keepType</span>&nbsp;<span class="op" id="5984221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984225">p</span><span class="op" id="5984226">.</span><span class="builtinfunc" id="5984227">print</span><span class="op" id="5984232">(</span><span class="ident" id="5984233">vtab</span><span class="op" id="5984237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984241">extraTabs</span><span class="op" id="5984250">--</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984257">if</span>&nbsp;<span class="ident" id="5984260">s</span><span class="op" id="5984261">.</span><span class="ident" id="5984262">Type</span>&nbsp;<span class="op" id="5984267">!=</span>&nbsp;<span class="ident" id="5984270">nil</span>&nbsp;<span class="op" id="5984274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984278">p</span><span class="op" id="5984279">.</span><span class="ident" id="5984280">expr</span><span class="op" id="5984284">(</span><span class="ident" id="5984285">s</span><span class="op" id="5984286">.</span><span class="ident" id="5984287">Type</span><span class="op" id="5984291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984297">if</span>&nbsp;<span class="ident" id="5984300">s</span><span class="op" id="5984301">.</span><span class="ident" id="5984302">Values</span>&nbsp;<span class="op" id="5984309">!=</span>&nbsp;<span class="ident" id="5984312">nil</span>&nbsp;<span class="op" id="5984316">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984320">p</span><span class="op" id="5984321">.</span><span class="builtinfunc" id="5984322">print</span><span class="op" id="5984327">(</span><span class="ident" id="5984328">vtab</span><span class="op" id="5984332">,</span>&nbsp;<span class="ident" id="5984334">token</span><span class="op" id="5984339">.</span><span class="ident" id="5984340">ASSIGN</span><span class="op" id="5984346">,</span>&nbsp;<span class="ident" id="5984348">blank</span><span class="op" id="5984353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984357">p</span><span class="op" id="5984358">.</span><span class="ident" id="5984359">exprList</span><span class="op" id="5984367">(</span><span class="ident" id="5984368">token</span><span class="op" id="5984373">.</span><span class="ident" id="5984374">NoPos</span><span class="op" id="5984379">,</span>&nbsp;<span class="ident" id="5984381">s</span><span class="op" id="5984382">.</span><span class="ident" id="5984383">Values</span><span class="op" id="5984389">,</span>&nbsp;<span class="num" id="5984391">1</span><span class="op" id="5984392">,</span>&nbsp;<span class="num" id="5984394">0</span><span class="op" id="5984395">,</span>&nbsp;<span class="ident" id="5984397">token</span><span class="op" id="5984402">.</span><span class="ident" id="5984403">NoPos</span><span class="op" id="5984408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984412">extraTabs</span><span class="op" id="5984421">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984428">if</span>&nbsp;<span class="ident" id="5984431">s</span><span class="op" id="5984432">.</span><span class="ident" id="5984433">Comment</span>&nbsp;<span class="op" id="5984441">!=</span>&nbsp;<span class="ident" id="5984444">nil</span>&nbsp;<span class="op" id="5984448">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984452">for</span>&nbsp;<span class="op" id="5984456">;</span>&nbsp;<span class="ident" id="5984458">extraTabs</span>&nbsp;<span class="op" id="5984468">&gt;</span>&nbsp;<span class="num" id="5984470">0</span><span class="op" id="5984471">;</span>&nbsp;<span class="ident" id="5984473">extraTabs</span><span class="op" id="5984482">--</span>&nbsp;<span class="op" id="5984485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984490">p</span><span class="op" id="5984491">.</span><span class="builtinfunc" id="5984492">print</span><span class="op" id="5984497">(</span><span class="ident" id="5984498">vtab</span><span class="op" id="5984502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984510">p</span><span class="op" id="5984511">.</span><span class="ident" id="5984512">setComment</span><span class="op" id="5984522">(</span><span class="ident" id="5984523">s</span><span class="op" id="5984524">.</span><span class="ident" id="5984525">Comment</span><span class="op" id="5984532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984535">}</span><br>
<span class="lineno">1335</span><span class="op" id="5984537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984540">//&nbsp;The&nbsp;parameter&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;specs&nbsp;in&nbsp;the&nbsp;group.&nbsp;If&nbsp;doIndent&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5984616">//&nbsp;multi-line&nbsp;identifier&nbsp;lists&nbsp;in&nbsp;the&nbsp;spec&nbsp;are&nbsp;indented&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5984687">//&nbsp;linebreak&nbsp;is&nbsp;encountered.</span><br>
<span class="lineno">1340</span><span class="comment" id="5984716">//</span><br>
<span class="lineno"></span><span class="keyword" id="5984719">func</span>&nbsp;<span class="op" id="5984724">(</span><span class="ident" id="5984725">p</span>&nbsp;<span class="op" id="5984727">*</span><span class="ident" id="5984728">printer</span><span class="op" id="5984735">)</span>&nbsp;<span class="ident" id="5984737">spec</span><span class="op" id="5984741">(</span><span class="ident" id="5984742">spec</span>&nbsp;<span class="ident" id="5984747">ast</span><span class="op" id="5984750">.</span><span class="ident" id="5984751">Spec</span><span class="op" id="5984755">,</span>&nbsp;<span class="ident" id="5984757">n</span>&nbsp;<span class="builtintype" id="5984759">int</span><span class="op" id="5984762">,</span>&nbsp;<span class="ident" id="5984764">doIndent</span>&nbsp;<span class="builtintype" id="5984773">bool</span><span class="op" id="5984777">)</span>&nbsp;<span class="op" id="5984779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984782">switch</span>&nbsp;<span class="ident" id="5984789">s</span>&nbsp;<span class="op" id="5984791">:=</span>&nbsp;<span class="ident" id="5984794">spec</span><span class="op" id="5984798">.</span><span class="op" id="5984799">(</span><span class="keyword" id="5984800">type</span><span class="op" id="5984804">)</span>&nbsp;<span class="op" id="5984806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984809">case</span>&nbsp;<span class="op" id="5984814">*</span><span class="ident" id="5984815">ast</span><span class="op" id="5984818">.</span><span class="ident" id="5984819">ImportSpec</span><span class="op" id="5984829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984833">p</span><span class="op" id="5984834">.</span><span class="ident" id="5984835">setComment</span><span class="op" id="5984845">(</span><span class="ident" id="5984846">s</span><span class="op" id="5984847">.</span><span class="ident" id="5984848">Doc</span><span class="op" id="5984851">)</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984855">if</span>&nbsp;<span class="ident" id="5984858">s</span><span class="op" id="5984859">.</span><span class="ident" id="5984860">Name</span>&nbsp;<span class="op" id="5984865">!=</span>&nbsp;<span class="ident" id="5984868">nil</span>&nbsp;<span class="op" id="5984872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984877">p</span><span class="op" id="5984878">.</span><span class="ident" id="5984879">expr</span><span class="op" id="5984883">(</span><span class="ident" id="5984884">s</span><span class="op" id="5984885">.</span><span class="ident" id="5984886">Name</span><span class="op" id="5984890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984895">p</span><span class="op" id="5984896">.</span><span class="builtinfunc" id="5984897">print</span><span class="op" id="5984902">(</span><span class="ident" id="5984903">blank</span><span class="op" id="5984908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984916">p</span><span class="op" id="5984917">.</span><span class="ident" id="5984918">expr</span><span class="op" id="5984922">(</span><span class="ident" id="5984923">s</span><span class="op" id="5984924">.</span><span class="ident" id="5984925">Path</span><span class="op" id="5984929">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984933">p</span><span class="op" id="5984934">.</span><span class="ident" id="5984935">setComment</span><span class="op" id="5984945">(</span><span class="ident" id="5984946">s</span><span class="op" id="5984947">.</span><span class="ident" id="5984948">Comment</span><span class="op" id="5984955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984959">p</span><span class="op" id="5984960">.</span><span class="builtinfunc" id="5984961">print</span><span class="op" id="5984966">(</span><span class="ident" id="5984967">s</span><span class="op" id="5984968">.</span><span class="ident" id="5984969">EndPos</span><span class="op" id="5984975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984979">case</span>&nbsp;<span class="op" id="5984984">*</span><span class="ident" id="5984985">ast</span><span class="op" id="5984988">.</span><span class="ident" id="5984989">ValueSpec</span><span class="op" id="5984998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985002">if</span>&nbsp;<span class="ident" id="5985005">n</span>&nbsp;<span class="op" id="5985007">!=</span>&nbsp;<span class="num" id="5985010">1</span>&nbsp;<span class="op" id="5985012">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985017">p</span><span class="op" id="5985018">.</span><span class="ident" id="5985019">internalError</span><span class="op" id="5985032">(</span><span class="string" id="5985033">&#34;expected&nbsp;n&nbsp;=&nbsp;1;&nbsp;got&#34;</span><span class="op" id="5985054">,</span>&nbsp;<span class="ident" id="5985056">n</span><span class="op" id="5985057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985065">p</span><span class="op" id="5985066">.</span><span class="ident" id="5985067">setComment</span><span class="op" id="5985077">(</span><span class="ident" id="5985078">s</span><span class="op" id="5985079">.</span><span class="ident" id="5985080">Doc</span><span class="op" id="5985083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985087">p</span><span class="op" id="5985088">.</span><span class="ident" id="5985089">identList</span><span class="op" id="5985098">(</span><span class="ident" id="5985099">s</span><span class="op" id="5985100">.</span><span class="ident" id="5985101">Names</span><span class="op" id="5985106">,</span>&nbsp;<span class="ident" id="5985108">doIndent</span><span class="op" id="5985116">)</span>&nbsp;<span class="comment" id="5985118">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985138">if</span>&nbsp;<span class="ident" id="5985141">s</span><span class="op" id="5985142">.</span><span class="ident" id="5985143">Type</span>&nbsp;<span class="op" id="5985148">!=</span>&nbsp;<span class="ident" id="5985151">nil</span>&nbsp;<span class="op" id="5985155">{</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985160">p</span><span class="op" id="5985161">.</span><span class="builtinfunc" id="5985162">print</span><span class="op" id="5985167">(</span><span class="ident" id="5985168">blank</span><span class="op" id="5985173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985178">p</span><span class="op" id="5985179">.</span><span class="ident" id="5985180">expr</span><span class="op" id="5985184">(</span><span class="ident" id="5985185">s</span><span class="op" id="5985186">.</span><span class="ident" id="5985187">Type</span><span class="op" id="5985191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985199">if</span>&nbsp;<span class="ident" id="5985202">s</span><span class="op" id="5985203">.</span><span class="ident" id="5985204">Values</span>&nbsp;<span class="op" id="5985211">!=</span>&nbsp;<span class="ident" id="5985214">nil</span>&nbsp;<span class="op" id="5985218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985223">p</span><span class="op" id="5985224">.</span><span class="builtinfunc" id="5985225">print</span><span class="op" id="5985230">(</span><span class="ident" id="5985231">blank</span><span class="op" id="5985236">,</span>&nbsp;<span class="ident" id="5985238">token</span><span class="op" id="5985243">.</span><span class="ident" id="5985244">ASSIGN</span><span class="op" id="5985250">,</span>&nbsp;<span class="ident" id="5985252">blank</span><span class="op" id="5985257">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985262">p</span><span class="op" id="5985263">.</span><span class="ident" id="5985264">exprList</span><span class="op" id="5985272">(</span><span class="ident" id="5985273">token</span><span class="op" id="5985278">.</span><span class="ident" id="5985279">NoPos</span><span class="op" id="5985284">,</span>&nbsp;<span class="ident" id="5985286">s</span><span class="op" id="5985287">.</span><span class="ident" id="5985288">Values</span><span class="op" id="5985294">,</span>&nbsp;<span class="num" id="5985296">1</span><span class="op" id="5985297">,</span>&nbsp;<span class="num" id="5985299">0</span><span class="op" id="5985300">,</span>&nbsp;<span class="ident" id="5985302">token</span><span class="op" id="5985307">.</span><span class="ident" id="5985308">NoPos</span><span class="op" id="5985313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985321">p</span><span class="op" id="5985322">.</span><span class="ident" id="5985323">setComment</span><span class="op" id="5985333">(</span><span class="ident" id="5985334">s</span><span class="op" id="5985335">.</span><span class="ident" id="5985336">Comment</span><span class="op" id="5985343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985347">case</span>&nbsp;<span class="op" id="5985352">*</span><span class="ident" id="5985353">ast</span><span class="op" id="5985356">.</span><span class="ident" id="5985357">TypeSpec</span><span class="op" id="5985365">:</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985369">p</span><span class="op" id="5985370">.</span><span class="ident" id="5985371">setComment</span><span class="op" id="5985381">(</span><span class="ident" id="5985382">s</span><span class="op" id="5985383">.</span><span class="ident" id="5985384">Doc</span><span class="op" id="5985387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985391">p</span><span class="op" id="5985392">.</span><span class="ident" id="5985393">expr</span><span class="op" id="5985397">(</span><span class="ident" id="5985398">s</span><span class="op" id="5985399">.</span><span class="ident" id="5985400">Name</span><span class="op" id="5985404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985408">if</span>&nbsp;<span class="ident" id="5985411">n</span>&nbsp;<span class="op" id="5985413">==</span>&nbsp;<span class="num" id="5985416">1</span>&nbsp;<span class="op" id="5985418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985423">p</span><span class="op" id="5985424">.</span><span class="builtinfunc" id="5985425">print</span><span class="op" id="5985430">(</span><span class="ident" id="5985431">blank</span><span class="op" id="5985436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985440">}</span>&nbsp;<span class="keyword" id="5985442">else</span>&nbsp;<span class="op" id="5985447">{</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985452">p</span><span class="op" id="5985453">.</span><span class="builtinfunc" id="5985454">print</span><span class="op" id="5985459">(</span><span class="ident" id="5985460">vtab</span><span class="op" id="5985464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985472">p</span><span class="op" id="5985473">.</span><span class="ident" id="5985474">expr</span><span class="op" id="5985478">(</span><span class="ident" id="5985479">s</span><span class="op" id="5985480">.</span><span class="ident" id="5985481">Type</span><span class="op" id="5985485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985489">p</span><span class="op" id="5985490">.</span><span class="ident" id="5985491">setComment</span><span class="op" id="5985501">(</span><span class="ident" id="5985502">s</span><span class="op" id="5985503">.</span><span class="ident" id="5985504">Comment</span><span class="op" id="5985511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985515">default</span><span class="op" id="5985522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5985526">panic</span><span class="op" id="5985531">(</span><span class="string" id="5985532">&#34;unreachable&#34;</span><span class="op" id="5985545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985548">}</span><br>
<span class="lineno"></span><span class="op" id="5985550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1385</span><span class="keyword" id="5985553">func</span>&nbsp;<span class="op" id="5985558">(</span><span class="ident" id="5985559">p</span>&nbsp;<span class="op" id="5985561">*</span><span class="ident" id="5985562">printer</span><span class="op" id="5985569">)</span>&nbsp;<span class="ident" id="5985571">genDecl</span><span class="op" id="5985578">(</span><span class="ident" id="5985579">d</span>&nbsp;<span class="op" id="5985581">*</span><span class="ident" id="5985582">ast</span><span class="op" id="5985585">.</span><span class="ident" id="5985586">GenDecl</span><span class="op" id="5985593">)</span>&nbsp;<span class="op" id="5985595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985598">p</span><span class="op" id="5985599">.</span><span class="ident" id="5985600">setComment</span><span class="op" id="5985610">(</span><span class="ident" id="5985611">d</span><span class="op" id="5985612">.</span><span class="ident" id="5985613">Doc</span><span class="op" id="5985616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985619">p</span><span class="op" id="5985620">.</span><span class="builtinfunc" id="5985621">print</span><span class="op" id="5985626">(</span><span class="ident" id="5985627">d</span><span class="op" id="5985628">.</span><span class="ident" id="5985629">Pos</span><span class="op" id="5985632">(</span><span class="op" id="5985633">)</span><span class="op" id="5985634">,</span>&nbsp;<span class="ident" id="5985636">d</span><span class="op" id="5985637">.</span><span class="ident" id="5985638">Tok</span><span class="op" id="5985641">,</span>&nbsp;<span class="ident" id="5985643">blank</span><span class="op" id="5985648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985652">if</span>&nbsp;<span class="ident" id="5985655">d</span><span class="op" id="5985656">.</span><span class="ident" id="5985657">Lparen</span><span class="op" id="5985663">.</span><span class="ident" id="5985664">IsValid</span><span class="op" id="5985671">(</span><span class="op" id="5985672">)</span>&nbsp;<span class="op" id="5985674">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985678">//&nbsp;group&nbsp;of&nbsp;parenthesized&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985719">p</span><span class="op" id="5985720">.</span><span class="builtinfunc" id="5985721">print</span><span class="op" id="5985726">(</span><span class="ident" id="5985727">d</span><span class="op" id="5985728">.</span><span class="ident" id="5985729">Lparen</span><span class="op" id="5985735">,</span>&nbsp;<span class="ident" id="5985737">token</span><span class="op" id="5985742">.</span><span class="ident" id="5985743">LPAREN</span><span class="op" id="5985749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985753">if</span>&nbsp;<span class="ident" id="5985756">n</span>&nbsp;<span class="op" id="5985758">:=</span>&nbsp;<span class="builtinfunc" id="5985761">len</span><span class="op" id="5985764">(</span><span class="ident" id="5985765">d</span><span class="op" id="5985766">.</span><span class="ident" id="5985767">Specs</span><span class="op" id="5985772">)</span><span class="op" id="5985773">;</span>&nbsp;<span class="ident" id="5985775">n</span>&nbsp;<span class="op" id="5985777">&gt;</span>&nbsp;<span class="num" id="5985779">0</span>&nbsp;<span class="op" id="5985781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985786">p</span><span class="op" id="5985787">.</span><span class="builtinfunc" id="5985788">print</span><span class="op" id="5985793">(</span><span class="ident" id="5985794">indent</span><span class="op" id="5985800">,</span>&nbsp;<span class="ident" id="5985802">formfeed</span><span class="op" id="5985810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985815">if</span>&nbsp;<span class="ident" id="5985818">n</span>&nbsp;<span class="op" id="5985820">&gt;</span>&nbsp;<span class="num" id="5985822">1</span>&nbsp;<span class="op" id="5985824">&amp;&amp;</span>&nbsp;<span class="op" id="5985827">(</span><span class="ident" id="5985828">d</span><span class="op" id="5985829">.</span><span class="ident" id="5985830">Tok</span>&nbsp;<span class="op" id="5985834">==</span>&nbsp;<span class="ident" id="5985837">token</span><span class="op" id="5985842">.</span><span class="ident" id="5985843">CONST</span>&nbsp;<span class="op" id="5985849">||</span>&nbsp;<span class="ident" id="5985852">d</span><span class="op" id="5985853">.</span><span class="ident" id="5985854">Tok</span>&nbsp;<span class="op" id="5985858">==</span>&nbsp;<span class="ident" id="5985861">token</span><span class="op" id="5985866">.</span><span class="ident" id="5985867">VAR</span><span class="op" id="5985870">)</span>&nbsp;<span class="op" id="5985872">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985878">//&nbsp;two&nbsp;or&nbsp;more&nbsp;grouped&nbsp;const/var&nbsp;declarations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985929">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985978">keepType</span>&nbsp;<span class="op" id="5985987">:=</span>&nbsp;<span class="ident" id="5985990">keepTypeColumn</span><span class="op" id="5986004">(</span><span class="ident" id="5986005">d</span><span class="op" id="5986006">.</span><span class="ident" id="5986007">Specs</span><span class="op" id="5986012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986018">var</span>&nbsp;<span class="ident" id="5986022">line</span>&nbsp;<span class="builtintype" id="5986027">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986035">for</span>&nbsp;<span class="ident" id="5986039">i</span><span class="op" id="5986040">,</span>&nbsp;<span class="ident" id="5986042">s</span>&nbsp;<span class="op" id="5986044">:=</span>&nbsp;<span class="keyword" id="5986047">range</span>&nbsp;<span class="ident" id="5986053">d</span><span class="op" id="5986054">.</span><span class="ident" id="5986055">Specs</span>&nbsp;<span class="op" id="5986061">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986068">if</span>&nbsp;<span class="ident" id="5986071">i</span>&nbsp;<span class="op" id="5986073">&gt;</span>&nbsp;<span class="num" id="5986075">0</span>&nbsp;<span class="op" id="5986077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986085">p</span><span class="op" id="5986086">.</span><span class="ident" id="5986087">linebreak</span><span class="op" id="5986096">(</span><span class="ident" id="5986097">p</span><span class="op" id="5986098">.</span><span class="ident" id="5986099">lineFor</span><span class="op" id="5986106">(</span><span class="ident" id="5986107">s</span><span class="op" id="5986108">.</span><span class="ident" id="5986109">Pos</span><span class="op" id="5986112">(</span><span class="op" id="5986113">)</span><span class="op" id="5986114">)</span><span class="op" id="5986115">,</span>&nbsp;<span class="num" id="5986117">1</span><span class="op" id="5986118">,</span>&nbsp;<span class="ident" id="5986120">ignore</span><span class="op" id="5986126">,</span>&nbsp;<span class="ident" id="5986128">p</span><span class="op" id="5986129">.</span><span class="ident" id="5986130">linesFrom</span><span class="op" id="5986139">(</span><span class="ident" id="5986140">line</span><span class="op" id="5986144">)</span>&nbsp;<span class="op" id="5986146">&gt;</span>&nbsp;<span class="num" id="5986148">0</span><span class="op" id="5986149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986163">p</span><span class="op" id="5986164">.</span><span class="ident" id="5986165">recordLine</span><span class="op" id="5986175">(</span><span class="op" id="5986176">&amp;</span><span class="ident" id="5986177">line</span><span class="op" id="5986181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986188">p</span><span class="op" id="5986189">.</span><span class="ident" id="5986190">valueSpec</span><span class="op" id="5986199">(</span><span class="ident" id="5986200">s</span><span class="op" id="5986201">.</span><span class="op" id="5986202">(</span><span class="op" id="5986203">*</span><span class="ident" id="5986204">ast</span><span class="op" id="5986207">.</span><span class="ident" id="5986208">ValueSpec</span><span class="op" id="5986217">)</span><span class="op" id="5986218">,</span>&nbsp;<span class="ident" id="5986220">keepType</span><span class="op" id="5986228">[</span><span class="ident" id="5986229">i</span><span class="op" id="5986230">]</span><span class="op" id="5986231">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986242">}</span>&nbsp;<span class="keyword" id="5986244">else</span>&nbsp;<span class="op" id="5986249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986255">var</span>&nbsp;<span class="ident" id="5986259">line</span>&nbsp;<span class="builtintype" id="5986264">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986272">for</span>&nbsp;<span class="ident" id="5986276">i</span><span class="op" id="5986277">,</span>&nbsp;<span class="ident" id="5986279">s</span>&nbsp;<span class="op" id="5986281">:=</span>&nbsp;<span class="keyword" id="5986284">range</span>&nbsp;<span class="ident" id="5986290">d</span><span class="op" id="5986291">.</span><span class="ident" id="5986292">Specs</span>&nbsp;<span class="op" id="5986298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986305">if</span>&nbsp;<span class="ident" id="5986308">i</span>&nbsp;<span class="op" id="5986310">&gt;</span>&nbsp;<span class="num" id="5986312">0</span>&nbsp;<span class="op" id="5986314">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986322">p</span><span class="op" id="5986323">.</span><span class="ident" id="5986324">linebreak</span><span class="op" id="5986333">(</span><span class="ident" id="5986334">p</span><span class="op" id="5986335">.</span><span class="ident" id="5986336">lineFor</span><span class="op" id="5986343">(</span><span class="ident" id="5986344">s</span><span class="op" id="5986345">.</span><span class="ident" id="5986346">Pos</span><span class="op" id="5986349">(</span><span class="op" id="5986350">)</span><span class="op" id="5986351">)</span><span class="op" id="5986352">,</span>&nbsp;<span class="num" id="5986354">1</span><span class="op" id="5986355">,</span>&nbsp;<span class="ident" id="5986357">ignore</span><span class="op" id="5986363">,</span>&nbsp;<span class="ident" id="5986365">p</span><span class="op" id="5986366">.</span><span class="ident" id="5986367">linesFrom</span><span class="op" id="5986376">(</span><span class="ident" id="5986377">line</span><span class="op" id="5986381">)</span>&nbsp;<span class="op" id="5986383">&gt;</span>&nbsp;<span class="num" id="5986385">0</span><span class="op" id="5986386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986400">p</span><span class="op" id="5986401">.</span><span class="ident" id="5986402">recordLine</span><span class="op" id="5986412">(</span><span class="op" id="5986413">&amp;</span><span class="ident" id="5986414">line</span><span class="op" id="5986418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986425">p</span><span class="op" id="5986426">.</span><span class="ident" id="5986427">spec</span><span class="op" id="5986431">(</span><span class="ident" id="5986432">s</span><span class="op" id="5986433">,</span>&nbsp;<span class="ident" id="5986435">n</span><span class="op" id="5986436">,</span>&nbsp;<span class="builtintype" id="5986438">false</span><span class="op" id="5986443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986449">}</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986459">p</span><span class="op" id="5986460">.</span><span class="builtinfunc" id="5986461">print</span><span class="op" id="5986466">(</span><span class="ident" id="5986467">unindent</span><span class="op" id="5986475">,</span>&nbsp;<span class="ident" id="5986477">formfeed</span><span class="op" id="5986485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986493">p</span><span class="op" id="5986494">.</span><span class="builtinfunc" id="5986495">print</span><span class="op" id="5986500">(</span><span class="ident" id="5986501">d</span><span class="op" id="5986502">.</span><span class="ident" id="5986503">Rparen</span><span class="op" id="5986509">,</span>&nbsp;<span class="ident" id="5986511">token</span><span class="op" id="5986516">.</span><span class="ident" id="5986517">RPAREN</span><span class="op" id="5986523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986527">}</span>&nbsp;<span class="keyword" id="5986529">else</span>&nbsp;<span class="op" id="5986534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986538">//&nbsp;single&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986562">p</span><span class="op" id="5986563">.</span><span class="ident" id="5986564">spec</span><span class="op" id="5986568">(</span><span class="ident" id="5986569">d</span><span class="op" id="5986570">.</span><span class="ident" id="5986571">Specs</span><span class="op" id="5986576">[</span><span class="num" id="5986577">0</span><span class="op" id="5986578">]</span><span class="op" id="5986579">,</span>&nbsp;<span class="num" id="5986581">1</span><span class="op" id="5986582">,</span>&nbsp;<span class="builtintype" id="5986584">true</span><span class="op" id="5986588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986591">}</span><br>
<span class="lineno"></span><span class="op" id="5986593">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5986596">//&nbsp;nodeSize&nbsp;determines&nbsp;the&nbsp;size&nbsp;of&nbsp;n&nbsp;in&nbsp;chars&nbsp;after&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="comment" id="5986660">//&nbsp;The&nbsp;result&nbsp;is&nbsp;&lt;=&nbsp;maxSize&nbsp;if&nbsp;the&nbsp;node&nbsp;fits&nbsp;on&nbsp;one&nbsp;line&nbsp;with&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5986725">//&nbsp;most&nbsp;maxSize&nbsp;chars&nbsp;and&nbsp;the&nbsp;formatted&nbsp;output&nbsp;doesn&#39;t&nbsp;contain</span><br>
<span class="lineno"></span><span class="comment" id="5986788">//&nbsp;any&nbsp;control&nbsp;chars.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;&gt;&nbsp;maxSize.</span><br>
<span class="lineno">1430</span><span class="comment" id="5986846">//</span><br>
<span class="lineno"></span><span class="keyword" id="5986849">func</span>&nbsp;<span class="op" id="5986854">(</span><span class="ident" id="5986855">p</span>&nbsp;<span class="op" id="5986857">*</span><span class="ident" id="5986858">printer</span><span class="op" id="5986865">)</span>&nbsp;<span class="ident" id="5986867">nodeSize</span><span class="op" id="5986875">(</span><span class="ident" id="5986876">n</span>&nbsp;<span class="ident" id="5986878">ast</span><span class="op" id="5986881">.</span><span class="ident" id="5986882">Node</span><span class="op" id="5986886">,</span>&nbsp;<span class="ident" id="5986888">maxSize</span>&nbsp;<span class="builtintype" id="5986896">int</span><span class="op" id="5986899">)</span>&nbsp;<span class="op" id="5986901">(</span><span class="ident" id="5986902">size</span>&nbsp;<span class="builtintype" id="5986907">int</span><span class="op" id="5986910">)</span>&nbsp;<span class="op" id="5986912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986915">//&nbsp;nodeSize&nbsp;invokes&nbsp;the&nbsp;printer,&nbsp;which&nbsp;may&nbsp;invoke&nbsp;nodeSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986975">//&nbsp;recursively.&nbsp;For&nbsp;deep&nbsp;composite&nbsp;literal&nbsp;nests,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987035">//&nbsp;lead&nbsp;to&nbsp;an&nbsp;exponential&nbsp;algorithm.&nbsp;Remember&nbsp;previous</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987091">//&nbsp;results&nbsp;to&nbsp;prune&nbsp;the&nbsp;recursion&nbsp;(was&nbsp;issue&nbsp;1628).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987144">if</span>&nbsp;<span class="ident" id="5987147">size</span><span class="op" id="5987151">,</span>&nbsp;<span class="ident" id="5987153">found</span>&nbsp;<span class="op" id="5987159">:=</span>&nbsp;<span class="ident" id="5987162">p</span><span class="op" id="5987163">.</span><span class="ident" id="5987164">nodeSizes</span><span class="op" id="5987173">[</span><span class="ident" id="5987174">n</span><span class="op" id="5987175">]</span><span class="op" id="5987176">;</span>&nbsp;<span class="ident" id="5987178">found</span>&nbsp;<span class="op" id="5987184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987188">return</span>&nbsp;<span class="ident" id="5987195">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987205">size</span>&nbsp;<span class="op" id="5987210">=</span>&nbsp;<span class="ident" id="5987212">maxSize</span>&nbsp;<span class="op" id="5987220">+</span>&nbsp;<span class="num" id="5987222">1</span>&nbsp;<span class="comment" id="5987224">//&nbsp;assume&nbsp;n&nbsp;doesn&#39;t&nbsp;fit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987249">p</span><span class="op" id="5987250">.</span><span class="ident" id="5987251">nodeSizes</span><span class="op" id="5987260">[</span><span class="ident" id="5987261">n</span><span class="op" id="5987262">]</span>&nbsp;<span class="op" id="5987264">=</span>&nbsp;<span class="ident" id="5987266">size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987273">//&nbsp;nodeSize&nbsp;computation&nbsp;must&nbsp;be&nbsp;independent&nbsp;of&nbsp;particular</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987332">//&nbsp;style&nbsp;so&nbsp;that&nbsp;we&nbsp;always&nbsp;get&nbsp;the&nbsp;same&nbsp;decision;&nbsp;print</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987389">//&nbsp;in&nbsp;RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987406">cfg</span>&nbsp;<span class="op" id="5987410">:=</span>&nbsp;<span class="ident" id="5987413">Config</span><span class="op" id="5987419">{</span><span class="ident" id="5987420">Mode</span><span class="op" id="5987424">:</span>&nbsp;<span class="ident" id="5987426">RawFormat</span><span class="op" id="5987435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987438">var</span>&nbsp;<span class="ident" id="5987442">buf</span>&nbsp;<span class="ident" id="5987446">bytes</span><span class="op" id="5987451">.</span><span class="ident" id="5987452">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987460">if</span>&nbsp;<span class="ident" id="5987463">err</span>&nbsp;<span class="op" id="5987467">:=</span>&nbsp;<span class="ident" id="5987470">cfg</span><span class="op" id="5987473">.</span><span class="ident" id="5987474">fprint</span><span class="op" id="5987480">(</span><span class="op" id="5987481">&amp;</span><span class="ident" id="5987482">buf</span><span class="op" id="5987485">,</span>&nbsp;<span class="ident" id="5987487">p</span><span class="op" id="5987488">.</span><span class="ident" id="5987489">fset</span><span class="op" id="5987493">,</span>&nbsp;<span class="ident" id="5987495">n</span><span class="op" id="5987496">,</span>&nbsp;<span class="ident" id="5987498">p</span><span class="op" id="5987499">.</span><span class="ident" id="5987500">nodeSizes</span><span class="op" id="5987509">)</span><span class="op" id="5987510">;</span>&nbsp;<span class="ident" id="5987512">err</span>&nbsp;<span class="op" id="5987516">!=</span>&nbsp;<span class="ident" id="5987519">nil</span>&nbsp;<span class="op" id="5987523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987527">return</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987538">if</span>&nbsp;<span class="ident" id="5987541">buf</span><span class="op" id="5987544">.</span><span class="ident" id="5987545">Len</span><span class="op" id="5987548">(</span><span class="op" id="5987549">)</span>&nbsp;<span class="op" id="5987551">&lt;=</span>&nbsp;<span class="ident" id="5987554">maxSize</span>&nbsp;<span class="op" id="5987562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987566">for</span>&nbsp;<span class="ident" id="5987570">_</span><span class="op" id="5987571">,</span>&nbsp;<span class="ident" id="5987573">ch</span>&nbsp;<span class="op" id="5987576">:=</span>&nbsp;<span class="keyword" id="5987579">range</span>&nbsp;<span class="ident" id="5987585">buf</span><span class="op" id="5987588">.</span><span class="ident" id="5987589">Bytes</span><span class="op" id="5987594">(</span><span class="op" id="5987595">)</span>&nbsp;<span class="op" id="5987597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987602">if</span>&nbsp;<span class="ident" id="5987605">ch</span>&nbsp;<span class="op" id="5987608">&lt;</span>&nbsp;<span class="string" id="5987610">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5987614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987620">return</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987638">size</span>&nbsp;<span class="op" id="5987643">=</span>&nbsp;<span class="ident" id="5987645">buf</span><span class="op" id="5987648">.</span><span class="ident" id="5987649">Len</span><span class="op" id="5987652">(</span><span class="op" id="5987653">)</span>&nbsp;<span class="comment" id="5987655">//&nbsp;n&nbsp;fits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987667">p</span><span class="op" id="5987668">.</span><span class="ident" id="5987669">nodeSizes</span><span class="op" id="5987678">[</span><span class="ident" id="5987679">n</span><span class="op" id="5987680">]</span>&nbsp;<span class="op" id="5987682">=</span>&nbsp;<span class="ident" id="5987684">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987690">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987693">return</span><br>
<span class="lineno"></span><span class="op" id="5987700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987703">//&nbsp;bodySize&nbsp;is&nbsp;like&nbsp;nodeSize&nbsp;but&nbsp;it&nbsp;is&nbsp;specialized&nbsp;for&nbsp;*ast.BlockStmt&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5987776">func</span>&nbsp;<span class="op" id="5987781">(</span><span class="ident" id="5987782">p</span>&nbsp;<span class="op" id="5987784">*</span><span class="ident" id="5987785">printer</span><span class="op" id="5987792">)</span>&nbsp;<span class="ident" id="5987794">bodySize</span><span class="op" id="5987802">(</span><span class="ident" id="5987803">b</span>&nbsp;<span class="op" id="5987805">*</span><span class="ident" id="5987806">ast</span><span class="op" id="5987809">.</span><span class="ident" id="5987810">BlockStmt</span><span class="op" id="5987819">,</span>&nbsp;<span class="ident" id="5987821">maxSize</span>&nbsp;<span class="builtintype" id="5987829">int</span><span class="op" id="5987832">)</span>&nbsp;<span class="builtintype" id="5987834">int</span>&nbsp;<span class="op" id="5987838">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987841">pos1</span>&nbsp;<span class="op" id="5987846">:=</span>&nbsp;<span class="ident" id="5987849">b</span><span class="op" id="5987850">.</span><span class="ident" id="5987851">Pos</span><span class="op" id="5987854">(</span><span class="op" id="5987855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987858">pos2</span>&nbsp;<span class="op" id="5987863">:=</span>&nbsp;<span class="ident" id="5987866">b</span><span class="op" id="5987867">.</span><span class="ident" id="5987868">Rbrace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987876">if</span>&nbsp;<span class="ident" id="5987879">pos1</span><span class="op" id="5987883">.</span><span class="ident" id="5987884">IsValid</span><span class="op" id="5987891">(</span><span class="op" id="5987892">)</span>&nbsp;<span class="op" id="5987894">&amp;&amp;</span>&nbsp;<span class="ident" id="5987897">pos2</span><span class="op" id="5987901">.</span><span class="ident" id="5987902">IsValid</span><span class="op" id="5987909">(</span><span class="op" id="5987910">)</span>&nbsp;<span class="op" id="5987912">&amp;&amp;</span>&nbsp;<span class="ident" id="5987915">p</span><span class="op" id="5987916">.</span><span class="ident" id="5987917">lineFor</span><span class="op" id="5987924">(</span><span class="ident" id="5987925">pos1</span><span class="op" id="5987929">)</span>&nbsp;<span class="op" id="5987931">!=</span>&nbsp;<span class="ident" id="5987934">p</span><span class="op" id="5987935">.</span><span class="ident" id="5987936">lineFor</span><span class="op" id="5987943">(</span><span class="ident" id="5987944">pos2</span><span class="op" id="5987948">)</span>&nbsp;<span class="op" id="5987950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987954">//&nbsp;opening&nbsp;and&nbsp;closing&nbsp;brace&nbsp;are&nbsp;on&nbsp;different&nbsp;lines&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988036">return</span>&nbsp;<span class="ident" id="5988043">maxSize</span>&nbsp;<span class="op" id="5988051">+</span>&nbsp;<span class="num" id="5988053">1</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988059">if</span>&nbsp;<span class="builtinfunc" id="5988062">len</span><span class="op" id="5988065">(</span><span class="ident" id="5988066">b</span><span class="op" id="5988067">.</span><span class="ident" id="5988068">List</span><span class="op" id="5988072">)</span>&nbsp;<span class="op" id="5988074">&gt;</span>&nbsp;<span class="num" id="5988076">5</span>&nbsp;<span class="op" id="5988078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988082">//&nbsp;too&nbsp;many&nbsp;statements&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988135">return</span>&nbsp;<span class="ident" id="5988142">maxSize</span>&nbsp;<span class="op" id="5988150">+</span>&nbsp;<span class="num" id="5988152">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988155">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988158">//&nbsp;otherwise,&nbsp;estimate&nbsp;body&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988192">bodySize</span>&nbsp;<span class="op" id="5988201">:=</span>&nbsp;<span class="ident" id="5988204">p</span><span class="op" id="5988205">.</span><span class="ident" id="5988206">commentSizeBefore</span><span class="op" id="5988223">(</span><span class="ident" id="5988224">p</span><span class="op" id="5988225">.</span><span class="ident" id="5988226">posFor</span><span class="op" id="5988232">(</span><span class="ident" id="5988233">pos2</span><span class="op" id="5988237">)</span><span class="op" id="5988238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988241">for</span>&nbsp;<span class="ident" id="5988245">i</span><span class="op" id="5988246">,</span>&nbsp;<span class="ident" id="5988248">s</span>&nbsp;<span class="op" id="5988250">:=</span>&nbsp;<span class="keyword" id="5988253">range</span>&nbsp;<span class="ident" id="5988259">b</span><span class="op" id="5988260">.</span><span class="ident" id="5988261">List</span>&nbsp;<span class="op" id="5988266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988270">if</span>&nbsp;<span class="ident" id="5988273">bodySize</span>&nbsp;<span class="op" id="5988282">&gt;</span>&nbsp;<span class="ident" id="5988284">maxSize</span>&nbsp;<span class="op" id="5988292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988297">break</span>&nbsp;<span class="comment" id="5988303">//&nbsp;no&nbsp;need&nbsp;to&nbsp;continue</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988332">if</span>&nbsp;<span class="ident" id="5988335">i</span>&nbsp;<span class="op" id="5988337">&gt;</span>&nbsp;<span class="num" id="5988339">0</span>&nbsp;<span class="op" id="5988341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988346">bodySize</span>&nbsp;<span class="op" id="5988355">+=</span>&nbsp;<span class="num" id="5988358">2</span>&nbsp;<span class="comment" id="5988360">//&nbsp;space&nbsp;for&nbsp;a&nbsp;semicolon&nbsp;and&nbsp;blank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988401">bodySize</span>&nbsp;<span class="op" id="5988410">+=</span>&nbsp;<span class="ident" id="5988413">p</span><span class="op" id="5988414">.</span><span class="ident" id="5988415">nodeSize</span><span class="op" id="5988423">(</span><span class="ident" id="5988424">s</span><span class="op" id="5988425">,</span>&nbsp;<span class="ident" id="5988427">maxSize</span><span class="op" id="5988434">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988440">return</span>&nbsp;<span class="ident" id="5988447">bodySize</span><br>
<span class="lineno"></span><span class="op" id="5988456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988459">//&nbsp;adjBlock&nbsp;prints&nbsp;an&nbsp;&#34;adjacent&#34;&nbsp;block&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;or&nbsp;function&nbsp;body)&nbsp;following</span><br>
<span class="lineno">1490</span><span class="comment" id="5988544">//&nbsp;a&nbsp;header&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;control&nbsp;clause&nbsp;or&nbsp;function&nbsp;signature)&nbsp;of&nbsp;given&nbsp;headerSize.</span><br>
<span class="lineno"></span><span class="comment" id="5988633">//&nbsp;If&nbsp;the&nbsp;header&#39;s&nbsp;and&nbsp;block&#39;s&nbsp;size&nbsp;are&nbsp;&#34;small&nbsp;enough&#34;&nbsp;and&nbsp;the&nbsp;block&nbsp;is&nbsp;&#34;simple&nbsp;enough&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5988722">//&nbsp;the&nbsp;block&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;without&nbsp;line&nbsp;breaks,&nbsp;spaced&nbsp;from&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5988811">//&nbsp;by&nbsp;sep.&nbsp;Otherwise&nbsp;the&nbsp;block&#39;s&nbsp;opening&nbsp;&#34;{&#34;&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5988900">//&nbsp;lines&nbsp;for&nbsp;the&nbsp;block&#39;s&nbsp;statements&nbsp;and&nbsp;its&nbsp;closing&nbsp;&#34;}&#34;.</span><br>
<span class="lineno">1495</span><span class="comment" id="5988957">//</span><br>
<span class="lineno"></span><span class="keyword" id="5988960">func</span>&nbsp;<span class="op" id="5988965">(</span><span class="ident" id="5988966">p</span>&nbsp;<span class="op" id="5988968">*</span><span class="ident" id="5988969">printer</span><span class="op" id="5988976">)</span>&nbsp;<span class="ident" id="5988978">adjBlock</span><span class="op" id="5988986">(</span><span class="ident" id="5988987">headerSize</span>&nbsp;<span class="builtintype" id="5988998">int</span><span class="op" id="5989001">,</span>&nbsp;<span class="ident" id="5989003">sep</span>&nbsp;<span class="ident" id="5989007">whiteSpace</span><span class="op" id="5989017">,</span>&nbsp;<span class="ident" id="5989019">b</span>&nbsp;<span class="op" id="5989021">*</span><span class="ident" id="5989022">ast</span><span class="op" id="5989025">.</span><span class="ident" id="5989026">BlockStmt</span><span class="op" id="5989035">)</span>&nbsp;<span class="op" id="5989037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989040">if</span>&nbsp;<span class="ident" id="5989043">b</span>&nbsp;<span class="op" id="5989045">==</span>&nbsp;<span class="ident" id="5989048">nil</span>&nbsp;<span class="op" id="5989052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989064">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989068">const</span>&nbsp;<span class="ident" id="5989074">maxSize</span>&nbsp;<span class="op" id="5989082">=</span>&nbsp;<span class="num" id="5989084">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989089">if</span>&nbsp;<span class="ident" id="5989092">headerSize</span><span class="op" id="5989102">+</span><span class="ident" id="5989103">p</span><span class="op" id="5989104">.</span><span class="ident" id="5989105">bodySize</span><span class="op" id="5989113">(</span><span class="ident" id="5989114">b</span><span class="op" id="5989115">,</span>&nbsp;<span class="ident" id="5989117">maxSize</span><span class="op" id="5989124">)</span>&nbsp;<span class="op" id="5989126">&lt;=</span>&nbsp;<span class="ident" id="5989129">maxSize</span>&nbsp;<span class="op" id="5989137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989141">p</span><span class="op" id="5989142">.</span><span class="builtinfunc" id="5989143">print</span><span class="op" id="5989148">(</span><span class="ident" id="5989149">sep</span><span class="op" id="5989152">,</span>&nbsp;<span class="ident" id="5989154">b</span><span class="op" id="5989155">.</span><span class="ident" id="5989156">Lbrace</span><span class="op" id="5989162">,</span>&nbsp;<span class="ident" id="5989164">token</span><span class="op" id="5989169">.</span><span class="ident" id="5989170">LBRACE</span><span class="op" id="5989176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989180">if</span>&nbsp;<span class="builtinfunc" id="5989183">len</span><span class="op" id="5989186">(</span><span class="ident" id="5989187">b</span><span class="op" id="5989188">.</span><span class="ident" id="5989189">List</span><span class="op" id="5989193">)</span>&nbsp;<span class="op" id="5989195">&gt;</span>&nbsp;<span class="num" id="5989197">0</span>&nbsp;<span class="op" id="5989199">{</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989204">p</span><span class="op" id="5989205">.</span><span class="builtinfunc" id="5989206">print</span><span class="op" id="5989211">(</span><span class="ident" id="5989212">blank</span><span class="op" id="5989217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989222">for</span>&nbsp;<span class="ident" id="5989226">i</span><span class="op" id="5989227">,</span>&nbsp;<span class="ident" id="5989229">s</span>&nbsp;<span class="op" id="5989231">:=</span>&nbsp;<span class="keyword" id="5989234">range</span>&nbsp;<span class="ident" id="5989240">b</span><span class="op" id="5989241">.</span><span class="ident" id="5989242">List</span>&nbsp;<span class="op" id="5989247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989253">if</span>&nbsp;<span class="ident" id="5989256">i</span>&nbsp;<span class="op" id="5989258">&gt;</span>&nbsp;<span class="num" id="5989260">0</span>&nbsp;<span class="op" id="5989262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989269">p</span><span class="op" id="5989270">.</span><span class="builtinfunc" id="5989271">print</span><span class="op" id="5989276">(</span><span class="ident" id="5989277">token</span><span class="op" id="5989282">.</span><span class="ident" id="5989283">SEMICOLON</span><span class="op" id="5989292">,</span>&nbsp;<span class="ident" id="5989294">blank</span><span class="op" id="5989299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989305">}</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989311">p</span><span class="op" id="5989312">.</span><span class="ident" id="5989313">stmt</span><span class="op" id="5989317">(</span><span class="ident" id="5989318">s</span><span class="op" id="5989319">,</span>&nbsp;<span class="ident" id="5989321">i</span>&nbsp;<span class="op" id="5989323">==</span>&nbsp;<span class="builtinfunc" id="5989326">len</span><span class="op" id="5989329">(</span><span class="ident" id="5989330">b</span><span class="op" id="5989331">.</span><span class="ident" id="5989332">List</span><span class="op" id="5989336">)</span><span class="op" id="5989337">-</span><span class="num" id="5989338">1</span><span class="op" id="5989339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989349">p</span><span class="op" id="5989350">.</span><span class="builtinfunc" id="5989351">print</span><span class="op" id="5989356">(</span><span class="ident" id="5989357">blank</span><span class="op" id="5989362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989370">p</span><span class="op" id="5989371">.</span><span class="builtinfunc" id="5989372">print</span><span class="op" id="5989377">(</span><span class="ident" id="5989378">noExtraLinebreak</span><span class="op" id="5989394">,</span>&nbsp;<span class="ident" id="5989396">b</span><span class="op" id="5989397">.</span><span class="ident" id="5989398">Rbrace</span><span class="op" id="5989404">,</span>&nbsp;<span class="ident" id="5989406">token</span><span class="op" id="5989411">.</span><span class="ident" id="5989412">RBRACE</span><span class="op" id="5989418">,</span>&nbsp;<span class="ident" id="5989420">noExtraLinebreak</span><span class="op" id="5989436">)</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989440">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989452">if</span>&nbsp;<span class="ident" id="5989455">sep</span>&nbsp;<span class="op" id="5989459">!=</span>&nbsp;<span class="ident" id="5989462">ignore</span>&nbsp;<span class="op" id="5989469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989473">p</span><span class="op" id="5989474">.</span><span class="builtinfunc" id="5989475">print</span><span class="op" id="5989480">(</span><span class="ident" id="5989481">blank</span><span class="op" id="5989486">)</span>&nbsp;<span class="comment" id="5989488">//&nbsp;always&nbsp;use&nbsp;blank</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989512">p</span><span class="op" id="5989513">.</span><span class="ident" id="5989514">block</span><span class="op" id="5989519">(</span><span class="ident" id="5989520">b</span><span class="op" id="5989521">,</span>&nbsp;<span class="num" id="5989523">1</span><span class="op" id="5989524">)</span><br>
<span class="lineno"></span><span class="op" id="5989526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989529">//&nbsp;distanceFrom&nbsp;returns&nbsp;the&nbsp;column&nbsp;difference&nbsp;between&nbsp;from&nbsp;and&nbsp;p.pos&nbsp;(the&nbsp;current</span><br>
<span class="lineno">1525</span><span class="comment" id="5989611">//&nbsp;estimated&nbsp;position)&nbsp;if&nbsp;both&nbsp;are&nbsp;on&nbsp;the&nbsp;same&nbsp;line;&nbsp;if&nbsp;they&nbsp;are&nbsp;on&nbsp;different&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5989695">//&nbsp;(or&nbsp;unknown)&nbsp;the&nbsp;result&nbsp;is&nbsp;infinity.</span><br>
<span class="lineno"></span><span class="keyword" id="5989735">func</span>&nbsp;<span class="op" id="5989740">(</span><span class="ident" id="5989741">p</span>&nbsp;<span class="op" id="5989743">*</span><span class="ident" id="5989744">printer</span><span class="op" id="5989751">)</span>&nbsp;<span class="ident" id="5989753">distanceFrom</span><span class="op" id="5989765">(</span><span class="ident" id="5989766">from</span>&nbsp;<span class="ident" id="5989771">token</span><span class="op" id="5989776">.</span><span class="ident" id="5989777">Pos</span><span class="op" id="5989780">)</span>&nbsp;<span class="builtintype" id="5989782">int</span>&nbsp;<span class="op" id="5989786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989789">if</span>&nbsp;<span class="ident" id="5989792">from</span><span class="op" id="5989796">.</span><span class="ident" id="5989797">IsValid</span><span class="op" id="5989804">(</span><span class="op" id="5989805">)</span>&nbsp;<span class="op" id="5989807">&amp;&amp;</span>&nbsp;<span class="ident" id="5989810">p</span><span class="op" id="5989811">.</span><span class="ident" id="5989812">pos</span><span class="op" id="5989815">.</span><span class="ident" id="5989816">IsValid</span><span class="op" id="5989823">(</span><span class="op" id="5989824">)</span>&nbsp;<span class="op" id="5989826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989830">if</span>&nbsp;<span class="ident" id="5989833">f</span>&nbsp;<span class="op" id="5989835">:=</span>&nbsp;<span class="ident" id="5989838">p</span><span class="op" id="5989839">.</span><span class="ident" id="5989840">posFor</span><span class="op" id="5989846">(</span><span class="ident" id="5989847">from</span><span class="op" id="5989851">)</span><span class="op" id="5989852">;</span>&nbsp;<span class="ident" id="5989854">f</span><span class="op" id="5989855">.</span><span class="ident" id="5989856">Line</span>&nbsp;<span class="op" id="5989861">==</span>&nbsp;<span class="ident" id="5989864">p</span><span class="op" id="5989865">.</span><span class="ident" id="5989866">pos</span><span class="op" id="5989869">.</span><span class="ident" id="5989870">Line</span>&nbsp;<span class="op" id="5989875">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989880">return</span>&nbsp;<span class="ident" id="5989887">p</span><span class="op" id="5989888">.</span><span class="ident" id="5989889">pos</span><span class="op" id="5989892">.</span><span class="ident" id="5989893">Column</span>&nbsp;<span class="op" id="5989900">-</span>&nbsp;<span class="ident" id="5989902">f</span><span class="op" id="5989903">.</span><span class="ident" id="5989904">Column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989919">return</span>&nbsp;<span class="ident" id="5989926">infinity</span><br>
<span class="lineno"></span><span class="op" id="5989935">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span><span class="keyword" id="5989938">func</span>&nbsp;<span class="op" id="5989943">(</span><span class="ident" id="5989944">p</span>&nbsp;<span class="op" id="5989946">*</span><span class="ident" id="5989947">printer</span><span class="op" id="5989954">)</span>&nbsp;<span class="ident" id="5989956">funcDecl</span><span class="op" id="5989964">(</span><span class="ident" id="5989965">d</span>&nbsp;<span class="op" id="5989967">*</span><span class="ident" id="5989968">ast</span><span class="op" id="5989971">.</span><span class="ident" id="5989972">FuncDecl</span><span class="op" id="5989980">)</span>&nbsp;<span class="op" id="5989982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989985">p</span><span class="op" id="5989986">.</span><span class="ident" id="5989987">setComment</span><span class="op" id="5989997">(</span><span class="ident" id="5989998">d</span><span class="op" id="5989999">.</span><span class="ident" id="5990000">Doc</span><span class="op" id="5990003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990006">p</span><span class="op" id="5990007">.</span><span class="builtinfunc" id="5990008">print</span><span class="op" id="5990013">(</span><span class="ident" id="5990014">d</span><span class="op" id="5990015">.</span><span class="ident" id="5990016">Pos</span><span class="op" id="5990019">(</span><span class="op" id="5990020">)</span><span class="op" id="5990021">,</span>&nbsp;<span class="ident" id="5990023">token</span><span class="op" id="5990028">.</span><span class="ident" id="5990029">FUNC</span><span class="op" id="5990033">,</span>&nbsp;<span class="ident" id="5990035">blank</span><span class="op" id="5990040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990043">if</span>&nbsp;<span class="ident" id="5990046">d</span><span class="op" id="5990047">.</span><span class="ident" id="5990048">Recv</span>&nbsp;<span class="op" id="5990053">!=</span>&nbsp;<span class="ident" id="5990056">nil</span>&nbsp;<span class="op" id="5990060">{</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990064">p</span><span class="op" id="5990065">.</span><span class="ident" id="5990066">parameters</span><span class="op" id="5990076">(</span><span class="ident" id="5990077">d</span><span class="op" id="5990078">.</span><span class="ident" id="5990079">Recv</span><span class="op" id="5990083">)</span>&nbsp;<span class="comment" id="5990085">//&nbsp;method:&nbsp;print&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990113">p</span><span class="op" id="5990114">.</span><span class="builtinfunc" id="5990115">print</span><span class="op" id="5990120">(</span><span class="ident" id="5990121">blank</span><span class="op" id="5990126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990132">p</span><span class="op" id="5990133">.</span><span class="ident" id="5990134">expr</span><span class="op" id="5990138">(</span><span class="ident" id="5990139">d</span><span class="op" id="5990140">.</span><span class="ident" id="5990141">Name</span><span class="op" id="5990145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990148">p</span><span class="op" id="5990149">.</span><span class="ident" id="5990150">signature</span><span class="op" id="5990159">(</span><span class="ident" id="5990160">d</span><span class="op" id="5990161">.</span><span class="ident" id="5990162">Type</span><span class="op" id="5990166">.</span><span class="ident" id="5990167">Params</span><span class="op" id="5990173">,</span>&nbsp;<span class="ident" id="5990175">d</span><span class="op" id="5990176">.</span><span class="ident" id="5990177">Type</span><span class="op" id="5990181">.</span><span class="ident" id="5990182">Results</span><span class="op" id="5990189">)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990192">p</span><span class="op" id="5990193">.</span><span class="ident" id="5990194">adjBlock</span><span class="op" id="5990202">(</span><span class="ident" id="5990203">p</span><span class="op" id="5990204">.</span><span class="ident" id="5990205">distanceFrom</span><span class="op" id="5990217">(</span><span class="ident" id="5990218">d</span><span class="op" id="5990219">.</span><span class="ident" id="5990220">Pos</span><span class="op" id="5990223">(</span><span class="op" id="5990224">)</span><span class="op" id="5990225">)</span><span class="op" id="5990226">,</span>&nbsp;<span class="ident" id="5990228">vtab</span><span class="op" id="5990232">,</span>&nbsp;<span class="ident" id="5990234">d</span><span class="op" id="5990235">.</span><span class="ident" id="5990236">Body</span><span class="op" id="5990240">)</span><br>
<span class="lineno"></span><span class="op" id="5990242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5990245">func</span>&nbsp;<span class="op" id="5990250">(</span><span class="ident" id="5990251">p</span>&nbsp;<span class="op" id="5990253">*</span><span class="ident" id="5990254">printer</span><span class="op" id="5990261">)</span>&nbsp;<span class="ident" id="5990263">decl</span><span class="op" id="5990267">(</span><span class="ident" id="5990268">decl</span>&nbsp;<span class="ident" id="5990273">ast</span><span class="op" id="5990276">.</span><span class="ident" id="5990277">Decl</span><span class="op" id="5990281">)</span>&nbsp;<span class="op" id="5990283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990286">switch</span>&nbsp;<span class="ident" id="5990293">d</span>&nbsp;<span class="op" id="5990295">:=</span>&nbsp;<span class="ident" id="5990298">decl</span><span class="op" id="5990302">.</span><span class="op" id="5990303">(</span><span class="keyword" id="5990304">type</span><span class="op" id="5990308">)</span>&nbsp;<span class="op" id="5990310">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990313">case</span>&nbsp;<span class="op" id="5990318">*</span><span class="ident" id="5990319">ast</span><span class="op" id="5990322">.</span><span class="ident" id="5990323">BadDecl</span><span class="op" id="5990330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990334">p</span><span class="op" id="5990335">.</span><span class="builtinfunc" id="5990336">print</span><span class="op" id="5990341">(</span><span class="ident" id="5990342">d</span><span class="op" id="5990343">.</span><span class="ident" id="5990344">Pos</span><span class="op" id="5990347">(</span><span class="op" id="5990348">)</span><span class="op" id="5990349">,</span>&nbsp;<span class="string" id="5990351">&#34;BadDecl&#34;</span><span class="op" id="5990360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990363">case</span>&nbsp;<span class="op" id="5990368">*</span><span class="ident" id="5990369">ast</span><span class="op" id="5990372">.</span><span class="ident" id="5990373">GenDecl</span><span class="op" id="5990380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990384">p</span><span class="op" id="5990385">.</span><span class="ident" id="5990386">genDecl</span><span class="op" id="5990393">(</span><span class="ident" id="5990394">d</span><span class="op" id="5990395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990398">case</span>&nbsp;<span class="op" id="5990403">*</span><span class="ident" id="5990404">ast</span><span class="op" id="5990407">.</span><span class="ident" id="5990408">FuncDecl</span><span class="op" id="5990416">:</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990420">p</span><span class="op" id="5990421">.</span><span class="ident" id="5990422">funcDecl</span><span class="op" id="5990430">(</span><span class="ident" id="5990431">d</span><span class="op" id="5990432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990435">default</span><span class="op" id="5990442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5990446">panic</span><span class="op" id="5990451">(</span><span class="string" id="5990452">&#34;unreachable&#34;</span><span class="op" id="5990465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990468">}</span><br>
<span class="lineno"></span><span class="op" id="5990470">}</span><br>
<span class="lineno">1560</span><br>
<span class="lineno"></span><span class="comment" id="5990473">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5990553">//&nbsp;Files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5990563">func</span>&nbsp;<span class="ident" id="5990568">declToken</span><span class="op" id="5990577">(</span><span class="ident" id="5990578">decl</span>&nbsp;<span class="ident" id="5990583">ast</span><span class="op" id="5990586">.</span><span class="ident" id="5990587">Decl</span><span class="op" id="5990591">)</span>&nbsp;<span class="op" id="5990593">(</span><span class="ident" id="5990594">tok</span>&nbsp;<span class="ident" id="5990598">token</span><span class="op" id="5990603">.</span><span class="ident" id="5990604">Token</span><span class="op" id="5990609">)</span>&nbsp;<span class="op" id="5990611">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990614">tok</span>&nbsp;<span class="op" id="5990618">=</span>&nbsp;<span class="ident" id="5990620">token</span><span class="op" id="5990625">.</span><span class="ident" id="5990626">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990635">switch</span>&nbsp;<span class="ident" id="5990642">d</span>&nbsp;<span class="op" id="5990644">:=</span>&nbsp;<span class="ident" id="5990647">decl</span><span class="op" id="5990651">.</span><span class="op" id="5990652">(</span><span class="keyword" id="5990653">type</span><span class="op" id="5990657">)</span>&nbsp;<span class="op" id="5990659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990662">case</span>&nbsp;<span class="op" id="5990667">*</span><span class="ident" id="5990668">ast</span><span class="op" id="5990671">.</span><span class="ident" id="5990672">GenDecl</span><span class="op" id="5990679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990683">tok</span>&nbsp;<span class="op" id="5990687">=</span>&nbsp;<span class="ident" id="5990689">d</span><span class="op" id="5990690">.</span><span class="ident" id="5990691">Tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990696">case</span>&nbsp;<span class="op" id="5990701">*</span><span class="ident" id="5990702">ast</span><span class="op" id="5990705">.</span><span class="ident" id="5990706">FuncDecl</span><span class="op" id="5990714">:</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990718">tok</span>&nbsp;<span class="op" id="5990722">=</span>&nbsp;<span class="ident" id="5990724">token</span><span class="op" id="5990729">.</span><span class="ident" id="5990730">FUNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990739">return</span><br>
<span class="lineno"></span><span class="op" id="5990746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span><span class="keyword" id="5990749">func</span>&nbsp;<span class="op" id="5990754">(</span><span class="ident" id="5990755">p</span>&nbsp;<span class="op" id="5990757">*</span><span class="ident" id="5990758">printer</span><span class="op" id="5990765">)</span>&nbsp;<span class="ident" id="5990767">declList</span><span class="op" id="5990775">(</span><span class="ident" id="5990776">list</span>&nbsp;<span class="op" id="5990781">[</span><span class="op" id="5990782">]</span><span class="ident" id="5990783">ast</span><span class="op" id="5990786">.</span><span class="ident" id="5990787">Decl</span><span class="op" id="5990791">)</span>&nbsp;<span class="op" id="5990793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990796">tok</span>&nbsp;<span class="op" id="5990800">:=</span>&nbsp;<span class="ident" id="5990803">token</span><span class="op" id="5990808">.</span><span class="ident" id="5990809">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990818">for</span>&nbsp;<span class="ident" id="5990822">_</span><span class="op" id="5990823">,</span>&nbsp;<span class="ident" id="5990825">d</span>&nbsp;<span class="op" id="5990827">:=</span>&nbsp;<span class="keyword" id="5990830">range</span>&nbsp;<span class="ident" id="5990836">list</span>&nbsp;<span class="op" id="5990841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990845">prev</span>&nbsp;<span class="op" id="5990850">:=</span>&nbsp;<span class="ident" id="5990853">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990859">tok</span>&nbsp;<span class="op" id="5990863">=</span>&nbsp;<span class="ident" id="5990865">declToken</span><span class="op" id="5990874">(</span><span class="ident" id="5990875">d</span><span class="op" id="5990876">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990880">//&nbsp;If&nbsp;the&nbsp;declaration&nbsp;token&nbsp;changed&nbsp;(e.g.,&nbsp;from&nbsp;CONST&nbsp;to&nbsp;TYPE)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990945">//&nbsp;or&nbsp;the&nbsp;next&nbsp;declaration&nbsp;has&nbsp;documentation&nbsp;associated&nbsp;with&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991012">//&nbsp;print&nbsp;an&nbsp;empty&nbsp;line&nbsp;between&nbsp;top-level&nbsp;declarations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991069">//&nbsp;(because&nbsp;p.linebreak&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;position&nbsp;of&nbsp;d,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991135">//&nbsp;is&nbsp;past&nbsp;any&nbsp;documentation,&nbsp;the&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;satisfied</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991204">//&nbsp;even&nbsp;w/o&nbsp;the&nbsp;extra&nbsp;getDoc(d)&nbsp;nil-check&nbsp;-&nbsp;leave&nbsp;it&nbsp;in&nbsp;case&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991271">//&nbsp;linebreak&nbsp;logic&nbsp;improves&nbsp;-&nbsp;there&#39;s&nbsp;already&nbsp;a&nbsp;TODO).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991328">if</span>&nbsp;<span class="builtinfunc" id="5991331">len</span><span class="op" id="5991334">(</span><span class="ident" id="5991335">p</span><span class="op" id="5991336">.</span><span class="ident" id="5991337">output</span><span class="op" id="5991343">)</span>&nbsp;<span class="op" id="5991345">&gt;</span>&nbsp;<span class="num" id="5991347">0</span>&nbsp;<span class="op" id="5991349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991354">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991427">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991484">min</span>&nbsp;<span class="op" id="5991488">:=</span>&nbsp;<span class="num" id="5991491">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991496">if</span>&nbsp;<span class="ident" id="5991499">prev</span>&nbsp;<span class="op" id="5991504">!=</span>&nbsp;<span class="ident" id="5991507">tok</span>&nbsp;<span class="op" id="5991511">||</span>&nbsp;<span class="ident" id="5991514">getDoc</span><span class="op" id="5991520">(</span><span class="ident" id="5991521">d</span><span class="op" id="5991522">)</span>&nbsp;<span class="op" id="5991524">!=</span>&nbsp;<span class="ident" id="5991527">nil</span>&nbsp;<span class="op" id="5991531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991537">min</span>&nbsp;<span class="op" id="5991541">=</span>&nbsp;<span class="num" id="5991543">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991553">p</span><span class="op" id="5991554">.</span><span class="ident" id="5991555">linebreak</span><span class="op" id="5991564">(</span><span class="ident" id="5991565">p</span><span class="op" id="5991566">.</span><span class="ident" id="5991567">lineFor</span><span class="op" id="5991574">(</span><span class="ident" id="5991575">d</span><span class="op" id="5991576">.</span><span class="ident" id="5991577">Pos</span><span class="op" id="5991580">(</span><span class="op" id="5991581">)</span><span class="op" id="5991582">)</span><span class="op" id="5991583">,</span>&nbsp;<span class="ident" id="5991585">min</span><span class="op" id="5991588">,</span>&nbsp;<span class="ident" id="5991590">ignore</span><span class="op" id="5991596">,</span>&nbsp;<span class="builtintype" id="5991598">false</span><span class="op" id="5991603">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991611">p</span><span class="op" id="5991612">.</span><span class="ident" id="5991613">decl</span><span class="op" id="5991617">(</span><span class="ident" id="5991618">d</span><span class="op" id="5991619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991622">}</span><br>
<span class="lineno"></span><span class="op" id="5991624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="keyword" id="5991627">func</span>&nbsp;<span class="op" id="5991632">(</span><span class="ident" id="5991633">p</span>&nbsp;<span class="op" id="5991635">*</span><span class="ident" id="5991636">printer</span><span class="op" id="5991643">)</span>&nbsp;<span class="ident" id="5991645">file</span><span class="op" id="5991649">(</span><span class="ident" id="5991650">src</span>&nbsp;<span class="op" id="5991654">*</span><span class="ident" id="5991655">ast</span><span class="op" id="5991658">.</span><span class="ident" id="5991659">File</span><span class="op" id="5991663">)</span>&nbsp;<span class="op" id="5991665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991668">p</span><span class="op" id="5991669">.</span><span class="ident" id="5991670">setComment</span><span class="op" id="5991680">(</span><span class="ident" id="5991681">src</span><span class="op" id="5991684">.</span><span class="ident" id="5991685">Doc</span><span class="op" id="5991688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991691">p</span><span class="op" id="5991692">.</span><span class="builtinfunc" id="5991693">print</span><span class="op" id="5991698">(</span><span class="ident" id="5991699">src</span><span class="op" id="5991702">.</span><span class="ident" id="5991703">Pos</span><span class="op" id="5991706">(</span><span class="op" id="5991707">)</span><span class="op" id="5991708">,</span>&nbsp;<span class="ident" id="5991710">token</span><span class="op" id="5991715">.</span><span class="ident" id="5991716">PACKAGE</span><span class="op" id="5991723">,</span>&nbsp;<span class="ident" id="5991725">blank</span><span class="op" id="5991730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991733">p</span><span class="op" id="5991734">.</span><span class="ident" id="5991735">expr</span><span class="op" id="5991739">(</span><span class="ident" id="5991740">src</span><span class="op" id="5991743">.</span><span class="ident" id="5991744">Name</span><span class="op" id="5991748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991751">p</span><span class="op" id="5991752">.</span><span class="ident" id="5991753">declList</span><span class="op" id="5991761">(</span><span class="ident" id="5991762">src</span><span class="op" id="5991765">.</span><span class="ident" id="5991766">Decls</span><span class="op" id="5991771">)</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991774">p</span><span class="op" id="5991775">.</span><span class="builtinfunc" id="5991776">print</span><span class="op" id="5991781">(</span><span class="ident" id="5991782">newline</span><span class="op" id="5991789">)</span><br>
<span class="lineno"></span><span class="op" id="5991791">}</span>
</div>
</body>
</html>
