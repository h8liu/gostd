<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7941796">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7941852">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7941906">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7941957">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7942036">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942045">package</span>&nbsp;<span class="ident" id="7942053">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7942058">import</span>&nbsp;<span class="op" id="7942065">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942068">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942081">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942087">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942098">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7942109">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7942116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7942119">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="7942189">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="7942257">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="7942279">func</span>&nbsp;<span class="ident" id="7942284">testUnixAddr</span><span class="op" id="7942296">(</span><span class="op" id="7942297">)</span>&nbsp;<span class="builtintype" id="7942299">string</span>&nbsp;<span class="op" id="7942306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942309">f</span><span class="op" id="7942310">,</span>&nbsp;<span class="ident" id="7942312">err</span>&nbsp;<span class="op" id="7942316">:=</span>&nbsp;<span class="ident" id="7942319">ioutil</span><span class="op" id="7942325">.</span><span class="ident" id="7942326">TempFile</span><span class="op" id="7942334">(</span><span class="string" id="7942335">&#34;&#34;</span><span class="op" id="7942337">,</span>&nbsp;<span class="string" id="7942339">&#34;nettest&#34;</span><span class="op" id="7942348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942351">if</span>&nbsp;<span class="ident" id="7942354">err</span>&nbsp;<span class="op" id="7942358">!=</span>&nbsp;<span class="ident" id="7942361">nil</span>&nbsp;<span class="op" id="7942365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7942369">panic</span><span class="op" id="7942374">(</span><span class="ident" id="7942375">err</span><span class="op" id="7942378">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942384">addr</span>&nbsp;<span class="op" id="7942389">:=</span>&nbsp;<span class="ident" id="7942392">f</span><span class="op" id="7942393">.</span><span class="ident" id="7942394">Name</span><span class="op" id="7942398">(</span><span class="op" id="7942399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942402">f</span><span class="op" id="7942403">.</span><span class="ident" id="7942404">Close</span><span class="op" id="7942409">(</span><span class="op" id="7942410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942413">os</span><span class="op" id="7942415">.</span><span class="ident" id="7942416">Remove</span><span class="op" id="7942422">(</span><span class="ident" id="7942423">addr</span><span class="op" id="7942427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942430">return</span>&nbsp;<span class="ident" id="7942437">addr</span><br>
<span class="lineno">30</span><span class="op" id="7942442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942445">var</span>&nbsp;<span class="ident" id="7942449">condFatalf</span>&nbsp;<span class="op" id="7942460">=</span>&nbsp;<span class="keyword" id="7942462">func</span><span class="op" id="7942466">(</span><span class="op" id="7942467">)</span>&nbsp;<span class="keyword" id="7942469">func</span><span class="op" id="7942473">(</span><span class="op" id="7942474">*</span><span class="ident" id="7942475">testing</span><span class="op" id="7942482">.</span><span class="ident" id="7942483">T</span><span class="op" id="7942484">,</span>&nbsp;<span class="builtintype" id="7942486">string</span><span class="op" id="7942492">,</span>&nbsp;<span class="op" id="7942494">...</span><span class="keyword" id="7942497">interface</span><span class="op" id="7942506">{</span><span class="op" id="7942507">}</span><span class="op" id="7942508">)</span>&nbsp;<span class="op" id="7942510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7942513">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942580">switch</span>&nbsp;<span class="ident" id="7942587">runtime</span><span class="op" id="7942594">.</span><span class="ident" id="7942595">GOOS</span>&nbsp;<span class="op" id="7942600">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942603">case</span>&nbsp;<span class="string" id="7942608">&#34;plan9&#34;</span><span class="op" id="7942615">,</span>&nbsp;<span class="string" id="7942617">&#34;windows&#34;</span><span class="op" id="7942626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942630">return</span>&nbsp;<span class="op" id="7942637">(</span><span class="op" id="7942638">*</span><span class="ident" id="7942639">testing</span><span class="op" id="7942646">.</span><span class="ident" id="7942647">T</span><span class="op" id="7942648">)</span><span class="op" id="7942649">.</span><span class="ident" id="7942650">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942659">return</span>&nbsp;<span class="op" id="7942666">(</span><span class="op" id="7942667">*</span><span class="ident" id="7942668">testing</span><span class="op" id="7942675">.</span><span class="ident" id="7942676">T</span><span class="op" id="7942677">)</span><span class="op" id="7942678">.</span><span class="ident" id="7942679">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="7942686">}</span><span class="op" id="7942687">(</span><span class="op" id="7942688">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7942691">func</span>&nbsp;<span class="ident" id="7942696">TestTCPListenerSpecificMethods</span><span class="op" id="7942726">(</span><span class="ident" id="7942727">t</span>&nbsp;<span class="op" id="7942729">*</span><span class="ident" id="7942730">testing</span><span class="op" id="7942737">.</span><span class="ident" id="7942738">T</span><span class="op" id="7942739">)</span>&nbsp;<span class="op" id="7942741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942744">switch</span>&nbsp;<span class="ident" id="7942751">runtime</span><span class="op" id="7942758">.</span><span class="ident" id="7942759">GOOS</span>&nbsp;<span class="op" id="7942764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942767">case</span>&nbsp;<span class="string" id="7942772">&#34;plan9&#34;</span><span class="op" id="7942779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942783">t</span><span class="op" id="7942784">.</span><span class="ident" id="7942785">Skipf</span><span class="op" id="7942790">(</span><span class="string" id="7942791">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7942812">,</span>&nbsp;<span class="ident" id="7942814">runtime</span><span class="op" id="7942821">.</span><span class="ident" id="7942822">GOOS</span><span class="op" id="7942826">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942833">la</span><span class="op" id="7942835">,</span>&nbsp;<span class="ident" id="7942837">err</span>&nbsp;<span class="op" id="7942841">:=</span>&nbsp;<span class="ident" id="7942844">ResolveTCPAddr</span><span class="op" id="7942858">(</span><span class="string" id="7942859">&#34;tcp4&#34;</span><span class="op" id="7942865">,</span>&nbsp;<span class="string" id="7942867">&#34;127.0.0.1:0&#34;</span><span class="op" id="7942880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942883">if</span>&nbsp;<span class="ident" id="7942886">err</span>&nbsp;<span class="op" id="7942890">!=</span>&nbsp;<span class="ident" id="7942893">nil</span>&nbsp;<span class="op" id="7942897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942901">t</span><span class="op" id="7942902">.</span><span class="ident" id="7942903">Fatalf</span><span class="op" id="7942909">(</span><span class="string" id="7942910">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7942937">,</span>&nbsp;<span class="ident" id="7942939">err</span><span class="op" id="7942942">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942948">ln</span><span class="op" id="7942950">,</span>&nbsp;<span class="ident" id="7942952">err</span>&nbsp;<span class="op" id="7942956">:=</span>&nbsp;<span class="ident" id="7942959">ListenTCP</span><span class="op" id="7942968">(</span><span class="string" id="7942969">&#34;tcp4&#34;</span><span class="op" id="7942975">,</span>&nbsp;<span class="ident" id="7942977">la</span><span class="op" id="7942979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942982">if</span>&nbsp;<span class="ident" id="7942985">err</span>&nbsp;<span class="op" id="7942989">!=</span>&nbsp;<span class="ident" id="7942992">nil</span>&nbsp;<span class="op" id="7942996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943000">t</span><span class="op" id="7943001">.</span><span class="ident" id="7943002">Fatalf</span><span class="op" id="7943008">(</span><span class="string" id="7943009">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943031">,</span>&nbsp;<span class="ident" id="7943033">err</span><span class="op" id="7943036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943039">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943042">defer</span>&nbsp;<span class="ident" id="7943048">ln</span><span class="op" id="7943050">.</span><span class="ident" id="7943051">Close</span><span class="op" id="7943056">(</span><span class="op" id="7943057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943060">ln</span><span class="op" id="7943062">.</span><span class="ident" id="7943063">Addr</span><span class="op" id="7943067">(</span><span class="op" id="7943068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943071">ln</span><span class="op" id="7943073">.</span><span class="ident" id="7943074">SetDeadline</span><span class="op" id="7943085">(</span><span class="ident" id="7943086">time</span><span class="op" id="7943090">.</span><span class="ident" id="7943091">Now</span><span class="op" id="7943094">(</span><span class="op" id="7943095">)</span><span class="op" id="7943096">.</span><span class="ident" id="7943097">Add</span><span class="op" id="7943100">(</span><span class="num" id="7943101">30</span>&nbsp;<span class="op" id="7943104">*</span>&nbsp;<span class="ident" id="7943106">time</span><span class="op" id="7943110">.</span><span class="ident" id="7943111">Nanosecond</span><span class="op" id="7943121">)</span><span class="op" id="7943122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943126">if</span>&nbsp;<span class="ident" id="7943129">c</span><span class="op" id="7943130">,</span>&nbsp;<span class="ident" id="7943132">err</span>&nbsp;<span class="op" id="7943136">:=</span>&nbsp;<span class="ident" id="7943139">ln</span><span class="op" id="7943141">.</span><span class="ident" id="7943142">Accept</span><span class="op" id="7943148">(</span><span class="op" id="7943149">)</span><span class="op" id="7943150">;</span>&nbsp;<span class="ident" id="7943152">err</span>&nbsp;<span class="op" id="7943156">!=</span>&nbsp;<span class="ident" id="7943159">nil</span>&nbsp;<span class="op" id="7943163">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943167">if</span>&nbsp;<span class="op" id="7943170">!</span><span class="ident" id="7943171">err</span><span class="op" id="7943174">.</span><span class="op" id="7943175">(</span><span class="ident" id="7943176">Error</span><span class="op" id="7943181">)</span><span class="op" id="7943182">.</span><span class="ident" id="7943183">Timeout</span><span class="op" id="7943190">(</span><span class="op" id="7943191">)</span>&nbsp;<span class="op" id="7943193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943198">t</span><span class="op" id="7943199">.</span><span class="ident" id="7943200">Fatalf</span><span class="op" id="7943206">(</span><span class="string" id="7943207">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943238">,</span>&nbsp;<span class="ident" id="7943240">err</span><span class="op" id="7943243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943250">}</span>&nbsp;<span class="keyword" id="7943252">else</span>&nbsp;<span class="op" id="7943257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943261">c</span><span class="op" id="7943262">.</span><span class="ident" id="7943263">Close</span><span class="op" id="7943268">(</span><span class="op" id="7943269">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943275">if</span>&nbsp;<span class="ident" id="7943278">c</span><span class="op" id="7943279">,</span>&nbsp;<span class="ident" id="7943281">err</span>&nbsp;<span class="op" id="7943285">:=</span>&nbsp;<span class="ident" id="7943288">ln</span><span class="op" id="7943290">.</span><span class="ident" id="7943291">AcceptTCP</span><span class="op" id="7943300">(</span><span class="op" id="7943301">)</span><span class="op" id="7943302">;</span>&nbsp;<span class="ident" id="7943304">err</span>&nbsp;<span class="op" id="7943308">!=</span>&nbsp;<span class="ident" id="7943311">nil</span>&nbsp;<span class="op" id="7943315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943319">if</span>&nbsp;<span class="op" id="7943322">!</span><span class="ident" id="7943323">err</span><span class="op" id="7943326">.</span><span class="op" id="7943327">(</span><span class="ident" id="7943328">Error</span><span class="op" id="7943333">)</span><span class="op" id="7943334">.</span><span class="ident" id="7943335">Timeout</span><span class="op" id="7943342">(</span><span class="op" id="7943343">)</span>&nbsp;<span class="op" id="7943345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943350">t</span><span class="op" id="7943351">.</span><span class="ident" id="7943352">Fatalf</span><span class="op" id="7943358">(</span><span class="string" id="7943359">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943393">,</span>&nbsp;<span class="ident" id="7943395">err</span><span class="op" id="7943398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943402">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943405">}</span>&nbsp;<span class="keyword" id="7943407">else</span>&nbsp;<span class="op" id="7943412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943416">c</span><span class="op" id="7943417">.</span><span class="ident" id="7943418">Close</span><span class="op" id="7943423">(</span><span class="op" id="7943424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943431">if</span>&nbsp;<span class="ident" id="7943434">f</span><span class="op" id="7943435">,</span>&nbsp;<span class="ident" id="7943437">err</span>&nbsp;<span class="op" id="7943441">:=</span>&nbsp;<span class="ident" id="7943444">ln</span><span class="op" id="7943446">.</span><span class="ident" id="7943447">File</span><span class="op" id="7943451">(</span><span class="op" id="7943452">)</span><span class="op" id="7943453">;</span>&nbsp;<span class="ident" id="7943455">err</span>&nbsp;<span class="op" id="7943459">!=</span>&nbsp;<span class="ident" id="7943462">nil</span>&nbsp;<span class="op" id="7943466">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943470">condFatalf</span><span class="op" id="7943480">(</span><span class="ident" id="7943481">t</span><span class="op" id="7943482">,</span>&nbsp;<span class="string" id="7943484">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943513">,</span>&nbsp;<span class="ident" id="7943515">err</span><span class="op" id="7943518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943521">}</span>&nbsp;<span class="keyword" id="7943523">else</span>&nbsp;<span class="op" id="7943528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943532">f</span><span class="op" id="7943533">.</span><span class="ident" id="7943534">Close</span><span class="op" id="7943539">(</span><span class="op" id="7943540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943543">}</span><br>
<span class="lineno"></span><span class="op" id="7943545">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7943548">func</span>&nbsp;<span class="ident" id="7943553">TestTCPConnSpecificMethods</span><span class="op" id="7943579">(</span><span class="ident" id="7943580">t</span>&nbsp;<span class="op" id="7943582">*</span><span class="ident" id="7943583">testing</span><span class="op" id="7943590">.</span><span class="ident" id="7943591">T</span><span class="op" id="7943592">)</span>&nbsp;<span class="op" id="7943594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943597">la</span><span class="op" id="7943599">,</span>&nbsp;<span class="ident" id="7943601">err</span>&nbsp;<span class="op" id="7943605">:=</span>&nbsp;<span class="ident" id="7943608">ResolveTCPAddr</span><span class="op" id="7943622">(</span><span class="string" id="7943623">&#34;tcp4&#34;</span><span class="op" id="7943629">,</span>&nbsp;<span class="string" id="7943631">&#34;127.0.0.1:0&#34;</span><span class="op" id="7943644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943647">if</span>&nbsp;<span class="ident" id="7943650">err</span>&nbsp;<span class="op" id="7943654">!=</span>&nbsp;<span class="ident" id="7943657">nil</span>&nbsp;<span class="op" id="7943661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943665">t</span><span class="op" id="7943666">.</span><span class="ident" id="7943667">Fatalf</span><span class="op" id="7943673">(</span><span class="string" id="7943674">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943701">,</span>&nbsp;<span class="ident" id="7943703">err</span><span class="op" id="7943706">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943712">ln</span><span class="op" id="7943714">,</span>&nbsp;<span class="ident" id="7943716">err</span>&nbsp;<span class="op" id="7943720">:=</span>&nbsp;<span class="ident" id="7943723">ListenTCP</span><span class="op" id="7943732">(</span><span class="string" id="7943733">&#34;tcp4&#34;</span><span class="op" id="7943739">,</span>&nbsp;<span class="ident" id="7943741">la</span><span class="op" id="7943743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943746">if</span>&nbsp;<span class="ident" id="7943749">err</span>&nbsp;<span class="op" id="7943753">!=</span>&nbsp;<span class="ident" id="7943756">nil</span>&nbsp;<span class="op" id="7943760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943764">t</span><span class="op" id="7943765">.</span><span class="ident" id="7943766">Fatalf</span><span class="op" id="7943772">(</span><span class="string" id="7943773">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943795">,</span>&nbsp;<span class="ident" id="7943797">err</span><span class="op" id="7943800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943803">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943806">defer</span>&nbsp;<span class="ident" id="7943812">ln</span><span class="op" id="7943814">.</span><span class="ident" id="7943815">Close</span><span class="op" id="7943820">(</span><span class="op" id="7943821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943824">ln</span><span class="op" id="7943826">.</span><span class="ident" id="7943827">Addr</span><span class="op" id="7943831">(</span><span class="op" id="7943832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943836">done</span>&nbsp;<span class="op" id="7943841">:=</span>&nbsp;<span class="builtinfunc" id="7943844">make</span><span class="op" id="7943848">(</span><span class="keyword" id="7943849">chan</span>&nbsp;<span class="builtintype" id="7943854">int</span><span class="op" id="7943857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943860">go</span>&nbsp;<span class="ident" id="7943863">transponder</span><span class="op" id="7943874">(</span><span class="ident" id="7943875">t</span><span class="op" id="7943876">,</span>&nbsp;<span class="ident" id="7943878">ln</span><span class="op" id="7943880">,</span>&nbsp;<span class="ident" id="7943882">done</span><span class="op" id="7943886">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943890">ra</span><span class="op" id="7943892">,</span>&nbsp;<span class="ident" id="7943894">err</span>&nbsp;<span class="op" id="7943898">:=</span>&nbsp;<span class="ident" id="7943901">ResolveTCPAddr</span><span class="op" id="7943915">(</span><span class="string" id="7943916">&#34;tcp4&#34;</span><span class="op" id="7943922">,</span>&nbsp;<span class="ident" id="7943924">ln</span><span class="op" id="7943926">.</span><span class="ident" id="7943927">Addr</span><span class="op" id="7943931">(</span><span class="op" id="7943932">)</span><span class="op" id="7943933">.</span><span class="ident" id="7943934">String</span><span class="op" id="7943940">(</span><span class="op" id="7943941">)</span><span class="op" id="7943942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943945">if</span>&nbsp;<span class="ident" id="7943948">err</span>&nbsp;<span class="op" id="7943952">!=</span>&nbsp;<span class="ident" id="7943955">nil</span>&nbsp;<span class="op" id="7943959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943963">t</span><span class="op" id="7943964">.</span><span class="ident" id="7943965">Fatalf</span><span class="op" id="7943971">(</span><span class="string" id="7943972">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7943999">,</span>&nbsp;<span class="ident" id="7944001">err</span><span class="op" id="7944004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944007">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944010">c</span><span class="op" id="7944011">,</span>&nbsp;<span class="ident" id="7944013">err</span>&nbsp;<span class="op" id="7944017">:=</span>&nbsp;<span class="ident" id="7944020">DialTCP</span><span class="op" id="7944027">(</span><span class="string" id="7944028">&#34;tcp4&#34;</span><span class="op" id="7944034">,</span>&nbsp;<span class="ident" id="7944036">nil</span><span class="op" id="7944039">,</span>&nbsp;<span class="ident" id="7944041">ra</span><span class="op" id="7944043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944046">if</span>&nbsp;<span class="ident" id="7944049">err</span>&nbsp;<span class="op" id="7944053">!=</span>&nbsp;<span class="ident" id="7944056">nil</span>&nbsp;<span class="op" id="7944060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944064">t</span><span class="op" id="7944065">.</span><span class="ident" id="7944066">Fatalf</span><span class="op" id="7944072">(</span><span class="string" id="7944073">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944093">,</span>&nbsp;<span class="ident" id="7944095">err</span><span class="op" id="7944098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944104">defer</span>&nbsp;<span class="ident" id="7944110">c</span><span class="op" id="7944111">.</span><span class="ident" id="7944112">Close</span><span class="op" id="7944117">(</span><span class="op" id="7944118">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944121">c</span><span class="op" id="7944122">.</span><span class="ident" id="7944123">SetKeepAlive</span><span class="op" id="7944135">(</span><span class="builtintype" id="7944136">false</span><span class="op" id="7944141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944144">c</span><span class="op" id="7944145">.</span><span class="ident" id="7944146">SetKeepAlivePeriod</span><span class="op" id="7944164">(</span><span class="num" id="7944165">3</span>&nbsp;<span class="op" id="7944167">*</span>&nbsp;<span class="ident" id="7944169">time</span><span class="op" id="7944173">.</span><span class="ident" id="7944174">Second</span><span class="op" id="7944180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944183">c</span><span class="op" id="7944184">.</span><span class="ident" id="7944185">SetLinger</span><span class="op" id="7944194">(</span><span class="num" id="7944195">0</span><span class="op" id="7944196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944199">c</span><span class="op" id="7944200">.</span><span class="ident" id="7944201">SetNoDelay</span><span class="op" id="7944211">(</span><span class="builtintype" id="7944212">false</span><span class="op" id="7944217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944220">c</span><span class="op" id="7944221">.</span><span class="ident" id="7944222">LocalAddr</span><span class="op" id="7944231">(</span><span class="op" id="7944232">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944235">c</span><span class="op" id="7944236">.</span><span class="ident" id="7944237">RemoteAddr</span><span class="op" id="7944247">(</span><span class="op" id="7944248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944251">c</span><span class="op" id="7944252">.</span><span class="ident" id="7944253">SetDeadline</span><span class="op" id="7944264">(</span><span class="ident" id="7944265">time</span><span class="op" id="7944269">.</span><span class="ident" id="7944270">Now</span><span class="op" id="7944273">(</span><span class="op" id="7944274">)</span><span class="op" id="7944275">.</span><span class="ident" id="7944276">Add</span><span class="op" id="7944279">(</span><span class="ident" id="7944280">someTimeout</span><span class="op" id="7944291">)</span><span class="op" id="7944292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944295">c</span><span class="op" id="7944296">.</span><span class="ident" id="7944297">SetReadDeadline</span><span class="op" id="7944312">(</span><span class="ident" id="7944313">time</span><span class="op" id="7944317">.</span><span class="ident" id="7944318">Now</span><span class="op" id="7944321">(</span><span class="op" id="7944322">)</span><span class="op" id="7944323">.</span><span class="ident" id="7944324">Add</span><span class="op" id="7944327">(</span><span class="ident" id="7944328">someTimeout</span><span class="op" id="7944339">)</span><span class="op" id="7944340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944343">c</span><span class="op" id="7944344">.</span><span class="ident" id="7944345">SetWriteDeadline</span><span class="op" id="7944361">(</span><span class="ident" id="7944362">time</span><span class="op" id="7944366">.</span><span class="ident" id="7944367">Now</span><span class="op" id="7944370">(</span><span class="op" id="7944371">)</span><span class="op" id="7944372">.</span><span class="ident" id="7944373">Add</span><span class="op" id="7944376">(</span><span class="ident" id="7944377">someTimeout</span><span class="op" id="7944388">)</span><span class="op" id="7944389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944393">if</span>&nbsp;<span class="ident" id="7944396">_</span><span class="op" id="7944397">,</span>&nbsp;<span class="ident" id="7944399">err</span>&nbsp;<span class="op" id="7944403">:=</span>&nbsp;<span class="ident" id="7944406">c</span><span class="op" id="7944407">.</span><span class="ident" id="7944408">Write</span><span class="op" id="7944413">(</span><span class="op" id="7944414">[</span><span class="op" id="7944415">]</span><span class="builtintype" id="7944416">byte</span><span class="op" id="7944420">(</span><span class="string" id="7944421">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="7944435">)</span><span class="op" id="7944436">)</span><span class="op" id="7944437">;</span>&nbsp;<span class="ident" id="7944439">err</span>&nbsp;<span class="op" id="7944443">!=</span>&nbsp;<span class="ident" id="7944446">nil</span>&nbsp;<span class="op" id="7944450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944454">t</span><span class="op" id="7944455">.</span><span class="ident" id="7944456">Fatalf</span><span class="op" id="7944462">(</span><span class="string" id="7944463">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944489">,</span>&nbsp;<span class="ident" id="7944491">err</span><span class="op" id="7944494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944500">rb</span>&nbsp;<span class="op" id="7944503">:=</span>&nbsp;<span class="builtinfunc" id="7944506">make</span><span class="op" id="7944510">(</span><span class="op" id="7944511">[</span><span class="op" id="7944512">]</span><span class="builtintype" id="7944513">byte</span><span class="op" id="7944517">,</span>&nbsp;<span class="num" id="7944519">128</span><span class="op" id="7944522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944525">if</span>&nbsp;<span class="ident" id="7944528">_</span><span class="op" id="7944529">,</span>&nbsp;<span class="ident" id="7944531">err</span>&nbsp;<span class="op" id="7944535">:=</span>&nbsp;<span class="ident" id="7944538">c</span><span class="op" id="7944539">.</span><span class="ident" id="7944540">Read</span><span class="op" id="7944544">(</span><span class="ident" id="7944545">rb</span><span class="op" id="7944547">)</span><span class="op" id="7944548">;</span>&nbsp;<span class="ident" id="7944550">err</span>&nbsp;<span class="op" id="7944554">!=</span>&nbsp;<span class="ident" id="7944557">nil</span>&nbsp;<span class="op" id="7944561">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944565">t</span><span class="op" id="7944566">.</span><span class="ident" id="7944567">Fatalf</span><span class="op" id="7944573">(</span><span class="string" id="7944574">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944599">,</span>&nbsp;<span class="ident" id="7944601">err</span><span class="op" id="7944604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944611">&lt;-</span><span class="ident" id="7944613">done</span><br>
<span class="lineno"></span><span class="op" id="7944618">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7944621">func</span>&nbsp;<span class="ident" id="7944626">TestUDPConnSpecificMethods</span><span class="op" id="7944652">(</span><span class="ident" id="7944653">t</span>&nbsp;<span class="op" id="7944655">*</span><span class="ident" id="7944656">testing</span><span class="op" id="7944663">.</span><span class="ident" id="7944664">T</span><span class="op" id="7944665">)</span>&nbsp;<span class="op" id="7944667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944670">la</span><span class="op" id="7944672">,</span>&nbsp;<span class="ident" id="7944674">err</span>&nbsp;<span class="op" id="7944678">:=</span>&nbsp;<span class="ident" id="7944681">ResolveUDPAddr</span><span class="op" id="7944695">(</span><span class="string" id="7944696">&#34;udp4&#34;</span><span class="op" id="7944702">,</span>&nbsp;<span class="string" id="7944704">&#34;127.0.0.1:0&#34;</span><span class="op" id="7944717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944720">if</span>&nbsp;<span class="ident" id="7944723">err</span>&nbsp;<span class="op" id="7944727">!=</span>&nbsp;<span class="ident" id="7944730">nil</span>&nbsp;<span class="op" id="7944734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944738">t</span><span class="op" id="7944739">.</span><span class="ident" id="7944740">Fatalf</span><span class="op" id="7944746">(</span><span class="string" id="7944747">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944774">,</span>&nbsp;<span class="ident" id="7944776">err</span><span class="op" id="7944779">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944785">c</span><span class="op" id="7944786">,</span>&nbsp;<span class="ident" id="7944788">err</span>&nbsp;<span class="op" id="7944792">:=</span>&nbsp;<span class="ident" id="7944795">ListenUDP</span><span class="op" id="7944804">(</span><span class="string" id="7944805">&#34;udp4&#34;</span><span class="op" id="7944811">,</span>&nbsp;<span class="ident" id="7944813">la</span><span class="op" id="7944815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944818">if</span>&nbsp;<span class="ident" id="7944821">err</span>&nbsp;<span class="op" id="7944825">!=</span>&nbsp;<span class="ident" id="7944828">nil</span>&nbsp;<span class="op" id="7944832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944836">t</span><span class="op" id="7944837">.</span><span class="ident" id="7944838">Fatalf</span><span class="op" id="7944844">(</span><span class="string" id="7944845">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7944867">,</span>&nbsp;<span class="ident" id="7944869">err</span><span class="op" id="7944872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944875">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944878">defer</span>&nbsp;<span class="ident" id="7944884">c</span><span class="op" id="7944885">.</span><span class="ident" id="7944886">Close</span><span class="op" id="7944891">(</span><span class="op" id="7944892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944895">c</span><span class="op" id="7944896">.</span><span class="ident" id="7944897">LocalAddr</span><span class="op" id="7944906">(</span><span class="op" id="7944907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944910">c</span><span class="op" id="7944911">.</span><span class="ident" id="7944912">RemoteAddr</span><span class="op" id="7944922">(</span><span class="op" id="7944923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944926">c</span><span class="op" id="7944927">.</span><span class="ident" id="7944928">SetDeadline</span><span class="op" id="7944939">(</span><span class="ident" id="7944940">time</span><span class="op" id="7944944">.</span><span class="ident" id="7944945">Now</span><span class="op" id="7944948">(</span><span class="op" id="7944949">)</span><span class="op" id="7944950">.</span><span class="ident" id="7944951">Add</span><span class="op" id="7944954">(</span><span class="ident" id="7944955">someTimeout</span><span class="op" id="7944966">)</span><span class="op" id="7944967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944970">c</span><span class="op" id="7944971">.</span><span class="ident" id="7944972">SetReadDeadline</span><span class="op" id="7944987">(</span><span class="ident" id="7944988">time</span><span class="op" id="7944992">.</span><span class="ident" id="7944993">Now</span><span class="op" id="7944996">(</span><span class="op" id="7944997">)</span><span class="op" id="7944998">.</span><span class="ident" id="7944999">Add</span><span class="op" id="7945002">(</span><span class="ident" id="7945003">someTimeout</span><span class="op" id="7945014">)</span><span class="op" id="7945015">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945018">c</span><span class="op" id="7945019">.</span><span class="ident" id="7945020">SetWriteDeadline</span><span class="op" id="7945036">(</span><span class="ident" id="7945037">time</span><span class="op" id="7945041">.</span><span class="ident" id="7945042">Now</span><span class="op" id="7945045">(</span><span class="op" id="7945046">)</span><span class="op" id="7945047">.</span><span class="ident" id="7945048">Add</span><span class="op" id="7945051">(</span><span class="ident" id="7945052">someTimeout</span><span class="op" id="7945063">)</span><span class="op" id="7945064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945067">c</span><span class="op" id="7945068">.</span><span class="ident" id="7945069">SetReadBuffer</span><span class="op" id="7945082">(</span><span class="num" id="7945083">2048</span><span class="op" id="7945087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945090">c</span><span class="op" id="7945091">.</span><span class="ident" id="7945092">SetWriteBuffer</span><span class="op" id="7945106">(</span><span class="num" id="7945107">2048</span><span class="op" id="7945111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945115">wb</span>&nbsp;<span class="op" id="7945118">:=</span>&nbsp;<span class="op" id="7945121">[</span><span class="op" id="7945122">]</span><span class="builtintype" id="7945123">byte</span><span class="op" id="7945127">(</span><span class="string" id="7945128">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="7945142">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945145">rb</span>&nbsp;<span class="op" id="7945148">:=</span>&nbsp;<span class="builtinfunc" id="7945151">make</span><span class="op" id="7945155">(</span><span class="op" id="7945156">[</span><span class="op" id="7945157">]</span><span class="builtintype" id="7945158">byte</span><span class="op" id="7945162">,</span>&nbsp;<span class="num" id="7945164">128</span><span class="op" id="7945167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945170">if</span>&nbsp;<span class="ident" id="7945173">_</span><span class="op" id="7945174">,</span>&nbsp;<span class="ident" id="7945176">err</span>&nbsp;<span class="op" id="7945180">:=</span>&nbsp;<span class="ident" id="7945183">c</span><span class="op" id="7945184">.</span><span class="ident" id="7945185">WriteToUDP</span><span class="op" id="7945195">(</span><span class="ident" id="7945196">wb</span><span class="op" id="7945198">,</span>&nbsp;<span class="ident" id="7945200">c</span><span class="op" id="7945201">.</span><span class="ident" id="7945202">LocalAddr</span><span class="op" id="7945211">(</span><span class="op" id="7945212">)</span><span class="op" id="7945213">.</span><span class="op" id="7945214">(</span><span class="op" id="7945215">*</span><span class="ident" id="7945216">UDPAddr</span><span class="op" id="7945223">)</span><span class="op" id="7945224">)</span><span class="op" id="7945225">;</span>&nbsp;<span class="ident" id="7945227">err</span>&nbsp;<span class="op" id="7945231">!=</span>&nbsp;<span class="ident" id="7945234">nil</span>&nbsp;<span class="op" id="7945238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945242">t</span><span class="op" id="7945243">.</span><span class="ident" id="7945244">Fatalf</span><span class="op" id="7945250">(</span><span class="string" id="7945251">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945282">,</span>&nbsp;<span class="ident" id="7945284">err</span><span class="op" id="7945287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945293">if</span>&nbsp;<span class="ident" id="7945296">_</span><span class="op" id="7945297">,</span>&nbsp;<span class="ident" id="7945299">_</span><span class="op" id="7945300">,</span>&nbsp;<span class="ident" id="7945302">err</span>&nbsp;<span class="op" id="7945306">:=</span>&nbsp;<span class="ident" id="7945309">c</span><span class="op" id="7945310">.</span><span class="ident" id="7945311">ReadFromUDP</span><span class="op" id="7945322">(</span><span class="ident" id="7945323">rb</span><span class="op" id="7945325">)</span><span class="op" id="7945326">;</span>&nbsp;<span class="ident" id="7945328">err</span>&nbsp;<span class="op" id="7945332">!=</span>&nbsp;<span class="ident" id="7945335">nil</span>&nbsp;<span class="op" id="7945339">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945343">t</span><span class="op" id="7945344">.</span><span class="ident" id="7945345">Fatalf</span><span class="op" id="7945351">(</span><span class="string" id="7945352">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945384">,</span>&nbsp;<span class="ident" id="7945386">err</span><span class="op" id="7945389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945395">if</span>&nbsp;<span class="ident" id="7945398">_</span><span class="op" id="7945399">,</span>&nbsp;<span class="ident" id="7945401">_</span><span class="op" id="7945402">,</span>&nbsp;<span class="ident" id="7945404">err</span>&nbsp;<span class="op" id="7945408">:=</span>&nbsp;<span class="ident" id="7945411">c</span><span class="op" id="7945412">.</span><span class="ident" id="7945413">WriteMsgUDP</span><span class="op" id="7945424">(</span><span class="ident" id="7945425">wb</span><span class="op" id="7945427">,</span>&nbsp;<span class="ident" id="7945429">nil</span><span class="op" id="7945432">,</span>&nbsp;<span class="ident" id="7945434">c</span><span class="op" id="7945435">.</span><span class="ident" id="7945436">LocalAddr</span><span class="op" id="7945445">(</span><span class="op" id="7945446">)</span><span class="op" id="7945447">.</span><span class="op" id="7945448">(</span><span class="op" id="7945449">*</span><span class="ident" id="7945450">UDPAddr</span><span class="op" id="7945457">)</span><span class="op" id="7945458">)</span><span class="op" id="7945459">;</span>&nbsp;<span class="ident" id="7945461">err</span>&nbsp;<span class="op" id="7945465">!=</span>&nbsp;<span class="ident" id="7945468">nil</span>&nbsp;<span class="op" id="7945472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945476">condFatalf</span><span class="op" id="7945486">(</span><span class="ident" id="7945487">t</span><span class="op" id="7945488">,</span>&nbsp;<span class="string" id="7945490">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945522">,</span>&nbsp;<span class="ident" id="7945524">err</span><span class="op" id="7945527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945530">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945533">if</span>&nbsp;<span class="ident" id="7945536">_</span><span class="op" id="7945537">,</span>&nbsp;<span class="ident" id="7945539">_</span><span class="op" id="7945540">,</span>&nbsp;<span class="ident" id="7945542">_</span><span class="op" id="7945543">,</span>&nbsp;<span class="ident" id="7945545">_</span><span class="op" id="7945546">,</span>&nbsp;<span class="ident" id="7945548">err</span>&nbsp;<span class="op" id="7945552">:=</span>&nbsp;<span class="ident" id="7945555">c</span><span class="op" id="7945556">.</span><span class="ident" id="7945557">ReadMsgUDP</span><span class="op" id="7945567">(</span><span class="ident" id="7945568">rb</span><span class="op" id="7945570">,</span>&nbsp;<span class="ident" id="7945572">nil</span><span class="op" id="7945575">)</span><span class="op" id="7945576">;</span>&nbsp;<span class="ident" id="7945578">err</span>&nbsp;<span class="op" id="7945582">!=</span>&nbsp;<span class="ident" id="7945585">nil</span>&nbsp;<span class="op" id="7945589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945593">condFatalf</span><span class="op" id="7945603">(</span><span class="ident" id="7945604">t</span><span class="op" id="7945605">,</span>&nbsp;<span class="string" id="7945607">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945638">,</span>&nbsp;<span class="ident" id="7945640">err</span><span class="op" id="7945643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945650">if</span>&nbsp;<span class="ident" id="7945653">f</span><span class="op" id="7945654">,</span>&nbsp;<span class="ident" id="7945656">err</span>&nbsp;<span class="op" id="7945660">:=</span>&nbsp;<span class="ident" id="7945663">c</span><span class="op" id="7945664">.</span><span class="ident" id="7945665">File</span><span class="op" id="7945669">(</span><span class="op" id="7945670">)</span><span class="op" id="7945671">;</span>&nbsp;<span class="ident" id="7945673">err</span>&nbsp;<span class="op" id="7945677">!=</span>&nbsp;<span class="ident" id="7945680">nil</span>&nbsp;<span class="op" id="7945684">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945688">condFatalf</span><span class="op" id="7945698">(</span><span class="ident" id="7945699">t</span><span class="op" id="7945700">,</span>&nbsp;<span class="string" id="7945702">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7945727">,</span>&nbsp;<span class="ident" id="7945729">err</span><span class="op" id="7945732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945735">}</span>&nbsp;<span class="keyword" id="7945737">else</span>&nbsp;<span class="op" id="7945742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945746">f</span><span class="op" id="7945747">.</span><span class="ident" id="7945748">Close</span><span class="op" id="7945753">(</span><span class="op" id="7945754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945761">defer</span>&nbsp;<span class="keyword" id="7945767">func</span><span class="op" id="7945771">(</span><span class="op" id="7945772">)</span>&nbsp;<span class="op" id="7945774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945778">if</span>&nbsp;<span class="ident" id="7945781">p</span>&nbsp;<span class="op" id="7945783">:=</span>&nbsp;<span class="builtinfunc" id="7945786">recover</span><span class="op" id="7945793">(</span><span class="op" id="7945794">)</span><span class="op" id="7945795">;</span>&nbsp;<span class="ident" id="7945797">p</span>&nbsp;<span class="op" id="7945799">!=</span>&nbsp;<span class="ident" id="7945802">nil</span>&nbsp;<span class="op" id="7945806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945811">t</span><span class="op" id="7945812">.</span><span class="ident" id="7945813">Fatalf</span><span class="op" id="7945819">(</span><span class="string" id="7945820">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7945868">,</span>&nbsp;<span class="ident" id="7945870">p</span><span class="op" id="7945871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945878">}</span><span class="op" id="7945879">(</span><span class="op" id="7945880">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945884">c</span><span class="op" id="7945885">.</span><span class="ident" id="7945886">WriteToUDP</span><span class="op" id="7945896">(</span><span class="ident" id="7945897">wb</span><span class="op" id="7945899">,</span>&nbsp;<span class="ident" id="7945901">nil</span><span class="op" id="7945904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945907">c</span><span class="op" id="7945908">.</span><span class="ident" id="7945909">WriteMsgUDP</span><span class="op" id="7945920">(</span><span class="ident" id="7945921">wb</span><span class="op" id="7945923">,</span>&nbsp;<span class="ident" id="7945925">nil</span><span class="op" id="7945928">,</span>&nbsp;<span class="ident" id="7945930">nil</span><span class="op" id="7945933">)</span><br>
<span class="lineno"></span><span class="op" id="7945935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7945938">func</span>&nbsp;<span class="ident" id="7945943">TestIPConnSpecificMethods</span><span class="op" id="7945968">(</span><span class="ident" id="7945969">t</span>&nbsp;<span class="op" id="7945971">*</span><span class="ident" id="7945972">testing</span><span class="op" id="7945979">.</span><span class="ident" id="7945980">T</span><span class="op" id="7945981">)</span>&nbsp;<span class="op" id="7945983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945986">if</span>&nbsp;<span class="ident" id="7945989">skip</span><span class="op" id="7945993">,</span>&nbsp;<span class="ident" id="7945995">skipmsg</span>&nbsp;<span class="op" id="7946003">:=</span>&nbsp;<span class="ident" id="7946006">skipRawSocketTest</span><span class="op" id="7946023">(</span><span class="ident" id="7946024">t</span><span class="op" id="7946025">)</span><span class="op" id="7946026">;</span>&nbsp;<span class="ident" id="7946028">skip</span>&nbsp;<span class="op" id="7946033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946037">t</span><span class="op" id="7946038">.</span><span class="ident" id="7946039">Skip</span><span class="op" id="7946043">(</span><span class="ident" id="7946044">skipmsg</span><span class="op" id="7946051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946058">la</span><span class="op" id="7946060">,</span>&nbsp;<span class="ident" id="7946062">err</span>&nbsp;<span class="op" id="7946066">:=</span>&nbsp;<span class="ident" id="7946069">ResolveIPAddr</span><span class="op" id="7946082">(</span><span class="string" id="7946083">&#34;ip4&#34;</span><span class="op" id="7946088">,</span>&nbsp;<span class="string" id="7946090">&#34;127.0.0.1&#34;</span><span class="op" id="7946101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946104">if</span>&nbsp;<span class="ident" id="7946107">err</span>&nbsp;<span class="op" id="7946111">!=</span>&nbsp;<span class="ident" id="7946114">nil</span>&nbsp;<span class="op" id="7946118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946122">t</span><span class="op" id="7946123">.</span><span class="ident" id="7946124">Fatalf</span><span class="op" id="7946130">(</span><span class="string" id="7946131">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946157">,</span>&nbsp;<span class="ident" id="7946159">err</span><span class="op" id="7946162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946168">c</span><span class="op" id="7946169">,</span>&nbsp;<span class="ident" id="7946171">err</span>&nbsp;<span class="op" id="7946175">:=</span>&nbsp;<span class="ident" id="7946178">ListenIP</span><span class="op" id="7946186">(</span><span class="string" id="7946187">&#34;ip4:icmp&#34;</span><span class="op" id="7946197">,</span>&nbsp;<span class="ident" id="7946199">la</span><span class="op" id="7946201">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946204">if</span>&nbsp;<span class="ident" id="7946207">err</span>&nbsp;<span class="op" id="7946211">!=</span>&nbsp;<span class="ident" id="7946214">nil</span>&nbsp;<span class="op" id="7946218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946222">t</span><span class="op" id="7946223">.</span><span class="ident" id="7946224">Fatalf</span><span class="op" id="7946230">(</span><span class="string" id="7946231">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946252">,</span>&nbsp;<span class="ident" id="7946254">err</span><span class="op" id="7946257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946263">defer</span>&nbsp;<span class="ident" id="7946269">c</span><span class="op" id="7946270">.</span><span class="ident" id="7946271">Close</span><span class="op" id="7946276">(</span><span class="op" id="7946277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946280">c</span><span class="op" id="7946281">.</span><span class="ident" id="7946282">LocalAddr</span><span class="op" id="7946291">(</span><span class="op" id="7946292">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946295">c</span><span class="op" id="7946296">.</span><span class="ident" id="7946297">RemoteAddr</span><span class="op" id="7946307">(</span><span class="op" id="7946308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946311">c</span><span class="op" id="7946312">.</span><span class="ident" id="7946313">SetDeadline</span><span class="op" id="7946324">(</span><span class="ident" id="7946325">time</span><span class="op" id="7946329">.</span><span class="ident" id="7946330">Now</span><span class="op" id="7946333">(</span><span class="op" id="7946334">)</span><span class="op" id="7946335">.</span><span class="ident" id="7946336">Add</span><span class="op" id="7946339">(</span><span class="ident" id="7946340">someTimeout</span><span class="op" id="7946351">)</span><span class="op" id="7946352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946355">c</span><span class="op" id="7946356">.</span><span class="ident" id="7946357">SetReadDeadline</span><span class="op" id="7946372">(</span><span class="ident" id="7946373">time</span><span class="op" id="7946377">.</span><span class="ident" id="7946378">Now</span><span class="op" id="7946381">(</span><span class="op" id="7946382">)</span><span class="op" id="7946383">.</span><span class="ident" id="7946384">Add</span><span class="op" id="7946387">(</span><span class="ident" id="7946388">someTimeout</span><span class="op" id="7946399">)</span><span class="op" id="7946400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946403">c</span><span class="op" id="7946404">.</span><span class="ident" id="7946405">SetWriteDeadline</span><span class="op" id="7946421">(</span><span class="ident" id="7946422">time</span><span class="op" id="7946426">.</span><span class="ident" id="7946427">Now</span><span class="op" id="7946430">(</span><span class="op" id="7946431">)</span><span class="op" id="7946432">.</span><span class="ident" id="7946433">Add</span><span class="op" id="7946436">(</span><span class="ident" id="7946437">someTimeout</span><span class="op" id="7946448">)</span><span class="op" id="7946449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946452">c</span><span class="op" id="7946453">.</span><span class="ident" id="7946454">SetReadBuffer</span><span class="op" id="7946467">(</span><span class="num" id="7946468">2048</span><span class="op" id="7946472">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946475">c</span><span class="op" id="7946476">.</span><span class="ident" id="7946477">SetWriteBuffer</span><span class="op" id="7946491">(</span><span class="num" id="7946492">2048</span><span class="op" id="7946496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946500">wb</span><span class="op" id="7946502">,</span>&nbsp;<span class="ident" id="7946504">err</span>&nbsp;<span class="op" id="7946508">:=</span>&nbsp;<span class="op" id="7946511">(</span><span class="op" id="7946512">&amp;</span><span class="ident" id="7946513">icmpMessage</span><span class="op" id="7946524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946528">Type</span><span class="op" id="7946532">:</span>&nbsp;<span class="ident" id="7946534">icmpv4EchoRequest</span><span class="op" id="7946551">,</span>&nbsp;<span class="ident" id="7946553">Code</span><span class="op" id="7946557">:</span>&nbsp;<span class="num" id="7946559">0</span><span class="op" id="7946560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946564">Body</span><span class="op" id="7946568">:</span>&nbsp;<span class="op" id="7946570">&amp;</span><span class="ident" id="7946571">icmpEcho</span><span class="op" id="7946579">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946584">ID</span><span class="op" id="7946586">:</span>&nbsp;<span class="ident" id="7946588">os</span><span class="op" id="7946590">.</span><span class="ident" id="7946591">Getpid</span><span class="op" id="7946597">(</span><span class="op" id="7946598">)</span>&nbsp;<span class="op" id="7946600">&amp;</span>&nbsp;<span class="num" id="7946602">0xffff</span><span class="op" id="7946608">,</span>&nbsp;<span class="ident" id="7946610">Seq</span><span class="op" id="7946613">:</span>&nbsp;<span class="num" id="7946615">1</span><span class="op" id="7946616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946621">Data</span><span class="op" id="7946625">:</span>&nbsp;<span class="op" id="7946627">[</span><span class="op" id="7946628">]</span><span class="builtintype" id="7946629">byte</span><span class="op" id="7946633">(</span><span class="string" id="7946634">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="7946648">)</span><span class="op" id="7946649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946653">}</span><span class="op" id="7946654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946657">}</span><span class="op" id="7946658">)</span><span class="op" id="7946659">.</span><span class="ident" id="7946660">Marshal</span><span class="op" id="7946667">(</span><span class="op" id="7946668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946671">if</span>&nbsp;<span class="ident" id="7946674">err</span>&nbsp;<span class="op" id="7946678">!=</span>&nbsp;<span class="ident" id="7946681">nil</span>&nbsp;<span class="op" id="7946685">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946689">t</span><span class="op" id="7946690">.</span><span class="ident" id="7946691">Fatalf</span><span class="op" id="7946697">(</span><span class="string" id="7946698">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946730">,</span>&nbsp;<span class="ident" id="7946732">err</span><span class="op" id="7946735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946741">rb</span>&nbsp;<span class="op" id="7946744">:=</span>&nbsp;<span class="builtinfunc" id="7946747">make</span><span class="op" id="7946751">(</span><span class="op" id="7946752">[</span><span class="op" id="7946753">]</span><span class="builtintype" id="7946754">byte</span><span class="op" id="7946758">,</span>&nbsp;<span class="num" id="7946760">20</span><span class="op" id="7946762">+</span><span class="builtinfunc" id="7946763">len</span><span class="op" id="7946766">(</span><span class="ident" id="7946767">wb</span><span class="op" id="7946769">)</span><span class="op" id="7946770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946773">if</span>&nbsp;<span class="ident" id="7946776">_</span><span class="op" id="7946777">,</span>&nbsp;<span class="ident" id="7946779">err</span>&nbsp;<span class="op" id="7946783">:=</span>&nbsp;<span class="ident" id="7946786">c</span><span class="op" id="7946787">.</span><span class="ident" id="7946788">WriteToIP</span><span class="op" id="7946797">(</span><span class="ident" id="7946798">wb</span><span class="op" id="7946800">,</span>&nbsp;<span class="ident" id="7946802">c</span><span class="op" id="7946803">.</span><span class="ident" id="7946804">LocalAddr</span><span class="op" id="7946813">(</span><span class="op" id="7946814">)</span><span class="op" id="7946815">.</span><span class="op" id="7946816">(</span><span class="op" id="7946817">*</span><span class="ident" id="7946818">IPAddr</span><span class="op" id="7946824">)</span><span class="op" id="7946825">)</span><span class="op" id="7946826">;</span>&nbsp;<span class="ident" id="7946828">err</span>&nbsp;<span class="op" id="7946832">!=</span>&nbsp;<span class="ident" id="7946835">nil</span>&nbsp;<span class="op" id="7946839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946843">t</span><span class="op" id="7946844">.</span><span class="ident" id="7946845">Fatalf</span><span class="op" id="7946851">(</span><span class="string" id="7946852">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946881">,</span>&nbsp;<span class="ident" id="7946883">err</span><span class="op" id="7946886">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946892">if</span>&nbsp;<span class="ident" id="7946895">_</span><span class="op" id="7946896">,</span>&nbsp;<span class="ident" id="7946898">_</span><span class="op" id="7946899">,</span>&nbsp;<span class="ident" id="7946901">err</span>&nbsp;<span class="op" id="7946905">:=</span>&nbsp;<span class="ident" id="7946908">c</span><span class="op" id="7946909">.</span><span class="ident" id="7946910">ReadFromIP</span><span class="op" id="7946920">(</span><span class="ident" id="7946921">rb</span><span class="op" id="7946923">)</span><span class="op" id="7946924">;</span>&nbsp;<span class="ident" id="7946926">err</span>&nbsp;<span class="op" id="7946930">!=</span>&nbsp;<span class="ident" id="7946933">nil</span>&nbsp;<span class="op" id="7946937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946941">t</span><span class="op" id="7946942">.</span><span class="ident" id="7946943">Fatalf</span><span class="op" id="7946949">(</span><span class="string" id="7946950">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7946980">,</span>&nbsp;<span class="ident" id="7946982">err</span><span class="op" id="7946985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946991">if</span>&nbsp;<span class="ident" id="7946994">_</span><span class="op" id="7946995">,</span>&nbsp;<span class="ident" id="7946997">_</span><span class="op" id="7946998">,</span>&nbsp;<span class="ident" id="7947000">err</span>&nbsp;<span class="op" id="7947004">:=</span>&nbsp;<span class="ident" id="7947007">c</span><span class="op" id="7947008">.</span><span class="ident" id="7947009">WriteMsgIP</span><span class="op" id="7947019">(</span><span class="ident" id="7947020">wb</span><span class="op" id="7947022">,</span>&nbsp;<span class="ident" id="7947024">nil</span><span class="op" id="7947027">,</span>&nbsp;<span class="ident" id="7947029">c</span><span class="op" id="7947030">.</span><span class="ident" id="7947031">LocalAddr</span><span class="op" id="7947040">(</span><span class="op" id="7947041">)</span><span class="op" id="7947042">.</span><span class="op" id="7947043">(</span><span class="op" id="7947044">*</span><span class="ident" id="7947045">IPAddr</span><span class="op" id="7947051">)</span><span class="op" id="7947052">)</span><span class="op" id="7947053">;</span>&nbsp;<span class="ident" id="7947055">err</span>&nbsp;<span class="op" id="7947059">!=</span>&nbsp;<span class="ident" id="7947062">nil</span>&nbsp;<span class="op" id="7947066">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947070">condFatalf</span><span class="op" id="7947080">(</span><span class="ident" id="7947081">t</span><span class="op" id="7947082">,</span>&nbsp;<span class="string" id="7947084">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947114">,</span>&nbsp;<span class="ident" id="7947116">err</span><span class="op" id="7947119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947125">if</span>&nbsp;<span class="ident" id="7947128">_</span><span class="op" id="7947129">,</span>&nbsp;<span class="ident" id="7947131">_</span><span class="op" id="7947132">,</span>&nbsp;<span class="ident" id="7947134">_</span><span class="op" id="7947135">,</span>&nbsp;<span class="ident" id="7947137">_</span><span class="op" id="7947138">,</span>&nbsp;<span class="ident" id="7947140">err</span>&nbsp;<span class="op" id="7947144">:=</span>&nbsp;<span class="ident" id="7947147">c</span><span class="op" id="7947148">.</span><span class="ident" id="7947149">ReadMsgIP</span><span class="op" id="7947158">(</span><span class="ident" id="7947159">rb</span><span class="op" id="7947161">,</span>&nbsp;<span class="ident" id="7947163">nil</span><span class="op" id="7947166">)</span><span class="op" id="7947167">;</span>&nbsp;<span class="ident" id="7947169">err</span>&nbsp;<span class="op" id="7947173">!=</span>&nbsp;<span class="ident" id="7947176">nil</span>&nbsp;<span class="op" id="7947180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947184">condFatalf</span><span class="op" id="7947194">(</span><span class="ident" id="7947195">t</span><span class="op" id="7947196">,</span>&nbsp;<span class="string" id="7947198">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947227">,</span>&nbsp;<span class="ident" id="7947229">err</span><span class="op" id="7947232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947235">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947239">if</span>&nbsp;<span class="ident" id="7947242">f</span><span class="op" id="7947243">,</span>&nbsp;<span class="ident" id="7947245">err</span>&nbsp;<span class="op" id="7947249">:=</span>&nbsp;<span class="ident" id="7947252">c</span><span class="op" id="7947253">.</span><span class="ident" id="7947254">File</span><span class="op" id="7947258">(</span><span class="op" id="7947259">)</span><span class="op" id="7947260">;</span>&nbsp;<span class="ident" id="7947262">err</span>&nbsp;<span class="op" id="7947266">!=</span>&nbsp;<span class="ident" id="7947269">nil</span>&nbsp;<span class="op" id="7947273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947277">condFatalf</span><span class="op" id="7947287">(</span><span class="ident" id="7947288">t</span><span class="op" id="7947289">,</span>&nbsp;<span class="string" id="7947291">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947315">,</span>&nbsp;<span class="ident" id="7947317">err</span><span class="op" id="7947320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947323">}</span>&nbsp;<span class="keyword" id="7947325">else</span>&nbsp;<span class="op" id="7947330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947334">f</span><span class="op" id="7947335">.</span><span class="ident" id="7947336">Close</span><span class="op" id="7947341">(</span><span class="op" id="7947342">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947349">defer</span>&nbsp;<span class="keyword" id="7947355">func</span><span class="op" id="7947359">(</span><span class="op" id="7947360">)</span>&nbsp;<span class="op" id="7947362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947366">if</span>&nbsp;<span class="ident" id="7947369">p</span>&nbsp;<span class="op" id="7947371">:=</span>&nbsp;<span class="builtinfunc" id="7947374">recover</span><span class="op" id="7947381">(</span><span class="op" id="7947382">)</span><span class="op" id="7947383">;</span>&nbsp;<span class="ident" id="7947385">p</span>&nbsp;<span class="op" id="7947387">!=</span>&nbsp;<span class="ident" id="7947390">nil</span>&nbsp;<span class="op" id="7947394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947399">t</span><span class="op" id="7947400">.</span><span class="ident" id="7947401">Fatalf</span><span class="op" id="7947407">(</span><span class="string" id="7947408">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7947453">,</span>&nbsp;<span class="ident" id="7947455">p</span><span class="op" id="7947456">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947463">}</span><span class="op" id="7947464">(</span><span class="op" id="7947465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947469">c</span><span class="op" id="7947470">.</span><span class="ident" id="7947471">WriteToIP</span><span class="op" id="7947480">(</span><span class="ident" id="7947481">wb</span><span class="op" id="7947483">,</span>&nbsp;<span class="ident" id="7947485">nil</span><span class="op" id="7947488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947491">c</span><span class="op" id="7947492">.</span><span class="ident" id="7947493">WriteMsgIP</span><span class="op" id="7947503">(</span><span class="ident" id="7947504">wb</span><span class="op" id="7947506">,</span>&nbsp;<span class="ident" id="7947508">nil</span><span class="op" id="7947511">,</span>&nbsp;<span class="ident" id="7947513">nil</span><span class="op" id="7947516">)</span><br>
<span class="lineno">235</span><span class="op" id="7947518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7947521">func</span>&nbsp;<span class="ident" id="7947526">TestUnixListenerSpecificMethods</span><span class="op" id="7947557">(</span><span class="ident" id="7947558">t</span>&nbsp;<span class="op" id="7947560">*</span><span class="ident" id="7947561">testing</span><span class="op" id="7947568">.</span><span class="ident" id="7947569">T</span><span class="op" id="7947570">)</span>&nbsp;<span class="op" id="7947572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947575">switch</span>&nbsp;<span class="ident" id="7947582">runtime</span><span class="op" id="7947589">.</span><span class="ident" id="7947590">GOOS</span>&nbsp;<span class="op" id="7947595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947598">case</span>&nbsp;<span class="string" id="7947603">&#34;nacl&#34;</span><span class="op" id="7947609">,</span>&nbsp;<span class="string" id="7947611">&#34;plan9&#34;</span><span class="op" id="7947618">,</span>&nbsp;<span class="string" id="7947620">&#34;windows&#34;</span><span class="op" id="7947629">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947633">t</span><span class="op" id="7947634">.</span><span class="ident" id="7947635">Skipf</span><span class="op" id="7947640">(</span><span class="string" id="7947641">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7947662">,</span>&nbsp;<span class="ident" id="7947664">runtime</span><span class="op" id="7947671">.</span><span class="ident" id="7947672">GOOS</span><span class="op" id="7947676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947683">addr</span>&nbsp;<span class="op" id="7947688">:=</span>&nbsp;<span class="ident" id="7947691">testUnixAddr</span><span class="op" id="7947703">(</span><span class="op" id="7947704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947707">la</span><span class="op" id="7947709">,</span>&nbsp;<span class="ident" id="7947711">err</span>&nbsp;<span class="op" id="7947715">:=</span>&nbsp;<span class="ident" id="7947718">ResolveUnixAddr</span><span class="op" id="7947733">(</span><span class="string" id="7947734">&#34;unix&#34;</span><span class="op" id="7947740">,</span>&nbsp;<span class="ident" id="7947742">addr</span><span class="op" id="7947746">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947749">if</span>&nbsp;<span class="ident" id="7947752">err</span>&nbsp;<span class="op" id="7947756">!=</span>&nbsp;<span class="ident" id="7947759">nil</span>&nbsp;<span class="op" id="7947763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947767">t</span><span class="op" id="7947768">.</span><span class="ident" id="7947769">Fatalf</span><span class="op" id="7947775">(</span><span class="string" id="7947776">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947804">,</span>&nbsp;<span class="ident" id="7947806">err</span><span class="op" id="7947809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947815">ln</span><span class="op" id="7947817">,</span>&nbsp;<span class="ident" id="7947819">err</span>&nbsp;<span class="op" id="7947823">:=</span>&nbsp;<span class="ident" id="7947826">ListenUnix</span><span class="op" id="7947836">(</span><span class="string" id="7947837">&#34;unix&#34;</span><span class="op" id="7947843">,</span>&nbsp;<span class="ident" id="7947845">la</span><span class="op" id="7947847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947850">if</span>&nbsp;<span class="ident" id="7947853">err</span>&nbsp;<span class="op" id="7947857">!=</span>&nbsp;<span class="ident" id="7947860">nil</span>&nbsp;<span class="op" id="7947864">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947868">t</span><span class="op" id="7947869">.</span><span class="ident" id="7947870">Fatalf</span><span class="op" id="7947876">(</span><span class="string" id="7947877">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7947900">,</span>&nbsp;<span class="ident" id="7947902">err</span><span class="op" id="7947905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947911">defer</span>&nbsp;<span class="ident" id="7947917">ln</span><span class="op" id="7947919">.</span><span class="ident" id="7947920">Close</span><span class="op" id="7947925">(</span><span class="op" id="7947926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947929">defer</span>&nbsp;<span class="ident" id="7947935">os</span><span class="op" id="7947937">.</span><span class="ident" id="7947938">Remove</span><span class="op" id="7947944">(</span><span class="ident" id="7947945">addr</span><span class="op" id="7947949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947952">ln</span><span class="op" id="7947954">.</span><span class="ident" id="7947955">Addr</span><span class="op" id="7947959">(</span><span class="op" id="7947960">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947963">ln</span><span class="op" id="7947965">.</span><span class="ident" id="7947966">SetDeadline</span><span class="op" id="7947977">(</span><span class="ident" id="7947978">time</span><span class="op" id="7947982">.</span><span class="ident" id="7947983">Now</span><span class="op" id="7947986">(</span><span class="op" id="7947987">)</span><span class="op" id="7947988">.</span><span class="ident" id="7947989">Add</span><span class="op" id="7947992">(</span><span class="num" id="7947993">30</span>&nbsp;<span class="op" id="7947996">*</span>&nbsp;<span class="ident" id="7947998">time</span><span class="op" id="7948002">.</span><span class="ident" id="7948003">Nanosecond</span><span class="op" id="7948013">)</span><span class="op" id="7948014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948018">if</span>&nbsp;<span class="ident" id="7948021">c</span><span class="op" id="7948022">,</span>&nbsp;<span class="ident" id="7948024">err</span>&nbsp;<span class="op" id="7948028">:=</span>&nbsp;<span class="ident" id="7948031">ln</span><span class="op" id="7948033">.</span><span class="ident" id="7948034">Accept</span><span class="op" id="7948040">(</span><span class="op" id="7948041">)</span><span class="op" id="7948042">;</span>&nbsp;<span class="ident" id="7948044">err</span>&nbsp;<span class="op" id="7948048">!=</span>&nbsp;<span class="ident" id="7948051">nil</span>&nbsp;<span class="op" id="7948055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948059">if</span>&nbsp;<span class="op" id="7948062">!</span><span class="ident" id="7948063">err</span><span class="op" id="7948066">.</span><span class="op" id="7948067">(</span><span class="ident" id="7948068">Error</span><span class="op" id="7948073">)</span><span class="op" id="7948074">.</span><span class="ident" id="7948075">Timeout</span><span class="op" id="7948082">(</span><span class="op" id="7948083">)</span>&nbsp;<span class="op" id="7948085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948090">t</span><span class="op" id="7948091">.</span><span class="ident" id="7948092">Fatalf</span><span class="op" id="7948098">(</span><span class="string" id="7948099">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948131">,</span>&nbsp;<span class="ident" id="7948133">err</span><span class="op" id="7948136">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948143">}</span>&nbsp;<span class="keyword" id="7948145">else</span>&nbsp;<span class="op" id="7948150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948154">c</span><span class="op" id="7948155">.</span><span class="ident" id="7948156">Close</span><span class="op" id="7948161">(</span><span class="op" id="7948162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948168">if</span>&nbsp;<span class="ident" id="7948171">c</span><span class="op" id="7948172">,</span>&nbsp;<span class="ident" id="7948174">err</span>&nbsp;<span class="op" id="7948178">:=</span>&nbsp;<span class="ident" id="7948181">ln</span><span class="op" id="7948183">.</span><span class="ident" id="7948184">AcceptUnix</span><span class="op" id="7948194">(</span><span class="op" id="7948195">)</span><span class="op" id="7948196">;</span>&nbsp;<span class="ident" id="7948198">err</span>&nbsp;<span class="op" id="7948202">!=</span>&nbsp;<span class="ident" id="7948205">nil</span>&nbsp;<span class="op" id="7948209">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948213">if</span>&nbsp;<span class="op" id="7948216">!</span><span class="ident" id="7948217">err</span><span class="op" id="7948220">.</span><span class="op" id="7948221">(</span><span class="ident" id="7948222">Error</span><span class="op" id="7948227">)</span><span class="op" id="7948228">.</span><span class="ident" id="7948229">Timeout</span><span class="op" id="7948236">(</span><span class="op" id="7948237">)</span>&nbsp;<span class="op" id="7948239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948244">t</span><span class="op" id="7948245">.</span><span class="ident" id="7948246">Fatalf</span><span class="op" id="7948252">(</span><span class="string" id="7948253">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948289">,</span>&nbsp;<span class="ident" id="7948291">err</span><span class="op" id="7948294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948301">}</span>&nbsp;<span class="keyword" id="7948303">else</span>&nbsp;<span class="op" id="7948308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948312">c</span><span class="op" id="7948313">.</span><span class="ident" id="7948314">Close</span><span class="op" id="7948319">(</span><span class="op" id="7948320">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948327">if</span>&nbsp;<span class="ident" id="7948330">f</span><span class="op" id="7948331">,</span>&nbsp;<span class="ident" id="7948333">err</span>&nbsp;<span class="op" id="7948337">:=</span>&nbsp;<span class="ident" id="7948340">ln</span><span class="op" id="7948342">.</span><span class="ident" id="7948343">File</span><span class="op" id="7948347">(</span><span class="op" id="7948348">)</span><span class="op" id="7948349">;</span>&nbsp;<span class="ident" id="7948351">err</span>&nbsp;<span class="op" id="7948355">!=</span>&nbsp;<span class="ident" id="7948358">nil</span>&nbsp;<span class="op" id="7948362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948366">t</span><span class="op" id="7948367">.</span><span class="ident" id="7948368">Fatalf</span><span class="op" id="7948374">(</span><span class="string" id="7948375">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948405">,</span>&nbsp;<span class="ident" id="7948407">err</span><span class="op" id="7948410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948413">}</span>&nbsp;<span class="keyword" id="7948415">else</span>&nbsp;<span class="op" id="7948420">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948424">f</span><span class="op" id="7948425">.</span><span class="ident" id="7948426">Close</span><span class="op" id="7948431">(</span><span class="op" id="7948432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948435">}</span><br>
<span class="lineno"></span><span class="op" id="7948437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7948440">func</span>&nbsp;<span class="ident" id="7948445">TestUnixConnSpecificMethods</span><span class="op" id="7948472">(</span><span class="ident" id="7948473">t</span>&nbsp;<span class="op" id="7948475">*</span><span class="ident" id="7948476">testing</span><span class="op" id="7948483">.</span><span class="ident" id="7948484">T</span><span class="op" id="7948485">)</span>&nbsp;<span class="op" id="7948487">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948490">switch</span>&nbsp;<span class="ident" id="7948497">runtime</span><span class="op" id="7948504">.</span><span class="ident" id="7948505">GOOS</span>&nbsp;<span class="op" id="7948510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948513">case</span>&nbsp;<span class="string" id="7948518">&#34;nacl&#34;</span><span class="op" id="7948524">,</span>&nbsp;<span class="string" id="7948526">&#34;plan9&#34;</span><span class="op" id="7948533">,</span>&nbsp;<span class="string" id="7948535">&#34;windows&#34;</span><span class="op" id="7948544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948548">t</span><span class="op" id="7948549">.</span><span class="ident" id="7948550">Skipf</span><span class="op" id="7948555">(</span><span class="string" id="7948556">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7948577">,</span>&nbsp;<span class="ident" id="7948579">runtime</span><span class="op" id="7948586">.</span><span class="ident" id="7948587">GOOS</span><span class="op" id="7948591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948598">addr1</span><span class="op" id="7948603">,</span>&nbsp;<span class="ident" id="7948605">addr2</span><span class="op" id="7948610">,</span>&nbsp;<span class="ident" id="7948612">addr3</span>&nbsp;<span class="op" id="7948618">:=</span>&nbsp;<span class="ident" id="7948621">testUnixAddr</span><span class="op" id="7948633">(</span><span class="op" id="7948634">)</span><span class="op" id="7948635">,</span>&nbsp;<span class="ident" id="7948637">testUnixAddr</span><span class="op" id="7948649">(</span><span class="op" id="7948650">)</span><span class="op" id="7948651">,</span>&nbsp;<span class="ident" id="7948653">testUnixAddr</span><span class="op" id="7948665">(</span><span class="op" id="7948666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948670">a1</span><span class="op" id="7948672">,</span>&nbsp;<span class="ident" id="7948674">err</span>&nbsp;<span class="op" id="7948678">:=</span>&nbsp;<span class="ident" id="7948681">ResolveUnixAddr</span><span class="op" id="7948696">(</span><span class="string" id="7948697">&#34;unixgram&#34;</span><span class="op" id="7948707">,</span>&nbsp;<span class="ident" id="7948709">addr1</span><span class="op" id="7948714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948717">if</span>&nbsp;<span class="ident" id="7948720">err</span>&nbsp;<span class="op" id="7948724">!=</span>&nbsp;<span class="ident" id="7948727">nil</span>&nbsp;<span class="op" id="7948731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948735">t</span><span class="op" id="7948736">.</span><span class="ident" id="7948737">Fatalf</span><span class="op" id="7948743">(</span><span class="string" id="7948744">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948772">,</span>&nbsp;<span class="ident" id="7948774">err</span><span class="op" id="7948777">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948783">c1</span><span class="op" id="7948785">,</span>&nbsp;<span class="ident" id="7948787">err</span>&nbsp;<span class="op" id="7948791">:=</span>&nbsp;<span class="ident" id="7948794">DialUnix</span><span class="op" id="7948802">(</span><span class="string" id="7948803">&#34;unixgram&#34;</span><span class="op" id="7948813">,</span>&nbsp;<span class="ident" id="7948815">a1</span><span class="op" id="7948817">,</span>&nbsp;<span class="ident" id="7948819">nil</span><span class="op" id="7948822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948825">if</span>&nbsp;<span class="ident" id="7948828">err</span>&nbsp;<span class="op" id="7948832">!=</span>&nbsp;<span class="ident" id="7948835">nil</span>&nbsp;<span class="op" id="7948839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948843">t</span><span class="op" id="7948844">.</span><span class="ident" id="7948845">Fatalf</span><span class="op" id="7948851">(</span><span class="string" id="7948852">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7948873">,</span>&nbsp;<span class="ident" id="7948875">err</span><span class="op" id="7948878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948881">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948884">defer</span>&nbsp;<span class="ident" id="7948890">c1</span><span class="op" id="7948892">.</span><span class="ident" id="7948893">Close</span><span class="op" id="7948898">(</span><span class="op" id="7948899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948902">defer</span>&nbsp;<span class="ident" id="7948908">os</span><span class="op" id="7948910">.</span><span class="ident" id="7948911">Remove</span><span class="op" id="7948917">(</span><span class="ident" id="7948918">addr1</span><span class="op" id="7948923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948926">c1</span><span class="op" id="7948928">.</span><span class="ident" id="7948929">LocalAddr</span><span class="op" id="7948938">(</span><span class="op" id="7948939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948942">c1</span><span class="op" id="7948944">.</span><span class="ident" id="7948945">RemoteAddr</span><span class="op" id="7948955">(</span><span class="op" id="7948956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948959">c1</span><span class="op" id="7948961">.</span><span class="ident" id="7948962">SetDeadline</span><span class="op" id="7948973">(</span><span class="ident" id="7948974">time</span><span class="op" id="7948978">.</span><span class="ident" id="7948979">Now</span><span class="op" id="7948982">(</span><span class="op" id="7948983">)</span><span class="op" id="7948984">.</span><span class="ident" id="7948985">Add</span><span class="op" id="7948988">(</span><span class="ident" id="7948989">someTimeout</span><span class="op" id="7949000">)</span><span class="op" id="7949001">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949004">c1</span><span class="op" id="7949006">.</span><span class="ident" id="7949007">SetReadDeadline</span><span class="op" id="7949022">(</span><span class="ident" id="7949023">time</span><span class="op" id="7949027">.</span><span class="ident" id="7949028">Now</span><span class="op" id="7949031">(</span><span class="op" id="7949032">)</span><span class="op" id="7949033">.</span><span class="ident" id="7949034">Add</span><span class="op" id="7949037">(</span><span class="ident" id="7949038">someTimeout</span><span class="op" id="7949049">)</span><span class="op" id="7949050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949053">c1</span><span class="op" id="7949055">.</span><span class="ident" id="7949056">SetWriteDeadline</span><span class="op" id="7949072">(</span><span class="ident" id="7949073">time</span><span class="op" id="7949077">.</span><span class="ident" id="7949078">Now</span><span class="op" id="7949081">(</span><span class="op" id="7949082">)</span><span class="op" id="7949083">.</span><span class="ident" id="7949084">Add</span><span class="op" id="7949087">(</span><span class="ident" id="7949088">someTimeout</span><span class="op" id="7949099">)</span><span class="op" id="7949100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949103">c1</span><span class="op" id="7949105">.</span><span class="ident" id="7949106">SetReadBuffer</span><span class="op" id="7949119">(</span><span class="num" id="7949120">2048</span><span class="op" id="7949124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949127">c1</span><span class="op" id="7949129">.</span><span class="ident" id="7949130">SetWriteBuffer</span><span class="op" id="7949144">(</span><span class="num" id="7949145">2048</span><span class="op" id="7949149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949153">a2</span><span class="op" id="7949155">,</span>&nbsp;<span class="ident" id="7949157">err</span>&nbsp;<span class="op" id="7949161">:=</span>&nbsp;<span class="ident" id="7949164">ResolveUnixAddr</span><span class="op" id="7949179">(</span><span class="string" id="7949180">&#34;unixgram&#34;</span><span class="op" id="7949190">,</span>&nbsp;<span class="ident" id="7949192">addr2</span><span class="op" id="7949197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949200">if</span>&nbsp;<span class="ident" id="7949203">err</span>&nbsp;<span class="op" id="7949207">!=</span>&nbsp;<span class="ident" id="7949210">nil</span>&nbsp;<span class="op" id="7949214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949218">t</span><span class="op" id="7949219">.</span><span class="ident" id="7949220">Fatalf</span><span class="op" id="7949226">(</span><span class="string" id="7949227">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949255">,</span>&nbsp;<span class="ident" id="7949257">err</span><span class="op" id="7949260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949266">c2</span><span class="op" id="7949268">,</span>&nbsp;<span class="ident" id="7949270">err</span>&nbsp;<span class="op" id="7949274">:=</span>&nbsp;<span class="ident" id="7949277">DialUnix</span><span class="op" id="7949285">(</span><span class="string" id="7949286">&#34;unixgram&#34;</span><span class="op" id="7949296">,</span>&nbsp;<span class="ident" id="7949298">a2</span><span class="op" id="7949300">,</span>&nbsp;<span class="ident" id="7949302">nil</span><span class="op" id="7949305">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949308">if</span>&nbsp;<span class="ident" id="7949311">err</span>&nbsp;<span class="op" id="7949315">!=</span>&nbsp;<span class="ident" id="7949318">nil</span>&nbsp;<span class="op" id="7949322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949326">t</span><span class="op" id="7949327">.</span><span class="ident" id="7949328">Fatalf</span><span class="op" id="7949334">(</span><span class="string" id="7949335">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949356">,</span>&nbsp;<span class="ident" id="7949358">err</span><span class="op" id="7949361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949367">defer</span>&nbsp;<span class="ident" id="7949373">c2</span><span class="op" id="7949375">.</span><span class="ident" id="7949376">Close</span><span class="op" id="7949381">(</span><span class="op" id="7949382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949385">defer</span>&nbsp;<span class="ident" id="7949391">os</span><span class="op" id="7949393">.</span><span class="ident" id="7949394">Remove</span><span class="op" id="7949400">(</span><span class="ident" id="7949401">addr2</span><span class="op" id="7949406">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949409">c2</span><span class="op" id="7949411">.</span><span class="ident" id="7949412">LocalAddr</span><span class="op" id="7949421">(</span><span class="op" id="7949422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949425">c2</span><span class="op" id="7949427">.</span><span class="ident" id="7949428">RemoteAddr</span><span class="op" id="7949438">(</span><span class="op" id="7949439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949442">c2</span><span class="op" id="7949444">.</span><span class="ident" id="7949445">SetDeadline</span><span class="op" id="7949456">(</span><span class="ident" id="7949457">time</span><span class="op" id="7949461">.</span><span class="ident" id="7949462">Now</span><span class="op" id="7949465">(</span><span class="op" id="7949466">)</span><span class="op" id="7949467">.</span><span class="ident" id="7949468">Add</span><span class="op" id="7949471">(</span><span class="ident" id="7949472">someTimeout</span><span class="op" id="7949483">)</span><span class="op" id="7949484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949487">c2</span><span class="op" id="7949489">.</span><span class="ident" id="7949490">SetReadDeadline</span><span class="op" id="7949505">(</span><span class="ident" id="7949506">time</span><span class="op" id="7949510">.</span><span class="ident" id="7949511">Now</span><span class="op" id="7949514">(</span><span class="op" id="7949515">)</span><span class="op" id="7949516">.</span><span class="ident" id="7949517">Add</span><span class="op" id="7949520">(</span><span class="ident" id="7949521">someTimeout</span><span class="op" id="7949532">)</span><span class="op" id="7949533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949536">c2</span><span class="op" id="7949538">.</span><span class="ident" id="7949539">SetWriteDeadline</span><span class="op" id="7949555">(</span><span class="ident" id="7949556">time</span><span class="op" id="7949560">.</span><span class="ident" id="7949561">Now</span><span class="op" id="7949564">(</span><span class="op" id="7949565">)</span><span class="op" id="7949566">.</span><span class="ident" id="7949567">Add</span><span class="op" id="7949570">(</span><span class="ident" id="7949571">someTimeout</span><span class="op" id="7949582">)</span><span class="op" id="7949583">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949586">c2</span><span class="op" id="7949588">.</span><span class="ident" id="7949589">SetReadBuffer</span><span class="op" id="7949602">(</span><span class="num" id="7949603">2048</span><span class="op" id="7949607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949610">c2</span><span class="op" id="7949612">.</span><span class="ident" id="7949613">SetWriteBuffer</span><span class="op" id="7949627">(</span><span class="num" id="7949628">2048</span><span class="op" id="7949632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949636">a3</span><span class="op" id="7949638">,</span>&nbsp;<span class="ident" id="7949640">err</span>&nbsp;<span class="op" id="7949644">:=</span>&nbsp;<span class="ident" id="7949647">ResolveUnixAddr</span><span class="op" id="7949662">(</span><span class="string" id="7949663">&#34;unixgram&#34;</span><span class="op" id="7949673">,</span>&nbsp;<span class="ident" id="7949675">addr3</span><span class="op" id="7949680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949683">if</span>&nbsp;<span class="ident" id="7949686">err</span>&nbsp;<span class="op" id="7949690">!=</span>&nbsp;<span class="ident" id="7949693">nil</span>&nbsp;<span class="op" id="7949697">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949701">t</span><span class="op" id="7949702">.</span><span class="ident" id="7949703">Fatalf</span><span class="op" id="7949709">(</span><span class="string" id="7949710">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949738">,</span>&nbsp;<span class="ident" id="7949740">err</span><span class="op" id="7949743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949749">c3</span><span class="op" id="7949751">,</span>&nbsp;<span class="ident" id="7949753">err</span>&nbsp;<span class="op" id="7949757">:=</span>&nbsp;<span class="ident" id="7949760">ListenUnixgram</span><span class="op" id="7949774">(</span><span class="string" id="7949775">&#34;unixgram&#34;</span><span class="op" id="7949785">,</span>&nbsp;<span class="ident" id="7949787">a3</span><span class="op" id="7949789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949792">if</span>&nbsp;<span class="ident" id="7949795">err</span>&nbsp;<span class="op" id="7949799">!=</span>&nbsp;<span class="ident" id="7949802">nil</span>&nbsp;<span class="op" id="7949806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949810">t</span><span class="op" id="7949811">.</span><span class="ident" id="7949812">Fatalf</span><span class="op" id="7949818">(</span><span class="string" id="7949819">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7949846">,</span>&nbsp;<span class="ident" id="7949848">err</span><span class="op" id="7949851">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949857">defer</span>&nbsp;<span class="ident" id="7949863">c3</span><span class="op" id="7949865">.</span><span class="ident" id="7949866">Close</span><span class="op" id="7949871">(</span><span class="op" id="7949872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949875">defer</span>&nbsp;<span class="ident" id="7949881">os</span><span class="op" id="7949883">.</span><span class="ident" id="7949884">Remove</span><span class="op" id="7949890">(</span><span class="ident" id="7949891">addr3</span><span class="op" id="7949896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949899">c3</span><span class="op" id="7949901">.</span><span class="ident" id="7949902">LocalAddr</span><span class="op" id="7949911">(</span><span class="op" id="7949912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949915">c3</span><span class="op" id="7949917">.</span><span class="ident" id="7949918">RemoteAddr</span><span class="op" id="7949928">(</span><span class="op" id="7949929">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949932">c3</span><span class="op" id="7949934">.</span><span class="ident" id="7949935">SetDeadline</span><span class="op" id="7949946">(</span><span class="ident" id="7949947">time</span><span class="op" id="7949951">.</span><span class="ident" id="7949952">Now</span><span class="op" id="7949955">(</span><span class="op" id="7949956">)</span><span class="op" id="7949957">.</span><span class="ident" id="7949958">Add</span><span class="op" id="7949961">(</span><span class="ident" id="7949962">someTimeout</span><span class="op" id="7949973">)</span><span class="op" id="7949974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949977">c3</span><span class="op" id="7949979">.</span><span class="ident" id="7949980">SetReadDeadline</span><span class="op" id="7949995">(</span><span class="ident" id="7949996">time</span><span class="op" id="7950000">.</span><span class="ident" id="7950001">Now</span><span class="op" id="7950004">(</span><span class="op" id="7950005">)</span><span class="op" id="7950006">.</span><span class="ident" id="7950007">Add</span><span class="op" id="7950010">(</span><span class="ident" id="7950011">someTimeout</span><span class="op" id="7950022">)</span><span class="op" id="7950023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950026">c3</span><span class="op" id="7950028">.</span><span class="ident" id="7950029">SetWriteDeadline</span><span class="op" id="7950045">(</span><span class="ident" id="7950046">time</span><span class="op" id="7950050">.</span><span class="ident" id="7950051">Now</span><span class="op" id="7950054">(</span><span class="op" id="7950055">)</span><span class="op" id="7950056">.</span><span class="ident" id="7950057">Add</span><span class="op" id="7950060">(</span><span class="ident" id="7950061">someTimeout</span><span class="op" id="7950072">)</span><span class="op" id="7950073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950076">c3</span><span class="op" id="7950078">.</span><span class="ident" id="7950079">SetReadBuffer</span><span class="op" id="7950092">(</span><span class="num" id="7950093">2048</span><span class="op" id="7950097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950100">c3</span><span class="op" id="7950102">.</span><span class="ident" id="7950103">SetWriteBuffer</span><span class="op" id="7950117">(</span><span class="num" id="7950118">2048</span><span class="op" id="7950122">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950126">wb</span>&nbsp;<span class="op" id="7950129">:=</span>&nbsp;<span class="op" id="7950132">[</span><span class="op" id="7950133">]</span><span class="builtintype" id="7950134">byte</span><span class="op" id="7950138">(</span><span class="string" id="7950139">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="7950154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950157">rb1</span>&nbsp;<span class="op" id="7950161">:=</span>&nbsp;<span class="builtinfunc" id="7950164">make</span><span class="op" id="7950168">(</span><span class="op" id="7950169">[</span><span class="op" id="7950170">]</span><span class="builtintype" id="7950171">byte</span><span class="op" id="7950175">,</span>&nbsp;<span class="num" id="7950177">128</span><span class="op" id="7950180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950183">rb2</span>&nbsp;<span class="op" id="7950187">:=</span>&nbsp;<span class="builtinfunc" id="7950190">make</span><span class="op" id="7950194">(</span><span class="op" id="7950195">[</span><span class="op" id="7950196">]</span><span class="builtintype" id="7950197">byte</span><span class="op" id="7950201">,</span>&nbsp;<span class="num" id="7950203">128</span><span class="op" id="7950206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950209">rb3</span>&nbsp;<span class="op" id="7950213">:=</span>&nbsp;<span class="builtinfunc" id="7950216">make</span><span class="op" id="7950220">(</span><span class="op" id="7950221">[</span><span class="op" id="7950222">]</span><span class="builtintype" id="7950223">byte</span><span class="op" id="7950227">,</span>&nbsp;<span class="num" id="7950229">128</span><span class="op" id="7950232">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950235">if</span>&nbsp;<span class="ident" id="7950238">_</span><span class="op" id="7950239">,</span>&nbsp;<span class="ident" id="7950241">_</span><span class="op" id="7950242">,</span>&nbsp;<span class="ident" id="7950244">err</span>&nbsp;<span class="op" id="7950248">:=</span>&nbsp;<span class="ident" id="7950251">c1</span><span class="op" id="7950253">.</span><span class="ident" id="7950254">WriteMsgUnix</span><span class="op" id="7950266">(</span><span class="ident" id="7950267">wb</span><span class="op" id="7950269">,</span>&nbsp;<span class="ident" id="7950271">nil</span><span class="op" id="7950274">,</span>&nbsp;<span class="ident" id="7950276">a2</span><span class="op" id="7950278">)</span><span class="op" id="7950279">;</span>&nbsp;<span class="ident" id="7950281">err</span>&nbsp;<span class="op" id="7950285">!=</span>&nbsp;<span class="ident" id="7950288">nil</span>&nbsp;<span class="op" id="7950292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950296">t</span><span class="op" id="7950297">.</span><span class="ident" id="7950298">Fatalf</span><span class="op" id="7950304">(</span><span class="string" id="7950305">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950339">,</span>&nbsp;<span class="ident" id="7950341">err</span><span class="op" id="7950344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950350">if</span>&nbsp;<span class="ident" id="7950353">_</span><span class="op" id="7950354">,</span>&nbsp;<span class="ident" id="7950356">_</span><span class="op" id="7950357">,</span>&nbsp;<span class="ident" id="7950359">_</span><span class="op" id="7950360">,</span>&nbsp;<span class="ident" id="7950362">_</span><span class="op" id="7950363">,</span>&nbsp;<span class="ident" id="7950365">err</span>&nbsp;<span class="op" id="7950369">:=</span>&nbsp;<span class="ident" id="7950372">c2</span><span class="op" id="7950374">.</span><span class="ident" id="7950375">ReadMsgUnix</span><span class="op" id="7950386">(</span><span class="ident" id="7950387">rb2</span><span class="op" id="7950390">,</span>&nbsp;<span class="ident" id="7950392">nil</span><span class="op" id="7950395">)</span><span class="op" id="7950396">;</span>&nbsp;<span class="ident" id="7950398">err</span>&nbsp;<span class="op" id="7950402">!=</span>&nbsp;<span class="ident" id="7950405">nil</span>&nbsp;<span class="op" id="7950409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950413">t</span><span class="op" id="7950414">.</span><span class="ident" id="7950415">Fatalf</span><span class="op" id="7950421">(</span><span class="string" id="7950422">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950455">,</span>&nbsp;<span class="ident" id="7950457">err</span><span class="op" id="7950460">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950466">if</span>&nbsp;<span class="ident" id="7950469">_</span><span class="op" id="7950470">,</span>&nbsp;<span class="ident" id="7950472">err</span>&nbsp;<span class="op" id="7950476">:=</span>&nbsp;<span class="ident" id="7950479">c2</span><span class="op" id="7950481">.</span><span class="ident" id="7950482">WriteToUnix</span><span class="op" id="7950493">(</span><span class="ident" id="7950494">wb</span><span class="op" id="7950496">,</span>&nbsp;<span class="ident" id="7950498">a1</span><span class="op" id="7950500">)</span><span class="op" id="7950501">;</span>&nbsp;<span class="ident" id="7950503">err</span>&nbsp;<span class="op" id="7950507">!=</span>&nbsp;<span class="ident" id="7950510">nil</span>&nbsp;<span class="op" id="7950514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950518">t</span><span class="op" id="7950519">.</span><span class="ident" id="7950520">Fatalf</span><span class="op" id="7950526">(</span><span class="string" id="7950527">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950560">,</span>&nbsp;<span class="ident" id="7950562">err</span><span class="op" id="7950565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950571">if</span>&nbsp;<span class="ident" id="7950574">_</span><span class="op" id="7950575">,</span>&nbsp;<span class="ident" id="7950577">_</span><span class="op" id="7950578">,</span>&nbsp;<span class="ident" id="7950580">err</span>&nbsp;<span class="op" id="7950584">:=</span>&nbsp;<span class="ident" id="7950587">c1</span><span class="op" id="7950589">.</span><span class="ident" id="7950590">ReadFromUnix</span><span class="op" id="7950602">(</span><span class="ident" id="7950603">rb1</span><span class="op" id="7950606">)</span><span class="op" id="7950607">;</span>&nbsp;<span class="ident" id="7950609">err</span>&nbsp;<span class="op" id="7950613">!=</span>&nbsp;<span class="ident" id="7950616">nil</span>&nbsp;<span class="op" id="7950620">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950624">t</span><span class="op" id="7950625">.</span><span class="ident" id="7950626">Fatalf</span><span class="op" id="7950632">(</span><span class="string" id="7950633">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950667">,</span>&nbsp;<span class="ident" id="7950669">err</span><span class="op" id="7950672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950678">if</span>&nbsp;<span class="ident" id="7950681">_</span><span class="op" id="7950682">,</span>&nbsp;<span class="ident" id="7950684">err</span>&nbsp;<span class="op" id="7950688">:=</span>&nbsp;<span class="ident" id="7950691">c3</span><span class="op" id="7950693">.</span><span class="ident" id="7950694">WriteToUnix</span><span class="op" id="7950705">(</span><span class="ident" id="7950706">wb</span><span class="op" id="7950708">,</span>&nbsp;<span class="ident" id="7950710">a1</span><span class="op" id="7950712">)</span><span class="op" id="7950713">;</span>&nbsp;<span class="ident" id="7950715">err</span>&nbsp;<span class="op" id="7950719">!=</span>&nbsp;<span class="ident" id="7950722">nil</span>&nbsp;<span class="op" id="7950726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950730">t</span><span class="op" id="7950731">.</span><span class="ident" id="7950732">Fatalf</span><span class="op" id="7950738">(</span><span class="string" id="7950739">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950772">,</span>&nbsp;<span class="ident" id="7950774">err</span><span class="op" id="7950777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950780">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950783">if</span>&nbsp;<span class="ident" id="7950786">_</span><span class="op" id="7950787">,</span>&nbsp;<span class="ident" id="7950789">_</span><span class="op" id="7950790">,</span>&nbsp;<span class="ident" id="7950792">err</span>&nbsp;<span class="op" id="7950796">:=</span>&nbsp;<span class="ident" id="7950799">c1</span><span class="op" id="7950801">.</span><span class="ident" id="7950802">ReadFromUnix</span><span class="op" id="7950814">(</span><span class="ident" id="7950815">rb1</span><span class="op" id="7950818">)</span><span class="op" id="7950819">;</span>&nbsp;<span class="ident" id="7950821">err</span>&nbsp;<span class="op" id="7950825">!=</span>&nbsp;<span class="ident" id="7950828">nil</span>&nbsp;<span class="op" id="7950832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950836">t</span><span class="op" id="7950837">.</span><span class="ident" id="7950838">Fatalf</span><span class="op" id="7950844">(</span><span class="string" id="7950845">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950879">,</span>&nbsp;<span class="ident" id="7950881">err</span><span class="op" id="7950884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950890">if</span>&nbsp;<span class="ident" id="7950893">_</span><span class="op" id="7950894">,</span>&nbsp;<span class="ident" id="7950896">err</span>&nbsp;<span class="op" id="7950900">:=</span>&nbsp;<span class="ident" id="7950903">c2</span><span class="op" id="7950905">.</span><span class="ident" id="7950906">WriteToUnix</span><span class="op" id="7950917">(</span><span class="ident" id="7950918">wb</span><span class="op" id="7950920">,</span>&nbsp;<span class="ident" id="7950922">a3</span><span class="op" id="7950924">)</span><span class="op" id="7950925">;</span>&nbsp;<span class="ident" id="7950927">err</span>&nbsp;<span class="op" id="7950931">!=</span>&nbsp;<span class="ident" id="7950934">nil</span>&nbsp;<span class="op" id="7950938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950942">t</span><span class="op" id="7950943">.</span><span class="ident" id="7950944">Fatalf</span><span class="op" id="7950950">(</span><span class="string" id="7950951">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7950984">,</span>&nbsp;<span class="ident" id="7950986">err</span><span class="op" id="7950989">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950995">if</span>&nbsp;<span class="ident" id="7950998">_</span><span class="op" id="7950999">,</span>&nbsp;<span class="ident" id="7951001">_</span><span class="op" id="7951002">,</span>&nbsp;<span class="ident" id="7951004">err</span>&nbsp;<span class="op" id="7951008">:=</span>&nbsp;<span class="ident" id="7951011">c3</span><span class="op" id="7951013">.</span><span class="ident" id="7951014">ReadFromUnix</span><span class="op" id="7951026">(</span><span class="ident" id="7951027">rb3</span><span class="op" id="7951030">)</span><span class="op" id="7951031">;</span>&nbsp;<span class="ident" id="7951033">err</span>&nbsp;<span class="op" id="7951037">!=</span>&nbsp;<span class="ident" id="7951040">nil</span>&nbsp;<span class="op" id="7951044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951048">t</span><span class="op" id="7951049">.</span><span class="ident" id="7951050">Fatalf</span><span class="op" id="7951056">(</span><span class="string" id="7951057">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7951091">,</span>&nbsp;<span class="ident" id="7951093">err</span><span class="op" id="7951096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951103">if</span>&nbsp;<span class="ident" id="7951106">f</span><span class="op" id="7951107">,</span>&nbsp;<span class="ident" id="7951109">err</span>&nbsp;<span class="op" id="7951113">:=</span>&nbsp;<span class="ident" id="7951116">c1</span><span class="op" id="7951118">.</span><span class="ident" id="7951119">File</span><span class="op" id="7951123">(</span><span class="op" id="7951124">)</span><span class="op" id="7951125">;</span>&nbsp;<span class="ident" id="7951127">err</span>&nbsp;<span class="op" id="7951131">!=</span>&nbsp;<span class="ident" id="7951134">nil</span>&nbsp;<span class="op" id="7951138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951142">t</span><span class="op" id="7951143">.</span><span class="ident" id="7951144">Fatalf</span><span class="op" id="7951150">(</span><span class="string" id="7951151">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7951177">,</span>&nbsp;<span class="ident" id="7951179">err</span><span class="op" id="7951182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951185">}</span>&nbsp;<span class="keyword" id="7951187">else</span>&nbsp;<span class="op" id="7951192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951196">f</span><span class="op" id="7951197">.</span><span class="ident" id="7951198">Close</span><span class="op" id="7951203">(</span><span class="op" id="7951204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951207">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951211">defer</span>&nbsp;<span class="keyword" id="7951217">func</span><span class="op" id="7951221">(</span><span class="op" id="7951222">)</span>&nbsp;<span class="op" id="7951224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951228">if</span>&nbsp;<span class="ident" id="7951231">p</span>&nbsp;<span class="op" id="7951233">:=</span>&nbsp;<span class="builtinfunc" id="7951236">recover</span><span class="op" id="7951243">(</span><span class="op" id="7951244">)</span><span class="op" id="7951245">;</span>&nbsp;<span class="ident" id="7951247">p</span>&nbsp;<span class="op" id="7951249">!=</span>&nbsp;<span class="ident" id="7951252">nil</span>&nbsp;<span class="op" id="7951256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951261">t</span><span class="op" id="7951262">.</span><span class="ident" id="7951263">Fatalf</span><span class="op" id="7951269">(</span><span class="string" id="7951270">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7951321">,</span>&nbsp;<span class="ident" id="7951323">p</span><span class="op" id="7951324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951328">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951331">}</span><span class="op" id="7951332">(</span><span class="op" id="7951333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951337">c1</span><span class="op" id="7951339">.</span><span class="ident" id="7951340">WriteToUnix</span><span class="op" id="7951351">(</span><span class="ident" id="7951352">wb</span><span class="op" id="7951354">,</span>&nbsp;<span class="ident" id="7951356">nil</span><span class="op" id="7951359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951362">c1</span><span class="op" id="7951364">.</span><span class="ident" id="7951365">WriteMsgUnix</span><span class="op" id="7951377">(</span><span class="ident" id="7951378">wb</span><span class="op" id="7951380">,</span>&nbsp;<span class="ident" id="7951382">nil</span><span class="op" id="7951385">,</span>&nbsp;<span class="ident" id="7951387">nil</span><span class="op" id="7951390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951393">c3</span><span class="op" id="7951395">.</span><span class="ident" id="7951396">WriteToUnix</span><span class="op" id="7951407">(</span><span class="ident" id="7951408">wb</span><span class="op" id="7951410">,</span>&nbsp;<span class="ident" id="7951412">nil</span><span class="op" id="7951415">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951418">c3</span><span class="op" id="7951420">.</span><span class="ident" id="7951421">WriteMsgUnix</span><span class="op" id="7951433">(</span><span class="ident" id="7951434">wb</span><span class="op" id="7951436">,</span>&nbsp;<span class="ident" id="7951438">nil</span><span class="op" id="7951441">,</span>&nbsp;<span class="ident" id="7951443">nil</span><span class="op" id="7951446">)</span><br>
<span class="lineno"></span><span class="op" id="7951448">}</span>
</div>
</body>
</html>
