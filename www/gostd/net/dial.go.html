<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3005450">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3005506">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3005560">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3005611">package</span>&nbsp;<span class="ident" id="3005619">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005624">import</span>&nbsp;<span class="op" id="3005631">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005634">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005644">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3005651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3005654">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3005713">//</span><br>
<span class="lineno"></span><span class="comment" id="3005716">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3005774">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3005836">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3005898">type</span>&nbsp;<span class="ident" id="3005903">Dialer</span>&nbsp;<span class="keyword" id="3005910">struct</span>&nbsp;<span class="op" id="3005917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005920">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005983">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006047">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006060">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006064">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006095">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006099">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006162">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006222">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006250">Timeout</span>&nbsp;<span class="ident" id="3006258">time</span><span class="op" id="3006262">.</span><span class="ident" id="3006263">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006274">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006335">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006390">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006455">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006487">Deadline</span>&nbsp;<span class="ident" id="3006496">time</span><span class="op" id="3006500">.</span><span class="ident" id="3006501">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006508">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006566">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006628">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006654">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006707">LocalAddr</span>&nbsp;<span class="ident" id="3006717">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006724">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006783">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006846">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006907">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006971">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006988">DualStack</span>&nbsp;<span class="builtintype" id="3006998">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007005">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007065">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007089">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007149">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007204">KeepAlive</span>&nbsp;<span class="ident" id="3007214">time</span><span class="op" id="3007218">.</span><span class="ident" id="3007219">Duration</span><br>
<span class="lineno"></span><span class="op" id="3007228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3007231">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3007296">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3007327">func</span>&nbsp;<span class="op" id="3007332">(</span><span class="ident" id="3007333">d</span>&nbsp;<span class="op" id="3007335">*</span><span class="ident" id="3007336">Dialer</span><span class="op" id="3007342">)</span>&nbsp;<span class="ident" id="3007344">deadline</span><span class="op" id="3007352">(</span><span class="op" id="3007353">)</span>&nbsp;<span class="ident" id="3007355">time</span><span class="op" id="3007359">.</span><span class="ident" id="3007360">Time</span>&nbsp;<span class="op" id="3007365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007368">if</span>&nbsp;<span class="ident" id="3007371">d</span><span class="op" id="3007372">.</span><span class="ident" id="3007373">Timeout</span>&nbsp;<span class="op" id="3007381">==</span>&nbsp;<span class="num" id="3007384">0</span>&nbsp;<span class="op" id="3007386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007390">return</span>&nbsp;<span class="ident" id="3007397">d</span><span class="op" id="3007398">.</span><span class="ident" id="3007399">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007412">timeoutDeadline</span>&nbsp;<span class="op" id="3007428">:=</span>&nbsp;<span class="ident" id="3007431">time</span><span class="op" id="3007435">.</span><span class="ident" id="3007436">Now</span><span class="op" id="3007439">(</span><span class="op" id="3007440">)</span><span class="op" id="3007441">.</span><span class="ident" id="3007442">Add</span><span class="op" id="3007445">(</span><span class="ident" id="3007446">d</span><span class="op" id="3007447">.</span><span class="ident" id="3007448">Timeout</span><span class="op" id="3007455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007458">if</span>&nbsp;<span class="ident" id="3007461">d</span><span class="op" id="3007462">.</span><span class="ident" id="3007463">Deadline</span><span class="op" id="3007471">.</span><span class="ident" id="3007472">IsZero</span><span class="op" id="3007478">(</span><span class="op" id="3007479">)</span>&nbsp;<span class="op" id="3007481">||</span>&nbsp;<span class="ident" id="3007484">timeoutDeadline</span><span class="op" id="3007499">.</span><span class="ident" id="3007500">Before</span><span class="op" id="3007506">(</span><span class="ident" id="3007507">d</span><span class="op" id="3007508">.</span><span class="ident" id="3007509">Deadline</span><span class="op" id="3007517">)</span>&nbsp;<span class="op" id="3007519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007523">return</span>&nbsp;<span class="ident" id="3007530">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007547">}</span>&nbsp;<span class="keyword" id="3007549">else</span>&nbsp;<span class="op" id="3007554">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007558">return</span>&nbsp;<span class="ident" id="3007565">d</span><span class="op" id="3007566">.</span><span class="ident" id="3007567">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007577">}</span><br>
<span class="lineno"></span><span class="op" id="3007579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3007582">func</span>&nbsp;<span class="ident" id="3007587">parseNetwork</span><span class="op" id="3007599">(</span><span class="ident" id="3007600">net</span>&nbsp;<span class="builtintype" id="3007604">string</span><span class="op" id="3007610">)</span>&nbsp;<span class="op" id="3007612">(</span><span class="ident" id="3007613">afnet</span>&nbsp;<span class="builtintype" id="3007619">string</span><span class="op" id="3007625">,</span>&nbsp;<span class="ident" id="3007627">proto</span>&nbsp;<span class="builtintype" id="3007633">int</span><span class="op" id="3007636">,</span>&nbsp;<span class="ident" id="3007638">err</span>&nbsp;<span class="builtintype" id="3007642">error</span><span class="op" id="3007647">)</span>&nbsp;<span class="op" id="3007649">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007652">i</span>&nbsp;<span class="op" id="3007654">:=</span>&nbsp;<span class="ident" id="3007657">last</span><span class="op" id="3007661">(</span><span class="ident" id="3007662">net</span><span class="op" id="3007665">,</span>&nbsp;<span class="string" id="3007667">&#39;:&#39;</span><span class="op" id="3007670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007673">if</span>&nbsp;<span class="ident" id="3007676">i</span>&nbsp;<span class="op" id="3007678">&lt;</span>&nbsp;<span class="num" id="3007680">0</span>&nbsp;<span class="op" id="3007682">{</span>&nbsp;<span class="comment" id="3007684">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007698">switch</span>&nbsp;<span class="ident" id="3007705">net</span>&nbsp;<span class="op" id="3007709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007713">case</span>&nbsp;<span class="string" id="3007718">&#34;tcp&#34;</span><span class="op" id="3007723">,</span>&nbsp;<span class="string" id="3007725">&#34;tcp4&#34;</span><span class="op" id="3007731">,</span>&nbsp;<span class="string" id="3007733">&#34;tcp6&#34;</span><span class="op" id="3007739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007743">case</span>&nbsp;<span class="string" id="3007748">&#34;udp&#34;</span><span class="op" id="3007753">,</span>&nbsp;<span class="string" id="3007755">&#34;udp4&#34;</span><span class="op" id="3007761">,</span>&nbsp;<span class="string" id="3007763">&#34;udp6&#34;</span><span class="op" id="3007769">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007773">case</span>&nbsp;<span class="string" id="3007778">&#34;ip&#34;</span><span class="op" id="3007782">,</span>&nbsp;<span class="string" id="3007784">&#34;ip4&#34;</span><span class="op" id="3007789">,</span>&nbsp;<span class="string" id="3007791">&#34;ip6&#34;</span><span class="op" id="3007796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007800">case</span>&nbsp;<span class="string" id="3007805">&#34;unix&#34;</span><span class="op" id="3007811">,</span>&nbsp;<span class="string" id="3007813">&#34;unixgram&#34;</span><span class="op" id="3007823">,</span>&nbsp;<span class="string" id="3007825">&#34;unixpacket&#34;</span><span class="op" id="3007837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007841">default</span><span class="op" id="3007848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007853">return</span>&nbsp;<span class="string" id="3007860">&#34;&#34;</span><span class="op" id="3007862">,</span>&nbsp;<span class="num" id="3007864">0</span><span class="op" id="3007865">,</span>&nbsp;<span class="ident" id="3007867">UnknownNetworkError</span><span class="op" id="3007886">(</span><span class="ident" id="3007887">net</span><span class="op" id="3007890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007894">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007898">return</span>&nbsp;<span class="ident" id="3007905">net</span><span class="op" id="3007908">,</span>&nbsp;<span class="num" id="3007910">0</span><span class="op" id="3007911">,</span>&nbsp;<span class="ident" id="3007913">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007921">afnet</span>&nbsp;<span class="op" id="3007927">=</span>&nbsp;<span class="ident" id="3007929">net</span><span class="op" id="3007932">[</span><span class="op" id="3007933">:</span><span class="ident" id="3007934">i</span><span class="op" id="3007935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007938">switch</span>&nbsp;<span class="ident" id="3007945">afnet</span>&nbsp;<span class="op" id="3007951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007954">case</span>&nbsp;<span class="string" id="3007959">&#34;ip&#34;</span><span class="op" id="3007963">,</span>&nbsp;<span class="string" id="3007965">&#34;ip4&#34;</span><span class="op" id="3007970">,</span>&nbsp;<span class="string" id="3007972">&#34;ip6&#34;</span><span class="op" id="3007977">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007981">protostr</span>&nbsp;<span class="op" id="3007990">:=</span>&nbsp;<span class="ident" id="3007993">net</span><span class="op" id="3007996">[</span><span class="ident" id="3007997">i</span><span class="op" id="3007998">+</span><span class="num" id="3007999">1</span><span class="op" id="3008000">:</span><span class="op" id="3008001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008005">proto</span><span class="op" id="3008010">,</span>&nbsp;<span class="ident" id="3008012">i</span><span class="op" id="3008013">,</span>&nbsp;<span class="ident" id="3008015">ok</span>&nbsp;<span class="op" id="3008018">:=</span>&nbsp;<span class="ident" id="3008021">dtoi</span><span class="op" id="3008025">(</span><span class="ident" id="3008026">protostr</span><span class="op" id="3008034">,</span>&nbsp;<span class="num" id="3008036">0</span><span class="op" id="3008037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008041">if</span>&nbsp;<span class="op" id="3008044">!</span><span class="ident" id="3008045">ok</span>&nbsp;<span class="op" id="3008048">||</span>&nbsp;<span class="ident" id="3008051">i</span>&nbsp;<span class="op" id="3008053">!=</span>&nbsp;<span class="builtinfunc" id="3008056">len</span><span class="op" id="3008059">(</span><span class="ident" id="3008060">protostr</span><span class="op" id="3008068">)</span>&nbsp;<span class="op" id="3008070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008075">proto</span><span class="op" id="3008080">,</span>&nbsp;<span class="ident" id="3008082">err</span>&nbsp;<span class="op" id="3008086">=</span>&nbsp;<span class="ident" id="3008088">lookupProtocol</span><span class="op" id="3008102">(</span><span class="ident" id="3008103">protostr</span><span class="op" id="3008111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008116">if</span>&nbsp;<span class="ident" id="3008119">err</span>&nbsp;<span class="op" id="3008123">!=</span>&nbsp;<span class="ident" id="3008126">nil</span>&nbsp;<span class="op" id="3008130">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008136">return</span>&nbsp;<span class="string" id="3008143">&#34;&#34;</span><span class="op" id="3008145">,</span>&nbsp;<span class="num" id="3008147">0</span><span class="op" id="3008148">,</span>&nbsp;<span class="ident" id="3008150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008165">return</span>&nbsp;<span class="ident" id="3008172">afnet</span><span class="op" id="3008177">,</span>&nbsp;<span class="ident" id="3008179">proto</span><span class="op" id="3008184">,</span>&nbsp;<span class="ident" id="3008186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008191">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008194">return</span>&nbsp;<span class="string" id="3008201">&#34;&#34;</span><span class="op" id="3008203">,</span>&nbsp;<span class="num" id="3008205">0</span><span class="op" id="3008206">,</span>&nbsp;<span class="ident" id="3008208">UnknownNetworkError</span><span class="op" id="3008227">(</span><span class="ident" id="3008228">net</span><span class="op" id="3008231">)</span><br>
<span class="lineno"></span><span class="op" id="3008233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3008236">func</span>&nbsp;<span class="ident" id="3008241">resolveAddr</span><span class="op" id="3008252">(</span><span class="ident" id="3008253">op</span><span class="op" id="3008255">,</span>&nbsp;<span class="ident" id="3008257">net</span><span class="op" id="3008260">,</span>&nbsp;<span class="ident" id="3008262">addr</span>&nbsp;<span class="builtintype" id="3008267">string</span><span class="op" id="3008273">,</span>&nbsp;<span class="ident" id="3008275">deadline</span>&nbsp;<span class="ident" id="3008284">time</span><span class="op" id="3008288">.</span><span class="ident" id="3008289">Time</span><span class="op" id="3008293">)</span>&nbsp;<span class="op" id="3008295">(</span><span class="ident" id="3008296">netaddr</span><span class="op" id="3008303">,</span>&nbsp;<span class="builtintype" id="3008305">error</span><span class="op" id="3008310">)</span>&nbsp;<span class="op" id="3008312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008315">afnet</span><span class="op" id="3008320">,</span>&nbsp;<span class="ident" id="3008322">_</span><span class="op" id="3008323">,</span>&nbsp;<span class="ident" id="3008325">err</span>&nbsp;<span class="op" id="3008329">:=</span>&nbsp;<span class="ident" id="3008332">parseNetwork</span><span class="op" id="3008344">(</span><span class="ident" id="3008345">net</span><span class="op" id="3008348">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008351">if</span>&nbsp;<span class="ident" id="3008354">err</span>&nbsp;<span class="op" id="3008358">!=</span>&nbsp;<span class="ident" id="3008361">nil</span>&nbsp;<span class="op" id="3008365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008369">return</span>&nbsp;<span class="ident" id="3008376">nil</span><span class="op" id="3008379">,</span>&nbsp;<span class="ident" id="3008381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008389">if</span>&nbsp;<span class="ident" id="3008392">op</span>&nbsp;<span class="op" id="3008395">==</span>&nbsp;<span class="string" id="3008398">&#34;dial&#34;</span>&nbsp;<span class="op" id="3008405">&amp;&amp;</span>&nbsp;<span class="ident" id="3008408">addr</span>&nbsp;<span class="op" id="3008413">==</span>&nbsp;<span class="string" id="3008416">&#34;&#34;</span>&nbsp;<span class="op" id="3008419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008423">return</span>&nbsp;<span class="ident" id="3008430">nil</span><span class="op" id="3008433">,</span>&nbsp;<span class="ident" id="3008435">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008457">switch</span>&nbsp;<span class="ident" id="3008464">afnet</span>&nbsp;<span class="op" id="3008470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008473">case</span>&nbsp;<span class="string" id="3008478">&#34;unix&#34;</span><span class="op" id="3008484">,</span>&nbsp;<span class="string" id="3008486">&#34;unixgram&#34;</span><span class="op" id="3008496">,</span>&nbsp;<span class="string" id="3008498">&#34;unixpacket&#34;</span><span class="op" id="3008510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008514">return</span>&nbsp;<span class="ident" id="3008521">ResolveUnixAddr</span><span class="op" id="3008536">(</span><span class="ident" id="3008537">afnet</span><span class="op" id="3008542">,</span>&nbsp;<span class="ident" id="3008544">addr</span><span class="op" id="3008548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008551">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008554">return</span>&nbsp;<span class="ident" id="3008561">resolveInternetAddr</span><span class="op" id="3008580">(</span><span class="ident" id="3008581">afnet</span><span class="op" id="3008586">,</span>&nbsp;<span class="ident" id="3008588">addr</span><span class="op" id="3008592">,</span>&nbsp;<span class="ident" id="3008594">deadline</span><span class="op" id="3008602">)</span><br>
<span class="lineno"></span><span class="op" id="3008604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3008607">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3008661">//</span><br>
<span class="lineno">115</span><span class="comment" id="3008664">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3008733">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3008795">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3008853">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3008870">//</span><br>
<span class="lineno">120</span><span class="comment" id="3008873">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3008937">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3008994">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3009059">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3009128">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3009145">//</span><br>
<span class="lineno"></span><span class="comment" id="3009148">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3009161">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3009194">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3009228">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3009265">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3009300">//</span><br>
<span class="lineno"></span><span class="comment" id="3009303">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3009373">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3009440">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3009463">//</span><br>
<span class="lineno"></span><span class="comment" id="3009466">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3009479">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3009509">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3009536">//</span><br>
<span class="lineno">140</span><span class="comment" id="3009539">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3009601">func</span>&nbsp;<span class="ident" id="3009606">Dial</span><span class="op" id="3009610">(</span><span class="ident" id="3009611">network</span><span class="op" id="3009618">,</span>&nbsp;<span class="ident" id="3009620">address</span>&nbsp;<span class="builtintype" id="3009628">string</span><span class="op" id="3009634">)</span>&nbsp;<span class="op" id="3009636">(</span><span class="ident" id="3009637">Conn</span><span class="op" id="3009641">,</span>&nbsp;<span class="builtintype" id="3009643">error</span><span class="op" id="3009648">)</span>&nbsp;<span class="op" id="3009650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009653">var</span>&nbsp;<span class="ident" id="3009657">d</span>&nbsp;<span class="ident" id="3009659">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009667">return</span>&nbsp;<span class="ident" id="3009674">d</span><span class="op" id="3009675">.</span><span class="ident" id="3009676">Dial</span><span class="op" id="3009680">(</span><span class="ident" id="3009681">network</span><span class="op" id="3009688">,</span>&nbsp;<span class="ident" id="3009690">address</span><span class="op" id="3009697">)</span><br>
<span class="lineno"></span><span class="op" id="3009699">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3009702">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3009753">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3009807">func</span>&nbsp;<span class="ident" id="3009812">DialTimeout</span><span class="op" id="3009823">(</span><span class="ident" id="3009824">network</span><span class="op" id="3009831">,</span>&nbsp;<span class="ident" id="3009833">address</span>&nbsp;<span class="builtintype" id="3009841">string</span><span class="op" id="3009847">,</span>&nbsp;<span class="ident" id="3009849">timeout</span>&nbsp;<span class="ident" id="3009857">time</span><span class="op" id="3009861">.</span><span class="ident" id="3009862">Duration</span><span class="op" id="3009870">)</span>&nbsp;<span class="op" id="3009872">(</span><span class="ident" id="3009873">Conn</span><span class="op" id="3009877">,</span>&nbsp;<span class="builtintype" id="3009879">error</span><span class="op" id="3009884">)</span>&nbsp;<span class="op" id="3009886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009889">d</span>&nbsp;<span class="op" id="3009891">:=</span>&nbsp;<span class="ident" id="3009894">Dialer</span><span class="op" id="3009900">{</span><span class="ident" id="3009901">Timeout</span><span class="op" id="3009908">:</span>&nbsp;<span class="ident" id="3009910">timeout</span><span class="op" id="3009917">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009920">return</span>&nbsp;<span class="ident" id="3009927">d</span><span class="op" id="3009928">.</span><span class="ident" id="3009929">Dial</span><span class="op" id="3009933">(</span><span class="ident" id="3009934">network</span><span class="op" id="3009941">,</span>&nbsp;<span class="ident" id="3009943">address</span><span class="op" id="3009950">)</span><br>
<span class="lineno"></span><span class="op" id="3009952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3009955">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3010009">//</span><br>
<span class="lineno">155</span><span class="comment" id="3010012">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3010074">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3010089">func</span>&nbsp;<span class="op" id="3010094">(</span><span class="ident" id="3010095">d</span>&nbsp;<span class="op" id="3010097">*</span><span class="ident" id="3010098">Dialer</span><span class="op" id="3010104">)</span>&nbsp;<span class="ident" id="3010106">Dial</span><span class="op" id="3010110">(</span><span class="ident" id="3010111">network</span><span class="op" id="3010118">,</span>&nbsp;<span class="ident" id="3010120">address</span>&nbsp;<span class="builtintype" id="3010128">string</span><span class="op" id="3010134">)</span>&nbsp;<span class="op" id="3010136">(</span><span class="ident" id="3010137">Conn</span><span class="op" id="3010141">,</span>&nbsp;<span class="builtintype" id="3010143">error</span><span class="op" id="3010148">)</span>&nbsp;<span class="op" id="3010150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010153">ra</span><span class="op" id="3010155">,</span>&nbsp;<span class="ident" id="3010157">err</span>&nbsp;<span class="op" id="3010161">:=</span>&nbsp;<span class="ident" id="3010164">resolveAddr</span><span class="op" id="3010175">(</span><span class="string" id="3010176">&#34;dial&#34;</span><span class="op" id="3010182">,</span>&nbsp;<span class="ident" id="3010184">network</span><span class="op" id="3010191">,</span>&nbsp;<span class="ident" id="3010193">address</span><span class="op" id="3010200">,</span>&nbsp;<span class="ident" id="3010202">d</span><span class="op" id="3010203">.</span><span class="ident" id="3010204">deadline</span><span class="op" id="3010212">(</span><span class="op" id="3010213">)</span><span class="op" id="3010214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010217">if</span>&nbsp;<span class="ident" id="3010220">err</span>&nbsp;<span class="op" id="3010224">!=</span>&nbsp;<span class="ident" id="3010227">nil</span>&nbsp;<span class="op" id="3010231">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010235">return</span>&nbsp;<span class="ident" id="3010242">nil</span><span class="op" id="3010245">,</span>&nbsp;<span class="op" id="3010247">&amp;</span><span class="ident" id="3010248">OpError</span><span class="op" id="3010255">{</span><span class="ident" id="3010256">Op</span><span class="op" id="3010258">:</span>&nbsp;<span class="string" id="3010260">&#34;dial&#34;</span><span class="op" id="3010266">,</span>&nbsp;<span class="ident" id="3010268">Net</span><span class="op" id="3010271">:</span>&nbsp;<span class="ident" id="3010273">network</span><span class="op" id="3010280">,</span>&nbsp;<span class="ident" id="3010282">Addr</span><span class="op" id="3010286">:</span>&nbsp;<span class="ident" id="3010288">nil</span><span class="op" id="3010291">,</span>&nbsp;<span class="ident" id="3010293">Err</span><span class="op" id="3010296">:</span>&nbsp;<span class="ident" id="3010298">err</span><span class="op" id="3010301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010307">dialer</span>&nbsp;<span class="op" id="3010314">:=</span>&nbsp;<span class="keyword" id="3010317">func</span><span class="op" id="3010321">(</span><span class="ident" id="3010322">deadline</span>&nbsp;<span class="ident" id="3010331">time</span><span class="op" id="3010335">.</span><span class="ident" id="3010336">Time</span><span class="op" id="3010340">)</span>&nbsp;<span class="op" id="3010342">(</span><span class="ident" id="3010343">Conn</span><span class="op" id="3010347">,</span>&nbsp;<span class="builtintype" id="3010349">error</span><span class="op" id="3010354">)</span>&nbsp;<span class="op" id="3010356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010360">return</span>&nbsp;<span class="ident" id="3010367">dialSingle</span><span class="op" id="3010377">(</span><span class="ident" id="3010378">network</span><span class="op" id="3010385">,</span>&nbsp;<span class="ident" id="3010387">address</span><span class="op" id="3010394">,</span>&nbsp;<span class="ident" id="3010396">d</span><span class="op" id="3010397">.</span><span class="ident" id="3010398">LocalAddr</span><span class="op" id="3010407">,</span>&nbsp;<span class="ident" id="3010409">ra</span><span class="op" id="3010411">.</span><span class="ident" id="3010412">toAddr</span><span class="op" id="3010418">(</span><span class="op" id="3010419">)</span><span class="op" id="3010420">,</span>&nbsp;<span class="ident" id="3010422">deadline</span><span class="op" id="3010430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010433">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010436">if</span>&nbsp;<span class="ident" id="3010439">ras</span><span class="op" id="3010442">,</span>&nbsp;<span class="ident" id="3010444">ok</span>&nbsp;<span class="op" id="3010447">:=</span>&nbsp;<span class="ident" id="3010450">ra</span><span class="op" id="3010452">.</span><span class="op" id="3010453">(</span><span class="ident" id="3010454">addrList</span><span class="op" id="3010462">)</span><span class="op" id="3010463">;</span>&nbsp;<span class="ident" id="3010465">ok</span>&nbsp;<span class="op" id="3010468">&amp;&amp;</span>&nbsp;<span class="ident" id="3010471">d</span><span class="op" id="3010472">.</span><span class="ident" id="3010473">DualStack</span>&nbsp;<span class="op" id="3010483">&amp;&amp;</span>&nbsp;<span class="ident" id="3010486">network</span>&nbsp;<span class="op" id="3010494">==</span>&nbsp;<span class="string" id="3010497">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3010503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010507">dialer</span>&nbsp;<span class="op" id="3010514">=</span>&nbsp;<span class="keyword" id="3010516">func</span><span class="op" id="3010520">(</span><span class="ident" id="3010521">deadline</span>&nbsp;<span class="ident" id="3010530">time</span><span class="op" id="3010534">.</span><span class="ident" id="3010535">Time</span><span class="op" id="3010539">)</span>&nbsp;<span class="op" id="3010541">(</span><span class="ident" id="3010542">Conn</span><span class="op" id="3010546">,</span>&nbsp;<span class="builtintype" id="3010548">error</span><span class="op" id="3010553">)</span>&nbsp;<span class="op" id="3010555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010560">return</span>&nbsp;<span class="ident" id="3010567">dialMulti</span><span class="op" id="3010576">(</span><span class="ident" id="3010577">network</span><span class="op" id="3010584">,</span>&nbsp;<span class="ident" id="3010586">address</span><span class="op" id="3010593">,</span>&nbsp;<span class="ident" id="3010595">d</span><span class="op" id="3010596">.</span><span class="ident" id="3010597">LocalAddr</span><span class="op" id="3010606">,</span>&nbsp;<span class="ident" id="3010608">ras</span><span class="op" id="3010611">,</span>&nbsp;<span class="ident" id="3010613">deadline</span><span class="op" id="3010621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010628">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010631">c</span><span class="op" id="3010632">,</span>&nbsp;<span class="ident" id="3010634">err</span>&nbsp;<span class="op" id="3010638">:=</span>&nbsp;<span class="ident" id="3010641">dial</span><span class="op" id="3010645">(</span><span class="ident" id="3010646">network</span><span class="op" id="3010653">,</span>&nbsp;<span class="ident" id="3010655">ra</span><span class="op" id="3010657">.</span><span class="ident" id="3010658">toAddr</span><span class="op" id="3010664">(</span><span class="op" id="3010665">)</span><span class="op" id="3010666">,</span>&nbsp;<span class="ident" id="3010668">dialer</span><span class="op" id="3010674">,</span>&nbsp;<span class="ident" id="3010676">d</span><span class="op" id="3010677">.</span><span class="ident" id="3010678">deadline</span><span class="op" id="3010686">(</span><span class="op" id="3010687">)</span><span class="op" id="3010688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010691">if</span>&nbsp;<span class="ident" id="3010694">d</span><span class="op" id="3010695">.</span><span class="ident" id="3010696">KeepAlive</span>&nbsp;<span class="op" id="3010706">&gt;</span>&nbsp;<span class="num" id="3010708">0</span>&nbsp;<span class="op" id="3010710">&amp;&amp;</span>&nbsp;<span class="ident" id="3010713">err</span>&nbsp;<span class="op" id="3010717">==</span>&nbsp;<span class="ident" id="3010720">nil</span>&nbsp;<span class="op" id="3010724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010728">if</span>&nbsp;<span class="ident" id="3010731">tc</span><span class="op" id="3010733">,</span>&nbsp;<span class="ident" id="3010735">ok</span>&nbsp;<span class="op" id="3010738">:=</span>&nbsp;<span class="ident" id="3010741">c</span><span class="op" id="3010742">.</span><span class="op" id="3010743">(</span><span class="op" id="3010744">*</span><span class="ident" id="3010745">TCPConn</span><span class="op" id="3010752">)</span><span class="op" id="3010753">;</span>&nbsp;<span class="ident" id="3010755">ok</span>&nbsp;<span class="op" id="3010758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010763">tc</span><span class="op" id="3010765">.</span><span class="ident" id="3010766">SetKeepAlive</span><span class="op" id="3010778">(</span><span class="builtintype" id="3010779">true</span><span class="op" id="3010783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010788">tc</span><span class="op" id="3010790">.</span><span class="ident" id="3010791">SetKeepAlivePeriod</span><span class="op" id="3010809">(</span><span class="ident" id="3010810">d</span><span class="op" id="3010811">.</span><span class="ident" id="3010812">KeepAlive</span><span class="op" id="3010821">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010826">testHookSetKeepAlive</span><span class="op" id="3010846">(</span><span class="op" id="3010847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010857">return</span>&nbsp;<span class="ident" id="3010864">c</span><span class="op" id="3010865">,</span>&nbsp;<span class="ident" id="3010867">err</span><br>
<span class="lineno"></span><span class="op" id="3010871">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3010874">var</span>&nbsp;<span class="ident" id="3010878">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3010899">=</span>&nbsp;<span class="keyword" id="3010901">func</span><span class="op" id="3010905">(</span><span class="op" id="3010906">)</span>&nbsp;<span class="op" id="3010908">{</span><span class="op" id="3010909">}</span>&nbsp;<span class="comment" id="3010911">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3010939">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3011009">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3011072">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3011140">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3011170">func</span>&nbsp;<span class="ident" id="3011175">dialMulti</span><span class="op" id="3011184">(</span><span class="ident" id="3011185">net</span><span class="op" id="3011188">,</span>&nbsp;<span class="ident" id="3011190">addr</span>&nbsp;<span class="builtintype" id="3011195">string</span><span class="op" id="3011201">,</span>&nbsp;<span class="ident" id="3011203">la</span>&nbsp;<span class="ident" id="3011206">Addr</span><span class="op" id="3011210">,</span>&nbsp;<span class="ident" id="3011212">ras</span>&nbsp;<span class="ident" id="3011216">addrList</span><span class="op" id="3011224">,</span>&nbsp;<span class="ident" id="3011226">deadline</span>&nbsp;<span class="ident" id="3011235">time</span><span class="op" id="3011239">.</span><span class="ident" id="3011240">Time</span><span class="op" id="3011244">)</span>&nbsp;<span class="op" id="3011246">(</span><span class="ident" id="3011247">Conn</span><span class="op" id="3011251">,</span>&nbsp;<span class="builtintype" id="3011253">error</span><span class="op" id="3011258">)</span>&nbsp;<span class="op" id="3011260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011263">type</span>&nbsp;<span class="ident" id="3011268">racer</span>&nbsp;<span class="keyword" id="3011274">struct</span>&nbsp;<span class="op" id="3011281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011285">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3011292">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011302">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011365">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011428">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011457">sig</span>&nbsp;<span class="op" id="3011461">:=</span>&nbsp;<span class="builtinfunc" id="3011464">make</span><span class="op" id="3011468">(</span><span class="keyword" id="3011469">chan</span>&nbsp;<span class="builtintype" id="3011474">bool</span><span class="op" id="3011478">,</span>&nbsp;<span class="num" id="3011480">1</span><span class="op" id="3011481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011484">lane</span>&nbsp;<span class="op" id="3011489">:=</span>&nbsp;<span class="builtinfunc" id="3011492">make</span><span class="op" id="3011496">(</span><span class="keyword" id="3011497">chan</span>&nbsp;<span class="ident" id="3011502">racer</span><span class="op" id="3011507">,</span>&nbsp;<span class="num" id="3011509">1</span><span class="op" id="3011510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011513">for</span>&nbsp;<span class="ident" id="3011517">_</span><span class="op" id="3011518">,</span>&nbsp;<span class="ident" id="3011520">ra</span>&nbsp;<span class="op" id="3011523">:=</span>&nbsp;<span class="keyword" id="3011526">range</span>&nbsp;<span class="ident" id="3011532">ras</span>&nbsp;<span class="op" id="3011536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011540">go</span>&nbsp;<span class="keyword" id="3011543">func</span><span class="op" id="3011547">(</span><span class="ident" id="3011548">ra</span>&nbsp;<span class="ident" id="3011551">Addr</span><span class="op" id="3011555">)</span>&nbsp;<span class="op" id="3011557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011562">c</span><span class="op" id="3011563">,</span>&nbsp;<span class="ident" id="3011565">err</span>&nbsp;<span class="op" id="3011569">:=</span>&nbsp;<span class="ident" id="3011572">dialSingle</span><span class="op" id="3011582">(</span><span class="ident" id="3011583">net</span><span class="op" id="3011586">,</span>&nbsp;<span class="ident" id="3011588">addr</span><span class="op" id="3011592">,</span>&nbsp;<span class="ident" id="3011594">la</span><span class="op" id="3011596">,</span>&nbsp;<span class="ident" id="3011598">ra</span><span class="op" id="3011600">,</span>&nbsp;<span class="ident" id="3011602">deadline</span><span class="op" id="3011610">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011615">if</span>&nbsp;<span class="ident" id="3011618">_</span><span class="op" id="3011619">,</span>&nbsp;<span class="ident" id="3011621">ok</span>&nbsp;<span class="op" id="3011624">:=</span>&nbsp;<span class="op" id="3011627">&lt;-</span><span class="ident" id="3011629">sig</span><span class="op" id="3011632">;</span>&nbsp;<span class="ident" id="3011634">ok</span>&nbsp;<span class="op" id="3011637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011643">lane</span>&nbsp;<span class="op" id="3011648">&lt;-</span>&nbsp;<span class="ident" id="3011651">racer</span><span class="op" id="3011656">{</span><span class="ident" id="3011657">c</span><span class="op" id="3011658">,</span>&nbsp;<span class="ident" id="3011660">err</span><span class="op" id="3011663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011668">}</span>&nbsp;<span class="keyword" id="3011670">else</span>&nbsp;<span class="keyword" id="3011675">if</span>&nbsp;<span class="ident" id="3011678">err</span>&nbsp;<span class="op" id="3011682">==</span>&nbsp;<span class="ident" id="3011685">nil</span>&nbsp;<span class="op" id="3011689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011695">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011734">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011766">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011803">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011843">c</span><span class="op" id="3011844">.</span><span class="ident" id="3011845">Close</span><span class="op" id="3011850">(</span><span class="op" id="3011851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011860">}</span><span class="op" id="3011861">(</span><span class="ident" id="3011862">ra</span><span class="op" id="3011864">.</span><span class="ident" id="3011865">toAddr</span><span class="op" id="3011871">(</span><span class="op" id="3011872">)</span><span class="op" id="3011873">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011879">defer</span>&nbsp;<span class="builtinfunc" id="3011885">close</span><span class="op" id="3011890">(</span><span class="ident" id="3011891">sig</span><span class="op" id="3011894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011897">lastErr</span>&nbsp;<span class="op" id="3011905">:=</span>&nbsp;<span class="ident" id="3011908">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011920">nracers</span>&nbsp;<span class="op" id="3011928">:=</span>&nbsp;<span class="builtinfunc" id="3011931">len</span><span class="op" id="3011934">(</span><span class="ident" id="3011935">ras</span><span class="op" id="3011938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011941">for</span>&nbsp;<span class="ident" id="3011945">nracers</span>&nbsp;<span class="op" id="3011953">&gt;</span>&nbsp;<span class="num" id="3011955">0</span>&nbsp;<span class="op" id="3011957">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011961">sig</span>&nbsp;<span class="op" id="3011965">&lt;-</span>&nbsp;<span class="builtintype" id="3011968">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011975">racer</span>&nbsp;<span class="op" id="3011981">:=</span>&nbsp;<span class="op" id="3011984">&lt;-</span><span class="ident" id="3011986">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011993">if</span>&nbsp;<span class="ident" id="3011996">racer</span><span class="op" id="3012001">.</span><span class="builtintype" id="3012002">error</span>&nbsp;<span class="op" id="3012008">==</span>&nbsp;<span class="ident" id="3012011">nil</span>&nbsp;<span class="op" id="3012015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012020">return</span>&nbsp;<span class="ident" id="3012027">racer</span><span class="op" id="3012032">.</span><span class="ident" id="3012033">Conn</span><span class="op" id="3012037">,</span>&nbsp;<span class="ident" id="3012039">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012045">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012049">lastErr</span>&nbsp;<span class="op" id="3012057">=</span>&nbsp;<span class="ident" id="3012059">racer</span><span class="op" id="3012064">.</span><span class="builtintype" id="3012065">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012073">nracers</span><span class="op" id="3012080">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012087">return</span>&nbsp;<span class="ident" id="3012094">nil</span><span class="op" id="3012097">,</span>&nbsp;<span class="ident" id="3012099">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3012107">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3012110">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3012181">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3012209">func</span>&nbsp;<span class="ident" id="3012214">dialSingle</span><span class="op" id="3012224">(</span><span class="ident" id="3012225">net</span><span class="op" id="3012228">,</span>&nbsp;<span class="ident" id="3012230">addr</span>&nbsp;<span class="builtintype" id="3012235">string</span><span class="op" id="3012241">,</span>&nbsp;<span class="ident" id="3012243">la</span><span class="op" id="3012245">,</span>&nbsp;<span class="ident" id="3012247">ra</span>&nbsp;<span class="ident" id="3012250">Addr</span><span class="op" id="3012254">,</span>&nbsp;<span class="ident" id="3012256">deadline</span>&nbsp;<span class="ident" id="3012265">time</span><span class="op" id="3012269">.</span><span class="ident" id="3012270">Time</span><span class="op" id="3012274">)</span>&nbsp;<span class="op" id="3012276">(</span><span class="ident" id="3012277">c</span>&nbsp;<span class="ident" id="3012279">Conn</span><span class="op" id="3012283">,</span>&nbsp;<span class="ident" id="3012285">err</span>&nbsp;<span class="builtintype" id="3012289">error</span><span class="op" id="3012294">)</span>&nbsp;<span class="op" id="3012296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012299">if</span>&nbsp;<span class="ident" id="3012302">la</span>&nbsp;<span class="op" id="3012305">!=</span>&nbsp;<span class="ident" id="3012308">nil</span>&nbsp;<span class="op" id="3012312">&amp;&amp;</span>&nbsp;<span class="ident" id="3012315">la</span><span class="op" id="3012317">.</span><span class="ident" id="3012318">Network</span><span class="op" id="3012325">(</span><span class="op" id="3012326">)</span>&nbsp;<span class="op" id="3012328">!=</span>&nbsp;<span class="ident" id="3012331">ra</span><span class="op" id="3012333">.</span><span class="ident" id="3012334">Network</span><span class="op" id="3012341">(</span><span class="op" id="3012342">)</span>&nbsp;<span class="op" id="3012344">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012348">return</span>&nbsp;<span class="ident" id="3012355">nil</span><span class="op" id="3012358">,</span>&nbsp;<span class="op" id="3012360">&amp;</span><span class="ident" id="3012361">OpError</span><span class="op" id="3012368">{</span><span class="ident" id="3012369">Op</span><span class="op" id="3012371">:</span>&nbsp;<span class="string" id="3012373">&#34;dial&#34;</span><span class="op" id="3012379">,</span>&nbsp;<span class="ident" id="3012381">Net</span><span class="op" id="3012384">:</span>&nbsp;<span class="ident" id="3012386">net</span><span class="op" id="3012389">,</span>&nbsp;<span class="ident" id="3012391">Addr</span><span class="op" id="3012395">:</span>&nbsp;<span class="ident" id="3012397">ra</span><span class="op" id="3012399">,</span>&nbsp;<span class="ident" id="3012401">Err</span><span class="op" id="3012404">:</span>&nbsp;<span class="ident" id="3012406">errors</span><span class="op" id="3012412">.</span><span class="ident" id="3012413">New</span><span class="op" id="3012416">(</span><span class="string" id="3012417">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3012450">+</span>&nbsp;<span class="ident" id="3012452">la</span><span class="op" id="3012454">.</span><span class="ident" id="3012455">Network</span><span class="op" id="3012462">(</span><span class="op" id="3012463">)</span><span class="op" id="3012464">)</span><span class="op" id="3012465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012471">switch</span>&nbsp;<span class="ident" id="3012478">ra</span>&nbsp;<span class="op" id="3012481">:=</span>&nbsp;<span class="ident" id="3012484">ra</span><span class="op" id="3012486">.</span><span class="op" id="3012487">(</span><span class="keyword" id="3012488">type</span><span class="op" id="3012492">)</span>&nbsp;<span class="op" id="3012494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012497">case</span>&nbsp;<span class="op" id="3012502">*</span><span class="ident" id="3012503">TCPAddr</span><span class="op" id="3012510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012514">la</span><span class="op" id="3012516">,</span>&nbsp;<span class="ident" id="3012518">_</span>&nbsp;<span class="op" id="3012520">:=</span>&nbsp;<span class="ident" id="3012523">la</span><span class="op" id="3012525">.</span><span class="op" id="3012526">(</span><span class="op" id="3012527">*</span><span class="ident" id="3012528">TCPAddr</span><span class="op" id="3012535">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012539">c</span><span class="op" id="3012540">,</span>&nbsp;<span class="ident" id="3012542">err</span>&nbsp;<span class="op" id="3012546">=</span>&nbsp;<span class="ident" id="3012548">dialTCP</span><span class="op" id="3012555">(</span><span class="ident" id="3012556">net</span><span class="op" id="3012559">,</span>&nbsp;<span class="ident" id="3012561">la</span><span class="op" id="3012563">,</span>&nbsp;<span class="ident" id="3012565">ra</span><span class="op" id="3012567">,</span>&nbsp;<span class="ident" id="3012569">deadline</span><span class="op" id="3012577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012580">case</span>&nbsp;<span class="op" id="3012585">*</span><span class="ident" id="3012586">UDPAddr</span><span class="op" id="3012593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012597">la</span><span class="op" id="3012599">,</span>&nbsp;<span class="ident" id="3012601">_</span>&nbsp;<span class="op" id="3012603">:=</span>&nbsp;<span class="ident" id="3012606">la</span><span class="op" id="3012608">.</span><span class="op" id="3012609">(</span><span class="op" id="3012610">*</span><span class="ident" id="3012611">UDPAddr</span><span class="op" id="3012618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012622">c</span><span class="op" id="3012623">,</span>&nbsp;<span class="ident" id="3012625">err</span>&nbsp;<span class="op" id="3012629">=</span>&nbsp;<span class="ident" id="3012631">dialUDP</span><span class="op" id="3012638">(</span><span class="ident" id="3012639">net</span><span class="op" id="3012642">,</span>&nbsp;<span class="ident" id="3012644">la</span><span class="op" id="3012646">,</span>&nbsp;<span class="ident" id="3012648">ra</span><span class="op" id="3012650">,</span>&nbsp;<span class="ident" id="3012652">deadline</span><span class="op" id="3012660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012663">case</span>&nbsp;<span class="op" id="3012668">*</span><span class="ident" id="3012669">IPAddr</span><span class="op" id="3012675">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012679">la</span><span class="op" id="3012681">,</span>&nbsp;<span class="ident" id="3012683">_</span>&nbsp;<span class="op" id="3012685">:=</span>&nbsp;<span class="ident" id="3012688">la</span><span class="op" id="3012690">.</span><span class="op" id="3012691">(</span><span class="op" id="3012692">*</span><span class="ident" id="3012693">IPAddr</span><span class="op" id="3012699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012703">c</span><span class="op" id="3012704">,</span>&nbsp;<span class="ident" id="3012706">err</span>&nbsp;<span class="op" id="3012710">=</span>&nbsp;<span class="ident" id="3012712">dialIP</span><span class="op" id="3012718">(</span><span class="ident" id="3012719">net</span><span class="op" id="3012722">,</span>&nbsp;<span class="ident" id="3012724">la</span><span class="op" id="3012726">,</span>&nbsp;<span class="ident" id="3012728">ra</span><span class="op" id="3012730">,</span>&nbsp;<span class="ident" id="3012732">deadline</span><span class="op" id="3012740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012743">case</span>&nbsp;<span class="op" id="3012748">*</span><span class="ident" id="3012749">UnixAddr</span><span class="op" id="3012757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012761">la</span><span class="op" id="3012763">,</span>&nbsp;<span class="ident" id="3012765">_</span>&nbsp;<span class="op" id="3012767">:=</span>&nbsp;<span class="ident" id="3012770">la</span><span class="op" id="3012772">.</span><span class="op" id="3012773">(</span><span class="op" id="3012774">*</span><span class="ident" id="3012775">UnixAddr</span><span class="op" id="3012783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012787">c</span><span class="op" id="3012788">,</span>&nbsp;<span class="ident" id="3012790">err</span>&nbsp;<span class="op" id="3012794">=</span>&nbsp;<span class="ident" id="3012796">dialUnix</span><span class="op" id="3012804">(</span><span class="ident" id="3012805">net</span><span class="op" id="3012808">,</span>&nbsp;<span class="ident" id="3012810">la</span><span class="op" id="3012812">,</span>&nbsp;<span class="ident" id="3012814">ra</span><span class="op" id="3012816">,</span>&nbsp;<span class="ident" id="3012818">deadline</span><span class="op" id="3012826">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012829">default</span><span class="op" id="3012836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012840">return</span>&nbsp;<span class="ident" id="3012847">nil</span><span class="op" id="3012850">,</span>&nbsp;<span class="op" id="3012852">&amp;</span><span class="ident" id="3012853">OpError</span><span class="op" id="3012860">{</span><span class="ident" id="3012861">Op</span><span class="op" id="3012863">:</span>&nbsp;<span class="string" id="3012865">&#34;dial&#34;</span><span class="op" id="3012871">,</span>&nbsp;<span class="ident" id="3012873">Net</span><span class="op" id="3012876">:</span>&nbsp;<span class="ident" id="3012878">net</span><span class="op" id="3012881">,</span>&nbsp;<span class="ident" id="3012883">Addr</span><span class="op" id="3012887">:</span>&nbsp;<span class="ident" id="3012889">ra</span><span class="op" id="3012891">,</span>&nbsp;<span class="ident" id="3012893">Err</span><span class="op" id="3012896">:</span>&nbsp;<span class="op" id="3012898">&amp;</span><span class="ident" id="3012899">AddrError</span><span class="op" id="3012908">{</span><span class="ident" id="3012909">Err</span><span class="op" id="3012912">:</span>&nbsp;<span class="string" id="3012914">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3012939">,</span>&nbsp;<span class="ident" id="3012941">Addr</span><span class="op" id="3012945">:</span>&nbsp;<span class="ident" id="3012947">addr</span><span class="op" id="3012951">}</span><span class="op" id="3012952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012958">if</span>&nbsp;<span class="ident" id="3012961">err</span>&nbsp;<span class="op" id="3012965">!=</span>&nbsp;<span class="ident" id="3012968">nil</span>&nbsp;<span class="op" id="3012972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012976">return</span>&nbsp;<span class="ident" id="3012983">nil</span><span class="op" id="3012986">,</span>&nbsp;<span class="ident" id="3012988">err</span>&nbsp;<span class="comment" id="3012992">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013045">return</span>&nbsp;<span class="ident" id="3013052">c</span><span class="op" id="3013053">,</span>&nbsp;<span class="ident" id="3013055">nil</span><br>
<span class="lineno"></span><span class="op" id="3013059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3013062">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3013118">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3013187">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3013222">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3013259">func</span>&nbsp;<span class="ident" id="3013264">Listen</span><span class="op" id="3013270">(</span><span class="ident" id="3013271">net</span><span class="op" id="3013274">,</span>&nbsp;<span class="ident" id="3013276">laddr</span>&nbsp;<span class="builtintype" id="3013282">string</span><span class="op" id="3013288">)</span>&nbsp;<span class="op" id="3013290">(</span><span class="ident" id="3013291">Listener</span><span class="op" id="3013299">,</span>&nbsp;<span class="builtintype" id="3013301">error</span><span class="op" id="3013306">)</span>&nbsp;<span class="op" id="3013308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013311">la</span><span class="op" id="3013313">,</span>&nbsp;<span class="ident" id="3013315">err</span>&nbsp;<span class="op" id="3013319">:=</span>&nbsp;<span class="ident" id="3013322">resolveAddr</span><span class="op" id="3013333">(</span><span class="string" id="3013334">&#34;listen&#34;</span><span class="op" id="3013342">,</span>&nbsp;<span class="ident" id="3013344">net</span><span class="op" id="3013347">,</span>&nbsp;<span class="ident" id="3013349">laddr</span><span class="op" id="3013354">,</span>&nbsp;<span class="ident" id="3013356">noDeadline</span><span class="op" id="3013366">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013369">if</span>&nbsp;<span class="ident" id="3013372">err</span>&nbsp;<span class="op" id="3013376">!=</span>&nbsp;<span class="ident" id="3013379">nil</span>&nbsp;<span class="op" id="3013383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013387">return</span>&nbsp;<span class="ident" id="3013394">nil</span><span class="op" id="3013397">,</span>&nbsp;<span class="op" id="3013399">&amp;</span><span class="ident" id="3013400">OpError</span><span class="op" id="3013407">{</span><span class="ident" id="3013408">Op</span><span class="op" id="3013410">:</span>&nbsp;<span class="string" id="3013412">&#34;listen&#34;</span><span class="op" id="3013420">,</span>&nbsp;<span class="ident" id="3013422">Net</span><span class="op" id="3013425">:</span>&nbsp;<span class="ident" id="3013427">net</span><span class="op" id="3013430">,</span>&nbsp;<span class="ident" id="3013432">Addr</span><span class="op" id="3013436">:</span>&nbsp;<span class="ident" id="3013438">nil</span><span class="op" id="3013441">,</span>&nbsp;<span class="ident" id="3013443">Err</span><span class="op" id="3013446">:</span>&nbsp;<span class="ident" id="3013448">err</span><span class="op" id="3013451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013457">var</span>&nbsp;<span class="ident" id="3013461">l</span>&nbsp;<span class="ident" id="3013463">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013473">switch</span>&nbsp;<span class="ident" id="3013480">la</span>&nbsp;<span class="op" id="3013483">:=</span>&nbsp;<span class="ident" id="3013486">la</span><span class="op" id="3013488">.</span><span class="ident" id="3013489">toAddr</span><span class="op" id="3013495">(</span><span class="op" id="3013496">)</span><span class="op" id="3013497">.</span><span class="op" id="3013498">(</span><span class="keyword" id="3013499">type</span><span class="op" id="3013503">)</span>&nbsp;<span class="op" id="3013505">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013508">case</span>&nbsp;<span class="op" id="3013513">*</span><span class="ident" id="3013514">TCPAddr</span><span class="op" id="3013521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013525">l</span><span class="op" id="3013526">,</span>&nbsp;<span class="ident" id="3013528">err</span>&nbsp;<span class="op" id="3013532">=</span>&nbsp;<span class="ident" id="3013534">ListenTCP</span><span class="op" id="3013543">(</span><span class="ident" id="3013544">net</span><span class="op" id="3013547">,</span>&nbsp;<span class="ident" id="3013549">la</span><span class="op" id="3013551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013554">case</span>&nbsp;<span class="op" id="3013559">*</span><span class="ident" id="3013560">UnixAddr</span><span class="op" id="3013568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013572">l</span><span class="op" id="3013573">,</span>&nbsp;<span class="ident" id="3013575">err</span>&nbsp;<span class="op" id="3013579">=</span>&nbsp;<span class="ident" id="3013581">ListenUnix</span><span class="op" id="3013591">(</span><span class="ident" id="3013592">net</span><span class="op" id="3013595">,</span>&nbsp;<span class="ident" id="3013597">la</span><span class="op" id="3013599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013602">default</span><span class="op" id="3013609">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013613">return</span>&nbsp;<span class="ident" id="3013620">nil</span><span class="op" id="3013623">,</span>&nbsp;<span class="op" id="3013625">&amp;</span><span class="ident" id="3013626">OpError</span><span class="op" id="3013633">{</span><span class="ident" id="3013634">Op</span><span class="op" id="3013636">:</span>&nbsp;<span class="string" id="3013638">&#34;listen&#34;</span><span class="op" id="3013646">,</span>&nbsp;<span class="ident" id="3013648">Net</span><span class="op" id="3013651">:</span>&nbsp;<span class="ident" id="3013653">net</span><span class="op" id="3013656">,</span>&nbsp;<span class="ident" id="3013658">Addr</span><span class="op" id="3013662">:</span>&nbsp;<span class="ident" id="3013664">la</span><span class="op" id="3013666">,</span>&nbsp;<span class="ident" id="3013668">Err</span><span class="op" id="3013671">:</span>&nbsp;<span class="op" id="3013673">&amp;</span><span class="ident" id="3013674">AddrError</span><span class="op" id="3013683">{</span><span class="ident" id="3013684">Err</span><span class="op" id="3013687">:</span>&nbsp;<span class="string" id="3013689">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3013714">,</span>&nbsp;<span class="ident" id="3013716">Addr</span><span class="op" id="3013720">:</span>&nbsp;<span class="ident" id="3013722">laddr</span><span class="op" id="3013727">}</span><span class="op" id="3013728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013734">if</span>&nbsp;<span class="ident" id="3013737">err</span>&nbsp;<span class="op" id="3013741">!=</span>&nbsp;<span class="ident" id="3013744">nil</span>&nbsp;<span class="op" id="3013748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013752">return</span>&nbsp;<span class="ident" id="3013759">nil</span><span class="op" id="3013762">,</span>&nbsp;<span class="ident" id="3013764">err</span>&nbsp;<span class="comment" id="3013768">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013818">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013821">return</span>&nbsp;<span class="ident" id="3013828">l</span><span class="op" id="3013829">,</span>&nbsp;<span class="ident" id="3013831">nil</span><br>
<span class="lineno"></span><span class="op" id="3013835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3013838">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3013900">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3013969">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3014014">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3014051">func</span>&nbsp;<span class="ident" id="3014056">ListenPacket</span><span class="op" id="3014068">(</span><span class="ident" id="3014069">net</span><span class="op" id="3014072">,</span>&nbsp;<span class="ident" id="3014074">laddr</span>&nbsp;<span class="builtintype" id="3014080">string</span><span class="op" id="3014086">)</span>&nbsp;<span class="op" id="3014088">(</span><span class="ident" id="3014089">PacketConn</span><span class="op" id="3014099">,</span>&nbsp;<span class="builtintype" id="3014101">error</span><span class="op" id="3014106">)</span>&nbsp;<span class="op" id="3014108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3014111">la</span><span class="op" id="3014113">,</span>&nbsp;<span class="ident" id="3014115">err</span>&nbsp;<span class="op" id="3014119">:=</span>&nbsp;<span class="ident" id="3014122">resolveAddr</span><span class="op" id="3014133">(</span><span class="string" id="3014134">&#34;listen&#34;</span><span class="op" id="3014142">,</span>&nbsp;<span class="ident" id="3014144">net</span><span class="op" id="3014147">,</span>&nbsp;<span class="ident" id="3014149">laddr</span><span class="op" id="3014154">,</span>&nbsp;<span class="ident" id="3014156">noDeadline</span><span class="op" id="3014166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014169">if</span>&nbsp;<span class="ident" id="3014172">err</span>&nbsp;<span class="op" id="3014176">!=</span>&nbsp;<span class="ident" id="3014179">nil</span>&nbsp;<span class="op" id="3014183">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014187">return</span>&nbsp;<span class="ident" id="3014194">nil</span><span class="op" id="3014197">,</span>&nbsp;<span class="op" id="3014199">&amp;</span><span class="ident" id="3014200">OpError</span><span class="op" id="3014207">{</span><span class="ident" id="3014208">Op</span><span class="op" id="3014210">:</span>&nbsp;<span class="string" id="3014212">&#34;listen&#34;</span><span class="op" id="3014220">,</span>&nbsp;<span class="ident" id="3014222">Net</span><span class="op" id="3014225">:</span>&nbsp;<span class="ident" id="3014227">net</span><span class="op" id="3014230">,</span>&nbsp;<span class="ident" id="3014232">Addr</span><span class="op" id="3014236">:</span>&nbsp;<span class="ident" id="3014238">nil</span><span class="op" id="3014241">,</span>&nbsp;<span class="ident" id="3014243">Err</span><span class="op" id="3014246">:</span>&nbsp;<span class="ident" id="3014248">err</span><span class="op" id="3014251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3014254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014257">var</span>&nbsp;<span class="ident" id="3014261">l</span>&nbsp;<span class="ident" id="3014263">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014275">switch</span>&nbsp;<span class="ident" id="3014282">la</span>&nbsp;<span class="op" id="3014285">:=</span>&nbsp;<span class="ident" id="3014288">la</span><span class="op" id="3014290">.</span><span class="ident" id="3014291">toAddr</span><span class="op" id="3014297">(</span><span class="op" id="3014298">)</span><span class="op" id="3014299">.</span><span class="op" id="3014300">(</span><span class="keyword" id="3014301">type</span><span class="op" id="3014305">)</span>&nbsp;<span class="op" id="3014307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014310">case</span>&nbsp;<span class="op" id="3014315">*</span><span class="ident" id="3014316">UDPAddr</span><span class="op" id="3014323">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3014327">l</span><span class="op" id="3014328">,</span>&nbsp;<span class="ident" id="3014330">err</span>&nbsp;<span class="op" id="3014334">=</span>&nbsp;<span class="ident" id="3014336">ListenUDP</span><span class="op" id="3014345">(</span><span class="ident" id="3014346">net</span><span class="op" id="3014349">,</span>&nbsp;<span class="ident" id="3014351">la</span><span class="op" id="3014353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014356">case</span>&nbsp;<span class="op" id="3014361">*</span><span class="ident" id="3014362">IPAddr</span><span class="op" id="3014368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3014372">l</span><span class="op" id="3014373">,</span>&nbsp;<span class="ident" id="3014375">err</span>&nbsp;<span class="op" id="3014379">=</span>&nbsp;<span class="ident" id="3014381">ListenIP</span><span class="op" id="3014389">(</span><span class="ident" id="3014390">net</span><span class="op" id="3014393">,</span>&nbsp;<span class="ident" id="3014395">la</span><span class="op" id="3014397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014400">case</span>&nbsp;<span class="op" id="3014405">*</span><span class="ident" id="3014406">UnixAddr</span><span class="op" id="3014414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3014418">l</span><span class="op" id="3014419">,</span>&nbsp;<span class="ident" id="3014421">err</span>&nbsp;<span class="op" id="3014425">=</span>&nbsp;<span class="ident" id="3014427">ListenUnixgram</span><span class="op" id="3014441">(</span><span class="ident" id="3014442">net</span><span class="op" id="3014445">,</span>&nbsp;<span class="ident" id="3014447">la</span><span class="op" id="3014449">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014452">default</span><span class="op" id="3014459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014463">return</span>&nbsp;<span class="ident" id="3014470">nil</span><span class="op" id="3014473">,</span>&nbsp;<span class="op" id="3014475">&amp;</span><span class="ident" id="3014476">OpError</span><span class="op" id="3014483">{</span><span class="ident" id="3014484">Op</span><span class="op" id="3014486">:</span>&nbsp;<span class="string" id="3014488">&#34;listen&#34;</span><span class="op" id="3014496">,</span>&nbsp;<span class="ident" id="3014498">Net</span><span class="op" id="3014501">:</span>&nbsp;<span class="ident" id="3014503">net</span><span class="op" id="3014506">,</span>&nbsp;<span class="ident" id="3014508">Addr</span><span class="op" id="3014512">:</span>&nbsp;<span class="ident" id="3014514">la</span><span class="op" id="3014516">,</span>&nbsp;<span class="ident" id="3014518">Err</span><span class="op" id="3014521">:</span>&nbsp;<span class="op" id="3014523">&amp;</span><span class="ident" id="3014524">AddrError</span><span class="op" id="3014533">{</span><span class="ident" id="3014534">Err</span><span class="op" id="3014537">:</span>&nbsp;<span class="string" id="3014539">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3014564">,</span>&nbsp;<span class="ident" id="3014566">Addr</span><span class="op" id="3014570">:</span>&nbsp;<span class="ident" id="3014572">laddr</span><span class="op" id="3014577">}</span><span class="op" id="3014578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3014581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014584">if</span>&nbsp;<span class="ident" id="3014587">err</span>&nbsp;<span class="op" id="3014591">!=</span>&nbsp;<span class="ident" id="3014594">nil</span>&nbsp;<span class="op" id="3014598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014602">return</span>&nbsp;<span class="ident" id="3014609">nil</span><span class="op" id="3014612">,</span>&nbsp;<span class="ident" id="3014614">err</span>&nbsp;<span class="comment" id="3014618">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3014668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014671">return</span>&nbsp;<span class="ident" id="3014678">l</span><span class="op" id="3014679">,</span>&nbsp;<span class="ident" id="3014681">nil</span><br>
<span class="lineno"></span><span class="op" id="3014685">}</span>
</div>
</body>
</html>
