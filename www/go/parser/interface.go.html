<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5940432">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5940487">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5940541">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5940592">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5940666">package</span>&nbsp;<span class="ident" id="5940674">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5940682">import</span>&nbsp;<span class="op" id="5940689">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940692">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940701">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940711">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940721">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940733">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940739">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940752">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940758">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5940775">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5940785">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5940788">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="5940855">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5940923">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="5940980">//</span><br>
<span class="lineno">25</span><span class="keyword" id="5940983">func</span>&nbsp;<span class="ident" id="5940988">readSource</span><span class="op" id="5940998">(</span><span class="ident" id="5940999">filename</span>&nbsp;<span class="builtintype" id="5941008">string</span><span class="op" id="5941014">,</span>&nbsp;<span class="ident" id="5941016">src</span>&nbsp;<span class="keyword" id="5941020">interface</span><span class="op" id="5941029">{</span><span class="op" id="5941030">}</span><span class="op" id="5941031">)</span>&nbsp;<span class="op" id="5941033">(</span><span class="op" id="5941034">[</span><span class="op" id="5941035">]</span><span class="builtintype" id="5941036">byte</span><span class="op" id="5941040">,</span>&nbsp;<span class="builtintype" id="5941042">error</span><span class="op" id="5941047">)</span>&nbsp;<span class="op" id="5941049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941052">if</span>&nbsp;<span class="ident" id="5941055">src</span>&nbsp;<span class="op" id="5941059">!=</span>&nbsp;<span class="ident" id="5941062">nil</span>&nbsp;<span class="op" id="5941066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941070">switch</span>&nbsp;<span class="ident" id="5941077">s</span>&nbsp;<span class="op" id="5941079">:=</span>&nbsp;<span class="ident" id="5941082">src</span><span class="op" id="5941085">.</span><span class="op" id="5941086">(</span><span class="keyword" id="5941087">type</span><span class="op" id="5941091">)</span>&nbsp;<span class="op" id="5941093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941097">case</span>&nbsp;<span class="builtintype" id="5941102">string</span><span class="op" id="5941108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941113">return</span>&nbsp;<span class="op" id="5941120">[</span><span class="op" id="5941121">]</span><span class="builtintype" id="5941122">byte</span><span class="op" id="5941126">(</span><span class="ident" id="5941127">s</span><span class="op" id="5941128">)</span><span class="op" id="5941129">,</span>&nbsp;<span class="ident" id="5941131">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941137">case</span>&nbsp;<span class="op" id="5941142">[</span><span class="op" id="5941143">]</span><span class="builtintype" id="5941144">byte</span><span class="op" id="5941148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941153">return</span>&nbsp;<span class="ident" id="5941160">s</span><span class="op" id="5941161">,</span>&nbsp;<span class="ident" id="5941163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941169">case</span>&nbsp;<span class="op" id="5941174">*</span><span class="ident" id="5941175">bytes</span><span class="op" id="5941180">.</span><span class="ident" id="5941181">Buffer</span><span class="op" id="5941187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5941192">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941256">if</span>&nbsp;<span class="ident" id="5941259">s</span>&nbsp;<span class="op" id="5941261">!=</span>&nbsp;<span class="ident" id="5941264">nil</span>&nbsp;<span class="op" id="5941268">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941274">return</span>&nbsp;<span class="ident" id="5941281">s</span><span class="op" id="5941282">.</span><span class="ident" id="5941283">Bytes</span><span class="op" id="5941288">(</span><span class="op" id="5941289">)</span><span class="op" id="5941290">,</span>&nbsp;<span class="ident" id="5941292">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941303">case</span>&nbsp;<span class="ident" id="5941308">io</span><span class="op" id="5941310">.</span><span class="ident" id="5941311">Reader</span><span class="op" id="5941317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941322">var</span>&nbsp;<span class="ident" id="5941326">buf</span>&nbsp;<span class="ident" id="5941330">bytes</span><span class="op" id="5941335">.</span><span class="ident" id="5941336">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941346">if</span>&nbsp;<span class="ident" id="5941349">_</span><span class="op" id="5941350">,</span>&nbsp;<span class="ident" id="5941352">err</span>&nbsp;<span class="op" id="5941356">:=</span>&nbsp;<span class="ident" id="5941359">io</span><span class="op" id="5941361">.</span><span class="ident" id="5941362">Copy</span><span class="op" id="5941366">(</span><span class="op" id="5941367">&amp;</span><span class="ident" id="5941368">buf</span><span class="op" id="5941371">,</span>&nbsp;<span class="ident" id="5941373">s</span><span class="op" id="5941374">)</span><span class="op" id="5941375">;</span>&nbsp;<span class="ident" id="5941377">err</span>&nbsp;<span class="op" id="5941381">!=</span>&nbsp;<span class="ident" id="5941384">nil</span>&nbsp;<span class="op" id="5941388">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941394">return</span>&nbsp;<span class="ident" id="5941401">nil</span><span class="op" id="5941404">,</span>&nbsp;<span class="ident" id="5941406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941418">return</span>&nbsp;<span class="ident" id="5941425">buf</span><span class="op" id="5941428">.</span><span class="ident" id="5941429">Bytes</span><span class="op" id="5941434">(</span><span class="op" id="5941435">)</span><span class="op" id="5941436">,</span>&nbsp;<span class="ident" id="5941438">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941448">return</span>&nbsp;<span class="ident" id="5941455">nil</span><span class="op" id="5941458">,</span>&nbsp;<span class="ident" id="5941460">errors</span><span class="op" id="5941466">.</span><span class="ident" id="5941467">New</span><span class="op" id="5941470">(</span><span class="string" id="5941471">&#34;invalid&nbsp;source&#34;</span><span class="op" id="5941487">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941493">return</span>&nbsp;<span class="ident" id="5941500">ioutil</span><span class="op" id="5941506">.</span><span class="ident" id="5941507">ReadFile</span><span class="op" id="5941515">(</span><span class="ident" id="5941516">filename</span><span class="op" id="5941524">)</span><br>
<span class="lineno"></span><span class="op" id="5941526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941529">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="5941571">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="5941639">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="5941664">//</span><br>
<span class="lineno"></span><span class="keyword" id="5941667">type</span>&nbsp;<span class="ident" id="5941672">Mode</span>&nbsp;<span class="builtintype" id="5941677">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5941683">const</span>&nbsp;<span class="op" id="5941689">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941692">PackageClauseOnly</span>&nbsp;<span class="ident" id="5941710">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941727">=</span>&nbsp;<span class="num" id="5941729">1</span>&nbsp;<span class="op" id="5941731">&lt;&lt;</span>&nbsp;<span class="ident" id="5941734">iota</span>&nbsp;<span class="comment" id="5941739">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941777">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5941824">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941867">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5941914">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941953">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942000">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942040">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942087">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942117">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942164">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942214">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942232">=</span>&nbsp;<span class="ident" id="5942234">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942261">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="5942325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5942328">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5942403">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5942475">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5942537">//</span><br>
<span class="lineno"></span><span class="comment" id="5942540">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="5942615">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="5942690">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5942753">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="5942820">//</span><br>
<span class="lineno"></span><span class="comment" id="5942823">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="5942897">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5942971">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="5942989">//</span><br>
<span class="lineno"></span><span class="comment" id="5942992">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5943065">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="5943134">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="5943205">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="5943278">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5943352">//</span><br>
<span class="lineno"></span><span class="keyword" id="5943355">func</span>&nbsp;<span class="ident" id="5943360">ParseFile</span><span class="op" id="5943369">(</span><span class="ident" id="5943370">fset</span>&nbsp;<span class="op" id="5943375">*</span><span class="ident" id="5943376">token</span><span class="op" id="5943381">.</span><span class="ident" id="5943382">FileSet</span><span class="op" id="5943389">,</span>&nbsp;<span class="ident" id="5943391">filename</span>&nbsp;<span class="builtintype" id="5943400">string</span><span class="op" id="5943406">,</span>&nbsp;<span class="ident" id="5943408">src</span>&nbsp;<span class="keyword" id="5943412">interface</span><span class="op" id="5943421">{</span><span class="op" id="5943422">}</span><span class="op" id="5943423">,</span>&nbsp;<span class="ident" id="5943425">mode</span>&nbsp;<span class="ident" id="5943430">Mode</span><span class="op" id="5943434">)</span>&nbsp;<span class="op" id="5943436">(</span><span class="ident" id="5943437">f</span>&nbsp;<span class="op" id="5943439">*</span><span class="ident" id="5943440">ast</span><span class="op" id="5943443">.</span><span class="ident" id="5943444">File</span><span class="op" id="5943448">,</span>&nbsp;<span class="ident" id="5943450">err</span>&nbsp;<span class="builtintype" id="5943454">error</span><span class="op" id="5943459">)</span>&nbsp;<span class="op" id="5943461">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943464">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943479">text</span><span class="op" id="5943483">,</span>&nbsp;<span class="ident" id="5943485">err</span>&nbsp;<span class="op" id="5943489">:=</span>&nbsp;<span class="ident" id="5943492">readSource</span><span class="op" id="5943502">(</span><span class="ident" id="5943503">filename</span><span class="op" id="5943511">,</span>&nbsp;<span class="ident" id="5943513">src</span><span class="op" id="5943516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943519">if</span>&nbsp;<span class="ident" id="5943522">err</span>&nbsp;<span class="op" id="5943526">!=</span>&nbsp;<span class="ident" id="5943529">nil</span>&nbsp;<span class="op" id="5943533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943537">return</span>&nbsp;<span class="ident" id="5943544">nil</span><span class="op" id="5943547">,</span>&nbsp;<span class="ident" id="5943549">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943554">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943558">var</span>&nbsp;<span class="ident" id="5943562">p</span>&nbsp;<span class="ident" id="5943564">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943572">defer</span>&nbsp;<span class="keyword" id="5943578">func</span><span class="op" id="5943582">(</span><span class="op" id="5943583">)</span>&nbsp;<span class="op" id="5943585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943589">if</span>&nbsp;<span class="ident" id="5943592">e</span>&nbsp;<span class="op" id="5943594">:=</span>&nbsp;<span class="builtinfunc" id="5943597">recover</span><span class="op" id="5943604">(</span><span class="op" id="5943605">)</span><span class="op" id="5943606">;</span>&nbsp;<span class="ident" id="5943608">e</span>&nbsp;<span class="op" id="5943610">!=</span>&nbsp;<span class="ident" id="5943613">nil</span>&nbsp;<span class="op" id="5943617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943622">_</span>&nbsp;<span class="op" id="5943624">=</span>&nbsp;<span class="ident" id="5943626">e</span><span class="op" id="5943627">.</span><span class="op" id="5943628">(</span><span class="ident" id="5943629">bailout</span><span class="op" id="5943636">)</span>&nbsp;<span class="comment" id="5943638">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943680">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943703">if</span>&nbsp;<span class="ident" id="5943706">f</span>&nbsp;<span class="op" id="5943708">==</span>&nbsp;<span class="ident" id="5943711">nil</span>&nbsp;<span class="op" id="5943715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943720">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943773">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943824">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943840">f</span>&nbsp;<span class="op" id="5943842">=</span>&nbsp;<span class="op" id="5943844">&amp;</span><span class="ident" id="5943845">ast</span><span class="op" id="5943848">.</span><span class="ident" id="5943849">File</span><span class="op" id="5943853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943859">Name</span><span class="op" id="5943863">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5943866">new</span><span class="op" id="5943869">(</span><span class="ident" id="5943870">ast</span><span class="op" id="5943873">.</span><span class="ident" id="5943874">Ident</span><span class="op" id="5943879">)</span><span class="op" id="5943880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943886">Scope</span><span class="op" id="5943891">:</span>&nbsp;<span class="ident" id="5943893">ast</span><span class="op" id="5943896">.</span><span class="ident" id="5943897">NewScope</span><span class="op" id="5943905">(</span><span class="ident" id="5943906">nil</span><span class="op" id="5943909">)</span><span class="op" id="5943910">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943924">p</span><span class="op" id="5943925">.</span><span class="ident" id="5943926">errors</span><span class="op" id="5943932">.</span><span class="ident" id="5943933">Sort</span><span class="op" id="5943937">(</span><span class="op" id="5943938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943942">err</span>&nbsp;<span class="op" id="5943946">=</span>&nbsp;<span class="ident" id="5943948">p</span><span class="op" id="5943949">.</span><span class="ident" id="5943950">errors</span><span class="op" id="5943956">.</span><span class="ident" id="5943957">Err</span><span class="op" id="5943960">(</span><span class="op" id="5943961">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943964">}</span><span class="op" id="5943965">(</span><span class="op" id="5943966">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943970">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943987">p</span><span class="op" id="5943988">.</span><span class="ident" id="5943989">init</span><span class="op" id="5943993">(</span><span class="ident" id="5943994">fset</span><span class="op" id="5943998">,</span>&nbsp;<span class="ident" id="5944000">filename</span><span class="op" id="5944008">,</span>&nbsp;<span class="ident" id="5944010">text</span><span class="op" id="5944014">,</span>&nbsp;<span class="ident" id="5944016">mode</span><span class="op" id="5944020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944023">f</span>&nbsp;<span class="op" id="5944025">=</span>&nbsp;<span class="ident" id="5944027">p</span><span class="op" id="5944028">.</span><span class="ident" id="5944029">parseFile</span><span class="op" id="5944038">(</span><span class="op" id="5944039">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944043">return</span><br>
<span class="lineno"></span><span class="op" id="5944050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944053">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="5944129">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5944205">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5944241">//</span><br>
<span class="lineno"></span><span class="comment" id="5944244">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="5944321">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="5944398">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="5944467">//</span><br>
<span class="lineno"></span><span class="comment" id="5944470">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5944547">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5944624">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="5944665">//</span><br>
<span class="lineno"></span><span class="keyword" id="5944668">func</span>&nbsp;<span class="ident" id="5944673">ParseDir</span><span class="op" id="5944681">(</span><span class="ident" id="5944682">fset</span>&nbsp;<span class="op" id="5944687">*</span><span class="ident" id="5944688">token</span><span class="op" id="5944693">.</span><span class="ident" id="5944694">FileSet</span><span class="op" id="5944701">,</span>&nbsp;<span class="ident" id="5944703">path</span>&nbsp;<span class="builtintype" id="5944708">string</span><span class="op" id="5944714">,</span>&nbsp;<span class="ident" id="5944716">filter</span>&nbsp;<span class="keyword" id="5944723">func</span><span class="op" id="5944727">(</span><span class="ident" id="5944728">os</span><span class="op" id="5944730">.</span><span class="ident" id="5944731">FileInfo</span><span class="op" id="5944739">)</span>&nbsp;<span class="builtintype" id="5944741">bool</span><span class="op" id="5944745">,</span>&nbsp;<span class="ident" id="5944747">mode</span>&nbsp;<span class="ident" id="5944752">Mode</span><span class="op" id="5944756">)</span>&nbsp;<span class="op" id="5944758">(</span><span class="ident" id="5944759">pkgs</span>&nbsp;<span class="keyword" id="5944764">map</span><span class="op" id="5944767">[</span><span class="builtintype" id="5944768">string</span><span class="op" id="5944774">]</span><span class="op" id="5944775">*</span><span class="ident" id="5944776">ast</span><span class="op" id="5944779">.</span><span class="ident" id="5944780">Package</span><span class="op" id="5944787">,</span>&nbsp;<span class="ident" id="5944789">first</span>&nbsp;<span class="builtintype" id="5944795">error</span><span class="op" id="5944800">)</span>&nbsp;<span class="op" id="5944802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944805">fd</span><span class="op" id="5944807">,</span>&nbsp;<span class="ident" id="5944809">err</span>&nbsp;<span class="op" id="5944813">:=</span>&nbsp;<span class="ident" id="5944816">os</span><span class="op" id="5944818">.</span><span class="ident" id="5944819">Open</span><span class="op" id="5944823">(</span><span class="ident" id="5944824">path</span><span class="op" id="5944828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944831">if</span>&nbsp;<span class="ident" id="5944834">err</span>&nbsp;<span class="op" id="5944838">!=</span>&nbsp;<span class="ident" id="5944841">nil</span>&nbsp;<span class="op" id="5944845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944849">return</span>&nbsp;<span class="ident" id="5944856">nil</span><span class="op" id="5944859">,</span>&nbsp;<span class="ident" id="5944861">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944869">defer</span>&nbsp;<span class="ident" id="5944875">fd</span><span class="op" id="5944877">.</span><span class="ident" id="5944878">Close</span><span class="op" id="5944883">(</span><span class="op" id="5944884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944888">list</span><span class="op" id="5944892">,</span>&nbsp;<span class="ident" id="5944894">err</span>&nbsp;<span class="op" id="5944898">:=</span>&nbsp;<span class="ident" id="5944901">fd</span><span class="op" id="5944903">.</span><span class="ident" id="5944904">Readdir</span><span class="op" id="5944911">(</span><span class="op" id="5944912">-</span><span class="num" id="5944913">1</span><span class="op" id="5944914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944917">if</span>&nbsp;<span class="ident" id="5944920">err</span>&nbsp;<span class="op" id="5944924">!=</span>&nbsp;<span class="ident" id="5944927">nil</span>&nbsp;<span class="op" id="5944931">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944935">return</span>&nbsp;<span class="ident" id="5944942">nil</span><span class="op" id="5944945">,</span>&nbsp;<span class="ident" id="5944947">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944956">pkgs</span>&nbsp;<span class="op" id="5944961">=</span>&nbsp;<span class="builtinfunc" id="5944963">make</span><span class="op" id="5944967">(</span><span class="keyword" id="5944968">map</span><span class="op" id="5944971">[</span><span class="builtintype" id="5944972">string</span><span class="op" id="5944978">]</span><span class="op" id="5944979">*</span><span class="ident" id="5944980">ast</span><span class="op" id="5944983">.</span><span class="ident" id="5944984">Package</span><span class="op" id="5944991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944994">for</span>&nbsp;<span class="ident" id="5944998">_</span><span class="op" id="5944999">,</span>&nbsp;<span class="ident" id="5945001">d</span>&nbsp;<span class="op" id="5945003">:=</span>&nbsp;<span class="keyword" id="5945006">range</span>&nbsp;<span class="ident" id="5945012">list</span>&nbsp;<span class="op" id="5945017">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945021">if</span>&nbsp;<span class="ident" id="5945024">strings</span><span class="op" id="5945031">.</span><span class="ident" id="5945032">HasSuffix</span><span class="op" id="5945041">(</span><span class="ident" id="5945042">d</span><span class="op" id="5945043">.</span><span class="ident" id="5945044">Name</span><span class="op" id="5945048">(</span><span class="op" id="5945049">)</span><span class="op" id="5945050">,</span>&nbsp;<span class="string" id="5945052">&#34;.go&#34;</span><span class="op" id="5945057">)</span>&nbsp;<span class="op" id="5945059">&amp;&amp;</span>&nbsp;<span class="op" id="5945062">(</span><span class="ident" id="5945063">filter</span>&nbsp;<span class="op" id="5945070">==</span>&nbsp;<span class="ident" id="5945073">nil</span>&nbsp;<span class="op" id="5945077">||</span>&nbsp;<span class="ident" id="5945080">filter</span><span class="op" id="5945086">(</span><span class="ident" id="5945087">d</span><span class="op" id="5945088">)</span><span class="op" id="5945089">)</span>&nbsp;<span class="op" id="5945091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945096">filename</span>&nbsp;<span class="op" id="5945105">:=</span>&nbsp;<span class="ident" id="5945108">filepath</span><span class="op" id="5945116">.</span><span class="ident" id="5945117">Join</span><span class="op" id="5945121">(</span><span class="ident" id="5945122">path</span><span class="op" id="5945126">,</span>&nbsp;<span class="ident" id="5945128">d</span><span class="op" id="5945129">.</span><span class="ident" id="5945130">Name</span><span class="op" id="5945134">(</span><span class="op" id="5945135">)</span><span class="op" id="5945136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945141">if</span>&nbsp;<span class="ident" id="5945144">src</span><span class="op" id="5945147">,</span>&nbsp;<span class="ident" id="5945149">err</span>&nbsp;<span class="op" id="5945153">:=</span>&nbsp;<span class="ident" id="5945156">ParseFile</span><span class="op" id="5945165">(</span><span class="ident" id="5945166">fset</span><span class="op" id="5945170">,</span>&nbsp;<span class="ident" id="5945172">filename</span><span class="op" id="5945180">,</span>&nbsp;<span class="ident" id="5945182">nil</span><span class="op" id="5945185">,</span>&nbsp;<span class="ident" id="5945187">mode</span><span class="op" id="5945191">)</span><span class="op" id="5945192">;</span>&nbsp;<span class="ident" id="5945194">err</span>&nbsp;<span class="op" id="5945198">==</span>&nbsp;<span class="ident" id="5945201">nil</span>&nbsp;<span class="op" id="5945205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945211">name</span>&nbsp;<span class="op" id="5945216">:=</span>&nbsp;<span class="ident" id="5945219">src</span><span class="op" id="5945222">.</span><span class="ident" id="5945223">Name</span><span class="op" id="5945227">.</span><span class="ident" id="5945228">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945237">pkg</span><span class="op" id="5945240">,</span>&nbsp;<span class="ident" id="5945242">found</span>&nbsp;<span class="op" id="5945248">:=</span>&nbsp;<span class="ident" id="5945251">pkgs</span><span class="op" id="5945255">[</span><span class="ident" id="5945256">name</span><span class="op" id="5945260">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945266">if</span>&nbsp;<span class="op" id="5945269">!</span><span class="ident" id="5945270">found</span>&nbsp;<span class="op" id="5945276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945283">pkg</span>&nbsp;<span class="op" id="5945287">=</span>&nbsp;<span class="op" id="5945289">&amp;</span><span class="ident" id="5945290">ast</span><span class="op" id="5945293">.</span><span class="ident" id="5945294">Package</span><span class="op" id="5945301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945309">Name</span><span class="op" id="5945313">:</span>&nbsp;&nbsp;<span class="ident" id="5945316">name</span><span class="op" id="5945320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945328">Files</span><span class="op" id="5945333">:</span>&nbsp;<span class="builtinfunc" id="5945335">make</span><span class="op" id="5945339">(</span><span class="keyword" id="5945340">map</span><span class="op" id="5945343">[</span><span class="builtintype" id="5945344">string</span><span class="op" id="5945350">]</span><span class="op" id="5945351">*</span><span class="ident" id="5945352">ast</span><span class="op" id="5945355">.</span><span class="ident" id="5945356">File</span><span class="op" id="5945360">)</span><span class="op" id="5945361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945368">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945375">pkgs</span><span class="op" id="5945379">[</span><span class="ident" id="5945380">name</span><span class="op" id="5945384">]</span>&nbsp;<span class="op" id="5945386">=</span>&nbsp;<span class="ident" id="5945388">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945402">pkg</span><span class="op" id="5945405">.</span><span class="ident" id="5945406">Files</span><span class="op" id="5945411">[</span><span class="ident" id="5945412">filename</span><span class="op" id="5945420">]</span>&nbsp;<span class="op" id="5945422">=</span>&nbsp;<span class="ident" id="5945424">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945431">}</span>&nbsp;<span class="keyword" id="5945433">else</span>&nbsp;<span class="keyword" id="5945438">if</span>&nbsp;<span class="ident" id="5945441">first</span>&nbsp;<span class="op" id="5945447">==</span>&nbsp;<span class="ident" id="5945450">nil</span>&nbsp;<span class="op" id="5945454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945460">first</span>&nbsp;<span class="op" id="5945466">=</span>&nbsp;<span class="ident" id="5945468">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945486">return</span><br>
<span class="lineno">165</span><span class="op" id="5945493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945496">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="5945577">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5945657">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="5945699">//</span><br>
<span class="lineno"></span><span class="keyword" id="5945702">func</span>&nbsp;<span class="ident" id="5945707">ParseExpr</span><span class="op" id="5945716">(</span><span class="ident" id="5945717">x</span>&nbsp;<span class="builtintype" id="5945719">string</span><span class="op" id="5945725">)</span>&nbsp;<span class="op" id="5945727">(</span><span class="ident" id="5945728">ast</span><span class="op" id="5945731">.</span><span class="ident" id="5945732">Expr</span><span class="op" id="5945736">,</span>&nbsp;<span class="builtintype" id="5945738">error</span><span class="op" id="5945743">)</span>&nbsp;<span class="op" id="5945745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945748">var</span>&nbsp;<span class="ident" id="5945752">p</span>&nbsp;<span class="ident" id="5945754">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945762">p</span><span class="op" id="5945763">.</span><span class="ident" id="5945764">init</span><span class="op" id="5945768">(</span><span class="ident" id="5945769">token</span><span class="op" id="5945774">.</span><span class="ident" id="5945775">NewFileSet</span><span class="op" id="5945785">(</span><span class="op" id="5945786">)</span><span class="op" id="5945787">,</span>&nbsp;<span class="string" id="5945789">&#34;&#34;</span><span class="op" id="5945791">,</span>&nbsp;<span class="op" id="5945793">[</span><span class="op" id="5945794">]</span><span class="builtintype" id="5945795">byte</span><span class="op" id="5945799">(</span><span class="ident" id="5945800">x</span><span class="op" id="5945801">)</span><span class="op" id="5945802">,</span>&nbsp;<span class="num" id="5945804">0</span><span class="op" id="5945805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945809">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945866">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945923">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945982">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946013">p</span><span class="op" id="5946014">.</span><span class="ident" id="5946015">openScope</span><span class="op" id="5946024">(</span><span class="op" id="5946025">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946028">p</span><span class="op" id="5946029">.</span><span class="ident" id="5946030">pkgScope</span>&nbsp;<span class="op" id="5946039">=</span>&nbsp;<span class="ident" id="5946041">p</span><span class="op" id="5946042">.</span><span class="ident" id="5946043">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946053">e</span>&nbsp;<span class="op" id="5946055">:=</span>&nbsp;<span class="ident" id="5946058">p</span><span class="op" id="5946059">.</span><span class="ident" id="5946060">parseRhsOrType</span><span class="op" id="5946074">(</span><span class="op" id="5946075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946078">p</span><span class="op" id="5946079">.</span><span class="ident" id="5946080">closeScope</span><span class="op" id="5946090">(</span><span class="op" id="5946091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946094">assert</span><span class="op" id="5946100">(</span><span class="ident" id="5946101">p</span><span class="op" id="5946102">.</span><span class="ident" id="5946103">topScope</span>&nbsp;<span class="op" id="5946112">==</span>&nbsp;<span class="ident" id="5946115">nil</span><span class="op" id="5946118">,</span>&nbsp;<span class="string" id="5946120">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5946139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946143">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946188">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946232">if</span>&nbsp;<span class="ident" id="5946235">p</span><span class="op" id="5946236">.</span><span class="ident" id="5946237">tok</span>&nbsp;<span class="op" id="5946241">==</span>&nbsp;<span class="ident" id="5946244">token</span><span class="op" id="5946249">.</span><span class="ident" id="5946250">SEMICOLON</span>&nbsp;<span class="op" id="5946260">&amp;&amp;</span>&nbsp;<span class="ident" id="5946263">p</span><span class="op" id="5946264">.</span><span class="ident" id="5946265">lit</span>&nbsp;<span class="op" id="5946269">==</span>&nbsp;<span class="string" id="5946272">&#34;\n&#34;</span>&nbsp;<span class="op" id="5946277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946281">p</span><span class="op" id="5946282">.</span><span class="ident" id="5946283">next</span><span class="op" id="5946287">(</span><span class="op" id="5946288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946291">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946294">p</span><span class="op" id="5946295">.</span><span class="ident" id="5946296">expect</span><span class="op" id="5946302">(</span><span class="ident" id="5946303">token</span><span class="op" id="5946308">.</span><span class="ident" id="5946309">EOF</span><span class="op" id="5946312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946316">if</span>&nbsp;<span class="ident" id="5946319">p</span><span class="op" id="5946320">.</span><span class="ident" id="5946321">errors</span><span class="op" id="5946327">.</span><span class="ident" id="5946328">Len</span><span class="op" id="5946331">(</span><span class="op" id="5946332">)</span>&nbsp;<span class="op" id="5946334">&gt;</span>&nbsp;<span class="num" id="5946336">0</span>&nbsp;<span class="op" id="5946338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946342">p</span><span class="op" id="5946343">.</span><span class="ident" id="5946344">errors</span><span class="op" id="5946350">.</span><span class="ident" id="5946351">Sort</span><span class="op" id="5946355">(</span><span class="op" id="5946356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946360">return</span>&nbsp;<span class="ident" id="5946367">nil</span><span class="op" id="5946370">,</span>&nbsp;<span class="ident" id="5946372">p</span><span class="op" id="5946373">.</span><span class="ident" id="5946374">errors</span><span class="op" id="5946380">.</span><span class="ident" id="5946381">Err</span><span class="op" id="5946384">(</span><span class="op" id="5946385">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946392">return</span>&nbsp;<span class="ident" id="5946399">e</span><span class="op" id="5946400">,</span>&nbsp;<span class="ident" id="5946402">nil</span><br>
<span class="lineno"></span><span class="op" id="5946406">}</span>
</div>
</body>
</html>
