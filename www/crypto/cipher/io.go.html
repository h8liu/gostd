<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3720547">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3720602">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3720656">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3720707">package</span>&nbsp;<span class="ident" id="3720715">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3720723">import</span>&nbsp;<span class="string" id="3720730">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3720736">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3720814">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3720846">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3720918">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3720973">type</span>&nbsp;<span class="ident" id="3720978">StreamReader</span>&nbsp;<span class="keyword" id="3720991">struct</span>&nbsp;<span class="op" id="3720998">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721001">S</span>&nbsp;<span class="ident" id="3721003"><a href="/crypto/cipher/cipher.go.html#3708421">Stream</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721011">R</span>&nbsp;<span class="ident" id="3721013"><a href="/crypto/cipher/io.go.html#3720730">io</a></span><span class="op" id="3721015">.</span><span class="ident" id="3721016">Reader</span><br>
<span class="lineno"></span><span class="op" id="3721023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3721026">func</span>&nbsp;<span class="op" id="3721031">(</span><span class="ident" id="3721032">r</span>&nbsp;<span class="ident" id="3721034"><a href="/crypto/cipher/io.go.html#3720978">StreamReader</a></span><span class="op" id="3721046">)</span>&nbsp;<span class="ident" id="3721048">Read</span><span class="op" id="3721052">(</span><span class="ident" id="3721053">dst</span>&nbsp;<span class="op" id="3721057">[</span><span class="op" id="3721058">]</span><span class="builtintype" id="3721059">byte</span><span class="op" id="3721063">)</span>&nbsp;<span class="op" id="3721065">(</span><span class="ident" id="3721066">n</span>&nbsp;<span class="builtintype" id="3721068">int</span><span class="op" id="3721071">,</span>&nbsp;<span class="ident" id="3721073">err</span>&nbsp;<span class="builtintype" id="3721077">error</span><span class="op" id="3721082">)</span>&nbsp;<span class="op" id="3721084">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721087"><a href="/crypto/cipher/io.go.html#3721066">n</a></span><span class="op" id="3721088">,</span>&nbsp;<span class="ident" id="3721090"><a href="/crypto/cipher/io.go.html#3721073">err</a></span>&nbsp;<span class="op" id="3721094">=</span>&nbsp;<span class="ident" id="3721096"><a href="/crypto/cipher/io.go.html#3721032">r</a></span><span class="op" id="3721097">.</span><span class="ident" id="3721098">R</span><span class="op" id="3721099">.</span><span class="ident" id="3721100">Read</span><span class="op" id="3721104">(</span><span class="ident" id="3721105"><a href="/crypto/cipher/io.go.html#3721053">dst</a></span><span class="op" id="3721108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721111"><a href="/crypto/cipher/io.go.html#3721032">r</a></span><span class="op" id="3721112">.</span><span class="ident" id="3721113">S</span><span class="op" id="3721114">.</span><span class="ident" id="3721115">XORKeyStream</span><span class="op" id="3721127">(</span><span class="ident" id="3721128"><a href="/crypto/cipher/io.go.html#3721053">dst</a></span><span class="op" id="3721131">[</span><span class="op" id="3721132">:</span><span class="ident" id="3721133"><a href="/crypto/cipher/io.go.html#3721066">n</a></span><span class="op" id="3721134">]</span><span class="op" id="3721135">,</span>&nbsp;<span class="ident" id="3721137"><a href="/crypto/cipher/io.go.html#3721053">dst</a></span><span class="op" id="3721140">[</span><span class="op" id="3721141">:</span><span class="ident" id="3721142"><a href="/crypto/cipher/io.go.html#3721066">n</a></span><span class="op" id="3721143">]</span><span class="op" id="3721144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721147">return</span><br>
<span class="lineno"></span><span class="op" id="3721154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3721157">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3721229">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3721302">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3721379">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3721444">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3721481">type</span>&nbsp;<span class="ident" id="3721486">StreamWriter</span>&nbsp;<span class="keyword" id="3721499">struct</span>&nbsp;<span class="op" id="3721506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721509">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3721513"><a href="/crypto/cipher/cipher.go.html#3708421">Stream</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721521">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3721525"><a href="/crypto/cipher/io.go.html#3720730">io</a></span><span class="op" id="3721527">.</span><span class="ident" id="3721528">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721536">Err</span>&nbsp;<span class="builtintype" id="3721540">error</span>&nbsp;<span class="comment" id="3721546">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3721556">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3721559">func</span>&nbsp;<span class="op" id="3721564">(</span><span class="ident" id="3721565">w</span>&nbsp;<span class="ident" id="3721567"><a href="/crypto/cipher/io.go.html#3721486">StreamWriter</a></span><span class="op" id="3721579">)</span>&nbsp;<span class="ident" id="3721581">Write</span><span class="op" id="3721586">(</span><span class="ident" id="3721587">src</span>&nbsp;<span class="op" id="3721591">[</span><span class="op" id="3721592">]</span><span class="builtintype" id="3721593">byte</span><span class="op" id="3721597">)</span>&nbsp;<span class="op" id="3721599">(</span><span class="ident" id="3721600">n</span>&nbsp;<span class="builtintype" id="3721602">int</span><span class="op" id="3721605">,</span>&nbsp;<span class="ident" id="3721607">err</span>&nbsp;<span class="builtintype" id="3721611">error</span><span class="op" id="3721616">)</span>&nbsp;<span class="op" id="3721618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721621">c</span>&nbsp;<span class="op" id="3721623">:=</span>&nbsp;<span class="builtinfunc" id="3721626">make</span><span class="op" id="3721630">(</span><span class="op" id="3721631">[</span><span class="op" id="3721632">]</span><span class="builtintype" id="3721633">byte</span><span class="op" id="3721637">,</span>&nbsp;<span class="builtinfunc" id="3721639">len</span><span class="op" id="3721642">(</span><span class="ident" id="3721643"><a href="/crypto/cipher/io.go.html#3721587">src</a></span><span class="op" id="3721646">)</span><span class="op" id="3721647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721650"><a href="/crypto/cipher/io.go.html#3721565">w</a></span><span class="op" id="3721651">.</span><span class="ident" id="3721652">S</span><span class="op" id="3721653">.</span><span class="ident" id="3721654">XORKeyStream</span><span class="op" id="3721666">(</span><span class="ident" id="3721667"><a href="/crypto/cipher/io.go.html#3721621">c</a></span><span class="op" id="3721668">,</span>&nbsp;<span class="ident" id="3721670"><a href="/crypto/cipher/io.go.html#3721587">src</a></span><span class="op" id="3721673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721676"><a href="/crypto/cipher/io.go.html#3721600">n</a></span><span class="op" id="3721677">,</span>&nbsp;<span class="ident" id="3721679"><a href="/crypto/cipher/io.go.html#3721607">err</a></span>&nbsp;<span class="op" id="3721683">=</span>&nbsp;<span class="ident" id="3721685"><a href="/crypto/cipher/io.go.html#3721565">w</a></span><span class="op" id="3721686">.</span><span class="ident" id="3721687">W</span><span class="op" id="3721688">.</span><span class="ident" id="3721689">Write</span><span class="op" id="3721694">(</span><span class="ident" id="3721695"><a href="/crypto/cipher/io.go.html#3721621">c</a></span><span class="op" id="3721696">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721699">if</span>&nbsp;<span class="ident" id="3721702"><a href="/crypto/cipher/io.go.html#3721600">n</a></span>&nbsp;<span class="op" id="3721704">!=</span>&nbsp;<span class="builtinfunc" id="3721707">len</span><span class="op" id="3721710">(</span><span class="ident" id="3721711"><a href="/crypto/cipher/io.go.html#3721587">src</a></span><span class="op" id="3721714">)</span>&nbsp;<span class="op" id="3721716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721720">if</span>&nbsp;<span class="ident" id="3721723"><a href="/crypto/cipher/io.go.html#3721607">err</a></span>&nbsp;<span class="op" id="3721727">==</span>&nbsp;<span class="ident" id="3721730">nil</span>&nbsp;<span class="op" id="3721734">{</span>&nbsp;<span class="comment" id="3721736">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721762"><a href="/crypto/cipher/io.go.html#3721607">err</a></span>&nbsp;<span class="op" id="3721766">=</span>&nbsp;<span class="ident" id="3721768"><a href="/crypto/cipher/io.go.html#3720730">io</a></span><span class="op" id="3721770">.</span><span class="ident" id="3721771">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721790">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721793">return</span><br>
<span class="lineno"></span><span class="op" id="3721800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3721803">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3721891">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3721942">func</span>&nbsp;<span class="op" id="3721947">(</span><span class="ident" id="3721948">w</span>&nbsp;<span class="ident" id="3721950"><a href="/crypto/cipher/io.go.html#3721486">StreamWriter</a></span><span class="op" id="3721962">)</span>&nbsp;<span class="ident" id="3721964">Close</span><span class="op" id="3721969">(</span><span class="op" id="3721970">)</span>&nbsp;<span class="builtintype" id="3721972">error</span>&nbsp;<span class="op" id="3721978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721981">if</span>&nbsp;<span class="ident" id="3721984">c</span><span class="op" id="3721985">,</span>&nbsp;<span class="ident" id="3721987">ok</span>&nbsp;<span class="op" id="3721990">:=</span>&nbsp;<span class="ident" id="3721993"><a href="/crypto/cipher/io.go.html#3721948">w</a></span><span class="op" id="3721994">.</span><span class="ident" id="3721995">W</span><span class="op" id="3721996">.</span><span class="op" id="3721997">(</span><span class="ident" id="3721998"><a href="/crypto/cipher/io.go.html#3720730">io</a></span><span class="op" id="3722000">.</span><span class="ident" id="3722001">Closer</span><span class="op" id="3722007">)</span><span class="op" id="3722008">;</span>&nbsp;<span class="ident" id="3722010"><a href="/crypto/cipher/io.go.html#3721987">ok</a></span>&nbsp;<span class="op" id="3722013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722017">return</span>&nbsp;<span class="ident" id="3722024"><a href="/crypto/cipher/io.go.html#3721984">c</a></span><span class="op" id="3722025">.</span><span class="ident" id="3722026">Close</span><span class="op" id="3722031">(</span><span class="op" id="3722032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722038">return</span>&nbsp;<span class="ident" id="3722045">nil</span><br>
<span class="lineno">55</span><span class="op" id="3722049">}</span>
</div>
</body>
</html>
