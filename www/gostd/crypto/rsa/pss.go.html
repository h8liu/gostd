<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html" class="current">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3918561">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3918616">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3918670">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3918721">package</span>&nbsp;<span class="ident" id="3918729">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3918734">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3918788">//</span><br>
<span class="lineno"></span><span class="comment" id="3918791">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3918888">import</span>&nbsp;<span class="op" id="3918895">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918898">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918907">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918917">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918927">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918935">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3918941">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3918952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3918955">func</span>&nbsp;<span class="ident" id="3918960">emsaPSSEncode</span><span class="op" id="3918973">(</span><span class="ident" id="3918974">mHash</span>&nbsp;<span class="op" id="3918980">[</span><span class="op" id="3918981">]</span><span class="builtintype" id="3918982">byte</span><span class="op" id="3918986">,</span>&nbsp;<span class="ident" id="3918988">emBits</span>&nbsp;<span class="builtintype" id="3918995">int</span><span class="op" id="3918998">,</span>&nbsp;<span class="ident" id="3919000">salt</span>&nbsp;<span class="op" id="3919005">[</span><span class="op" id="3919006">]</span><span class="builtintype" id="3919007">byte</span><span class="op" id="3919011">,</span>&nbsp;<span class="ident" id="3919013">hash</span>&nbsp;<span class="ident" id="3919018">hash</span><span class="op" id="3919022">.</span><span class="ident" id="3919023">Hash</span><span class="op" id="3919027">)</span>&nbsp;<span class="op" id="3919029">(</span><span class="op" id="3919030">[</span><span class="op" id="3919031">]</span><span class="builtintype" id="3919032">byte</span><span class="op" id="3919036">,</span>&nbsp;<span class="builtintype" id="3919038">error</span><span class="op" id="3919043">)</span>&nbsp;<span class="op" id="3919045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919048">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919075">hLen</span>&nbsp;<span class="op" id="3919080">:=</span>&nbsp;<span class="ident" id="3919083">hash</span><span class="op" id="3919087">.</span><span class="ident" id="3919088">Size</span><span class="op" id="3919092">(</span><span class="op" id="3919093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919096">sLen</span>&nbsp;<span class="op" id="3919101">:=</span>&nbsp;<span class="builtinfunc" id="3919104">len</span><span class="op" id="3919107">(</span><span class="ident" id="3919108">salt</span><span class="op" id="3919112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919115">emLen</span>&nbsp;<span class="op" id="3919121">:=</span>&nbsp;<span class="op" id="3919124">(</span><span class="ident" id="3919125">emBits</span>&nbsp;<span class="op" id="3919132">+</span>&nbsp;<span class="num" id="3919134">7</span><span class="op" id="3919135">)</span>&nbsp;<span class="op" id="3919137">/</span>&nbsp;<span class="num" id="3919139">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919143">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919215">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919310">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919314">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919376">if</span>&nbsp;<span class="builtinfunc" id="3919379">len</span><span class="op" id="3919382">(</span><span class="ident" id="3919383">mHash</span><span class="op" id="3919388">)</span>&nbsp;<span class="op" id="3919390">!=</span>&nbsp;<span class="ident" id="3919393">hLen</span>&nbsp;<span class="op" id="3919398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919402">return</span>&nbsp;<span class="ident" id="3919409">nil</span><span class="op" id="3919412">,</span>&nbsp;<span class="ident" id="3919414">errors</span><span class="op" id="3919420">.</span><span class="ident" id="3919421">New</span><span class="op" id="3919424">(</span><span class="string" id="3919425">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="3919467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919470">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919474">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919545">if</span>&nbsp;<span class="ident" id="3919548">emLen</span>&nbsp;<span class="op" id="3919554">&lt;</span>&nbsp;<span class="ident" id="3919556">hLen</span><span class="op" id="3919560">+</span><span class="ident" id="3919561">sLen</span><span class="op" id="3919565">+</span><span class="num" id="3919566">2</span>&nbsp;<span class="op" id="3919568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919572">return</span>&nbsp;<span class="ident" id="3919579">nil</span><span class="op" id="3919582">,</span>&nbsp;<span class="ident" id="3919584">errors</span><span class="op" id="3919590">.</span><span class="ident" id="3919591">New</span><span class="op" id="3919594">(</span><span class="string" id="3919595">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="3919623">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919630">em</span>&nbsp;<span class="op" id="3919633">:=</span>&nbsp;<span class="builtinfunc" id="3919636">make</span><span class="op" id="3919640">(</span><span class="op" id="3919641">[</span><span class="op" id="3919642">]</span><span class="builtintype" id="3919643">byte</span><span class="op" id="3919647">,</span>&nbsp;<span class="ident" id="3919649">emLen</span><span class="op" id="3919654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919657">db</span>&nbsp;<span class="op" id="3919660">:=</span>&nbsp;<span class="ident" id="3919663">em</span><span class="op" id="3919665">[</span><span class="op" id="3919666">:</span><span class="ident" id="3919667">emLen</span><span class="op" id="3919672">-</span><span class="ident" id="3919673">sLen</span><span class="op" id="3919677">-</span><span class="ident" id="3919678">hLen</span><span class="op" id="3919682">-</span><span class="num" id="3919683">2</span><span class="op" id="3919684">+</span><span class="num" id="3919685">1</span><span class="op" id="3919686">+</span><span class="ident" id="3919687">sLen</span><span class="op" id="3919691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919694">h</span>&nbsp;<span class="op" id="3919696">:=</span>&nbsp;<span class="ident" id="3919699">em</span><span class="op" id="3919701">[</span><span class="ident" id="3919702">emLen</span><span class="op" id="3919707">-</span><span class="ident" id="3919708">sLen</span><span class="op" id="3919712">-</span><span class="ident" id="3919713">hLen</span><span class="op" id="3919717">-</span><span class="num" id="3919718">2</span><span class="op" id="3919719">+</span><span class="num" id="3919720">1</span><span class="op" id="3919721">+</span><span class="ident" id="3919722">sLen</span>&nbsp;<span class="op" id="3919727">:</span>&nbsp;<span class="ident" id="3919729">emLen</span><span class="op" id="3919734">-</span><span class="num" id="3919735">1</span><span class="op" id="3919736">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919740">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919813">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919852">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919856">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919929">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3919933">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920029">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920033">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920092">var</span>&nbsp;<span class="ident" id="3920096">prefix</span>&nbsp;<span class="op" id="3920103">[</span><span class="num" id="3920104">8</span><span class="op" id="3920105">]</span><span class="builtintype" id="3920106">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920113">hash</span><span class="op" id="3920117">.</span><span class="ident" id="3920118">Write</span><span class="op" id="3920123">(</span><span class="ident" id="3920124">prefix</span><span class="op" id="3920130">[</span><span class="op" id="3920131">:</span><span class="op" id="3920132">]</span><span class="op" id="3920133">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920136">hash</span><span class="op" id="3920140">.</span><span class="ident" id="3920141">Write</span><span class="op" id="3920146">(</span><span class="ident" id="3920147">mHash</span><span class="op" id="3920152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920155">hash</span><span class="op" id="3920159">.</span><span class="ident" id="3920160">Write</span><span class="op" id="3920165">(</span><span class="ident" id="3920166">salt</span><span class="op" id="3920170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920174">h</span>&nbsp;<span class="op" id="3920176">=</span>&nbsp;<span class="ident" id="3920178">hash</span><span class="op" id="3920182">.</span><span class="ident" id="3920183">Sum</span><span class="op" id="3920186">(</span><span class="ident" id="3920187">h</span><span class="op" id="3920188">[</span><span class="op" id="3920189">:</span><span class="num" id="3920190">0</span><span class="op" id="3920191">]</span><span class="op" id="3920192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920195">hash</span><span class="op" id="3920199">.</span><span class="ident" id="3920200">Reset</span><span class="op" id="3920205">(</span><span class="op" id="3920206">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920210">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920284">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920333">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920337">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920406">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920433">db</span><span class="op" id="3920435">[</span><span class="ident" id="3920436">emLen</span><span class="op" id="3920441">-</span><span class="ident" id="3920442">sLen</span><span class="op" id="3920446">-</span><span class="ident" id="3920447">hLen</span><span class="op" id="3920451">-</span><span class="num" id="3920452">2</span><span class="op" id="3920453">]</span>&nbsp;<span class="op" id="3920455">=</span>&nbsp;<span class="num" id="3920457">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3920463">copy</span><span class="op" id="3920467">(</span><span class="ident" id="3920468">db</span><span class="op" id="3920470">[</span><span class="ident" id="3920471">emLen</span><span class="op" id="3920476">-</span><span class="ident" id="3920477">sLen</span><span class="op" id="3920481">-</span><span class="ident" id="3920482">hLen</span><span class="op" id="3920486">-</span><span class="num" id="3920487">1</span><span class="op" id="3920488">:</span><span class="op" id="3920489">]</span><span class="op" id="3920490">,</span>&nbsp;<span class="ident" id="3920492">salt</span><span class="op" id="3920496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920500">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920547">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920551">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920591">mgf1XOR</span><span class="op" id="3920598">(</span><span class="ident" id="3920599">db</span><span class="op" id="3920601">,</span>&nbsp;<span class="ident" id="3920603">hash</span><span class="op" id="3920607">,</span>&nbsp;<span class="ident" id="3920609">h</span><span class="op" id="3920610">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920614">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920688">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920715">db</span><span class="op" id="3920717">[</span><span class="num" id="3920718">0</span><span class="op" id="3920719">]</span>&nbsp;<span class="op" id="3920721">&amp;=</span>&nbsp;<span class="op" id="3920724">(</span><span class="num" id="3920725">0xFF</span>&nbsp;<span class="op" id="3920730">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3920733">uint</span><span class="op" id="3920737">(</span><span class="num" id="3920738">8</span><span class="op" id="3920739">*</span><span class="ident" id="3920740">emLen</span><span class="op" id="3920745">-</span><span class="ident" id="3920746">emBits</span><span class="op" id="3920752">)</span><span class="op" id="3920753">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920757">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920797">em</span><span class="op" id="3920799">[</span><span class="ident" id="3920800">emLen</span><span class="op" id="3920805">-</span><span class="num" id="3920806">1</span><span class="op" id="3920807">]</span>&nbsp;<span class="op" id="3920809">=</span>&nbsp;<span class="num" id="3920811">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920818">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920837">return</span>&nbsp;<span class="ident" id="3920844">em</span><span class="op" id="3920846">,</span>&nbsp;<span class="ident" id="3920848">nil</span><br>
<span class="lineno"></span><span class="op" id="3920852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3920855">func</span>&nbsp;<span class="ident" id="3920860">emsaPSSVerify</span><span class="op" id="3920873">(</span><span class="ident" id="3920874">mHash</span><span class="op" id="3920879">,</span>&nbsp;<span class="ident" id="3920881">em</span>&nbsp;<span class="op" id="3920884">[</span><span class="op" id="3920885">]</span><span class="builtintype" id="3920886">byte</span><span class="op" id="3920890">,</span>&nbsp;<span class="ident" id="3920892">emBits</span><span class="op" id="3920898">,</span>&nbsp;<span class="ident" id="3920900">sLen</span>&nbsp;<span class="builtintype" id="3920905">int</span><span class="op" id="3920908">,</span>&nbsp;<span class="ident" id="3920910">hash</span>&nbsp;<span class="ident" id="3920915">hash</span><span class="op" id="3920919">.</span><span class="ident" id="3920920">Hash</span><span class="op" id="3920924">)</span>&nbsp;<span class="builtintype" id="3920926">error</span>&nbsp;<span class="op" id="3920932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920935">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921007">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921080">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921098">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921102">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921163">hLen</span>&nbsp;<span class="op" id="3921168">:=</span>&nbsp;<span class="ident" id="3921171">hash</span><span class="op" id="3921175">.</span><span class="ident" id="3921176">Size</span><span class="op" id="3921180">(</span><span class="op" id="3921181">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921184">if</span>&nbsp;<span class="ident" id="3921187">hLen</span>&nbsp;<span class="op" id="3921192">!=</span>&nbsp;<span class="builtinfunc" id="3921195">len</span><span class="op" id="3921198">(</span><span class="ident" id="3921199">mHash</span><span class="op" id="3921204">)</span>&nbsp;<span class="op" id="3921206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921210">return</span>&nbsp;<span class="ident" id="3921217">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921238">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921306">emLen</span>&nbsp;<span class="op" id="3921312">:=</span>&nbsp;<span class="op" id="3921315">(</span><span class="ident" id="3921316">emBits</span>&nbsp;<span class="op" id="3921323">+</span>&nbsp;<span class="num" id="3921325">7</span><span class="op" id="3921326">)</span>&nbsp;<span class="op" id="3921328">/</span>&nbsp;<span class="num" id="3921330">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921333">if</span>&nbsp;<span class="ident" id="3921336">emLen</span>&nbsp;<span class="op" id="3921342">&lt;</span>&nbsp;<span class="ident" id="3921344">hLen</span><span class="op" id="3921348">+</span><span class="ident" id="3921349">sLen</span><span class="op" id="3921353">+</span><span class="num" id="3921354">2</span>&nbsp;<span class="op" id="3921356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921360">return</span>&nbsp;<span class="ident" id="3921367">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921388">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921457">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921503">if</span>&nbsp;<span class="ident" id="3921506">em</span><span class="op" id="3921508">[</span><span class="builtinfunc" id="3921509">len</span><span class="op" id="3921512">(</span><span class="ident" id="3921513">em</span><span class="op" id="3921515">)</span><span class="op" id="3921516">-</span><span class="num" id="3921517">1</span><span class="op" id="3921518">]</span>&nbsp;<span class="op" id="3921520">!=</span>&nbsp;<span class="num" id="3921523">0xBC</span>&nbsp;<span class="op" id="3921528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921532">return</span>&nbsp;<span class="ident" id="3921539">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921556">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921560">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921632">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921671">db</span>&nbsp;<span class="op" id="3921674">:=</span>&nbsp;<span class="ident" id="3921677">em</span><span class="op" id="3921679">[</span><span class="op" id="3921680">:</span><span class="ident" id="3921681">emLen</span><span class="op" id="3921686">-</span><span class="ident" id="3921687">hLen</span><span class="op" id="3921691">-</span><span class="num" id="3921692">1</span><span class="op" id="3921693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921696">h</span>&nbsp;<span class="op" id="3921698">:=</span>&nbsp;<span class="ident" id="3921701">em</span><span class="op" id="3921703">[</span><span class="ident" id="3921704">emLen</span><span class="op" id="3921709">-</span><span class="ident" id="3921710">hLen</span><span class="op" id="3921714">-</span><span class="num" id="3921715">1</span>&nbsp;<span class="op" id="3921717">:</span>&nbsp;<span class="builtinfunc" id="3921719">len</span><span class="op" id="3921722">(</span><span class="ident" id="3921723">em</span><span class="op" id="3921725">)</span><span class="op" id="3921726">-</span><span class="num" id="3921727">1</span><span class="op" id="3921728">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921732">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921805">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921875">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921889">if</span>&nbsp;<span class="ident" id="3921892">em</span><span class="op" id="3921894">[</span><span class="num" id="3921895">0</span><span class="op" id="3921896">]</span><span class="op" id="3921897">&amp;</span><span class="op" id="3921898">(</span><span class="num" id="3921899">0xFF</span><span class="op" id="3921903">&lt;&lt;</span><span class="builtintype" id="3921905">uint</span><span class="op" id="3921909">(</span><span class="num" id="3921910">8</span><span class="op" id="3921911">-</span><span class="op" id="3921912">(</span><span class="num" id="3921913">8</span><span class="op" id="3921914">*</span><span class="ident" id="3921915">emLen</span><span class="op" id="3921920">-</span><span class="ident" id="3921921">emBits</span><span class="op" id="3921927">)</span><span class="op" id="3921928">)</span><span class="op" id="3921929">)</span>&nbsp;<span class="op" id="3921931">!=</span>&nbsp;<span class="num" id="3921934">0</span>&nbsp;<span class="op" id="3921936">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921940">return</span>&nbsp;<span class="ident" id="3921947">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3921968">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922015">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922019">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922058">mgf1XOR</span><span class="op" id="3922065">(</span><span class="ident" id="3922066">db</span><span class="op" id="3922068">,</span>&nbsp;<span class="ident" id="3922070">hash</span><span class="op" id="3922074">,</span>&nbsp;<span class="ident" id="3922076">h</span><span class="op" id="3922077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922081">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922158">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922175">db</span><span class="op" id="3922177">[</span><span class="num" id="3922178">0</span><span class="op" id="3922179">]</span>&nbsp;<span class="op" id="3922181">&amp;=</span>&nbsp;<span class="op" id="3922184">(</span><span class="num" id="3922185">0xFF</span>&nbsp;<span class="op" id="3922190">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3922193">uint</span><span class="op" id="3922197">(</span><span class="num" id="3922198">8</span><span class="op" id="3922199">*</span><span class="ident" id="3922200">emLen</span><span class="op" id="3922205">-</span><span class="ident" id="3922206">emBits</span><span class="op" id="3922212">)</span><span class="op" id="3922213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922217">if</span>&nbsp;<span class="ident" id="3922220">sLen</span>&nbsp;<span class="op" id="3922225">==</span>&nbsp;<span class="ident" id="3922228">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3922246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922249">FindSaltLength</span><span class="op" id="3922263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922267">for</span>&nbsp;<span class="ident" id="3922271">sLen</span>&nbsp;<span class="op" id="3922276">=</span>&nbsp;<span class="ident" id="3922278">emLen</span>&nbsp;<span class="op" id="3922284">-</span>&nbsp;<span class="op" id="3922286">(</span><span class="ident" id="3922287">hLen</span>&nbsp;<span class="op" id="3922292">+</span>&nbsp;<span class="num" id="3922294">2</span><span class="op" id="3922295">)</span><span class="op" id="3922296">;</span>&nbsp;<span class="ident" id="3922298">sLen</span>&nbsp;<span class="op" id="3922303">&gt;=</span>&nbsp;<span class="num" id="3922306">0</span><span class="op" id="3922307">;</span>&nbsp;<span class="ident" id="3922309">sLen</span><span class="op" id="3922313">--</span>&nbsp;<span class="op" id="3922316">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922321">switch</span>&nbsp;<span class="ident" id="3922328">db</span><span class="op" id="3922330">[</span><span class="ident" id="3922331">emLen</span><span class="op" id="3922336">-</span><span class="ident" id="3922337">hLen</span><span class="op" id="3922341">-</span><span class="ident" id="3922342">sLen</span><span class="op" id="3922346">-</span><span class="num" id="3922347">2</span><span class="op" id="3922348">]</span>&nbsp;<span class="op" id="3922350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922355">case</span>&nbsp;<span class="num" id="3922360">1</span><span class="op" id="3922361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922367">break</span>&nbsp;<span class="ident" id="3922373">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922391">case</span>&nbsp;<span class="num" id="3922396">0</span><span class="op" id="3922397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922403">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922415">default</span><span class="op" id="3922422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922428">return</span>&nbsp;<span class="ident" id="3922435">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922462">if</span>&nbsp;<span class="ident" id="3922465">sLen</span>&nbsp;<span class="op" id="3922470">&lt;</span>&nbsp;<span class="num" id="3922472">0</span>&nbsp;<span class="op" id="3922474">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922479">return</span>&nbsp;<span class="ident" id="3922486">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922507">}</span>&nbsp;<span class="keyword" id="3922509">else</span>&nbsp;<span class="op" id="3922514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922518">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922593">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922668">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922741">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922782">for</span>&nbsp;<span class="ident" id="3922786">_</span><span class="op" id="3922787">,</span>&nbsp;<span class="ident" id="3922789">e</span>&nbsp;<span class="op" id="3922791">:=</span>&nbsp;<span class="keyword" id="3922794">range</span>&nbsp;<span class="ident" id="3922800">db</span><span class="op" id="3922802">[</span><span class="op" id="3922803">:</span><span class="ident" id="3922804">emLen</span><span class="op" id="3922809">-</span><span class="ident" id="3922810">hLen</span><span class="op" id="3922814">-</span><span class="ident" id="3922815">sLen</span><span class="op" id="3922819">-</span><span class="num" id="3922820">2</span><span class="op" id="3922821">]</span>&nbsp;<span class="op" id="3922823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922828">if</span>&nbsp;<span class="ident" id="3922831">e</span>&nbsp;<span class="op" id="3922833">!=</span>&nbsp;<span class="num" id="3922836">0x00</span>&nbsp;<span class="op" id="3922841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922847">return</span>&nbsp;<span class="ident" id="3922854">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922881">if</span>&nbsp;<span class="ident" id="3922884">db</span><span class="op" id="3922886">[</span><span class="ident" id="3922887">emLen</span><span class="op" id="3922892">-</span><span class="ident" id="3922893">hLen</span><span class="op" id="3922897">-</span><span class="ident" id="3922898">sLen</span><span class="op" id="3922902">-</span><span class="num" id="3922903">2</span><span class="op" id="3922904">]</span>&nbsp;<span class="op" id="3922906">!=</span>&nbsp;<span class="num" id="3922909">0x01</span>&nbsp;<span class="op" id="3922914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922919">return</span>&nbsp;<span class="ident" id="3922926">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922944">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922951">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923000">salt</span>&nbsp;<span class="op" id="3923005">:=</span>&nbsp;<span class="ident" id="3923008">db</span><span class="op" id="3923010">[</span><span class="builtinfunc" id="3923011">len</span><span class="op" id="3923014">(</span><span class="ident" id="3923015">db</span><span class="op" id="3923017">)</span><span class="op" id="3923018">-</span><span class="ident" id="3923019">sLen</span><span class="op" id="3923023">:</span><span class="op" id="3923024">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923028">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923041">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923106">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923173">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923202">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923206">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923265">var</span>&nbsp;<span class="ident" id="3923269">prefix</span>&nbsp;<span class="op" id="3923276">[</span><span class="num" id="3923277">8</span><span class="op" id="3923278">]</span><span class="builtintype" id="3923279">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923285">hash</span><span class="op" id="3923289">.</span><span class="ident" id="3923290">Write</span><span class="op" id="3923295">(</span><span class="ident" id="3923296">prefix</span><span class="op" id="3923302">[</span><span class="op" id="3923303">:</span><span class="op" id="3923304">]</span><span class="op" id="3923305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923308">hash</span><span class="op" id="3923312">.</span><span class="ident" id="3923313">Write</span><span class="op" id="3923318">(</span><span class="ident" id="3923319">mHash</span><span class="op" id="3923324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923327">hash</span><span class="op" id="3923331">.</span><span class="ident" id="3923332">Write</span><span class="op" id="3923337">(</span><span class="ident" id="3923338">salt</span><span class="op" id="3923342">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923346">h0</span>&nbsp;<span class="op" id="3923349">:=</span>&nbsp;<span class="ident" id="3923352">hash</span><span class="op" id="3923356">.</span><span class="ident" id="3923357">Sum</span><span class="op" id="3923360">(</span><span class="ident" id="3923361">nil</span><span class="op" id="3923364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923368">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923442">if</span>&nbsp;<span class="op" id="3923445">!</span><span class="ident" id="3923446">bytes</span><span class="op" id="3923451">.</span><span class="ident" id="3923452">Equal</span><span class="op" id="3923457">(</span><span class="ident" id="3923458">h0</span><span class="op" id="3923460">,</span>&nbsp;<span class="ident" id="3923462">h</span><span class="op" id="3923463">)</span>&nbsp;<span class="op" id="3923465">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923469">return</span>&nbsp;<span class="ident" id="3923476">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923496">return</span>&nbsp;<span class="ident" id="3923503">nil</span><br>
<span class="lineno"></span><span class="op" id="3923507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3923510">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="3923599">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3923677">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3923757">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="3923796">func</span>&nbsp;<span class="ident" id="3923801">signPSSWithSalt</span><span class="op" id="3923816">(</span><span class="ident" id="3923817">rand</span>&nbsp;<span class="ident" id="3923822">io</span><span class="op" id="3923824">.</span><span class="ident" id="3923825">Reader</span><span class="op" id="3923831">,</span>&nbsp;<span class="ident" id="3923833">priv</span>&nbsp;<span class="op" id="3923838">*</span><span class="ident" id="3923839">PrivateKey</span><span class="op" id="3923849">,</span>&nbsp;<span class="ident" id="3923851">hash</span>&nbsp;<span class="ident" id="3923856">crypto</span><span class="op" id="3923862">.</span><span class="ident" id="3923863">Hash</span><span class="op" id="3923867">,</span>&nbsp;<span class="ident" id="3923869">hashed</span><span class="op" id="3923875">,</span>&nbsp;<span class="ident" id="3923877">salt</span>&nbsp;<span class="op" id="3923882">[</span><span class="op" id="3923883">]</span><span class="builtintype" id="3923884">byte</span><span class="op" id="3923888">)</span>&nbsp;<span class="op" id="3923890">(</span><span class="ident" id="3923891">s</span>&nbsp;<span class="op" id="3923893">[</span><span class="op" id="3923894">]</span><span class="builtintype" id="3923895">byte</span><span class="op" id="3923899">,</span>&nbsp;<span class="ident" id="3923901">err</span>&nbsp;<span class="builtintype" id="3923905">error</span><span class="op" id="3923910">)</span>&nbsp;<span class="op" id="3923912">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923915">nBits</span>&nbsp;<span class="op" id="3923921">:=</span>&nbsp;<span class="ident" id="3923924">priv</span><span class="op" id="3923928">.</span><span class="ident" id="3923929">N</span><span class="op" id="3923930">.</span><span class="ident" id="3923931">BitLen</span><span class="op" id="3923937">(</span><span class="op" id="3923938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923941">em</span><span class="op" id="3923943">,</span>&nbsp;<span class="ident" id="3923945">err</span>&nbsp;<span class="op" id="3923949">:=</span>&nbsp;<span class="ident" id="3923952">emsaPSSEncode</span><span class="op" id="3923965">(</span><span class="ident" id="3923966">hashed</span><span class="op" id="3923972">,</span>&nbsp;<span class="ident" id="3923974">nBits</span><span class="op" id="3923979">-</span><span class="num" id="3923980">1</span><span class="op" id="3923981">,</span>&nbsp;<span class="ident" id="3923983">salt</span><span class="op" id="3923987">,</span>&nbsp;<span class="ident" id="3923989">hash</span><span class="op" id="3923993">.</span><span class="ident" id="3923994">New</span><span class="op" id="3923997">(</span><span class="op" id="3923998">)</span><span class="op" id="3923999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924002">if</span>&nbsp;<span class="ident" id="3924005">err</span>&nbsp;<span class="op" id="3924009">!=</span>&nbsp;<span class="ident" id="3924012">nil</span>&nbsp;<span class="op" id="3924016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924028">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924031">m</span>&nbsp;<span class="op" id="3924033">:=</span>&nbsp;<span class="builtinfunc" id="3924036">new</span><span class="op" id="3924039">(</span><span class="ident" id="3924040">big</span><span class="op" id="3924043">.</span><span class="ident" id="3924044">Int</span><span class="op" id="3924047">)</span><span class="op" id="3924048">.</span><span class="ident" id="3924049">SetBytes</span><span class="op" id="3924057">(</span><span class="ident" id="3924058">em</span><span class="op" id="3924060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924063">c</span><span class="op" id="3924064">,</span>&nbsp;<span class="ident" id="3924066">err</span>&nbsp;<span class="op" id="3924070">:=</span>&nbsp;<span class="ident" id="3924073">decrypt</span><span class="op" id="3924080">(</span><span class="ident" id="3924081">rand</span><span class="op" id="3924085">,</span>&nbsp;<span class="ident" id="3924087">priv</span><span class="op" id="3924091">,</span>&nbsp;<span class="ident" id="3924093">m</span><span class="op" id="3924094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924097">if</span>&nbsp;<span class="ident" id="3924100">err</span>&nbsp;<span class="op" id="3924104">!=</span>&nbsp;<span class="ident" id="3924107">nil</span>&nbsp;<span class="op" id="3924111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924123">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924126">s</span>&nbsp;<span class="op" id="3924128">=</span>&nbsp;<span class="builtinfunc" id="3924130">make</span><span class="op" id="3924134">(</span><span class="op" id="3924135">[</span><span class="op" id="3924136">]</span><span class="builtintype" id="3924137">byte</span><span class="op" id="3924141">,</span>&nbsp;<span class="op" id="3924143">(</span><span class="ident" id="3924144">nBits</span><span class="op" id="3924149">+</span><span class="num" id="3924150">7</span><span class="op" id="3924151">)</span><span class="op" id="3924152">/</span><span class="num" id="3924153">8</span><span class="op" id="3924154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924157">copyWithLeftPad</span><span class="op" id="3924172">(</span><span class="ident" id="3924173">s</span><span class="op" id="3924174">,</span>&nbsp;<span class="ident" id="3924176">c</span><span class="op" id="3924177">.</span><span class="ident" id="3924178">Bytes</span><span class="op" id="3924183">(</span><span class="op" id="3924184">)</span><span class="op" id="3924185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924188">return</span><br>
<span class="lineno"></span><span class="op" id="3924195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3924198">const</span>&nbsp;<span class="op" id="3924204">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924207">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924279">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924349">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3924367">=</span>&nbsp;<span class="num" id="3924369">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924372">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924443">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924482">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3924506">=</span>&nbsp;<span class="op" id="3924508">-</span><span class="num" id="3924509">1</span><br>
<span class="lineno"></span><span class="op" id="3924511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924514">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="3924588">type</span>&nbsp;<span class="ident" id="3924593">PSSOptions</span>&nbsp;<span class="keyword" id="3924604">struct</span>&nbsp;<span class="op" id="3924611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924614">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924677">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924750">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924779">SaltLength</span>&nbsp;<span class="builtintype" id="3924790">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924796">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924866">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3924935">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924964">Hash</span>&nbsp;<span class="ident" id="3924969">crypto</span><span class="op" id="3924975">.</span><span class="ident" id="3924976">Hash</span><br>
<span class="lineno">230</span><span class="op" id="3924981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924984">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3925047">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="3925069">func</span>&nbsp;<span class="op" id="3925074">(</span><span class="ident" id="3925075">pssOpts</span>&nbsp;<span class="op" id="3925083">*</span><span class="ident" id="3925084">PSSOptions</span><span class="op" id="3925094">)</span>&nbsp;<span class="ident" id="3925096">HashFunc</span><span class="op" id="3925104">(</span><span class="op" id="3925105">)</span>&nbsp;<span class="ident" id="3925107">crypto</span><span class="op" id="3925113">.</span><span class="ident" id="3925114">Hash</span>&nbsp;<span class="op" id="3925119">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925122">return</span>&nbsp;<span class="ident" id="3925129">pssOpts</span><span class="op" id="3925136">.</span><span class="ident" id="3925137">Hash</span><br>
<span class="lineno"></span><span class="op" id="3925142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3925145">func</span>&nbsp;<span class="op" id="3925150">(</span><span class="ident" id="3925151">opts</span>&nbsp;<span class="op" id="3925156">*</span><span class="ident" id="3925157">PSSOptions</span><span class="op" id="3925167">)</span>&nbsp;<span class="ident" id="3925169">saltLength</span><span class="op" id="3925179">(</span><span class="op" id="3925180">)</span>&nbsp;<span class="builtintype" id="3925182">int</span>&nbsp;<span class="op" id="3925186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925189">if</span>&nbsp;<span class="ident" id="3925192">opts</span>&nbsp;<span class="op" id="3925197">==</span>&nbsp;<span class="ident" id="3925200">nil</span>&nbsp;<span class="op" id="3925204">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925208">return</span>&nbsp;<span class="ident" id="3925215">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925237">return</span>&nbsp;<span class="ident" id="3925244">opts</span><span class="op" id="3925248">.</span><span class="ident" id="3925249">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="3925260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3925263">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3925331">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3925409">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3925486">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3925508">func</span>&nbsp;<span class="ident" id="3925513">SignPSS</span><span class="op" id="3925520">(</span><span class="ident" id="3925521">rand</span>&nbsp;<span class="ident" id="3925526">io</span><span class="op" id="3925528">.</span><span class="ident" id="3925529">Reader</span><span class="op" id="3925535">,</span>&nbsp;<span class="ident" id="3925537">priv</span>&nbsp;<span class="op" id="3925542">*</span><span class="ident" id="3925543">PrivateKey</span><span class="op" id="3925553">,</span>&nbsp;<span class="ident" id="3925555">hash</span>&nbsp;<span class="ident" id="3925560">crypto</span><span class="op" id="3925566">.</span><span class="ident" id="3925567">Hash</span><span class="op" id="3925571">,</span>&nbsp;<span class="ident" id="3925573">hashed</span>&nbsp;<span class="op" id="3925580">[</span><span class="op" id="3925581">]</span><span class="builtintype" id="3925582">byte</span><span class="op" id="3925586">,</span>&nbsp;<span class="ident" id="3925588">opts</span>&nbsp;<span class="op" id="3925593">*</span><span class="ident" id="3925594">PSSOptions</span><span class="op" id="3925604">)</span>&nbsp;<span class="op" id="3925606">(</span><span class="ident" id="3925607">s</span>&nbsp;<span class="op" id="3925609">[</span><span class="op" id="3925610">]</span><span class="builtintype" id="3925611">byte</span><span class="op" id="3925615">,</span>&nbsp;<span class="ident" id="3925617">err</span>&nbsp;<span class="builtintype" id="3925621">error</span><span class="op" id="3925626">)</span>&nbsp;<span class="op" id="3925628">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925631">saltLength</span>&nbsp;<span class="op" id="3925642">:=</span>&nbsp;<span class="ident" id="3925645">opts</span><span class="op" id="3925649">.</span><span class="ident" id="3925650">saltLength</span><span class="op" id="3925660">(</span><span class="op" id="3925661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925664">switch</span>&nbsp;<span class="ident" id="3925671">saltLength</span>&nbsp;<span class="op" id="3925682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925685">case</span>&nbsp;<span class="ident" id="3925690">PSSSaltLengthAuto</span><span class="op" id="3925707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925711">saltLength</span>&nbsp;<span class="op" id="3925722">=</span>&nbsp;<span class="op" id="3925724">(</span><span class="ident" id="3925725">priv</span><span class="op" id="3925729">.</span><span class="ident" id="3925730">N</span><span class="op" id="3925731">.</span><span class="ident" id="3925732">BitLen</span><span class="op" id="3925738">(</span><span class="op" id="3925739">)</span><span class="op" id="3925740">+</span><span class="num" id="3925741">7</span><span class="op" id="3925742">)</span><span class="op" id="3925743">/</span><span class="num" id="3925744">8</span>&nbsp;<span class="op" id="3925746">-</span>&nbsp;<span class="num" id="3925748">2</span>&nbsp;<span class="op" id="3925750">-</span>&nbsp;<span class="ident" id="3925752">hash</span><span class="op" id="3925756">.</span><span class="ident" id="3925757">Size</span><span class="op" id="3925761">(</span><span class="op" id="3925762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925765">case</span>&nbsp;<span class="ident" id="3925770">PSSSaltLengthEqualsHash</span><span class="op" id="3925793">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925797">saltLength</span>&nbsp;<span class="op" id="3925808">=</span>&nbsp;<span class="ident" id="3925810">hash</span><span class="op" id="3925814">.</span><span class="ident" id="3925815">Size</span><span class="op" id="3925819">(</span><span class="op" id="3925820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925827">if</span>&nbsp;<span class="ident" id="3925830">opts</span><span class="op" id="3925834">.</span><span class="ident" id="3925835">Hash</span>&nbsp;<span class="op" id="3925840">!=</span>&nbsp;<span class="num" id="3925843">0</span>&nbsp;<span class="op" id="3925845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925849">hash</span>&nbsp;<span class="op" id="3925854">=</span>&nbsp;<span class="ident" id="3925856">opts</span><span class="op" id="3925860">.</span><span class="ident" id="3925861">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925871">salt</span>&nbsp;<span class="op" id="3925876">:=</span>&nbsp;<span class="builtinfunc" id="3925879">make</span><span class="op" id="3925883">(</span><span class="op" id="3925884">[</span><span class="op" id="3925885">]</span><span class="builtintype" id="3925886">byte</span><span class="op" id="3925890">,</span>&nbsp;<span class="ident" id="3925892">saltLength</span><span class="op" id="3925902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925905">if</span>&nbsp;<span class="ident" id="3925908">_</span><span class="op" id="3925909">,</span>&nbsp;<span class="ident" id="3925911">err</span>&nbsp;<span class="op" id="3925915">=</span>&nbsp;<span class="ident" id="3925917">io</span><span class="op" id="3925919">.</span><span class="ident" id="3925920">ReadFull</span><span class="op" id="3925928">(</span><span class="ident" id="3925929">rand</span><span class="op" id="3925933">,</span>&nbsp;<span class="ident" id="3925935">salt</span><span class="op" id="3925939">)</span><span class="op" id="3925940">;</span>&nbsp;<span class="ident" id="3925942">err</span>&nbsp;<span class="op" id="3925946">!=</span>&nbsp;<span class="ident" id="3925949">nil</span>&nbsp;<span class="op" id="3925953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925957">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925968">return</span>&nbsp;<span class="ident" id="3925975">signPSSWithSalt</span><span class="op" id="3925990">(</span><span class="ident" id="3925991">rand</span><span class="op" id="3925995">,</span>&nbsp;<span class="ident" id="3925997">priv</span><span class="op" id="3926001">,</span>&nbsp;<span class="ident" id="3926003">hash</span><span class="op" id="3926007">,</span>&nbsp;<span class="ident" id="3926009">hashed</span><span class="op" id="3926015">,</span>&nbsp;<span class="ident" id="3926017">salt</span><span class="op" id="3926021">)</span><br>
<span class="lineno"></span><span class="op" id="3926023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3926026">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="3926065">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3926139">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3926211">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3926290">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3926312">func</span>&nbsp;<span class="ident" id="3926317">VerifyPSS</span><span class="op" id="3926326">(</span><span class="ident" id="3926327">pub</span>&nbsp;<span class="op" id="3926331">*</span><span class="ident" id="3926332">PublicKey</span><span class="op" id="3926341">,</span>&nbsp;<span class="ident" id="3926343">hash</span>&nbsp;<span class="ident" id="3926348">crypto</span><span class="op" id="3926354">.</span><span class="ident" id="3926355">Hash</span><span class="op" id="3926359">,</span>&nbsp;<span class="ident" id="3926361">hashed</span>&nbsp;<span class="op" id="3926368">[</span><span class="op" id="3926369">]</span><span class="builtintype" id="3926370">byte</span><span class="op" id="3926374">,</span>&nbsp;<span class="ident" id="3926376">sig</span>&nbsp;<span class="op" id="3926380">[</span><span class="op" id="3926381">]</span><span class="builtintype" id="3926382">byte</span><span class="op" id="3926386">,</span>&nbsp;<span class="ident" id="3926388">opts</span>&nbsp;<span class="op" id="3926393">*</span><span class="ident" id="3926394">PSSOptions</span><span class="op" id="3926404">)</span>&nbsp;<span class="builtintype" id="3926406">error</span>&nbsp;<span class="op" id="3926412">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926415">return</span>&nbsp;<span class="ident" id="3926422">verifyPSS</span><span class="op" id="3926431">(</span><span class="ident" id="3926432">pub</span><span class="op" id="3926435">,</span>&nbsp;<span class="ident" id="3926437">hash</span><span class="op" id="3926441">,</span>&nbsp;<span class="ident" id="3926443">hashed</span><span class="op" id="3926449">,</span>&nbsp;<span class="ident" id="3926451">sig</span><span class="op" id="3926454">,</span>&nbsp;<span class="ident" id="3926456">opts</span><span class="op" id="3926460">.</span><span class="ident" id="3926461">saltLength</span><span class="op" id="3926471">(</span><span class="op" id="3926472">)</span><span class="op" id="3926473">)</span><br>
<span class="lineno"></span><span class="op" id="3926475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3926478">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3926544">func</span>&nbsp;<span class="ident" id="3926549">verifyPSS</span><span class="op" id="3926558">(</span><span class="ident" id="3926559">pub</span>&nbsp;<span class="op" id="3926563">*</span><span class="ident" id="3926564">PublicKey</span><span class="op" id="3926573">,</span>&nbsp;<span class="ident" id="3926575">hash</span>&nbsp;<span class="ident" id="3926580">crypto</span><span class="op" id="3926586">.</span><span class="ident" id="3926587">Hash</span><span class="op" id="3926591">,</span>&nbsp;<span class="ident" id="3926593">hashed</span>&nbsp;<span class="op" id="3926600">[</span><span class="op" id="3926601">]</span><span class="builtintype" id="3926602">byte</span><span class="op" id="3926606">,</span>&nbsp;<span class="ident" id="3926608">sig</span>&nbsp;<span class="op" id="3926612">[</span><span class="op" id="3926613">]</span><span class="builtintype" id="3926614">byte</span><span class="op" id="3926618">,</span>&nbsp;<span class="ident" id="3926620">saltLen</span>&nbsp;<span class="builtintype" id="3926628">int</span><span class="op" id="3926631">)</span>&nbsp;<span class="builtintype" id="3926633">error</span>&nbsp;<span class="op" id="3926639">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926642">nBits</span>&nbsp;<span class="op" id="3926648">:=</span>&nbsp;<span class="ident" id="3926651">pub</span><span class="op" id="3926654">.</span><span class="ident" id="3926655">N</span><span class="op" id="3926656">.</span><span class="ident" id="3926657">BitLen</span><span class="op" id="3926663">(</span><span class="op" id="3926664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926667">if</span>&nbsp;<span class="builtinfunc" id="3926670">len</span><span class="op" id="3926673">(</span><span class="ident" id="3926674">sig</span><span class="op" id="3926677">)</span>&nbsp;<span class="op" id="3926679">!=</span>&nbsp;<span class="op" id="3926682">(</span><span class="ident" id="3926683">nBits</span><span class="op" id="3926688">+</span><span class="num" id="3926689">7</span><span class="op" id="3926690">)</span><span class="op" id="3926691">/</span><span class="num" id="3926692">8</span>&nbsp;<span class="op" id="3926694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926698">return</span>&nbsp;<span class="ident" id="3926705">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926725">s</span>&nbsp;<span class="op" id="3926727">:=</span>&nbsp;<span class="builtinfunc" id="3926730">new</span><span class="op" id="3926733">(</span><span class="ident" id="3926734">big</span><span class="op" id="3926737">.</span><span class="ident" id="3926738">Int</span><span class="op" id="3926741">)</span><span class="op" id="3926742">.</span><span class="ident" id="3926743">SetBytes</span><span class="op" id="3926751">(</span><span class="ident" id="3926752">sig</span><span class="op" id="3926755">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926758">m</span>&nbsp;<span class="op" id="3926760">:=</span>&nbsp;<span class="ident" id="3926763">encrypt</span><span class="op" id="3926770">(</span><span class="builtinfunc" id="3926771">new</span><span class="op" id="3926774">(</span><span class="ident" id="3926775">big</span><span class="op" id="3926778">.</span><span class="ident" id="3926779">Int</span><span class="op" id="3926782">)</span><span class="op" id="3926783">,</span>&nbsp;<span class="ident" id="3926785">pub</span><span class="op" id="3926788">,</span>&nbsp;<span class="ident" id="3926790">s</span><span class="op" id="3926791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926794">emBits</span>&nbsp;<span class="op" id="3926801">:=</span>&nbsp;<span class="ident" id="3926804">nBits</span>&nbsp;<span class="op" id="3926810">-</span>&nbsp;<span class="num" id="3926812">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926815">emLen</span>&nbsp;<span class="op" id="3926821">:=</span>&nbsp;<span class="op" id="3926824">(</span><span class="ident" id="3926825">emBits</span>&nbsp;<span class="op" id="3926832">+</span>&nbsp;<span class="num" id="3926834">7</span><span class="op" id="3926835">)</span>&nbsp;<span class="op" id="3926837">/</span>&nbsp;<span class="num" id="3926839">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926842">if</span>&nbsp;<span class="ident" id="3926845">emLen</span>&nbsp;<span class="op" id="3926851">&lt;</span>&nbsp;<span class="builtinfunc" id="3926853">len</span><span class="op" id="3926856">(</span><span class="ident" id="3926857">m</span><span class="op" id="3926858">.</span><span class="ident" id="3926859">Bytes</span><span class="op" id="3926864">(</span><span class="op" id="3926865">)</span><span class="op" id="3926866">)</span>&nbsp;<span class="op" id="3926868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926872">return</span>&nbsp;<span class="ident" id="3926879">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926899">em</span>&nbsp;<span class="op" id="3926902">:=</span>&nbsp;<span class="builtinfunc" id="3926905">make</span><span class="op" id="3926909">(</span><span class="op" id="3926910">[</span><span class="op" id="3926911">]</span><span class="builtintype" id="3926912">byte</span><span class="op" id="3926916">,</span>&nbsp;<span class="ident" id="3926918">emLen</span><span class="op" id="3926923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926926">copyWithLeftPad</span><span class="op" id="3926941">(</span><span class="ident" id="3926942">em</span><span class="op" id="3926944">,</span>&nbsp;<span class="ident" id="3926946">m</span><span class="op" id="3926947">.</span><span class="ident" id="3926948">Bytes</span><span class="op" id="3926953">(</span><span class="op" id="3926954">)</span><span class="op" id="3926955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926958">if</span>&nbsp;<span class="ident" id="3926961">saltLen</span>&nbsp;<span class="op" id="3926969">==</span>&nbsp;<span class="ident" id="3926972">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3926996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927000">saltLen</span>&nbsp;<span class="op" id="3927008">=</span>&nbsp;<span class="ident" id="3927010">hash</span><span class="op" id="3927014">.</span><span class="ident" id="3927015">Size</span><span class="op" id="3927019">(</span><span class="op" id="3927020">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927026">return</span>&nbsp;<span class="ident" id="3927033">emsaPSSVerify</span><span class="op" id="3927046">(</span><span class="ident" id="3927047">hashed</span><span class="op" id="3927053">,</span>&nbsp;<span class="ident" id="3927055">em</span><span class="op" id="3927057">,</span>&nbsp;<span class="ident" id="3927059">emBits</span><span class="op" id="3927065">,</span>&nbsp;<span class="ident" id="3927067">saltLen</span><span class="op" id="3927074">,</span>&nbsp;<span class="ident" id="3927076">hash</span><span class="op" id="3927080">.</span><span class="ident" id="3927081">New</span><span class="op" id="3927084">(</span><span class="op" id="3927085">)</span><span class="op" id="3927086">)</span><br>
<span class="lineno"></span><span class="op" id="3927088">}</span>
</div>
</body>
</html>
