<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3333560">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3333615">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3333669">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3333720">package</span>&nbsp;<span class="ident" id="3333728">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3333733">import</span>&nbsp;<span class="op" id="3333740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333743">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333761">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333771">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333786">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333801">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333808">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333814">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333826">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333837">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333845">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3333852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3333855">const</span>&nbsp;<span class="op" id="3333861">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333864">VersionSSL30</span>&nbsp;<span class="op" id="3333877">=</span>&nbsp;<span class="num" id="3333879">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333887">VersionTLS10</span>&nbsp;<span class="op" id="3333900">=</span>&nbsp;<span class="num" id="3333902">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333910">VersionTLS11</span>&nbsp;<span class="op" id="3333923">=</span>&nbsp;<span class="num" id="3333925">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333933">VersionTLS12</span>&nbsp;<span class="op" id="3333946">=</span>&nbsp;<span class="num" id="3333948">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3333955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3333958">const</span>&nbsp;<span class="op" id="3333964">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333967">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3333983">=</span>&nbsp;<span class="num" id="3333985">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3333998">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334035">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3334051">=</span>&nbsp;<span class="num" id="3334053">16384</span>&nbsp;<span class="op" id="3334059">+</span>&nbsp;<span class="num" id="3334061">2048</span>&nbsp;<span class="comment" id="3334066">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334104">recordHeaderLen</span>&nbsp;<span class="op" id="3334120">=</span>&nbsp;<span class="num" id="3334122">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3334135">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334160">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3334176">=</span>&nbsp;<span class="num" id="3334178">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3334191">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334249">minVersion</span>&nbsp;<span class="op" id="3334260">=</span>&nbsp;<span class="ident" id="3334262">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334276">maxVersion</span>&nbsp;<span class="op" id="3334287">=</span>&nbsp;<span class="ident" id="3334289">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3334302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3334305">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3334326">type</span>&nbsp;<span class="ident" id="3334331">recordType</span>&nbsp;<span class="builtintype" id="3334342">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3334349">const</span>&nbsp;<span class="op" id="3334355">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334358">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3334385">recordType</span>&nbsp;<span class="op" id="3334396">=</span>&nbsp;<span class="num" id="3334398">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334402">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334429">recordType</span>&nbsp;<span class="op" id="3334440">=</span>&nbsp;<span class="num" id="3334442">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334446">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334473">recordType</span>&nbsp;<span class="op" id="3334484">=</span>&nbsp;<span class="num" id="3334486">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334490">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3334517">recordType</span>&nbsp;<span class="op" id="3334528">=</span>&nbsp;<span class="num" id="3334530">23</span><br>
<span class="lineno">45</span><span class="op" id="3334533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3334536">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3334568">const</span>&nbsp;<span class="op" id="3334574">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334577">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334600">uint8</span>&nbsp;<span class="op" id="3334606">=</span>&nbsp;<span class="num" id="3334608">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334611">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334634">uint8</span>&nbsp;<span class="op" id="3334640">=</span>&nbsp;<span class="num" id="3334642">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334645">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334668">uint8</span>&nbsp;<span class="op" id="3334674">=</span>&nbsp;<span class="num" id="3334676">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334679">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334702">uint8</span>&nbsp;<span class="op" id="3334708">=</span>&nbsp;<span class="num" id="3334710">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334714">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3334737">uint8</span>&nbsp;<span class="op" id="3334743">=</span>&nbsp;<span class="num" id="3334745">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334749">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3334772">uint8</span>&nbsp;<span class="op" id="3334778">=</span>&nbsp;<span class="num" id="3334780">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334784">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334807">uint8</span>&nbsp;<span class="op" id="3334813">=</span>&nbsp;<span class="num" id="3334815">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334819">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3334842">uint8</span>&nbsp;<span class="op" id="3334848">=</span>&nbsp;<span class="num" id="3334850">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334854">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3334877">uint8</span>&nbsp;<span class="op" id="3334883">=</span>&nbsp;<span class="num" id="3334885">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334889">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334912">uint8</span>&nbsp;<span class="op" id="3334918">=</span>&nbsp;<span class="num" id="3334920">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334924">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3334947">uint8</span>&nbsp;<span class="op" id="3334953">=</span>&nbsp;<span class="num" id="3334955">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334959">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3334982">uint8</span>&nbsp;<span class="op" id="3334988">=</span>&nbsp;<span class="num" id="3334990">67</span>&nbsp;<span class="comment" id="3334993">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3335014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3335017">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3335043">const</span>&nbsp;<span class="op" id="3335049">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335052">compressionNone</span>&nbsp;<span class="builtintype" id="3335068">uint8</span>&nbsp;<span class="op" id="3335074">=</span>&nbsp;<span class="num" id="3335076">0</span><br>
<span class="lineno"></span><span class="op" id="3335078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3335081">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3335106">const</span>&nbsp;<span class="op" id="3335112">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335115">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335144">uint16</span>&nbsp;<span class="op" id="3335151">=</span>&nbsp;<span class="num" id="3335153">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335156">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335185">uint16</span>&nbsp;<span class="op" id="3335192">=</span>&nbsp;<span class="num" id="3335194">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335197">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335226">uint16</span>&nbsp;<span class="op" id="3335233">=</span>&nbsp;<span class="num" id="3335235">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335239">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335268">uint16</span>&nbsp;<span class="op" id="3335275">=</span>&nbsp;<span class="num" id="3335277">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335281">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3335310">uint16</span>&nbsp;<span class="op" id="3335317">=</span>&nbsp;<span class="num" id="3335319">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335323">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335352">uint16</span>&nbsp;<span class="op" id="3335359">=</span>&nbsp;<span class="num" id="3335361">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335365">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335394">uint16</span>&nbsp;<span class="op" id="3335401">=</span>&nbsp;<span class="num" id="3335403">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335407">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335436">uint16</span>&nbsp;<span class="op" id="3335443">=</span>&nbsp;<span class="num" id="3335445">13172</span>&nbsp;<span class="comment" id="3335451">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335473">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3335502">uint16</span>&nbsp;<span class="op" id="3335509">=</span>&nbsp;<span class="num" id="3335511">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3335518">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3335521">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3335558">const</span>&nbsp;<span class="op" id="3335564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335567">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3335585">uint16</span>&nbsp;<span class="op" id="3335592">=</span>&nbsp;<span class="num" id="3335594">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3335601">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3335604">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3335674">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3335760">type</span>&nbsp;<span class="ident" id="3335765">CurveID</span>&nbsp;<span class="builtintype" id="3335773">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3335781">const</span>&nbsp;<span class="op" id="3335787">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335790">CurveP256</span>&nbsp;<span class="ident" id="3335800">CurveID</span>&nbsp;<span class="op" id="3335808">=</span>&nbsp;<span class="num" id="3335810">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335814">CurveP384</span>&nbsp;<span class="ident" id="3335824">CurveID</span>&nbsp;<span class="op" id="3335832">=</span>&nbsp;<span class="num" id="3335834">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335838">CurveP521</span>&nbsp;<span class="ident" id="3335848">CurveID</span>&nbsp;<span class="op" id="3335856">=</span>&nbsp;<span class="num" id="3335858">25</span><br>
<span class="lineno"></span><span class="op" id="3335861">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3335864">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3335900">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3335986">const</span>&nbsp;<span class="op" id="3335992">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335995">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3336019">uint8</span>&nbsp;<span class="op" id="3336025">=</span>&nbsp;<span class="num" id="3336027">0</span><br>
<span class="lineno">100</span><span class="op" id="3336029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336032">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3336072">const</span>&nbsp;<span class="op" id="3336078">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336081">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3336096">uint8</span>&nbsp;<span class="op" id="3336102">=</span>&nbsp;<span class="num" id="3336104">1</span><br>
<span class="lineno">105</span><span class="op" id="3336106">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336109">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3336158">const</span>&nbsp;<span class="op" id="3336164">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336167">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336186">=</span>&nbsp;<span class="num" id="3336188">1</span>&nbsp;<span class="comment" id="3336190">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336230">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336249">=</span>&nbsp;<span class="num" id="3336251">2</span>&nbsp;<span class="comment" id="3336253">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336292">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3336311">=</span>&nbsp;<span class="num" id="3336313">3</span>&nbsp;<span class="comment" id="3336315">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336360">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3336379">=</span>&nbsp;<span class="num" id="3336381">4</span>&nbsp;<span class="comment" id="3336383">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336429">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336465">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336488">=</span>&nbsp;<span class="num" id="3336490">64</span>&nbsp;<span class="comment" id="3336493">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336570">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3336593">=</span>&nbsp;<span class="num" id="3336595">65</span>&nbsp;<span class="comment" id="3336598">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336672">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3336695">=</span>&nbsp;<span class="num" id="3336697">66</span>&nbsp;<span class="comment" id="3336700">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336777">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3336823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336826">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3336886">const</span>&nbsp;<span class="op" id="3336892">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336895">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3336906">uint8</span>&nbsp;<span class="op" id="3336912">=</span>&nbsp;<span class="num" id="3336914">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336917">hashSHA256</span>&nbsp;<span class="builtintype" id="3336928">uint8</span>&nbsp;<span class="op" id="3336934">=</span>&nbsp;<span class="num" id="3336936">4</span><br>
<span class="lineno"></span><span class="op" id="3336938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336941">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3337007">const</span>&nbsp;<span class="op" id="3337013">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337016">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3337031">uint8</span>&nbsp;<span class="op" id="3337037">=</span>&nbsp;<span class="num" id="3337039">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337042">signatureECDSA</span>&nbsp;<span class="builtintype" id="3337057">uint8</span>&nbsp;<span class="op" id="3337063">=</span>&nbsp;<span class="num" id="3337065">3</span><br>
<span class="lineno"></span><span class="op" id="3337067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337070">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3337149">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3337177">type</span>&nbsp;<span class="ident" id="3337182">signatureAndHash</span>&nbsp;<span class="keyword" id="3337199">struct</span>&nbsp;<span class="op" id="3337206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337209">hash</span><span class="op" id="3337213">,</span>&nbsp;<span class="ident" id="3337215">signature</span>&nbsp;<span class="builtintype" id="3337225">uint8</span><br>
<span class="lineno"></span><span class="op" id="3337231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3337234">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3337312">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3337379">var</span>&nbsp;<span class="ident" id="3337383">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3337415">=</span>&nbsp;<span class="op" id="3337417">[</span><span class="op" id="3337418">]</span><span class="ident" id="3337419">signatureAndHash</span><span class="op" id="3337435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337438">{</span><span class="ident" id="3337439">hashSHA256</span><span class="op" id="3337449">,</span>&nbsp;<span class="ident" id="3337451">signatureRSA</span><span class="op" id="3337463">}</span><span class="op" id="3337464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337467">{</span><span class="ident" id="3337468">hashSHA256</span><span class="op" id="3337478">,</span>&nbsp;<span class="ident" id="3337480">signatureECDSA</span><span class="op" id="3337494">}</span><span class="op" id="3337495">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337498">{</span><span class="ident" id="3337499">hashSHA1</span><span class="op" id="3337507">,</span>&nbsp;<span class="ident" id="3337509">signatureRSA</span><span class="op" id="3337521">}</span><span class="op" id="3337522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337525">{</span><span class="ident" id="3337526">hashSHA1</span><span class="op" id="3337534">,</span>&nbsp;<span class="ident" id="3337536">signatureECDSA</span><span class="op" id="3337550">}</span><span class="op" id="3337551">,</span><br>
<span class="lineno"></span><span class="op" id="3337553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337556">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3337630">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3337695">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3337718">var</span>&nbsp;<span class="ident" id="3337722">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3337761">=</span>&nbsp;<span class="op" id="3337763">[</span><span class="op" id="3337764">]</span><span class="ident" id="3337765">signatureAndHash</span><span class="op" id="3337781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337784">{</span><span class="ident" id="3337785">hashSHA256</span><span class="op" id="3337795">,</span>&nbsp;<span class="ident" id="3337797">signatureRSA</span><span class="op" id="3337809">}</span><span class="op" id="3337810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337813">{</span><span class="ident" id="3337814">hashSHA256</span><span class="op" id="3337824">,</span>&nbsp;<span class="ident" id="3337826">signatureECDSA</span><span class="op" id="3337840">}</span><span class="op" id="3337841">,</span><br>
<span class="lineno">155</span><span class="op" id="3337843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337846">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3337913">type</span>&nbsp;<span class="ident" id="3337918">ConnectionState</span>&nbsp;<span class="keyword" id="3337934">struct</span>&nbsp;<span class="op" id="3337941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337944">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3337971">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337993">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338052">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338079">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338101">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338131">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338158">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338180">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338229">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338256">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338278">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338334">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338361">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338383">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338437">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3338464">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338486">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338535">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338562">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338584">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338647">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338674">[</span><span class="op" id="3338675">]</span><span class="op" id="3338676">*</span><span class="ident" id="3338677">x509</span><span class="op" id="3338681">.</span><span class="ident" id="3338682">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3338696">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338743">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338770">[</span><span class="op" id="3338771">]</span><span class="op" id="3338772">[</span><span class="op" id="3338773">]</span><span class="op" id="3338774">*</span><span class="ident" id="3338775">x509</span><span class="op" id="3338779">.</span><span class="ident" id="3338780">Certificate</span>&nbsp;<span class="comment" id="3338792">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338841">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338912">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338978">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339038">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339111">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339177">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339211">TLSUnique</span>&nbsp;<span class="op" id="3339221">[</span><span class="op" id="3339222">]</span><span class="builtintype" id="3339223">byte</span><br>
<span class="lineno"></span><span class="op" id="3339228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339231">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3339296">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3339326">type</span>&nbsp;<span class="ident" id="3339331">ClientAuthType</span>&nbsp;<span class="builtintype" id="3339346">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339351">const</span>&nbsp;<span class="op" id="3339357">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339360">NoClientCert</span>&nbsp;<span class="ident" id="3339373">ClientAuthType</span>&nbsp;<span class="op" id="3339388">=</span>&nbsp;<span class="ident" id="3339390">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339396">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339415">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339437">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339462">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3339489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3339492">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3339565">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3339578">type</span>&nbsp;<span class="ident" id="3339583">ClientSessionState</span>&nbsp;<span class="keyword" id="3339602">struct</span>&nbsp;<span class="op" id="3339609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339612">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339631">[</span><span class="op" id="3339632">]</span><span class="builtintype" id="3339633">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339651">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339712">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3339731">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339751">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339798">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3339817">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339837">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339880">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339899">[</span><span class="op" id="3339900">]</span><span class="builtintype" id="3339901">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339919">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339976">serverCertificates</span>&nbsp;<span class="op" id="3339995">[</span><span class="op" id="3339996">]</span><span class="op" id="3339997">*</span><span class="ident" id="3339998">x509</span><span class="op" id="3340002">.</span><span class="ident" id="3340003">Certificate</span>&nbsp;<span class="comment" id="3340015">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3340060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3340063">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3340143">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3340222">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3340296">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3340311">type</span>&nbsp;<span class="ident" id="3340316">ClientSessionCache</span>&nbsp;<span class="keyword" id="3340335">interface</span>&nbsp;<span class="op" id="3340345">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340348">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340421">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340465">Get</span><span class="op" id="3340468">(</span><span class="ident" id="3340469">sessionKey</span>&nbsp;<span class="builtintype" id="3340480">string</span><span class="op" id="3340486">)</span>&nbsp;<span class="op" id="3340488">(</span><span class="ident" id="3340489">session</span>&nbsp;<span class="op" id="3340497">*</span><span class="ident" id="3340498">ClientSessionState</span><span class="op" id="3340516">,</span>&nbsp;<span class="ident" id="3340518">ok</span>&nbsp;<span class="builtintype" id="3340521">bool</span><span class="op" id="3340525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340529">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340598">Put</span><span class="op" id="3340601">(</span><span class="ident" id="3340602">sessionKey</span>&nbsp;<span class="builtintype" id="3340613">string</span><span class="op" id="3340619">,</span>&nbsp;<span class="ident" id="3340621">cs</span>&nbsp;<span class="op" id="3340624">*</span><span class="ident" id="3340625">ClientSessionState</span><span class="op" id="3340643">)</span><br>
<span class="lineno"></span><span class="op" id="3340645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3340648">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3340727">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3340790">type</span>&nbsp;<span class="ident" id="3340795">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3340811">struct</span>&nbsp;<span class="op" id="3340818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340821">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340891">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340922">CipherSuites</span>&nbsp;<span class="op" id="3340935">[</span><span class="op" id="3340936">]</span><span class="builtintype" id="3340937">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340946">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341018">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341089">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341118">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341171">ServerName</span>&nbsp;<span class="builtintype" id="3341182">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341191">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341262">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341327">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341360">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341415">SupportedCurves</span>&nbsp;<span class="op" id="3341431">[</span><span class="op" id="3341432">]</span><span class="ident" id="3341433">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341443">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341512">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341585">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341608">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341663">SupportedPoints</span>&nbsp;<span class="op" id="3341679">[</span><span class="op" id="3341680">]</span><span class="builtintype" id="3341681">uint8</span><br>
<span class="lineno"></span><span class="op" id="3341687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3341690">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3341757">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3341819">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3341886">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3341900">type</span>&nbsp;<span class="ident" id="3341905">Config</span>&nbsp;<span class="keyword" id="3341912">struct</span>&nbsp;<span class="op" id="3341919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341922">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3341991">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342063">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342080">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342140">Rand</span>&nbsp;<span class="ident" id="3342145">io</span><span class="op" id="3342147">.</span><span class="ident" id="3342148">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342157">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342233">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342272">Time</span>&nbsp;<span class="keyword" id="3342277">func</span><span class="op" id="3342281">(</span><span class="op" id="3342282">)</span>&nbsp;<span class="ident" id="3342284">time</span><span class="op" id="3342288">.</span><span class="ident" id="3342289">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342296">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342353">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342405">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342470">Certificates</span>&nbsp;<span class="op" id="3342483">[</span><span class="op" id="3342484">]</span><span class="ident" id="3342485">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342499">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342567">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342633">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342702">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342740">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342810">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3342835">NameToCertificate</span>&nbsp;<span class="keyword" id="3342853">map</span><span class="op" id="3342856">[</span><span class="builtintype" id="3342857">string</span><span class="op" id="3342863">]</span><span class="op" id="3342864">*</span><span class="ident" id="3342865">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342879">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3342939">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343010">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343066">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343138">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343148">GetCertificate</span>&nbsp;<span class="keyword" id="3343163">func</span><span class="op" id="3343167">(</span><span class="ident" id="3343168">clientHello</span>&nbsp;<span class="op" id="3343180">*</span><span class="ident" id="3343181">ClientHelloInfo</span><span class="op" id="3343196">)</span>&nbsp;<span class="op" id="3343198">(</span><span class="op" id="3343199">*</span><span class="ident" id="3343200">Certificate</span><span class="op" id="3343211">,</span>&nbsp;<span class="builtintype" id="3343213">error</span><span class="op" id="3343218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343222">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343282">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343339">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343395">RootCAs</span>&nbsp;<span class="op" id="3343403">*</span><span class="ident" id="3343404">x509</span><span class="op" id="3343408">.</span><span class="ident" id="3343409">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343420">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343488">NextProtos</span>&nbsp;<span class="op" id="3343499">[</span><span class="op" id="3343500">]</span><span class="builtintype" id="3343501">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343510">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343572">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343645">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343703">ServerName</span>&nbsp;<span class="builtintype" id="3343714">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343723">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343773">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3343833">ClientAuth</span>&nbsp;<span class="ident" id="3343844">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343861">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343923">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3343987">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344020">ClientCAs</span>&nbsp;<span class="op" id="3344030">*</span><span class="ident" id="3344031">x509</span><span class="op" id="3344035">.</span><span class="ident" id="3344036">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344047">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344109">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344155">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344218">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344285">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344352">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344394">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3344413">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344420">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344491">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344562">CipherSuites</span>&nbsp;<span class="op" id="3344575">[</span><span class="op" id="3344576">]</span><span class="builtintype" id="3344577">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344586">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344655">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344727">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344798">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344850">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3344875">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344882">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3344954">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3344980">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3345003">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345010">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345073">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345135">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345186">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345190">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345260">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345319">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345382">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345430">SessionTicketKey</span>&nbsp;<span class="op" id="3345447">[</span><span class="num" id="3345448">32</span><span class="op" id="3345450">]</span><span class="builtintype" id="3345451">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345458">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345532">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345548">ClientSessionCache</span>&nbsp;<span class="ident" id="3345567">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345588">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345660">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345709">MinVersion</span>&nbsp;<span class="builtintype" id="3345720">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345729">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345801">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345874">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345906">MaxVersion</span>&nbsp;<span class="builtintype" id="3345917">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345926">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345997">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346069">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346082">CurvePreferences</span>&nbsp;<span class="op" id="3346099">[</span><span class="op" id="3346100">]</span><span class="ident" id="3346101">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346111">serverInitOnce</span>&nbsp;<span class="ident" id="3346126">sync</span><span class="op" id="3346130">.</span><span class="ident" id="3346131">Once</span>&nbsp;<span class="comment" id="3346136">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3346175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3346178">func</span>&nbsp;<span class="op" id="3346183">(</span><span class="ident" id="3346184">c</span>&nbsp;<span class="op" id="3346186">*</span><span class="ident" id="3346187">Config</span><span class="op" id="3346193">)</span>&nbsp;<span class="ident" id="3346195">serverInit</span><span class="op" id="3346205">(</span><span class="op" id="3346206">)</span>&nbsp;<span class="op" id="3346208">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346211">if</span>&nbsp;<span class="ident" id="3346214">c</span><span class="op" id="3346215">.</span><span class="ident" id="3346216">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3346239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346255">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346319">for</span>&nbsp;<span class="ident" id="3346323">_</span><span class="op" id="3346324">,</span>&nbsp;<span class="ident" id="3346326">b</span>&nbsp;<span class="op" id="3346328">:=</span>&nbsp;<span class="keyword" id="3346331">range</span>&nbsp;<span class="ident" id="3346337">c</span><span class="op" id="3346338">.</span><span class="ident" id="3346339">SessionTicketKey</span>&nbsp;<span class="op" id="3346356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346360">if</span>&nbsp;<span class="ident" id="3346363">b</span>&nbsp;<span class="op" id="3346365">!=</span>&nbsp;<span class="num" id="3346368">0</span>&nbsp;<span class="op" id="3346370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346375">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346387">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346391">if</span>&nbsp;<span class="ident" id="3346394">_</span><span class="op" id="3346395">,</span>&nbsp;<span class="ident" id="3346397">err</span>&nbsp;<span class="op" id="3346401">:=</span>&nbsp;<span class="ident" id="3346404">io</span><span class="op" id="3346406">.</span><span class="ident" id="3346407">ReadFull</span><span class="op" id="3346415">(</span><span class="ident" id="3346416">c</span><span class="op" id="3346417">.</span><span class="ident" id="3346418">rand</span><span class="op" id="3346422">(</span><span class="op" id="3346423">)</span><span class="op" id="3346424">,</span>&nbsp;<span class="ident" id="3346426">c</span><span class="op" id="3346427">.</span><span class="ident" id="3346428">SessionTicketKey</span><span class="op" id="3346444">[</span><span class="op" id="3346445">:</span><span class="op" id="3346446">]</span><span class="op" id="3346447">)</span><span class="op" id="3346448">;</span>&nbsp;<span class="ident" id="3346450">err</span>&nbsp;<span class="op" id="3346454">!=</span>&nbsp;<span class="ident" id="3346457">nil</span>&nbsp;<span class="op" id="3346461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346465">c</span><span class="op" id="3346466">.</span><span class="ident" id="3346467">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3346490">=</span>&nbsp;<span class="builtintype" id="3346492">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346498">}</span><br>
<span class="lineno"></span><span class="op" id="3346500">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3346503">func</span>&nbsp;<span class="op" id="3346508">(</span><span class="ident" id="3346509">c</span>&nbsp;<span class="op" id="3346511">*</span><span class="ident" id="3346512">Config</span><span class="op" id="3346518">)</span>&nbsp;<span class="ident" id="3346520">rand</span><span class="op" id="3346524">(</span><span class="op" id="3346525">)</span>&nbsp;<span class="ident" id="3346527">io</span><span class="op" id="3346529">.</span><span class="ident" id="3346530">Reader</span>&nbsp;<span class="op" id="3346537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346540">r</span>&nbsp;<span class="op" id="3346542">:=</span>&nbsp;<span class="ident" id="3346545">c</span><span class="op" id="3346546">.</span><span class="ident" id="3346547">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346553">if</span>&nbsp;<span class="ident" id="3346556">r</span>&nbsp;<span class="op" id="3346558">==</span>&nbsp;<span class="ident" id="3346561">nil</span>&nbsp;<span class="op" id="3346565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346569">return</span>&nbsp;<span class="ident" id="3346576">rand</span><span class="op" id="3346580">.</span><span class="ident" id="3346581">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346592">return</span>&nbsp;<span class="ident" id="3346599">r</span><br>
<span class="lineno"></span><span class="op" id="3346601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3346604">func</span>&nbsp;<span class="op" id="3346609">(</span><span class="ident" id="3346610">c</span>&nbsp;<span class="op" id="3346612">*</span><span class="ident" id="3346613">Config</span><span class="op" id="3346619">)</span>&nbsp;<span class="ident" id="3346621">time</span><span class="op" id="3346625">(</span><span class="op" id="3346626">)</span>&nbsp;<span class="ident" id="3346628">time</span><span class="op" id="3346632">.</span><span class="ident" id="3346633">Time</span>&nbsp;<span class="op" id="3346638">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346641">t</span>&nbsp;<span class="op" id="3346643">:=</span>&nbsp;<span class="ident" id="3346646">c</span><span class="op" id="3346647">.</span><span class="ident" id="3346648">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346654">if</span>&nbsp;<span class="ident" id="3346657">t</span>&nbsp;<span class="op" id="3346659">==</span>&nbsp;<span class="ident" id="3346662">nil</span>&nbsp;<span class="op" id="3346666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346670">t</span>&nbsp;<span class="op" id="3346672">=</span>&nbsp;<span class="ident" id="3346674">time</span><span class="op" id="3346678">.</span><span class="ident" id="3346679">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346687">return</span>&nbsp;<span class="ident" id="3346694">t</span><span class="op" id="3346695">(</span><span class="op" id="3346696">)</span><br>
<span class="lineno">380</span><span class="op" id="3346698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3346701">func</span>&nbsp;<span class="op" id="3346706">(</span><span class="ident" id="3346707">c</span>&nbsp;<span class="op" id="3346709">*</span><span class="ident" id="3346710">Config</span><span class="op" id="3346716">)</span>&nbsp;<span class="ident" id="3346718">cipherSuites</span><span class="op" id="3346730">(</span><span class="op" id="3346731">)</span>&nbsp;<span class="op" id="3346733">[</span><span class="op" id="3346734">]</span><span class="builtintype" id="3346735">uint16</span>&nbsp;<span class="op" id="3346742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346745">s</span>&nbsp;<span class="op" id="3346747">:=</span>&nbsp;<span class="ident" id="3346750">c</span><span class="op" id="3346751">.</span><span class="ident" id="3346752">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346766">if</span>&nbsp;<span class="ident" id="3346769">s</span>&nbsp;<span class="op" id="3346771">==</span>&nbsp;<span class="ident" id="3346774">nil</span>&nbsp;<span class="op" id="3346778">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346782">s</span>&nbsp;<span class="op" id="3346784">=</span>&nbsp;<span class="ident" id="3346786">defaultCipherSuites</span><span class="op" id="3346805">(</span><span class="op" id="3346806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346812">return</span>&nbsp;<span class="ident" id="3346819">s</span><br>
<span class="lineno"></span><span class="op" id="3346821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3346824">func</span>&nbsp;<span class="op" id="3346829">(</span><span class="ident" id="3346830">c</span>&nbsp;<span class="op" id="3346832">*</span><span class="ident" id="3346833">Config</span><span class="op" id="3346839">)</span>&nbsp;<span class="ident" id="3346841">minVersion</span><span class="op" id="3346851">(</span><span class="op" id="3346852">)</span>&nbsp;<span class="builtintype" id="3346854">uint16</span>&nbsp;<span class="op" id="3346861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346864">if</span>&nbsp;<span class="ident" id="3346867">c</span>&nbsp;<span class="op" id="3346869">==</span>&nbsp;<span class="ident" id="3346872">nil</span>&nbsp;<span class="op" id="3346876">||</span>&nbsp;<span class="ident" id="3346879">c</span><span class="op" id="3346880">.</span><span class="ident" id="3346881">MinVersion</span>&nbsp;<span class="op" id="3346892">==</span>&nbsp;<span class="num" id="3346895">0</span>&nbsp;<span class="op" id="3346897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346901">return</span>&nbsp;<span class="ident" id="3346908">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346923">return</span>&nbsp;<span class="ident" id="3346930">c</span><span class="op" id="3346931">.</span><span class="ident" id="3346932">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3346943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3346946">func</span>&nbsp;<span class="op" id="3346951">(</span><span class="ident" id="3346952">c</span>&nbsp;<span class="op" id="3346954">*</span><span class="ident" id="3346955">Config</span><span class="op" id="3346961">)</span>&nbsp;<span class="ident" id="3346963">maxVersion</span><span class="op" id="3346973">(</span><span class="op" id="3346974">)</span>&nbsp;<span class="builtintype" id="3346976">uint16</span>&nbsp;<span class="op" id="3346983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346986">if</span>&nbsp;<span class="ident" id="3346989">c</span>&nbsp;<span class="op" id="3346991">==</span>&nbsp;<span class="ident" id="3346994">nil</span>&nbsp;<span class="op" id="3346998">||</span>&nbsp;<span class="ident" id="3347001">c</span><span class="op" id="3347002">.</span><span class="ident" id="3347003">MaxVersion</span>&nbsp;<span class="op" id="3347014">==</span>&nbsp;<span class="num" id="3347017">0</span>&nbsp;<span class="op" id="3347019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347023">return</span>&nbsp;<span class="ident" id="3347030">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347045">return</span>&nbsp;<span class="ident" id="3347052">c</span><span class="op" id="3347053">.</span><span class="ident" id="3347054">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3347065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3347068">var</span>&nbsp;<span class="ident" id="3347072">defaultCurvePreferences</span>&nbsp;<span class="op" id="3347096">=</span>&nbsp;<span class="op" id="3347098">[</span><span class="op" id="3347099">]</span><span class="ident" id="3347100">CurveID</span><span class="op" id="3347107">{</span><span class="ident" id="3347108">CurveP256</span><span class="op" id="3347117">,</span>&nbsp;<span class="ident" id="3347119">CurveP384</span><span class="op" id="3347128">,</span>&nbsp;<span class="ident" id="3347130">CurveP521</span><span class="op" id="3347139">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3347142">func</span>&nbsp;<span class="op" id="3347147">(</span><span class="ident" id="3347148">c</span>&nbsp;<span class="op" id="3347150">*</span><span class="ident" id="3347151">Config</span><span class="op" id="3347157">)</span>&nbsp;<span class="ident" id="3347159">curvePreferences</span><span class="op" id="3347175">(</span><span class="op" id="3347176">)</span>&nbsp;<span class="op" id="3347178">[</span><span class="op" id="3347179">]</span><span class="ident" id="3347180">CurveID</span>&nbsp;<span class="op" id="3347188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347191">if</span>&nbsp;<span class="ident" id="3347194">c</span>&nbsp;<span class="op" id="3347196">==</span>&nbsp;<span class="ident" id="3347199">nil</span>&nbsp;<span class="op" id="3347203">||</span>&nbsp;<span class="builtinfunc" id="3347206">len</span><span class="op" id="3347209">(</span><span class="ident" id="3347210">c</span><span class="op" id="3347211">.</span><span class="ident" id="3347212">CurvePreferences</span><span class="op" id="3347228">)</span>&nbsp;<span class="op" id="3347230">==</span>&nbsp;<span class="num" id="3347233">0</span>&nbsp;<span class="op" id="3347235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347239">return</span>&nbsp;<span class="ident" id="3347246">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347271">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347274">return</span>&nbsp;<span class="ident" id="3347281">c</span><span class="op" id="3347282">.</span><span class="ident" id="3347283">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3347300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347303">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3347377">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3347401">func</span>&nbsp;<span class="op" id="3347406">(</span><span class="ident" id="3347407">c</span>&nbsp;<span class="op" id="3347409">*</span><span class="ident" id="3347410">Config</span><span class="op" id="3347416">)</span>&nbsp;<span class="ident" id="3347418">mutualVersion</span><span class="op" id="3347431">(</span><span class="ident" id="3347432">vers</span>&nbsp;<span class="builtintype" id="3347437">uint16</span><span class="op" id="3347443">)</span>&nbsp;<span class="op" id="3347445">(</span><span class="builtintype" id="3347446">uint16</span><span class="op" id="3347452">,</span>&nbsp;<span class="builtintype" id="3347454">bool</span><span class="op" id="3347458">)</span>&nbsp;<span class="op" id="3347460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347463">minVersion</span>&nbsp;<span class="op" id="3347474">:=</span>&nbsp;<span class="ident" id="3347477">c</span><span class="op" id="3347478">.</span><span class="ident" id="3347479">minVersion</span><span class="op" id="3347489">(</span><span class="op" id="3347490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347493">maxVersion</span>&nbsp;<span class="op" id="3347504">:=</span>&nbsp;<span class="ident" id="3347507">c</span><span class="op" id="3347508">.</span><span class="ident" id="3347509">maxVersion</span><span class="op" id="3347519">(</span><span class="op" id="3347520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347524">if</span>&nbsp;<span class="ident" id="3347527">vers</span>&nbsp;<span class="op" id="3347532">&lt;</span>&nbsp;<span class="ident" id="3347534">minVersion</span>&nbsp;<span class="op" id="3347545">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347549">return</span>&nbsp;<span class="num" id="3347556">0</span><span class="op" id="3347557">,</span>&nbsp;<span class="builtintype" id="3347559">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347569">if</span>&nbsp;<span class="ident" id="3347572">vers</span>&nbsp;<span class="op" id="3347577">&gt;</span>&nbsp;<span class="ident" id="3347579">maxVersion</span>&nbsp;<span class="op" id="3347590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347594">vers</span>&nbsp;<span class="op" id="3347599">=</span>&nbsp;<span class="ident" id="3347601">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347613">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347616">return</span>&nbsp;<span class="ident" id="3347623">vers</span><span class="op" id="3347627">,</span>&nbsp;<span class="builtintype" id="3347629">true</span><br>
<span class="lineno"></span><span class="op" id="3347634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347637">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3347715">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3347769">func</span>&nbsp;<span class="op" id="3347774">(</span><span class="ident" id="3347775">c</span>&nbsp;<span class="op" id="3347777">*</span><span class="ident" id="3347778">Config</span><span class="op" id="3347784">)</span>&nbsp;<span class="ident" id="3347786">getCertificate</span><span class="op" id="3347800">(</span><span class="ident" id="3347801">clientHello</span>&nbsp;<span class="op" id="3347813">*</span><span class="ident" id="3347814">ClientHelloInfo</span><span class="op" id="3347829">)</span>&nbsp;<span class="op" id="3347831">(</span><span class="op" id="3347832">*</span><span class="ident" id="3347833">Certificate</span><span class="op" id="3347844">,</span>&nbsp;<span class="builtintype" id="3347846">error</span><span class="op" id="3347851">)</span>&nbsp;<span class="op" id="3347853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347856">if</span>&nbsp;<span class="ident" id="3347859">c</span><span class="op" id="3347860">.</span><span class="ident" id="3347861">GetCertificate</span>&nbsp;<span class="op" id="3347876">!=</span>&nbsp;<span class="ident" id="3347879">nil</span>&nbsp;<span class="op" id="3347883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347887">cert</span><span class="op" id="3347891">,</span>&nbsp;<span class="ident" id="3347893">err</span>&nbsp;<span class="op" id="3347897">:=</span>&nbsp;<span class="ident" id="3347900">c</span><span class="op" id="3347901">.</span><span class="ident" id="3347902">GetCertificate</span><span class="op" id="3347916">(</span><span class="ident" id="3347917">clientHello</span><span class="op" id="3347928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347932">if</span>&nbsp;<span class="ident" id="3347935">cert</span>&nbsp;<span class="op" id="3347940">!=</span>&nbsp;<span class="ident" id="3347943">nil</span>&nbsp;<span class="op" id="3347947">||</span>&nbsp;<span class="ident" id="3347950">err</span>&nbsp;<span class="op" id="3347954">!=</span>&nbsp;<span class="ident" id="3347957">nil</span>&nbsp;<span class="op" id="3347961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347966">return</span>&nbsp;<span class="ident" id="3347973">cert</span><span class="op" id="3347977">,</span>&nbsp;<span class="ident" id="3347979">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347992">if</span>&nbsp;<span class="builtinfunc" id="3347995">len</span><span class="op" id="3347998">(</span><span class="ident" id="3347999">c</span><span class="op" id="3348000">.</span><span class="ident" id="3348001">Certificates</span><span class="op" id="3348013">)</span>&nbsp;<span class="op" id="3348015">==</span>&nbsp;<span class="num" id="3348018">1</span>&nbsp;<span class="op" id="3348020">||</span>&nbsp;<span class="ident" id="3348023">c</span><span class="op" id="3348024">.</span><span class="ident" id="3348025">NameToCertificate</span>&nbsp;<span class="op" id="3348043">==</span>&nbsp;<span class="ident" id="3348046">nil</span>&nbsp;<span class="op" id="3348050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348054">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348112">return</span>&nbsp;<span class="op" id="3348119">&amp;</span><span class="ident" id="3348120">c</span><span class="op" id="3348121">.</span><span class="ident" id="3348122">Certificates</span><span class="op" id="3348134">[</span><span class="num" id="3348135">0</span><span class="op" id="3348136">]</span><span class="op" id="3348137">,</span>&nbsp;<span class="ident" id="3348139">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348148">name</span>&nbsp;<span class="op" id="3348153">:=</span>&nbsp;<span class="ident" id="3348156">strings</span><span class="op" id="3348163">.</span><span class="ident" id="3348164">ToLower</span><span class="op" id="3348171">(</span><span class="ident" id="3348172">clientHello</span><span class="op" id="3348183">.</span><span class="ident" id="3348184">ServerName</span><span class="op" id="3348194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348197">for</span>&nbsp;<span class="builtinfunc" id="3348201">len</span><span class="op" id="3348204">(</span><span class="ident" id="3348205">name</span><span class="op" id="3348209">)</span>&nbsp;<span class="op" id="3348211">&gt;</span>&nbsp;<span class="num" id="3348213">0</span>&nbsp;<span class="op" id="3348215">&amp;&amp;</span>&nbsp;<span class="ident" id="3348218">name</span><span class="op" id="3348222">[</span><span class="builtinfunc" id="3348223">len</span><span class="op" id="3348226">(</span><span class="ident" id="3348227">name</span><span class="op" id="3348231">)</span><span class="op" id="3348232">-</span><span class="num" id="3348233">1</span><span class="op" id="3348234">]</span>&nbsp;<span class="op" id="3348236">==</span>&nbsp;<span class="string" id="3348239">&#39;.&#39;</span>&nbsp;<span class="op" id="3348243">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348247">name</span>&nbsp;<span class="op" id="3348252">=</span>&nbsp;<span class="ident" id="3348254">name</span><span class="op" id="3348258">[</span><span class="op" id="3348259">:</span><span class="builtinfunc" id="3348260">len</span><span class="op" id="3348263">(</span><span class="ident" id="3348264">name</span><span class="op" id="3348268">)</span><span class="op" id="3348269">-</span><span class="num" id="3348270">1</span><span class="op" id="3348271">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348278">if</span>&nbsp;<span class="ident" id="3348281">cert</span><span class="op" id="3348285">,</span>&nbsp;<span class="ident" id="3348287">ok</span>&nbsp;<span class="op" id="3348290">:=</span>&nbsp;<span class="ident" id="3348293">c</span><span class="op" id="3348294">.</span><span class="ident" id="3348295">NameToCertificate</span><span class="op" id="3348312">[</span><span class="ident" id="3348313">name</span><span class="op" id="3348317">]</span><span class="op" id="3348318">;</span>&nbsp;<span class="ident" id="3348320">ok</span>&nbsp;<span class="op" id="3348323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348327">return</span>&nbsp;<span class="ident" id="3348334">cert</span><span class="op" id="3348338">,</span>&nbsp;<span class="ident" id="3348340">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348349">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348416">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348427">labels</span>&nbsp;<span class="op" id="3348434">:=</span>&nbsp;<span class="ident" id="3348437">strings</span><span class="op" id="3348444">.</span><span class="ident" id="3348445">Split</span><span class="op" id="3348450">(</span><span class="ident" id="3348451">name</span><span class="op" id="3348455">,</span>&nbsp;<span class="string" id="3348457">&#34;.&#34;</span><span class="op" id="3348460">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348463">for</span>&nbsp;<span class="ident" id="3348467">i</span>&nbsp;<span class="op" id="3348469">:=</span>&nbsp;<span class="keyword" id="3348472">range</span>&nbsp;<span class="ident" id="3348478">labels</span>&nbsp;<span class="op" id="3348485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348489">labels</span><span class="op" id="3348495">[</span><span class="ident" id="3348496">i</span><span class="op" id="3348497">]</span>&nbsp;<span class="op" id="3348499">=</span>&nbsp;<span class="string" id="3348501">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348507">candidate</span>&nbsp;<span class="op" id="3348517">:=</span>&nbsp;<span class="ident" id="3348520">strings</span><span class="op" id="3348527">.</span><span class="ident" id="3348528">Join</span><span class="op" id="3348532">(</span><span class="ident" id="3348533">labels</span><span class="op" id="3348539">,</span>&nbsp;<span class="string" id="3348541">&#34;.&#34;</span><span class="op" id="3348544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348548">if</span>&nbsp;<span class="ident" id="3348551">cert</span><span class="op" id="3348555">,</span>&nbsp;<span class="ident" id="3348557">ok</span>&nbsp;<span class="op" id="3348560">:=</span>&nbsp;<span class="ident" id="3348563">c</span><span class="op" id="3348564">.</span><span class="ident" id="3348565">NameToCertificate</span><span class="op" id="3348582">[</span><span class="ident" id="3348583">candidate</span><span class="op" id="3348592">]</span><span class="op" id="3348593">;</span>&nbsp;<span class="ident" id="3348595">ok</span>&nbsp;<span class="op" id="3348598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348603">return</span>&nbsp;<span class="ident" id="3348610">cert</span><span class="op" id="3348614">,</span>&nbsp;<span class="ident" id="3348616">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348629">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348683">return</span>&nbsp;<span class="op" id="3348690">&amp;</span><span class="ident" id="3348691">c</span><span class="op" id="3348692">.</span><span class="ident" id="3348693">Certificates</span><span class="op" id="3348705">[</span><span class="num" id="3348706">0</span><span class="op" id="3348707">]</span><span class="op" id="3348708">,</span>&nbsp;<span class="ident" id="3348710">nil</span><br>
<span class="lineno">465</span><span class="op" id="3348714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348717">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3348796">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3348871">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3348888">func</span>&nbsp;<span class="op" id="3348893">(</span><span class="ident" id="3348894">c</span>&nbsp;<span class="op" id="3348896">*</span><span class="ident" id="3348897">Config</span><span class="op" id="3348903">)</span>&nbsp;<span class="ident" id="3348905">BuildNameToCertificate</span><span class="op" id="3348927">(</span><span class="op" id="3348928">)</span>&nbsp;<span class="op" id="3348930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348933">c</span><span class="op" id="3348934">.</span><span class="ident" id="3348935">NameToCertificate</span>&nbsp;<span class="op" id="3348953">=</span>&nbsp;<span class="builtinfunc" id="3348955">make</span><span class="op" id="3348959">(</span><span class="keyword" id="3348960">map</span><span class="op" id="3348963">[</span><span class="builtintype" id="3348964">string</span><span class="op" id="3348970">]</span><span class="op" id="3348971">*</span><span class="ident" id="3348972">Certificate</span><span class="op" id="3348983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348986">for</span>&nbsp;<span class="ident" id="3348990">i</span>&nbsp;<span class="op" id="3348992">:=</span>&nbsp;<span class="keyword" id="3348995">range</span>&nbsp;<span class="ident" id="3349001">c</span><span class="op" id="3349002">.</span><span class="ident" id="3349003">Certificates</span>&nbsp;<span class="op" id="3349016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349020">cert</span>&nbsp;<span class="op" id="3349025">:=</span>&nbsp;<span class="op" id="3349028">&amp;</span><span class="ident" id="3349029">c</span><span class="op" id="3349030">.</span><span class="ident" id="3349031">Certificates</span><span class="op" id="3349043">[</span><span class="ident" id="3349044">i</span><span class="op" id="3349045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349049">x509Cert</span><span class="op" id="3349057">,</span>&nbsp;<span class="ident" id="3349059">err</span>&nbsp;<span class="op" id="3349063">:=</span>&nbsp;<span class="ident" id="3349066">x509</span><span class="op" id="3349070">.</span><span class="ident" id="3349071">ParseCertificate</span><span class="op" id="3349087">(</span><span class="ident" id="3349088">cert</span><span class="op" id="3349092">.</span><span class="ident" id="3349093">Certificate</span><span class="op" id="3349104">[</span><span class="num" id="3349105">0</span><span class="op" id="3349106">]</span><span class="op" id="3349107">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349111">if</span>&nbsp;<span class="ident" id="3349114">err</span>&nbsp;<span class="op" id="3349118">!=</span>&nbsp;<span class="ident" id="3349121">nil</span>&nbsp;<span class="op" id="3349125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349145">if</span>&nbsp;<span class="builtinfunc" id="3349148">len</span><span class="op" id="3349151">(</span><span class="ident" id="3349152">x509Cert</span><span class="op" id="3349160">.</span><span class="ident" id="3349161">Subject</span><span class="op" id="3349168">.</span><span class="ident" id="3349169">CommonName</span><span class="op" id="3349179">)</span>&nbsp;<span class="op" id="3349181">&gt;</span>&nbsp;<span class="num" id="3349183">0</span>&nbsp;<span class="op" id="3349185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349190">c</span><span class="op" id="3349191">.</span><span class="ident" id="3349192">NameToCertificate</span><span class="op" id="3349209">[</span><span class="ident" id="3349210">x509Cert</span><span class="op" id="3349218">.</span><span class="ident" id="3349219">Subject</span><span class="op" id="3349226">.</span><span class="ident" id="3349227">CommonName</span><span class="op" id="3349237">]</span>&nbsp;<span class="op" id="3349239">=</span>&nbsp;<span class="ident" id="3349241">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349252">for</span>&nbsp;<span class="ident" id="3349256">_</span><span class="op" id="3349257">,</span>&nbsp;<span class="ident" id="3349259">san</span>&nbsp;<span class="op" id="3349263">:=</span>&nbsp;<span class="keyword" id="3349266">range</span>&nbsp;<span class="ident" id="3349272">x509Cert</span><span class="op" id="3349280">.</span><span class="ident" id="3349281">DNSNames</span>&nbsp;<span class="op" id="3349290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349295">c</span><span class="op" id="3349296">.</span><span class="ident" id="3349297">NameToCertificate</span><span class="op" id="3349314">[</span><span class="ident" id="3349315">san</span><span class="op" id="3349318">]</span>&nbsp;<span class="op" id="3349320">=</span>&nbsp;<span class="ident" id="3349322">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349332">}</span><br>
<span class="lineno">485</span><span class="op" id="3349334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349337">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3349406">type</span>&nbsp;<span class="ident" id="3349411">Certificate</span>&nbsp;<span class="keyword" id="3349423">struct</span>&nbsp;<span class="op" id="3349430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349433">Certificate</span>&nbsp;<span class="op" id="3349445">[</span><span class="op" id="3349446">]</span><span class="op" id="3349447">[</span><span class="op" id="3349448">]</span><span class="builtintype" id="3349449">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349455">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349527">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349588">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349658">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349728">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349757">PrivateKey</span>&nbsp;<span class="ident" id="3349768">crypto</span><span class="op" id="3349774">.</span><span class="ident" id="3349775">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349787">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349858">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349890">OCSPStaple</span>&nbsp;<span class="op" id="3349901">[</span><span class="op" id="3349902">]</span><span class="builtintype" id="3349903">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349909">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349975">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350043">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350115">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350162">Leaf</span>&nbsp;<span class="op" id="3350167">*</span><span class="ident" id="3350168">x509</span><span class="op" id="3350172">.</span><span class="ident" id="3350173">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3350185">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3350188">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3350205">type</span>&nbsp;<span class="ident" id="3350210">record</span>&nbsp;<span class="keyword" id="3350217">struct</span>&nbsp;<span class="op" id="3350224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350227">contentType</span>&nbsp;&nbsp;<span class="ident" id="3350240">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350252">major</span><span class="op" id="3350257">,</span>&nbsp;<span class="ident" id="3350259">minor</span>&nbsp;<span class="builtintype" id="3350265">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350272">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350285">[</span><span class="op" id="3350286">]</span><span class="builtintype" id="3350287">byte</span><br>
<span class="lineno"></span><span class="op" id="3350292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3350295">type</span>&nbsp;<span class="ident" id="3350300">handshakeMessage</span>&nbsp;<span class="keyword" id="3350317">interface</span>&nbsp;<span class="op" id="3350327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350330">marshal</span><span class="op" id="3350337">(</span><span class="op" id="3350338">)</span>&nbsp;<span class="op" id="3350340">[</span><span class="op" id="3350341">]</span><span class="builtintype" id="3350342">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350348">unmarshal</span><span class="op" id="3350357">(</span><span class="op" id="3350358">[</span><span class="op" id="3350359">]</span><span class="builtintype" id="3350360">byte</span><span class="op" id="3350364">)</span>&nbsp;<span class="builtintype" id="3350366">bool</span><br>
<span class="lineno"></span><span class="op" id="3350371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350374">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3350449">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3350470">type</span>&nbsp;<span class="ident" id="3350475">lruSessionCache</span>&nbsp;<span class="keyword" id="3350491">struct</span>&nbsp;<span class="op" id="3350498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350501">sync</span><span class="op" id="3350505">.</span><span class="ident" id="3350506">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350514">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350523">map</span><span class="op" id="3350526">[</span><span class="builtintype" id="3350527">string</span><span class="op" id="3350533">]</span><span class="op" id="3350534">*</span><span class="ident" id="3350535">list</span><span class="op" id="3350539">.</span><span class="ident" id="3350540">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350549">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350558">*</span><span class="ident" id="3350559">list</span><span class="op" id="3350563">.</span><span class="ident" id="3350564">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350570">capacity</span>&nbsp;<span class="builtintype" id="3350579">int</span><br>
<span class="lineno"></span><span class="op" id="3350583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3350586">type</span>&nbsp;<span class="ident" id="3350591">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3350612">struct</span>&nbsp;<span class="op" id="3350619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350622">sessionKey</span>&nbsp;<span class="builtintype" id="3350633">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350641">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350652">*</span><span class="ident" id="3350653">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3350672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350675">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3350747">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3350825">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3350845">func</span>&nbsp;<span class="ident" id="3350850">NewLRUClientSessionCache</span><span class="op" id="3350874">(</span><span class="ident" id="3350875">capacity</span>&nbsp;<span class="builtintype" id="3350884">int</span><span class="op" id="3350887">)</span>&nbsp;<span class="ident" id="3350889">ClientSessionCache</span>&nbsp;<span class="op" id="3350908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350911">const</span>&nbsp;<span class="ident" id="3350917">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3350945">=</span>&nbsp;<span class="num" id="3350947">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350952">if</span>&nbsp;<span class="ident" id="3350955">capacity</span>&nbsp;<span class="op" id="3350964">&lt;</span>&nbsp;<span class="num" id="3350966">1</span>&nbsp;<span class="op" id="3350968">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350972">capacity</span>&nbsp;<span class="op" id="3350981">=</span>&nbsp;<span class="ident" id="3350983">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351015">return</span>&nbsp;<span class="op" id="3351022">&amp;</span><span class="ident" id="3351023">lruSessionCache</span><span class="op" id="3351038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351042">m</span><span class="op" id="3351043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3351052">make</span><span class="op" id="3351056">(</span><span class="keyword" id="3351057">map</span><span class="op" id="3351060">[</span><span class="builtintype" id="3351061">string</span><span class="op" id="3351067">]</span><span class="op" id="3351068">*</span><span class="ident" id="3351069">list</span><span class="op" id="3351073">.</span><span class="ident" id="3351074">Element</span><span class="op" id="3351081">)</span><span class="op" id="3351082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351086">q</span><span class="op" id="3351087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3351096">list</span><span class="op" id="3351100">.</span><span class="ident" id="3351101">New</span><span class="op" id="3351104">(</span><span class="op" id="3351105">)</span><span class="op" id="3351106">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351110">capacity</span><span class="op" id="3351118">:</span>&nbsp;<span class="ident" id="3351120">capacity</span><span class="op" id="3351128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351131">}</span><br>
<span class="lineno"></span><span class="op" id="3351133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351136">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3351197">func</span>&nbsp;<span class="op" id="3351202">(</span><span class="ident" id="3351203">c</span>&nbsp;<span class="op" id="3351205">*</span><span class="ident" id="3351206">lruSessionCache</span><span class="op" id="3351221">)</span>&nbsp;<span class="ident" id="3351223">Put</span><span class="op" id="3351226">(</span><span class="ident" id="3351227">sessionKey</span>&nbsp;<span class="builtintype" id="3351238">string</span><span class="op" id="3351244">,</span>&nbsp;<span class="ident" id="3351246">cs</span>&nbsp;<span class="op" id="3351249">*</span><span class="ident" id="3351250">ClientSessionState</span><span class="op" id="3351268">)</span>&nbsp;<span class="op" id="3351270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351273">c</span><span class="op" id="3351274">.</span><span class="ident" id="3351275">Lock</span><span class="op" id="3351279">(</span><span class="op" id="3351280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351283">defer</span>&nbsp;<span class="ident" id="3351289">c</span><span class="op" id="3351290">.</span><span class="ident" id="3351291">Unlock</span><span class="op" id="3351297">(</span><span class="op" id="3351298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351302">if</span>&nbsp;<span class="ident" id="3351305">elem</span><span class="op" id="3351309">,</span>&nbsp;<span class="ident" id="3351311">ok</span>&nbsp;<span class="op" id="3351314">:=</span>&nbsp;<span class="ident" id="3351317">c</span><span class="op" id="3351318">.</span><span class="ident" id="3351319">m</span><span class="op" id="3351320">[</span><span class="ident" id="3351321">sessionKey</span><span class="op" id="3351331">]</span><span class="op" id="3351332">;</span>&nbsp;<span class="ident" id="3351334">ok</span>&nbsp;<span class="op" id="3351337">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351341">entry</span>&nbsp;<span class="op" id="3351347">:=</span>&nbsp;<span class="ident" id="3351350">elem</span><span class="op" id="3351354">.</span><span class="ident" id="3351355">Value</span><span class="op" id="3351360">.</span><span class="op" id="3351361">(</span><span class="op" id="3351362">*</span><span class="ident" id="3351363">lruSessionCacheEntry</span><span class="op" id="3351383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351387">entry</span><span class="op" id="3351392">.</span><span class="ident" id="3351393">state</span>&nbsp;<span class="op" id="3351399">=</span>&nbsp;<span class="ident" id="3351401">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351406">c</span><span class="op" id="3351407">.</span><span class="ident" id="3351408">q</span><span class="op" id="3351409">.</span><span class="ident" id="3351410">MoveToFront</span><span class="op" id="3351421">(</span><span class="ident" id="3351422">elem</span><span class="op" id="3351426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351430">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351438">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351442">if</span>&nbsp;<span class="ident" id="3351445">c</span><span class="op" id="3351446">.</span><span class="ident" id="3351447">q</span><span class="op" id="3351448">.</span><span class="ident" id="3351449">Len</span><span class="op" id="3351452">(</span><span class="op" id="3351453">)</span>&nbsp;<span class="op" id="3351455">&lt;</span>&nbsp;<span class="ident" id="3351457">c</span><span class="op" id="3351458">.</span><span class="ident" id="3351459">capacity</span>&nbsp;<span class="op" id="3351468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351472">entry</span>&nbsp;<span class="op" id="3351478">:=</span>&nbsp;<span class="op" id="3351481">&amp;</span><span class="ident" id="3351482">lruSessionCacheEntry</span><span class="op" id="3351502">{</span><span class="ident" id="3351503">sessionKey</span><span class="op" id="3351513">,</span>&nbsp;<span class="ident" id="3351515">cs</span><span class="op" id="3351517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351521">c</span><span class="op" id="3351522">.</span><span class="ident" id="3351523">m</span><span class="op" id="3351524">[</span><span class="ident" id="3351525">sessionKey</span><span class="op" id="3351535">]</span>&nbsp;<span class="op" id="3351537">=</span>&nbsp;<span class="ident" id="3351539">c</span><span class="op" id="3351540">.</span><span class="ident" id="3351541">q</span><span class="op" id="3351542">.</span><span class="ident" id="3351543">PushFront</span><span class="op" id="3351552">(</span><span class="ident" id="3351553">entry</span><span class="op" id="3351558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351562">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351574">elem</span>&nbsp;<span class="op" id="3351579">:=</span>&nbsp;<span class="ident" id="3351582">c</span><span class="op" id="3351583">.</span><span class="ident" id="3351584">q</span><span class="op" id="3351585">.</span><span class="ident" id="3351586">Back</span><span class="op" id="3351590">(</span><span class="op" id="3351591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351594">entry</span>&nbsp;<span class="op" id="3351600">:=</span>&nbsp;<span class="ident" id="3351603">elem</span><span class="op" id="3351607">.</span><span class="ident" id="3351608">Value</span><span class="op" id="3351613">.</span><span class="op" id="3351614">(</span><span class="op" id="3351615">*</span><span class="ident" id="3351616">lruSessionCacheEntry</span><span class="op" id="3351636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3351639">delete</span><span class="op" id="3351645">(</span><span class="ident" id="3351646">c</span><span class="op" id="3351647">.</span><span class="ident" id="3351648">m</span><span class="op" id="3351649">,</span>&nbsp;<span class="ident" id="3351651">entry</span><span class="op" id="3351656">.</span><span class="ident" id="3351657">sessionKey</span><span class="op" id="3351667">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351670">entry</span><span class="op" id="3351675">.</span><span class="ident" id="3351676">sessionKey</span>&nbsp;<span class="op" id="3351687">=</span>&nbsp;<span class="ident" id="3351689">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351701">entry</span><span class="op" id="3351706">.</span><span class="ident" id="3351707">state</span>&nbsp;<span class="op" id="3351713">=</span>&nbsp;<span class="ident" id="3351715">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351719">c</span><span class="op" id="3351720">.</span><span class="ident" id="3351721">q</span><span class="op" id="3351722">.</span><span class="ident" id="3351723">MoveToFront</span><span class="op" id="3351734">(</span><span class="ident" id="3351735">elem</span><span class="op" id="3351739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351742">c</span><span class="op" id="3351743">.</span><span class="ident" id="3351744">m</span><span class="op" id="3351745">[</span><span class="ident" id="3351746">sessionKey</span><span class="op" id="3351756">]</span>&nbsp;<span class="op" id="3351758">=</span>&nbsp;<span class="ident" id="3351760">elem</span><br>
<span class="lineno"></span><span class="op" id="3351765">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3351768">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3351844">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3351890">func</span>&nbsp;<span class="op" id="3351895">(</span><span class="ident" id="3351896">c</span>&nbsp;<span class="op" id="3351898">*</span><span class="ident" id="3351899">lruSessionCache</span><span class="op" id="3351914">)</span>&nbsp;<span class="ident" id="3351916">Get</span><span class="op" id="3351919">(</span><span class="ident" id="3351920">sessionKey</span>&nbsp;<span class="builtintype" id="3351931">string</span><span class="op" id="3351937">)</span>&nbsp;<span class="op" id="3351939">(</span><span class="op" id="3351940">*</span><span class="ident" id="3351941">ClientSessionState</span><span class="op" id="3351959">,</span>&nbsp;<span class="builtintype" id="3351961">bool</span><span class="op" id="3351965">)</span>&nbsp;<span class="op" id="3351967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351970">c</span><span class="op" id="3351971">.</span><span class="ident" id="3351972">Lock</span><span class="op" id="3351976">(</span><span class="op" id="3351977">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351980">defer</span>&nbsp;<span class="ident" id="3351986">c</span><span class="op" id="3351987">.</span><span class="ident" id="3351988">Unlock</span><span class="op" id="3351994">(</span><span class="op" id="3351995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351999">if</span>&nbsp;<span class="ident" id="3352002">elem</span><span class="op" id="3352006">,</span>&nbsp;<span class="ident" id="3352008">ok</span>&nbsp;<span class="op" id="3352011">:=</span>&nbsp;<span class="ident" id="3352014">c</span><span class="op" id="3352015">.</span><span class="ident" id="3352016">m</span><span class="op" id="3352017">[</span><span class="ident" id="3352018">sessionKey</span><span class="op" id="3352028">]</span><span class="op" id="3352029">;</span>&nbsp;<span class="ident" id="3352031">ok</span>&nbsp;<span class="op" id="3352034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352038">c</span><span class="op" id="3352039">.</span><span class="ident" id="3352040">q</span><span class="op" id="3352041">.</span><span class="ident" id="3352042">MoveToFront</span><span class="op" id="3352053">(</span><span class="ident" id="3352054">elem</span><span class="op" id="3352058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352062">return</span>&nbsp;<span class="ident" id="3352069">elem</span><span class="op" id="3352073">.</span><span class="ident" id="3352074">Value</span><span class="op" id="3352079">.</span><span class="op" id="3352080">(</span><span class="op" id="3352081">*</span><span class="ident" id="3352082">lruSessionCacheEntry</span><span class="op" id="3352102">)</span><span class="op" id="3352103">.</span><span class="ident" id="3352104">state</span><span class="op" id="3352109">,</span>&nbsp;<span class="builtintype" id="3352111">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352120">return</span>&nbsp;<span class="ident" id="3352127">nil</span><span class="op" id="3352130">,</span>&nbsp;<span class="builtintype" id="3352132">false</span><br>
<span class="lineno"></span><span class="op" id="3352138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3352141">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3352214">type</span>&nbsp;<span class="ident" id="3352219">dsaSignature</span>&nbsp;<span class="keyword" id="3352232">struct</span>&nbsp;<span class="op" id="3352239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352242">R</span><span class="op" id="3352243">,</span>&nbsp;<span class="ident" id="3352245">S</span>&nbsp;<span class="op" id="3352247">*</span><span class="ident" id="3352248">big</span><span class="op" id="3352251">.</span><span class="ident" id="3352252">Int</span><br>
<span class="lineno"></span><span class="op" id="3352256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352259">type</span>&nbsp;<span class="ident" id="3352264">ecdsaSignature</span>&nbsp;<span class="ident" id="3352279">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3352293">var</span>&nbsp;<span class="ident" id="3352297">emptyConfig</span>&nbsp;<span class="ident" id="3352309">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352317">func</span>&nbsp;<span class="ident" id="3352322">defaultConfig</span><span class="op" id="3352335">(</span><span class="op" id="3352336">)</span>&nbsp;<span class="op" id="3352338">*</span><span class="ident" id="3352339">Config</span>&nbsp;<span class="op" id="3352346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352349">return</span>&nbsp;<span class="op" id="3352356">&amp;</span><span class="ident" id="3352357">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3352369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352372">var</span>&nbsp;<span class="op" id="3352376">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352379">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352402">sync</span><span class="op" id="3352406">.</span><span class="ident" id="3352407">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352413">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3352436">[</span><span class="op" id="3352437">]</span><span class="builtintype" id="3352438">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3352445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352448">func</span>&nbsp;<span class="ident" id="3352453">defaultCipherSuites</span><span class="op" id="3352472">(</span><span class="op" id="3352473">)</span>&nbsp;<span class="op" id="3352475">[</span><span class="op" id="3352476">]</span><span class="builtintype" id="3352477">uint16</span>&nbsp;<span class="op" id="3352484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352487">once</span><span class="op" id="3352491">.</span><span class="ident" id="3352492">Do</span><span class="op" id="3352494">(</span><span class="ident" id="3352495">initDefaultCipherSuites</span><span class="op" id="3352518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352521">return</span>&nbsp;<span class="ident" id="3352528">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3352551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352554">func</span>&nbsp;<span class="ident" id="3352559">initDefaultCipherSuites</span><span class="op" id="3352582">(</span><span class="op" id="3352583">)</span>&nbsp;<span class="op" id="3352585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352588">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3352611">=</span>&nbsp;<span class="builtinfunc" id="3352613">make</span><span class="op" id="3352617">(</span><span class="op" id="3352618">[</span><span class="op" id="3352619">]</span><span class="builtintype" id="3352620">uint16</span><span class="op" id="3352626">,</span>&nbsp;<span class="builtinfunc" id="3352628">len</span><span class="op" id="3352631">(</span><span class="ident" id="3352632">cipherSuites</span><span class="op" id="3352644">)</span><span class="op" id="3352645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352648">for</span>&nbsp;<span class="ident" id="3352652">i</span><span class="op" id="3352653">,</span>&nbsp;<span class="ident" id="3352655">suite</span>&nbsp;<span class="op" id="3352661">:=</span>&nbsp;<span class="keyword" id="3352664">range</span>&nbsp;<span class="ident" id="3352670">cipherSuites</span>&nbsp;<span class="op" id="3352683">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352687">varDefaultCipherSuites</span><span class="op" id="3352709">[</span><span class="ident" id="3352710">i</span><span class="op" id="3352711">]</span>&nbsp;<span class="op" id="3352713">=</span>&nbsp;<span class="ident" id="3352715">suite</span><span class="op" id="3352720">.</span><span class="ident" id="3352721">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352725">}</span><br>
<span class="lineno"></span><span class="op" id="3352727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352730">func</span>&nbsp;<span class="ident" id="3352735">unexpectedMessageError</span><span class="op" id="3352757">(</span><span class="ident" id="3352758">wanted</span><span class="op" id="3352764">,</span>&nbsp;<span class="ident" id="3352766">got</span>&nbsp;<span class="keyword" id="3352770">interface</span><span class="op" id="3352779">{</span><span class="op" id="3352780">}</span><span class="op" id="3352781">)</span>&nbsp;<span class="builtintype" id="3352783">error</span>&nbsp;<span class="op" id="3352789">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352792">return</span>&nbsp;<span class="ident" id="3352799">fmt</span><span class="op" id="3352802">.</span><span class="ident" id="3352803">Errorf</span><span class="op" id="3352809">(</span><span class="string" id="3352810">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3352885">,</span>&nbsp;<span class="ident" id="3352887">got</span><span class="op" id="3352890">,</span>&nbsp;<span class="ident" id="3352892">wanted</span><span class="op" id="3352898">)</span><br>
<span class="lineno"></span><span class="op" id="3352900">}</span>
</div>
</body>
</html>
