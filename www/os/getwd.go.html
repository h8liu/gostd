<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2460344">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2460399">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2460453">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2460504">package</span>&nbsp;<span class="ident" id="2460512">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2460516">import</span>&nbsp;<span class="op" id="2460523">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2460526">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2460537">&#34;sync&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2460545">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2460555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2460558">var</span>&nbsp;<span class="ident" id="2460562">getwdCache</span>&nbsp;<span class="keyword" id="2460573">struct</span>&nbsp;<span class="op" id="2460580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2460583"><a href="/os/getwd.go.html#2460537">sync</a></span><span class="op" id="2460587">.</span><span class="ident" id="2460588">Mutex</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2460595">dir</span>&nbsp;<span class="builtintype" id="2460599">string</span><br>
<span class="lineno"></span><span class="op" id="2460606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2460609">//&nbsp;useSyscallwd&nbsp;determines&nbsp;whether&nbsp;to&nbsp;use&nbsp;the&nbsp;return&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2460671">//&nbsp;syscall.Getwd&nbsp;based&nbsp;on&nbsp;its&nbsp;error.</span><br>
<span class="lineno">20</span><span class="keyword" id="2460708">var</span>&nbsp;<span class="ident" id="2460712">useSyscallwd</span>&nbsp;<span class="op" id="2460725">=</span>&nbsp;<span class="keyword" id="2460727">func</span><span class="op" id="2460731">(</span><span class="builtintype" id="2460732">error</span><span class="op" id="2460737">)</span>&nbsp;<span class="builtintype" id="2460739">bool</span>&nbsp;<span class="op" id="2460744">{</span>&nbsp;<span class="keyword" id="2460746">return</span>&nbsp;<span class="builtintype" id="2460753">true</span>&nbsp;<span class="op" id="2460758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2460761">//&nbsp;Getwd&nbsp;returns&nbsp;a&nbsp;rooted&nbsp;path&nbsp;name&nbsp;corresponding&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2460818">//&nbsp;current&nbsp;directory.&nbsp;&nbsp;If&nbsp;the&nbsp;current&nbsp;directory&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2460873">//&nbsp;reached&nbsp;via&nbsp;multiple&nbsp;paths&nbsp;(due&nbsp;to&nbsp;symbolic&nbsp;links),</span><br>
<span class="lineno">25</span><span class="comment" id="2460928">//&nbsp;Getwd&nbsp;may&nbsp;return&nbsp;any&nbsp;one&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="2460965">func</span>&nbsp;<span class="ident" id="2460970">Getwd</span><span class="op" id="2460975">(</span><span class="op" id="2460976">)</span>&nbsp;<span class="op" id="2460978">(</span><span class="ident" id="2460979">dir</span>&nbsp;<span class="builtintype" id="2460983">string</span><span class="op" id="2460989">,</span>&nbsp;<span class="ident" id="2460991">err</span>&nbsp;<span class="builtintype" id="2460995">error</span><span class="op" id="2461000">)</span>&nbsp;<span class="op" id="2461002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461005">if</span>&nbsp;<span class="ident" id="2461008"><a href="/os/getwd.go.html#2460526">runtime</a></span><span class="op" id="2461015">.</span><span class="ident" id="2461016">GOOS</span>&nbsp;<span class="op" id="2461021">==</span>&nbsp;<span class="string" id="2461024">&#34;windows&#34;</span>&nbsp;<span class="op" id="2461034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461038">return</span>&nbsp;<span class="ident" id="2461045"><a href="/os/getwd.go.html#2460545">syscall</a></span><span class="op" id="2461052">.</span><span class="ident" id="2461053">Getwd</span><span class="op" id="2461058">(</span><span class="op" id="2461059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461062">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461066">//&nbsp;Clumsy&nbsp;but&nbsp;widespread&nbsp;kludge:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461100">//&nbsp;if&nbsp;$PWD&nbsp;is&nbsp;set&nbsp;and&nbsp;matches&nbsp;&#34;.&#34;,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461144">dot</span><span class="op" id="2461147">,</span>&nbsp;<span class="ident" id="2461149"><a href="/os/getwd.go.html#2460991">err</a></span>&nbsp;<span class="op" id="2461153">:=</span>&nbsp;<span class="ident" id="2461156"><a href="/os/file_unix.go.html#2454464">Stat</a></span><span class="op" id="2461160">(</span><span class="string" id="2461161">&#34;.&#34;</span><span class="op" id="2461164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461167">if</span>&nbsp;<span class="ident" id="2461170"><a href="/os/getwd.go.html#2460991">err</a></span>&nbsp;<span class="op" id="2461174">!=</span>&nbsp;<span class="ident" id="2461177">nil</span>&nbsp;<span class="op" id="2461181">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461185">return</span>&nbsp;<span class="string" id="2461192">&#34;&#34;</span><span class="op" id="2461194">,</span>&nbsp;<span class="ident" id="2461196"><a href="/os/getwd.go.html#2460991">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461204"><a href="/os/getwd.go.html#2460979">dir</a></span>&nbsp;<span class="op" id="2461208">=</span>&nbsp;<span class="ident" id="2461210"><a href="/os/env.go.html#2428668">Getenv</a></span><span class="op" id="2461216">(</span><span class="string" id="2461217">&#34;PWD&#34;</span><span class="op" id="2461222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461225">if</span>&nbsp;<span class="builtinfunc" id="2461228">len</span><span class="op" id="2461231">(</span><span class="ident" id="2461232"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461235">)</span>&nbsp;<span class="op" id="2461237">&gt;</span>&nbsp;<span class="num" id="2461239">0</span>&nbsp;<span class="op" id="2461241">&amp;&amp;</span>&nbsp;<span class="ident" id="2461244"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461247">[</span><span class="num" id="2461248">0</span><span class="op" id="2461249">]</span>&nbsp;<span class="op" id="2461251">==</span>&nbsp;<span class="string" id="2461254">&#39;/&#39;</span>&nbsp;<span class="op" id="2461258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461262">d</span><span class="op" id="2461263">,</span>&nbsp;<span class="ident" id="2461265">err</span>&nbsp;<span class="op" id="2461269">:=</span>&nbsp;<span class="ident" id="2461272"><a href="/os/file_unix.go.html#2454464">Stat</a></span><span class="op" id="2461276">(</span><span class="ident" id="2461277"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461280">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461284">if</span>&nbsp;<span class="ident" id="2461287"><a href="/os/getwd.go.html#2461265">err</a></span>&nbsp;<span class="op" id="2461291">==</span>&nbsp;<span class="ident" id="2461294">nil</span>&nbsp;<span class="op" id="2461298">&amp;&amp;</span>&nbsp;<span class="ident" id="2461301"><a href="/os/types.go.html#2474902">SameFile</a></span><span class="op" id="2461309">(</span><span class="ident" id="2461310"><a href="/os/getwd.go.html#2461144">dot</a></span><span class="op" id="2461313">,</span>&nbsp;<span class="ident" id="2461315"><a href="/os/getwd.go.html#2461262">d</a></span><span class="op" id="2461316">)</span>&nbsp;<span class="op" id="2461318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461323">return</span>&nbsp;<span class="ident" id="2461330"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461333">,</span>&nbsp;<span class="ident" id="2461335">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461348">//&nbsp;If&nbsp;the&nbsp;operating&nbsp;system&nbsp;provides&nbsp;a&nbsp;Getwd&nbsp;call,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461407">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;our&nbsp;way&nbsp;back&nbsp;to&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461464">if</span>&nbsp;<span class="ident" id="2461467"><a href="/os/getwd.go.html#2460545">syscall</a></span><span class="op" id="2461474">.</span><span class="ident" id="2461475">ImplementsGetwd</span>&nbsp;<span class="op" id="2461491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461495">s</span><span class="op" id="2461496">,</span>&nbsp;<span class="ident" id="2461498">e</span>&nbsp;<span class="op" id="2461500">:=</span>&nbsp;<span class="ident" id="2461503"><a href="/os/getwd.go.html#2460545">syscall</a></span><span class="op" id="2461510">.</span><span class="ident" id="2461511">Getwd</span><span class="op" id="2461516">(</span><span class="op" id="2461517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461521">if</span>&nbsp;<span class="ident" id="2461524"><a href="/os/getwd.go.html#2460712">useSyscallwd</a></span><span class="op" id="2461536">(</span><span class="ident" id="2461537"><a href="/os/getwd.go.html#2461498">e</a></span><span class="op" id="2461538">)</span>&nbsp;<span class="op" id="2461540">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461545">return</span>&nbsp;<span class="ident" id="2461552"><a href="/os/getwd.go.html#2461495">s</a></span><span class="op" id="2461553">,</span>&nbsp;<span class="ident" id="2461555"><a href="/os/error.go.html#2430425">NewSyscallError</a></span><span class="op" id="2461570">(</span><span class="string" id="2461571">&#34;getwd&#34;</span><span class="op" id="2461578">,</span>&nbsp;<span class="ident" id="2461580"><a href="/os/getwd.go.html#2461498">e</a></span><span class="op" id="2461581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461592">//&nbsp;Apply&nbsp;same&nbsp;kludge&nbsp;but&nbsp;to&nbsp;cached&nbsp;dir&nbsp;instead&nbsp;of&nbsp;$PWD.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461649"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2461659">.</span><span class="ident" id="2461660">Lock</span><span class="op" id="2461664">(</span><span class="op" id="2461665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461668"><a href="/os/getwd.go.html#2460979">dir</a></span>&nbsp;<span class="op" id="2461672">=</span>&nbsp;<span class="ident" id="2461674"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2461684">.</span><span class="ident" id="2461685">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461690"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2461700">.</span><span class="ident" id="2461701">Unlock</span><span class="op" id="2461707">(</span><span class="op" id="2461708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461711">if</span>&nbsp;<span class="builtinfunc" id="2461714">len</span><span class="op" id="2461717">(</span><span class="ident" id="2461718"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461721">)</span>&nbsp;<span class="op" id="2461723">&gt;</span>&nbsp;<span class="num" id="2461725">0</span>&nbsp;<span class="op" id="2461727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461731">d</span><span class="op" id="2461732">,</span>&nbsp;<span class="ident" id="2461734">err</span>&nbsp;<span class="op" id="2461738">:=</span>&nbsp;<span class="ident" id="2461741"><a href="/os/file_unix.go.html#2454464">Stat</a></span><span class="op" id="2461745">(</span><span class="ident" id="2461746"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461749">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461753">if</span>&nbsp;<span class="ident" id="2461756"><a href="/os/getwd.go.html#2461734">err</a></span>&nbsp;<span class="op" id="2461760">==</span>&nbsp;<span class="ident" id="2461763">nil</span>&nbsp;<span class="op" id="2461767">&amp;&amp;</span>&nbsp;<span class="ident" id="2461770"><a href="/os/types.go.html#2474902">SameFile</a></span><span class="op" id="2461778">(</span><span class="ident" id="2461779"><a href="/os/getwd.go.html#2461144">dot</a></span><span class="op" id="2461782">,</span>&nbsp;<span class="ident" id="2461784"><a href="/os/getwd.go.html#2461731">d</a></span><span class="op" id="2461785">)</span>&nbsp;<span class="op" id="2461787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461792">return</span>&nbsp;<span class="ident" id="2461799"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2461802">,</span>&nbsp;<span class="ident" id="2461804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461817">//&nbsp;Root&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;because&nbsp;it&nbsp;has&nbsp;no&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461869">//&nbsp;and&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2461894">root</span><span class="op" id="2461898">,</span>&nbsp;<span class="ident" id="2461900"><a href="/os/getwd.go.html#2460991">err</a></span>&nbsp;<span class="op" id="2461904">:=</span>&nbsp;<span class="ident" id="2461907"><a href="/os/file_unix.go.html#2454464">Stat</a></span><span class="op" id="2461911">(</span><span class="string" id="2461912">&#34;/&#34;</span><span class="op" id="2461915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461918">if</span>&nbsp;<span class="ident" id="2461921"><a href="/os/getwd.go.html#2460991">err</a></span>&nbsp;<span class="op" id="2461925">!=</span>&nbsp;<span class="ident" id="2461928">nil</span>&nbsp;<span class="op" id="2461932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2461936">//&nbsp;Can&#39;t&nbsp;stat&nbsp;root&nbsp;-&nbsp;no&nbsp;hope.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461968">return</span>&nbsp;<span class="string" id="2461975">&#34;&#34;</span><span class="op" id="2461977">,</span>&nbsp;<span class="ident" id="2461979"><a href="/os/getwd.go.html#2460991">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2461984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2461987">if</span>&nbsp;<span class="ident" id="2461990"><a href="/os/types.go.html#2474902">SameFile</a></span><span class="op" id="2461998">(</span><span class="ident" id="2461999"><a href="/os/getwd.go.html#2461894">root</a></span><span class="op" id="2462003">,</span>&nbsp;<span class="ident" id="2462005"><a href="/os/getwd.go.html#2461144">dot</a></span><span class="op" id="2462008">)</span>&nbsp;<span class="op" id="2462010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462014">return</span>&nbsp;<span class="string" id="2462021">&#34;/&#34;</span><span class="op" id="2462024">,</span>&nbsp;<span class="ident" id="2462026">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462031">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2462035">//&nbsp;General&nbsp;algorithm:&nbsp;find&nbsp;name&nbsp;in&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2462078">//&nbsp;and&nbsp;then&nbsp;find&nbsp;name&nbsp;of&nbsp;parent.&nbsp;&nbsp;Each&nbsp;iteration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2462128">//&nbsp;adds&nbsp;/name&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462168"><a href="/os/getwd.go.html#2460979">dir</a></span>&nbsp;<span class="op" id="2462172">=</span>&nbsp;<span class="string" id="2462174">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462178">for</span>&nbsp;<span class="ident" id="2462182">parent</span>&nbsp;<span class="op" id="2462189">:=</span>&nbsp;<span class="string" id="2462192">&#34;..&#34;</span><span class="op" id="2462196">;</span>&nbsp;<span class="op" id="2462198">;</span>&nbsp;<span class="ident" id="2462200"><a href="/os/getwd.go.html#2462182">parent</a></span>&nbsp;<span class="op" id="2462207">=</span>&nbsp;<span class="string" id="2462209">&#34;../&#34;</span>&nbsp;<span class="op" id="2462215">+</span>&nbsp;<span class="ident" id="2462217"><a href="/os/getwd.go.html#2462182">parent</a></span>&nbsp;<span class="op" id="2462224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462228">if</span>&nbsp;<span class="builtinfunc" id="2462231">len</span><span class="op" id="2462234">(</span><span class="ident" id="2462235"><a href="/os/getwd.go.html#2462182">parent</a></span><span class="op" id="2462241">)</span>&nbsp;<span class="op" id="2462243">&gt;=</span>&nbsp;<span class="num" id="2462246">1024</span>&nbsp;<span class="op" id="2462251">{</span>&nbsp;<span class="comment" id="2462253">//&nbsp;Sanity&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462272">return</span>&nbsp;<span class="string" id="2462279">&#34;&#34;</span><span class="op" id="2462281">,</span>&nbsp;<span class="ident" id="2462283"><a href="/os/getwd.go.html#2460545">syscall</a></span><span class="op" id="2462290">.</span><span class="ident" id="2462291">ENAMETOOLONG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462310">fd</span><span class="op" id="2462312">,</span>&nbsp;<span class="ident" id="2462314">err</span>&nbsp;<span class="op" id="2462318">:=</span>&nbsp;<span class="ident" id="2462321"><a href="/os/file.go.html#2445816">Open</a></span><span class="op" id="2462325">(</span><span class="ident" id="2462326"><a href="/os/getwd.go.html#2462182">parent</a></span><span class="op" id="2462332">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462336">if</span>&nbsp;<span class="ident" id="2462339"><a href="/os/getwd.go.html#2462314">err</a></span>&nbsp;<span class="op" id="2462343">!=</span>&nbsp;<span class="ident" id="2462346">nil</span>&nbsp;<span class="op" id="2462350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462355">return</span>&nbsp;<span class="string" id="2462362">&#34;&#34;</span><span class="op" id="2462364">,</span>&nbsp;<span class="ident" id="2462366"><a href="/os/getwd.go.html#2462314">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462377">for</span>&nbsp;<span class="op" id="2462381">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462386">names</span><span class="op" id="2462391">,</span>&nbsp;<span class="ident" id="2462393">err</span>&nbsp;<span class="op" id="2462397">:=</span>&nbsp;<span class="ident" id="2462400"><a href="/os/getwd.go.html#2462310">fd</a></span><span class="op" id="2462402">.</span><span class="ident" id="2462403">Readdirnames</span><span class="op" id="2462415">(</span><span class="num" id="2462416">100</span><span class="op" id="2462419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462424">if</span>&nbsp;<span class="ident" id="2462427"><a href="/os/getwd.go.html#2462393">err</a></span>&nbsp;<span class="op" id="2462431">!=</span>&nbsp;<span class="ident" id="2462434">nil</span>&nbsp;<span class="op" id="2462438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462444"><a href="/os/getwd.go.html#2462310">fd</a></span><span class="op" id="2462446">.</span><span class="ident" id="2462447">Close</span><span class="op" id="2462452">(</span><span class="op" id="2462453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462459">return</span>&nbsp;<span class="string" id="2462466">&#34;&#34;</span><span class="op" id="2462468">,</span>&nbsp;<span class="ident" id="2462470"><a href="/os/getwd.go.html#2462393">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462477">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462482">for</span>&nbsp;<span class="ident" id="2462486">_</span><span class="op" id="2462487">,</span>&nbsp;<span class="ident" id="2462489">name</span>&nbsp;<span class="op" id="2462494">:=</span>&nbsp;<span class="keyword" id="2462497">range</span>&nbsp;<span class="ident" id="2462503"><a href="/os/getwd.go.html#2462386">names</a></span>&nbsp;<span class="op" id="2462509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462515">d</span><span class="op" id="2462516">,</span>&nbsp;<span class="ident" id="2462518">_</span>&nbsp;<span class="op" id="2462520">:=</span>&nbsp;<span class="ident" id="2462523"><a href="/os/file_unix.go.html#2454926">Lstat</a></span><span class="op" id="2462528">(</span><span class="ident" id="2462529"><a href="/os/getwd.go.html#2462182">parent</a></span>&nbsp;<span class="op" id="2462536">+</span>&nbsp;<span class="string" id="2462538">&#34;/&#34;</span>&nbsp;<span class="op" id="2462542">+</span>&nbsp;<span class="ident" id="2462544"><a href="/os/getwd.go.html#2462489">name</a></span><span class="op" id="2462548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462554">if</span>&nbsp;<span class="ident" id="2462557"><a href="/os/types.go.html#2474902">SameFile</a></span><span class="op" id="2462565">(</span><span class="ident" id="2462566"><a href="/os/getwd.go.html#2462515">d</a></span><span class="op" id="2462567">,</span>&nbsp;<span class="ident" id="2462569"><a href="/os/getwd.go.html#2461144">dot</a></span><span class="op" id="2462572">)</span>&nbsp;<span class="op" id="2462574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462581"><a href="/os/getwd.go.html#2460979">dir</a></span>&nbsp;<span class="op" id="2462585">=</span>&nbsp;<span class="string" id="2462587">&#34;/&#34;</span>&nbsp;<span class="op" id="2462591">+</span>&nbsp;<span class="ident" id="2462593"><a href="/os/getwd.go.html#2462489">name</a></span>&nbsp;<span class="op" id="2462598">+</span>&nbsp;<span class="ident" id="2462600"><a href="/os/getwd.go.html#2460979">dir</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462609">goto</span>&nbsp;<span class="ident" id="2462614">Found</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462637">Found</span><span class="op" id="2462642">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462646">pd</span><span class="op" id="2462648">,</span>&nbsp;<span class="ident" id="2462650"><a href="/os/getwd.go.html#2462314">err</a></span>&nbsp;<span class="op" id="2462654">:=</span>&nbsp;<span class="ident" id="2462657"><a href="/os/getwd.go.html#2462310">fd</a></span><span class="op" id="2462659">.</span><span class="ident" id="2462660">Stat</span><span class="op" id="2462664">(</span><span class="op" id="2462665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462669">if</span>&nbsp;<span class="ident" id="2462672"><a href="/os/getwd.go.html#2462314">err</a></span>&nbsp;<span class="op" id="2462676">!=</span>&nbsp;<span class="ident" id="2462679">nil</span>&nbsp;<span class="op" id="2462683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462688">return</span>&nbsp;<span class="string" id="2462695">&#34;&#34;</span><span class="op" id="2462697">,</span>&nbsp;<span class="ident" id="2462699"><a href="/os/getwd.go.html#2462314">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462709"><a href="/os/getwd.go.html#2462310">fd</a></span><span class="op" id="2462711">.</span><span class="ident" id="2462712">Close</span><span class="op" id="2462717">(</span><span class="op" id="2462718">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462722">if</span>&nbsp;<span class="ident" id="2462725"><a href="/os/types.go.html#2474902">SameFile</a></span><span class="op" id="2462733">(</span><span class="ident" id="2462734"><a href="/os/getwd.go.html#2462646">pd</a></span><span class="op" id="2462736">,</span>&nbsp;<span class="ident" id="2462738"><a href="/os/getwd.go.html#2461894">root</a></span><span class="op" id="2462742">)</span>&nbsp;<span class="op" id="2462744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462749">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2462761">//&nbsp;Set&nbsp;up&nbsp;for&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462789"><a href="/os/getwd.go.html#2461144">dot</a></span>&nbsp;<span class="op" id="2462793">=</span>&nbsp;<span class="ident" id="2462795"><a href="/os/getwd.go.html#2462646">pd</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2462799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2462803">//&nbsp;Save&nbsp;answer&nbsp;as&nbsp;hint&nbsp;to&nbsp;avoid&nbsp;the&nbsp;expensive&nbsp;path&nbsp;next&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462866"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2462876">.</span><span class="ident" id="2462877">Lock</span><span class="op" id="2462881">(</span><span class="op" id="2462882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462885"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2462895">.</span><span class="ident" id="2462896">dir</span>&nbsp;<span class="op" id="2462900">=</span>&nbsp;<span class="ident" id="2462902"><a href="/os/getwd.go.html#2460979">dir</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2462907"><a href="/os/getwd.go.html#2460562">getwdCache</a></span><span class="op" id="2462917">.</span><span class="ident" id="2462918">Unlock</span><span class="op" id="2462924">(</span><span class="op" id="2462925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2462929">return</span>&nbsp;<span class="ident" id="2462936"><a href="/os/getwd.go.html#2460979">dir</a></span><span class="op" id="2462939">,</span>&nbsp;<span class="ident" id="2462941">nil</span><br>
<span class="lineno"></span><span class="op" id="2462945">}</span>
</div>
</body>
</html>
