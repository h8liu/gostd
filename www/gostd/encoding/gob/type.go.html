<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4501711">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4501766">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4501820">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4501871">package</span>&nbsp;<span class="ident" id="4501879">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4501884">import</span>&nbsp;<span class="op" id="4501891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501894">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501906">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501916">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501923">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501929">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501940">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501948">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501963">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4501974">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4501989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501992">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="4502074">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="4502153">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4502162">type</span>&nbsp;<span class="ident" id="4502167">userTypeInfo</span>&nbsp;<span class="keyword" id="4502180">struct</span>&nbsp;<span class="op" id="4502187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502190">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502202">reflect</span><span class="op" id="4502209">.</span><span class="ident" id="4502210">Type</span>&nbsp;<span class="comment" id="4502215">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502247">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502259">reflect</span><span class="op" id="4502266">.</span><span class="ident" id="4502267">Type</span>&nbsp;<span class="comment" id="4502272">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502313">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4502325">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502338">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502388">externalEnc</span>&nbsp;<span class="builtintype" id="4502400">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502413">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502441">externalDec</span>&nbsp;<span class="builtintype" id="4502453">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502466">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502493">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4502505">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502518">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502589">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4502601">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502614">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="4502684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502687">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="4502712">const</span>&nbsp;<span class="op" id="4502718">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502721">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502729">=</span>&nbsp;<span class="num" id="4502731">1</span>&nbsp;<span class="op" id="4502733">+</span>&nbsp;<span class="ident" id="4502735">iota</span>&nbsp;<span class="comment" id="4502740">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502769">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502788">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502847">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502866">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="4502920">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4502923">var</span>&nbsp;<span class="op" id="4502927">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502930">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502993">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503055">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="4503069">sync</span><span class="op" id="4503073">.</span><span class="ident" id="4503074">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503083">userTypeCache</span>&nbsp;<span class="op" id="4503097">=</span>&nbsp;<span class="builtinfunc" id="4503099">make</span><span class="op" id="4503103">(</span><span class="keyword" id="4503104">map</span><span class="op" id="4503107">[</span><span class="ident" id="4503108">reflect</span><span class="op" id="4503115">.</span><span class="ident" id="4503116">Type</span><span class="op" id="4503120">]</span><span class="op" id="4503121">*</span><span class="ident" id="4503122">userTypeInfo</span><span class="op" id="4503134">)</span><br>
<span class="lineno"></span><span class="op" id="4503136">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4503139">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4503227">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="4503317">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4503335">func</span>&nbsp;<span class="ident" id="4503340">validUserType</span><span class="op" id="4503353">(</span><span class="ident" id="4503354">rt</span>&nbsp;<span class="ident" id="4503357">reflect</span><span class="op" id="4503364">.</span><span class="ident" id="4503365">Type</span><span class="op" id="4503369">)</span>&nbsp;<span class="op" id="4503371">(</span><span class="ident" id="4503372">ut</span>&nbsp;<span class="op" id="4503375">*</span><span class="ident" id="4503376">userTypeInfo</span><span class="op" id="4503388">,</span>&nbsp;<span class="ident" id="4503390">err</span>&nbsp;<span class="builtintype" id="4503394">error</span><span class="op" id="4503399">)</span>&nbsp;<span class="op" id="4503401">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503404">userTypeLock</span><span class="op" id="4503416">.</span><span class="ident" id="4503417">RLock</span><span class="op" id="4503422">(</span><span class="op" id="4503423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503426">ut</span>&nbsp;<span class="op" id="4503429">=</span>&nbsp;<span class="ident" id="4503431">userTypeCache</span><span class="op" id="4503444">[</span><span class="ident" id="4503445">rt</span><span class="op" id="4503447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503450">userTypeLock</span><span class="op" id="4503462">.</span><span class="ident" id="4503463">RUnlock</span><span class="op" id="4503470">(</span><span class="op" id="4503471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503474">if</span>&nbsp;<span class="ident" id="4503477">ut</span>&nbsp;<span class="op" id="4503480">!=</span>&nbsp;<span class="ident" id="4503483">nil</span>&nbsp;<span class="op" id="4503487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503491">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503502">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503546">userTypeLock</span><span class="op" id="4503558">.</span><span class="ident" id="4503559">Lock</span><span class="op" id="4503563">(</span><span class="op" id="4503564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503567">defer</span>&nbsp;<span class="ident" id="4503573">userTypeLock</span><span class="op" id="4503585">.</span><span class="ident" id="4503586">Unlock</span><span class="op" id="4503592">(</span><span class="op" id="4503593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503596">if</span>&nbsp;<span class="ident" id="4503599">ut</span>&nbsp;<span class="op" id="4503602">=</span>&nbsp;<span class="ident" id="4503604">userTypeCache</span><span class="op" id="4503617">[</span><span class="ident" id="4503618">rt</span><span class="op" id="4503620">]</span><span class="op" id="4503621">;</span>&nbsp;<span class="ident" id="4503623">ut</span>&nbsp;<span class="op" id="4503626">!=</span>&nbsp;<span class="ident" id="4503629">nil</span>&nbsp;<span class="op" id="4503633">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503637">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503683">ut</span>&nbsp;<span class="op" id="4503686">=</span>&nbsp;<span class="builtinfunc" id="4503688">new</span><span class="op" id="4503691">(</span><span class="ident" id="4503692">userTypeInfo</span><span class="op" id="4503704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503707">ut</span><span class="op" id="4503709">.</span><span class="ident" id="4503710">base</span>&nbsp;<span class="op" id="4503715">=</span>&nbsp;<span class="ident" id="4503717">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503721">ut</span><span class="op" id="4503723">.</span><span class="ident" id="4503724">user</span>&nbsp;<span class="op" id="4503729">=</span>&nbsp;<span class="ident" id="4503731">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503735">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503806">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503875">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503943">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504013">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504063">slowpoke</span>&nbsp;<span class="op" id="4504072">:=</span>&nbsp;<span class="ident" id="4504075">ut</span><span class="op" id="4504077">.</span><span class="ident" id="4504078">base</span>&nbsp;<span class="comment" id="4504083">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504117">for</span>&nbsp;<span class="op" id="4504121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504125">pt</span>&nbsp;<span class="op" id="4504128">:=</span>&nbsp;<span class="ident" id="4504131">ut</span><span class="op" id="4504133">.</span><span class="ident" id="4504134">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504141">if</span>&nbsp;<span class="ident" id="4504144">pt</span><span class="op" id="4504146">.</span><span class="ident" id="4504147">Kind</span><span class="op" id="4504151">(</span><span class="op" id="4504152">)</span>&nbsp;<span class="op" id="4504154">!=</span>&nbsp;<span class="ident" id="4504157">reflect</span><span class="op" id="4504164">.</span><span class="ident" id="4504165">Ptr</span>&nbsp;<span class="op" id="4504169">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504186">ut</span><span class="op" id="4504188">.</span><span class="ident" id="4504189">base</span>&nbsp;<span class="op" id="4504194">=</span>&nbsp;<span class="ident" id="4504196">pt</span><span class="op" id="4504198">.</span><span class="ident" id="4504199">Elem</span><span class="op" id="4504203">(</span><span class="op" id="4504204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504208">if</span>&nbsp;<span class="ident" id="4504211">ut</span><span class="op" id="4504213">.</span><span class="ident" id="4504214">base</span>&nbsp;<span class="op" id="4504219">==</span>&nbsp;<span class="ident" id="4504222">slowpoke</span>&nbsp;<span class="op" id="4504231">{</span>&nbsp;<span class="comment" id="4504233">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504263">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504293">return</span>&nbsp;<span class="ident" id="4504300">nil</span><span class="op" id="4504303">,</span>&nbsp;<span class="ident" id="4504305">errors</span><span class="op" id="4504311">.</span><span class="ident" id="4504312">New</span><span class="op" id="4504315">(</span><span class="string" id="4504316">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4504358">+</span>&nbsp;<span class="ident" id="4504360">ut</span><span class="op" id="4504362">.</span><span class="ident" id="4504363">base</span><span class="op" id="4504367">.</span><span class="ident" id="4504368">String</span><span class="op" id="4504374">(</span><span class="op" id="4504375">)</span><span class="op" id="4504376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504384">if</span>&nbsp;<span class="ident" id="4504387">ut</span><span class="op" id="4504389">.</span><span class="ident" id="4504390">indir</span><span class="op" id="4504395">%</span><span class="num" id="4504396">2</span>&nbsp;<span class="op" id="4504398">==</span>&nbsp;<span class="num" id="4504401">0</span>&nbsp;<span class="op" id="4504403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504408">slowpoke</span>&nbsp;<span class="op" id="4504417">=</span>&nbsp;<span class="ident" id="4504419">slowpoke</span><span class="op" id="4504427">.</span><span class="ident" id="4504428">Elem</span><span class="op" id="4504432">(</span><span class="op" id="4504433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504437">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504441">ut</span><span class="op" id="4504443">.</span><span class="ident" id="4504444">indir</span><span class="op" id="4504449">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504457">if</span>&nbsp;<span class="ident" id="4504460">ok</span><span class="op" id="4504462">,</span>&nbsp;<span class="ident" id="4504464">indir</span>&nbsp;<span class="op" id="4504470">:=</span>&nbsp;<span class="ident" id="4504473">implementsInterface</span><span class="op" id="4504492">(</span><span class="ident" id="4504493">ut</span><span class="op" id="4504495">.</span><span class="ident" id="4504496">user</span><span class="op" id="4504500">,</span>&nbsp;<span class="ident" id="4504502">gobEncoderInterfaceType</span><span class="op" id="4504525">)</span><span class="op" id="4504526">;</span>&nbsp;<span class="ident" id="4504528">ok</span>&nbsp;<span class="op" id="4504531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504535">ut</span><span class="op" id="4504537">.</span><span class="ident" id="4504538">externalEnc</span><span class="op" id="4504549">,</span>&nbsp;<span class="ident" id="4504551">ut</span><span class="op" id="4504553">.</span><span class="ident" id="4504554">encIndir</span>&nbsp;<span class="op" id="4504563">=</span>&nbsp;<span class="ident" id="4504565">xGob</span><span class="op" id="4504569">,</span>&nbsp;<span class="ident" id="4504571">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504578">}</span>&nbsp;<span class="keyword" id="4504580">else</span>&nbsp;<span class="keyword" id="4504585">if</span>&nbsp;<span class="ident" id="4504588">ok</span><span class="op" id="4504590">,</span>&nbsp;<span class="ident" id="4504592">indir</span>&nbsp;<span class="op" id="4504598">:=</span>&nbsp;<span class="ident" id="4504601">implementsInterface</span><span class="op" id="4504620">(</span><span class="ident" id="4504621">ut</span><span class="op" id="4504623">.</span><span class="ident" id="4504624">user</span><span class="op" id="4504628">,</span>&nbsp;<span class="ident" id="4504630">binaryMarshalerInterfaceType</span><span class="op" id="4504658">)</span><span class="op" id="4504659">;</span>&nbsp;<span class="ident" id="4504661">ok</span>&nbsp;<span class="op" id="4504664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504668">ut</span><span class="op" id="4504670">.</span><span class="ident" id="4504671">externalEnc</span><span class="op" id="4504682">,</span>&nbsp;<span class="ident" id="4504684">ut</span><span class="op" id="4504686">.</span><span class="ident" id="4504687">encIndir</span>&nbsp;<span class="op" id="4504696">=</span>&nbsp;<span class="ident" id="4504698">xBinary</span><span class="op" id="4504705">,</span>&nbsp;<span class="ident" id="4504707">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504718">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504802">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504866">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505004">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505011">if</span>&nbsp;<span class="ident" id="4505014">ok</span><span class="op" id="4505016">,</span>&nbsp;<span class="ident" id="4505018">indir</span>&nbsp;<span class="op" id="4505024">:=</span>&nbsp;<span class="ident" id="4505027">implementsInterface</span><span class="op" id="4505046">(</span><span class="ident" id="4505047">ut</span><span class="op" id="4505049">.</span><span class="ident" id="4505050">user</span><span class="op" id="4505054">,</span>&nbsp;<span class="ident" id="4505056">gobDecoderInterfaceType</span><span class="op" id="4505079">)</span><span class="op" id="4505080">;</span>&nbsp;<span class="ident" id="4505082">ok</span>&nbsp;<span class="op" id="4505085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505089">ut</span><span class="op" id="4505091">.</span><span class="ident" id="4505092">externalDec</span><span class="op" id="4505103">,</span>&nbsp;<span class="ident" id="4505105">ut</span><span class="op" id="4505107">.</span><span class="ident" id="4505108">decIndir</span>&nbsp;<span class="op" id="4505117">=</span>&nbsp;<span class="ident" id="4505119">xGob</span><span class="op" id="4505123">,</span>&nbsp;<span class="ident" id="4505125">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505132">}</span>&nbsp;<span class="keyword" id="4505134">else</span>&nbsp;<span class="keyword" id="4505139">if</span>&nbsp;<span class="ident" id="4505142">ok</span><span class="op" id="4505144">,</span>&nbsp;<span class="ident" id="4505146">indir</span>&nbsp;<span class="op" id="4505152">:=</span>&nbsp;<span class="ident" id="4505155">implementsInterface</span><span class="op" id="4505174">(</span><span class="ident" id="4505175">ut</span><span class="op" id="4505177">.</span><span class="ident" id="4505178">user</span><span class="op" id="4505182">,</span>&nbsp;<span class="ident" id="4505184">binaryUnmarshalerInterfaceType</span><span class="op" id="4505214">)</span><span class="op" id="4505215">;</span>&nbsp;<span class="ident" id="4505217">ok</span>&nbsp;<span class="op" id="4505220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505224">ut</span><span class="op" id="4505226">.</span><span class="ident" id="4505227">externalDec</span><span class="op" id="4505238">,</span>&nbsp;<span class="ident" id="4505240">ut</span><span class="op" id="4505242">.</span><span class="ident" id="4505243">decIndir</span>&nbsp;<span class="op" id="4505252">=</span>&nbsp;<span class="ident" id="4505254">xBinary</span><span class="op" id="4505261">,</span>&nbsp;<span class="ident" id="4505263">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505270">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505274">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505294">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505386">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505434">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505441">userTypeCache</span><span class="op" id="4505454">[</span><span class="ident" id="4505455">rt</span><span class="op" id="4505457">]</span>&nbsp;<span class="op" id="4505459">=</span>&nbsp;<span class="ident" id="4505461">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505465">return</span><br>
<span class="lineno"></span><span class="op" id="4505472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4505475">var</span>&nbsp;<span class="op" id="4505479">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505482">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505513">=</span>&nbsp;<span class="ident" id="4505515">reflect</span><span class="op" id="4505522">.</span><span class="ident" id="4505523">TypeOf</span><span class="op" id="4505529">(</span><span class="op" id="4505530">(</span><span class="op" id="4505531">*</span><span class="ident" id="4505532">GobEncoder</span><span class="op" id="4505542">)</span><span class="op" id="4505543">(</span><span class="ident" id="4505544">nil</span><span class="op" id="4505547">)</span><span class="op" id="4505548">)</span><span class="op" id="4505549">.</span><span class="ident" id="4505550">Elem</span><span class="op" id="4505554">(</span><span class="op" id="4505555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505558">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505589">=</span>&nbsp;<span class="ident" id="4505591">reflect</span><span class="op" id="4505598">.</span><span class="ident" id="4505599">TypeOf</span><span class="op" id="4505605">(</span><span class="op" id="4505606">(</span><span class="op" id="4505607">*</span><span class="ident" id="4505608">GobDecoder</span><span class="op" id="4505618">)</span><span class="op" id="4505619">(</span><span class="ident" id="4505620">nil</span><span class="op" id="4505623">)</span><span class="op" id="4505624">)</span><span class="op" id="4505625">.</span><span class="ident" id="4505626">Elem</span><span class="op" id="4505630">(</span><span class="op" id="4505631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505634">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4505665">=</span>&nbsp;<span class="ident" id="4505667">reflect</span><span class="op" id="4505674">.</span><span class="ident" id="4505675">TypeOf</span><span class="op" id="4505681">(</span><span class="op" id="4505682">(</span><span class="op" id="4505683">*</span><span class="ident" id="4505684">encoding</span><span class="op" id="4505692">.</span><span class="ident" id="4505693">BinaryMarshaler</span><span class="op" id="4505708">)</span><span class="op" id="4505709">(</span><span class="ident" id="4505710">nil</span><span class="op" id="4505713">)</span><span class="op" id="4505714">)</span><span class="op" id="4505715">.</span><span class="ident" id="4505716">Elem</span><span class="op" id="4505720">(</span><span class="op" id="4505721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505724">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="4505755">=</span>&nbsp;<span class="ident" id="4505757">reflect</span><span class="op" id="4505764">.</span><span class="ident" id="4505765">TypeOf</span><span class="op" id="4505771">(</span><span class="op" id="4505772">(</span><span class="op" id="4505773">*</span><span class="ident" id="4505774">encoding</span><span class="op" id="4505782">.</span><span class="ident" id="4505783">BinaryUnmarshaler</span><span class="op" id="4505800">)</span><span class="op" id="4505801">(</span><span class="ident" id="4505802">nil</span><span class="op" id="4505805">)</span><span class="op" id="4505806">)</span><span class="op" id="4505807">.</span><span class="ident" id="4505808">Elem</span><span class="op" id="4505812">(</span><span class="op" id="4505813">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505816">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505847">=</span>&nbsp;<span class="ident" id="4505849">reflect</span><span class="op" id="4505856">.</span><span class="ident" id="4505857">TypeOf</span><span class="op" id="4505863">(</span><span class="op" id="4505864">(</span><span class="op" id="4505865">*</span><span class="ident" id="4505866">encoding</span><span class="op" id="4505874">.</span><span class="ident" id="4505875">TextMarshaler</span><span class="op" id="4505888">)</span><span class="op" id="4505889">(</span><span class="ident" id="4505890">nil</span><span class="op" id="4505893">)</span><span class="op" id="4505894">)</span><span class="op" id="4505895">.</span><span class="ident" id="4505896">Elem</span><span class="op" id="4505900">(</span><span class="op" id="4505901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505904">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4505935">=</span>&nbsp;<span class="ident" id="4505937">reflect</span><span class="op" id="4505944">.</span><span class="ident" id="4505945">TypeOf</span><span class="op" id="4505951">(</span><span class="op" id="4505952">(</span><span class="op" id="4505953">*</span><span class="ident" id="4505954">encoding</span><span class="op" id="4505962">.</span><span class="ident" id="4505963">TextUnmarshaler</span><span class="op" id="4505978">)</span><span class="op" id="4505979">(</span><span class="ident" id="4505980">nil</span><span class="op" id="4505983">)</span><span class="op" id="4505984">)</span><span class="op" id="4505985">.</span><span class="ident" id="4505986">Elem</span><span class="op" id="4505990">(</span><span class="op" id="4505991">)</span><br>
<span class="lineno"></span><span class="op" id="4505993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4505996">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="4506059">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4506095">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4506164">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="4506183">func</span>&nbsp;<span class="ident" id="4506188">implementsInterface</span><span class="op" id="4506207">(</span><span class="ident" id="4506208">typ</span><span class="op" id="4506211">,</span>&nbsp;<span class="ident" id="4506213">gobEncDecType</span>&nbsp;<span class="ident" id="4506227">reflect</span><span class="op" id="4506234">.</span><span class="ident" id="4506235">Type</span><span class="op" id="4506239">)</span>&nbsp;<span class="op" id="4506241">(</span><span class="ident" id="4506242">success</span>&nbsp;<span class="builtintype" id="4506250">bool</span><span class="op" id="4506254">,</span>&nbsp;<span class="ident" id="4506256">indir</span>&nbsp;<span class="builtintype" id="4506262">int8</span><span class="op" id="4506266">)</span>&nbsp;<span class="op" id="4506268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506271">if</span>&nbsp;<span class="ident" id="4506274">typ</span>&nbsp;<span class="op" id="4506278">==</span>&nbsp;<span class="ident" id="4506281">nil</span>&nbsp;<span class="op" id="4506285">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506289">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506300">rt</span>&nbsp;<span class="op" id="4506303">:=</span>&nbsp;<span class="ident" id="4506306">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506311">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506363">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506431">for</span>&nbsp;<span class="op" id="4506435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506439">if</span>&nbsp;<span class="ident" id="4506442">rt</span><span class="op" id="4506444">.</span><span class="ident" id="4506445">Implements</span><span class="op" id="4506455">(</span><span class="ident" id="4506456">gobEncDecType</span><span class="op" id="4506469">)</span>&nbsp;<span class="op" id="4506471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506476">return</span>&nbsp;<span class="builtintype" id="4506483">true</span><span class="op" id="4506487">,</span>&nbsp;<span class="ident" id="4506489">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506501">if</span>&nbsp;<span class="ident" id="4506504">p</span>&nbsp;<span class="op" id="4506506">:=</span>&nbsp;<span class="ident" id="4506509">rt</span><span class="op" id="4506511">;</span>&nbsp;<span class="ident" id="4506513">p</span><span class="op" id="4506514">.</span><span class="ident" id="4506515">Kind</span><span class="op" id="4506519">(</span><span class="op" id="4506520">)</span>&nbsp;<span class="op" id="4506522">==</span>&nbsp;<span class="ident" id="4506525">reflect</span><span class="op" id="4506532">.</span><span class="ident" id="4506533">Ptr</span>&nbsp;<span class="op" id="4506537">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506542">indir</span><span class="op" id="4506547">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506553">if</span>&nbsp;<span class="ident" id="4506556">indir</span>&nbsp;<span class="op" id="4506562">&gt;</span>&nbsp;<span class="num" id="4506564">100</span>&nbsp;<span class="op" id="4506568">{</span>&nbsp;<span class="comment" id="4506570">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506607">return</span>&nbsp;<span class="builtintype" id="4506614">false</span><span class="op" id="4506619">,</span>&nbsp;<span class="num" id="4506621">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506631">rt</span>&nbsp;<span class="op" id="4506634">=</span>&nbsp;<span class="ident" id="4506636">p</span><span class="op" id="4506637">.</span><span class="ident" id="4506638">Elem</span><span class="op" id="4506642">(</span><span class="op" id="4506643">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506648">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506663">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506673">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506759">if</span>&nbsp;<span class="ident" id="4506762">typ</span><span class="op" id="4506765">.</span><span class="ident" id="4506766">Kind</span><span class="op" id="4506770">(</span><span class="op" id="4506771">)</span>&nbsp;<span class="op" id="4506773">!=</span>&nbsp;<span class="ident" id="4506776">reflect</span><span class="op" id="4506783">.</span><span class="ident" id="4506784">Ptr</span>&nbsp;<span class="op" id="4506788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506792">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506839">if</span>&nbsp;<span class="ident" id="4506842">reflect</span><span class="op" id="4506849">.</span><span class="ident" id="4506850">PtrTo</span><span class="op" id="4506855">(</span><span class="ident" id="4506856">typ</span><span class="op" id="4506859">)</span><span class="op" id="4506860">.</span><span class="ident" id="4506861">Implements</span><span class="op" id="4506871">(</span><span class="ident" id="4506872">gobEncDecType</span><span class="op" id="4506885">)</span>&nbsp;<span class="op" id="4506887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506892">return</span>&nbsp;<span class="builtintype" id="4506899">true</span><span class="op" id="4506903">,</span>&nbsp;<span class="op" id="4506905">-</span><span class="num" id="4506906">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506910">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506916">return</span>&nbsp;<span class="builtintype" id="4506923">false</span><span class="op" id="4506928">,</span>&nbsp;<span class="num" id="4506930">0</span><br>
<span class="lineno"></span><span class="op" id="4506932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4506935">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="4507022">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4507072">func</span>&nbsp;<span class="ident" id="4507077">userType</span><span class="op" id="4507085">(</span><span class="ident" id="4507086">rt</span>&nbsp;<span class="ident" id="4507089">reflect</span><span class="op" id="4507096">.</span><span class="ident" id="4507097">Type</span><span class="op" id="4507101">)</span>&nbsp;<span class="op" id="4507103">*</span><span class="ident" id="4507104">userTypeInfo</span>&nbsp;<span class="op" id="4507117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507120">ut</span><span class="op" id="4507122">,</span>&nbsp;<span class="ident" id="4507124">err</span>&nbsp;<span class="op" id="4507128">:=</span>&nbsp;<span class="ident" id="4507131">validUserType</span><span class="op" id="4507144">(</span><span class="ident" id="4507145">rt</span><span class="op" id="4507147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507150">if</span>&nbsp;<span class="ident" id="4507153">err</span>&nbsp;<span class="op" id="4507157">!=</span>&nbsp;<span class="ident" id="4507160">nil</span>&nbsp;<span class="op" id="4507164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507168">error_</span><span class="op" id="4507174">(</span><span class="ident" id="4507175">err</span><span class="op" id="4507178">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507184">return</span>&nbsp;<span class="ident" id="4507191">ut</span><br>
<span class="lineno"></span><span class="op" id="4507194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507197">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="4507277">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="4507363">type</span>&nbsp;<span class="ident" id="4507368">typeId</span>&nbsp;<span class="builtintype" id="4507375">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4507382">var</span>&nbsp;<span class="ident" id="4507386">nextId</span>&nbsp;<span class="ident" id="4507393">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4507406">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="4507448">var</span>&nbsp;<span class="ident" id="4507452">typeLock</span>&nbsp;<span class="ident" id="4507461">sync</span><span class="op" id="4507465">.</span><span class="ident" id="4507466">Mutex</span>&nbsp;<span class="comment" id="4507472">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="4507501">const</span>&nbsp;<span class="ident" id="4507507">firstUserId</span>&nbsp;<span class="op" id="4507519">=</span>&nbsp;<span class="num" id="4507521">64</span>&nbsp;&nbsp;<span class="comment" id="4507525">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4507562">type</span>&nbsp;<span class="ident" id="4507567">gobType</span>&nbsp;<span class="keyword" id="4507575">interface</span>&nbsp;<span class="op" id="4507585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507588">id</span><span class="op" id="4507590">(</span><span class="op" id="4507591">)</span>&nbsp;<span class="ident" id="4507593">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507601">setId</span><span class="op" id="4507606">(</span><span class="ident" id="4507607">id</span>&nbsp;<span class="ident" id="4507610">typeId</span><span class="op" id="4507616">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507619">name</span><span class="op" id="4507623">(</span><span class="op" id="4507624">)</span>&nbsp;<span class="builtintype" id="4507626">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4507634">string</span><span class="op" id="4507640">(</span><span class="op" id="4507641">)</span>&nbsp;<span class="builtintype" id="4507643">string</span>&nbsp;<span class="comment" id="4507650">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507685">safeString</span><span class="op" id="4507695">(</span><span class="ident" id="4507696">seen</span>&nbsp;<span class="keyword" id="4507701">map</span><span class="op" id="4507704">[</span><span class="ident" id="4507705">typeId</span><span class="op" id="4507711">]</span><span class="builtintype" id="4507712">bool</span><span class="op" id="4507716">)</span>&nbsp;<span class="builtintype" id="4507718">string</span><br>
<span class="lineno"></span><span class="op" id="4507725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4507728">var</span>&nbsp;<span class="ident" id="4507732">types</span>&nbsp;<span class="op" id="4507738">=</span>&nbsp;<span class="builtinfunc" id="4507740">make</span><span class="op" id="4507744">(</span><span class="keyword" id="4507745">map</span><span class="op" id="4507748">[</span><span class="ident" id="4507749">reflect</span><span class="op" id="4507756">.</span><span class="ident" id="4507757">Type</span><span class="op" id="4507761">]</span><span class="ident" id="4507762">gobType</span><span class="op" id="4507769">)</span><br>
<span class="lineno"></span><span class="keyword" id="4507771">var</span>&nbsp;<span class="ident" id="4507775">idToType</span>&nbsp;<span class="op" id="4507784">=</span>&nbsp;<span class="builtinfunc" id="4507786">make</span><span class="op" id="4507790">(</span><span class="keyword" id="4507791">map</span><span class="op" id="4507794">[</span><span class="ident" id="4507795">typeId</span><span class="op" id="4507801">]</span><span class="ident" id="4507802">gobType</span><span class="op" id="4507809">)</span><br>
<span class="lineno"></span><span class="keyword" id="4507811">var</span>&nbsp;<span class="ident" id="4507815">builtinIdToType</span>&nbsp;<span class="keyword" id="4507831">map</span><span class="op" id="4507834">[</span><span class="ident" id="4507835">typeId</span><span class="op" id="4507841">]</span><span class="ident" id="4507842">gobType</span>&nbsp;<span class="comment" id="4507850">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4507899">func</span>&nbsp;<span class="ident" id="4507904">setTypeId</span><span class="op" id="4507913">(</span><span class="ident" id="4507914">typ</span>&nbsp;<span class="ident" id="4507918">gobType</span><span class="op" id="4507925">)</span>&nbsp;<span class="op" id="4507927">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507930">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507998">if</span>&nbsp;<span class="ident" id="4508001">typ</span><span class="op" id="4508004">.</span><span class="ident" id="4508005">id</span><span class="op" id="4508007">(</span><span class="op" id="4508008">)</span>&nbsp;<span class="op" id="4508010">!=</span>&nbsp;<span class="num" id="4508013">0</span>&nbsp;<span class="op" id="4508015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508019">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508030">nextId</span><span class="op" id="4508036">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508040">typ</span><span class="op" id="4508043">.</span><span class="ident" id="4508044">setId</span><span class="op" id="4508049">(</span><span class="ident" id="4508050">nextId</span><span class="op" id="4508056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508059">idToType</span><span class="op" id="4508067">[</span><span class="ident" id="4508068">nextId</span><span class="op" id="4508074">]</span>&nbsp;<span class="op" id="4508076">=</span>&nbsp;<span class="ident" id="4508078">typ</span><br>
<span class="lineno"></span><span class="op" id="4508082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4508085">func</span>&nbsp;<span class="op" id="4508090">(</span><span class="ident" id="4508091">t</span>&nbsp;<span class="ident" id="4508093">typeId</span><span class="op" id="4508099">)</span>&nbsp;<span class="ident" id="4508101">gobType</span><span class="op" id="4508108">(</span><span class="op" id="4508109">)</span>&nbsp;<span class="ident" id="4508111">gobType</span>&nbsp;<span class="op" id="4508119">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508122">if</span>&nbsp;<span class="ident" id="4508125">t</span>&nbsp;<span class="op" id="4508127">==</span>&nbsp;<span class="num" id="4508130">0</span>&nbsp;<span class="op" id="4508132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508136">return</span>&nbsp;<span class="ident" id="4508143">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508151">return</span>&nbsp;<span class="ident" id="4508158">idToType</span><span class="op" id="4508166">[</span><span class="ident" id="4508167">t</span><span class="op" id="4508168">]</span><br>
<span class="lineno"></span><span class="op" id="4508170">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4508173">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="4508257">func</span>&nbsp;<span class="op" id="4508262">(</span><span class="ident" id="4508263">t</span>&nbsp;<span class="ident" id="4508265">typeId</span><span class="op" id="4508271">)</span>&nbsp;<span class="builtintype" id="4508273">string</span><span class="op" id="4508279">(</span><span class="op" id="4508280">)</span>&nbsp;<span class="builtintype" id="4508282">string</span>&nbsp;<span class="op" id="4508289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508292">if</span>&nbsp;<span class="ident" id="4508295">t</span><span class="op" id="4508296">.</span><span class="ident" id="4508297">gobType</span><span class="op" id="4508304">(</span><span class="op" id="4508305">)</span>&nbsp;<span class="op" id="4508307">==</span>&nbsp;<span class="ident" id="4508310">nil</span>&nbsp;<span class="op" id="4508314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508318">return</span>&nbsp;<span class="string" id="4508325">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508337">return</span>&nbsp;<span class="ident" id="4508344">t</span><span class="op" id="4508345">.</span><span class="ident" id="4508346">gobType</span><span class="op" id="4508353">(</span><span class="op" id="4508354">)</span><span class="op" id="4508355">.</span><span class="builtintype" id="4508356">string</span><span class="op" id="4508362">(</span><span class="op" id="4508363">)</span><br>
<span class="lineno"></span><span class="op" id="4508365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508368">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="4508433">func</span>&nbsp;<span class="op" id="4508438">(</span><span class="ident" id="4508439">t</span>&nbsp;<span class="ident" id="4508441">typeId</span><span class="op" id="4508447">)</span>&nbsp;<span class="ident" id="4508449">name</span><span class="op" id="4508453">(</span><span class="op" id="4508454">)</span>&nbsp;<span class="builtintype" id="4508456">string</span>&nbsp;<span class="op" id="4508463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508466">if</span>&nbsp;<span class="ident" id="4508469">t</span><span class="op" id="4508470">.</span><span class="ident" id="4508471">gobType</span><span class="op" id="4508478">(</span><span class="op" id="4508479">)</span>&nbsp;<span class="op" id="4508481">==</span>&nbsp;<span class="ident" id="4508484">nil</span>&nbsp;<span class="op" id="4508488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508492">return</span>&nbsp;<span class="string" id="4508499">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508511">return</span>&nbsp;<span class="ident" id="4508518">t</span><span class="op" id="4508519">.</span><span class="ident" id="4508520">gobType</span><span class="op" id="4508527">(</span><span class="op" id="4508528">)</span><span class="op" id="4508529">.</span><span class="ident" id="4508530">name</span><span class="op" id="4508534">(</span><span class="op" id="4508535">)</span><br>
<span class="lineno">220</span><span class="op" id="4508537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508540">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="4508583">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4508658">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="4508735">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4508778">type</span>&nbsp;<span class="ident" id="4508783">CommonType</span>&nbsp;<span class="keyword" id="4508794">struct</span>&nbsp;<span class="op" id="4508801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508804">Name</span>&nbsp;<span class="builtintype" id="4508809">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508817">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4508822">typeId</span><br>
<span class="lineno"></span><span class="op" id="4508829">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4508832">func</span>&nbsp;<span class="op" id="4508837">(</span><span class="ident" id="4508838">t</span>&nbsp;<span class="op" id="4508840">*</span><span class="ident" id="4508841">CommonType</span><span class="op" id="4508851">)</span>&nbsp;<span class="ident" id="4508853">id</span><span class="op" id="4508855">(</span><span class="op" id="4508856">)</span>&nbsp;<span class="ident" id="4508858">typeId</span>&nbsp;<span class="op" id="4508865">{</span>&nbsp;<span class="keyword" id="4508867">return</span>&nbsp;<span class="ident" id="4508874">t</span><span class="op" id="4508875">.</span><span class="ident" id="4508876">Id</span>&nbsp;<span class="op" id="4508879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4508882">func</span>&nbsp;<span class="op" id="4508887">(</span><span class="ident" id="4508888">t</span>&nbsp;<span class="op" id="4508890">*</span><span class="ident" id="4508891">CommonType</span><span class="op" id="4508901">)</span>&nbsp;<span class="ident" id="4508903">setId</span><span class="op" id="4508908">(</span><span class="ident" id="4508909">id</span>&nbsp;<span class="ident" id="4508912">typeId</span><span class="op" id="4508918">)</span>&nbsp;<span class="op" id="4508920">{</span>&nbsp;<span class="ident" id="4508922">t</span><span class="op" id="4508923">.</span><span class="ident" id="4508924">Id</span>&nbsp;<span class="op" id="4508927">=</span>&nbsp;<span class="ident" id="4508929">id</span>&nbsp;<span class="op" id="4508932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4508935">func</span>&nbsp;<span class="op" id="4508940">(</span><span class="ident" id="4508941">t</span>&nbsp;<span class="op" id="4508943">*</span><span class="ident" id="4508944">CommonType</span><span class="op" id="4508954">)</span>&nbsp;<span class="builtintype" id="4508956">string</span><span class="op" id="4508962">(</span><span class="op" id="4508963">)</span>&nbsp;<span class="builtintype" id="4508965">string</span>&nbsp;<span class="op" id="4508972">{</span>&nbsp;<span class="keyword" id="4508974">return</span>&nbsp;<span class="ident" id="4508981">t</span><span class="op" id="4508982">.</span><span class="ident" id="4508983">Name</span>&nbsp;<span class="op" id="4508988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4508991">func</span>&nbsp;<span class="op" id="4508996">(</span><span class="ident" id="4508997">t</span>&nbsp;<span class="op" id="4508999">*</span><span class="ident" id="4509000">CommonType</span><span class="op" id="4509010">)</span>&nbsp;<span class="ident" id="4509012">safeString</span><span class="op" id="4509022">(</span><span class="ident" id="4509023">seen</span>&nbsp;<span class="keyword" id="4509028">map</span><span class="op" id="4509031">[</span><span class="ident" id="4509032">typeId</span><span class="op" id="4509038">]</span><span class="builtintype" id="4509039">bool</span><span class="op" id="4509043">)</span>&nbsp;<span class="builtintype" id="4509045">string</span>&nbsp;<span class="op" id="4509052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509055">return</span>&nbsp;<span class="ident" id="4509062">t</span><span class="op" id="4509063">.</span><span class="ident" id="4509064">Name</span><br>
<span class="lineno"></span><span class="op" id="4509069">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4509072">func</span>&nbsp;<span class="op" id="4509077">(</span><span class="ident" id="4509078">t</span>&nbsp;<span class="op" id="4509080">*</span><span class="ident" id="4509081">CommonType</span><span class="op" id="4509091">)</span>&nbsp;<span class="ident" id="4509093">name</span><span class="op" id="4509097">(</span><span class="op" id="4509098">)</span>&nbsp;<span class="builtintype" id="4509100">string</span>&nbsp;<span class="op" id="4509107">{</span>&nbsp;<span class="keyword" id="4509109">return</span>&nbsp;<span class="ident" id="4509116">t</span><span class="op" id="4509117">.</span><span class="ident" id="4509118">Name</span>&nbsp;<span class="op" id="4509123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509126">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="4509163">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4509241">var</span>&nbsp;<span class="op" id="4509245">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509248">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509300">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509354">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509405">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509416">=</span>&nbsp;<span class="ident" id="4509418">bootstrapType</span><span class="op" id="4509431">(</span><span class="string" id="4509432">&#34;bool&#34;</span><span class="op" id="4509438">,</span>&nbsp;<span class="op" id="4509440">(</span><span class="op" id="4509441">*</span><span class="builtintype" id="4509442">bool</span><span class="op" id="4509446">)</span><span class="op" id="4509447">(</span><span class="ident" id="4509448">nil</span><span class="op" id="4509451">)</span><span class="op" id="4509452">,</span>&nbsp;<span class="num" id="4509454">1</span><span class="op" id="4509455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509458">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509469">=</span>&nbsp;<span class="ident" id="4509471">bootstrapType</span><span class="op" id="4509484">(</span><span class="string" id="4509485">&#34;int&#34;</span><span class="op" id="4509490">,</span>&nbsp;<span class="op" id="4509492">(</span><span class="op" id="4509493">*</span><span class="builtintype" id="4509494">int</span><span class="op" id="4509497">)</span><span class="op" id="4509498">(</span><span class="ident" id="4509499">nil</span><span class="op" id="4509502">)</span><span class="op" id="4509503">,</span>&nbsp;<span class="num" id="4509505">2</span><span class="op" id="4509506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509509">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509520">=</span>&nbsp;<span class="ident" id="4509522">bootstrapType</span><span class="op" id="4509535">(</span><span class="string" id="4509536">&#34;uint&#34;</span><span class="op" id="4509542">,</span>&nbsp;<span class="op" id="4509544">(</span><span class="op" id="4509545">*</span><span class="builtintype" id="4509546">uint</span><span class="op" id="4509550">)</span><span class="op" id="4509551">(</span><span class="ident" id="4509552">nil</span><span class="op" id="4509555">)</span><span class="op" id="4509556">,</span>&nbsp;<span class="num" id="4509558">3</span><span class="op" id="4509559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509562">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509573">=</span>&nbsp;<span class="ident" id="4509575">bootstrapType</span><span class="op" id="4509588">(</span><span class="string" id="4509589">&#34;float&#34;</span><span class="op" id="4509596">,</span>&nbsp;<span class="op" id="4509598">(</span><span class="op" id="4509599">*</span><span class="builtintype" id="4509600">float64</span><span class="op" id="4509607">)</span><span class="op" id="4509608">(</span><span class="ident" id="4509609">nil</span><span class="op" id="4509612">)</span><span class="op" id="4509613">,</span>&nbsp;<span class="num" id="4509615">4</span><span class="op" id="4509616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509619">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509630">=</span>&nbsp;<span class="ident" id="4509632">bootstrapType</span><span class="op" id="4509645">(</span><span class="string" id="4509646">&#34;bytes&#34;</span><span class="op" id="4509653">,</span>&nbsp;<span class="op" id="4509655">(</span><span class="op" id="4509656">*</span><span class="op" id="4509657">[</span><span class="op" id="4509658">]</span><span class="builtintype" id="4509659">byte</span><span class="op" id="4509663">)</span><span class="op" id="4509664">(</span><span class="ident" id="4509665">nil</span><span class="op" id="4509668">)</span><span class="op" id="4509669">,</span>&nbsp;<span class="num" id="4509671">5</span><span class="op" id="4509672">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509675">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509686">=</span>&nbsp;<span class="ident" id="4509688">bootstrapType</span><span class="op" id="4509701">(</span><span class="string" id="4509702">&#34;string&#34;</span><span class="op" id="4509710">,</span>&nbsp;<span class="op" id="4509712">(</span><span class="op" id="4509713">*</span><span class="builtintype" id="4509714">string</span><span class="op" id="4509720">)</span><span class="op" id="4509721">(</span><span class="ident" id="4509722">nil</span><span class="op" id="4509725">)</span><span class="op" id="4509726">,</span>&nbsp;<span class="num" id="4509728">6</span><span class="op" id="4509729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509732">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4509743">=</span>&nbsp;<span class="ident" id="4509745">bootstrapType</span><span class="op" id="4509758">(</span><span class="string" id="4509759">&#34;complex&#34;</span><span class="op" id="4509768">,</span>&nbsp;<span class="op" id="4509770">(</span><span class="op" id="4509771">*</span><span class="builtintype" id="4509772">complex128</span><span class="op" id="4509782">)</span><span class="op" id="4509783">(</span><span class="ident" id="4509784">nil</span><span class="op" id="4509787">)</span><span class="op" id="4509788">,</span>&nbsp;<span class="num" id="4509790">7</span><span class="op" id="4509791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509794">tInterface</span>&nbsp;<span class="op" id="4509805">=</span>&nbsp;<span class="ident" id="4509807">bootstrapType</span><span class="op" id="4509820">(</span><span class="string" id="4509821">&#34;interface&#34;</span><span class="op" id="4509832">,</span>&nbsp;<span class="op" id="4509834">(</span><span class="op" id="4509835">*</span><span class="keyword" id="4509836">interface</span><span class="op" id="4509845">{</span><span class="op" id="4509846">}</span><span class="op" id="4509847">)</span><span class="op" id="4509848">(</span><span class="ident" id="4509849">nil</span><span class="op" id="4509852">)</span><span class="op" id="4509853">,</span>&nbsp;<span class="num" id="4509855">8</span><span class="op" id="4509856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509859">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509905">tReserved7</span>&nbsp;<span class="op" id="4509916">=</span>&nbsp;<span class="ident" id="4509918">bootstrapType</span><span class="op" id="4509931">(</span><span class="string" id="4509932">&#34;_reserved1&#34;</span><span class="op" id="4509944">,</span>&nbsp;<span class="op" id="4509946">(</span><span class="op" id="4509947">*</span><span class="keyword" id="4509948">struct</span><span class="op" id="4509954">{</span>&nbsp;<span class="ident" id="4509956">r7</span>&nbsp;<span class="builtintype" id="4509959">int</span>&nbsp;<span class="op" id="4509963">}</span><span class="op" id="4509964">)</span><span class="op" id="4509965">(</span><span class="ident" id="4509966">nil</span><span class="op" id="4509969">)</span><span class="op" id="4509970">,</span>&nbsp;<span class="num" id="4509972">9</span><span class="op" id="4509973">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509976">tReserved6</span>&nbsp;<span class="op" id="4509987">=</span>&nbsp;<span class="ident" id="4509989">bootstrapType</span><span class="op" id="4510002">(</span><span class="string" id="4510003">&#34;_reserved1&#34;</span><span class="op" id="4510015">,</span>&nbsp;<span class="op" id="4510017">(</span><span class="op" id="4510018">*</span><span class="keyword" id="4510019">struct</span><span class="op" id="4510025">{</span>&nbsp;<span class="ident" id="4510027">r6</span>&nbsp;<span class="builtintype" id="4510030">int</span>&nbsp;<span class="op" id="4510034">}</span><span class="op" id="4510035">)</span><span class="op" id="4510036">(</span><span class="ident" id="4510037">nil</span><span class="op" id="4510040">)</span><span class="op" id="4510041">,</span>&nbsp;<span class="num" id="4510043">10</span><span class="op" id="4510045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510048">tReserved5</span>&nbsp;<span class="op" id="4510059">=</span>&nbsp;<span class="ident" id="4510061">bootstrapType</span><span class="op" id="4510074">(</span><span class="string" id="4510075">&#34;_reserved1&#34;</span><span class="op" id="4510087">,</span>&nbsp;<span class="op" id="4510089">(</span><span class="op" id="4510090">*</span><span class="keyword" id="4510091">struct</span><span class="op" id="4510097">{</span>&nbsp;<span class="ident" id="4510099">r5</span>&nbsp;<span class="builtintype" id="4510102">int</span>&nbsp;<span class="op" id="4510106">}</span><span class="op" id="4510107">)</span><span class="op" id="4510108">(</span><span class="ident" id="4510109">nil</span><span class="op" id="4510112">)</span><span class="op" id="4510113">,</span>&nbsp;<span class="num" id="4510115">11</span><span class="op" id="4510117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510120">tReserved4</span>&nbsp;<span class="op" id="4510131">=</span>&nbsp;<span class="ident" id="4510133">bootstrapType</span><span class="op" id="4510146">(</span><span class="string" id="4510147">&#34;_reserved1&#34;</span><span class="op" id="4510159">,</span>&nbsp;<span class="op" id="4510161">(</span><span class="op" id="4510162">*</span><span class="keyword" id="4510163">struct</span><span class="op" id="4510169">{</span>&nbsp;<span class="ident" id="4510171">r4</span>&nbsp;<span class="builtintype" id="4510174">int</span>&nbsp;<span class="op" id="4510178">}</span><span class="op" id="4510179">)</span><span class="op" id="4510180">(</span><span class="ident" id="4510181">nil</span><span class="op" id="4510184">)</span><span class="op" id="4510185">,</span>&nbsp;<span class="num" id="4510187">12</span><span class="op" id="4510189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510192">tReserved3</span>&nbsp;<span class="op" id="4510203">=</span>&nbsp;<span class="ident" id="4510205">bootstrapType</span><span class="op" id="4510218">(</span><span class="string" id="4510219">&#34;_reserved1&#34;</span><span class="op" id="4510231">,</span>&nbsp;<span class="op" id="4510233">(</span><span class="op" id="4510234">*</span><span class="keyword" id="4510235">struct</span><span class="op" id="4510241">{</span>&nbsp;<span class="ident" id="4510243">r3</span>&nbsp;<span class="builtintype" id="4510246">int</span>&nbsp;<span class="op" id="4510250">}</span><span class="op" id="4510251">)</span><span class="op" id="4510252">(</span><span class="ident" id="4510253">nil</span><span class="op" id="4510256">)</span><span class="op" id="4510257">,</span>&nbsp;<span class="num" id="4510259">13</span><span class="op" id="4510261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510264">tReserved2</span>&nbsp;<span class="op" id="4510275">=</span>&nbsp;<span class="ident" id="4510277">bootstrapType</span><span class="op" id="4510290">(</span><span class="string" id="4510291">&#34;_reserved1&#34;</span><span class="op" id="4510303">,</span>&nbsp;<span class="op" id="4510305">(</span><span class="op" id="4510306">*</span><span class="keyword" id="4510307">struct</span><span class="op" id="4510313">{</span>&nbsp;<span class="ident" id="4510315">r2</span>&nbsp;<span class="builtintype" id="4510318">int</span>&nbsp;<span class="op" id="4510322">}</span><span class="op" id="4510323">)</span><span class="op" id="4510324">(</span><span class="ident" id="4510325">nil</span><span class="op" id="4510328">)</span><span class="op" id="4510329">,</span>&nbsp;<span class="num" id="4510331">14</span><span class="op" id="4510333">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510336">tReserved1</span>&nbsp;<span class="op" id="4510347">=</span>&nbsp;<span class="ident" id="4510349">bootstrapType</span><span class="op" id="4510362">(</span><span class="string" id="4510363">&#34;_reserved1&#34;</span><span class="op" id="4510375">,</span>&nbsp;<span class="op" id="4510377">(</span><span class="op" id="4510378">*</span><span class="keyword" id="4510379">struct</span><span class="op" id="4510385">{</span>&nbsp;<span class="ident" id="4510387">r1</span>&nbsp;<span class="builtintype" id="4510390">int</span>&nbsp;<span class="op" id="4510394">}</span><span class="op" id="4510395">)</span><span class="op" id="4510396">(</span><span class="ident" id="4510397">nil</span><span class="op" id="4510400">)</span><span class="op" id="4510401">,</span>&nbsp;<span class="num" id="4510403">15</span><span class="op" id="4510405">)</span><br>
<span class="lineno"></span><span class="op" id="4510407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510410">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="4510459">var</span>&nbsp;<span class="ident" id="4510463">tWireType</span>&nbsp;<span class="op" id="4510473">=</span>&nbsp;<span class="ident" id="4510475">mustGetTypeInfo</span><span class="op" id="4510490">(</span><span class="ident" id="4510491">reflect</span><span class="op" id="4510498">.</span><span class="ident" id="4510499">TypeOf</span><span class="op" id="4510505">(</span><span class="ident" id="4510506">wireType</span><span class="op" id="4510514">{</span><span class="op" id="4510515">}</span><span class="op" id="4510516">)</span><span class="op" id="4510517">)</span><span class="op" id="4510518">.</span><span class="ident" id="4510519">id</span><br>
<span class="lineno">270</span><span class="keyword" id="4510522">var</span>&nbsp;<span class="ident" id="4510526">wireTypeUserInfo</span>&nbsp;<span class="op" id="4510543">*</span><span class="ident" id="4510544">userTypeInfo</span>&nbsp;<span class="comment" id="4510557">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510589">func</span>&nbsp;<span class="ident" id="4510594">init</span><span class="op" id="4510598">(</span><span class="op" id="4510599">)</span>&nbsp;<span class="op" id="4510601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510604">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510664">checkId</span><span class="op" id="4510671">(</span><span class="num" id="4510672">16</span><span class="op" id="4510674">,</span>&nbsp;<span class="ident" id="4510676">tWireType</span><span class="op" id="4510685">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510688">checkId</span><span class="op" id="4510695">(</span><span class="num" id="4510696">17</span><span class="op" id="4510698">,</span>&nbsp;<span class="ident" id="4510700">mustGetTypeInfo</span><span class="op" id="4510715">(</span><span class="ident" id="4510716">reflect</span><span class="op" id="4510723">.</span><span class="ident" id="4510724">TypeOf</span><span class="op" id="4510730">(</span><span class="ident" id="4510731">arrayType</span><span class="op" id="4510740">{</span><span class="op" id="4510741">}</span><span class="op" id="4510742">)</span><span class="op" id="4510743">)</span><span class="op" id="4510744">.</span><span class="ident" id="4510745">id</span><span class="op" id="4510747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510750">checkId</span><span class="op" id="4510757">(</span><span class="num" id="4510758">18</span><span class="op" id="4510760">,</span>&nbsp;<span class="ident" id="4510762">mustGetTypeInfo</span><span class="op" id="4510777">(</span><span class="ident" id="4510778">reflect</span><span class="op" id="4510785">.</span><span class="ident" id="4510786">TypeOf</span><span class="op" id="4510792">(</span><span class="ident" id="4510793">CommonType</span><span class="op" id="4510803">{</span><span class="op" id="4510804">}</span><span class="op" id="4510805">)</span><span class="op" id="4510806">)</span><span class="op" id="4510807">.</span><span class="ident" id="4510808">id</span><span class="op" id="4510810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510813">checkId</span><span class="op" id="4510820">(</span><span class="num" id="4510821">19</span><span class="op" id="4510823">,</span>&nbsp;<span class="ident" id="4510825">mustGetTypeInfo</span><span class="op" id="4510840">(</span><span class="ident" id="4510841">reflect</span><span class="op" id="4510848">.</span><span class="ident" id="4510849">TypeOf</span><span class="op" id="4510855">(</span><span class="ident" id="4510856">sliceType</span><span class="op" id="4510865">{</span><span class="op" id="4510866">}</span><span class="op" id="4510867">)</span><span class="op" id="4510868">)</span><span class="op" id="4510869">.</span><span class="ident" id="4510870">id</span><span class="op" id="4510872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510875">checkId</span><span class="op" id="4510882">(</span><span class="num" id="4510883">20</span><span class="op" id="4510885">,</span>&nbsp;<span class="ident" id="4510887">mustGetTypeInfo</span><span class="op" id="4510902">(</span><span class="ident" id="4510903">reflect</span><span class="op" id="4510910">.</span><span class="ident" id="4510911">TypeOf</span><span class="op" id="4510917">(</span><span class="ident" id="4510918">structType</span><span class="op" id="4510928">{</span><span class="op" id="4510929">}</span><span class="op" id="4510930">)</span><span class="op" id="4510931">)</span><span class="op" id="4510932">.</span><span class="ident" id="4510933">id</span><span class="op" id="4510935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510938">checkId</span><span class="op" id="4510945">(</span><span class="num" id="4510946">21</span><span class="op" id="4510948">,</span>&nbsp;<span class="ident" id="4510950">mustGetTypeInfo</span><span class="op" id="4510965">(</span><span class="ident" id="4510966">reflect</span><span class="op" id="4510973">.</span><span class="ident" id="4510974">TypeOf</span><span class="op" id="4510980">(</span><span class="ident" id="4510981">fieldType</span><span class="op" id="4510990">{</span><span class="op" id="4510991">}</span><span class="op" id="4510992">)</span><span class="op" id="4510993">)</span><span class="op" id="4510994">.</span><span class="ident" id="4510995">id</span><span class="op" id="4510997">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511000">checkId</span><span class="op" id="4511007">(</span><span class="num" id="4511008">23</span><span class="op" id="4511010">,</span>&nbsp;<span class="ident" id="4511012">mustGetTypeInfo</span><span class="op" id="4511027">(</span><span class="ident" id="4511028">reflect</span><span class="op" id="4511035">.</span><span class="ident" id="4511036">TypeOf</span><span class="op" id="4511042">(</span><span class="ident" id="4511043">mapType</span><span class="op" id="4511050">{</span><span class="op" id="4511051">}</span><span class="op" id="4511052">)</span><span class="op" id="4511053">)</span><span class="op" id="4511054">.</span><span class="ident" id="4511055">id</span><span class="op" id="4511057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511061">builtinIdToType</span>&nbsp;<span class="op" id="4511077">=</span>&nbsp;<span class="builtinfunc" id="4511079">make</span><span class="op" id="4511083">(</span><span class="keyword" id="4511084">map</span><span class="op" id="4511087">[</span><span class="ident" id="4511088">typeId</span><span class="op" id="4511094">]</span><span class="ident" id="4511095">gobType</span><span class="op" id="4511102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511105">for</span>&nbsp;<span class="ident" id="4511109">k</span><span class="op" id="4511110">,</span>&nbsp;<span class="ident" id="4511112">v</span>&nbsp;<span class="op" id="4511114">:=</span>&nbsp;<span class="keyword" id="4511117">range</span>&nbsp;<span class="ident" id="4511123">idToType</span>&nbsp;<span class="op" id="4511132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511136">builtinIdToType</span><span class="op" id="4511151">[</span><span class="ident" id="4511152">k</span><span class="op" id="4511153">]</span>&nbsp;<span class="op" id="4511155">=</span>&nbsp;<span class="ident" id="4511157">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511164">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511238">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511275">if</span>&nbsp;<span class="ident" id="4511278">nextId</span>&nbsp;<span class="op" id="4511285">&gt;</span>&nbsp;<span class="ident" id="4511287">firstUserId</span>&nbsp;<span class="op" id="4511299">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4511303">panic</span><span class="op" id="4511308">(</span><span class="ident" id="4511309">fmt</span><span class="op" id="4511312">.</span><span class="ident" id="4511313">Sprintln</span><span class="op" id="4511321">(</span><span class="string" id="4511322">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="4511341">,</span>&nbsp;<span class="ident" id="4511343">nextId</span><span class="op" id="4511349">)</span><span class="op" id="4511350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511356">nextId</span>&nbsp;<span class="op" id="4511363">=</span>&nbsp;<span class="ident" id="4511365">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511378">registerBasics</span><span class="op" id="4511392">(</span><span class="op" id="4511393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511396">wireTypeUserInfo</span>&nbsp;<span class="op" id="4511413">=</span>&nbsp;<span class="ident" id="4511415">userType</span><span class="op" id="4511423">(</span><span class="ident" id="4511424">reflect</span><span class="op" id="4511431">.</span><span class="ident" id="4511432">TypeOf</span><span class="op" id="4511438">(</span><span class="op" id="4511439">(</span><span class="op" id="4511440">*</span><span class="ident" id="4511441">wireType</span><span class="op" id="4511449">)</span><span class="op" id="4511450">(</span><span class="ident" id="4511451">nil</span><span class="op" id="4511454">)</span><span class="op" id="4511455">)</span><span class="op" id="4511456">)</span><br>
<span class="lineno">295</span><span class="op" id="4511458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4511461">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4511475">type</span>&nbsp;<span class="ident" id="4511480">arrayType</span>&nbsp;<span class="keyword" id="4511490">struct</span>&nbsp;<span class="op" id="4511497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511500">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511512">Elem</span>&nbsp;<span class="ident" id="4511517">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511525">Len</span>&nbsp;&nbsp;<span class="builtintype" id="4511530">int</span><br>
<span class="lineno"></span><span class="op" id="4511534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511537">func</span>&nbsp;<span class="ident" id="4511542">newArrayType</span><span class="op" id="4511554">(</span><span class="ident" id="4511555">name</span>&nbsp;<span class="builtintype" id="4511560">string</span><span class="op" id="4511566">)</span>&nbsp;<span class="op" id="4511568">*</span><span class="ident" id="4511569">arrayType</span>&nbsp;<span class="op" id="4511579">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511582">a</span>&nbsp;<span class="op" id="4511584">:=</span>&nbsp;<span class="op" id="4511587">&amp;</span><span class="ident" id="4511588">arrayType</span><span class="op" id="4511597">{</span><span class="ident" id="4511598">CommonType</span><span class="op" id="4511608">{</span><span class="ident" id="4511609">Name</span><span class="op" id="4511613">:</span>&nbsp;<span class="ident" id="4511615">name</span><span class="op" id="4511619">}</span><span class="op" id="4511620">,</span>&nbsp;<span class="num" id="4511622">0</span><span class="op" id="4511623">,</span>&nbsp;<span class="num" id="4511625">0</span><span class="op" id="4511626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511629">return</span>&nbsp;<span class="ident" id="4511636">a</span><br>
<span class="lineno"></span><span class="op" id="4511638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511641">func</span>&nbsp;<span class="op" id="4511646">(</span><span class="ident" id="4511647">a</span>&nbsp;<span class="op" id="4511649">*</span><span class="ident" id="4511650">arrayType</span><span class="op" id="4511659">)</span>&nbsp;<span class="ident" id="4511661">init</span><span class="op" id="4511665">(</span><span class="ident" id="4511666">elem</span>&nbsp;<span class="ident" id="4511671">gobType</span><span class="op" id="4511678">,</span>&nbsp;<span class="builtinfunc" id="4511680">len</span>&nbsp;<span class="builtintype" id="4511684">int</span><span class="op" id="4511687">)</span>&nbsp;<span class="op" id="4511689">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511692">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511767">setTypeId</span><span class="op" id="4511776">(</span><span class="ident" id="4511777">a</span><span class="op" id="4511778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511781">a</span><span class="op" id="4511782">.</span><span class="ident" id="4511783">Elem</span>&nbsp;<span class="op" id="4511788">=</span>&nbsp;<span class="ident" id="4511790">elem</span><span class="op" id="4511794">.</span><span class="ident" id="4511795">id</span><span class="op" id="4511797">(</span><span class="op" id="4511798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511801">a</span><span class="op" id="4511802">.</span><span class="ident" id="4511803">Len</span>&nbsp;<span class="op" id="4511807">=</span>&nbsp;<span class="builtinfunc" id="4511809">len</span><br>
<span class="lineno"></span><span class="op" id="4511813">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4511816">func</span>&nbsp;<span class="op" id="4511821">(</span><span class="ident" id="4511822">a</span>&nbsp;<span class="op" id="4511824">*</span><span class="ident" id="4511825">arrayType</span><span class="op" id="4511834">)</span>&nbsp;<span class="ident" id="4511836">safeString</span><span class="op" id="4511846">(</span><span class="ident" id="4511847">seen</span>&nbsp;<span class="keyword" id="4511852">map</span><span class="op" id="4511855">[</span><span class="ident" id="4511856">typeId</span><span class="op" id="4511862">]</span><span class="builtintype" id="4511863">bool</span><span class="op" id="4511867">)</span>&nbsp;<span class="builtintype" id="4511869">string</span>&nbsp;<span class="op" id="4511876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511879">if</span>&nbsp;<span class="ident" id="4511882">seen</span><span class="op" id="4511886">[</span><span class="ident" id="4511887">a</span><span class="op" id="4511888">.</span><span class="ident" id="4511889">Id</span><span class="op" id="4511891">]</span>&nbsp;<span class="op" id="4511893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511897">return</span>&nbsp;<span class="ident" id="4511904">a</span><span class="op" id="4511905">.</span><span class="ident" id="4511906">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511912">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511915">seen</span><span class="op" id="4511919">[</span><span class="ident" id="4511920">a</span><span class="op" id="4511921">.</span><span class="ident" id="4511922">Id</span><span class="op" id="4511924">]</span>&nbsp;<span class="op" id="4511926">=</span>&nbsp;<span class="builtintype" id="4511928">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511934">return</span>&nbsp;<span class="ident" id="4511941">fmt</span><span class="op" id="4511944">.</span><span class="ident" id="4511945">Sprintf</span><span class="op" id="4511952">(</span><span class="string" id="4511953">&#34;[%d]%s&#34;</span><span class="op" id="4511961">,</span>&nbsp;<span class="ident" id="4511963">a</span><span class="op" id="4511964">.</span><span class="ident" id="4511965">Len</span><span class="op" id="4511968">,</span>&nbsp;<span class="ident" id="4511970">a</span><span class="op" id="4511971">.</span><span class="ident" id="4511972">Elem</span><span class="op" id="4511976">.</span><span class="ident" id="4511977">gobType</span><span class="op" id="4511984">(</span><span class="op" id="4511985">)</span><span class="op" id="4511986">.</span><span class="ident" id="4511987">safeString</span><span class="op" id="4511997">(</span><span class="ident" id="4511998">seen</span><span class="op" id="4512002">)</span><span class="op" id="4512003">)</span><br>
<span class="lineno"></span><span class="op" id="4512005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512008">func</span>&nbsp;<span class="op" id="4512013">(</span><span class="ident" id="4512014">a</span>&nbsp;<span class="op" id="4512016">*</span><span class="ident" id="4512017">arrayType</span><span class="op" id="4512026">)</span>&nbsp;<span class="builtintype" id="4512028">string</span><span class="op" id="4512034">(</span><span class="op" id="4512035">)</span>&nbsp;<span class="builtintype" id="4512037">string</span>&nbsp;<span class="op" id="4512044">{</span>&nbsp;<span class="keyword" id="4512046">return</span>&nbsp;<span class="ident" id="4512053">a</span><span class="op" id="4512054">.</span><span class="ident" id="4512055">safeString</span><span class="op" id="4512065">(</span><span class="builtinfunc" id="4512066">make</span><span class="op" id="4512070">(</span><span class="keyword" id="4512071">map</span><span class="op" id="4512074">[</span><span class="ident" id="4512075">typeId</span><span class="op" id="4512081">]</span><span class="builtintype" id="4512082">bool</span><span class="op" id="4512086">)</span><span class="op" id="4512087">)</span>&nbsp;<span class="op" id="4512089">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4512092">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="4512164">type</span>&nbsp;<span class="ident" id="4512169">gobEncoderType</span>&nbsp;<span class="keyword" id="4512184">struct</span>&nbsp;<span class="op" id="4512191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512194">CommonType</span><br>
<span class="lineno"></span><span class="op" id="4512205">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4512208">func</span>&nbsp;<span class="ident" id="4512213">newGobEncoderType</span><span class="op" id="4512230">(</span><span class="ident" id="4512231">name</span>&nbsp;<span class="builtintype" id="4512236">string</span><span class="op" id="4512242">)</span>&nbsp;<span class="op" id="4512244">*</span><span class="ident" id="4512245">gobEncoderType</span>&nbsp;<span class="op" id="4512260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512263">g</span>&nbsp;<span class="op" id="4512265">:=</span>&nbsp;<span class="op" id="4512268">&amp;</span><span class="ident" id="4512269">gobEncoderType</span><span class="op" id="4512283">{</span><span class="ident" id="4512284">CommonType</span><span class="op" id="4512294">{</span><span class="ident" id="4512295">Name</span><span class="op" id="4512299">:</span>&nbsp;<span class="ident" id="4512301">name</span><span class="op" id="4512305">}</span><span class="op" id="4512306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512309">setTypeId</span><span class="op" id="4512318">(</span><span class="ident" id="4512319">g</span><span class="op" id="4512320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512323">return</span>&nbsp;<span class="ident" id="4512330">g</span><br>
<span class="lineno">335</span><span class="op" id="4512332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512335">func</span>&nbsp;<span class="op" id="4512340">(</span><span class="ident" id="4512341">g</span>&nbsp;<span class="op" id="4512343">*</span><span class="ident" id="4512344">gobEncoderType</span><span class="op" id="4512358">)</span>&nbsp;<span class="ident" id="4512360">safeString</span><span class="op" id="4512370">(</span><span class="ident" id="4512371">seen</span>&nbsp;<span class="keyword" id="4512376">map</span><span class="op" id="4512379">[</span><span class="ident" id="4512380">typeId</span><span class="op" id="4512386">]</span><span class="builtintype" id="4512387">bool</span><span class="op" id="4512391">)</span>&nbsp;<span class="builtintype" id="4512393">string</span>&nbsp;<span class="op" id="4512400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512403">return</span>&nbsp;<span class="ident" id="4512410">g</span><span class="op" id="4512411">.</span><span class="ident" id="4512412">Name</span><br>
<span class="lineno"></span><span class="op" id="4512417">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="4512420">func</span>&nbsp;<span class="op" id="4512425">(</span><span class="ident" id="4512426">g</span>&nbsp;<span class="op" id="4512428">*</span><span class="ident" id="4512429">gobEncoderType</span><span class="op" id="4512443">)</span>&nbsp;<span class="builtintype" id="4512445">string</span><span class="op" id="4512451">(</span><span class="op" id="4512452">)</span>&nbsp;<span class="builtintype" id="4512454">string</span>&nbsp;<span class="op" id="4512461">{</span>&nbsp;<span class="keyword" id="4512463">return</span>&nbsp;<span class="ident" id="4512470">g</span><span class="op" id="4512471">.</span><span class="ident" id="4512472">Name</span>&nbsp;<span class="op" id="4512477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4512480">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4512492">type</span>&nbsp;<span class="ident" id="4512497">mapType</span>&nbsp;<span class="keyword" id="4512505">struct</span>&nbsp;<span class="op" id="4512512">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512515">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512527">Key</span>&nbsp;&nbsp;<span class="ident" id="4512532">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512540">Elem</span>&nbsp;<span class="ident" id="4512545">typeId</span><br>
<span class="lineno"></span><span class="op" id="4512552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4512555">func</span>&nbsp;<span class="ident" id="4512560">newMapType</span><span class="op" id="4512570">(</span><span class="ident" id="4512571">name</span>&nbsp;<span class="builtintype" id="4512576">string</span><span class="op" id="4512582">)</span>&nbsp;<span class="op" id="4512584">*</span><span class="ident" id="4512585">mapType</span>&nbsp;<span class="op" id="4512593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512596">m</span>&nbsp;<span class="op" id="4512598">:=</span>&nbsp;<span class="op" id="4512601">&amp;</span><span class="ident" id="4512602">mapType</span><span class="op" id="4512609">{</span><span class="ident" id="4512610">CommonType</span><span class="op" id="4512620">{</span><span class="ident" id="4512621">Name</span><span class="op" id="4512625">:</span>&nbsp;<span class="ident" id="4512627">name</span><span class="op" id="4512631">}</span><span class="op" id="4512632">,</span>&nbsp;<span class="num" id="4512634">0</span><span class="op" id="4512635">,</span>&nbsp;<span class="num" id="4512637">0</span><span class="op" id="4512638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512641">return</span>&nbsp;<span class="ident" id="4512648">m</span><br>
<span class="lineno"></span><span class="op" id="4512650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4512653">func</span>&nbsp;<span class="op" id="4512658">(</span><span class="ident" id="4512659">m</span>&nbsp;<span class="op" id="4512661">*</span><span class="ident" id="4512662">mapType</span><span class="op" id="4512669">)</span>&nbsp;<span class="ident" id="4512671">init</span><span class="op" id="4512675">(</span><span class="ident" id="4512676">key</span><span class="op" id="4512679">,</span>&nbsp;<span class="ident" id="4512681">elem</span>&nbsp;<span class="ident" id="4512686">gobType</span><span class="op" id="4512693">)</span>&nbsp;<span class="op" id="4512695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512698">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512773">setTypeId</span><span class="op" id="4512782">(</span><span class="ident" id="4512783">m</span><span class="op" id="4512784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512787">m</span><span class="op" id="4512788">.</span><span class="ident" id="4512789">Key</span>&nbsp;<span class="op" id="4512793">=</span>&nbsp;<span class="ident" id="4512795">key</span><span class="op" id="4512798">.</span><span class="ident" id="4512799">id</span><span class="op" id="4512801">(</span><span class="op" id="4512802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512805">m</span><span class="op" id="4512806">.</span><span class="ident" id="4512807">Elem</span>&nbsp;<span class="op" id="4512812">=</span>&nbsp;<span class="ident" id="4512814">elem</span><span class="op" id="4512818">.</span><span class="ident" id="4512819">id</span><span class="op" id="4512821">(</span><span class="op" id="4512822">)</span><br>
<span class="lineno">360</span><span class="op" id="4512824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512827">func</span>&nbsp;<span class="op" id="4512832">(</span><span class="ident" id="4512833">m</span>&nbsp;<span class="op" id="4512835">*</span><span class="ident" id="4512836">mapType</span><span class="op" id="4512843">)</span>&nbsp;<span class="ident" id="4512845">safeString</span><span class="op" id="4512855">(</span><span class="ident" id="4512856">seen</span>&nbsp;<span class="keyword" id="4512861">map</span><span class="op" id="4512864">[</span><span class="ident" id="4512865">typeId</span><span class="op" id="4512871">]</span><span class="builtintype" id="4512872">bool</span><span class="op" id="4512876">)</span>&nbsp;<span class="builtintype" id="4512878">string</span>&nbsp;<span class="op" id="4512885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512888">if</span>&nbsp;<span class="ident" id="4512891">seen</span><span class="op" id="4512895">[</span><span class="ident" id="4512896">m</span><span class="op" id="4512897">.</span><span class="ident" id="4512898">Id</span><span class="op" id="4512900">]</span>&nbsp;<span class="op" id="4512902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512906">return</span>&nbsp;<span class="ident" id="4512913">m</span><span class="op" id="4512914">.</span><span class="ident" id="4512915">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512924">seen</span><span class="op" id="4512928">[</span><span class="ident" id="4512929">m</span><span class="op" id="4512930">.</span><span class="ident" id="4512931">Id</span><span class="op" id="4512933">]</span>&nbsp;<span class="op" id="4512935">=</span>&nbsp;<span class="builtintype" id="4512937">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512943">key</span>&nbsp;<span class="op" id="4512947">:=</span>&nbsp;<span class="ident" id="4512950">m</span><span class="op" id="4512951">.</span><span class="ident" id="4512952">Key</span><span class="op" id="4512955">.</span><span class="ident" id="4512956">gobType</span><span class="op" id="4512963">(</span><span class="op" id="4512964">)</span><span class="op" id="4512965">.</span><span class="ident" id="4512966">safeString</span><span class="op" id="4512976">(</span><span class="ident" id="4512977">seen</span><span class="op" id="4512981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512984">elem</span>&nbsp;<span class="op" id="4512989">:=</span>&nbsp;<span class="ident" id="4512992">m</span><span class="op" id="4512993">.</span><span class="ident" id="4512994">Elem</span><span class="op" id="4512998">.</span><span class="ident" id="4512999">gobType</span><span class="op" id="4513006">(</span><span class="op" id="4513007">)</span><span class="op" id="4513008">.</span><span class="ident" id="4513009">safeString</span><span class="op" id="4513019">(</span><span class="ident" id="4513020">seen</span><span class="op" id="4513024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513027">return</span>&nbsp;<span class="ident" id="4513034">fmt</span><span class="op" id="4513037">.</span><span class="ident" id="4513038">Sprintf</span><span class="op" id="4513045">(</span><span class="string" id="4513046">&#34;map[%s]%s&#34;</span><span class="op" id="4513057">,</span>&nbsp;<span class="ident" id="4513059">key</span><span class="op" id="4513062">,</span>&nbsp;<span class="ident" id="4513064">elem</span><span class="op" id="4513068">)</span><br>
<span class="lineno">370</span><span class="op" id="4513070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4513073">func</span>&nbsp;<span class="op" id="4513078">(</span><span class="ident" id="4513079">m</span>&nbsp;<span class="op" id="4513081">*</span><span class="ident" id="4513082">mapType</span><span class="op" id="4513089">)</span>&nbsp;<span class="builtintype" id="4513091">string</span><span class="op" id="4513097">(</span><span class="op" id="4513098">)</span>&nbsp;<span class="builtintype" id="4513100">string</span>&nbsp;<span class="op" id="4513107">{</span>&nbsp;<span class="keyword" id="4513109">return</span>&nbsp;<span class="ident" id="4513116">m</span><span class="op" id="4513117">.</span><span class="ident" id="4513118">safeString</span><span class="op" id="4513128">(</span><span class="builtinfunc" id="4513129">make</span><span class="op" id="4513133">(</span><span class="keyword" id="4513134">map</span><span class="op" id="4513137">[</span><span class="ident" id="4513138">typeId</span><span class="op" id="4513144">]</span><span class="builtintype" id="4513145">bool</span><span class="op" id="4513149">)</span><span class="op" id="4513150">)</span>&nbsp;<span class="op" id="4513152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4513155">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="4513169">type</span>&nbsp;<span class="ident" id="4513174">sliceType</span>&nbsp;<span class="keyword" id="4513184">struct</span>&nbsp;<span class="op" id="4513191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513194">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513206">Elem</span>&nbsp;<span class="ident" id="4513211">typeId</span><br>
<span class="lineno"></span><span class="op" id="4513218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4513221">func</span>&nbsp;<span class="ident" id="4513226">newSliceType</span><span class="op" id="4513238">(</span><span class="ident" id="4513239">name</span>&nbsp;<span class="builtintype" id="4513244">string</span><span class="op" id="4513250">)</span>&nbsp;<span class="op" id="4513252">*</span><span class="ident" id="4513253">sliceType</span>&nbsp;<span class="op" id="4513263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513266">s</span>&nbsp;<span class="op" id="4513268">:=</span>&nbsp;<span class="op" id="4513271">&amp;</span><span class="ident" id="4513272">sliceType</span><span class="op" id="4513281">{</span><span class="ident" id="4513282">CommonType</span><span class="op" id="4513292">{</span><span class="ident" id="4513293">Name</span><span class="op" id="4513297">:</span>&nbsp;<span class="ident" id="4513299">name</span><span class="op" id="4513303">}</span><span class="op" id="4513304">,</span>&nbsp;<span class="num" id="4513306">0</span><span class="op" id="4513307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513310">return</span>&nbsp;<span class="ident" id="4513317">s</span><br>
<span class="lineno"></span><span class="op" id="4513319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4513322">func</span>&nbsp;<span class="op" id="4513327">(</span><span class="ident" id="4513328">s</span>&nbsp;<span class="op" id="4513330">*</span><span class="ident" id="4513331">sliceType</span><span class="op" id="4513340">)</span>&nbsp;<span class="ident" id="4513342">init</span><span class="op" id="4513346">(</span><span class="ident" id="4513347">elem</span>&nbsp;<span class="ident" id="4513352">gobType</span><span class="op" id="4513359">)</span>&nbsp;<span class="op" id="4513361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513364">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513439">setTypeId</span><span class="op" id="4513448">(</span><span class="ident" id="4513449">s</span><span class="op" id="4513450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513453">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513518">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513553">if</span>&nbsp;<span class="ident" id="4513556">elem</span><span class="op" id="4513560">.</span><span class="ident" id="4513561">id</span><span class="op" id="4513563">(</span><span class="op" id="4513564">)</span>&nbsp;<span class="op" id="4513566">==</span>&nbsp;<span class="num" id="4513569">0</span>&nbsp;<span class="op" id="4513571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513575">setTypeId</span><span class="op" id="4513584">(</span><span class="ident" id="4513585">elem</span><span class="op" id="4513589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513595">s</span><span class="op" id="4513596">.</span><span class="ident" id="4513597">Elem</span>&nbsp;<span class="op" id="4513602">=</span>&nbsp;<span class="ident" id="4513604">elem</span><span class="op" id="4513608">.</span><span class="ident" id="4513609">id</span><span class="op" id="4513611">(</span><span class="op" id="4513612">)</span><br>
<span class="lineno"></span><span class="op" id="4513614">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="4513617">func</span>&nbsp;<span class="op" id="4513622">(</span><span class="ident" id="4513623">s</span>&nbsp;<span class="op" id="4513625">*</span><span class="ident" id="4513626">sliceType</span><span class="op" id="4513635">)</span>&nbsp;<span class="ident" id="4513637">safeString</span><span class="op" id="4513647">(</span><span class="ident" id="4513648">seen</span>&nbsp;<span class="keyword" id="4513653">map</span><span class="op" id="4513656">[</span><span class="ident" id="4513657">typeId</span><span class="op" id="4513663">]</span><span class="builtintype" id="4513664">bool</span><span class="op" id="4513668">)</span>&nbsp;<span class="builtintype" id="4513670">string</span>&nbsp;<span class="op" id="4513677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513680">if</span>&nbsp;<span class="ident" id="4513683">seen</span><span class="op" id="4513687">[</span><span class="ident" id="4513688">s</span><span class="op" id="4513689">.</span><span class="ident" id="4513690">Id</span><span class="op" id="4513692">]</span>&nbsp;<span class="op" id="4513694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513698">return</span>&nbsp;<span class="ident" id="4513705">s</span><span class="op" id="4513706">.</span><span class="ident" id="4513707">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513713">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513716">seen</span><span class="op" id="4513720">[</span><span class="ident" id="4513721">s</span><span class="op" id="4513722">.</span><span class="ident" id="4513723">Id</span><span class="op" id="4513725">]</span>&nbsp;<span class="op" id="4513727">=</span>&nbsp;<span class="builtintype" id="4513729">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513735">return</span>&nbsp;<span class="ident" id="4513742">fmt</span><span class="op" id="4513745">.</span><span class="ident" id="4513746">Sprintf</span><span class="op" id="4513753">(</span><span class="string" id="4513754">&#34;[]%s&#34;</span><span class="op" id="4513760">,</span>&nbsp;<span class="ident" id="4513762">s</span><span class="op" id="4513763">.</span><span class="ident" id="4513764">Elem</span><span class="op" id="4513768">.</span><span class="ident" id="4513769">gobType</span><span class="op" id="4513776">(</span><span class="op" id="4513777">)</span><span class="op" id="4513778">.</span><span class="ident" id="4513779">safeString</span><span class="op" id="4513789">(</span><span class="ident" id="4513790">seen</span><span class="op" id="4513794">)</span><span class="op" id="4513795">)</span><br>
<span class="lineno"></span><span class="op" id="4513797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4513800">func</span>&nbsp;<span class="op" id="4513805">(</span><span class="ident" id="4513806">s</span>&nbsp;<span class="op" id="4513808">*</span><span class="ident" id="4513809">sliceType</span><span class="op" id="4513818">)</span>&nbsp;<span class="builtintype" id="4513820">string</span><span class="op" id="4513826">(</span><span class="op" id="4513827">)</span>&nbsp;<span class="builtintype" id="4513829">string</span>&nbsp;<span class="op" id="4513836">{</span>&nbsp;<span class="keyword" id="4513838">return</span>&nbsp;<span class="ident" id="4513845">s</span><span class="op" id="4513846">.</span><span class="ident" id="4513847">safeString</span><span class="op" id="4513857">(</span><span class="builtinfunc" id="4513858">make</span><span class="op" id="4513862">(</span><span class="keyword" id="4513863">map</span><span class="op" id="4513866">[</span><span class="ident" id="4513867">typeId</span><span class="op" id="4513873">]</span><span class="builtintype" id="4513874">bool</span><span class="op" id="4513878">)</span><span class="op" id="4513879">)</span>&nbsp;<span class="op" id="4513881">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4513884">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4513899">type</span>&nbsp;<span class="ident" id="4513904">fieldType</span>&nbsp;<span class="keyword" id="4513914">struct</span>&nbsp;<span class="op" id="4513921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513924">Name</span>&nbsp;<span class="builtintype" id="4513929">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513937">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4513942">typeId</span><br>
<span class="lineno">410</span><span class="op" id="4513949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4513952">type</span>&nbsp;<span class="ident" id="4513957">structType</span>&nbsp;<span class="keyword" id="4513968">struct</span>&nbsp;<span class="op" id="4513975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513978">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513990">Field</span>&nbsp;<span class="op" id="4513996">[</span><span class="op" id="4513997">]</span><span class="op" id="4513998">*</span><span class="ident" id="4513999">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="4514009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4514012">func</span>&nbsp;<span class="op" id="4514017">(</span><span class="ident" id="4514018">s</span>&nbsp;<span class="op" id="4514020">*</span><span class="ident" id="4514021">structType</span><span class="op" id="4514031">)</span>&nbsp;<span class="ident" id="4514033">safeString</span><span class="op" id="4514043">(</span><span class="ident" id="4514044">seen</span>&nbsp;<span class="keyword" id="4514049">map</span><span class="op" id="4514052">[</span><span class="ident" id="4514053">typeId</span><span class="op" id="4514059">]</span><span class="builtintype" id="4514060">bool</span><span class="op" id="4514064">)</span>&nbsp;<span class="builtintype" id="4514066">string</span>&nbsp;<span class="op" id="4514073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514076">if</span>&nbsp;<span class="ident" id="4514079">s</span>&nbsp;<span class="op" id="4514081">==</span>&nbsp;<span class="ident" id="4514084">nil</span>&nbsp;<span class="op" id="4514088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514092">return</span>&nbsp;<span class="string" id="4514099">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4514108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514111">if</span>&nbsp;<span class="ident" id="4514114">_</span><span class="op" id="4514115">,</span>&nbsp;<span class="ident" id="4514117">ok</span>&nbsp;<span class="op" id="4514120">:=</span>&nbsp;<span class="ident" id="4514123">seen</span><span class="op" id="4514127">[</span><span class="ident" id="4514128">s</span><span class="op" id="4514129">.</span><span class="ident" id="4514130">Id</span><span class="op" id="4514132">]</span><span class="op" id="4514133">;</span>&nbsp;<span class="ident" id="4514135">ok</span>&nbsp;<span class="op" id="4514138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514142">return</span>&nbsp;<span class="ident" id="4514149">s</span><span class="op" id="4514150">.</span><span class="ident" id="4514151">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4514157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514160">seen</span><span class="op" id="4514164">[</span><span class="ident" id="4514165">s</span><span class="op" id="4514166">.</span><span class="ident" id="4514167">Id</span><span class="op" id="4514169">]</span>&nbsp;<span class="op" id="4514171">=</span>&nbsp;<span class="builtintype" id="4514173">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514179">str</span>&nbsp;<span class="op" id="4514183">:=</span>&nbsp;<span class="ident" id="4514186">s</span><span class="op" id="4514187">.</span><span class="ident" id="4514188">Name</span>&nbsp;<span class="op" id="4514193">+</span>&nbsp;<span class="string" id="4514195">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514211">for</span>&nbsp;<span class="ident" id="4514215">_</span><span class="op" id="4514216">,</span>&nbsp;<span class="ident" id="4514218">f</span>&nbsp;<span class="op" id="4514220">:=</span>&nbsp;<span class="keyword" id="4514223">range</span>&nbsp;<span class="ident" id="4514229">s</span><span class="op" id="4514230">.</span><span class="ident" id="4514231">Field</span>&nbsp;<span class="op" id="4514237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514241">str</span>&nbsp;<span class="op" id="4514245">+=</span>&nbsp;<span class="ident" id="4514248">fmt</span><span class="op" id="4514251">.</span><span class="ident" id="4514252">Sprintf</span><span class="op" id="4514259">(</span><span class="string" id="4514260">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="4514269">,</span>&nbsp;<span class="ident" id="4514271">f</span><span class="op" id="4514272">.</span><span class="ident" id="4514273">Name</span><span class="op" id="4514277">,</span>&nbsp;<span class="ident" id="4514279">f</span><span class="op" id="4514280">.</span><span class="ident" id="4514281">Id</span><span class="op" id="4514283">.</span><span class="ident" id="4514284">gobType</span><span class="op" id="4514291">(</span><span class="op" id="4514292">)</span><span class="op" id="4514293">.</span><span class="ident" id="4514294">safeString</span><span class="op" id="4514304">(</span><span class="ident" id="4514305">seen</span><span class="op" id="4514309">)</span><span class="op" id="4514310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4514313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514316">str</span>&nbsp;<span class="op" id="4514320">+=</span>&nbsp;<span class="string" id="4514323">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514328">return</span>&nbsp;<span class="ident" id="4514335">str</span><br>
<span class="lineno"></span><span class="op" id="4514339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4514342">func</span>&nbsp;<span class="op" id="4514347">(</span><span class="ident" id="4514348">s</span>&nbsp;<span class="op" id="4514350">*</span><span class="ident" id="4514351">structType</span><span class="op" id="4514361">)</span>&nbsp;<span class="builtintype" id="4514363">string</span><span class="op" id="4514369">(</span><span class="op" id="4514370">)</span>&nbsp;<span class="builtintype" id="4514372">string</span>&nbsp;<span class="op" id="4514379">{</span>&nbsp;<span class="keyword" id="4514381">return</span>&nbsp;<span class="ident" id="4514388">s</span><span class="op" id="4514389">.</span><span class="ident" id="4514390">safeString</span><span class="op" id="4514400">(</span><span class="builtinfunc" id="4514401">make</span><span class="op" id="4514405">(</span><span class="keyword" id="4514406">map</span><span class="op" id="4514409">[</span><span class="ident" id="4514410">typeId</span><span class="op" id="4514416">]</span><span class="builtintype" id="4514417">bool</span><span class="op" id="4514421">)</span><span class="op" id="4514422">)</span>&nbsp;<span class="op" id="4514424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4514427">func</span>&nbsp;<span class="ident" id="4514432">newStructType</span><span class="op" id="4514445">(</span><span class="ident" id="4514446">name</span>&nbsp;<span class="builtintype" id="4514451">string</span><span class="op" id="4514457">)</span>&nbsp;<span class="op" id="4514459">*</span><span class="ident" id="4514460">structType</span>&nbsp;<span class="op" id="4514471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514474">s</span>&nbsp;<span class="op" id="4514476">:=</span>&nbsp;<span class="op" id="4514479">&amp;</span><span class="ident" id="4514480">structType</span><span class="op" id="4514490">{</span><span class="ident" id="4514491">CommonType</span><span class="op" id="4514501">{</span><span class="ident" id="4514502">Name</span><span class="op" id="4514506">:</span>&nbsp;<span class="ident" id="4514508">name</span><span class="op" id="4514512">}</span><span class="op" id="4514513">,</span>&nbsp;<span class="ident" id="4514515">nil</span><span class="op" id="4514518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514521">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514585">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514635">setTypeId</span><span class="op" id="4514644">(</span><span class="ident" id="4514645">s</span><span class="op" id="4514646">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514649">return</span>&nbsp;<span class="ident" id="4514656">s</span><br>
<span class="lineno"></span><span class="op" id="4514658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4514661">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4514726">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="4514791">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="4514801">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="4514866">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="4514916">func</span>&nbsp;<span class="ident" id="4514921">newTypeObject</span><span class="op" id="4514934">(</span><span class="ident" id="4514935">name</span>&nbsp;<span class="builtintype" id="4514940">string</span><span class="op" id="4514946">,</span>&nbsp;<span class="ident" id="4514948">ut</span>&nbsp;<span class="op" id="4514951">*</span><span class="ident" id="4514952">userTypeInfo</span><span class="op" id="4514964">,</span>&nbsp;<span class="ident" id="4514966">rt</span>&nbsp;<span class="ident" id="4514969">reflect</span><span class="op" id="4514976">.</span><span class="ident" id="4514977">Type</span><span class="op" id="4514981">)</span>&nbsp;<span class="op" id="4514983">(</span><span class="ident" id="4514984">gobType</span><span class="op" id="4514991">,</span>&nbsp;<span class="builtintype" id="4514993">error</span><span class="op" id="4514998">)</span>&nbsp;<span class="op" id="4515000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4515003">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515044">if</span>&nbsp;<span class="ident" id="4515047">ut</span><span class="op" id="4515049">.</span><span class="ident" id="4515050">externalEnc</span>&nbsp;<span class="op" id="4515062">!=</span>&nbsp;<span class="num" id="4515065">0</span>&nbsp;<span class="op" id="4515067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515071">return</span>&nbsp;<span class="ident" id="4515078">newGobEncoderType</span><span class="op" id="4515095">(</span><span class="ident" id="4515096">name</span><span class="op" id="4515100">)</span><span class="op" id="4515101">,</span>&nbsp;<span class="ident" id="4515103">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515111">var</span>&nbsp;<span class="ident" id="4515115">err</span>&nbsp;<span class="builtintype" id="4515119">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515126">var</span>&nbsp;<span class="ident" id="4515130">type0</span><span class="op" id="4515135">,</span>&nbsp;<span class="ident" id="4515137">type1</span>&nbsp;<span class="ident" id="4515143">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515152">defer</span>&nbsp;<span class="keyword" id="4515158">func</span><span class="op" id="4515162">(</span><span class="op" id="4515163">)</span>&nbsp;<span class="op" id="4515165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515169">if</span>&nbsp;<span class="ident" id="4515172">err</span>&nbsp;<span class="op" id="4515176">!=</span>&nbsp;<span class="ident" id="4515179">nil</span>&nbsp;<span class="op" id="4515183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4515188">delete</span><span class="op" id="4515194">(</span><span class="ident" id="4515195">types</span><span class="op" id="4515200">,</span>&nbsp;<span class="ident" id="4515202">rt</span><span class="op" id="4515204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515211">}</span><span class="op" id="4515212">(</span><span class="op" id="4515213">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4515216">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4515287">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515345">switch</span>&nbsp;<span class="ident" id="4515352">t</span>&nbsp;<span class="op" id="4515354">:=</span>&nbsp;<span class="ident" id="4515357">rt</span><span class="op" id="4515359">;</span>&nbsp;<span class="ident" id="4515361">t</span><span class="op" id="4515362">.</span><span class="ident" id="4515363">Kind</span><span class="op" id="4515367">(</span><span class="op" id="4515368">)</span>&nbsp;<span class="op" id="4515370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4515373">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515424">case</span>&nbsp;<span class="ident" id="4515429">reflect</span><span class="op" id="4515436">.</span><span class="ident" id="4515437">Bool</span><span class="op" id="4515441">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515445">return</span>&nbsp;<span class="ident" id="4515452">tBool</span><span class="op" id="4515457">.</span><span class="ident" id="4515458">gobType</span><span class="op" id="4515465">(</span><span class="op" id="4515466">)</span><span class="op" id="4515467">,</span>&nbsp;<span class="ident" id="4515469">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515475">case</span>&nbsp;<span class="ident" id="4515480">reflect</span><span class="op" id="4515487">.</span><span class="ident" id="4515488">Int</span><span class="op" id="4515491">,</span>&nbsp;<span class="ident" id="4515493">reflect</span><span class="op" id="4515500">.</span><span class="ident" id="4515501">Int8</span><span class="op" id="4515505">,</span>&nbsp;<span class="ident" id="4515507">reflect</span><span class="op" id="4515514">.</span><span class="ident" id="4515515">Int16</span><span class="op" id="4515520">,</span>&nbsp;<span class="ident" id="4515522">reflect</span><span class="op" id="4515529">.</span><span class="ident" id="4515530">Int32</span><span class="op" id="4515535">,</span>&nbsp;<span class="ident" id="4515537">reflect</span><span class="op" id="4515544">.</span><span class="ident" id="4515545">Int64</span><span class="op" id="4515550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515554">return</span>&nbsp;<span class="ident" id="4515561">tInt</span><span class="op" id="4515565">.</span><span class="ident" id="4515566">gobType</span><span class="op" id="4515573">(</span><span class="op" id="4515574">)</span><span class="op" id="4515575">,</span>&nbsp;<span class="ident" id="4515577">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515583">case</span>&nbsp;<span class="ident" id="4515588">reflect</span><span class="op" id="4515595">.</span><span class="ident" id="4515596">Uint</span><span class="op" id="4515600">,</span>&nbsp;<span class="ident" id="4515602">reflect</span><span class="op" id="4515609">.</span><span class="ident" id="4515610">Uint8</span><span class="op" id="4515615">,</span>&nbsp;<span class="ident" id="4515617">reflect</span><span class="op" id="4515624">.</span><span class="ident" id="4515625">Uint16</span><span class="op" id="4515631">,</span>&nbsp;<span class="ident" id="4515633">reflect</span><span class="op" id="4515640">.</span><span class="ident" id="4515641">Uint32</span><span class="op" id="4515647">,</span>&nbsp;<span class="ident" id="4515649">reflect</span><span class="op" id="4515656">.</span><span class="ident" id="4515657">Uint64</span><span class="op" id="4515663">,</span>&nbsp;<span class="ident" id="4515665">reflect</span><span class="op" id="4515672">.</span><span class="ident" id="4515673">Uintptr</span><span class="op" id="4515680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515684">return</span>&nbsp;<span class="ident" id="4515691">tUint</span><span class="op" id="4515696">.</span><span class="ident" id="4515697">gobType</span><span class="op" id="4515704">(</span><span class="op" id="4515705">)</span><span class="op" id="4515706">,</span>&nbsp;<span class="ident" id="4515708">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515714">case</span>&nbsp;<span class="ident" id="4515719">reflect</span><span class="op" id="4515726">.</span><span class="ident" id="4515727">Float32</span><span class="op" id="4515734">,</span>&nbsp;<span class="ident" id="4515736">reflect</span><span class="op" id="4515743">.</span><span class="ident" id="4515744">Float64</span><span class="op" id="4515751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515755">return</span>&nbsp;<span class="ident" id="4515762">tFloat</span><span class="op" id="4515768">.</span><span class="ident" id="4515769">gobType</span><span class="op" id="4515776">(</span><span class="op" id="4515777">)</span><span class="op" id="4515778">,</span>&nbsp;<span class="ident" id="4515780">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515786">case</span>&nbsp;<span class="ident" id="4515791">reflect</span><span class="op" id="4515798">.</span><span class="ident" id="4515799">Complex64</span><span class="op" id="4515808">,</span>&nbsp;<span class="ident" id="4515810">reflect</span><span class="op" id="4515817">.</span><span class="ident" id="4515818">Complex128</span><span class="op" id="4515828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515832">return</span>&nbsp;<span class="ident" id="4515839">tComplex</span><span class="op" id="4515847">.</span><span class="ident" id="4515848">gobType</span><span class="op" id="4515855">(</span><span class="op" id="4515856">)</span><span class="op" id="4515857">,</span>&nbsp;<span class="ident" id="4515859">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515865">case</span>&nbsp;<span class="ident" id="4515870">reflect</span><span class="op" id="4515877">.</span><span class="ident" id="4515878">String</span><span class="op" id="4515884">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515888">return</span>&nbsp;<span class="ident" id="4515895">tString</span><span class="op" id="4515902">.</span><span class="ident" id="4515903">gobType</span><span class="op" id="4515910">(</span><span class="op" id="4515911">)</span><span class="op" id="4515912">,</span>&nbsp;<span class="ident" id="4515914">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515920">case</span>&nbsp;<span class="ident" id="4515925">reflect</span><span class="op" id="4515932">.</span><span class="ident" id="4515933">Interface</span><span class="op" id="4515942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515946">return</span>&nbsp;<span class="ident" id="4515953">tInterface</span><span class="op" id="4515963">.</span><span class="ident" id="4515964">gobType</span><span class="op" id="4515971">(</span><span class="op" id="4515972">)</span><span class="op" id="4515973">,</span>&nbsp;<span class="ident" id="4515975">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515981">case</span>&nbsp;<span class="ident" id="4515986">reflect</span><span class="op" id="4515993">.</span><span class="ident" id="4515994">Array</span><span class="op" id="4515999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516003">at</span>&nbsp;<span class="op" id="4516006">:=</span>&nbsp;<span class="ident" id="4516009">newArrayType</span><span class="op" id="4516021">(</span><span class="ident" id="4516022">name</span><span class="op" id="4516026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516030">types</span><span class="op" id="4516035">[</span><span class="ident" id="4516036">rt</span><span class="op" id="4516038">]</span>&nbsp;<span class="op" id="4516040">=</span>&nbsp;<span class="ident" id="4516042">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516047">type0</span><span class="op" id="4516052">,</span>&nbsp;<span class="ident" id="4516054">err</span>&nbsp;<span class="op" id="4516058">=</span>&nbsp;<span class="ident" id="4516060">getBaseType</span><span class="op" id="4516071">(</span><span class="string" id="4516072">&#34;&#34;</span><span class="op" id="4516074">,</span>&nbsp;<span class="ident" id="4516076">t</span><span class="op" id="4516077">.</span><span class="ident" id="4516078">Elem</span><span class="op" id="4516082">(</span><span class="op" id="4516083">)</span><span class="op" id="4516084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516088">if</span>&nbsp;<span class="ident" id="4516091">err</span>&nbsp;<span class="op" id="4516095">!=</span>&nbsp;<span class="ident" id="4516098">nil</span>&nbsp;<span class="op" id="4516102">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516107">return</span>&nbsp;<span class="ident" id="4516114">nil</span><span class="op" id="4516117">,</span>&nbsp;<span class="ident" id="4516119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516129">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516152">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516225">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516303">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516373">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516445">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516516">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516583">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516639">at</span><span class="op" id="4516641">.</span><span class="ident" id="4516642">init</span><span class="op" id="4516646">(</span><span class="ident" id="4516647">type0</span><span class="op" id="4516652">,</span>&nbsp;<span class="ident" id="4516654">t</span><span class="op" id="4516655">.</span><span class="ident" id="4516656">Len</span><span class="op" id="4516659">(</span><span class="op" id="4516660">)</span><span class="op" id="4516661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516665">return</span>&nbsp;<span class="ident" id="4516672">at</span><span class="op" id="4516674">,</span>&nbsp;<span class="ident" id="4516676">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516682">case</span>&nbsp;<span class="ident" id="4516687">reflect</span><span class="op" id="4516694">.</span><span class="ident" id="4516695">Map</span><span class="op" id="4516698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516702">mt</span>&nbsp;<span class="op" id="4516705">:=</span>&nbsp;<span class="ident" id="4516708">newMapType</span><span class="op" id="4516718">(</span><span class="ident" id="4516719">name</span><span class="op" id="4516723">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516727">types</span><span class="op" id="4516732">[</span><span class="ident" id="4516733">rt</span><span class="op" id="4516735">]</span>&nbsp;<span class="op" id="4516737">=</span>&nbsp;<span class="ident" id="4516739">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516744">type0</span><span class="op" id="4516749">,</span>&nbsp;<span class="ident" id="4516751">err</span>&nbsp;<span class="op" id="4516755">=</span>&nbsp;<span class="ident" id="4516757">getBaseType</span><span class="op" id="4516768">(</span><span class="string" id="4516769">&#34;&#34;</span><span class="op" id="4516771">,</span>&nbsp;<span class="ident" id="4516773">t</span><span class="op" id="4516774">.</span><span class="ident" id="4516775">Key</span><span class="op" id="4516778">(</span><span class="op" id="4516779">)</span><span class="op" id="4516780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516784">if</span>&nbsp;<span class="ident" id="4516787">err</span>&nbsp;<span class="op" id="4516791">!=</span>&nbsp;<span class="ident" id="4516794">nil</span>&nbsp;<span class="op" id="4516798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516803">return</span>&nbsp;<span class="ident" id="4516810">nil</span><span class="op" id="4516813">,</span>&nbsp;<span class="ident" id="4516815">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516821">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516825">type1</span><span class="op" id="4516830">,</span>&nbsp;<span class="ident" id="4516832">err</span>&nbsp;<span class="op" id="4516836">=</span>&nbsp;<span class="ident" id="4516838">getBaseType</span><span class="op" id="4516849">(</span><span class="string" id="4516850">&#34;&#34;</span><span class="op" id="4516852">,</span>&nbsp;<span class="ident" id="4516854">t</span><span class="op" id="4516855">.</span><span class="ident" id="4516856">Elem</span><span class="op" id="4516860">(</span><span class="op" id="4516861">)</span><span class="op" id="4516862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516866">if</span>&nbsp;<span class="ident" id="4516869">err</span>&nbsp;<span class="op" id="4516873">!=</span>&nbsp;<span class="ident" id="4516876">nil</span>&nbsp;<span class="op" id="4516880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516885">return</span>&nbsp;<span class="ident" id="4516892">nil</span><span class="op" id="4516895">,</span>&nbsp;<span class="ident" id="4516897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516907">mt</span><span class="op" id="4516909">.</span><span class="ident" id="4516910">init</span><span class="op" id="4516914">(</span><span class="ident" id="4516915">type0</span><span class="op" id="4516920">,</span>&nbsp;<span class="ident" id="4516922">type1</span><span class="op" id="4516927">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516931">return</span>&nbsp;<span class="ident" id="4516938">mt</span><span class="op" id="4516940">,</span>&nbsp;<span class="ident" id="4516942">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516948">case</span>&nbsp;<span class="ident" id="4516953">reflect</span><span class="op" id="4516960">.</span><span class="ident" id="4516961">Slice</span><span class="op" id="4516966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516970">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517011">if</span>&nbsp;<span class="ident" id="4517014">t</span><span class="op" id="4517015">.</span><span class="ident" id="4517016">Elem</span><span class="op" id="4517020">(</span><span class="op" id="4517021">)</span><span class="op" id="4517022">.</span><span class="ident" id="4517023">Kind</span><span class="op" id="4517027">(</span><span class="op" id="4517028">)</span>&nbsp;<span class="op" id="4517030">==</span>&nbsp;<span class="ident" id="4517033">reflect</span><span class="op" id="4517040">.</span><span class="ident" id="4517041">Uint8</span>&nbsp;<span class="op" id="4517047">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517052">return</span>&nbsp;<span class="ident" id="4517059">tBytes</span><span class="op" id="4517065">.</span><span class="ident" id="4517066">gobType</span><span class="op" id="4517073">(</span><span class="op" id="4517074">)</span><span class="op" id="4517075">,</span>&nbsp;<span class="ident" id="4517077">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517087">st</span>&nbsp;<span class="op" id="4517090">:=</span>&nbsp;<span class="ident" id="4517093">newSliceType</span><span class="op" id="4517105">(</span><span class="ident" id="4517106">name</span><span class="op" id="4517110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517114">types</span><span class="op" id="4517119">[</span><span class="ident" id="4517120">rt</span><span class="op" id="4517122">]</span>&nbsp;<span class="op" id="4517124">=</span>&nbsp;<span class="ident" id="4517126">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517131">type0</span><span class="op" id="4517136">,</span>&nbsp;<span class="ident" id="4517138">err</span>&nbsp;<span class="op" id="4517142">=</span>&nbsp;<span class="ident" id="4517144">getBaseType</span><span class="op" id="4517155">(</span><span class="ident" id="4517156">t</span><span class="op" id="4517157">.</span><span class="ident" id="4517158">Elem</span><span class="op" id="4517162">(</span><span class="op" id="4517163">)</span><span class="op" id="4517164">.</span><span class="ident" id="4517165">Name</span><span class="op" id="4517169">(</span><span class="op" id="4517170">)</span><span class="op" id="4517171">,</span>&nbsp;<span class="ident" id="4517173">t</span><span class="op" id="4517174">.</span><span class="ident" id="4517175">Elem</span><span class="op" id="4517179">(</span><span class="op" id="4517180">)</span><span class="op" id="4517181">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517185">if</span>&nbsp;<span class="ident" id="4517188">err</span>&nbsp;<span class="op" id="4517192">!=</span>&nbsp;<span class="ident" id="4517195">nil</span>&nbsp;<span class="op" id="4517199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517204">return</span>&nbsp;<span class="ident" id="4517211">nil</span><span class="op" id="4517214">,</span>&nbsp;<span class="ident" id="4517216">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517226">st</span><span class="op" id="4517228">.</span><span class="ident" id="4517229">init</span><span class="op" id="4517233">(</span><span class="ident" id="4517234">type0</span><span class="op" id="4517239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517243">return</span>&nbsp;<span class="ident" id="4517250">st</span><span class="op" id="4517252">,</span>&nbsp;<span class="ident" id="4517254">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517260">case</span>&nbsp;<span class="ident" id="4517265">reflect</span><span class="op" id="4517272">.</span><span class="ident" id="4517273">Struct</span><span class="op" id="4517279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517283">st</span>&nbsp;<span class="op" id="4517286">:=</span>&nbsp;<span class="ident" id="4517289">newStructType</span><span class="op" id="4517302">(</span><span class="ident" id="4517303">name</span><span class="op" id="4517307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517311">types</span><span class="op" id="4517316">[</span><span class="ident" id="4517317">rt</span><span class="op" id="4517319">]</span>&nbsp;<span class="op" id="4517321">=</span>&nbsp;<span class="ident" id="4517323">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517328">idToType</span><span class="op" id="4517336">[</span><span class="ident" id="4517337">st</span><span class="op" id="4517339">.</span><span class="ident" id="4517340">id</span><span class="op" id="4517342">(</span><span class="op" id="4517343">)</span><span class="op" id="4517344">]</span>&nbsp;<span class="op" id="4517346">=</span>&nbsp;<span class="ident" id="4517348">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517353">for</span>&nbsp;<span class="ident" id="4517357">i</span>&nbsp;<span class="op" id="4517359">:=</span>&nbsp;<span class="num" id="4517362">0</span><span class="op" id="4517363">;</span>&nbsp;<span class="ident" id="4517365">i</span>&nbsp;<span class="op" id="4517367">&lt;</span>&nbsp;<span class="ident" id="4517369">t</span><span class="op" id="4517370">.</span><span class="ident" id="4517371">NumField</span><span class="op" id="4517379">(</span><span class="op" id="4517380">)</span><span class="op" id="4517381">;</span>&nbsp;<span class="ident" id="4517383">i</span><span class="op" id="4517384">++</span>&nbsp;<span class="op" id="4517387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517392">f</span>&nbsp;<span class="op" id="4517394">:=</span>&nbsp;<span class="ident" id="4517397">t</span><span class="op" id="4517398">.</span><span class="ident" id="4517399">Field</span><span class="op" id="4517404">(</span><span class="ident" id="4517405">i</span><span class="op" id="4517406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517411">if</span>&nbsp;<span class="op" id="4517414">!</span><span class="ident" id="4517415">isSent</span><span class="op" id="4517421">(</span><span class="op" id="4517422">&amp;</span><span class="ident" id="4517423">f</span><span class="op" id="4517424">)</span>&nbsp;<span class="op" id="4517426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517432">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517444">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517449">typ</span>&nbsp;<span class="op" id="4517453">:=</span>&nbsp;<span class="ident" id="4517456">userType</span><span class="op" id="4517464">(</span><span class="ident" id="4517465">f</span><span class="op" id="4517466">.</span><span class="ident" id="4517467">Type</span><span class="op" id="4517471">)</span><span class="op" id="4517472">.</span><span class="ident" id="4517473">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517481">tname</span>&nbsp;<span class="op" id="4517487">:=</span>&nbsp;<span class="ident" id="4517490">typ</span><span class="op" id="4517493">.</span><span class="ident" id="4517494">Name</span><span class="op" id="4517498">(</span><span class="op" id="4517499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517504">if</span>&nbsp;<span class="ident" id="4517507">tname</span>&nbsp;<span class="op" id="4517513">==</span>&nbsp;<span class="string" id="4517516">&#34;&#34;</span>&nbsp;<span class="op" id="4517519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517525">t</span>&nbsp;<span class="op" id="4517527">:=</span>&nbsp;<span class="ident" id="4517530">userType</span><span class="op" id="4517538">(</span><span class="ident" id="4517539">f</span><span class="op" id="4517540">.</span><span class="ident" id="4517541">Type</span><span class="op" id="4517545">)</span><span class="op" id="4517546">.</span><span class="ident" id="4517547">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517556">tname</span>&nbsp;<span class="op" id="4517562">=</span>&nbsp;<span class="ident" id="4517564">t</span><span class="op" id="4517565">.</span><span class="ident" id="4517566">String</span><span class="op" id="4517572">(</span><span class="op" id="4517573">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517583">gt</span><span class="op" id="4517585">,</span>&nbsp;<span class="ident" id="4517587">err</span>&nbsp;<span class="op" id="4517591">:=</span>&nbsp;<span class="ident" id="4517594">getBaseType</span><span class="op" id="4517605">(</span><span class="ident" id="4517606">tname</span><span class="op" id="4517611">,</span>&nbsp;<span class="ident" id="4517613">f</span><span class="op" id="4517614">.</span><span class="ident" id="4517615">Type</span><span class="op" id="4517619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517624">if</span>&nbsp;<span class="ident" id="4517627">err</span>&nbsp;<span class="op" id="4517631">!=</span>&nbsp;<span class="ident" id="4517634">nil</span>&nbsp;<span class="op" id="4517638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517644">return</span>&nbsp;<span class="ident" id="4517651">nil</span><span class="op" id="4517654">,</span>&nbsp;<span class="ident" id="4517656">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517663">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517668">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517734">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517798">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517867">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517937">if</span>&nbsp;<span class="ident" id="4517940">gt</span><span class="op" id="4517942">.</span><span class="ident" id="4517943">id</span><span class="op" id="4517945">(</span><span class="op" id="4517946">)</span>&nbsp;<span class="op" id="4517948">==</span>&nbsp;<span class="num" id="4517951">0</span>&nbsp;<span class="op" id="4517953">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517959">setTypeId</span><span class="op" id="4517968">(</span><span class="ident" id="4517969">gt</span><span class="op" id="4517971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517981">st</span><span class="op" id="4517983">.</span><span class="ident" id="4517984">Field</span>&nbsp;<span class="op" id="4517990">=</span>&nbsp;<span class="builtinfunc" id="4517992">append</span><span class="op" id="4517998">(</span><span class="ident" id="4517999">st</span><span class="op" id="4518001">.</span><span class="ident" id="4518002">Field</span><span class="op" id="4518007">,</span>&nbsp;<span class="op" id="4518009">&amp;</span><span class="ident" id="4518010">fieldType</span><span class="op" id="4518019">{</span><span class="ident" id="4518020">f</span><span class="op" id="4518021">.</span><span class="ident" id="4518022">Name</span><span class="op" id="4518026">,</span>&nbsp;<span class="ident" id="4518028">gt</span><span class="op" id="4518030">.</span><span class="ident" id="4518031">id</span><span class="op" id="4518033">(</span><span class="op" id="4518034">)</span><span class="op" id="4518035">}</span><span class="op" id="4518036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518044">return</span>&nbsp;<span class="ident" id="4518051">st</span><span class="op" id="4518053">,</span>&nbsp;<span class="ident" id="4518055">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518061">default</span><span class="op" id="4518068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518072">return</span>&nbsp;<span class="ident" id="4518079">nil</span><span class="op" id="4518082">,</span>&nbsp;<span class="ident" id="4518084">errors</span><span class="op" id="4518090">.</span><span class="ident" id="4518091">New</span><span class="op" id="4518094">(</span><span class="string" id="4518095">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4518135">+</span>&nbsp;<span class="ident" id="4518137">rt</span><span class="op" id="4518139">.</span><span class="ident" id="4518140">String</span><span class="op" id="4518146">(</span><span class="op" id="4518147">)</span><span class="op" id="4518148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518151">}</span><br>
<span class="lineno"></span><span class="op" id="4518153">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4518156">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4518227">func</span>&nbsp;<span class="ident" id="4518232">isExported</span><span class="op" id="4518242">(</span><span class="ident" id="4518243">name</span>&nbsp;<span class="builtintype" id="4518248">string</span><span class="op" id="4518254">)</span>&nbsp;<span class="builtintype" id="4518256">bool</span>&nbsp;<span class="op" id="4518261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4518264">rune</span><span class="op" id="4518268">,</span>&nbsp;<span class="ident" id="4518270">_</span>&nbsp;<span class="op" id="4518272">:=</span>&nbsp;<span class="ident" id="4518275">utf8</span><span class="op" id="4518279">.</span><span class="ident" id="4518280">DecodeRuneInString</span><span class="op" id="4518298">(</span><span class="ident" id="4518299">name</span><span class="op" id="4518303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518306">return</span>&nbsp;<span class="ident" id="4518313">unicode</span><span class="op" id="4518320">.</span><span class="ident" id="4518321">IsUpper</span><span class="op" id="4518328">(</span><span class="builtintype" id="4518329">rune</span><span class="op" id="4518333">)</span><br>
<span class="lineno">570</span><span class="op" id="4518335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4518338">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="4518404">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4518482">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="4518513">func</span>&nbsp;<span class="ident" id="4518518">isSent</span><span class="op" id="4518524">(</span><span class="ident" id="4518525">field</span>&nbsp;<span class="op" id="4518531">*</span><span class="ident" id="4518532">reflect</span><span class="op" id="4518539">.</span><span class="ident" id="4518540">StructField</span><span class="op" id="4518551">)</span>&nbsp;<span class="builtintype" id="4518553">bool</span>&nbsp;<span class="op" id="4518558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518561">if</span>&nbsp;<span class="op" id="4518564">!</span><span class="ident" id="4518565">isExported</span><span class="op" id="4518575">(</span><span class="ident" id="4518576">field</span><span class="op" id="4518581">.</span><span class="ident" id="4518582">Name</span><span class="op" id="4518586">)</span>&nbsp;<span class="op" id="4518588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518592">return</span>&nbsp;<span class="builtintype" id="4518599">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518609">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518679">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518727">typ</span>&nbsp;<span class="op" id="4518731">:=</span>&nbsp;<span class="ident" id="4518734">field</span><span class="op" id="4518739">.</span><span class="ident" id="4518740">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518746">for</span>&nbsp;<span class="ident" id="4518750">typ</span><span class="op" id="4518753">.</span><span class="ident" id="4518754">Kind</span><span class="op" id="4518758">(</span><span class="op" id="4518759">)</span>&nbsp;<span class="op" id="4518761">==</span>&nbsp;<span class="ident" id="4518764">reflect</span><span class="op" id="4518771">.</span><span class="ident" id="4518772">Ptr</span>&nbsp;<span class="op" id="4518776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518780">typ</span>&nbsp;<span class="op" id="4518784">=</span>&nbsp;<span class="ident" id="4518786">typ</span><span class="op" id="4518789">.</span><span class="ident" id="4518790">Elem</span><span class="op" id="4518794">(</span><span class="op" id="4518795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518798">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518801">if</span>&nbsp;<span class="ident" id="4518804">typ</span><span class="op" id="4518807">.</span><span class="ident" id="4518808">Kind</span><span class="op" id="4518812">(</span><span class="op" id="4518813">)</span>&nbsp;<span class="op" id="4518815">==</span>&nbsp;<span class="ident" id="4518818">reflect</span><span class="op" id="4518825">.</span><span class="ident" id="4518826">Chan</span>&nbsp;<span class="op" id="4518831">||</span>&nbsp;<span class="ident" id="4518834">typ</span><span class="op" id="4518837">.</span><span class="ident" id="4518838">Kind</span><span class="op" id="4518842">(</span><span class="op" id="4518843">)</span>&nbsp;<span class="op" id="4518845">==</span>&nbsp;<span class="ident" id="4518848">reflect</span><span class="op" id="4518855">.</span><span class="ident" id="4518856">Func</span>&nbsp;<span class="op" id="4518861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518865">return</span>&nbsp;<span class="builtintype" id="4518872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4518882">return</span>&nbsp;<span class="builtintype" id="4518889">true</span><br>
<span class="lineno"></span><span class="op" id="4518894">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="4518897">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4518980">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4519006">func</span>&nbsp;<span class="ident" id="4519011">getBaseType</span><span class="op" id="4519022">(</span><span class="ident" id="4519023">name</span>&nbsp;<span class="builtintype" id="4519028">string</span><span class="op" id="4519034">,</span>&nbsp;<span class="ident" id="4519036">rt</span>&nbsp;<span class="ident" id="4519039">reflect</span><span class="op" id="4519046">.</span><span class="ident" id="4519047">Type</span><span class="op" id="4519051">)</span>&nbsp;<span class="op" id="4519053">(</span><span class="ident" id="4519054">gobType</span><span class="op" id="4519061">,</span>&nbsp;<span class="builtintype" id="4519063">error</span><span class="op" id="4519068">)</span>&nbsp;<span class="op" id="4519070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519073">ut</span>&nbsp;<span class="op" id="4519076">:=</span>&nbsp;<span class="ident" id="4519079">userType</span><span class="op" id="4519087">(</span><span class="ident" id="4519088">rt</span><span class="op" id="4519090">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519093">return</span>&nbsp;<span class="ident" id="4519100">getType</span><span class="op" id="4519107">(</span><span class="ident" id="4519108">name</span><span class="op" id="4519112">,</span>&nbsp;<span class="ident" id="4519114">ut</span><span class="op" id="4519116">,</span>&nbsp;<span class="ident" id="4519118">ut</span><span class="op" id="4519120">.</span><span class="ident" id="4519121">base</span><span class="op" id="4519125">)</span><br>
<span class="lineno"></span><span class="op" id="4519127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4519130">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="4519197">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="4519258">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4519325">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="4519356">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4519382">func</span>&nbsp;<span class="ident" id="4519387">getType</span><span class="op" id="4519394">(</span><span class="ident" id="4519395">name</span>&nbsp;<span class="builtintype" id="4519400">string</span><span class="op" id="4519406">,</span>&nbsp;<span class="ident" id="4519408">ut</span>&nbsp;<span class="op" id="4519411">*</span><span class="ident" id="4519412">userTypeInfo</span><span class="op" id="4519424">,</span>&nbsp;<span class="ident" id="4519426">rt</span>&nbsp;<span class="ident" id="4519429">reflect</span><span class="op" id="4519436">.</span><span class="ident" id="4519437">Type</span><span class="op" id="4519441">)</span>&nbsp;<span class="op" id="4519443">(</span><span class="ident" id="4519444">gobType</span><span class="op" id="4519451">,</span>&nbsp;<span class="builtintype" id="4519453">error</span><span class="op" id="4519458">)</span>&nbsp;<span class="op" id="4519460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519463">typ</span><span class="op" id="4519466">,</span>&nbsp;<span class="ident" id="4519468">present</span>&nbsp;<span class="op" id="4519476">:=</span>&nbsp;<span class="ident" id="4519479">types</span><span class="op" id="4519484">[</span><span class="ident" id="4519485">rt</span><span class="op" id="4519487">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519490">if</span>&nbsp;<span class="ident" id="4519493">present</span>&nbsp;<span class="op" id="4519501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519505">return</span>&nbsp;<span class="ident" id="4519512">typ</span><span class="op" id="4519515">,</span>&nbsp;<span class="ident" id="4519517">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4519522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519525">typ</span><span class="op" id="4519528">,</span>&nbsp;<span class="ident" id="4519530">err</span>&nbsp;<span class="op" id="4519534">:=</span>&nbsp;<span class="ident" id="4519537">newTypeObject</span><span class="op" id="4519550">(</span><span class="ident" id="4519551">name</span><span class="op" id="4519555">,</span>&nbsp;<span class="ident" id="4519557">ut</span><span class="op" id="4519559">,</span>&nbsp;<span class="ident" id="4519561">rt</span><span class="op" id="4519563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519566">if</span>&nbsp;<span class="ident" id="4519569">err</span>&nbsp;<span class="op" id="4519573">==</span>&nbsp;<span class="ident" id="4519576">nil</span>&nbsp;<span class="op" id="4519580">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519584">types</span><span class="op" id="4519589">[</span><span class="ident" id="4519590">rt</span><span class="op" id="4519592">]</span>&nbsp;<span class="op" id="4519594">=</span>&nbsp;<span class="ident" id="4519596">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4519601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519604">return</span>&nbsp;<span class="ident" id="4519611">typ</span><span class="op" id="4519614">,</span>&nbsp;<span class="ident" id="4519616">err</span><br>
<span class="lineno"></span><span class="op" id="4519620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="4519623">func</span>&nbsp;<span class="ident" id="4519628">checkId</span><span class="op" id="4519635">(</span><span class="ident" id="4519636">want</span><span class="op" id="4519640">,</span>&nbsp;<span class="ident" id="4519642">got</span>&nbsp;<span class="ident" id="4519646">typeId</span><span class="op" id="4519652">)</span>&nbsp;<span class="op" id="4519654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519657">if</span>&nbsp;<span class="ident" id="4519660">want</span>&nbsp;<span class="op" id="4519665">!=</span>&nbsp;<span class="ident" id="4519668">got</span>&nbsp;<span class="op" id="4519672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519676">fmt</span><span class="op" id="4519679">.</span><span class="ident" id="4519680">Fprintf</span><span class="op" id="4519687">(</span><span class="ident" id="4519688">os</span><span class="op" id="4519690">.</span><span class="ident" id="4519691">Stderr</span><span class="op" id="4519697">,</span>&nbsp;<span class="string" id="4519699">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="4519727">,</span>&nbsp;<span class="builtintype" id="4519729">int</span><span class="op" id="4519732">(</span><span class="ident" id="4519733">got</span><span class="op" id="4519736">)</span><span class="op" id="4519737">,</span>&nbsp;<span class="builtintype" id="4519739">int</span><span class="op" id="4519742">(</span><span class="ident" id="4519743">want</span><span class="op" id="4519747">)</span><span class="op" id="4519748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4519752">panic</span><span class="op" id="4519757">(</span><span class="string" id="4519758">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="4519786">+</span>&nbsp;<span class="ident" id="4519788">got</span><span class="op" id="4519791">.</span><span class="ident" id="4519792">name</span><span class="op" id="4519796">(</span><span class="op" id="4519797">)</span>&nbsp;<span class="op" id="4519799">+</span>&nbsp;<span class="string" id="4519801">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4519805">+</span>&nbsp;<span class="ident" id="4519807">got</span><span class="op" id="4519810">.</span><span class="builtintype" id="4519811">string</span><span class="op" id="4519817">(</span><span class="op" id="4519818">)</span>&nbsp;<span class="op" id="4519820">+</span>&nbsp;<span class="string" id="4519822">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4519830">+</span>&nbsp;<span class="ident" id="4519832">want</span><span class="op" id="4519836">.</span><span class="builtintype" id="4519837">string</span><span class="op" id="4519843">(</span><span class="op" id="4519844">)</span><span class="op" id="4519845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4519848">}</span><br>
<span class="lineno">620</span><span class="op" id="4519850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4519853">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4519930">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="4519971">func</span>&nbsp;<span class="ident" id="4519976">bootstrapType</span><span class="op" id="4519989">(</span><span class="ident" id="4519990">name</span>&nbsp;<span class="builtintype" id="4519995">string</span><span class="op" id="4520001">,</span>&nbsp;<span class="ident" id="4520003">e</span>&nbsp;<span class="keyword" id="4520005">interface</span><span class="op" id="4520014">{</span><span class="op" id="4520015">}</span><span class="op" id="4520016">,</span>&nbsp;<span class="ident" id="4520018">expect</span>&nbsp;<span class="ident" id="4520025">typeId</span><span class="op" id="4520031">)</span>&nbsp;<span class="ident" id="4520033">typeId</span>&nbsp;<span class="op" id="4520040">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520043">rt</span>&nbsp;<span class="op" id="4520046">:=</span>&nbsp;<span class="ident" id="4520049">reflect</span><span class="op" id="4520056">.</span><span class="ident" id="4520057">TypeOf</span><span class="op" id="4520063">(</span><span class="ident" id="4520064">e</span><span class="op" id="4520065">)</span><span class="op" id="4520066">.</span><span class="ident" id="4520067">Elem</span><span class="op" id="4520071">(</span><span class="op" id="4520072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520075">_</span><span class="op" id="4520076">,</span>&nbsp;<span class="ident" id="4520078">present</span>&nbsp;<span class="op" id="4520086">:=</span>&nbsp;<span class="ident" id="4520089">types</span><span class="op" id="4520094">[</span><span class="ident" id="4520095">rt</span><span class="op" id="4520097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520100">if</span>&nbsp;<span class="ident" id="4520103">present</span>&nbsp;<span class="op" id="4520111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4520115">panic</span><span class="op" id="4520120">(</span><span class="string" id="4520121">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="4520156">+</span>&nbsp;<span class="ident" id="4520158">name</span>&nbsp;<span class="op" id="4520163">+</span>&nbsp;<span class="string" id="4520165">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="4520170">+</span>&nbsp;<span class="ident" id="4520172">rt</span><span class="op" id="4520174">.</span><span class="ident" id="4520175">String</span><span class="op" id="4520181">(</span><span class="op" id="4520182">)</span><span class="op" id="4520183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4520186">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520189">typ</span>&nbsp;<span class="op" id="4520193">:=</span>&nbsp;<span class="op" id="4520196">&amp;</span><span class="ident" id="4520197">CommonType</span><span class="op" id="4520207">{</span><span class="ident" id="4520208">Name</span><span class="op" id="4520212">:</span>&nbsp;<span class="ident" id="4520214">name</span><span class="op" id="4520218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520221">types</span><span class="op" id="4520226">[</span><span class="ident" id="4520227">rt</span><span class="op" id="4520229">]</span>&nbsp;<span class="op" id="4520231">=</span>&nbsp;<span class="ident" id="4520233">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520238">setTypeId</span><span class="op" id="4520247">(</span><span class="ident" id="4520248">typ</span><span class="op" id="4520251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520254">checkId</span><span class="op" id="4520261">(</span><span class="ident" id="4520262">expect</span><span class="op" id="4520268">,</span>&nbsp;<span class="ident" id="4520270">nextId</span><span class="op" id="4520276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520279">userType</span><span class="op" id="4520287">(</span><span class="ident" id="4520288">rt</span><span class="op" id="4520290">)</span>&nbsp;<span class="comment" id="4520292">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520323">return</span>&nbsp;<span class="ident" id="4520330">nextId</span><br>
<span class="lineno"></span><span class="op" id="4520337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4520340">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4520414">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="4520488">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="4520562">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="4520582">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="4520652">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="4520729">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="4520803">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="4520875">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4520920">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="4520993">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="4521017">type</span>&nbsp;<span class="ident" id="4521022">wireType</span>&nbsp;<span class="keyword" id="4521031">struct</span>&nbsp;<span class="op" id="4521038">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521041">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521058">*</span><span class="ident" id="4521059">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521070">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521087">*</span><span class="ident" id="4521088">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521099">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521116">*</span><span class="ident" id="4521117">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521129">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521146">*</span><span class="ident" id="4521147">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521156">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521173">*</span><span class="ident" id="4521174">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521190">BinaryMarshalerT</span>&nbsp;<span class="op" id="4521207">*</span><span class="ident" id="4521208">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521224">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4521241">*</span><span class="ident" id="4521242">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="4521257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521260">func</span>&nbsp;<span class="op" id="4521265">(</span><span class="ident" id="4521266">w</span>&nbsp;<span class="op" id="4521268">*</span><span class="ident" id="4521269">wireType</span><span class="op" id="4521277">)</span>&nbsp;<span class="builtintype" id="4521279">string</span><span class="op" id="4521285">(</span><span class="op" id="4521286">)</span>&nbsp;<span class="builtintype" id="4521288">string</span>&nbsp;<span class="op" id="4521295">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521298">const</span>&nbsp;<span class="ident" id="4521304">unknown</span>&nbsp;<span class="op" id="4521312">=</span>&nbsp;<span class="string" id="4521314">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521330">if</span>&nbsp;<span class="ident" id="4521333">w</span>&nbsp;<span class="op" id="4521335">==</span>&nbsp;<span class="ident" id="4521338">nil</span>&nbsp;<span class="op" id="4521342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521346">return</span>&nbsp;<span class="ident" id="4521353">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4521362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521365">switch</span>&nbsp;<span class="op" id="4521372">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521375">case</span>&nbsp;<span class="ident" id="4521380">w</span><span class="op" id="4521381">.</span><span class="ident" id="4521382">ArrayT</span>&nbsp;<span class="op" id="4521389">!=</span>&nbsp;<span class="ident" id="4521392">nil</span><span class="op" id="4521395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521399">return</span>&nbsp;<span class="ident" id="4521406">w</span><span class="op" id="4521407">.</span><span class="ident" id="4521408">ArrayT</span><span class="op" id="4521414">.</span><span class="ident" id="4521415">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521421">case</span>&nbsp;<span class="ident" id="4521426">w</span><span class="op" id="4521427">.</span><span class="ident" id="4521428">SliceT</span>&nbsp;<span class="op" id="4521435">!=</span>&nbsp;<span class="ident" id="4521438">nil</span><span class="op" id="4521441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521445">return</span>&nbsp;<span class="ident" id="4521452">w</span><span class="op" id="4521453">.</span><span class="ident" id="4521454">SliceT</span><span class="op" id="4521460">.</span><span class="ident" id="4521461">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521467">case</span>&nbsp;<span class="ident" id="4521472">w</span><span class="op" id="4521473">.</span><span class="ident" id="4521474">StructT</span>&nbsp;<span class="op" id="4521482">!=</span>&nbsp;<span class="ident" id="4521485">nil</span><span class="op" id="4521488">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521492">return</span>&nbsp;<span class="ident" id="4521499">w</span><span class="op" id="4521500">.</span><span class="ident" id="4521501">StructT</span><span class="op" id="4521508">.</span><span class="ident" id="4521509">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521515">case</span>&nbsp;<span class="ident" id="4521520">w</span><span class="op" id="4521521">.</span><span class="ident" id="4521522">MapT</span>&nbsp;<span class="op" id="4521527">!=</span>&nbsp;<span class="ident" id="4521530">nil</span><span class="op" id="4521533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521537">return</span>&nbsp;<span class="ident" id="4521544">w</span><span class="op" id="4521545">.</span><span class="ident" id="4521546">MapT</span><span class="op" id="4521550">.</span><span class="ident" id="4521551">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521557">case</span>&nbsp;<span class="ident" id="4521562">w</span><span class="op" id="4521563">.</span><span class="ident" id="4521564">GobEncoderT</span>&nbsp;<span class="op" id="4521576">!=</span>&nbsp;<span class="ident" id="4521579">nil</span><span class="op" id="4521582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521586">return</span>&nbsp;<span class="ident" id="4521593">w</span><span class="op" id="4521594">.</span><span class="ident" id="4521595">GobEncoderT</span><span class="op" id="4521606">.</span><span class="ident" id="4521607">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521613">case</span>&nbsp;<span class="ident" id="4521618">w</span><span class="op" id="4521619">.</span><span class="ident" id="4521620">BinaryMarshalerT</span>&nbsp;<span class="op" id="4521637">!=</span>&nbsp;<span class="ident" id="4521640">nil</span><span class="op" id="4521643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521647">return</span>&nbsp;<span class="ident" id="4521654">w</span><span class="op" id="4521655">.</span><span class="ident" id="4521656">BinaryMarshalerT</span><span class="op" id="4521672">.</span><span class="ident" id="4521673">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521679">case</span>&nbsp;<span class="ident" id="4521684">w</span><span class="op" id="4521685">.</span><span class="ident" id="4521686">TextMarshalerT</span>&nbsp;<span class="op" id="4521701">!=</span>&nbsp;<span class="ident" id="4521704">nil</span><span class="op" id="4521707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521711">return</span>&nbsp;<span class="ident" id="4521718">w</span><span class="op" id="4521719">.</span><span class="ident" id="4521720">TextMarshalerT</span><span class="op" id="4521734">.</span><span class="ident" id="4521735">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4521741">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521744">return</span>&nbsp;<span class="ident" id="4521751">unknown</span><br>
<span class="lineno"></span><span class="op" id="4521759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521762">type</span>&nbsp;<span class="ident" id="4521767">typeInfo</span>&nbsp;<span class="keyword" id="4521776">struct</span>&nbsp;<span class="op" id="4521783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521786">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521794">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521802">encInit</span>&nbsp;<span class="ident" id="4521810">sync</span><span class="op" id="4521814">.</span><span class="ident" id="4521815">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4521823">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521856">encoder</span>&nbsp;<span class="ident" id="4521864">atomic</span><span class="op" id="4521870">.</span><span class="ident" id="4521871">Value</span>&nbsp;<span class="comment" id="4521877">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521892">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521900">*</span><span class="ident" id="4521901">wireType</span><br>
<span class="lineno"></span><span class="op" id="4521910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="4521913">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="4521980">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="4522042">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4522112">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4522182">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="4522254">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="4522279">var</span>&nbsp;<span class="ident" id="4522283">typeInfoMap</span>&nbsp;<span class="ident" id="4522295">atomic</span><span class="op" id="4522301">.</span><span class="ident" id="4522302">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4522309">func</span>&nbsp;<span class="ident" id="4522314">lookupTypeInfo</span><span class="op" id="4522328">(</span><span class="ident" id="4522329">rt</span>&nbsp;<span class="ident" id="4522332">reflect</span><span class="op" id="4522339">.</span><span class="ident" id="4522340">Type</span><span class="op" id="4522344">)</span>&nbsp;<span class="op" id="4522346">*</span><span class="ident" id="4522347">typeInfo</span>&nbsp;<span class="op" id="4522356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4522359">m</span><span class="op" id="4522360">,</span>&nbsp;<span class="ident" id="4522362">_</span>&nbsp;<span class="op" id="4522364">:=</span>&nbsp;<span class="ident" id="4522367">typeInfoMap</span><span class="op" id="4522378">.</span><span class="ident" id="4522379">Load</span><span class="op" id="4522383">(</span><span class="op" id="4522384">)</span><span class="op" id="4522385">.</span><span class="op" id="4522386">(</span><span class="keyword" id="4522387">map</span><span class="op" id="4522390">[</span><span class="ident" id="4522391">reflect</span><span class="op" id="4522398">.</span><span class="ident" id="4522399">Type</span><span class="op" id="4522403">]</span><span class="op" id="4522404">*</span><span class="ident" id="4522405">typeInfo</span><span class="op" id="4522413">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522416">return</span>&nbsp;<span class="ident" id="4522423">m</span><span class="op" id="4522424">[</span><span class="ident" id="4522425">rt</span><span class="op" id="4522427">]</span><br>
<span class="lineno"></span><span class="op" id="4522429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4522432">func</span>&nbsp;<span class="ident" id="4522437">getTypeInfo</span><span class="op" id="4522448">(</span><span class="ident" id="4522449">ut</span>&nbsp;<span class="op" id="4522452">*</span><span class="ident" id="4522453">userTypeInfo</span><span class="op" id="4522465">)</span>&nbsp;<span class="op" id="4522467">(</span><span class="op" id="4522468">*</span><span class="ident" id="4522469">typeInfo</span><span class="op" id="4522477">,</span>&nbsp;<span class="builtintype" id="4522479">error</span><span class="op" id="4522484">)</span>&nbsp;<span class="op" id="4522486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4522489">rt</span>&nbsp;<span class="op" id="4522492">:=</span>&nbsp;<span class="ident" id="4522495">ut</span><span class="op" id="4522497">.</span><span class="ident" id="4522498">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522504">if</span>&nbsp;<span class="ident" id="4522507">ut</span><span class="op" id="4522509">.</span><span class="ident" id="4522510">externalEnc</span>&nbsp;<span class="op" id="4522522">!=</span>&nbsp;<span class="num" id="4522525">0</span>&nbsp;<span class="op" id="4522527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4522531">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4522578">rt</span>&nbsp;<span class="op" id="4522581">=</span>&nbsp;<span class="ident" id="4522583">ut</span><span class="op" id="4522585">.</span><span class="ident" id="4522586">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4522592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522595">if</span>&nbsp;<span class="ident" id="4522598">info</span>&nbsp;<span class="op" id="4522603">:=</span>&nbsp;<span class="ident" id="4522606">lookupTypeInfo</span><span class="op" id="4522620">(</span><span class="ident" id="4522621">rt</span><span class="op" id="4522623">)</span><span class="op" id="4522624">;</span>&nbsp;<span class="ident" id="4522626">info</span>&nbsp;<span class="op" id="4522631">!=</span>&nbsp;<span class="ident" id="4522634">nil</span>&nbsp;<span class="op" id="4522638">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522642">return</span>&nbsp;<span class="ident" id="4522649">info</span><span class="op" id="4522653">,</span>&nbsp;<span class="ident" id="4522655">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4522660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522663">return</span>&nbsp;<span class="ident" id="4522670">buildTypeInfo</span><span class="op" id="4522683">(</span><span class="ident" id="4522684">ut</span><span class="op" id="4522686">,</span>&nbsp;<span class="ident" id="4522688">rt</span><span class="op" id="4522690">)</span><br>
<span class="lineno"></span><span class="op" id="4522692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="4522695">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4522757">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="4522796">func</span>&nbsp;<span class="ident" id="4522801">buildTypeInfo</span><span class="op" id="4522814">(</span><span class="ident" id="4522815">ut</span>&nbsp;<span class="op" id="4522818">*</span><span class="ident" id="4522819">userTypeInfo</span><span class="op" id="4522831">,</span>&nbsp;<span class="ident" id="4522833">rt</span>&nbsp;<span class="ident" id="4522836">reflect</span><span class="op" id="4522843">.</span><span class="ident" id="4522844">Type</span><span class="op" id="4522848">)</span>&nbsp;<span class="op" id="4522850">(</span><span class="op" id="4522851">*</span><span class="ident" id="4522852">typeInfo</span><span class="op" id="4522860">,</span>&nbsp;<span class="builtintype" id="4522862">error</span><span class="op" id="4522867">)</span>&nbsp;<span class="op" id="4522869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4522872">typeLock</span><span class="op" id="4522880">.</span><span class="ident" id="4522881">Lock</span><span class="op" id="4522885">(</span><span class="op" id="4522886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522889">defer</span>&nbsp;<span class="ident" id="4522895">typeLock</span><span class="op" id="4522903">.</span><span class="ident" id="4522904">Unlock</span><span class="op" id="4522910">(</span><span class="op" id="4522911">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522915">if</span>&nbsp;<span class="ident" id="4522918">info</span>&nbsp;<span class="op" id="4522923">:=</span>&nbsp;<span class="ident" id="4522926">lookupTypeInfo</span><span class="op" id="4522940">(</span><span class="ident" id="4522941">rt</span><span class="op" id="4522943">)</span><span class="op" id="4522944">;</span>&nbsp;<span class="ident" id="4522946">info</span>&nbsp;<span class="op" id="4522951">!=</span>&nbsp;<span class="ident" id="4522954">nil</span>&nbsp;<span class="op" id="4522958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4522962">return</span>&nbsp;<span class="ident" id="4522969">info</span><span class="op" id="4522973">,</span>&nbsp;<span class="ident" id="4522975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4522980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4522984">gt</span><span class="op" id="4522986">,</span>&nbsp;<span class="ident" id="4522988">err</span>&nbsp;<span class="op" id="4522992">:=</span>&nbsp;<span class="ident" id="4522995">getBaseType</span><span class="op" id="4523006">(</span><span class="ident" id="4523007">rt</span><span class="op" id="4523009">.</span><span class="ident" id="4523010">Name</span><span class="op" id="4523014">(</span><span class="op" id="4523015">)</span><span class="op" id="4523016">,</span>&nbsp;<span class="ident" id="4523018">rt</span><span class="op" id="4523020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523023">if</span>&nbsp;<span class="ident" id="4523026">err</span>&nbsp;<span class="op" id="4523030">!=</span>&nbsp;<span class="ident" id="4523033">nil</span>&nbsp;<span class="op" id="4523037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523041">return</span>&nbsp;<span class="ident" id="4523048">nil</span><span class="op" id="4523051">,</span>&nbsp;<span class="ident" id="4523053">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523061">info</span>&nbsp;<span class="op" id="4523066">:=</span>&nbsp;<span class="op" id="4523069">&amp;</span><span class="ident" id="4523070">typeInfo</span><span class="op" id="4523078">{</span><span class="ident" id="4523079">id</span><span class="op" id="4523081">:</span>&nbsp;<span class="ident" id="4523083">gt</span><span class="op" id="4523085">.</span><span class="ident" id="4523086">id</span><span class="op" id="4523088">(</span><span class="op" id="4523089">)</span><span class="op" id="4523090">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523094">if</span>&nbsp;<span class="ident" id="4523097">ut</span><span class="op" id="4523099">.</span><span class="ident" id="4523100">externalEnc</span>&nbsp;<span class="op" id="4523112">!=</span>&nbsp;<span class="num" id="4523115">0</span>&nbsp;<span class="op" id="4523117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523121">userType</span><span class="op" id="4523129">,</span>&nbsp;<span class="ident" id="4523131">err</span>&nbsp;<span class="op" id="4523135">:=</span>&nbsp;<span class="ident" id="4523138">getType</span><span class="op" id="4523145">(</span><span class="ident" id="4523146">rt</span><span class="op" id="4523148">.</span><span class="ident" id="4523149">Name</span><span class="op" id="4523153">(</span><span class="op" id="4523154">)</span><span class="op" id="4523155">,</span>&nbsp;<span class="ident" id="4523157">ut</span><span class="op" id="4523159">,</span>&nbsp;<span class="ident" id="4523161">rt</span><span class="op" id="4523163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523167">if</span>&nbsp;<span class="ident" id="4523170">err</span>&nbsp;<span class="op" id="4523174">!=</span>&nbsp;<span class="ident" id="4523177">nil</span>&nbsp;<span class="op" id="4523181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523186">return</span>&nbsp;<span class="ident" id="4523193">nil</span><span class="op" id="4523196">,</span>&nbsp;<span class="ident" id="4523198">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523208">gt</span>&nbsp;<span class="op" id="4523211">:=</span>&nbsp;<span class="ident" id="4523214">userType</span><span class="op" id="4523222">.</span><span class="ident" id="4523223">id</span><span class="op" id="4523225">(</span><span class="op" id="4523226">)</span><span class="op" id="4523227">.</span><span class="ident" id="4523228">gobType</span><span class="op" id="4523235">(</span><span class="op" id="4523236">)</span><span class="op" id="4523237">.</span><span class="op" id="4523238">(</span><span class="op" id="4523239">*</span><span class="ident" id="4523240">gobEncoderType</span><span class="op" id="4523254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523258">switch</span>&nbsp;<span class="ident" id="4523265">ut</span><span class="op" id="4523267">.</span><span class="ident" id="4523268">externalEnc</span>&nbsp;<span class="op" id="4523280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523284">case</span>&nbsp;<span class="ident" id="4523289">xGob</span><span class="op" id="4523293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523298">info</span><span class="op" id="4523302">.</span><span class="ident" id="4523303">wire</span>&nbsp;<span class="op" id="4523308">=</span>&nbsp;<span class="op" id="4523310">&amp;</span><span class="ident" id="4523311">wireType</span><span class="op" id="4523319">{</span><span class="ident" id="4523320">GobEncoderT</span><span class="op" id="4523331">:</span>&nbsp;<span class="ident" id="4523333">gt</span><span class="op" id="4523335">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523339">case</span>&nbsp;<span class="ident" id="4523344">xBinary</span><span class="op" id="4523351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523356">info</span><span class="op" id="4523360">.</span><span class="ident" id="4523361">wire</span>&nbsp;<span class="op" id="4523366">=</span>&nbsp;<span class="op" id="4523368">&amp;</span><span class="ident" id="4523369">wireType</span><span class="op" id="4523377">{</span><span class="ident" id="4523378">BinaryMarshalerT</span><span class="op" id="4523394">:</span>&nbsp;<span class="ident" id="4523396">gt</span><span class="op" id="4523398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523402">case</span>&nbsp;<span class="ident" id="4523407">xText</span><span class="op" id="4523412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523417">info</span><span class="op" id="4523421">.</span><span class="ident" id="4523422">wire</span>&nbsp;<span class="op" id="4523427">=</span>&nbsp;<span class="op" id="4523429">&amp;</span><span class="ident" id="4523430">wireType</span><span class="op" id="4523438">{</span><span class="ident" id="4523439">TextMarshalerT</span><span class="op" id="4523453">:</span>&nbsp;<span class="ident" id="4523455">gt</span><span class="op" id="4523457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523461">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523465">rt</span>&nbsp;<span class="op" id="4523468">=</span>&nbsp;<span class="ident" id="4523470">ut</span><span class="op" id="4523472">.</span><span class="ident" id="4523473">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523479">}</span>&nbsp;<span class="keyword" id="4523481">else</span>&nbsp;<span class="op" id="4523486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523490">t</span>&nbsp;<span class="op" id="4523492">:=</span>&nbsp;<span class="ident" id="4523495">info</span><span class="op" id="4523499">.</span><span class="ident" id="4523500">id</span><span class="op" id="4523502">.</span><span class="ident" id="4523503">gobType</span><span class="op" id="4523510">(</span><span class="op" id="4523511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523515">switch</span>&nbsp;<span class="ident" id="4523522">typ</span>&nbsp;<span class="op" id="4523526">:=</span>&nbsp;<span class="ident" id="4523529">rt</span><span class="op" id="4523531">;</span>&nbsp;<span class="ident" id="4523533">typ</span><span class="op" id="4523536">.</span><span class="ident" id="4523537">Kind</span><span class="op" id="4523541">(</span><span class="op" id="4523542">)</span>&nbsp;<span class="op" id="4523544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523548">case</span>&nbsp;<span class="ident" id="4523553">reflect</span><span class="op" id="4523560">.</span><span class="ident" id="4523561">Array</span><span class="op" id="4523566">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523571">info</span><span class="op" id="4523575">.</span><span class="ident" id="4523576">wire</span>&nbsp;<span class="op" id="4523581">=</span>&nbsp;<span class="op" id="4523583">&amp;</span><span class="ident" id="4523584">wireType</span><span class="op" id="4523592">{</span><span class="ident" id="4523593">ArrayT</span><span class="op" id="4523599">:</span>&nbsp;<span class="ident" id="4523601">t</span><span class="op" id="4523602">.</span><span class="op" id="4523603">(</span><span class="op" id="4523604">*</span><span class="ident" id="4523605">arrayType</span><span class="op" id="4523614">)</span><span class="op" id="4523615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523619">case</span>&nbsp;<span class="ident" id="4523624">reflect</span><span class="op" id="4523631">.</span><span class="ident" id="4523632">Map</span><span class="op" id="4523635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523640">info</span><span class="op" id="4523644">.</span><span class="ident" id="4523645">wire</span>&nbsp;<span class="op" id="4523650">=</span>&nbsp;<span class="op" id="4523652">&amp;</span><span class="ident" id="4523653">wireType</span><span class="op" id="4523661">{</span><span class="ident" id="4523662">MapT</span><span class="op" id="4523666">:</span>&nbsp;<span class="ident" id="4523668">t</span><span class="op" id="4523669">.</span><span class="op" id="4523670">(</span><span class="op" id="4523671">*</span><span class="ident" id="4523672">mapType</span><span class="op" id="4523679">)</span><span class="op" id="4523680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523684">case</span>&nbsp;<span class="ident" id="4523689">reflect</span><span class="op" id="4523696">.</span><span class="ident" id="4523697">Slice</span><span class="op" id="4523702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4523707">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523768">if</span>&nbsp;<span class="ident" id="4523771">typ</span><span class="op" id="4523774">.</span><span class="ident" id="4523775">Elem</span><span class="op" id="4523779">(</span><span class="op" id="4523780">)</span><span class="op" id="4523781">.</span><span class="ident" id="4523782">Kind</span><span class="op" id="4523786">(</span><span class="op" id="4523787">)</span>&nbsp;<span class="op" id="4523789">!=</span>&nbsp;<span class="ident" id="4523792">reflect</span><span class="op" id="4523799">.</span><span class="ident" id="4523800">Uint8</span>&nbsp;<span class="op" id="4523806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523812">info</span><span class="op" id="4523816">.</span><span class="ident" id="4523817">wire</span>&nbsp;<span class="op" id="4523822">=</span>&nbsp;<span class="op" id="4523824">&amp;</span><span class="ident" id="4523825">wireType</span><span class="op" id="4523833">{</span><span class="ident" id="4523834">SliceT</span><span class="op" id="4523840">:</span>&nbsp;<span class="ident" id="4523842">t</span><span class="op" id="4523843">.</span><span class="op" id="4523844">(</span><span class="op" id="4523845">*</span><span class="ident" id="4523846">sliceType</span><span class="op" id="4523855">)</span><span class="op" id="4523856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4523865">case</span>&nbsp;<span class="ident" id="4523870">reflect</span><span class="op" id="4523877">.</span><span class="ident" id="4523878">Struct</span><span class="op" id="4523884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523889">info</span><span class="op" id="4523893">.</span><span class="ident" id="4523894">wire</span>&nbsp;<span class="op" id="4523899">=</span>&nbsp;<span class="op" id="4523901">&amp;</span><span class="ident" id="4523902">wireType</span><span class="op" id="4523910">{</span><span class="ident" id="4523911">StructT</span><span class="op" id="4523918">:</span>&nbsp;<span class="ident" id="4523920">t</span><span class="op" id="4523921">.</span><span class="op" id="4523922">(</span><span class="op" id="4523923">*</span><span class="ident" id="4523924">structType</span><span class="op" id="4523934">)</span><span class="op" id="4523935">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4523942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4523946">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4523999">newm</span>&nbsp;<span class="op" id="4524004">:=</span>&nbsp;<span class="builtinfunc" id="4524007">make</span><span class="op" id="4524011">(</span><span class="keyword" id="4524012">map</span><span class="op" id="4524015">[</span><span class="ident" id="4524016">reflect</span><span class="op" id="4524023">.</span><span class="ident" id="4524024">Type</span><span class="op" id="4524028">]</span><span class="op" id="4524029">*</span><span class="ident" id="4524030">typeInfo</span><span class="op" id="4524038">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524041">m</span><span class="op" id="4524042">,</span>&nbsp;<span class="ident" id="4524044">_</span>&nbsp;<span class="op" id="4524046">:=</span>&nbsp;<span class="ident" id="4524049">typeInfoMap</span><span class="op" id="4524060">.</span><span class="ident" id="4524061">Load</span><span class="op" id="4524065">(</span><span class="op" id="4524066">)</span><span class="op" id="4524067">.</span><span class="op" id="4524068">(</span><span class="keyword" id="4524069">map</span><span class="op" id="4524072">[</span><span class="ident" id="4524073">reflect</span><span class="op" id="4524080">.</span><span class="ident" id="4524081">Type</span><span class="op" id="4524085">]</span><span class="op" id="4524086">*</span><span class="ident" id="4524087">typeInfo</span><span class="op" id="4524095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524098">for</span>&nbsp;<span class="ident" id="4524102">k</span><span class="op" id="4524103">,</span>&nbsp;<span class="ident" id="4524105">v</span>&nbsp;<span class="op" id="4524107">:=</span>&nbsp;<span class="keyword" id="4524110">range</span>&nbsp;<span class="ident" id="4524116">m</span>&nbsp;<span class="op" id="4524118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524122">newm</span><span class="op" id="4524126">[</span><span class="ident" id="4524127">k</span><span class="op" id="4524128">]</span>&nbsp;<span class="op" id="4524130">=</span>&nbsp;<span class="ident" id="4524132">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4524135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524138">newm</span><span class="op" id="4524142">[</span><span class="ident" id="4524143">rt</span><span class="op" id="4524145">]</span>&nbsp;<span class="op" id="4524147">=</span>&nbsp;<span class="ident" id="4524149">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524155">typeInfoMap</span><span class="op" id="4524166">.</span><span class="ident" id="4524167">Store</span><span class="op" id="4524172">(</span><span class="ident" id="4524173">newm</span><span class="op" id="4524177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524180">return</span>&nbsp;<span class="ident" id="4524187">info</span><span class="op" id="4524191">,</span>&nbsp;<span class="ident" id="4524193">nil</span><br>
<span class="lineno"></span><span class="op" id="4524197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4524200">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="4524258">func</span>&nbsp;<span class="ident" id="4524263">mustGetTypeInfo</span><span class="op" id="4524278">(</span><span class="ident" id="4524279">rt</span>&nbsp;<span class="ident" id="4524282">reflect</span><span class="op" id="4524289">.</span><span class="ident" id="4524290">Type</span><span class="op" id="4524294">)</span>&nbsp;<span class="op" id="4524296">*</span><span class="ident" id="4524297">typeInfo</span>&nbsp;<span class="op" id="4524306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4524309">t</span><span class="op" id="4524310">,</span>&nbsp;<span class="ident" id="4524312">err</span>&nbsp;<span class="op" id="4524316">:=</span>&nbsp;<span class="ident" id="4524319">getTypeInfo</span><span class="op" id="4524330">(</span><span class="ident" id="4524331">userType</span><span class="op" id="4524339">(</span><span class="ident" id="4524340">rt</span><span class="op" id="4524342">)</span><span class="op" id="4524343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524346">if</span>&nbsp;<span class="ident" id="4524349">err</span>&nbsp;<span class="op" id="4524353">!=</span>&nbsp;<span class="ident" id="4524356">nil</span>&nbsp;<span class="op" id="4524360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4524364">panic</span><span class="op" id="4524369">(</span><span class="string" id="4524370">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="4524386">+</span>&nbsp;<span class="ident" id="4524388">err</span><span class="op" id="4524391">.</span><span class="ident" id="4524392">Error</span><span class="op" id="4524397">(</span><span class="op" id="4524398">)</span><span class="op" id="4524399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4524402">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4524405">return</span>&nbsp;<span class="ident" id="4524412">t</span><br>
<span class="lineno"></span><span class="op" id="4524414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4524417">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4524486">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="4524558">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="4524623">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="4524688">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="4524755">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4524810">//</span><br>
<span class="lineno">790</span><span class="comment" id="4524813">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="4524878">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4524945">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="4525015">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4525063">type</span>&nbsp;<span class="ident" id="4525068">GobEncoder</span>&nbsp;<span class="keyword" id="4525079">interface</span>&nbsp;<span class="op" id="4525089">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525092">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525160">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525227">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525246">GobEncode</span><span class="op" id="4525255">(</span><span class="op" id="4525256">)</span>&nbsp;<span class="op" id="4525258">(</span><span class="op" id="4525259">[</span><span class="op" id="4525260">]</span><span class="builtintype" id="4525261">byte</span><span class="op" id="4525265">,</span>&nbsp;<span class="builtintype" id="4525267">error</span><span class="op" id="4525272">)</span><br>
<span class="lineno"></span><span class="op" id="4525274">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4525277">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4525346">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4525411">type</span>&nbsp;<span class="ident" id="4525416">GobDecoder</span>&nbsp;<span class="keyword" id="4525427">interface</span>&nbsp;<span class="op" id="4525437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525440">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525504">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525572">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525626">GobDecode</span><span class="op" id="4525635">(</span><span class="op" id="4525636">[</span><span class="op" id="4525637">]</span><span class="builtintype" id="4525638">byte</span><span class="op" id="4525642">)</span>&nbsp;<span class="builtintype" id="4525644">error</span><br>
<span class="lineno"></span><span class="op" id="4525650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4525653">var</span>&nbsp;<span class="op" id="4525657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525660">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525679">sync</span><span class="op" id="4525683">.</span><span class="ident" id="4525684">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525693">nameToConcreteType</span>&nbsp;<span class="op" id="4525712">=</span>&nbsp;<span class="builtinfunc" id="4525714">make</span><span class="op" id="4525718">(</span><span class="keyword" id="4525719">map</span><span class="op" id="4525722">[</span><span class="builtintype" id="4525723">string</span><span class="op" id="4525729">]</span><span class="ident" id="4525730">reflect</span><span class="op" id="4525737">.</span><span class="ident" id="4525738">Type</span><span class="op" id="4525742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4525745">concreteTypeToName</span>&nbsp;<span class="op" id="4525764">=</span>&nbsp;<span class="builtinfunc" id="4525766">make</span><span class="op" id="4525770">(</span><span class="keyword" id="4525771">map</span><span class="op" id="4525774">[</span><span class="ident" id="4525775">reflect</span><span class="op" id="4525782">.</span><span class="ident" id="4525783">Type</span><span class="op" id="4525787">]</span><span class="builtintype" id="4525788">string</span><span class="op" id="4525794">)</span><br>
<span class="lineno"></span><span class="op" id="4525796">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="4525799">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4525875">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="4525894">func</span>&nbsp;<span class="ident" id="4525899">RegisterName</span><span class="op" id="4525911">(</span><span class="ident" id="4525912">name</span>&nbsp;<span class="builtintype" id="4525917">string</span><span class="op" id="4525923">,</span>&nbsp;<span class="ident" id="4525925">value</span>&nbsp;<span class="keyword" id="4525931">interface</span><span class="op" id="4525940">{</span><span class="op" id="4525941">}</span><span class="op" id="4525942">)</span>&nbsp;<span class="op" id="4525944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4525947">if</span>&nbsp;<span class="ident" id="4525950">name</span>&nbsp;<span class="op" id="4525955">==</span>&nbsp;<span class="string" id="4525958">&#34;&#34;</span>&nbsp;<span class="op" id="4525961">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4525965">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4525987">panic</span><span class="op" id="4525992">(</span><span class="string" id="4525993">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4526025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4526028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526031">registerLock</span><span class="op" id="4526043">.</span><span class="ident" id="4526044">Lock</span><span class="op" id="4526048">(</span><span class="op" id="4526049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4526052">defer</span>&nbsp;<span class="ident" id="4526058">registerLock</span><span class="op" id="4526070">.</span><span class="ident" id="4526071">Unlock</span><span class="op" id="4526077">(</span><span class="op" id="4526078">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526081">ut</span>&nbsp;<span class="op" id="4526084">:=</span>&nbsp;<span class="ident" id="4526087">userType</span><span class="op" id="4526095">(</span><span class="ident" id="4526096">reflect</span><span class="op" id="4526103">.</span><span class="ident" id="4526104">TypeOf</span><span class="op" id="4526110">(</span><span class="ident" id="4526111">value</span><span class="op" id="4526116">)</span><span class="op" id="4526117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526120">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526186">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4526222">if</span>&nbsp;<span class="ident" id="4526225">t</span><span class="op" id="4526226">,</span>&nbsp;<span class="ident" id="4526228">ok</span>&nbsp;<span class="op" id="4526231">:=</span>&nbsp;<span class="ident" id="4526234">nameToConcreteType</span><span class="op" id="4526252">[</span><span class="ident" id="4526253">name</span><span class="op" id="4526257">]</span><span class="op" id="4526258">;</span>&nbsp;<span class="ident" id="4526260">ok</span>&nbsp;<span class="op" id="4526263">&amp;&amp;</span>&nbsp;<span class="ident" id="4526266">t</span>&nbsp;<span class="op" id="4526268">!=</span>&nbsp;<span class="ident" id="4526271">ut</span><span class="op" id="4526273">.</span><span class="ident" id="4526274">user</span>&nbsp;<span class="op" id="4526279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4526283">panic</span><span class="op" id="4526288">(</span><span class="ident" id="4526289">fmt</span><span class="op" id="4526292">.</span><span class="ident" id="4526293">Sprintf</span><span class="op" id="4526300">(</span><span class="string" id="4526301">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="4526352">,</span>&nbsp;<span class="ident" id="4526354">name</span><span class="op" id="4526358">,</span>&nbsp;<span class="ident" id="4526360">t</span><span class="op" id="4526361">,</span>&nbsp;<span class="ident" id="4526363">ut</span><span class="op" id="4526365">.</span><span class="ident" id="4526366">user</span><span class="op" id="4526370">)</span><span class="op" id="4526371">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4526374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4526377">if</span>&nbsp;<span class="ident" id="4526380">n</span><span class="op" id="4526381">,</span>&nbsp;<span class="ident" id="4526383">ok</span>&nbsp;<span class="op" id="4526386">:=</span>&nbsp;<span class="ident" id="4526389">concreteTypeToName</span><span class="op" id="4526407">[</span><span class="ident" id="4526408">ut</span><span class="op" id="4526410">.</span><span class="ident" id="4526411">base</span><span class="op" id="4526415">]</span><span class="op" id="4526416">;</span>&nbsp;<span class="ident" id="4526418">ok</span>&nbsp;<span class="op" id="4526421">&amp;&amp;</span>&nbsp;<span class="ident" id="4526424">n</span>&nbsp;<span class="op" id="4526426">!=</span>&nbsp;<span class="ident" id="4526429">name</span>&nbsp;<span class="op" id="4526434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4526438">panic</span><span class="op" id="4526443">(</span><span class="ident" id="4526444">fmt</span><span class="op" id="4526447">.</span><span class="ident" id="4526448">Sprintf</span><span class="op" id="4526455">(</span><span class="string" id="4526456">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="4526507">,</span>&nbsp;<span class="ident" id="4526509">ut</span><span class="op" id="4526511">.</span><span class="ident" id="4526512">user</span><span class="op" id="4526516">,</span>&nbsp;<span class="ident" id="4526518">n</span><span class="op" id="4526519">,</span>&nbsp;<span class="ident" id="4526521">name</span><span class="op" id="4526525">)</span><span class="op" id="4526526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4526529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526532">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526585">nameToConcreteType</span><span class="op" id="4526603">[</span><span class="ident" id="4526604">name</span><span class="op" id="4526608">]</span>&nbsp;<span class="op" id="4526610">=</span>&nbsp;<span class="ident" id="4526612">reflect</span><span class="op" id="4526619">.</span><span class="ident" id="4526620">TypeOf</span><span class="op" id="4526626">(</span><span class="ident" id="4526627">value</span><span class="op" id="4526632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4526635">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4526713">concreteTypeToName</span><span class="op" id="4526731">[</span><span class="ident" id="4526732">ut</span><span class="op" id="4526734">.</span><span class="ident" id="4526735">base</span><span class="op" id="4526739">]</span>&nbsp;<span class="op" id="4526741">=</span>&nbsp;<span class="ident" id="4526743">name</span><br>
<span class="lineno"></span><span class="op" id="4526748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="4526751">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4526826">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4526903">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4526974">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="4527051">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="4527128">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="4527175">func</span>&nbsp;<span class="ident" id="4527180">Register</span><span class="op" id="4527188">(</span><span class="ident" id="4527189">value</span>&nbsp;<span class="keyword" id="4527195">interface</span><span class="op" id="4527204">{</span><span class="op" id="4527205">}</span><span class="op" id="4527206">)</span>&nbsp;<span class="op" id="4527208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527211">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527267">rt</span>&nbsp;<span class="op" id="4527270">:=</span>&nbsp;<span class="ident" id="4527273">reflect</span><span class="op" id="4527280">.</span><span class="ident" id="4527281">TypeOf</span><span class="op" id="4527287">(</span><span class="ident" id="4527288">value</span><span class="op" id="4527293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527296">name</span>&nbsp;<span class="op" id="4527301">:=</span>&nbsp;<span class="ident" id="4527304">rt</span><span class="op" id="4527306">.</span><span class="ident" id="4527307">String</span><span class="op" id="4527313">(</span><span class="op" id="4527314">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527318">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527415">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527469">star</span>&nbsp;<span class="op" id="4527474">:=</span>&nbsp;<span class="string" id="4527477">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4527481">if</span>&nbsp;<span class="ident" id="4527484">rt</span><span class="op" id="4527486">.</span><span class="ident" id="4527487">Name</span><span class="op" id="4527491">(</span><span class="op" id="4527492">)</span>&nbsp;<span class="op" id="4527494">==</span>&nbsp;<span class="string" id="4527497">&#34;&#34;</span>&nbsp;<span class="op" id="4527500">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4527504">if</span>&nbsp;<span class="ident" id="4527507">pt</span>&nbsp;<span class="op" id="4527510">:=</span>&nbsp;<span class="ident" id="4527513">rt</span><span class="op" id="4527515">;</span>&nbsp;<span class="ident" id="4527517">pt</span><span class="op" id="4527519">.</span><span class="ident" id="4527520">Kind</span><span class="op" id="4527524">(</span><span class="op" id="4527525">)</span>&nbsp;<span class="op" id="4527527">==</span>&nbsp;<span class="ident" id="4527530">reflect</span><span class="op" id="4527537">.</span><span class="ident" id="4527538">Ptr</span>&nbsp;<span class="op" id="4527542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4527547">star</span>&nbsp;<span class="op" id="4527552">=</span>&nbsp;<span class="string" id="4527554">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527561">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527630">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527707">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527733">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527739">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527806">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527826">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527859">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527929">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527951">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4527957">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528006">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528012">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528057">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528098">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4528104">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528188">rt</span>&nbsp;<span class="op" id="4528191">=</span>&nbsp;<span class="ident" id="4528193">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4528198">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4528201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4528204">if</span>&nbsp;<span class="ident" id="4528207">rt</span><span class="op" id="4528209">.</span><span class="ident" id="4528210">Name</span><span class="op" id="4528214">(</span><span class="op" id="4528215">)</span>&nbsp;<span class="op" id="4528217">!=</span>&nbsp;<span class="string" id="4528220">&#34;&#34;</span>&nbsp;<span class="op" id="4528223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4528227">if</span>&nbsp;<span class="ident" id="4528230">rt</span><span class="op" id="4528232">.</span><span class="ident" id="4528233">PkgPath</span><span class="op" id="4528240">(</span><span class="op" id="4528241">)</span>&nbsp;<span class="op" id="4528243">==</span>&nbsp;<span class="string" id="4528246">&#34;&#34;</span>&nbsp;<span class="op" id="4528249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528254">name</span>&nbsp;<span class="op" id="4528259">=</span>&nbsp;<span class="ident" id="4528261">star</span>&nbsp;<span class="op" id="4528266">+</span>&nbsp;<span class="ident" id="4528268">rt</span><span class="op" id="4528270">.</span><span class="ident" id="4528271">Name</span><span class="op" id="4528275">(</span><span class="op" id="4528276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4528280">}</span>&nbsp;<span class="keyword" id="4528282">else</span>&nbsp;<span class="op" id="4528287">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528292">name</span>&nbsp;<span class="op" id="4528297">=</span>&nbsp;<span class="ident" id="4528299">star</span>&nbsp;<span class="op" id="4528304">+</span>&nbsp;<span class="ident" id="4528306">rt</span><span class="op" id="4528308">.</span><span class="ident" id="4528309">PkgPath</span><span class="op" id="4528316">(</span><span class="op" id="4528317">)</span>&nbsp;<span class="op" id="4528319">+</span>&nbsp;<span class="string" id="4528321">&#34;.&#34;</span>&nbsp;<span class="op" id="4528325">+</span>&nbsp;<span class="ident" id="4528327">rt</span><span class="op" id="4528329">.</span><span class="ident" id="4528330">Name</span><span class="op" id="4528334">(</span><span class="op" id="4528335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4528339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4528342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528346">RegisterName</span><span class="op" id="4528358">(</span><span class="ident" id="4528359">name</span><span class="op" id="4528363">,</span>&nbsp;<span class="ident" id="4528365">value</span><span class="op" id="4528370">)</span><br>
<span class="lineno">885</span><span class="op" id="4528372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4528375">func</span>&nbsp;<span class="ident" id="4528380">registerBasics</span><span class="op" id="4528394">(</span><span class="op" id="4528395">)</span>&nbsp;<span class="op" id="4528397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528400">Register</span><span class="op" id="4528408">(</span><span class="builtintype" id="4528409">int</span><span class="op" id="4528412">(</span><span class="num" id="4528413">0</span><span class="op" id="4528414">)</span><span class="op" id="4528415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528418">Register</span><span class="op" id="4528426">(</span><span class="builtintype" id="4528427">int8</span><span class="op" id="4528431">(</span><span class="num" id="4528432">0</span><span class="op" id="4528433">)</span><span class="op" id="4528434">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528437">Register</span><span class="op" id="4528445">(</span><span class="builtintype" id="4528446">int16</span><span class="op" id="4528451">(</span><span class="num" id="4528452">0</span><span class="op" id="4528453">)</span><span class="op" id="4528454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528457">Register</span><span class="op" id="4528465">(</span><span class="builtintype" id="4528466">int32</span><span class="op" id="4528471">(</span><span class="num" id="4528472">0</span><span class="op" id="4528473">)</span><span class="op" id="4528474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528477">Register</span><span class="op" id="4528485">(</span><span class="ident" id="4528486">int64</span><span class="op" id="4528491">(</span><span class="num" id="4528492">0</span><span class="op" id="4528493">)</span><span class="op" id="4528494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528497">Register</span><span class="op" id="4528505">(</span><span class="builtintype" id="4528506">uint</span><span class="op" id="4528510">(</span><span class="num" id="4528511">0</span><span class="op" id="4528512">)</span><span class="op" id="4528513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528516">Register</span><span class="op" id="4528524">(</span><span class="builtintype" id="4528525">uint8</span><span class="op" id="4528530">(</span><span class="num" id="4528531">0</span><span class="op" id="4528532">)</span><span class="op" id="4528533">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528536">Register</span><span class="op" id="4528544">(</span><span class="builtintype" id="4528545">uint16</span><span class="op" id="4528551">(</span><span class="num" id="4528552">0</span><span class="op" id="4528553">)</span><span class="op" id="4528554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528557">Register</span><span class="op" id="4528565">(</span><span class="builtintype" id="4528566">uint32</span><span class="op" id="4528572">(</span><span class="num" id="4528573">0</span><span class="op" id="4528574">)</span><span class="op" id="4528575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528578">Register</span><span class="op" id="4528586">(</span><span class="ident" id="4528587">uint64</span><span class="op" id="4528593">(</span><span class="num" id="4528594">0</span><span class="op" id="4528595">)</span><span class="op" id="4528596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528599">Register</span><span class="op" id="4528607">(</span><span class="builtintype" id="4528608">float32</span><span class="op" id="4528615">(</span><span class="num" id="4528616">0</span><span class="op" id="4528617">)</span><span class="op" id="4528618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528621">Register</span><span class="op" id="4528629">(</span><span class="builtintype" id="4528630">float64</span><span class="op" id="4528637">(</span><span class="num" id="4528638">0</span><span class="op" id="4528639">)</span><span class="op" id="4528640">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528643">Register</span><span class="op" id="4528651">(</span><span class="builtintype" id="4528652">complex64</span><span class="op" id="4528661">(</span><span class="num" id="4528662">0i</span><span class="op" id="4528664">)</span><span class="op" id="4528665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528668">Register</span><span class="op" id="4528676">(</span><span class="builtintype" id="4528677">complex128</span><span class="op" id="4528687">(</span><span class="num" id="4528688">0i</span><span class="op" id="4528690">)</span><span class="op" id="4528691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528694">Register</span><span class="op" id="4528702">(</span><span class="builtintype" id="4528703">uintptr</span><span class="op" id="4528710">(</span><span class="num" id="4528711">0</span><span class="op" id="4528712">)</span><span class="op" id="4528713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528716">Register</span><span class="op" id="4528724">(</span><span class="builtintype" id="4528725">false</span><span class="op" id="4528730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528733">Register</span><span class="op" id="4528741">(</span><span class="string" id="4528742">&#34;&#34;</span><span class="op" id="4528744">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528747">Register</span><span class="op" id="4528755">(</span><span class="op" id="4528756">[</span><span class="op" id="4528757">]</span><span class="builtintype" id="4528758">byte</span><span class="op" id="4528762">(</span><span class="ident" id="4528763">nil</span><span class="op" id="4528766">)</span><span class="op" id="4528767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528770">Register</span><span class="op" id="4528778">(</span><span class="op" id="4528779">[</span><span class="op" id="4528780">]</span><span class="builtintype" id="4528781">int</span><span class="op" id="4528784">(</span><span class="ident" id="4528785">nil</span><span class="op" id="4528788">)</span><span class="op" id="4528789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528792">Register</span><span class="op" id="4528800">(</span><span class="op" id="4528801">[</span><span class="op" id="4528802">]</span><span class="builtintype" id="4528803">int8</span><span class="op" id="4528807">(</span><span class="ident" id="4528808">nil</span><span class="op" id="4528811">)</span><span class="op" id="4528812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528815">Register</span><span class="op" id="4528823">(</span><span class="op" id="4528824">[</span><span class="op" id="4528825">]</span><span class="builtintype" id="4528826">int16</span><span class="op" id="4528831">(</span><span class="ident" id="4528832">nil</span><span class="op" id="4528835">)</span><span class="op" id="4528836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528839">Register</span><span class="op" id="4528847">(</span><span class="op" id="4528848">[</span><span class="op" id="4528849">]</span><span class="builtintype" id="4528850">int32</span><span class="op" id="4528855">(</span><span class="ident" id="4528856">nil</span><span class="op" id="4528859">)</span><span class="op" id="4528860">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528863">Register</span><span class="op" id="4528871">(</span><span class="op" id="4528872">[</span><span class="op" id="4528873">]</span><span class="ident" id="4528874">int64</span><span class="op" id="4528879">(</span><span class="ident" id="4528880">nil</span><span class="op" id="4528883">)</span><span class="op" id="4528884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528887">Register</span><span class="op" id="4528895">(</span><span class="op" id="4528896">[</span><span class="op" id="4528897">]</span><span class="builtintype" id="4528898">uint</span><span class="op" id="4528902">(</span><span class="ident" id="4528903">nil</span><span class="op" id="4528906">)</span><span class="op" id="4528907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528910">Register</span><span class="op" id="4528918">(</span><span class="op" id="4528919">[</span><span class="op" id="4528920">]</span><span class="builtintype" id="4528921">uint8</span><span class="op" id="4528926">(</span><span class="ident" id="4528927">nil</span><span class="op" id="4528930">)</span><span class="op" id="4528931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528934">Register</span><span class="op" id="4528942">(</span><span class="op" id="4528943">[</span><span class="op" id="4528944">]</span><span class="builtintype" id="4528945">uint16</span><span class="op" id="4528951">(</span><span class="ident" id="4528952">nil</span><span class="op" id="4528955">)</span><span class="op" id="4528956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528959">Register</span><span class="op" id="4528967">(</span><span class="op" id="4528968">[</span><span class="op" id="4528969">]</span><span class="builtintype" id="4528970">uint32</span><span class="op" id="4528976">(</span><span class="ident" id="4528977">nil</span><span class="op" id="4528980">)</span><span class="op" id="4528981">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4528984">Register</span><span class="op" id="4528992">(</span><span class="op" id="4528993">[</span><span class="op" id="4528994">]</span><span class="ident" id="4528995">uint64</span><span class="op" id="4529001">(</span><span class="ident" id="4529002">nil</span><span class="op" id="4529005">)</span><span class="op" id="4529006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529009">Register</span><span class="op" id="4529017">(</span><span class="op" id="4529018">[</span><span class="op" id="4529019">]</span><span class="builtintype" id="4529020">float32</span><span class="op" id="4529027">(</span><span class="ident" id="4529028">nil</span><span class="op" id="4529031">)</span><span class="op" id="4529032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529035">Register</span><span class="op" id="4529043">(</span><span class="op" id="4529044">[</span><span class="op" id="4529045">]</span><span class="builtintype" id="4529046">float64</span><span class="op" id="4529053">(</span><span class="ident" id="4529054">nil</span><span class="op" id="4529057">)</span><span class="op" id="4529058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529061">Register</span><span class="op" id="4529069">(</span><span class="op" id="4529070">[</span><span class="op" id="4529071">]</span><span class="builtintype" id="4529072">complex64</span><span class="op" id="4529081">(</span><span class="ident" id="4529082">nil</span><span class="op" id="4529085">)</span><span class="op" id="4529086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529089">Register</span><span class="op" id="4529097">(</span><span class="op" id="4529098">[</span><span class="op" id="4529099">]</span><span class="builtintype" id="4529100">complex128</span><span class="op" id="4529110">(</span><span class="ident" id="4529111">nil</span><span class="op" id="4529114">)</span><span class="op" id="4529115">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529118">Register</span><span class="op" id="4529126">(</span><span class="op" id="4529127">[</span><span class="op" id="4529128">]</span><span class="builtintype" id="4529129">uintptr</span><span class="op" id="4529136">(</span><span class="ident" id="4529137">nil</span><span class="op" id="4529140">)</span><span class="op" id="4529141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529144">Register</span><span class="op" id="4529152">(</span><span class="op" id="4529153">[</span><span class="op" id="4529154">]</span><span class="builtintype" id="4529155">bool</span><span class="op" id="4529159">(</span><span class="ident" id="4529160">nil</span><span class="op" id="4529163">)</span><span class="op" id="4529164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4529167">Register</span><span class="op" id="4529175">(</span><span class="op" id="4529176">[</span><span class="op" id="4529177">]</span><span class="builtintype" id="4529178">string</span><span class="op" id="4529184">(</span><span class="ident" id="4529185">nil</span><span class="op" id="4529188">)</span><span class="op" id="4529189">)</span><br>
<span class="lineno"></span><span class="op" id="4529191">}</span>
</div>
</body>
</html>
