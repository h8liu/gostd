<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">zigzag</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="ident">blockSize</span><span class="op">]</span><span class="builtintype">int</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="num">5</span><span class="op">,</span>&nbsp;<span class="num">6</span><span class="op">,</span>&nbsp;<span class="num">14</span><span class="op">,</span>&nbsp;<span class="num">15</span><span class="op">,</span>&nbsp;<span class="num">27</span><span class="op">,</span>&nbsp;<span class="num">28</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">2</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">,</span>&nbsp;<span class="num">7</span><span class="op">,</span>&nbsp;<span class="num">13</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">26</span><span class="op">,</span>&nbsp;<span class="num">29</span><span class="op">,</span>&nbsp;<span class="num">42</span><span class="op">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">3</span><span class="op">,</span>&nbsp;<span class="num">8</span><span class="op">,</span>&nbsp;<span class="num">12</span><span class="op">,</span>&nbsp;<span class="num">17</span><span class="op">,</span>&nbsp;<span class="num">25</span><span class="op">,</span>&nbsp;<span class="num">30</span><span class="op">,</span>&nbsp;<span class="num">41</span><span class="op">,</span>&nbsp;<span class="num">43</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">9</span><span class="op">,</span>&nbsp;<span class="num">11</span><span class="op">,</span>&nbsp;<span class="num">18</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">31</span><span class="op">,</span>&nbsp;<span class="num">40</span><span class="op">,</span>&nbsp;<span class="num">44</span><span class="op">,</span>&nbsp;<span class="num">53</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">10</span><span class="op">,</span>&nbsp;<span class="num">19</span><span class="op">,</span>&nbsp;<span class="num">23</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">,</span>&nbsp;<span class="num">39</span><span class="op">,</span>&nbsp;<span class="num">45</span><span class="op">,</span>&nbsp;<span class="num">52</span><span class="op">,</span>&nbsp;<span class="num">54</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">22</span><span class="op">,</span>&nbsp;<span class="num">33</span><span class="op">,</span>&nbsp;<span class="num">38</span><span class="op">,</span>&nbsp;<span class="num">46</span><span class="op">,</span>&nbsp;<span class="num">51</span><span class="op">,</span>&nbsp;<span class="num">55</span><span class="op">,</span>&nbsp;<span class="num">60</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">21</span><span class="op">,</span>&nbsp;<span class="num">34</span><span class="op">,</span>&nbsp;<span class="num">37</span><span class="op">,</span>&nbsp;<span class="num">47</span><span class="op">,</span>&nbsp;<span class="num">50</span><span class="op">,</span>&nbsp;<span class="num">56</span><span class="op">,</span>&nbsp;<span class="num">59</span><span class="op">,</span>&nbsp;<span class="num">61</span><span class="op">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">35</span><span class="op">,</span>&nbsp;<span class="num">36</span><span class="op">,</span>&nbsp;<span class="num">48</span><span class="op">,</span>&nbsp;<span class="num">49</span><span class="op">,</span>&nbsp;<span class="num">57</span><span class="op">,</span>&nbsp;<span class="num">58</span><span class="op">,</span>&nbsp;<span class="num">62</span><span class="op">,</span>&nbsp;<span class="num">63</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">TestZigUnzig</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">T</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">blockSize</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">unzig</span><span class="op">[</span><span class="ident">zigzag</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op">,</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">unzig</span><span class="op">[</span><span class="ident">zigzag</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">zigzag</span><span class="op">[</span><span class="ident">unzig</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op">,</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">zigzag</span><span class="op">[</span><span class="ident">unzig</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="ident">nQuantIndex</span><span class="op">]</span><span class="op">[</span><span class="ident">blockSize</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">11</span><span class="op">,</span>&nbsp;<span class="num">10</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">40</span><span class="op">,</span>&nbsp;<span class="num">51</span><span class="op">,</span>&nbsp;<span class="num">61</span><span class="op">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">12</span><span class="op">,</span>&nbsp;<span class="num">12</span><span class="op">,</span>&nbsp;<span class="num">14</span><span class="op">,</span>&nbsp;<span class="num">19</span><span class="op">,</span>&nbsp;<span class="num">26</span><span class="op">,</span>&nbsp;<span class="num">58</span><span class="op">,</span>&nbsp;<span class="num">60</span><span class="op">,</span>&nbsp;<span class="num">55</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">14</span><span class="op">,</span>&nbsp;<span class="num">13</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">40</span><span class="op">,</span>&nbsp;<span class="num">57</span><span class="op">,</span>&nbsp;<span class="num">69</span><span class="op">,</span>&nbsp;<span class="num">56</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">14</span><span class="op">,</span>&nbsp;<span class="num">17</span><span class="op">,</span>&nbsp;<span class="num">22</span><span class="op">,</span>&nbsp;<span class="num">29</span><span class="op">,</span>&nbsp;<span class="num">51</span><span class="op">,</span>&nbsp;<span class="num">87</span><span class="op">,</span>&nbsp;<span class="num">80</span><span class="op">,</span>&nbsp;<span class="num">62</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">18</span><span class="op">,</span>&nbsp;<span class="num">22</span><span class="op">,</span>&nbsp;<span class="num">37</span><span class="op">,</span>&nbsp;<span class="num">56</span><span class="op">,</span>&nbsp;<span class="num">68</span><span class="op">,</span>&nbsp;<span class="num">109</span><span class="op">,</span>&nbsp;<span class="num">103</span><span class="op">,</span>&nbsp;<span class="num">77</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">35</span><span class="op">,</span>&nbsp;<span class="num">55</span><span class="op">,</span>&nbsp;<span class="num">64</span><span class="op">,</span>&nbsp;<span class="num">81</span><span class="op">,</span>&nbsp;<span class="num">104</span><span class="op">,</span>&nbsp;<span class="num">113</span><span class="op">,</span>&nbsp;<span class="num">92</span><span class="op">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">49</span><span class="op">,</span>&nbsp;<span class="num">64</span><span class="op">,</span>&nbsp;<span class="num">78</span><span class="op">,</span>&nbsp;<span class="num">87</span><span class="op">,</span>&nbsp;<span class="num">103</span><span class="op">,</span>&nbsp;<span class="num">121</span><span class="op">,</span>&nbsp;<span class="num">120</span><span class="op">,</span>&nbsp;<span class="num">101</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">72</span><span class="op">,</span>&nbsp;<span class="num">92</span><span class="op">,</span>&nbsp;<span class="num">95</span><span class="op">,</span>&nbsp;<span class="num">98</span><span class="op">,</span>&nbsp;<span class="num">112</span><span class="op">,</span>&nbsp;<span class="num">100</span><span class="op">,</span>&nbsp;<span class="num">103</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">17</span><span class="op">,</span>&nbsp;<span class="num">18</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">47</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">18</span><span class="op">,</span>&nbsp;<span class="num">21</span><span class="op">,</span>&nbsp;<span class="num">26</span><span class="op">,</span>&nbsp;<span class="num">66</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">26</span><span class="op">,</span>&nbsp;<span class="num">56</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">47</span><span class="op">,</span>&nbsp;<span class="num">66</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span>&nbsp;<span class="num">99</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">TestUnscaledQuant</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">T</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bad</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">quantIndex</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">nQuantIndex</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">zig</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">zig</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">blockSize</span><span class="op">;</span>&nbsp;<span class="ident">zig</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">got</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">unscaledQuant</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">[</span><span class="ident">zig</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">want</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">unscaledQuantInNaturalOrder</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">[</span><span class="ident">unzig</span><span class="op">[</span><span class="ident">zig</span><span class="op">]</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">got</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">want</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op">,</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">zig</span><span class="op">,</span>&nbsp;<span class="ident">got</span><span class="op">,</span>&nbsp;<span class="ident">want</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bad</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">bad</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">names</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">[</span><span class="ident">nQuantIndex</span><span class="op">]</span><span class="builtintype">string</span><span class="op">{</span><span class="string">&#34;Luminance&#34;</span><span class="op">,</span>&nbsp;<span class="string">&#34;Chrominance&#34;</span><span class="op">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">bytes</span><span class="op">.</span><span class="ident">Buffer</span><span class="op">{</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">name</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">names</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fmt</span><span class="op">.</span><span class="ident">Fprintf</span><span class="op">(</span><span class="ident">buf</span><span class="op">,</span>&nbsp;<span class="string">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op">,</span>&nbsp;<span class="ident">name</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">zig</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">zig</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">blockSize</span><span class="op">;</span>&nbsp;<span class="ident">zig</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fmt</span><span class="op">.</span><span class="ident">Fprintf</span><span class="op">(</span><span class="ident">buf</span><span class="op">,</span>&nbsp;<span class="string">&#34;%d,&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">unscaledQuantInNaturalOrder</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">[</span><span class="ident">unzig</span><span class="op">[</span><span class="ident">zig</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">zig</span><span class="op">%</span><span class="num">8</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">7</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">.</span><span class="ident">WriteString</span><span class="op">(</span><span class="string">&#34;\n&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">.</span><span class="ident">WriteString</span><span class="op">(</span><span class="string">&#34;},\n&#34;</span><span class="op">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Logf</span><span class="op">(</span><span class="string">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op">,</span>&nbsp;<span class="ident">buf</span><span class="op">.</span><span class="ident">String</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword">var</span>&nbsp;<span class="ident">testCase</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filename</span>&nbsp;&nbsp;<span class="builtintype">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tolerance</span>&nbsp;<span class="ident">int64</span><br>
<span class="lineno"></span><span class="op">}</span><span class="op">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="num">24</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">12</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">60</span><span class="op">,</span>&nbsp;<span class="num">8</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">80</span><span class="op">,</span>&nbsp;<span class="num">6</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">90</span><span class="op">,</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">&#34;../testdata/video-001.png&#34;</span><span class="op">,</span>&nbsp;<span class="num">100</span><span class="op">,</span>&nbsp;<span class="num">2</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">delta</span><span class="op">(</span><span class="ident">u0</span><span class="op">,</span>&nbsp;<span class="ident">u1</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">u0</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">u1</span><span class="op">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="ident">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">d</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">readPng</span><span class="op">(</span><span class="ident">filename</span>&nbsp;<span class="builtintype">string</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">image</span><span class="op">.</span><span class="ident">Image</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">os</span><span class="op">.</span><span class="ident">Open</span><span class="op">(</span><span class="ident">filename</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">Close</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">png</span><span class="op">.</span><span class="ident">Decode</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword">func</span>&nbsp;<span class="ident">TestWriter</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">T</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">tc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">testCase</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">readPng</span><span class="op">(</span><span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Error</span><span class="op">(</span><span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">,</span>&nbsp;<span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="ident">bytes</span><span class="op">.</span><span class="ident">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">err</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Encode</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">buf</span><span class="op">,</span>&nbsp;<span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">Options</span><span class="op">{</span><span class="ident">Quality</span><span class="op">:</span>&nbsp;<span class="ident">tc</span><span class="op">.</span><span class="ident">quality</span><span class="op">}</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Error</span><span class="op">(</span><span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">,</span>&nbsp;<span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m1</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Decode</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Error</span><span class="op">(</span><span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">,</span>&nbsp;<span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op">,</span>&nbsp;<span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">,</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">averageDelta</span><span class="op">(</span><span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="ident">m1</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">tc</span><span class="op">.</span><span class="ident">tolerance</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op">,</span>&nbsp;<span class="ident">tc</span><span class="op">.</span><span class="ident">filename</span><span class="op">,</span>&nbsp;<span class="ident">tc</span><span class="op">.</span><span class="ident">quality</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword">func</span>&nbsp;<span class="ident">TestWriteGrayscale</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">T</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">image</span><span class="op">.</span><span class="ident">NewGray</span><span class="op">(</span><span class="ident">image</span><span class="op">.</span><span class="ident">Rect</span><span class="op">(</span><span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Pix</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m0</span><span class="op">.</span><span class="ident">Pix</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint8</span><span class="op">(</span><span class="ident">i</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="ident">bytes</span><span class="op">.</span><span class="ident">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Encode</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">buf</span><span class="op">,</span>&nbsp;<span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Fatal</span><span class="op">(</span><span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m1</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Decode</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Fatal</span><span class="op">(</span><span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Fatalf</span><span class="op">(</span><span class="string">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op">,</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="op">(</span><span class="op">*</span><span class="ident">image</span><span class="op">.</span><span class="ident">Gray</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="op">!</span><span class="ident">ok</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op">,</span>&nbsp;<span class="ident">m1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">want</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="num">2</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">got</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">averageDelta</span><span class="op">(</span><span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="ident">m1</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">got</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">want</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op">,</span>&nbsp;<span class="ident">got</span><span class="op">,</span>&nbsp;<span class="ident">want</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">averageDelta</span><span class="op">(</span><span class="ident">m0</span><span class="op">,</span>&nbsp;<span class="ident">m1</span>&nbsp;<span class="ident">image</span><span class="op">.</span><span class="ident">Image</span><span class="op">)</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">sum</span><span class="op">,</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="ident">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">b</span><span class="op">.</span><span class="ident">Min</span><span class="op">.</span><span class="ident">Y</span><span class="op">;</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">b</span><span class="op">.</span><span class="ident">Max</span><span class="op">.</span><span class="ident">Y</span><span class="op">;</span>&nbsp;<span class="ident">y</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">b</span><span class="op">.</span><span class="ident">Min</span><span class="op">.</span><span class="ident">X</span><span class="op">;</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">b</span><span class="op">.</span><span class="ident">Max</span><span class="op">.</span><span class="ident">X</span><span class="op">;</span>&nbsp;<span class="ident">x</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">c0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">m0</span><span class="op">.</span><span class="ident">At</span><span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">c1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">m1</span><span class="op">.</span><span class="ident">At</span><span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r0</span><span class="op">,</span>&nbsp;<span class="ident">g0</span><span class="op">,</span>&nbsp;<span class="ident">b0</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">c0</span><span class="op">.</span><span class="ident">RGBA</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span><span class="op">,</span>&nbsp;<span class="ident">g1</span><span class="op">,</span>&nbsp;<span class="ident">b1</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">c1</span><span class="op">.</span><span class="ident">RGBA</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sum</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">delta</span><span class="op">(</span><span class="ident">r0</span><span class="op">,</span>&nbsp;<span class="ident">r1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sum</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">delta</span><span class="op">(</span><span class="ident">g0</span><span class="op">,</span>&nbsp;<span class="ident">g1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sum</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">delta</span><span class="op">(</span><span class="ident">b0</span><span class="op">,</span>&nbsp;<span class="ident">b1</span><span class="op">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sum</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">BenchmarkEncode</span><span class="op">(</span><span class="ident">b</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">B</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">.</span><span class="ident">StopTimer</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">img</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">image</span><span class="op">.</span><span class="ident">NewRGBA</span><span class="op">(</span><span class="ident">image</span><span class="op">.</span><span class="ident">Rect</span><span class="op">(</span><span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">640</span><span class="op">,</span>&nbsp;<span class="num">480</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">img</span><span class="op">.</span><span class="ident">Bounds</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rnd</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rand</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="ident">rand</span><span class="op">.</span><span class="ident">NewSource</span><span class="op">(</span><span class="num">123</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">bo</span><span class="op">.</span><span class="ident">Min</span><span class="op">.</span><span class="ident">Y</span><span class="op">;</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bo</span><span class="op">.</span><span class="ident">Max</span><span class="op">.</span><span class="ident">Y</span><span class="op">;</span>&nbsp;<span class="ident">y</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">bo</span><span class="op">.</span><span class="ident">Min</span><span class="op">.</span><span class="ident">X</span><span class="op">;</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bo</span><span class="op">.</span><span class="ident">Max</span><span class="op">.</span><span class="ident">X</span><span class="op">;</span>&nbsp;<span class="ident">x</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">img</span><span class="op">.</span><span class="ident">SetRGBA</span><span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">,</span>&nbsp;<span class="ident">color</span><span class="op">.</span><span class="ident">RGBA</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">uint8</span><span class="op">(</span><span class="ident">rnd</span><span class="op">.</span><span class="ident">Intn</span><span class="op">(</span><span class="num">256</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">uint8</span><span class="op">(</span><span class="ident">rnd</span><span class="op">.</span><span class="ident">Intn</span><span class="op">(</span><span class="num">256</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">uint8</span><span class="op">(</span><span class="ident">rnd</span><span class="op">.</span><span class="ident">Intn</span><span class="op">(</span><span class="num">256</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">255</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">.</span><span class="ident">SetBytes</span><span class="op">(</span><span class="num">640</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">480</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">.</span><span class="ident">StartTimer</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">options</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">Options</span><span class="op">{</span><span class="ident">Quality</span><span class="op">:</span>&nbsp;<span class="num">90</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">b</span><span class="op">.</span><span class="ident">N</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Encode</span><span class="op">(</span><span class="ident">ioutil</span><span class="op">.</span><span class="ident">Discard</span><span class="op">,</span>&nbsp;<span class="ident">img</span><span class="op">,</span>&nbsp;<span class="ident">options</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
