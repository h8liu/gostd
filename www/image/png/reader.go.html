<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6351274">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6351329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6351383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6351434">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6351493">//</span><br>
<span class="lineno"></span><span class="comment" id="6351496">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="6351554">package</span>&nbsp;<span class="ident" id="6351562">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6351567">import</span>&nbsp;<span class="op" id="6351574">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351577">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351594">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351613">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351620">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351628">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351642">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351651">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6351666">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6351671">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6351674">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6351710">const</span>&nbsp;<span class="op" id="6351716">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351719">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6351736">=</span>&nbsp;<span class="num" id="6351738">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351741">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6351758">=</span>&nbsp;<span class="num" id="6351760">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351763">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6351780">=</span>&nbsp;<span class="num" id="6351782">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351785">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="6351802">=</span>&nbsp;<span class="num" id="6351804">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351807">ctTrueColorAlpha</span>&nbsp;<span class="op" id="6351824">=</span>&nbsp;<span class="num" id="6351826">6</span><br>
<span class="lineno"></span><span class="op" id="6351828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6351831">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6351885">const</span>&nbsp;<span class="op" id="6351891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351894">cbInvalid</span>&nbsp;<span class="op" id="6351904">=</span>&nbsp;<span class="ident" id="6351906">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351912">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351918">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351924">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351930">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351936">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351943">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351950">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351956">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351962">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351968">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351974">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351982">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351989">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351997">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352005">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="6352013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6352016">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6352053">const</span>&nbsp;<span class="op" id="6352059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352062">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6352072">=</span>&nbsp;<span class="num" id="6352074">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352077">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6352087">=</span>&nbsp;<span class="num" id="6352089">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352092">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6352102">=</span>&nbsp;<span class="num" id="6352104">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352107">ftAverage</span>&nbsp;<span class="op" id="6352117">=</span>&nbsp;<span class="num" id="6352119">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352122">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6352132">=</span>&nbsp;<span class="num" id="6352134">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352137">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6352147">=</span>&nbsp;<span class="num" id="6352149">5</span><br>
<span class="lineno"></span><span class="op" id="6352151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6352154">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="6352173">const</span>&nbsp;<span class="op" id="6352179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352182">itNone</span>&nbsp;&nbsp;<span class="op" id="6352190">=</span>&nbsp;<span class="num" id="6352192">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352195">itAdam7</span>&nbsp;<span class="op" id="6352203">=</span>&nbsp;<span class="num" id="6352205">1</span><br>
<span class="lineno"></span><span class="op" id="6352207">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6352210">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="6352291">type</span>&nbsp;<span class="ident" id="6352296">interlaceScan</span>&nbsp;<span class="keyword" id="6352310">struct</span>&nbsp;<span class="op" id="6352317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352320">xFactor</span><span class="op" id="6352327">,</span>&nbsp;<span class="ident" id="6352329">yFactor</span><span class="op" id="6352336">,</span>&nbsp;<span class="ident" id="6352338">xOffset</span><span class="op" id="6352345">,</span>&nbsp;<span class="ident" id="6352347">yOffset</span>&nbsp;<span class="builtintype" id="6352355">int</span><br>
<span class="lineno"></span><span class="op" id="6352359">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6352362">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="6352437">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="6352481">var</span>&nbsp;<span class="ident" id="6352485">interlacing</span>&nbsp;<span class="op" id="6352497">=</span>&nbsp;<span class="op" id="6352499">[</span><span class="op" id="6352500">]</span><span class="ident" id="6352501">interlaceScan</span><span class="op" id="6352514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352517">{</span><span class="num" id="6352518">8</span><span class="op" id="6352519">,</span>&nbsp;<span class="num" id="6352521">8</span><span class="op" id="6352522">,</span>&nbsp;<span class="num" id="6352524">0</span><span class="op" id="6352525">,</span>&nbsp;<span class="num" id="6352527">0</span><span class="op" id="6352528">}</span><span class="op" id="6352529">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352532">{</span><span class="num" id="6352533">8</span><span class="op" id="6352534">,</span>&nbsp;<span class="num" id="6352536">8</span><span class="op" id="6352537">,</span>&nbsp;<span class="num" id="6352539">4</span><span class="op" id="6352540">,</span>&nbsp;<span class="num" id="6352542">0</span><span class="op" id="6352543">}</span><span class="op" id="6352544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352547">{</span><span class="num" id="6352548">4</span><span class="op" id="6352549">,</span>&nbsp;<span class="num" id="6352551">8</span><span class="op" id="6352552">,</span>&nbsp;<span class="num" id="6352554">0</span><span class="op" id="6352555">,</span>&nbsp;<span class="num" id="6352557">4</span><span class="op" id="6352558">}</span><span class="op" id="6352559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352562">{</span><span class="num" id="6352563">4</span><span class="op" id="6352564">,</span>&nbsp;<span class="num" id="6352566">4</span><span class="op" id="6352567">,</span>&nbsp;<span class="num" id="6352569">2</span><span class="op" id="6352570">,</span>&nbsp;<span class="num" id="6352572">0</span><span class="op" id="6352573">}</span><span class="op" id="6352574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352577">{</span><span class="num" id="6352578">2</span><span class="op" id="6352579">,</span>&nbsp;<span class="num" id="6352581">4</span><span class="op" id="6352582">,</span>&nbsp;<span class="num" id="6352584">0</span><span class="op" id="6352585">,</span>&nbsp;<span class="num" id="6352587">2</span><span class="op" id="6352588">}</span><span class="op" id="6352589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352592">{</span><span class="num" id="6352593">2</span><span class="op" id="6352594">,</span>&nbsp;<span class="num" id="6352596">2</span><span class="op" id="6352597">,</span>&nbsp;<span class="num" id="6352599">1</span><span class="op" id="6352600">,</span>&nbsp;<span class="num" id="6352602">0</span><span class="op" id="6352603">}</span><span class="op" id="6352604">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352607">{</span><span class="num" id="6352608">1</span><span class="op" id="6352609">,</span>&nbsp;<span class="num" id="6352611">2</span><span class="op" id="6352612">,</span>&nbsp;<span class="num" id="6352614">0</span><span class="op" id="6352615">,</span>&nbsp;<span class="num" id="6352617">1</span><span class="op" id="6352618">}</span><span class="op" id="6352619">,</span><br>
<span class="lineno"></span><span class="op" id="6352621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6352624">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="6352643">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="6352721">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6352797">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="6352872">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="6352890">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="6352934">const</span>&nbsp;<span class="op" id="6352940">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352943">dsStart</span>&nbsp;<span class="op" id="6352951">=</span>&nbsp;<span class="ident" id="6352953">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352959">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352971">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352983">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352995">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="6353006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6353009">const</span>&nbsp;<span class="ident" id="6353015">pngHeader</span>&nbsp;<span class="op" id="6353025">=</span>&nbsp;<span class="string" id="6353027">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6353048">type</span>&nbsp;<span class="ident" id="6353053">decoder</span>&nbsp;<span class="keyword" id="6353061">struct</span>&nbsp;<span class="op" id="6353068">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353071">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6353085">io</span><span class="op" id="6353087">.</span><span class="ident" id="6353088">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353096">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6353110">image</span><span class="op" id="6353115">.</span><span class="ident" id="6353116">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353123">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6353137">hash</span><span class="op" id="6353141">.</span><span class="ident" id="6353142">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353150">width</span><span class="op" id="6353155">,</span>&nbsp;<span class="ident" id="6353157">height</span>&nbsp;<span class="builtintype" id="6353164">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353169">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6353183">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353188">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6353202">color</span><span class="op" id="6353207">.</span><span class="ident" id="6353208">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353217">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6353231">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353236">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6353250">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353255">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6353269">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353277">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6353291">[</span><span class="num" id="6353292">3</span>&nbsp;<span class="op" id="6353294">*</span>&nbsp;<span class="num" id="6353296">256</span><span class="op" id="6353299">]</span><span class="builtintype" id="6353300">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353306">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6353320">int</span><br>
<span class="lineno"></span><span class="op" id="6353324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6353327">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="6353387">type</span>&nbsp;<span class="ident" id="6353392">FormatError</span>&nbsp;<span class="builtintype" id="6353404">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6353412">func</span>&nbsp;<span class="op" id="6353417">(</span><span class="ident" id="6353418">e</span>&nbsp;<span class="ident" id="6353420">FormatError</span><span class="op" id="6353431">)</span>&nbsp;<span class="ident" id="6353433">Error</span><span class="op" id="6353438">(</span><span class="op" id="6353439">)</span>&nbsp;<span class="builtintype" id="6353441">string</span>&nbsp;<span class="op" id="6353448">{</span>&nbsp;<span class="keyword" id="6353450">return</span>&nbsp;<span class="string" id="6353457">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="6353481">+</span>&nbsp;<span class="builtintype" id="6353483">string</span><span class="op" id="6353489">(</span><span class="ident" id="6353490">e</span><span class="op" id="6353491">)</span>&nbsp;<span class="op" id="6353493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6353496">var</span>&nbsp;<span class="ident" id="6353500">chunkOrderError</span>&nbsp;<span class="op" id="6353516">=</span>&nbsp;<span class="ident" id="6353518">FormatError</span><span class="op" id="6353529">(</span><span class="string" id="6353530">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="6353550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="6353553">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="6353643">type</span>&nbsp;<span class="ident" id="6353648">UnsupportedError</span>&nbsp;<span class="builtintype" id="6353665">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6353673">func</span>&nbsp;<span class="op" id="6353678">(</span><span class="ident" id="6353679">e</span>&nbsp;<span class="ident" id="6353681">UnsupportedError</span><span class="op" id="6353697">)</span>&nbsp;<span class="ident" id="6353699">Error</span><span class="op" id="6353704">(</span><span class="op" id="6353705">)</span>&nbsp;<span class="builtintype" id="6353707">string</span>&nbsp;<span class="op" id="6353714">{</span>&nbsp;<span class="keyword" id="6353716">return</span>&nbsp;<span class="string" id="6353723">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="6353752">+</span>&nbsp;<span class="builtintype" id="6353754">string</span><span class="op" id="6353760">(</span><span class="ident" id="6353761">e</span><span class="op" id="6353762">)</span>&nbsp;<span class="op" id="6353764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6353767">func</span>&nbsp;<span class="ident" id="6353772">min</span><span class="op" id="6353775">(</span><span class="ident" id="6353776">a</span><span class="op" id="6353777">,</span>&nbsp;<span class="ident" id="6353779">b</span>&nbsp;<span class="builtintype" id="6353781">int</span><span class="op" id="6353784">)</span>&nbsp;<span class="builtintype" id="6353786">int</span>&nbsp;<span class="op" id="6353790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353793">if</span>&nbsp;<span class="ident" id="6353796">a</span>&nbsp;<span class="op" id="6353798">&lt;</span>&nbsp;<span class="ident" id="6353800">b</span>&nbsp;<span class="op" id="6353802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353806">return</span>&nbsp;<span class="ident" id="6353813">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6353816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353819">return</span>&nbsp;<span class="ident" id="6353826">b</span><br>
<span class="lineno">130</span><span class="op" id="6353828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6353831">func</span>&nbsp;<span class="op" id="6353836">(</span><span class="ident" id="6353837">d</span>&nbsp;<span class="op" id="6353839">*</span><span class="ident" id="6353840">decoder</span><span class="op" id="6353847">)</span>&nbsp;<span class="ident" id="6353849">parseIHDR</span><span class="op" id="6353858">(</span><span class="ident" id="6353859">length</span>&nbsp;<span class="builtintype" id="6353866">uint32</span><span class="op" id="6353872">)</span>&nbsp;<span class="builtintype" id="6353874">error</span>&nbsp;<span class="op" id="6353880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353883">if</span>&nbsp;<span class="ident" id="6353886">length</span>&nbsp;<span class="op" id="6353893">!=</span>&nbsp;<span class="num" id="6353896">13</span>&nbsp;<span class="op" id="6353899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353903">return</span>&nbsp;<span class="ident" id="6353910">FormatError</span><span class="op" id="6353921">(</span><span class="string" id="6353922">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="6353939">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6353942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6353945">if</span>&nbsp;<span class="ident" id="6353948">_</span><span class="op" id="6353949">,</span>&nbsp;<span class="ident" id="6353951">err</span>&nbsp;<span class="op" id="6353955">:=</span>&nbsp;<span class="ident" id="6353958">io</span><span class="op" id="6353960">.</span><span class="ident" id="6353961">ReadFull</span><span class="op" id="6353969">(</span><span class="ident" id="6353970">d</span><span class="op" id="6353971">.</span><span class="ident" id="6353972">r</span><span class="op" id="6353973">,</span>&nbsp;<span class="ident" id="6353975">d</span><span class="op" id="6353976">.</span><span class="ident" id="6353977">tmp</span><span class="op" id="6353980">[</span><span class="op" id="6353981">:</span><span class="num" id="6353982">13</span><span class="op" id="6353984">]</span><span class="op" id="6353985">)</span><span class="op" id="6353986">;</span>&nbsp;<span class="ident" id="6353988">err</span>&nbsp;<span class="op" id="6353992">!=</span>&nbsp;<span class="ident" id="6353995">nil</span>&nbsp;<span class="op" id="6353999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354003">return</span>&nbsp;<span class="ident" id="6354010">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354018">d</span><span class="op" id="6354019">.</span><span class="ident" id="6354020">crc</span><span class="op" id="6354023">.</span><span class="ident" id="6354024">Write</span><span class="op" id="6354029">(</span><span class="ident" id="6354030">d</span><span class="op" id="6354031">.</span><span class="ident" id="6354032">tmp</span><span class="op" id="6354035">[</span><span class="op" id="6354036">:</span><span class="num" id="6354037">13</span><span class="op" id="6354039">]</span><span class="op" id="6354040">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354043">if</span>&nbsp;<span class="ident" id="6354046">d</span><span class="op" id="6354047">.</span><span class="ident" id="6354048">tmp</span><span class="op" id="6354051">[</span><span class="num" id="6354052">10</span><span class="op" id="6354054">]</span>&nbsp;<span class="op" id="6354056">!=</span>&nbsp;<span class="num" id="6354059">0</span>&nbsp;<span class="op" id="6354061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354065">return</span>&nbsp;<span class="ident" id="6354072">UnsupportedError</span><span class="op" id="6354088">(</span><span class="string" id="6354089">&#34;compression&nbsp;method&#34;</span><span class="op" id="6354109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354115">if</span>&nbsp;<span class="ident" id="6354118">d</span><span class="op" id="6354119">.</span><span class="ident" id="6354120">tmp</span><span class="op" id="6354123">[</span><span class="num" id="6354124">11</span><span class="op" id="6354126">]</span>&nbsp;<span class="op" id="6354128">!=</span>&nbsp;<span class="num" id="6354131">0</span>&nbsp;<span class="op" id="6354133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354137">return</span>&nbsp;<span class="ident" id="6354144">UnsupportedError</span><span class="op" id="6354160">(</span><span class="string" id="6354161">&#34;filter&nbsp;method&#34;</span><span class="op" id="6354176">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354182">if</span>&nbsp;<span class="ident" id="6354185">d</span><span class="op" id="6354186">.</span><span class="ident" id="6354187">tmp</span><span class="op" id="6354190">[</span><span class="num" id="6354191">12</span><span class="op" id="6354193">]</span>&nbsp;<span class="op" id="6354195">!=</span>&nbsp;<span class="ident" id="6354198">itNone</span>&nbsp;<span class="op" id="6354205">&amp;&amp;</span>&nbsp;<span class="ident" id="6354208">d</span><span class="op" id="6354209">.</span><span class="ident" id="6354210">tmp</span><span class="op" id="6354213">[</span><span class="num" id="6354214">12</span><span class="op" id="6354216">]</span>&nbsp;<span class="op" id="6354218">!=</span>&nbsp;<span class="ident" id="6354221">itAdam7</span>&nbsp;<span class="op" id="6354229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354233">return</span>&nbsp;<span class="ident" id="6354240">FormatError</span><span class="op" id="6354251">(</span><span class="string" id="6354252">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="6354278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354284">d</span><span class="op" id="6354285">.</span><span class="ident" id="6354286">interlace</span>&nbsp;<span class="op" id="6354296">=</span>&nbsp;<span class="builtintype" id="6354298">int</span><span class="op" id="6354301">(</span><span class="ident" id="6354302">d</span><span class="op" id="6354303">.</span><span class="ident" id="6354304">tmp</span><span class="op" id="6354307">[</span><span class="num" id="6354308">12</span><span class="op" id="6354310">]</span><span class="op" id="6354311">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354314">w</span>&nbsp;<span class="op" id="6354316">:=</span>&nbsp;<span class="builtintype" id="6354319">int32</span><span class="op" id="6354324">(</span><span class="ident" id="6354325">binary</span><span class="op" id="6354331">.</span><span class="ident" id="6354332">BigEndian</span><span class="op" id="6354341">.</span><span class="ident" id="6354342">Uint32</span><span class="op" id="6354348">(</span><span class="ident" id="6354349">d</span><span class="op" id="6354350">.</span><span class="ident" id="6354351">tmp</span><span class="op" id="6354354">[</span><span class="num" id="6354355">0</span><span class="op" id="6354356">:</span><span class="num" id="6354357">4</span><span class="op" id="6354358">]</span><span class="op" id="6354359">)</span><span class="op" id="6354360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354363">h</span>&nbsp;<span class="op" id="6354365">:=</span>&nbsp;<span class="builtintype" id="6354368">int32</span><span class="op" id="6354373">(</span><span class="ident" id="6354374">binary</span><span class="op" id="6354380">.</span><span class="ident" id="6354381">BigEndian</span><span class="op" id="6354390">.</span><span class="ident" id="6354391">Uint32</span><span class="op" id="6354397">(</span><span class="ident" id="6354398">d</span><span class="op" id="6354399">.</span><span class="ident" id="6354400">tmp</span><span class="op" id="6354403">[</span><span class="num" id="6354404">4</span><span class="op" id="6354405">:</span><span class="num" id="6354406">8</span><span class="op" id="6354407">]</span><span class="op" id="6354408">)</span><span class="op" id="6354409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354412">if</span>&nbsp;<span class="ident" id="6354415">w</span>&nbsp;<span class="op" id="6354417">&lt;</span>&nbsp;<span class="num" id="6354419">0</span>&nbsp;<span class="op" id="6354421">||</span>&nbsp;<span class="ident" id="6354424">h</span>&nbsp;<span class="op" id="6354426">&lt;</span>&nbsp;<span class="num" id="6354428">0</span>&nbsp;<span class="op" id="6354430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354434">return</span>&nbsp;<span class="ident" id="6354441">FormatError</span><span class="op" id="6354452">(</span><span class="string" id="6354453">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="6354473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354476">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354479">nPixels</span>&nbsp;<span class="op" id="6354487">:=</span>&nbsp;<span class="ident" id="6354490">int64</span><span class="op" id="6354495">(</span><span class="ident" id="6354496">w</span><span class="op" id="6354497">)</span>&nbsp;<span class="op" id="6354499">*</span>&nbsp;<span class="ident" id="6354501">int64</span><span class="op" id="6354506">(</span><span class="ident" id="6354507">h</span><span class="op" id="6354508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354511">if</span>&nbsp;<span class="ident" id="6354514">nPixels</span>&nbsp;<span class="op" id="6354522">!=</span>&nbsp;<span class="ident" id="6354525">int64</span><span class="op" id="6354530">(</span><span class="builtintype" id="6354531">int</span><span class="op" id="6354534">(</span><span class="ident" id="6354535">nPixels</span><span class="op" id="6354542">)</span><span class="op" id="6354543">)</span>&nbsp;<span class="op" id="6354545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354549">return</span>&nbsp;<span class="ident" id="6354556">UnsupportedError</span><span class="op" id="6354572">(</span><span class="string" id="6354573">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="6354593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354599">d</span><span class="op" id="6354600">.</span><span class="ident" id="6354601">cb</span>&nbsp;<span class="op" id="6354604">=</span>&nbsp;<span class="ident" id="6354606">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354617">d</span><span class="op" id="6354618">.</span><span class="ident" id="6354619">depth</span>&nbsp;<span class="op" id="6354625">=</span>&nbsp;<span class="builtintype" id="6354627">int</span><span class="op" id="6354630">(</span><span class="ident" id="6354631">d</span><span class="op" id="6354632">.</span><span class="ident" id="6354633">tmp</span><span class="op" id="6354636">[</span><span class="num" id="6354637">8</span><span class="op" id="6354638">]</span><span class="op" id="6354639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354642">switch</span>&nbsp;<span class="ident" id="6354649">d</span><span class="op" id="6354650">.</span><span class="ident" id="6354651">depth</span>&nbsp;<span class="op" id="6354657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354660">case</span>&nbsp;<span class="num" id="6354665">1</span><span class="op" id="6354666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354670">switch</span>&nbsp;<span class="ident" id="6354677">d</span><span class="op" id="6354678">.</span><span class="ident" id="6354679">tmp</span><span class="op" id="6354682">[</span><span class="num" id="6354683">9</span><span class="op" id="6354684">]</span>&nbsp;<span class="op" id="6354686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354690">case</span>&nbsp;<span class="ident" id="6354695">ctGrayscale</span><span class="op" id="6354706">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354711">d</span><span class="op" id="6354712">.</span><span class="ident" id="6354713">cb</span>&nbsp;<span class="op" id="6354716">=</span>&nbsp;<span class="ident" id="6354718">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354725">case</span>&nbsp;<span class="ident" id="6354730">ctPaletted</span><span class="op" id="6354740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354745">d</span><span class="op" id="6354746">.</span><span class="ident" id="6354747">cb</span>&nbsp;<span class="op" id="6354750">=</span>&nbsp;<span class="ident" id="6354752">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354762">case</span>&nbsp;<span class="num" id="6354767">2</span><span class="op" id="6354768">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354772">switch</span>&nbsp;<span class="ident" id="6354779">d</span><span class="op" id="6354780">.</span><span class="ident" id="6354781">tmp</span><span class="op" id="6354784">[</span><span class="num" id="6354785">9</span><span class="op" id="6354786">]</span>&nbsp;<span class="op" id="6354788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354792">case</span>&nbsp;<span class="ident" id="6354797">ctGrayscale</span><span class="op" id="6354808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354813">d</span><span class="op" id="6354814">.</span><span class="ident" id="6354815">cb</span>&nbsp;<span class="op" id="6354818">=</span>&nbsp;<span class="ident" id="6354820">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354827">case</span>&nbsp;<span class="ident" id="6354832">ctPaletted</span><span class="op" id="6354842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354847">d</span><span class="op" id="6354848">.</span><span class="ident" id="6354849">cb</span>&nbsp;<span class="op" id="6354852">=</span>&nbsp;<span class="ident" id="6354854">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354864">case</span>&nbsp;<span class="num" id="6354869">4</span><span class="op" id="6354870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354874">switch</span>&nbsp;<span class="ident" id="6354881">d</span><span class="op" id="6354882">.</span><span class="ident" id="6354883">tmp</span><span class="op" id="6354886">[</span><span class="num" id="6354887">9</span><span class="op" id="6354888">]</span>&nbsp;<span class="op" id="6354890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354894">case</span>&nbsp;<span class="ident" id="6354899">ctGrayscale</span><span class="op" id="6354910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354915">d</span><span class="op" id="6354916">.</span><span class="ident" id="6354917">cb</span>&nbsp;<span class="op" id="6354920">=</span>&nbsp;<span class="ident" id="6354922">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354929">case</span>&nbsp;<span class="ident" id="6354934">ctPaletted</span><span class="op" id="6354944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354949">d</span><span class="op" id="6354950">.</span><span class="ident" id="6354951">cb</span>&nbsp;<span class="op" id="6354954">=</span>&nbsp;<span class="ident" id="6354956">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6354963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354966">case</span>&nbsp;<span class="num" id="6354971">8</span><span class="op" id="6354972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354976">switch</span>&nbsp;<span class="ident" id="6354983">d</span><span class="op" id="6354984">.</span><span class="ident" id="6354985">tmp</span><span class="op" id="6354988">[</span><span class="num" id="6354989">9</span><span class="op" id="6354990">]</span>&nbsp;<span class="op" id="6354992">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6354996">case</span>&nbsp;<span class="ident" id="6355001">ctGrayscale</span><span class="op" id="6355012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355017">d</span><span class="op" id="6355018">.</span><span class="ident" id="6355019">cb</span>&nbsp;<span class="op" id="6355022">=</span>&nbsp;<span class="ident" id="6355024">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355031">case</span>&nbsp;<span class="ident" id="6355036">ctTrueColor</span><span class="op" id="6355047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355052">d</span><span class="op" id="6355053">.</span><span class="ident" id="6355054">cb</span>&nbsp;<span class="op" id="6355057">=</span>&nbsp;<span class="ident" id="6355059">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355067">case</span>&nbsp;<span class="ident" id="6355072">ctPaletted</span><span class="op" id="6355082">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355087">d</span><span class="op" id="6355088">.</span><span class="ident" id="6355089">cb</span>&nbsp;<span class="op" id="6355092">=</span>&nbsp;<span class="ident" id="6355094">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355101">case</span>&nbsp;<span class="ident" id="6355106">ctGrayscaleAlpha</span><span class="op" id="6355122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355127">d</span><span class="op" id="6355128">.</span><span class="ident" id="6355129">cb</span>&nbsp;<span class="op" id="6355132">=</span>&nbsp;<span class="ident" id="6355134">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355142">case</span>&nbsp;<span class="ident" id="6355147">ctTrueColorAlpha</span><span class="op" id="6355163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355168">d</span><span class="op" id="6355169">.</span><span class="ident" id="6355170">cb</span>&nbsp;<span class="op" id="6355173">=</span>&nbsp;<span class="ident" id="6355175">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355187">case</span>&nbsp;<span class="num" id="6355192">16</span><span class="op" id="6355194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355198">switch</span>&nbsp;<span class="ident" id="6355205">d</span><span class="op" id="6355206">.</span><span class="ident" id="6355207">tmp</span><span class="op" id="6355210">[</span><span class="num" id="6355211">9</span><span class="op" id="6355212">]</span>&nbsp;<span class="op" id="6355214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355218">case</span>&nbsp;<span class="ident" id="6355223">ctGrayscale</span><span class="op" id="6355234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355239">d</span><span class="op" id="6355240">.</span><span class="ident" id="6355241">cb</span>&nbsp;<span class="op" id="6355244">=</span>&nbsp;<span class="ident" id="6355246">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355254">case</span>&nbsp;<span class="ident" id="6355259">ctTrueColor</span><span class="op" id="6355270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355275">d</span><span class="op" id="6355276">.</span><span class="ident" id="6355277">cb</span>&nbsp;<span class="op" id="6355280">=</span>&nbsp;<span class="ident" id="6355282">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355291">case</span>&nbsp;<span class="ident" id="6355296">ctGrayscaleAlpha</span><span class="op" id="6355312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355317">d</span><span class="op" id="6355318">.</span><span class="ident" id="6355319">cb</span>&nbsp;<span class="op" id="6355322">=</span>&nbsp;<span class="ident" id="6355324">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355333">case</span>&nbsp;<span class="ident" id="6355338">ctTrueColorAlpha</span><span class="op" id="6355354">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355359">d</span><span class="op" id="6355360">.</span><span class="ident" id="6355361">cb</span>&nbsp;<span class="op" id="6355364">=</span>&nbsp;<span class="ident" id="6355366">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355382">if</span>&nbsp;<span class="ident" id="6355385">d</span><span class="op" id="6355386">.</span><span class="ident" id="6355387">cb</span>&nbsp;<span class="op" id="6355390">==</span>&nbsp;<span class="ident" id="6355393">cbInvalid</span>&nbsp;<span class="op" id="6355403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355407">return</span>&nbsp;<span class="ident" id="6355414">UnsupportedError</span><span class="op" id="6355430">(</span><span class="ident" id="6355431">fmt</span><span class="op" id="6355434">.</span><span class="ident" id="6355435">Sprintf</span><span class="op" id="6355442">(</span><span class="string" id="6355443">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="6355472">,</span>&nbsp;<span class="ident" id="6355474">d</span><span class="op" id="6355475">.</span><span class="ident" id="6355476">tmp</span><span class="op" id="6355479">[</span><span class="num" id="6355480">8</span><span class="op" id="6355481">]</span><span class="op" id="6355482">,</span>&nbsp;<span class="ident" id="6355484">d</span><span class="op" id="6355485">.</span><span class="ident" id="6355486">tmp</span><span class="op" id="6355489">[</span><span class="num" id="6355490">9</span><span class="op" id="6355491">]</span><span class="op" id="6355492">)</span><span class="op" id="6355493">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355499">d</span><span class="op" id="6355500">.</span><span class="ident" id="6355501">width</span><span class="op" id="6355506">,</span>&nbsp;<span class="ident" id="6355508">d</span><span class="op" id="6355509">.</span><span class="ident" id="6355510">height</span>&nbsp;<span class="op" id="6355517">=</span>&nbsp;<span class="builtintype" id="6355519">int</span><span class="op" id="6355522">(</span><span class="ident" id="6355523">w</span><span class="op" id="6355524">)</span><span class="op" id="6355525">,</span>&nbsp;<span class="builtintype" id="6355527">int</span><span class="op" id="6355530">(</span><span class="ident" id="6355531">h</span><span class="op" id="6355532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355535">return</span>&nbsp;<span class="ident" id="6355542">d</span><span class="op" id="6355543">.</span><span class="ident" id="6355544">verifyChecksum</span><span class="op" id="6355558">(</span><span class="op" id="6355559">)</span><br>
<span class="lineno"></span><span class="op" id="6355561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6355564">func</span>&nbsp;<span class="op" id="6355569">(</span><span class="ident" id="6355570">d</span>&nbsp;<span class="op" id="6355572">*</span><span class="ident" id="6355573">decoder</span><span class="op" id="6355580">)</span>&nbsp;<span class="ident" id="6355582">parsePLTE</span><span class="op" id="6355591">(</span><span class="ident" id="6355592">length</span>&nbsp;<span class="builtintype" id="6355599">uint32</span><span class="op" id="6355605">)</span>&nbsp;<span class="builtintype" id="6355607">error</span>&nbsp;<span class="op" id="6355613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355616">np</span>&nbsp;<span class="op" id="6355619">:=</span>&nbsp;<span class="builtintype" id="6355622">int</span><span class="op" id="6355625">(</span><span class="ident" id="6355626">length</span>&nbsp;<span class="op" id="6355633">/</span>&nbsp;<span class="num" id="6355635">3</span><span class="op" id="6355636">)</span>&nbsp;<span class="comment" id="6355638">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355673">if</span>&nbsp;<span class="ident" id="6355676">length</span><span class="op" id="6355682">%</span><span class="num" id="6355683">3</span>&nbsp;<span class="op" id="6355685">!=</span>&nbsp;<span class="num" id="6355688">0</span>&nbsp;<span class="op" id="6355690">||</span>&nbsp;<span class="ident" id="6355693">np</span>&nbsp;<span class="op" id="6355696">&lt;=</span>&nbsp;<span class="num" id="6355699">0</span>&nbsp;<span class="op" id="6355701">||</span>&nbsp;<span class="ident" id="6355704">np</span>&nbsp;<span class="op" id="6355707">&gt;</span>&nbsp;<span class="num" id="6355709">256</span>&nbsp;<span class="op" id="6355713">||</span>&nbsp;<span class="ident" id="6355716">np</span>&nbsp;<span class="op" id="6355719">&gt;</span>&nbsp;<span class="num" id="6355721">1</span><span class="op" id="6355722">&lt;&lt;</span><span class="builtintype" id="6355724">uint</span><span class="op" id="6355728">(</span><span class="ident" id="6355729">d</span><span class="op" id="6355730">.</span><span class="ident" id="6355731">depth</span><span class="op" id="6355736">)</span>&nbsp;<span class="op" id="6355738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355742">return</span>&nbsp;<span class="ident" id="6355749">FormatError</span><span class="op" id="6355760">(</span><span class="string" id="6355761">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="6355778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355781">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355784">n</span><span class="op" id="6355785">,</span>&nbsp;<span class="ident" id="6355787">err</span>&nbsp;<span class="op" id="6355791">:=</span>&nbsp;<span class="ident" id="6355794">io</span><span class="op" id="6355796">.</span><span class="ident" id="6355797">ReadFull</span><span class="op" id="6355805">(</span><span class="ident" id="6355806">d</span><span class="op" id="6355807">.</span><span class="ident" id="6355808">r</span><span class="op" id="6355809">,</span>&nbsp;<span class="ident" id="6355811">d</span><span class="op" id="6355812">.</span><span class="ident" id="6355813">tmp</span><span class="op" id="6355816">[</span><span class="op" id="6355817">:</span><span class="num" id="6355818">3</span><span class="op" id="6355819">*</span><span class="ident" id="6355820">np</span><span class="op" id="6355822">]</span><span class="op" id="6355823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355826">if</span>&nbsp;<span class="ident" id="6355829">err</span>&nbsp;<span class="op" id="6355833">!=</span>&nbsp;<span class="ident" id="6355836">nil</span>&nbsp;<span class="op" id="6355840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355844">return</span>&nbsp;<span class="ident" id="6355851">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6355856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355859">d</span><span class="op" id="6355860">.</span><span class="ident" id="6355861">crc</span><span class="op" id="6355864">.</span><span class="ident" id="6355865">Write</span><span class="op" id="6355870">(</span><span class="ident" id="6355871">d</span><span class="op" id="6355872">.</span><span class="ident" id="6355873">tmp</span><span class="op" id="6355876">[</span><span class="op" id="6355877">:</span><span class="ident" id="6355878">n</span><span class="op" id="6355879">]</span><span class="op" id="6355880">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355883">switch</span>&nbsp;<span class="ident" id="6355890">d</span><span class="op" id="6355891">.</span><span class="ident" id="6355892">cb</span>&nbsp;<span class="op" id="6355895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355898">case</span>&nbsp;<span class="ident" id="6355903">cbP1</span><span class="op" id="6355907">,</span>&nbsp;<span class="ident" id="6355909">cbP2</span><span class="op" id="6355913">,</span>&nbsp;<span class="ident" id="6355915">cbP4</span><span class="op" id="6355919">,</span>&nbsp;<span class="ident" id="6355921">cbP8</span><span class="op" id="6355925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355929">d</span><span class="op" id="6355930">.</span><span class="ident" id="6355931">palette</span>&nbsp;<span class="op" id="6355939">=</span>&nbsp;<span class="builtinfunc" id="6355941">make</span><span class="op" id="6355945">(</span><span class="ident" id="6355946">color</span><span class="op" id="6355951">.</span><span class="ident" id="6355952">Palette</span><span class="op" id="6355959">,</span>&nbsp;<span class="num" id="6355961">256</span><span class="op" id="6355964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355968">for</span>&nbsp;<span class="ident" id="6355972">i</span>&nbsp;<span class="op" id="6355974">:=</span>&nbsp;<span class="num" id="6355977">0</span><span class="op" id="6355978">;</span>&nbsp;<span class="ident" id="6355980">i</span>&nbsp;<span class="op" id="6355982">&lt;</span>&nbsp;<span class="ident" id="6355984">np</span><span class="op" id="6355986">;</span>&nbsp;<span class="ident" id="6355988">i</span><span class="op" id="6355989">++</span>&nbsp;<span class="op" id="6355992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355997">d</span><span class="op" id="6355998">.</span><span class="ident" id="6355999">palette</span><span class="op" id="6356006">[</span><span class="ident" id="6356007">i</span><span class="op" id="6356008">]</span>&nbsp;<span class="op" id="6356010">=</span>&nbsp;<span class="ident" id="6356012">color</span><span class="op" id="6356017">.</span><span class="ident" id="6356018">RGBA</span><span class="op" id="6356022">{</span><span class="ident" id="6356023">d</span><span class="op" id="6356024">.</span><span class="ident" id="6356025">tmp</span><span class="op" id="6356028">[</span><span class="num" id="6356029">3</span><span class="op" id="6356030">*</span><span class="ident" id="6356031">i</span><span class="op" id="6356032">+</span><span class="num" id="6356033">0</span><span class="op" id="6356034">]</span><span class="op" id="6356035">,</span>&nbsp;<span class="ident" id="6356037">d</span><span class="op" id="6356038">.</span><span class="ident" id="6356039">tmp</span><span class="op" id="6356042">[</span><span class="num" id="6356043">3</span><span class="op" id="6356044">*</span><span class="ident" id="6356045">i</span><span class="op" id="6356046">+</span><span class="num" id="6356047">1</span><span class="op" id="6356048">]</span><span class="op" id="6356049">,</span>&nbsp;<span class="ident" id="6356051">d</span><span class="op" id="6356052">.</span><span class="ident" id="6356053">tmp</span><span class="op" id="6356056">[</span><span class="num" id="6356057">3</span><span class="op" id="6356058">*</span><span class="ident" id="6356059">i</span><span class="op" id="6356060">+</span><span class="num" id="6356061">2</span><span class="op" id="6356062">]</span><span class="op" id="6356063">,</span>&nbsp;<span class="num" id="6356065">0xff</span><span class="op" id="6356069">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356077">for</span>&nbsp;<span class="ident" id="6356081">i</span>&nbsp;<span class="op" id="6356083">:=</span>&nbsp;<span class="ident" id="6356086">np</span><span class="op" id="6356088">;</span>&nbsp;<span class="ident" id="6356090">i</span>&nbsp;<span class="op" id="6356092">&lt;</span>&nbsp;<span class="num" id="6356094">256</span><span class="op" id="6356097">;</span>&nbsp;<span class="ident" id="6356099">i</span><span class="op" id="6356100">++</span>&nbsp;<span class="op" id="6356103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356108">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356184">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356262">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356336">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356407">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356449">d</span><span class="op" id="6356450">.</span><span class="ident" id="6356451">palette</span><span class="op" id="6356458">[</span><span class="ident" id="6356459">i</span><span class="op" id="6356460">]</span>&nbsp;<span class="op" id="6356462">=</span>&nbsp;<span class="ident" id="6356464">color</span><span class="op" id="6356469">.</span><span class="ident" id="6356470">RGBA</span><span class="op" id="6356474">{</span><span class="num" id="6356475">0x00</span><span class="op" id="6356479">,</span>&nbsp;<span class="num" id="6356481">0x00</span><span class="op" id="6356485">,</span>&nbsp;<span class="num" id="6356487">0x00</span><span class="op" id="6356491">,</span>&nbsp;<span class="num" id="6356493">0xff</span><span class="op" id="6356497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356505">d</span><span class="op" id="6356506">.</span><span class="ident" id="6356507">palette</span>&nbsp;<span class="op" id="6356515">=</span>&nbsp;<span class="ident" id="6356517">d</span><span class="op" id="6356518">.</span><span class="ident" id="6356519">palette</span><span class="op" id="6356526">[</span><span class="op" id="6356527">:</span><span class="ident" id="6356528">np</span><span class="op" id="6356530">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356533">case</span>&nbsp;<span class="ident" id="6356538">cbTC8</span><span class="op" id="6356543">,</span>&nbsp;<span class="ident" id="6356545">cbTCA8</span><span class="op" id="6356551">,</span>&nbsp;<span class="ident" id="6356553">cbTC16</span><span class="op" id="6356559">,</span>&nbsp;<span class="ident" id="6356561">cbTCA16</span><span class="op" id="6356568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356572">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356652">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356737">default</span><span class="op" id="6356744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356748">return</span>&nbsp;<span class="ident" id="6356755">FormatError</span><span class="op" id="6356766">(</span><span class="string" id="6356767">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6356794">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356800">return</span>&nbsp;<span class="ident" id="6356807">d</span><span class="op" id="6356808">.</span><span class="ident" id="6356809">verifyChecksum</span><span class="op" id="6356823">(</span><span class="op" id="6356824">)</span><br>
<span class="lineno"></span><span class="op" id="6356826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6356829">func</span>&nbsp;<span class="op" id="6356834">(</span><span class="ident" id="6356835">d</span>&nbsp;<span class="op" id="6356837">*</span><span class="ident" id="6356838">decoder</span><span class="op" id="6356845">)</span>&nbsp;<span class="ident" id="6356847">parsetRNS</span><span class="op" id="6356856">(</span><span class="ident" id="6356857">length</span>&nbsp;<span class="builtintype" id="6356864">uint32</span><span class="op" id="6356870">)</span>&nbsp;<span class="builtintype" id="6356872">error</span>&nbsp;<span class="op" id="6356878">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356881">if</span>&nbsp;<span class="ident" id="6356884">length</span>&nbsp;<span class="op" id="6356891">&gt;</span>&nbsp;<span class="num" id="6356893">256</span>&nbsp;<span class="op" id="6356897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356901">return</span>&nbsp;<span class="ident" id="6356908">FormatError</span><span class="op" id="6356919">(</span><span class="string" id="6356920">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="6356937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356943">n</span><span class="op" id="6356944">,</span>&nbsp;<span class="ident" id="6356946">err</span>&nbsp;<span class="op" id="6356950">:=</span>&nbsp;<span class="ident" id="6356953">io</span><span class="op" id="6356955">.</span><span class="ident" id="6356956">ReadFull</span><span class="op" id="6356964">(</span><span class="ident" id="6356965">d</span><span class="op" id="6356966">.</span><span class="ident" id="6356967">r</span><span class="op" id="6356968">,</span>&nbsp;<span class="ident" id="6356970">d</span><span class="op" id="6356971">.</span><span class="ident" id="6356972">tmp</span><span class="op" id="6356975">[</span><span class="op" id="6356976">:</span><span class="ident" id="6356977">length</span><span class="op" id="6356983">]</span><span class="op" id="6356984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356987">if</span>&nbsp;<span class="ident" id="6356990">err</span>&nbsp;<span class="op" id="6356994">!=</span>&nbsp;<span class="ident" id="6356997">nil</span>&nbsp;<span class="op" id="6357001">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357005">return</span>&nbsp;<span class="ident" id="6357012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357020">d</span><span class="op" id="6357021">.</span><span class="ident" id="6357022">crc</span><span class="op" id="6357025">.</span><span class="ident" id="6357026">Write</span><span class="op" id="6357031">(</span><span class="ident" id="6357032">d</span><span class="op" id="6357033">.</span><span class="ident" id="6357034">tmp</span><span class="op" id="6357037">[</span><span class="op" id="6357038">:</span><span class="ident" id="6357039">n</span><span class="op" id="6357040">]</span><span class="op" id="6357041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357044">switch</span>&nbsp;<span class="ident" id="6357051">d</span><span class="op" id="6357052">.</span><span class="ident" id="6357053">cb</span>&nbsp;<span class="op" id="6357056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357059">case</span>&nbsp;<span class="ident" id="6357064">cbG8</span><span class="op" id="6357068">,</span>&nbsp;<span class="ident" id="6357070">cbG16</span><span class="op" id="6357075">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357079">return</span>&nbsp;<span class="ident" id="6357086">UnsupportedError</span><span class="op" id="6357102">(</span><span class="string" id="6357103">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="6357127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357130">case</span>&nbsp;<span class="ident" id="6357135">cbTC8</span><span class="op" id="6357140">,</span>&nbsp;<span class="ident" id="6357142">cbTC16</span><span class="op" id="6357148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357152">return</span>&nbsp;<span class="ident" id="6357159">UnsupportedError</span><span class="op" id="6357175">(</span><span class="string" id="6357176">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="6357200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357203">case</span>&nbsp;<span class="ident" id="6357208">cbP1</span><span class="op" id="6357212">,</span>&nbsp;<span class="ident" id="6357214">cbP2</span><span class="op" id="6357218">,</span>&nbsp;<span class="ident" id="6357220">cbP4</span><span class="op" id="6357224">,</span>&nbsp;<span class="ident" id="6357226">cbP8</span><span class="op" id="6357230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357234">if</span>&nbsp;<span class="builtinfunc" id="6357237">len</span><span class="op" id="6357240">(</span><span class="ident" id="6357241">d</span><span class="op" id="6357242">.</span><span class="ident" id="6357243">palette</span><span class="op" id="6357250">)</span>&nbsp;<span class="op" id="6357252">&lt;</span>&nbsp;<span class="ident" id="6357254">n</span>&nbsp;<span class="op" id="6357256">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357261">d</span><span class="op" id="6357262">.</span><span class="ident" id="6357263">palette</span>&nbsp;<span class="op" id="6357271">=</span>&nbsp;<span class="ident" id="6357273">d</span><span class="op" id="6357274">.</span><span class="ident" id="6357275">palette</span><span class="op" id="6357282">[</span><span class="op" id="6357283">:</span><span class="ident" id="6357284">n</span><span class="op" id="6357285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357293">for</span>&nbsp;<span class="ident" id="6357297">i</span>&nbsp;<span class="op" id="6357299">:=</span>&nbsp;<span class="num" id="6357302">0</span><span class="op" id="6357303">;</span>&nbsp;<span class="ident" id="6357305">i</span>&nbsp;<span class="op" id="6357307">&lt;</span>&nbsp;<span class="ident" id="6357309">n</span><span class="op" id="6357310">;</span>&nbsp;<span class="ident" id="6357312">i</span><span class="op" id="6357313">++</span>&nbsp;<span class="op" id="6357316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357321">rgba</span>&nbsp;<span class="op" id="6357326">:=</span>&nbsp;<span class="ident" id="6357329">d</span><span class="op" id="6357330">.</span><span class="ident" id="6357331">palette</span><span class="op" id="6357338">[</span><span class="ident" id="6357339">i</span><span class="op" id="6357340">]</span><span class="op" id="6357341">.</span><span class="op" id="6357342">(</span><span class="ident" id="6357343">color</span><span class="op" id="6357348">.</span><span class="ident" id="6357349">RGBA</span><span class="op" id="6357353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357358">d</span><span class="op" id="6357359">.</span><span class="ident" id="6357360">palette</span><span class="op" id="6357367">[</span><span class="ident" id="6357368">i</span><span class="op" id="6357369">]</span>&nbsp;<span class="op" id="6357371">=</span>&nbsp;<span class="ident" id="6357373">color</span><span class="op" id="6357378">.</span><span class="ident" id="6357379">NRGBA</span><span class="op" id="6357384">{</span><span class="ident" id="6357385">rgba</span><span class="op" id="6357389">.</span><span class="ident" id="6357390">R</span><span class="op" id="6357391">,</span>&nbsp;<span class="ident" id="6357393">rgba</span><span class="op" id="6357397">.</span><span class="ident" id="6357398">G</span><span class="op" id="6357399">,</span>&nbsp;<span class="ident" id="6357401">rgba</span><span class="op" id="6357405">.</span><span class="ident" id="6357406">B</span><span class="op" id="6357407">,</span>&nbsp;<span class="ident" id="6357409">d</span><span class="op" id="6357410">.</span><span class="ident" id="6357411">tmp</span><span class="op" id="6357414">[</span><span class="ident" id="6357415">i</span><span class="op" id="6357416">]</span><span class="op" id="6357417">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357424">case</span>&nbsp;<span class="ident" id="6357429">cbGA8</span><span class="op" id="6357434">,</span>&nbsp;<span class="ident" id="6357436">cbGA16</span><span class="op" id="6357442">,</span>&nbsp;<span class="ident" id="6357444">cbTCA8</span><span class="op" id="6357450">,</span>&nbsp;<span class="ident" id="6357452">cbTCA16</span><span class="op" id="6357459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357463">return</span>&nbsp;<span class="ident" id="6357470">FormatError</span><span class="op" id="6357481">(</span><span class="string" id="6357482">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6357509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357515">return</span>&nbsp;<span class="ident" id="6357522">d</span><span class="op" id="6357523">.</span><span class="ident" id="6357524">verifyChecksum</span><span class="op" id="6357538">(</span><span class="op" id="6357539">)</span><br>
<span class="lineno">275</span><span class="op" id="6357541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6357544">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6357621">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="6357694">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="6357755">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="6357835">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6357915">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="6357992">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="6358047">func</span>&nbsp;<span class="op" id="6358052">(</span><span class="ident" id="6358053">d</span>&nbsp;<span class="op" id="6358055">*</span><span class="ident" id="6358056">decoder</span><span class="op" id="6358063">)</span>&nbsp;<span class="ident" id="6358065">Read</span><span class="op" id="6358069">(</span><span class="ident" id="6358070">p</span>&nbsp;<span class="op" id="6358072">[</span><span class="op" id="6358073">]</span><span class="builtintype" id="6358074">byte</span><span class="op" id="6358078">)</span>&nbsp;<span class="op" id="6358080">(</span><span class="builtintype" id="6358081">int</span><span class="op" id="6358084">,</span>&nbsp;<span class="builtintype" id="6358086">error</span><span class="op" id="6358091">)</span>&nbsp;<span class="op" id="6358093">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358096">if</span>&nbsp;<span class="builtinfunc" id="6358099">len</span><span class="op" id="6358102">(</span><span class="ident" id="6358103">p</span><span class="op" id="6358104">)</span>&nbsp;<span class="op" id="6358106">==</span>&nbsp;<span class="num" id="6358109">0</span>&nbsp;<span class="op" id="6358111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358115">return</span>&nbsp;<span class="num" id="6358122">0</span><span class="op" id="6358123">,</span>&nbsp;<span class="ident" id="6358125">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358133">for</span>&nbsp;<span class="ident" id="6358137">d</span><span class="op" id="6358138">.</span><span class="ident" id="6358139">idatLength</span>&nbsp;<span class="op" id="6358150">==</span>&nbsp;<span class="num" id="6358153">0</span>&nbsp;<span class="op" id="6358155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358159">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358232">if</span>&nbsp;<span class="ident" id="6358235">err</span>&nbsp;<span class="op" id="6358239">:=</span>&nbsp;<span class="ident" id="6358242">d</span><span class="op" id="6358243">.</span><span class="ident" id="6358244">verifyChecksum</span><span class="op" id="6358258">(</span><span class="op" id="6358259">)</span><span class="op" id="6358260">;</span>&nbsp;<span class="ident" id="6358262">err</span>&nbsp;<span class="op" id="6358266">!=</span>&nbsp;<span class="ident" id="6358269">nil</span>&nbsp;<span class="op" id="6358273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358278">return</span>&nbsp;<span class="num" id="6358285">0</span><span class="op" id="6358286">,</span>&nbsp;<span class="ident" id="6358288">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358298">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358368">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358394">if</span>&nbsp;<span class="ident" id="6358397">_</span><span class="op" id="6358398">,</span>&nbsp;<span class="ident" id="6358400">err</span>&nbsp;<span class="op" id="6358404">:=</span>&nbsp;<span class="ident" id="6358407">io</span><span class="op" id="6358409">.</span><span class="ident" id="6358410">ReadFull</span><span class="op" id="6358418">(</span><span class="ident" id="6358419">d</span><span class="op" id="6358420">.</span><span class="ident" id="6358421">r</span><span class="op" id="6358422">,</span>&nbsp;<span class="ident" id="6358424">d</span><span class="op" id="6358425">.</span><span class="ident" id="6358426">tmp</span><span class="op" id="6358429">[</span><span class="op" id="6358430">:</span><span class="num" id="6358431">8</span><span class="op" id="6358432">]</span><span class="op" id="6358433">)</span><span class="op" id="6358434">;</span>&nbsp;<span class="ident" id="6358436">err</span>&nbsp;<span class="op" id="6358440">!=</span>&nbsp;<span class="ident" id="6358443">nil</span>&nbsp;<span class="op" id="6358447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358452">return</span>&nbsp;<span class="num" id="6358459">0</span><span class="op" id="6358460">,</span>&nbsp;<span class="ident" id="6358462">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358472">d</span><span class="op" id="6358473">.</span><span class="ident" id="6358474">idatLength</span>&nbsp;<span class="op" id="6358485">=</span>&nbsp;<span class="ident" id="6358487">binary</span><span class="op" id="6358493">.</span><span class="ident" id="6358494">BigEndian</span><span class="op" id="6358503">.</span><span class="ident" id="6358504">Uint32</span><span class="op" id="6358510">(</span><span class="ident" id="6358511">d</span><span class="op" id="6358512">.</span><span class="ident" id="6358513">tmp</span><span class="op" id="6358516">[</span><span class="op" id="6358517">:</span><span class="num" id="6358518">4</span><span class="op" id="6358519">]</span><span class="op" id="6358520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358524">if</span>&nbsp;<span class="builtintype" id="6358527">string</span><span class="op" id="6358533">(</span><span class="ident" id="6358534">d</span><span class="op" id="6358535">.</span><span class="ident" id="6358536">tmp</span><span class="op" id="6358539">[</span><span class="num" id="6358540">4</span><span class="op" id="6358541">:</span><span class="num" id="6358542">8</span><span class="op" id="6358543">]</span><span class="op" id="6358544">)</span>&nbsp;<span class="op" id="6358546">!=</span>&nbsp;<span class="string" id="6358549">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="6358556">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358561">return</span>&nbsp;<span class="num" id="6358568">0</span><span class="op" id="6358569">,</span>&nbsp;<span class="ident" id="6358571">FormatError</span><span class="op" id="6358582">(</span><span class="string" id="6358583">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6358606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358614">d</span><span class="op" id="6358615">.</span><span class="ident" id="6358616">crc</span><span class="op" id="6358619">.</span><span class="ident" id="6358620">Reset</span><span class="op" id="6358625">(</span><span class="op" id="6358626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358630">d</span><span class="op" id="6358631">.</span><span class="ident" id="6358632">crc</span><span class="op" id="6358635">.</span><span class="ident" id="6358636">Write</span><span class="op" id="6358641">(</span><span class="ident" id="6358642">d</span><span class="op" id="6358643">.</span><span class="ident" id="6358644">tmp</span><span class="op" id="6358647">[</span><span class="num" id="6358648">4</span><span class="op" id="6358649">:</span><span class="num" id="6358650">8</span><span class="op" id="6358651">]</span><span class="op" id="6358652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358655">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358658">if</span>&nbsp;<span class="builtintype" id="6358661">int</span><span class="op" id="6358664">(</span><span class="ident" id="6358665">d</span><span class="op" id="6358666">.</span><span class="ident" id="6358667">idatLength</span><span class="op" id="6358677">)</span>&nbsp;<span class="op" id="6358679">&lt;</span>&nbsp;<span class="num" id="6358681">0</span>&nbsp;<span class="op" id="6358683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358687">return</span>&nbsp;<span class="num" id="6358694">0</span><span class="op" id="6358695">,</span>&nbsp;<span class="ident" id="6358697">UnsupportedError</span><span class="op" id="6358713">(</span><span class="string" id="6358714">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="6358742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358748">n</span><span class="op" id="6358749">,</span>&nbsp;<span class="ident" id="6358751">err</span>&nbsp;<span class="op" id="6358755">:=</span>&nbsp;<span class="ident" id="6358758">d</span><span class="op" id="6358759">.</span><span class="ident" id="6358760">r</span><span class="op" id="6358761">.</span><span class="ident" id="6358762">Read</span><span class="op" id="6358766">(</span><span class="ident" id="6358767">p</span><span class="op" id="6358768">[</span><span class="op" id="6358769">:</span><span class="ident" id="6358770">min</span><span class="op" id="6358773">(</span><span class="builtinfunc" id="6358774">len</span><span class="op" id="6358777">(</span><span class="ident" id="6358778">p</span><span class="op" id="6358779">)</span><span class="op" id="6358780">,</span>&nbsp;<span class="builtintype" id="6358782">int</span><span class="op" id="6358785">(</span><span class="ident" id="6358786">d</span><span class="op" id="6358787">.</span><span class="ident" id="6358788">idatLength</span><span class="op" id="6358798">)</span><span class="op" id="6358799">)</span><span class="op" id="6358800">]</span><span class="op" id="6358801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358804">d</span><span class="op" id="6358805">.</span><span class="ident" id="6358806">crc</span><span class="op" id="6358809">.</span><span class="ident" id="6358810">Write</span><span class="op" id="6358815">(</span><span class="ident" id="6358816">p</span><span class="op" id="6358817">[</span><span class="op" id="6358818">:</span><span class="ident" id="6358819">n</span><span class="op" id="6358820">]</span><span class="op" id="6358821">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358824">d</span><span class="op" id="6358825">.</span><span class="ident" id="6358826">idatLength</span>&nbsp;<span class="op" id="6358837">-=</span>&nbsp;<span class="builtintype" id="6358840">uint32</span><span class="op" id="6358846">(</span><span class="ident" id="6358847">n</span><span class="op" id="6358848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358851">return</span>&nbsp;<span class="ident" id="6358858">n</span><span class="op" id="6358859">,</span>&nbsp;<span class="ident" id="6358861">err</span><br>
<span class="lineno"></span><span class="op" id="6358865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358868">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="6358915">func</span>&nbsp;<span class="op" id="6358920">(</span><span class="ident" id="6358921">d</span>&nbsp;<span class="op" id="6358923">*</span><span class="ident" id="6358924">decoder</span><span class="op" id="6358931">)</span>&nbsp;<span class="ident" id="6358933">decode</span><span class="op" id="6358939">(</span><span class="op" id="6358940">)</span>&nbsp;<span class="op" id="6358942">(</span><span class="ident" id="6358943">image</span><span class="op" id="6358948">.</span><span class="ident" id="6358949">Image</span><span class="op" id="6358954">,</span>&nbsp;<span class="builtintype" id="6358956">error</span><span class="op" id="6358961">)</span>&nbsp;<span class="op" id="6358963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358966">r</span><span class="op" id="6358967">,</span>&nbsp;<span class="ident" id="6358969">err</span>&nbsp;<span class="op" id="6358973">:=</span>&nbsp;<span class="ident" id="6358976">zlib</span><span class="op" id="6358980">.</span><span class="ident" id="6358981">NewReader</span><span class="op" id="6358990">(</span><span class="ident" id="6358991">d</span><span class="op" id="6358992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358995">if</span>&nbsp;<span class="ident" id="6358998">err</span>&nbsp;<span class="op" id="6359002">!=</span>&nbsp;<span class="ident" id="6359005">nil</span>&nbsp;<span class="op" id="6359009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359013">return</span>&nbsp;<span class="ident" id="6359020">nil</span><span class="op" id="6359023">,</span>&nbsp;<span class="ident" id="6359025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359030">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359033">defer</span>&nbsp;<span class="ident" id="6359039">r</span><span class="op" id="6359040">.</span><span class="ident" id="6359041">Close</span><span class="op" id="6359046">(</span><span class="op" id="6359047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359050">var</span>&nbsp;<span class="ident" id="6359054">img</span>&nbsp;<span class="ident" id="6359058">image</span><span class="op" id="6359063">.</span><span class="ident" id="6359064">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359071">if</span>&nbsp;<span class="ident" id="6359074">d</span><span class="op" id="6359075">.</span><span class="ident" id="6359076">interlace</span>&nbsp;<span class="op" id="6359086">==</span>&nbsp;<span class="ident" id="6359089">itNone</span>&nbsp;<span class="op" id="6359096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359100">img</span><span class="op" id="6359103">,</span>&nbsp;<span class="ident" id="6359105">err</span>&nbsp;<span class="op" id="6359109">=</span>&nbsp;<span class="ident" id="6359111">d</span><span class="op" id="6359112">.</span><span class="ident" id="6359113">readImagePass</span><span class="op" id="6359126">(</span><span class="ident" id="6359127">r</span><span class="op" id="6359128">,</span>&nbsp;<span class="num" id="6359130">0</span><span class="op" id="6359131">,</span>&nbsp;<span class="ident" id="6359133">false</span><span class="op" id="6359138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359141">}</span>&nbsp;<span class="keyword" id="6359143">else</span>&nbsp;<span class="keyword" id="6359148">if</span>&nbsp;<span class="ident" id="6359151">d</span><span class="op" id="6359152">.</span><span class="ident" id="6359153">interlace</span>&nbsp;<span class="op" id="6359163">==</span>&nbsp;<span class="ident" id="6359166">itAdam7</span>&nbsp;<span class="op" id="6359174">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359178">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359224">img</span><span class="op" id="6359227">,</span>&nbsp;<span class="ident" id="6359229">err</span>&nbsp;<span class="op" id="6359233">=</span>&nbsp;<span class="ident" id="6359235">d</span><span class="op" id="6359236">.</span><span class="ident" id="6359237">readImagePass</span><span class="op" id="6359250">(</span><span class="ident" id="6359251">nil</span><span class="op" id="6359254">,</span>&nbsp;<span class="num" id="6359256">0</span><span class="op" id="6359257">,</span>&nbsp;<span class="ident" id="6359259">true</span><span class="op" id="6359263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359267">for</span>&nbsp;<span class="ident" id="6359271">pass</span>&nbsp;<span class="op" id="6359276">:=</span>&nbsp;<span class="num" id="6359279">0</span><span class="op" id="6359280">;</span>&nbsp;<span class="ident" id="6359282">pass</span>&nbsp;<span class="op" id="6359287">&lt;</span>&nbsp;<span class="num" id="6359289">7</span><span class="op" id="6359290">;</span>&nbsp;<span class="ident" id="6359292">pass</span><span class="op" id="6359296">++</span>&nbsp;<span class="op" id="6359299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359304">imagePass</span><span class="op" id="6359313">,</span>&nbsp;<span class="ident" id="6359315">err</span>&nbsp;<span class="op" id="6359319">:=</span>&nbsp;<span class="ident" id="6359322">d</span><span class="op" id="6359323">.</span><span class="ident" id="6359324">readImagePass</span><span class="op" id="6359337">(</span><span class="ident" id="6359338">r</span><span class="op" id="6359339">,</span>&nbsp;<span class="ident" id="6359341">pass</span><span class="op" id="6359345">,</span>&nbsp;<span class="ident" id="6359347">false</span><span class="op" id="6359352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359357">if</span>&nbsp;<span class="ident" id="6359360">err</span>&nbsp;<span class="op" id="6359364">!=</span>&nbsp;<span class="ident" id="6359367">nil</span>&nbsp;<span class="op" id="6359371">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359377">return</span>&nbsp;<span class="ident" id="6359384">nil</span><span class="op" id="6359387">,</span>&nbsp;<span class="ident" id="6359389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359401">d</span><span class="op" id="6359402">.</span><span class="ident" id="6359403">mergePassInto</span><span class="op" id="6359416">(</span><span class="ident" id="6359417">img</span><span class="op" id="6359420">,</span>&nbsp;<span class="ident" id="6359422">imagePass</span><span class="op" id="6359431">,</span>&nbsp;<span class="ident" id="6359433">pass</span><span class="op" id="6359437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359444">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359448">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359496">n</span>&nbsp;<span class="op" id="6359498">:=</span>&nbsp;<span class="num" id="6359501">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359504">for</span>&nbsp;<span class="ident" id="6359508">i</span>&nbsp;<span class="op" id="6359510">:=</span>&nbsp;<span class="num" id="6359513">0</span><span class="op" id="6359514">;</span>&nbsp;<span class="ident" id="6359516">n</span>&nbsp;<span class="op" id="6359518">==</span>&nbsp;<span class="num" id="6359521">0</span>&nbsp;<span class="op" id="6359523">&amp;&amp;</span>&nbsp;<span class="ident" id="6359526">err</span>&nbsp;<span class="op" id="6359530">==</span>&nbsp;<span class="ident" id="6359533">nil</span><span class="op" id="6359536">;</span>&nbsp;<span class="ident" id="6359538">i</span><span class="op" id="6359539">++</span>&nbsp;<span class="op" id="6359542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359546">if</span>&nbsp;<span class="ident" id="6359549">i</span>&nbsp;<span class="op" id="6359551">==</span>&nbsp;<span class="num" id="6359554">100</span>&nbsp;<span class="op" id="6359558">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359563">return</span>&nbsp;<span class="ident" id="6359570">nil</span><span class="op" id="6359573">,</span>&nbsp;<span class="ident" id="6359575">io</span><span class="op" id="6359577">.</span><span class="ident" id="6359578">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359598">n</span><span class="op" id="6359599">,</span>&nbsp;<span class="ident" id="6359601">err</span>&nbsp;<span class="op" id="6359605">=</span>&nbsp;<span class="ident" id="6359607">r</span><span class="op" id="6359608">.</span><span class="ident" id="6359609">Read</span><span class="op" id="6359613">(</span><span class="ident" id="6359614">d</span><span class="op" id="6359615">.</span><span class="ident" id="6359616">tmp</span><span class="op" id="6359619">[</span><span class="op" id="6359620">:</span><span class="num" id="6359621">1</span><span class="op" id="6359622">]</span><span class="op" id="6359623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359629">if</span>&nbsp;<span class="ident" id="6359632">err</span>&nbsp;<span class="op" id="6359636">!=</span>&nbsp;<span class="ident" id="6359639">nil</span>&nbsp;<span class="op" id="6359643">&amp;&amp;</span>&nbsp;<span class="ident" id="6359646">err</span>&nbsp;<span class="op" id="6359650">!=</span>&nbsp;<span class="ident" id="6359653">io</span><span class="op" id="6359655">.</span><span class="ident" id="6359656">EOF</span>&nbsp;<span class="op" id="6359660">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359664">return</span>&nbsp;<span class="ident" id="6359671">nil</span><span class="op" id="6359674">,</span>&nbsp;<span class="ident" id="6359676">FormatError</span><span class="op" id="6359687">(</span><span class="ident" id="6359688">err</span><span class="op" id="6359691">.</span><span class="ident" id="6359692">Error</span><span class="op" id="6359697">(</span><span class="op" id="6359698">)</span><span class="op" id="6359699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359705">if</span>&nbsp;<span class="ident" id="6359708">n</span>&nbsp;<span class="op" id="6359710">!=</span>&nbsp;<span class="num" id="6359713">0</span>&nbsp;<span class="op" id="6359715">||</span>&nbsp;<span class="ident" id="6359718">d</span><span class="op" id="6359719">.</span><span class="ident" id="6359720">idatLength</span>&nbsp;<span class="op" id="6359731">!=</span>&nbsp;<span class="num" id="6359734">0</span>&nbsp;<span class="op" id="6359736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359740">return</span>&nbsp;<span class="ident" id="6359747">nil</span><span class="op" id="6359750">,</span>&nbsp;<span class="ident" id="6359752">FormatError</span><span class="op" id="6359763">(</span><span class="string" id="6359764">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6359785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359788">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359792">return</span>&nbsp;<span class="ident" id="6359799">img</span><span class="op" id="6359802">,</span>&nbsp;<span class="ident" id="6359804">nil</span><br>
<span class="lineno"></span><span class="op" id="6359808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6359811">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="6359891">func</span>&nbsp;<span class="op" id="6359896">(</span><span class="ident" id="6359897">d</span>&nbsp;<span class="op" id="6359899">*</span><span class="ident" id="6359900">decoder</span><span class="op" id="6359907">)</span>&nbsp;<span class="ident" id="6359909">readImagePass</span><span class="op" id="6359922">(</span><span class="ident" id="6359923">r</span>&nbsp;<span class="ident" id="6359925">io</span><span class="op" id="6359927">.</span><span class="ident" id="6359928">Reader</span><span class="op" id="6359934">,</span>&nbsp;<span class="ident" id="6359936">pass</span>&nbsp;<span class="builtintype" id="6359941">int</span><span class="op" id="6359944">,</span>&nbsp;<span class="ident" id="6359946">allocateOnly</span>&nbsp;<span class="builtintype" id="6359959">bool</span><span class="op" id="6359963">)</span>&nbsp;<span class="op" id="6359965">(</span><span class="ident" id="6359966">image</span><span class="op" id="6359971">.</span><span class="ident" id="6359972">Image</span><span class="op" id="6359977">,</span>&nbsp;<span class="builtintype" id="6359979">error</span><span class="op" id="6359984">)</span>&nbsp;<span class="op" id="6359986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359989">var</span>&nbsp;<span class="ident" id="6359993">bitsPerPixel</span>&nbsp;<span class="builtintype" id="6360006">int</span>&nbsp;<span class="op" id="6360010">=</span>&nbsp;<span class="num" id="6360012">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360015">pixOffset</span>&nbsp;<span class="op" id="6360025">:=</span>&nbsp;<span class="num" id="6360028">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360031">var</span>&nbsp;<span class="op" id="6360035">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360039">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6360048">*</span><span class="ident" id="6360049">image</span><span class="op" id="6360054">.</span><span class="ident" id="6360055">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360062">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6360071">*</span><span class="ident" id="6360072">image</span><span class="op" id="6360077">.</span><span class="ident" id="6360078">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360085">paletted</span>&nbsp;<span class="op" id="6360094">*</span><span class="ident" id="6360095">image</span><span class="op" id="6360100">.</span><span class="ident" id="6360101">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360112">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6360121">*</span><span class="ident" id="6360122">image</span><span class="op" id="6360127">.</span><span class="ident" id="6360128">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360136">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6360145">*</span><span class="ident" id="6360146">image</span><span class="op" id="6360151">.</span><span class="ident" id="6360152">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360161">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6360170">*</span><span class="ident" id="6360171">image</span><span class="op" id="6360176">.</span><span class="ident" id="6360177">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360186">nrgba64</span>&nbsp;&nbsp;<span class="op" id="6360195">*</span><span class="ident" id="6360196">image</span><span class="op" id="6360201">.</span><span class="ident" id="6360202">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360212">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6360221">image</span><span class="op" id="6360226">.</span><span class="ident" id="6360227">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360237">width</span><span class="op" id="6360242">,</span>&nbsp;<span class="ident" id="6360244">height</span>&nbsp;<span class="op" id="6360251">:=</span>&nbsp;<span class="ident" id="6360254">d</span><span class="op" id="6360255">.</span><span class="ident" id="6360256">width</span><span class="op" id="6360261">,</span>&nbsp;<span class="ident" id="6360263">d</span><span class="op" id="6360264">.</span><span class="ident" id="6360265">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360273">if</span>&nbsp;<span class="ident" id="6360276">d</span><span class="op" id="6360277">.</span><span class="ident" id="6360278">interlace</span>&nbsp;<span class="op" id="6360288">==</span>&nbsp;<span class="ident" id="6360291">itAdam7</span>&nbsp;<span class="op" id="6360299">&amp;&amp;</span>&nbsp;<span class="op" id="6360302">!</span><span class="ident" id="6360303">allocateOnly</span>&nbsp;<span class="op" id="6360316">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360320">p</span>&nbsp;<span class="op" id="6360322">:=</span>&nbsp;<span class="ident" id="6360325">interlacing</span><span class="op" id="6360336">[</span><span class="ident" id="6360337">pass</span><span class="op" id="6360341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6360345">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360423">width</span>&nbsp;<span class="op" id="6360429">=</span>&nbsp;<span class="op" id="6360431">(</span><span class="ident" id="6360432">width</span>&nbsp;<span class="op" id="6360438">-</span>&nbsp;<span class="ident" id="6360440">p</span><span class="op" id="6360441">.</span><span class="ident" id="6360442">xOffset</span>&nbsp;<span class="op" id="6360450">+</span>&nbsp;<span class="ident" id="6360452">p</span><span class="op" id="6360453">.</span><span class="ident" id="6360454">xFactor</span>&nbsp;<span class="op" id="6360462">-</span>&nbsp;<span class="num" id="6360464">1</span><span class="op" id="6360465">)</span>&nbsp;<span class="op" id="6360467">/</span>&nbsp;<span class="ident" id="6360469">p</span><span class="op" id="6360470">.</span><span class="ident" id="6360471">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360481">height</span>&nbsp;<span class="op" id="6360488">=</span>&nbsp;<span class="op" id="6360490">(</span><span class="ident" id="6360491">height</span>&nbsp;<span class="op" id="6360498">-</span>&nbsp;<span class="ident" id="6360500">p</span><span class="op" id="6360501">.</span><span class="ident" id="6360502">yOffset</span>&nbsp;<span class="op" id="6360510">+</span>&nbsp;<span class="ident" id="6360512">p</span><span class="op" id="6360513">.</span><span class="ident" id="6360514">yFactor</span>&nbsp;<span class="op" id="6360522">-</span>&nbsp;<span class="num" id="6360524">1</span><span class="op" id="6360525">)</span>&nbsp;<span class="op" id="6360527">/</span>&nbsp;<span class="ident" id="6360529">p</span><span class="op" id="6360530">.</span><span class="ident" id="6360531">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6360540">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360543">switch</span>&nbsp;<span class="ident" id="6360550">d</span><span class="op" id="6360551">.</span><span class="ident" id="6360552">cb</span>&nbsp;<span class="op" id="6360555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360558">case</span>&nbsp;<span class="ident" id="6360563">cbG1</span><span class="op" id="6360567">,</span>&nbsp;<span class="ident" id="6360569">cbG2</span><span class="op" id="6360573">,</span>&nbsp;<span class="ident" id="6360575">cbG4</span><span class="op" id="6360579">,</span>&nbsp;<span class="ident" id="6360581">cbG8</span><span class="op" id="6360585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360589">bitsPerPixel</span>&nbsp;<span class="op" id="6360602">=</span>&nbsp;<span class="ident" id="6360604">d</span><span class="op" id="6360605">.</span><span class="ident" id="6360606">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360614">gray</span>&nbsp;<span class="op" id="6360619">=</span>&nbsp;<span class="ident" id="6360621">image</span><span class="op" id="6360626">.</span><span class="ident" id="6360627">NewGray</span><span class="op" id="6360634">(</span><span class="ident" id="6360635">image</span><span class="op" id="6360640">.</span><span class="ident" id="6360641">Rect</span><span class="op" id="6360645">(</span><span class="num" id="6360646">0</span><span class="op" id="6360647">,</span>&nbsp;<span class="num" id="6360649">0</span><span class="op" id="6360650">,</span>&nbsp;<span class="ident" id="6360652">width</span><span class="op" id="6360657">,</span>&nbsp;<span class="ident" id="6360659">height</span><span class="op" id="6360665">)</span><span class="op" id="6360666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360670">img</span>&nbsp;<span class="op" id="6360674">=</span>&nbsp;<span class="ident" id="6360676">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360682">case</span>&nbsp;<span class="ident" id="6360687">cbGA8</span><span class="op" id="6360692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360696">bitsPerPixel</span>&nbsp;<span class="op" id="6360709">=</span>&nbsp;<span class="num" id="6360711">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360716">nrgba</span>&nbsp;<span class="op" id="6360722">=</span>&nbsp;<span class="ident" id="6360724">image</span><span class="op" id="6360729">.</span><span class="ident" id="6360730">NewNRGBA</span><span class="op" id="6360738">(</span><span class="ident" id="6360739">image</span><span class="op" id="6360744">.</span><span class="ident" id="6360745">Rect</span><span class="op" id="6360749">(</span><span class="num" id="6360750">0</span><span class="op" id="6360751">,</span>&nbsp;<span class="num" id="6360753">0</span><span class="op" id="6360754">,</span>&nbsp;<span class="ident" id="6360756">width</span><span class="op" id="6360761">,</span>&nbsp;<span class="ident" id="6360763">height</span><span class="op" id="6360769">)</span><span class="op" id="6360770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360774">img</span>&nbsp;<span class="op" id="6360778">=</span>&nbsp;<span class="ident" id="6360780">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360787">case</span>&nbsp;<span class="ident" id="6360792">cbTC8</span><span class="op" id="6360797">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360801">bitsPerPixel</span>&nbsp;<span class="op" id="6360814">=</span>&nbsp;<span class="num" id="6360816">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360821">rgba</span>&nbsp;<span class="op" id="6360826">=</span>&nbsp;<span class="ident" id="6360828">image</span><span class="op" id="6360833">.</span><span class="ident" id="6360834">NewRGBA</span><span class="op" id="6360841">(</span><span class="ident" id="6360842">image</span><span class="op" id="6360847">.</span><span class="ident" id="6360848">Rect</span><span class="op" id="6360852">(</span><span class="num" id="6360853">0</span><span class="op" id="6360854">,</span>&nbsp;<span class="num" id="6360856">0</span><span class="op" id="6360857">,</span>&nbsp;<span class="ident" id="6360859">width</span><span class="op" id="6360864">,</span>&nbsp;<span class="ident" id="6360866">height</span><span class="op" id="6360872">)</span><span class="op" id="6360873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360877">img</span>&nbsp;<span class="op" id="6360881">=</span>&nbsp;<span class="ident" id="6360883">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360889">case</span>&nbsp;<span class="ident" id="6360894">cbP1</span><span class="op" id="6360898">,</span>&nbsp;<span class="ident" id="6360900">cbP2</span><span class="op" id="6360904">,</span>&nbsp;<span class="ident" id="6360906">cbP4</span><span class="op" id="6360910">,</span>&nbsp;<span class="ident" id="6360912">cbP8</span><span class="op" id="6360916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360920">bitsPerPixel</span>&nbsp;<span class="op" id="6360933">=</span>&nbsp;<span class="ident" id="6360935">d</span><span class="op" id="6360936">.</span><span class="ident" id="6360937">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360945">paletted</span>&nbsp;<span class="op" id="6360954">=</span>&nbsp;<span class="ident" id="6360956">image</span><span class="op" id="6360961">.</span><span class="ident" id="6360962">NewPaletted</span><span class="op" id="6360973">(</span><span class="ident" id="6360974">image</span><span class="op" id="6360979">.</span><span class="ident" id="6360980">Rect</span><span class="op" id="6360984">(</span><span class="num" id="6360985">0</span><span class="op" id="6360986">,</span>&nbsp;<span class="num" id="6360988">0</span><span class="op" id="6360989">,</span>&nbsp;<span class="ident" id="6360991">width</span><span class="op" id="6360996">,</span>&nbsp;<span class="ident" id="6360998">height</span><span class="op" id="6361004">)</span><span class="op" id="6361005">,</span>&nbsp;<span class="ident" id="6361007">d</span><span class="op" id="6361008">.</span><span class="ident" id="6361009">palette</span><span class="op" id="6361016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361020">img</span>&nbsp;<span class="op" id="6361024">=</span>&nbsp;<span class="ident" id="6361026">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361036">case</span>&nbsp;<span class="ident" id="6361041">cbTCA8</span><span class="op" id="6361047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361051">bitsPerPixel</span>&nbsp;<span class="op" id="6361064">=</span>&nbsp;<span class="num" id="6361066">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361071">nrgba</span>&nbsp;<span class="op" id="6361077">=</span>&nbsp;<span class="ident" id="6361079">image</span><span class="op" id="6361084">.</span><span class="ident" id="6361085">NewNRGBA</span><span class="op" id="6361093">(</span><span class="ident" id="6361094">image</span><span class="op" id="6361099">.</span><span class="ident" id="6361100">Rect</span><span class="op" id="6361104">(</span><span class="num" id="6361105">0</span><span class="op" id="6361106">,</span>&nbsp;<span class="num" id="6361108">0</span><span class="op" id="6361109">,</span>&nbsp;<span class="ident" id="6361111">width</span><span class="op" id="6361116">,</span>&nbsp;<span class="ident" id="6361118">height</span><span class="op" id="6361124">)</span><span class="op" id="6361125">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361129">img</span>&nbsp;<span class="op" id="6361133">=</span>&nbsp;<span class="ident" id="6361135">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361142">case</span>&nbsp;<span class="ident" id="6361147">cbG16</span><span class="op" id="6361152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361156">bitsPerPixel</span>&nbsp;<span class="op" id="6361169">=</span>&nbsp;<span class="num" id="6361171">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361176">gray16</span>&nbsp;<span class="op" id="6361183">=</span>&nbsp;<span class="ident" id="6361185">image</span><span class="op" id="6361190">.</span><span class="ident" id="6361191">NewGray16</span><span class="op" id="6361200">(</span><span class="ident" id="6361201">image</span><span class="op" id="6361206">.</span><span class="ident" id="6361207">Rect</span><span class="op" id="6361211">(</span><span class="num" id="6361212">0</span><span class="op" id="6361213">,</span>&nbsp;<span class="num" id="6361215">0</span><span class="op" id="6361216">,</span>&nbsp;<span class="ident" id="6361218">width</span><span class="op" id="6361223">,</span>&nbsp;<span class="ident" id="6361225">height</span><span class="op" id="6361231">)</span><span class="op" id="6361232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361236">img</span>&nbsp;<span class="op" id="6361240">=</span>&nbsp;<span class="ident" id="6361242">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361250">case</span>&nbsp;<span class="ident" id="6361255">cbGA16</span><span class="op" id="6361261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361265">bitsPerPixel</span>&nbsp;<span class="op" id="6361278">=</span>&nbsp;<span class="num" id="6361280">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361285">nrgba64</span>&nbsp;<span class="op" id="6361293">=</span>&nbsp;<span class="ident" id="6361295">image</span><span class="op" id="6361300">.</span><span class="ident" id="6361301">NewNRGBA64</span><span class="op" id="6361311">(</span><span class="ident" id="6361312">image</span><span class="op" id="6361317">.</span><span class="ident" id="6361318">Rect</span><span class="op" id="6361322">(</span><span class="num" id="6361323">0</span><span class="op" id="6361324">,</span>&nbsp;<span class="num" id="6361326">0</span><span class="op" id="6361327">,</span>&nbsp;<span class="ident" id="6361329">width</span><span class="op" id="6361334">,</span>&nbsp;<span class="ident" id="6361336">height</span><span class="op" id="6361342">)</span><span class="op" id="6361343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361347">img</span>&nbsp;<span class="op" id="6361351">=</span>&nbsp;<span class="ident" id="6361353">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361362">case</span>&nbsp;<span class="ident" id="6361367">cbTC16</span><span class="op" id="6361373">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361377">bitsPerPixel</span>&nbsp;<span class="op" id="6361390">=</span>&nbsp;<span class="num" id="6361392">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361397">rgba64</span>&nbsp;<span class="op" id="6361404">=</span>&nbsp;<span class="ident" id="6361406">image</span><span class="op" id="6361411">.</span><span class="ident" id="6361412">NewRGBA64</span><span class="op" id="6361421">(</span><span class="ident" id="6361422">image</span><span class="op" id="6361427">.</span><span class="ident" id="6361428">Rect</span><span class="op" id="6361432">(</span><span class="num" id="6361433">0</span><span class="op" id="6361434">,</span>&nbsp;<span class="num" id="6361436">0</span><span class="op" id="6361437">,</span>&nbsp;<span class="ident" id="6361439">width</span><span class="op" id="6361444">,</span>&nbsp;<span class="ident" id="6361446">height</span><span class="op" id="6361452">)</span><span class="op" id="6361453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361457">img</span>&nbsp;<span class="op" id="6361461">=</span>&nbsp;<span class="ident" id="6361463">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361471">case</span>&nbsp;<span class="ident" id="6361476">cbTCA16</span><span class="op" id="6361483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361487">bitsPerPixel</span>&nbsp;<span class="op" id="6361500">=</span>&nbsp;<span class="num" id="6361502">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361507">nrgba64</span>&nbsp;<span class="op" id="6361515">=</span>&nbsp;<span class="ident" id="6361517">image</span><span class="op" id="6361522">.</span><span class="ident" id="6361523">NewNRGBA64</span><span class="op" id="6361533">(</span><span class="ident" id="6361534">image</span><span class="op" id="6361539">.</span><span class="ident" id="6361540">Rect</span><span class="op" id="6361544">(</span><span class="num" id="6361545">0</span><span class="op" id="6361546">,</span>&nbsp;<span class="num" id="6361548">0</span><span class="op" id="6361549">,</span>&nbsp;<span class="ident" id="6361551">width</span><span class="op" id="6361556">,</span>&nbsp;<span class="ident" id="6361558">height</span><span class="op" id="6361564">)</span><span class="op" id="6361565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361569">img</span>&nbsp;<span class="op" id="6361573">=</span>&nbsp;<span class="ident" id="6361575">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361587">if</span>&nbsp;<span class="ident" id="6361590">allocateOnly</span>&nbsp;<span class="op" id="6361603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361607">return</span>&nbsp;<span class="ident" id="6361614">img</span><span class="op" id="6361617">,</span>&nbsp;<span class="ident" id="6361619">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361627">bytesPerPixel</span>&nbsp;<span class="op" id="6361641">:=</span>&nbsp;<span class="op" id="6361644">(</span><span class="ident" id="6361645">bitsPerPixel</span>&nbsp;<span class="op" id="6361658">+</span>&nbsp;<span class="num" id="6361660">7</span><span class="op" id="6361661">)</span>&nbsp;<span class="op" id="6361663">/</span>&nbsp;<span class="num" id="6361665">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361669">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361731">rowSize</span>&nbsp;<span class="op" id="6361739">:=</span>&nbsp;<span class="num" id="6361742">1</span>&nbsp;<span class="op" id="6361744">+</span>&nbsp;<span class="op" id="6361746">(</span><span class="ident" id="6361747">bitsPerPixel</span><span class="op" id="6361759">*</span><span class="ident" id="6361760">width</span><span class="op" id="6361765">+</span><span class="num" id="6361766">7</span><span class="op" id="6361767">)</span><span class="op" id="6361768">/</span><span class="num" id="6361769">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361772">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361834">cr</span>&nbsp;<span class="op" id="6361837">:=</span>&nbsp;<span class="builtinfunc" id="6361840">make</span><span class="op" id="6361844">(</span><span class="op" id="6361845">[</span><span class="op" id="6361846">]</span><span class="builtintype" id="6361847">uint8</span><span class="op" id="6361852">,</span>&nbsp;<span class="ident" id="6361854">rowSize</span><span class="op" id="6361861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361864">pr</span>&nbsp;<span class="op" id="6361867">:=</span>&nbsp;<span class="builtinfunc" id="6361870">make</span><span class="op" id="6361874">(</span><span class="op" id="6361875">[</span><span class="op" id="6361876">]</span><span class="builtintype" id="6361877">uint8</span><span class="op" id="6361882">,</span>&nbsp;<span class="ident" id="6361884">rowSize</span><span class="op" id="6361891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361895">for</span>&nbsp;<span class="ident" id="6361899">y</span>&nbsp;<span class="op" id="6361901">:=</span>&nbsp;<span class="num" id="6361904">0</span><span class="op" id="6361905">;</span>&nbsp;<span class="ident" id="6361907">y</span>&nbsp;<span class="op" id="6361909">&lt;</span>&nbsp;<span class="ident" id="6361911">height</span><span class="op" id="6361917">;</span>&nbsp;<span class="ident" id="6361919">y</span><span class="op" id="6361920">++</span>&nbsp;<span class="op" id="6361923">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361927">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361961">_</span><span class="op" id="6361962">,</span>&nbsp;<span class="ident" id="6361964">err</span>&nbsp;<span class="op" id="6361968">:=</span>&nbsp;<span class="ident" id="6361971">io</span><span class="op" id="6361973">.</span><span class="ident" id="6361974">ReadFull</span><span class="op" id="6361982">(</span><span class="ident" id="6361983">r</span><span class="op" id="6361984">,</span>&nbsp;<span class="ident" id="6361986">cr</span><span class="op" id="6361988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361992">if</span>&nbsp;<span class="ident" id="6361995">err</span>&nbsp;<span class="op" id="6361999">!=</span>&nbsp;<span class="ident" id="6362002">nil</span>&nbsp;<span class="op" id="6362006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362011">return</span>&nbsp;<span class="ident" id="6362018">nil</span><span class="op" id="6362021">,</span>&nbsp;<span class="ident" id="6362023">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362029">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362034">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362057">cdat</span>&nbsp;<span class="op" id="6362062">:=</span>&nbsp;<span class="ident" id="6362065">cr</span><span class="op" id="6362067">[</span><span class="num" id="6362068">1</span><span class="op" id="6362069">:</span><span class="op" id="6362070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362074">pdat</span>&nbsp;<span class="op" id="6362079">:=</span>&nbsp;<span class="ident" id="6362082">pr</span><span class="op" id="6362084">[</span><span class="num" id="6362085">1</span><span class="op" id="6362086">:</span><span class="op" id="6362087">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362091">switch</span>&nbsp;<span class="ident" id="6362098">cr</span><span class="op" id="6362100">[</span><span class="num" id="6362101">0</span><span class="op" id="6362102">]</span>&nbsp;<span class="op" id="6362104">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362108">case</span>&nbsp;<span class="ident" id="6362113">ftNone</span><span class="op" id="6362119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362124">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362136">case</span>&nbsp;<span class="ident" id="6362141">ftSub</span><span class="op" id="6362146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362151">for</span>&nbsp;<span class="ident" id="6362155">i</span>&nbsp;<span class="op" id="6362157">:=</span>&nbsp;<span class="ident" id="6362160">bytesPerPixel</span><span class="op" id="6362173">;</span>&nbsp;<span class="ident" id="6362175">i</span>&nbsp;<span class="op" id="6362177">&lt;</span>&nbsp;<span class="builtinfunc" id="6362179">len</span><span class="op" id="6362182">(</span><span class="ident" id="6362183">cdat</span><span class="op" id="6362187">)</span><span class="op" id="6362188">;</span>&nbsp;<span class="ident" id="6362190">i</span><span class="op" id="6362191">++</span>&nbsp;<span class="op" id="6362194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362200">cdat</span><span class="op" id="6362204">[</span><span class="ident" id="6362205">i</span><span class="op" id="6362206">]</span>&nbsp;<span class="op" id="6362208">+=</span>&nbsp;<span class="ident" id="6362211">cdat</span><span class="op" id="6362215">[</span><span class="ident" id="6362216">i</span><span class="op" id="6362217">-</span><span class="ident" id="6362218">bytesPerPixel</span><span class="op" id="6362231">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362240">case</span>&nbsp;<span class="ident" id="6362245">ftUp</span><span class="op" id="6362249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362254">for</span>&nbsp;<span class="ident" id="6362258">i</span><span class="op" id="6362259">,</span>&nbsp;<span class="ident" id="6362261">p</span>&nbsp;<span class="op" id="6362263">:=</span>&nbsp;<span class="keyword" id="6362266">range</span>&nbsp;<span class="ident" id="6362272">pdat</span>&nbsp;<span class="op" id="6362277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362283">cdat</span><span class="op" id="6362287">[</span><span class="ident" id="6362288">i</span><span class="op" id="6362289">]</span>&nbsp;<span class="op" id="6362291">+=</span>&nbsp;<span class="ident" id="6362294">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362299">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362303">case</span>&nbsp;<span class="ident" id="6362308">ftAverage</span><span class="op" id="6362317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362322">for</span>&nbsp;<span class="ident" id="6362326">i</span>&nbsp;<span class="op" id="6362328">:=</span>&nbsp;<span class="num" id="6362331">0</span><span class="op" id="6362332">;</span>&nbsp;<span class="ident" id="6362334">i</span>&nbsp;<span class="op" id="6362336">&lt;</span>&nbsp;<span class="ident" id="6362338">bytesPerPixel</span><span class="op" id="6362351">;</span>&nbsp;<span class="ident" id="6362353">i</span><span class="op" id="6362354">++</span>&nbsp;<span class="op" id="6362357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362363">cdat</span><span class="op" id="6362367">[</span><span class="ident" id="6362368">i</span><span class="op" id="6362369">]</span>&nbsp;<span class="op" id="6362371">+=</span>&nbsp;<span class="ident" id="6362374">pdat</span><span class="op" id="6362378">[</span><span class="ident" id="6362379">i</span><span class="op" id="6362380">]</span>&nbsp;<span class="op" id="6362382">/</span>&nbsp;<span class="num" id="6362384">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362394">for</span>&nbsp;<span class="ident" id="6362398">i</span>&nbsp;<span class="op" id="6362400">:=</span>&nbsp;<span class="ident" id="6362403">bytesPerPixel</span><span class="op" id="6362416">;</span>&nbsp;<span class="ident" id="6362418">i</span>&nbsp;<span class="op" id="6362420">&lt;</span>&nbsp;<span class="builtinfunc" id="6362422">len</span><span class="op" id="6362425">(</span><span class="ident" id="6362426">cdat</span><span class="op" id="6362430">)</span><span class="op" id="6362431">;</span>&nbsp;<span class="ident" id="6362433">i</span><span class="op" id="6362434">++</span>&nbsp;<span class="op" id="6362437">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362443">cdat</span><span class="op" id="6362447">[</span><span class="ident" id="6362448">i</span><span class="op" id="6362449">]</span>&nbsp;<span class="op" id="6362451">+=</span>&nbsp;<span class="builtintype" id="6362454">uint8</span><span class="op" id="6362459">(</span><span class="op" id="6362460">(</span><span class="builtintype" id="6362461">int</span><span class="op" id="6362464">(</span><span class="ident" id="6362465">cdat</span><span class="op" id="6362469">[</span><span class="ident" id="6362470">i</span><span class="op" id="6362471">-</span><span class="ident" id="6362472">bytesPerPixel</span><span class="op" id="6362485">]</span><span class="op" id="6362486">)</span>&nbsp;<span class="op" id="6362488">+</span>&nbsp;<span class="builtintype" id="6362490">int</span><span class="op" id="6362493">(</span><span class="ident" id="6362494">pdat</span><span class="op" id="6362498">[</span><span class="ident" id="6362499">i</span><span class="op" id="6362500">]</span><span class="op" id="6362501">)</span><span class="op" id="6362502">)</span>&nbsp;<span class="op" id="6362504">/</span>&nbsp;<span class="num" id="6362506">2</span><span class="op" id="6362507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362516">case</span>&nbsp;<span class="ident" id="6362521">ftPaeth</span><span class="op" id="6362528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362533">filterPaeth</span><span class="op" id="6362544">(</span><span class="ident" id="6362545">cdat</span><span class="op" id="6362549">,</span>&nbsp;<span class="ident" id="6362551">pdat</span><span class="op" id="6362555">,</span>&nbsp;<span class="ident" id="6362557">bytesPerPixel</span><span class="op" id="6362570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362574">default</span><span class="op" id="6362581">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362586">return</span>&nbsp;<span class="ident" id="6362593">nil</span><span class="op" id="6362596">,</span>&nbsp;<span class="ident" id="6362598">FormatError</span><span class="op" id="6362609">(</span><span class="string" id="6362610">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="6362627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362636">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362671">switch</span>&nbsp;<span class="ident" id="6362678">d</span><span class="op" id="6362679">.</span><span class="ident" id="6362680">cb</span>&nbsp;<span class="op" id="6362683">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362687">case</span>&nbsp;<span class="ident" id="6362692">cbG1</span><span class="op" id="6362696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362701">for</span>&nbsp;<span class="ident" id="6362705">x</span>&nbsp;<span class="op" id="6362707">:=</span>&nbsp;<span class="num" id="6362710">0</span><span class="op" id="6362711">;</span>&nbsp;<span class="ident" id="6362713">x</span>&nbsp;<span class="op" id="6362715">&lt;</span>&nbsp;<span class="ident" id="6362717">width</span><span class="op" id="6362722">;</span>&nbsp;<span class="ident" id="6362724">x</span>&nbsp;<span class="op" id="6362726">+=</span>&nbsp;<span class="num" id="6362729">8</span>&nbsp;<span class="op" id="6362731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362737">b</span>&nbsp;<span class="op" id="6362739">:=</span>&nbsp;<span class="ident" id="6362742">cdat</span><span class="op" id="6362746">[</span><span class="ident" id="6362747">x</span><span class="op" id="6362748">/</span><span class="num" id="6362749">8</span><span class="op" id="6362750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362756">for</span>&nbsp;<span class="ident" id="6362760">x2</span>&nbsp;<span class="op" id="6362763">:=</span>&nbsp;<span class="num" id="6362766">0</span><span class="op" id="6362767">;</span>&nbsp;<span class="ident" id="6362769">x2</span>&nbsp;<span class="op" id="6362772">&lt;</span>&nbsp;<span class="num" id="6362774">8</span>&nbsp;<span class="op" id="6362776">&amp;&amp;</span>&nbsp;<span class="ident" id="6362779">x</span><span class="op" id="6362780">+</span><span class="ident" id="6362781">x2</span>&nbsp;<span class="op" id="6362784">&lt;</span>&nbsp;<span class="ident" id="6362786">width</span><span class="op" id="6362791">;</span>&nbsp;<span class="ident" id="6362793">x2</span><span class="op" id="6362795">++</span>&nbsp;<span class="op" id="6362798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362805">gray</span><span class="op" id="6362809">.</span><span class="ident" id="6362810">SetGray</span><span class="op" id="6362817">(</span><span class="ident" id="6362818">x</span><span class="op" id="6362819">+</span><span class="ident" id="6362820">x2</span><span class="op" id="6362822">,</span>&nbsp;<span class="ident" id="6362824">y</span><span class="op" id="6362825">,</span>&nbsp;<span class="ident" id="6362827">color</span><span class="op" id="6362832">.</span><span class="ident" id="6362833">Gray</span><span class="op" id="6362837">{</span><span class="op" id="6362838">(</span><span class="ident" id="6362839">b</span>&nbsp;<span class="op" id="6362841">&gt;&gt;</span>&nbsp;<span class="num" id="6362844">7</span><span class="op" id="6362845">)</span>&nbsp;<span class="op" id="6362847">*</span>&nbsp;<span class="num" id="6362849">0xff</span><span class="op" id="6362853">}</span><span class="op" id="6362854">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362861">b</span>&nbsp;<span class="op" id="6362863">&lt;&lt;=</span>&nbsp;<span class="num" id="6362867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362882">case</span>&nbsp;<span class="ident" id="6362887">cbG2</span><span class="op" id="6362891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362896">for</span>&nbsp;<span class="ident" id="6362900">x</span>&nbsp;<span class="op" id="6362902">:=</span>&nbsp;<span class="num" id="6362905">0</span><span class="op" id="6362906">;</span>&nbsp;<span class="ident" id="6362908">x</span>&nbsp;<span class="op" id="6362910">&lt;</span>&nbsp;<span class="ident" id="6362912">width</span><span class="op" id="6362917">;</span>&nbsp;<span class="ident" id="6362919">x</span>&nbsp;<span class="op" id="6362921">+=</span>&nbsp;<span class="num" id="6362924">4</span>&nbsp;<span class="op" id="6362926">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362932">b</span>&nbsp;<span class="op" id="6362934">:=</span>&nbsp;<span class="ident" id="6362937">cdat</span><span class="op" id="6362941">[</span><span class="ident" id="6362942">x</span><span class="op" id="6362943">/</span><span class="num" id="6362944">4</span><span class="op" id="6362945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362951">for</span>&nbsp;<span class="ident" id="6362955">x2</span>&nbsp;<span class="op" id="6362958">:=</span>&nbsp;<span class="num" id="6362961">0</span><span class="op" id="6362962">;</span>&nbsp;<span class="ident" id="6362964">x2</span>&nbsp;<span class="op" id="6362967">&lt;</span>&nbsp;<span class="num" id="6362969">4</span>&nbsp;<span class="op" id="6362971">&amp;&amp;</span>&nbsp;<span class="ident" id="6362974">x</span><span class="op" id="6362975">+</span><span class="ident" id="6362976">x2</span>&nbsp;<span class="op" id="6362979">&lt;</span>&nbsp;<span class="ident" id="6362981">width</span><span class="op" id="6362986">;</span>&nbsp;<span class="ident" id="6362988">x2</span><span class="op" id="6362990">++</span>&nbsp;<span class="op" id="6362993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363000">gray</span><span class="op" id="6363004">.</span><span class="ident" id="6363005">SetGray</span><span class="op" id="6363012">(</span><span class="ident" id="6363013">x</span><span class="op" id="6363014">+</span><span class="ident" id="6363015">x2</span><span class="op" id="6363017">,</span>&nbsp;<span class="ident" id="6363019">y</span><span class="op" id="6363020">,</span>&nbsp;<span class="ident" id="6363022">color</span><span class="op" id="6363027">.</span><span class="ident" id="6363028">Gray</span><span class="op" id="6363032">{</span><span class="op" id="6363033">(</span><span class="ident" id="6363034">b</span>&nbsp;<span class="op" id="6363036">&gt;&gt;</span>&nbsp;<span class="num" id="6363039">6</span><span class="op" id="6363040">)</span>&nbsp;<span class="op" id="6363042">*</span>&nbsp;<span class="num" id="6363044">0x55</span><span class="op" id="6363048">}</span><span class="op" id="6363049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363056">b</span>&nbsp;<span class="op" id="6363058">&lt;&lt;=</span>&nbsp;<span class="num" id="6363062">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363068">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363077">case</span>&nbsp;<span class="ident" id="6363082">cbG4</span><span class="op" id="6363086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363091">for</span>&nbsp;<span class="ident" id="6363095">x</span>&nbsp;<span class="op" id="6363097">:=</span>&nbsp;<span class="num" id="6363100">0</span><span class="op" id="6363101">;</span>&nbsp;<span class="ident" id="6363103">x</span>&nbsp;<span class="op" id="6363105">&lt;</span>&nbsp;<span class="ident" id="6363107">width</span><span class="op" id="6363112">;</span>&nbsp;<span class="ident" id="6363114">x</span>&nbsp;<span class="op" id="6363116">+=</span>&nbsp;<span class="num" id="6363119">2</span>&nbsp;<span class="op" id="6363121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363127">b</span>&nbsp;<span class="op" id="6363129">:=</span>&nbsp;<span class="ident" id="6363132">cdat</span><span class="op" id="6363136">[</span><span class="ident" id="6363137">x</span><span class="op" id="6363138">/</span><span class="num" id="6363139">2</span><span class="op" id="6363140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363146">for</span>&nbsp;<span class="ident" id="6363150">x2</span>&nbsp;<span class="op" id="6363153">:=</span>&nbsp;<span class="num" id="6363156">0</span><span class="op" id="6363157">;</span>&nbsp;<span class="ident" id="6363159">x2</span>&nbsp;<span class="op" id="6363162">&lt;</span>&nbsp;<span class="num" id="6363164">2</span>&nbsp;<span class="op" id="6363166">&amp;&amp;</span>&nbsp;<span class="ident" id="6363169">x</span><span class="op" id="6363170">+</span><span class="ident" id="6363171">x2</span>&nbsp;<span class="op" id="6363174">&lt;</span>&nbsp;<span class="ident" id="6363176">width</span><span class="op" id="6363181">;</span>&nbsp;<span class="ident" id="6363183">x2</span><span class="op" id="6363185">++</span>&nbsp;<span class="op" id="6363188">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363195">gray</span><span class="op" id="6363199">.</span><span class="ident" id="6363200">SetGray</span><span class="op" id="6363207">(</span><span class="ident" id="6363208">x</span><span class="op" id="6363209">+</span><span class="ident" id="6363210">x2</span><span class="op" id="6363212">,</span>&nbsp;<span class="ident" id="6363214">y</span><span class="op" id="6363215">,</span>&nbsp;<span class="ident" id="6363217">color</span><span class="op" id="6363222">.</span><span class="ident" id="6363223">Gray</span><span class="op" id="6363227">{</span><span class="op" id="6363228">(</span><span class="ident" id="6363229">b</span>&nbsp;<span class="op" id="6363231">&gt;&gt;</span>&nbsp;<span class="num" id="6363234">4</span><span class="op" id="6363235">)</span>&nbsp;<span class="op" id="6363237">*</span>&nbsp;<span class="num" id="6363239">0x11</span><span class="op" id="6363243">}</span><span class="op" id="6363244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363251">b</span>&nbsp;<span class="op" id="6363253">&lt;&lt;=</span>&nbsp;<span class="num" id="6363257">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363272">case</span>&nbsp;<span class="ident" id="6363277">cbG8</span><span class="op" id="6363281">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6363286">copy</span><span class="op" id="6363290">(</span><span class="ident" id="6363291">gray</span><span class="op" id="6363295">.</span><span class="ident" id="6363296">Pix</span><span class="op" id="6363299">[</span><span class="ident" id="6363300">pixOffset</span><span class="op" id="6363309">:</span><span class="op" id="6363310">]</span><span class="op" id="6363311">,</span>&nbsp;<span class="ident" id="6363313">cdat</span><span class="op" id="6363317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363322">pixOffset</span>&nbsp;<span class="op" id="6363332">+=</span>&nbsp;<span class="ident" id="6363335">gray</span><span class="op" id="6363339">.</span><span class="ident" id="6363340">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363349">case</span>&nbsp;<span class="ident" id="6363354">cbGA8</span><span class="op" id="6363359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363364">for</span>&nbsp;<span class="ident" id="6363368">x</span>&nbsp;<span class="op" id="6363370">:=</span>&nbsp;<span class="num" id="6363373">0</span><span class="op" id="6363374">;</span>&nbsp;<span class="ident" id="6363376">x</span>&nbsp;<span class="op" id="6363378">&lt;</span>&nbsp;<span class="ident" id="6363380">width</span><span class="op" id="6363385">;</span>&nbsp;<span class="ident" id="6363387">x</span><span class="op" id="6363388">++</span>&nbsp;<span class="op" id="6363391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363397">ycol</span>&nbsp;<span class="op" id="6363402">:=</span>&nbsp;<span class="ident" id="6363405">cdat</span><span class="op" id="6363409">[</span><span class="num" id="6363410">2</span><span class="op" id="6363411">*</span><span class="ident" id="6363412">x</span><span class="op" id="6363413">+</span><span class="num" id="6363414">0</span><span class="op" id="6363415">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363421">nrgba</span><span class="op" id="6363426">.</span><span class="ident" id="6363427">SetNRGBA</span><span class="op" id="6363435">(</span><span class="ident" id="6363436">x</span><span class="op" id="6363437">,</span>&nbsp;<span class="ident" id="6363439">y</span><span class="op" id="6363440">,</span>&nbsp;<span class="ident" id="6363442">color</span><span class="op" id="6363447">.</span><span class="ident" id="6363448">NRGBA</span><span class="op" id="6363453">{</span><span class="ident" id="6363454">ycol</span><span class="op" id="6363458">,</span>&nbsp;<span class="ident" id="6363460">ycol</span><span class="op" id="6363464">,</span>&nbsp;<span class="ident" id="6363466">ycol</span><span class="op" id="6363470">,</span>&nbsp;<span class="ident" id="6363472">cdat</span><span class="op" id="6363476">[</span><span class="num" id="6363477">2</span><span class="op" id="6363478">*</span><span class="ident" id="6363479">x</span><span class="op" id="6363480">+</span><span class="num" id="6363481">1</span><span class="op" id="6363482">]</span><span class="op" id="6363483">}</span><span class="op" id="6363484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363493">case</span>&nbsp;<span class="ident" id="6363498">cbTC8</span><span class="op" id="6363503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363508">pix</span><span class="op" id="6363511">,</span>&nbsp;<span class="ident" id="6363513">i</span><span class="op" id="6363514">,</span>&nbsp;<span class="ident" id="6363516">j</span>&nbsp;<span class="op" id="6363518">:=</span>&nbsp;<span class="ident" id="6363521">rgba</span><span class="op" id="6363525">.</span><span class="ident" id="6363526">Pix</span><span class="op" id="6363529">,</span>&nbsp;<span class="ident" id="6363531">pixOffset</span><span class="op" id="6363540">,</span>&nbsp;<span class="num" id="6363542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363547">for</span>&nbsp;<span class="ident" id="6363551">x</span>&nbsp;<span class="op" id="6363553">:=</span>&nbsp;<span class="num" id="6363556">0</span><span class="op" id="6363557">;</span>&nbsp;<span class="ident" id="6363559">x</span>&nbsp;<span class="op" id="6363561">&lt;</span>&nbsp;<span class="ident" id="6363563">width</span><span class="op" id="6363568">;</span>&nbsp;<span class="ident" id="6363570">x</span><span class="op" id="6363571">++</span>&nbsp;<span class="op" id="6363574">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363580">pix</span><span class="op" id="6363583">[</span><span class="ident" id="6363584">i</span><span class="op" id="6363585">+</span><span class="num" id="6363586">0</span><span class="op" id="6363587">]</span>&nbsp;<span class="op" id="6363589">=</span>&nbsp;<span class="ident" id="6363591">cdat</span><span class="op" id="6363595">[</span><span class="ident" id="6363596">j</span><span class="op" id="6363597">+</span><span class="num" id="6363598">0</span><span class="op" id="6363599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363605">pix</span><span class="op" id="6363608">[</span><span class="ident" id="6363609">i</span><span class="op" id="6363610">+</span><span class="num" id="6363611">1</span><span class="op" id="6363612">]</span>&nbsp;<span class="op" id="6363614">=</span>&nbsp;<span class="ident" id="6363616">cdat</span><span class="op" id="6363620">[</span><span class="ident" id="6363621">j</span><span class="op" id="6363622">+</span><span class="num" id="6363623">1</span><span class="op" id="6363624">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363630">pix</span><span class="op" id="6363633">[</span><span class="ident" id="6363634">i</span><span class="op" id="6363635">+</span><span class="num" id="6363636">2</span><span class="op" id="6363637">]</span>&nbsp;<span class="op" id="6363639">=</span>&nbsp;<span class="ident" id="6363641">cdat</span><span class="op" id="6363645">[</span><span class="ident" id="6363646">j</span><span class="op" id="6363647">+</span><span class="num" id="6363648">2</span><span class="op" id="6363649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363655">pix</span><span class="op" id="6363658">[</span><span class="ident" id="6363659">i</span><span class="op" id="6363660">+</span><span class="num" id="6363661">3</span><span class="op" id="6363662">]</span>&nbsp;<span class="op" id="6363664">=</span>&nbsp;<span class="num" id="6363666">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363675">i</span>&nbsp;<span class="op" id="6363677">+=</span>&nbsp;<span class="num" id="6363680">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363686">j</span>&nbsp;<span class="op" id="6363688">+=</span>&nbsp;<span class="num" id="6363691">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363701">pixOffset</span>&nbsp;<span class="op" id="6363711">+=</span>&nbsp;<span class="ident" id="6363714">rgba</span><span class="op" id="6363718">.</span><span class="ident" id="6363719">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363728">case</span>&nbsp;<span class="ident" id="6363733">cbP1</span><span class="op" id="6363737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363742">for</span>&nbsp;<span class="ident" id="6363746">x</span>&nbsp;<span class="op" id="6363748">:=</span>&nbsp;<span class="num" id="6363751">0</span><span class="op" id="6363752">;</span>&nbsp;<span class="ident" id="6363754">x</span>&nbsp;<span class="op" id="6363756">&lt;</span>&nbsp;<span class="ident" id="6363758">width</span><span class="op" id="6363763">;</span>&nbsp;<span class="ident" id="6363765">x</span>&nbsp;<span class="op" id="6363767">+=</span>&nbsp;<span class="num" id="6363770">8</span>&nbsp;<span class="op" id="6363772">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363778">b</span>&nbsp;<span class="op" id="6363780">:=</span>&nbsp;<span class="ident" id="6363783">cdat</span><span class="op" id="6363787">[</span><span class="ident" id="6363788">x</span><span class="op" id="6363789">/</span><span class="num" id="6363790">8</span><span class="op" id="6363791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363797">for</span>&nbsp;<span class="ident" id="6363801">x2</span>&nbsp;<span class="op" id="6363804">:=</span>&nbsp;<span class="num" id="6363807">0</span><span class="op" id="6363808">;</span>&nbsp;<span class="ident" id="6363810">x2</span>&nbsp;<span class="op" id="6363813">&lt;</span>&nbsp;<span class="num" id="6363815">8</span>&nbsp;<span class="op" id="6363817">&amp;&amp;</span>&nbsp;<span class="ident" id="6363820">x</span><span class="op" id="6363821">+</span><span class="ident" id="6363822">x2</span>&nbsp;<span class="op" id="6363825">&lt;</span>&nbsp;<span class="ident" id="6363827">width</span><span class="op" id="6363832">;</span>&nbsp;<span class="ident" id="6363834">x2</span><span class="op" id="6363836">++</span>&nbsp;<span class="op" id="6363839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363846">idx</span>&nbsp;<span class="op" id="6363850">:=</span>&nbsp;<span class="ident" id="6363853">b</span>&nbsp;<span class="op" id="6363855">&gt;&gt;</span>&nbsp;<span class="num" id="6363858">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363865">if</span>&nbsp;<span class="builtinfunc" id="6363868">len</span><span class="op" id="6363871">(</span><span class="ident" id="6363872">paletted</span><span class="op" id="6363880">.</span><span class="ident" id="6363881">Palette</span><span class="op" id="6363888">)</span>&nbsp;<span class="op" id="6363890">&lt;=</span>&nbsp;<span class="builtintype" id="6363893">int</span><span class="op" id="6363896">(</span><span class="ident" id="6363897">idx</span><span class="op" id="6363900">)</span>&nbsp;<span class="op" id="6363902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363910">paletted</span><span class="op" id="6363918">.</span><span class="ident" id="6363919">Palette</span>&nbsp;<span class="op" id="6363927">=</span>&nbsp;<span class="ident" id="6363929">paletted</span><span class="op" id="6363937">.</span><span class="ident" id="6363938">Palette</span><span class="op" id="6363945">[</span><span class="op" id="6363946">:</span><span class="builtintype" id="6363947">int</span><span class="op" id="6363950">(</span><span class="ident" id="6363951">idx</span><span class="op" id="6363954">)</span><span class="op" id="6363955">+</span><span class="num" id="6363956">1</span><span class="op" id="6363957">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363971">paletted</span><span class="op" id="6363979">.</span><span class="ident" id="6363980">SetColorIndex</span><span class="op" id="6363993">(</span><span class="ident" id="6363994">x</span><span class="op" id="6363995">+</span><span class="ident" id="6363996">x2</span><span class="op" id="6363998">,</span>&nbsp;<span class="ident" id="6364000">y</span><span class="op" id="6364001">,</span>&nbsp;<span class="ident" id="6364003">idx</span><span class="op" id="6364006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364013">b</span>&nbsp;<span class="op" id="6364015">&lt;&lt;=</span>&nbsp;<span class="num" id="6364019">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364030">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364034">case</span>&nbsp;<span class="ident" id="6364039">cbP2</span><span class="op" id="6364043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364048">for</span>&nbsp;<span class="ident" id="6364052">x</span>&nbsp;<span class="op" id="6364054">:=</span>&nbsp;<span class="num" id="6364057">0</span><span class="op" id="6364058">;</span>&nbsp;<span class="ident" id="6364060">x</span>&nbsp;<span class="op" id="6364062">&lt;</span>&nbsp;<span class="ident" id="6364064">width</span><span class="op" id="6364069">;</span>&nbsp;<span class="ident" id="6364071">x</span>&nbsp;<span class="op" id="6364073">+=</span>&nbsp;<span class="num" id="6364076">4</span>&nbsp;<span class="op" id="6364078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364084">b</span>&nbsp;<span class="op" id="6364086">:=</span>&nbsp;<span class="ident" id="6364089">cdat</span><span class="op" id="6364093">[</span><span class="ident" id="6364094">x</span><span class="op" id="6364095">/</span><span class="num" id="6364096">4</span><span class="op" id="6364097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364103">for</span>&nbsp;<span class="ident" id="6364107">x2</span>&nbsp;<span class="op" id="6364110">:=</span>&nbsp;<span class="num" id="6364113">0</span><span class="op" id="6364114">;</span>&nbsp;<span class="ident" id="6364116">x2</span>&nbsp;<span class="op" id="6364119">&lt;</span>&nbsp;<span class="num" id="6364121">4</span>&nbsp;<span class="op" id="6364123">&amp;&amp;</span>&nbsp;<span class="ident" id="6364126">x</span><span class="op" id="6364127">+</span><span class="ident" id="6364128">x2</span>&nbsp;<span class="op" id="6364131">&lt;</span>&nbsp;<span class="ident" id="6364133">width</span><span class="op" id="6364138">;</span>&nbsp;<span class="ident" id="6364140">x2</span><span class="op" id="6364142">++</span>&nbsp;<span class="op" id="6364145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364152">idx</span>&nbsp;<span class="op" id="6364156">:=</span>&nbsp;<span class="ident" id="6364159">b</span>&nbsp;<span class="op" id="6364161">&gt;&gt;</span>&nbsp;<span class="num" id="6364164">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364171">if</span>&nbsp;<span class="builtinfunc" id="6364174">len</span><span class="op" id="6364177">(</span><span class="ident" id="6364178">paletted</span><span class="op" id="6364186">.</span><span class="ident" id="6364187">Palette</span><span class="op" id="6364194">)</span>&nbsp;<span class="op" id="6364196">&lt;=</span>&nbsp;<span class="builtintype" id="6364199">int</span><span class="op" id="6364202">(</span><span class="ident" id="6364203">idx</span><span class="op" id="6364206">)</span>&nbsp;<span class="op" id="6364208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364216">paletted</span><span class="op" id="6364224">.</span><span class="ident" id="6364225">Palette</span>&nbsp;<span class="op" id="6364233">=</span>&nbsp;<span class="ident" id="6364235">paletted</span><span class="op" id="6364243">.</span><span class="ident" id="6364244">Palette</span><span class="op" id="6364251">[</span><span class="op" id="6364252">:</span><span class="builtintype" id="6364253">int</span><span class="op" id="6364256">(</span><span class="ident" id="6364257">idx</span><span class="op" id="6364260">)</span><span class="op" id="6364261">+</span><span class="num" id="6364262">1</span><span class="op" id="6364263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364277">paletted</span><span class="op" id="6364285">.</span><span class="ident" id="6364286">SetColorIndex</span><span class="op" id="6364299">(</span><span class="ident" id="6364300">x</span><span class="op" id="6364301">+</span><span class="ident" id="6364302">x2</span><span class="op" id="6364304">,</span>&nbsp;<span class="ident" id="6364306">y</span><span class="op" id="6364307">,</span>&nbsp;<span class="ident" id="6364309">idx</span><span class="op" id="6364312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364319">b</span>&nbsp;<span class="op" id="6364321">&lt;&lt;=</span>&nbsp;<span class="num" id="6364325">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364340">case</span>&nbsp;<span class="ident" id="6364345">cbP4</span><span class="op" id="6364349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364354">for</span>&nbsp;<span class="ident" id="6364358">x</span>&nbsp;<span class="op" id="6364360">:=</span>&nbsp;<span class="num" id="6364363">0</span><span class="op" id="6364364">;</span>&nbsp;<span class="ident" id="6364366">x</span>&nbsp;<span class="op" id="6364368">&lt;</span>&nbsp;<span class="ident" id="6364370">width</span><span class="op" id="6364375">;</span>&nbsp;<span class="ident" id="6364377">x</span>&nbsp;<span class="op" id="6364379">+=</span>&nbsp;<span class="num" id="6364382">2</span>&nbsp;<span class="op" id="6364384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364390">b</span>&nbsp;<span class="op" id="6364392">:=</span>&nbsp;<span class="ident" id="6364395">cdat</span><span class="op" id="6364399">[</span><span class="ident" id="6364400">x</span><span class="op" id="6364401">/</span><span class="num" id="6364402">2</span><span class="op" id="6364403">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364409">for</span>&nbsp;<span class="ident" id="6364413">x2</span>&nbsp;<span class="op" id="6364416">:=</span>&nbsp;<span class="num" id="6364419">0</span><span class="op" id="6364420">;</span>&nbsp;<span class="ident" id="6364422">x2</span>&nbsp;<span class="op" id="6364425">&lt;</span>&nbsp;<span class="num" id="6364427">2</span>&nbsp;<span class="op" id="6364429">&amp;&amp;</span>&nbsp;<span class="ident" id="6364432">x</span><span class="op" id="6364433">+</span><span class="ident" id="6364434">x2</span>&nbsp;<span class="op" id="6364437">&lt;</span>&nbsp;<span class="ident" id="6364439">width</span><span class="op" id="6364444">;</span>&nbsp;<span class="ident" id="6364446">x2</span><span class="op" id="6364448">++</span>&nbsp;<span class="op" id="6364451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364458">idx</span>&nbsp;<span class="op" id="6364462">:=</span>&nbsp;<span class="ident" id="6364465">b</span>&nbsp;<span class="op" id="6364467">&gt;&gt;</span>&nbsp;<span class="num" id="6364470">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364477">if</span>&nbsp;<span class="builtinfunc" id="6364480">len</span><span class="op" id="6364483">(</span><span class="ident" id="6364484">paletted</span><span class="op" id="6364492">.</span><span class="ident" id="6364493">Palette</span><span class="op" id="6364500">)</span>&nbsp;<span class="op" id="6364502">&lt;=</span>&nbsp;<span class="builtintype" id="6364505">int</span><span class="op" id="6364508">(</span><span class="ident" id="6364509">idx</span><span class="op" id="6364512">)</span>&nbsp;<span class="op" id="6364514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364522">paletted</span><span class="op" id="6364530">.</span><span class="ident" id="6364531">Palette</span>&nbsp;<span class="op" id="6364539">=</span>&nbsp;<span class="ident" id="6364541">paletted</span><span class="op" id="6364549">.</span><span class="ident" id="6364550">Palette</span><span class="op" id="6364557">[</span><span class="op" id="6364558">:</span><span class="builtintype" id="6364559">int</span><span class="op" id="6364562">(</span><span class="ident" id="6364563">idx</span><span class="op" id="6364566">)</span><span class="op" id="6364567">+</span><span class="num" id="6364568">1</span><span class="op" id="6364569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364576">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364583">paletted</span><span class="op" id="6364591">.</span><span class="ident" id="6364592">SetColorIndex</span><span class="op" id="6364605">(</span><span class="ident" id="6364606">x</span><span class="op" id="6364607">+</span><span class="ident" id="6364608">x2</span><span class="op" id="6364610">,</span>&nbsp;<span class="ident" id="6364612">y</span><span class="op" id="6364613">,</span>&nbsp;<span class="ident" id="6364615">idx</span><span class="op" id="6364618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364625">b</span>&nbsp;<span class="op" id="6364627">&lt;&lt;=</span>&nbsp;<span class="num" id="6364631">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364646">case</span>&nbsp;<span class="ident" id="6364651">cbP8</span><span class="op" id="6364655">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364660">if</span>&nbsp;<span class="builtinfunc" id="6364663">len</span><span class="op" id="6364666">(</span><span class="ident" id="6364667">paletted</span><span class="op" id="6364675">.</span><span class="ident" id="6364676">Palette</span><span class="op" id="6364683">)</span>&nbsp;<span class="op" id="6364685">!=</span>&nbsp;<span class="num" id="6364688">255</span>&nbsp;<span class="op" id="6364692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364698">for</span>&nbsp;<span class="ident" id="6364702">x</span>&nbsp;<span class="op" id="6364704">:=</span>&nbsp;<span class="num" id="6364707">0</span><span class="op" id="6364708">;</span>&nbsp;<span class="ident" id="6364710">x</span>&nbsp;<span class="op" id="6364712">&lt;</span>&nbsp;<span class="ident" id="6364714">width</span><span class="op" id="6364719">;</span>&nbsp;<span class="ident" id="6364721">x</span><span class="op" id="6364722">++</span>&nbsp;<span class="op" id="6364725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364732">if</span>&nbsp;<span class="builtinfunc" id="6364735">len</span><span class="op" id="6364738">(</span><span class="ident" id="6364739">paletted</span><span class="op" id="6364747">.</span><span class="ident" id="6364748">Palette</span><span class="op" id="6364755">)</span>&nbsp;<span class="op" id="6364757">&lt;=</span>&nbsp;<span class="builtintype" id="6364760">int</span><span class="op" id="6364763">(</span><span class="ident" id="6364764">cdat</span><span class="op" id="6364768">[</span><span class="ident" id="6364769">x</span><span class="op" id="6364770">]</span><span class="op" id="6364771">)</span>&nbsp;<span class="op" id="6364773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364781">paletted</span><span class="op" id="6364789">.</span><span class="ident" id="6364790">Palette</span>&nbsp;<span class="op" id="6364798">=</span>&nbsp;<span class="ident" id="6364800">paletted</span><span class="op" id="6364808">.</span><span class="ident" id="6364809">Palette</span><span class="op" id="6364816">[</span><span class="op" id="6364817">:</span><span class="builtintype" id="6364818">int</span><span class="op" id="6364821">(</span><span class="ident" id="6364822">cdat</span><span class="op" id="6364826">[</span><span class="ident" id="6364827">x</span><span class="op" id="6364828">]</span><span class="op" id="6364829">)</span><span class="op" id="6364830">+</span><span class="num" id="6364831">1</span><span class="op" id="6364832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364839">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6364855">copy</span><span class="op" id="6364859">(</span><span class="ident" id="6364860">paletted</span><span class="op" id="6364868">.</span><span class="ident" id="6364869">Pix</span><span class="op" id="6364872">[</span><span class="ident" id="6364873">pixOffset</span><span class="op" id="6364882">:</span><span class="op" id="6364883">]</span><span class="op" id="6364884">,</span>&nbsp;<span class="ident" id="6364886">cdat</span><span class="op" id="6364890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364895">pixOffset</span>&nbsp;<span class="op" id="6364905">+=</span>&nbsp;<span class="ident" id="6364908">paletted</span><span class="op" id="6364916">.</span><span class="ident" id="6364917">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364926">case</span>&nbsp;<span class="ident" id="6364931">cbTCA8</span><span class="op" id="6364937">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6364942">copy</span><span class="op" id="6364946">(</span><span class="ident" id="6364947">nrgba</span><span class="op" id="6364952">.</span><span class="ident" id="6364953">Pix</span><span class="op" id="6364956">[</span><span class="ident" id="6364957">pixOffset</span><span class="op" id="6364966">:</span><span class="op" id="6364967">]</span><span class="op" id="6364968">,</span>&nbsp;<span class="ident" id="6364970">cdat</span><span class="op" id="6364974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364979">pixOffset</span>&nbsp;<span class="op" id="6364989">+=</span>&nbsp;<span class="ident" id="6364992">nrgba</span><span class="op" id="6364997">.</span><span class="ident" id="6364998">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365007">case</span>&nbsp;<span class="ident" id="6365012">cbG16</span><span class="op" id="6365017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365022">for</span>&nbsp;<span class="ident" id="6365026">x</span>&nbsp;<span class="op" id="6365028">:=</span>&nbsp;<span class="num" id="6365031">0</span><span class="op" id="6365032">;</span>&nbsp;<span class="ident" id="6365034">x</span>&nbsp;<span class="op" id="6365036">&lt;</span>&nbsp;<span class="ident" id="6365038">width</span><span class="op" id="6365043">;</span>&nbsp;<span class="ident" id="6365045">x</span><span class="op" id="6365046">++</span>&nbsp;<span class="op" id="6365049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365055">ycol</span>&nbsp;<span class="op" id="6365060">:=</span>&nbsp;<span class="builtintype" id="6365063">uint16</span><span class="op" id="6365069">(</span><span class="ident" id="6365070">cdat</span><span class="op" id="6365074">[</span><span class="num" id="6365075">2</span><span class="op" id="6365076">*</span><span class="ident" id="6365077">x</span><span class="op" id="6365078">+</span><span class="num" id="6365079">0</span><span class="op" id="6365080">]</span><span class="op" id="6365081">)</span><span class="op" id="6365082">&lt;&lt;</span><span class="num" id="6365084">8</span>&nbsp;<span class="op" id="6365086">|</span>&nbsp;<span class="builtintype" id="6365088">uint16</span><span class="op" id="6365094">(</span><span class="ident" id="6365095">cdat</span><span class="op" id="6365099">[</span><span class="num" id="6365100">2</span><span class="op" id="6365101">*</span><span class="ident" id="6365102">x</span><span class="op" id="6365103">+</span><span class="num" id="6365104">1</span><span class="op" id="6365105">]</span><span class="op" id="6365106">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365112">gray16</span><span class="op" id="6365118">.</span><span class="ident" id="6365119">SetGray16</span><span class="op" id="6365128">(</span><span class="ident" id="6365129">x</span><span class="op" id="6365130">,</span>&nbsp;<span class="ident" id="6365132">y</span><span class="op" id="6365133">,</span>&nbsp;<span class="ident" id="6365135">color</span><span class="op" id="6365140">.</span><span class="ident" id="6365141">Gray16</span><span class="op" id="6365147">{</span><span class="ident" id="6365148">ycol</span><span class="op" id="6365152">}</span><span class="op" id="6365153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365162">case</span>&nbsp;<span class="ident" id="6365167">cbGA16</span><span class="op" id="6365173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365178">for</span>&nbsp;<span class="ident" id="6365182">x</span>&nbsp;<span class="op" id="6365184">:=</span>&nbsp;<span class="num" id="6365187">0</span><span class="op" id="6365188">;</span>&nbsp;<span class="ident" id="6365190">x</span>&nbsp;<span class="op" id="6365192">&lt;</span>&nbsp;<span class="ident" id="6365194">width</span><span class="op" id="6365199">;</span>&nbsp;<span class="ident" id="6365201">x</span><span class="op" id="6365202">++</span>&nbsp;<span class="op" id="6365205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365211">ycol</span>&nbsp;<span class="op" id="6365216">:=</span>&nbsp;<span class="builtintype" id="6365219">uint16</span><span class="op" id="6365225">(</span><span class="ident" id="6365226">cdat</span><span class="op" id="6365230">[</span><span class="num" id="6365231">4</span><span class="op" id="6365232">*</span><span class="ident" id="6365233">x</span><span class="op" id="6365234">+</span><span class="num" id="6365235">0</span><span class="op" id="6365236">]</span><span class="op" id="6365237">)</span><span class="op" id="6365238">&lt;&lt;</span><span class="num" id="6365240">8</span>&nbsp;<span class="op" id="6365242">|</span>&nbsp;<span class="builtintype" id="6365244">uint16</span><span class="op" id="6365250">(</span><span class="ident" id="6365251">cdat</span><span class="op" id="6365255">[</span><span class="num" id="6365256">4</span><span class="op" id="6365257">*</span><span class="ident" id="6365258">x</span><span class="op" id="6365259">+</span><span class="num" id="6365260">1</span><span class="op" id="6365261">]</span><span class="op" id="6365262">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365268">acol</span>&nbsp;<span class="op" id="6365273">:=</span>&nbsp;<span class="builtintype" id="6365276">uint16</span><span class="op" id="6365282">(</span><span class="ident" id="6365283">cdat</span><span class="op" id="6365287">[</span><span class="num" id="6365288">4</span><span class="op" id="6365289">*</span><span class="ident" id="6365290">x</span><span class="op" id="6365291">+</span><span class="num" id="6365292">2</span><span class="op" id="6365293">]</span><span class="op" id="6365294">)</span><span class="op" id="6365295">&lt;&lt;</span><span class="num" id="6365297">8</span>&nbsp;<span class="op" id="6365299">|</span>&nbsp;<span class="builtintype" id="6365301">uint16</span><span class="op" id="6365307">(</span><span class="ident" id="6365308">cdat</span><span class="op" id="6365312">[</span><span class="num" id="6365313">4</span><span class="op" id="6365314">*</span><span class="ident" id="6365315">x</span><span class="op" id="6365316">+</span><span class="num" id="6365317">3</span><span class="op" id="6365318">]</span><span class="op" id="6365319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365325">nrgba64</span><span class="op" id="6365332">.</span><span class="ident" id="6365333">SetNRGBA64</span><span class="op" id="6365343">(</span><span class="ident" id="6365344">x</span><span class="op" id="6365345">,</span>&nbsp;<span class="ident" id="6365347">y</span><span class="op" id="6365348">,</span>&nbsp;<span class="ident" id="6365350">color</span><span class="op" id="6365355">.</span><span class="ident" id="6365356">NRGBA64</span><span class="op" id="6365363">{</span><span class="ident" id="6365364">ycol</span><span class="op" id="6365368">,</span>&nbsp;<span class="ident" id="6365370">ycol</span><span class="op" id="6365374">,</span>&nbsp;<span class="ident" id="6365376">ycol</span><span class="op" id="6365380">,</span>&nbsp;<span class="ident" id="6365382">acol</span><span class="op" id="6365386">}</span><span class="op" id="6365387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365396">case</span>&nbsp;<span class="ident" id="6365401">cbTC16</span><span class="op" id="6365407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365412">for</span>&nbsp;<span class="ident" id="6365416">x</span>&nbsp;<span class="op" id="6365418">:=</span>&nbsp;<span class="num" id="6365421">0</span><span class="op" id="6365422">;</span>&nbsp;<span class="ident" id="6365424">x</span>&nbsp;<span class="op" id="6365426">&lt;</span>&nbsp;<span class="ident" id="6365428">width</span><span class="op" id="6365433">;</span>&nbsp;<span class="ident" id="6365435">x</span><span class="op" id="6365436">++</span>&nbsp;<span class="op" id="6365439">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365445">rcol</span>&nbsp;<span class="op" id="6365450">:=</span>&nbsp;<span class="builtintype" id="6365453">uint16</span><span class="op" id="6365459">(</span><span class="ident" id="6365460">cdat</span><span class="op" id="6365464">[</span><span class="num" id="6365465">6</span><span class="op" id="6365466">*</span><span class="ident" id="6365467">x</span><span class="op" id="6365468">+</span><span class="num" id="6365469">0</span><span class="op" id="6365470">]</span><span class="op" id="6365471">)</span><span class="op" id="6365472">&lt;&lt;</span><span class="num" id="6365474">8</span>&nbsp;<span class="op" id="6365476">|</span>&nbsp;<span class="builtintype" id="6365478">uint16</span><span class="op" id="6365484">(</span><span class="ident" id="6365485">cdat</span><span class="op" id="6365489">[</span><span class="num" id="6365490">6</span><span class="op" id="6365491">*</span><span class="ident" id="6365492">x</span><span class="op" id="6365493">+</span><span class="num" id="6365494">1</span><span class="op" id="6365495">]</span><span class="op" id="6365496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365502">gcol</span>&nbsp;<span class="op" id="6365507">:=</span>&nbsp;<span class="builtintype" id="6365510">uint16</span><span class="op" id="6365516">(</span><span class="ident" id="6365517">cdat</span><span class="op" id="6365521">[</span><span class="num" id="6365522">6</span><span class="op" id="6365523">*</span><span class="ident" id="6365524">x</span><span class="op" id="6365525">+</span><span class="num" id="6365526">2</span><span class="op" id="6365527">]</span><span class="op" id="6365528">)</span><span class="op" id="6365529">&lt;&lt;</span><span class="num" id="6365531">8</span>&nbsp;<span class="op" id="6365533">|</span>&nbsp;<span class="builtintype" id="6365535">uint16</span><span class="op" id="6365541">(</span><span class="ident" id="6365542">cdat</span><span class="op" id="6365546">[</span><span class="num" id="6365547">6</span><span class="op" id="6365548">*</span><span class="ident" id="6365549">x</span><span class="op" id="6365550">+</span><span class="num" id="6365551">3</span><span class="op" id="6365552">]</span><span class="op" id="6365553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365559">bcol</span>&nbsp;<span class="op" id="6365564">:=</span>&nbsp;<span class="builtintype" id="6365567">uint16</span><span class="op" id="6365573">(</span><span class="ident" id="6365574">cdat</span><span class="op" id="6365578">[</span><span class="num" id="6365579">6</span><span class="op" id="6365580">*</span><span class="ident" id="6365581">x</span><span class="op" id="6365582">+</span><span class="num" id="6365583">4</span><span class="op" id="6365584">]</span><span class="op" id="6365585">)</span><span class="op" id="6365586">&lt;&lt;</span><span class="num" id="6365588">8</span>&nbsp;<span class="op" id="6365590">|</span>&nbsp;<span class="builtintype" id="6365592">uint16</span><span class="op" id="6365598">(</span><span class="ident" id="6365599">cdat</span><span class="op" id="6365603">[</span><span class="num" id="6365604">6</span><span class="op" id="6365605">*</span><span class="ident" id="6365606">x</span><span class="op" id="6365607">+</span><span class="num" id="6365608">5</span><span class="op" id="6365609">]</span><span class="op" id="6365610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365616">rgba64</span><span class="op" id="6365622">.</span><span class="ident" id="6365623">SetRGBA64</span><span class="op" id="6365632">(</span><span class="ident" id="6365633">x</span><span class="op" id="6365634">,</span>&nbsp;<span class="ident" id="6365636">y</span><span class="op" id="6365637">,</span>&nbsp;<span class="ident" id="6365639">color</span><span class="op" id="6365644">.</span><span class="ident" id="6365645">RGBA64</span><span class="op" id="6365651">{</span><span class="ident" id="6365652">rcol</span><span class="op" id="6365656">,</span>&nbsp;<span class="ident" id="6365658">gcol</span><span class="op" id="6365662">,</span>&nbsp;<span class="ident" id="6365664">bcol</span><span class="op" id="6365668">,</span>&nbsp;<span class="num" id="6365670">0xffff</span><span class="op" id="6365676">}</span><span class="op" id="6365677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365682">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365686">case</span>&nbsp;<span class="ident" id="6365691">cbTCA16</span><span class="op" id="6365698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365703">for</span>&nbsp;<span class="ident" id="6365707">x</span>&nbsp;<span class="op" id="6365709">:=</span>&nbsp;<span class="num" id="6365712">0</span><span class="op" id="6365713">;</span>&nbsp;<span class="ident" id="6365715">x</span>&nbsp;<span class="op" id="6365717">&lt;</span>&nbsp;<span class="ident" id="6365719">width</span><span class="op" id="6365724">;</span>&nbsp;<span class="ident" id="6365726">x</span><span class="op" id="6365727">++</span>&nbsp;<span class="op" id="6365730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365736">rcol</span>&nbsp;<span class="op" id="6365741">:=</span>&nbsp;<span class="builtintype" id="6365744">uint16</span><span class="op" id="6365750">(</span><span class="ident" id="6365751">cdat</span><span class="op" id="6365755">[</span><span class="num" id="6365756">8</span><span class="op" id="6365757">*</span><span class="ident" id="6365758">x</span><span class="op" id="6365759">+</span><span class="num" id="6365760">0</span><span class="op" id="6365761">]</span><span class="op" id="6365762">)</span><span class="op" id="6365763">&lt;&lt;</span><span class="num" id="6365765">8</span>&nbsp;<span class="op" id="6365767">|</span>&nbsp;<span class="builtintype" id="6365769">uint16</span><span class="op" id="6365775">(</span><span class="ident" id="6365776">cdat</span><span class="op" id="6365780">[</span><span class="num" id="6365781">8</span><span class="op" id="6365782">*</span><span class="ident" id="6365783">x</span><span class="op" id="6365784">+</span><span class="num" id="6365785">1</span><span class="op" id="6365786">]</span><span class="op" id="6365787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365793">gcol</span>&nbsp;<span class="op" id="6365798">:=</span>&nbsp;<span class="builtintype" id="6365801">uint16</span><span class="op" id="6365807">(</span><span class="ident" id="6365808">cdat</span><span class="op" id="6365812">[</span><span class="num" id="6365813">8</span><span class="op" id="6365814">*</span><span class="ident" id="6365815">x</span><span class="op" id="6365816">+</span><span class="num" id="6365817">2</span><span class="op" id="6365818">]</span><span class="op" id="6365819">)</span><span class="op" id="6365820">&lt;&lt;</span><span class="num" id="6365822">8</span>&nbsp;<span class="op" id="6365824">|</span>&nbsp;<span class="builtintype" id="6365826">uint16</span><span class="op" id="6365832">(</span><span class="ident" id="6365833">cdat</span><span class="op" id="6365837">[</span><span class="num" id="6365838">8</span><span class="op" id="6365839">*</span><span class="ident" id="6365840">x</span><span class="op" id="6365841">+</span><span class="num" id="6365842">3</span><span class="op" id="6365843">]</span><span class="op" id="6365844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365850">bcol</span>&nbsp;<span class="op" id="6365855">:=</span>&nbsp;<span class="builtintype" id="6365858">uint16</span><span class="op" id="6365864">(</span><span class="ident" id="6365865">cdat</span><span class="op" id="6365869">[</span><span class="num" id="6365870">8</span><span class="op" id="6365871">*</span><span class="ident" id="6365872">x</span><span class="op" id="6365873">+</span><span class="num" id="6365874">4</span><span class="op" id="6365875">]</span><span class="op" id="6365876">)</span><span class="op" id="6365877">&lt;&lt;</span><span class="num" id="6365879">8</span>&nbsp;<span class="op" id="6365881">|</span>&nbsp;<span class="builtintype" id="6365883">uint16</span><span class="op" id="6365889">(</span><span class="ident" id="6365890">cdat</span><span class="op" id="6365894">[</span><span class="num" id="6365895">8</span><span class="op" id="6365896">*</span><span class="ident" id="6365897">x</span><span class="op" id="6365898">+</span><span class="num" id="6365899">5</span><span class="op" id="6365900">]</span><span class="op" id="6365901">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365907">acol</span>&nbsp;<span class="op" id="6365912">:=</span>&nbsp;<span class="builtintype" id="6365915">uint16</span><span class="op" id="6365921">(</span><span class="ident" id="6365922">cdat</span><span class="op" id="6365926">[</span><span class="num" id="6365927">8</span><span class="op" id="6365928">*</span><span class="ident" id="6365929">x</span><span class="op" id="6365930">+</span><span class="num" id="6365931">6</span><span class="op" id="6365932">]</span><span class="op" id="6365933">)</span><span class="op" id="6365934">&lt;&lt;</span><span class="num" id="6365936">8</span>&nbsp;<span class="op" id="6365938">|</span>&nbsp;<span class="builtintype" id="6365940">uint16</span><span class="op" id="6365946">(</span><span class="ident" id="6365947">cdat</span><span class="op" id="6365951">[</span><span class="num" id="6365952">8</span><span class="op" id="6365953">*</span><span class="ident" id="6365954">x</span><span class="op" id="6365955">+</span><span class="num" id="6365956">7</span><span class="op" id="6365957">]</span><span class="op" id="6365958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365964">nrgba64</span><span class="op" id="6365971">.</span><span class="ident" id="6365972">SetNRGBA64</span><span class="op" id="6365982">(</span><span class="ident" id="6365983">x</span><span class="op" id="6365984">,</span>&nbsp;<span class="ident" id="6365986">y</span><span class="op" id="6365987">,</span>&nbsp;<span class="ident" id="6365989">color</span><span class="op" id="6365994">.</span><span class="ident" id="6365995">NRGBA64</span><span class="op" id="6366002">{</span><span class="ident" id="6366003">rcol</span><span class="op" id="6366007">,</span>&nbsp;<span class="ident" id="6366009">gcol</span><span class="op" id="6366013">,</span>&nbsp;<span class="ident" id="6366015">bcol</span><span class="op" id="6366019">,</span>&nbsp;<span class="ident" id="6366021">acol</span><span class="op" id="6366025">}</span><span class="op" id="6366026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366040">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366096">pr</span><span class="op" id="6366098">,</span>&nbsp;<span class="ident" id="6366100">cr</span>&nbsp;<span class="op" id="6366103">=</span>&nbsp;<span class="ident" id="6366105">cr</span><span class="op" id="6366107">,</span>&nbsp;<span class="ident" id="6366109">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366117">return</span>&nbsp;<span class="ident" id="6366124">img</span><span class="op" id="6366127">,</span>&nbsp;<span class="ident" id="6366129">nil</span><br>
<span class="lineno">585</span><span class="op" id="6366133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6366136">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6366199">func</span>&nbsp;<span class="op" id="6366204">(</span><span class="ident" id="6366205">d</span>&nbsp;<span class="op" id="6366207">*</span><span class="ident" id="6366208">decoder</span><span class="op" id="6366215">)</span>&nbsp;<span class="ident" id="6366217">mergePassInto</span><span class="op" id="6366230">(</span><span class="ident" id="6366231">dst</span>&nbsp;<span class="ident" id="6366235">image</span><span class="op" id="6366240">.</span><span class="ident" id="6366241">Image</span><span class="op" id="6366246">,</span>&nbsp;<span class="ident" id="6366248">src</span>&nbsp;<span class="ident" id="6366252">image</span><span class="op" id="6366257">.</span><span class="ident" id="6366258">Image</span><span class="op" id="6366263">,</span>&nbsp;<span class="ident" id="6366265">pass</span>&nbsp;<span class="builtintype" id="6366270">int</span><span class="op" id="6366273">)</span>&nbsp;<span class="op" id="6366275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366278">p</span>&nbsp;<span class="op" id="6366280">:=</span>&nbsp;<span class="ident" id="6366283">interlacing</span><span class="op" id="6366294">[</span><span class="ident" id="6366295">pass</span><span class="op" id="6366299">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366302">var</span>&nbsp;<span class="op" id="6366306">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366310">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366324">[</span><span class="op" id="6366325">]</span><span class="builtintype" id="6366326">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366334">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366348">[</span><span class="op" id="6366349">]</span><span class="builtintype" id="6366350">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366358">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6366372">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366378">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6366392">image</span><span class="op" id="6366397">.</span><span class="ident" id="6366398">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366410">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6366424">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366432">switch</span>&nbsp;<span class="ident" id="6366439">target</span>&nbsp;<span class="op" id="6366446">:=</span>&nbsp;<span class="ident" id="6366449">dst</span><span class="op" id="6366452">.</span><span class="op" id="6366453">(</span><span class="keyword" id="6366454">type</span><span class="op" id="6366458">)</span>&nbsp;<span class="op" id="6366460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366463">case</span>&nbsp;<span class="op" id="6366468">*</span><span class="ident" id="6366469">image</span><span class="op" id="6366474">.</span><span class="ident" id="6366475">Alpha</span><span class="op" id="6366480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366484">srcPix</span>&nbsp;<span class="op" id="6366491">=</span>&nbsp;<span class="ident" id="6366493">src</span><span class="op" id="6366496">.</span><span class="op" id="6366497">(</span><span class="op" id="6366498">*</span><span class="ident" id="6366499">image</span><span class="op" id="6366504">.</span><span class="ident" id="6366505">Alpha</span><span class="op" id="6366510">)</span><span class="op" id="6366511">.</span><span class="ident" id="6366512">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366518">dstPix</span><span class="op" id="6366524">,</span>&nbsp;<span class="ident" id="6366526">stride</span><span class="op" id="6366532">,</span>&nbsp;<span class="ident" id="6366534">rect</span>&nbsp;<span class="op" id="6366539">=</span>&nbsp;<span class="ident" id="6366541">target</span><span class="op" id="6366547">.</span><span class="ident" id="6366548">Pix</span><span class="op" id="6366551">,</span>&nbsp;<span class="ident" id="6366553">target</span><span class="op" id="6366559">.</span><span class="ident" id="6366560">Stride</span><span class="op" id="6366566">,</span>&nbsp;<span class="ident" id="6366568">target</span><span class="op" id="6366574">.</span><span class="ident" id="6366575">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366582">bytesPerPixel</span>&nbsp;<span class="op" id="6366596">=</span>&nbsp;<span class="num" id="6366598">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366601">case</span>&nbsp;<span class="op" id="6366606">*</span><span class="ident" id="6366607">image</span><span class="op" id="6366612">.</span><span class="ident" id="6366613">Alpha16</span><span class="op" id="6366620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366624">srcPix</span>&nbsp;<span class="op" id="6366631">=</span>&nbsp;<span class="ident" id="6366633">src</span><span class="op" id="6366636">.</span><span class="op" id="6366637">(</span><span class="op" id="6366638">*</span><span class="ident" id="6366639">image</span><span class="op" id="6366644">.</span><span class="ident" id="6366645">Alpha16</span><span class="op" id="6366652">)</span><span class="op" id="6366653">.</span><span class="ident" id="6366654">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366660">dstPix</span><span class="op" id="6366666">,</span>&nbsp;<span class="ident" id="6366668">stride</span><span class="op" id="6366674">,</span>&nbsp;<span class="ident" id="6366676">rect</span>&nbsp;<span class="op" id="6366681">=</span>&nbsp;<span class="ident" id="6366683">target</span><span class="op" id="6366689">.</span><span class="ident" id="6366690">Pix</span><span class="op" id="6366693">,</span>&nbsp;<span class="ident" id="6366695">target</span><span class="op" id="6366701">.</span><span class="ident" id="6366702">Stride</span><span class="op" id="6366708">,</span>&nbsp;<span class="ident" id="6366710">target</span><span class="op" id="6366716">.</span><span class="ident" id="6366717">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366724">bytesPerPixel</span>&nbsp;<span class="op" id="6366738">=</span>&nbsp;<span class="num" id="6366740">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366743">case</span>&nbsp;<span class="op" id="6366748">*</span><span class="ident" id="6366749">image</span><span class="op" id="6366754">.</span><span class="ident" id="6366755">Gray</span><span class="op" id="6366759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366763">srcPix</span>&nbsp;<span class="op" id="6366770">=</span>&nbsp;<span class="ident" id="6366772">src</span><span class="op" id="6366775">.</span><span class="op" id="6366776">(</span><span class="op" id="6366777">*</span><span class="ident" id="6366778">image</span><span class="op" id="6366783">.</span><span class="ident" id="6366784">Gray</span><span class="op" id="6366788">)</span><span class="op" id="6366789">.</span><span class="ident" id="6366790">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366796">dstPix</span><span class="op" id="6366802">,</span>&nbsp;<span class="ident" id="6366804">stride</span><span class="op" id="6366810">,</span>&nbsp;<span class="ident" id="6366812">rect</span>&nbsp;<span class="op" id="6366817">=</span>&nbsp;<span class="ident" id="6366819">target</span><span class="op" id="6366825">.</span><span class="ident" id="6366826">Pix</span><span class="op" id="6366829">,</span>&nbsp;<span class="ident" id="6366831">target</span><span class="op" id="6366837">.</span><span class="ident" id="6366838">Stride</span><span class="op" id="6366844">,</span>&nbsp;<span class="ident" id="6366846">target</span><span class="op" id="6366852">.</span><span class="ident" id="6366853">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366860">bytesPerPixel</span>&nbsp;<span class="op" id="6366874">=</span>&nbsp;<span class="num" id="6366876">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366879">case</span>&nbsp;<span class="op" id="6366884">*</span><span class="ident" id="6366885">image</span><span class="op" id="6366890">.</span><span class="ident" id="6366891">Gray16</span><span class="op" id="6366897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366901">srcPix</span>&nbsp;<span class="op" id="6366908">=</span>&nbsp;<span class="ident" id="6366910">src</span><span class="op" id="6366913">.</span><span class="op" id="6366914">(</span><span class="op" id="6366915">*</span><span class="ident" id="6366916">image</span><span class="op" id="6366921">.</span><span class="ident" id="6366922">Gray16</span><span class="op" id="6366928">)</span><span class="op" id="6366929">.</span><span class="ident" id="6366930">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366936">dstPix</span><span class="op" id="6366942">,</span>&nbsp;<span class="ident" id="6366944">stride</span><span class="op" id="6366950">,</span>&nbsp;<span class="ident" id="6366952">rect</span>&nbsp;<span class="op" id="6366957">=</span>&nbsp;<span class="ident" id="6366959">target</span><span class="op" id="6366965">.</span><span class="ident" id="6366966">Pix</span><span class="op" id="6366969">,</span>&nbsp;<span class="ident" id="6366971">target</span><span class="op" id="6366977">.</span><span class="ident" id="6366978">Stride</span><span class="op" id="6366984">,</span>&nbsp;<span class="ident" id="6366986">target</span><span class="op" id="6366992">.</span><span class="ident" id="6366993">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367000">bytesPerPixel</span>&nbsp;<span class="op" id="6367014">=</span>&nbsp;<span class="num" id="6367016">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367019">case</span>&nbsp;<span class="op" id="6367024">*</span><span class="ident" id="6367025">image</span><span class="op" id="6367030">.</span><span class="ident" id="6367031">NRGBA</span><span class="op" id="6367036">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367040">srcPix</span>&nbsp;<span class="op" id="6367047">=</span>&nbsp;<span class="ident" id="6367049">src</span><span class="op" id="6367052">.</span><span class="op" id="6367053">(</span><span class="op" id="6367054">*</span><span class="ident" id="6367055">image</span><span class="op" id="6367060">.</span><span class="ident" id="6367061">NRGBA</span><span class="op" id="6367066">)</span><span class="op" id="6367067">.</span><span class="ident" id="6367068">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367074">dstPix</span><span class="op" id="6367080">,</span>&nbsp;<span class="ident" id="6367082">stride</span><span class="op" id="6367088">,</span>&nbsp;<span class="ident" id="6367090">rect</span>&nbsp;<span class="op" id="6367095">=</span>&nbsp;<span class="ident" id="6367097">target</span><span class="op" id="6367103">.</span><span class="ident" id="6367104">Pix</span><span class="op" id="6367107">,</span>&nbsp;<span class="ident" id="6367109">target</span><span class="op" id="6367115">.</span><span class="ident" id="6367116">Stride</span><span class="op" id="6367122">,</span>&nbsp;<span class="ident" id="6367124">target</span><span class="op" id="6367130">.</span><span class="ident" id="6367131">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367138">bytesPerPixel</span>&nbsp;<span class="op" id="6367152">=</span>&nbsp;<span class="num" id="6367154">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367157">case</span>&nbsp;<span class="op" id="6367162">*</span><span class="ident" id="6367163">image</span><span class="op" id="6367168">.</span><span class="ident" id="6367169">NRGBA64</span><span class="op" id="6367176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367180">srcPix</span>&nbsp;<span class="op" id="6367187">=</span>&nbsp;<span class="ident" id="6367189">src</span><span class="op" id="6367192">.</span><span class="op" id="6367193">(</span><span class="op" id="6367194">*</span><span class="ident" id="6367195">image</span><span class="op" id="6367200">.</span><span class="ident" id="6367201">NRGBA64</span><span class="op" id="6367208">)</span><span class="op" id="6367209">.</span><span class="ident" id="6367210">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367216">dstPix</span><span class="op" id="6367222">,</span>&nbsp;<span class="ident" id="6367224">stride</span><span class="op" id="6367230">,</span>&nbsp;<span class="ident" id="6367232">rect</span>&nbsp;<span class="op" id="6367237">=</span>&nbsp;<span class="ident" id="6367239">target</span><span class="op" id="6367245">.</span><span class="ident" id="6367246">Pix</span><span class="op" id="6367249">,</span>&nbsp;<span class="ident" id="6367251">target</span><span class="op" id="6367257">.</span><span class="ident" id="6367258">Stride</span><span class="op" id="6367264">,</span>&nbsp;<span class="ident" id="6367266">target</span><span class="op" id="6367272">.</span><span class="ident" id="6367273">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367280">bytesPerPixel</span>&nbsp;<span class="op" id="6367294">=</span>&nbsp;<span class="num" id="6367296">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367299">case</span>&nbsp;<span class="op" id="6367304">*</span><span class="ident" id="6367305">image</span><span class="op" id="6367310">.</span><span class="ident" id="6367311">Paletted</span><span class="op" id="6367319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367323">srcPix</span>&nbsp;<span class="op" id="6367330">=</span>&nbsp;<span class="ident" id="6367332">src</span><span class="op" id="6367335">.</span><span class="op" id="6367336">(</span><span class="op" id="6367337">*</span><span class="ident" id="6367338">image</span><span class="op" id="6367343">.</span><span class="ident" id="6367344">Paletted</span><span class="op" id="6367352">)</span><span class="op" id="6367353">.</span><span class="ident" id="6367354">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367360">dstPix</span><span class="op" id="6367366">,</span>&nbsp;<span class="ident" id="6367368">stride</span><span class="op" id="6367374">,</span>&nbsp;<span class="ident" id="6367376">rect</span>&nbsp;<span class="op" id="6367381">=</span>&nbsp;<span class="ident" id="6367383">target</span><span class="op" id="6367389">.</span><span class="ident" id="6367390">Pix</span><span class="op" id="6367393">,</span>&nbsp;<span class="ident" id="6367395">target</span><span class="op" id="6367401">.</span><span class="ident" id="6367402">Stride</span><span class="op" id="6367408">,</span>&nbsp;<span class="ident" id="6367410">target</span><span class="op" id="6367416">.</span><span class="ident" id="6367417">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367424">bytesPerPixel</span>&nbsp;<span class="op" id="6367438">=</span>&nbsp;<span class="num" id="6367440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367443">case</span>&nbsp;<span class="op" id="6367448">*</span><span class="ident" id="6367449">image</span><span class="op" id="6367454">.</span><span class="ident" id="6367455">RGBA</span><span class="op" id="6367459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367463">srcPix</span>&nbsp;<span class="op" id="6367470">=</span>&nbsp;<span class="ident" id="6367472">src</span><span class="op" id="6367475">.</span><span class="op" id="6367476">(</span><span class="op" id="6367477">*</span><span class="ident" id="6367478">image</span><span class="op" id="6367483">.</span><span class="ident" id="6367484">RGBA</span><span class="op" id="6367488">)</span><span class="op" id="6367489">.</span><span class="ident" id="6367490">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367496">dstPix</span><span class="op" id="6367502">,</span>&nbsp;<span class="ident" id="6367504">stride</span><span class="op" id="6367510">,</span>&nbsp;<span class="ident" id="6367512">rect</span>&nbsp;<span class="op" id="6367517">=</span>&nbsp;<span class="ident" id="6367519">target</span><span class="op" id="6367525">.</span><span class="ident" id="6367526">Pix</span><span class="op" id="6367529">,</span>&nbsp;<span class="ident" id="6367531">target</span><span class="op" id="6367537">.</span><span class="ident" id="6367538">Stride</span><span class="op" id="6367544">,</span>&nbsp;<span class="ident" id="6367546">target</span><span class="op" id="6367552">.</span><span class="ident" id="6367553">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367560">bytesPerPixel</span>&nbsp;<span class="op" id="6367574">=</span>&nbsp;<span class="num" id="6367576">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367579">case</span>&nbsp;<span class="op" id="6367584">*</span><span class="ident" id="6367585">image</span><span class="op" id="6367590">.</span><span class="ident" id="6367591">RGBA64</span><span class="op" id="6367597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367601">srcPix</span>&nbsp;<span class="op" id="6367608">=</span>&nbsp;<span class="ident" id="6367610">src</span><span class="op" id="6367613">.</span><span class="op" id="6367614">(</span><span class="op" id="6367615">*</span><span class="ident" id="6367616">image</span><span class="op" id="6367621">.</span><span class="ident" id="6367622">RGBA64</span><span class="op" id="6367628">)</span><span class="op" id="6367629">.</span><span class="ident" id="6367630">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367636">dstPix</span><span class="op" id="6367642">,</span>&nbsp;<span class="ident" id="6367644">stride</span><span class="op" id="6367650">,</span>&nbsp;<span class="ident" id="6367652">rect</span>&nbsp;<span class="op" id="6367657">=</span>&nbsp;<span class="ident" id="6367659">target</span><span class="op" id="6367665">.</span><span class="ident" id="6367666">Pix</span><span class="op" id="6367669">,</span>&nbsp;<span class="ident" id="6367671">target</span><span class="op" id="6367677">.</span><span class="ident" id="6367678">Stride</span><span class="op" id="6367684">,</span>&nbsp;<span class="ident" id="6367686">target</span><span class="op" id="6367692">.</span><span class="ident" id="6367693">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367700">bytesPerPixel</span>&nbsp;<span class="op" id="6367714">=</span>&nbsp;<span class="num" id="6367716">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367719">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367722">s</span><span class="op" id="6367723">,</span>&nbsp;<span class="ident" id="6367725">bounds</span>&nbsp;<span class="op" id="6367732">:=</span>&nbsp;<span class="num" id="6367735">0</span><span class="op" id="6367736">,</span>&nbsp;<span class="ident" id="6367738">src</span><span class="op" id="6367741">.</span><span class="ident" id="6367742">Bounds</span><span class="op" id="6367748">(</span><span class="op" id="6367749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367752">for</span>&nbsp;<span class="ident" id="6367756">y</span>&nbsp;<span class="op" id="6367758">:=</span>&nbsp;<span class="ident" id="6367761">bounds</span><span class="op" id="6367767">.</span><span class="ident" id="6367768">Min</span><span class="op" id="6367771">.</span><span class="ident" id="6367772">Y</span><span class="op" id="6367773">;</span>&nbsp;<span class="ident" id="6367775">y</span>&nbsp;<span class="op" id="6367777">&lt;</span>&nbsp;<span class="ident" id="6367779">bounds</span><span class="op" id="6367785">.</span><span class="ident" id="6367786">Max</span><span class="op" id="6367789">.</span><span class="ident" id="6367790">Y</span><span class="op" id="6367791">;</span>&nbsp;<span class="ident" id="6367793">y</span><span class="op" id="6367794">++</span>&nbsp;<span class="op" id="6367797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367801">dBase</span>&nbsp;<span class="op" id="6367807">:=</span>&nbsp;<span class="op" id="6367810">(</span><span class="ident" id="6367811">y</span><span class="op" id="6367812">*</span><span class="ident" id="6367813">p</span><span class="op" id="6367814">.</span><span class="ident" id="6367815">yFactor</span><span class="op" id="6367822">+</span><span class="ident" id="6367823">p</span><span class="op" id="6367824">.</span><span class="ident" id="6367825">yOffset</span><span class="op" id="6367832">-</span><span class="ident" id="6367833">rect</span><span class="op" id="6367837">.</span><span class="ident" id="6367838">Min</span><span class="op" id="6367841">.</span><span class="ident" id="6367842">Y</span><span class="op" id="6367843">)</span><span class="op" id="6367844">*</span><span class="ident" id="6367845">stride</span>&nbsp;<span class="op" id="6367852">+</span>&nbsp;<span class="op" id="6367854">(</span><span class="ident" id="6367855">p</span><span class="op" id="6367856">.</span><span class="ident" id="6367857">xOffset</span><span class="op" id="6367864">-</span><span class="ident" id="6367865">rect</span><span class="op" id="6367869">.</span><span class="ident" id="6367870">Min</span><span class="op" id="6367873">.</span><span class="ident" id="6367874">X</span><span class="op" id="6367875">)</span><span class="op" id="6367876">*</span><span class="ident" id="6367877">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367893">for</span>&nbsp;<span class="ident" id="6367897">x</span>&nbsp;<span class="op" id="6367899">:=</span>&nbsp;<span class="ident" id="6367902">bounds</span><span class="op" id="6367908">.</span><span class="ident" id="6367909">Min</span><span class="op" id="6367912">.</span><span class="ident" id="6367913">X</span><span class="op" id="6367914">;</span>&nbsp;<span class="ident" id="6367916">x</span>&nbsp;<span class="op" id="6367918">&lt;</span>&nbsp;<span class="ident" id="6367920">bounds</span><span class="op" id="6367926">.</span><span class="ident" id="6367927">Max</span><span class="op" id="6367930">.</span><span class="ident" id="6367931">X</span><span class="op" id="6367932">;</span>&nbsp;<span class="ident" id="6367934">x</span><span class="op" id="6367935">++</span>&nbsp;<span class="op" id="6367938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367943">d</span>&nbsp;<span class="op" id="6367945">:=</span>&nbsp;<span class="ident" id="6367948">dBase</span>&nbsp;<span class="op" id="6367954">+</span>&nbsp;<span class="ident" id="6367956">x</span><span class="op" id="6367957">*</span><span class="ident" id="6367958">p</span><span class="op" id="6367959">.</span><span class="ident" id="6367960">xFactor</span><span class="op" id="6367967">*</span><span class="ident" id="6367968">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6367985">copy</span><span class="op" id="6367989">(</span><span class="ident" id="6367990">dstPix</span><span class="op" id="6367996">[</span><span class="ident" id="6367997">d</span><span class="op" id="6367998">:</span><span class="op" id="6367999">]</span><span class="op" id="6368000">,</span>&nbsp;<span class="ident" id="6368002">srcPix</span><span class="op" id="6368008">[</span><span class="ident" id="6368009">s</span><span class="op" id="6368010">:</span><span class="ident" id="6368011">s</span><span class="op" id="6368012">+</span><span class="ident" id="6368013">bytesPerPixel</span><span class="op" id="6368026">]</span><span class="op" id="6368027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368032">s</span>&nbsp;<span class="op" id="6368034">+=</span>&nbsp;<span class="ident" id="6368037">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368056">}</span><br>
<span class="lineno"></span><span class="op" id="6368058">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="6368061">func</span>&nbsp;<span class="op" id="6368066">(</span><span class="ident" id="6368067">d</span>&nbsp;<span class="op" id="6368069">*</span><span class="ident" id="6368070">decoder</span><span class="op" id="6368077">)</span>&nbsp;<span class="ident" id="6368079">parseIDAT</span><span class="op" id="6368088">(</span><span class="ident" id="6368089">length</span>&nbsp;<span class="builtintype" id="6368096">uint32</span><span class="op" id="6368102">)</span>&nbsp;<span class="op" id="6368104">(</span><span class="ident" id="6368105">err</span>&nbsp;<span class="builtintype" id="6368109">error</span><span class="op" id="6368114">)</span>&nbsp;<span class="op" id="6368116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368119">d</span><span class="op" id="6368120">.</span><span class="ident" id="6368121">idatLength</span>&nbsp;<span class="op" id="6368132">=</span>&nbsp;<span class="ident" id="6368134">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368142">d</span><span class="op" id="6368143">.</span><span class="ident" id="6368144">img</span><span class="op" id="6368147">,</span>&nbsp;<span class="ident" id="6368149">err</span>&nbsp;<span class="op" id="6368153">=</span>&nbsp;<span class="ident" id="6368155">d</span><span class="op" id="6368156">.</span><span class="ident" id="6368157">decode</span><span class="op" id="6368163">(</span><span class="op" id="6368164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368167">if</span>&nbsp;<span class="ident" id="6368170">err</span>&nbsp;<span class="op" id="6368174">!=</span>&nbsp;<span class="ident" id="6368177">nil</span>&nbsp;<span class="op" id="6368181">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368185">return</span>&nbsp;<span class="ident" id="6368192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368200">return</span>&nbsp;<span class="ident" id="6368207">d</span><span class="op" id="6368208">.</span><span class="ident" id="6368209">verifyChecksum</span><span class="op" id="6368223">(</span><span class="op" id="6368224">)</span><br>
<span class="lineno"></span><span class="op" id="6368226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="6368229">func</span>&nbsp;<span class="op" id="6368234">(</span><span class="ident" id="6368235">d</span>&nbsp;<span class="op" id="6368237">*</span><span class="ident" id="6368238">decoder</span><span class="op" id="6368245">)</span>&nbsp;<span class="ident" id="6368247">parseIEND</span><span class="op" id="6368256">(</span><span class="ident" id="6368257">length</span>&nbsp;<span class="builtintype" id="6368264">uint32</span><span class="op" id="6368270">)</span>&nbsp;<span class="builtintype" id="6368272">error</span>&nbsp;<span class="op" id="6368278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368281">if</span>&nbsp;<span class="ident" id="6368284">length</span>&nbsp;<span class="op" id="6368291">!=</span>&nbsp;<span class="num" id="6368294">0</span>&nbsp;<span class="op" id="6368296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368300">return</span>&nbsp;<span class="ident" id="6368307">FormatError</span><span class="op" id="6368318">(</span><span class="string" id="6368319">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="6368336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368342">return</span>&nbsp;<span class="ident" id="6368349">d</span><span class="op" id="6368350">.</span><span class="ident" id="6368351">verifyChecksum</span><span class="op" id="6368365">(</span><span class="op" id="6368366">)</span><br>
<span class="lineno">660</span><span class="op" id="6368368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6368371">func</span>&nbsp;<span class="op" id="6368376">(</span><span class="ident" id="6368377">d</span>&nbsp;<span class="op" id="6368379">*</span><span class="ident" id="6368380">decoder</span><span class="op" id="6368387">)</span>&nbsp;<span class="ident" id="6368389">parseChunk</span><span class="op" id="6368399">(</span><span class="op" id="6368400">)</span>&nbsp;<span class="builtintype" id="6368402">error</span>&nbsp;<span class="op" id="6368408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368411">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368447">n</span><span class="op" id="6368448">,</span>&nbsp;<span class="ident" id="6368450">err</span>&nbsp;<span class="op" id="6368454">:=</span>&nbsp;<span class="ident" id="6368457">io</span><span class="op" id="6368459">.</span><span class="ident" id="6368460">ReadFull</span><span class="op" id="6368468">(</span><span class="ident" id="6368469">d</span><span class="op" id="6368470">.</span><span class="ident" id="6368471">r</span><span class="op" id="6368472">,</span>&nbsp;<span class="ident" id="6368474">d</span><span class="op" id="6368475">.</span><span class="ident" id="6368476">tmp</span><span class="op" id="6368479">[</span><span class="op" id="6368480">:</span><span class="num" id="6368481">8</span><span class="op" id="6368482">]</span><span class="op" id="6368483">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368486">if</span>&nbsp;<span class="ident" id="6368489">err</span>&nbsp;<span class="op" id="6368493">!=</span>&nbsp;<span class="ident" id="6368496">nil</span>&nbsp;<span class="op" id="6368500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368504">return</span>&nbsp;<span class="ident" id="6368511">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368519">length</span>&nbsp;<span class="op" id="6368526">:=</span>&nbsp;<span class="ident" id="6368529">binary</span><span class="op" id="6368535">.</span><span class="ident" id="6368536">BigEndian</span><span class="op" id="6368545">.</span><span class="ident" id="6368546">Uint32</span><span class="op" id="6368552">(</span><span class="ident" id="6368553">d</span><span class="op" id="6368554">.</span><span class="ident" id="6368555">tmp</span><span class="op" id="6368558">[</span><span class="op" id="6368559">:</span><span class="num" id="6368560">4</span><span class="op" id="6368561">]</span><span class="op" id="6368562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368565">d</span><span class="op" id="6368566">.</span><span class="ident" id="6368567">crc</span><span class="op" id="6368570">.</span><span class="ident" id="6368571">Reset</span><span class="op" id="6368576">(</span><span class="op" id="6368577">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368580">d</span><span class="op" id="6368581">.</span><span class="ident" id="6368582">crc</span><span class="op" id="6368585">.</span><span class="ident" id="6368586">Write</span><span class="op" id="6368591">(</span><span class="ident" id="6368592">d</span><span class="op" id="6368593">.</span><span class="ident" id="6368594">tmp</span><span class="op" id="6368597">[</span><span class="num" id="6368598">4</span><span class="op" id="6368599">:</span><span class="num" id="6368600">8</span><span class="op" id="6368601">]</span><span class="op" id="6368602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368606">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368631">switch</span>&nbsp;<span class="builtintype" id="6368638">string</span><span class="op" id="6368644">(</span><span class="ident" id="6368645">d</span><span class="op" id="6368646">.</span><span class="ident" id="6368647">tmp</span><span class="op" id="6368650">[</span><span class="num" id="6368651">4</span><span class="op" id="6368652">:</span><span class="num" id="6368653">8</span><span class="op" id="6368654">]</span><span class="op" id="6368655">)</span>&nbsp;<span class="op" id="6368657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368660">case</span>&nbsp;<span class="string" id="6368665">&#34;IHDR&#34;</span><span class="op" id="6368671">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368675">if</span>&nbsp;<span class="ident" id="6368678">d</span><span class="op" id="6368679">.</span><span class="ident" id="6368680">stage</span>&nbsp;<span class="op" id="6368686">!=</span>&nbsp;<span class="ident" id="6368689">dsStart</span>&nbsp;<span class="op" id="6368697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368702">return</span>&nbsp;<span class="ident" id="6368709">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368731">d</span><span class="op" id="6368732">.</span><span class="ident" id="6368733">stage</span>&nbsp;<span class="op" id="6368739">=</span>&nbsp;<span class="ident" id="6368741">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368754">return</span>&nbsp;<span class="ident" id="6368761">d</span><span class="op" id="6368762">.</span><span class="ident" id="6368763">parseIHDR</span><span class="op" id="6368772">(</span><span class="ident" id="6368773">length</span><span class="op" id="6368779">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368782">case</span>&nbsp;<span class="string" id="6368787">&#34;PLTE&#34;</span><span class="op" id="6368793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368797">if</span>&nbsp;<span class="ident" id="6368800">d</span><span class="op" id="6368801">.</span><span class="ident" id="6368802">stage</span>&nbsp;<span class="op" id="6368808">!=</span>&nbsp;<span class="ident" id="6368811">dsSeenIHDR</span>&nbsp;<span class="op" id="6368822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368827">return</span>&nbsp;<span class="ident" id="6368834">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368856">d</span><span class="op" id="6368857">.</span><span class="ident" id="6368858">stage</span>&nbsp;<span class="op" id="6368864">=</span>&nbsp;<span class="ident" id="6368866">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368879">return</span>&nbsp;<span class="ident" id="6368886">d</span><span class="op" id="6368887">.</span><span class="ident" id="6368888">parsePLTE</span><span class="op" id="6368897">(</span><span class="ident" id="6368898">length</span><span class="op" id="6368904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368907">case</span>&nbsp;<span class="string" id="6368912">&#34;tRNS&#34;</span><span class="op" id="6368918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368922">if</span>&nbsp;<span class="ident" id="6368925">d</span><span class="op" id="6368926">.</span><span class="ident" id="6368927">stage</span>&nbsp;<span class="op" id="6368933">!=</span>&nbsp;<span class="ident" id="6368936">dsSeenPLTE</span>&nbsp;<span class="op" id="6368947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368952">return</span>&nbsp;<span class="ident" id="6368959">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368977">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368981">return</span>&nbsp;<span class="ident" id="6368988">d</span><span class="op" id="6368989">.</span><span class="ident" id="6368990">parsetRNS</span><span class="op" id="6368999">(</span><span class="ident" id="6369000">length</span><span class="op" id="6369006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369009">case</span>&nbsp;<span class="string" id="6369014">&#34;IDAT&#34;</span><span class="op" id="6369020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369024">if</span>&nbsp;<span class="ident" id="6369027">d</span><span class="op" id="6369028">.</span><span class="ident" id="6369029">stage</span>&nbsp;<span class="op" id="6369035">&lt;</span>&nbsp;<span class="ident" id="6369037">dsSeenIHDR</span>&nbsp;<span class="op" id="6369048">||</span>&nbsp;<span class="ident" id="6369051">d</span><span class="op" id="6369052">.</span><span class="ident" id="6369053">stage</span>&nbsp;<span class="op" id="6369059">&gt;</span>&nbsp;<span class="ident" id="6369061">dsSeenIDAT</span>&nbsp;<span class="op" id="6369072">||</span>&nbsp;<span class="op" id="6369075">(</span><span class="ident" id="6369076">d</span><span class="op" id="6369077">.</span><span class="ident" id="6369078">cb</span>&nbsp;<span class="op" id="6369081">==</span>&nbsp;<span class="ident" id="6369084">cbP8</span>&nbsp;<span class="op" id="6369089">&amp;&amp;</span>&nbsp;<span class="ident" id="6369092">d</span><span class="op" id="6369093">.</span><span class="ident" id="6369094">stage</span>&nbsp;<span class="op" id="6369100">==</span>&nbsp;<span class="ident" id="6369103">dsSeenIHDR</span><span class="op" id="6369113">)</span>&nbsp;<span class="op" id="6369115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369120">return</span>&nbsp;<span class="ident" id="6369127">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369145">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369149">d</span><span class="op" id="6369150">.</span><span class="ident" id="6369151">stage</span>&nbsp;<span class="op" id="6369157">=</span>&nbsp;<span class="ident" id="6369159">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369172">return</span>&nbsp;<span class="ident" id="6369179">d</span><span class="op" id="6369180">.</span><span class="ident" id="6369181">parseIDAT</span><span class="op" id="6369190">(</span><span class="ident" id="6369191">length</span><span class="op" id="6369197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369200">case</span>&nbsp;<span class="string" id="6369205">&#34;IEND&#34;</span><span class="op" id="6369211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369215">if</span>&nbsp;<span class="ident" id="6369218">d</span><span class="op" id="6369219">.</span><span class="ident" id="6369220">stage</span>&nbsp;<span class="op" id="6369226">!=</span>&nbsp;<span class="ident" id="6369229">dsSeenIDAT</span>&nbsp;<span class="op" id="6369240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369245">return</span>&nbsp;<span class="ident" id="6369252">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369274">d</span><span class="op" id="6369275">.</span><span class="ident" id="6369276">stage</span>&nbsp;<span class="op" id="6369282">=</span>&nbsp;<span class="ident" id="6369284">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369297">return</span>&nbsp;<span class="ident" id="6369304">d</span><span class="op" id="6369305">.</span><span class="ident" id="6369306">parseIEND</span><span class="op" id="6369315">(</span><span class="ident" id="6369316">length</span><span class="op" id="6369322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6369328">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369371">var</span>&nbsp;<span class="ident" id="6369375">ignored</span>&nbsp;<span class="op" id="6369383">[</span><span class="num" id="6369384">4096</span><span class="op" id="6369388">]</span><span class="builtintype" id="6369389">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369395">for</span>&nbsp;<span class="ident" id="6369399">length</span>&nbsp;<span class="op" id="6369406">&gt;</span>&nbsp;<span class="num" id="6369408">0</span>&nbsp;<span class="op" id="6369410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369414">n</span><span class="op" id="6369415">,</span>&nbsp;<span class="ident" id="6369417">err</span>&nbsp;<span class="op" id="6369421">=</span>&nbsp;<span class="ident" id="6369423">io</span><span class="op" id="6369425">.</span><span class="ident" id="6369426">ReadFull</span><span class="op" id="6369434">(</span><span class="ident" id="6369435">d</span><span class="op" id="6369436">.</span><span class="ident" id="6369437">r</span><span class="op" id="6369438">,</span>&nbsp;<span class="ident" id="6369440">ignored</span><span class="op" id="6369447">[</span><span class="op" id="6369448">:</span><span class="ident" id="6369449">min</span><span class="op" id="6369452">(</span><span class="builtinfunc" id="6369453">len</span><span class="op" id="6369456">(</span><span class="ident" id="6369457">ignored</span><span class="op" id="6369464">)</span><span class="op" id="6369465">,</span>&nbsp;<span class="builtintype" id="6369467">int</span><span class="op" id="6369470">(</span><span class="ident" id="6369471">length</span><span class="op" id="6369477">)</span><span class="op" id="6369478">)</span><span class="op" id="6369479">]</span><span class="op" id="6369480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369484">if</span>&nbsp;<span class="ident" id="6369487">err</span>&nbsp;<span class="op" id="6369491">!=</span>&nbsp;<span class="ident" id="6369494">nil</span>&nbsp;<span class="op" id="6369498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369503">return</span>&nbsp;<span class="ident" id="6369510">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369520">d</span><span class="op" id="6369521">.</span><span class="ident" id="6369522">crc</span><span class="op" id="6369525">.</span><span class="ident" id="6369526">Write</span><span class="op" id="6369531">(</span><span class="ident" id="6369532">ignored</span><span class="op" id="6369539">[</span><span class="op" id="6369540">:</span><span class="ident" id="6369541">n</span><span class="op" id="6369542">]</span><span class="op" id="6369543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369547">length</span>&nbsp;<span class="op" id="6369554">-=</span>&nbsp;<span class="builtintype" id="6369557">uint32</span><span class="op" id="6369563">(</span><span class="ident" id="6369564">n</span><span class="op" id="6369565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369571">return</span>&nbsp;<span class="ident" id="6369578">d</span><span class="op" id="6369579">.</span><span class="ident" id="6369580">verifyChecksum</span><span class="op" id="6369594">(</span><span class="op" id="6369595">)</span><br>
<span class="lineno">715</span><span class="op" id="6369597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6369600">func</span>&nbsp;<span class="op" id="6369605">(</span><span class="ident" id="6369606">d</span>&nbsp;<span class="op" id="6369608">*</span><span class="ident" id="6369609">decoder</span><span class="op" id="6369616">)</span>&nbsp;<span class="ident" id="6369618">verifyChecksum</span><span class="op" id="6369632">(</span><span class="op" id="6369633">)</span>&nbsp;<span class="builtintype" id="6369635">error</span>&nbsp;<span class="op" id="6369641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369644">if</span>&nbsp;<span class="ident" id="6369647">_</span><span class="op" id="6369648">,</span>&nbsp;<span class="ident" id="6369650">err</span>&nbsp;<span class="op" id="6369654">:=</span>&nbsp;<span class="ident" id="6369657">io</span><span class="op" id="6369659">.</span><span class="ident" id="6369660">ReadFull</span><span class="op" id="6369668">(</span><span class="ident" id="6369669">d</span><span class="op" id="6369670">.</span><span class="ident" id="6369671">r</span><span class="op" id="6369672">,</span>&nbsp;<span class="ident" id="6369674">d</span><span class="op" id="6369675">.</span><span class="ident" id="6369676">tmp</span><span class="op" id="6369679">[</span><span class="op" id="6369680">:</span><span class="num" id="6369681">4</span><span class="op" id="6369682">]</span><span class="op" id="6369683">)</span><span class="op" id="6369684">;</span>&nbsp;<span class="ident" id="6369686">err</span>&nbsp;<span class="op" id="6369690">!=</span>&nbsp;<span class="ident" id="6369693">nil</span>&nbsp;<span class="op" id="6369697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369701">return</span>&nbsp;<span class="ident" id="6369708">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369716">if</span>&nbsp;<span class="ident" id="6369719">binary</span><span class="op" id="6369725">.</span><span class="ident" id="6369726">BigEndian</span><span class="op" id="6369735">.</span><span class="ident" id="6369736">Uint32</span><span class="op" id="6369742">(</span><span class="ident" id="6369743">d</span><span class="op" id="6369744">.</span><span class="ident" id="6369745">tmp</span><span class="op" id="6369748">[</span><span class="op" id="6369749">:</span><span class="num" id="6369750">4</span><span class="op" id="6369751">]</span><span class="op" id="6369752">)</span>&nbsp;<span class="op" id="6369754">!=</span>&nbsp;<span class="ident" id="6369757">d</span><span class="op" id="6369758">.</span><span class="ident" id="6369759">crc</span><span class="op" id="6369762">.</span><span class="ident" id="6369763">Sum32</span><span class="op" id="6369768">(</span><span class="op" id="6369769">)</span>&nbsp;<span class="op" id="6369771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369775">return</span>&nbsp;<span class="ident" id="6369782">FormatError</span><span class="op" id="6369793">(</span><span class="string" id="6369794">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6369812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369818">return</span>&nbsp;<span class="ident" id="6369825">nil</span><br>
<span class="lineno">725</span><span class="op" id="6369829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6369832">func</span>&nbsp;<span class="op" id="6369837">(</span><span class="ident" id="6369838">d</span>&nbsp;<span class="op" id="6369840">*</span><span class="ident" id="6369841">decoder</span><span class="op" id="6369848">)</span>&nbsp;<span class="ident" id="6369850">checkHeader</span><span class="op" id="6369861">(</span><span class="op" id="6369862">)</span>&nbsp;<span class="builtintype" id="6369864">error</span>&nbsp;<span class="op" id="6369870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369873">_</span><span class="op" id="6369874">,</span>&nbsp;<span class="ident" id="6369876">err</span>&nbsp;<span class="op" id="6369880">:=</span>&nbsp;<span class="ident" id="6369883">io</span><span class="op" id="6369885">.</span><span class="ident" id="6369886">ReadFull</span><span class="op" id="6369894">(</span><span class="ident" id="6369895">d</span><span class="op" id="6369896">.</span><span class="ident" id="6369897">r</span><span class="op" id="6369898">,</span>&nbsp;<span class="ident" id="6369900">d</span><span class="op" id="6369901">.</span><span class="ident" id="6369902">tmp</span><span class="op" id="6369905">[</span><span class="op" id="6369906">:</span><span class="builtinfunc" id="6369907">len</span><span class="op" id="6369910">(</span><span class="ident" id="6369911">pngHeader</span><span class="op" id="6369920">)</span><span class="op" id="6369921">]</span><span class="op" id="6369922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369925">if</span>&nbsp;<span class="ident" id="6369928">err</span>&nbsp;<span class="op" id="6369932">!=</span>&nbsp;<span class="ident" id="6369935">nil</span>&nbsp;<span class="op" id="6369939">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369943">return</span>&nbsp;<span class="ident" id="6369950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369958">if</span>&nbsp;<span class="builtintype" id="6369961">string</span><span class="op" id="6369967">(</span><span class="ident" id="6369968">d</span><span class="op" id="6369969">.</span><span class="ident" id="6369970">tmp</span><span class="op" id="6369973">[</span><span class="op" id="6369974">:</span><span class="builtinfunc" id="6369975">len</span><span class="op" id="6369978">(</span><span class="ident" id="6369979">pngHeader</span><span class="op" id="6369988">)</span><span class="op" id="6369989">]</span><span class="op" id="6369990">)</span>&nbsp;<span class="op" id="6369992">!=</span>&nbsp;<span class="ident" id="6369995">pngHeader</span>&nbsp;<span class="op" id="6370005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370009">return</span>&nbsp;<span class="ident" id="6370016">FormatError</span><span class="op" id="6370027">(</span><span class="string" id="6370028">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="6370044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370047">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370050">return</span>&nbsp;<span class="ident" id="6370057">nil</span><br>
<span class="lineno"></span><span class="op" id="6370061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6370064">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="6370133">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="6370192">func</span>&nbsp;<span class="ident" id="6370197">Decode</span><span class="op" id="6370203">(</span><span class="ident" id="6370204">r</span>&nbsp;<span class="ident" id="6370206">io</span><span class="op" id="6370208">.</span><span class="ident" id="6370209">Reader</span><span class="op" id="6370215">)</span>&nbsp;<span class="op" id="6370217">(</span><span class="ident" id="6370218">image</span><span class="op" id="6370223">.</span><span class="ident" id="6370224">Image</span><span class="op" id="6370229">,</span>&nbsp;<span class="builtintype" id="6370231">error</span><span class="op" id="6370236">)</span>&nbsp;<span class="op" id="6370238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370241">d</span>&nbsp;<span class="op" id="6370243">:=</span>&nbsp;<span class="op" id="6370246">&amp;</span><span class="ident" id="6370247">decoder</span><span class="op" id="6370254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370258">r</span><span class="op" id="6370259">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6370263">r</span><span class="op" id="6370264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370268">crc</span><span class="op" id="6370271">:</span>&nbsp;<span class="ident" id="6370273">crc32</span><span class="op" id="6370278">.</span><span class="ident" id="6370279">NewIEEE</span><span class="op" id="6370286">(</span><span class="op" id="6370287">)</span><span class="op" id="6370288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370291">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370294">if</span>&nbsp;<span class="ident" id="6370297">err</span>&nbsp;<span class="op" id="6370301">:=</span>&nbsp;<span class="ident" id="6370304">d</span><span class="op" id="6370305">.</span><span class="ident" id="6370306">checkHeader</span><span class="op" id="6370317">(</span><span class="op" id="6370318">)</span><span class="op" id="6370319">;</span>&nbsp;<span class="ident" id="6370321">err</span>&nbsp;<span class="op" id="6370325">!=</span>&nbsp;<span class="ident" id="6370328">nil</span>&nbsp;<span class="op" id="6370332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370336">if</span>&nbsp;<span class="ident" id="6370339">err</span>&nbsp;<span class="op" id="6370343">==</span>&nbsp;<span class="ident" id="6370346">io</span><span class="op" id="6370348">.</span><span class="ident" id="6370349">EOF</span>&nbsp;<span class="op" id="6370353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370358">err</span>&nbsp;<span class="op" id="6370362">=</span>&nbsp;<span class="ident" id="6370364">io</span><span class="op" id="6370366">.</span><span class="ident" id="6370367">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370390">return</span>&nbsp;<span class="ident" id="6370397">nil</span><span class="op" id="6370400">,</span>&nbsp;<span class="ident" id="6370402">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370410">for</span>&nbsp;<span class="ident" id="6370414">d</span><span class="op" id="6370415">.</span><span class="ident" id="6370416">stage</span>&nbsp;<span class="op" id="6370422">!=</span>&nbsp;<span class="ident" id="6370425">dsSeenIEND</span>&nbsp;<span class="op" id="6370436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370440">if</span>&nbsp;<span class="ident" id="6370443">err</span>&nbsp;<span class="op" id="6370447">:=</span>&nbsp;<span class="ident" id="6370450">d</span><span class="op" id="6370451">.</span><span class="ident" id="6370452">parseChunk</span><span class="op" id="6370462">(</span><span class="op" id="6370463">)</span><span class="op" id="6370464">;</span>&nbsp;<span class="ident" id="6370466">err</span>&nbsp;<span class="op" id="6370470">!=</span>&nbsp;<span class="ident" id="6370473">nil</span>&nbsp;<span class="op" id="6370477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370482">if</span>&nbsp;<span class="ident" id="6370485">err</span>&nbsp;<span class="op" id="6370489">==</span>&nbsp;<span class="ident" id="6370492">io</span><span class="op" id="6370494">.</span><span class="ident" id="6370495">EOF</span>&nbsp;<span class="op" id="6370499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370505">err</span>&nbsp;<span class="op" id="6370509">=</span>&nbsp;<span class="ident" id="6370511">io</span><span class="op" id="6370513">.</span><span class="ident" id="6370514">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370539">return</span>&nbsp;<span class="ident" id="6370546">nil</span><span class="op" id="6370549">,</span>&nbsp;<span class="ident" id="6370551">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370563">return</span>&nbsp;<span class="ident" id="6370570">d</span><span class="op" id="6370571">.</span><span class="ident" id="6370572">img</span><span class="op" id="6370575">,</span>&nbsp;<span class="ident" id="6370577">nil</span><br>
<span class="lineno">760</span><span class="op" id="6370581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6370584">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6370662">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6370692">func</span>&nbsp;<span class="ident" id="6370697">DecodeConfig</span><span class="op" id="6370709">(</span><span class="ident" id="6370710">r</span>&nbsp;<span class="ident" id="6370712">io</span><span class="op" id="6370714">.</span><span class="ident" id="6370715">Reader</span><span class="op" id="6370721">)</span>&nbsp;<span class="op" id="6370723">(</span><span class="ident" id="6370724">image</span><span class="op" id="6370729">.</span><span class="ident" id="6370730">Config</span><span class="op" id="6370736">,</span>&nbsp;<span class="builtintype" id="6370738">error</span><span class="op" id="6370743">)</span>&nbsp;<span class="op" id="6370745">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370748">d</span>&nbsp;<span class="op" id="6370750">:=</span>&nbsp;<span class="op" id="6370753">&amp;</span><span class="ident" id="6370754">decoder</span><span class="op" id="6370761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370765">r</span><span class="op" id="6370766">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6370770">r</span><span class="op" id="6370771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370775">crc</span><span class="op" id="6370778">:</span>&nbsp;<span class="ident" id="6370780">crc32</span><span class="op" id="6370785">.</span><span class="ident" id="6370786">NewIEEE</span><span class="op" id="6370793">(</span><span class="op" id="6370794">)</span><span class="op" id="6370795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370801">if</span>&nbsp;<span class="ident" id="6370804">err</span>&nbsp;<span class="op" id="6370808">:=</span>&nbsp;<span class="ident" id="6370811">d</span><span class="op" id="6370812">.</span><span class="ident" id="6370813">checkHeader</span><span class="op" id="6370824">(</span><span class="op" id="6370825">)</span><span class="op" id="6370826">;</span>&nbsp;<span class="ident" id="6370828">err</span>&nbsp;<span class="op" id="6370832">!=</span>&nbsp;<span class="ident" id="6370835">nil</span>&nbsp;<span class="op" id="6370839">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370843">if</span>&nbsp;<span class="ident" id="6370846">err</span>&nbsp;<span class="op" id="6370850">==</span>&nbsp;<span class="ident" id="6370853">io</span><span class="op" id="6370855">.</span><span class="ident" id="6370856">EOF</span>&nbsp;<span class="op" id="6370860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370865">err</span>&nbsp;<span class="op" id="6370869">=</span>&nbsp;<span class="ident" id="6370871">io</span><span class="op" id="6370873">.</span><span class="ident" id="6370874">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370897">return</span>&nbsp;<span class="ident" id="6370904">image</span><span class="op" id="6370909">.</span><span class="ident" id="6370910">Config</span><span class="op" id="6370916">{</span><span class="op" id="6370917">}</span><span class="op" id="6370918">,</span>&nbsp;<span class="ident" id="6370920">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370925">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370928">for</span>&nbsp;<span class="op" id="6370932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370936">if</span>&nbsp;<span class="ident" id="6370939">err</span>&nbsp;<span class="op" id="6370943">:=</span>&nbsp;<span class="ident" id="6370946">d</span><span class="op" id="6370947">.</span><span class="ident" id="6370948">parseChunk</span><span class="op" id="6370958">(</span><span class="op" id="6370959">)</span><span class="op" id="6370960">;</span>&nbsp;<span class="ident" id="6370962">err</span>&nbsp;<span class="op" id="6370966">!=</span>&nbsp;<span class="ident" id="6370969">nil</span>&nbsp;<span class="op" id="6370973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370978">if</span>&nbsp;<span class="ident" id="6370981">err</span>&nbsp;<span class="op" id="6370985">==</span>&nbsp;<span class="ident" id="6370988">io</span><span class="op" id="6370990">.</span><span class="ident" id="6370991">EOF</span>&nbsp;<span class="op" id="6370995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371001">err</span>&nbsp;<span class="op" id="6371005">=</span>&nbsp;<span class="ident" id="6371007">io</span><span class="op" id="6371009">.</span><span class="ident" id="6371010">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371030">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371035">return</span>&nbsp;<span class="ident" id="6371042">image</span><span class="op" id="6371047">.</span><span class="ident" id="6371048">Config</span><span class="op" id="6371054">{</span><span class="op" id="6371055">}</span><span class="op" id="6371056">,</span>&nbsp;<span class="ident" id="6371058">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371068">paletted</span>&nbsp;<span class="op" id="6371077">:=</span>&nbsp;<span class="ident" id="6371080">d</span><span class="op" id="6371081">.</span><span class="ident" id="6371082">cb</span>&nbsp;<span class="op" id="6371085">==</span>&nbsp;<span class="ident" id="6371088">cbP8</span>&nbsp;<span class="op" id="6371093">||</span>&nbsp;<span class="ident" id="6371096">d</span><span class="op" id="6371097">.</span><span class="ident" id="6371098">cb</span>&nbsp;<span class="op" id="6371101">==</span>&nbsp;<span class="ident" id="6371104">cbP4</span>&nbsp;<span class="op" id="6371109">||</span>&nbsp;<span class="ident" id="6371112">d</span><span class="op" id="6371113">.</span><span class="ident" id="6371114">cb</span>&nbsp;<span class="op" id="6371117">==</span>&nbsp;<span class="ident" id="6371120">cbP2</span>&nbsp;<span class="op" id="6371125">||</span>&nbsp;<span class="ident" id="6371128">d</span><span class="op" id="6371129">.</span><span class="ident" id="6371130">cb</span>&nbsp;<span class="op" id="6371133">==</span>&nbsp;<span class="ident" id="6371136">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371143">if</span>&nbsp;<span class="ident" id="6371146">d</span><span class="op" id="6371147">.</span><span class="ident" id="6371148">stage</span>&nbsp;<span class="op" id="6371154">==</span>&nbsp;<span class="ident" id="6371157">dsSeenIHDR</span>&nbsp;<span class="op" id="6371168">&amp;&amp;</span>&nbsp;<span class="op" id="6371171">!</span><span class="ident" id="6371172">paletted</span>&nbsp;<span class="op" id="6371181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371186">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371198">if</span>&nbsp;<span class="ident" id="6371201">d</span><span class="op" id="6371202">.</span><span class="ident" id="6371203">stage</span>&nbsp;<span class="op" id="6371209">==</span>&nbsp;<span class="ident" id="6371212">dsSeenPLTE</span>&nbsp;<span class="op" id="6371223">&amp;&amp;</span>&nbsp;<span class="ident" id="6371226">paletted</span>&nbsp;<span class="op" id="6371235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371240">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371251">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371254">var</span>&nbsp;<span class="ident" id="6371258">cm</span>&nbsp;<span class="ident" id="6371261">color</span><span class="op" id="6371266">.</span><span class="ident" id="6371267">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371274">switch</span>&nbsp;<span class="ident" id="6371281">d</span><span class="op" id="6371282">.</span><span class="ident" id="6371283">cb</span>&nbsp;<span class="op" id="6371286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371289">case</span>&nbsp;<span class="ident" id="6371294">cbG1</span><span class="op" id="6371298">,</span>&nbsp;<span class="ident" id="6371300">cbG2</span><span class="op" id="6371304">,</span>&nbsp;<span class="ident" id="6371306">cbG4</span><span class="op" id="6371310">,</span>&nbsp;<span class="ident" id="6371312">cbG8</span><span class="op" id="6371316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371320">cm</span>&nbsp;<span class="op" id="6371323">=</span>&nbsp;<span class="ident" id="6371325">color</span><span class="op" id="6371330">.</span><span class="ident" id="6371331">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371342">case</span>&nbsp;<span class="ident" id="6371347">cbGA8</span><span class="op" id="6371352">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371356">cm</span>&nbsp;<span class="op" id="6371359">=</span>&nbsp;<span class="ident" id="6371361">color</span><span class="op" id="6371366">.</span><span class="ident" id="6371367">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371379">case</span>&nbsp;<span class="ident" id="6371384">cbTC8</span><span class="op" id="6371389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371393">cm</span>&nbsp;<span class="op" id="6371396">=</span>&nbsp;<span class="ident" id="6371398">color</span><span class="op" id="6371403">.</span><span class="ident" id="6371404">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371415">case</span>&nbsp;<span class="ident" id="6371420">cbP1</span><span class="op" id="6371424">,</span>&nbsp;<span class="ident" id="6371426">cbP2</span><span class="op" id="6371430">,</span>&nbsp;<span class="ident" id="6371432">cbP4</span><span class="op" id="6371436">,</span>&nbsp;<span class="ident" id="6371438">cbP8</span><span class="op" id="6371442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371446">cm</span>&nbsp;<span class="op" id="6371449">=</span>&nbsp;<span class="ident" id="6371451">d</span><span class="op" id="6371452">.</span><span class="ident" id="6371453">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371462">case</span>&nbsp;<span class="ident" id="6371467">cbTCA8</span><span class="op" id="6371473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371477">cm</span>&nbsp;<span class="op" id="6371480">=</span>&nbsp;<span class="ident" id="6371482">color</span><span class="op" id="6371487">.</span><span class="ident" id="6371488">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371500">case</span>&nbsp;<span class="ident" id="6371505">cbG16</span><span class="op" id="6371510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371514">cm</span>&nbsp;<span class="op" id="6371517">=</span>&nbsp;<span class="ident" id="6371519">color</span><span class="op" id="6371524">.</span><span class="ident" id="6371525">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371538">case</span>&nbsp;<span class="ident" id="6371543">cbGA16</span><span class="op" id="6371549">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371553">cm</span>&nbsp;<span class="op" id="6371556">=</span>&nbsp;<span class="ident" id="6371558">color</span><span class="op" id="6371563">.</span><span class="ident" id="6371564">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371578">case</span>&nbsp;<span class="ident" id="6371583">cbTC16</span><span class="op" id="6371589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371593">cm</span>&nbsp;<span class="op" id="6371596">=</span>&nbsp;<span class="ident" id="6371598">color</span><span class="op" id="6371603">.</span><span class="ident" id="6371604">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371617">case</span>&nbsp;<span class="ident" id="6371622">cbTCA16</span><span class="op" id="6371629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371633">cm</span>&nbsp;<span class="op" id="6371636">=</span>&nbsp;<span class="ident" id="6371638">color</span><span class="op" id="6371643">.</span><span class="ident" id="6371644">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371661">return</span>&nbsp;<span class="ident" id="6371668">image</span><span class="op" id="6371673">.</span><span class="ident" id="6371674">Config</span><span class="op" id="6371680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371684">ColorModel</span><span class="op" id="6371694">:</span>&nbsp;<span class="ident" id="6371696">cm</span><span class="op" id="6371698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371702">Width</span><span class="op" id="6371707">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371714">d</span><span class="op" id="6371715">.</span><span class="ident" id="6371716">width</span><span class="op" id="6371721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371725">Height</span><span class="op" id="6371731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371737">d</span><span class="op" id="6371738">.</span><span class="ident" id="6371739">height</span><span class="op" id="6371745">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371748">}</span><span class="op" id="6371749">,</span>&nbsp;<span class="ident" id="6371751">nil</span><br>
<span class="lineno"></span><span class="op" id="6371755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6371758">func</span>&nbsp;<span class="ident" id="6371763">init</span><span class="op" id="6371767">(</span><span class="op" id="6371768">)</span>&nbsp;<span class="op" id="6371770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371773">image</span><span class="op" id="6371778">.</span><span class="ident" id="6371779">RegisterFormat</span><span class="op" id="6371793">(</span><span class="string" id="6371794">&#34;png&#34;</span><span class="op" id="6371799">,</span>&nbsp;<span class="ident" id="6371801">pngHeader</span><span class="op" id="6371810">,</span>&nbsp;<span class="ident" id="6371812">Decode</span><span class="op" id="6371818">,</span>&nbsp;<span class="ident" id="6371820">DecodeConfig</span><span class="op" id="6371832">)</span><br>
<span class="lineno">820</span><span class="op" id="6371834">}</span>
</div>
</body>
</html>
