<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7898726">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7898782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7898836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7898887">package</span>&nbsp;<span class="ident" id="7898895">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898900">import</span>&nbsp;<span class="op" id="7898907">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898910">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898919">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898926">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898932">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898943">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898954">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7898965">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7898972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898975">type</span>&nbsp;<span class="ident" id="7898980">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="7898998">struct</span>&nbsp;<span class="op" id="7899005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899008">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7899022">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899030">litAddrOrName</span>&nbsp;<span class="builtintype" id="7899044">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899052">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7899066">*</span><span class="ident" id="7899067">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899075">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7899089">error</span><br>
<span class="lineno"></span><span class="op" id="7899095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899098">var</span>&nbsp;<span class="ident" id="7899102">resolveIPAddrTests</span>&nbsp;<span class="op" id="7899121">=</span>&nbsp;<span class="op" id="7899123">[</span><span class="op" id="7899124">]</span><span class="ident" id="7899125">resolveIPAddrTest</span><span class="op" id="7899142">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899145">{</span><span class="string" id="7899146">&#34;ip&#34;</span><span class="op" id="7899150">,</span>&nbsp;<span class="string" id="7899152">&#34;127.0.0.1&#34;</span><span class="op" id="7899163">,</span>&nbsp;<span class="op" id="7899165">&amp;</span><span class="ident" id="7899166">IPAddr</span><span class="op" id="7899172">{</span><span class="ident" id="7899173">IP</span><span class="op" id="7899175">:</span>&nbsp;<span class="ident" id="7899177">IPv4</span><span class="op" id="7899181">(</span><span class="num" id="7899182">127</span><span class="op" id="7899185">,</span>&nbsp;<span class="num" id="7899187">0</span><span class="op" id="7899188">,</span>&nbsp;<span class="num" id="7899190">0</span><span class="op" id="7899191">,</span>&nbsp;<span class="num" id="7899193">1</span><span class="op" id="7899194">)</span><span class="op" id="7899195">}</span><span class="op" id="7899196">,</span>&nbsp;<span class="ident" id="7899198">nil</span><span class="op" id="7899201">}</span><span class="op" id="7899202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899205">{</span><span class="string" id="7899206">&#34;ip4&#34;</span><span class="op" id="7899211">,</span>&nbsp;<span class="string" id="7899213">&#34;127.0.0.1&#34;</span><span class="op" id="7899224">,</span>&nbsp;<span class="op" id="7899226">&amp;</span><span class="ident" id="7899227">IPAddr</span><span class="op" id="7899233">{</span><span class="ident" id="7899234">IP</span><span class="op" id="7899236">:</span>&nbsp;<span class="ident" id="7899238">IPv4</span><span class="op" id="7899242">(</span><span class="num" id="7899243">127</span><span class="op" id="7899246">,</span>&nbsp;<span class="num" id="7899248">0</span><span class="op" id="7899249">,</span>&nbsp;<span class="num" id="7899251">0</span><span class="op" id="7899252">,</span>&nbsp;<span class="num" id="7899254">1</span><span class="op" id="7899255">)</span><span class="op" id="7899256">}</span><span class="op" id="7899257">,</span>&nbsp;<span class="ident" id="7899259">nil</span><span class="op" id="7899262">}</span><span class="op" id="7899263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899266">{</span><span class="string" id="7899267">&#34;ip4:icmp&#34;</span><span class="op" id="7899277">,</span>&nbsp;<span class="string" id="7899279">&#34;127.0.0.1&#34;</span><span class="op" id="7899290">,</span>&nbsp;<span class="op" id="7899292">&amp;</span><span class="ident" id="7899293">IPAddr</span><span class="op" id="7899299">{</span><span class="ident" id="7899300">IP</span><span class="op" id="7899302">:</span>&nbsp;<span class="ident" id="7899304">IPv4</span><span class="op" id="7899308">(</span><span class="num" id="7899309">127</span><span class="op" id="7899312">,</span>&nbsp;<span class="num" id="7899314">0</span><span class="op" id="7899315">,</span>&nbsp;<span class="num" id="7899317">0</span><span class="op" id="7899318">,</span>&nbsp;<span class="num" id="7899320">1</span><span class="op" id="7899321">)</span><span class="op" id="7899322">}</span><span class="op" id="7899323">,</span>&nbsp;<span class="ident" id="7899325">nil</span><span class="op" id="7899328">}</span><span class="op" id="7899329">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899333">{</span><span class="string" id="7899334">&#34;ip&#34;</span><span class="op" id="7899338">,</span>&nbsp;<span class="string" id="7899340">&#34;::1&#34;</span><span class="op" id="7899345">,</span>&nbsp;<span class="op" id="7899347">&amp;</span><span class="ident" id="7899348">IPAddr</span><span class="op" id="7899354">{</span><span class="ident" id="7899355">IP</span><span class="op" id="7899357">:</span>&nbsp;<span class="ident" id="7899359">ParseIP</span><span class="op" id="7899366">(</span><span class="string" id="7899367">&#34;::1&#34;</span><span class="op" id="7899372">)</span><span class="op" id="7899373">}</span><span class="op" id="7899374">,</span>&nbsp;<span class="ident" id="7899376">nil</span><span class="op" id="7899379">}</span><span class="op" id="7899380">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899383">{</span><span class="string" id="7899384">&#34;ip6&#34;</span><span class="op" id="7899389">,</span>&nbsp;<span class="string" id="7899391">&#34;::1&#34;</span><span class="op" id="7899396">,</span>&nbsp;<span class="op" id="7899398">&amp;</span><span class="ident" id="7899399">IPAddr</span><span class="op" id="7899405">{</span><span class="ident" id="7899406">IP</span><span class="op" id="7899408">:</span>&nbsp;<span class="ident" id="7899410">ParseIP</span><span class="op" id="7899417">(</span><span class="string" id="7899418">&#34;::1&#34;</span><span class="op" id="7899423">)</span><span class="op" id="7899424">}</span><span class="op" id="7899425">,</span>&nbsp;<span class="ident" id="7899427">nil</span><span class="op" id="7899430">}</span><span class="op" id="7899431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899434">{</span><span class="string" id="7899435">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7899450">,</span>&nbsp;<span class="string" id="7899452">&#34;::1&#34;</span><span class="op" id="7899457">,</span>&nbsp;<span class="op" id="7899459">&amp;</span><span class="ident" id="7899460">IPAddr</span><span class="op" id="7899466">{</span><span class="ident" id="7899467">IP</span><span class="op" id="7899469">:</span>&nbsp;<span class="ident" id="7899471">ParseIP</span><span class="op" id="7899478">(</span><span class="string" id="7899479">&#34;::1&#34;</span><span class="op" id="7899484">)</span><span class="op" id="7899485">}</span><span class="op" id="7899486">,</span>&nbsp;<span class="ident" id="7899488">nil</span><span class="op" id="7899491">}</span><span class="op" id="7899492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899495">{</span><span class="string" id="7899496">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="7899511">,</span>&nbsp;<span class="string" id="7899513">&#34;::1&#34;</span><span class="op" id="7899518">,</span>&nbsp;<span class="op" id="7899520">&amp;</span><span class="ident" id="7899521">IPAddr</span><span class="op" id="7899527">{</span><span class="ident" id="7899528">IP</span><span class="op" id="7899530">:</span>&nbsp;<span class="ident" id="7899532">ParseIP</span><span class="op" id="7899539">(</span><span class="string" id="7899540">&#34;::1&#34;</span><span class="op" id="7899545">)</span><span class="op" id="7899546">}</span><span class="op" id="7899547">,</span>&nbsp;<span class="ident" id="7899549">nil</span><span class="op" id="7899552">}</span><span class="op" id="7899553">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899557">{</span><span class="string" id="7899558">&#34;ip&#34;</span><span class="op" id="7899562">,</span>&nbsp;<span class="string" id="7899564">&#34;::1%en0&#34;</span><span class="op" id="7899573">,</span>&nbsp;<span class="op" id="7899575">&amp;</span><span class="ident" id="7899576">IPAddr</span><span class="op" id="7899582">{</span><span class="ident" id="7899583">IP</span><span class="op" id="7899585">:</span>&nbsp;<span class="ident" id="7899587">ParseIP</span><span class="op" id="7899594">(</span><span class="string" id="7899595">&#34;::1&#34;</span><span class="op" id="7899600">)</span><span class="op" id="7899601">,</span>&nbsp;<span class="ident" id="7899603">Zone</span><span class="op" id="7899607">:</span>&nbsp;<span class="string" id="7899609">&#34;en0&#34;</span><span class="op" id="7899614">}</span><span class="op" id="7899615">,</span>&nbsp;<span class="ident" id="7899617">nil</span><span class="op" id="7899620">}</span><span class="op" id="7899621">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899624">{</span><span class="string" id="7899625">&#34;ip6&#34;</span><span class="op" id="7899630">,</span>&nbsp;<span class="string" id="7899632">&#34;::1%911&#34;</span><span class="op" id="7899641">,</span>&nbsp;<span class="op" id="7899643">&amp;</span><span class="ident" id="7899644">IPAddr</span><span class="op" id="7899650">{</span><span class="ident" id="7899651">IP</span><span class="op" id="7899653">:</span>&nbsp;<span class="ident" id="7899655">ParseIP</span><span class="op" id="7899662">(</span><span class="string" id="7899663">&#34;::1&#34;</span><span class="op" id="7899668">)</span><span class="op" id="7899669">,</span>&nbsp;<span class="ident" id="7899671">Zone</span><span class="op" id="7899675">:</span>&nbsp;<span class="string" id="7899677">&#34;911&#34;</span><span class="op" id="7899682">}</span><span class="op" id="7899683">,</span>&nbsp;<span class="ident" id="7899685">nil</span><span class="op" id="7899688">}</span><span class="op" id="7899689">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899693">{</span><span class="string" id="7899694">&#34;&#34;</span><span class="op" id="7899696">,</span>&nbsp;<span class="string" id="7899698">&#34;127.0.0.1&#34;</span><span class="op" id="7899709">,</span>&nbsp;<span class="op" id="7899711">&amp;</span><span class="ident" id="7899712">IPAddr</span><span class="op" id="7899718">{</span><span class="ident" id="7899719">IP</span><span class="op" id="7899721">:</span>&nbsp;<span class="ident" id="7899723">IPv4</span><span class="op" id="7899727">(</span><span class="num" id="7899728">127</span><span class="op" id="7899731">,</span>&nbsp;<span class="num" id="7899733">0</span><span class="op" id="7899734">,</span>&nbsp;<span class="num" id="7899736">0</span><span class="op" id="7899737">,</span>&nbsp;<span class="num" id="7899739">1</span><span class="op" id="7899740">)</span><span class="op" id="7899741">}</span><span class="op" id="7899742">,</span>&nbsp;<span class="ident" id="7899744">nil</span><span class="op" id="7899747">}</span><span class="op" id="7899748">,</span>&nbsp;<span class="comment" id="7899750">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899770">{</span><span class="string" id="7899771">&#34;&#34;</span><span class="op" id="7899773">,</span>&nbsp;<span class="string" id="7899775">&#34;::1&#34;</span><span class="op" id="7899780">,</span>&nbsp;<span class="op" id="7899782">&amp;</span><span class="ident" id="7899783">IPAddr</span><span class="op" id="7899789">{</span><span class="ident" id="7899790">IP</span><span class="op" id="7899792">:</span>&nbsp;<span class="ident" id="7899794">ParseIP</span><span class="op" id="7899801">(</span><span class="string" id="7899802">&#34;::1&#34;</span><span class="op" id="7899807">)</span><span class="op" id="7899808">}</span><span class="op" id="7899809">,</span>&nbsp;<span class="ident" id="7899811">nil</span><span class="op" id="7899814">}</span><span class="op" id="7899815">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7899827">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899848">{</span><span class="string" id="7899849">&#34;l2tp&#34;</span><span class="op" id="7899855">,</span>&nbsp;<span class="string" id="7899857">&#34;127.0.0.1&#34;</span><span class="op" id="7899868">,</span>&nbsp;<span class="ident" id="7899870">nil</span><span class="op" id="7899873">,</span>&nbsp;<span class="ident" id="7899875">UnknownNetworkError</span><span class="op" id="7899894">(</span><span class="string" id="7899895">&#34;l2tp&#34;</span><span class="op" id="7899901">)</span><span class="op" id="7899902">}</span><span class="op" id="7899903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899906">{</span><span class="string" id="7899907">&#34;l2tp:gre&#34;</span><span class="op" id="7899917">,</span>&nbsp;<span class="string" id="7899919">&#34;127.0.0.1&#34;</span><span class="op" id="7899930">,</span>&nbsp;<span class="ident" id="7899932">nil</span><span class="op" id="7899935">,</span>&nbsp;<span class="ident" id="7899937">UnknownNetworkError</span><span class="op" id="7899956">(</span><span class="string" id="7899957">&#34;l2tp:gre&#34;</span><span class="op" id="7899967">)</span><span class="op" id="7899968">}</span><span class="op" id="7899969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899972">{</span><span class="string" id="7899973">&#34;tcp&#34;</span><span class="op" id="7899978">,</span>&nbsp;<span class="string" id="7899980">&#34;1.2.3.4:123&#34;</span><span class="op" id="7899993">,</span>&nbsp;<span class="ident" id="7899995">nil</span><span class="op" id="7899998">,</span>&nbsp;<span class="ident" id="7900000">UnknownNetworkError</span><span class="op" id="7900019">(</span><span class="string" id="7900020">&#34;tcp&#34;</span><span class="op" id="7900025">)</span><span class="op" id="7900026">}</span><span class="op" id="7900027">,</span><br>
<span class="lineno"></span><span class="op" id="7900029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7900032">func</span>&nbsp;<span class="ident" id="7900037">init</span><span class="op" id="7900041">(</span><span class="op" id="7900042">)</span>&nbsp;<span class="op" id="7900044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900047">if</span>&nbsp;<span class="ident" id="7900050">ifi</span>&nbsp;<span class="op" id="7900054">:=</span>&nbsp;<span class="ident" id="7900057">loopbackInterface</span><span class="op" id="7900074">(</span><span class="op" id="7900075">)</span><span class="op" id="7900076">;</span>&nbsp;<span class="ident" id="7900078">ifi</span>&nbsp;<span class="op" id="7900082">!=</span>&nbsp;<span class="ident" id="7900085">nil</span>&nbsp;<span class="op" id="7900089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900093">index</span>&nbsp;<span class="op" id="7900099">:=</span>&nbsp;<span class="ident" id="7900102">fmt</span><span class="op" id="7900105">.</span><span class="ident" id="7900106">Sprintf</span><span class="op" id="7900113">(</span><span class="string" id="7900114">&#34;%v&#34;</span><span class="op" id="7900118">,</span>&nbsp;<span class="ident" id="7900120">ifi</span><span class="op" id="7900123">.</span><span class="ident" id="7900124">Index</span><span class="op" id="7900129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900133">resolveIPAddrTests</span>&nbsp;<span class="op" id="7900152">=</span>&nbsp;<span class="builtinfunc" id="7900154">append</span><span class="op" id="7900160">(</span><span class="ident" id="7900161">resolveIPAddrTests</span><span class="op" id="7900179">,</span>&nbsp;<span class="op" id="7900181">[</span><span class="op" id="7900182">]</span><span class="ident" id="7900183">resolveIPAddrTest</span><span class="op" id="7900200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900205">{</span><span class="string" id="7900206">&#34;ip6&#34;</span><span class="op" id="7900211">,</span>&nbsp;<span class="string" id="7900213">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7900224">+</span>&nbsp;<span class="ident" id="7900226">ifi</span><span class="op" id="7900229">.</span><span class="ident" id="7900230">Name</span><span class="op" id="7900234">,</span>&nbsp;<span class="op" id="7900236">&amp;</span><span class="ident" id="7900237">IPAddr</span><span class="op" id="7900243">{</span><span class="ident" id="7900244">IP</span><span class="op" id="7900246">:</span>&nbsp;<span class="ident" id="7900248">ParseIP</span><span class="op" id="7900255">(</span><span class="string" id="7900256">&#34;fe80::1&#34;</span><span class="op" id="7900265">)</span><span class="op" id="7900266">,</span>&nbsp;<span class="ident" id="7900268">Zone</span><span class="op" id="7900272">:</span>&nbsp;<span class="ident" id="7900274">zoneToString</span><span class="op" id="7900286">(</span><span class="ident" id="7900287">ifi</span><span class="op" id="7900290">.</span><span class="ident" id="7900291">Index</span><span class="op" id="7900296">)</span><span class="op" id="7900297">}</span><span class="op" id="7900298">,</span>&nbsp;<span class="ident" id="7900300">nil</span><span class="op" id="7900303">}</span><span class="op" id="7900304">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900309">{</span><span class="string" id="7900310">&#34;ip6&#34;</span><span class="op" id="7900315">,</span>&nbsp;<span class="string" id="7900317">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7900328">+</span>&nbsp;<span class="ident" id="7900330">index</span><span class="op" id="7900335">,</span>&nbsp;<span class="op" id="7900337">&amp;</span><span class="ident" id="7900338">IPAddr</span><span class="op" id="7900344">{</span><span class="ident" id="7900345">IP</span><span class="op" id="7900347">:</span>&nbsp;<span class="ident" id="7900349">ParseIP</span><span class="op" id="7900356">(</span><span class="string" id="7900357">&#34;fe80::1&#34;</span><span class="op" id="7900366">)</span><span class="op" id="7900367">,</span>&nbsp;<span class="ident" id="7900369">Zone</span><span class="op" id="7900373">:</span>&nbsp;<span class="ident" id="7900375">index</span><span class="op" id="7900380">}</span><span class="op" id="7900381">,</span>&nbsp;<span class="ident" id="7900383">nil</span><span class="op" id="7900386">}</span><span class="op" id="7900387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900391">}</span><span class="op" id="7900392">...</span><span class="op" id="7900395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900401">if</span>&nbsp;<span class="ident" id="7900404">ips</span><span class="op" id="7900407">,</span>&nbsp;<span class="ident" id="7900409">err</span>&nbsp;<span class="op" id="7900413">:=</span>&nbsp;<span class="ident" id="7900416">LookupIP</span><span class="op" id="7900424">(</span><span class="string" id="7900425">&#34;localhost&#34;</span><span class="op" id="7900436">)</span><span class="op" id="7900437">;</span>&nbsp;<span class="ident" id="7900439">err</span>&nbsp;<span class="op" id="7900443">==</span>&nbsp;<span class="ident" id="7900446">nil</span>&nbsp;<span class="op" id="7900450">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7900453">len</span><span class="op" id="7900456">(</span><span class="ident" id="7900457">ips</span><span class="op" id="7900460">)</span>&nbsp;<span class="op" id="7900462">&gt;</span>&nbsp;<span class="num" id="7900464">1</span>&nbsp;<span class="op" id="7900466">&amp;&amp;</span>&nbsp;<span class="ident" id="7900469">supportsIPv4</span>&nbsp;<span class="op" id="7900482">&amp;&amp;</span>&nbsp;<span class="ident" id="7900485">supportsIPv6</span>&nbsp;<span class="op" id="7900498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900502">resolveIPAddrTests</span>&nbsp;<span class="op" id="7900521">=</span>&nbsp;<span class="builtinfunc" id="7900523">append</span><span class="op" id="7900529">(</span><span class="ident" id="7900530">resolveIPAddrTests</span><span class="op" id="7900548">,</span>&nbsp;<span class="op" id="7900550">[</span><span class="op" id="7900551">]</span><span class="ident" id="7900552">resolveIPAddrTest</span><span class="op" id="7900569">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900574">{</span><span class="string" id="7900575">&#34;ip&#34;</span><span class="op" id="7900579">,</span>&nbsp;<span class="string" id="7900581">&#34;localhost&#34;</span><span class="op" id="7900592">,</span>&nbsp;<span class="op" id="7900594">&amp;</span><span class="ident" id="7900595">IPAddr</span><span class="op" id="7900601">{</span><span class="ident" id="7900602">IP</span><span class="op" id="7900604">:</span>&nbsp;<span class="ident" id="7900606">IPv4</span><span class="op" id="7900610">(</span><span class="num" id="7900611">127</span><span class="op" id="7900614">,</span>&nbsp;<span class="num" id="7900616">0</span><span class="op" id="7900617">,</span>&nbsp;<span class="num" id="7900619">0</span><span class="op" id="7900620">,</span>&nbsp;<span class="num" id="7900622">1</span><span class="op" id="7900623">)</span><span class="op" id="7900624">}</span><span class="op" id="7900625">,</span>&nbsp;<span class="ident" id="7900627">nil</span><span class="op" id="7900630">}</span><span class="op" id="7900631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900636">{</span><span class="string" id="7900637">&#34;ip4&#34;</span><span class="op" id="7900642">,</span>&nbsp;<span class="string" id="7900644">&#34;localhost&#34;</span><span class="op" id="7900655">,</span>&nbsp;<span class="op" id="7900657">&amp;</span><span class="ident" id="7900658">IPAddr</span><span class="op" id="7900664">{</span><span class="ident" id="7900665">IP</span><span class="op" id="7900667">:</span>&nbsp;<span class="ident" id="7900669">IPv4</span><span class="op" id="7900673">(</span><span class="num" id="7900674">127</span><span class="op" id="7900677">,</span>&nbsp;<span class="num" id="7900679">0</span><span class="op" id="7900680">,</span>&nbsp;<span class="num" id="7900682">0</span><span class="op" id="7900683">,</span>&nbsp;<span class="num" id="7900685">1</span><span class="op" id="7900686">)</span><span class="op" id="7900687">}</span><span class="op" id="7900688">,</span>&nbsp;<span class="ident" id="7900690">nil</span><span class="op" id="7900693">}</span><span class="op" id="7900694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900699">{</span><span class="string" id="7900700">&#34;ip6&#34;</span><span class="op" id="7900705">,</span>&nbsp;<span class="string" id="7900707">&#34;localhost&#34;</span><span class="op" id="7900718">,</span>&nbsp;<span class="op" id="7900720">&amp;</span><span class="ident" id="7900721">IPAddr</span><span class="op" id="7900727">{</span><span class="ident" id="7900728">IP</span><span class="op" id="7900730">:</span>&nbsp;<span class="ident" id="7900732">IPv6loopback</span><span class="op" id="7900744">}</span><span class="op" id="7900745">,</span>&nbsp;<span class="ident" id="7900747">nil</span><span class="op" id="7900750">}</span><span class="op" id="7900751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900755">}</span><span class="op" id="7900756">...</span><span class="op" id="7900759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900762">}</span><br>
<span class="lineno">60</span><span class="op" id="7900764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7900767">func</span>&nbsp;<span class="ident" id="7900772">skipRawSocketTest</span><span class="op" id="7900789">(</span><span class="ident" id="7900790">t</span>&nbsp;<span class="op" id="7900792">*</span><span class="ident" id="7900793">testing</span><span class="op" id="7900800">.</span><span class="ident" id="7900801">T</span><span class="op" id="7900802">)</span>&nbsp;<span class="op" id="7900804">(</span><span class="ident" id="7900805">skip</span>&nbsp;<span class="builtintype" id="7900810">bool</span><span class="op" id="7900814">,</span>&nbsp;<span class="ident" id="7900816">skipmsg</span>&nbsp;<span class="builtintype" id="7900824">string</span><span class="op" id="7900830">)</span>&nbsp;<span class="op" id="7900832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900835">skip</span><span class="op" id="7900839">,</span>&nbsp;<span class="ident" id="7900841">skipmsg</span><span class="op" id="7900848">,</span>&nbsp;<span class="ident" id="7900850">err</span>&nbsp;<span class="op" id="7900854">:=</span>&nbsp;<span class="ident" id="7900857">skipRawSocketTests</span><span class="op" id="7900875">(</span><span class="op" id="7900876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900879">if</span>&nbsp;<span class="ident" id="7900882">err</span>&nbsp;<span class="op" id="7900886">!=</span>&nbsp;<span class="ident" id="7900889">nil</span>&nbsp;<span class="op" id="7900893">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900897">t</span><span class="op" id="7900898">.</span><span class="ident" id="7900899">Fatal</span><span class="op" id="7900904">(</span><span class="ident" id="7900905">err</span><span class="op" id="7900908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900914">return</span>&nbsp;<span class="ident" id="7900921">skip</span><span class="op" id="7900925">,</span>&nbsp;<span class="ident" id="7900927">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="7900935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7900938">func</span>&nbsp;<span class="ident" id="7900943">TestResolveIPAddr</span><span class="op" id="7900960">(</span><span class="ident" id="7900961">t</span>&nbsp;<span class="op" id="7900963">*</span><span class="ident" id="7900964">testing</span><span class="op" id="7900971">.</span><span class="ident" id="7900972">T</span><span class="op" id="7900973">)</span>&nbsp;<span class="op" id="7900975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900978">switch</span>&nbsp;<span class="ident" id="7900985">runtime</span><span class="op" id="7900992">.</span><span class="ident" id="7900993">GOOS</span>&nbsp;<span class="op" id="7900998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901001">case</span>&nbsp;<span class="string" id="7901006">&#34;nacl&#34;</span><span class="op" id="7901012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901016">t</span><span class="op" id="7901017">.</span><span class="ident" id="7901018">Skipf</span><span class="op" id="7901023">(</span><span class="string" id="7901024">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7901045">,</span>&nbsp;<span class="ident" id="7901047">runtime</span><span class="op" id="7901054">.</span><span class="ident" id="7901055">GOOS</span><span class="op" id="7901059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901062">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901066">for</span>&nbsp;<span class="ident" id="7901070">_</span><span class="op" id="7901071">,</span>&nbsp;<span class="ident" id="7901073">tt</span>&nbsp;<span class="op" id="7901076">:=</span>&nbsp;<span class="keyword" id="7901079">range</span>&nbsp;<span class="ident" id="7901085">resolveIPAddrTests</span>&nbsp;<span class="op" id="7901104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901108">addr</span><span class="op" id="7901112">,</span>&nbsp;<span class="ident" id="7901114">err</span>&nbsp;<span class="op" id="7901118">:=</span>&nbsp;<span class="ident" id="7901121">ResolveIPAddr</span><span class="op" id="7901134">(</span><span class="ident" id="7901135">tt</span><span class="op" id="7901137">.</span><span class="ident" id="7901138">net</span><span class="op" id="7901141">,</span>&nbsp;<span class="ident" id="7901143">tt</span><span class="op" id="7901145">.</span><span class="ident" id="7901146">litAddrOrName</span><span class="op" id="7901159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901163">if</span>&nbsp;<span class="ident" id="7901166">err</span>&nbsp;<span class="op" id="7901170">!=</span>&nbsp;<span class="ident" id="7901173">tt</span><span class="op" id="7901175">.</span><span class="ident" id="7901176">err</span>&nbsp;<span class="op" id="7901180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901185">t</span><span class="op" id="7901186">.</span><span class="ident" id="7901187">Fatalf</span><span class="op" id="7901193">(</span><span class="string" id="7901194">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7901228">,</span>&nbsp;<span class="ident" id="7901230">tt</span><span class="op" id="7901232">.</span><span class="ident" id="7901233">net</span><span class="op" id="7901236">,</span>&nbsp;<span class="ident" id="7901238">tt</span><span class="op" id="7901240">.</span><span class="ident" id="7901241">litAddrOrName</span><span class="op" id="7901254">,</span>&nbsp;<span class="ident" id="7901256">err</span><span class="op" id="7901259">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901263">}</span>&nbsp;<span class="keyword" id="7901265">else</span>&nbsp;<span class="keyword" id="7901270">if</span>&nbsp;<span class="op" id="7901273">!</span><span class="ident" id="7901274">reflect</span><span class="op" id="7901281">.</span><span class="ident" id="7901282">DeepEqual</span><span class="op" id="7901291">(</span><span class="ident" id="7901292">addr</span><span class="op" id="7901296">,</span>&nbsp;<span class="ident" id="7901298">tt</span><span class="op" id="7901300">.</span><span class="ident" id="7901301">addr</span><span class="op" id="7901305">)</span>&nbsp;<span class="op" id="7901307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901312">t</span><span class="op" id="7901313">.</span><span class="ident" id="7901314">Fatalf</span><span class="op" id="7901320">(</span><span class="string" id="7901321">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7901344">,</span>&nbsp;<span class="ident" id="7901346">addr</span><span class="op" id="7901350">,</span>&nbsp;<span class="ident" id="7901352">tt</span><span class="op" id="7901354">.</span><span class="ident" id="7901355">addr</span><span class="op" id="7901359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901366">}</span><br>
<span class="lineno"></span><span class="op" id="7901368">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7901371">var</span>&nbsp;<span class="ident" id="7901375">icmpEchoTests</span>&nbsp;<span class="op" id="7901389">=</span>&nbsp;<span class="op" id="7901391">[</span><span class="op" id="7901392">]</span><span class="keyword" id="7901393">struct</span>&nbsp;<span class="op" id="7901400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901403">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7901409">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901417">laddr</span>&nbsp;<span class="builtintype" id="7901423">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901431">raddr</span>&nbsp;<span class="builtintype" id="7901437">string</span><br>
<span class="lineno">90</span><span class="op" id="7901444">}</span><span class="op" id="7901445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901448">{</span><span class="string" id="7901449">&#34;ip4:icmp&#34;</span><span class="op" id="7901459">,</span>&nbsp;<span class="string" id="7901461">&#34;0.0.0.0&#34;</span><span class="op" id="7901470">,</span>&nbsp;<span class="string" id="7901472">&#34;127.0.0.1&#34;</span><span class="op" id="7901483">}</span><span class="op" id="7901484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901487">{</span><span class="string" id="7901488">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7901503">,</span>&nbsp;<span class="string" id="7901505">&#34;::&#34;</span><span class="op" id="7901509">,</span>&nbsp;<span class="string" id="7901511">&#34;::1&#34;</span><span class="op" id="7901516">}</span><span class="op" id="7901517">,</span><br>
<span class="lineno"></span><span class="op" id="7901519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7901522">func</span>&nbsp;<span class="ident" id="7901527">TestConnICMPEcho</span><span class="op" id="7901543">(</span><span class="ident" id="7901544">t</span>&nbsp;<span class="op" id="7901546">*</span><span class="ident" id="7901547">testing</span><span class="op" id="7901554">.</span><span class="ident" id="7901555">T</span><span class="op" id="7901556">)</span>&nbsp;<span class="op" id="7901558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901561">if</span>&nbsp;<span class="ident" id="7901564">skip</span><span class="op" id="7901568">,</span>&nbsp;<span class="ident" id="7901570">skipmsg</span>&nbsp;<span class="op" id="7901578">:=</span>&nbsp;<span class="ident" id="7901581">skipRawSocketTest</span><span class="op" id="7901598">(</span><span class="ident" id="7901599">t</span><span class="op" id="7901600">)</span><span class="op" id="7901601">;</span>&nbsp;<span class="ident" id="7901603">skip</span>&nbsp;<span class="op" id="7901608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901612">t</span><span class="op" id="7901613">.</span><span class="ident" id="7901614">Skip</span><span class="op" id="7901618">(</span><span class="ident" id="7901619">skipmsg</span><span class="op" id="7901626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901633">for</span>&nbsp;<span class="ident" id="7901637">i</span><span class="op" id="7901638">,</span>&nbsp;<span class="ident" id="7901640">tt</span>&nbsp;<span class="op" id="7901643">:=</span>&nbsp;<span class="keyword" id="7901646">range</span>&nbsp;<span class="ident" id="7901652">icmpEchoTests</span>&nbsp;<span class="op" id="7901666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901670">net</span><span class="op" id="7901673">,</span>&nbsp;<span class="ident" id="7901675">_</span><span class="op" id="7901676">,</span>&nbsp;<span class="ident" id="7901678">err</span>&nbsp;<span class="op" id="7901682">:=</span>&nbsp;<span class="ident" id="7901685">parseNetwork</span><span class="op" id="7901697">(</span><span class="ident" id="7901698">tt</span><span class="op" id="7901700">.</span><span class="ident" id="7901701">net</span><span class="op" id="7901704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901708">if</span>&nbsp;<span class="ident" id="7901711">err</span>&nbsp;<span class="op" id="7901715">!=</span>&nbsp;<span class="ident" id="7901718">nil</span>&nbsp;<span class="op" id="7901722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901727">t</span><span class="op" id="7901728">.</span><span class="ident" id="7901729">Fatalf</span><span class="op" id="7901735">(</span><span class="string" id="7901736">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7901761">,</span>&nbsp;<span class="ident" id="7901763">err</span><span class="op" id="7901766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901770">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901774">if</span>&nbsp;<span class="ident" id="7901777">net</span>&nbsp;<span class="op" id="7901781">==</span>&nbsp;<span class="string" id="7901784">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7901790">&amp;&amp;</span>&nbsp;<span class="op" id="7901793">!</span><span class="ident" id="7901794">supportsIPv6</span>&nbsp;<span class="op" id="7901807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901812">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901828">c</span><span class="op" id="7901829">,</span>&nbsp;<span class="ident" id="7901831">err</span>&nbsp;<span class="op" id="7901835">:=</span>&nbsp;<span class="ident" id="7901838">Dial</span><span class="op" id="7901842">(</span><span class="ident" id="7901843">tt</span><span class="op" id="7901845">.</span><span class="ident" id="7901846">net</span><span class="op" id="7901849">,</span>&nbsp;<span class="ident" id="7901851">tt</span><span class="op" id="7901853">.</span><span class="ident" id="7901854">raddr</span><span class="op" id="7901859">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901863">if</span>&nbsp;<span class="ident" id="7901866">err</span>&nbsp;<span class="op" id="7901870">!=</span>&nbsp;<span class="ident" id="7901873">nil</span>&nbsp;<span class="op" id="7901877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901882">t</span><span class="op" id="7901883">.</span><span class="ident" id="7901884">Fatalf</span><span class="op" id="7901890">(</span><span class="string" id="7901891">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7901908">,</span>&nbsp;<span class="ident" id="7901910">err</span><span class="op" id="7901913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901921">c</span><span class="op" id="7901922">.</span><span class="ident" id="7901923">SetDeadline</span><span class="op" id="7901934">(</span><span class="ident" id="7901935">time</span><span class="op" id="7901939">.</span><span class="ident" id="7901940">Now</span><span class="op" id="7901943">(</span><span class="op" id="7901944">)</span><span class="op" id="7901945">.</span><span class="ident" id="7901946">Add</span><span class="op" id="7901949">(</span><span class="num" id="7901950">100</span>&nbsp;<span class="op" id="7901954">*</span>&nbsp;<span class="ident" id="7901956">time</span><span class="op" id="7901960">.</span><span class="ident" id="7901961">Millisecond</span><span class="op" id="7901972">)</span><span class="op" id="7901973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901977">defer</span>&nbsp;<span class="ident" id="7901983">c</span><span class="op" id="7901984">.</span><span class="ident" id="7901985">Close</span><span class="op" id="7901990">(</span><span class="op" id="7901991">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901996">typ</span>&nbsp;<span class="op" id="7902000">:=</span>&nbsp;<span class="ident" id="7902003">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902023">if</span>&nbsp;<span class="ident" id="7902026">net</span>&nbsp;<span class="op" id="7902030">==</span>&nbsp;<span class="string" id="7902033">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7902039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902044">typ</span>&nbsp;<span class="op" id="7902048">=</span>&nbsp;<span class="ident" id="7902050">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902070">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902074">xid</span><span class="op" id="7902077">,</span>&nbsp;<span class="ident" id="7902079">xseq</span>&nbsp;<span class="op" id="7902084">:=</span>&nbsp;<span class="ident" id="7902087">os</span><span class="op" id="7902089">.</span><span class="ident" id="7902090">Getpid</span><span class="op" id="7902096">(</span><span class="op" id="7902097">)</span><span class="op" id="7902098">&amp;</span><span class="num" id="7902099">0xffff</span><span class="op" id="7902105">,</span>&nbsp;<span class="ident" id="7902107">i</span><span class="op" id="7902108">+</span><span class="num" id="7902109">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902113">wb</span><span class="op" id="7902115">,</span>&nbsp;<span class="ident" id="7902117">err</span>&nbsp;<span class="op" id="7902121">:=</span>&nbsp;<span class="op" id="7902124">(</span><span class="op" id="7902125">&amp;</span><span class="ident" id="7902126">icmpMessage</span><span class="op" id="7902137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902142">Type</span><span class="op" id="7902146">:</span>&nbsp;<span class="ident" id="7902148">typ</span><span class="op" id="7902151">,</span>&nbsp;<span class="ident" id="7902153">Code</span><span class="op" id="7902157">:</span>&nbsp;<span class="num" id="7902159">0</span><span class="op" id="7902160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902165">Body</span><span class="op" id="7902169">:</span>&nbsp;<span class="op" id="7902171">&amp;</span><span class="ident" id="7902172">icmpEcho</span><span class="op" id="7902180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902186">ID</span><span class="op" id="7902188">:</span>&nbsp;<span class="ident" id="7902190">xid</span><span class="op" id="7902193">,</span>&nbsp;<span class="ident" id="7902195">Seq</span><span class="op" id="7902198">:</span>&nbsp;<span class="ident" id="7902200">xseq</span><span class="op" id="7902204">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902210">Data</span><span class="op" id="7902214">:</span>&nbsp;<span class="ident" id="7902216">bytes</span><span class="op" id="7902221">.</span><span class="ident" id="7902222">Repeat</span><span class="op" id="7902228">(</span><span class="op" id="7902229">[</span><span class="op" id="7902230">]</span><span class="builtintype" id="7902231">byte</span><span class="op" id="7902235">(</span><span class="string" id="7902236">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7902258">)</span><span class="op" id="7902259">,</span>&nbsp;<span class="num" id="7902261">3</span><span class="op" id="7902262">)</span><span class="op" id="7902263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902268">}</span><span class="op" id="7902269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902273">}</span><span class="op" id="7902274">)</span><span class="op" id="7902275">.</span><span class="ident" id="7902276">Marshal</span><span class="op" id="7902283">(</span><span class="op" id="7902284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902288">if</span>&nbsp;<span class="ident" id="7902291">err</span>&nbsp;<span class="op" id="7902295">!=</span>&nbsp;<span class="ident" id="7902298">nil</span>&nbsp;<span class="op" id="7902302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902307">t</span><span class="op" id="7902308">.</span><span class="ident" id="7902309">Fatalf</span><span class="op" id="7902315">(</span><span class="string" id="7902316">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7902348">,</span>&nbsp;<span class="ident" id="7902350">err</span><span class="op" id="7902353">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902361">if</span>&nbsp;<span class="ident" id="7902364">_</span><span class="op" id="7902365">,</span>&nbsp;<span class="ident" id="7902367">err</span>&nbsp;<span class="op" id="7902371">:=</span>&nbsp;<span class="ident" id="7902374">c</span><span class="op" id="7902375">.</span><span class="ident" id="7902376">Write</span><span class="op" id="7902381">(</span><span class="ident" id="7902382">wb</span><span class="op" id="7902384">)</span><span class="op" id="7902385">;</span>&nbsp;<span class="ident" id="7902387">err</span>&nbsp;<span class="op" id="7902391">!=</span>&nbsp;<span class="ident" id="7902394">nil</span>&nbsp;<span class="op" id="7902398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902403">t</span><span class="op" id="7902404">.</span><span class="ident" id="7902405">Fatalf</span><span class="op" id="7902411">(</span><span class="string" id="7902412">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7902435">,</span>&nbsp;<span class="ident" id="7902437">err</span><span class="op" id="7902440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902448">var</span>&nbsp;<span class="ident" id="7902452">m</span>&nbsp;<span class="op" id="7902454">*</span><span class="ident" id="7902455">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902469">rb</span>&nbsp;<span class="op" id="7902472">:=</span>&nbsp;<span class="builtinfunc" id="7902475">make</span><span class="op" id="7902479">(</span><span class="op" id="7902480">[</span><span class="op" id="7902481">]</span><span class="builtintype" id="7902482">byte</span><span class="op" id="7902486">,</span>&nbsp;<span class="num" id="7902488">20</span><span class="op" id="7902490">+</span><span class="builtinfunc" id="7902491">len</span><span class="op" id="7902494">(</span><span class="ident" id="7902495">wb</span><span class="op" id="7902497">)</span><span class="op" id="7902498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902502">for</span>&nbsp;<span class="op" id="7902506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902511">if</span>&nbsp;<span class="ident" id="7902514">_</span><span class="op" id="7902515">,</span>&nbsp;<span class="ident" id="7902517">err</span>&nbsp;<span class="op" id="7902521">:=</span>&nbsp;<span class="ident" id="7902524">c</span><span class="op" id="7902525">.</span><span class="ident" id="7902526">Read</span><span class="op" id="7902530">(</span><span class="ident" id="7902531">rb</span><span class="op" id="7902533">)</span><span class="op" id="7902534">;</span>&nbsp;<span class="ident" id="7902536">err</span>&nbsp;<span class="op" id="7902540">!=</span>&nbsp;<span class="ident" id="7902543">nil</span>&nbsp;<span class="op" id="7902547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902553">t</span><span class="op" id="7902554">.</span><span class="ident" id="7902555">Fatalf</span><span class="op" id="7902561">(</span><span class="string" id="7902562">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7902584">,</span>&nbsp;<span class="ident" id="7902586">err</span><span class="op" id="7902589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902594">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902599">if</span>&nbsp;<span class="ident" id="7902602">net</span>&nbsp;<span class="op" id="7902606">==</span>&nbsp;<span class="string" id="7902609">&#34;ip4&#34;</span>&nbsp;<span class="op" id="7902615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902621">rb</span>&nbsp;<span class="op" id="7902624">=</span>&nbsp;<span class="ident" id="7902626">ipv4Payload</span><span class="op" id="7902637">(</span><span class="ident" id="7902638">rb</span><span class="op" id="7902640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902650">if</span>&nbsp;<span class="ident" id="7902653">m</span><span class="op" id="7902654">,</span>&nbsp;<span class="ident" id="7902656">err</span>&nbsp;<span class="op" id="7902660">=</span>&nbsp;<span class="ident" id="7902662">parseICMPMessage</span><span class="op" id="7902678">(</span><span class="ident" id="7902679">rb</span><span class="op" id="7902681">)</span><span class="op" id="7902682">;</span>&nbsp;<span class="ident" id="7902684">err</span>&nbsp;<span class="op" id="7902688">!=</span>&nbsp;<span class="ident" id="7902691">nil</span>&nbsp;<span class="op" id="7902695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902701">t</span><span class="op" id="7902702">.</span><span class="ident" id="7902703">Fatalf</span><span class="op" id="7902709">(</span><span class="string" id="7902710">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7902739">,</span>&nbsp;<span class="ident" id="7902741">err</span><span class="op" id="7902744">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902754">switch</span>&nbsp;<span class="ident" id="7902761">m</span><span class="op" id="7902762">.</span><span class="ident" id="7902763">Type</span>&nbsp;<span class="op" id="7902768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902773">case</span>&nbsp;<span class="ident" id="7902778">icmpv4EchoRequest</span><span class="op" id="7902795">,</span>&nbsp;<span class="ident" id="7902797">icmpv6EchoRequest</span><span class="op" id="7902814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902820">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902832">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902837">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902849">switch</span>&nbsp;<span class="ident" id="7902856">p</span>&nbsp;<span class="op" id="7902858">:=</span>&nbsp;<span class="ident" id="7902861">m</span><span class="op" id="7902862">.</span><span class="ident" id="7902863">Body</span><span class="op" id="7902867">.</span><span class="op" id="7902868">(</span><span class="keyword" id="7902869">type</span><span class="op" id="7902873">)</span>&nbsp;<span class="op" id="7902875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902879">case</span>&nbsp;<span class="op" id="7902884">*</span><span class="ident" id="7902885">icmpEcho</span><span class="op" id="7902893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902898">if</span>&nbsp;<span class="ident" id="7902901">p</span><span class="op" id="7902902">.</span><span class="ident" id="7902903">ID</span>&nbsp;<span class="op" id="7902906">!=</span>&nbsp;<span class="ident" id="7902909">xid</span>&nbsp;<span class="op" id="7902913">||</span>&nbsp;<span class="ident" id="7902916">p</span><span class="op" id="7902917">.</span><span class="ident" id="7902918">Seq</span>&nbsp;<span class="op" id="7902922">!=</span>&nbsp;<span class="ident" id="7902925">xseq</span>&nbsp;<span class="op" id="7902930">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902936">t</span><span class="op" id="7902937">.</span><span class="ident" id="7902938">Fatalf</span><span class="op" id="7902944">(</span><span class="string" id="7902945">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7902994">,</span>&nbsp;<span class="ident" id="7902996">p</span><span class="op" id="7902997">.</span><span class="ident" id="7902998">ID</span><span class="op" id="7903000">,</span>&nbsp;<span class="ident" id="7903002">p</span><span class="op" id="7903003">.</span><span class="ident" id="7903004">Seq</span><span class="op" id="7903007">,</span>&nbsp;<span class="ident" id="7903009">xid</span><span class="op" id="7903012">,</span>&nbsp;<span class="ident" id="7903014">xseq</span><span class="op" id="7903018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903027">default</span><span class="op" id="7903034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903039">t</span><span class="op" id="7903040">.</span><span class="ident" id="7903041">Fatalf</span><span class="op" id="7903047">(</span><span class="string" id="7903048">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7903097">,</span>&nbsp;<span class="ident" id="7903099">m</span><span class="op" id="7903100">.</span><span class="ident" id="7903101">Type</span><span class="op" id="7903105">,</span>&nbsp;<span class="ident" id="7903107">m</span><span class="op" id="7903108">.</span><span class="ident" id="7903109">Code</span><span class="op" id="7903113">,</span>&nbsp;<span class="ident" id="7903115">typ</span><span class="op" id="7903118">,</span>&nbsp;<span class="num" id="7903120">0</span><span class="op" id="7903121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903125">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903128">}</span><br>
<span class="lineno"></span><span class="op" id="7903130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7903133">func</span>&nbsp;<span class="ident" id="7903138">TestPacketConnICMPEcho</span><span class="op" id="7903160">(</span><span class="ident" id="7903161">t</span>&nbsp;<span class="op" id="7903163">*</span><span class="ident" id="7903164">testing</span><span class="op" id="7903171">.</span><span class="ident" id="7903172">T</span><span class="op" id="7903173">)</span>&nbsp;<span class="op" id="7903175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903178">if</span>&nbsp;<span class="ident" id="7903181">skip</span><span class="op" id="7903185">,</span>&nbsp;<span class="ident" id="7903187">skipmsg</span>&nbsp;<span class="op" id="7903195">:=</span>&nbsp;<span class="ident" id="7903198">skipRawSocketTest</span><span class="op" id="7903215">(</span><span class="ident" id="7903216">t</span><span class="op" id="7903217">)</span><span class="op" id="7903218">;</span>&nbsp;<span class="ident" id="7903220">skip</span>&nbsp;<span class="op" id="7903225">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903229">t</span><span class="op" id="7903230">.</span><span class="ident" id="7903231">Skip</span><span class="op" id="7903235">(</span><span class="ident" id="7903236">skipmsg</span><span class="op" id="7903243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903250">for</span>&nbsp;<span class="ident" id="7903254">i</span><span class="op" id="7903255">,</span>&nbsp;<span class="ident" id="7903257">tt</span>&nbsp;<span class="op" id="7903260">:=</span>&nbsp;<span class="keyword" id="7903263">range</span>&nbsp;<span class="ident" id="7903269">icmpEchoTests</span>&nbsp;<span class="op" id="7903283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903287">net</span><span class="op" id="7903290">,</span>&nbsp;<span class="ident" id="7903292">_</span><span class="op" id="7903293">,</span>&nbsp;<span class="ident" id="7903295">err</span>&nbsp;<span class="op" id="7903299">:=</span>&nbsp;<span class="ident" id="7903302">parseNetwork</span><span class="op" id="7903314">(</span><span class="ident" id="7903315">tt</span><span class="op" id="7903317">.</span><span class="ident" id="7903318">net</span><span class="op" id="7903321">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903325">if</span>&nbsp;<span class="ident" id="7903328">err</span>&nbsp;<span class="op" id="7903332">!=</span>&nbsp;<span class="ident" id="7903335">nil</span>&nbsp;<span class="op" id="7903339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903344">t</span><span class="op" id="7903345">.</span><span class="ident" id="7903346">Fatalf</span><span class="op" id="7903352">(</span><span class="string" id="7903353">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7903378">,</span>&nbsp;<span class="ident" id="7903380">err</span><span class="op" id="7903383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903391">if</span>&nbsp;<span class="ident" id="7903394">net</span>&nbsp;<span class="op" id="7903398">==</span>&nbsp;<span class="string" id="7903401">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7903407">&amp;&amp;</span>&nbsp;<span class="op" id="7903410">!</span><span class="ident" id="7903411">supportsIPv6</span>&nbsp;<span class="op" id="7903424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903429">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903445">c</span><span class="op" id="7903446">,</span>&nbsp;<span class="ident" id="7903448">err</span>&nbsp;<span class="op" id="7903452">:=</span>&nbsp;<span class="ident" id="7903455">ListenPacket</span><span class="op" id="7903467">(</span><span class="ident" id="7903468">tt</span><span class="op" id="7903470">.</span><span class="ident" id="7903471">net</span><span class="op" id="7903474">,</span>&nbsp;<span class="ident" id="7903476">tt</span><span class="op" id="7903478">.</span><span class="ident" id="7903479">laddr</span><span class="op" id="7903484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903488">if</span>&nbsp;<span class="ident" id="7903491">err</span>&nbsp;<span class="op" id="7903495">!=</span>&nbsp;<span class="ident" id="7903498">nil</span>&nbsp;<span class="op" id="7903502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903507">t</span><span class="op" id="7903508">.</span><span class="ident" id="7903509">Fatalf</span><span class="op" id="7903515">(</span><span class="string" id="7903516">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7903541">,</span>&nbsp;<span class="ident" id="7903543">err</span><span class="op" id="7903546">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903554">c</span><span class="op" id="7903555">.</span><span class="ident" id="7903556">SetDeadline</span><span class="op" id="7903567">(</span><span class="ident" id="7903568">time</span><span class="op" id="7903572">.</span><span class="ident" id="7903573">Now</span><span class="op" id="7903576">(</span><span class="op" id="7903577">)</span><span class="op" id="7903578">.</span><span class="ident" id="7903579">Add</span><span class="op" id="7903582">(</span><span class="num" id="7903583">100</span>&nbsp;<span class="op" id="7903587">*</span>&nbsp;<span class="ident" id="7903589">time</span><span class="op" id="7903593">.</span><span class="ident" id="7903594">Millisecond</span><span class="op" id="7903605">)</span><span class="op" id="7903606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903610">defer</span>&nbsp;<span class="ident" id="7903616">c</span><span class="op" id="7903617">.</span><span class="ident" id="7903618">Close</span><span class="op" id="7903623">(</span><span class="op" id="7903624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903629">ra</span><span class="op" id="7903631">,</span>&nbsp;<span class="ident" id="7903633">err</span>&nbsp;<span class="op" id="7903637">:=</span>&nbsp;<span class="ident" id="7903640">ResolveIPAddr</span><span class="op" id="7903653">(</span><span class="ident" id="7903654">tt</span><span class="op" id="7903656">.</span><span class="ident" id="7903657">net</span><span class="op" id="7903660">,</span>&nbsp;<span class="ident" id="7903662">tt</span><span class="op" id="7903664">.</span><span class="ident" id="7903665">raddr</span><span class="op" id="7903670">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903674">if</span>&nbsp;<span class="ident" id="7903677">err</span>&nbsp;<span class="op" id="7903681">!=</span>&nbsp;<span class="ident" id="7903684">nil</span>&nbsp;<span class="op" id="7903688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903693">t</span><span class="op" id="7903694">.</span><span class="ident" id="7903695">Fatalf</span><span class="op" id="7903701">(</span><span class="string" id="7903702">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7903728">,</span>&nbsp;<span class="ident" id="7903730">err</span><span class="op" id="7903733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903741">typ</span>&nbsp;<span class="op" id="7903745">:=</span>&nbsp;<span class="ident" id="7903748">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903768">if</span>&nbsp;<span class="ident" id="7903771">net</span>&nbsp;<span class="op" id="7903775">==</span>&nbsp;<span class="string" id="7903778">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7903784">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903789">typ</span>&nbsp;<span class="op" id="7903793">=</span>&nbsp;<span class="ident" id="7903795">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903819">xid</span><span class="op" id="7903822">,</span>&nbsp;<span class="ident" id="7903824">xseq</span>&nbsp;<span class="op" id="7903829">:=</span>&nbsp;<span class="ident" id="7903832">os</span><span class="op" id="7903834">.</span><span class="ident" id="7903835">Getpid</span><span class="op" id="7903841">(</span><span class="op" id="7903842">)</span><span class="op" id="7903843">&amp;</span><span class="num" id="7903844">0xffff</span><span class="op" id="7903850">,</span>&nbsp;<span class="ident" id="7903852">i</span><span class="op" id="7903853">+</span><span class="num" id="7903854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903858">wb</span><span class="op" id="7903860">,</span>&nbsp;<span class="ident" id="7903862">err</span>&nbsp;<span class="op" id="7903866">:=</span>&nbsp;<span class="op" id="7903869">(</span><span class="op" id="7903870">&amp;</span><span class="ident" id="7903871">icmpMessage</span><span class="op" id="7903882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903887">Type</span><span class="op" id="7903891">:</span>&nbsp;<span class="ident" id="7903893">typ</span><span class="op" id="7903896">,</span>&nbsp;<span class="ident" id="7903898">Code</span><span class="op" id="7903902">:</span>&nbsp;<span class="num" id="7903904">0</span><span class="op" id="7903905">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903910">Body</span><span class="op" id="7903914">:</span>&nbsp;<span class="op" id="7903916">&amp;</span><span class="ident" id="7903917">icmpEcho</span><span class="op" id="7903925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903931">ID</span><span class="op" id="7903933">:</span>&nbsp;<span class="ident" id="7903935">xid</span><span class="op" id="7903938">,</span>&nbsp;<span class="ident" id="7903940">Seq</span><span class="op" id="7903943">:</span>&nbsp;<span class="ident" id="7903945">xseq</span><span class="op" id="7903949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903955">Data</span><span class="op" id="7903959">:</span>&nbsp;<span class="ident" id="7903961">bytes</span><span class="op" id="7903966">.</span><span class="ident" id="7903967">Repeat</span><span class="op" id="7903973">(</span><span class="op" id="7903974">[</span><span class="op" id="7903975">]</span><span class="builtintype" id="7903976">byte</span><span class="op" id="7903980">(</span><span class="string" id="7903981">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7904003">)</span><span class="op" id="7904004">,</span>&nbsp;<span class="num" id="7904006">3</span><span class="op" id="7904007">)</span><span class="op" id="7904008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904013">}</span><span class="op" id="7904014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904018">}</span><span class="op" id="7904019">)</span><span class="op" id="7904020">.</span><span class="ident" id="7904021">Marshal</span><span class="op" id="7904028">(</span><span class="op" id="7904029">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904033">if</span>&nbsp;<span class="ident" id="7904036">err</span>&nbsp;<span class="op" id="7904040">!=</span>&nbsp;<span class="ident" id="7904043">nil</span>&nbsp;<span class="op" id="7904047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904052">t</span><span class="op" id="7904053">.</span><span class="ident" id="7904054">Fatalf</span><span class="op" id="7904060">(</span><span class="string" id="7904061">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7904093">,</span>&nbsp;<span class="ident" id="7904095">err</span><span class="op" id="7904098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904106">if</span>&nbsp;<span class="ident" id="7904109">_</span><span class="op" id="7904110">,</span>&nbsp;<span class="ident" id="7904112">err</span>&nbsp;<span class="op" id="7904116">:=</span>&nbsp;<span class="ident" id="7904119">c</span><span class="op" id="7904120">.</span><span class="ident" id="7904121">WriteTo</span><span class="op" id="7904128">(</span><span class="ident" id="7904129">wb</span><span class="op" id="7904131">,</span>&nbsp;<span class="ident" id="7904133">ra</span><span class="op" id="7904135">)</span><span class="op" id="7904136">;</span>&nbsp;<span class="ident" id="7904138">err</span>&nbsp;<span class="op" id="7904142">!=</span>&nbsp;<span class="ident" id="7904145">nil</span>&nbsp;<span class="op" id="7904149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904154">t</span><span class="op" id="7904155">.</span><span class="ident" id="7904156">Fatalf</span><span class="op" id="7904162">(</span><span class="string" id="7904163">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7904194">,</span>&nbsp;<span class="ident" id="7904196">err</span><span class="op" id="7904199">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904207">var</span>&nbsp;<span class="ident" id="7904211">m</span>&nbsp;<span class="op" id="7904213">*</span><span class="ident" id="7904214">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904228">rb</span>&nbsp;<span class="op" id="7904231">:=</span>&nbsp;<span class="builtinfunc" id="7904234">make</span><span class="op" id="7904238">(</span><span class="op" id="7904239">[</span><span class="op" id="7904240">]</span><span class="builtintype" id="7904241">byte</span><span class="op" id="7904245">,</span>&nbsp;<span class="num" id="7904247">20</span><span class="op" id="7904249">+</span><span class="builtinfunc" id="7904250">len</span><span class="op" id="7904253">(</span><span class="ident" id="7904254">wb</span><span class="op" id="7904256">)</span><span class="op" id="7904257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904261">for</span>&nbsp;<span class="op" id="7904265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904270">if</span>&nbsp;<span class="ident" id="7904273">_</span><span class="op" id="7904274">,</span>&nbsp;<span class="ident" id="7904276">_</span><span class="op" id="7904277">,</span>&nbsp;<span class="ident" id="7904279">err</span>&nbsp;<span class="op" id="7904283">:=</span>&nbsp;<span class="ident" id="7904286">c</span><span class="op" id="7904287">.</span><span class="ident" id="7904288">ReadFrom</span><span class="op" id="7904296">(</span><span class="ident" id="7904297">rb</span><span class="op" id="7904299">)</span><span class="op" id="7904300">;</span>&nbsp;<span class="ident" id="7904302">err</span>&nbsp;<span class="op" id="7904306">!=</span>&nbsp;<span class="ident" id="7904309">nil</span>&nbsp;<span class="op" id="7904313">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904319">t</span><span class="op" id="7904320">.</span><span class="ident" id="7904321">Fatalf</span><span class="op" id="7904327">(</span><span class="string" id="7904328">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7904360">,</span>&nbsp;<span class="ident" id="7904362">err</span><span class="op" id="7904365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7904375">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7904398">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7904421">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7904448">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904455">if</span>&nbsp;<span class="ident" id="7904458">m</span><span class="op" id="7904459">,</span>&nbsp;<span class="ident" id="7904461">err</span>&nbsp;<span class="op" id="7904465">=</span>&nbsp;<span class="ident" id="7904467">parseICMPMessage</span><span class="op" id="7904483">(</span><span class="ident" id="7904484">rb</span><span class="op" id="7904486">)</span><span class="op" id="7904487">;</span>&nbsp;<span class="ident" id="7904489">err</span>&nbsp;<span class="op" id="7904493">!=</span>&nbsp;<span class="ident" id="7904496">nil</span>&nbsp;<span class="op" id="7904500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904506">t</span><span class="op" id="7904507">.</span><span class="ident" id="7904508">Fatalf</span><span class="op" id="7904514">(</span><span class="string" id="7904515">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7904544">,</span>&nbsp;<span class="ident" id="7904546">err</span><span class="op" id="7904549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904559">switch</span>&nbsp;<span class="ident" id="7904566">m</span><span class="op" id="7904567">.</span><span class="ident" id="7904568">Type</span>&nbsp;<span class="op" id="7904573">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904578">case</span>&nbsp;<span class="ident" id="7904583">icmpv4EchoRequest</span><span class="op" id="7904600">,</span>&nbsp;<span class="ident" id="7904602">icmpv6EchoRequest</span><span class="op" id="7904619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904625">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904642">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904650">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904654">switch</span>&nbsp;<span class="ident" id="7904661">p</span>&nbsp;<span class="op" id="7904663">:=</span>&nbsp;<span class="ident" id="7904666">m</span><span class="op" id="7904667">.</span><span class="ident" id="7904668">Body</span><span class="op" id="7904672">.</span><span class="op" id="7904673">(</span><span class="keyword" id="7904674">type</span><span class="op" id="7904678">)</span>&nbsp;<span class="op" id="7904680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904684">case</span>&nbsp;<span class="op" id="7904689">*</span><span class="ident" id="7904690">icmpEcho</span><span class="op" id="7904698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904703">if</span>&nbsp;<span class="ident" id="7904706">p</span><span class="op" id="7904707">.</span><span class="ident" id="7904708">ID</span>&nbsp;<span class="op" id="7904711">!=</span>&nbsp;<span class="ident" id="7904714">xid</span>&nbsp;<span class="op" id="7904718">||</span>&nbsp;<span class="ident" id="7904721">p</span><span class="op" id="7904722">.</span><span class="ident" id="7904723">Seq</span>&nbsp;<span class="op" id="7904727">!=</span>&nbsp;<span class="ident" id="7904730">xseq</span>&nbsp;<span class="op" id="7904735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904741">t</span><span class="op" id="7904742">.</span><span class="ident" id="7904743">Fatalf</span><span class="op" id="7904749">(</span><span class="string" id="7904750">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7904799">,</span>&nbsp;<span class="ident" id="7904801">p</span><span class="op" id="7904802">.</span><span class="ident" id="7904803">ID</span><span class="op" id="7904805">,</span>&nbsp;<span class="ident" id="7904807">p</span><span class="op" id="7904808">.</span><span class="ident" id="7904809">Seq</span><span class="op" id="7904812">,</span>&nbsp;<span class="ident" id="7904814">xid</span><span class="op" id="7904817">,</span>&nbsp;<span class="ident" id="7904819">xseq</span><span class="op" id="7904823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904828">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904832">default</span><span class="op" id="7904839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904844">t</span><span class="op" id="7904845">.</span><span class="ident" id="7904846">Fatalf</span><span class="op" id="7904852">(</span><span class="string" id="7904853">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7904902">,</span>&nbsp;<span class="ident" id="7904904">m</span><span class="op" id="7904905">.</span><span class="ident" id="7904906">Type</span><span class="op" id="7904910">,</span>&nbsp;<span class="ident" id="7904912">m</span><span class="op" id="7904913">.</span><span class="ident" id="7904914">Code</span><span class="op" id="7904918">,</span>&nbsp;<span class="ident" id="7904920">typ</span><span class="op" id="7904923">,</span>&nbsp;<span class="num" id="7904925">0</span><span class="op" id="7904926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904933">}</span><br>
<span class="lineno"></span><span class="op" id="7904935">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="7904938">func</span>&nbsp;<span class="ident" id="7904943">ipv4Payload</span><span class="op" id="7904954">(</span><span class="ident" id="7904955">b</span>&nbsp;<span class="op" id="7904957">[</span><span class="op" id="7904958">]</span><span class="builtintype" id="7904959">byte</span><span class="op" id="7904963">)</span>&nbsp;<span class="op" id="7904965">[</span><span class="op" id="7904966">]</span><span class="builtintype" id="7904967">byte</span>&nbsp;<span class="op" id="7904972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904975">if</span>&nbsp;<span class="builtinfunc" id="7904978">len</span><span class="op" id="7904981">(</span><span class="ident" id="7904982">b</span><span class="op" id="7904983">)</span>&nbsp;<span class="op" id="7904985">&lt;</span>&nbsp;<span class="num" id="7904987">20</span>&nbsp;<span class="op" id="7904990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904994">return</span>&nbsp;<span class="ident" id="7905001">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905004">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905007">hdrlen</span>&nbsp;<span class="op" id="7905014">:=</span>&nbsp;<span class="builtintype" id="7905017">int</span><span class="op" id="7905020">(</span><span class="ident" id="7905021">b</span><span class="op" id="7905022">[</span><span class="num" id="7905023">0</span><span class="op" id="7905024">]</span><span class="op" id="7905025">&amp;</span><span class="num" id="7905026">0x0f</span><span class="op" id="7905030">)</span>&nbsp;<span class="op" id="7905032">&lt;&lt;</span>&nbsp;<span class="num" id="7905035">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905038">return</span>&nbsp;<span class="ident" id="7905045">b</span><span class="op" id="7905046">[</span><span class="ident" id="7905047">hdrlen</span><span class="op" id="7905053">:</span><span class="op" id="7905054">]</span><br>
<span class="lineno"></span><span class="op" id="7905056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7905059">var</span>&nbsp;<span class="ident" id="7905063">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7905084">=</span>&nbsp;<span class="op" id="7905086">[</span><span class="op" id="7905087">]</span><span class="keyword" id="7905088">struct</span>&nbsp;<span class="op" id="7905095">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905098">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7905104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905112">laddr</span>&nbsp;<span class="op" id="7905118">*</span><span class="ident" id="7905119">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="7905126">}</span><span class="op" id="7905127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905130">{</span><span class="string" id="7905131">&#34;ip4:icmp&#34;</span><span class="op" id="7905141">,</span>&nbsp;<span class="op" id="7905143">&amp;</span><span class="ident" id="7905144">IPAddr</span><span class="op" id="7905150">{</span><span class="ident" id="7905151">IP</span><span class="op" id="7905153">:</span>&nbsp;<span class="ident" id="7905155">IPv4</span><span class="op" id="7905159">(</span><span class="num" id="7905160">127</span><span class="op" id="7905163">,</span>&nbsp;<span class="num" id="7905165">0</span><span class="op" id="7905166">,</span>&nbsp;<span class="num" id="7905168">0</span><span class="op" id="7905169">,</span>&nbsp;<span class="num" id="7905171">1</span><span class="op" id="7905172">)</span><span class="op" id="7905173">}</span><span class="op" id="7905174">}</span><span class="op" id="7905175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905178">{</span><span class="string" id="7905179">&#34;ip4:icmp&#34;</span><span class="op" id="7905189">,</span>&nbsp;<span class="op" id="7905191">&amp;</span><span class="ident" id="7905192">IPAddr</span><span class="op" id="7905198">{</span><span class="op" id="7905199">}</span><span class="op" id="7905200">}</span><span class="op" id="7905201">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905204">{</span><span class="string" id="7905205">&#34;ip4:icmp&#34;</span><span class="op" id="7905215">,</span>&nbsp;<span class="ident" id="7905217">nil</span><span class="op" id="7905220">}</span><span class="op" id="7905221">,</span><br>
<span class="lineno"></span><span class="op" id="7905223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7905226">func</span>&nbsp;<span class="ident" id="7905231">TestIPConnLocalName</span><span class="op" id="7905250">(</span><span class="ident" id="7905251">t</span>&nbsp;<span class="op" id="7905253">*</span><span class="ident" id="7905254">testing</span><span class="op" id="7905261">.</span><span class="ident" id="7905262">T</span><span class="op" id="7905263">)</span>&nbsp;<span class="op" id="7905265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905268">switch</span>&nbsp;<span class="ident" id="7905275">runtime</span><span class="op" id="7905282">.</span><span class="ident" id="7905283">GOOS</span>&nbsp;<span class="op" id="7905288">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905291">case</span>&nbsp;<span class="string" id="7905296">&#34;nacl&#34;</span><span class="op" id="7905302">,</span>&nbsp;<span class="string" id="7905304">&#34;plan9&#34;</span><span class="op" id="7905311">,</span>&nbsp;<span class="string" id="7905313">&#34;windows&#34;</span><span class="op" id="7905322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905326">t</span><span class="op" id="7905327">.</span><span class="ident" id="7905328">Skipf</span><span class="op" id="7905333">(</span><span class="string" id="7905334">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7905355">,</span>&nbsp;<span class="ident" id="7905357">runtime</span><span class="op" id="7905364">.</span><span class="ident" id="7905365">GOOS</span><span class="op" id="7905369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905372">default</span><span class="op" id="7905379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905383">if</span>&nbsp;<span class="ident" id="7905386">os</span><span class="op" id="7905388">.</span><span class="ident" id="7905389">Getuid</span><span class="op" id="7905395">(</span><span class="op" id="7905396">)</span>&nbsp;<span class="op" id="7905398">!=</span>&nbsp;<span class="num" id="7905401">0</span>&nbsp;<span class="op" id="7905403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905408">t</span><span class="op" id="7905409">.</span><span class="ident" id="7905410">Skip</span><span class="op" id="7905414">(</span><span class="string" id="7905415">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7905444">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905455">for</span>&nbsp;<span class="ident" id="7905459">_</span><span class="op" id="7905460">,</span>&nbsp;<span class="ident" id="7905462">tt</span>&nbsp;<span class="op" id="7905465">:=</span>&nbsp;<span class="keyword" id="7905468">range</span>&nbsp;<span class="ident" id="7905474">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7905495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905499">c</span><span class="op" id="7905500">,</span>&nbsp;<span class="ident" id="7905502">err</span>&nbsp;<span class="op" id="7905506">:=</span>&nbsp;<span class="ident" id="7905509">ListenIP</span><span class="op" id="7905517">(</span><span class="ident" id="7905518">tt</span><span class="op" id="7905520">.</span><span class="ident" id="7905521">net</span><span class="op" id="7905524">,</span>&nbsp;<span class="ident" id="7905526">tt</span><span class="op" id="7905528">.</span><span class="ident" id="7905529">laddr</span><span class="op" id="7905534">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905538">if</span>&nbsp;<span class="ident" id="7905541">err</span>&nbsp;<span class="op" id="7905545">!=</span>&nbsp;<span class="ident" id="7905548">nil</span>&nbsp;<span class="op" id="7905552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905557">t</span><span class="op" id="7905558">.</span><span class="ident" id="7905559">Fatalf</span><span class="op" id="7905565">(</span><span class="string" id="7905566">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7905587">,</span>&nbsp;<span class="ident" id="7905589">err</span><span class="op" id="7905592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905600">defer</span>&nbsp;<span class="ident" id="7905606">c</span><span class="op" id="7905607">.</span><span class="ident" id="7905608">Close</span><span class="op" id="7905613">(</span><span class="op" id="7905614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905618">if</span>&nbsp;<span class="ident" id="7905621">la</span>&nbsp;<span class="op" id="7905624">:=</span>&nbsp;<span class="ident" id="7905627">c</span><span class="op" id="7905628">.</span><span class="ident" id="7905629">LocalAddr</span><span class="op" id="7905638">(</span><span class="op" id="7905639">)</span><span class="op" id="7905640">;</span>&nbsp;<span class="ident" id="7905642">la</span>&nbsp;<span class="op" id="7905645">==</span>&nbsp;<span class="ident" id="7905648">nil</span>&nbsp;<span class="op" id="7905652">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905657">t</span><span class="op" id="7905658">.</span><span class="ident" id="7905659">Fatal</span><span class="op" id="7905664">(</span><span class="string" id="7905665">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="7905690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905697">}</span><br>
<span class="lineno"></span><span class="op" id="7905699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="7905702">func</span>&nbsp;<span class="ident" id="7905707">TestIPConnRemoteName</span><span class="op" id="7905727">(</span><span class="ident" id="7905728">t</span>&nbsp;<span class="op" id="7905730">*</span><span class="ident" id="7905731">testing</span><span class="op" id="7905738">.</span><span class="ident" id="7905739">T</span><span class="op" id="7905740">)</span>&nbsp;<span class="op" id="7905742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905745">switch</span>&nbsp;<span class="ident" id="7905752">runtime</span><span class="op" id="7905759">.</span><span class="ident" id="7905760">GOOS</span>&nbsp;<span class="op" id="7905765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905768">case</span>&nbsp;<span class="string" id="7905773">&#34;plan9&#34;</span><span class="op" id="7905780">,</span>&nbsp;<span class="string" id="7905782">&#34;windows&#34;</span><span class="op" id="7905791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905795">t</span><span class="op" id="7905796">.</span><span class="ident" id="7905797">Skipf</span><span class="op" id="7905802">(</span><span class="string" id="7905803">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7905824">,</span>&nbsp;<span class="ident" id="7905826">runtime</span><span class="op" id="7905833">.</span><span class="ident" id="7905834">GOOS</span><span class="op" id="7905838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905841">default</span><span class="op" id="7905848">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905852">if</span>&nbsp;<span class="ident" id="7905855">os</span><span class="op" id="7905857">.</span><span class="ident" id="7905858">Getuid</span><span class="op" id="7905864">(</span><span class="op" id="7905865">)</span>&nbsp;<span class="op" id="7905867">!=</span>&nbsp;<span class="num" id="7905870">0</span>&nbsp;<span class="op" id="7905872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905877">t</span><span class="op" id="7905878">.</span><span class="ident" id="7905879">Skip</span><span class="op" id="7905883">(</span><span class="string" id="7905884">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7905913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905924">raddr</span>&nbsp;<span class="op" id="7905930">:=</span>&nbsp;<span class="op" id="7905933">&amp;</span><span class="ident" id="7905934">IPAddr</span><span class="op" id="7905940">{</span><span class="ident" id="7905941">IP</span><span class="op" id="7905943">:</span>&nbsp;<span class="ident" id="7905945">IPv4</span><span class="op" id="7905949">(</span><span class="num" id="7905950">127</span><span class="op" id="7905953">,</span>&nbsp;<span class="num" id="7905955">0</span><span class="op" id="7905956">,</span>&nbsp;<span class="num" id="7905958">0</span><span class="op" id="7905959">,</span>&nbsp;<span class="num" id="7905961">1</span><span class="op" id="7905962">)</span><span class="op" id="7905963">.</span><span class="ident" id="7905964">To4</span><span class="op" id="7905967">(</span><span class="op" id="7905968">)</span><span class="op" id="7905969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905972">c</span><span class="op" id="7905973">,</span>&nbsp;<span class="ident" id="7905975">err</span>&nbsp;<span class="op" id="7905979">:=</span>&nbsp;<span class="ident" id="7905982">DialIP</span><span class="op" id="7905988">(</span><span class="string" id="7905989">&#34;ip:tcp&#34;</span><span class="op" id="7905997">,</span>&nbsp;<span class="op" id="7905999">&amp;</span><span class="ident" id="7906000">IPAddr</span><span class="op" id="7906006">{</span><span class="ident" id="7906007">IP</span><span class="op" id="7906009">:</span>&nbsp;<span class="ident" id="7906011">IPv4</span><span class="op" id="7906015">(</span><span class="num" id="7906016">127</span><span class="op" id="7906019">,</span>&nbsp;<span class="num" id="7906021">0</span><span class="op" id="7906022">,</span>&nbsp;<span class="num" id="7906024">0</span><span class="op" id="7906025">,</span>&nbsp;<span class="num" id="7906027">1</span><span class="op" id="7906028">)</span><span class="op" id="7906029">}</span><span class="op" id="7906030">,</span>&nbsp;<span class="ident" id="7906032">raddr</span><span class="op" id="7906037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906040">if</span>&nbsp;<span class="ident" id="7906043">err</span>&nbsp;<span class="op" id="7906047">!=</span>&nbsp;<span class="ident" id="7906050">nil</span>&nbsp;<span class="op" id="7906054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906058">t</span><span class="op" id="7906059">.</span><span class="ident" id="7906060">Fatalf</span><span class="op" id="7906066">(</span><span class="string" id="7906067">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7906086">,</span>&nbsp;<span class="ident" id="7906088">err</span><span class="op" id="7906091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906094">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906097">defer</span>&nbsp;<span class="ident" id="7906103">c</span><span class="op" id="7906104">.</span><span class="ident" id="7906105">Close</span><span class="op" id="7906110">(</span><span class="op" id="7906111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906114">if</span>&nbsp;<span class="op" id="7906117">!</span><span class="ident" id="7906118">reflect</span><span class="op" id="7906125">.</span><span class="ident" id="7906126">DeepEqual</span><span class="op" id="7906135">(</span><span class="ident" id="7906136">raddr</span><span class="op" id="7906141">,</span>&nbsp;<span class="ident" id="7906143">c</span><span class="op" id="7906144">.</span><span class="ident" id="7906145">RemoteAddr</span><span class="op" id="7906155">(</span><span class="op" id="7906156">)</span><span class="op" id="7906157">)</span>&nbsp;<span class="op" id="7906159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906163">t</span><span class="op" id="7906164">.</span><span class="ident" id="7906165">Fatalf</span><span class="op" id="7906171">(</span><span class="string" id="7906172">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7906195">,</span>&nbsp;<span class="ident" id="7906197">c</span><span class="op" id="7906198">.</span><span class="ident" id="7906199">RemoteAddr</span><span class="op" id="7906209">(</span><span class="op" id="7906210">)</span><span class="op" id="7906211">,</span>&nbsp;<span class="ident" id="7906213">raddr</span><span class="op" id="7906218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906221">}</span><br>
<span class="lineno"></span><span class="op" id="7906223">}</span>
</div>
</body>
</html>
