<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1635765">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1635820">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1635874">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1635925">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635942">package</span>&nbsp;<span class="ident" id="1635950">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635959">import</span>&nbsp;<span class="string" id="1635966">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1635976">func</span>&nbsp;<span class="ident" id="1635981">epollcreate</span><span class="op" id="1635992">(</span><span class="ident" id="1635993">size</span>&nbsp;<span class="builtintype" id="1635998">int32</span><span class="op" id="1636003">)</span>&nbsp;<span class="builtintype" id="1636005">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1636011">func</span>&nbsp;<span class="ident" id="1636016">epollcreate1</span><span class="op" id="1636028">(</span><span class="ident" id="1636029">flags</span>&nbsp;<span class="builtintype" id="1636035">int32</span><span class="op" id="1636040">)</span>&nbsp;<span class="builtintype" id="1636042">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636049">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1636063">func</span>&nbsp;<span class="ident" id="1636068">epollctl</span><span class="op" id="1636076">(</span><span class="ident" id="1636077">epfd</span><span class="op" id="1636081">,</span>&nbsp;<span class="ident" id="1636083">op</span><span class="op" id="1636085">,</span>&nbsp;<span class="ident" id="1636087">fd</span>&nbsp;<span class="builtintype" id="1636090">int32</span><span class="op" id="1636095">,</span>&nbsp;<span class="ident" id="1636097">ev</span>&nbsp;<span class="op" id="1636100">*</span><span class="ident" id="1636101">epollevent</span><span class="op" id="1636111">)</span>&nbsp;<span class="builtintype" id="1636113">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636120">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1636134">func</span>&nbsp;<span class="ident" id="1636139">epollwait</span><span class="op" id="1636148">(</span><span class="ident" id="1636149">epfd</span>&nbsp;<span class="builtintype" id="1636154">int32</span><span class="op" id="1636159">,</span>&nbsp;<span class="ident" id="1636161">ev</span>&nbsp;<span class="op" id="1636164">*</span><span class="ident" id="1636165">epollevent</span><span class="op" id="1636175">,</span>&nbsp;<span class="ident" id="1636177">nev</span><span class="op" id="1636180">,</span>&nbsp;<span class="ident" id="1636182">timeout</span>&nbsp;<span class="builtintype" id="1636190">int32</span><span class="op" id="1636195">)</span>&nbsp;<span class="builtintype" id="1636197">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1636203">func</span>&nbsp;<span class="ident" id="1636208">closeonexec</span><span class="op" id="1636219">(</span><span class="ident" id="1636220">fd</span>&nbsp;<span class="builtintype" id="1636223">int32</span><span class="op" id="1636228">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1636231">var</span>&nbsp;<span class="op" id="1636235">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636238">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1636253">int32</span>&nbsp;<span class="op" id="1636259">=</span>&nbsp;<span class="op" id="1636261">-</span><span class="num" id="1636262">1</span>&nbsp;<span class="comment" id="1636264">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636285">netpolllasterr</span>&nbsp;<span class="builtintype" id="1636300">int32</span><br>
<span class="lineno"></span><span class="op" id="1636306">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1636309">func</span>&nbsp;<span class="ident" id="1636314">netpollinit</span><span class="op" id="1636325">(</span><span class="op" id="1636326">)</span>&nbsp;<span class="op" id="1636328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636331">epfd</span>&nbsp;<span class="op" id="1636336">=</span>&nbsp;<span class="ident" id="1636338">epollcreate1</span><span class="op" id="1636350">(</span><span class="ident" id="1636351">_EPOLL_CLOEXEC</span><span class="op" id="1636365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636368">if</span>&nbsp;<span class="ident" id="1636371">epfd</span>&nbsp;<span class="op" id="1636376">&gt;=</span>&nbsp;<span class="num" id="1636379">0</span>&nbsp;<span class="op" id="1636381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636385">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636396">epfd</span>&nbsp;<span class="op" id="1636401">=</span>&nbsp;<span class="ident" id="1636403">epollcreate</span><span class="op" id="1636414">(</span><span class="num" id="1636415">1024</span><span class="op" id="1636419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636422">if</span>&nbsp;<span class="ident" id="1636425">epfd</span>&nbsp;<span class="op" id="1636430">&gt;=</span>&nbsp;<span class="num" id="1636433">0</span>&nbsp;<span class="op" id="1636435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636439">closeonexec</span><span class="op" id="1636450">(</span><span class="ident" id="1636451">epfd</span><span class="op" id="1636455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636459">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1636470">println</span><span class="op" id="1636477">(</span><span class="string" id="1636478">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1636526">,</span>&nbsp;<span class="op" id="1636528">-</span><span class="ident" id="1636529">epfd</span><span class="op" id="1636533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636536">gothrow</span><span class="op" id="1636543">(</span><span class="string" id="1636544">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1636586">)</span><br>
<span class="lineno"></span><span class="op" id="1636588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1636591">func</span>&nbsp;<span class="ident" id="1636596">netpollopen</span><span class="op" id="1636607">(</span><span class="ident" id="1636608">fd</span>&nbsp;<span class="builtintype" id="1636611">uintptr</span><span class="op" id="1636618">,</span>&nbsp;<span class="ident" id="1636620">pd</span>&nbsp;<span class="op" id="1636623">*</span><span class="ident" id="1636624">pollDesc</span><span class="op" id="1636632">)</span>&nbsp;<span class="builtintype" id="1636634">int32</span>&nbsp;<span class="op" id="1636640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636643">var</span>&nbsp;<span class="ident" id="1636647">ev</span>&nbsp;<span class="ident" id="1636650">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636662">ev</span><span class="op" id="1636664">.</span><span class="ident" id="1636665">events</span>&nbsp;<span class="op" id="1636672">=</span>&nbsp;<span class="ident" id="1636674">_EPOLLIN</span>&nbsp;<span class="op" id="1636683">|</span>&nbsp;<span class="ident" id="1636685">_EPOLLOUT</span>&nbsp;<span class="op" id="1636695">|</span>&nbsp;<span class="ident" id="1636697">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1636709">|</span>&nbsp;<span class="ident" id="1636711">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636721">*</span><span class="op" id="1636722">(</span><span class="op" id="1636723">*</span><span class="op" id="1636724">*</span><span class="ident" id="1636725">pollDesc</span><span class="op" id="1636733">)</span><span class="op" id="1636734">(</span><span class="ident" id="1636735">unsafe</span><span class="op" id="1636741">.</span><span class="ident" id="1636742">Pointer</span><span class="op" id="1636749">(</span><span class="op" id="1636750">&amp;</span><span class="ident" id="1636751">ev</span><span class="op" id="1636753">.</span><span class="ident" id="1636754">data</span><span class="op" id="1636758">)</span><span class="op" id="1636759">)</span>&nbsp;<span class="op" id="1636761">=</span>&nbsp;<span class="ident" id="1636763">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636767">return</span>&nbsp;<span class="op" id="1636774">-</span><span class="ident" id="1636775">epollctl</span><span class="op" id="1636783">(</span><span class="ident" id="1636784">epfd</span><span class="op" id="1636788">,</span>&nbsp;<span class="ident" id="1636790">_EPOLL_CTL_ADD</span><span class="op" id="1636804">,</span>&nbsp;<span class="builtintype" id="1636806">int32</span><span class="op" id="1636811">(</span><span class="ident" id="1636812">fd</span><span class="op" id="1636814">)</span><span class="op" id="1636815">,</span>&nbsp;<span class="op" id="1636817">&amp;</span><span class="ident" id="1636818">ev</span><span class="op" id="1636820">)</span><br>
<span class="lineno">45</span><span class="op" id="1636822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1636825">func</span>&nbsp;<span class="ident" id="1636830">netpollclose</span><span class="op" id="1636842">(</span><span class="ident" id="1636843">fd</span>&nbsp;<span class="builtintype" id="1636846">uintptr</span><span class="op" id="1636853">)</span>&nbsp;<span class="builtintype" id="1636855">int32</span>&nbsp;<span class="op" id="1636861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636864">var</span>&nbsp;<span class="ident" id="1636868">ev</span>&nbsp;<span class="ident" id="1636871">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636883">return</span>&nbsp;<span class="op" id="1636890">-</span><span class="ident" id="1636891">epollctl</span><span class="op" id="1636899">(</span><span class="ident" id="1636900">epfd</span><span class="op" id="1636904">,</span>&nbsp;<span class="ident" id="1636906">_EPOLL_CTL_DEL</span><span class="op" id="1636920">,</span>&nbsp;<span class="builtintype" id="1636922">int32</span><span class="op" id="1636927">(</span><span class="ident" id="1636928">fd</span><span class="op" id="1636930">)</span><span class="op" id="1636931">,</span>&nbsp;<span class="op" id="1636933">&amp;</span><span class="ident" id="1636934">ev</span><span class="op" id="1636936">)</span><br>
<span class="lineno">50</span><span class="op" id="1636938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1636941">func</span>&nbsp;<span class="ident" id="1636946">netpollarm</span><span class="op" id="1636956">(</span><span class="ident" id="1636957">pd</span>&nbsp;<span class="op" id="1636960">*</span><span class="ident" id="1636961">pollDesc</span><span class="op" id="1636969">,</span>&nbsp;<span class="ident" id="1636971">mode</span>&nbsp;<span class="builtintype" id="1636976">int</span><span class="op" id="1636979">)</span>&nbsp;<span class="op" id="1636981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636984">gothrow</span><span class="op" id="1636991">(</span><span class="string" id="1636992">&#34;unused&#34;</span><span class="op" id="1637000">)</span><br>
<span class="lineno"></span><span class="op" id="1637002">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1637005">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1637044">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1637095">func</span>&nbsp;<span class="ident" id="1637100">netpoll</span><span class="op" id="1637107">(</span><span class="ident" id="1637108">block</span>&nbsp;<span class="builtintype" id="1637114">bool</span><span class="op" id="1637118">)</span>&nbsp;<span class="op" id="1637120">(</span><span class="ident" id="1637121">gp</span>&nbsp;<span class="op" id="1637124">*</span><span class="ident" id="1637125">g</span><span class="op" id="1637126">)</span>&nbsp;<span class="op" id="1637128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637131">if</span>&nbsp;<span class="ident" id="1637134">epfd</span>&nbsp;<span class="op" id="1637139">==</span>&nbsp;<span class="op" id="1637142">-</span><span class="num" id="1637143">1</span>&nbsp;<span class="op" id="1637145">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637149">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637160">waitms</span>&nbsp;<span class="op" id="1637167">:=</span>&nbsp;<span class="builtintype" id="1637170">int32</span><span class="op" id="1637175">(</span><span class="op" id="1637176">-</span><span class="num" id="1637177">1</span><span class="op" id="1637178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637181">if</span>&nbsp;<span class="op" id="1637184">!</span><span class="ident" id="1637185">block</span>&nbsp;<span class="op" id="1637191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637195">waitms</span>&nbsp;<span class="op" id="1637202">=</span>&nbsp;<span class="num" id="1637204">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637210">var</span>&nbsp;<span class="ident" id="1637214">events</span>&nbsp;<span class="op" id="1637221">[</span><span class="num" id="1637222">128</span><span class="op" id="1637225">]</span><span class="ident" id="1637226">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1637237">retry</span><span class="op" id="1637242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637245">n</span>&nbsp;<span class="op" id="1637247">:=</span>&nbsp;<span class="ident" id="1637250">epollwait</span><span class="op" id="1637259">(</span><span class="ident" id="1637260">epfd</span><span class="op" id="1637264">,</span>&nbsp;<span class="op" id="1637266">&amp;</span><span class="ident" id="1637267">events</span><span class="op" id="1637273">[</span><span class="num" id="1637274">0</span><span class="op" id="1637275">]</span><span class="op" id="1637276">,</span>&nbsp;<span class="builtintype" id="1637278">int32</span><span class="op" id="1637283">(</span><span class="builtinfunc" id="1637284">len</span><span class="op" id="1637287">(</span><span class="ident" id="1637288">events</span><span class="op" id="1637294">)</span><span class="op" id="1637295">)</span><span class="op" id="1637296">,</span>&nbsp;<span class="ident" id="1637298">waitms</span><span class="op" id="1637304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637307">if</span>&nbsp;<span class="ident" id="1637310">n</span>&nbsp;<span class="op" id="1637312">&lt;</span>&nbsp;<span class="num" id="1637314">0</span>&nbsp;<span class="op" id="1637316">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637320">if</span>&nbsp;<span class="ident" id="1637323">n</span>&nbsp;<span class="op" id="1637325">!=</span>&nbsp;<span class="op" id="1637328">-</span><span class="ident" id="1637329">_EINTR</span>&nbsp;<span class="op" id="1637336">&amp;&amp;</span>&nbsp;<span class="ident" id="1637339">n</span>&nbsp;<span class="op" id="1637341">!=</span>&nbsp;<span class="ident" id="1637344">netpolllasterr</span>&nbsp;<span class="op" id="1637359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637364">netpolllasterr</span>&nbsp;<span class="op" id="1637379">=</span>&nbsp;<span class="ident" id="1637381">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1637386">println</span><span class="op" id="1637393">(</span><span class="string" id="1637394">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1637420">,</span>&nbsp;<span class="ident" id="1637422">epfd</span><span class="op" id="1637426">,</span>&nbsp;<span class="string" id="1637428">&#34;failed&nbsp;with&#34;</span><span class="op" id="1637441">,</span>&nbsp;<span class="op" id="1637443">-</span><span class="ident" id="1637444">n</span><span class="op" id="1637445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637453">goto</span>&nbsp;<span class="ident" id="1637458">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637468">for</span>&nbsp;<span class="ident" id="1637472">i</span>&nbsp;<span class="op" id="1637474">:=</span>&nbsp;<span class="builtintype" id="1637477">int32</span><span class="op" id="1637482">(</span><span class="num" id="1637483">0</span><span class="op" id="1637484">)</span><span class="op" id="1637485">;</span>&nbsp;<span class="ident" id="1637487">i</span>&nbsp;<span class="op" id="1637489">&lt;</span>&nbsp;<span class="ident" id="1637491">n</span><span class="op" id="1637492">;</span>&nbsp;<span class="ident" id="1637494">i</span><span class="op" id="1637495">++</span>&nbsp;<span class="op" id="1637498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637502">ev</span>&nbsp;<span class="op" id="1637505">:=</span>&nbsp;<span class="op" id="1637508">&amp;</span><span class="ident" id="1637509">events</span><span class="op" id="1637515">[</span><span class="ident" id="1637516">i</span><span class="op" id="1637517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637521">if</span>&nbsp;<span class="ident" id="1637524">ev</span><span class="op" id="1637526">.</span><span class="ident" id="1637527">events</span>&nbsp;<span class="op" id="1637534">==</span>&nbsp;<span class="num" id="1637537">0</span>&nbsp;<span class="op" id="1637539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637544">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637559">var</span>&nbsp;<span class="ident" id="1637563">mode</span>&nbsp;<span class="builtintype" id="1637568">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637576">if</span>&nbsp;<span class="ident" id="1637579">ev</span><span class="op" id="1637581">.</span><span class="ident" id="1637582">events</span><span class="op" id="1637588">&amp;</span><span class="op" id="1637589">(</span><span class="ident" id="1637590">_EPOLLIN</span><span class="op" id="1637598">|</span><span class="ident" id="1637599">_EPOLLRDHUP</span><span class="op" id="1637610">|</span><span class="ident" id="1637611">_EPOLLHUP</span><span class="op" id="1637620">|</span><span class="ident" id="1637621">_EPOLLERR</span><span class="op" id="1637630">)</span>&nbsp;<span class="op" id="1637632">!=</span>&nbsp;<span class="num" id="1637635">0</span>&nbsp;<span class="op" id="1637637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637642">mode</span>&nbsp;<span class="op" id="1637647">+=</span>&nbsp;<span class="string" id="1637650">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637656">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637660">if</span>&nbsp;<span class="ident" id="1637663">ev</span><span class="op" id="1637665">.</span><span class="ident" id="1637666">events</span><span class="op" id="1637672">&amp;</span><span class="op" id="1637673">(</span><span class="ident" id="1637674">_EPOLLOUT</span><span class="op" id="1637683">|</span><span class="ident" id="1637684">_EPOLLHUP</span><span class="op" id="1637693">|</span><span class="ident" id="1637694">_EPOLLERR</span><span class="op" id="1637703">)</span>&nbsp;<span class="op" id="1637705">!=</span>&nbsp;<span class="num" id="1637708">0</span>&nbsp;<span class="op" id="1637710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637715">mode</span>&nbsp;<span class="op" id="1637720">+=</span>&nbsp;<span class="string" id="1637723">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637733">if</span>&nbsp;<span class="ident" id="1637736">mode</span>&nbsp;<span class="op" id="1637741">!=</span>&nbsp;<span class="num" id="1637744">0</span>&nbsp;<span class="op" id="1637746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637751">pd</span>&nbsp;<span class="op" id="1637754">:=</span>&nbsp;<span class="op" id="1637757">*</span><span class="op" id="1637758">(</span><span class="op" id="1637759">*</span><span class="op" id="1637760">*</span><span class="ident" id="1637761">pollDesc</span><span class="op" id="1637769">)</span><span class="op" id="1637770">(</span><span class="ident" id="1637771">unsafe</span><span class="op" id="1637777">.</span><span class="ident" id="1637778">Pointer</span><span class="op" id="1637785">(</span><span class="op" id="1637786">&amp;</span><span class="ident" id="1637787">ev</span><span class="op" id="1637789">.</span><span class="ident" id="1637790">data</span><span class="op" id="1637794">)</span><span class="op" id="1637795">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637800">netpollready</span><span class="op" id="1637812">(</span><span class="op" id="1637813">(</span><span class="op" id="1637814">*</span><span class="op" id="1637815">*</span><span class="ident" id="1637816">g</span><span class="op" id="1637817">)</span><span class="op" id="1637818">(</span><span class="ident" id="1637819">noescape</span><span class="op" id="1637827">(</span><span class="ident" id="1637828">unsafe</span><span class="op" id="1637834">.</span><span class="ident" id="1637835">Pointer</span><span class="op" id="1637842">(</span><span class="op" id="1637843">&amp;</span><span class="ident" id="1637844">gp</span><span class="op" id="1637846">)</span><span class="op" id="1637847">)</span><span class="op" id="1637848">)</span><span class="op" id="1637849">,</span>&nbsp;<span class="ident" id="1637851">pd</span><span class="op" id="1637853">,</span>&nbsp;<span class="ident" id="1637855">mode</span><span class="op" id="1637859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637869">if</span>&nbsp;<span class="ident" id="1637872">block</span>&nbsp;<span class="op" id="1637878">&amp;&amp;</span>&nbsp;<span class="ident" id="1637881">gp</span>&nbsp;<span class="op" id="1637884">==</span>&nbsp;<span class="ident" id="1637887">nil</span>&nbsp;<span class="op" id="1637891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637895">goto</span>&nbsp;<span class="ident" id="1637900">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637910">return</span>&nbsp;<span class="ident" id="1637917">gp</span><br>
<span class="lineno"></span><span class="op" id="1637920">}</span>
</div>
</body>
</html>
