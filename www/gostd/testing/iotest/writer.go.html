<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html" class="current">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5964265">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5964320">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5964374">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5964425">package</span>&nbsp;<span class="ident" id="5964433">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5964441">import</span>&nbsp;<span class="string" id="5964448">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964454">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="5964506">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5964543">func</span>&nbsp;<span class="ident" id="5964548">TruncateWriter</span><span class="op" id="5964562">(</span><span class="ident" id="5964563">w</span>&nbsp;<span class="ident" id="5964565">io</span><span class="op" id="5964567">.</span><span class="ident" id="5964568">Writer</span><span class="op" id="5964574">,</span>&nbsp;<span class="ident" id="5964576">n</span>&nbsp;<span class="ident" id="5964578">int64</span><span class="op" id="5964583">)</span>&nbsp;<span class="ident" id="5964585">io</span><span class="op" id="5964587">.</span><span class="ident" id="5964588">Writer</span>&nbsp;<span class="op" id="5964595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964598">return</span>&nbsp;<span class="op" id="5964605">&amp;</span><span class="ident" id="5964606">truncateWriter</span><span class="op" id="5964620">{</span><span class="ident" id="5964621">w</span><span class="op" id="5964622">,</span>&nbsp;<span class="ident" id="5964624">n</span><span class="op" id="5964625">}</span><br>
<span class="lineno"></span><span class="op" id="5964627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5964630">type</span>&nbsp;<span class="ident" id="5964635">truncateWriter</span>&nbsp;<span class="keyword" id="5964650">struct</span>&nbsp;<span class="op" id="5964657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964660">w</span>&nbsp;<span class="ident" id="5964662">io</span><span class="op" id="5964664">.</span><span class="ident" id="5964665">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964673">n</span>&nbsp;<span class="ident" id="5964675">int64</span><br>
<span class="lineno"></span><span class="op" id="5964681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5964684">func</span>&nbsp;<span class="op" id="5964689">(</span><span class="ident" id="5964690">t</span>&nbsp;<span class="op" id="5964692">*</span><span class="ident" id="5964693">truncateWriter</span><span class="op" id="5964707">)</span>&nbsp;<span class="ident" id="5964709">Write</span><span class="op" id="5964714">(</span><span class="ident" id="5964715">p</span>&nbsp;<span class="op" id="5964717">[</span><span class="op" id="5964718">]</span><span class="builtintype" id="5964719">byte</span><span class="op" id="5964723">)</span>&nbsp;<span class="op" id="5964725">(</span><span class="ident" id="5964726">n</span>&nbsp;<span class="builtintype" id="5964728">int</span><span class="op" id="5964731">,</span>&nbsp;<span class="ident" id="5964733">err</span>&nbsp;<span class="builtintype" id="5964737">error</span><span class="op" id="5964742">)</span>&nbsp;<span class="op" id="5964744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964747">if</span>&nbsp;<span class="ident" id="5964750">t</span><span class="op" id="5964751">.</span><span class="ident" id="5964752">n</span>&nbsp;<span class="op" id="5964754">&lt;=</span>&nbsp;<span class="num" id="5964757">0</span>&nbsp;<span class="op" id="5964759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964763">return</span>&nbsp;<span class="builtinfunc" id="5964770">len</span><span class="op" id="5964773">(</span><span class="ident" id="5964774">p</span><span class="op" id="5964775">)</span><span class="op" id="5964776">,</span>&nbsp;<span class="builtintype" id="5964778">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964786">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964801">n</span>&nbsp;<span class="op" id="5964803">=</span>&nbsp;<span class="builtinfunc" id="5964805">len</span><span class="op" id="5964808">(</span><span class="ident" id="5964809">p</span><span class="op" id="5964810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964813">if</span>&nbsp;<span class="ident" id="5964816">int64</span><span class="op" id="5964821">(</span><span class="ident" id="5964822">n</span><span class="op" id="5964823">)</span>&nbsp;<span class="op" id="5964825">&gt;</span>&nbsp;<span class="ident" id="5964827">t</span><span class="op" id="5964828">.</span><span class="ident" id="5964829">n</span>&nbsp;<span class="op" id="5964831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964835">n</span>&nbsp;<span class="op" id="5964837">=</span>&nbsp;<span class="builtintype" id="5964839">int</span><span class="op" id="5964842">(</span><span class="ident" id="5964843">t</span><span class="op" id="5964844">.</span><span class="ident" id="5964845">n</span><span class="op" id="5964846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964852">n</span><span class="op" id="5964853">,</span>&nbsp;<span class="ident" id="5964855">err</span>&nbsp;<span class="op" id="5964859">=</span>&nbsp;<span class="ident" id="5964861">t</span><span class="op" id="5964862">.</span><span class="ident" id="5964863">w</span><span class="op" id="5964864">.</span><span class="ident" id="5964865">Write</span><span class="op" id="5964870">(</span><span class="ident" id="5964871">p</span><span class="op" id="5964872">[</span><span class="num" id="5964873">0</span><span class="op" id="5964874">:</span><span class="ident" id="5964875">n</span><span class="op" id="5964876">]</span><span class="op" id="5964877">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964880">t</span><span class="op" id="5964881">.</span><span class="ident" id="5964882">n</span>&nbsp;<span class="op" id="5964884">-=</span>&nbsp;<span class="ident" id="5964887">int64</span><span class="op" id="5964892">(</span><span class="ident" id="5964893">n</span><span class="op" id="5964894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964897">if</span>&nbsp;<span class="ident" id="5964900">err</span>&nbsp;<span class="op" id="5964904">==</span>&nbsp;<span class="builtintype" id="5964907">nil</span>&nbsp;<span class="op" id="5964911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964915">n</span>&nbsp;<span class="op" id="5964917">=</span>&nbsp;<span class="builtinfunc" id="5964919">len</span><span class="op" id="5964922">(</span><span class="ident" id="5964923">p</span><span class="op" id="5964924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964930">return</span><br>
<span class="lineno">35</span><span class="op" id="5964937">}</span>
</div>
</body>
</html>
