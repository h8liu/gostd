<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6390861">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6390916">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6390970">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6391021">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6391080">//</span><br>
<span class="lineno"></span><span class="comment" id="6391083">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6391162">package</span>&nbsp;<span class="ident" id="6391170">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6391175">import</span>&nbsp;<span class="op" id="6391182">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391185">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391194">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391210">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391220">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391227">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391236">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391251">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6391256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6391259">var</span>&nbsp;<span class="op" id="6391263">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391266">errNotEnough</span>&nbsp;<span class="op" id="6391279">=</span>&nbsp;<span class="ident" id="6391281">errors</span><span class="op" id="6391287">.</span><span class="ident" id="6391288">New</span><span class="op" id="6391291">(</span><span class="string" id="6391292">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6391320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391323">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6391336">=</span>&nbsp;<span class="ident" id="6391338">errors</span><span class="op" id="6391344">.</span><span class="ident" id="6391345">New</span><span class="op" id="6391348">(</span><span class="string" id="6391349">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6391375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391378">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6391391">=</span>&nbsp;<span class="ident" id="6391393">errors</span><span class="op" id="6391399">.</span><span class="ident" id="6391400">New</span><span class="op" id="6391403">(</span><span class="string" id="6391404">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6391430">)</span><br>
<span class="lineno"></span><span class="op" id="6391432">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6391435">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6391530">type</span>&nbsp;<span class="ident" id="6391535">reader</span>&nbsp;<span class="keyword" id="6391542">interface</span>&nbsp;<span class="op" id="6391552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391555">io</span><span class="op" id="6391557">.</span><span class="ident" id="6391558">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391566">io</span><span class="op" id="6391568">.</span><span class="ident" id="6391569">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6391580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6391583">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6391597">const</span>&nbsp;<span class="op" id="6391603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391606">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391618">fColorMapFollows</span>&nbsp;<span class="op" id="6391635">=</span>&nbsp;<span class="num" id="6391637">1</span>&nbsp;<span class="op" id="6391639">&lt;&lt;</span>&nbsp;<span class="num" id="6391642">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391646">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391664">ifLocalColorTable</span>&nbsp;<span class="op" id="6391682">=</span>&nbsp;<span class="num" id="6391684">1</span>&nbsp;<span class="op" id="6391686">&lt;&lt;</span>&nbsp;<span class="num" id="6391689">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391692">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391710">=</span>&nbsp;<span class="num" id="6391712">1</span>&nbsp;<span class="op" id="6391714">&lt;&lt;</span>&nbsp;<span class="num" id="6391717">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391720">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6391738">=</span>&nbsp;<span class="num" id="6391740">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391744">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391771">gcTransparentColorSet</span>&nbsp;<span class="op" id="6391793">=</span>&nbsp;<span class="num" id="6391795">1</span>&nbsp;<span class="op" id="6391797">&lt;&lt;</span>&nbsp;<span class="num" id="6391800">0</span><br>
<span class="lineno"></span><span class="op" id="6391802">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6391805">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6391828">const</span>&nbsp;<span class="op" id="6391834">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391837">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391854">=</span>&nbsp;<span class="num" id="6391856">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391862">sImageDescriptor</span>&nbsp;<span class="op" id="6391879">=</span>&nbsp;<span class="num" id="6391881">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391887">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391904">=</span>&nbsp;<span class="num" id="6391906">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6391911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6391914">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6391929">const</span>&nbsp;<span class="op" id="6391935">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391938">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391954">=</span>&nbsp;<span class="num" id="6391956">0x01</span>&nbsp;<span class="comment" id="6391961">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391976">eGraphicControl</span>&nbsp;<span class="op" id="6391992">=</span>&nbsp;<span class="num" id="6391994">0xF9</span>&nbsp;<span class="comment" id="6391999">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392019">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392035">=</span>&nbsp;<span class="num" id="6392037">0xFE</span>&nbsp;<span class="comment" id="6392042">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392054">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392070">=</span>&nbsp;<span class="num" id="6392072">0xFF</span>&nbsp;<span class="comment" id="6392077">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6392092">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6392095">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6392145">type</span>&nbsp;<span class="ident" id="6392150">decoder</span>&nbsp;<span class="keyword" id="6392158">struct</span>&nbsp;<span class="op" id="6392165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392168">r</span>&nbsp;<span class="ident" id="6392170">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392179">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392196">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392212">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392220">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392236">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392241">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392257">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392262">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392278">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392284">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392300">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392306">backgroundIndex</span>&nbsp;<span class="builtintype" id="6392322">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392328">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392344">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392349">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392365">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392371">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392395">aspect</span>&nbsp;<span class="builtintype" id="6392402">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392409">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392436">imageFields</span>&nbsp;<span class="builtintype" id="6392448">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392455">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392482">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392502">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392508">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6392528">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392535">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392549">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392564">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392570">globalColorMap</span>&nbsp;<span class="ident" id="6392585">color</span><span class="op" id="6392590">.</span><span class="ident" id="6392591">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392601">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392625">delay</span>&nbsp;<span class="op" id="6392631">[</span><span class="op" id="6392632">]</span><span class="builtintype" id="6392633">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392638">image</span>&nbsp;<span class="op" id="6392644">[</span><span class="op" id="6392645">]</span><span class="op" id="6392646">*</span><span class="ident" id="6392647">image</span><span class="op" id="6392652">.</span><span class="ident" id="6392653">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392663">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6392669">[</span><span class="num" id="6392670">1024</span><span class="op" id="6392674">]</span><span class="builtintype" id="6392675">byte</span>&nbsp;<span class="comment" id="6392680">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6392729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6392732">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6392799">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6392866">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6392930">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6393000">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6393069">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6393098">type</span>&nbsp;<span class="ident" id="6393103">blockReader</span>&nbsp;<span class="keyword" id="6393115">struct</span>&nbsp;<span class="op" id="6393122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393125">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393131">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393139">slice</span>&nbsp;<span class="op" id="6393145">[</span><span class="op" id="6393146">]</span><span class="builtintype" id="6393147">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393153">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6393159">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393166">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6393172">[</span><span class="num" id="6393173">256</span><span class="op" id="6393176">]</span><span class="builtintype" id="6393177">byte</span><br>
<span class="lineno"></span><span class="op" id="6393182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6393185">func</span>&nbsp;<span class="op" id="6393190">(</span><span class="ident" id="6393191">b</span>&nbsp;<span class="op" id="6393193">*</span><span class="ident" id="6393194">blockReader</span><span class="op" id="6393205">)</span>&nbsp;<span class="ident" id="6393207">Read</span><span class="op" id="6393211">(</span><span class="ident" id="6393212">p</span>&nbsp;<span class="op" id="6393214">[</span><span class="op" id="6393215">]</span><span class="builtintype" id="6393216">byte</span><span class="op" id="6393220">)</span>&nbsp;<span class="op" id="6393222">(</span><span class="builtintype" id="6393223">int</span><span class="op" id="6393226">,</span>&nbsp;<span class="builtintype" id="6393228">error</span><span class="op" id="6393233">)</span>&nbsp;<span class="op" id="6393235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393238">if</span>&nbsp;<span class="ident" id="6393241">b</span><span class="op" id="6393242">.</span><span class="ident" id="6393243">err</span>&nbsp;<span class="op" id="6393247">!=</span>&nbsp;<span class="ident" id="6393250">nil</span>&nbsp;<span class="op" id="6393254">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393258">return</span>&nbsp;<span class="num" id="6393265">0</span><span class="op" id="6393266">,</span>&nbsp;<span class="ident" id="6393268">b</span><span class="op" id="6393269">.</span><span class="ident" id="6393270">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393278">if</span>&nbsp;<span class="builtinfunc" id="6393281">len</span><span class="op" id="6393284">(</span><span class="ident" id="6393285">p</span><span class="op" id="6393286">)</span>&nbsp;<span class="op" id="6393288">==</span>&nbsp;<span class="num" id="6393291">0</span>&nbsp;<span class="op" id="6393293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393297">return</span>&nbsp;<span class="num" id="6393304">0</span><span class="op" id="6393305">,</span>&nbsp;<span class="ident" id="6393307">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393312">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393315">if</span>&nbsp;<span class="builtinfunc" id="6393318">len</span><span class="op" id="6393321">(</span><span class="ident" id="6393322">b</span><span class="op" id="6393323">.</span><span class="ident" id="6393324">slice</span><span class="op" id="6393329">)</span>&nbsp;<span class="op" id="6393331">==</span>&nbsp;<span class="num" id="6393334">0</span>&nbsp;<span class="op" id="6393336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393340">var</span>&nbsp;<span class="ident" id="6393344">blockLen</span>&nbsp;<span class="builtintype" id="6393353">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393361">blockLen</span><span class="op" id="6393369">,</span>&nbsp;<span class="ident" id="6393371">b</span><span class="op" id="6393372">.</span><span class="ident" id="6393373">err</span>&nbsp;<span class="op" id="6393377">=</span>&nbsp;<span class="ident" id="6393379">b</span><span class="op" id="6393380">.</span><span class="ident" id="6393381">r</span><span class="op" id="6393382">.</span><span class="ident" id="6393383">ReadByte</span><span class="op" id="6393391">(</span><span class="op" id="6393392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393396">if</span>&nbsp;<span class="ident" id="6393399">b</span><span class="op" id="6393400">.</span><span class="ident" id="6393401">err</span>&nbsp;<span class="op" id="6393405">!=</span>&nbsp;<span class="ident" id="6393408">nil</span>&nbsp;<span class="op" id="6393412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393417">return</span>&nbsp;<span class="num" id="6393424">0</span><span class="op" id="6393425">,</span>&nbsp;<span class="ident" id="6393427">b</span><span class="op" id="6393428">.</span><span class="ident" id="6393429">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393439">if</span>&nbsp;<span class="ident" id="6393442">blockLen</span>&nbsp;<span class="op" id="6393451">==</span>&nbsp;<span class="num" id="6393454">0</span>&nbsp;<span class="op" id="6393456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393461">b</span><span class="op" id="6393462">.</span><span class="ident" id="6393463">err</span>&nbsp;<span class="op" id="6393467">=</span>&nbsp;<span class="ident" id="6393469">io</span><span class="op" id="6393471">.</span><span class="ident" id="6393472">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393479">return</span>&nbsp;<span class="num" id="6393486">0</span><span class="op" id="6393487">,</span>&nbsp;<span class="ident" id="6393489">b</span><span class="op" id="6393490">.</span><span class="ident" id="6393491">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393497">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393501">b</span><span class="op" id="6393502">.</span><span class="ident" id="6393503">slice</span>&nbsp;<span class="op" id="6393509">=</span>&nbsp;<span class="ident" id="6393511">b</span><span class="op" id="6393512">.</span><span class="ident" id="6393513">tmp</span><span class="op" id="6393516">[</span><span class="num" id="6393517">0</span><span class="op" id="6393518">:</span><span class="ident" id="6393519">blockLen</span><span class="op" id="6393527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393531">if</span>&nbsp;<span class="ident" id="6393534">_</span><span class="op" id="6393535">,</span>&nbsp;<span class="ident" id="6393537">b</span><span class="op" id="6393538">.</span><span class="ident" id="6393539">err</span>&nbsp;<span class="op" id="6393543">=</span>&nbsp;<span class="ident" id="6393545">io</span><span class="op" id="6393547">.</span><span class="ident" id="6393548">ReadFull</span><span class="op" id="6393556">(</span><span class="ident" id="6393557">b</span><span class="op" id="6393558">.</span><span class="ident" id="6393559">r</span><span class="op" id="6393560">,</span>&nbsp;<span class="ident" id="6393562">b</span><span class="op" id="6393563">.</span><span class="ident" id="6393564">slice</span><span class="op" id="6393569">)</span><span class="op" id="6393570">;</span>&nbsp;<span class="ident" id="6393572">b</span><span class="op" id="6393573">.</span><span class="ident" id="6393574">err</span>&nbsp;<span class="op" id="6393578">!=</span>&nbsp;<span class="ident" id="6393581">nil</span>&nbsp;<span class="op" id="6393585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393590">return</span>&nbsp;<span class="num" id="6393597">0</span><span class="op" id="6393598">,</span>&nbsp;<span class="ident" id="6393600">b</span><span class="op" id="6393601">.</span><span class="ident" id="6393602">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393611">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393614">n</span>&nbsp;<span class="op" id="6393616">:=</span>&nbsp;<span class="builtinfunc" id="6393619">copy</span><span class="op" id="6393623">(</span><span class="ident" id="6393624">p</span><span class="op" id="6393625">,</span>&nbsp;<span class="ident" id="6393627">b</span><span class="op" id="6393628">.</span><span class="ident" id="6393629">slice</span><span class="op" id="6393634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393637">b</span><span class="op" id="6393638">.</span><span class="ident" id="6393639">slice</span>&nbsp;<span class="op" id="6393645">=</span>&nbsp;<span class="ident" id="6393647">b</span><span class="op" id="6393648">.</span><span class="ident" id="6393649">slice</span><span class="op" id="6393654">[</span><span class="ident" id="6393655">n</span><span class="op" id="6393656">:</span><span class="op" id="6393657">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393660">return</span>&nbsp;<span class="ident" id="6393667">n</span><span class="op" id="6393668">,</span>&nbsp;<span class="ident" id="6393670">nil</span><br>
<span class="lineno"></span><span class="op" id="6393674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6393677">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6393740">func</span>&nbsp;<span class="op" id="6393745">(</span><span class="ident" id="6393746">d</span>&nbsp;<span class="op" id="6393748">*</span><span class="ident" id="6393749">decoder</span><span class="op" id="6393756">)</span>&nbsp;<span class="ident" id="6393758">decode</span><span class="op" id="6393764">(</span><span class="ident" id="6393765">r</span>&nbsp;<span class="ident" id="6393767">io</span><span class="op" id="6393769">.</span><span class="ident" id="6393770">Reader</span><span class="op" id="6393776">,</span>&nbsp;<span class="ident" id="6393778">configOnly</span>&nbsp;<span class="builtintype" id="6393789">bool</span><span class="op" id="6393793">)</span>&nbsp;<span class="builtintype" id="6393795">error</span>&nbsp;<span class="op" id="6393801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393804">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393854">if</span>&nbsp;<span class="ident" id="6393857">rr</span><span class="op" id="6393859">,</span>&nbsp;<span class="ident" id="6393861">ok</span>&nbsp;<span class="op" id="6393864">:=</span>&nbsp;<span class="ident" id="6393867">r</span><span class="op" id="6393868">.</span><span class="op" id="6393869">(</span><span class="ident" id="6393870">reader</span><span class="op" id="6393876">)</span><span class="op" id="6393877">;</span>&nbsp;<span class="ident" id="6393879">ok</span>&nbsp;<span class="op" id="6393882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393886">d</span><span class="op" id="6393887">.</span><span class="ident" id="6393888">r</span>&nbsp;<span class="op" id="6393890">=</span>&nbsp;<span class="ident" id="6393892">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393896">}</span>&nbsp;<span class="keyword" id="6393898">else</span>&nbsp;<span class="op" id="6393903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393907">d</span><span class="op" id="6393908">.</span><span class="ident" id="6393909">r</span>&nbsp;<span class="op" id="6393911">=</span>&nbsp;<span class="ident" id="6393913">bufio</span><span class="op" id="6393918">.</span><span class="ident" id="6393919">NewReader</span><span class="op" id="6393928">(</span><span class="ident" id="6393929">r</span><span class="op" id="6393930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393937">err</span>&nbsp;<span class="op" id="6393941">:=</span>&nbsp;<span class="ident" id="6393944">d</span><span class="op" id="6393945">.</span><span class="ident" id="6393946">readHeaderAndScreenDescriptor</span><span class="op" id="6393975">(</span><span class="op" id="6393976">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393979">if</span>&nbsp;<span class="ident" id="6393982">err</span>&nbsp;<span class="op" id="6393986">!=</span>&nbsp;<span class="ident" id="6393989">nil</span>&nbsp;<span class="op" id="6393993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393997">return</span>&nbsp;<span class="ident" id="6394004">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394012">if</span>&nbsp;<span class="ident" id="6394015">configOnly</span>&nbsp;<span class="op" id="6394026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394030">return</span>&nbsp;<span class="ident" id="6394037">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394046">if</span>&nbsp;<span class="ident" id="6394049">d</span><span class="op" id="6394050">.</span><span class="ident" id="6394051">headerFields</span><span class="op" id="6394063">&amp;</span><span class="ident" id="6394064">fColorMapFollows</span>&nbsp;<span class="op" id="6394081">!=</span>&nbsp;<span class="num" id="6394084">0</span>&nbsp;<span class="op" id="6394086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394090">if</span>&nbsp;<span class="ident" id="6394093">d</span><span class="op" id="6394094">.</span><span class="ident" id="6394095">globalColorMap</span><span class="op" id="6394109">,</span>&nbsp;<span class="ident" id="6394111">err</span>&nbsp;<span class="op" id="6394115">=</span>&nbsp;<span class="ident" id="6394117">d</span><span class="op" id="6394118">.</span><span class="ident" id="6394119">readColorMap</span><span class="op" id="6394131">(</span><span class="op" id="6394132">)</span><span class="op" id="6394133">;</span>&nbsp;<span class="ident" id="6394135">err</span>&nbsp;<span class="op" id="6394139">!=</span>&nbsp;<span class="ident" id="6394142">nil</span>&nbsp;<span class="op" id="6394146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394151">return</span>&nbsp;<span class="ident" id="6394158">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394171">for</span>&nbsp;<span class="op" id="6394175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394179">c</span><span class="op" id="6394180">,</span>&nbsp;<span class="ident" id="6394182">err</span>&nbsp;<span class="op" id="6394186">:=</span>&nbsp;<span class="ident" id="6394189">d</span><span class="op" id="6394190">.</span><span class="ident" id="6394191">r</span><span class="op" id="6394192">.</span><span class="ident" id="6394193">ReadByte</span><span class="op" id="6394201">(</span><span class="op" id="6394202">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394206">if</span>&nbsp;<span class="ident" id="6394209">err</span>&nbsp;<span class="op" id="6394213">!=</span>&nbsp;<span class="ident" id="6394216">nil</span>&nbsp;<span class="op" id="6394220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394225">return</span>&nbsp;<span class="ident" id="6394232">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394242">switch</span>&nbsp;<span class="ident" id="6394249">c</span>&nbsp;<span class="op" id="6394251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394255">case</span>&nbsp;<span class="ident" id="6394260">sExtension</span><span class="op" id="6394270">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394275">if</span>&nbsp;<span class="ident" id="6394278">err</span>&nbsp;<span class="op" id="6394282">=</span>&nbsp;<span class="ident" id="6394284">d</span><span class="op" id="6394285">.</span><span class="ident" id="6394286">readExtension</span><span class="op" id="6394299">(</span><span class="op" id="6394300">)</span><span class="op" id="6394301">;</span>&nbsp;<span class="ident" id="6394303">err</span>&nbsp;<span class="op" id="6394307">!=</span>&nbsp;<span class="ident" id="6394310">nil</span>&nbsp;<span class="op" id="6394314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394320">return</span>&nbsp;<span class="ident" id="6394327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394339">case</span>&nbsp;<span class="ident" id="6394344">sImageDescriptor</span><span class="op" id="6394360">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394365">m</span><span class="op" id="6394366">,</span>&nbsp;<span class="ident" id="6394368">err</span>&nbsp;<span class="op" id="6394372">:=</span>&nbsp;<span class="ident" id="6394375">d</span><span class="op" id="6394376">.</span><span class="ident" id="6394377">newImageFromDescriptor</span><span class="op" id="6394399">(</span><span class="op" id="6394400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394405">if</span>&nbsp;<span class="ident" id="6394408">err</span>&nbsp;<span class="op" id="6394412">!=</span>&nbsp;<span class="ident" id="6394415">nil</span>&nbsp;<span class="op" id="6394419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394425">return</span>&nbsp;<span class="ident" id="6394432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394444">useLocalColorMap</span>&nbsp;<span class="op" id="6394461">:=</span>&nbsp;<span class="ident" id="6394464">d</span><span class="op" id="6394465">.</span><span class="ident" id="6394466">imageFields</span><span class="op" id="6394477">&amp;</span><span class="ident" id="6394478">fColorMapFollows</span>&nbsp;<span class="op" id="6394495">!=</span>&nbsp;<span class="num" id="6394498">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394503">if</span>&nbsp;<span class="ident" id="6394506">useLocalColorMap</span>&nbsp;<span class="op" id="6394523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394529">m</span><span class="op" id="6394530">.</span><span class="ident" id="6394531">Palette</span><span class="op" id="6394538">,</span>&nbsp;<span class="ident" id="6394540">err</span>&nbsp;<span class="op" id="6394544">=</span>&nbsp;<span class="ident" id="6394546">d</span><span class="op" id="6394547">.</span><span class="ident" id="6394548">readColorMap</span><span class="op" id="6394560">(</span><span class="op" id="6394561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394567">if</span>&nbsp;<span class="ident" id="6394570">err</span>&nbsp;<span class="op" id="6394574">!=</span>&nbsp;<span class="ident" id="6394577">nil</span>&nbsp;<span class="op" id="6394581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394588">return</span>&nbsp;<span class="ident" id="6394595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394603">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394608">}</span>&nbsp;<span class="keyword" id="6394610">else</span>&nbsp;<span class="op" id="6394615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394621">m</span><span class="op" id="6394622">.</span><span class="ident" id="6394623">Palette</span>&nbsp;<span class="op" id="6394631">=</span>&nbsp;<span class="ident" id="6394633">d</span><span class="op" id="6394634">.</span><span class="ident" id="6394635">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394658">if</span>&nbsp;<span class="ident" id="6394661">d</span><span class="op" id="6394662">.</span><span class="ident" id="6394663">hasTransparentIndex</span>&nbsp;<span class="op" id="6394683">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6394686">int</span><span class="op" id="6394689">(</span><span class="ident" id="6394690">d</span><span class="op" id="6394691">.</span><span class="ident" id="6394692">transparentIndex</span><span class="op" id="6394708">)</span>&nbsp;<span class="op" id="6394710">&lt;</span>&nbsp;<span class="builtinfunc" id="6394712">len</span><span class="op" id="6394715">(</span><span class="ident" id="6394716">m</span><span class="op" id="6394717">.</span><span class="ident" id="6394718">Palette</span><span class="op" id="6394725">)</span>&nbsp;<span class="op" id="6394727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394733">if</span>&nbsp;<span class="op" id="6394736">!</span><span class="ident" id="6394737">useLocalColorMap</span>&nbsp;<span class="op" id="6394754">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394761">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394797">m</span><span class="op" id="6394798">.</span><span class="ident" id="6394799">Palette</span>&nbsp;<span class="op" id="6394807">=</span>&nbsp;<span class="builtinfunc" id="6394809">append</span><span class="op" id="6394815">(</span><span class="ident" id="6394816">color</span><span class="op" id="6394821">.</span><span class="ident" id="6394822">Palette</span><span class="op" id="6394829">(</span><span class="ident" id="6394830">nil</span><span class="op" id="6394833">)</span><span class="op" id="6394834">,</span>&nbsp;<span class="ident" id="6394836">d</span><span class="op" id="6394837">.</span><span class="ident" id="6394838">globalColorMap</span><span class="op" id="6394852">...</span><span class="op" id="6394855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394867">m</span><span class="op" id="6394868">.</span><span class="ident" id="6394869">Palette</span><span class="op" id="6394876">[</span><span class="ident" id="6394877">d</span><span class="op" id="6394878">.</span><span class="ident" id="6394879">transparentIndex</span><span class="op" id="6394895">]</span>&nbsp;<span class="op" id="6394897">=</span>&nbsp;<span class="ident" id="6394899">color</span><span class="op" id="6394904">.</span><span class="ident" id="6394905">RGBA</span><span class="op" id="6394909">{</span><span class="op" id="6394910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394915">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394920">litWidth</span><span class="op" id="6394928">,</span>&nbsp;<span class="ident" id="6394930">err</span>&nbsp;<span class="op" id="6394934">:=</span>&nbsp;<span class="ident" id="6394937">d</span><span class="op" id="6394938">.</span><span class="ident" id="6394939">r</span><span class="op" id="6394940">.</span><span class="ident" id="6394941">ReadByte</span><span class="op" id="6394949">(</span><span class="op" id="6394950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394955">if</span>&nbsp;<span class="ident" id="6394958">err</span>&nbsp;<span class="op" id="6394962">!=</span>&nbsp;<span class="ident" id="6394965">nil</span>&nbsp;<span class="op" id="6394969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394975">return</span>&nbsp;<span class="ident" id="6394982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394994">if</span>&nbsp;<span class="ident" id="6394997">litWidth</span>&nbsp;<span class="op" id="6395006">&lt;</span>&nbsp;<span class="num" id="6395008">2</span>&nbsp;<span class="op" id="6395010">||</span>&nbsp;<span class="ident" id="6395013">litWidth</span>&nbsp;<span class="op" id="6395022">&gt;</span>&nbsp;<span class="num" id="6395024">8</span>&nbsp;<span class="op" id="6395026">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395032">return</span>&nbsp;<span class="ident" id="6395039">fmt</span><span class="op" id="6395042">.</span><span class="ident" id="6395043">Errorf</span><span class="op" id="6395049">(</span><span class="string" id="6395050">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6395094">,</span>&nbsp;<span class="ident" id="6395096">litWidth</span><span class="op" id="6395104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395114">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395158">br</span>&nbsp;<span class="op" id="6395161">:=</span>&nbsp;<span class="op" id="6395164">&amp;</span><span class="ident" id="6395165">blockReader</span><span class="op" id="6395176">{</span><span class="ident" id="6395177">r</span><span class="op" id="6395178">:</span>&nbsp;<span class="ident" id="6395180">d</span><span class="op" id="6395181">.</span><span class="ident" id="6395182">r</span><span class="op" id="6395183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395188">lzwr</span>&nbsp;<span class="op" id="6395193">:=</span>&nbsp;<span class="ident" id="6395196">lzw</span><span class="op" id="6395199">.</span><span class="ident" id="6395200">NewReader</span><span class="op" id="6395209">(</span><span class="ident" id="6395210">br</span><span class="op" id="6395212">,</span>&nbsp;<span class="ident" id="6395214">lzw</span><span class="op" id="6395217">.</span><span class="ident" id="6395218">LSB</span><span class="op" id="6395221">,</span>&nbsp;<span class="builtintype" id="6395223">int</span><span class="op" id="6395226">(</span><span class="ident" id="6395227">litWidth</span><span class="op" id="6395235">)</span><span class="op" id="6395236">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395241">defer</span>&nbsp;<span class="ident" id="6395247">lzwr</span><span class="op" id="6395251">.</span><span class="ident" id="6395252">Close</span><span class="op" id="6395257">(</span><span class="op" id="6395258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395263">if</span>&nbsp;<span class="ident" id="6395266">_</span><span class="op" id="6395267">,</span>&nbsp;<span class="ident" id="6395269">err</span>&nbsp;<span class="op" id="6395273">=</span>&nbsp;<span class="ident" id="6395275">io</span><span class="op" id="6395277">.</span><span class="ident" id="6395278">ReadFull</span><span class="op" id="6395286">(</span><span class="ident" id="6395287">lzwr</span><span class="op" id="6395291">,</span>&nbsp;<span class="ident" id="6395293">m</span><span class="op" id="6395294">.</span><span class="ident" id="6395295">Pix</span><span class="op" id="6395298">)</span><span class="op" id="6395299">;</span>&nbsp;<span class="ident" id="6395301">err</span>&nbsp;<span class="op" id="6395305">!=</span>&nbsp;<span class="ident" id="6395308">nil</span>&nbsp;<span class="op" id="6395312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395318">if</span>&nbsp;<span class="ident" id="6395321">err</span>&nbsp;<span class="op" id="6395325">!=</span>&nbsp;<span class="ident" id="6395328">io</span><span class="op" id="6395330">.</span><span class="ident" id="6395331">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6395348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395355">return</span>&nbsp;<span class="ident" id="6395362">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395370">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395376">return</span>&nbsp;<span class="ident" id="6395383">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395404">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395466">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395498">if</span>&nbsp;<span class="ident" id="6395501">n</span><span class="op" id="6395502">,</span>&nbsp;<span class="ident" id="6395504">err</span>&nbsp;<span class="op" id="6395508">:=</span>&nbsp;<span class="ident" id="6395511">lzwr</span><span class="op" id="6395515">.</span><span class="ident" id="6395516">Read</span><span class="op" id="6395520">(</span><span class="ident" id="6395521">d</span><span class="op" id="6395522">.</span><span class="ident" id="6395523">tmp</span><span class="op" id="6395526">[</span><span class="op" id="6395527">:</span><span class="num" id="6395528">1</span><span class="op" id="6395529">]</span><span class="op" id="6395530">)</span><span class="op" id="6395531">;</span>&nbsp;<span class="ident" id="6395533">n</span>&nbsp;<span class="op" id="6395535">!=</span>&nbsp;<span class="num" id="6395538">0</span>&nbsp;<span class="op" id="6395540">||</span>&nbsp;<span class="ident" id="6395543">err</span>&nbsp;<span class="op" id="6395547">!=</span>&nbsp;<span class="ident" id="6395550">io</span><span class="op" id="6395552">.</span><span class="ident" id="6395553">EOF</span>&nbsp;<span class="op" id="6395557">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395563">if</span>&nbsp;<span class="ident" id="6395566">err</span>&nbsp;<span class="op" id="6395570">!=</span>&nbsp;<span class="ident" id="6395573">nil</span>&nbsp;<span class="op" id="6395577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395584">return</span>&nbsp;<span class="ident" id="6395591">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395605">return</span>&nbsp;<span class="ident" id="6395612">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395626">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395631">if</span>&nbsp;<span class="ident" id="6395634">n</span><span class="op" id="6395635">,</span>&nbsp;<span class="ident" id="6395637">err</span>&nbsp;<span class="op" id="6395641">:=</span>&nbsp;<span class="ident" id="6395644">br</span><span class="op" id="6395646">.</span><span class="ident" id="6395647">Read</span><span class="op" id="6395651">(</span><span class="ident" id="6395652">d</span><span class="op" id="6395653">.</span><span class="ident" id="6395654">tmp</span><span class="op" id="6395657">[</span><span class="op" id="6395658">:</span><span class="num" id="6395659">1</span><span class="op" id="6395660">]</span><span class="op" id="6395661">)</span><span class="op" id="6395662">;</span>&nbsp;<span class="ident" id="6395664">n</span>&nbsp;<span class="op" id="6395666">!=</span>&nbsp;<span class="num" id="6395669">0</span>&nbsp;<span class="op" id="6395671">||</span>&nbsp;<span class="ident" id="6395674">err</span>&nbsp;<span class="op" id="6395678">!=</span>&nbsp;<span class="ident" id="6395681">io</span><span class="op" id="6395683">.</span><span class="ident" id="6395684">EOF</span>&nbsp;<span class="op" id="6395688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395694">if</span>&nbsp;<span class="ident" id="6395697">err</span>&nbsp;<span class="op" id="6395701">!=</span>&nbsp;<span class="ident" id="6395704">nil</span>&nbsp;<span class="op" id="6395708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395715">return</span>&nbsp;<span class="ident" id="6395722">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395736">return</span>&nbsp;<span class="ident" id="6395743">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395763">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395822">if</span>&nbsp;<span class="builtinfunc" id="6395825">len</span><span class="op" id="6395828">(</span><span class="ident" id="6395829">m</span><span class="op" id="6395830">.</span><span class="ident" id="6395831">Palette</span><span class="op" id="6395838">)</span>&nbsp;<span class="op" id="6395840">&lt;</span>&nbsp;<span class="num" id="6395842">256</span>&nbsp;<span class="op" id="6395846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395852">for</span>&nbsp;<span class="ident" id="6395856">_</span><span class="op" id="6395857">,</span>&nbsp;<span class="ident" id="6395859">pixel</span>&nbsp;<span class="op" id="6395865">:=</span>&nbsp;<span class="keyword" id="6395868">range</span>&nbsp;<span class="ident" id="6395874">m</span><span class="op" id="6395875">.</span><span class="ident" id="6395876">Pix</span>&nbsp;<span class="op" id="6395880">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395887">if</span>&nbsp;<span class="builtintype" id="6395890">int</span><span class="op" id="6395893">(</span><span class="ident" id="6395894">pixel</span><span class="op" id="6395899">)</span>&nbsp;<span class="op" id="6395901">&gt;=</span>&nbsp;<span class="builtinfunc" id="6395904">len</span><span class="op" id="6395907">(</span><span class="ident" id="6395908">m</span><span class="op" id="6395909">.</span><span class="ident" id="6395910">Palette</span><span class="op" id="6395917">)</span>&nbsp;<span class="op" id="6395919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395927">return</span>&nbsp;<span class="ident" id="6395934">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395962">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395968">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396009">if</span>&nbsp;<span class="ident" id="6396012">d</span><span class="op" id="6396013">.</span><span class="ident" id="6396014">imageFields</span><span class="op" id="6396025">&amp;</span><span class="ident" id="6396026">ifInterlace</span>&nbsp;<span class="op" id="6396038">!=</span>&nbsp;<span class="num" id="6396041">0</span>&nbsp;<span class="op" id="6396043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396049">uninterlace</span><span class="op" id="6396060">(</span><span class="ident" id="6396061">m</span><span class="op" id="6396062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396067">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396073">d</span><span class="op" id="6396074">.</span><span class="ident" id="6396075">image</span>&nbsp;<span class="op" id="6396081">=</span>&nbsp;<span class="builtinfunc" id="6396083">append</span><span class="op" id="6396089">(</span><span class="ident" id="6396090">d</span><span class="op" id="6396091">.</span><span class="ident" id="6396092">image</span><span class="op" id="6396097">,</span>&nbsp;<span class="ident" id="6396099">m</span><span class="op" id="6396100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396105">d</span><span class="op" id="6396106">.</span><span class="ident" id="6396107">delay</span>&nbsp;<span class="op" id="6396113">=</span>&nbsp;<span class="builtinfunc" id="6396115">append</span><span class="op" id="6396121">(</span><span class="ident" id="6396122">d</span><span class="op" id="6396123">.</span><span class="ident" id="6396124">delay</span><span class="op" id="6396129">,</span>&nbsp;<span class="ident" id="6396131">d</span><span class="op" id="6396132">.</span><span class="ident" id="6396133">delayTime</span><span class="op" id="6396142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396147">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396215">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396287">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396348">d</span><span class="op" id="6396349">.</span><span class="ident" id="6396350">delayTime</span>&nbsp;<span class="op" id="6396360">=</span>&nbsp;<span class="num" id="6396362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396367">d</span><span class="op" id="6396368">.</span><span class="ident" id="6396369">hasTransparentIndex</span>&nbsp;<span class="op" id="6396389">=</span>&nbsp;<span class="builtintype" id="6396391">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396400">case</span>&nbsp;<span class="ident" id="6396405">sTrailer</span><span class="op" id="6396413">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396418">if</span>&nbsp;<span class="builtinfunc" id="6396421">len</span><span class="op" id="6396424">(</span><span class="ident" id="6396425">d</span><span class="op" id="6396426">.</span><span class="ident" id="6396427">image</span><span class="op" id="6396432">)</span>&nbsp;<span class="op" id="6396434">==</span>&nbsp;<span class="num" id="6396437">0</span>&nbsp;<span class="op" id="6396439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396445">return</span>&nbsp;<span class="ident" id="6396452">io</span><span class="op" id="6396454">.</span><span class="ident" id="6396455">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396480">return</span>&nbsp;<span class="ident" id="6396487">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396494">default</span><span class="op" id="6396501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396506">return</span>&nbsp;<span class="ident" id="6396513">fmt</span><span class="op" id="6396516">.</span><span class="ident" id="6396517">Errorf</span><span class="op" id="6396523">(</span><span class="string" id="6396524">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6396557">,</span>&nbsp;<span class="ident" id="6396559">c</span><span class="op" id="6396560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396567">}</span><br>
<span class="lineno"></span><span class="op" id="6396569">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6396572">func</span>&nbsp;<span class="op" id="6396577">(</span><span class="ident" id="6396578">d</span>&nbsp;<span class="op" id="6396580">*</span><span class="ident" id="6396581">decoder</span><span class="op" id="6396588">)</span>&nbsp;<span class="ident" id="6396590">readHeaderAndScreenDescriptor</span><span class="op" id="6396619">(</span><span class="op" id="6396620">)</span>&nbsp;<span class="builtintype" id="6396622">error</span>&nbsp;<span class="op" id="6396628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396631">_</span><span class="op" id="6396632">,</span>&nbsp;<span class="ident" id="6396634">err</span>&nbsp;<span class="op" id="6396638">:=</span>&nbsp;<span class="ident" id="6396641">io</span><span class="op" id="6396643">.</span><span class="ident" id="6396644">ReadFull</span><span class="op" id="6396652">(</span><span class="ident" id="6396653">d</span><span class="op" id="6396654">.</span><span class="ident" id="6396655">r</span><span class="op" id="6396656">,</span>&nbsp;<span class="ident" id="6396658">d</span><span class="op" id="6396659">.</span><span class="ident" id="6396660">tmp</span><span class="op" id="6396663">[</span><span class="num" id="6396664">0</span><span class="op" id="6396665">:</span><span class="num" id="6396666">13</span><span class="op" id="6396668">]</span><span class="op" id="6396669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396672">if</span>&nbsp;<span class="ident" id="6396675">err</span>&nbsp;<span class="op" id="6396679">!=</span>&nbsp;<span class="ident" id="6396682">nil</span>&nbsp;<span class="op" id="6396686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396690">return</span>&nbsp;<span class="ident" id="6396697">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396705">d</span><span class="op" id="6396706">.</span><span class="ident" id="6396707">vers</span>&nbsp;<span class="op" id="6396712">=</span>&nbsp;<span class="builtintype" id="6396714">string</span><span class="op" id="6396720">(</span><span class="ident" id="6396721">d</span><span class="op" id="6396722">.</span><span class="ident" id="6396723">tmp</span><span class="op" id="6396726">[</span><span class="num" id="6396727">0</span><span class="op" id="6396728">:</span><span class="num" id="6396729">6</span><span class="op" id="6396730">]</span><span class="op" id="6396731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396734">if</span>&nbsp;<span class="ident" id="6396737">d</span><span class="op" id="6396738">.</span><span class="ident" id="6396739">vers</span>&nbsp;<span class="op" id="6396744">!=</span>&nbsp;<span class="string" id="6396747">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6396756">&amp;&amp;</span>&nbsp;<span class="ident" id="6396759">d</span><span class="op" id="6396760">.</span><span class="ident" id="6396761">vers</span>&nbsp;<span class="op" id="6396766">!=</span>&nbsp;<span class="string" id="6396769">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6396778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396782">return</span>&nbsp;<span class="ident" id="6396789">fmt</span><span class="op" id="6396792">.</span><span class="ident" id="6396793">Errorf</span><span class="op" id="6396799">(</span><span class="string" id="6396800">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6396832">,</span>&nbsp;<span class="ident" id="6396834">d</span><span class="op" id="6396835">.</span><span class="ident" id="6396836">vers</span><span class="op" id="6396840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396843">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396846">d</span><span class="op" id="6396847">.</span><span class="ident" id="6396848">width</span>&nbsp;<span class="op" id="6396854">=</span>&nbsp;<span class="builtintype" id="6396856">int</span><span class="op" id="6396859">(</span><span class="ident" id="6396860">d</span><span class="op" id="6396861">.</span><span class="ident" id="6396862">tmp</span><span class="op" id="6396865">[</span><span class="num" id="6396866">6</span><span class="op" id="6396867">]</span><span class="op" id="6396868">)</span>&nbsp;<span class="op" id="6396870">+</span>&nbsp;<span class="builtintype" id="6396872">int</span><span class="op" id="6396875">(</span><span class="ident" id="6396876">d</span><span class="op" id="6396877">.</span><span class="ident" id="6396878">tmp</span><span class="op" id="6396881">[</span><span class="num" id="6396882">7</span><span class="op" id="6396883">]</span><span class="op" id="6396884">)</span><span class="op" id="6396885">&lt;&lt;</span><span class="num" id="6396887">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396890">d</span><span class="op" id="6396891">.</span><span class="ident" id="6396892">height</span>&nbsp;<span class="op" id="6396899">=</span>&nbsp;<span class="builtintype" id="6396901">int</span><span class="op" id="6396904">(</span><span class="ident" id="6396905">d</span><span class="op" id="6396906">.</span><span class="ident" id="6396907">tmp</span><span class="op" id="6396910">[</span><span class="num" id="6396911">8</span><span class="op" id="6396912">]</span><span class="op" id="6396913">)</span>&nbsp;<span class="op" id="6396915">+</span>&nbsp;<span class="builtintype" id="6396917">int</span><span class="op" id="6396920">(</span><span class="ident" id="6396921">d</span><span class="op" id="6396922">.</span><span class="ident" id="6396923">tmp</span><span class="op" id="6396926">[</span><span class="num" id="6396927">9</span><span class="op" id="6396928">]</span><span class="op" id="6396929">)</span><span class="op" id="6396930">&lt;&lt;</span><span class="num" id="6396932">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396935">d</span><span class="op" id="6396936">.</span><span class="ident" id="6396937">headerFields</span>&nbsp;<span class="op" id="6396950">=</span>&nbsp;<span class="ident" id="6396952">d</span><span class="op" id="6396953">.</span><span class="ident" id="6396954">tmp</span><span class="op" id="6396957">[</span><span class="num" id="6396958">10</span><span class="op" id="6396960">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396963">d</span><span class="op" id="6396964">.</span><span class="ident" id="6396965">backgroundIndex</span>&nbsp;<span class="op" id="6396981">=</span>&nbsp;<span class="ident" id="6396983">d</span><span class="op" id="6396984">.</span><span class="ident" id="6396985">tmp</span><span class="op" id="6396988">[</span><span class="num" id="6396989">11</span><span class="op" id="6396991">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396994">d</span><span class="op" id="6396995">.</span><span class="ident" id="6396996">aspect</span>&nbsp;<span class="op" id="6397003">=</span>&nbsp;<span class="ident" id="6397005">d</span><span class="op" id="6397006">.</span><span class="ident" id="6397007">tmp</span><span class="op" id="6397010">[</span><span class="num" id="6397011">12</span><span class="op" id="6397013">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397016">d</span><span class="op" id="6397017">.</span><span class="ident" id="6397018">loopCount</span>&nbsp;<span class="op" id="6397028">=</span>&nbsp;<span class="op" id="6397030">-</span><span class="num" id="6397031">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397034">d</span><span class="op" id="6397035">.</span><span class="ident" id="6397036">pixelSize</span>&nbsp;<span class="op" id="6397046">=</span>&nbsp;<span class="builtintype" id="6397048">uint</span><span class="op" id="6397052">(</span><span class="ident" id="6397053">d</span><span class="op" id="6397054">.</span><span class="ident" id="6397055">headerFields</span><span class="op" id="6397067">&amp;</span><span class="num" id="6397068">7</span><span class="op" id="6397069">)</span>&nbsp;<span class="op" id="6397071">+</span>&nbsp;<span class="num" id="6397073">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397076">return</span>&nbsp;<span class="ident" id="6397083">nil</span><br>
<span class="lineno"></span><span class="op" id="6397087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6397090">func</span>&nbsp;<span class="op" id="6397095">(</span><span class="ident" id="6397096">d</span>&nbsp;<span class="op" id="6397098">*</span><span class="ident" id="6397099">decoder</span><span class="op" id="6397106">)</span>&nbsp;<span class="ident" id="6397108">readColorMap</span><span class="op" id="6397120">(</span><span class="op" id="6397121">)</span>&nbsp;<span class="op" id="6397123">(</span><span class="ident" id="6397124">color</span><span class="op" id="6397129">.</span><span class="ident" id="6397130">Palette</span><span class="op" id="6397137">,</span>&nbsp;<span class="builtintype" id="6397139">error</span><span class="op" id="6397144">)</span>&nbsp;<span class="op" id="6397146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397149">if</span>&nbsp;<span class="ident" id="6397152">d</span><span class="op" id="6397153">.</span><span class="ident" id="6397154">pixelSize</span>&nbsp;<span class="op" id="6397164">&gt;</span>&nbsp;<span class="num" id="6397166">8</span>&nbsp;<span class="op" id="6397168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397172">return</span>&nbsp;<span class="ident" id="6397179">nil</span><span class="op" id="6397182">,</span>&nbsp;<span class="ident" id="6397184">fmt</span><span class="op" id="6397187">.</span><span class="ident" id="6397188">Errorf</span><span class="op" id="6397194">(</span><span class="string" id="6397195">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6397232">,</span>&nbsp;<span class="ident" id="6397234">d</span><span class="op" id="6397235">.</span><span class="ident" id="6397236">pixelSize</span><span class="op" id="6397245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397251">numColors</span>&nbsp;<span class="op" id="6397261">:=</span>&nbsp;<span class="num" id="6397264">1</span>&nbsp;<span class="op" id="6397266">&lt;&lt;</span>&nbsp;<span class="ident" id="6397269">d</span><span class="op" id="6397270">.</span><span class="ident" id="6397271">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397282">if</span>&nbsp;<span class="ident" id="6397285">d</span><span class="op" id="6397286">.</span><span class="ident" id="6397287">imageFields</span><span class="op" id="6397298">&amp;</span><span class="ident" id="6397299">ifLocalColorTable</span>&nbsp;<span class="op" id="6397317">!=</span>&nbsp;<span class="num" id="6397320">0</span>&nbsp;<span class="op" id="6397322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397326">numColors</span>&nbsp;<span class="op" id="6397336">=</span>&nbsp;<span class="num" id="6397338">1</span>&nbsp;<span class="op" id="6397340">&lt;&lt;</span>&nbsp;<span class="op" id="6397343">(</span><span class="op" id="6397344">(</span><span class="ident" id="6397345">d</span><span class="op" id="6397346">.</span><span class="ident" id="6397347">imageFields</span>&nbsp;<span class="op" id="6397359">&amp;</span>&nbsp;<span class="ident" id="6397361">ifPixelSizeMask</span><span class="op" id="6397376">)</span>&nbsp;<span class="op" id="6397378">+</span>&nbsp;<span class="num" id="6397380">1</span><span class="op" id="6397381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397387">numValues</span>&nbsp;<span class="op" id="6397397">:=</span>&nbsp;<span class="num" id="6397400">3</span>&nbsp;<span class="op" id="6397402">*</span>&nbsp;<span class="ident" id="6397404">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397415">_</span><span class="op" id="6397416">,</span>&nbsp;<span class="ident" id="6397418">err</span>&nbsp;<span class="op" id="6397422">:=</span>&nbsp;<span class="ident" id="6397425">io</span><span class="op" id="6397427">.</span><span class="ident" id="6397428">ReadFull</span><span class="op" id="6397436">(</span><span class="ident" id="6397437">d</span><span class="op" id="6397438">.</span><span class="ident" id="6397439">r</span><span class="op" id="6397440">,</span>&nbsp;<span class="ident" id="6397442">d</span><span class="op" id="6397443">.</span><span class="ident" id="6397444">tmp</span><span class="op" id="6397447">[</span><span class="num" id="6397448">0</span><span class="op" id="6397449">:</span><span class="ident" id="6397450">numValues</span><span class="op" id="6397459">]</span><span class="op" id="6397460">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397463">if</span>&nbsp;<span class="ident" id="6397466">err</span>&nbsp;<span class="op" id="6397470">!=</span>&nbsp;<span class="ident" id="6397473">nil</span>&nbsp;<span class="op" id="6397477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397481">return</span>&nbsp;<span class="ident" id="6397488">nil</span><span class="op" id="6397491">,</span>&nbsp;<span class="ident" id="6397493">fmt</span><span class="op" id="6397496">.</span><span class="ident" id="6397497">Errorf</span><span class="op" id="6397503">(</span><span class="string" id="6397504">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6397538">,</span>&nbsp;<span class="ident" id="6397540">err</span><span class="op" id="6397543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397549">colorMap</span>&nbsp;<span class="op" id="6397558">:=</span>&nbsp;<span class="builtinfunc" id="6397561">make</span><span class="op" id="6397565">(</span><span class="ident" id="6397566">color</span><span class="op" id="6397571">.</span><span class="ident" id="6397572">Palette</span><span class="op" id="6397579">,</span>&nbsp;<span class="ident" id="6397581">numColors</span><span class="op" id="6397590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397593">j</span>&nbsp;<span class="op" id="6397595">:=</span>&nbsp;<span class="num" id="6397598">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397601">for</span>&nbsp;<span class="ident" id="6397605">i</span>&nbsp;<span class="op" id="6397607">:=</span>&nbsp;<span class="keyword" id="6397610">range</span>&nbsp;<span class="ident" id="6397616">colorMap</span>&nbsp;<span class="op" id="6397625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397629">colorMap</span><span class="op" id="6397637">[</span><span class="ident" id="6397638">i</span><span class="op" id="6397639">]</span>&nbsp;<span class="op" id="6397641">=</span>&nbsp;<span class="ident" id="6397643">color</span><span class="op" id="6397648">.</span><span class="ident" id="6397649">RGBA</span><span class="op" id="6397653">{</span><span class="ident" id="6397654">d</span><span class="op" id="6397655">.</span><span class="ident" id="6397656">tmp</span><span class="op" id="6397659">[</span><span class="ident" id="6397660">j</span><span class="op" id="6397661">+</span><span class="num" id="6397662">0</span><span class="op" id="6397663">]</span><span class="op" id="6397664">,</span>&nbsp;<span class="ident" id="6397666">d</span><span class="op" id="6397667">.</span><span class="ident" id="6397668">tmp</span><span class="op" id="6397671">[</span><span class="ident" id="6397672">j</span><span class="op" id="6397673">+</span><span class="num" id="6397674">1</span><span class="op" id="6397675">]</span><span class="op" id="6397676">,</span>&nbsp;<span class="ident" id="6397678">d</span><span class="op" id="6397679">.</span><span class="ident" id="6397680">tmp</span><span class="op" id="6397683">[</span><span class="ident" id="6397684">j</span><span class="op" id="6397685">+</span><span class="num" id="6397686">2</span><span class="op" id="6397687">]</span><span class="op" id="6397688">,</span>&nbsp;<span class="num" id="6397690">0xFF</span><span class="op" id="6397694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397698">j</span>&nbsp;<span class="op" id="6397700">+=</span>&nbsp;<span class="num" id="6397703">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397709">return</span>&nbsp;<span class="ident" id="6397716">colorMap</span><span class="op" id="6397724">,</span>&nbsp;<span class="ident" id="6397726">nil</span><br>
<span class="lineno">295</span><span class="op" id="6397730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6397733">func</span>&nbsp;<span class="op" id="6397738">(</span><span class="ident" id="6397739">d</span>&nbsp;<span class="op" id="6397741">*</span><span class="ident" id="6397742">decoder</span><span class="op" id="6397749">)</span>&nbsp;<span class="ident" id="6397751">readExtension</span><span class="op" id="6397764">(</span><span class="op" id="6397765">)</span>&nbsp;<span class="builtintype" id="6397767">error</span>&nbsp;<span class="op" id="6397773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397776">extension</span><span class="op" id="6397785">,</span>&nbsp;<span class="ident" id="6397787">err</span>&nbsp;<span class="op" id="6397791">:=</span>&nbsp;<span class="ident" id="6397794">d</span><span class="op" id="6397795">.</span><span class="ident" id="6397796">r</span><span class="op" id="6397797">.</span><span class="ident" id="6397798">ReadByte</span><span class="op" id="6397806">(</span><span class="op" id="6397807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397810">if</span>&nbsp;<span class="ident" id="6397813">err</span>&nbsp;<span class="op" id="6397817">!=</span>&nbsp;<span class="ident" id="6397820">nil</span>&nbsp;<span class="op" id="6397824">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397828">return</span>&nbsp;<span class="ident" id="6397835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397843">size</span>&nbsp;<span class="op" id="6397848">:=</span>&nbsp;<span class="num" id="6397851">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397854">switch</span>&nbsp;<span class="ident" id="6397861">extension</span>&nbsp;<span class="op" id="6397871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397874">case</span>&nbsp;<span class="ident" id="6397879">eText</span><span class="op" id="6397884">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397888">size</span>&nbsp;<span class="op" id="6397893">=</span>&nbsp;<span class="num" id="6397895">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397899">case</span>&nbsp;<span class="ident" id="6397904">eGraphicControl</span><span class="op" id="6397919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397923">return</span>&nbsp;<span class="ident" id="6397930">d</span><span class="op" id="6397931">.</span><span class="ident" id="6397932">readGraphicControl</span><span class="op" id="6397950">(</span><span class="op" id="6397951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397954">case</span>&nbsp;<span class="ident" id="6397959">eComment</span><span class="op" id="6397967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397971">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398008">case</span>&nbsp;<span class="ident" id="6398013">eApplication</span><span class="op" id="6398025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398029">b</span><span class="op" id="6398030">,</span>&nbsp;<span class="ident" id="6398032">err</span>&nbsp;<span class="op" id="6398036">:=</span>&nbsp;<span class="ident" id="6398039">d</span><span class="op" id="6398040">.</span><span class="ident" id="6398041">r</span><span class="op" id="6398042">.</span><span class="ident" id="6398043">ReadByte</span><span class="op" id="6398051">(</span><span class="op" id="6398052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398056">if</span>&nbsp;<span class="ident" id="6398059">err</span>&nbsp;<span class="op" id="6398063">!=</span>&nbsp;<span class="ident" id="6398066">nil</span>&nbsp;<span class="op" id="6398070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398075">return</span>&nbsp;<span class="ident" id="6398082">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398088">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398092">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398156">size</span>&nbsp;<span class="op" id="6398161">=</span>&nbsp;<span class="builtintype" id="6398163">int</span><span class="op" id="6398166">(</span><span class="ident" id="6398167">b</span><span class="op" id="6398168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398171">default</span><span class="op" id="6398178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398182">return</span>&nbsp;<span class="ident" id="6398189">fmt</span><span class="op" id="6398192">.</span><span class="ident" id="6398193">Errorf</span><span class="op" id="6398199">(</span><span class="string" id="6398200">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6398231">,</span>&nbsp;<span class="ident" id="6398233">extension</span><span class="op" id="6398242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398245">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398248">if</span>&nbsp;<span class="ident" id="6398251">size</span>&nbsp;<span class="op" id="6398256">&gt;</span>&nbsp;<span class="num" id="6398258">0</span>&nbsp;<span class="op" id="6398260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398264">if</span>&nbsp;<span class="ident" id="6398267">_</span><span class="op" id="6398268">,</span>&nbsp;<span class="ident" id="6398270">err</span>&nbsp;<span class="op" id="6398274">:=</span>&nbsp;<span class="ident" id="6398277">io</span><span class="op" id="6398279">.</span><span class="ident" id="6398280">ReadFull</span><span class="op" id="6398288">(</span><span class="ident" id="6398289">d</span><span class="op" id="6398290">.</span><span class="ident" id="6398291">r</span><span class="op" id="6398292">,</span>&nbsp;<span class="ident" id="6398294">d</span><span class="op" id="6398295">.</span><span class="ident" id="6398296">tmp</span><span class="op" id="6398299">[</span><span class="num" id="6398300">0</span><span class="op" id="6398301">:</span><span class="ident" id="6398302">size</span><span class="op" id="6398306">]</span><span class="op" id="6398307">)</span><span class="op" id="6398308">;</span>&nbsp;<span class="ident" id="6398310">err</span>&nbsp;<span class="op" id="6398314">!=</span>&nbsp;<span class="ident" id="6398317">nil</span>&nbsp;<span class="op" id="6398321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398326">return</span>&nbsp;<span class="ident" id="6398333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398342">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398346">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398421">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398462">if</span>&nbsp;<span class="ident" id="6398465">extension</span>&nbsp;<span class="op" id="6398475">==</span>&nbsp;<span class="ident" id="6398478">eApplication</span>&nbsp;<span class="op" id="6398491">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6398494">string</span><span class="op" id="6398500">(</span><span class="ident" id="6398501">d</span><span class="op" id="6398502">.</span><span class="ident" id="6398503">tmp</span><span class="op" id="6398506">[</span><span class="op" id="6398507">:</span><span class="ident" id="6398508">size</span><span class="op" id="6398512">]</span><span class="op" id="6398513">)</span>&nbsp;<span class="op" id="6398515">==</span>&nbsp;<span class="string" id="6398518">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6398532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398536">n</span><span class="op" id="6398537">,</span>&nbsp;<span class="ident" id="6398539">err</span>&nbsp;<span class="op" id="6398543">:=</span>&nbsp;<span class="ident" id="6398546">d</span><span class="op" id="6398547">.</span><span class="ident" id="6398548">readBlock</span><span class="op" id="6398557">(</span><span class="op" id="6398558">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398562">if</span>&nbsp;<span class="ident" id="6398565">n</span>&nbsp;<span class="op" id="6398567">==</span>&nbsp;<span class="num" id="6398570">0</span>&nbsp;<span class="op" id="6398572">||</span>&nbsp;<span class="ident" id="6398575">err</span>&nbsp;<span class="op" id="6398579">!=</span>&nbsp;<span class="ident" id="6398582">nil</span>&nbsp;<span class="op" id="6398586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398591">return</span>&nbsp;<span class="ident" id="6398598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398608">if</span>&nbsp;<span class="ident" id="6398611">n</span>&nbsp;<span class="op" id="6398613">==</span>&nbsp;<span class="num" id="6398616">3</span>&nbsp;<span class="op" id="6398618">&amp;&amp;</span>&nbsp;<span class="ident" id="6398621">d</span><span class="op" id="6398622">.</span><span class="ident" id="6398623">tmp</span><span class="op" id="6398626">[</span><span class="num" id="6398627">0</span><span class="op" id="6398628">]</span>&nbsp;<span class="op" id="6398630">==</span>&nbsp;<span class="num" id="6398633">1</span>&nbsp;<span class="op" id="6398635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398640">d</span><span class="op" id="6398641">.</span><span class="ident" id="6398642">loopCount</span>&nbsp;<span class="op" id="6398652">=</span>&nbsp;<span class="builtintype" id="6398654">int</span><span class="op" id="6398657">(</span><span class="ident" id="6398658">d</span><span class="op" id="6398659">.</span><span class="ident" id="6398660">tmp</span><span class="op" id="6398663">[</span><span class="num" id="6398664">1</span><span class="op" id="6398665">]</span><span class="op" id="6398666">)</span>&nbsp;<span class="op" id="6398668">|</span>&nbsp;<span class="builtintype" id="6398670">int</span><span class="op" id="6398673">(</span><span class="ident" id="6398674">d</span><span class="op" id="6398675">.</span><span class="ident" id="6398676">tmp</span><span class="op" id="6398679">[</span><span class="num" id="6398680">2</span><span class="op" id="6398681">]</span><span class="op" id="6398682">)</span><span class="op" id="6398683">&lt;&lt;</span><span class="num" id="6398685">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398695">for</span>&nbsp;<span class="op" id="6398699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398703">n</span><span class="op" id="6398704">,</span>&nbsp;<span class="ident" id="6398706">err</span>&nbsp;<span class="op" id="6398710">:=</span>&nbsp;<span class="ident" id="6398713">d</span><span class="op" id="6398714">.</span><span class="ident" id="6398715">readBlock</span><span class="op" id="6398724">(</span><span class="op" id="6398725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398729">if</span>&nbsp;<span class="ident" id="6398732">n</span>&nbsp;<span class="op" id="6398734">==</span>&nbsp;<span class="num" id="6398737">0</span>&nbsp;<span class="op" id="6398739">||</span>&nbsp;<span class="ident" id="6398742">err</span>&nbsp;<span class="op" id="6398746">!=</span>&nbsp;<span class="ident" id="6398749">nil</span>&nbsp;<span class="op" id="6398753">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398758">return</span>&nbsp;<span class="ident" id="6398765">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398774">}</span><br>
<span class="lineno"></span><span class="op" id="6398776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6398779">func</span>&nbsp;<span class="op" id="6398784">(</span><span class="ident" id="6398785">d</span>&nbsp;<span class="op" id="6398787">*</span><span class="ident" id="6398788">decoder</span><span class="op" id="6398795">)</span>&nbsp;<span class="ident" id="6398797">readGraphicControl</span><span class="op" id="6398815">(</span><span class="op" id="6398816">)</span>&nbsp;<span class="builtintype" id="6398818">error</span>&nbsp;<span class="op" id="6398824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398827">if</span>&nbsp;<span class="ident" id="6398830">_</span><span class="op" id="6398831">,</span>&nbsp;<span class="ident" id="6398833">err</span>&nbsp;<span class="op" id="6398837">:=</span>&nbsp;<span class="ident" id="6398840">io</span><span class="op" id="6398842">.</span><span class="ident" id="6398843">ReadFull</span><span class="op" id="6398851">(</span><span class="ident" id="6398852">d</span><span class="op" id="6398853">.</span><span class="ident" id="6398854">r</span><span class="op" id="6398855">,</span>&nbsp;<span class="ident" id="6398857">d</span><span class="op" id="6398858">.</span><span class="ident" id="6398859">tmp</span><span class="op" id="6398862">[</span><span class="num" id="6398863">0</span><span class="op" id="6398864">:</span><span class="num" id="6398865">6</span><span class="op" id="6398866">]</span><span class="op" id="6398867">)</span><span class="op" id="6398868">;</span>&nbsp;<span class="ident" id="6398870">err</span>&nbsp;<span class="op" id="6398874">!=</span>&nbsp;<span class="ident" id="6398877">nil</span>&nbsp;<span class="op" id="6398881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398885">return</span>&nbsp;<span class="ident" id="6398892">fmt</span><span class="op" id="6398895">.</span><span class="ident" id="6398896">Errorf</span><span class="op" id="6398902">(</span><span class="string" id="6398903">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6398940">,</span>&nbsp;<span class="ident" id="6398942">err</span><span class="op" id="6398945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398951">d</span><span class="op" id="6398952">.</span><span class="ident" id="6398953">flags</span>&nbsp;<span class="op" id="6398959">=</span>&nbsp;<span class="ident" id="6398961">d</span><span class="op" id="6398962">.</span><span class="ident" id="6398963">tmp</span><span class="op" id="6398966">[</span><span class="num" id="6398967">1</span><span class="op" id="6398968">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398971">d</span><span class="op" id="6398972">.</span><span class="ident" id="6398973">delayTime</span>&nbsp;<span class="op" id="6398983">=</span>&nbsp;<span class="builtintype" id="6398985">int</span><span class="op" id="6398988">(</span><span class="ident" id="6398989">d</span><span class="op" id="6398990">.</span><span class="ident" id="6398991">tmp</span><span class="op" id="6398994">[</span><span class="num" id="6398995">2</span><span class="op" id="6398996">]</span><span class="op" id="6398997">)</span>&nbsp;<span class="op" id="6398999">|</span>&nbsp;<span class="builtintype" id="6399001">int</span><span class="op" id="6399004">(</span><span class="ident" id="6399005">d</span><span class="op" id="6399006">.</span><span class="ident" id="6399007">tmp</span><span class="op" id="6399010">[</span><span class="num" id="6399011">3</span><span class="op" id="6399012">]</span><span class="op" id="6399013">)</span><span class="op" id="6399014">&lt;&lt;</span><span class="num" id="6399016">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399019">if</span>&nbsp;<span class="ident" id="6399022">d</span><span class="op" id="6399023">.</span><span class="ident" id="6399024">flags</span><span class="op" id="6399029">&amp;</span><span class="ident" id="6399030">gcTransparentColorSet</span>&nbsp;<span class="op" id="6399052">!=</span>&nbsp;<span class="num" id="6399055">0</span>&nbsp;<span class="op" id="6399057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399061">d</span><span class="op" id="6399062">.</span><span class="ident" id="6399063">transparentIndex</span>&nbsp;<span class="op" id="6399080">=</span>&nbsp;<span class="ident" id="6399082">d</span><span class="op" id="6399083">.</span><span class="ident" id="6399084">tmp</span><span class="op" id="6399087">[</span><span class="num" id="6399088">4</span><span class="op" id="6399089">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399093">d</span><span class="op" id="6399094">.</span><span class="ident" id="6399095">hasTransparentIndex</span>&nbsp;<span class="op" id="6399115">=</span>&nbsp;<span class="builtintype" id="6399117">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399123">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399126">return</span>&nbsp;<span class="ident" id="6399133">nil</span><br>
<span class="lineno"></span><span class="op" id="6399137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6399140">func</span>&nbsp;<span class="op" id="6399145">(</span><span class="ident" id="6399146">d</span>&nbsp;<span class="op" id="6399148">*</span><span class="ident" id="6399149">decoder</span><span class="op" id="6399156">)</span>&nbsp;<span class="ident" id="6399158">newImageFromDescriptor</span><span class="op" id="6399180">(</span><span class="op" id="6399181">)</span>&nbsp;<span class="op" id="6399183">(</span><span class="op" id="6399184">*</span><span class="ident" id="6399185">image</span><span class="op" id="6399190">.</span><span class="ident" id="6399191">Paletted</span><span class="op" id="6399199">,</span>&nbsp;<span class="builtintype" id="6399201">error</span><span class="op" id="6399206">)</span>&nbsp;<span class="op" id="6399208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399211">if</span>&nbsp;<span class="ident" id="6399214">_</span><span class="op" id="6399215">,</span>&nbsp;<span class="ident" id="6399217">err</span>&nbsp;<span class="op" id="6399221">:=</span>&nbsp;<span class="ident" id="6399224">io</span><span class="op" id="6399226">.</span><span class="ident" id="6399227">ReadFull</span><span class="op" id="6399235">(</span><span class="ident" id="6399236">d</span><span class="op" id="6399237">.</span><span class="ident" id="6399238">r</span><span class="op" id="6399239">,</span>&nbsp;<span class="ident" id="6399241">d</span><span class="op" id="6399242">.</span><span class="ident" id="6399243">tmp</span><span class="op" id="6399246">[</span><span class="num" id="6399247">0</span><span class="op" id="6399248">:</span><span class="num" id="6399249">9</span><span class="op" id="6399250">]</span><span class="op" id="6399251">)</span><span class="op" id="6399252">;</span>&nbsp;<span class="ident" id="6399254">err</span>&nbsp;<span class="op" id="6399258">!=</span>&nbsp;<span class="ident" id="6399261">nil</span>&nbsp;<span class="op" id="6399265">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399269">return</span>&nbsp;<span class="ident" id="6399276">nil</span><span class="op" id="6399279">,</span>&nbsp;<span class="ident" id="6399281">fmt</span><span class="op" id="6399284">.</span><span class="ident" id="6399285">Errorf</span><span class="op" id="6399291">(</span><span class="string" id="6399292">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6399330">,</span>&nbsp;<span class="ident" id="6399332">err</span><span class="op" id="6399335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399341">left</span>&nbsp;<span class="op" id="6399346">:=</span>&nbsp;<span class="builtintype" id="6399349">int</span><span class="op" id="6399352">(</span><span class="ident" id="6399353">d</span><span class="op" id="6399354">.</span><span class="ident" id="6399355">tmp</span><span class="op" id="6399358">[</span><span class="num" id="6399359">0</span><span class="op" id="6399360">]</span><span class="op" id="6399361">)</span>&nbsp;<span class="op" id="6399363">+</span>&nbsp;<span class="builtintype" id="6399365">int</span><span class="op" id="6399368">(</span><span class="ident" id="6399369">d</span><span class="op" id="6399370">.</span><span class="ident" id="6399371">tmp</span><span class="op" id="6399374">[</span><span class="num" id="6399375">1</span><span class="op" id="6399376">]</span><span class="op" id="6399377">)</span><span class="op" id="6399378">&lt;&lt;</span><span class="num" id="6399380">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399383">top</span>&nbsp;<span class="op" id="6399387">:=</span>&nbsp;<span class="builtintype" id="6399390">int</span><span class="op" id="6399393">(</span><span class="ident" id="6399394">d</span><span class="op" id="6399395">.</span><span class="ident" id="6399396">tmp</span><span class="op" id="6399399">[</span><span class="num" id="6399400">2</span><span class="op" id="6399401">]</span><span class="op" id="6399402">)</span>&nbsp;<span class="op" id="6399404">+</span>&nbsp;<span class="builtintype" id="6399406">int</span><span class="op" id="6399409">(</span><span class="ident" id="6399410">d</span><span class="op" id="6399411">.</span><span class="ident" id="6399412">tmp</span><span class="op" id="6399415">[</span><span class="num" id="6399416">3</span><span class="op" id="6399417">]</span><span class="op" id="6399418">)</span><span class="op" id="6399419">&lt;&lt;</span><span class="num" id="6399421">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399424">width</span>&nbsp;<span class="op" id="6399430">:=</span>&nbsp;<span class="builtintype" id="6399433">int</span><span class="op" id="6399436">(</span><span class="ident" id="6399437">d</span><span class="op" id="6399438">.</span><span class="ident" id="6399439">tmp</span><span class="op" id="6399442">[</span><span class="num" id="6399443">4</span><span class="op" id="6399444">]</span><span class="op" id="6399445">)</span>&nbsp;<span class="op" id="6399447">+</span>&nbsp;<span class="builtintype" id="6399449">int</span><span class="op" id="6399452">(</span><span class="ident" id="6399453">d</span><span class="op" id="6399454">.</span><span class="ident" id="6399455">tmp</span><span class="op" id="6399458">[</span><span class="num" id="6399459">5</span><span class="op" id="6399460">]</span><span class="op" id="6399461">)</span><span class="op" id="6399462">&lt;&lt;</span><span class="num" id="6399464">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399467">height</span>&nbsp;<span class="op" id="6399474">:=</span>&nbsp;<span class="builtintype" id="6399477">int</span><span class="op" id="6399480">(</span><span class="ident" id="6399481">d</span><span class="op" id="6399482">.</span><span class="ident" id="6399483">tmp</span><span class="op" id="6399486">[</span><span class="num" id="6399487">6</span><span class="op" id="6399488">]</span><span class="op" id="6399489">)</span>&nbsp;<span class="op" id="6399491">+</span>&nbsp;<span class="builtintype" id="6399493">int</span><span class="op" id="6399496">(</span><span class="ident" id="6399497">d</span><span class="op" id="6399498">.</span><span class="ident" id="6399499">tmp</span><span class="op" id="6399502">[</span><span class="num" id="6399503">7</span><span class="op" id="6399504">]</span><span class="op" id="6399505">)</span><span class="op" id="6399506">&lt;&lt;</span><span class="num" id="6399508">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399511">d</span><span class="op" id="6399512">.</span><span class="ident" id="6399513">imageFields</span>&nbsp;<span class="op" id="6399525">=</span>&nbsp;<span class="ident" id="6399527">d</span><span class="op" id="6399528">.</span><span class="ident" id="6399529">tmp</span><span class="op" id="6399532">[</span><span class="num" id="6399533">8</span><span class="op" id="6399534">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399538">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399595">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399657">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399715">bounds</span>&nbsp;<span class="op" id="6399722">:=</span>&nbsp;<span class="ident" id="6399725">image</span><span class="op" id="6399730">.</span><span class="ident" id="6399731">Rect</span><span class="op" id="6399735">(</span><span class="ident" id="6399736">left</span><span class="op" id="6399740">,</span>&nbsp;<span class="ident" id="6399742">top</span><span class="op" id="6399745">,</span>&nbsp;<span class="ident" id="6399747">left</span><span class="op" id="6399751">+</span><span class="ident" id="6399752">width</span><span class="op" id="6399757">,</span>&nbsp;<span class="ident" id="6399759">top</span><span class="op" id="6399762">+</span><span class="ident" id="6399763">height</span><span class="op" id="6399769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399772">if</span>&nbsp;<span class="ident" id="6399775">bounds</span>&nbsp;<span class="op" id="6399782">!=</span>&nbsp;<span class="ident" id="6399785">bounds</span><span class="op" id="6399791">.</span><span class="ident" id="6399792">Intersect</span><span class="op" id="6399801">(</span><span class="ident" id="6399802">image</span><span class="op" id="6399807">.</span><span class="ident" id="6399808">Rect</span><span class="op" id="6399812">(</span><span class="num" id="6399813">0</span><span class="op" id="6399814">,</span>&nbsp;<span class="num" id="6399816">0</span><span class="op" id="6399817">,</span>&nbsp;<span class="ident" id="6399819">d</span><span class="op" id="6399820">.</span><span class="ident" id="6399821">width</span><span class="op" id="6399826">,</span>&nbsp;<span class="ident" id="6399828">d</span><span class="op" id="6399829">.</span><span class="ident" id="6399830">height</span><span class="op" id="6399836">)</span><span class="op" id="6399837">)</span>&nbsp;<span class="op" id="6399839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399843">return</span>&nbsp;<span class="ident" id="6399850">nil</span><span class="op" id="6399853">,</span>&nbsp;<span class="ident" id="6399855">errors</span><span class="op" id="6399861">.</span><span class="ident" id="6399862">New</span><span class="op" id="6399865">(</span><span class="string" id="6399866">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6399910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399913">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399916">return</span>&nbsp;<span class="ident" id="6399923">image</span><span class="op" id="6399928">.</span><span class="ident" id="6399929">NewPaletted</span><span class="op" id="6399940">(</span><span class="ident" id="6399941">bounds</span><span class="op" id="6399947">,</span>&nbsp;<span class="ident" id="6399949">nil</span><span class="op" id="6399952">)</span><span class="op" id="6399953">,</span>&nbsp;<span class="ident" id="6399955">nil</span><br>
<span class="lineno"></span><span class="op" id="6399959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6399962">func</span>&nbsp;<span class="op" id="6399967">(</span><span class="ident" id="6399968">d</span>&nbsp;<span class="op" id="6399970">*</span><span class="ident" id="6399971">decoder</span><span class="op" id="6399978">)</span>&nbsp;<span class="ident" id="6399980">readBlock</span><span class="op" id="6399989">(</span><span class="op" id="6399990">)</span>&nbsp;<span class="op" id="6399992">(</span><span class="builtintype" id="6399993">int</span><span class="op" id="6399996">,</span>&nbsp;<span class="builtintype" id="6399998">error</span><span class="op" id="6400003">)</span>&nbsp;<span class="op" id="6400005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400008">n</span><span class="op" id="6400009">,</span>&nbsp;<span class="ident" id="6400011">err</span>&nbsp;<span class="op" id="6400015">:=</span>&nbsp;<span class="ident" id="6400018">d</span><span class="op" id="6400019">.</span><span class="ident" id="6400020">r</span><span class="op" id="6400021">.</span><span class="ident" id="6400022">ReadByte</span><span class="op" id="6400030">(</span><span class="op" id="6400031">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400034">if</span>&nbsp;<span class="ident" id="6400037">n</span>&nbsp;<span class="op" id="6400039">==</span>&nbsp;<span class="num" id="6400042">0</span>&nbsp;<span class="op" id="6400044">||</span>&nbsp;<span class="ident" id="6400047">err</span>&nbsp;<span class="op" id="6400051">!=</span>&nbsp;<span class="ident" id="6400054">nil</span>&nbsp;<span class="op" id="6400058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400062">return</span>&nbsp;<span class="num" id="6400069">0</span><span class="op" id="6400070">,</span>&nbsp;<span class="ident" id="6400072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400080">return</span>&nbsp;<span class="ident" id="6400087">io</span><span class="op" id="6400089">.</span><span class="ident" id="6400090">ReadFull</span><span class="op" id="6400098">(</span><span class="ident" id="6400099">d</span><span class="op" id="6400100">.</span><span class="ident" id="6400101">r</span><span class="op" id="6400102">,</span>&nbsp;<span class="ident" id="6400104">d</span><span class="op" id="6400105">.</span><span class="ident" id="6400106">tmp</span><span class="op" id="6400109">[</span><span class="num" id="6400110">0</span><span class="op" id="6400111">:</span><span class="ident" id="6400112">n</span><span class="op" id="6400113">]</span><span class="op" id="6400114">)</span><br>
<span class="lineno"></span><span class="op" id="6400116">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6400119">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6400196">type</span>&nbsp;<span class="ident" id="6400201">interlaceScan</span>&nbsp;<span class="keyword" id="6400215">struct</span>&nbsp;<span class="op" id="6400222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400225">skip</span><span class="op" id="6400229">,</span>&nbsp;<span class="ident" id="6400231">start</span>&nbsp;<span class="builtintype" id="6400237">int</span><br>
<span class="lineno"></span><span class="op" id="6400241">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6400244">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6400315">var</span>&nbsp;<span class="ident" id="6400319">interlacing</span>&nbsp;<span class="op" id="6400331">=</span>&nbsp;<span class="op" id="6400333">[</span><span class="op" id="6400334">]</span><span class="ident" id="6400335">interlaceScan</span><span class="op" id="6400348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400351">{</span><span class="num" id="6400352">8</span><span class="op" id="6400353">,</span>&nbsp;<span class="num" id="6400355">0</span><span class="op" id="6400356">}</span><span class="op" id="6400357">,</span>&nbsp;<span class="comment" id="6400359">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400410">{</span><span class="num" id="6400411">8</span><span class="op" id="6400412">,</span>&nbsp;<span class="num" id="6400414">4</span><span class="op" id="6400415">}</span><span class="op" id="6400416">,</span>&nbsp;<span class="comment" id="6400418">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400469">{</span><span class="num" id="6400470">4</span><span class="op" id="6400471">,</span>&nbsp;<span class="num" id="6400473">2</span><span class="op" id="6400474">}</span><span class="op" id="6400475">,</span>&nbsp;<span class="comment" id="6400477">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400528">{</span><span class="num" id="6400529">2</span><span class="op" id="6400530">,</span>&nbsp;<span class="num" id="6400532">1</span><span class="op" id="6400533">}</span><span class="op" id="6400534">,</span>&nbsp;<span class="comment" id="6400536">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6400586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6400589">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6400664">func</span>&nbsp;<span class="ident" id="6400669">uninterlace</span><span class="op" id="6400680">(</span><span class="ident" id="6400681">m</span>&nbsp;<span class="op" id="6400683">*</span><span class="ident" id="6400684">image</span><span class="op" id="6400689">.</span><span class="ident" id="6400690">Paletted</span><span class="op" id="6400698">)</span>&nbsp;<span class="op" id="6400700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400703">var</span>&nbsp;<span class="ident" id="6400707">nPix</span>&nbsp;<span class="op" id="6400712">[</span><span class="op" id="6400713">]</span><span class="builtintype" id="6400714">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400721">dx</span>&nbsp;<span class="op" id="6400724">:=</span>&nbsp;<span class="ident" id="6400727">m</span><span class="op" id="6400728">.</span><span class="ident" id="6400729">Bounds</span><span class="op" id="6400735">(</span><span class="op" id="6400736">)</span><span class="op" id="6400737">.</span><span class="ident" id="6400738">Dx</span><span class="op" id="6400740">(</span><span class="op" id="6400741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400744">dy</span>&nbsp;<span class="op" id="6400747">:=</span>&nbsp;<span class="ident" id="6400750">m</span><span class="op" id="6400751">.</span><span class="ident" id="6400752">Bounds</span><span class="op" id="6400758">(</span><span class="op" id="6400759">)</span><span class="op" id="6400760">.</span><span class="ident" id="6400761">Dy</span><span class="op" id="6400763">(</span><span class="op" id="6400764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400767">nPix</span>&nbsp;<span class="op" id="6400772">=</span>&nbsp;<span class="builtinfunc" id="6400774">make</span><span class="op" id="6400778">(</span><span class="op" id="6400779">[</span><span class="op" id="6400780">]</span><span class="builtintype" id="6400781">uint8</span><span class="op" id="6400786">,</span>&nbsp;<span class="ident" id="6400788">dx</span><span class="op" id="6400790">*</span><span class="ident" id="6400791">dy</span><span class="op" id="6400793">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400796">offset</span>&nbsp;<span class="op" id="6400803">:=</span>&nbsp;<span class="num" id="6400806">0</span>&nbsp;<span class="comment" id="6400808">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400862">for</span>&nbsp;<span class="ident" id="6400866">_</span><span class="op" id="6400867">,</span>&nbsp;<span class="ident" id="6400869">pass</span>&nbsp;<span class="op" id="6400874">:=</span>&nbsp;<span class="keyword" id="6400877">range</span>&nbsp;<span class="ident" id="6400883">interlacing</span>&nbsp;<span class="op" id="6400895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400899">nOffset</span>&nbsp;<span class="op" id="6400907">:=</span>&nbsp;<span class="ident" id="6400910">pass</span><span class="op" id="6400914">.</span><span class="ident" id="6400915">start</span>&nbsp;<span class="op" id="6400921">*</span>&nbsp;<span class="ident" id="6400923">dx</span>&nbsp;<span class="comment" id="6400926">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400976">for</span>&nbsp;<span class="ident" id="6400980">y</span>&nbsp;<span class="op" id="6400982">:=</span>&nbsp;<span class="ident" id="6400985">pass</span><span class="op" id="6400989">.</span><span class="ident" id="6400990">start</span><span class="op" id="6400995">;</span>&nbsp;<span class="ident" id="6400997">y</span>&nbsp;<span class="op" id="6400999">&lt;</span>&nbsp;<span class="ident" id="6401001">dy</span><span class="op" id="6401003">;</span>&nbsp;<span class="ident" id="6401005">y</span>&nbsp;<span class="op" id="6401007">+=</span>&nbsp;<span class="ident" id="6401010">pass</span><span class="op" id="6401014">.</span><span class="ident" id="6401015">skip</span>&nbsp;<span class="op" id="6401020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6401025">copy</span><span class="op" id="6401029">(</span><span class="ident" id="6401030">nPix</span><span class="op" id="6401034">[</span><span class="ident" id="6401035">nOffset</span><span class="op" id="6401042">:</span><span class="ident" id="6401043">nOffset</span><span class="op" id="6401050">+</span><span class="ident" id="6401051">dx</span><span class="op" id="6401053">]</span><span class="op" id="6401054">,</span>&nbsp;<span class="ident" id="6401056">m</span><span class="op" id="6401057">.</span><span class="ident" id="6401058">Pix</span><span class="op" id="6401061">[</span><span class="ident" id="6401062">offset</span><span class="op" id="6401068">:</span><span class="ident" id="6401069">offset</span><span class="op" id="6401075">+</span><span class="ident" id="6401076">dx</span><span class="op" id="6401078">]</span><span class="op" id="6401079">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401084">offset</span>&nbsp;<span class="op" id="6401091">+=</span>&nbsp;<span class="ident" id="6401094">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401100">nOffset</span>&nbsp;<span class="op" id="6401108">+=</span>&nbsp;<span class="ident" id="6401111">dx</span>&nbsp;<span class="op" id="6401114">*</span>&nbsp;<span class="ident" id="6401116">pass</span><span class="op" id="6401120">.</span><span class="ident" id="6401121">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401134">m</span><span class="op" id="6401135">.</span><span class="ident" id="6401136">Pix</span>&nbsp;<span class="op" id="6401140">=</span>&nbsp;<span class="ident" id="6401142">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6401147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401150">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6401216">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6401244">func</span>&nbsp;<span class="ident" id="6401249">Decode</span><span class="op" id="6401255">(</span><span class="ident" id="6401256">r</span>&nbsp;<span class="ident" id="6401258">io</span><span class="op" id="6401260">.</span><span class="ident" id="6401261">Reader</span><span class="op" id="6401267">)</span>&nbsp;<span class="op" id="6401269">(</span><span class="ident" id="6401270">image</span><span class="op" id="6401275">.</span><span class="ident" id="6401276">Image</span><span class="op" id="6401281">,</span>&nbsp;<span class="builtintype" id="6401283">error</span><span class="op" id="6401288">)</span>&nbsp;<span class="op" id="6401290">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401293">var</span>&nbsp;<span class="ident" id="6401297">d</span>&nbsp;<span class="ident" id="6401299">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401308">if</span>&nbsp;<span class="ident" id="6401311">err</span>&nbsp;<span class="op" id="6401315">:=</span>&nbsp;<span class="ident" id="6401318">d</span><span class="op" id="6401319">.</span><span class="ident" id="6401320">decode</span><span class="op" id="6401326">(</span><span class="ident" id="6401327">r</span><span class="op" id="6401328">,</span>&nbsp;<span class="builtintype" id="6401330">false</span><span class="op" id="6401335">)</span><span class="op" id="6401336">;</span>&nbsp;<span class="ident" id="6401338">err</span>&nbsp;<span class="op" id="6401342">!=</span>&nbsp;<span class="ident" id="6401345">nil</span>&nbsp;<span class="op" id="6401349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401353">return</span>&nbsp;<span class="ident" id="6401360">nil</span><span class="op" id="6401363">,</span>&nbsp;<span class="ident" id="6401365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401373">return</span>&nbsp;<span class="ident" id="6401380">d</span><span class="op" id="6401381">.</span><span class="ident" id="6401382">image</span><span class="op" id="6401387">[</span><span class="num" id="6401388">0</span><span class="op" id="6401389">]</span><span class="op" id="6401390">,</span>&nbsp;<span class="ident" id="6401392">nil</span><br>
<span class="lineno">425</span><span class="op" id="6401396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401399">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6401468">type</span>&nbsp;<span class="ident" id="6401473">GIF</span>&nbsp;<span class="keyword" id="6401477">struct</span>&nbsp;<span class="op" id="6401484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401487">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6401497">[</span><span class="op" id="6401498">]</span><span class="op" id="6401499">*</span><span class="ident" id="6401500">image</span><span class="op" id="6401505">.</span><span class="ident" id="6401506">Paletted</span>&nbsp;<span class="comment" id="6401515">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401542">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6401552">[</span><span class="op" id="6401553">]</span><span class="builtintype" id="6401554">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6401570">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401640">LoopCount</span>&nbsp;<span class="builtintype" id="6401650">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6401668">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6401687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401690">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6401762">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6401789">func</span>&nbsp;<span class="ident" id="6401794">DecodeAll</span><span class="op" id="6401803">(</span><span class="ident" id="6401804">r</span>&nbsp;<span class="ident" id="6401806">io</span><span class="op" id="6401808">.</span><span class="ident" id="6401809">Reader</span><span class="op" id="6401815">)</span>&nbsp;<span class="op" id="6401817">(</span><span class="op" id="6401818">*</span><span class="ident" id="6401819">GIF</span><span class="op" id="6401822">,</span>&nbsp;<span class="builtintype" id="6401824">error</span><span class="op" id="6401829">)</span>&nbsp;<span class="op" id="6401831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401834">var</span>&nbsp;<span class="ident" id="6401838">d</span>&nbsp;<span class="ident" id="6401840">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401849">if</span>&nbsp;<span class="ident" id="6401852">err</span>&nbsp;<span class="op" id="6401856">:=</span>&nbsp;<span class="ident" id="6401859">d</span><span class="op" id="6401860">.</span><span class="ident" id="6401861">decode</span><span class="op" id="6401867">(</span><span class="ident" id="6401868">r</span><span class="op" id="6401869">,</span>&nbsp;<span class="builtintype" id="6401871">false</span><span class="op" id="6401876">)</span><span class="op" id="6401877">;</span>&nbsp;<span class="ident" id="6401879">err</span>&nbsp;<span class="op" id="6401883">!=</span>&nbsp;<span class="ident" id="6401886">nil</span>&nbsp;<span class="op" id="6401890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401894">return</span>&nbsp;<span class="ident" id="6401901">nil</span><span class="op" id="6401904">,</span>&nbsp;<span class="ident" id="6401906">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401914">gif</span>&nbsp;<span class="op" id="6401918">:=</span>&nbsp;<span class="op" id="6401921">&amp;</span><span class="ident" id="6401922">GIF</span><span class="op" id="6401925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401929">Image</span><span class="op" id="6401934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6401940">d</span><span class="op" id="6401941">.</span><span class="ident" id="6401942">image</span><span class="op" id="6401947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401951">LoopCount</span><span class="op" id="6401960">:</span>&nbsp;<span class="ident" id="6401962">d</span><span class="op" id="6401963">.</span><span class="ident" id="6401964">loopCount</span><span class="op" id="6401973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401977">Delay</span><span class="op" id="6401982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6401988">d</span><span class="op" id="6401989">.</span><span class="ident" id="6401990">delay</span><span class="op" id="6401995">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402001">return</span>&nbsp;<span class="ident" id="6402008">gif</span><span class="op" id="6402011">,</span>&nbsp;<span class="ident" id="6402013">nil</span><br>
<span class="lineno"></span><span class="op" id="6402017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6402020">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6402097">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6402135">func</span>&nbsp;<span class="ident" id="6402140">DecodeConfig</span><span class="op" id="6402152">(</span><span class="ident" id="6402153">r</span>&nbsp;<span class="ident" id="6402155">io</span><span class="op" id="6402157">.</span><span class="ident" id="6402158">Reader</span><span class="op" id="6402164">)</span>&nbsp;<span class="op" id="6402166">(</span><span class="ident" id="6402167">image</span><span class="op" id="6402172">.</span><span class="ident" id="6402173">Config</span><span class="op" id="6402179">,</span>&nbsp;<span class="builtintype" id="6402181">error</span><span class="op" id="6402186">)</span>&nbsp;<span class="op" id="6402188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402191">var</span>&nbsp;<span class="ident" id="6402195">d</span>&nbsp;<span class="ident" id="6402197">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402206">if</span>&nbsp;<span class="ident" id="6402209">err</span>&nbsp;<span class="op" id="6402213">:=</span>&nbsp;<span class="ident" id="6402216">d</span><span class="op" id="6402217">.</span><span class="ident" id="6402218">decode</span><span class="op" id="6402224">(</span><span class="ident" id="6402225">r</span><span class="op" id="6402226">,</span>&nbsp;<span class="builtintype" id="6402228">true</span><span class="op" id="6402232">)</span><span class="op" id="6402233">;</span>&nbsp;<span class="ident" id="6402235">err</span>&nbsp;<span class="op" id="6402239">!=</span>&nbsp;<span class="ident" id="6402242">nil</span>&nbsp;<span class="op" id="6402246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402250">return</span>&nbsp;<span class="ident" id="6402257">image</span><span class="op" id="6402262">.</span><span class="ident" id="6402263">Config</span><span class="op" id="6402269">{</span><span class="op" id="6402270">}</span><span class="op" id="6402271">,</span>&nbsp;<span class="ident" id="6402273">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402281">return</span>&nbsp;<span class="ident" id="6402288">image</span><span class="op" id="6402293">.</span><span class="ident" id="6402294">Config</span><span class="op" id="6402300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402304">ColorModel</span><span class="op" id="6402314">:</span>&nbsp;<span class="ident" id="6402316">d</span><span class="op" id="6402317">.</span><span class="ident" id="6402318">globalColorMap</span><span class="op" id="6402332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402336">Width</span><span class="op" id="6402341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6402348">d</span><span class="op" id="6402349">.</span><span class="ident" id="6402350">width</span><span class="op" id="6402355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402359">Height</span><span class="op" id="6402365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6402371">d</span><span class="op" id="6402372">.</span><span class="ident" id="6402373">height</span><span class="op" id="6402379">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402382">}</span><span class="op" id="6402383">,</span>&nbsp;<span class="ident" id="6402385">nil</span><br>
<span class="lineno"></span><span class="op" id="6402389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6402392">func</span>&nbsp;<span class="ident" id="6402397">init</span><span class="op" id="6402401">(</span><span class="op" id="6402402">)</span>&nbsp;<span class="op" id="6402404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402407">image</span><span class="op" id="6402412">.</span><span class="ident" id="6402413">RegisterFormat</span><span class="op" id="6402427">(</span><span class="string" id="6402428">&#34;gif&#34;</span><span class="op" id="6402433">,</span>&nbsp;<span class="string" id="6402435">&#34;GIF8?a&#34;</span><span class="op" id="6402443">,</span>&nbsp;<span class="ident" id="6402445">Decode</span><span class="op" id="6402451">,</span>&nbsp;<span class="ident" id="6402453">DecodeConfig</span><span class="op" id="6402465">)</span><br>
<span class="lineno">465</span><span class="op" id="6402467">}</span>
</div>
</body>
</html>
