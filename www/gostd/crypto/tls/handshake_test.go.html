<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7220874">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7220929">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7220983">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7221034">package</span>&nbsp;<span class="ident" id="7221042">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7221047">import</span>&nbsp;<span class="op" id="7221054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221057">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221066">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221082">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221092">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221100">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221107">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221113">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221126">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221133">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221144">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7221155">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7221162">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7221165">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7221240">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7221317">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7221396">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7221455">//</span><br>
<span class="lineno"></span><span class="comment" id="7221458">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7221532">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7221610">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7221686">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7221753">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7221772">//</span><br>
<span class="lineno"></span><span class="comment" id="7221775">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7221854">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7221934">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7222012">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7222091">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7222110">var</span>&nbsp;<span class="ident" id="7222114">update</span>&nbsp;<span class="op" id="7222121">=</span>&nbsp;<span class="ident" id="7222123">flag</span><span class="op" id="7222127">.</span><span class="ident" id="7222128">Bool</span><span class="op" id="7222132">(</span><span class="string" id="7222133">&#34;update&#34;</span><span class="op" id="7222141">,</span>&nbsp;<span class="builtintype" id="7222143">false</span><span class="op" id="7222148">,</span>&nbsp;<span class="string" id="7222150">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7222179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7222182">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7222262">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7222336">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7222354">type</span>&nbsp;<span class="ident" id="7222359">recordingConn</span>&nbsp;<span class="keyword" id="7222373">struct</span>&nbsp;<span class="op" id="7222380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222383">net</span><span class="op" id="7222386">.</span><span class="ident" id="7222387">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222393">sync</span><span class="op" id="7222397">.</span><span class="ident" id="7222398">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222405">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7222413">[</span><span class="op" id="7222414">]</span><span class="op" id="7222415">[</span><span class="op" id="7222416">]</span><span class="builtintype" id="7222417">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222423">reading</span>&nbsp;<span class="builtintype" id="7222431">bool</span><br>
<span class="lineno"></span><span class="op" id="7222436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7222439">func</span>&nbsp;<span class="op" id="7222444">(</span><span class="ident" id="7222445">r</span>&nbsp;<span class="op" id="7222447">*</span><span class="ident" id="7222448">recordingConn</span><span class="op" id="7222461">)</span>&nbsp;<span class="ident" id="7222463">Read</span><span class="op" id="7222467">(</span><span class="ident" id="7222468">b</span>&nbsp;<span class="op" id="7222470">[</span><span class="op" id="7222471">]</span><span class="builtintype" id="7222472">byte</span><span class="op" id="7222476">)</span>&nbsp;<span class="op" id="7222478">(</span><span class="ident" id="7222479">n</span>&nbsp;<span class="builtintype" id="7222481">int</span><span class="op" id="7222484">,</span>&nbsp;<span class="ident" id="7222486">err</span>&nbsp;<span class="builtintype" id="7222490">error</span><span class="op" id="7222495">)</span>&nbsp;<span class="op" id="7222497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222500">if</span>&nbsp;<span class="ident" id="7222503">n</span><span class="op" id="7222504">,</span>&nbsp;<span class="ident" id="7222506">err</span>&nbsp;<span class="op" id="7222510">=</span>&nbsp;<span class="ident" id="7222512">r</span><span class="op" id="7222513">.</span><span class="ident" id="7222514">Conn</span><span class="op" id="7222518">.</span><span class="ident" id="7222519">Read</span><span class="op" id="7222523">(</span><span class="ident" id="7222524">b</span><span class="op" id="7222525">)</span><span class="op" id="7222526">;</span>&nbsp;<span class="ident" id="7222528">n</span>&nbsp;<span class="op" id="7222530">==</span>&nbsp;<span class="num" id="7222533">0</span>&nbsp;<span class="op" id="7222535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7222547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222550">b</span>&nbsp;<span class="op" id="7222552">=</span>&nbsp;<span class="ident" id="7222554">b</span><span class="op" id="7222555">[</span><span class="op" id="7222556">:</span><span class="ident" id="7222557">n</span><span class="op" id="7222558">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222562">r</span><span class="op" id="7222563">.</span><span class="ident" id="7222564">Lock</span><span class="op" id="7222568">(</span><span class="op" id="7222569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222572">defer</span>&nbsp;<span class="ident" id="7222578">r</span><span class="op" id="7222579">.</span><span class="ident" id="7222580">Unlock</span><span class="op" id="7222586">(</span><span class="op" id="7222587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222591">if</span>&nbsp;<span class="ident" id="7222594">l</span>&nbsp;<span class="op" id="7222596">:=</span>&nbsp;<span class="builtinfunc" id="7222599">len</span><span class="op" id="7222602">(</span><span class="ident" id="7222603">r</span><span class="op" id="7222604">.</span><span class="ident" id="7222605">flows</span><span class="op" id="7222610">)</span><span class="op" id="7222611">;</span>&nbsp;<span class="ident" id="7222613">l</span>&nbsp;<span class="op" id="7222615">==</span>&nbsp;<span class="num" id="7222618">0</span>&nbsp;<span class="op" id="7222620">||</span>&nbsp;<span class="op" id="7222623">!</span><span class="ident" id="7222624">r</span><span class="op" id="7222625">.</span><span class="ident" id="7222626">reading</span>&nbsp;<span class="op" id="7222634">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222638">buf</span>&nbsp;<span class="op" id="7222642">:=</span>&nbsp;<span class="builtinfunc" id="7222645">make</span><span class="op" id="7222649">(</span><span class="op" id="7222650">[</span><span class="op" id="7222651">]</span><span class="builtintype" id="7222652">byte</span><span class="op" id="7222656">,</span>&nbsp;<span class="builtinfunc" id="7222658">len</span><span class="op" id="7222661">(</span><span class="ident" id="7222662">b</span><span class="op" id="7222663">)</span><span class="op" id="7222664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7222668">copy</span><span class="op" id="7222672">(</span><span class="ident" id="7222673">buf</span><span class="op" id="7222676">,</span>&nbsp;<span class="ident" id="7222678">b</span><span class="op" id="7222679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222683">r</span><span class="op" id="7222684">.</span><span class="ident" id="7222685">flows</span>&nbsp;<span class="op" id="7222691">=</span>&nbsp;<span class="builtinfunc" id="7222693">append</span><span class="op" id="7222699">(</span><span class="ident" id="7222700">r</span><span class="op" id="7222701">.</span><span class="ident" id="7222702">flows</span><span class="op" id="7222707">,</span>&nbsp;<span class="ident" id="7222709">buf</span><span class="op" id="7222712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7222715">}</span>&nbsp;<span class="keyword" id="7222717">else</span>&nbsp;<span class="op" id="7222722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222726">r</span><span class="op" id="7222727">.</span><span class="ident" id="7222728">flows</span><span class="op" id="7222733">[</span><span class="ident" id="7222734">l</span><span class="op" id="7222735">-</span><span class="num" id="7222736">1</span><span class="op" id="7222737">]</span>&nbsp;<span class="op" id="7222739">=</span>&nbsp;<span class="builtinfunc" id="7222741">append</span><span class="op" id="7222747">(</span><span class="ident" id="7222748">r</span><span class="op" id="7222749">.</span><span class="ident" id="7222750">flows</span><span class="op" id="7222755">[</span><span class="ident" id="7222756">l</span><span class="op" id="7222757">-</span><span class="num" id="7222758">1</span><span class="op" id="7222759">]</span><span class="op" id="7222760">,</span>&nbsp;<span class="ident" id="7222762">b</span><span class="op" id="7222763">[</span><span class="op" id="7222764">:</span><span class="ident" id="7222765">n</span><span class="op" id="7222766">]</span><span class="op" id="7222767">...</span><span class="op" id="7222770">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7222773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222776">r</span><span class="op" id="7222777">.</span><span class="ident" id="7222778">reading</span>&nbsp;<span class="op" id="7222786">=</span>&nbsp;<span class="builtintype" id="7222788">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222794">return</span><br>
<span class="lineno"></span><span class="op" id="7222801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7222804">func</span>&nbsp;<span class="op" id="7222809">(</span><span class="ident" id="7222810">r</span>&nbsp;<span class="op" id="7222812">*</span><span class="ident" id="7222813">recordingConn</span><span class="op" id="7222826">)</span>&nbsp;<span class="ident" id="7222828">Write</span><span class="op" id="7222833">(</span><span class="ident" id="7222834">b</span>&nbsp;<span class="op" id="7222836">[</span><span class="op" id="7222837">]</span><span class="builtintype" id="7222838">byte</span><span class="op" id="7222842">)</span>&nbsp;<span class="op" id="7222844">(</span><span class="ident" id="7222845">n</span>&nbsp;<span class="builtintype" id="7222847">int</span><span class="op" id="7222850">,</span>&nbsp;<span class="ident" id="7222852">err</span>&nbsp;<span class="builtintype" id="7222856">error</span><span class="op" id="7222861">)</span>&nbsp;<span class="op" id="7222863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222866">if</span>&nbsp;<span class="ident" id="7222869">n</span><span class="op" id="7222870">,</span>&nbsp;<span class="ident" id="7222872">err</span>&nbsp;<span class="op" id="7222876">=</span>&nbsp;<span class="ident" id="7222878">r</span><span class="op" id="7222879">.</span><span class="ident" id="7222880">Conn</span><span class="op" id="7222884">.</span><span class="ident" id="7222885">Write</span><span class="op" id="7222890">(</span><span class="ident" id="7222891">b</span><span class="op" id="7222892">)</span><span class="op" id="7222893">;</span>&nbsp;<span class="ident" id="7222895">n</span>&nbsp;<span class="op" id="7222897">==</span>&nbsp;<span class="num" id="7222900">0</span>&nbsp;<span class="op" id="7222902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222906">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7222914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222917">b</span>&nbsp;<span class="op" id="7222919">=</span>&nbsp;<span class="ident" id="7222921">b</span><span class="op" id="7222922">[</span><span class="op" id="7222923">:</span><span class="ident" id="7222924">n</span><span class="op" id="7222925">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7222929">r</span><span class="op" id="7222930">.</span><span class="ident" id="7222931">Lock</span><span class="op" id="7222935">(</span><span class="op" id="7222936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222939">defer</span>&nbsp;<span class="ident" id="7222945">r</span><span class="op" id="7222946">.</span><span class="ident" id="7222947">Unlock</span><span class="op" id="7222953">(</span><span class="op" id="7222954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7222958">if</span>&nbsp;<span class="ident" id="7222961">l</span>&nbsp;<span class="op" id="7222963">:=</span>&nbsp;<span class="builtinfunc" id="7222966">len</span><span class="op" id="7222969">(</span><span class="ident" id="7222970">r</span><span class="op" id="7222971">.</span><span class="ident" id="7222972">flows</span><span class="op" id="7222977">)</span><span class="op" id="7222978">;</span>&nbsp;<span class="ident" id="7222980">l</span>&nbsp;<span class="op" id="7222982">==</span>&nbsp;<span class="num" id="7222985">0</span>&nbsp;<span class="op" id="7222987">||</span>&nbsp;<span class="ident" id="7222990">r</span><span class="op" id="7222991">.</span><span class="ident" id="7222992">reading</span>&nbsp;<span class="op" id="7223000">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223004">buf</span>&nbsp;<span class="op" id="7223008">:=</span>&nbsp;<span class="builtinfunc" id="7223011">make</span><span class="op" id="7223015">(</span><span class="op" id="7223016">[</span><span class="op" id="7223017">]</span><span class="builtintype" id="7223018">byte</span><span class="op" id="7223022">,</span>&nbsp;<span class="builtinfunc" id="7223024">len</span><span class="op" id="7223027">(</span><span class="ident" id="7223028">b</span><span class="op" id="7223029">)</span><span class="op" id="7223030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7223034">copy</span><span class="op" id="7223038">(</span><span class="ident" id="7223039">buf</span><span class="op" id="7223042">,</span>&nbsp;<span class="ident" id="7223044">b</span><span class="op" id="7223045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223049">r</span><span class="op" id="7223050">.</span><span class="ident" id="7223051">flows</span>&nbsp;<span class="op" id="7223057">=</span>&nbsp;<span class="builtinfunc" id="7223059">append</span><span class="op" id="7223065">(</span><span class="ident" id="7223066">r</span><span class="op" id="7223067">.</span><span class="ident" id="7223068">flows</span><span class="op" id="7223073">,</span>&nbsp;<span class="ident" id="7223075">buf</span><span class="op" id="7223078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7223081">}</span>&nbsp;<span class="keyword" id="7223083">else</span>&nbsp;<span class="op" id="7223088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223092">r</span><span class="op" id="7223093">.</span><span class="ident" id="7223094">flows</span><span class="op" id="7223099">[</span><span class="ident" id="7223100">l</span><span class="op" id="7223101">-</span><span class="num" id="7223102">1</span><span class="op" id="7223103">]</span>&nbsp;<span class="op" id="7223105">=</span>&nbsp;<span class="builtinfunc" id="7223107">append</span><span class="op" id="7223113">(</span><span class="ident" id="7223114">r</span><span class="op" id="7223115">.</span><span class="ident" id="7223116">flows</span><span class="op" id="7223121">[</span><span class="ident" id="7223122">l</span><span class="op" id="7223123">-</span><span class="num" id="7223124">1</span><span class="op" id="7223125">]</span><span class="op" id="7223126">,</span>&nbsp;<span class="ident" id="7223128">b</span><span class="op" id="7223129">[</span><span class="op" id="7223130">:</span><span class="ident" id="7223131">n</span><span class="op" id="7223132">]</span><span class="op" id="7223133">...</span><span class="op" id="7223136">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7223139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223142">r</span><span class="op" id="7223143">.</span><span class="ident" id="7223144">reading</span>&nbsp;<span class="op" id="7223152">=</span>&nbsp;<span class="builtintype" id="7223154">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223161">return</span><br>
<span class="lineno"></span><span class="op" id="7223168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7223171">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7223245">func</span>&nbsp;<span class="op" id="7223250">(</span><span class="ident" id="7223251">r</span>&nbsp;<span class="op" id="7223253">*</span><span class="ident" id="7223254">recordingConn</span><span class="op" id="7223267">)</span>&nbsp;<span class="ident" id="7223269">WriteTo</span><span class="op" id="7223276">(</span><span class="ident" id="7223277">w</span>&nbsp;<span class="ident" id="7223279">io</span><span class="op" id="7223281">.</span><span class="ident" id="7223282">Writer</span><span class="op" id="7223288">)</span>&nbsp;<span class="op" id="7223290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7223293">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223345">clientToServer</span>&nbsp;<span class="op" id="7223360">:=</span>&nbsp;<span class="builtintype" id="7223363">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223370">for</span>&nbsp;<span class="ident" id="7223374">i</span><span class="op" id="7223375">,</span>&nbsp;<span class="ident" id="7223377">flow</span>&nbsp;<span class="op" id="7223382">:=</span>&nbsp;<span class="keyword" id="7223385">range</span>&nbsp;<span class="ident" id="7223391">r</span><span class="op" id="7223392">.</span><span class="ident" id="7223393">flows</span>&nbsp;<span class="op" id="7223399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223403">source</span><span class="op" id="7223409">,</span>&nbsp;<span class="ident" id="7223411">dest</span>&nbsp;<span class="op" id="7223416">:=</span>&nbsp;<span class="string" id="7223419">&#34;client&#34;</span><span class="op" id="7223427">,</span>&nbsp;<span class="string" id="7223429">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223440">if</span>&nbsp;<span class="op" id="7223443">!</span><span class="ident" id="7223444">clientToServer</span>&nbsp;<span class="op" id="7223459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223464">source</span><span class="op" id="7223470">,</span>&nbsp;<span class="ident" id="7223472">dest</span>&nbsp;<span class="op" id="7223477">=</span>&nbsp;<span class="ident" id="7223479">dest</span><span class="op" id="7223483">,</span>&nbsp;<span class="ident" id="7223485">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7223494">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223498">fmt</span><span class="op" id="7223501">.</span><span class="ident" id="7223502">Fprintf</span><span class="op" id="7223509">(</span><span class="ident" id="7223510">w</span><span class="op" id="7223511">,</span>&nbsp;<span class="string" id="7223513">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7223539">,</span>&nbsp;<span class="ident" id="7223541">i</span><span class="op" id="7223542">+</span><span class="num" id="7223543">1</span><span class="op" id="7223544">,</span>&nbsp;<span class="ident" id="7223546">source</span><span class="op" id="7223552">,</span>&nbsp;<span class="ident" id="7223554">dest</span><span class="op" id="7223558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223562">dumper</span>&nbsp;<span class="op" id="7223569">:=</span>&nbsp;<span class="ident" id="7223572">hex</span><span class="op" id="7223575">.</span><span class="ident" id="7223576">Dumper</span><span class="op" id="7223582">(</span><span class="ident" id="7223583">w</span><span class="op" id="7223584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223588">dumper</span><span class="op" id="7223594">.</span><span class="ident" id="7223595">Write</span><span class="op" id="7223600">(</span><span class="ident" id="7223601">flow</span><span class="op" id="7223605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223609">dumper</span><span class="op" id="7223615">.</span><span class="ident" id="7223616">Close</span><span class="op" id="7223621">(</span><span class="op" id="7223622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223626">clientToServer</span>&nbsp;<span class="op" id="7223641">=</span>&nbsp;<span class="op" id="7223643">!</span><span class="ident" id="7223644">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7223660">}</span><br>
<span class="lineno"></span><span class="op" id="7223662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7223665">func</span>&nbsp;<span class="ident" id="7223670">parseTestData</span><span class="op" id="7223683">(</span><span class="ident" id="7223684">r</span>&nbsp;<span class="ident" id="7223686">io</span><span class="op" id="7223688">.</span><span class="ident" id="7223689">Reader</span><span class="op" id="7223695">)</span>&nbsp;<span class="op" id="7223697">(</span><span class="ident" id="7223698">flows</span>&nbsp;<span class="op" id="7223704">[</span><span class="op" id="7223705">]</span><span class="op" id="7223706">[</span><span class="op" id="7223707">]</span><span class="builtintype" id="7223708">byte</span><span class="op" id="7223712">,</span>&nbsp;<span class="ident" id="7223714">err</span>&nbsp;<span class="builtintype" id="7223718">error</span><span class="op" id="7223723">)</span>&nbsp;<span class="op" id="7223725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223728">var</span>&nbsp;<span class="ident" id="7223732">currentFlow</span>&nbsp;<span class="op" id="7223744">[</span><span class="op" id="7223745">]</span><span class="builtintype" id="7223746">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223753">scanner</span>&nbsp;<span class="op" id="7223761">:=</span>&nbsp;<span class="ident" id="7223764">bufio</span><span class="op" id="7223769">.</span><span class="ident" id="7223770">NewScanner</span><span class="op" id="7223780">(</span><span class="ident" id="7223781">r</span><span class="op" id="7223782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223785">for</span>&nbsp;<span class="ident" id="7223789">scanner</span><span class="op" id="7223796">.</span><span class="ident" id="7223797">Scan</span><span class="op" id="7223801">(</span><span class="op" id="7223802">)</span>&nbsp;<span class="op" id="7223804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7223808">line</span>&nbsp;<span class="op" id="7223813">:=</span>&nbsp;<span class="ident" id="7223816">scanner</span><span class="op" id="7223823">.</span><span class="ident" id="7223824">Text</span><span class="op" id="7223828">(</span><span class="op" id="7223829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7223833">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7223897">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223917">if</span>&nbsp;<span class="ident" id="7223920">strings</span><span class="op" id="7223927">.</span><span class="ident" id="7223928">HasPrefix</span><span class="op" id="7223937">(</span><span class="ident" id="7223938">line</span><span class="op" id="7223942">,</span>&nbsp;<span class="string" id="7223944">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7223950">)</span>&nbsp;<span class="op" id="7223952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7223957">if</span>&nbsp;<span class="builtinfunc" id="7223960">len</span><span class="op" id="7223963">(</span><span class="ident" id="7223964">currentFlow</span><span class="op" id="7223975">)</span>&nbsp;<span class="op" id="7223977">&gt;</span>&nbsp;<span class="num" id="7223979">0</span>&nbsp;<span class="op" id="7223981">||</span>&nbsp;<span class="builtinfunc" id="7223984">len</span><span class="op" id="7223987">(</span><span class="ident" id="7223988">flows</span><span class="op" id="7223993">)</span>&nbsp;<span class="op" id="7223995">&gt;</span>&nbsp;<span class="num" id="7223997">0</span>&nbsp;<span class="op" id="7223999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224005">flows</span>&nbsp;<span class="op" id="7224011">=</span>&nbsp;<span class="builtinfunc" id="7224013">append</span><span class="op" id="7224019">(</span><span class="ident" id="7224020">flows</span><span class="op" id="7224025">,</span>&nbsp;<span class="ident" id="7224027">currentFlow</span><span class="op" id="7224038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224044">currentFlow</span>&nbsp;<span class="op" id="7224056">=</span>&nbsp;<span class="ident" id="7224058">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224070">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7224086">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7224149">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7224202">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224264">if</span>&nbsp;<span class="ident" id="7224267">i</span>&nbsp;<span class="op" id="7224269">:=</span>&nbsp;<span class="ident" id="7224272">strings</span><span class="op" id="7224279">.</span><span class="ident" id="7224280">IndexByte</span><span class="op" id="7224289">(</span><span class="ident" id="7224290">line</span><span class="op" id="7224294">,</span>&nbsp;<span class="string" id="7224296">&#39;&nbsp;&#39;</span><span class="op" id="7224299">)</span><span class="op" id="7224300">;</span>&nbsp;<span class="ident" id="7224302">i</span>&nbsp;<span class="op" id="7224304">&gt;=</span>&nbsp;<span class="num" id="7224307">0</span>&nbsp;<span class="op" id="7224309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224314">line</span>&nbsp;<span class="op" id="7224319">=</span>&nbsp;<span class="ident" id="7224321">line</span><span class="op" id="7224325">[</span><span class="ident" id="7224326">i</span><span class="op" id="7224327">:</span><span class="op" id="7224328">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224332">}</span>&nbsp;<span class="keyword" id="7224334">else</span>&nbsp;<span class="op" id="7224339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224344">return</span>&nbsp;<span class="ident" id="7224351">nil</span><span class="op" id="7224354">,</span>&nbsp;<span class="ident" id="7224356">errors</span><span class="op" id="7224362">.</span><span class="ident" id="7224363">New</span><span class="op" id="7224366">(</span><span class="string" id="7224367">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7224386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224395">if</span>&nbsp;<span class="ident" id="7224398">i</span>&nbsp;<span class="op" id="7224400">:=</span>&nbsp;<span class="ident" id="7224403">strings</span><span class="op" id="7224410">.</span><span class="ident" id="7224411">IndexByte</span><span class="op" id="7224420">(</span><span class="ident" id="7224421">line</span><span class="op" id="7224425">,</span>&nbsp;<span class="string" id="7224427">&#39;|&#39;</span><span class="op" id="7224430">)</span><span class="op" id="7224431">;</span>&nbsp;<span class="ident" id="7224433">i</span>&nbsp;<span class="op" id="7224435">&gt;=</span>&nbsp;<span class="num" id="7224438">0</span>&nbsp;<span class="op" id="7224440">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224445">line</span>&nbsp;<span class="op" id="7224450">=</span>&nbsp;<span class="ident" id="7224452">line</span><span class="op" id="7224456">[</span><span class="op" id="7224457">:</span><span class="ident" id="7224458">i</span><span class="op" id="7224459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224463">}</span>&nbsp;<span class="keyword" id="7224465">else</span>&nbsp;<span class="op" id="7224470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224475">return</span>&nbsp;<span class="ident" id="7224482">nil</span><span class="op" id="7224485">,</span>&nbsp;<span class="ident" id="7224487">errors</span><span class="op" id="7224493">.</span><span class="ident" id="7224494">New</span><span class="op" id="7224497">(</span><span class="string" id="7224498">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7224517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224526">hexBytes</span>&nbsp;<span class="op" id="7224535">:=</span>&nbsp;<span class="ident" id="7224538">strings</span><span class="op" id="7224545">.</span><span class="ident" id="7224546">Fields</span><span class="op" id="7224552">(</span><span class="ident" id="7224553">line</span><span class="op" id="7224557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224561">for</span>&nbsp;<span class="ident" id="7224565">_</span><span class="op" id="7224566">,</span>&nbsp;<span class="ident" id="7224568">hexByte</span>&nbsp;<span class="op" id="7224576">:=</span>&nbsp;<span class="keyword" id="7224579">range</span>&nbsp;<span class="ident" id="7224585">hexBytes</span>&nbsp;<span class="op" id="7224594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224599">val</span><span class="op" id="7224602">,</span>&nbsp;<span class="ident" id="7224604">err</span>&nbsp;<span class="op" id="7224608">:=</span>&nbsp;<span class="ident" id="7224611">strconv</span><span class="op" id="7224618">.</span><span class="ident" id="7224619">ParseUint</span><span class="op" id="7224628">(</span><span class="ident" id="7224629">hexByte</span><span class="op" id="7224636">,</span>&nbsp;<span class="num" id="7224638">16</span><span class="op" id="7224640">,</span>&nbsp;<span class="num" id="7224642">8</span><span class="op" id="7224643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224648">if</span>&nbsp;<span class="ident" id="7224651">err</span>&nbsp;<span class="op" id="7224655">!=</span>&nbsp;<span class="ident" id="7224658">nil</span>&nbsp;<span class="op" id="7224662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224668">return</span>&nbsp;<span class="ident" id="7224675">nil</span><span class="op" id="7224678">,</span>&nbsp;<span class="ident" id="7224680">errors</span><span class="op" id="7224686">.</span><span class="ident" id="7224687">New</span><span class="op" id="7224690">(</span><span class="string" id="7224691">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7224725">+</span>&nbsp;<span class="ident" id="7224727">err</span><span class="op" id="7224730">.</span><span class="ident" id="7224731">Error</span><span class="op" id="7224736">(</span><span class="op" id="7224737">)</span><span class="op" id="7224738">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224748">currentFlow</span>&nbsp;<span class="op" id="7224760">=</span>&nbsp;<span class="builtinfunc" id="7224762">append</span><span class="op" id="7224768">(</span><span class="ident" id="7224769">currentFlow</span><span class="op" id="7224780">,</span>&nbsp;<span class="builtintype" id="7224782">byte</span><span class="op" id="7224786">(</span><span class="ident" id="7224787">val</span><span class="op" id="7224790">)</span><span class="op" id="7224791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224802">if</span>&nbsp;<span class="builtinfunc" id="7224805">len</span><span class="op" id="7224808">(</span><span class="ident" id="7224809">currentFlow</span><span class="op" id="7224820">)</span>&nbsp;<span class="op" id="7224822">&gt;</span>&nbsp;<span class="num" id="7224824">0</span>&nbsp;<span class="op" id="7224826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7224830">flows</span>&nbsp;<span class="op" id="7224836">=</span>&nbsp;<span class="builtinfunc" id="7224838">append</span><span class="op" id="7224844">(</span><span class="ident" id="7224845">flows</span><span class="op" id="7224850">,</span>&nbsp;<span class="ident" id="7224852">currentFlow</span><span class="op" id="7224863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7224866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7224870">return</span>&nbsp;<span class="ident" id="7224877">flows</span><span class="op" id="7224882">,</span>&nbsp;<span class="ident" id="7224884">nil</span><br>
<span class="lineno">155</span><span class="op" id="7224888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7224891">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7224965">func</span>&nbsp;<span class="ident" id="7224970">tempFile</span><span class="op" id="7224978">(</span><span class="ident" id="7224979">contents</span>&nbsp;<span class="builtintype" id="7224988">string</span><span class="op" id="7224994">)</span>&nbsp;<span class="builtintype" id="7224996">string</span>&nbsp;<span class="op" id="7225003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7225006">file</span><span class="op" id="7225010">,</span>&nbsp;<span class="ident" id="7225012">err</span>&nbsp;<span class="op" id="7225016">:=</span>&nbsp;<span class="ident" id="7225019">ioutil</span><span class="op" id="7225025">.</span><span class="ident" id="7225026">TempFile</span><span class="op" id="7225034">(</span><span class="string" id="7225035">&#34;&#34;</span><span class="op" id="7225037">,</span>&nbsp;<span class="string" id="7225039">&#34;go-tls-test&#34;</span><span class="op" id="7225052">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7225055">if</span>&nbsp;<span class="ident" id="7225058">err</span>&nbsp;<span class="op" id="7225062">!=</span>&nbsp;<span class="ident" id="7225065">nil</span>&nbsp;<span class="op" id="7225069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7225073">panic</span><span class="op" id="7225078">(</span><span class="string" id="7225079">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7225110">+</span>&nbsp;<span class="ident" id="7225112">err</span><span class="op" id="7225115">.</span><span class="ident" id="7225116">Error</span><span class="op" id="7225121">(</span><span class="op" id="7225122">)</span><span class="op" id="7225123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7225126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7225129">path</span>&nbsp;<span class="op" id="7225134">:=</span>&nbsp;<span class="ident" id="7225137">file</span><span class="op" id="7225141">.</span><span class="ident" id="7225142">Name</span><span class="op" id="7225146">(</span><span class="op" id="7225147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7225150">file</span><span class="op" id="7225154">.</span><span class="ident" id="7225155">WriteString</span><span class="op" id="7225166">(</span><span class="ident" id="7225167">contents</span><span class="op" id="7225175">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7225178">file</span><span class="op" id="7225182">.</span><span class="ident" id="7225183">Close</span><span class="op" id="7225188">(</span><span class="op" id="7225189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7225192">return</span>&nbsp;<span class="ident" id="7225199">path</span><br>
<span class="lineno"></span><span class="op" id="7225204">}</span>
</div>
</body>
</html>
