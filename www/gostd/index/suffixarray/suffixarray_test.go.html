<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html" class="current">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8253285">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8253340">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8253394">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8253445">package</span>&nbsp;<span class="ident" id="8253453">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8253466">import</span>&nbsp;<span class="op" id="8253473">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253476">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253485">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253498">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253508">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253516">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253527">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8253537">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8253540">type</span>&nbsp;<span class="ident" id="8253545">testCase</span>&nbsp;<span class="keyword" id="8253554">struct</span>&nbsp;<span class="op" id="8253561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8253564">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8253573">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8253582">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8253604">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8253613">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8253622">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8253642">patterns</span>&nbsp;<span class="op" id="8253651">[</span><span class="op" id="8253652">]</span><span class="builtintype" id="8253653">string</span>&nbsp;<span class="comment" id="8253660">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="8253682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8253685">var</span>&nbsp;<span class="ident" id="8253689">testCases</span>&nbsp;<span class="op" id="8253699">=</span>&nbsp;<span class="op" id="8253701">[</span><span class="op" id="8253702">]</span><span class="ident" id="8253703">testCase</span><span class="op" id="8253711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253718">&#34;empty&nbsp;string&#34;</span><span class="op" id="8253732">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253736">&#34;&#34;</span><span class="op" id="8253738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253742">[</span><span class="op" id="8253743">]</span><span class="builtintype" id="8253744">string</span><span class="op" id="8253750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253755">&#34;&#34;</span><span class="op" id="8253757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253762">&#34;foo&#34;</span><span class="op" id="8253767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253772">&#34;(foo)&#34;</span><span class="op" id="8253779">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253784">&#34;.*&#34;</span><span class="op" id="8253788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253793">&#34;a*&#34;</span><span class="op" id="8253797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253801">}</span><span class="op" id="8253802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253805">}</span><span class="op" id="8253806">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253814">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="8253823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253827">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8253839">,</span>&nbsp;<span class="comment" id="8253841">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8253853">[</span><span class="op" id="8253854">]</span><span class="builtintype" id="8253855">string</span><span class="op" id="8253861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253866">&#34;&#34;</span><span class="op" id="8253868">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253873">&#34;a&#34;</span><span class="op" id="8253876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253881">&#34;aa&#34;</span><span class="op" id="8253885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253890">&#34;aaa&#34;</span><span class="op" id="8253895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253900">&#34;aaaa&#34;</span><span class="op" id="8253906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253911">&#34;aaaaa&#34;</span><span class="op" id="8253918">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253923">&#34;aaaaaa&#34;</span><span class="op" id="8253931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253936">&#34;aaaaaaa&#34;</span><span class="op" id="8253945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253950">&#34;aaaaaaaa&#34;</span><span class="op" id="8253960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253965">&#34;aaaaaaaaa&#34;</span><span class="op" id="8253976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253981">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8253993">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253998">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="8254011">,</span>&nbsp;<span class="comment" id="8254013">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254026">&#34;.&#34;</span><span class="op" id="8254029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254034">&#34;.*&#34;</span><span class="op" id="8254038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254043">&#34;a+&#34;</span><span class="op" id="8254047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254052">&#34;aa+&#34;</span><span class="op" id="8254057">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254062">&#34;aaaa[b]?&#34;</span><span class="op" id="8254072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254077">&#34;aaa*&#34;</span><span class="op" id="8254083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254087">}</span><span class="op" id="8254088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254091">}</span><span class="op" id="8254092">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254100">&#34;abc&#34;</span><span class="op" id="8254105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254109">&#34;abc&#34;</span><span class="op" id="8254114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254118">[</span><span class="op" id="8254119">]</span><span class="builtintype" id="8254120">string</span><span class="op" id="8254126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254131">&#34;a&#34;</span><span class="op" id="8254134">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254139">&#34;b&#34;</span><span class="op" id="8254142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254147">&#34;c&#34;</span><span class="op" id="8254150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254155">&#34;ab&#34;</span><span class="op" id="8254159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254164">&#34;bc&#34;</span><span class="op" id="8254168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254173">&#34;abc&#34;</span><span class="op" id="8254178">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254183">&#34;a.c&#34;</span><span class="op" id="8254188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254193">&#34;a(b|c)&#34;</span><span class="op" id="8254201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254206">&#34;abc?&#34;</span><span class="op" id="8254212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254216">}</span><span class="op" id="8254217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254220">}</span><span class="op" id="8254221">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254229">&#34;barbara*3&#34;</span><span class="op" id="8254240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254244">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="8254267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254271">[</span><span class="op" id="8254272">]</span><span class="builtintype" id="8254273">string</span><span class="op" id="8254279">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254284">&#34;a&#34;</span><span class="op" id="8254287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254292">&#34;bar&#34;</span><span class="op" id="8254297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254302">&#34;rab&#34;</span><span class="op" id="8254307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254312">&#34;arab&#34;</span><span class="op" id="8254318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254323">&#34;barbar&#34;</span><span class="op" id="8254331">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254336">&#34;bara?bar&#34;</span><span class="op" id="8254346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254350">}</span><span class="op" id="8254351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254354">}</span><span class="op" id="8254355">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254359">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254363">&#34;typing&nbsp;drill&#34;</span><span class="op" id="8254377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254381">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="8254452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254456">[</span><span class="op" id="8254457">]</span><span class="builtintype" id="8254458">string</span><span class="op" id="8254464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254469">&#34;Now&#34;</span><span class="op" id="8254474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254479">&#34;the&nbsp;time&#34;</span><span class="op" id="8254489">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254494">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="8254511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254516">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="8254574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254579">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="8254595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254599">}</span><span class="op" id="8254600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254603">}</span><span class="op" id="8254604">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254612">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="8254630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254634">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="8254679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254683">[</span><span class="op" id="8254684">]</span><span class="builtintype" id="8254685">string</span><span class="op" id="8254691">{</span><span class="op" id="8254692">}</span><span class="op" id="8254693">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254696">}</span><span class="op" id="8254697">,</span><br>
<span class="lineno"></span><span class="op" id="8254699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8254702">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="8254771">func</span>&nbsp;<span class="ident" id="8254776">find</span><span class="op" id="8254780">(</span><span class="ident" id="8254781">src</span><span class="op" id="8254784">,</span>&nbsp;<span class="ident" id="8254786">s</span>&nbsp;<span class="builtintype" id="8254788">string</span><span class="op" id="8254794">,</span>&nbsp;<span class="ident" id="8254796">n</span>&nbsp;<span class="builtintype" id="8254798">int</span><span class="op" id="8254801">)</span>&nbsp;<span class="op" id="8254803">[</span><span class="op" id="8254804">]</span><span class="builtintype" id="8254805">int</span>&nbsp;<span class="op" id="8254809">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254812">var</span>&nbsp;<span class="ident" id="8254816">res</span>&nbsp;<span class="op" id="8254820">[</span><span class="op" id="8254821">]</span><span class="builtintype" id="8254822">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254827">if</span>&nbsp;<span class="ident" id="8254830">s</span>&nbsp;<span class="op" id="8254832">!=</span>&nbsp;<span class="string" id="8254835">&#34;&#34;</span>&nbsp;<span class="op" id="8254838">&amp;&amp;</span>&nbsp;<span class="ident" id="8254841">n</span>&nbsp;<span class="op" id="8254843">!=</span>&nbsp;<span class="num" id="8254846">0</span>&nbsp;<span class="op" id="8254848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8254852">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254896">for</span>&nbsp;<span class="ident" id="8254900">i</span>&nbsp;<span class="op" id="8254902">:=</span>&nbsp;<span class="op" id="8254905">-</span><span class="num" id="8254906">1</span><span class="op" id="8254907">;</span>&nbsp;<span class="ident" id="8254909">n</span>&nbsp;<span class="op" id="8254911">&lt;</span>&nbsp;<span class="num" id="8254913">0</span>&nbsp;<span class="op" id="8254915">||</span>&nbsp;<span class="builtinfunc" id="8254918">len</span><span class="op" id="8254921">(</span><span class="ident" id="8254922">res</span><span class="op" id="8254925">)</span>&nbsp;<span class="op" id="8254927">&lt;</span>&nbsp;<span class="ident" id="8254929">n</span><span class="op" id="8254930">;</span>&nbsp;<span class="op" id="8254932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8254937">j</span>&nbsp;<span class="op" id="8254939">:=</span>&nbsp;<span class="ident" id="8254942">strings</span><span class="op" id="8254949">.</span><span class="ident" id="8254950">Index</span><span class="op" id="8254955">(</span><span class="ident" id="8254956">src</span><span class="op" id="8254959">[</span><span class="ident" id="8254960">i</span><span class="op" id="8254961">+</span><span class="num" id="8254962">1</span><span class="op" id="8254963">:</span><span class="op" id="8254964">]</span><span class="op" id="8254965">,</span>&nbsp;<span class="ident" id="8254967">s</span><span class="op" id="8254968">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254973">if</span>&nbsp;<span class="ident" id="8254976">j</span>&nbsp;<span class="op" id="8254978">&lt;</span>&nbsp;<span class="num" id="8254980">0</span>&nbsp;<span class="op" id="8254982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254988">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255002">i</span>&nbsp;<span class="op" id="8255004">+=</span>&nbsp;<span class="ident" id="8255007">j</span>&nbsp;<span class="op" id="8255009">+</span>&nbsp;<span class="num" id="8255011">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255016">res</span>&nbsp;<span class="op" id="8255020">=</span>&nbsp;<span class="builtinfunc" id="8255022">append</span><span class="op" id="8255028">(</span><span class="ident" id="8255029">res</span><span class="op" id="8255032">,</span>&nbsp;<span class="ident" id="8255034">i</span><span class="op" id="8255035">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255045">return</span>&nbsp;<span class="ident" id="8255052">res</span><br>
<span class="lineno"></span><span class="op" id="8255056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8255059">func</span>&nbsp;<span class="ident" id="8255064">testLookup</span><span class="op" id="8255074">(</span><span class="ident" id="8255075">t</span>&nbsp;<span class="op" id="8255077">*</span><span class="ident" id="8255078">testing</span><span class="op" id="8255085">.</span><span class="ident" id="8255086">T</span><span class="op" id="8255087">,</span>&nbsp;<span class="ident" id="8255089">tc</span>&nbsp;<span class="op" id="8255092">*</span><span class="ident" id="8255093">testCase</span><span class="op" id="8255101">,</span>&nbsp;<span class="ident" id="8255103">x</span>&nbsp;<span class="op" id="8255105">*</span><span class="ident" id="8255106">Index</span><span class="op" id="8255111">,</span>&nbsp;<span class="ident" id="8255113">s</span>&nbsp;<span class="builtintype" id="8255115">string</span><span class="op" id="8255121">,</span>&nbsp;<span class="ident" id="8255123">n</span>&nbsp;<span class="builtintype" id="8255125">int</span><span class="op" id="8255128">)</span>&nbsp;<span class="op" id="8255130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255133">res</span>&nbsp;<span class="op" id="8255137">:=</span>&nbsp;<span class="ident" id="8255140">x</span><span class="op" id="8255141">.</span><span class="ident" id="8255142">Lookup</span><span class="op" id="8255148">(</span><span class="op" id="8255149">[</span><span class="op" id="8255150">]</span><span class="builtintype" id="8255151">byte</span><span class="op" id="8255155">(</span><span class="ident" id="8255156">s</span><span class="op" id="8255157">)</span><span class="op" id="8255158">,</span>&nbsp;<span class="ident" id="8255160">n</span><span class="op" id="8255161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255164">exp</span>&nbsp;<span class="op" id="8255168">:=</span>&nbsp;<span class="ident" id="8255171">find</span><span class="op" id="8255175">(</span><span class="ident" id="8255176">tc</span><span class="op" id="8255178">.</span><span class="ident" id="8255179">source</span><span class="op" id="8255185">,</span>&nbsp;<span class="ident" id="8255187">s</span><span class="op" id="8255188">,</span>&nbsp;<span class="ident" id="8255190">n</span><span class="op" id="8255191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255195">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255228">if</span>&nbsp;<span class="builtinfunc" id="8255231">len</span><span class="op" id="8255234">(</span><span class="ident" id="8255235">res</span><span class="op" id="8255238">)</span>&nbsp;<span class="op" id="8255240">!=</span>&nbsp;<span class="builtinfunc" id="8255243">len</span><span class="op" id="8255246">(</span><span class="ident" id="8255247">exp</span><span class="op" id="8255250">)</span>&nbsp;<span class="op" id="8255252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255256">t</span><span class="op" id="8255257">.</span><span class="ident" id="8255258">Errorf</span><span class="op" id="8255264">(</span><span class="string" id="8255265">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8255323">,</span>&nbsp;<span class="ident" id="8255325">tc</span><span class="op" id="8255327">.</span><span class="ident" id="8255328">name</span><span class="op" id="8255332">,</span>&nbsp;<span class="ident" id="8255334">s</span><span class="op" id="8255335">,</span>&nbsp;<span class="ident" id="8255337">n</span><span class="op" id="8255338">,</span>&nbsp;<span class="builtinfunc" id="8255340">len</span><span class="op" id="8255343">(</span><span class="ident" id="8255344">exp</span><span class="op" id="8255347">)</span><span class="op" id="8255348">,</span>&nbsp;<span class="builtinfunc" id="8255350">len</span><span class="op" id="8255353">(</span><span class="ident" id="8255354">res</span><span class="op" id="8255357">)</span><span class="op" id="8255358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255365">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255441">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255517">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255593">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8255658">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255740">sort</span><span class="op" id="8255744">.</span><span class="ident" id="8255745">Ints</span><span class="op" id="8255749">(</span><span class="ident" id="8255750">res</span><span class="op" id="8255753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255756">for</span>&nbsp;<span class="ident" id="8255760">i</span><span class="op" id="8255761">,</span>&nbsp;<span class="ident" id="8255763">r</span>&nbsp;<span class="op" id="8255765">:=</span>&nbsp;<span class="keyword" id="8255768">range</span>&nbsp;<span class="ident" id="8255774">res</span>&nbsp;<span class="op" id="8255778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255782">if</span>&nbsp;<span class="ident" id="8255785">r</span>&nbsp;<span class="op" id="8255787">&lt;</span>&nbsp;<span class="num" id="8255789">0</span>&nbsp;<span class="op" id="8255791">||</span>&nbsp;<span class="builtinfunc" id="8255794">len</span><span class="op" id="8255797">(</span><span class="ident" id="8255798">tc</span><span class="op" id="8255800">.</span><span class="ident" id="8255801">source</span><span class="op" id="8255807">)</span>&nbsp;<span class="op" id="8255809">&lt;=</span>&nbsp;<span class="ident" id="8255812">r</span>&nbsp;<span class="op" id="8255814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255819">t</span><span class="op" id="8255820">.</span><span class="ident" id="8255821">Errorf</span><span class="op" id="8255827">(</span><span class="string" id="8255828">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="8255899">,</span>&nbsp;<span class="ident" id="8255901">tc</span><span class="op" id="8255903">.</span><span class="ident" id="8255904">name</span><span class="op" id="8255908">,</span>&nbsp;<span class="ident" id="8255910">s</span><span class="op" id="8255911">,</span>&nbsp;<span class="ident" id="8255913">i</span><span class="op" id="8255914">,</span>&nbsp;<span class="ident" id="8255916">n</span><span class="op" id="8255917">,</span>&nbsp;<span class="ident" id="8255919">r</span><span class="op" id="8255920">,</span>&nbsp;<span class="builtinfunc" id="8255922">len</span><span class="op" id="8255925">(</span><span class="ident" id="8255926">tc</span><span class="op" id="8255928">.</span><span class="ident" id="8255929">source</span><span class="op" id="8255935">)</span><span class="op" id="8255936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255940">}</span>&nbsp;<span class="keyword" id="8255942">else</span>&nbsp;<span class="keyword" id="8255947">if</span>&nbsp;<span class="op" id="8255950">!</span><span class="ident" id="8255951">strings</span><span class="op" id="8255958">.</span><span class="ident" id="8255959">HasPrefix</span><span class="op" id="8255968">(</span><span class="ident" id="8255969">tc</span><span class="op" id="8255971">.</span><span class="ident" id="8255972">source</span><span class="op" id="8255978">[</span><span class="ident" id="8255979">r</span><span class="op" id="8255980">:</span><span class="op" id="8255981">]</span><span class="op" id="8255982">,</span>&nbsp;<span class="ident" id="8255984">s</span><span class="op" id="8255985">)</span>&nbsp;<span class="op" id="8255987">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255992">t</span><span class="op" id="8255993">.</span><span class="ident" id="8255994">Errorf</span><span class="op" id="8256000">(</span><span class="string" id="8256001">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8256063">,</span>&nbsp;<span class="ident" id="8256065">tc</span><span class="op" id="8256067">.</span><span class="ident" id="8256068">name</span><span class="op" id="8256072">,</span>&nbsp;<span class="ident" id="8256074">s</span><span class="op" id="8256075">,</span>&nbsp;<span class="ident" id="8256077">i</span><span class="op" id="8256078">,</span>&nbsp;<span class="ident" id="8256080">n</span><span class="op" id="8256081">,</span>&nbsp;<span class="ident" id="8256083">r</span><span class="op" id="8256084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256092">if</span>&nbsp;<span class="ident" id="8256095">i</span>&nbsp;<span class="op" id="8256097">&gt;</span>&nbsp;<span class="num" id="8256099">0</span>&nbsp;<span class="op" id="8256101">&amp;&amp;</span>&nbsp;<span class="ident" id="8256104">res</span><span class="op" id="8256107">[</span><span class="ident" id="8256108">i</span><span class="op" id="8256109">-</span><span class="num" id="8256110">1</span><span class="op" id="8256111">]</span>&nbsp;<span class="op" id="8256113">==</span>&nbsp;<span class="ident" id="8256116">r</span>&nbsp;<span class="op" id="8256118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256123">t</span><span class="op" id="8256124">.</span><span class="ident" id="8256125">Errorf</span><span class="op" id="8256131">(</span><span class="string" id="8256132">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="8256198">,</span>&nbsp;<span class="ident" id="8256200">tc</span><span class="op" id="8256202">.</span><span class="ident" id="8256203">name</span><span class="op" id="8256207">,</span>&nbsp;<span class="ident" id="8256209">s</span><span class="op" id="8256210">,</span>&nbsp;<span class="ident" id="8256212">i</span><span class="op" id="8256213">,</span>&nbsp;<span class="ident" id="8256215">n</span><span class="op" id="8256216">,</span>&nbsp;<span class="ident" id="8256218">r</span><span class="op" id="8256219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256223">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256230">if</span>&nbsp;<span class="ident" id="8256233">n</span>&nbsp;<span class="op" id="8256235">&lt;</span>&nbsp;<span class="num" id="8256237">0</span>&nbsp;<span class="op" id="8256239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256243">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256304">for</span>&nbsp;<span class="ident" id="8256308">i</span><span class="op" id="8256309">,</span>&nbsp;<span class="ident" id="8256311">r</span>&nbsp;<span class="op" id="8256313">:=</span>&nbsp;<span class="keyword" id="8256316">range</span>&nbsp;<span class="ident" id="8256322">res</span>&nbsp;<span class="op" id="8256326">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256331">e</span>&nbsp;<span class="op" id="8256333">:=</span>&nbsp;<span class="ident" id="8256336">exp</span><span class="op" id="8256339">[</span><span class="ident" id="8256340">i</span><span class="op" id="8256341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256346">if</span>&nbsp;<span class="ident" id="8256349">r</span>&nbsp;<span class="op" id="8256351">!=</span>&nbsp;<span class="ident" id="8256354">e</span>&nbsp;<span class="op" id="8256356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256362">t</span><span class="op" id="8256363">.</span><span class="ident" id="8256364">Errorf</span><span class="op" id="8256370">(</span><span class="string" id="8256371">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8256429">,</span>&nbsp;<span class="ident" id="8256431">tc</span><span class="op" id="8256433">.</span><span class="ident" id="8256434">name</span><span class="op" id="8256438">,</span>&nbsp;<span class="ident" id="8256440">s</span><span class="op" id="8256441">,</span>&nbsp;<span class="ident" id="8256443">i</span><span class="op" id="8256444">,</span>&nbsp;<span class="ident" id="8256446">e</span><span class="op" id="8256447">,</span>&nbsp;<span class="ident" id="8256449">r</span><span class="op" id="8256450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256459">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256462">}</span><br>
<span class="lineno"></span><span class="op" id="8256464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8256467">func</span>&nbsp;<span class="ident" id="8256472">testFindAllIndex</span><span class="op" id="8256488">(</span><span class="ident" id="8256489">t</span>&nbsp;<span class="op" id="8256491">*</span><span class="ident" id="8256492">testing</span><span class="op" id="8256499">.</span><span class="ident" id="8256500">T</span><span class="op" id="8256501">,</span>&nbsp;<span class="ident" id="8256503">tc</span>&nbsp;<span class="op" id="8256506">*</span><span class="ident" id="8256507">testCase</span><span class="op" id="8256515">,</span>&nbsp;<span class="ident" id="8256517">x</span>&nbsp;<span class="op" id="8256519">*</span><span class="ident" id="8256520">Index</span><span class="op" id="8256525">,</span>&nbsp;<span class="ident" id="8256527">rx</span>&nbsp;<span class="op" id="8256530">*</span><span class="ident" id="8256531">regexp</span><span class="op" id="8256537">.</span><span class="ident" id="8256538">Regexp</span><span class="op" id="8256544">,</span>&nbsp;<span class="ident" id="8256546">n</span>&nbsp;<span class="builtintype" id="8256548">int</span><span class="op" id="8256551">)</span>&nbsp;<span class="op" id="8256553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256556">res</span>&nbsp;<span class="op" id="8256560">:=</span>&nbsp;<span class="ident" id="8256563">x</span><span class="op" id="8256564">.</span><span class="ident" id="8256565">FindAllIndex</span><span class="op" id="8256577">(</span><span class="ident" id="8256578">rx</span><span class="op" id="8256580">,</span>&nbsp;<span class="ident" id="8256582">n</span><span class="op" id="8256583">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256586">exp</span>&nbsp;<span class="op" id="8256590">:=</span>&nbsp;<span class="ident" id="8256593">rx</span><span class="op" id="8256595">.</span><span class="ident" id="8256596">FindAllStringIndex</span><span class="op" id="8256614">(</span><span class="ident" id="8256615">tc</span><span class="op" id="8256617">.</span><span class="ident" id="8256618">source</span><span class="op" id="8256624">,</span>&nbsp;<span class="ident" id="8256626">n</span><span class="op" id="8256627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256631">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256664">if</span>&nbsp;<span class="builtinfunc" id="8256667">len</span><span class="op" id="8256670">(</span><span class="ident" id="8256671">res</span><span class="op" id="8256674">)</span>&nbsp;<span class="op" id="8256676">!=</span>&nbsp;<span class="builtinfunc" id="8256679">len</span><span class="op" id="8256682">(</span><span class="ident" id="8256683">exp</span><span class="op" id="8256686">)</span>&nbsp;<span class="op" id="8256688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256692">t</span><span class="op" id="8256693">.</span><span class="ident" id="8256694">Errorf</span><span class="op" id="8256700">(</span><span class="string" id="8256701">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8256765">,</span>&nbsp;<span class="ident" id="8256767">tc</span><span class="op" id="8256769">.</span><span class="ident" id="8256770">name</span><span class="op" id="8256774">,</span>&nbsp;<span class="ident" id="8256776">rx</span><span class="op" id="8256778">,</span>&nbsp;<span class="ident" id="8256780">n</span><span class="op" id="8256781">,</span>&nbsp;<span class="builtinfunc" id="8256783">len</span><span class="op" id="8256786">(</span><span class="ident" id="8256787">exp</span><span class="op" id="8256790">)</span><span class="op" id="8256791">,</span>&nbsp;<span class="builtinfunc" id="8256793">len</span><span class="op" id="8256796">(</span><span class="ident" id="8256797">res</span><span class="op" id="8256800">)</span><span class="op" id="8256801">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256808">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256884">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256962">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257040">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257105">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257184">for</span>&nbsp;<span class="ident" id="8257188">i</span><span class="op" id="8257189">,</span>&nbsp;<span class="ident" id="8257191">r</span>&nbsp;<span class="op" id="8257193">:=</span>&nbsp;<span class="keyword" id="8257196">range</span>&nbsp;<span class="ident" id="8257202">res</span>&nbsp;<span class="op" id="8257206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257210">if</span>&nbsp;<span class="ident" id="8257213">r</span><span class="op" id="8257214">[</span><span class="num" id="8257215">0</span><span class="op" id="8257216">]</span>&nbsp;<span class="op" id="8257218">&lt;</span>&nbsp;<span class="num" id="8257220">0</span>&nbsp;<span class="op" id="8257222">||</span>&nbsp;<span class="ident" id="8257225">r</span><span class="op" id="8257226">[</span><span class="num" id="8257227">0</span><span class="op" id="8257228">]</span>&nbsp;<span class="op" id="8257230">&gt;</span>&nbsp;<span class="ident" id="8257232">r</span><span class="op" id="8257233">[</span><span class="num" id="8257234">1</span><span class="op" id="8257235">]</span>&nbsp;<span class="op" id="8257237">||</span>&nbsp;<span class="builtinfunc" id="8257240">len</span><span class="op" id="8257243">(</span><span class="ident" id="8257244">tc</span><span class="op" id="8257246">.</span><span class="ident" id="8257247">source</span><span class="op" id="8257253">)</span>&nbsp;<span class="op" id="8257255">&lt;</span>&nbsp;<span class="ident" id="8257257">r</span><span class="op" id="8257258">[</span><span class="num" id="8257259">1</span><span class="op" id="8257260">]</span>&nbsp;<span class="op" id="8257262">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257267">t</span><span class="op" id="8257268">.</span><span class="ident" id="8257269">Errorf</span><span class="op" id="8257275">(</span><span class="string" id="8257276">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8257347">,</span>&nbsp;<span class="ident" id="8257349">tc</span><span class="op" id="8257351">.</span><span class="ident" id="8257352">name</span><span class="op" id="8257356">,</span>&nbsp;<span class="ident" id="8257358">rx</span><span class="op" id="8257360">,</span>&nbsp;<span class="ident" id="8257362">i</span><span class="op" id="8257363">,</span>&nbsp;<span class="ident" id="8257365">n</span><span class="op" id="8257366">,</span>&nbsp;<span class="ident" id="8257368">r</span><span class="op" id="8257369">[</span><span class="num" id="8257370">0</span><span class="op" id="8257371">]</span><span class="op" id="8257372">,</span>&nbsp;<span class="ident" id="8257374">r</span><span class="op" id="8257375">[</span><span class="num" id="8257376">1</span><span class="op" id="8257377">]</span><span class="op" id="8257378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257382">}</span>&nbsp;<span class="keyword" id="8257384">else</span>&nbsp;<span class="keyword" id="8257389">if</span>&nbsp;<span class="op" id="8257392">!</span><span class="ident" id="8257393">rx</span><span class="op" id="8257395">.</span><span class="ident" id="8257396">MatchString</span><span class="op" id="8257407">(</span><span class="ident" id="8257408">tc</span><span class="op" id="8257410">.</span><span class="ident" id="8257411">source</span><span class="op" id="8257417">[</span><span class="ident" id="8257418">r</span><span class="op" id="8257419">[</span><span class="num" id="8257420">0</span><span class="op" id="8257421">]</span><span class="op" id="8257422">:</span><span class="ident" id="8257423">r</span><span class="op" id="8257424">[</span><span class="num" id="8257425">1</span><span class="op" id="8257426">]</span><span class="op" id="8257427">]</span><span class="op" id="8257428">)</span>&nbsp;<span class="op" id="8257430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257435">t</span><span class="op" id="8257436">.</span><span class="ident" id="8257437">Errorf</span><span class="op" id="8257443">(</span><span class="string" id="8257444">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8257512">,</span>&nbsp;<span class="ident" id="8257514">tc</span><span class="op" id="8257516">.</span><span class="ident" id="8257517">name</span><span class="op" id="8257521">,</span>&nbsp;<span class="ident" id="8257523">rx</span><span class="op" id="8257525">,</span>&nbsp;<span class="ident" id="8257527">i</span><span class="op" id="8257528">,</span>&nbsp;<span class="ident" id="8257530">n</span><span class="op" id="8257531">,</span>&nbsp;<span class="ident" id="8257533">r</span><span class="op" id="8257534">[</span><span class="num" id="8257535">0</span><span class="op" id="8257536">]</span><span class="op" id="8257537">,</span>&nbsp;<span class="ident" id="8257539">r</span><span class="op" id="8257540">[</span><span class="num" id="8257541">1</span><span class="op" id="8257542">]</span><span class="op" id="8257543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257550">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257554">if</span>&nbsp;<span class="ident" id="8257557">n</span>&nbsp;<span class="op" id="8257559">&lt;</span>&nbsp;<span class="num" id="8257561">0</span>&nbsp;<span class="op" id="8257563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257567">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257628">for</span>&nbsp;<span class="ident" id="8257632">i</span><span class="op" id="8257633">,</span>&nbsp;<span class="ident" id="8257635">r</span>&nbsp;<span class="op" id="8257637">:=</span>&nbsp;<span class="keyword" id="8257640">range</span>&nbsp;<span class="ident" id="8257646">res</span>&nbsp;<span class="op" id="8257650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257655">e</span>&nbsp;<span class="op" id="8257657">:=</span>&nbsp;<span class="ident" id="8257660">exp</span><span class="op" id="8257663">[</span><span class="ident" id="8257664">i</span><span class="op" id="8257665">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257670">if</span>&nbsp;<span class="ident" id="8257673">r</span><span class="op" id="8257674">[</span><span class="num" id="8257675">0</span><span class="op" id="8257676">]</span>&nbsp;<span class="op" id="8257678">!=</span>&nbsp;<span class="ident" id="8257681">e</span><span class="op" id="8257682">[</span><span class="num" id="8257683">0</span><span class="op" id="8257684">]</span>&nbsp;<span class="op" id="8257686">||</span>&nbsp;<span class="ident" id="8257689">r</span><span class="op" id="8257690">[</span><span class="num" id="8257691">1</span><span class="op" id="8257692">]</span>&nbsp;<span class="op" id="8257694">!=</span>&nbsp;<span class="ident" id="8257697">e</span><span class="op" id="8257698">[</span><span class="num" id="8257699">1</span><span class="op" id="8257700">]</span>&nbsp;<span class="op" id="8257702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257708">t</span><span class="op" id="8257709">.</span><span class="ident" id="8257710">Errorf</span><span class="op" id="8257716">(</span><span class="string" id="8257717">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8257793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257800">tc</span><span class="op" id="8257802">.</span><span class="ident" id="8257803">name</span><span class="op" id="8257807">,</span>&nbsp;<span class="ident" id="8257809">rx</span><span class="op" id="8257811">,</span>&nbsp;<span class="ident" id="8257813">i</span><span class="op" id="8257814">,</span>&nbsp;<span class="ident" id="8257816">e</span><span class="op" id="8257817">[</span><span class="num" id="8257818">0</span><span class="op" id="8257819">]</span><span class="op" id="8257820">,</span>&nbsp;<span class="ident" id="8257822">e</span><span class="op" id="8257823">[</span><span class="num" id="8257824">1</span><span class="op" id="8257825">]</span><span class="op" id="8257826">,</span>&nbsp;<span class="ident" id="8257828">r</span><span class="op" id="8257829">[</span><span class="num" id="8257830">0</span><span class="op" id="8257831">]</span><span class="op" id="8257832">,</span>&nbsp;<span class="ident" id="8257834">r</span><span class="op" id="8257835">[</span><span class="num" id="8257836">1</span><span class="op" id="8257837">]</span><span class="op" id="8257838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257847">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257850">}</span><br>
<span class="lineno"></span><span class="op" id="8257852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8257855">func</span>&nbsp;<span class="ident" id="8257860">testLookups</span><span class="op" id="8257871">(</span><span class="ident" id="8257872">t</span>&nbsp;<span class="op" id="8257874">*</span><span class="ident" id="8257875">testing</span><span class="op" id="8257882">.</span><span class="ident" id="8257883">T</span><span class="op" id="8257884">,</span>&nbsp;<span class="ident" id="8257886">tc</span>&nbsp;<span class="op" id="8257889">*</span><span class="ident" id="8257890">testCase</span><span class="op" id="8257898">,</span>&nbsp;<span class="ident" id="8257900">x</span>&nbsp;<span class="op" id="8257902">*</span><span class="ident" id="8257903">Index</span><span class="op" id="8257908">,</span>&nbsp;<span class="ident" id="8257910">n</span>&nbsp;<span class="builtintype" id="8257912">int</span><span class="op" id="8257915">)</span>&nbsp;<span class="op" id="8257917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257920">for</span>&nbsp;<span class="ident" id="8257924">_</span><span class="op" id="8257925">,</span>&nbsp;<span class="ident" id="8257927">pat</span>&nbsp;<span class="op" id="8257931">:=</span>&nbsp;<span class="keyword" id="8257934">range</span>&nbsp;<span class="ident" id="8257940">tc</span><span class="op" id="8257942">.</span><span class="ident" id="8257943">patterns</span>&nbsp;<span class="op" id="8257952">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257956">testLookup</span><span class="op" id="8257966">(</span><span class="ident" id="8257967">t</span><span class="op" id="8257968">,</span>&nbsp;<span class="ident" id="8257970">tc</span><span class="op" id="8257972">,</span>&nbsp;<span class="ident" id="8257974">x</span><span class="op" id="8257975">,</span>&nbsp;<span class="ident" id="8257977">pat</span><span class="op" id="8257980">,</span>&nbsp;<span class="ident" id="8257982">n</span><span class="op" id="8257983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257987">if</span>&nbsp;<span class="ident" id="8257990">rx</span><span class="op" id="8257992">,</span>&nbsp;<span class="ident" id="8257994">err</span>&nbsp;<span class="op" id="8257998">:=</span>&nbsp;<span class="ident" id="8258001">regexp</span><span class="op" id="8258007">.</span><span class="ident" id="8258008">Compile</span><span class="op" id="8258015">(</span><span class="ident" id="8258016">pat</span><span class="op" id="8258019">)</span><span class="op" id="8258020">;</span>&nbsp;<span class="ident" id="8258022">err</span>&nbsp;<span class="op" id="8258026">==</span>&nbsp;<span class="ident" id="8258029">nil</span>&nbsp;<span class="op" id="8258033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258038">testFindAllIndex</span><span class="op" id="8258054">(</span><span class="ident" id="8258055">t</span><span class="op" id="8258056">,</span>&nbsp;<span class="ident" id="8258058">tc</span><span class="op" id="8258060">,</span>&nbsp;<span class="ident" id="8258062">x</span><span class="op" id="8258063">,</span>&nbsp;<span class="ident" id="8258065">rx</span><span class="op" id="8258067">,</span>&nbsp;<span class="ident" id="8258069">n</span><span class="op" id="8258070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258077">}</span><br>
<span class="lineno">205</span><span class="op" id="8258079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8258082">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="8258126">type</span>&nbsp;<span class="ident" id="8258131">index</span>&nbsp;<span class="ident" id="8258137">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="8258144">func</span>&nbsp;<span class="op" id="8258149">(</span><span class="ident" id="8258150">x</span>&nbsp;<span class="op" id="8258152">*</span><span class="ident" id="8258153">index</span><span class="op" id="8258158">)</span>&nbsp;<span class="ident" id="8258160">Len</span><span class="op" id="8258163">(</span><span class="op" id="8258164">)</span>&nbsp;<span class="builtintype" id="8258166">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8258180">{</span>&nbsp;<span class="keyword" id="8258182">return</span>&nbsp;<span class="builtinfunc" id="8258189">len</span><span class="op" id="8258192">(</span><span class="ident" id="8258193">x</span><span class="op" id="8258194">.</span><span class="ident" id="8258195">sa</span><span class="op" id="8258197">)</span>&nbsp;<span class="op" id="8258199">}</span><br>
<span class="lineno"></span><span class="keyword" id="8258201">func</span>&nbsp;<span class="op" id="8258206">(</span><span class="ident" id="8258207">x</span>&nbsp;<span class="op" id="8258209">*</span><span class="ident" id="8258210">index</span><span class="op" id="8258215">)</span>&nbsp;<span class="ident" id="8258217">Less</span><span class="op" id="8258221">(</span><span class="ident" id="8258222">i</span><span class="op" id="8258223">,</span>&nbsp;<span class="ident" id="8258225">j</span>&nbsp;<span class="builtintype" id="8258227">int</span><span class="op" id="8258230">)</span>&nbsp;<span class="builtintype" id="8258232">bool</span>&nbsp;<span class="op" id="8258237">{</span>&nbsp;<span class="keyword" id="8258239">return</span>&nbsp;<span class="ident" id="8258246">bytes</span><span class="op" id="8258251">.</span><span class="ident" id="8258252">Compare</span><span class="op" id="8258259">(</span><span class="ident" id="8258260">x</span><span class="op" id="8258261">.</span><span class="ident" id="8258262">at</span><span class="op" id="8258264">(</span><span class="ident" id="8258265">i</span><span class="op" id="8258266">)</span><span class="op" id="8258267">,</span>&nbsp;<span class="ident" id="8258269">x</span><span class="op" id="8258270">.</span><span class="ident" id="8258271">at</span><span class="op" id="8258273">(</span><span class="ident" id="8258274">j</span><span class="op" id="8258275">)</span><span class="op" id="8258276">)</span>&nbsp;<span class="op" id="8258278">&lt;</span>&nbsp;<span class="num" id="8258280">0</span>&nbsp;<span class="op" id="8258282">}</span><br>
<span class="lineno"></span><span class="keyword" id="8258284">func</span>&nbsp;<span class="op" id="8258289">(</span><span class="ident" id="8258290">x</span>&nbsp;<span class="op" id="8258292">*</span><span class="ident" id="8258293">index</span><span class="op" id="8258298">)</span>&nbsp;<span class="ident" id="8258300">Swap</span><span class="op" id="8258304">(</span><span class="ident" id="8258305">i</span><span class="op" id="8258306">,</span>&nbsp;<span class="ident" id="8258308">j</span>&nbsp;<span class="builtintype" id="8258310">int</span><span class="op" id="8258313">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8258320">{</span>&nbsp;<span class="ident" id="8258322">x</span><span class="op" id="8258323">.</span><span class="ident" id="8258324">sa</span><span class="op" id="8258326">[</span><span class="ident" id="8258327">i</span><span class="op" id="8258328">]</span><span class="op" id="8258329">,</span>&nbsp;<span class="ident" id="8258331">x</span><span class="op" id="8258332">.</span><span class="ident" id="8258333">sa</span><span class="op" id="8258335">[</span><span class="ident" id="8258336">j</span><span class="op" id="8258337">]</span>&nbsp;<span class="op" id="8258339">=</span>&nbsp;<span class="ident" id="8258341">x</span><span class="op" id="8258342">.</span><span class="ident" id="8258343">sa</span><span class="op" id="8258345">[</span><span class="ident" id="8258346">j</span><span class="op" id="8258347">]</span><span class="op" id="8258348">,</span>&nbsp;<span class="ident" id="8258350">x</span><span class="op" id="8258351">.</span><span class="ident" id="8258352">sa</span><span class="op" id="8258354">[</span><span class="ident" id="8258355">i</span><span class="op" id="8258356">]</span>&nbsp;<span class="op" id="8258358">}</span><br>
<span class="lineno"></span><span class="keyword" id="8258360">func</span>&nbsp;<span class="op" id="8258365">(</span><span class="ident" id="8258366">a</span>&nbsp;<span class="op" id="8258368">*</span><span class="ident" id="8258369">index</span><span class="op" id="8258374">)</span>&nbsp;<span class="ident" id="8258376">at</span><span class="op" id="8258378">(</span><span class="ident" id="8258379">i</span>&nbsp;<span class="builtintype" id="8258381">int</span><span class="op" id="8258384">)</span>&nbsp;<span class="op" id="8258386">[</span><span class="op" id="8258387">]</span><span class="builtintype" id="8258388">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8258396">{</span>&nbsp;<span class="keyword" id="8258398">return</span>&nbsp;<span class="ident" id="8258405">a</span><span class="op" id="8258406">.</span><span class="ident" id="8258407">data</span><span class="op" id="8258411">[</span><span class="ident" id="8258412">a</span><span class="op" id="8258413">.</span><span class="ident" id="8258414">sa</span><span class="op" id="8258416">[</span><span class="ident" id="8258417">i</span><span class="op" id="8258418">]</span><span class="op" id="8258419">:</span><span class="op" id="8258420">]</span>&nbsp;<span class="op" id="8258422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8258425">func</span>&nbsp;<span class="ident" id="8258430">testConstruction</span><span class="op" id="8258446">(</span><span class="ident" id="8258447">t</span>&nbsp;<span class="op" id="8258449">*</span><span class="ident" id="8258450">testing</span><span class="op" id="8258457">.</span><span class="ident" id="8258458">T</span><span class="op" id="8258459">,</span>&nbsp;<span class="ident" id="8258461">tc</span>&nbsp;<span class="op" id="8258464">*</span><span class="ident" id="8258465">testCase</span><span class="op" id="8258473">,</span>&nbsp;<span class="ident" id="8258475">x</span>&nbsp;<span class="op" id="8258477">*</span><span class="ident" id="8258478">Index</span><span class="op" id="8258483">)</span>&nbsp;<span class="op" id="8258485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258488">if</span>&nbsp;<span class="op" id="8258491">!</span><span class="ident" id="8258492">sort</span><span class="op" id="8258496">.</span><span class="ident" id="8258497">IsSorted</span><span class="op" id="8258505">(</span><span class="op" id="8258506">(</span><span class="op" id="8258507">*</span><span class="ident" id="8258508">index</span><span class="op" id="8258513">)</span><span class="op" id="8258514">(</span><span class="ident" id="8258515">x</span><span class="op" id="8258516">)</span><span class="op" id="8258517">)</span>&nbsp;<span class="op" id="8258519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258523">t</span><span class="op" id="8258524">.</span><span class="ident" id="8258525">Errorf</span><span class="op" id="8258531">(</span><span class="string" id="8258532">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="8258560">,</span>&nbsp;<span class="ident" id="8258562">tc</span><span class="op" id="8258564">.</span><span class="ident" id="8258565">name</span><span class="op" id="8258569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258572">}</span><br>
<span class="lineno"></span><span class="op" id="8258574">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8258577">func</span>&nbsp;<span class="ident" id="8258582">equal</span><span class="op" id="8258587">(</span><span class="ident" id="8258588">x</span><span class="op" id="8258589">,</span>&nbsp;<span class="ident" id="8258591">y</span>&nbsp;<span class="op" id="8258593">*</span><span class="ident" id="8258594">Index</span><span class="op" id="8258599">)</span>&nbsp;<span class="builtintype" id="8258601">bool</span>&nbsp;<span class="op" id="8258606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258609">if</span>&nbsp;<span class="op" id="8258612">!</span><span class="ident" id="8258613">bytes</span><span class="op" id="8258618">.</span><span class="ident" id="8258619">Equal</span><span class="op" id="8258624">(</span><span class="ident" id="8258625">x</span><span class="op" id="8258626">.</span><span class="ident" id="8258627">data</span><span class="op" id="8258631">,</span>&nbsp;<span class="ident" id="8258633">y</span><span class="op" id="8258634">.</span><span class="ident" id="8258635">data</span><span class="op" id="8258639">)</span>&nbsp;<span class="op" id="8258641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258645">return</span>&nbsp;<span class="builtintype" id="8258652">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258659">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258662">for</span>&nbsp;<span class="ident" id="8258666">i</span><span class="op" id="8258667">,</span>&nbsp;<span class="ident" id="8258669">j</span>&nbsp;<span class="op" id="8258671">:=</span>&nbsp;<span class="keyword" id="8258674">range</span>&nbsp;<span class="ident" id="8258680">x</span><span class="op" id="8258681">.</span><span class="ident" id="8258682">sa</span>&nbsp;<span class="op" id="8258685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258689">if</span>&nbsp;<span class="ident" id="8258692">j</span>&nbsp;<span class="op" id="8258694">!=</span>&nbsp;<span class="ident" id="8258697">y</span><span class="op" id="8258698">.</span><span class="ident" id="8258699">sa</span><span class="op" id="8258701">[</span><span class="ident" id="8258702">i</span><span class="op" id="8258703">]</span>&nbsp;<span class="op" id="8258705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258710">return</span>&nbsp;<span class="builtintype" id="8258717">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258728">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258731">return</span>&nbsp;<span class="builtintype" id="8258738">true</span><br>
<span class="lineno"></span><span class="op" id="8258743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8258746">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="8258783">func</span>&nbsp;<span class="ident" id="8258788">testSaveRestore</span><span class="op" id="8258803">(</span><span class="ident" id="8258804">t</span>&nbsp;<span class="op" id="8258806">*</span><span class="ident" id="8258807">testing</span><span class="op" id="8258814">.</span><span class="ident" id="8258815">T</span><span class="op" id="8258816">,</span>&nbsp;<span class="ident" id="8258818">tc</span>&nbsp;<span class="op" id="8258821">*</span><span class="ident" id="8258822">testCase</span><span class="op" id="8258830">,</span>&nbsp;<span class="ident" id="8258832">x</span>&nbsp;<span class="op" id="8258834">*</span><span class="ident" id="8258835">Index</span><span class="op" id="8258840">)</span>&nbsp;<span class="builtintype" id="8258842">int</span>&nbsp;<span class="op" id="8258846">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258849">var</span>&nbsp;<span class="ident" id="8258853">buf</span>&nbsp;<span class="ident" id="8258857">bytes</span><span class="op" id="8258862">.</span><span class="ident" id="8258863">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258871">if</span>&nbsp;<span class="ident" id="8258874">err</span>&nbsp;<span class="op" id="8258878">:=</span>&nbsp;<span class="ident" id="8258881">x</span><span class="op" id="8258882">.</span><span class="ident" id="8258883">Write</span><span class="op" id="8258888">(</span><span class="op" id="8258889">&amp;</span><span class="ident" id="8258890">buf</span><span class="op" id="8258893">)</span><span class="op" id="8258894">;</span>&nbsp;<span class="ident" id="8258896">err</span>&nbsp;<span class="op" id="8258900">!=</span>&nbsp;<span class="ident" id="8258903">nil</span>&nbsp;<span class="op" id="8258907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258911">t</span><span class="op" id="8258912">.</span><span class="ident" id="8258913">Errorf</span><span class="op" id="8258919">(</span><span class="string" id="8258920">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8258950">,</span>&nbsp;<span class="ident" id="8258952">tc</span><span class="op" id="8258954">.</span><span class="ident" id="8258955">name</span><span class="op" id="8258959">,</span>&nbsp;<span class="ident" id="8258961">err</span><span class="op" id="8258964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258970">size</span>&nbsp;<span class="op" id="8258975">:=</span>&nbsp;<span class="ident" id="8258978">buf</span><span class="op" id="8258981">.</span><span class="ident" id="8258982">Len</span><span class="op" id="8258985">(</span><span class="op" id="8258986">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258989">var</span>&nbsp;<span class="ident" id="8258993">y</span>&nbsp;<span class="ident" id="8258995">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259002">if</span>&nbsp;<span class="ident" id="8259005">err</span>&nbsp;<span class="op" id="8259009">:=</span>&nbsp;<span class="ident" id="8259012">y</span><span class="op" id="8259013">.</span><span class="ident" id="8259014">Read</span><span class="op" id="8259018">(</span><span class="op" id="8259019">&amp;</span><span class="ident" id="8259020">buf</span><span class="op" id="8259023">)</span><span class="op" id="8259024">;</span>&nbsp;<span class="ident" id="8259026">err</span>&nbsp;<span class="op" id="8259030">!=</span>&nbsp;<span class="ident" id="8259033">nil</span>&nbsp;<span class="op" id="8259037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259041">t</span><span class="op" id="8259042">.</span><span class="ident" id="8259043">Errorf</span><span class="op" id="8259049">(</span><span class="string" id="8259050">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8259080">,</span>&nbsp;<span class="ident" id="8259082">tc</span><span class="op" id="8259084">.</span><span class="ident" id="8259085">name</span><span class="op" id="8259089">,</span>&nbsp;<span class="ident" id="8259091">err</span><span class="op" id="8259094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259100">if</span>&nbsp;<span class="op" id="8259103">!</span><span class="ident" id="8259104">equal</span><span class="op" id="8259109">(</span><span class="ident" id="8259110">x</span><span class="op" id="8259111">,</span>&nbsp;<span class="op" id="8259113">&amp;</span><span class="ident" id="8259114">y</span><span class="op" id="8259115">)</span>&nbsp;<span class="op" id="8259117">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259121">t</span><span class="op" id="8259122">.</span><span class="ident" id="8259123">Errorf</span><span class="op" id="8259129">(</span><span class="string" id="8259130">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="8259175">,</span>&nbsp;<span class="ident" id="8259177">tc</span><span class="op" id="8259179">.</span><span class="ident" id="8259180">name</span><span class="op" id="8259184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259190">return</span>&nbsp;<span class="ident" id="8259197">size</span><br>
<span class="lineno"></span><span class="op" id="8259202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="8259205">func</span>&nbsp;<span class="ident" id="8259210">TestIndex</span><span class="op" id="8259219">(</span><span class="ident" id="8259220">t</span>&nbsp;<span class="op" id="8259222">*</span><span class="ident" id="8259223">testing</span><span class="op" id="8259230">.</span><span class="ident" id="8259231">T</span><span class="op" id="8259232">)</span>&nbsp;<span class="op" id="8259234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259237">for</span>&nbsp;<span class="ident" id="8259241">_</span><span class="op" id="8259242">,</span>&nbsp;<span class="ident" id="8259244">tc</span>&nbsp;<span class="op" id="8259247">:=</span>&nbsp;<span class="keyword" id="8259250">range</span>&nbsp;<span class="ident" id="8259256">testCases</span>&nbsp;<span class="op" id="8259266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259270">x</span>&nbsp;<span class="op" id="8259272">:=</span>&nbsp;<span class="ident" id="8259275">New</span><span class="op" id="8259278">(</span><span class="op" id="8259279">[</span><span class="op" id="8259280">]</span><span class="builtintype" id="8259281">byte</span><span class="op" id="8259285">(</span><span class="ident" id="8259286">tc</span><span class="op" id="8259288">.</span><span class="ident" id="8259289">source</span><span class="op" id="8259295">)</span><span class="op" id="8259296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259300">testConstruction</span><span class="op" id="8259316">(</span><span class="ident" id="8259317">t</span><span class="op" id="8259318">,</span>&nbsp;<span class="op" id="8259320">&amp;</span><span class="ident" id="8259321">tc</span><span class="op" id="8259323">,</span>&nbsp;<span class="ident" id="8259325">x</span><span class="op" id="8259326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259330">testSaveRestore</span><span class="op" id="8259345">(</span><span class="ident" id="8259346">t</span><span class="op" id="8259347">,</span>&nbsp;<span class="op" id="8259349">&amp;</span><span class="ident" id="8259350">tc</span><span class="op" id="8259352">,</span>&nbsp;<span class="ident" id="8259354">x</span><span class="op" id="8259355">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259359">testLookups</span><span class="op" id="8259370">(</span><span class="ident" id="8259371">t</span><span class="op" id="8259372">,</span>&nbsp;<span class="op" id="8259374">&amp;</span><span class="ident" id="8259375">tc</span><span class="op" id="8259377">,</span>&nbsp;<span class="ident" id="8259379">x</span><span class="op" id="8259380">,</span>&nbsp;<span class="num" id="8259382">0</span><span class="op" id="8259383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259387">testLookups</span><span class="op" id="8259398">(</span><span class="ident" id="8259399">t</span><span class="op" id="8259400">,</span>&nbsp;<span class="op" id="8259402">&amp;</span><span class="ident" id="8259403">tc</span><span class="op" id="8259405">,</span>&nbsp;<span class="ident" id="8259407">x</span><span class="op" id="8259408">,</span>&nbsp;<span class="num" id="8259410">1</span><span class="op" id="8259411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259415">testLookups</span><span class="op" id="8259426">(</span><span class="ident" id="8259427">t</span><span class="op" id="8259428">,</span>&nbsp;<span class="op" id="8259430">&amp;</span><span class="ident" id="8259431">tc</span><span class="op" id="8259433">,</span>&nbsp;<span class="ident" id="8259435">x</span><span class="op" id="8259436">,</span>&nbsp;<span class="num" id="8259438">10</span><span class="op" id="8259440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259444">testLookups</span><span class="op" id="8259455">(</span><span class="ident" id="8259456">t</span><span class="op" id="8259457">,</span>&nbsp;<span class="op" id="8259459">&amp;</span><span class="ident" id="8259460">tc</span><span class="op" id="8259462">,</span>&nbsp;<span class="ident" id="8259464">x</span><span class="op" id="8259465">,</span>&nbsp;<span class="num" id="8259467">2e9</span><span class="op" id="8259470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259474">testLookups</span><span class="op" id="8259485">(</span><span class="ident" id="8259486">t</span><span class="op" id="8259487">,</span>&nbsp;<span class="op" id="8259489">&amp;</span><span class="ident" id="8259490">tc</span><span class="op" id="8259492">,</span>&nbsp;<span class="ident" id="8259494">x</span><span class="op" id="8259495">,</span>&nbsp;<span class="op" id="8259497">-</span><span class="num" id="8259498">1</span><span class="op" id="8259499">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259502">}</span><br>
<span class="lineno"></span><span class="op" id="8259504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8259507">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="8259586">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="8259660">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="8259722">func</span>&nbsp;<span class="ident" id="8259727">benchmarkNew</span><span class="op" id="8259739">(</span><span class="ident" id="8259740">b</span>&nbsp;<span class="op" id="8259742">*</span><span class="ident" id="8259743">testing</span><span class="op" id="8259750">.</span><span class="ident" id="8259751">B</span><span class="op" id="8259752">,</span>&nbsp;<span class="ident" id="8259754">random</span>&nbsp;<span class="builtintype" id="8259761">bool</span><span class="op" id="8259765">)</span>&nbsp;<span class="op" id="8259767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259770">b</span><span class="op" id="8259771">.</span><span class="ident" id="8259772">StopTimer</span><span class="op" id="8259781">(</span><span class="op" id="8259782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259785">data</span>&nbsp;<span class="op" id="8259790">:=</span>&nbsp;<span class="builtinfunc" id="8259793">make</span><span class="op" id="8259797">(</span><span class="op" id="8259798">[</span><span class="op" id="8259799">]</span><span class="builtintype" id="8259800">byte</span><span class="op" id="8259804">,</span>&nbsp;<span class="num" id="8259806">1e6</span><span class="op" id="8259809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259812">if</span>&nbsp;<span class="ident" id="8259815">random</span>&nbsp;<span class="op" id="8259822">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259826">for</span>&nbsp;<span class="ident" id="8259830">i</span>&nbsp;<span class="op" id="8259832">:=</span>&nbsp;<span class="keyword" id="8259835">range</span>&nbsp;<span class="ident" id="8259841">data</span>&nbsp;<span class="op" id="8259846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259851">data</span><span class="op" id="8259855">[</span><span class="ident" id="8259856">i</span><span class="op" id="8259857">]</span>&nbsp;<span class="op" id="8259859">=</span>&nbsp;<span class="builtintype" id="8259861">byte</span><span class="op" id="8259865">(</span><span class="ident" id="8259866">rand</span><span class="op" id="8259870">.</span><span class="ident" id="8259871">Intn</span><span class="op" id="8259875">(</span><span class="num" id="8259876">256</span><span class="op" id="8259879">)</span><span class="op" id="8259880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259890">b</span><span class="op" id="8259891">.</span><span class="ident" id="8259892">StartTimer</span><span class="op" id="8259902">(</span><span class="op" id="8259903">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259906">for</span>&nbsp;<span class="ident" id="8259910">i</span>&nbsp;<span class="op" id="8259912">:=</span>&nbsp;<span class="num" id="8259915">0</span><span class="op" id="8259916">;</span>&nbsp;<span class="ident" id="8259918">i</span>&nbsp;<span class="op" id="8259920">&lt;</span>&nbsp;<span class="ident" id="8259922">b</span><span class="op" id="8259923">.</span><span class="ident" id="8259924">N</span><span class="op" id="8259925">;</span>&nbsp;<span class="ident" id="8259927">i</span><span class="op" id="8259928">++</span>&nbsp;<span class="op" id="8259931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259935">New</span><span class="op" id="8259938">(</span><span class="ident" id="8259939">data</span><span class="op" id="8259943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259946">}</span><br>
<span class="lineno"></span><span class="op" id="8259948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8259951">func</span>&nbsp;<span class="ident" id="8259956">BenchmarkNewIndexRandom</span><span class="op" id="8259979">(</span><span class="ident" id="8259980">b</span>&nbsp;<span class="op" id="8259982">*</span><span class="ident" id="8259983">testing</span><span class="op" id="8259990">.</span><span class="ident" id="8259991">B</span><span class="op" id="8259992">)</span>&nbsp;<span class="op" id="8259994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259997">benchmarkNew</span><span class="op" id="8260009">(</span><span class="ident" id="8260010">b</span><span class="op" id="8260011">,</span>&nbsp;<span class="builtintype" id="8260013">true</span><span class="op" id="8260017">)</span><br>
<span class="lineno"></span><span class="op" id="8260019">}</span><br>
<span class="lineno"></span><span class="keyword" id="8260021">func</span>&nbsp;<span class="ident" id="8260026">BenchmarkNewIndexRepeat</span><span class="op" id="8260049">(</span><span class="ident" id="8260050">b</span>&nbsp;<span class="op" id="8260052">*</span><span class="ident" id="8260053">testing</span><span class="op" id="8260060">.</span><span class="ident" id="8260061">B</span><span class="op" id="8260062">)</span>&nbsp;<span class="op" id="8260064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260067">benchmarkNew</span><span class="op" id="8260079">(</span><span class="ident" id="8260080">b</span><span class="op" id="8260081">,</span>&nbsp;<span class="builtintype" id="8260083">false</span><span class="op" id="8260088">)</span><br>
<span class="lineno">285</span><span class="op" id="8260090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8260093">func</span>&nbsp;<span class="ident" id="8260098">BenchmarkSaveRestore</span><span class="op" id="8260118">(</span><span class="ident" id="8260119">b</span>&nbsp;<span class="op" id="8260121">*</span><span class="ident" id="8260122">testing</span><span class="op" id="8260129">.</span><span class="ident" id="8260130">B</span><span class="op" id="8260131">)</span>&nbsp;<span class="op" id="8260133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260136">b</span><span class="op" id="8260137">.</span><span class="ident" id="8260138">StopTimer</span><span class="op" id="8260147">(</span><span class="op" id="8260148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260151">r</span>&nbsp;<span class="op" id="8260153">:=</span>&nbsp;<span class="ident" id="8260156">rand</span><span class="op" id="8260160">.</span><span class="ident" id="8260161">New</span><span class="op" id="8260164">(</span><span class="ident" id="8260165">rand</span><span class="op" id="8260169">.</span><span class="ident" id="8260170">NewSource</span><span class="op" id="8260179">(</span><span class="num" id="8260180">0x5a77a1</span><span class="op" id="8260188">)</span><span class="op" id="8260189">)</span>&nbsp;<span class="comment" id="8260191">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260226">data</span>&nbsp;<span class="op" id="8260231">:=</span>&nbsp;<span class="builtinfunc" id="8260234">make</span><span class="op" id="8260238">(</span><span class="op" id="8260239">[</span><span class="op" id="8260240">]</span><span class="builtintype" id="8260241">byte</span><span class="op" id="8260245">,</span>&nbsp;<span class="num" id="8260247">1</span><span class="op" id="8260248">&lt;&lt;</span><span class="num" id="8260250">20</span><span class="op" id="8260252">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8260266">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260291">for</span>&nbsp;<span class="ident" id="8260295">i</span>&nbsp;<span class="op" id="8260297">:=</span>&nbsp;<span class="keyword" id="8260300">range</span>&nbsp;<span class="ident" id="8260306">data</span>&nbsp;<span class="op" id="8260311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260315">data</span><span class="op" id="8260319">[</span><span class="ident" id="8260320">i</span><span class="op" id="8260321">]</span>&nbsp;<span class="op" id="8260323">=</span>&nbsp;<span class="builtintype" id="8260325">byte</span><span class="op" id="8260329">(</span><span class="ident" id="8260330">r</span><span class="op" id="8260331">.</span><span class="ident" id="8260332">Intn</span><span class="op" id="8260336">(</span><span class="num" id="8260337">256</span><span class="op" id="8260340">)</span><span class="op" id="8260341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260347">x</span>&nbsp;<span class="op" id="8260349">:=</span>&nbsp;<span class="ident" id="8260352">New</span><span class="op" id="8260355">(</span><span class="ident" id="8260356">data</span><span class="op" id="8260360">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260363">size</span>&nbsp;<span class="op" id="8260368">:=</span>&nbsp;<span class="ident" id="8260371">testSaveRestore</span><span class="op" id="8260386">(</span><span class="ident" id="8260387">nil</span><span class="op" id="8260390">,</span>&nbsp;<span class="ident" id="8260392">nil</span><span class="op" id="8260395">,</span>&nbsp;<span class="ident" id="8260397">x</span><span class="op" id="8260398">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8260406">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260429">buf</span>&nbsp;<span class="op" id="8260433">:=</span>&nbsp;<span class="ident" id="8260436">bytes</span><span class="op" id="8260441">.</span><span class="ident" id="8260442">NewBuffer</span><span class="op" id="8260451">(</span><span class="builtinfunc" id="8260452">make</span><span class="op" id="8260456">(</span><span class="op" id="8260457">[</span><span class="op" id="8260458">]</span><span class="builtintype" id="8260459">byte</span><span class="op" id="8260463">,</span>&nbsp;<span class="ident" id="8260465">size</span><span class="op" id="8260469">)</span><span class="op" id="8260470">)</span>&nbsp;<span class="comment" id="8260472">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260490">b</span><span class="op" id="8260491">.</span><span class="ident" id="8260492">SetBytes</span><span class="op" id="8260500">(</span><span class="ident" id="8260501">int64</span><span class="op" id="8260506">(</span><span class="ident" id="8260507">size</span><span class="op" id="8260511">)</span><span class="op" id="8260512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260515">b</span><span class="op" id="8260516">.</span><span class="ident" id="8260517">StartTimer</span><span class="op" id="8260527">(</span><span class="op" id="8260528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260531">for</span>&nbsp;<span class="ident" id="8260535">i</span>&nbsp;<span class="op" id="8260537">:=</span>&nbsp;<span class="num" id="8260540">0</span><span class="op" id="8260541">;</span>&nbsp;<span class="ident" id="8260543">i</span>&nbsp;<span class="op" id="8260545">&lt;</span>&nbsp;<span class="ident" id="8260547">b</span><span class="op" id="8260548">.</span><span class="ident" id="8260549">N</span><span class="op" id="8260550">;</span>&nbsp;<span class="ident" id="8260552">i</span><span class="op" id="8260553">++</span>&nbsp;<span class="op" id="8260556">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260560">x</span><span class="op" id="8260561">.</span><span class="ident" id="8260562">Write</span><span class="op" id="8260567">(</span><span class="ident" id="8260568">buf</span><span class="op" id="8260571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260575">var</span>&nbsp;<span class="ident" id="8260579">y</span>&nbsp;<span class="ident" id="8260581">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260589">y</span><span class="op" id="8260590">.</span><span class="ident" id="8260591">Read</span><span class="op" id="8260595">(</span><span class="ident" id="8260596">buf</span><span class="op" id="8260599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260602">}</span><br>
<span class="lineno"></span><span class="op" id="8260604">}</span>
</div>
</body>
</html>
