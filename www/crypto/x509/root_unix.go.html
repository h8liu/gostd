<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4011646">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4011701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4011755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4011806">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4011869">package</span>&nbsp;<span class="ident" id="4011877">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4011883">import</span>&nbsp;<span class="string" id="4011890">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4011903">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4011958">var</span>&nbsp;<span class="ident" id="4011962">certFiles</span>&nbsp;<span class="op" id="4011972">=</span>&nbsp;<span class="op" id="4011974">[</span><span class="op" id="4011975">]</span><span class="builtintype" id="4011976">string</span><span class="op" id="4011982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011985">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4012021">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012027">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012057">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4012091">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012099">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012115">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4012139">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012157">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012170">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4012189">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012212">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012224">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4012264">,</span>&nbsp;<span class="comment" id="4012266">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012288">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4012313">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012330">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012343">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4012375">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4012385">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4012402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4012405">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4012477">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4012524">var</span>&nbsp;<span class="ident" id="4012528">certDirectories</span>&nbsp;<span class="op" id="4012544">=</span>&nbsp;<span class="op" id="4012546">[</span><span class="op" id="4012547">]</span><span class="builtintype" id="4012548">string</span><span class="op" id="4012554">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4012557">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4012587">,</span>&nbsp;<span class="comment" id="4012589">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4012601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4012604">func</span>&nbsp;<span class="op" id="4012609">(</span><span class="ident" id="4012610">c</span>&nbsp;<span class="op" id="4012612">*</span><span class="ident" id="4012613"><a href="/crypto/x509/x509.go.html#4044200">Certificate</a></span><span class="op" id="4012624">)</span>&nbsp;<span class="ident" id="4012626">systemVerify</span><span class="op" id="4012638">(</span><span class="ident" id="4012639">opts</span>&nbsp;<span class="op" id="4012644">*</span><span class="ident" id="4012645"><a href="/crypto/x509/verify.go.html#4019904">VerifyOptions</a></span><span class="op" id="4012658">)</span>&nbsp;<span class="op" id="4012660">(</span><span class="ident" id="4012661">chains</span>&nbsp;<span class="op" id="4012668">[</span><span class="op" id="4012669">]</span><span class="op" id="4012670">[</span><span class="op" id="4012671">]</span><span class="op" id="4012672">*</span><span class="ident" id="4012673"><a href="/crypto/x509/x509.go.html#4044200">Certificate</a></span><span class="op" id="4012684">,</span>&nbsp;<span class="ident" id="4012686">err</span>&nbsp;<span class="builtintype" id="4012690">error</span><span class="op" id="4012695">)</span>&nbsp;<span class="op" id="4012697">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012700">return</span>&nbsp;<span class="ident" id="4012707">nil</span><span class="op" id="4012710">,</span>&nbsp;<span class="ident" id="4012712">nil</span><br>
<span class="lineno"></span><span class="op" id="4012716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4012719">func</span>&nbsp;<span class="ident" id="4012724">initSystemRoots</span><span class="op" id="4012739">(</span><span class="op" id="4012740">)</span>&nbsp;<span class="op" id="4012742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012745">roots</span>&nbsp;<span class="op" id="4012751">:=</span>&nbsp;<span class="ident" id="4012754"><a href="/crypto/x509/cert_pool.go.html#3998029">NewCertPool</a></span><span class="op" id="4012765">(</span><span class="op" id="4012766">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012769">for</span>&nbsp;<span class="ident" id="4012773">_</span><span class="op" id="4012774">,</span>&nbsp;<span class="ident" id="4012776">file</span>&nbsp;<span class="op" id="4012781">:=</span>&nbsp;<span class="keyword" id="4012784">range</span>&nbsp;<span class="ident" id="4012790"><a href="/crypto/x509/root_unix.go.html#4011962">certFiles</a></span>&nbsp;<span class="op" id="4012800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012804">data</span><span class="op" id="4012808">,</span>&nbsp;<span class="ident" id="4012810">err</span>&nbsp;<span class="op" id="4012814">:=</span>&nbsp;<span class="ident" id="4012817"><a href="/crypto/x509/root_unix.go.html#4011890">ioutil</a></span><span class="op" id="4012823">.</span><span class="ident" id="4012824">ReadFile</span><span class="op" id="4012832">(</span><span class="ident" id="4012833"><a href="/crypto/x509/root_unix.go.html#4012776">file</a></span><span class="op" id="4012837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012841">if</span>&nbsp;<span class="ident" id="4012844"><a href="/crypto/x509/root_unix.go.html#4012810">err</a></span>&nbsp;<span class="op" id="4012848">==</span>&nbsp;<span class="ident" id="4012851">nil</span>&nbsp;<span class="op" id="4012855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012860"><a href="/crypto/x509/root_unix.go.html#4012745">roots</a></span><span class="op" id="4012865">.</span><span class="ident" id="4012866">AppendCertsFromPEM</span><span class="op" id="4012884">(</span><span class="ident" id="4012885"><a href="/crypto/x509/root_unix.go.html#4012804">data</a></span><span class="op" id="4012889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012894"><a href="/crypto/x509/root.go.html#4011537">systemRoots</a></span>&nbsp;<span class="op" id="4012906">=</span>&nbsp;<span class="ident" id="4012908"><a href="/crypto/x509/root_unix.go.html#4012745">roots</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012933">for</span>&nbsp;<span class="ident" id="4012937">_</span><span class="op" id="4012938">,</span>&nbsp;<span class="ident" id="4012940">directory</span>&nbsp;<span class="op" id="4012950">:=</span>&nbsp;<span class="keyword" id="4012953">range</span>&nbsp;<span class="ident" id="4012959"><a href="/crypto/x509/root_unix.go.html#4012528">certDirectories</a></span>&nbsp;<span class="op" id="4012975">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012979">fis</span><span class="op" id="4012982">,</span>&nbsp;<span class="ident" id="4012984">err</span>&nbsp;<span class="op" id="4012988">:=</span>&nbsp;<span class="ident" id="4012991"><a href="/crypto/x509/root_unix.go.html#4011890">ioutil</a></span><span class="op" id="4012997">.</span><span class="ident" id="4012998">ReadDir</span><span class="op" id="4013005">(</span><span class="ident" id="4013006"><a href="/crypto/x509/root_unix.go.html#4012940">directory</a></span><span class="op" id="4013015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013019">if</span>&nbsp;<span class="ident" id="4013022"><a href="/crypto/x509/root_unix.go.html#4012984">err</a></span>&nbsp;<span class="op" id="4013026">!=</span>&nbsp;<span class="ident" id="4013029">nil</span>&nbsp;<span class="op" id="4013033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013038">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013053">rootsAdded</span>&nbsp;<span class="op" id="4013064">:=</span>&nbsp;<span class="builtintype" id="4013067">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013075">for</span>&nbsp;<span class="ident" id="4013079">_</span><span class="op" id="4013080">,</span>&nbsp;<span class="ident" id="4013082">fi</span>&nbsp;<span class="op" id="4013085">:=</span>&nbsp;<span class="keyword" id="4013088">range</span>&nbsp;<span class="ident" id="4013094"><a href="/crypto/x509/root_unix.go.html#4012979">fis</a></span>&nbsp;<span class="op" id="4013098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013103">data</span><span class="op" id="4013107">,</span>&nbsp;<span class="ident" id="4013109">err</span>&nbsp;<span class="op" id="4013113">:=</span>&nbsp;<span class="ident" id="4013116"><a href="/crypto/x509/root_unix.go.html#4011890">ioutil</a></span><span class="op" id="4013122">.</span><span class="ident" id="4013123">ReadFile</span><span class="op" id="4013131">(</span><span class="ident" id="4013132"><a href="/crypto/x509/root_unix.go.html#4012940">directory</a></span>&nbsp;<span class="op" id="4013142">+</span>&nbsp;<span class="string" id="4013144">&#34;/&#34;</span>&nbsp;<span class="op" id="4013148">+</span>&nbsp;<span class="ident" id="4013150"><a href="/crypto/x509/root_unix.go.html#4013082">fi</a></span><span class="op" id="4013152">.</span><span class="ident" id="4013153">Name</span><span class="op" id="4013157">(</span><span class="op" id="4013158">)</span><span class="op" id="4013159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013164">if</span>&nbsp;<span class="ident" id="4013167"><a href="/crypto/x509/root_unix.go.html#4013109">err</a></span>&nbsp;<span class="op" id="4013171">==</span>&nbsp;<span class="ident" id="4013174">nil</span>&nbsp;<span class="op" id="4013178">&amp;&amp;</span>&nbsp;<span class="ident" id="4013181"><a href="/crypto/x509/root_unix.go.html#4012745">roots</a></span><span class="op" id="4013186">.</span><span class="ident" id="4013187">AppendCertsFromPEM</span><span class="op" id="4013205">(</span><span class="ident" id="4013206"><a href="/crypto/x509/root_unix.go.html#4013103">data</a></span><span class="op" id="4013210">)</span>&nbsp;<span class="op" id="4013212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013218"><a href="/crypto/x509/root_unix.go.html#4013053">rootsAdded</a></span>&nbsp;<span class="op" id="4013229">=</span>&nbsp;<span class="builtintype" id="4013231">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013239">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013247">if</span>&nbsp;<span class="ident" id="4013250"><a href="/crypto/x509/root_unix.go.html#4013053">rootsAdded</a></span>&nbsp;<span class="op" id="4013261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013266"><a href="/crypto/x509/root.go.html#4011537">systemRoots</a></span>&nbsp;<span class="op" id="4013278">=</span>&nbsp;<span class="ident" id="4013280"><a href="/crypto/x509/root_unix.go.html#4012745">roots</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013289">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013298">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013305">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013377">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4013427">}</span>
</div>
</body>
</html>
