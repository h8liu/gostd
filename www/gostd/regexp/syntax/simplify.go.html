<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4531306">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4531362">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4531416">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4531467">package</span>&nbsp;<span class="ident" id="4531475">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531483">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="4531561">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="4531641">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="4531718">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="4531789">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4531863">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="4531930">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="4531998">func</span>&nbsp;<span class="op" id="4532003">(</span><span class="ident" id="4532004">re</span>&nbsp;<span class="op" id="4532007">*</span><span class="ident" id="4532008">Regexp</span><span class="op" id="4532014">)</span>&nbsp;<span class="ident" id="4532016">Simplify</span><span class="op" id="4532024">(</span><span class="op" id="4532025">)</span>&nbsp;<span class="op" id="4532027">*</span><span class="ident" id="4532028">Regexp</span>&nbsp;<span class="op" id="4532035">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532038">if</span>&nbsp;<span class="ident" id="4532041">re</span>&nbsp;<span class="op" id="4532044">==</span>&nbsp;<span class="ident" id="4532047">nil</span>&nbsp;<span class="op" id="4532051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532055">return</span>&nbsp;<span class="ident" id="4532062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532070">switch</span>&nbsp;<span class="ident" id="4532077">re</span><span class="op" id="4532079">.</span><span class="ident" id="4532080">Op</span>&nbsp;<span class="op" id="4532083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532086">case</span>&nbsp;<span class="ident" id="4532091">OpCapture</span><span class="op" id="4532100">,</span>&nbsp;<span class="ident" id="4532102">OpConcat</span><span class="op" id="4532110">,</span>&nbsp;<span class="ident" id="4532112">OpAlternate</span><span class="op" id="4532123">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532127">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532191">nre</span>&nbsp;<span class="op" id="4532195">:=</span>&nbsp;<span class="ident" id="4532198">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532203">for</span>&nbsp;<span class="ident" id="4532207">i</span><span class="op" id="4532208">,</span>&nbsp;<span class="ident" id="4532210">sub</span>&nbsp;<span class="op" id="4532214">:=</span>&nbsp;<span class="keyword" id="4532217">range</span>&nbsp;<span class="ident" id="4532223">re</span><span class="op" id="4532225">.</span><span class="ident" id="4532226">Sub</span>&nbsp;<span class="op" id="4532230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532235">nsub</span>&nbsp;<span class="op" id="4532240">:=</span>&nbsp;<span class="ident" id="4532243">sub</span><span class="op" id="4532246">.</span><span class="ident" id="4532247">Simplify</span><span class="op" id="4532255">(</span><span class="op" id="4532256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532261">if</span>&nbsp;<span class="ident" id="4532264">nre</span>&nbsp;<span class="op" id="4532268">==</span>&nbsp;<span class="ident" id="4532271">re</span>&nbsp;<span class="op" id="4532274">&amp;&amp;</span>&nbsp;<span class="ident" id="4532277">nsub</span>&nbsp;<span class="op" id="4532282">!=</span>&nbsp;<span class="ident" id="4532285">sub</span>&nbsp;<span class="op" id="4532289">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532295">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532316">nre</span>&nbsp;<span class="op" id="4532320">=</span>&nbsp;<span class="builtinfunc" id="4532322">new</span><span class="op" id="4532325">(</span><span class="ident" id="4532326">Regexp</span><span class="op" id="4532332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532338">*</span><span class="ident" id="4532339">nre</span>&nbsp;<span class="op" id="4532343">=</span>&nbsp;<span class="op" id="4532345">*</span><span class="ident" id="4532346">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532353">nre</span><span class="op" id="4532356">.</span><span class="ident" id="4532357">Rune</span>&nbsp;<span class="op" id="4532362">=</span>&nbsp;<span class="ident" id="4532364">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532372">nre</span><span class="op" id="4532375">.</span><span class="ident" id="4532376">Sub</span>&nbsp;<span class="op" id="4532380">=</span>&nbsp;<span class="builtinfunc" id="4532382">append</span><span class="op" id="4532388">(</span><span class="ident" id="4532389">nre</span><span class="op" id="4532392">.</span><span class="ident" id="4532393">Sub0</span><span class="op" id="4532397">[</span><span class="op" id="4532398">:</span><span class="num" id="4532399">0</span><span class="op" id="4532400">]</span><span class="op" id="4532401">,</span>&nbsp;<span class="ident" id="4532403">re</span><span class="op" id="4532405">.</span><span class="ident" id="4532406">Sub</span><span class="op" id="4532409">[</span><span class="op" id="4532410">:</span><span class="ident" id="4532411">i</span><span class="op" id="4532412">]</span><span class="op" id="4532413">...</span><span class="op" id="4532416">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532426">if</span>&nbsp;<span class="ident" id="4532429">nre</span>&nbsp;<span class="op" id="4532433">!=</span>&nbsp;<span class="ident" id="4532436">re</span>&nbsp;<span class="op" id="4532439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532445">nre</span><span class="op" id="4532448">.</span><span class="ident" id="4532449">Sub</span>&nbsp;<span class="op" id="4532453">=</span>&nbsp;<span class="builtinfunc" id="4532455">append</span><span class="op" id="4532461">(</span><span class="ident" id="4532462">nre</span><span class="op" id="4532465">.</span><span class="ident" id="4532466">Sub</span><span class="op" id="4532469">,</span>&nbsp;<span class="ident" id="4532471">nsub</span><span class="op" id="4532475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532484">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532488">return</span>&nbsp;<span class="ident" id="4532495">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532501">case</span>&nbsp;<span class="ident" id="4532506">OpStar</span><span class="op" id="4532512">,</span>&nbsp;<span class="ident" id="4532514">OpPlus</span><span class="op" id="4532520">,</span>&nbsp;<span class="ident" id="4532522">OpQuest</span><span class="op" id="4532529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532533">sub</span>&nbsp;<span class="op" id="4532537">:=</span>&nbsp;<span class="ident" id="4532540">re</span><span class="op" id="4532542">.</span><span class="ident" id="4532543">Sub</span><span class="op" id="4532546">[</span><span class="num" id="4532547">0</span><span class="op" id="4532548">]</span><span class="op" id="4532549">.</span><span class="ident" id="4532550">Simplify</span><span class="op" id="4532558">(</span><span class="op" id="4532559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532563">return</span>&nbsp;<span class="ident" id="4532570">simplify1</span><span class="op" id="4532579">(</span><span class="ident" id="4532580">re</span><span class="op" id="4532582">.</span><span class="ident" id="4532583">Op</span><span class="op" id="4532585">,</span>&nbsp;<span class="ident" id="4532587">re</span><span class="op" id="4532589">.</span><span class="ident" id="4532590">Flags</span><span class="op" id="4532595">,</span>&nbsp;<span class="ident" id="4532597">sub</span><span class="op" id="4532600">,</span>&nbsp;<span class="ident" id="4532602">re</span><span class="op" id="4532604">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532608">case</span>&nbsp;<span class="ident" id="4532613">OpRepeat</span><span class="op" id="4532621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532625">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532682">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532724">if</span>&nbsp;<span class="ident" id="4532727">re</span><span class="op" id="4532729">.</span><span class="ident" id="4532730">Min</span>&nbsp;<span class="op" id="4532734">==</span>&nbsp;<span class="num" id="4532737">0</span>&nbsp;<span class="op" id="4532739">&amp;&amp;</span>&nbsp;<span class="ident" id="4532742">re</span><span class="op" id="4532744">.</span><span class="ident" id="4532745">Max</span>&nbsp;<span class="op" id="4532749">==</span>&nbsp;<span class="num" id="4532752">0</span>&nbsp;<span class="op" id="4532754">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532759">return</span>&nbsp;<span class="op" id="4532766">&amp;</span><span class="ident" id="4532767">Regexp</span><span class="op" id="4532773">{</span><span class="ident" id="4532774">Op</span><span class="op" id="4532776">:</span>&nbsp;<span class="ident" id="4532778">OpEmptyMatch</span><span class="op" id="4532790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532799">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532820">sub</span>&nbsp;<span class="op" id="4532824">:=</span>&nbsp;<span class="ident" id="4532827">re</span><span class="op" id="4532829">.</span><span class="ident" id="4532830">Sub</span><span class="op" id="4532833">[</span><span class="num" id="4532834">0</span><span class="op" id="4532835">]</span><span class="op" id="4532836">.</span><span class="ident" id="4532837">Simplify</span><span class="op" id="4532845">(</span><span class="op" id="4532846">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532851">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532893">if</span>&nbsp;<span class="ident" id="4532896">re</span><span class="op" id="4532898">.</span><span class="ident" id="4532899">Max</span>&nbsp;<span class="op" id="4532903">==</span>&nbsp;<span class="op" id="4532906">-</span><span class="num" id="4532907">1</span>&nbsp;<span class="op" id="4532909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532914">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532947">if</span>&nbsp;<span class="ident" id="4532950">re</span><span class="op" id="4532952">.</span><span class="ident" id="4532953">Min</span>&nbsp;<span class="op" id="4532957">==</span>&nbsp;<span class="num" id="4532960">0</span>&nbsp;<span class="op" id="4532962">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532968">return</span>&nbsp;<span class="ident" id="4532975">simplify1</span><span class="op" id="4532984">(</span><span class="ident" id="4532985">OpStar</span><span class="op" id="4532991">,</span>&nbsp;<span class="ident" id="4532993">re</span><span class="op" id="4532995">.</span><span class="ident" id="4532996">Flags</span><span class="op" id="4533001">,</span>&nbsp;<span class="ident" id="4533003">sub</span><span class="op" id="4533006">,</span>&nbsp;<span class="ident" id="4533008">nil</span><span class="op" id="4533011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533022">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533055">if</span>&nbsp;<span class="ident" id="4533058">re</span><span class="op" id="4533060">.</span><span class="ident" id="4533061">Min</span>&nbsp;<span class="op" id="4533065">==</span>&nbsp;<span class="num" id="4533068">1</span>&nbsp;<span class="op" id="4533070">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533076">return</span>&nbsp;<span class="ident" id="4533083">simplify1</span><span class="op" id="4533092">(</span><span class="ident" id="4533093">OpPlus</span><span class="op" id="4533099">,</span>&nbsp;<span class="ident" id="4533101">re</span><span class="op" id="4533103">.</span><span class="ident" id="4533104">Flags</span><span class="op" id="4533109">,</span>&nbsp;<span class="ident" id="4533111">sub</span><span class="op" id="4533114">,</span>&nbsp;<span class="ident" id="4533116">nil</span><span class="op" id="4533119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533130">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533166">nre</span>&nbsp;<span class="op" id="4533170">:=</span>&nbsp;<span class="op" id="4533173">&amp;</span><span class="ident" id="4533174">Regexp</span><span class="op" id="4533180">{</span><span class="ident" id="4533181">Op</span><span class="op" id="4533183">:</span>&nbsp;<span class="ident" id="4533185">OpConcat</span><span class="op" id="4533193">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533198">nre</span><span class="op" id="4533201">.</span><span class="ident" id="4533202">Sub</span>&nbsp;<span class="op" id="4533206">=</span>&nbsp;<span class="ident" id="4533208">nre</span><span class="op" id="4533211">.</span><span class="ident" id="4533212">Sub0</span><span class="op" id="4533216">[</span><span class="op" id="4533217">:</span><span class="num" id="4533218">0</span><span class="op" id="4533219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533224">for</span>&nbsp;<span class="ident" id="4533228">i</span>&nbsp;<span class="op" id="4533230">:=</span>&nbsp;<span class="num" id="4533233">0</span><span class="op" id="4533234">;</span>&nbsp;<span class="ident" id="4533236">i</span>&nbsp;<span class="op" id="4533238">&lt;</span>&nbsp;<span class="ident" id="4533240">re</span><span class="op" id="4533242">.</span><span class="ident" id="4533243">Min</span><span class="op" id="4533246">-</span><span class="num" id="4533247">1</span><span class="op" id="4533248">;</span>&nbsp;<span class="ident" id="4533250">i</span><span class="op" id="4533251">++</span>&nbsp;<span class="op" id="4533254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533260">nre</span><span class="op" id="4533263">.</span><span class="ident" id="4533264">Sub</span>&nbsp;<span class="op" id="4533268">=</span>&nbsp;<span class="builtinfunc" id="4533270">append</span><span class="op" id="4533276">(</span><span class="ident" id="4533277">nre</span><span class="op" id="4533280">.</span><span class="ident" id="4533281">Sub</span><span class="op" id="4533284">,</span>&nbsp;<span class="ident" id="4533286">sub</span><span class="op" id="4533289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533299">nre</span><span class="op" id="4533302">.</span><span class="ident" id="4533303">Sub</span>&nbsp;<span class="op" id="4533307">=</span>&nbsp;<span class="builtinfunc" id="4533309">append</span><span class="op" id="4533315">(</span><span class="ident" id="4533316">nre</span><span class="op" id="4533319">.</span><span class="ident" id="4533320">Sub</span><span class="op" id="4533323">,</span>&nbsp;<span class="ident" id="4533325">simplify1</span><span class="op" id="4533334">(</span><span class="ident" id="4533335">OpPlus</span><span class="op" id="4533341">,</span>&nbsp;<span class="ident" id="4533343">re</span><span class="op" id="4533345">.</span><span class="ident" id="4533346">Flags</span><span class="op" id="4533351">,</span>&nbsp;<span class="ident" id="4533353">sub</span><span class="op" id="4533356">,</span>&nbsp;<span class="ident" id="4533358">nil</span><span class="op" id="4533361">)</span><span class="op" id="4533362">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533367">return</span>&nbsp;<span class="ident" id="4533374">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533385">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533424">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533459">if</span>&nbsp;<span class="ident" id="4533462">re</span><span class="op" id="4533464">.</span><span class="ident" id="4533465">Min</span>&nbsp;<span class="op" id="4533469">==</span>&nbsp;<span class="num" id="4533472">1</span>&nbsp;<span class="op" id="4533474">&amp;&amp;</span>&nbsp;<span class="ident" id="4533477">re</span><span class="op" id="4533479">.</span><span class="ident" id="4533480">Max</span>&nbsp;<span class="op" id="4533484">==</span>&nbsp;<span class="num" id="4533487">1</span>&nbsp;<span class="op" id="4533489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533494">return</span>&nbsp;<span class="ident" id="4533501">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533512">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533577">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533643">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533681">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533712">var</span>&nbsp;<span class="ident" id="4533716">prefix</span>&nbsp;<span class="op" id="4533723">*</span><span class="ident" id="4533724">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533733">if</span>&nbsp;<span class="ident" id="4533736">re</span><span class="op" id="4533738">.</span><span class="ident" id="4533739">Min</span>&nbsp;<span class="op" id="4533743">&gt;</span>&nbsp;<span class="num" id="4533745">0</span>&nbsp;<span class="op" id="4533747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533752">prefix</span>&nbsp;<span class="op" id="4533759">=</span>&nbsp;<span class="op" id="4533761">&amp;</span><span class="ident" id="4533762">Regexp</span><span class="op" id="4533768">{</span><span class="ident" id="4533769">Op</span><span class="op" id="4533771">:</span>&nbsp;<span class="ident" id="4533773">OpConcat</span><span class="op" id="4533781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533786">prefix</span><span class="op" id="4533792">.</span><span class="ident" id="4533793">Sub</span>&nbsp;<span class="op" id="4533797">=</span>&nbsp;<span class="ident" id="4533799">prefix</span><span class="op" id="4533805">.</span><span class="ident" id="4533806">Sub0</span><span class="op" id="4533810">[</span><span class="op" id="4533811">:</span><span class="num" id="4533812">0</span><span class="op" id="4533813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533818">for</span>&nbsp;<span class="ident" id="4533822">i</span>&nbsp;<span class="op" id="4533824">:=</span>&nbsp;<span class="num" id="4533827">0</span><span class="op" id="4533828">;</span>&nbsp;<span class="ident" id="4533830">i</span>&nbsp;<span class="op" id="4533832">&lt;</span>&nbsp;<span class="ident" id="4533834">re</span><span class="op" id="4533836">.</span><span class="ident" id="4533837">Min</span><span class="op" id="4533840">;</span>&nbsp;<span class="ident" id="4533842">i</span><span class="op" id="4533843">++</span>&nbsp;<span class="op" id="4533846">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533852">prefix</span><span class="op" id="4533858">.</span><span class="ident" id="4533859">Sub</span>&nbsp;<span class="op" id="4533863">=</span>&nbsp;<span class="builtinfunc" id="4533865">append</span><span class="op" id="4533871">(</span><span class="ident" id="4533872">prefix</span><span class="op" id="4533878">.</span><span class="ident" id="4533879">Sub</span><span class="op" id="4533882">,</span>&nbsp;<span class="ident" id="4533884">sub</span><span class="op" id="4533887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533901">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533944">if</span>&nbsp;<span class="ident" id="4533947">re</span><span class="op" id="4533949">.</span><span class="ident" id="4533950">Max</span>&nbsp;<span class="op" id="4533954">&gt;</span>&nbsp;<span class="ident" id="4533956">re</span><span class="op" id="4533958">.</span><span class="ident" id="4533959">Min</span>&nbsp;<span class="op" id="4533963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533968">suffix</span>&nbsp;<span class="op" id="4533975">:=</span>&nbsp;<span class="ident" id="4533978">simplify1</span><span class="op" id="4533987">(</span><span class="ident" id="4533988">OpQuest</span><span class="op" id="4533995">,</span>&nbsp;<span class="ident" id="4533997">re</span><span class="op" id="4533999">.</span><span class="ident" id="4534000">Flags</span><span class="op" id="4534005">,</span>&nbsp;<span class="ident" id="4534007">sub</span><span class="op" id="4534010">,</span>&nbsp;<span class="ident" id="4534012">nil</span><span class="op" id="4534015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534020">for</span>&nbsp;<span class="ident" id="4534024">i</span>&nbsp;<span class="op" id="4534026">:=</span>&nbsp;<span class="ident" id="4534029">re</span><span class="op" id="4534031">.</span><span class="ident" id="4534032">Min</span>&nbsp;<span class="op" id="4534036">+</span>&nbsp;<span class="num" id="4534038">1</span><span class="op" id="4534039">;</span>&nbsp;<span class="ident" id="4534041">i</span>&nbsp;<span class="op" id="4534043">&lt;</span>&nbsp;<span class="ident" id="4534045">re</span><span class="op" id="4534047">.</span><span class="ident" id="4534048">Max</span><span class="op" id="4534051">;</span>&nbsp;<span class="ident" id="4534053">i</span><span class="op" id="4534054">++</span>&nbsp;<span class="op" id="4534057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534063">nre2</span>&nbsp;<span class="op" id="4534068">:=</span>&nbsp;<span class="op" id="4534071">&amp;</span><span class="ident" id="4534072">Regexp</span><span class="op" id="4534078">{</span><span class="ident" id="4534079">Op</span><span class="op" id="4534081">:</span>&nbsp;<span class="ident" id="4534083">OpConcat</span><span class="op" id="4534091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534097">nre2</span><span class="op" id="4534101">.</span><span class="ident" id="4534102">Sub</span>&nbsp;<span class="op" id="4534106">=</span>&nbsp;<span class="builtinfunc" id="4534108">append</span><span class="op" id="4534114">(</span><span class="ident" id="4534115">nre2</span><span class="op" id="4534119">.</span><span class="ident" id="4534120">Sub0</span><span class="op" id="4534124">[</span><span class="op" id="4534125">:</span><span class="num" id="4534126">0</span><span class="op" id="4534127">]</span><span class="op" id="4534128">,</span>&nbsp;<span class="ident" id="4534130">sub</span><span class="op" id="4534133">,</span>&nbsp;<span class="ident" id="4534135">suffix</span><span class="op" id="4534141">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534147">suffix</span>&nbsp;<span class="op" id="4534154">=</span>&nbsp;<span class="ident" id="4534156">simplify1</span><span class="op" id="4534165">(</span><span class="ident" id="4534166">OpQuest</span><span class="op" id="4534173">,</span>&nbsp;<span class="ident" id="4534175">re</span><span class="op" id="4534177">.</span><span class="ident" id="4534178">Flags</span><span class="op" id="4534183">,</span>&nbsp;<span class="ident" id="4534185">nre2</span><span class="op" id="4534189">,</span>&nbsp;<span class="ident" id="4534191">nil</span><span class="op" id="4534194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534204">if</span>&nbsp;<span class="ident" id="4534207">prefix</span>&nbsp;<span class="op" id="4534214">==</span>&nbsp;<span class="ident" id="4534217">nil</span>&nbsp;<span class="op" id="4534221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534227">return</span>&nbsp;<span class="ident" id="4534234">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534244">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534249">prefix</span><span class="op" id="4534255">.</span><span class="ident" id="4534256">Sub</span>&nbsp;<span class="op" id="4534260">=</span>&nbsp;<span class="builtinfunc" id="4534262">append</span><span class="op" id="4534268">(</span><span class="ident" id="4534269">prefix</span><span class="op" id="4534275">.</span><span class="ident" id="4534276">Sub</span><span class="op" id="4534279">,</span>&nbsp;<span class="ident" id="4534281">suffix</span><span class="op" id="4534287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534295">if</span>&nbsp;<span class="ident" id="4534298">prefix</span>&nbsp;<span class="op" id="4534305">!=</span>&nbsp;<span class="ident" id="4534308">nil</span>&nbsp;<span class="op" id="4534312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534317">return</span>&nbsp;<span class="ident" id="4534324">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534333">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4534338">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4534397">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534430">return</span>&nbsp;<span class="op" id="4534437">&amp;</span><span class="ident" id="4534438">Regexp</span><span class="op" id="4534444">{</span><span class="ident" id="4534445">Op</span><span class="op" id="4534447">:</span>&nbsp;<span class="ident" id="4534449">OpNoMatch</span><span class="op" id="4534458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534461">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534465">return</span>&nbsp;<span class="ident" id="4534472">re</span><br>
<span class="lineno"></span><span class="op" id="4534475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4534478">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="4534533">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4534597">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4534614">//</span><br>
<span class="lineno"></span><span class="comment" id="4534617">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="4534661">//</span><br>
<span class="lineno">125</span><span class="comment" id="4534664">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4534720">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4534779">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="4534841">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4534864">//</span><br>
<span class="lineno">130</span><span class="comment" id="4534867">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="4534935">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="4534993">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4535056">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="4535080">func</span>&nbsp;<span class="ident" id="4535085">simplify1</span><span class="op" id="4535094">(</span><span class="ident" id="4535095">op</span>&nbsp;<span class="ident" id="4535098">Op</span><span class="op" id="4535100">,</span>&nbsp;<span class="ident" id="4535102">flags</span>&nbsp;<span class="ident" id="4535108">Flags</span><span class="op" id="4535113">,</span>&nbsp;<span class="ident" id="4535115">sub</span><span class="op" id="4535118">,</span>&nbsp;<span class="ident" id="4535120">re</span>&nbsp;<span class="op" id="4535123">*</span><span class="ident" id="4535124">Regexp</span><span class="op" id="4535130">)</span>&nbsp;<span class="op" id="4535132">*</span><span class="ident" id="4535133">Regexp</span>&nbsp;<span class="op" id="4535140">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4535143">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4535196">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535243">if</span>&nbsp;<span class="ident" id="4535246">sub</span><span class="op" id="4535249">.</span><span class="ident" id="4535250">Op</span>&nbsp;<span class="op" id="4535253">==</span>&nbsp;<span class="ident" id="4535256">OpEmptyMatch</span>&nbsp;<span class="op" id="4535269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535273">return</span>&nbsp;<span class="ident" id="4535280">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535285">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4535288">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535341">if</span>&nbsp;<span class="ident" id="4535344">op</span>&nbsp;<span class="op" id="4535347">==</span>&nbsp;<span class="ident" id="4535350">sub</span><span class="op" id="4535353">.</span><span class="ident" id="4535354">Op</span>&nbsp;<span class="op" id="4535357">&amp;&amp;</span>&nbsp;<span class="ident" id="4535360">flags</span><span class="op" id="4535365">&amp;</span><span class="ident" id="4535366">NonGreedy</span>&nbsp;<span class="op" id="4535376">==</span>&nbsp;<span class="ident" id="4535379">sub</span><span class="op" id="4535382">.</span><span class="ident" id="4535383">Flags</span><span class="op" id="4535388">&amp;</span><span class="ident" id="4535389">NonGreedy</span>&nbsp;<span class="op" id="4535399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535403">return</span>&nbsp;<span class="ident" id="4535410">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535418">if</span>&nbsp;<span class="ident" id="4535421">re</span>&nbsp;<span class="op" id="4535424">!=</span>&nbsp;<span class="ident" id="4535427">nil</span>&nbsp;<span class="op" id="4535431">&amp;&amp;</span>&nbsp;<span class="ident" id="4535434">re</span><span class="op" id="4535436">.</span><span class="ident" id="4535437">Op</span>&nbsp;<span class="op" id="4535440">==</span>&nbsp;<span class="ident" id="4535443">op</span>&nbsp;<span class="op" id="4535446">&amp;&amp;</span>&nbsp;<span class="ident" id="4535449">re</span><span class="op" id="4535451">.</span><span class="ident" id="4535452">Flags</span><span class="op" id="4535457">&amp;</span><span class="ident" id="4535458">NonGreedy</span>&nbsp;<span class="op" id="4535468">==</span>&nbsp;<span class="ident" id="4535471">flags</span><span class="op" id="4535476">&amp;</span><span class="ident" id="4535477">NonGreedy</span>&nbsp;<span class="op" id="4535487">&amp;&amp;</span>&nbsp;<span class="ident" id="4535490">sub</span>&nbsp;<span class="op" id="4535494">==</span>&nbsp;<span class="ident" id="4535497">re</span><span class="op" id="4535499">.</span><span class="ident" id="4535500">Sub</span><span class="op" id="4535503">[</span><span class="num" id="4535504">0</span><span class="op" id="4535505">]</span>&nbsp;<span class="op" id="4535507">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535511">return</span>&nbsp;<span class="ident" id="4535518">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535526">re</span>&nbsp;<span class="op" id="4535529">=</span>&nbsp;<span class="op" id="4535531">&amp;</span><span class="ident" id="4535532">Regexp</span><span class="op" id="4535538">{</span><span class="ident" id="4535539">Op</span><span class="op" id="4535541">:</span>&nbsp;<span class="ident" id="4535543">op</span><span class="op" id="4535545">,</span>&nbsp;<span class="ident" id="4535547">Flags</span><span class="op" id="4535552">:</span>&nbsp;<span class="ident" id="4535554">flags</span><span class="op" id="4535559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535562">re</span><span class="op" id="4535564">.</span><span class="ident" id="4535565">Sub</span>&nbsp;<span class="op" id="4535569">=</span>&nbsp;<span class="builtinfunc" id="4535571">append</span><span class="op" id="4535577">(</span><span class="ident" id="4535578">re</span><span class="op" id="4535580">.</span><span class="ident" id="4535581">Sub0</span><span class="op" id="4535585">[</span><span class="op" id="4535586">:</span><span class="num" id="4535587">0</span><span class="op" id="4535588">]</span><span class="op" id="4535589">,</span>&nbsp;<span class="ident" id="4535591">sub</span><span class="op" id="4535594">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535597">return</span>&nbsp;<span class="ident" id="4535604">re</span><br>
<span class="lineno"></span><span class="op" id="4535607">}</span>
</div>
</body>
</html>
