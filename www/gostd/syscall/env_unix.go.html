<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2361455">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2361511">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2361565">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2361616">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2361686">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2361718">package</span>&nbsp;<span class="ident" id="2361726">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2361735">import</span>&nbsp;<span class="string" id="2361742">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2361750">var</span>&nbsp;<span class="op" id="2361754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2361757">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361824">envOnce</span>&nbsp;<span class="ident" id="2361832">sync</span><span class="op" id="2361836">.</span><span class="ident" id="2361837">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2361844">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361877">envLock</span>&nbsp;<span class="ident" id="2361885">sync</span><span class="op" id="2361889">.</span><span class="ident" id="2361890">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2361900">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361975">env</span>&nbsp;<span class="keyword" id="2361979">map</span><span class="op" id="2361982">[</span><span class="builtintype" id="2361983">string</span><span class="op" id="2361989">]</span><span class="builtintype" id="2361990">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2361996">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362058">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362120">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362156">envs</span>&nbsp;<span class="op" id="2362161">[</span><span class="op" id="2362162">]</span><span class="builtintype" id="2362163">string</span>&nbsp;<span class="op" id="2362170">=</span>&nbsp;<span class="ident" id="2362172">runtime_envs</span><span class="op" id="2362184">(</span><span class="op" id="2362185">)</span><br>
<span class="lineno"></span><span class="op" id="2362187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2362190">func</span>&nbsp;<span class="ident" id="2362195">runtime_envs</span><span class="op" id="2362207">(</span><span class="op" id="2362208">)</span>&nbsp;<span class="op" id="2362210">[</span><span class="op" id="2362211">]</span><span class="builtintype" id="2362212">string</span>&nbsp;<span class="comment" id="2362219">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2362242">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2362312">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2362336">func</span>&nbsp;<span class="ident" id="2362341">setenv_c</span><span class="op" id="2362349">(</span><span class="ident" id="2362350">k</span><span class="op" id="2362351">,</span>&nbsp;<span class="ident" id="2362353">v</span>&nbsp;<span class="builtintype" id="2362355">string</span><span class="op" id="2362361">)</span><br>
<span class="lineno"></span><span class="keyword" id="2362363">func</span>&nbsp;<span class="ident" id="2362368">unsetenv_c</span><span class="op" id="2362378">(</span><span class="ident" id="2362379">k</span>&nbsp;<span class="builtintype" id="2362381">string</span><span class="op" id="2362387">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2362390">func</span>&nbsp;<span class="ident" id="2362395">copyenv</span><span class="op" id="2362402">(</span><span class="op" id="2362403">)</span>&nbsp;<span class="op" id="2362405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362408">env</span>&nbsp;<span class="op" id="2362412">=</span>&nbsp;<span class="builtinfunc" id="2362414">make</span><span class="op" id="2362418">(</span><span class="keyword" id="2362419">map</span><span class="op" id="2362422">[</span><span class="builtintype" id="2362423">string</span><span class="op" id="2362429">]</span><span class="builtintype" id="2362430">int</span><span class="op" id="2362433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362436">for</span>&nbsp;<span class="ident" id="2362440">i</span><span class="op" id="2362441">,</span>&nbsp;<span class="ident" id="2362443">s</span>&nbsp;<span class="op" id="2362445">:=</span>&nbsp;<span class="keyword" id="2362448">range</span>&nbsp;<span class="ident" id="2362454">envs</span>&nbsp;<span class="op" id="2362459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362463">for</span>&nbsp;<span class="ident" id="2362467">j</span>&nbsp;<span class="op" id="2362469">:=</span>&nbsp;<span class="num" id="2362472">0</span><span class="op" id="2362473">;</span>&nbsp;<span class="ident" id="2362475">j</span>&nbsp;<span class="op" id="2362477">&lt;</span>&nbsp;<span class="builtinfunc" id="2362479">len</span><span class="op" id="2362482">(</span><span class="ident" id="2362483">s</span><span class="op" id="2362484">)</span><span class="op" id="2362485">;</span>&nbsp;<span class="ident" id="2362487">j</span><span class="op" id="2362488">++</span>&nbsp;<span class="op" id="2362491">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362496">if</span>&nbsp;<span class="ident" id="2362499">s</span><span class="op" id="2362500">[</span><span class="ident" id="2362501">j</span><span class="op" id="2362502">]</span>&nbsp;<span class="op" id="2362504">==</span>&nbsp;<span class="string" id="2362507">&#39;=&#39;</span>&nbsp;<span class="op" id="2362511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362517">key</span>&nbsp;<span class="op" id="2362521">:=</span>&nbsp;<span class="ident" id="2362524">s</span><span class="op" id="2362525">[</span><span class="op" id="2362526">:</span><span class="ident" id="2362527">j</span><span class="op" id="2362528">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362534">if</span>&nbsp;<span class="ident" id="2362537">_</span><span class="op" id="2362538">,</span>&nbsp;<span class="ident" id="2362540">ok</span>&nbsp;<span class="op" id="2362543">:=</span>&nbsp;<span class="ident" id="2362546">env</span><span class="op" id="2362549">[</span><span class="ident" id="2362550">key</span><span class="op" id="2362553">]</span><span class="op" id="2362554">;</span>&nbsp;<span class="op" id="2362556">!</span><span class="ident" id="2362557">ok</span>&nbsp;<span class="op" id="2362560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362567">env</span><span class="op" id="2362570">[</span><span class="ident" id="2362571">key</span><span class="op" id="2362574">]</span>&nbsp;<span class="op" id="2362576">=</span>&nbsp;<span class="ident" id="2362578">i</span>&nbsp;<span class="comment" id="2362580">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362608">}</span>&nbsp;<span class="keyword" id="2362610">else</span>&nbsp;<span class="op" id="2362615">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362622">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362677">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362727">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2362775">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362818">envs</span><span class="op" id="2362822">[</span><span class="ident" id="2362823">i</span><span class="op" id="2362824">]</span>&nbsp;<span class="op" id="2362826">=</span>&nbsp;<span class="string" id="2362828">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362841">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362857">}</span><br>
<span class="lineno">55</span><span class="op" id="2362859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2362862">func</span>&nbsp;<span class="ident" id="2362867">Unsetenv</span><span class="op" id="2362875">(</span><span class="ident" id="2362876">key</span>&nbsp;<span class="builtintype" id="2362880">string</span><span class="op" id="2362886">)</span>&nbsp;<span class="builtintype" id="2362888">error</span>&nbsp;<span class="op" id="2362894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362897">envOnce</span><span class="op" id="2362904">.</span><span class="ident" id="2362905">Do</span><span class="op" id="2362907">(</span><span class="ident" id="2362908">copyenv</span><span class="op" id="2362915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362919">envLock</span><span class="op" id="2362926">.</span><span class="ident" id="2362927">Lock</span><span class="op" id="2362931">(</span><span class="op" id="2362932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362935">defer</span>&nbsp;<span class="ident" id="2362941">envLock</span><span class="op" id="2362948">.</span><span class="ident" id="2362949">Unlock</span><span class="op" id="2362955">(</span><span class="op" id="2362956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362960">if</span>&nbsp;<span class="ident" id="2362963">i</span><span class="op" id="2362964">,</span>&nbsp;<span class="ident" id="2362966">ok</span>&nbsp;<span class="op" id="2362969">:=</span>&nbsp;<span class="ident" id="2362972">env</span><span class="op" id="2362975">[</span><span class="ident" id="2362976">key</span><span class="op" id="2362979">]</span><span class="op" id="2362980">;</span>&nbsp;<span class="ident" id="2362982">ok</span>&nbsp;<span class="op" id="2362985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362989">envs</span><span class="op" id="2362993">[</span><span class="ident" id="2362994">i</span><span class="op" id="2362995">]</span>&nbsp;<span class="op" id="2362997">=</span>&nbsp;<span class="string" id="2362999">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2363004">delete</span><span class="op" id="2363010">(</span><span class="ident" id="2363011">env</span><span class="op" id="2363014">,</span>&nbsp;<span class="ident" id="2363016">key</span><span class="op" id="2363019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363025">unsetenv_c</span><span class="op" id="2363035">(</span><span class="ident" id="2363036">key</span><span class="op" id="2363039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363042">return</span>&nbsp;<span class="ident" id="2363049">nil</span><br>
<span class="lineno"></span><span class="op" id="2363053">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2363056">func</span>&nbsp;<span class="ident" id="2363061">Getenv</span><span class="op" id="2363067">(</span><span class="ident" id="2363068">key</span>&nbsp;<span class="builtintype" id="2363072">string</span><span class="op" id="2363078">)</span>&nbsp;<span class="op" id="2363080">(</span><span class="ident" id="2363081">value</span>&nbsp;<span class="builtintype" id="2363087">string</span><span class="op" id="2363093">,</span>&nbsp;<span class="ident" id="2363095">found</span>&nbsp;<span class="builtintype" id="2363101">bool</span><span class="op" id="2363105">)</span>&nbsp;<span class="op" id="2363107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363110">envOnce</span><span class="op" id="2363117">.</span><span class="ident" id="2363118">Do</span><span class="op" id="2363120">(</span><span class="ident" id="2363121">copyenv</span><span class="op" id="2363128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363131">if</span>&nbsp;<span class="builtinfunc" id="2363134">len</span><span class="op" id="2363137">(</span><span class="ident" id="2363138">key</span><span class="op" id="2363141">)</span>&nbsp;<span class="op" id="2363143">==</span>&nbsp;<span class="num" id="2363146">0</span>&nbsp;<span class="op" id="2363148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363152">return</span>&nbsp;<span class="string" id="2363159">&#34;&#34;</span><span class="op" id="2363161">,</span>&nbsp;<span class="builtintype" id="2363163">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363174">envLock</span><span class="op" id="2363181">.</span><span class="ident" id="2363182">RLock</span><span class="op" id="2363187">(</span><span class="op" id="2363188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363191">defer</span>&nbsp;<span class="ident" id="2363197">envLock</span><span class="op" id="2363204">.</span><span class="ident" id="2363205">RUnlock</span><span class="op" id="2363212">(</span><span class="op" id="2363213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363217">i</span><span class="op" id="2363218">,</span>&nbsp;<span class="ident" id="2363220">ok</span>&nbsp;<span class="op" id="2363223">:=</span>&nbsp;<span class="ident" id="2363226">env</span><span class="op" id="2363229">[</span><span class="ident" id="2363230">key</span><span class="op" id="2363233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363236">if</span>&nbsp;<span class="op" id="2363239">!</span><span class="ident" id="2363240">ok</span>&nbsp;<span class="op" id="2363243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363247">return</span>&nbsp;<span class="string" id="2363254">&#34;&#34;</span><span class="op" id="2363256">,</span>&nbsp;<span class="builtintype" id="2363258">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363268">s</span>&nbsp;<span class="op" id="2363270">:=</span>&nbsp;<span class="ident" id="2363273">envs</span><span class="op" id="2363277">[</span><span class="ident" id="2363278">i</span><span class="op" id="2363279">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363282">for</span>&nbsp;<span class="ident" id="2363286">i</span>&nbsp;<span class="op" id="2363288">:=</span>&nbsp;<span class="num" id="2363291">0</span><span class="op" id="2363292">;</span>&nbsp;<span class="ident" id="2363294">i</span>&nbsp;<span class="op" id="2363296">&lt;</span>&nbsp;<span class="builtinfunc" id="2363298">len</span><span class="op" id="2363301">(</span><span class="ident" id="2363302">s</span><span class="op" id="2363303">)</span><span class="op" id="2363304">;</span>&nbsp;<span class="ident" id="2363306">i</span><span class="op" id="2363307">++</span>&nbsp;<span class="op" id="2363310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363314">if</span>&nbsp;<span class="ident" id="2363317">s</span><span class="op" id="2363318">[</span><span class="ident" id="2363319">i</span><span class="op" id="2363320">]</span>&nbsp;<span class="op" id="2363322">==</span>&nbsp;<span class="string" id="2363325">&#39;=&#39;</span>&nbsp;<span class="op" id="2363329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363334">return</span>&nbsp;<span class="ident" id="2363341">s</span><span class="op" id="2363342">[</span><span class="ident" id="2363343">i</span><span class="op" id="2363344">+</span><span class="num" id="2363345">1</span><span class="op" id="2363346">:</span><span class="op" id="2363347">]</span><span class="op" id="2363348">,</span>&nbsp;<span class="builtintype" id="2363350">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363360">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363363">return</span>&nbsp;<span class="string" id="2363370">&#34;&#34;</span><span class="op" id="2363372">,</span>&nbsp;<span class="builtintype" id="2363374">false</span><br>
<span class="lineno"></span><span class="op" id="2363380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2363383">func</span>&nbsp;<span class="ident" id="2363388">Setenv</span><span class="op" id="2363394">(</span><span class="ident" id="2363395">key</span><span class="op" id="2363398">,</span>&nbsp;<span class="ident" id="2363400">value</span>&nbsp;<span class="builtintype" id="2363406">string</span><span class="op" id="2363412">)</span>&nbsp;<span class="builtintype" id="2363414">error</span>&nbsp;<span class="op" id="2363420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363423">envOnce</span><span class="op" id="2363430">.</span><span class="ident" id="2363431">Do</span><span class="op" id="2363433">(</span><span class="ident" id="2363434">copyenv</span><span class="op" id="2363441">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363444">if</span>&nbsp;<span class="builtinfunc" id="2363447">len</span><span class="op" id="2363450">(</span><span class="ident" id="2363451">key</span><span class="op" id="2363454">)</span>&nbsp;<span class="op" id="2363456">==</span>&nbsp;<span class="num" id="2363459">0</span>&nbsp;<span class="op" id="2363461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363465">return</span>&nbsp;<span class="ident" id="2363472">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363483">for</span>&nbsp;<span class="ident" id="2363487">i</span>&nbsp;<span class="op" id="2363489">:=</span>&nbsp;<span class="num" id="2363492">0</span><span class="op" id="2363493">;</span>&nbsp;<span class="ident" id="2363495">i</span>&nbsp;<span class="op" id="2363497">&lt;</span>&nbsp;<span class="builtinfunc" id="2363499">len</span><span class="op" id="2363502">(</span><span class="ident" id="2363503">key</span><span class="op" id="2363506">)</span><span class="op" id="2363507">;</span>&nbsp;<span class="ident" id="2363509">i</span><span class="op" id="2363510">++</span>&nbsp;<span class="op" id="2363513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363517">if</span>&nbsp;<span class="ident" id="2363520">key</span><span class="op" id="2363523">[</span><span class="ident" id="2363524">i</span><span class="op" id="2363525">]</span>&nbsp;<span class="op" id="2363527">==</span>&nbsp;<span class="string" id="2363530">&#39;=&#39;</span>&nbsp;<span class="op" id="2363534">||</span>&nbsp;<span class="ident" id="2363537">key</span><span class="op" id="2363540">[</span><span class="ident" id="2363541">i</span><span class="op" id="2363542">]</span>&nbsp;<span class="op" id="2363544">==</span>&nbsp;<span class="num" id="2363547">0</span>&nbsp;<span class="op" id="2363549">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363554">return</span>&nbsp;<span class="ident" id="2363561">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363576">for</span>&nbsp;<span class="ident" id="2363580">i</span>&nbsp;<span class="op" id="2363582">:=</span>&nbsp;<span class="num" id="2363585">0</span><span class="op" id="2363586">;</span>&nbsp;<span class="ident" id="2363588">i</span>&nbsp;<span class="op" id="2363590">&lt;</span>&nbsp;<span class="builtinfunc" id="2363592">len</span><span class="op" id="2363595">(</span><span class="ident" id="2363596">value</span><span class="op" id="2363601">)</span><span class="op" id="2363602">;</span>&nbsp;<span class="ident" id="2363604">i</span><span class="op" id="2363605">++</span>&nbsp;<span class="op" id="2363608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363612">if</span>&nbsp;<span class="ident" id="2363615">value</span><span class="op" id="2363620">[</span><span class="ident" id="2363621">i</span><span class="op" id="2363622">]</span>&nbsp;<span class="op" id="2363624">==</span>&nbsp;<span class="num" id="2363627">0</span>&nbsp;<span class="op" id="2363629">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363634">return</span>&nbsp;<span class="ident" id="2363641">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363657">envLock</span><span class="op" id="2363664">.</span><span class="ident" id="2363665">Lock</span><span class="op" id="2363669">(</span><span class="op" id="2363670">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363673">defer</span>&nbsp;<span class="ident" id="2363679">envLock</span><span class="op" id="2363686">.</span><span class="ident" id="2363687">Unlock</span><span class="op" id="2363693">(</span><span class="op" id="2363694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363698">i</span><span class="op" id="2363699">,</span>&nbsp;<span class="ident" id="2363701">ok</span>&nbsp;<span class="op" id="2363704">:=</span>&nbsp;<span class="ident" id="2363707">env</span><span class="op" id="2363710">[</span><span class="ident" id="2363711">key</span><span class="op" id="2363714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363717">kv</span>&nbsp;<span class="op" id="2363720">:=</span>&nbsp;<span class="ident" id="2363723">key</span>&nbsp;<span class="op" id="2363727">+</span>&nbsp;<span class="string" id="2363729">&#34;=&#34;</span>&nbsp;<span class="op" id="2363733">+</span>&nbsp;<span class="ident" id="2363735">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363742">if</span>&nbsp;<span class="ident" id="2363745">ok</span>&nbsp;<span class="op" id="2363748">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363752">envs</span><span class="op" id="2363756">[</span><span class="ident" id="2363757">i</span><span class="op" id="2363758">]</span>&nbsp;<span class="op" id="2363760">=</span>&nbsp;<span class="ident" id="2363762">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363766">}</span>&nbsp;<span class="keyword" id="2363768">else</span>&nbsp;<span class="op" id="2363773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363777">i</span>&nbsp;<span class="op" id="2363779">=</span>&nbsp;<span class="builtinfunc" id="2363781">len</span><span class="op" id="2363784">(</span><span class="ident" id="2363785">envs</span><span class="op" id="2363789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363793">envs</span>&nbsp;<span class="op" id="2363798">=</span>&nbsp;<span class="builtinfunc" id="2363800">append</span><span class="op" id="2363806">(</span><span class="ident" id="2363807">envs</span><span class="op" id="2363811">,</span>&nbsp;<span class="ident" id="2363813">kv</span><span class="op" id="2363815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2363818">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363821">env</span><span class="op" id="2363824">[</span><span class="ident" id="2363825">key</span><span class="op" id="2363828">]</span>&nbsp;<span class="op" id="2363830">=</span>&nbsp;<span class="ident" id="2363832">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363835">setenv_c</span><span class="op" id="2363843">(</span><span class="ident" id="2363844">key</span><span class="op" id="2363847">,</span>&nbsp;<span class="ident" id="2363849">value</span><span class="op" id="2363854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363857">return</span>&nbsp;<span class="ident" id="2363864">nil</span><br>
<span class="lineno"></span><span class="op" id="2363868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2363871">func</span>&nbsp;<span class="ident" id="2363876">Clearenv</span><span class="op" id="2363884">(</span><span class="op" id="2363885">)</span>&nbsp;<span class="op" id="2363887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363890">envOnce</span><span class="op" id="2363897">.</span><span class="ident" id="2363898">Do</span><span class="op" id="2363900">(</span><span class="ident" id="2363901">copyenv</span><span class="op" id="2363908">)</span>&nbsp;<span class="comment" id="2363910">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2363948">envLock</span><span class="op" id="2363955">.</span><span class="ident" id="2363956">Lock</span><span class="op" id="2363960">(</span><span class="op" id="2363961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363964">defer</span>&nbsp;<span class="ident" id="2363970">envLock</span><span class="op" id="2363977">.</span><span class="ident" id="2363978">Unlock</span><span class="op" id="2363984">(</span><span class="op" id="2363985">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2363989">for</span>&nbsp;<span class="ident" id="2363993">k</span>&nbsp;<span class="op" id="2363995">:=</span>&nbsp;<span class="keyword" id="2363998">range</span>&nbsp;<span class="ident" id="2364004">env</span>&nbsp;<span class="op" id="2364008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364012">unsetenv_c</span><span class="op" id="2364022">(</span><span class="ident" id="2364023">k</span><span class="op" id="2364024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2364027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364030">env</span>&nbsp;<span class="op" id="2364034">=</span>&nbsp;<span class="builtinfunc" id="2364036">make</span><span class="op" id="2364040">(</span><span class="keyword" id="2364041">map</span><span class="op" id="2364044">[</span><span class="builtintype" id="2364045">string</span><span class="op" id="2364051">]</span><span class="builtintype" id="2364052">int</span><span class="op" id="2364055">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364058">envs</span>&nbsp;<span class="op" id="2364063">=</span>&nbsp;<span class="op" id="2364065">[</span><span class="op" id="2364066">]</span><span class="builtintype" id="2364067">string</span><span class="op" id="2364073">{</span><span class="op" id="2364074">}</span><br>
<span class="lineno"></span><span class="op" id="2364076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2364079">func</span>&nbsp;<span class="ident" id="2364084">Environ</span><span class="op" id="2364091">(</span><span class="op" id="2364092">)</span>&nbsp;<span class="op" id="2364094">[</span><span class="op" id="2364095">]</span><span class="builtintype" id="2364096">string</span>&nbsp;<span class="op" id="2364103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364106">envOnce</span><span class="op" id="2364113">.</span><span class="ident" id="2364114">Do</span><span class="op" id="2364116">(</span><span class="ident" id="2364117">copyenv</span><span class="op" id="2364124">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364127">envLock</span><span class="op" id="2364134">.</span><span class="ident" id="2364135">RLock</span><span class="op" id="2364140">(</span><span class="op" id="2364141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2364144">defer</span>&nbsp;<span class="ident" id="2364150">envLock</span><span class="op" id="2364157">.</span><span class="ident" id="2364158">RUnlock</span><span class="op" id="2364165">(</span><span class="op" id="2364166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364169">a</span>&nbsp;<span class="op" id="2364171">:=</span>&nbsp;<span class="builtinfunc" id="2364174">make</span><span class="op" id="2364178">(</span><span class="op" id="2364179">[</span><span class="op" id="2364180">]</span><span class="builtintype" id="2364181">string</span><span class="op" id="2364187">,</span>&nbsp;<span class="num" id="2364189">0</span><span class="op" id="2364190">,</span>&nbsp;<span class="builtinfunc" id="2364192">len</span><span class="op" id="2364195">(</span><span class="ident" id="2364196">envs</span><span class="op" id="2364200">)</span><span class="op" id="2364201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2364204">for</span>&nbsp;<span class="ident" id="2364208">_</span><span class="op" id="2364209">,</span>&nbsp;<span class="ident" id="2364211">env</span>&nbsp;<span class="op" id="2364215">:=</span>&nbsp;<span class="keyword" id="2364218">range</span>&nbsp;<span class="ident" id="2364224">envs</span>&nbsp;<span class="op" id="2364229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2364233">if</span>&nbsp;<span class="ident" id="2364236">env</span>&nbsp;<span class="op" id="2364240">!=</span>&nbsp;<span class="string" id="2364243">&#34;&#34;</span>&nbsp;<span class="op" id="2364246">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2364251">a</span>&nbsp;<span class="op" id="2364253">=</span>&nbsp;<span class="builtinfunc" id="2364255">append</span><span class="op" id="2364261">(</span><span class="ident" id="2364262">a</span><span class="op" id="2364263">,</span>&nbsp;<span class="ident" id="2364265">env</span><span class="op" id="2364268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2364272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2364275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2364278">return</span>&nbsp;<span class="ident" id="2364285">a</span><br>
<span class="lineno"></span><span class="op" id="2364287">}</span>
</div>
</body>
</html>
