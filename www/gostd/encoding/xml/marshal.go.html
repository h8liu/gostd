<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5653560">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5653615">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5653669">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5653720">package</span>&nbsp;<span class="ident" id="5653728">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5653733">import</span>&nbsp;<span class="op" id="5653740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653743">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653752">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653761">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653773">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653780">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653786">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653797">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5653808">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5653818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5653821">const</span>&nbsp;<span class="op" id="5653827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653830">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653900">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653967">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654004">Header</span>&nbsp;<span class="op" id="5654011">=</span>&nbsp;<span class="string" id="5654013">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="5654054">+</span>&nbsp;<span class="string" id="5654056">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="5654061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5654064">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5654106">//</span><br>
<span class="lineno"></span><span class="comment" id="5654109">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5654183">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5654261">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="5654339">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5654414">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="5654493">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5654526">//</span><br>
<span class="lineno"></span><span class="comment" id="5654529">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="5654601">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="5654664">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="5654721">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5654782">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5654844">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="5654885">//</span><br>
<span class="lineno"></span><span class="comment" id="5654888">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5654965">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="5655022">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="5655079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="5655121">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5655185">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5655229">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5655293">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5655333">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="5655401">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5655433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="5655504">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="5655549">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5655620">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="5655693">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5655729">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="5655801">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5655874">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5655945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="5655977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5656047">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="5656093">//</span><br>
<span class="lineno"></span><span class="comment" id="5656096">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="5656171">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="5656248">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5656304">//</span><br>
<span class="lineno"></span><span class="comment" id="5656307">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="5656344">//</span><br>
<span class="lineno"></span><span class="comment" id="5656347">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="5656428">func</span>&nbsp;<span class="ident" id="5656433">Marshal</span><span class="op" id="5656440">(</span><span class="ident" id="5656441">v</span>&nbsp;<span class="keyword" id="5656443">interface</span><span class="op" id="5656452">{</span><span class="op" id="5656453">}</span><span class="op" id="5656454">)</span>&nbsp;<span class="op" id="5656456">(</span><span class="op" id="5656457">[</span><span class="op" id="5656458">]</span><span class="builtintype" id="5656459">byte</span><span class="op" id="5656463">,</span>&nbsp;<span class="builtintype" id="5656465">error</span><span class="op" id="5656470">)</span>&nbsp;<span class="op" id="5656472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656475">var</span>&nbsp;<span class="ident" id="5656479">b</span>&nbsp;<span class="ident" id="5656481">bytes</span><span class="op" id="5656486">.</span><span class="ident" id="5656487">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656495">if</span>&nbsp;<span class="ident" id="5656498">err</span>&nbsp;<span class="op" id="5656502">:=</span>&nbsp;<span class="ident" id="5656505">NewEncoder</span><span class="op" id="5656515">(</span><span class="op" id="5656516">&amp;</span><span class="ident" id="5656517">b</span><span class="op" id="5656518">)</span><span class="op" id="5656519">.</span><span class="ident" id="5656520">Encode</span><span class="op" id="5656526">(</span><span class="ident" id="5656527">v</span><span class="op" id="5656528">)</span><span class="op" id="5656529">;</span>&nbsp;<span class="ident" id="5656531">err</span>&nbsp;<span class="op" id="5656535">!=</span>&nbsp;<span class="ident" id="5656538">nil</span>&nbsp;<span class="op" id="5656542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656546">return</span>&nbsp;<span class="ident" id="5656553">nil</span><span class="op" id="5656556">,</span>&nbsp;<span class="ident" id="5656558">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656563">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656566">return</span>&nbsp;<span class="ident" id="5656573">b</span><span class="op" id="5656574">.</span><span class="ident" id="5656575">Bytes</span><span class="op" id="5656580">(</span><span class="op" id="5656581">)</span><span class="op" id="5656582">,</span>&nbsp;<span class="ident" id="5656584">nil</span><br>
<span class="lineno"></span><span class="op" id="5656588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5656591">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5656661">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="5656700">//</span><br>
<span class="lineno"></span><span class="comment" id="5656703">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5656768">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5656839">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5656870">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="5656934">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5657000">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="5657017">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="5657082">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5657147">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="5657186">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="5657255">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5657306">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="5657372">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5657389">type</span>&nbsp;<span class="ident" id="5657394">Marshaler</span>&nbsp;<span class="keyword" id="5657404">interface</span>&nbsp;<span class="op" id="5657414">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657417">MarshalXML</span><span class="op" id="5657427">(</span><span class="ident" id="5657428">e</span>&nbsp;<span class="op" id="5657430">*</span><span class="ident" id="5657431">Encoder</span><span class="op" id="5657438">,</span>&nbsp;<span class="ident" id="5657440">start</span>&nbsp;<span class="ident" id="5657446">StartElement</span><span class="op" id="5657458">)</span>&nbsp;<span class="builtintype" id="5657460">error</span><br>
<span class="lineno"></span><span class="op" id="5657466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5657469">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5657543">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="5657584">//</span><br>
<span class="lineno"></span><span class="comment" id="5657587">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="5657670">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5657736">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5657799">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="5657816">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="5657885">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5657921">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5657979">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="5658014">type</span>&nbsp;<span class="ident" id="5658019">MarshalerAttr</span>&nbsp;<span class="keyword" id="5658033">interface</span>&nbsp;<span class="op" id="5658043">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658046">MarshalXMLAttr</span><span class="op" id="5658060">(</span><span class="ident" id="5658061">name</span>&nbsp;<span class="ident" id="5658066">Name</span><span class="op" id="5658070">)</span>&nbsp;<span class="op" id="5658072">(</span><span class="ident" id="5658073">Attr</span><span class="op" id="5658077">,</span>&nbsp;<span class="builtintype" id="5658079">error</span><span class="op" id="5658084">)</span><br>
<span class="lineno"></span><span class="op" id="5658086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658089">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="5658163">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="5658235">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5658287">func</span>&nbsp;<span class="ident" id="5658292">MarshalIndent</span><span class="op" id="5658305">(</span><span class="ident" id="5658306">v</span>&nbsp;<span class="keyword" id="5658308">interface</span><span class="op" id="5658317">{</span><span class="op" id="5658318">}</span><span class="op" id="5658319">,</span>&nbsp;<span class="ident" id="5658321">prefix</span><span class="op" id="5658327">,</span>&nbsp;<span class="ident" id="5658329">indent</span>&nbsp;<span class="builtintype" id="5658336">string</span><span class="op" id="5658342">)</span>&nbsp;<span class="op" id="5658344">(</span><span class="op" id="5658345">[</span><span class="op" id="5658346">]</span><span class="builtintype" id="5658347">byte</span><span class="op" id="5658351">,</span>&nbsp;<span class="builtintype" id="5658353">error</span><span class="op" id="5658358">)</span>&nbsp;<span class="op" id="5658360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658363">var</span>&nbsp;<span class="ident" id="5658367">b</span>&nbsp;<span class="ident" id="5658369">bytes</span><span class="op" id="5658374">.</span><span class="ident" id="5658375">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658383">enc</span>&nbsp;<span class="op" id="5658387">:=</span>&nbsp;<span class="ident" id="5658390">NewEncoder</span><span class="op" id="5658400">(</span><span class="op" id="5658401">&amp;</span><span class="ident" id="5658402">b</span><span class="op" id="5658403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658406">enc</span><span class="op" id="5658409">.</span><span class="ident" id="5658410">Indent</span><span class="op" id="5658416">(</span><span class="ident" id="5658417">prefix</span><span class="op" id="5658423">,</span>&nbsp;<span class="ident" id="5658425">indent</span><span class="op" id="5658431">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658434">if</span>&nbsp;<span class="ident" id="5658437">err</span>&nbsp;<span class="op" id="5658441">:=</span>&nbsp;<span class="ident" id="5658444">enc</span><span class="op" id="5658447">.</span><span class="ident" id="5658448">Encode</span><span class="op" id="5658454">(</span><span class="ident" id="5658455">v</span><span class="op" id="5658456">)</span><span class="op" id="5658457">;</span>&nbsp;<span class="ident" id="5658459">err</span>&nbsp;<span class="op" id="5658463">!=</span>&nbsp;<span class="ident" id="5658466">nil</span>&nbsp;<span class="op" id="5658470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658474">return</span>&nbsp;<span class="ident" id="5658481">nil</span><span class="op" id="5658484">,</span>&nbsp;<span class="ident" id="5658486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658494">return</span>&nbsp;<span class="ident" id="5658501">b</span><span class="op" id="5658502">.</span><span class="ident" id="5658503">Bytes</span><span class="op" id="5658508">(</span><span class="op" id="5658509">)</span><span class="op" id="5658510">,</span>&nbsp;<span class="ident" id="5658512">nil</span><br>
<span class="lineno"></span><span class="op" id="5658516">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="5658519">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5658570">type</span>&nbsp;<span class="ident" id="5658575">Encoder</span>&nbsp;<span class="keyword" id="5658583">struct</span>&nbsp;<span class="op" id="5658590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658593">p</span>&nbsp;<span class="ident" id="5658595">printer</span><br>
<span class="lineno"></span><span class="op" id="5658603">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5658606">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5658660">func</span>&nbsp;<span class="ident" id="5658665">NewEncoder</span><span class="op" id="5658675">(</span><span class="ident" id="5658676">w</span>&nbsp;<span class="ident" id="5658678">io</span><span class="op" id="5658680">.</span><span class="ident" id="5658681">Writer</span><span class="op" id="5658687">)</span>&nbsp;<span class="op" id="5658689">*</span><span class="ident" id="5658690">Encoder</span>&nbsp;<span class="op" id="5658698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658701">e</span>&nbsp;<span class="op" id="5658703">:=</span>&nbsp;<span class="op" id="5658706">&amp;</span><span class="ident" id="5658707">Encoder</span><span class="op" id="5658714">{</span><span class="ident" id="5658715">printer</span><span class="op" id="5658722">{</span><span class="ident" id="5658723">Writer</span><span class="op" id="5658729">:</span>&nbsp;<span class="ident" id="5658731">bufio</span><span class="op" id="5658736">.</span><span class="ident" id="5658737">NewWriter</span><span class="op" id="5658746">(</span><span class="ident" id="5658747">w</span><span class="op" id="5658748">)</span><span class="op" id="5658749">}</span><span class="op" id="5658750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658753">e</span><span class="op" id="5658754">.</span><span class="ident" id="5658755">p</span><span class="op" id="5658756">.</span><span class="ident" id="5658757">encoder</span>&nbsp;<span class="op" id="5658765">=</span>&nbsp;<span class="ident" id="5658767">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658770">return</span>&nbsp;<span class="ident" id="5658777">e</span><br>
<span class="lineno"></span><span class="op" id="5658779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658782">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="5658847">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="5658923">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5658987">func</span>&nbsp;<span class="op" id="5658992">(</span><span class="ident" id="5658993">enc</span>&nbsp;<span class="op" id="5658997">*</span><span class="ident" id="5658998">Encoder</span><span class="op" id="5659005">)</span>&nbsp;<span class="ident" id="5659007">Indent</span><span class="op" id="5659013">(</span><span class="ident" id="5659014">prefix</span><span class="op" id="5659020">,</span>&nbsp;<span class="ident" id="5659022">indent</span>&nbsp;<span class="builtintype" id="5659029">string</span><span class="op" id="5659035">)</span>&nbsp;<span class="op" id="5659037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659040">enc</span><span class="op" id="5659043">.</span><span class="ident" id="5659044">p</span><span class="op" id="5659045">.</span><span class="ident" id="5659046">prefix</span>&nbsp;<span class="op" id="5659053">=</span>&nbsp;<span class="ident" id="5659055">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659063">enc</span><span class="op" id="5659066">.</span><span class="ident" id="5659067">p</span><span class="op" id="5659068">.</span><span class="ident" id="5659069">indent</span>&nbsp;<span class="op" id="5659076">=</span>&nbsp;<span class="ident" id="5659078">indent</span><br>
<span class="lineno"></span><span class="op" id="5659085">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="5659088">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5659142">//</span><br>
<span class="lineno"></span><span class="comment" id="5659145">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5659215">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="5659239">//</span><br>
<span class="lineno"></span><span class="comment" id="5659242">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5659282">func</span>&nbsp;<span class="op" id="5659287">(</span><span class="ident" id="5659288">enc</span>&nbsp;<span class="op" id="5659292">*</span><span class="ident" id="5659293">Encoder</span><span class="op" id="5659300">)</span>&nbsp;<span class="ident" id="5659302">Encode</span><span class="op" id="5659308">(</span><span class="ident" id="5659309">v</span>&nbsp;<span class="keyword" id="5659311">interface</span><span class="op" id="5659320">{</span><span class="op" id="5659321">}</span><span class="op" id="5659322">)</span>&nbsp;<span class="builtintype" id="5659324">error</span>&nbsp;<span class="op" id="5659330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659333">err</span>&nbsp;<span class="op" id="5659337">:=</span>&nbsp;<span class="ident" id="5659340">enc</span><span class="op" id="5659343">.</span><span class="ident" id="5659344">p</span><span class="op" id="5659345">.</span><span class="ident" id="5659346">marshalValue</span><span class="op" id="5659358">(</span><span class="ident" id="5659359">reflect</span><span class="op" id="5659366">.</span><span class="ident" id="5659367">ValueOf</span><span class="op" id="5659374">(</span><span class="ident" id="5659375">v</span><span class="op" id="5659376">)</span><span class="op" id="5659377">,</span>&nbsp;<span class="ident" id="5659379">nil</span><span class="op" id="5659382">,</span>&nbsp;<span class="ident" id="5659384">nil</span><span class="op" id="5659387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659390">if</span>&nbsp;<span class="ident" id="5659393">err</span>&nbsp;<span class="op" id="5659397">!=</span>&nbsp;<span class="ident" id="5659400">nil</span>&nbsp;<span class="op" id="5659404">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659408">return</span>&nbsp;<span class="ident" id="5659415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659423">return</span>&nbsp;<span class="ident" id="5659430">enc</span><span class="op" id="5659433">.</span><span class="ident" id="5659434">p</span><span class="op" id="5659435">.</span><span class="ident" id="5659436">Flush</span><span class="op" id="5659441">(</span><span class="op" id="5659442">)</span><br>
<span class="lineno"></span><span class="op" id="5659444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5659447">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5659508">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="5659561">//</span><br>
<span class="lineno"></span><span class="comment" id="5659564">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5659634">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="5659658">//</span><br>
<span class="lineno"></span><span class="comment" id="5659661">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5659708">func</span>&nbsp;<span class="op" id="5659713">(</span><span class="ident" id="5659714">enc</span>&nbsp;<span class="op" id="5659718">*</span><span class="ident" id="5659719">Encoder</span><span class="op" id="5659726">)</span>&nbsp;<span class="ident" id="5659728">EncodeElement</span><span class="op" id="5659741">(</span><span class="ident" id="5659742">v</span>&nbsp;<span class="keyword" id="5659744">interface</span><span class="op" id="5659753">{</span><span class="op" id="5659754">}</span><span class="op" id="5659755">,</span>&nbsp;<span class="ident" id="5659757">start</span>&nbsp;<span class="ident" id="5659763">StartElement</span><span class="op" id="5659775">)</span>&nbsp;<span class="builtintype" id="5659777">error</span>&nbsp;<span class="op" id="5659783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659786">err</span>&nbsp;<span class="op" id="5659790">:=</span>&nbsp;<span class="ident" id="5659793">enc</span><span class="op" id="5659796">.</span><span class="ident" id="5659797">p</span><span class="op" id="5659798">.</span><span class="ident" id="5659799">marshalValue</span><span class="op" id="5659811">(</span><span class="ident" id="5659812">reflect</span><span class="op" id="5659819">.</span><span class="ident" id="5659820">ValueOf</span><span class="op" id="5659827">(</span><span class="ident" id="5659828">v</span><span class="op" id="5659829">)</span><span class="op" id="5659830">,</span>&nbsp;<span class="ident" id="5659832">nil</span><span class="op" id="5659835">,</span>&nbsp;<span class="op" id="5659837">&amp;</span><span class="ident" id="5659838">start</span><span class="op" id="5659843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659846">if</span>&nbsp;<span class="ident" id="5659849">err</span>&nbsp;<span class="op" id="5659853">!=</span>&nbsp;<span class="ident" id="5659856">nil</span>&nbsp;<span class="op" id="5659860">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659864">return</span>&nbsp;<span class="ident" id="5659871">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659879">return</span>&nbsp;<span class="ident" id="5659886">enc</span><span class="op" id="5659889">.</span><span class="ident" id="5659890">p</span><span class="op" id="5659891">.</span><span class="ident" id="5659892">Flush</span><span class="op" id="5659897">(</span><span class="op" id="5659898">)</span><br>
<span class="lineno"></span><span class="op" id="5659900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="5659903">var</span>&nbsp;<span class="op" id="5659907">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659910">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5659923">=</span>&nbsp;<span class="op" id="5659925">[</span><span class="op" id="5659926">]</span><span class="builtintype" id="5659927">byte</span><span class="op" id="5659931">(</span><span class="string" id="5659932">&#34;--&gt;&#34;</span><span class="op" id="5659937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659940">endProcInst</span>&nbsp;&nbsp;<span class="op" id="5659953">=</span>&nbsp;<span class="op" id="5659955">[</span><span class="op" id="5659956">]</span><span class="builtintype" id="5659957">byte</span><span class="op" id="5659961">(</span><span class="string" id="5659962">&#34;?&gt;&#34;</span><span class="op" id="5659966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659969">endDirective</span>&nbsp;<span class="op" id="5659982">=</span>&nbsp;<span class="op" id="5659984">[</span><span class="op" id="5659985">]</span><span class="builtintype" id="5659986">byte</span><span class="op" id="5659990">(</span><span class="string" id="5659991">&#34;&gt;&#34;</span><span class="op" id="5659994">)</span><br>
<span class="lineno"></span><span class="op" id="5659996">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="5659999">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5660056">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="5660143">//</span><br>
<span class="lineno"></span><span class="comment" id="5660146">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="5660231">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="5660310">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="5660369">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5660449">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5660526">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="5660579">//</span><br>
<span class="lineno"></span><span class="comment" id="5660582">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5660672">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5660690">func</span>&nbsp;<span class="op" id="5660695">(</span><span class="ident" id="5660696">enc</span>&nbsp;<span class="op" id="5660700">*</span><span class="ident" id="5660701">Encoder</span><span class="op" id="5660708">)</span>&nbsp;<span class="ident" id="5660710">EncodeToken</span><span class="op" id="5660721">(</span><span class="ident" id="5660722">t</span>&nbsp;<span class="ident" id="5660724">Token</span><span class="op" id="5660729">)</span>&nbsp;<span class="builtintype" id="5660731">error</span>&nbsp;<span class="op" id="5660737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660740">p</span>&nbsp;<span class="op" id="5660742">:=</span>&nbsp;<span class="op" id="5660745">&amp;</span><span class="ident" id="5660746">enc</span><span class="op" id="5660749">.</span><span class="ident" id="5660750">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660753">switch</span>&nbsp;<span class="ident" id="5660760">t</span>&nbsp;<span class="op" id="5660762">:=</span>&nbsp;<span class="ident" id="5660765">t</span><span class="op" id="5660766">.</span><span class="op" id="5660767">(</span><span class="keyword" id="5660768">type</span><span class="op" id="5660772">)</span>&nbsp;<span class="op" id="5660774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660777">case</span>&nbsp;<span class="ident" id="5660782">StartElement</span><span class="op" id="5660794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660798">if</span>&nbsp;<span class="ident" id="5660801">err</span>&nbsp;<span class="op" id="5660805">:=</span>&nbsp;<span class="ident" id="5660808">p</span><span class="op" id="5660809">.</span><span class="ident" id="5660810">writeStart</span><span class="op" id="5660820">(</span><span class="op" id="5660821">&amp;</span><span class="ident" id="5660822">t</span><span class="op" id="5660823">)</span><span class="op" id="5660824">;</span>&nbsp;<span class="ident" id="5660826">err</span>&nbsp;<span class="op" id="5660830">!=</span>&nbsp;<span class="ident" id="5660833">nil</span>&nbsp;<span class="op" id="5660837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660842">return</span>&nbsp;<span class="ident" id="5660849">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660855">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660858">case</span>&nbsp;<span class="ident" id="5660863">EndElement</span><span class="op" id="5660873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660877">if</span>&nbsp;<span class="ident" id="5660880">err</span>&nbsp;<span class="op" id="5660884">:=</span>&nbsp;<span class="ident" id="5660887">p</span><span class="op" id="5660888">.</span><span class="ident" id="5660889">writeEnd</span><span class="op" id="5660897">(</span><span class="ident" id="5660898">t</span><span class="op" id="5660899">.</span><span class="ident" id="5660900">Name</span><span class="op" id="5660904">)</span><span class="op" id="5660905">;</span>&nbsp;<span class="ident" id="5660907">err</span>&nbsp;<span class="op" id="5660911">!=</span>&nbsp;<span class="ident" id="5660914">nil</span>&nbsp;<span class="op" id="5660918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660923">return</span>&nbsp;<span class="ident" id="5660930">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660939">case</span>&nbsp;<span class="ident" id="5660944">CharData</span><span class="op" id="5660952">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660956">EscapeText</span><span class="op" id="5660966">(</span><span class="ident" id="5660967">p</span><span class="op" id="5660968">,</span>&nbsp;<span class="ident" id="5660970">t</span><span class="op" id="5660971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660974">case</span>&nbsp;<span class="ident" id="5660979">Comment</span><span class="op" id="5660986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660990">if</span>&nbsp;<span class="ident" id="5660993">bytes</span><span class="op" id="5660998">.</span><span class="ident" id="5660999">Contains</span><span class="op" id="5661007">(</span><span class="ident" id="5661008">t</span><span class="op" id="5661009">,</span>&nbsp;<span class="ident" id="5661011">endComment</span><span class="op" id="5661021">)</span>&nbsp;<span class="op" id="5661023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661028">return</span>&nbsp;<span class="ident" id="5661035">fmt</span><span class="op" id="5661038">.</span><span class="ident" id="5661039">Errorf</span><span class="op" id="5661045">(</span><span class="string" id="5661046">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="5661097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661101">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661105">p</span><span class="op" id="5661106">.</span><span class="ident" id="5661107">WriteString</span><span class="op" id="5661118">(</span><span class="string" id="5661119">&#34;&lt;!--&#34;</span><span class="op" id="5661125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661129">p</span><span class="op" id="5661130">.</span><span class="ident" id="5661131">Write</span><span class="op" id="5661136">(</span><span class="ident" id="5661137">t</span><span class="op" id="5661138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661142">p</span><span class="op" id="5661143">.</span><span class="ident" id="5661144">WriteString</span><span class="op" id="5661155">(</span><span class="string" id="5661156">&#34;--&gt;&#34;</span><span class="op" id="5661161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661165">return</span>&nbsp;<span class="ident" id="5661172">p</span><span class="op" id="5661173">.</span><span class="ident" id="5661174">cachedWriteError</span><span class="op" id="5661190">(</span><span class="op" id="5661191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661194">case</span>&nbsp;<span class="ident" id="5661199">ProcInst</span><span class="op" id="5661207">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661211">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661286">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661366">if</span>&nbsp;<span class="ident" id="5661369">t</span><span class="op" id="5661370">.</span><span class="ident" id="5661371">Target</span>&nbsp;<span class="op" id="5661378">==</span>&nbsp;<span class="string" id="5661381">&#34;xml&#34;</span>&nbsp;<span class="op" id="5661387">&amp;&amp;</span>&nbsp;<span class="ident" id="5661390">p</span><span class="op" id="5661391">.</span><span class="ident" id="5661392">Buffered</span><span class="op" id="5661400">(</span><span class="op" id="5661401">)</span>&nbsp;<span class="op" id="5661403">!=</span>&nbsp;<span class="num" id="5661406">0</span>&nbsp;<span class="op" id="5661408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661413">return</span>&nbsp;<span class="ident" id="5661420">fmt</span><span class="op" id="5661423">.</span><span class="ident" id="5661424">Errorf</span><span class="op" id="5661430">(</span><span class="string" id="5661431">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="5661524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661528">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661532">if</span>&nbsp;<span class="op" id="5661535">!</span><span class="ident" id="5661536">isNameString</span><span class="op" id="5661548">(</span><span class="ident" id="5661549">t</span><span class="op" id="5661550">.</span><span class="ident" id="5661551">Target</span><span class="op" id="5661557">)</span>&nbsp;<span class="op" id="5661559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661564">return</span>&nbsp;<span class="ident" id="5661571">fmt</span><span class="op" id="5661574">.</span><span class="ident" id="5661575">Errorf</span><span class="op" id="5661581">(</span><span class="string" id="5661582">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="5661632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661640">if</span>&nbsp;<span class="ident" id="5661643">bytes</span><span class="op" id="5661648">.</span><span class="ident" id="5661649">Contains</span><span class="op" id="5661657">(</span><span class="ident" id="5661658">t</span><span class="op" id="5661659">.</span><span class="ident" id="5661660">Inst</span><span class="op" id="5661664">,</span>&nbsp;<span class="ident" id="5661666">endProcInst</span><span class="op" id="5661677">)</span>&nbsp;<span class="op" id="5661679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661684">return</span>&nbsp;<span class="ident" id="5661691">fmt</span><span class="op" id="5661694">.</span><span class="ident" id="5661695">Errorf</span><span class="op" id="5661701">(</span><span class="string" id="5661702">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="5661753">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661761">p</span><span class="op" id="5661762">.</span><span class="ident" id="5661763">WriteString</span><span class="op" id="5661774">(</span><span class="string" id="5661775">&#34;&lt;?&#34;</span><span class="op" id="5661779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661783">p</span><span class="op" id="5661784">.</span><span class="ident" id="5661785">WriteString</span><span class="op" id="5661796">(</span><span class="ident" id="5661797">t</span><span class="op" id="5661798">.</span><span class="ident" id="5661799">Target</span><span class="op" id="5661805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661809">if</span>&nbsp;<span class="builtinfunc" id="5661812">len</span><span class="op" id="5661815">(</span><span class="ident" id="5661816">t</span><span class="op" id="5661817">.</span><span class="ident" id="5661818">Inst</span><span class="op" id="5661822">)</span>&nbsp;<span class="op" id="5661824">&gt;</span>&nbsp;<span class="num" id="5661826">0</span>&nbsp;<span class="op" id="5661828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661833">p</span><span class="op" id="5661834">.</span><span class="ident" id="5661835">WriteByte</span><span class="op" id="5661844">(</span><span class="string" id="5661845">&#39;&nbsp;&#39;</span><span class="op" id="5661848">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661853">p</span><span class="op" id="5661854">.</span><span class="ident" id="5661855">Write</span><span class="op" id="5661860">(</span><span class="ident" id="5661861">t</span><span class="op" id="5661862">.</span><span class="ident" id="5661863">Inst</span><span class="op" id="5661867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661875">p</span><span class="op" id="5661876">.</span><span class="ident" id="5661877">WriteString</span><span class="op" id="5661888">(</span><span class="string" id="5661889">&#34;?&gt;&#34;</span><span class="op" id="5661893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661896">case</span>&nbsp;<span class="ident" id="5661901">Directive</span><span class="op" id="5661910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661914">if</span>&nbsp;<span class="ident" id="5661917">bytes</span><span class="op" id="5661922">.</span><span class="ident" id="5661923">Contains</span><span class="op" id="5661931">(</span><span class="ident" id="5661932">t</span><span class="op" id="5661933">,</span>&nbsp;<span class="ident" id="5661935">endDirective</span><span class="op" id="5661947">)</span>&nbsp;<span class="op" id="5661949">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661954">return</span>&nbsp;<span class="ident" id="5661961">fmt</span><span class="op" id="5661964">.</span><span class="ident" id="5661965">Errorf</span><span class="op" id="5661971">(</span><span class="string" id="5661972">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="5662023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662031">p</span><span class="op" id="5662032">.</span><span class="ident" id="5662033">WriteString</span><span class="op" id="5662044">(</span><span class="string" id="5662045">&#34;&lt;!&#34;</span><span class="op" id="5662049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662053">p</span><span class="op" id="5662054">.</span><span class="ident" id="5662055">Write</span><span class="op" id="5662060">(</span><span class="ident" id="5662061">t</span><span class="op" id="5662062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662066">p</span><span class="op" id="5662067">.</span><span class="ident" id="5662068">WriteString</span><span class="op" id="5662079">(</span><span class="string" id="5662080">&#34;&gt;&#34;</span><span class="op" id="5662083">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662089">return</span>&nbsp;<span class="ident" id="5662096">p</span><span class="op" id="5662097">.</span><span class="ident" id="5662098">cachedWriteError</span><span class="op" id="5662114">(</span><span class="op" id="5662115">)</span><br>
<span class="lineno"></span><span class="op" id="5662117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662120">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="5662180">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5662257">func</span>&nbsp;<span class="op" id="5662262">(</span><span class="ident" id="5662263">enc</span>&nbsp;<span class="op" id="5662267">*</span><span class="ident" id="5662268">Encoder</span><span class="op" id="5662275">)</span>&nbsp;<span class="ident" id="5662277">Flush</span><span class="op" id="5662282">(</span><span class="op" id="5662283">)</span>&nbsp;<span class="builtintype" id="5662285">error</span>&nbsp;<span class="op" id="5662291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662294">return</span>&nbsp;<span class="ident" id="5662301">enc</span><span class="op" id="5662304">.</span><span class="ident" id="5662305">p</span><span class="op" id="5662306">.</span><span class="ident" id="5662307">Flush</span><span class="op" id="5662312">(</span><span class="op" id="5662313">)</span><br>
<span class="lineno"></span><span class="op" id="5662315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="5662318">type</span>&nbsp;<span class="ident" id="5662323">printer</span>&nbsp;<span class="keyword" id="5662331">struct</span>&nbsp;<span class="op" id="5662338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662341">*</span><span class="ident" id="5662342">bufio</span><span class="op" id="5662347">.</span><span class="ident" id="5662348">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662356">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5662367">*</span><span class="ident" id="5662368">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662377">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662388">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662393">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662404">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662412">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662423">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662431">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662442">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662447">indentedIn</span>&nbsp;<span class="builtintype" id="5662458">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662464">putNewline</span>&nbsp;<span class="builtintype" id="5662475">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662481">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662492">map</span><span class="op" id="5662495">[</span><span class="builtintype" id="5662496">string</span><span class="op" id="5662502">]</span><span class="builtintype" id="5662503">string</span>&nbsp;<span class="comment" id="5662510">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662539">attrPrefix</span>&nbsp;<span class="keyword" id="5662550">map</span><span class="op" id="5662553">[</span><span class="builtintype" id="5662554">string</span><span class="op" id="5662560">]</span><span class="builtintype" id="5662561">string</span>&nbsp;<span class="comment" id="5662568">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662597">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5662608">[</span><span class="op" id="5662609">]</span><span class="builtintype" id="5662610">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662618">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5662629">[</span><span class="op" id="5662630">]</span><span class="ident" id="5662631">Name</span><br>
<span class="lineno"></span><span class="op" id="5662636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="5662639">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="5662730">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5662792">func</span>&nbsp;<span class="op" id="5662797">(</span><span class="ident" id="5662798">p</span>&nbsp;<span class="op" id="5662800">*</span><span class="ident" id="5662801">printer</span><span class="op" id="5662808">)</span>&nbsp;<span class="ident" id="5662810">createAttrPrefix</span><span class="op" id="5662826">(</span><span class="ident" id="5662827">url</span>&nbsp;<span class="builtintype" id="5662831">string</span><span class="op" id="5662837">)</span>&nbsp;<span class="builtintype" id="5662839">string</span>&nbsp;<span class="op" id="5662846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662849">if</span>&nbsp;<span class="ident" id="5662852">prefix</span>&nbsp;<span class="op" id="5662859">:=</span>&nbsp;<span class="ident" id="5662862">p</span><span class="op" id="5662863">.</span><span class="ident" id="5662864">attrPrefix</span><span class="op" id="5662874">[</span><span class="ident" id="5662875">url</span><span class="op" id="5662878">]</span><span class="op" id="5662879">;</span>&nbsp;<span class="ident" id="5662881">prefix</span>&nbsp;<span class="op" id="5662888">!=</span>&nbsp;<span class="string" id="5662891">&#34;&#34;</span>&nbsp;<span class="op" id="5662894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662898">return</span>&nbsp;<span class="ident" id="5662905">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662917">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662998">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663036">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663119">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663198">if</span>&nbsp;<span class="ident" id="5663201">url</span>&nbsp;<span class="op" id="5663205">==</span>&nbsp;<span class="ident" id="5663208">xmlURL</span>&nbsp;<span class="op" id="5663215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663219">return</span>&nbsp;<span class="string" id="5663226">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663237">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663274">if</span>&nbsp;<span class="ident" id="5663277">p</span><span class="op" id="5663278">.</span><span class="ident" id="5663279">attrPrefix</span>&nbsp;<span class="op" id="5663290">==</span>&nbsp;<span class="ident" id="5663293">nil</span>&nbsp;<span class="op" id="5663297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663301">p</span><span class="op" id="5663302">.</span><span class="ident" id="5663303">attrPrefix</span>&nbsp;<span class="op" id="5663314">=</span>&nbsp;<span class="builtinfunc" id="5663316">make</span><span class="op" id="5663320">(</span><span class="keyword" id="5663321">map</span><span class="op" id="5663324">[</span><span class="builtintype" id="5663325">string</span><span class="op" id="5663331">]</span><span class="builtintype" id="5663332">string</span><span class="op" id="5663338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663342">p</span><span class="op" id="5663343">.</span><span class="ident" id="5663344">attrNS</span>&nbsp;<span class="op" id="5663351">=</span>&nbsp;<span class="builtinfunc" id="5663353">make</span><span class="op" id="5663357">(</span><span class="keyword" id="5663358">map</span><span class="op" id="5663361">[</span><span class="builtintype" id="5663362">string</span><span class="op" id="5663368">]</span><span class="builtintype" id="5663369">string</span><span class="op" id="5663375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663378">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663382">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663443">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663467">prefix</span>&nbsp;<span class="op" id="5663474">:=</span>&nbsp;<span class="ident" id="5663477">strings</span><span class="op" id="5663484">.</span><span class="ident" id="5663485">TrimRight</span><span class="op" id="5663494">(</span><span class="ident" id="5663495">url</span><span class="op" id="5663498">,</span>&nbsp;<span class="string" id="5663500">&#34;/&#34;</span><span class="op" id="5663503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663506">if</span>&nbsp;<span class="ident" id="5663509">i</span>&nbsp;<span class="op" id="5663511">:=</span>&nbsp;<span class="ident" id="5663514">strings</span><span class="op" id="5663521">.</span><span class="ident" id="5663522">LastIndex</span><span class="op" id="5663531">(</span><span class="ident" id="5663532">prefix</span><span class="op" id="5663538">,</span>&nbsp;<span class="string" id="5663540">&#34;/&#34;</span><span class="op" id="5663543">)</span><span class="op" id="5663544">;</span>&nbsp;<span class="ident" id="5663546">i</span>&nbsp;<span class="op" id="5663548">&gt;=</span>&nbsp;<span class="num" id="5663551">0</span>&nbsp;<span class="op" id="5663553">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663557">prefix</span>&nbsp;<span class="op" id="5663564">=</span>&nbsp;<span class="ident" id="5663566">prefix</span><span class="op" id="5663572">[</span><span class="ident" id="5663573">i</span><span class="op" id="5663574">+</span><span class="num" id="5663575">1</span><span class="op" id="5663576">:</span><span class="op" id="5663577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663583">if</span>&nbsp;<span class="ident" id="5663586">prefix</span>&nbsp;<span class="op" id="5663593">==</span>&nbsp;<span class="string" id="5663596">&#34;&#34;</span>&nbsp;<span class="op" id="5663599">||</span>&nbsp;<span class="op" id="5663602">!</span><span class="ident" id="5663603">isName</span><span class="op" id="5663609">(</span><span class="op" id="5663610">[</span><span class="op" id="5663611">]</span><span class="builtintype" id="5663612">byte</span><span class="op" id="5663616">(</span><span class="ident" id="5663617">prefix</span><span class="op" id="5663623">)</span><span class="op" id="5663624">)</span>&nbsp;<span class="op" id="5663626">||</span>&nbsp;<span class="ident" id="5663629">strings</span><span class="op" id="5663636">.</span><span class="ident" id="5663637">Contains</span><span class="op" id="5663645">(</span><span class="ident" id="5663646">prefix</span><span class="op" id="5663652">,</span>&nbsp;<span class="string" id="5663654">&#34;:&#34;</span><span class="op" id="5663657">)</span>&nbsp;<span class="op" id="5663659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663663">prefix</span>&nbsp;<span class="op" id="5663670">=</span>&nbsp;<span class="string" id="5663672">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663677">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663680">if</span>&nbsp;<span class="ident" id="5663683">strings</span><span class="op" id="5663690">.</span><span class="ident" id="5663691">HasPrefix</span><span class="op" id="5663700">(</span><span class="ident" id="5663701">prefix</span><span class="op" id="5663707">,</span>&nbsp;<span class="string" id="5663709">&#34;xml&#34;</span><span class="op" id="5663714">)</span>&nbsp;<span class="op" id="5663716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663720">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663750">prefix</span>&nbsp;<span class="op" id="5663757">=</span>&nbsp;<span class="string" id="5663759">&#34;_&#34;</span>&nbsp;<span class="op" id="5663763">+</span>&nbsp;<span class="ident" id="5663765">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663776">if</span>&nbsp;<span class="ident" id="5663779">p</span><span class="op" id="5663780">.</span><span class="ident" id="5663781">attrNS</span><span class="op" id="5663787">[</span><span class="ident" id="5663788">prefix</span><span class="op" id="5663794">]</span>&nbsp;<span class="op" id="5663796">!=</span>&nbsp;<span class="string" id="5663799">&#34;&#34;</span>&nbsp;<span class="op" id="5663802">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5663806">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663845">for</span>&nbsp;<span class="ident" id="5663849">p</span><span class="op" id="5663850">.</span><span class="ident" id="5663851">seq</span><span class="op" id="5663854">++</span><span class="op" id="5663856">;</span>&nbsp;<span class="op" id="5663858">;</span>&nbsp;<span class="ident" id="5663860">p</span><span class="op" id="5663861">.</span><span class="ident" id="5663862">seq</span><span class="op" id="5663865">++</span>&nbsp;<span class="op" id="5663868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663873">if</span>&nbsp;<span class="ident" id="5663876">id</span>&nbsp;<span class="op" id="5663879">:=</span>&nbsp;<span class="ident" id="5663882">prefix</span>&nbsp;<span class="op" id="5663889">+</span>&nbsp;<span class="string" id="5663891">&#34;_&#34;</span>&nbsp;<span class="op" id="5663895">+</span>&nbsp;<span class="ident" id="5663897">strconv</span><span class="op" id="5663904">.</span><span class="ident" id="5663905">Itoa</span><span class="op" id="5663909">(</span><span class="ident" id="5663910">p</span><span class="op" id="5663911">.</span><span class="ident" id="5663912">seq</span><span class="op" id="5663915">)</span><span class="op" id="5663916">;</span>&nbsp;<span class="ident" id="5663918">p</span><span class="op" id="5663919">.</span><span class="ident" id="5663920">attrNS</span><span class="op" id="5663926">[</span><span class="ident" id="5663927">id</span><span class="op" id="5663929">]</span>&nbsp;<span class="op" id="5663931">==</span>&nbsp;<span class="string" id="5663934">&#34;&#34;</span>&nbsp;<span class="op" id="5663937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663943">prefix</span>&nbsp;<span class="op" id="5663950">=</span>&nbsp;<span class="ident" id="5663952">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663959">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663979">p</span><span class="op" id="5663980">.</span><span class="ident" id="5663981">attrPrefix</span><span class="op" id="5663991">[</span><span class="ident" id="5663992">url</span><span class="op" id="5663995">]</span>&nbsp;<span class="op" id="5663997">=</span>&nbsp;<span class="ident" id="5663999">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664007">p</span><span class="op" id="5664008">.</span><span class="ident" id="5664009">attrNS</span><span class="op" id="5664015">[</span><span class="ident" id="5664016">prefix</span><span class="op" id="5664022">]</span>&nbsp;<span class="op" id="5664024">=</span>&nbsp;<span class="ident" id="5664026">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664032">p</span><span class="op" id="5664033">.</span><span class="ident" id="5664034">WriteString</span><span class="op" id="5664045">(</span><span class="string" id="5664046">`xmlns:`</span><span class="op" id="5664054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664057">p</span><span class="op" id="5664058">.</span><span class="ident" id="5664059">WriteString</span><span class="op" id="5664070">(</span><span class="ident" id="5664071">prefix</span><span class="op" id="5664077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664080">p</span><span class="op" id="5664081">.</span><span class="ident" id="5664082">WriteString</span><span class="op" id="5664093">(</span><span class="string" id="5664094">`=&#34;`</span><span class="op" id="5664098">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664101">EscapeText</span><span class="op" id="5664111">(</span><span class="ident" id="5664112">p</span><span class="op" id="5664113">,</span>&nbsp;<span class="op" id="5664115">[</span><span class="op" id="5664116">]</span><span class="builtintype" id="5664117">byte</span><span class="op" id="5664121">(</span><span class="ident" id="5664122">url</span><span class="op" id="5664125">)</span><span class="op" id="5664126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664129">p</span><span class="op" id="5664130">.</span><span class="ident" id="5664131">WriteString</span><span class="op" id="5664142">(</span><span class="string" id="5664143">`&#34;&nbsp;`</span><span class="op" id="5664147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664151">p</span><span class="op" id="5664152">.</span><span class="ident" id="5664153">prefixes</span>&nbsp;<span class="op" id="5664162">=</span>&nbsp;<span class="builtinfunc" id="5664164">append</span><span class="op" id="5664170">(</span><span class="ident" id="5664171">p</span><span class="op" id="5664172">.</span><span class="ident" id="5664173">prefixes</span><span class="op" id="5664181">,</span>&nbsp;<span class="ident" id="5664183">prefix</span><span class="op" id="5664189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664193">return</span>&nbsp;<span class="ident" id="5664200">prefix</span><br>
<span class="lineno"></span><span class="op" id="5664207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664210">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5664270">func</span>&nbsp;<span class="op" id="5664275">(</span><span class="ident" id="5664276">p</span>&nbsp;<span class="op" id="5664278">*</span><span class="ident" id="5664279">printer</span><span class="op" id="5664286">)</span>&nbsp;<span class="ident" id="5664288">deleteAttrPrefix</span><span class="op" id="5664304">(</span><span class="ident" id="5664305">prefix</span>&nbsp;<span class="builtintype" id="5664312">string</span><span class="op" id="5664318">)</span>&nbsp;<span class="op" id="5664320">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5664323">delete</span><span class="op" id="5664329">(</span><span class="ident" id="5664330">p</span><span class="op" id="5664331">.</span><span class="ident" id="5664332">attrPrefix</span><span class="op" id="5664342">,</span>&nbsp;<span class="ident" id="5664344">p</span><span class="op" id="5664345">.</span><span class="ident" id="5664346">attrNS</span><span class="op" id="5664352">[</span><span class="ident" id="5664353">prefix</span><span class="op" id="5664359">]</span><span class="op" id="5664360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5664363">delete</span><span class="op" id="5664369">(</span><span class="ident" id="5664370">p</span><span class="op" id="5664371">.</span><span class="ident" id="5664372">attrNS</span><span class="op" id="5664378">,</span>&nbsp;<span class="ident" id="5664380">prefix</span><span class="op" id="5664386">)</span><br>
<span class="lineno"></span><span class="op" id="5664388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664391">func</span>&nbsp;<span class="op" id="5664396">(</span><span class="ident" id="5664397">p</span>&nbsp;<span class="op" id="5664399">*</span><span class="ident" id="5664400">printer</span><span class="op" id="5664407">)</span>&nbsp;<span class="ident" id="5664409">markPrefix</span><span class="op" id="5664419">(</span><span class="op" id="5664420">)</span>&nbsp;<span class="op" id="5664422">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664425">p</span><span class="op" id="5664426">.</span><span class="ident" id="5664427">prefixes</span>&nbsp;<span class="op" id="5664436">=</span>&nbsp;<span class="builtinfunc" id="5664438">append</span><span class="op" id="5664444">(</span><span class="ident" id="5664445">p</span><span class="op" id="5664446">.</span><span class="ident" id="5664447">prefixes</span><span class="op" id="5664455">,</span>&nbsp;<span class="string" id="5664457">&#34;&#34;</span><span class="op" id="5664459">)</span><br>
<span class="lineno"></span><span class="op" id="5664461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664464">func</span>&nbsp;<span class="op" id="5664469">(</span><span class="ident" id="5664470">p</span>&nbsp;<span class="op" id="5664472">*</span><span class="ident" id="5664473">printer</span><span class="op" id="5664480">)</span>&nbsp;<span class="ident" id="5664482">popPrefix</span><span class="op" id="5664491">(</span><span class="op" id="5664492">)</span>&nbsp;<span class="op" id="5664494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664497">for</span>&nbsp;<span class="builtinfunc" id="5664501">len</span><span class="op" id="5664504">(</span><span class="ident" id="5664505">p</span><span class="op" id="5664506">.</span><span class="ident" id="5664507">prefixes</span><span class="op" id="5664515">)</span>&nbsp;<span class="op" id="5664517">&gt;</span>&nbsp;<span class="num" id="5664519">0</span>&nbsp;<span class="op" id="5664521">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664525">prefix</span>&nbsp;<span class="op" id="5664532">:=</span>&nbsp;<span class="ident" id="5664535">p</span><span class="op" id="5664536">.</span><span class="ident" id="5664537">prefixes</span><span class="op" id="5664545">[</span><span class="builtinfunc" id="5664546">len</span><span class="op" id="5664549">(</span><span class="ident" id="5664550">p</span><span class="op" id="5664551">.</span><span class="ident" id="5664552">prefixes</span><span class="op" id="5664560">)</span><span class="op" id="5664561">-</span><span class="num" id="5664562">1</span><span class="op" id="5664563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664567">p</span><span class="op" id="5664568">.</span><span class="ident" id="5664569">prefixes</span>&nbsp;<span class="op" id="5664578">=</span>&nbsp;<span class="ident" id="5664580">p</span><span class="op" id="5664581">.</span><span class="ident" id="5664582">prefixes</span><span class="op" id="5664590">[</span><span class="op" id="5664591">:</span><span class="builtinfunc" id="5664592">len</span><span class="op" id="5664595">(</span><span class="ident" id="5664596">p</span><span class="op" id="5664597">.</span><span class="ident" id="5664598">prefixes</span><span class="op" id="5664606">)</span><span class="op" id="5664607">-</span><span class="num" id="5664608">1</span><span class="op" id="5664609">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664613">if</span>&nbsp;<span class="ident" id="5664616">prefix</span>&nbsp;<span class="op" id="5664623">==</span>&nbsp;<span class="string" id="5664626">&#34;&#34;</span>&nbsp;<span class="op" id="5664629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664634">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664642">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664646">p</span><span class="op" id="5664647">.</span><span class="ident" id="5664648">deleteAttrPrefix</span><span class="op" id="5664664">(</span><span class="ident" id="5664665">prefix</span><span class="op" id="5664671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664674">}</span><br>
<span class="lineno"></span><span class="op" id="5664676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664679">var</span>&nbsp;<span class="op" id="5664683">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664686">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664704">=</span>&nbsp;<span class="ident" id="5664706">reflect</span><span class="op" id="5664713">.</span><span class="ident" id="5664714">TypeOf</span><span class="op" id="5664720">(</span><span class="op" id="5664721">(</span><span class="op" id="5664722">*</span><span class="ident" id="5664723">Marshaler</span><span class="op" id="5664732">)</span><span class="op" id="5664733">(</span><span class="ident" id="5664734">nil</span><span class="op" id="5664737">)</span><span class="op" id="5664738">)</span><span class="op" id="5664739">.</span><span class="ident" id="5664740">Elem</span><span class="op" id="5664744">(</span><span class="op" id="5664745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664748">marshalerAttrType</span>&nbsp;<span class="op" id="5664766">=</span>&nbsp;<span class="ident" id="5664768">reflect</span><span class="op" id="5664775">.</span><span class="ident" id="5664776">TypeOf</span><span class="op" id="5664782">(</span><span class="op" id="5664783">(</span><span class="op" id="5664784">*</span><span class="ident" id="5664785">MarshalerAttr</span><span class="op" id="5664798">)</span><span class="op" id="5664799">(</span><span class="ident" id="5664800">nil</span><span class="op" id="5664803">)</span><span class="op" id="5664804">)</span><span class="op" id="5664805">.</span><span class="ident" id="5664806">Elem</span><span class="op" id="5664810">(</span><span class="op" id="5664811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664814">textMarshalerType</span>&nbsp;<span class="op" id="5664832">=</span>&nbsp;<span class="ident" id="5664834">reflect</span><span class="op" id="5664841">.</span><span class="ident" id="5664842">TypeOf</span><span class="op" id="5664848">(</span><span class="op" id="5664849">(</span><span class="op" id="5664850">*</span><span class="ident" id="5664851">encoding</span><span class="op" id="5664859">.</span><span class="ident" id="5664860">TextMarshaler</span><span class="op" id="5664873">)</span><span class="op" id="5664874">(</span><span class="ident" id="5664875">nil</span><span class="op" id="5664878">)</span><span class="op" id="5664879">)</span><span class="op" id="5664880">.</span><span class="ident" id="5664881">Elem</span><span class="op" id="5664885">(</span><span class="op" id="5664886">)</span><br>
<span class="lineno"></span><span class="op" id="5664888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="5664891">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="5664957">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="5665030">func</span>&nbsp;<span class="op" id="5665035">(</span><span class="ident" id="5665036">p</span>&nbsp;<span class="op" id="5665038">*</span><span class="ident" id="5665039">printer</span><span class="op" id="5665046">)</span>&nbsp;<span class="ident" id="5665048">marshalValue</span><span class="op" id="5665060">(</span><span class="ident" id="5665061">val</span>&nbsp;<span class="ident" id="5665065">reflect</span><span class="op" id="5665072">.</span><span class="ident" id="5665073">Value</span><span class="op" id="5665078">,</span>&nbsp;<span class="ident" id="5665080">finfo</span>&nbsp;<span class="op" id="5665086">*</span><span class="ident" id="5665087">fieldInfo</span><span class="op" id="5665096">,</span>&nbsp;<span class="ident" id="5665098">startTemplate</span>&nbsp;<span class="op" id="5665112">*</span><span class="ident" id="5665113">StartElement</span><span class="op" id="5665125">)</span>&nbsp;<span class="builtintype" id="5665127">error</span>&nbsp;<span class="op" id="5665133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665136">if</span>&nbsp;<span class="ident" id="5665139">startTemplate</span>&nbsp;<span class="op" id="5665153">!=</span>&nbsp;<span class="ident" id="5665156">nil</span>&nbsp;<span class="op" id="5665160">&amp;&amp;</span>&nbsp;<span class="ident" id="5665163">startTemplate</span><span class="op" id="5665176">.</span><span class="ident" id="5665177">Name</span><span class="op" id="5665181">.</span><span class="ident" id="5665182">Local</span>&nbsp;<span class="op" id="5665188">==</span>&nbsp;<span class="string" id="5665191">&#34;&#34;</span>&nbsp;<span class="op" id="5665194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665198">return</span>&nbsp;<span class="ident" id="5665205">fmt</span><span class="op" id="5665208">.</span><span class="ident" id="5665209">Errorf</span><span class="op" id="5665215">(</span><span class="string" id="5665216">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="5665270">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665277">if</span>&nbsp;<span class="op" id="5665280">!</span><span class="ident" id="5665281">val</span><span class="op" id="5665284">.</span><span class="ident" id="5665285">IsValid</span><span class="op" id="5665292">(</span><span class="op" id="5665293">)</span>&nbsp;<span class="op" id="5665295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665299">return</span>&nbsp;<span class="ident" id="5665306">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665311">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665314">if</span>&nbsp;<span class="ident" id="5665317">finfo</span>&nbsp;<span class="op" id="5665323">!=</span>&nbsp;<span class="ident" id="5665326">nil</span>&nbsp;<span class="op" id="5665330">&amp;&amp;</span>&nbsp;<span class="ident" id="5665333">finfo</span><span class="op" id="5665338">.</span><span class="ident" id="5665339">flags</span><span class="op" id="5665344">&amp;</span><span class="ident" id="5665345">fOmitEmpty</span>&nbsp;<span class="op" id="5665356">!=</span>&nbsp;<span class="num" id="5665359">0</span>&nbsp;<span class="op" id="5665361">&amp;&amp;</span>&nbsp;<span class="ident" id="5665364">isEmptyValue</span><span class="op" id="5665376">(</span><span class="ident" id="5665377">val</span><span class="op" id="5665380">)</span>&nbsp;<span class="op" id="5665382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665386">return</span>&nbsp;<span class="ident" id="5665393">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665402">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665442">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665504">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665542">for</span>&nbsp;<span class="ident" id="5665546">val</span><span class="op" id="5665549">.</span><span class="ident" id="5665550">Kind</span><span class="op" id="5665554">(</span><span class="op" id="5665555">)</span>&nbsp;<span class="op" id="5665557">==</span>&nbsp;<span class="ident" id="5665560">reflect</span><span class="op" id="5665567">.</span><span class="ident" id="5665568">Interface</span>&nbsp;<span class="op" id="5665578">||</span>&nbsp;<span class="ident" id="5665581">val</span><span class="op" id="5665584">.</span><span class="ident" id="5665585">Kind</span><span class="op" id="5665589">(</span><span class="op" id="5665590">)</span>&nbsp;<span class="op" id="5665592">==</span>&nbsp;<span class="ident" id="5665595">reflect</span><span class="op" id="5665602">.</span><span class="ident" id="5665603">Ptr</span>&nbsp;<span class="op" id="5665607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665611">if</span>&nbsp;<span class="ident" id="5665614">val</span><span class="op" id="5665617">.</span><span class="ident" id="5665618">IsNil</span><span class="op" id="5665623">(</span><span class="op" id="5665624">)</span>&nbsp;<span class="op" id="5665626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665631">return</span>&nbsp;<span class="ident" id="5665638">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665648">val</span>&nbsp;<span class="op" id="5665652">=</span>&nbsp;<span class="ident" id="5665654">val</span><span class="op" id="5665657">.</span><span class="ident" id="5665658">Elem</span><span class="op" id="5665662">(</span><span class="op" id="5665663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665670">kind</span>&nbsp;<span class="op" id="5665675">:=</span>&nbsp;<span class="ident" id="5665678">val</span><span class="op" id="5665681">.</span><span class="ident" id="5665682">Kind</span><span class="op" id="5665686">(</span><span class="op" id="5665687">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665690">typ</span>&nbsp;<span class="op" id="5665694">:=</span>&nbsp;<span class="ident" id="5665697">val</span><span class="op" id="5665700">.</span><span class="ident" id="5665701">Type</span><span class="op" id="5665705">(</span><span class="op" id="5665706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665710">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665735">if</span>&nbsp;<span class="ident" id="5665738">val</span><span class="op" id="5665741">.</span><span class="ident" id="5665742">CanInterface</span><span class="op" id="5665754">(</span><span class="op" id="5665755">)</span>&nbsp;<span class="op" id="5665757">&amp;&amp;</span>&nbsp;<span class="ident" id="5665760">typ</span><span class="op" id="5665763">.</span><span class="ident" id="5665764">Implements</span><span class="op" id="5665774">(</span><span class="ident" id="5665775">marshalerType</span><span class="op" id="5665788">)</span>&nbsp;<span class="op" id="5665790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665794">return</span>&nbsp;<span class="ident" id="5665801">p</span><span class="op" id="5665802">.</span><span class="ident" id="5665803">marshalInterface</span><span class="op" id="5665819">(</span><span class="ident" id="5665820">val</span><span class="op" id="5665823">.</span><span class="ident" id="5665824">Interface</span><span class="op" id="5665833">(</span><span class="op" id="5665834">)</span><span class="op" id="5665835">.</span><span class="op" id="5665836">(</span><span class="ident" id="5665837">Marshaler</span><span class="op" id="5665846">)</span><span class="op" id="5665847">,</span>&nbsp;<span class="ident" id="5665849">defaultStart</span><span class="op" id="5665861">(</span><span class="ident" id="5665862">typ</span><span class="op" id="5665865">,</span>&nbsp;<span class="ident" id="5665867">finfo</span><span class="op" id="5665872">,</span>&nbsp;<span class="ident" id="5665874">startTemplate</span><span class="op" id="5665887">)</span><span class="op" id="5665888">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665894">if</span>&nbsp;<span class="ident" id="5665897">val</span><span class="op" id="5665900">.</span><span class="ident" id="5665901">CanAddr</span><span class="op" id="5665908">(</span><span class="op" id="5665909">)</span>&nbsp;<span class="op" id="5665911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665915">pv</span>&nbsp;<span class="op" id="5665918">:=</span>&nbsp;<span class="ident" id="5665921">val</span><span class="op" id="5665924">.</span><span class="ident" id="5665925">Addr</span><span class="op" id="5665929">(</span><span class="op" id="5665930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665934">if</span>&nbsp;<span class="ident" id="5665937">pv</span><span class="op" id="5665939">.</span><span class="ident" id="5665940">CanInterface</span><span class="op" id="5665952">(</span><span class="op" id="5665953">)</span>&nbsp;<span class="op" id="5665955">&amp;&amp;</span>&nbsp;<span class="ident" id="5665958">pv</span><span class="op" id="5665960">.</span><span class="ident" id="5665961">Type</span><span class="op" id="5665965">(</span><span class="op" id="5665966">)</span><span class="op" id="5665967">.</span><span class="ident" id="5665968">Implements</span><span class="op" id="5665978">(</span><span class="ident" id="5665979">marshalerType</span><span class="op" id="5665992">)</span>&nbsp;<span class="op" id="5665994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665999">return</span>&nbsp;<span class="ident" id="5666006">p</span><span class="op" id="5666007">.</span><span class="ident" id="5666008">marshalInterface</span><span class="op" id="5666024">(</span><span class="ident" id="5666025">pv</span><span class="op" id="5666027">.</span><span class="ident" id="5666028">Interface</span><span class="op" id="5666037">(</span><span class="op" id="5666038">)</span><span class="op" id="5666039">.</span><span class="op" id="5666040">(</span><span class="ident" id="5666041">Marshaler</span><span class="op" id="5666050">)</span><span class="op" id="5666051">,</span>&nbsp;<span class="ident" id="5666053">defaultStart</span><span class="op" id="5666065">(</span><span class="ident" id="5666066">pv</span><span class="op" id="5666068">.</span><span class="ident" id="5666069">Type</span><span class="op" id="5666073">(</span><span class="op" id="5666074">)</span><span class="op" id="5666075">,</span>&nbsp;<span class="ident" id="5666077">finfo</span><span class="op" id="5666082">,</span>&nbsp;<span class="ident" id="5666084">startTemplate</span><span class="op" id="5666097">)</span><span class="op" id="5666098">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666109">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666139">if</span>&nbsp;<span class="ident" id="5666142">val</span><span class="op" id="5666145">.</span><span class="ident" id="5666146">CanInterface</span><span class="op" id="5666158">(</span><span class="op" id="5666159">)</span>&nbsp;<span class="op" id="5666161">&amp;&amp;</span>&nbsp;<span class="ident" id="5666164">typ</span><span class="op" id="5666167">.</span><span class="ident" id="5666168">Implements</span><span class="op" id="5666178">(</span><span class="ident" id="5666179">textMarshalerType</span><span class="op" id="5666196">)</span>&nbsp;<span class="op" id="5666198">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666202">return</span>&nbsp;<span class="ident" id="5666209">p</span><span class="op" id="5666210">.</span><span class="ident" id="5666211">marshalTextInterface</span><span class="op" id="5666231">(</span><span class="ident" id="5666232">val</span><span class="op" id="5666235">.</span><span class="ident" id="5666236">Interface</span><span class="op" id="5666245">(</span><span class="op" id="5666246">)</span><span class="op" id="5666247">.</span><span class="op" id="5666248">(</span><span class="ident" id="5666249">encoding</span><span class="op" id="5666257">.</span><span class="ident" id="5666258">TextMarshaler</span><span class="op" id="5666271">)</span><span class="op" id="5666272">,</span>&nbsp;<span class="ident" id="5666274">defaultStart</span><span class="op" id="5666286">(</span><span class="ident" id="5666287">typ</span><span class="op" id="5666290">,</span>&nbsp;<span class="ident" id="5666292">finfo</span><span class="op" id="5666297">,</span>&nbsp;<span class="ident" id="5666299">startTemplate</span><span class="op" id="5666312">)</span><span class="op" id="5666313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666319">if</span>&nbsp;<span class="ident" id="5666322">val</span><span class="op" id="5666325">.</span><span class="ident" id="5666326">CanAddr</span><span class="op" id="5666333">(</span><span class="op" id="5666334">)</span>&nbsp;<span class="op" id="5666336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666340">pv</span>&nbsp;<span class="op" id="5666343">:=</span>&nbsp;<span class="ident" id="5666346">val</span><span class="op" id="5666349">.</span><span class="ident" id="5666350">Addr</span><span class="op" id="5666354">(</span><span class="op" id="5666355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666359">if</span>&nbsp;<span class="ident" id="5666362">pv</span><span class="op" id="5666364">.</span><span class="ident" id="5666365">CanInterface</span><span class="op" id="5666377">(</span><span class="op" id="5666378">)</span>&nbsp;<span class="op" id="5666380">&amp;&amp;</span>&nbsp;<span class="ident" id="5666383">pv</span><span class="op" id="5666385">.</span><span class="ident" id="5666386">Type</span><span class="op" id="5666390">(</span><span class="op" id="5666391">)</span><span class="op" id="5666392">.</span><span class="ident" id="5666393">Implements</span><span class="op" id="5666403">(</span><span class="ident" id="5666404">textMarshalerType</span><span class="op" id="5666421">)</span>&nbsp;<span class="op" id="5666423">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666428">return</span>&nbsp;<span class="ident" id="5666435">p</span><span class="op" id="5666436">.</span><span class="ident" id="5666437">marshalTextInterface</span><span class="op" id="5666457">(</span><span class="ident" id="5666458">pv</span><span class="op" id="5666460">.</span><span class="ident" id="5666461">Interface</span><span class="op" id="5666470">(</span><span class="op" id="5666471">)</span><span class="op" id="5666472">.</span><span class="op" id="5666473">(</span><span class="ident" id="5666474">encoding</span><span class="op" id="5666482">.</span><span class="ident" id="5666483">TextMarshaler</span><span class="op" id="5666496">)</span><span class="op" id="5666497">,</span>&nbsp;<span class="ident" id="5666499">defaultStart</span><span class="op" id="5666511">(</span><span class="ident" id="5666512">pv</span><span class="op" id="5666514">.</span><span class="ident" id="5666515">Type</span><span class="op" id="5666519">(</span><span class="op" id="5666520">)</span><span class="op" id="5666521">,</span>&nbsp;<span class="ident" id="5666523">finfo</span><span class="op" id="5666528">,</span>&nbsp;<span class="ident" id="5666530">startTemplate</span><span class="op" id="5666543">)</span><span class="op" id="5666544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666555">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666639">if</span>&nbsp;<span class="op" id="5666642">(</span><span class="ident" id="5666643">kind</span>&nbsp;<span class="op" id="5666648">==</span>&nbsp;<span class="ident" id="5666651">reflect</span><span class="op" id="5666658">.</span><span class="ident" id="5666659">Slice</span>&nbsp;<span class="op" id="5666665">||</span>&nbsp;<span class="ident" id="5666668">kind</span>&nbsp;<span class="op" id="5666673">==</span>&nbsp;<span class="ident" id="5666676">reflect</span><span class="op" id="5666683">.</span><span class="ident" id="5666684">Array</span><span class="op" id="5666689">)</span>&nbsp;<span class="op" id="5666691">&amp;&amp;</span>&nbsp;<span class="ident" id="5666694">typ</span><span class="op" id="5666697">.</span><span class="ident" id="5666698">Elem</span><span class="op" id="5666702">(</span><span class="op" id="5666703">)</span><span class="op" id="5666704">.</span><span class="ident" id="5666705">Kind</span><span class="op" id="5666709">(</span><span class="op" id="5666710">)</span>&nbsp;<span class="op" id="5666712">!=</span>&nbsp;<span class="ident" id="5666715">reflect</span><span class="op" id="5666722">.</span><span class="ident" id="5666723">Uint8</span>&nbsp;<span class="op" id="5666729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666733">for</span>&nbsp;<span class="ident" id="5666737">i</span><span class="op" id="5666738">,</span>&nbsp;<span class="ident" id="5666740">n</span>&nbsp;<span class="op" id="5666742">:=</span>&nbsp;<span class="num" id="5666745">0</span><span class="op" id="5666746">,</span>&nbsp;<span class="ident" id="5666748">val</span><span class="op" id="5666751">.</span><span class="ident" id="5666752">Len</span><span class="op" id="5666755">(</span><span class="op" id="5666756">)</span><span class="op" id="5666757">;</span>&nbsp;<span class="ident" id="5666759">i</span>&nbsp;<span class="op" id="5666761">&lt;</span>&nbsp;<span class="ident" id="5666763">n</span><span class="op" id="5666764">;</span>&nbsp;<span class="ident" id="5666766">i</span><span class="op" id="5666767">++</span>&nbsp;<span class="op" id="5666770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666775">if</span>&nbsp;<span class="ident" id="5666778">err</span>&nbsp;<span class="op" id="5666782">:=</span>&nbsp;<span class="ident" id="5666785">p</span><span class="op" id="5666786">.</span><span class="ident" id="5666787">marshalValue</span><span class="op" id="5666799">(</span><span class="ident" id="5666800">val</span><span class="op" id="5666803">.</span><span class="ident" id="5666804">Index</span><span class="op" id="5666809">(</span><span class="ident" id="5666810">i</span><span class="op" id="5666811">)</span><span class="op" id="5666812">,</span>&nbsp;<span class="ident" id="5666814">finfo</span><span class="op" id="5666819">,</span>&nbsp;<span class="ident" id="5666821">startTemplate</span><span class="op" id="5666834">)</span><span class="op" id="5666835">;</span>&nbsp;<span class="ident" id="5666837">err</span>&nbsp;<span class="op" id="5666841">!=</span>&nbsp;<span class="ident" id="5666844">nil</span>&nbsp;<span class="op" id="5666848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666854">return</span>&nbsp;<span class="ident" id="5666861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666868">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666876">return</span>&nbsp;<span class="ident" id="5666883">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666892">tinfo</span><span class="op" id="5666897">,</span>&nbsp;<span class="ident" id="5666899">err</span>&nbsp;<span class="op" id="5666903">:=</span>&nbsp;<span class="ident" id="5666906">getTypeInfo</span><span class="op" id="5666917">(</span><span class="ident" id="5666918">typ</span><span class="op" id="5666921">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666924">if</span>&nbsp;<span class="ident" id="5666927">err</span>&nbsp;<span class="op" id="5666931">!=</span>&nbsp;<span class="ident" id="5666934">nil</span>&nbsp;<span class="op" id="5666938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666942">return</span>&nbsp;<span class="ident" id="5666949">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666958">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666984">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667028">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667049">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667092">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667139">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667156">var</span>&nbsp;<span class="ident" id="5667160">start</span>&nbsp;<span class="ident" id="5667166">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667181">if</span>&nbsp;<span class="ident" id="5667184">startTemplate</span>&nbsp;<span class="op" id="5667198">!=</span>&nbsp;<span class="ident" id="5667201">nil</span>&nbsp;<span class="op" id="5667205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667209">start</span><span class="op" id="5667214">.</span><span class="ident" id="5667215">Name</span>&nbsp;<span class="op" id="5667220">=</span>&nbsp;<span class="ident" id="5667222">startTemplate</span><span class="op" id="5667235">.</span><span class="ident" id="5667236">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667243">start</span><span class="op" id="5667248">.</span><span class="ident" id="5667249">Attr</span>&nbsp;<span class="op" id="5667254">=</span>&nbsp;<span class="builtinfunc" id="5667256">append</span><span class="op" id="5667262">(</span><span class="ident" id="5667263">start</span><span class="op" id="5667268">.</span><span class="ident" id="5667269">Attr</span><span class="op" id="5667273">,</span>&nbsp;<span class="ident" id="5667275">startTemplate</span><span class="op" id="5667288">.</span><span class="ident" id="5667289">Attr</span><span class="op" id="5667293">...</span><span class="op" id="5667296">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667299">}</span>&nbsp;<span class="keyword" id="5667301">else</span>&nbsp;<span class="keyword" id="5667306">if</span>&nbsp;<span class="ident" id="5667309">tinfo</span><span class="op" id="5667314">.</span><span class="ident" id="5667315">xmlname</span>&nbsp;<span class="op" id="5667323">!=</span>&nbsp;<span class="ident" id="5667326">nil</span>&nbsp;<span class="op" id="5667330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667334">xmlname</span>&nbsp;<span class="op" id="5667342">:=</span>&nbsp;<span class="ident" id="5667345">tinfo</span><span class="op" id="5667350">.</span><span class="ident" id="5667351">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667361">if</span>&nbsp;<span class="ident" id="5667364">xmlname</span><span class="op" id="5667371">.</span><span class="ident" id="5667372">name</span>&nbsp;<span class="op" id="5667377">!=</span>&nbsp;<span class="string" id="5667380">&#34;&#34;</span>&nbsp;<span class="op" id="5667383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667388">start</span><span class="op" id="5667393">.</span><span class="ident" id="5667394">Name</span><span class="op" id="5667398">.</span><span class="ident" id="5667399">Space</span><span class="op" id="5667404">,</span>&nbsp;<span class="ident" id="5667406">start</span><span class="op" id="5667411">.</span><span class="ident" id="5667412">Name</span><span class="op" id="5667416">.</span><span class="ident" id="5667417">Local</span>&nbsp;<span class="op" id="5667423">=</span>&nbsp;<span class="ident" id="5667425">xmlname</span><span class="op" id="5667432">.</span><span class="ident" id="5667433">xmlns</span><span class="op" id="5667438">,</span>&nbsp;<span class="ident" id="5667440">xmlname</span><span class="op" id="5667447">.</span><span class="ident" id="5667448">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667455">}</span>&nbsp;<span class="keyword" id="5667457">else</span>&nbsp;<span class="keyword" id="5667462">if</span>&nbsp;<span class="ident" id="5667465">v</span><span class="op" id="5667466">,</span>&nbsp;<span class="ident" id="5667468">ok</span>&nbsp;<span class="op" id="5667471">:=</span>&nbsp;<span class="ident" id="5667474">xmlname</span><span class="op" id="5667481">.</span><span class="ident" id="5667482">value</span><span class="op" id="5667487">(</span><span class="ident" id="5667488">val</span><span class="op" id="5667491">)</span><span class="op" id="5667492">.</span><span class="ident" id="5667493">Interface</span><span class="op" id="5667502">(</span><span class="op" id="5667503">)</span><span class="op" id="5667504">.</span><span class="op" id="5667505">(</span><span class="ident" id="5667506">Name</span><span class="op" id="5667510">)</span><span class="op" id="5667511">;</span>&nbsp;<span class="ident" id="5667513">ok</span>&nbsp;<span class="op" id="5667516">&amp;&amp;</span>&nbsp;<span class="ident" id="5667519">v</span><span class="op" id="5667520">.</span><span class="ident" id="5667521">Local</span>&nbsp;<span class="op" id="5667527">!=</span>&nbsp;<span class="string" id="5667530">&#34;&#34;</span>&nbsp;<span class="op" id="5667533">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667538">start</span><span class="op" id="5667543">.</span><span class="ident" id="5667544">Name</span>&nbsp;<span class="op" id="5667549">=</span>&nbsp;<span class="ident" id="5667551">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667561">if</span>&nbsp;<span class="ident" id="5667564">start</span><span class="op" id="5667569">.</span><span class="ident" id="5667570">Name</span><span class="op" id="5667574">.</span><span class="ident" id="5667575">Local</span>&nbsp;<span class="op" id="5667581">==</span>&nbsp;<span class="string" id="5667584">&#34;&#34;</span>&nbsp;<span class="op" id="5667587">&amp;&amp;</span>&nbsp;<span class="ident" id="5667590">finfo</span>&nbsp;<span class="op" id="5667596">!=</span>&nbsp;<span class="ident" id="5667599">nil</span>&nbsp;<span class="op" id="5667603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667607">start</span><span class="op" id="5667612">.</span><span class="ident" id="5667613">Name</span><span class="op" id="5667617">.</span><span class="ident" id="5667618">Space</span><span class="op" id="5667623">,</span>&nbsp;<span class="ident" id="5667625">start</span><span class="op" id="5667630">.</span><span class="ident" id="5667631">Name</span><span class="op" id="5667635">.</span><span class="ident" id="5667636">Local</span>&nbsp;<span class="op" id="5667642">=</span>&nbsp;<span class="ident" id="5667644">finfo</span><span class="op" id="5667649">.</span><span class="ident" id="5667650">xmlns</span><span class="op" id="5667655">,</span>&nbsp;<span class="ident" id="5667657">finfo</span><span class="op" id="5667662">.</span><span class="ident" id="5667663">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667672">if</span>&nbsp;<span class="ident" id="5667675">start</span><span class="op" id="5667680">.</span><span class="ident" id="5667681">Name</span><span class="op" id="5667685">.</span><span class="ident" id="5667686">Local</span>&nbsp;<span class="op" id="5667692">==</span>&nbsp;<span class="string" id="5667695">&#34;&#34;</span>&nbsp;<span class="op" id="5667698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667702">name</span>&nbsp;<span class="op" id="5667707">:=</span>&nbsp;<span class="ident" id="5667710">typ</span><span class="op" id="5667713">.</span><span class="ident" id="5667714">Name</span><span class="op" id="5667718">(</span><span class="op" id="5667719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667723">if</span>&nbsp;<span class="ident" id="5667726">name</span>&nbsp;<span class="op" id="5667731">==</span>&nbsp;<span class="string" id="5667734">&#34;&#34;</span>&nbsp;<span class="op" id="5667737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667742">return</span>&nbsp;<span class="op" id="5667749">&amp;</span><span class="ident" id="5667750">UnsupportedTypeError</span><span class="op" id="5667770">{</span><span class="ident" id="5667771">typ</span><span class="op" id="5667774">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667782">start</span><span class="op" id="5667787">.</span><span class="ident" id="5667788">Name</span><span class="op" id="5667792">.</span><span class="ident" id="5667793">Local</span>&nbsp;<span class="op" id="5667799">=</span>&nbsp;<span class="ident" id="5667801">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667811">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667826">for</span>&nbsp;<span class="ident" id="5667830">i</span>&nbsp;<span class="op" id="5667832">:=</span>&nbsp;<span class="keyword" id="5667835">range</span>&nbsp;<span class="ident" id="5667841">tinfo</span><span class="op" id="5667846">.</span><span class="ident" id="5667847">fields</span>&nbsp;<span class="op" id="5667854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667858">finfo</span>&nbsp;<span class="op" id="5667864">:=</span>&nbsp;<span class="op" id="5667867">&amp;</span><span class="ident" id="5667868">tinfo</span><span class="op" id="5667873">.</span><span class="ident" id="5667874">fields</span><span class="op" id="5667880">[</span><span class="ident" id="5667881">i</span><span class="op" id="5667882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667886">if</span>&nbsp;<span class="ident" id="5667889">finfo</span><span class="op" id="5667894">.</span><span class="ident" id="5667895">flags</span><span class="op" id="5667900">&amp;</span><span class="ident" id="5667901">fAttr</span>&nbsp;<span class="op" id="5667907">==</span>&nbsp;<span class="num" id="5667910">0</span>&nbsp;<span class="op" id="5667912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667917">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667928">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667932">fv</span>&nbsp;<span class="op" id="5667935">:=</span>&nbsp;<span class="ident" id="5667938">finfo</span><span class="op" id="5667943">.</span><span class="ident" id="5667944">value</span><span class="op" id="5667949">(</span><span class="ident" id="5667950">val</span><span class="op" id="5667953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667957">name</span>&nbsp;<span class="op" id="5667962">:=</span>&nbsp;<span class="ident" id="5667965">Name</span><span class="op" id="5667969">{</span><span class="ident" id="5667970">Space</span><span class="op" id="5667975">:</span>&nbsp;<span class="ident" id="5667977">finfo</span><span class="op" id="5667982">.</span><span class="ident" id="5667983">xmlns</span><span class="op" id="5667988">,</span>&nbsp;<span class="ident" id="5667990">Local</span><span class="op" id="5667995">:</span>&nbsp;<span class="ident" id="5667997">finfo</span><span class="op" id="5668002">.</span><span class="ident" id="5668003">name</span><span class="op" id="5668007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668012">if</span>&nbsp;<span class="ident" id="5668015">finfo</span><span class="op" id="5668020">.</span><span class="ident" id="5668021">flags</span><span class="op" id="5668026">&amp;</span><span class="ident" id="5668027">fOmitEmpty</span>&nbsp;<span class="op" id="5668038">!=</span>&nbsp;<span class="num" id="5668041">0</span>&nbsp;<span class="op" id="5668043">&amp;&amp;</span>&nbsp;<span class="ident" id="5668046">isEmptyValue</span><span class="op" id="5668058">(</span><span class="ident" id="5668059">fv</span><span class="op" id="5668061">)</span>&nbsp;<span class="op" id="5668063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668068">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668084">if</span>&nbsp;<span class="ident" id="5668087">fv</span><span class="op" id="5668089">.</span><span class="ident" id="5668090">Kind</span><span class="op" id="5668094">(</span><span class="op" id="5668095">)</span>&nbsp;<span class="op" id="5668097">==</span>&nbsp;<span class="ident" id="5668100">reflect</span><span class="op" id="5668107">.</span><span class="ident" id="5668108">Interface</span>&nbsp;<span class="op" id="5668118">&amp;&amp;</span>&nbsp;<span class="ident" id="5668121">fv</span><span class="op" id="5668123">.</span><span class="ident" id="5668124">IsNil</span><span class="op" id="5668129">(</span><span class="op" id="5668130">)</span>&nbsp;<span class="op" id="5668132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668137">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668148">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668153">if</span>&nbsp;<span class="ident" id="5668156">fv</span><span class="op" id="5668158">.</span><span class="ident" id="5668159">CanInterface</span><span class="op" id="5668171">(</span><span class="op" id="5668172">)</span>&nbsp;<span class="op" id="5668174">&amp;&amp;</span>&nbsp;<span class="ident" id="5668177">fv</span><span class="op" id="5668179">.</span><span class="ident" id="5668180">Type</span><span class="op" id="5668184">(</span><span class="op" id="5668185">)</span><span class="op" id="5668186">.</span><span class="ident" id="5668187">Implements</span><span class="op" id="5668197">(</span><span class="ident" id="5668198">marshalerAttrType</span><span class="op" id="5668215">)</span>&nbsp;<span class="op" id="5668217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668222">attr</span><span class="op" id="5668226">,</span>&nbsp;<span class="ident" id="5668228">err</span>&nbsp;<span class="op" id="5668232">:=</span>&nbsp;<span class="ident" id="5668235">fv</span><span class="op" id="5668237">.</span><span class="ident" id="5668238">Interface</span><span class="op" id="5668247">(</span><span class="op" id="5668248">)</span><span class="op" id="5668249">.</span><span class="op" id="5668250">(</span><span class="ident" id="5668251">MarshalerAttr</span><span class="op" id="5668264">)</span><span class="op" id="5668265">.</span><span class="ident" id="5668266">MarshalXMLAttr</span><span class="op" id="5668280">(</span><span class="ident" id="5668281">name</span><span class="op" id="5668285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668290">if</span>&nbsp;<span class="ident" id="5668293">err</span>&nbsp;<span class="op" id="5668297">!=</span>&nbsp;<span class="ident" id="5668300">nil</span>&nbsp;<span class="op" id="5668304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668310">return</span>&nbsp;<span class="ident" id="5668317">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668329">if</span>&nbsp;<span class="ident" id="5668332">attr</span><span class="op" id="5668336">.</span><span class="ident" id="5668337">Name</span><span class="op" id="5668341">.</span><span class="ident" id="5668342">Local</span>&nbsp;<span class="op" id="5668348">!=</span>&nbsp;<span class="string" id="5668351">&#34;&#34;</span>&nbsp;<span class="op" id="5668354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668360">start</span><span class="op" id="5668365">.</span><span class="ident" id="5668366">Attr</span>&nbsp;<span class="op" id="5668371">=</span>&nbsp;<span class="builtinfunc" id="5668373">append</span><span class="op" id="5668379">(</span><span class="ident" id="5668380">start</span><span class="op" id="5668385">.</span><span class="ident" id="5668386">Attr</span><span class="op" id="5668390">,</span>&nbsp;<span class="ident" id="5668392">attr</span><span class="op" id="5668396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668406">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668422">if</span>&nbsp;<span class="ident" id="5668425">fv</span><span class="op" id="5668427">.</span><span class="ident" id="5668428">CanAddr</span><span class="op" id="5668435">(</span><span class="op" id="5668436">)</span>&nbsp;<span class="op" id="5668438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668443">pv</span>&nbsp;<span class="op" id="5668446">:=</span>&nbsp;<span class="ident" id="5668449">fv</span><span class="op" id="5668451">.</span><span class="ident" id="5668452">Addr</span><span class="op" id="5668456">(</span><span class="op" id="5668457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668462">if</span>&nbsp;<span class="ident" id="5668465">pv</span><span class="op" id="5668467">.</span><span class="ident" id="5668468">CanInterface</span><span class="op" id="5668480">(</span><span class="op" id="5668481">)</span>&nbsp;<span class="op" id="5668483">&amp;&amp;</span>&nbsp;<span class="ident" id="5668486">pv</span><span class="op" id="5668488">.</span><span class="ident" id="5668489">Type</span><span class="op" id="5668493">(</span><span class="op" id="5668494">)</span><span class="op" id="5668495">.</span><span class="ident" id="5668496">Implements</span><span class="op" id="5668506">(</span><span class="ident" id="5668507">marshalerAttrType</span><span class="op" id="5668524">)</span>&nbsp;<span class="op" id="5668526">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668532">attr</span><span class="op" id="5668536">,</span>&nbsp;<span class="ident" id="5668538">err</span>&nbsp;<span class="op" id="5668542">:=</span>&nbsp;<span class="ident" id="5668545">pv</span><span class="op" id="5668547">.</span><span class="ident" id="5668548">Interface</span><span class="op" id="5668557">(</span><span class="op" id="5668558">)</span><span class="op" id="5668559">.</span><span class="op" id="5668560">(</span><span class="ident" id="5668561">MarshalerAttr</span><span class="op" id="5668574">)</span><span class="op" id="5668575">.</span><span class="ident" id="5668576">MarshalXMLAttr</span><span class="op" id="5668590">(</span><span class="ident" id="5668591">name</span><span class="op" id="5668595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668601">if</span>&nbsp;<span class="ident" id="5668604">err</span>&nbsp;<span class="op" id="5668608">!=</span>&nbsp;<span class="ident" id="5668611">nil</span>&nbsp;<span class="op" id="5668615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668622">return</span>&nbsp;<span class="ident" id="5668629">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668643">if</span>&nbsp;<span class="ident" id="5668646">attr</span><span class="op" id="5668650">.</span><span class="ident" id="5668651">Name</span><span class="op" id="5668655">.</span><span class="ident" id="5668656">Local</span>&nbsp;<span class="op" id="5668662">!=</span>&nbsp;<span class="string" id="5668665">&#34;&#34;</span>&nbsp;<span class="op" id="5668668">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668675">start</span><span class="op" id="5668680">.</span><span class="ident" id="5668681">Attr</span>&nbsp;<span class="op" id="5668686">=</span>&nbsp;<span class="builtinfunc" id="5668688">append</span><span class="op" id="5668694">(</span><span class="ident" id="5668695">start</span><span class="op" id="5668700">.</span><span class="ident" id="5668701">Attr</span><span class="op" id="5668705">,</span>&nbsp;<span class="ident" id="5668707">attr</span><span class="op" id="5668711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668723">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668739">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668744">if</span>&nbsp;<span class="ident" id="5668747">fv</span><span class="op" id="5668749">.</span><span class="ident" id="5668750">CanInterface</span><span class="op" id="5668762">(</span><span class="op" id="5668763">)</span>&nbsp;<span class="op" id="5668765">&amp;&amp;</span>&nbsp;<span class="ident" id="5668768">fv</span><span class="op" id="5668770">.</span><span class="ident" id="5668771">Type</span><span class="op" id="5668775">(</span><span class="op" id="5668776">)</span><span class="op" id="5668777">.</span><span class="ident" id="5668778">Implements</span><span class="op" id="5668788">(</span><span class="ident" id="5668789">textMarshalerType</span><span class="op" id="5668806">)</span>&nbsp;<span class="op" id="5668808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668813">text</span><span class="op" id="5668817">,</span>&nbsp;<span class="ident" id="5668819">err</span>&nbsp;<span class="op" id="5668823">:=</span>&nbsp;<span class="ident" id="5668826">fv</span><span class="op" id="5668828">.</span><span class="ident" id="5668829">Interface</span><span class="op" id="5668838">(</span><span class="op" id="5668839">)</span><span class="op" id="5668840">.</span><span class="op" id="5668841">(</span><span class="ident" id="5668842">encoding</span><span class="op" id="5668850">.</span><span class="ident" id="5668851">TextMarshaler</span><span class="op" id="5668864">)</span><span class="op" id="5668865">.</span><span class="ident" id="5668866">MarshalText</span><span class="op" id="5668877">(</span><span class="op" id="5668878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668883">if</span>&nbsp;<span class="ident" id="5668886">err</span>&nbsp;<span class="op" id="5668890">!=</span>&nbsp;<span class="ident" id="5668893">nil</span>&nbsp;<span class="op" id="5668897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668903">return</span>&nbsp;<span class="ident" id="5668910">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668922">start</span><span class="op" id="5668927">.</span><span class="ident" id="5668928">Attr</span>&nbsp;<span class="op" id="5668933">=</span>&nbsp;<span class="builtinfunc" id="5668935">append</span><span class="op" id="5668941">(</span><span class="ident" id="5668942">start</span><span class="op" id="5668947">.</span><span class="ident" id="5668948">Attr</span><span class="op" id="5668952">,</span>&nbsp;<span class="ident" id="5668954">Attr</span><span class="op" id="5668958">{</span><span class="ident" id="5668959">name</span><span class="op" id="5668963">,</span>&nbsp;<span class="builtintype" id="5668965">string</span><span class="op" id="5668971">(</span><span class="ident" id="5668972">text</span><span class="op" id="5668976">)</span><span class="op" id="5668977">}</span><span class="op" id="5668978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668983">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668999">if</span>&nbsp;<span class="ident" id="5669002">fv</span><span class="op" id="5669004">.</span><span class="ident" id="5669005">CanAddr</span><span class="op" id="5669012">(</span><span class="op" id="5669013">)</span>&nbsp;<span class="op" id="5669015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669020">pv</span>&nbsp;<span class="op" id="5669023">:=</span>&nbsp;<span class="ident" id="5669026">fv</span><span class="op" id="5669028">.</span><span class="ident" id="5669029">Addr</span><span class="op" id="5669033">(</span><span class="op" id="5669034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669039">if</span>&nbsp;<span class="ident" id="5669042">pv</span><span class="op" id="5669044">.</span><span class="ident" id="5669045">CanInterface</span><span class="op" id="5669057">(</span><span class="op" id="5669058">)</span>&nbsp;<span class="op" id="5669060">&amp;&amp;</span>&nbsp;<span class="ident" id="5669063">pv</span><span class="op" id="5669065">.</span><span class="ident" id="5669066">Type</span><span class="op" id="5669070">(</span><span class="op" id="5669071">)</span><span class="op" id="5669072">.</span><span class="ident" id="5669073">Implements</span><span class="op" id="5669083">(</span><span class="ident" id="5669084">textMarshalerType</span><span class="op" id="5669101">)</span>&nbsp;<span class="op" id="5669103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669109">text</span><span class="op" id="5669113">,</span>&nbsp;<span class="ident" id="5669115">err</span>&nbsp;<span class="op" id="5669119">:=</span>&nbsp;<span class="ident" id="5669122">pv</span><span class="op" id="5669124">.</span><span class="ident" id="5669125">Interface</span><span class="op" id="5669134">(</span><span class="op" id="5669135">)</span><span class="op" id="5669136">.</span><span class="op" id="5669137">(</span><span class="ident" id="5669138">encoding</span><span class="op" id="5669146">.</span><span class="ident" id="5669147">TextMarshaler</span><span class="op" id="5669160">)</span><span class="op" id="5669161">.</span><span class="ident" id="5669162">MarshalText</span><span class="op" id="5669173">(</span><span class="op" id="5669174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669180">if</span>&nbsp;<span class="ident" id="5669183">err</span>&nbsp;<span class="op" id="5669187">!=</span>&nbsp;<span class="ident" id="5669190">nil</span>&nbsp;<span class="op" id="5669194">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669201">return</span>&nbsp;<span class="ident" id="5669208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669222">start</span><span class="op" id="5669227">.</span><span class="ident" id="5669228">Attr</span>&nbsp;<span class="op" id="5669233">=</span>&nbsp;<span class="builtinfunc" id="5669235">append</span><span class="op" id="5669241">(</span><span class="ident" id="5669242">start</span><span class="op" id="5669247">.</span><span class="ident" id="5669248">Attr</span><span class="op" id="5669252">,</span>&nbsp;<span class="ident" id="5669254">Attr</span><span class="op" id="5669258">{</span><span class="ident" id="5669259">name</span><span class="op" id="5669263">,</span>&nbsp;<span class="builtintype" id="5669265">string</span><span class="op" id="5669271">(</span><span class="ident" id="5669272">text</span><span class="op" id="5669276">)</span><span class="op" id="5669277">}</span><span class="op" id="5669278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669284">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669296">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669305">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669361">switch</span>&nbsp;<span class="ident" id="5669368">fv</span><span class="op" id="5669370">.</span><span class="ident" id="5669371">Kind</span><span class="op" id="5669375">(</span><span class="op" id="5669376">)</span>&nbsp;<span class="op" id="5669378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669382">case</span>&nbsp;<span class="ident" id="5669387">reflect</span><span class="op" id="5669394">.</span><span class="ident" id="5669395">Ptr</span><span class="op" id="5669398">,</span>&nbsp;<span class="ident" id="5669400">reflect</span><span class="op" id="5669407">.</span><span class="ident" id="5669408">Interface</span><span class="op" id="5669417">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669422">if</span>&nbsp;<span class="ident" id="5669425">fv</span><span class="op" id="5669427">.</span><span class="ident" id="5669428">IsNil</span><span class="op" id="5669433">(</span><span class="op" id="5669434">)</span>&nbsp;<span class="op" id="5669436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669442">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669459">fv</span>&nbsp;<span class="op" id="5669462">=</span>&nbsp;<span class="ident" id="5669464">fv</span><span class="op" id="5669466">.</span><span class="ident" id="5669467">Elem</span><span class="op" id="5669471">(</span><span class="op" id="5669472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669476">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669481">s</span><span class="op" id="5669482">,</span>&nbsp;<span class="ident" id="5669484">b</span><span class="op" id="5669485">,</span>&nbsp;<span class="ident" id="5669487">err</span>&nbsp;<span class="op" id="5669491">:=</span>&nbsp;<span class="ident" id="5669494">p</span><span class="op" id="5669495">.</span><span class="ident" id="5669496">marshalSimple</span><span class="op" id="5669509">(</span><span class="ident" id="5669510">fv</span><span class="op" id="5669512">.</span><span class="ident" id="5669513">Type</span><span class="op" id="5669517">(</span><span class="op" id="5669518">)</span><span class="op" id="5669519">,</span>&nbsp;<span class="ident" id="5669521">fv</span><span class="op" id="5669523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669527">if</span>&nbsp;<span class="ident" id="5669530">err</span>&nbsp;<span class="op" id="5669534">!=</span>&nbsp;<span class="ident" id="5669537">nil</span>&nbsp;<span class="op" id="5669541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669546">return</span>&nbsp;<span class="ident" id="5669553">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669559">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669563">if</span>&nbsp;<span class="ident" id="5669566">b</span>&nbsp;<span class="op" id="5669568">!=</span>&nbsp;<span class="ident" id="5669571">nil</span>&nbsp;<span class="op" id="5669575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669580">s</span>&nbsp;<span class="op" id="5669582">=</span>&nbsp;<span class="builtintype" id="5669584">string</span><span class="op" id="5669590">(</span><span class="ident" id="5669591">b</span><span class="op" id="5669592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669600">start</span><span class="op" id="5669605">.</span><span class="ident" id="5669606">Attr</span>&nbsp;<span class="op" id="5669611">=</span>&nbsp;<span class="builtinfunc" id="5669613">append</span><span class="op" id="5669619">(</span><span class="ident" id="5669620">start</span><span class="op" id="5669625">.</span><span class="ident" id="5669626">Attr</span><span class="op" id="5669630">,</span>&nbsp;<span class="ident" id="5669632">Attr</span><span class="op" id="5669636">{</span><span class="ident" id="5669637">name</span><span class="op" id="5669641">,</span>&nbsp;<span class="ident" id="5669643">s</span><span class="op" id="5669644">}</span><span class="op" id="5669645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669648">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669652">if</span>&nbsp;<span class="ident" id="5669655">err</span>&nbsp;<span class="op" id="5669659">:=</span>&nbsp;<span class="ident" id="5669662">p</span><span class="op" id="5669663">.</span><span class="ident" id="5669664">writeStart</span><span class="op" id="5669674">(</span><span class="op" id="5669675">&amp;</span><span class="ident" id="5669676">start</span><span class="op" id="5669681">)</span><span class="op" id="5669682">;</span>&nbsp;<span class="ident" id="5669684">err</span>&nbsp;<span class="op" id="5669688">!=</span>&nbsp;<span class="ident" id="5669691">nil</span>&nbsp;<span class="op" id="5669695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669699">return</span>&nbsp;<span class="ident" id="5669706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669715">if</span>&nbsp;<span class="ident" id="5669718">val</span><span class="op" id="5669721">.</span><span class="ident" id="5669722">Kind</span><span class="op" id="5669726">(</span><span class="op" id="5669727">)</span>&nbsp;<span class="op" id="5669729">==</span>&nbsp;<span class="ident" id="5669732">reflect</span><span class="op" id="5669739">.</span><span class="ident" id="5669740">Struct</span>&nbsp;<span class="op" id="5669747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669751">err</span>&nbsp;<span class="op" id="5669755">=</span>&nbsp;<span class="ident" id="5669757">p</span><span class="op" id="5669758">.</span><span class="ident" id="5669759">marshalStruct</span><span class="op" id="5669772">(</span><span class="ident" id="5669773">tinfo</span><span class="op" id="5669778">,</span>&nbsp;<span class="ident" id="5669780">val</span><span class="op" id="5669783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669786">}</span>&nbsp;<span class="keyword" id="5669788">else</span>&nbsp;<span class="op" id="5669793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669797">s</span><span class="op" id="5669798">,</span>&nbsp;<span class="ident" id="5669800">b</span><span class="op" id="5669801">,</span>&nbsp;<span class="ident" id="5669803">err1</span>&nbsp;<span class="op" id="5669808">:=</span>&nbsp;<span class="ident" id="5669811">p</span><span class="op" id="5669812">.</span><span class="ident" id="5669813">marshalSimple</span><span class="op" id="5669826">(</span><span class="ident" id="5669827">typ</span><span class="op" id="5669830">,</span>&nbsp;<span class="ident" id="5669832">val</span><span class="op" id="5669835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669839">if</span>&nbsp;<span class="ident" id="5669842">err1</span>&nbsp;<span class="op" id="5669847">!=</span>&nbsp;<span class="ident" id="5669850">nil</span>&nbsp;<span class="op" id="5669854">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669859">err</span>&nbsp;<span class="op" id="5669863">=</span>&nbsp;<span class="ident" id="5669865">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669872">}</span>&nbsp;<span class="keyword" id="5669874">else</span>&nbsp;<span class="keyword" id="5669879">if</span>&nbsp;<span class="ident" id="5669882">b</span>&nbsp;<span class="op" id="5669884">!=</span>&nbsp;<span class="ident" id="5669887">nil</span>&nbsp;<span class="op" id="5669891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669896">EscapeText</span><span class="op" id="5669906">(</span><span class="ident" id="5669907">p</span><span class="op" id="5669908">,</span>&nbsp;<span class="ident" id="5669910">b</span><span class="op" id="5669911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669915">}</span>&nbsp;<span class="keyword" id="5669917">else</span>&nbsp;<span class="op" id="5669922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669927">p</span><span class="op" id="5669928">.</span><span class="ident" id="5669929">EscapeString</span><span class="op" id="5669941">(</span><span class="ident" id="5669942">s</span><span class="op" id="5669943">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669953">if</span>&nbsp;<span class="ident" id="5669956">err</span>&nbsp;<span class="op" id="5669960">!=</span>&nbsp;<span class="ident" id="5669963">nil</span>&nbsp;<span class="op" id="5669967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669971">return</span>&nbsp;<span class="ident" id="5669978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669983">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669987">if</span>&nbsp;<span class="ident" id="5669990">err</span>&nbsp;<span class="op" id="5669994">:=</span>&nbsp;<span class="ident" id="5669997">p</span><span class="op" id="5669998">.</span><span class="ident" id="5669999">writeEnd</span><span class="op" id="5670007">(</span><span class="ident" id="5670008">start</span><span class="op" id="5670013">.</span><span class="ident" id="5670014">Name</span><span class="op" id="5670018">)</span><span class="op" id="5670019">;</span>&nbsp;<span class="ident" id="5670021">err</span>&nbsp;<span class="op" id="5670025">!=</span>&nbsp;<span class="ident" id="5670028">nil</span>&nbsp;<span class="op" id="5670032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670036">return</span>&nbsp;<span class="ident" id="5670043">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670052">return</span>&nbsp;<span class="ident" id="5670059">p</span><span class="op" id="5670060">.</span><span class="ident" id="5670061">cachedWriteError</span><span class="op" id="5670077">(</span><span class="op" id="5670078">)</span><br>
<span class="lineno"></span><span class="op" id="5670080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670083">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="5670141">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="5670200">func</span>&nbsp;<span class="ident" id="5670205">defaultStart</span><span class="op" id="5670217">(</span><span class="ident" id="5670218">typ</span>&nbsp;<span class="ident" id="5670222">reflect</span><span class="op" id="5670229">.</span><span class="ident" id="5670230">Type</span><span class="op" id="5670234">,</span>&nbsp;<span class="ident" id="5670236">finfo</span>&nbsp;<span class="op" id="5670242">*</span><span class="ident" id="5670243">fieldInfo</span><span class="op" id="5670252">,</span>&nbsp;<span class="ident" id="5670254">startTemplate</span>&nbsp;<span class="op" id="5670268">*</span><span class="ident" id="5670269">StartElement</span><span class="op" id="5670281">)</span>&nbsp;<span class="ident" id="5670283">StartElement</span>&nbsp;<span class="op" id="5670296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670299">var</span>&nbsp;<span class="ident" id="5670303">start</span>&nbsp;<span class="ident" id="5670309">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670323">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670376">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670443">if</span>&nbsp;<span class="ident" id="5670446">startTemplate</span>&nbsp;<span class="op" id="5670460">!=</span>&nbsp;<span class="ident" id="5670463">nil</span>&nbsp;<span class="op" id="5670467">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670471">start</span><span class="op" id="5670476">.</span><span class="ident" id="5670477">Name</span>&nbsp;<span class="op" id="5670482">=</span>&nbsp;<span class="ident" id="5670484">startTemplate</span><span class="op" id="5670497">.</span><span class="ident" id="5670498">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670505">start</span><span class="op" id="5670510">.</span><span class="ident" id="5670511">Attr</span>&nbsp;<span class="op" id="5670516">=</span>&nbsp;<span class="builtinfunc" id="5670518">append</span><span class="op" id="5670524">(</span><span class="ident" id="5670525">start</span><span class="op" id="5670530">.</span><span class="ident" id="5670531">Attr</span><span class="op" id="5670535">,</span>&nbsp;<span class="ident" id="5670537">startTemplate</span><span class="op" id="5670550">.</span><span class="ident" id="5670551">Attr</span><span class="op" id="5670555">...</span><span class="op" id="5670558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670561">}</span>&nbsp;<span class="keyword" id="5670563">else</span>&nbsp;<span class="keyword" id="5670568">if</span>&nbsp;<span class="ident" id="5670571">finfo</span>&nbsp;<span class="op" id="5670577">!=</span>&nbsp;<span class="ident" id="5670580">nil</span>&nbsp;<span class="op" id="5670584">&amp;&amp;</span>&nbsp;<span class="ident" id="5670587">finfo</span><span class="op" id="5670592">.</span><span class="ident" id="5670593">name</span>&nbsp;<span class="op" id="5670598">!=</span>&nbsp;<span class="string" id="5670601">&#34;&#34;</span>&nbsp;<span class="op" id="5670604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670608">start</span><span class="op" id="5670613">.</span><span class="ident" id="5670614">Name</span><span class="op" id="5670618">.</span><span class="ident" id="5670619">Local</span>&nbsp;<span class="op" id="5670625">=</span>&nbsp;<span class="ident" id="5670627">finfo</span><span class="op" id="5670632">.</span><span class="ident" id="5670633">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670640">start</span><span class="op" id="5670645">.</span><span class="ident" id="5670646">Name</span><span class="op" id="5670650">.</span><span class="ident" id="5670651">Space</span>&nbsp;<span class="op" id="5670657">=</span>&nbsp;<span class="ident" id="5670659">finfo</span><span class="op" id="5670664">.</span><span class="ident" id="5670665">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670672">}</span>&nbsp;<span class="keyword" id="5670674">else</span>&nbsp;<span class="keyword" id="5670679">if</span>&nbsp;<span class="ident" id="5670682">typ</span><span class="op" id="5670685">.</span><span class="ident" id="5670686">Name</span><span class="op" id="5670690">(</span><span class="op" id="5670691">)</span>&nbsp;<span class="op" id="5670693">!=</span>&nbsp;<span class="string" id="5670696">&#34;&#34;</span>&nbsp;<span class="op" id="5670699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670703">start</span><span class="op" id="5670708">.</span><span class="ident" id="5670709">Name</span><span class="op" id="5670713">.</span><span class="ident" id="5670714">Local</span>&nbsp;<span class="op" id="5670720">=</span>&nbsp;<span class="ident" id="5670722">typ</span><span class="op" id="5670725">.</span><span class="ident" id="5670726">Name</span><span class="op" id="5670730">(</span><span class="op" id="5670731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670734">}</span>&nbsp;<span class="keyword" id="5670736">else</span>&nbsp;<span class="op" id="5670741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670745">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670785">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670826">start</span><span class="op" id="5670831">.</span><span class="ident" id="5670832">Name</span><span class="op" id="5670836">.</span><span class="ident" id="5670837">Local</span>&nbsp;<span class="op" id="5670843">=</span>&nbsp;<span class="ident" id="5670845">typ</span><span class="op" id="5670848">.</span><span class="ident" id="5670849">Elem</span><span class="op" id="5670853">(</span><span class="op" id="5670854">)</span><span class="op" id="5670855">.</span><span class="ident" id="5670856">Name</span><span class="op" id="5670860">(</span><span class="op" id="5670861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670867">return</span>&nbsp;<span class="ident" id="5670874">start</span><br>
<span class="lineno"></span><span class="op" id="5670880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="5670883">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5670941">func</span>&nbsp;<span class="op" id="5670946">(</span><span class="ident" id="5670947">p</span>&nbsp;<span class="op" id="5670949">*</span><span class="ident" id="5670950">printer</span><span class="op" id="5670957">)</span>&nbsp;<span class="ident" id="5670959">marshalInterface</span><span class="op" id="5670975">(</span><span class="ident" id="5670976">val</span>&nbsp;<span class="ident" id="5670980">Marshaler</span><span class="op" id="5670989">,</span>&nbsp;<span class="ident" id="5670991">start</span>&nbsp;<span class="ident" id="5670997">StartElement</span><span class="op" id="5671009">)</span>&nbsp;<span class="builtintype" id="5671011">error</span>&nbsp;<span class="op" id="5671017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671020">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671076">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671128">p</span><span class="op" id="5671129">.</span><span class="ident" id="5671130">tags</span>&nbsp;<span class="op" id="5671135">=</span>&nbsp;<span class="builtinfunc" id="5671137">append</span><span class="op" id="5671143">(</span><span class="ident" id="5671144">p</span><span class="op" id="5671145">.</span><span class="ident" id="5671146">tags</span><span class="op" id="5671150">,</span>&nbsp;<span class="ident" id="5671152">Name</span><span class="op" id="5671156">{</span><span class="op" id="5671157">}</span><span class="op" id="5671158">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671161">n</span>&nbsp;<span class="op" id="5671163">:=</span>&nbsp;<span class="builtinfunc" id="5671166">len</span><span class="op" id="5671169">(</span><span class="ident" id="5671170">p</span><span class="op" id="5671171">.</span><span class="ident" id="5671172">tags</span><span class="op" id="5671176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671180">err</span>&nbsp;<span class="op" id="5671184">:=</span>&nbsp;<span class="ident" id="5671187">val</span><span class="op" id="5671190">.</span><span class="ident" id="5671191">MarshalXML</span><span class="op" id="5671201">(</span><span class="ident" id="5671202">p</span><span class="op" id="5671203">.</span><span class="ident" id="5671204">encoder</span><span class="op" id="5671211">,</span>&nbsp;<span class="ident" id="5671213">start</span><span class="op" id="5671218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671221">if</span>&nbsp;<span class="ident" id="5671224">err</span>&nbsp;<span class="op" id="5671228">!=</span>&nbsp;<span class="ident" id="5671231">nil</span>&nbsp;<span class="op" id="5671235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671239">return</span>&nbsp;<span class="ident" id="5671246">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671255">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671326">if</span>&nbsp;<span class="builtinfunc" id="5671329">len</span><span class="op" id="5671332">(</span><span class="ident" id="5671333">p</span><span class="op" id="5671334">.</span><span class="ident" id="5671335">tags</span><span class="op" id="5671339">)</span>&nbsp;<span class="op" id="5671341">&gt;</span>&nbsp;<span class="ident" id="5671343">n</span>&nbsp;<span class="op" id="5671345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671349">return</span>&nbsp;<span class="ident" id="5671356">fmt</span><span class="op" id="5671359">.</span><span class="ident" id="5671360">Errorf</span><span class="op" id="5671366">(</span><span class="string" id="5671367">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="5671422">,</span>&nbsp;<span class="ident" id="5671424">receiverType</span><span class="op" id="5671436">(</span><span class="ident" id="5671437">val</span><span class="op" id="5671440">)</span><span class="op" id="5671441">,</span>&nbsp;<span class="ident" id="5671443">p</span><span class="op" id="5671444">.</span><span class="ident" id="5671445">tags</span><span class="op" id="5671449">[</span><span class="builtinfunc" id="5671450">len</span><span class="op" id="5671453">(</span><span class="ident" id="5671454">p</span><span class="op" id="5671455">.</span><span class="ident" id="5671456">tags</span><span class="op" id="5671460">)</span><span class="op" id="5671461">-</span><span class="num" id="5671462">1</span><span class="op" id="5671463">]</span><span class="op" id="5671464">.</span><span class="ident" id="5671465">Local</span><span class="op" id="5671470">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671476">p</span><span class="op" id="5671477">.</span><span class="ident" id="5671478">tags</span>&nbsp;<span class="op" id="5671483">=</span>&nbsp;<span class="ident" id="5671485">p</span><span class="op" id="5671486">.</span><span class="ident" id="5671487">tags</span><span class="op" id="5671491">[</span><span class="op" id="5671492">:</span><span class="ident" id="5671493">n</span><span class="op" id="5671494">-</span><span class="num" id="5671495">1</span><span class="op" id="5671496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671499">return</span>&nbsp;<span class="ident" id="5671506">nil</span><br>
<span class="lineno"></span><span class="op" id="5671510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5671513">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5671579">func</span>&nbsp;<span class="op" id="5671584">(</span><span class="ident" id="5671585">p</span>&nbsp;<span class="op" id="5671587">*</span><span class="ident" id="5671588">printer</span><span class="op" id="5671595">)</span>&nbsp;<span class="ident" id="5671597">marshalTextInterface</span><span class="op" id="5671617">(</span><span class="ident" id="5671618">val</span>&nbsp;<span class="ident" id="5671622">encoding</span><span class="op" id="5671630">.</span><span class="ident" id="5671631">TextMarshaler</span><span class="op" id="5671644">,</span>&nbsp;<span class="ident" id="5671646">start</span>&nbsp;<span class="ident" id="5671652">StartElement</span><span class="op" id="5671664">)</span>&nbsp;<span class="builtintype" id="5671666">error</span>&nbsp;<span class="op" id="5671672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671675">if</span>&nbsp;<span class="ident" id="5671678">err</span>&nbsp;<span class="op" id="5671682">:=</span>&nbsp;<span class="ident" id="5671685">p</span><span class="op" id="5671686">.</span><span class="ident" id="5671687">writeStart</span><span class="op" id="5671697">(</span><span class="op" id="5671698">&amp;</span><span class="ident" id="5671699">start</span><span class="op" id="5671704">)</span><span class="op" id="5671705">;</span>&nbsp;<span class="ident" id="5671707">err</span>&nbsp;<span class="op" id="5671711">!=</span>&nbsp;<span class="ident" id="5671714">nil</span>&nbsp;<span class="op" id="5671718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671722">return</span>&nbsp;<span class="ident" id="5671729">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671734">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671737">text</span><span class="op" id="5671741">,</span>&nbsp;<span class="ident" id="5671743">err</span>&nbsp;<span class="op" id="5671747">:=</span>&nbsp;<span class="ident" id="5671750">val</span><span class="op" id="5671753">.</span><span class="ident" id="5671754">MarshalText</span><span class="op" id="5671765">(</span><span class="op" id="5671766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671769">if</span>&nbsp;<span class="ident" id="5671772">err</span>&nbsp;<span class="op" id="5671776">!=</span>&nbsp;<span class="ident" id="5671779">nil</span>&nbsp;<span class="op" id="5671783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671787">return</span>&nbsp;<span class="ident" id="5671794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671802">EscapeText</span><span class="op" id="5671812">(</span><span class="ident" id="5671813">p</span><span class="op" id="5671814">,</span>&nbsp;<span class="ident" id="5671816">text</span><span class="op" id="5671820">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671823">return</span>&nbsp;<span class="ident" id="5671830">p</span><span class="op" id="5671831">.</span><span class="ident" id="5671832">writeEnd</span><span class="op" id="5671840">(</span><span class="ident" id="5671841">start</span><span class="op" id="5671846">.</span><span class="ident" id="5671847">Name</span><span class="op" id="5671851">)</span><br>
<span class="lineno"></span><span class="op" id="5671853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671856">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="5671902">func</span>&nbsp;<span class="op" id="5671907">(</span><span class="ident" id="5671908">p</span>&nbsp;<span class="op" id="5671910">*</span><span class="ident" id="5671911">printer</span><span class="op" id="5671918">)</span>&nbsp;<span class="ident" id="5671920">writeStart</span><span class="op" id="5671930">(</span><span class="ident" id="5671931">start</span>&nbsp;<span class="op" id="5671937">*</span><span class="ident" id="5671938">StartElement</span><span class="op" id="5671950">)</span>&nbsp;<span class="builtintype" id="5671952">error</span>&nbsp;<span class="op" id="5671958">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671961">if</span>&nbsp;<span class="ident" id="5671964">start</span><span class="op" id="5671969">.</span><span class="ident" id="5671970">Name</span><span class="op" id="5671974">.</span><span class="ident" id="5671975">Local</span>&nbsp;<span class="op" id="5671981">==</span>&nbsp;<span class="string" id="5671984">&#34;&#34;</span>&nbsp;<span class="op" id="5671987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671991">return</span>&nbsp;<span class="ident" id="5671998">fmt</span><span class="op" id="5672001">.</span><span class="ident" id="5672002">Errorf</span><span class="op" id="5672008">(</span><span class="string" id="5672009">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5672038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672045">p</span><span class="op" id="5672046">.</span><span class="ident" id="5672047">tags</span>&nbsp;<span class="op" id="5672052">=</span>&nbsp;<span class="builtinfunc" id="5672054">append</span><span class="op" id="5672060">(</span><span class="ident" id="5672061">p</span><span class="op" id="5672062">.</span><span class="ident" id="5672063">tags</span><span class="op" id="5672067">,</span>&nbsp;<span class="ident" id="5672069">start</span><span class="op" id="5672074">.</span><span class="ident" id="5672075">Name</span><span class="op" id="5672079">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672082">p</span><span class="op" id="5672083">.</span><span class="ident" id="5672084">markPrefix</span><span class="op" id="5672094">(</span><span class="op" id="5672095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672099">p</span><span class="op" id="5672100">.</span><span class="ident" id="5672101">writeIndent</span><span class="op" id="5672112">(</span><span class="num" id="5672113">1</span><span class="op" id="5672114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672117">p</span><span class="op" id="5672118">.</span><span class="ident" id="5672119">WriteByte</span><span class="op" id="5672128">(</span><span class="string" id="5672129">&#39;&lt;&#39;</span><span class="op" id="5672132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672135">p</span><span class="op" id="5672136">.</span><span class="ident" id="5672137">WriteString</span><span class="op" id="5672148">(</span><span class="ident" id="5672149">start</span><span class="op" id="5672154">.</span><span class="ident" id="5672155">Name</span><span class="op" id="5672159">.</span><span class="ident" id="5672160">Local</span><span class="op" id="5672165">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672169">if</span>&nbsp;<span class="ident" id="5672172">start</span><span class="op" id="5672177">.</span><span class="ident" id="5672178">Name</span><span class="op" id="5672182">.</span><span class="ident" id="5672183">Space</span>&nbsp;<span class="op" id="5672189">!=</span>&nbsp;<span class="string" id="5672192">&#34;&#34;</span>&nbsp;<span class="op" id="5672195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672199">p</span><span class="op" id="5672200">.</span><span class="ident" id="5672201">WriteString</span><span class="op" id="5672212">(</span><span class="string" id="5672213">`&nbsp;xmlns=&#34;`</span><span class="op" id="5672223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672227">p</span><span class="op" id="5672228">.</span><span class="ident" id="5672229">EscapeString</span><span class="op" id="5672241">(</span><span class="ident" id="5672242">start</span><span class="op" id="5672247">.</span><span class="ident" id="5672248">Name</span><span class="op" id="5672252">.</span><span class="ident" id="5672253">Space</span><span class="op" id="5672258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672262">p</span><span class="op" id="5672263">.</span><span class="ident" id="5672264">WriteByte</span><span class="op" id="5672273">(</span><span class="string" id="5672274">&#39;&#34;&#39;</span><span class="op" id="5672277">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672284">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672299">for</span>&nbsp;<span class="ident" id="5672303">_</span><span class="op" id="5672304">,</span>&nbsp;<span class="ident" id="5672306">attr</span>&nbsp;<span class="op" id="5672311">:=</span>&nbsp;<span class="keyword" id="5672314">range</span>&nbsp;<span class="ident" id="5672320">start</span><span class="op" id="5672325">.</span><span class="ident" id="5672326">Attr</span>&nbsp;<span class="op" id="5672331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672335">name</span>&nbsp;<span class="op" id="5672340">:=</span>&nbsp;<span class="ident" id="5672343">attr</span><span class="op" id="5672347">.</span><span class="ident" id="5672348">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672355">if</span>&nbsp;<span class="ident" id="5672358">name</span><span class="op" id="5672362">.</span><span class="ident" id="5672363">Local</span>&nbsp;<span class="op" id="5672369">==</span>&nbsp;<span class="string" id="5672372">&#34;&#34;</span>&nbsp;<span class="op" id="5672375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672380">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672395">p</span><span class="op" id="5672396">.</span><span class="ident" id="5672397">WriteByte</span><span class="op" id="5672406">(</span><span class="string" id="5672407">&#39;&nbsp;&#39;</span><span class="op" id="5672410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672414">if</span>&nbsp;<span class="ident" id="5672417">name</span><span class="op" id="5672421">.</span><span class="ident" id="5672422">Space</span>&nbsp;<span class="op" id="5672428">!=</span>&nbsp;<span class="string" id="5672431">&#34;&#34;</span>&nbsp;<span class="op" id="5672434">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672439">p</span><span class="op" id="5672440">.</span><span class="ident" id="5672441">WriteString</span><span class="op" id="5672452">(</span><span class="ident" id="5672453">p</span><span class="op" id="5672454">.</span><span class="ident" id="5672455">createAttrPrefix</span><span class="op" id="5672471">(</span><span class="ident" id="5672472">name</span><span class="op" id="5672476">.</span><span class="ident" id="5672477">Space</span><span class="op" id="5672482">)</span><span class="op" id="5672483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672488">p</span><span class="op" id="5672489">.</span><span class="ident" id="5672490">WriteByte</span><span class="op" id="5672499">(</span><span class="string" id="5672500">&#39;:&#39;</span><span class="op" id="5672503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672511">p</span><span class="op" id="5672512">.</span><span class="ident" id="5672513">WriteString</span><span class="op" id="5672524">(</span><span class="ident" id="5672525">name</span><span class="op" id="5672529">.</span><span class="ident" id="5672530">Local</span><span class="op" id="5672535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672539">p</span><span class="op" id="5672540">.</span><span class="ident" id="5672541">WriteString</span><span class="op" id="5672552">(</span><span class="string" id="5672553">`=&#34;`</span><span class="op" id="5672557">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672561">p</span><span class="op" id="5672562">.</span><span class="ident" id="5672563">EscapeString</span><span class="op" id="5672575">(</span><span class="ident" id="5672576">attr</span><span class="op" id="5672580">.</span><span class="ident" id="5672581">Value</span><span class="op" id="5672586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672590">p</span><span class="op" id="5672591">.</span><span class="ident" id="5672592">WriteByte</span><span class="op" id="5672601">(</span><span class="string" id="5672602">&#39;&#34;&#39;</span><span class="op" id="5672605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672611">p</span><span class="op" id="5672612">.</span><span class="ident" id="5672613">WriteByte</span><span class="op" id="5672622">(</span><span class="string" id="5672623">&#39;&gt;&#39;</span><span class="op" id="5672626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672629">return</span>&nbsp;<span class="ident" id="5672636">nil</span><br>
<span class="lineno">645</span><span class="op" id="5672640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5672643">func</span>&nbsp;<span class="op" id="5672648">(</span><span class="ident" id="5672649">p</span>&nbsp;<span class="op" id="5672651">*</span><span class="ident" id="5672652">printer</span><span class="op" id="5672659">)</span>&nbsp;<span class="ident" id="5672661">writeEnd</span><span class="op" id="5672669">(</span><span class="ident" id="5672670">name</span>&nbsp;<span class="ident" id="5672675">Name</span><span class="op" id="5672679">)</span>&nbsp;<span class="builtintype" id="5672681">error</span>&nbsp;<span class="op" id="5672687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672690">if</span>&nbsp;<span class="ident" id="5672693">name</span><span class="op" id="5672697">.</span><span class="ident" id="5672698">Local</span>&nbsp;<span class="op" id="5672704">==</span>&nbsp;<span class="string" id="5672707">&#34;&#34;</span>&nbsp;<span class="op" id="5672710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672714">return</span>&nbsp;<span class="ident" id="5672721">fmt</span><span class="op" id="5672724">.</span><span class="ident" id="5672725">Errorf</span><span class="op" id="5672731">(</span><span class="string" id="5672732">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5672759">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672765">if</span>&nbsp;<span class="builtinfunc" id="5672768">len</span><span class="op" id="5672771">(</span><span class="ident" id="5672772">p</span><span class="op" id="5672773">.</span><span class="ident" id="5672774">tags</span><span class="op" id="5672778">)</span>&nbsp;<span class="op" id="5672780">==</span>&nbsp;<span class="num" id="5672783">0</span>&nbsp;<span class="op" id="5672785">||</span>&nbsp;<span class="ident" id="5672788">p</span><span class="op" id="5672789">.</span><span class="ident" id="5672790">tags</span><span class="op" id="5672794">[</span><span class="builtinfunc" id="5672795">len</span><span class="op" id="5672798">(</span><span class="ident" id="5672799">p</span><span class="op" id="5672800">.</span><span class="ident" id="5672801">tags</span><span class="op" id="5672805">)</span><span class="op" id="5672806">-</span><span class="num" id="5672807">1</span><span class="op" id="5672808">]</span><span class="op" id="5672809">.</span><span class="ident" id="5672810">Local</span>&nbsp;<span class="op" id="5672816">==</span>&nbsp;<span class="string" id="5672819">&#34;&#34;</span>&nbsp;<span class="op" id="5672822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672826">return</span>&nbsp;<span class="ident" id="5672833">fmt</span><span class="op" id="5672836">.</span><span class="ident" id="5672837">Errorf</span><span class="op" id="5672843">(</span><span class="string" id="5672844">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="5672882">,</span>&nbsp;<span class="ident" id="5672884">name</span><span class="op" id="5672888">.</span><span class="ident" id="5672889">Local</span><span class="op" id="5672894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672900">if</span>&nbsp;<span class="ident" id="5672903">top</span>&nbsp;<span class="op" id="5672907">:=</span>&nbsp;<span class="ident" id="5672910">p</span><span class="op" id="5672911">.</span><span class="ident" id="5672912">tags</span><span class="op" id="5672916">[</span><span class="builtinfunc" id="5672917">len</span><span class="op" id="5672920">(</span><span class="ident" id="5672921">p</span><span class="op" id="5672922">.</span><span class="ident" id="5672923">tags</span><span class="op" id="5672927">)</span><span class="op" id="5672928">-</span><span class="num" id="5672929">1</span><span class="op" id="5672930">]</span><span class="op" id="5672931">;</span>&nbsp;<span class="ident" id="5672933">top</span>&nbsp;<span class="op" id="5672937">!=</span>&nbsp;<span class="ident" id="5672940">name</span>&nbsp;<span class="op" id="5672945">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672949">if</span>&nbsp;<span class="ident" id="5672952">top</span><span class="op" id="5672955">.</span><span class="ident" id="5672956">Local</span>&nbsp;<span class="op" id="5672962">!=</span>&nbsp;<span class="ident" id="5672965">name</span><span class="op" id="5672969">.</span><span class="ident" id="5672970">Local</span>&nbsp;<span class="op" id="5672976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672981">return</span>&nbsp;<span class="ident" id="5672988">fmt</span><span class="op" id="5672991">.</span><span class="ident" id="5672992">Errorf</span><span class="op" id="5672998">(</span><span class="string" id="5672999">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="5673049">,</span>&nbsp;<span class="ident" id="5673051">name</span><span class="op" id="5673055">.</span><span class="ident" id="5673056">Local</span><span class="op" id="5673061">,</span>&nbsp;<span class="ident" id="5673063">top</span><span class="op" id="5673066">.</span><span class="ident" id="5673067">Local</span><span class="op" id="5673072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673080">return</span>&nbsp;<span class="ident" id="5673087">fmt</span><span class="op" id="5673090">.</span><span class="ident" id="5673091">Errorf</span><span class="op" id="5673097">(</span><span class="string" id="5673098">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="5673180">,</span>&nbsp;<span class="ident" id="5673182">name</span><span class="op" id="5673186">.</span><span class="ident" id="5673187">Local</span><span class="op" id="5673192">,</span>&nbsp;<span class="ident" id="5673194">name</span><span class="op" id="5673198">.</span><span class="ident" id="5673199">Space</span><span class="op" id="5673204">,</span>&nbsp;<span class="ident" id="5673206">top</span><span class="op" id="5673209">.</span><span class="ident" id="5673210">Local</span><span class="op" id="5673215">,</span>&nbsp;<span class="ident" id="5673217">top</span><span class="op" id="5673220">.</span><span class="ident" id="5673221">Space</span><span class="op" id="5673226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673229">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673232">p</span><span class="op" id="5673233">.</span><span class="ident" id="5673234">tags</span>&nbsp;<span class="op" id="5673239">=</span>&nbsp;<span class="ident" id="5673241">p</span><span class="op" id="5673242">.</span><span class="ident" id="5673243">tags</span><span class="op" id="5673247">[</span><span class="op" id="5673248">:</span><span class="builtinfunc" id="5673249">len</span><span class="op" id="5673252">(</span><span class="ident" id="5673253">p</span><span class="op" id="5673254">.</span><span class="ident" id="5673255">tags</span><span class="op" id="5673259">)</span><span class="op" id="5673260">-</span><span class="num" id="5673261">1</span><span class="op" id="5673262">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673266">p</span><span class="op" id="5673267">.</span><span class="ident" id="5673268">writeIndent</span><span class="op" id="5673279">(</span><span class="op" id="5673280">-</span><span class="num" id="5673281">1</span><span class="op" id="5673282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673285">p</span><span class="op" id="5673286">.</span><span class="ident" id="5673287">WriteByte</span><span class="op" id="5673296">(</span><span class="string" id="5673297">&#39;&lt;&#39;</span><span class="op" id="5673300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673303">p</span><span class="op" id="5673304">.</span><span class="ident" id="5673305">WriteByte</span><span class="op" id="5673314">(</span><span class="string" id="5673315">&#39;/&#39;</span><span class="op" id="5673318">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673321">p</span><span class="op" id="5673322">.</span><span class="ident" id="5673323">WriteString</span><span class="op" id="5673334">(</span><span class="ident" id="5673335">name</span><span class="op" id="5673339">.</span><span class="ident" id="5673340">Local</span><span class="op" id="5673345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673348">p</span><span class="op" id="5673349">.</span><span class="ident" id="5673350">WriteByte</span><span class="op" id="5673359">(</span><span class="string" id="5673360">&#39;&gt;&#39;</span><span class="op" id="5673363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673366">p</span><span class="op" id="5673367">.</span><span class="ident" id="5673368">popPrefix</span><span class="op" id="5673377">(</span><span class="op" id="5673378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673381">return</span>&nbsp;<span class="ident" id="5673388">nil</span><br>
<span class="lineno"></span><span class="op" id="5673392">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="5673395">func</span>&nbsp;<span class="op" id="5673400">(</span><span class="ident" id="5673401">p</span>&nbsp;<span class="op" id="5673403">*</span><span class="ident" id="5673404">printer</span><span class="op" id="5673411">)</span>&nbsp;<span class="ident" id="5673413">marshalSimple</span><span class="op" id="5673426">(</span><span class="ident" id="5673427">typ</span>&nbsp;<span class="ident" id="5673431">reflect</span><span class="op" id="5673438">.</span><span class="ident" id="5673439">Type</span><span class="op" id="5673443">,</span>&nbsp;<span class="ident" id="5673445">val</span>&nbsp;<span class="ident" id="5673449">reflect</span><span class="op" id="5673456">.</span><span class="ident" id="5673457">Value</span><span class="op" id="5673462">)</span>&nbsp;<span class="op" id="5673464">(</span><span class="builtintype" id="5673465">string</span><span class="op" id="5673471">,</span>&nbsp;<span class="op" id="5673473">[</span><span class="op" id="5673474">]</span><span class="builtintype" id="5673475">byte</span><span class="op" id="5673479">,</span>&nbsp;<span class="builtintype" id="5673481">error</span><span class="op" id="5673486">)</span>&nbsp;<span class="op" id="5673488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673491">switch</span>&nbsp;<span class="ident" id="5673498">val</span><span class="op" id="5673501">.</span><span class="ident" id="5673502">Kind</span><span class="op" id="5673506">(</span><span class="op" id="5673507">)</span>&nbsp;<span class="op" id="5673509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673512">case</span>&nbsp;<span class="ident" id="5673517">reflect</span><span class="op" id="5673524">.</span><span class="ident" id="5673525">Int</span><span class="op" id="5673528">,</span>&nbsp;<span class="ident" id="5673530">reflect</span><span class="op" id="5673537">.</span><span class="ident" id="5673538">Int8</span><span class="op" id="5673542">,</span>&nbsp;<span class="ident" id="5673544">reflect</span><span class="op" id="5673551">.</span><span class="ident" id="5673552">Int16</span><span class="op" id="5673557">,</span>&nbsp;<span class="ident" id="5673559">reflect</span><span class="op" id="5673566">.</span><span class="ident" id="5673567">Int32</span><span class="op" id="5673572">,</span>&nbsp;<span class="ident" id="5673574">reflect</span><span class="op" id="5673581">.</span><span class="ident" id="5673582">Int64</span><span class="op" id="5673587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673591">return</span>&nbsp;<span class="ident" id="5673598">strconv</span><span class="op" id="5673605">.</span><span class="ident" id="5673606">FormatInt</span><span class="op" id="5673615">(</span><span class="ident" id="5673616">val</span><span class="op" id="5673619">.</span><span class="ident" id="5673620">Int</span><span class="op" id="5673623">(</span><span class="op" id="5673624">)</span><span class="op" id="5673625">,</span>&nbsp;<span class="num" id="5673627">10</span><span class="op" id="5673629">)</span><span class="op" id="5673630">,</span>&nbsp;<span class="ident" id="5673632">nil</span><span class="op" id="5673635">,</span>&nbsp;<span class="ident" id="5673637">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673642">case</span>&nbsp;<span class="ident" id="5673647">reflect</span><span class="op" id="5673654">.</span><span class="ident" id="5673655">Uint</span><span class="op" id="5673659">,</span>&nbsp;<span class="ident" id="5673661">reflect</span><span class="op" id="5673668">.</span><span class="ident" id="5673669">Uint8</span><span class="op" id="5673674">,</span>&nbsp;<span class="ident" id="5673676">reflect</span><span class="op" id="5673683">.</span><span class="ident" id="5673684">Uint16</span><span class="op" id="5673690">,</span>&nbsp;<span class="ident" id="5673692">reflect</span><span class="op" id="5673699">.</span><span class="ident" id="5673700">Uint32</span><span class="op" id="5673706">,</span>&nbsp;<span class="ident" id="5673708">reflect</span><span class="op" id="5673715">.</span><span class="ident" id="5673716">Uint64</span><span class="op" id="5673722">,</span>&nbsp;<span class="ident" id="5673724">reflect</span><span class="op" id="5673731">.</span><span class="ident" id="5673732">Uintptr</span><span class="op" id="5673739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673743">return</span>&nbsp;<span class="ident" id="5673750">strconv</span><span class="op" id="5673757">.</span><span class="ident" id="5673758">FormatUint</span><span class="op" id="5673768">(</span><span class="ident" id="5673769">val</span><span class="op" id="5673772">.</span><span class="ident" id="5673773">Uint</span><span class="op" id="5673777">(</span><span class="op" id="5673778">)</span><span class="op" id="5673779">,</span>&nbsp;<span class="num" id="5673781">10</span><span class="op" id="5673783">)</span><span class="op" id="5673784">,</span>&nbsp;<span class="ident" id="5673786">nil</span><span class="op" id="5673789">,</span>&nbsp;<span class="ident" id="5673791">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673796">case</span>&nbsp;<span class="ident" id="5673801">reflect</span><span class="op" id="5673808">.</span><span class="ident" id="5673809">Float32</span><span class="op" id="5673816">,</span>&nbsp;<span class="ident" id="5673818">reflect</span><span class="op" id="5673825">.</span><span class="ident" id="5673826">Float64</span><span class="op" id="5673833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673837">return</span>&nbsp;<span class="ident" id="5673844">strconv</span><span class="op" id="5673851">.</span><span class="ident" id="5673852">FormatFloat</span><span class="op" id="5673863">(</span><span class="ident" id="5673864">val</span><span class="op" id="5673867">.</span><span class="ident" id="5673868">Float</span><span class="op" id="5673873">(</span><span class="op" id="5673874">)</span><span class="op" id="5673875">,</span>&nbsp;<span class="string" id="5673877">&#39;g&#39;</span><span class="op" id="5673880">,</span>&nbsp;<span class="op" id="5673882">-</span><span class="num" id="5673883">1</span><span class="op" id="5673884">,</span>&nbsp;<span class="ident" id="5673886">val</span><span class="op" id="5673889">.</span><span class="ident" id="5673890">Type</span><span class="op" id="5673894">(</span><span class="op" id="5673895">)</span><span class="op" id="5673896">.</span><span class="ident" id="5673897">Bits</span><span class="op" id="5673901">(</span><span class="op" id="5673902">)</span><span class="op" id="5673903">)</span><span class="op" id="5673904">,</span>&nbsp;<span class="ident" id="5673906">nil</span><span class="op" id="5673909">,</span>&nbsp;<span class="ident" id="5673911">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673916">case</span>&nbsp;<span class="ident" id="5673921">reflect</span><span class="op" id="5673928">.</span><span class="ident" id="5673929">String</span><span class="op" id="5673935">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673939">return</span>&nbsp;<span class="ident" id="5673946">val</span><span class="op" id="5673949">.</span><span class="ident" id="5673950">String</span><span class="op" id="5673956">(</span><span class="op" id="5673957">)</span><span class="op" id="5673958">,</span>&nbsp;<span class="ident" id="5673960">nil</span><span class="op" id="5673963">,</span>&nbsp;<span class="ident" id="5673965">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673970">case</span>&nbsp;<span class="ident" id="5673975">reflect</span><span class="op" id="5673982">.</span><span class="ident" id="5673983">Bool</span><span class="op" id="5673987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673991">return</span>&nbsp;<span class="ident" id="5673998">strconv</span><span class="op" id="5674005">.</span><span class="ident" id="5674006">FormatBool</span><span class="op" id="5674016">(</span><span class="ident" id="5674017">val</span><span class="op" id="5674020">.</span><span class="ident" id="5674021">Bool</span><span class="op" id="5674025">(</span><span class="op" id="5674026">)</span><span class="op" id="5674027">)</span><span class="op" id="5674028">,</span>&nbsp;<span class="ident" id="5674030">nil</span><span class="op" id="5674033">,</span>&nbsp;<span class="ident" id="5674035">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674040">case</span>&nbsp;<span class="ident" id="5674045">reflect</span><span class="op" id="5674052">.</span><span class="ident" id="5674053">Array</span><span class="op" id="5674058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674062">if</span>&nbsp;<span class="ident" id="5674065">typ</span><span class="op" id="5674068">.</span><span class="ident" id="5674069">Elem</span><span class="op" id="5674073">(</span><span class="op" id="5674074">)</span><span class="op" id="5674075">.</span><span class="ident" id="5674076">Kind</span><span class="op" id="5674080">(</span><span class="op" id="5674081">)</span>&nbsp;<span class="op" id="5674083">!=</span>&nbsp;<span class="ident" id="5674086">reflect</span><span class="op" id="5674093">.</span><span class="ident" id="5674094">Uint8</span>&nbsp;<span class="op" id="5674100">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674105">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674117">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674132">var</span>&nbsp;<span class="ident" id="5674136">bytes</span>&nbsp;<span class="op" id="5674142">[</span><span class="op" id="5674143">]</span><span class="builtintype" id="5674144">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674151">if</span>&nbsp;<span class="ident" id="5674154">val</span><span class="op" id="5674157">.</span><span class="ident" id="5674158">CanAddr</span><span class="op" id="5674165">(</span><span class="op" id="5674166">)</span>&nbsp;<span class="op" id="5674168">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674173">bytes</span>&nbsp;<span class="op" id="5674179">=</span>&nbsp;<span class="ident" id="5674181">val</span><span class="op" id="5674184">.</span><span class="ident" id="5674185">Slice</span><span class="op" id="5674190">(</span><span class="num" id="5674191">0</span><span class="op" id="5674192">,</span>&nbsp;<span class="ident" id="5674194">val</span><span class="op" id="5674197">.</span><span class="ident" id="5674198">Len</span><span class="op" id="5674201">(</span><span class="op" id="5674202">)</span><span class="op" id="5674203">)</span><span class="op" id="5674204">.</span><span class="ident" id="5674205">Bytes</span><span class="op" id="5674210">(</span><span class="op" id="5674211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674215">}</span>&nbsp;<span class="keyword" id="5674217">else</span>&nbsp;<span class="op" id="5674222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674227">bytes</span>&nbsp;<span class="op" id="5674233">=</span>&nbsp;<span class="builtinfunc" id="5674235">make</span><span class="op" id="5674239">(</span><span class="op" id="5674240">[</span><span class="op" id="5674241">]</span><span class="builtintype" id="5674242">byte</span><span class="op" id="5674246">,</span>&nbsp;<span class="ident" id="5674248">val</span><span class="op" id="5674251">.</span><span class="ident" id="5674252">Len</span><span class="op" id="5674255">(</span><span class="op" id="5674256">)</span><span class="op" id="5674257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674262">reflect</span><span class="op" id="5674269">.</span><span class="ident" id="5674270">Copy</span><span class="op" id="5674274">(</span><span class="ident" id="5674275">reflect</span><span class="op" id="5674282">.</span><span class="ident" id="5674283">ValueOf</span><span class="op" id="5674290">(</span><span class="ident" id="5674291">bytes</span><span class="op" id="5674296">)</span><span class="op" id="5674297">,</span>&nbsp;<span class="ident" id="5674299">val</span><span class="op" id="5674302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674306">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674310">return</span>&nbsp;<span class="string" id="5674317">&#34;&#34;</span><span class="op" id="5674319">,</span>&nbsp;<span class="ident" id="5674321">bytes</span><span class="op" id="5674326">,</span>&nbsp;<span class="ident" id="5674328">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674333">case</span>&nbsp;<span class="ident" id="5674338">reflect</span><span class="op" id="5674345">.</span><span class="ident" id="5674346">Slice</span><span class="op" id="5674351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674355">if</span>&nbsp;<span class="ident" id="5674358">typ</span><span class="op" id="5674361">.</span><span class="ident" id="5674362">Elem</span><span class="op" id="5674366">(</span><span class="op" id="5674367">)</span><span class="op" id="5674368">.</span><span class="ident" id="5674369">Kind</span><span class="op" id="5674373">(</span><span class="op" id="5674374">)</span>&nbsp;<span class="op" id="5674376">!=</span>&nbsp;<span class="ident" id="5674379">reflect</span><span class="op" id="5674386">.</span><span class="ident" id="5674387">Uint8</span>&nbsp;<span class="op" id="5674393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674398">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674406">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674410">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674422">return</span>&nbsp;<span class="string" id="5674429">&#34;&#34;</span><span class="op" id="5674431">,</span>&nbsp;<span class="ident" id="5674433">val</span><span class="op" id="5674436">.</span><span class="ident" id="5674437">Bytes</span><span class="op" id="5674442">(</span><span class="op" id="5674443">)</span><span class="op" id="5674444">,</span>&nbsp;<span class="ident" id="5674446">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674454">return</span>&nbsp;<span class="string" id="5674461">&#34;&#34;</span><span class="op" id="5674463">,</span>&nbsp;<span class="ident" id="5674465">nil</span><span class="op" id="5674468">,</span>&nbsp;<span class="op" id="5674470">&amp;</span><span class="ident" id="5674471">UnsupportedTypeError</span><span class="op" id="5674491">{</span><span class="ident" id="5674492">typ</span><span class="op" id="5674495">}</span><br>
<span class="lineno"></span><span class="op" id="5674497">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="5674500">var</span>&nbsp;<span class="ident" id="5674504">ddBytes</span>&nbsp;<span class="op" id="5674512">=</span>&nbsp;<span class="op" id="5674514">[</span><span class="op" id="5674515">]</span><span class="builtintype" id="5674516">byte</span><span class="op" id="5674520">(</span><span class="string" id="5674521">&#34;--&#34;</span><span class="op" id="5674525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5674528">func</span>&nbsp;<span class="op" id="5674533">(</span><span class="ident" id="5674534">p</span>&nbsp;<span class="op" id="5674536">*</span><span class="ident" id="5674537">printer</span><span class="op" id="5674544">)</span>&nbsp;<span class="ident" id="5674546">marshalStruct</span><span class="op" id="5674559">(</span><span class="ident" id="5674560">tinfo</span>&nbsp;<span class="op" id="5674566">*</span><span class="ident" id="5674567">typeInfo</span><span class="op" id="5674575">,</span>&nbsp;<span class="ident" id="5674577">val</span>&nbsp;<span class="ident" id="5674581">reflect</span><span class="op" id="5674588">.</span><span class="ident" id="5674589">Value</span><span class="op" id="5674594">)</span>&nbsp;<span class="builtintype" id="5674596">error</span>&nbsp;<span class="op" id="5674602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674605">s</span>&nbsp;<span class="op" id="5674607">:=</span>&nbsp;<span class="ident" id="5674610">parentStack</span><span class="op" id="5674621">{</span><span class="ident" id="5674622">p</span><span class="op" id="5674623">:</span>&nbsp;<span class="ident" id="5674625">p</span><span class="op" id="5674626">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674629">for</span>&nbsp;<span class="ident" id="5674633">i</span>&nbsp;<span class="op" id="5674635">:=</span>&nbsp;<span class="keyword" id="5674638">range</span>&nbsp;<span class="ident" id="5674644">tinfo</span><span class="op" id="5674649">.</span><span class="ident" id="5674650">fields</span>&nbsp;<span class="op" id="5674657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674661">finfo</span>&nbsp;<span class="op" id="5674667">:=</span>&nbsp;<span class="op" id="5674670">&amp;</span><span class="ident" id="5674671">tinfo</span><span class="op" id="5674676">.</span><span class="ident" id="5674677">fields</span><span class="op" id="5674683">[</span><span class="ident" id="5674684">i</span><span class="op" id="5674685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674689">if</span>&nbsp;<span class="ident" id="5674692">finfo</span><span class="op" id="5674697">.</span><span class="ident" id="5674698">flags</span><span class="op" id="5674703">&amp;</span><span class="ident" id="5674704">fAttr</span>&nbsp;<span class="op" id="5674710">!=</span>&nbsp;<span class="num" id="5674713">0</span>&nbsp;<span class="op" id="5674715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674720">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674731">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674735">vf</span>&nbsp;<span class="op" id="5674738">:=</span>&nbsp;<span class="ident" id="5674741">finfo</span><span class="op" id="5674746">.</span><span class="ident" id="5674747">value</span><span class="op" id="5674752">(</span><span class="ident" id="5674753">val</span><span class="op" id="5674756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674761">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674817">switch</span>&nbsp;<span class="ident" id="5674824">vf</span><span class="op" id="5674826">.</span><span class="ident" id="5674827">Kind</span><span class="op" id="5674831">(</span><span class="op" id="5674832">)</span>&nbsp;<span class="op" id="5674834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674838">case</span>&nbsp;<span class="ident" id="5674843">reflect</span><span class="op" id="5674850">.</span><span class="ident" id="5674851">Ptr</span><span class="op" id="5674854">,</span>&nbsp;<span class="ident" id="5674856">reflect</span><span class="op" id="5674863">.</span><span class="ident" id="5674864">Interface</span><span class="op" id="5674873">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674878">if</span>&nbsp;<span class="op" id="5674881">!</span><span class="ident" id="5674882">vf</span><span class="op" id="5674884">.</span><span class="ident" id="5674885">IsNil</span><span class="op" id="5674890">(</span><span class="op" id="5674891">)</span>&nbsp;<span class="op" id="5674893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674899">vf</span>&nbsp;<span class="op" id="5674902">=</span>&nbsp;<span class="ident" id="5674904">vf</span><span class="op" id="5674906">.</span><span class="ident" id="5674907">Elem</span><span class="op" id="5674911">(</span><span class="op" id="5674912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674926">switch</span>&nbsp;<span class="ident" id="5674933">finfo</span><span class="op" id="5674938">.</span><span class="ident" id="5674939">flags</span>&nbsp;<span class="op" id="5674945">&amp;</span>&nbsp;<span class="ident" id="5674947">fMode</span>&nbsp;<span class="op" id="5674953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674957">case</span>&nbsp;<span class="ident" id="5674962">fCharData</span><span class="op" id="5674971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674976">if</span>&nbsp;<span class="ident" id="5674979">vf</span><span class="op" id="5674981">.</span><span class="ident" id="5674982">CanInterface</span><span class="op" id="5674994">(</span><span class="op" id="5674995">)</span>&nbsp;<span class="op" id="5674997">&amp;&amp;</span>&nbsp;<span class="ident" id="5675000">vf</span><span class="op" id="5675002">.</span><span class="ident" id="5675003">Type</span><span class="op" id="5675007">(</span><span class="op" id="5675008">)</span><span class="op" id="5675009">.</span><span class="ident" id="5675010">Implements</span><span class="op" id="5675020">(</span><span class="ident" id="5675021">textMarshalerType</span><span class="op" id="5675038">)</span>&nbsp;<span class="op" id="5675040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675046">data</span><span class="op" id="5675050">,</span>&nbsp;<span class="ident" id="5675052">err</span>&nbsp;<span class="op" id="5675056">:=</span>&nbsp;<span class="ident" id="5675059">vf</span><span class="op" id="5675061">.</span><span class="ident" id="5675062">Interface</span><span class="op" id="5675071">(</span><span class="op" id="5675072">)</span><span class="op" id="5675073">.</span><span class="op" id="5675074">(</span><span class="ident" id="5675075">encoding</span><span class="op" id="5675083">.</span><span class="ident" id="5675084">TextMarshaler</span><span class="op" id="5675097">)</span><span class="op" id="5675098">.</span><span class="ident" id="5675099">MarshalText</span><span class="op" id="5675110">(</span><span class="op" id="5675111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675117">if</span>&nbsp;<span class="ident" id="5675120">err</span>&nbsp;<span class="op" id="5675124">!=</span>&nbsp;<span class="ident" id="5675127">nil</span>&nbsp;<span class="op" id="5675131">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675138">return</span>&nbsp;<span class="ident" id="5675145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675159">Escape</span><span class="op" id="5675165">(</span><span class="ident" id="5675166">p</span><span class="op" id="5675167">,</span>&nbsp;<span class="ident" id="5675169">data</span><span class="op" id="5675173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675179">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675191">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675196">if</span>&nbsp;<span class="ident" id="5675199">vf</span><span class="op" id="5675201">.</span><span class="ident" id="5675202">CanAddr</span><span class="op" id="5675209">(</span><span class="op" id="5675210">)</span>&nbsp;<span class="op" id="5675212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675218">pv</span>&nbsp;<span class="op" id="5675221">:=</span>&nbsp;<span class="ident" id="5675224">vf</span><span class="op" id="5675226">.</span><span class="ident" id="5675227">Addr</span><span class="op" id="5675231">(</span><span class="op" id="5675232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675238">if</span>&nbsp;<span class="ident" id="5675241">pv</span><span class="op" id="5675243">.</span><span class="ident" id="5675244">CanInterface</span><span class="op" id="5675256">(</span><span class="op" id="5675257">)</span>&nbsp;<span class="op" id="5675259">&amp;&amp;</span>&nbsp;<span class="ident" id="5675262">pv</span><span class="op" id="5675264">.</span><span class="ident" id="5675265">Type</span><span class="op" id="5675269">(</span><span class="op" id="5675270">)</span><span class="op" id="5675271">.</span><span class="ident" id="5675272">Implements</span><span class="op" id="5675282">(</span><span class="ident" id="5675283">textMarshalerType</span><span class="op" id="5675300">)</span>&nbsp;<span class="op" id="5675302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675309">data</span><span class="op" id="5675313">,</span>&nbsp;<span class="ident" id="5675315">err</span>&nbsp;<span class="op" id="5675319">:=</span>&nbsp;<span class="ident" id="5675322">pv</span><span class="op" id="5675324">.</span><span class="ident" id="5675325">Interface</span><span class="op" id="5675334">(</span><span class="op" id="5675335">)</span><span class="op" id="5675336">.</span><span class="op" id="5675337">(</span><span class="ident" id="5675338">encoding</span><span class="op" id="5675346">.</span><span class="ident" id="5675347">TextMarshaler</span><span class="op" id="5675360">)</span><span class="op" id="5675361">.</span><span class="ident" id="5675362">MarshalText</span><span class="op" id="5675373">(</span><span class="op" id="5675374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675381">if</span>&nbsp;<span class="ident" id="5675384">err</span>&nbsp;<span class="op" id="5675388">!=</span>&nbsp;<span class="ident" id="5675391">nil</span>&nbsp;<span class="op" id="5675395">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675403">return</span>&nbsp;<span class="ident" id="5675410">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675426">Escape</span><span class="op" id="5675432">(</span><span class="ident" id="5675433">p</span><span class="op" id="5675434">,</span>&nbsp;<span class="ident" id="5675436">data</span><span class="op" id="5675440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675447">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675460">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675470">var</span>&nbsp;<span class="ident" id="5675474">scratch</span>&nbsp;<span class="op" id="5675482">[</span><span class="num" id="5675483">64</span><span class="op" id="5675485">]</span><span class="builtintype" id="5675486">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675494">switch</span>&nbsp;<span class="ident" id="5675501">vf</span><span class="op" id="5675503">.</span><span class="ident" id="5675504">Kind</span><span class="op" id="5675508">(</span><span class="op" id="5675509">)</span>&nbsp;<span class="op" id="5675511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675516">case</span>&nbsp;<span class="ident" id="5675521">reflect</span><span class="op" id="5675528">.</span><span class="ident" id="5675529">Int</span><span class="op" id="5675532">,</span>&nbsp;<span class="ident" id="5675534">reflect</span><span class="op" id="5675541">.</span><span class="ident" id="5675542">Int8</span><span class="op" id="5675546">,</span>&nbsp;<span class="ident" id="5675548">reflect</span><span class="op" id="5675555">.</span><span class="ident" id="5675556">Int16</span><span class="op" id="5675561">,</span>&nbsp;<span class="ident" id="5675563">reflect</span><span class="op" id="5675570">.</span><span class="ident" id="5675571">Int32</span><span class="op" id="5675576">,</span>&nbsp;<span class="ident" id="5675578">reflect</span><span class="op" id="5675585">.</span><span class="ident" id="5675586">Int64</span><span class="op" id="5675591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675597">Escape</span><span class="op" id="5675603">(</span><span class="ident" id="5675604">p</span><span class="op" id="5675605">,</span>&nbsp;<span class="ident" id="5675607">strconv</span><span class="op" id="5675614">.</span><span class="ident" id="5675615">AppendInt</span><span class="op" id="5675624">(</span><span class="ident" id="5675625">scratch</span><span class="op" id="5675632">[</span><span class="op" id="5675633">:</span><span class="num" id="5675634">0</span><span class="op" id="5675635">]</span><span class="op" id="5675636">,</span>&nbsp;<span class="ident" id="5675638">vf</span><span class="op" id="5675640">.</span><span class="ident" id="5675641">Int</span><span class="op" id="5675644">(</span><span class="op" id="5675645">)</span><span class="op" id="5675646">,</span>&nbsp;<span class="num" id="5675648">10</span><span class="op" id="5675650">)</span><span class="op" id="5675651">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675656">case</span>&nbsp;<span class="ident" id="5675661">reflect</span><span class="op" id="5675668">.</span><span class="ident" id="5675669">Uint</span><span class="op" id="5675673">,</span>&nbsp;<span class="ident" id="5675675">reflect</span><span class="op" id="5675682">.</span><span class="ident" id="5675683">Uint8</span><span class="op" id="5675688">,</span>&nbsp;<span class="ident" id="5675690">reflect</span><span class="op" id="5675697">.</span><span class="ident" id="5675698">Uint16</span><span class="op" id="5675704">,</span>&nbsp;<span class="ident" id="5675706">reflect</span><span class="op" id="5675713">.</span><span class="ident" id="5675714">Uint32</span><span class="op" id="5675720">,</span>&nbsp;<span class="ident" id="5675722">reflect</span><span class="op" id="5675729">.</span><span class="ident" id="5675730">Uint64</span><span class="op" id="5675736">,</span>&nbsp;<span class="ident" id="5675738">reflect</span><span class="op" id="5675745">.</span><span class="ident" id="5675746">Uintptr</span><span class="op" id="5675753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675759">Escape</span><span class="op" id="5675765">(</span><span class="ident" id="5675766">p</span><span class="op" id="5675767">,</span>&nbsp;<span class="ident" id="5675769">strconv</span><span class="op" id="5675776">.</span><span class="ident" id="5675777">AppendUint</span><span class="op" id="5675787">(</span><span class="ident" id="5675788">scratch</span><span class="op" id="5675795">[</span><span class="op" id="5675796">:</span><span class="num" id="5675797">0</span><span class="op" id="5675798">]</span><span class="op" id="5675799">,</span>&nbsp;<span class="ident" id="5675801">vf</span><span class="op" id="5675803">.</span><span class="ident" id="5675804">Uint</span><span class="op" id="5675808">(</span><span class="op" id="5675809">)</span><span class="op" id="5675810">,</span>&nbsp;<span class="num" id="5675812">10</span><span class="op" id="5675814">)</span><span class="op" id="5675815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675820">case</span>&nbsp;<span class="ident" id="5675825">reflect</span><span class="op" id="5675832">.</span><span class="ident" id="5675833">Float32</span><span class="op" id="5675840">,</span>&nbsp;<span class="ident" id="5675842">reflect</span><span class="op" id="5675849">.</span><span class="ident" id="5675850">Float64</span><span class="op" id="5675857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675863">Escape</span><span class="op" id="5675869">(</span><span class="ident" id="5675870">p</span><span class="op" id="5675871">,</span>&nbsp;<span class="ident" id="5675873">strconv</span><span class="op" id="5675880">.</span><span class="ident" id="5675881">AppendFloat</span><span class="op" id="5675892">(</span><span class="ident" id="5675893">scratch</span><span class="op" id="5675900">[</span><span class="op" id="5675901">:</span><span class="num" id="5675902">0</span><span class="op" id="5675903">]</span><span class="op" id="5675904">,</span>&nbsp;<span class="ident" id="5675906">vf</span><span class="op" id="5675908">.</span><span class="ident" id="5675909">Float</span><span class="op" id="5675914">(</span><span class="op" id="5675915">)</span><span class="op" id="5675916">,</span>&nbsp;<span class="string" id="5675918">&#39;g&#39;</span><span class="op" id="5675921">,</span>&nbsp;<span class="op" id="5675923">-</span><span class="num" id="5675924">1</span><span class="op" id="5675925">,</span>&nbsp;<span class="ident" id="5675927">vf</span><span class="op" id="5675929">.</span><span class="ident" id="5675930">Type</span><span class="op" id="5675934">(</span><span class="op" id="5675935">)</span><span class="op" id="5675936">.</span><span class="ident" id="5675937">Bits</span><span class="op" id="5675941">(</span><span class="op" id="5675942">)</span><span class="op" id="5675943">)</span><span class="op" id="5675944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675949">case</span>&nbsp;<span class="ident" id="5675954">reflect</span><span class="op" id="5675961">.</span><span class="ident" id="5675962">Bool</span><span class="op" id="5675966">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675972">Escape</span><span class="op" id="5675978">(</span><span class="ident" id="5675979">p</span><span class="op" id="5675980">,</span>&nbsp;<span class="ident" id="5675982">strconv</span><span class="op" id="5675989">.</span><span class="ident" id="5675990">AppendBool</span><span class="op" id="5676000">(</span><span class="ident" id="5676001">scratch</span><span class="op" id="5676008">[</span><span class="op" id="5676009">:</span><span class="num" id="5676010">0</span><span class="op" id="5676011">]</span><span class="op" id="5676012">,</span>&nbsp;<span class="ident" id="5676014">vf</span><span class="op" id="5676016">.</span><span class="ident" id="5676017">Bool</span><span class="op" id="5676021">(</span><span class="op" id="5676022">)</span><span class="op" id="5676023">)</span><span class="op" id="5676024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676029">case</span>&nbsp;<span class="ident" id="5676034">reflect</span><span class="op" id="5676041">.</span><span class="ident" id="5676042">String</span><span class="op" id="5676048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676054">if</span>&nbsp;<span class="ident" id="5676057">err</span>&nbsp;<span class="op" id="5676061">:=</span>&nbsp;<span class="ident" id="5676064">EscapeText</span><span class="op" id="5676074">(</span><span class="ident" id="5676075">p</span><span class="op" id="5676076">,</span>&nbsp;<span class="op" id="5676078">[</span><span class="op" id="5676079">]</span><span class="builtintype" id="5676080">byte</span><span class="op" id="5676084">(</span><span class="ident" id="5676085">vf</span><span class="op" id="5676087">.</span><span class="ident" id="5676088">String</span><span class="op" id="5676094">(</span><span class="op" id="5676095">)</span><span class="op" id="5676096">)</span><span class="op" id="5676097">)</span><span class="op" id="5676098">;</span>&nbsp;<span class="ident" id="5676100">err</span>&nbsp;<span class="op" id="5676104">!=</span>&nbsp;<span class="ident" id="5676107">nil</span>&nbsp;<span class="op" id="5676111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676118">return</span>&nbsp;<span class="ident" id="5676125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676133">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676138">case</span>&nbsp;<span class="ident" id="5676143">reflect</span><span class="op" id="5676150">.</span><span class="ident" id="5676151">Slice</span><span class="op" id="5676156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676162">if</span>&nbsp;<span class="ident" id="5676165">elem</span><span class="op" id="5676169">,</span>&nbsp;<span class="ident" id="5676171">ok</span>&nbsp;<span class="op" id="5676174">:=</span>&nbsp;<span class="ident" id="5676177">vf</span><span class="op" id="5676179">.</span><span class="ident" id="5676180">Interface</span><span class="op" id="5676189">(</span><span class="op" id="5676190">)</span><span class="op" id="5676191">.</span><span class="op" id="5676192">(</span><span class="op" id="5676193">[</span><span class="op" id="5676194">]</span><span class="builtintype" id="5676195">byte</span><span class="op" id="5676199">)</span><span class="op" id="5676200">;</span>&nbsp;<span class="ident" id="5676202">ok</span>&nbsp;<span class="op" id="5676205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676212">if</span>&nbsp;<span class="ident" id="5676215">err</span>&nbsp;<span class="op" id="5676219">:=</span>&nbsp;<span class="ident" id="5676222">EscapeText</span><span class="op" id="5676232">(</span><span class="ident" id="5676233">p</span><span class="op" id="5676234">,</span>&nbsp;<span class="ident" id="5676236">elem</span><span class="op" id="5676240">)</span><span class="op" id="5676241">;</span>&nbsp;<span class="ident" id="5676243">err</span>&nbsp;<span class="op" id="5676247">!=</span>&nbsp;<span class="ident" id="5676250">nil</span>&nbsp;<span class="op" id="5676254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676262">return</span>&nbsp;<span class="ident" id="5676269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676278">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676294">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676306">case</span>&nbsp;<span class="ident" id="5676311">fComment</span><span class="op" id="5676319">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676324">k</span>&nbsp;<span class="op" id="5676326">:=</span>&nbsp;<span class="ident" id="5676329">vf</span><span class="op" id="5676331">.</span><span class="ident" id="5676332">Kind</span><span class="op" id="5676336">(</span><span class="op" id="5676337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676342">if</span>&nbsp;<span class="op" id="5676345">!</span><span class="op" id="5676346">(</span><span class="ident" id="5676347">k</span>&nbsp;<span class="op" id="5676349">==</span>&nbsp;<span class="ident" id="5676352">reflect</span><span class="op" id="5676359">.</span><span class="ident" id="5676360">String</span>&nbsp;<span class="op" id="5676367">||</span>&nbsp;<span class="ident" id="5676370">k</span>&nbsp;<span class="op" id="5676372">==</span>&nbsp;<span class="ident" id="5676375">reflect</span><span class="op" id="5676382">.</span><span class="ident" id="5676383">Slice</span>&nbsp;<span class="op" id="5676389">&amp;&amp;</span>&nbsp;<span class="ident" id="5676392">vf</span><span class="op" id="5676394">.</span><span class="ident" id="5676395">Type</span><span class="op" id="5676399">(</span><span class="op" id="5676400">)</span><span class="op" id="5676401">.</span><span class="ident" id="5676402">Elem</span><span class="op" id="5676406">(</span><span class="op" id="5676407">)</span><span class="op" id="5676408">.</span><span class="ident" id="5676409">Kind</span><span class="op" id="5676413">(</span><span class="op" id="5676414">)</span>&nbsp;<span class="op" id="5676416">==</span>&nbsp;<span class="ident" id="5676419">reflect</span><span class="op" id="5676426">.</span><span class="ident" id="5676427">Uint8</span><span class="op" id="5676432">)</span>&nbsp;<span class="op" id="5676434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676440">return</span>&nbsp;<span class="ident" id="5676447">fmt</span><span class="op" id="5676450">.</span><span class="ident" id="5676451">Errorf</span><span class="op" id="5676457">(</span><span class="string" id="5676458">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="5676497">,</span>&nbsp;<span class="ident" id="5676499">val</span><span class="op" id="5676502">.</span><span class="ident" id="5676503">Type</span><span class="op" id="5676507">(</span><span class="op" id="5676508">)</span><span class="op" id="5676509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676519">if</span>&nbsp;<span class="ident" id="5676522">vf</span><span class="op" id="5676524">.</span><span class="ident" id="5676525">Len</span><span class="op" id="5676528">(</span><span class="op" id="5676529">)</span>&nbsp;<span class="op" id="5676531">==</span>&nbsp;<span class="num" id="5676534">0</span>&nbsp;<span class="op" id="5676536">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676542">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676559">p</span><span class="op" id="5676560">.</span><span class="ident" id="5676561">writeIndent</span><span class="op" id="5676572">(</span><span class="num" id="5676573">0</span><span class="op" id="5676574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676579">p</span><span class="op" id="5676580">.</span><span class="ident" id="5676581">WriteString</span><span class="op" id="5676592">(</span><span class="string" id="5676593">&#34;&lt;!--&#34;</span><span class="op" id="5676599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676604">dashDash</span>&nbsp;<span class="op" id="5676613">:=</span>&nbsp;<span class="builtintype" id="5676616">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676625">dashLast</span>&nbsp;<span class="op" id="5676634">:=</span>&nbsp;<span class="builtintype" id="5676637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676646">switch</span>&nbsp;<span class="ident" id="5676653">k</span>&nbsp;<span class="op" id="5676655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676660">case</span>&nbsp;<span class="ident" id="5676665">reflect</span><span class="op" id="5676672">.</span><span class="ident" id="5676673">String</span><span class="op" id="5676679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676685">s</span>&nbsp;<span class="op" id="5676687">:=</span>&nbsp;<span class="ident" id="5676690">vf</span><span class="op" id="5676692">.</span><span class="ident" id="5676693">String</span><span class="op" id="5676699">(</span><span class="op" id="5676700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676706">dashDash</span>&nbsp;<span class="op" id="5676715">=</span>&nbsp;<span class="ident" id="5676717">strings</span><span class="op" id="5676724">.</span><span class="ident" id="5676725">Index</span><span class="op" id="5676730">(</span><span class="ident" id="5676731">s</span><span class="op" id="5676732">,</span>&nbsp;<span class="string" id="5676734">&#34;--&#34;</span><span class="op" id="5676738">)</span>&nbsp;<span class="op" id="5676740">&gt;=</span>&nbsp;<span class="num" id="5676743">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676749">dashLast</span>&nbsp;<span class="op" id="5676758">=</span>&nbsp;<span class="ident" id="5676760">s</span><span class="op" id="5676761">[</span><span class="builtinfunc" id="5676762">len</span><span class="op" id="5676765">(</span><span class="ident" id="5676766">s</span><span class="op" id="5676767">)</span><span class="op" id="5676768">-</span><span class="num" id="5676769">1</span><span class="op" id="5676770">]</span>&nbsp;<span class="op" id="5676772">==</span>&nbsp;<span class="string" id="5676775">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676783">if</span>&nbsp;<span class="op" id="5676786">!</span><span class="ident" id="5676787">dashDash</span>&nbsp;<span class="op" id="5676796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676803">p</span><span class="op" id="5676804">.</span><span class="ident" id="5676805">WriteString</span><span class="op" id="5676816">(</span><span class="ident" id="5676817">s</span><span class="op" id="5676818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676829">case</span>&nbsp;<span class="ident" id="5676834">reflect</span><span class="op" id="5676841">.</span><span class="ident" id="5676842">Slice</span><span class="op" id="5676847">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676853">b</span>&nbsp;<span class="op" id="5676855">:=</span>&nbsp;<span class="ident" id="5676858">vf</span><span class="op" id="5676860">.</span><span class="ident" id="5676861">Bytes</span><span class="op" id="5676866">(</span><span class="op" id="5676867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676873">dashDash</span>&nbsp;<span class="op" id="5676882">=</span>&nbsp;<span class="ident" id="5676884">bytes</span><span class="op" id="5676889">.</span><span class="ident" id="5676890">Index</span><span class="op" id="5676895">(</span><span class="ident" id="5676896">b</span><span class="op" id="5676897">,</span>&nbsp;<span class="ident" id="5676899">ddBytes</span><span class="op" id="5676906">)</span>&nbsp;<span class="op" id="5676908">&gt;=</span>&nbsp;<span class="num" id="5676911">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676917">dashLast</span>&nbsp;<span class="op" id="5676926">=</span>&nbsp;<span class="ident" id="5676928">b</span><span class="op" id="5676929">[</span><span class="builtinfunc" id="5676930">len</span><span class="op" id="5676933">(</span><span class="ident" id="5676934">b</span><span class="op" id="5676935">)</span><span class="op" id="5676936">-</span><span class="num" id="5676937">1</span><span class="op" id="5676938">]</span>&nbsp;<span class="op" id="5676940">==</span>&nbsp;<span class="string" id="5676943">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676951">if</span>&nbsp;<span class="op" id="5676954">!</span><span class="ident" id="5676955">dashDash</span>&nbsp;<span class="op" id="5676964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676971">p</span><span class="op" id="5676972">.</span><span class="ident" id="5676973">Write</span><span class="op" id="5676978">(</span><span class="ident" id="5676979">b</span><span class="op" id="5676980">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676991">default</span><span class="op" id="5676998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5677004">panic</span><span class="op" id="5677009">(</span><span class="string" id="5677010">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="5677024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677034">if</span>&nbsp;<span class="ident" id="5677037">dashDash</span>&nbsp;<span class="op" id="5677046">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677052">return</span>&nbsp;<span class="ident" id="5677059">fmt</span><span class="op" id="5677062">.</span><span class="ident" id="5677063">Errorf</span><span class="op" id="5677069">(</span><span class="string" id="5677070">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="5677107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677117">if</span>&nbsp;<span class="ident" id="5677120">dashLast</span>&nbsp;<span class="op" id="5677129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677135">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677185">p</span><span class="op" id="5677186">.</span><span class="ident" id="5677187">WriteByte</span><span class="op" id="5677196">(</span><span class="string" id="5677197">&#39;&nbsp;&#39;</span><span class="op" id="5677200">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677210">p</span><span class="op" id="5677211">.</span><span class="ident" id="5677212">WriteString</span><span class="op" id="5677223">(</span><span class="string" id="5677224">&#34;--&gt;&#34;</span><span class="op" id="5677229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677234">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677246">case</span>&nbsp;<span class="ident" id="5677251">fInnerXml</span><span class="op" id="5677260">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677265">iface</span>&nbsp;<span class="op" id="5677271">:=</span>&nbsp;<span class="ident" id="5677274">vf</span><span class="op" id="5677276">.</span><span class="ident" id="5677277">Interface</span><span class="op" id="5677286">(</span><span class="op" id="5677287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677292">switch</span>&nbsp;<span class="ident" id="5677299">raw</span>&nbsp;<span class="op" id="5677303">:=</span>&nbsp;<span class="ident" id="5677306">iface</span><span class="op" id="5677311">.</span><span class="op" id="5677312">(</span><span class="keyword" id="5677313">type</span><span class="op" id="5677317">)</span>&nbsp;<span class="op" id="5677319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677324">case</span>&nbsp;<span class="op" id="5677329">[</span><span class="op" id="5677330">]</span><span class="builtintype" id="5677331">byte</span><span class="op" id="5677335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677341">p</span><span class="op" id="5677342">.</span><span class="ident" id="5677343">Write</span><span class="op" id="5677348">(</span><span class="ident" id="5677349">raw</span><span class="op" id="5677352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677358">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677370">case</span>&nbsp;<span class="builtintype" id="5677375">string</span><span class="op" id="5677381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677387">p</span><span class="op" id="5677388">.</span><span class="ident" id="5677389">WriteString</span><span class="op" id="5677400">(</span><span class="ident" id="5677401">raw</span><span class="op" id="5677404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677410">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677427">case</span>&nbsp;<span class="ident" id="5677432">fElement</span><span class="op" id="5677440">,</span>&nbsp;<span class="ident" id="5677442">fElement</span>&nbsp;<span class="op" id="5677451">|</span>&nbsp;<span class="ident" id="5677453">fAny</span><span class="op" id="5677457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677462">if</span>&nbsp;<span class="ident" id="5677465">err</span>&nbsp;<span class="op" id="5677469">:=</span>&nbsp;<span class="ident" id="5677472">s</span><span class="op" id="5677473">.</span><span class="ident" id="5677474">trim</span><span class="op" id="5677478">(</span><span class="ident" id="5677479">finfo</span><span class="op" id="5677484">.</span><span class="ident" id="5677485">parents</span><span class="op" id="5677492">)</span><span class="op" id="5677493">;</span>&nbsp;<span class="ident" id="5677495">err</span>&nbsp;<span class="op" id="5677499">!=</span>&nbsp;<span class="ident" id="5677502">nil</span>&nbsp;<span class="op" id="5677506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677512">return</span>&nbsp;<span class="ident" id="5677519">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677531">if</span>&nbsp;<span class="builtinfunc" id="5677534">len</span><span class="op" id="5677537">(</span><span class="ident" id="5677538">finfo</span><span class="op" id="5677543">.</span><span class="ident" id="5677544">parents</span><span class="op" id="5677551">)</span>&nbsp;<span class="op" id="5677553">&gt;</span>&nbsp;<span class="builtinfunc" id="5677555">len</span><span class="op" id="5677558">(</span><span class="ident" id="5677559">s</span><span class="op" id="5677560">.</span><span class="ident" id="5677561">stack</span><span class="op" id="5677566">)</span>&nbsp;<span class="op" id="5677568">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677574">if</span>&nbsp;<span class="ident" id="5677577">vf</span><span class="op" id="5677579">.</span><span class="ident" id="5677580">Kind</span><span class="op" id="5677584">(</span><span class="op" id="5677585">)</span>&nbsp;<span class="op" id="5677587">!=</span>&nbsp;<span class="ident" id="5677590">reflect</span><span class="op" id="5677597">.</span><span class="ident" id="5677598">Ptr</span>&nbsp;<span class="op" id="5677602">&amp;&amp;</span>&nbsp;<span class="ident" id="5677605">vf</span><span class="op" id="5677607">.</span><span class="ident" id="5677608">Kind</span><span class="op" id="5677612">(</span><span class="op" id="5677613">)</span>&nbsp;<span class="op" id="5677615">!=</span>&nbsp;<span class="ident" id="5677618">reflect</span><span class="op" id="5677625">.</span><span class="ident" id="5677626">Interface</span>&nbsp;<span class="op" id="5677636">||</span>&nbsp;<span class="op" id="5677639">!</span><span class="ident" id="5677640">vf</span><span class="op" id="5677642">.</span><span class="ident" id="5677643">IsNil</span><span class="op" id="5677648">(</span><span class="op" id="5677649">)</span>&nbsp;<span class="op" id="5677651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677658">if</span>&nbsp;<span class="ident" id="5677661">err</span>&nbsp;<span class="op" id="5677665">:=</span>&nbsp;<span class="ident" id="5677668">s</span><span class="op" id="5677669">.</span><span class="ident" id="5677670">push</span><span class="op" id="5677674">(</span><span class="ident" id="5677675">finfo</span><span class="op" id="5677680">.</span><span class="ident" id="5677681">parents</span><span class="op" id="5677688">[</span><span class="builtinfunc" id="5677689">len</span><span class="op" id="5677692">(</span><span class="ident" id="5677693">s</span><span class="op" id="5677694">.</span><span class="ident" id="5677695">stack</span><span class="op" id="5677700">)</span><span class="op" id="5677701">:</span><span class="op" id="5677702">]</span><span class="op" id="5677703">)</span><span class="op" id="5677704">;</span>&nbsp;<span class="ident" id="5677706">err</span>&nbsp;<span class="op" id="5677710">!=</span>&nbsp;<span class="ident" id="5677713">nil</span>&nbsp;<span class="op" id="5677717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677725">return</span>&nbsp;<span class="ident" id="5677732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677747">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677760">if</span>&nbsp;<span class="ident" id="5677763">err</span>&nbsp;<span class="op" id="5677767">:=</span>&nbsp;<span class="ident" id="5677770">p</span><span class="op" id="5677771">.</span><span class="ident" id="5677772">marshalValue</span><span class="op" id="5677784">(</span><span class="ident" id="5677785">vf</span><span class="op" id="5677787">,</span>&nbsp;<span class="ident" id="5677789">finfo</span><span class="op" id="5677794">,</span>&nbsp;<span class="ident" id="5677796">nil</span><span class="op" id="5677799">)</span><span class="op" id="5677800">;</span>&nbsp;<span class="ident" id="5677802">err</span>&nbsp;<span class="op" id="5677806">!=</span>&nbsp;<span class="ident" id="5677809">nil</span>&nbsp;<span class="op" id="5677813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677818">return</span>&nbsp;<span class="ident" id="5677825">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677831">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677837">s</span><span class="op" id="5677838">.</span><span class="ident" id="5677839">trim</span><span class="op" id="5677843">(</span><span class="ident" id="5677844">nil</span><span class="op" id="5677847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677850">return</span>&nbsp;<span class="ident" id="5677857">p</span><span class="op" id="5677858">.</span><span class="ident" id="5677859">cachedWriteError</span><span class="op" id="5677875">(</span><span class="op" id="5677876">)</span><br>
<span class="lineno"></span><span class="op" id="5677878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5677881">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="5677929">func</span>&nbsp;<span class="op" id="5677934">(</span><span class="ident" id="5677935">p</span>&nbsp;<span class="op" id="5677937">*</span><span class="ident" id="5677938">printer</span><span class="op" id="5677945">)</span>&nbsp;<span class="ident" id="5677947">cachedWriteError</span><span class="op" id="5677963">(</span><span class="op" id="5677964">)</span>&nbsp;<span class="builtintype" id="5677966">error</span>&nbsp;<span class="op" id="5677972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677975">_</span><span class="op" id="5677976">,</span>&nbsp;<span class="ident" id="5677978">err</span>&nbsp;<span class="op" id="5677982">:=</span>&nbsp;<span class="ident" id="5677985">p</span><span class="op" id="5677986">.</span><span class="ident" id="5677987">Write</span><span class="op" id="5677992">(</span><span class="ident" id="5677993">nil</span><span class="op" id="5677996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677999">return</span>&nbsp;<span class="ident" id="5678006">err</span><br>
<span class="lineno"></span><span class="op" id="5678010">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5678013">func</span>&nbsp;<span class="op" id="5678018">(</span><span class="ident" id="5678019">p</span>&nbsp;<span class="op" id="5678021">*</span><span class="ident" id="5678022">printer</span><span class="op" id="5678029">)</span>&nbsp;<span class="ident" id="5678031">writeIndent</span><span class="op" id="5678042">(</span><span class="ident" id="5678043">depthDelta</span>&nbsp;<span class="builtintype" id="5678054">int</span><span class="op" id="5678057">)</span>&nbsp;<span class="op" id="5678059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678062">if</span>&nbsp;<span class="builtinfunc" id="5678065">len</span><span class="op" id="5678068">(</span><span class="ident" id="5678069">p</span><span class="op" id="5678070">.</span><span class="ident" id="5678071">prefix</span><span class="op" id="5678077">)</span>&nbsp;<span class="op" id="5678079">==</span>&nbsp;<span class="num" id="5678082">0</span>&nbsp;<span class="op" id="5678084">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5678087">len</span><span class="op" id="5678090">(</span><span class="ident" id="5678091">p</span><span class="op" id="5678092">.</span><span class="ident" id="5678093">indent</span><span class="op" id="5678099">)</span>&nbsp;<span class="op" id="5678101">==</span>&nbsp;<span class="num" id="5678104">0</span>&nbsp;<span class="op" id="5678106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678118">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678121">if</span>&nbsp;<span class="ident" id="5678124">depthDelta</span>&nbsp;<span class="op" id="5678135">&lt;</span>&nbsp;<span class="num" id="5678137">0</span>&nbsp;<span class="op" id="5678139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678143">p</span><span class="op" id="5678144">.</span><span class="ident" id="5678145">depth</span><span class="op" id="5678150">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678155">if</span>&nbsp;<span class="ident" id="5678158">p</span><span class="op" id="5678159">.</span><span class="ident" id="5678160">indentedIn</span>&nbsp;<span class="op" id="5678171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678176">p</span><span class="op" id="5678177">.</span><span class="ident" id="5678178">indentedIn</span>&nbsp;<span class="op" id="5678189">=</span>&nbsp;<span class="builtintype" id="5678191">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678200">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678213">p</span><span class="op" id="5678214">.</span><span class="ident" id="5678215">indentedIn</span>&nbsp;<span class="op" id="5678226">=</span>&nbsp;<span class="builtintype" id="5678228">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678238">if</span>&nbsp;<span class="ident" id="5678241">p</span><span class="op" id="5678242">.</span><span class="ident" id="5678243">putNewline</span>&nbsp;<span class="op" id="5678254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678258">p</span><span class="op" id="5678259">.</span><span class="ident" id="5678260">WriteByte</span><span class="op" id="5678269">(</span><span class="string" id="5678270">&#39;\n&#39;</span><span class="op" id="5678274">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678277">}</span>&nbsp;<span class="keyword" id="5678279">else</span>&nbsp;<span class="op" id="5678284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678288">p</span><span class="op" id="5678289">.</span><span class="ident" id="5678290">putNewline</span>&nbsp;<span class="op" id="5678301">=</span>&nbsp;<span class="builtintype" id="5678303">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678312">if</span>&nbsp;<span class="builtinfunc" id="5678315">len</span><span class="op" id="5678318">(</span><span class="ident" id="5678319">p</span><span class="op" id="5678320">.</span><span class="ident" id="5678321">prefix</span><span class="op" id="5678327">)</span>&nbsp;<span class="op" id="5678329">&gt;</span>&nbsp;<span class="num" id="5678331">0</span>&nbsp;<span class="op" id="5678333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678337">p</span><span class="op" id="5678338">.</span><span class="ident" id="5678339">WriteString</span><span class="op" id="5678350">(</span><span class="ident" id="5678351">p</span><span class="op" id="5678352">.</span><span class="ident" id="5678353">prefix</span><span class="op" id="5678359">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678365">if</span>&nbsp;<span class="builtinfunc" id="5678368">len</span><span class="op" id="5678371">(</span><span class="ident" id="5678372">p</span><span class="op" id="5678373">.</span><span class="ident" id="5678374">indent</span><span class="op" id="5678380">)</span>&nbsp;<span class="op" id="5678382">&gt;</span>&nbsp;<span class="num" id="5678384">0</span>&nbsp;<span class="op" id="5678386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678390">for</span>&nbsp;<span class="ident" id="5678394">i</span>&nbsp;<span class="op" id="5678396">:=</span>&nbsp;<span class="num" id="5678399">0</span><span class="op" id="5678400">;</span>&nbsp;<span class="ident" id="5678402">i</span>&nbsp;<span class="op" id="5678404">&lt;</span>&nbsp;<span class="ident" id="5678406">p</span><span class="op" id="5678407">.</span><span class="ident" id="5678408">depth</span><span class="op" id="5678413">;</span>&nbsp;<span class="ident" id="5678415">i</span><span class="op" id="5678416">++</span>&nbsp;<span class="op" id="5678419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678424">p</span><span class="op" id="5678425">.</span><span class="ident" id="5678426">WriteString</span><span class="op" id="5678437">(</span><span class="ident" id="5678438">p</span><span class="op" id="5678439">.</span><span class="ident" id="5678440">indent</span><span class="op" id="5678446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678450">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678456">if</span>&nbsp;<span class="ident" id="5678459">depthDelta</span>&nbsp;<span class="op" id="5678470">&gt;</span>&nbsp;<span class="num" id="5678472">0</span>&nbsp;<span class="op" id="5678474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678478">p</span><span class="op" id="5678479">.</span><span class="ident" id="5678480">depth</span><span class="op" id="5678485">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678490">p</span><span class="op" id="5678491">.</span><span class="ident" id="5678492">indentedIn</span>&nbsp;<span class="op" id="5678503">=</span>&nbsp;<span class="builtintype" id="5678505">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678511">}</span><br>
<span class="lineno">875</span><span class="op" id="5678513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678516">type</span>&nbsp;<span class="ident" id="5678521">parentStack</span>&nbsp;<span class="keyword" id="5678533">struct</span>&nbsp;<span class="op" id="5678540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678543">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5678549">*</span><span class="ident" id="5678550">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678559">stack</span>&nbsp;<span class="op" id="5678565">[</span><span class="op" id="5678566">]</span><span class="builtintype" id="5678567">string</span><br>
<span class="lineno">880</span><span class="op" id="5678574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5678577">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5678657">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="5678731">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="5678800">func</span>&nbsp;<span class="op" id="5678805">(</span><span class="ident" id="5678806">s</span>&nbsp;<span class="op" id="5678808">*</span><span class="ident" id="5678809">parentStack</span><span class="op" id="5678820">)</span>&nbsp;<span class="ident" id="5678822">trim</span><span class="op" id="5678826">(</span><span class="ident" id="5678827">parents</span>&nbsp;<span class="op" id="5678835">[</span><span class="op" id="5678836">]</span><span class="builtintype" id="5678837">string</span><span class="op" id="5678843">)</span>&nbsp;<span class="builtintype" id="5678845">error</span>&nbsp;<span class="op" id="5678851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678854">split</span>&nbsp;<span class="op" id="5678860">:=</span>&nbsp;<span class="num" id="5678863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678866">for</span>&nbsp;<span class="op" id="5678870">;</span>&nbsp;<span class="ident" id="5678872">split</span>&nbsp;<span class="op" id="5678878">&lt;</span>&nbsp;<span class="builtinfunc" id="5678880">len</span><span class="op" id="5678883">(</span><span class="ident" id="5678884">parents</span><span class="op" id="5678891">)</span>&nbsp;<span class="op" id="5678893">&amp;&amp;</span>&nbsp;<span class="ident" id="5678896">split</span>&nbsp;<span class="op" id="5678902">&lt;</span>&nbsp;<span class="builtinfunc" id="5678904">len</span><span class="op" id="5678907">(</span><span class="ident" id="5678908">s</span><span class="op" id="5678909">.</span><span class="ident" id="5678910">stack</span><span class="op" id="5678915">)</span><span class="op" id="5678916">;</span>&nbsp;<span class="ident" id="5678918">split</span><span class="op" id="5678923">++</span>&nbsp;<span class="op" id="5678926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678930">if</span>&nbsp;<span class="ident" id="5678933">parents</span><span class="op" id="5678940">[</span><span class="ident" id="5678941">split</span><span class="op" id="5678946">]</span>&nbsp;<span class="op" id="5678948">!=</span>&nbsp;<span class="ident" id="5678951">s</span><span class="op" id="5678952">.</span><span class="ident" id="5678953">stack</span><span class="op" id="5678958">[</span><span class="ident" id="5678959">split</span><span class="op" id="5678964">]</span>&nbsp;<span class="op" id="5678966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678971">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678985">for</span>&nbsp;<span class="ident" id="5678989">i</span>&nbsp;<span class="op" id="5678991">:=</span>&nbsp;<span class="builtinfunc" id="5678994">len</span><span class="op" id="5678997">(</span><span class="ident" id="5678998">s</span><span class="op" id="5678999">.</span><span class="ident" id="5679000">stack</span><span class="op" id="5679005">)</span>&nbsp;<span class="op" id="5679007">-</span>&nbsp;<span class="num" id="5679009">1</span><span class="op" id="5679010">;</span>&nbsp;<span class="ident" id="5679012">i</span>&nbsp;<span class="op" id="5679014">&gt;=</span>&nbsp;<span class="ident" id="5679017">split</span><span class="op" id="5679022">;</span>&nbsp;<span class="ident" id="5679024">i</span><span class="op" id="5679025">--</span>&nbsp;<span class="op" id="5679028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679032">if</span>&nbsp;<span class="ident" id="5679035">err</span>&nbsp;<span class="op" id="5679039">:=</span>&nbsp;<span class="ident" id="5679042">s</span><span class="op" id="5679043">.</span><span class="ident" id="5679044">p</span><span class="op" id="5679045">.</span><span class="ident" id="5679046">writeEnd</span><span class="op" id="5679054">(</span><span class="ident" id="5679055">Name</span><span class="op" id="5679059">{</span><span class="ident" id="5679060">Local</span><span class="op" id="5679065">:</span>&nbsp;<span class="ident" id="5679067">s</span><span class="op" id="5679068">.</span><span class="ident" id="5679069">stack</span><span class="op" id="5679074">[</span><span class="ident" id="5679075">i</span><span class="op" id="5679076">]</span><span class="op" id="5679077">}</span><span class="op" id="5679078">)</span><span class="op" id="5679079">;</span>&nbsp;<span class="ident" id="5679081">err</span>&nbsp;<span class="op" id="5679085">!=</span>&nbsp;<span class="ident" id="5679088">nil</span>&nbsp;<span class="op" id="5679092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679097">return</span>&nbsp;<span class="ident" id="5679104">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679116">s</span><span class="op" id="5679117">.</span><span class="ident" id="5679118">stack</span>&nbsp;<span class="op" id="5679124">=</span>&nbsp;<span class="ident" id="5679126">parents</span><span class="op" id="5679133">[</span><span class="op" id="5679134">:</span><span class="ident" id="5679135">split</span><span class="op" id="5679140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679143">return</span>&nbsp;<span class="ident" id="5679150">nil</span><br>
<span class="lineno"></span><span class="op" id="5679154">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="5679157">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="5679221">func</span>&nbsp;<span class="op" id="5679226">(</span><span class="ident" id="5679227">s</span>&nbsp;<span class="op" id="5679229">*</span><span class="ident" id="5679230">parentStack</span><span class="op" id="5679241">)</span>&nbsp;<span class="ident" id="5679243">push</span><span class="op" id="5679247">(</span><span class="ident" id="5679248">parents</span>&nbsp;<span class="op" id="5679256">[</span><span class="op" id="5679257">]</span><span class="builtintype" id="5679258">string</span><span class="op" id="5679264">)</span>&nbsp;<span class="builtintype" id="5679266">error</span>&nbsp;<span class="op" id="5679272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679275">for</span>&nbsp;<span class="ident" id="5679279">i</span>&nbsp;<span class="op" id="5679281">:=</span>&nbsp;<span class="num" id="5679284">0</span><span class="op" id="5679285">;</span>&nbsp;<span class="ident" id="5679287">i</span>&nbsp;<span class="op" id="5679289">&lt;</span>&nbsp;<span class="builtinfunc" id="5679291">len</span><span class="op" id="5679294">(</span><span class="ident" id="5679295">parents</span><span class="op" id="5679302">)</span><span class="op" id="5679303">;</span>&nbsp;<span class="ident" id="5679305">i</span><span class="op" id="5679306">++</span>&nbsp;<span class="op" id="5679309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679313">if</span>&nbsp;<span class="ident" id="5679316">err</span>&nbsp;<span class="op" id="5679320">:=</span>&nbsp;<span class="ident" id="5679323">s</span><span class="op" id="5679324">.</span><span class="ident" id="5679325">p</span><span class="op" id="5679326">.</span><span class="ident" id="5679327">writeStart</span><span class="op" id="5679337">(</span><span class="op" id="5679338">&amp;</span><span class="ident" id="5679339">StartElement</span><span class="op" id="5679351">{</span><span class="ident" id="5679352">Name</span><span class="op" id="5679356">:</span>&nbsp;<span class="ident" id="5679358">Name</span><span class="op" id="5679362">{</span><span class="ident" id="5679363">Local</span><span class="op" id="5679368">:</span>&nbsp;<span class="ident" id="5679370">parents</span><span class="op" id="5679377">[</span><span class="ident" id="5679378">i</span><span class="op" id="5679379">]</span><span class="op" id="5679380">}</span><span class="op" id="5679381">}</span><span class="op" id="5679382">)</span><span class="op" id="5679383">;</span>&nbsp;<span class="ident" id="5679385">err</span>&nbsp;<span class="op" id="5679389">!=</span>&nbsp;<span class="ident" id="5679392">nil</span>&nbsp;<span class="op" id="5679396">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679401">return</span>&nbsp;<span class="ident" id="5679408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679420">s</span><span class="op" id="5679421">.</span><span class="ident" id="5679422">stack</span>&nbsp;<span class="op" id="5679428">=</span>&nbsp;<span class="builtinfunc" id="5679430">append</span><span class="op" id="5679436">(</span><span class="ident" id="5679437">s</span><span class="op" id="5679438">.</span><span class="ident" id="5679439">stack</span><span class="op" id="5679444">,</span>&nbsp;<span class="ident" id="5679446">parents</span><span class="op" id="5679453">...</span><span class="op" id="5679456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679459">return</span>&nbsp;<span class="ident" id="5679466">nil</span><br>
<span class="lineno">910</span><span class="op" id="5679470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5679473">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5679537">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="5679575">type</span>&nbsp;<span class="ident" id="5679580">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="5679601">struct</span>&nbsp;<span class="op" id="5679608">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679611">Type</span>&nbsp;<span class="ident" id="5679616">reflect</span><span class="op" id="5679623">.</span><span class="ident" id="5679624">Type</span><br>
<span class="lineno"></span><span class="op" id="5679629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5679632">func</span>&nbsp;<span class="op" id="5679637">(</span><span class="ident" id="5679638">e</span>&nbsp;<span class="op" id="5679640">*</span><span class="ident" id="5679641">UnsupportedTypeError</span><span class="op" id="5679661">)</span>&nbsp;<span class="ident" id="5679663">Error</span><span class="op" id="5679668">(</span><span class="op" id="5679669">)</span>&nbsp;<span class="builtintype" id="5679671">string</span>&nbsp;<span class="op" id="5679678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679681">return</span>&nbsp;<span class="string" id="5679688">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5679714">+</span>&nbsp;<span class="ident" id="5679716">e</span><span class="op" id="5679717">.</span><span class="ident" id="5679718">Type</span><span class="op" id="5679722">.</span><span class="ident" id="5679723">String</span><span class="op" id="5679729">(</span><span class="op" id="5679730">)</span><br>
<span class="lineno">920</span><span class="op" id="5679732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5679735">func</span>&nbsp;<span class="ident" id="5679740">isEmptyValue</span><span class="op" id="5679752">(</span><span class="ident" id="5679753">v</span>&nbsp;<span class="ident" id="5679755">reflect</span><span class="op" id="5679762">.</span><span class="ident" id="5679763">Value</span><span class="op" id="5679768">)</span>&nbsp;<span class="builtintype" id="5679770">bool</span>&nbsp;<span class="op" id="5679775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679778">switch</span>&nbsp;<span class="ident" id="5679785">v</span><span class="op" id="5679786">.</span><span class="ident" id="5679787">Kind</span><span class="op" id="5679791">(</span><span class="op" id="5679792">)</span>&nbsp;<span class="op" id="5679794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679797">case</span>&nbsp;<span class="ident" id="5679802">reflect</span><span class="op" id="5679809">.</span><span class="ident" id="5679810">Array</span><span class="op" id="5679815">,</span>&nbsp;<span class="ident" id="5679817">reflect</span><span class="op" id="5679824">.</span><span class="ident" id="5679825">Map</span><span class="op" id="5679828">,</span>&nbsp;<span class="ident" id="5679830">reflect</span><span class="op" id="5679837">.</span><span class="ident" id="5679838">Slice</span><span class="op" id="5679843">,</span>&nbsp;<span class="ident" id="5679845">reflect</span><span class="op" id="5679852">.</span><span class="ident" id="5679853">String</span><span class="op" id="5679859">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679863">return</span>&nbsp;<span class="ident" id="5679870">v</span><span class="op" id="5679871">.</span><span class="ident" id="5679872">Len</span><span class="op" id="5679875">(</span><span class="op" id="5679876">)</span>&nbsp;<span class="op" id="5679878">==</span>&nbsp;<span class="num" id="5679881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679884">case</span>&nbsp;<span class="ident" id="5679889">reflect</span><span class="op" id="5679896">.</span><span class="ident" id="5679897">Bool</span><span class="op" id="5679901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679905">return</span>&nbsp;<span class="op" id="5679912">!</span><span class="ident" id="5679913">v</span><span class="op" id="5679914">.</span><span class="ident" id="5679915">Bool</span><span class="op" id="5679919">(</span><span class="op" id="5679920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679923">case</span>&nbsp;<span class="ident" id="5679928">reflect</span><span class="op" id="5679935">.</span><span class="ident" id="5679936">Int</span><span class="op" id="5679939">,</span>&nbsp;<span class="ident" id="5679941">reflect</span><span class="op" id="5679948">.</span><span class="ident" id="5679949">Int8</span><span class="op" id="5679953">,</span>&nbsp;<span class="ident" id="5679955">reflect</span><span class="op" id="5679962">.</span><span class="ident" id="5679963">Int16</span><span class="op" id="5679968">,</span>&nbsp;<span class="ident" id="5679970">reflect</span><span class="op" id="5679977">.</span><span class="ident" id="5679978">Int32</span><span class="op" id="5679983">,</span>&nbsp;<span class="ident" id="5679985">reflect</span><span class="op" id="5679992">.</span><span class="ident" id="5679993">Int64</span><span class="op" id="5679998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680002">return</span>&nbsp;<span class="ident" id="5680009">v</span><span class="op" id="5680010">.</span><span class="ident" id="5680011">Int</span><span class="op" id="5680014">(</span><span class="op" id="5680015">)</span>&nbsp;<span class="op" id="5680017">==</span>&nbsp;<span class="num" id="5680020">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680023">case</span>&nbsp;<span class="ident" id="5680028">reflect</span><span class="op" id="5680035">.</span><span class="ident" id="5680036">Uint</span><span class="op" id="5680040">,</span>&nbsp;<span class="ident" id="5680042">reflect</span><span class="op" id="5680049">.</span><span class="ident" id="5680050">Uint8</span><span class="op" id="5680055">,</span>&nbsp;<span class="ident" id="5680057">reflect</span><span class="op" id="5680064">.</span><span class="ident" id="5680065">Uint16</span><span class="op" id="5680071">,</span>&nbsp;<span class="ident" id="5680073">reflect</span><span class="op" id="5680080">.</span><span class="ident" id="5680081">Uint32</span><span class="op" id="5680087">,</span>&nbsp;<span class="ident" id="5680089">reflect</span><span class="op" id="5680096">.</span><span class="ident" id="5680097">Uint64</span><span class="op" id="5680103">,</span>&nbsp;<span class="ident" id="5680105">reflect</span><span class="op" id="5680112">.</span><span class="ident" id="5680113">Uintptr</span><span class="op" id="5680120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680124">return</span>&nbsp;<span class="ident" id="5680131">v</span><span class="op" id="5680132">.</span><span class="ident" id="5680133">Uint</span><span class="op" id="5680137">(</span><span class="op" id="5680138">)</span>&nbsp;<span class="op" id="5680140">==</span>&nbsp;<span class="num" id="5680143">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680146">case</span>&nbsp;<span class="ident" id="5680151">reflect</span><span class="op" id="5680158">.</span><span class="ident" id="5680159">Float32</span><span class="op" id="5680166">,</span>&nbsp;<span class="ident" id="5680168">reflect</span><span class="op" id="5680175">.</span><span class="ident" id="5680176">Float64</span><span class="op" id="5680183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680187">return</span>&nbsp;<span class="ident" id="5680194">v</span><span class="op" id="5680195">.</span><span class="ident" id="5680196">Float</span><span class="op" id="5680201">(</span><span class="op" id="5680202">)</span>&nbsp;<span class="op" id="5680204">==</span>&nbsp;<span class="num" id="5680207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680210">case</span>&nbsp;<span class="ident" id="5680215">reflect</span><span class="op" id="5680222">.</span><span class="ident" id="5680223">Interface</span><span class="op" id="5680232">,</span>&nbsp;<span class="ident" id="5680234">reflect</span><span class="op" id="5680241">.</span><span class="ident" id="5680242">Ptr</span><span class="op" id="5680245">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680249">return</span>&nbsp;<span class="ident" id="5680256">v</span><span class="op" id="5680257">.</span><span class="ident" id="5680258">IsNil</span><span class="op" id="5680263">(</span><span class="op" id="5680264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680270">return</span>&nbsp;<span class="builtintype" id="5680277">false</span><br>
<span class="lineno"></span><span class="op" id="5680283">}</span>
</div>
</body>
</html>
