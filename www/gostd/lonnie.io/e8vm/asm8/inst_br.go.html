<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5091742">package</span>&nbsp;<span class="ident" id="5091750">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5091756">import</span>&nbsp;<span class="op" id="5091763">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5091766">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5091788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5091791">var</span>&nbsp;<span class="op" id="5091795">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5091798">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091819">opBrMap</span>&nbsp;<span class="op" id="5091827">=</span>&nbsp;<span class="keyword" id="5091829">map</span><span class="op" id="5091832">[</span><span class="builtintype" id="5091833">string</span><span class="op" id="5091839">]</span><span class="builtintype" id="5091840">uint32</span><span class="op" id="5091846">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5091850">&#34;bne&#34;</span><span class="op" id="5091855">:</span>&nbsp;<span class="num" id="5091857">32</span><span class="op" id="5091859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5091863">&#34;beq&#34;</span><span class="op" id="5091868">:</span>&nbsp;<span class="num" id="5091870">33</span><span class="op" id="5091872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091875">}</span><br>
<span class="lineno"></span><span class="op" id="5091877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5091880">func</span>&nbsp;<span class="ident" id="5091885">makeInstBr</span><span class="op" id="5091895">(</span><span class="ident" id="5091896">op</span><span class="op" id="5091898">,</span>&nbsp;<span class="ident" id="5091900">s1</span><span class="op" id="5091902">,</span>&nbsp;<span class="ident" id="5091904">s2</span>&nbsp;<span class="builtintype" id="5091907">uint32</span><span class="op" id="5091913">)</span>&nbsp;<span class="op" id="5091915">*</span><span class="ident" id="5091916">inst</span>&nbsp;<span class="op" id="5091921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091924">ret</span>&nbsp;<span class="op" id="5091928">:=</span>&nbsp;<span class="op" id="5091931">(</span><span class="ident" id="5091932">op</span>&nbsp;<span class="op" id="5091935">&amp;</span>&nbsp;<span class="num" id="5091937">0xff</span><span class="op" id="5091941">)</span>&nbsp;<span class="op" id="5091943">&lt;&lt;</span>&nbsp;<span class="num" id="5091946">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091950">ret</span>&nbsp;<span class="op" id="5091954">|=</span>&nbsp;<span class="op" id="5091957">(</span><span class="ident" id="5091958">s1</span>&nbsp;<span class="op" id="5091961">&amp;</span>&nbsp;<span class="num" id="5091963">0x7</span><span class="op" id="5091966">)</span>&nbsp;<span class="op" id="5091968">&lt;&lt;</span>&nbsp;<span class="num" id="5091971">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091975">ret</span>&nbsp;<span class="op" id="5091979">|=</span>&nbsp;<span class="op" id="5091982">(</span><span class="ident" id="5091983">s2</span>&nbsp;<span class="op" id="5091986">&amp;</span>&nbsp;<span class="num" id="5091988">0x7</span><span class="op" id="5091991">)</span>&nbsp;<span class="op" id="5091993">&lt;&lt;</span>&nbsp;<span class="num" id="5091996">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092000">return</span>&nbsp;<span class="op" id="5092007">&amp;</span><span class="ident" id="5092008">inst</span><span class="op" id="5092012">{</span><span class="ident" id="5092013">inst</span><span class="op" id="5092017">:</span>&nbsp;<span class="ident" id="5092019">ret</span><span class="op" id="5092022">}</span><br>
<span class="lineno">20</span><span class="op" id="5092024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5092027">func</span>&nbsp;<span class="ident" id="5092032">parseInstBr</span><span class="op" id="5092043">(</span><span class="ident" id="5092044">p</span>&nbsp;<span class="op" id="5092046">*</span><span class="ident" id="5092047">parser</span><span class="op" id="5092053">,</span>&nbsp;<span class="ident" id="5092055">ops</span>&nbsp;<span class="op" id="5092059">[</span><span class="op" id="5092060">]</span><span class="op" id="5092061">*</span><span class="ident" id="5092062">lex8</span><span class="op" id="5092066">.</span><span class="ident" id="5092067">Token</span><span class="op" id="5092072">)</span>&nbsp;<span class="op" id="5092074">(</span><span class="op" id="5092075">*</span><span class="ident" id="5092076">inst</span><span class="op" id="5092080">,</span>&nbsp;<span class="builtintype" id="5092082">bool</span><span class="op" id="5092086">)</span>&nbsp;<span class="op" id="5092088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092091">op0</span>&nbsp;<span class="op" id="5092095">:=</span>&nbsp;<span class="ident" id="5092098">ops</span><span class="op" id="5092101">[</span><span class="num" id="5092102">0</span><span class="op" id="5092103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092106">opName</span>&nbsp;<span class="op" id="5092113">:=</span>&nbsp;<span class="ident" id="5092116">op0</span><span class="op" id="5092119">.</span><span class="ident" id="5092120">Lit</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092125">args</span>&nbsp;<span class="op" id="5092130">:=</span>&nbsp;<span class="ident" id="5092133">ops</span><span class="op" id="5092136">[</span><span class="num" id="5092137">1</span><span class="op" id="5092138">:</span><span class="op" id="5092139">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092143">var</span>&nbsp;<span class="op" id="5092147">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092151">op</span><span class="op" id="5092153">,</span>&nbsp;<span class="ident" id="5092155">s1</span><span class="op" id="5092157">,</span>&nbsp;<span class="ident" id="5092159">s2</span>&nbsp;<span class="builtintype" id="5092162">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092171">lab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5092182">string</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092191">symTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092202">*</span><span class="ident" id="5092203">lex8</span><span class="op" id="5092207">.</span><span class="ident" id="5092208">Token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092217">found</span>&nbsp;<span class="builtintype" id="5092223">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092233">if</span>&nbsp;<span class="ident" id="5092236">op</span><span class="op" id="5092238">,</span>&nbsp;<span class="ident" id="5092240">found</span>&nbsp;<span class="op" id="5092246">=</span>&nbsp;<span class="ident" id="5092248">opBrMap</span><span class="op" id="5092255">[</span><span class="ident" id="5092256">opName</span><span class="op" id="5092262">]</span><span class="op" id="5092263">;</span>&nbsp;<span class="ident" id="5092265">found</span>&nbsp;<span class="op" id="5092271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5092275">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092297">if</span>&nbsp;<span class="ident" id="5092300">argCount</span><span class="op" id="5092308">(</span><span class="ident" id="5092309">p</span><span class="op" id="5092310">,</span>&nbsp;<span class="ident" id="5092312">ops</span><span class="op" id="5092315">,</span>&nbsp;<span class="num" id="5092317">3</span><span class="op" id="5092318">)</span>&nbsp;<span class="op" id="5092320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092325">s1</span>&nbsp;<span class="op" id="5092328">=</span>&nbsp;<span class="ident" id="5092330">parseReg</span><span class="op" id="5092338">(</span><span class="ident" id="5092339">p</span><span class="op" id="5092340">,</span>&nbsp;<span class="ident" id="5092342">args</span><span class="op" id="5092346">[</span><span class="num" id="5092347">0</span><span class="op" id="5092348">]</span><span class="op" id="5092349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092354">s2</span>&nbsp;<span class="op" id="5092357">=</span>&nbsp;<span class="ident" id="5092359">parseReg</span><span class="op" id="5092367">(</span><span class="ident" id="5092368">p</span><span class="op" id="5092369">,</span>&nbsp;<span class="ident" id="5092371">args</span><span class="op" id="5092375">[</span><span class="num" id="5092376">1</span><span class="op" id="5092377">]</span><span class="op" id="5092378">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092383">symTok</span>&nbsp;<span class="op" id="5092390">=</span>&nbsp;<span class="ident" id="5092392">args</span><span class="op" id="5092396">[</span><span class="num" id="5092397">2</span><span class="op" id="5092398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092403">if</span>&nbsp;<span class="ident" id="5092406">parseLabel</span><span class="op" id="5092416">(</span><span class="ident" id="5092417">p</span><span class="op" id="5092418">,</span>&nbsp;<span class="ident" id="5092420">symTok</span><span class="op" id="5092426">)</span>&nbsp;<span class="op" id="5092428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092434">lab</span>&nbsp;<span class="op" id="5092438">=</span>&nbsp;<span class="ident" id="5092440">symTok</span><span class="op" id="5092446">.</span><span class="ident" id="5092447">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092454">}</span>&nbsp;<span class="keyword" id="5092456">else</span>&nbsp;<span class="op" id="5092461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092467">p</span><span class="op" id="5092468">.</span><span class="ident" id="5092469">err</span><span class="op" id="5092472">(</span><span class="ident" id="5092473">symTok</span><span class="op" id="5092479">.</span><span class="ident" id="5092480">Pos</span><span class="op" id="5092483">,</span>&nbsp;<span class="string" id="5092485">&#34;expects&nbsp;a&nbsp;label&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5092509">,</span>&nbsp;<span class="ident" id="5092511">opName</span><span class="op" id="5092517">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092529">}</span>&nbsp;<span class="keyword" id="5092531">else</span>&nbsp;<span class="op" id="5092536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092540">return</span>&nbsp;<span class="ident" id="5092547">nil</span><span class="op" id="5092550">,</span>&nbsp;<span class="builtintype" id="5092552">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092559">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092563">ret</span>&nbsp;<span class="op" id="5092567">:=</span>&nbsp;<span class="ident" id="5092570">makeInstBr</span><span class="op" id="5092580">(</span><span class="ident" id="5092581">op</span><span class="op" id="5092583">,</span>&nbsp;<span class="ident" id="5092585">s1</span><span class="op" id="5092587">,</span>&nbsp;<span class="ident" id="5092589">s2</span><span class="op" id="5092591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092594">ret</span><span class="op" id="5092597">.</span><span class="ident" id="5092598">symbol</span>&nbsp;<span class="op" id="5092605">=</span>&nbsp;<span class="ident" id="5092607">lab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092612">ret</span><span class="op" id="5092615">.</span><span class="ident" id="5092616">fill</span>&nbsp;<span class="op" id="5092621">=</span>&nbsp;<span class="ident" id="5092623">fillLabel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092634">ret</span><span class="op" id="5092637">.</span><span class="ident" id="5092638">symTok</span>&nbsp;<span class="op" id="5092645">=</span>&nbsp;<span class="ident" id="5092647">symTok</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092656">return</span>&nbsp;<span class="ident" id="5092663">ret</span><span class="op" id="5092666">,</span>&nbsp;<span class="builtintype" id="5092668">true</span><br>
<span class="lineno"></span><span class="op" id="5092673">}</span>
</div>
</body>
</html>
