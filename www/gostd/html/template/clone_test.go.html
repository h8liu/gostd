<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html" class="current">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7797480">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7797535">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7797589">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7797640">package</span>&nbsp;<span class="ident" id="7797648">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7797658">import</span>&nbsp;<span class="op" id="7797665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7797668">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7797677">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7797687">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7797700">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7797711">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7797733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7797736">func</span>&nbsp;<span class="ident" id="7797741">TestAddParseTree</span><span class="op" id="7797757">(</span><span class="ident" id="7797758">t</span>&nbsp;<span class="op" id="7797760">*</span><span class="ident" id="7797761">testing</span><span class="op" id="7797768">.</span><span class="ident" id="7797769">T</span><span class="op" id="7797770">)</span>&nbsp;<span class="op" id="7797772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7797775">root</span>&nbsp;<span class="op" id="7797780">:=</span>&nbsp;<span class="ident" id="7797783">Must</span><span class="op" id="7797787">(</span><span class="ident" id="7797788">New</span><span class="op" id="7797791">(</span><span class="string" id="7797792">&#34;root&#34;</span><span class="op" id="7797798">)</span><span class="op" id="7797799">.</span><span class="ident" id="7797800">Parse</span><span class="op" id="7797805">(</span><span class="string" id="7797806">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7797865">)</span><span class="op" id="7797866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7797869">tree</span><span class="op" id="7797873">,</span>&nbsp;<span class="ident" id="7797875">err</span>&nbsp;<span class="op" id="7797879">:=</span>&nbsp;<span class="ident" id="7797882">parse</span><span class="op" id="7797887">.</span><span class="ident" id="7797888">Parse</span><span class="op" id="7797893">(</span><span class="string" id="7797894">&#34;t&#34;</span><span class="op" id="7797897">,</span>&nbsp;<span class="string" id="7797899">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7797931">,</span>&nbsp;<span class="string" id="7797933">&#34;&#34;</span><span class="op" id="7797935">,</span>&nbsp;<span class="string" id="7797937">&#34;&#34;</span><span class="op" id="7797939">,</span>&nbsp;<span class="ident" id="7797941">nil</span><span class="op" id="7797944">,</span>&nbsp;<span class="ident" id="7797946">nil</span><span class="op" id="7797949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7797952">if</span>&nbsp;<span class="ident" id="7797955">err</span>&nbsp;<span class="op" id="7797959">!=</span>&nbsp;<span class="ident" id="7797962">nil</span>&nbsp;<span class="op" id="7797966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7797970">t</span><span class="op" id="7797971">.</span><span class="ident" id="7797972">Fatal</span><span class="op" id="7797977">(</span><span class="ident" id="7797978">err</span><span class="op" id="7797981">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7797984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7797987">added</span>&nbsp;<span class="op" id="7797993">:=</span>&nbsp;<span class="ident" id="7797996">Must</span><span class="op" id="7798000">(</span><span class="ident" id="7798001">root</span><span class="op" id="7798005">.</span><span class="ident" id="7798006">AddParseTree</span><span class="op" id="7798018">(</span><span class="string" id="7798019">&#34;b&#34;</span><span class="op" id="7798022">,</span>&nbsp;<span class="ident" id="7798024">tree</span><span class="op" id="7798028">[</span><span class="string" id="7798029">&#34;b&#34;</span><span class="op" id="7798032">]</span><span class="op" id="7798033">)</span><span class="op" id="7798034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798037">b</span>&nbsp;<span class="op" id="7798039">:=</span>&nbsp;<span class="builtinfunc" id="7798042">new</span><span class="op" id="7798045">(</span><span class="ident" id="7798046">bytes</span><span class="op" id="7798051">.</span><span class="ident" id="7798052">Buffer</span><span class="op" id="7798058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798061">err</span>&nbsp;<span class="op" id="7798065">=</span>&nbsp;<span class="ident" id="7798067">added</span><span class="op" id="7798072">.</span><span class="ident" id="7798073">ExecuteTemplate</span><span class="op" id="7798088">(</span><span class="ident" id="7798089">b</span><span class="op" id="7798090">,</span>&nbsp;<span class="string" id="7798092">&#34;a&#34;</span><span class="op" id="7798095">,</span>&nbsp;<span class="string" id="7798097">&#34;1&gt;0&#34;</span><span class="op" id="7798102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7798105">if</span>&nbsp;<span class="ident" id="7798108">err</span>&nbsp;<span class="op" id="7798112">!=</span>&nbsp;<span class="ident" id="7798115">nil</span>&nbsp;<span class="op" id="7798119">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798123">t</span><span class="op" id="7798124">.</span><span class="ident" id="7798125">Fatal</span><span class="op" id="7798130">(</span><span class="ident" id="7798131">err</span><span class="op" id="7798134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7798137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7798140">if</span>&nbsp;<span class="ident" id="7798143">got</span><span class="op" id="7798146">,</span>&nbsp;<span class="ident" id="7798148">want</span>&nbsp;<span class="op" id="7798153">:=</span>&nbsp;<span class="ident" id="7798156">b</span><span class="op" id="7798157">.</span><span class="ident" id="7798158">String</span><span class="op" id="7798164">(</span><span class="op" id="7798165">)</span><span class="op" id="7798166">,</span>&nbsp;<span class="string" id="7798168">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7798200">;</span>&nbsp;<span class="ident" id="7798202">got</span>&nbsp;<span class="op" id="7798206">!=</span>&nbsp;<span class="ident" id="7798209">want</span>&nbsp;<span class="op" id="7798214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798218">t</span><span class="op" id="7798219">.</span><span class="ident" id="7798220">Errorf</span><span class="op" id="7798226">(</span><span class="string" id="7798227">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7798243">,</span>&nbsp;<span class="ident" id="7798245">got</span><span class="op" id="7798248">,</span>&nbsp;<span class="ident" id="7798250">want</span><span class="op" id="7798254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7798257">}</span><br>
<span class="lineno">30</span><span class="op" id="7798259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7798262">func</span>&nbsp;<span class="ident" id="7798267">TestClone</span><span class="op" id="7798276">(</span><span class="ident" id="7798277">t</span>&nbsp;<span class="op" id="7798279">*</span><span class="ident" id="7798280">testing</span><span class="op" id="7798287">.</span><span class="ident" id="7798288">T</span><span class="op" id="7798289">)</span>&nbsp;<span class="op" id="7798291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798294">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798366">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798420">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798473">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798533">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7798586">const</span>&nbsp;<span class="ident" id="7798592">tmpl</span>&nbsp;<span class="op" id="7798597">=</span>&nbsp;<span class="string" id="7798599">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798665">b</span>&nbsp;<span class="op" id="7798667">:=</span>&nbsp;<span class="builtinfunc" id="7798670">new</span><span class="op" id="7798673">(</span><span class="ident" id="7798674">bytes</span><span class="op" id="7798679">.</span><span class="ident" id="7798680">Buffer</span><span class="op" id="7798686">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798690">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798728">t0</span>&nbsp;<span class="op" id="7798731">:=</span>&nbsp;<span class="ident" id="7798734">Must</span><span class="op" id="7798738">(</span><span class="ident" id="7798739">New</span><span class="op" id="7798742">(</span><span class="string" id="7798743">&#34;t0&#34;</span><span class="op" id="7798747">)</span><span class="op" id="7798748">.</span><span class="ident" id="7798749">Parse</span><span class="op" id="7798754">(</span><span class="ident" id="7798755">tmpl</span><span class="op" id="7798759">)</span><span class="op" id="7798760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798764">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798784">t1</span>&nbsp;<span class="op" id="7798787">:=</span>&nbsp;<span class="ident" id="7798790">Must</span><span class="op" id="7798794">(</span><span class="ident" id="7798795">t0</span><span class="op" id="7798797">.</span><span class="ident" id="7798798">Clone</span><span class="op" id="7798803">(</span><span class="op" id="7798804">)</span><span class="op" id="7798805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798808">Must</span><span class="op" id="7798812">(</span><span class="ident" id="7798813">t1</span><span class="op" id="7798815">.</span><span class="ident" id="7798816">Parse</span><span class="op" id="7798821">(</span><span class="string" id="7798822">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7798858">)</span><span class="op" id="7798859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798862">Must</span><span class="op" id="7798866">(</span><span class="ident" id="7798867">t1</span><span class="op" id="7798869">.</span><span class="ident" id="7798870">Parse</span><span class="op" id="7798875">(</span><span class="string" id="7798876">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7798909">)</span><span class="op" id="7798910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7798914">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7798930">b</span><span class="op" id="7798931">.</span><span class="ident" id="7798932">Reset</span><span class="op" id="7798937">(</span><span class="op" id="7798938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7798941">if</span>&nbsp;<span class="ident" id="7798944">err</span>&nbsp;<span class="op" id="7798948">:=</span>&nbsp;<span class="ident" id="7798951">t1</span><span class="op" id="7798953">.</span><span class="ident" id="7798954">ExecuteTemplate</span><span class="op" id="7798969">(</span><span class="ident" id="7798970">b</span><span class="op" id="7798971">,</span>&nbsp;<span class="string" id="7798973">&#34;a&#34;</span><span class="op" id="7798976">,</span>&nbsp;<span class="string" id="7798978">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7798985">)</span><span class="op" id="7798986">;</span>&nbsp;<span class="ident" id="7798988">err</span>&nbsp;<span class="op" id="7798992">!=</span>&nbsp;<span class="ident" id="7798995">nil</span>&nbsp;<span class="op" id="7798999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799003">t</span><span class="op" id="7799004">.</span><span class="ident" id="7799005">Fatal</span><span class="op" id="7799010">(</span><span class="ident" id="7799011">err</span><span class="op" id="7799014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7799017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7799020">if</span>&nbsp;<span class="ident" id="7799023">got</span><span class="op" id="7799026">,</span>&nbsp;<span class="ident" id="7799028">want</span>&nbsp;<span class="op" id="7799033">:=</span>&nbsp;<span class="ident" id="7799036">b</span><span class="op" id="7799037">.</span><span class="ident" id="7799038">String</span><span class="op" id="7799044">(</span><span class="op" id="7799045">)</span><span class="op" id="7799046">,</span>&nbsp;<span class="string" id="7799048">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7799078">;</span>&nbsp;<span class="ident" id="7799080">got</span>&nbsp;<span class="op" id="7799084">!=</span>&nbsp;<span class="ident" id="7799087">want</span>&nbsp;<span class="op" id="7799092">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799096">t</span><span class="op" id="7799097">.</span><span class="ident" id="7799098">Errorf</span><span class="op" id="7799104">(</span><span class="string" id="7799105">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7799125">,</span>&nbsp;<span class="ident" id="7799127">got</span><span class="op" id="7799130">,</span>&nbsp;<span class="ident" id="7799132">want</span><span class="op" id="7799136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7799139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7799143">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799163">t2</span>&nbsp;<span class="op" id="7799166">:=</span>&nbsp;<span class="ident" id="7799169">Must</span><span class="op" id="7799173">(</span><span class="ident" id="7799174">t0</span><span class="op" id="7799176">.</span><span class="ident" id="7799177">Clone</span><span class="op" id="7799182">(</span><span class="op" id="7799183">)</span><span class="op" id="7799184">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799187">Must</span><span class="op" id="7799191">(</span><span class="ident" id="7799192">t2</span><span class="op" id="7799194">.</span><span class="ident" id="7799195">Parse</span><span class="op" id="7799200">(</span><span class="string" id="7799201">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7799251">)</span><span class="op" id="7799252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799255">Must</span><span class="op" id="7799259">(</span><span class="ident" id="7799260">t2</span><span class="op" id="7799262">.</span><span class="ident" id="7799263">Parse</span><span class="op" id="7799268">(</span><span class="string" id="7799269">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7799302">)</span><span class="op" id="7799303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7799307">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799323">b</span><span class="op" id="7799324">.</span><span class="ident" id="7799325">Reset</span><span class="op" id="7799330">(</span><span class="op" id="7799331">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7799334">if</span>&nbsp;<span class="ident" id="7799337">err</span>&nbsp;<span class="op" id="7799341">:=</span>&nbsp;<span class="ident" id="7799344">t2</span><span class="op" id="7799346">.</span><span class="ident" id="7799347">ExecuteTemplate</span><span class="op" id="7799362">(</span><span class="ident" id="7799363">b</span><span class="op" id="7799364">,</span>&nbsp;<span class="string" id="7799366">&#34;a&#34;</span><span class="op" id="7799369">,</span>&nbsp;<span class="string" id="7799371">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7799378">)</span><span class="op" id="7799379">;</span>&nbsp;<span class="ident" id="7799381">err</span>&nbsp;<span class="op" id="7799385">!=</span>&nbsp;<span class="ident" id="7799388">nil</span>&nbsp;<span class="op" id="7799392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799396">t</span><span class="op" id="7799397">.</span><span class="ident" id="7799398">Fatal</span><span class="op" id="7799403">(</span><span class="ident" id="7799404">err</span><span class="op" id="7799407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7799410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7799413">if</span>&nbsp;<span class="ident" id="7799416">got</span><span class="op" id="7799419">,</span>&nbsp;<span class="ident" id="7799421">want</span>&nbsp;<span class="op" id="7799426">:=</span>&nbsp;<span class="ident" id="7799429">b</span><span class="op" id="7799430">.</span><span class="ident" id="7799431">String</span><span class="op" id="7799437">(</span><span class="op" id="7799438">)</span><span class="op" id="7799439">,</span>&nbsp;<span class="string" id="7799441">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7799501">;</span>&nbsp;<span class="ident" id="7799503">got</span>&nbsp;<span class="op" id="7799507">!=</span>&nbsp;<span class="ident" id="7799510">want</span>&nbsp;<span class="op" id="7799515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799519">t</span><span class="op" id="7799520">.</span><span class="ident" id="7799521">Errorf</span><span class="op" id="7799527">(</span><span class="string" id="7799528">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7799548">,</span>&nbsp;<span class="ident" id="7799550">got</span><span class="op" id="7799553">,</span>&nbsp;<span class="ident" id="7799555">want</span><span class="op" id="7799559">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7799562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7799566">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799613">t3</span>&nbsp;<span class="op" id="7799616">:=</span>&nbsp;<span class="ident" id="7799619">Must</span><span class="op" id="7799623">(</span><span class="ident" id="7799624">t0</span><span class="op" id="7799626">.</span><span class="ident" id="7799627">Clone</span><span class="op" id="7799632">(</span><span class="op" id="7799633">)</span><span class="op" id="7799634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799637">Must</span><span class="op" id="7799641">(</span><span class="ident" id="7799642">t3</span><span class="op" id="7799644">.</span><span class="ident" id="7799645">Parse</span><span class="op" id="7799650">(</span><span class="string" id="7799651">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7799685">)</span><span class="op" id="7799686">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799689">Must</span><span class="op" id="7799693">(</span><span class="ident" id="7799694">t3</span><span class="op" id="7799696">.</span><span class="ident" id="7799697">Parse</span><span class="op" id="7799702">(</span><span class="string" id="7799703">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7799738">)</span><span class="op" id="7799739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7799743">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799760">Must</span><span class="op" id="7799764">(</span><span class="ident" id="7799765">t0</span><span class="op" id="7799767">.</span><span class="ident" id="7799768">Parse</span><span class="op" id="7799773">(</span><span class="string" id="7799774">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7799802">)</span><span class="op" id="7799803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799806">Must</span><span class="op" id="7799810">(</span><span class="ident" id="7799811">t0</span><span class="op" id="7799813">.</span><span class="ident" id="7799814">Parse</span><span class="op" id="7799819">(</span><span class="string" id="7799820">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7799848">)</span><span class="op" id="7799849">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7799853">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7799916">t4</span>&nbsp;<span class="op" id="7799919">:=</span>&nbsp;<span class="ident" id="7799922">Must</span><span class="op" id="7799926">(</span><span class="ident" id="7799927">t0</span><span class="op" id="7799929">.</span><span class="ident" id="7799930">Clone</span><span class="op" id="7799935">(</span><span class="op" id="7799936">)</span><span class="op" id="7799937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7799940">if</span>&nbsp;<span class="ident" id="7799943">_</span><span class="op" id="7799944">,</span>&nbsp;<span class="ident" id="7799946">err</span>&nbsp;<span class="op" id="7799950">:=</span>&nbsp;<span class="ident" id="7799953">t4</span><span class="op" id="7799955">.</span><span class="ident" id="7799956">Parse</span><span class="op" id="7799961">(</span><span class="string" id="7799962">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7799993">)</span><span class="op" id="7799994">;</span>&nbsp;<span class="ident" id="7799996">err</span>&nbsp;<span class="op" id="7800000">==</span>&nbsp;<span class="ident" id="7800003">nil</span>&nbsp;<span class="op" id="7800007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800011">t</span><span class="op" id="7800012">.</span><span class="ident" id="7800013">Error</span><span class="op" id="7800018">(</span><span class="string" id="7800019">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7800061">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7800068">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800084">b</span><span class="op" id="7800085">.</span><span class="ident" id="7800086">Reset</span><span class="op" id="7800091">(</span><span class="op" id="7800092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800095">if</span>&nbsp;<span class="ident" id="7800098">err</span>&nbsp;<span class="op" id="7800102">:=</span>&nbsp;<span class="ident" id="7800105">t0</span><span class="op" id="7800107">.</span><span class="ident" id="7800108">ExecuteTemplate</span><span class="op" id="7800123">(</span><span class="ident" id="7800124">b</span><span class="op" id="7800125">,</span>&nbsp;<span class="string" id="7800127">&#34;a&#34;</span><span class="op" id="7800130">,</span>&nbsp;<span class="string" id="7800132">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7800139">)</span><span class="op" id="7800140">;</span>&nbsp;<span class="ident" id="7800142">err</span>&nbsp;<span class="op" id="7800146">!=</span>&nbsp;<span class="ident" id="7800149">nil</span>&nbsp;<span class="op" id="7800153">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800157">t</span><span class="op" id="7800158">.</span><span class="ident" id="7800159">Fatal</span><span class="op" id="7800164">(</span><span class="ident" id="7800165">err</span><span class="op" id="7800168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800174">if</span>&nbsp;<span class="ident" id="7800177">got</span><span class="op" id="7800180">,</span>&nbsp;<span class="ident" id="7800182">want</span>&nbsp;<span class="op" id="7800187">:=</span>&nbsp;<span class="ident" id="7800190">b</span><span class="op" id="7800191">.</span><span class="ident" id="7800192">String</span><span class="op" id="7800198">(</span><span class="op" id="7800199">)</span><span class="op" id="7800200">,</span>&nbsp;<span class="string" id="7800202">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7800221">;</span>&nbsp;<span class="ident" id="7800223">got</span>&nbsp;<span class="op" id="7800227">!=</span>&nbsp;<span class="ident" id="7800230">want</span>&nbsp;<span class="op" id="7800235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800239">t</span><span class="op" id="7800240">.</span><span class="ident" id="7800241">Errorf</span><span class="op" id="7800247">(</span><span class="string" id="7800248">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7800268">,</span>&nbsp;<span class="ident" id="7800270">got</span><span class="op" id="7800273">,</span>&nbsp;<span class="ident" id="7800275">want</span><span class="op" id="7800279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800282">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7800286">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800346">if</span>&nbsp;<span class="ident" id="7800349">_</span><span class="op" id="7800350">,</span>&nbsp;<span class="ident" id="7800352">err</span>&nbsp;<span class="op" id="7800356">:=</span>&nbsp;<span class="ident" id="7800359">t0</span><span class="op" id="7800361">.</span><span class="ident" id="7800362">Clone</span><span class="op" id="7800367">(</span><span class="op" id="7800368">)</span><span class="op" id="7800369">;</span>&nbsp;<span class="ident" id="7800371">err</span>&nbsp;<span class="op" id="7800375">==</span>&nbsp;<span class="ident" id="7800378">nil</span>&nbsp;<span class="op" id="7800382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800386">t</span><span class="op" id="7800387">.</span><span class="ident" id="7800388">Error</span><span class="op" id="7800393">(</span><span class="string" id="7800394">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7800432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800435">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7800439">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800489">if</span>&nbsp;<span class="ident" id="7800492">_</span><span class="op" id="7800493">,</span>&nbsp;<span class="ident" id="7800495">err</span>&nbsp;<span class="op" id="7800499">:=</span>&nbsp;<span class="ident" id="7800502">t0</span><span class="op" id="7800504">.</span><span class="ident" id="7800505">Lookup</span><span class="op" id="7800511">(</span><span class="string" id="7800512">&#34;a&#34;</span><span class="op" id="7800515">)</span><span class="op" id="7800516">.</span><span class="ident" id="7800517">Clone</span><span class="op" id="7800522">(</span><span class="op" id="7800523">)</span><span class="op" id="7800524">;</span>&nbsp;<span class="ident" id="7800526">err</span>&nbsp;<span class="op" id="7800530">==</span>&nbsp;<span class="ident" id="7800533">nil</span>&nbsp;<span class="op" id="7800537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800541">t</span><span class="op" id="7800542">.</span><span class="ident" id="7800543">Error</span><span class="op" id="7800548">(</span><span class="string" id="7800549">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7800599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800602">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800605">if</span>&nbsp;<span class="ident" id="7800608">_</span><span class="op" id="7800609">,</span>&nbsp;<span class="ident" id="7800611">err</span>&nbsp;<span class="op" id="7800615">:=</span>&nbsp;<span class="ident" id="7800618">t0</span><span class="op" id="7800620">.</span><span class="ident" id="7800621">Lookup</span><span class="op" id="7800627">(</span><span class="string" id="7800628">&#34;lhs&#34;</span><span class="op" id="7800633">)</span><span class="op" id="7800634">.</span><span class="ident" id="7800635">Clone</span><span class="op" id="7800640">(</span><span class="op" id="7800641">)</span><span class="op" id="7800642">;</span>&nbsp;<span class="ident" id="7800644">err</span>&nbsp;<span class="op" id="7800648">==</span>&nbsp;<span class="ident" id="7800651">nil</span>&nbsp;<span class="op" id="7800655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800659">t</span><span class="op" id="7800660">.</span><span class="ident" id="7800661">Error</span><span class="op" id="7800666">(</span><span class="string" id="7800667">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7800719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7800726">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800742">b</span><span class="op" id="7800743">.</span><span class="ident" id="7800744">Reset</span><span class="op" id="7800749">(</span><span class="op" id="7800750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800753">if</span>&nbsp;<span class="ident" id="7800756">err</span>&nbsp;<span class="op" id="7800760">:=</span>&nbsp;<span class="ident" id="7800763">t3</span><span class="op" id="7800765">.</span><span class="ident" id="7800766">ExecuteTemplate</span><span class="op" id="7800781">(</span><span class="ident" id="7800782">b</span><span class="op" id="7800783">,</span>&nbsp;<span class="string" id="7800785">&#34;a&#34;</span><span class="op" id="7800788">,</span>&nbsp;<span class="string" id="7800790">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7800797">)</span><span class="op" id="7800798">;</span>&nbsp;<span class="ident" id="7800800">err</span>&nbsp;<span class="op" id="7800804">!=</span>&nbsp;<span class="ident" id="7800807">nil</span>&nbsp;<span class="op" id="7800811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800815">t</span><span class="op" id="7800816">.</span><span class="ident" id="7800817">Fatal</span><span class="op" id="7800822">(</span><span class="ident" id="7800823">err</span><span class="op" id="7800826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7800832">if</span>&nbsp;<span class="ident" id="7800835">got</span><span class="op" id="7800838">,</span>&nbsp;<span class="ident" id="7800840">want</span>&nbsp;<span class="op" id="7800845">:=</span>&nbsp;<span class="ident" id="7800848">b</span><span class="op" id="7800849">.</span><span class="ident" id="7800850">String</span><span class="op" id="7800856">(</span><span class="op" id="7800857">)</span><span class="op" id="7800858">,</span>&nbsp;<span class="string" id="7800860">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7800889">;</span>&nbsp;<span class="ident" id="7800891">got</span>&nbsp;<span class="op" id="7800895">!=</span>&nbsp;<span class="ident" id="7800898">want</span>&nbsp;<span class="op" id="7800903">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800907">t</span><span class="op" id="7800908">.</span><span class="ident" id="7800909">Errorf</span><span class="op" id="7800915">(</span><span class="string" id="7800916">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7800936">,</span>&nbsp;<span class="ident" id="7800938">got</span><span class="op" id="7800941">,</span>&nbsp;<span class="ident" id="7800943">want</span><span class="op" id="7800947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7800950">}</span><br>
<span class="lineno"></span><span class="op" id="7800952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7800955">func</span>&nbsp;<span class="ident" id="7800960">TestTemplates</span><span class="op" id="7800973">(</span><span class="ident" id="7800974">t</span>&nbsp;<span class="op" id="7800976">*</span><span class="ident" id="7800977">testing</span><span class="op" id="7800984">.</span><span class="ident" id="7800985">T</span><span class="op" id="7800986">)</span>&nbsp;<span class="op" id="7800988">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7800991">names</span>&nbsp;<span class="op" id="7800997">:=</span>&nbsp;<span class="op" id="7801000">[</span><span class="op" id="7801001">]</span><span class="builtintype" id="7801002">string</span><span class="op" id="7801008">{</span><span class="string" id="7801009">&#34;t0&#34;</span><span class="op" id="7801013">,</span>&nbsp;<span class="string" id="7801015">&#34;a&#34;</span><span class="op" id="7801018">,</span>&nbsp;<span class="string" id="7801020">&#34;lhs&#34;</span><span class="op" id="7801025">,</span>&nbsp;<span class="string" id="7801027">&#34;rhs&#34;</span><span class="op" id="7801032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7801035">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801090">const</span>&nbsp;<span class="ident" id="7801096">tmpl</span>&nbsp;<span class="op" id="7801101">=</span>&nbsp;<span class="string" id="7801103">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801243">t0</span>&nbsp;<span class="op" id="7801246">:=</span>&nbsp;<span class="ident" id="7801249">Must</span><span class="op" id="7801253">(</span><span class="ident" id="7801254">New</span><span class="op" id="7801257">(</span><span class="string" id="7801258">&#34;t0&#34;</span><span class="op" id="7801262">)</span><span class="op" id="7801263">.</span><span class="ident" id="7801264">Parse</span><span class="op" id="7801269">(</span><span class="ident" id="7801270">tmpl</span><span class="op" id="7801274">)</span><span class="op" id="7801275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801278">templates</span>&nbsp;<span class="op" id="7801288">:=</span>&nbsp;<span class="ident" id="7801291">t0</span><span class="op" id="7801293">.</span><span class="ident" id="7801294">Templates</span><span class="op" id="7801303">(</span><span class="op" id="7801304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801307">if</span>&nbsp;<span class="builtinfunc" id="7801310">len</span><span class="op" id="7801313">(</span><span class="ident" id="7801314">templates</span><span class="op" id="7801323">)</span>&nbsp;<span class="op" id="7801325">!=</span>&nbsp;<span class="builtinfunc" id="7801328">len</span><span class="op" id="7801331">(</span><span class="ident" id="7801332">names</span><span class="op" id="7801337">)</span>&nbsp;<span class="op" id="7801339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801343">t</span><span class="op" id="7801344">.</span><span class="ident" id="7801345">Errorf</span><span class="op" id="7801351">(</span><span class="string" id="7801352">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7801383">,</span>&nbsp;<span class="builtinfunc" id="7801385">len</span><span class="op" id="7801388">(</span><span class="ident" id="7801389">names</span><span class="op" id="7801394">)</span><span class="op" id="7801395">,</span>&nbsp;<span class="builtinfunc" id="7801397">len</span><span class="op" id="7801400">(</span><span class="ident" id="7801401">templates</span><span class="op" id="7801410">)</span><span class="op" id="7801411">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7801414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801417">for</span>&nbsp;<span class="ident" id="7801421">_</span><span class="op" id="7801422">,</span>&nbsp;<span class="ident" id="7801424">name</span>&nbsp;<span class="op" id="7801429">:=</span>&nbsp;<span class="keyword" id="7801432">range</span>&nbsp;<span class="ident" id="7801438">names</span>&nbsp;<span class="op" id="7801444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801448">found</span>&nbsp;<span class="op" id="7801454">:=</span>&nbsp;<span class="builtintype" id="7801457">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801465">for</span>&nbsp;<span class="ident" id="7801469">_</span><span class="op" id="7801470">,</span>&nbsp;<span class="ident" id="7801472">tmpl</span>&nbsp;<span class="op" id="7801477">:=</span>&nbsp;<span class="keyword" id="7801480">range</span>&nbsp;<span class="ident" id="7801486">templates</span>&nbsp;<span class="op" id="7801496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801501">if</span>&nbsp;<span class="ident" id="7801504">name</span>&nbsp;<span class="op" id="7801509">==</span>&nbsp;<span class="ident" id="7801512">tmpl</span><span class="op" id="7801516">.</span><span class="ident" id="7801517">text</span><span class="op" id="7801521">.</span><span class="ident" id="7801522">Name</span><span class="op" id="7801526">(</span><span class="op" id="7801527">)</span>&nbsp;<span class="op" id="7801529">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801535">found</span>&nbsp;<span class="op" id="7801541">=</span>&nbsp;<span class="builtintype" id="7801543">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801552">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7801561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7801565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7801569">if</span>&nbsp;<span class="op" id="7801572">!</span><span class="ident" id="7801573">found</span>&nbsp;<span class="op" id="7801579">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801584">t</span><span class="op" id="7801585">.</span><span class="ident" id="7801586">Error</span><span class="op" id="7801591">(</span><span class="string" id="7801592">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7801617">,</span>&nbsp;<span class="ident" id="7801619">name</span><span class="op" id="7801623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7801627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7801630">}</span><br>
<span class="lineno"></span><span class="op" id="7801632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7801635">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7801687">func</span>&nbsp;<span class="ident" id="7801692">TestCloneCrash</span><span class="op" id="7801706">(</span><span class="ident" id="7801707">t</span>&nbsp;<span class="op" id="7801709">*</span><span class="ident" id="7801710">testing</span><span class="op" id="7801717">.</span><span class="ident" id="7801718">T</span><span class="op" id="7801719">)</span>&nbsp;<span class="op" id="7801721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801724">t1</span>&nbsp;<span class="op" id="7801727">:=</span>&nbsp;<span class="ident" id="7801730">New</span><span class="op" id="7801733">(</span><span class="string" id="7801734">&#34;all&#34;</span><span class="op" id="7801739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801742">Must</span><span class="op" id="7801746">(</span><span class="ident" id="7801747">t1</span><span class="op" id="7801749">.</span><span class="ident" id="7801750">New</span><span class="op" id="7801753">(</span><span class="string" id="7801754">&#34;t1&#34;</span><span class="op" id="7801758">)</span><span class="op" id="7801759">.</span><span class="ident" id="7801760">Parse</span><span class="op" id="7801765">(</span><span class="string" id="7801766">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7801794">)</span><span class="op" id="7801795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7801798">t1</span><span class="op" id="7801800">.</span><span class="ident" id="7801801">Clone</span><span class="op" id="7801806">(</span><span class="op" id="7801807">)</span><br>
<span class="lineno">150</span><span class="op" id="7801809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7801812">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7801867">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7801925">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7801966">func</span>&nbsp;<span class="ident" id="7801971">TestCloneThenParse</span><span class="op" id="7801989">(</span><span class="ident" id="7801990">t</span>&nbsp;<span class="op" id="7801992">*</span><span class="ident" id="7801993">testing</span><span class="op" id="7802000">.</span><span class="ident" id="7802001">T</span><span class="op" id="7802002">)</span>&nbsp;<span class="op" id="7802004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802007">t0</span>&nbsp;<span class="op" id="7802010">:=</span>&nbsp;<span class="ident" id="7802013">Must</span><span class="op" id="7802017">(</span><span class="ident" id="7802018">New</span><span class="op" id="7802021">(</span><span class="string" id="7802022">&#34;t0&#34;</span><span class="op" id="7802026">)</span><span class="op" id="7802027">.</span><span class="ident" id="7802028">Parse</span><span class="op" id="7802033">(</span><span class="string" id="7802034">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7802080">)</span><span class="op" id="7802081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802084">t1</span>&nbsp;<span class="op" id="7802087">:=</span>&nbsp;<span class="ident" id="7802090">Must</span><span class="op" id="7802094">(</span><span class="ident" id="7802095">t0</span><span class="op" id="7802097">.</span><span class="ident" id="7802098">Clone</span><span class="op" id="7802103">(</span><span class="op" id="7802104">)</span><span class="op" id="7802105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802108">Must</span><span class="op" id="7802112">(</span><span class="ident" id="7802113">t1</span><span class="op" id="7802115">.</span><span class="ident" id="7802116">Parse</span><span class="op" id="7802121">(</span><span class="string" id="7802122">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7802154">)</span><span class="op" id="7802155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7802158">if</span>&nbsp;<span class="builtinfunc" id="7802161">len</span><span class="op" id="7802164">(</span><span class="ident" id="7802165">t0</span><span class="op" id="7802167">.</span><span class="ident" id="7802168">Templates</span><span class="op" id="7802177">(</span><span class="op" id="7802178">)</span><span class="op" id="7802179">)</span><span class="op" id="7802180">+</span><span class="num" id="7802181">1</span>&nbsp;<span class="op" id="7802183">!=</span>&nbsp;<span class="builtinfunc" id="7802186">len</span><span class="op" id="7802189">(</span><span class="ident" id="7802190">t1</span><span class="op" id="7802192">.</span><span class="ident" id="7802193">Templates</span><span class="op" id="7802202">(</span><span class="op" id="7802203">)</span><span class="op" id="7802204">)</span>&nbsp;<span class="op" id="7802206">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802210">t</span><span class="op" id="7802211">.</span><span class="ident" id="7802212">Error</span><span class="op" id="7802217">(</span><span class="string" id="7802218">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7802273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7802276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7802279">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802355">err</span>&nbsp;<span class="op" id="7802359">:=</span>&nbsp;<span class="ident" id="7802362">t0</span><span class="op" id="7802364">.</span><span class="ident" id="7802365">ExecuteTemplate</span><span class="op" id="7802380">(</span><span class="ident" id="7802381">ioutil</span><span class="op" id="7802387">.</span><span class="ident" id="7802388">Discard</span><span class="op" id="7802395">,</span>&nbsp;<span class="string" id="7802397">&#34;a&#34;</span><span class="op" id="7802400">,</span>&nbsp;<span class="ident" id="7802402">nil</span><span class="op" id="7802405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7802408">if</span>&nbsp;<span class="ident" id="7802411">err</span>&nbsp;<span class="op" id="7802415">==</span>&nbsp;<span class="ident" id="7802418">nil</span>&nbsp;<span class="op" id="7802422">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802426">t</span><span class="op" id="7802427">.</span><span class="ident" id="7802428">Error</span><span class="op" id="7802433">(</span><span class="string" id="7802434">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7802469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7802472">}</span><br>
<span class="lineno"></span><span class="op" id="7802474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7802477">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7802531">func</span>&nbsp;<span class="ident" id="7802536">TestFuncMapWorksAfterClone</span><span class="op" id="7802562">(</span><span class="ident" id="7802563">t</span>&nbsp;<span class="op" id="7802565">*</span><span class="ident" id="7802566">testing</span><span class="op" id="7802573">.</span><span class="ident" id="7802574">T</span><span class="op" id="7802575">)</span>&nbsp;<span class="op" id="7802577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802580">funcs</span>&nbsp;<span class="op" id="7802586">:=</span>&nbsp;<span class="ident" id="7802589">FuncMap</span><span class="op" id="7802596">{</span><span class="string" id="7802597">&#34;customFunc&#34;</span><span class="op" id="7802609">:</span>&nbsp;<span class="keyword" id="7802611">func</span><span class="op" id="7802615">(</span><span class="op" id="7802616">)</span>&nbsp;<span class="op" id="7802618">(</span><span class="builtintype" id="7802619">string</span><span class="op" id="7802625">,</span>&nbsp;<span class="builtintype" id="7802627">error</span><span class="op" id="7802632">)</span>&nbsp;<span class="op" id="7802634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7802638">return</span>&nbsp;<span class="string" id="7802645">&#34;&#34;</span><span class="op" id="7802647">,</span>&nbsp;<span class="ident" id="7802649">errors</span><span class="op" id="7802655">.</span><span class="ident" id="7802656">New</span><span class="op" id="7802659">(</span><span class="string" id="7802660">&#34;issue5980&#34;</span><span class="op" id="7802671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7802674">}</span><span class="op" id="7802675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7802679">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802724">uncloned</span>&nbsp;<span class="op" id="7802733">:=</span>&nbsp;<span class="ident" id="7802736">Must</span><span class="op" id="7802740">(</span><span class="ident" id="7802741">New</span><span class="op" id="7802744">(</span><span class="string" id="7802745">&#34;&#34;</span><span class="op" id="7802747">)</span><span class="op" id="7802748">.</span><span class="ident" id="7802749">Funcs</span><span class="op" id="7802754">(</span><span class="ident" id="7802755">funcs</span><span class="op" id="7802760">)</span><span class="op" id="7802761">.</span><span class="ident" id="7802762">Parse</span><span class="op" id="7802767">(</span><span class="string" id="7802768">&#34;{{customFunc}}&#34;</span><span class="op" id="7802784">)</span><span class="op" id="7802785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802788">wantErr</span>&nbsp;<span class="op" id="7802796">:=</span>&nbsp;<span class="ident" id="7802799">uncloned</span><span class="op" id="7802807">.</span><span class="ident" id="7802808">Execute</span><span class="op" id="7802815">(</span><span class="ident" id="7802816">ioutil</span><span class="op" id="7802822">.</span><span class="ident" id="7802823">Discard</span><span class="op" id="7802830">,</span>&nbsp;<span class="ident" id="7802832">nil</span><span class="op" id="7802835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7802839">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7802918">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7802966">toClone</span>&nbsp;<span class="op" id="7802974">:=</span>&nbsp;<span class="ident" id="7802977">Must</span><span class="op" id="7802981">(</span><span class="ident" id="7802982">New</span><span class="op" id="7802985">(</span><span class="string" id="7802986">&#34;&#34;</span><span class="op" id="7802988">)</span><span class="op" id="7802989">.</span><span class="ident" id="7802990">Funcs</span><span class="op" id="7802995">(</span><span class="ident" id="7802996">funcs</span><span class="op" id="7803001">)</span><span class="op" id="7803002">.</span><span class="ident" id="7803003">Parse</span><span class="op" id="7803008">(</span><span class="string" id="7803009">&#34;{{customFunc}}&#34;</span><span class="op" id="7803025">)</span><span class="op" id="7803026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7803029">cloned</span>&nbsp;<span class="op" id="7803036">:=</span>&nbsp;<span class="ident" id="7803039">Must</span><span class="op" id="7803043">(</span><span class="ident" id="7803044">toClone</span><span class="op" id="7803051">.</span><span class="ident" id="7803052">Clone</span><span class="op" id="7803057">(</span><span class="op" id="7803058">)</span><span class="op" id="7803059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7803062">gotErr</span>&nbsp;<span class="op" id="7803069">:=</span>&nbsp;<span class="ident" id="7803072">cloned</span><span class="op" id="7803078">.</span><span class="ident" id="7803079">Execute</span><span class="op" id="7803086">(</span><span class="ident" id="7803087">ioutil</span><span class="op" id="7803093">.</span><span class="ident" id="7803094">Discard</span><span class="op" id="7803101">,</span>&nbsp;<span class="ident" id="7803103">nil</span><span class="op" id="7803106">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7803110">if</span>&nbsp;<span class="ident" id="7803113">wantErr</span><span class="op" id="7803120">.</span><span class="ident" id="7803121">Error</span><span class="op" id="7803126">(</span><span class="op" id="7803127">)</span>&nbsp;<span class="op" id="7803129">!=</span>&nbsp;<span class="ident" id="7803132">gotErr</span><span class="op" id="7803138">.</span><span class="ident" id="7803139">Error</span><span class="op" id="7803144">(</span><span class="op" id="7803145">)</span>&nbsp;<span class="op" id="7803147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7803151">t</span><span class="op" id="7803152">.</span><span class="ident" id="7803153">Errorf</span><span class="op" id="7803159">(</span><span class="string" id="7803160">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7803205">,</span>&nbsp;<span class="ident" id="7803207">wantErr</span><span class="op" id="7803214">,</span>&nbsp;<span class="ident" id="7803216">gotErr</span><span class="op" id="7803222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7803225">}</span><br>
<span class="lineno"></span><span class="op" id="7803227">}</span>
</div>
</body>
</html>
