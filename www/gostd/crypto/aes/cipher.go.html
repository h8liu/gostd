<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html" class="current">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3543627">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3543682">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3543736">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3543787">package</span>&nbsp;<span class="ident" id="3543795">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3543800">import</span>&nbsp;<span class="op" id="3543807">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3543810">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3543827">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3543837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3543840">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3543872">const</span>&nbsp;<span class="ident" id="3543878">BlockSize</span>&nbsp;<span class="op" id="3543888">=</span>&nbsp;<span class="num" id="3543890">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3543894">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3543963">type</span>&nbsp;<span class="ident" id="3543968">aesCipher</span>&nbsp;<span class="keyword" id="3543978">struct</span>&nbsp;<span class="op" id="3543985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543988">enc</span>&nbsp;<span class="op" id="3543992">[</span><span class="op" id="3543993">]</span><span class="builtintype" id="3543994">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544002">dec</span>&nbsp;<span class="op" id="3544006">[</span><span class="op" id="3544007">]</span><span class="builtintype" id="3544008">uint32</span><br>
<span class="lineno"></span><span class="op" id="3544015">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3544018">type</span>&nbsp;<span class="ident" id="3544023">KeySizeError</span>&nbsp;<span class="builtintype" id="3544036">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544041">func</span>&nbsp;<span class="op" id="3544046">(</span><span class="ident" id="3544047">k</span>&nbsp;<span class="ident" id="3544049">KeySizeError</span><span class="op" id="3544061">)</span>&nbsp;<span class="ident" id="3544063">Error</span><span class="op" id="3544068">(</span><span class="op" id="3544069">)</span>&nbsp;<span class="builtintype" id="3544071">string</span>&nbsp;<span class="op" id="3544078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544081">return</span>&nbsp;<span class="string" id="3544088">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3544120">+</span>&nbsp;<span class="ident" id="3544122">strconv</span><span class="op" id="3544129">.</span><span class="ident" id="3544130">Itoa</span><span class="op" id="3544134">(</span><span class="builtintype" id="3544135">int</span><span class="op" id="3544138">(</span><span class="ident" id="3544139">k</span><span class="op" id="3544140">)</span><span class="op" id="3544141">)</span><br>
<span class="lineno">25</span><span class="op" id="3544143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3544146">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3544199">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3544242">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3544282">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3544315">func</span>&nbsp;<span class="ident" id="3544320">NewCipher</span><span class="op" id="3544329">(</span><span class="ident" id="3544330">key</span>&nbsp;<span class="op" id="3544334">[</span><span class="op" id="3544335">]</span><span class="builtintype" id="3544336">byte</span><span class="op" id="3544340">)</span>&nbsp;<span class="op" id="3544342">(</span><span class="ident" id="3544343">cipher</span><span class="op" id="3544349">.</span><span class="ident" id="3544350">Block</span><span class="op" id="3544355">,</span>&nbsp;<span class="builtintype" id="3544357">error</span><span class="op" id="3544362">)</span>&nbsp;<span class="op" id="3544364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544367">k</span>&nbsp;<span class="op" id="3544369">:=</span>&nbsp;<span class="builtinfunc" id="3544372">len</span><span class="op" id="3544375">(</span><span class="ident" id="3544376">key</span><span class="op" id="3544379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544382">switch</span>&nbsp;<span class="ident" id="3544389">k</span>&nbsp;<span class="op" id="3544391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544394">default</span><span class="op" id="3544401">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544405">return</span>&nbsp;<span class="builtintype" id="3544412">nil</span><span class="op" id="3544415">,</span>&nbsp;<span class="ident" id="3544417">KeySizeError</span><span class="op" id="3544429">(</span><span class="ident" id="3544430">k</span><span class="op" id="3544431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544434">case</span>&nbsp;<span class="num" id="3544439">16</span><span class="op" id="3544441">,</span>&nbsp;<span class="num" id="3544443">24</span><span class="op" id="3544445">,</span>&nbsp;<span class="num" id="3544447">32</span><span class="op" id="3544449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544453">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3544460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544464">n</span>&nbsp;<span class="op" id="3544466">:=</span>&nbsp;<span class="ident" id="3544469">k</span>&nbsp;<span class="op" id="3544471">+</span>&nbsp;<span class="num" id="3544473">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544477">c</span>&nbsp;<span class="op" id="3544479">:=</span>&nbsp;<span class="op" id="3544482">&amp;</span><span class="ident" id="3544483">aesCipher</span><span class="op" id="3544492">{</span><span class="builtinfunc" id="3544493">make</span><span class="op" id="3544497">(</span><span class="op" id="3544498">[</span><span class="op" id="3544499">]</span><span class="builtintype" id="3544500">uint32</span><span class="op" id="3544506">,</span>&nbsp;<span class="ident" id="3544508">n</span><span class="op" id="3544509">)</span><span class="op" id="3544510">,</span>&nbsp;<span class="builtinfunc" id="3544512">make</span><span class="op" id="3544516">(</span><span class="op" id="3544517">[</span><span class="op" id="3544518">]</span><span class="builtintype" id="3544519">uint32</span><span class="op" id="3544525">,</span>&nbsp;<span class="ident" id="3544527">n</span><span class="op" id="3544528">)</span><span class="op" id="3544529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544532">expandKey</span><span class="op" id="3544541">(</span><span class="ident" id="3544542">key</span><span class="op" id="3544545">,</span>&nbsp;<span class="ident" id="3544547">c</span><span class="op" id="3544548">.</span><span class="ident" id="3544549">enc</span><span class="op" id="3544552">,</span>&nbsp;<span class="ident" id="3544554">c</span><span class="op" id="3544555">.</span><span class="ident" id="3544556">dec</span><span class="op" id="3544559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544562">return</span>&nbsp;<span class="ident" id="3544569">c</span><span class="op" id="3544570">,</span>&nbsp;<span class="builtintype" id="3544572">nil</span><br>
<span class="lineno"></span><span class="op" id="3544576">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3544579">func</span>&nbsp;<span class="op" id="3544584">(</span><span class="ident" id="3544585">c</span>&nbsp;<span class="op" id="3544587">*</span><span class="ident" id="3544588">aesCipher</span><span class="op" id="3544597">)</span>&nbsp;<span class="ident" id="3544599">BlockSize</span><span class="op" id="3544608">(</span><span class="op" id="3544609">)</span>&nbsp;<span class="builtintype" id="3544611">int</span>&nbsp;<span class="op" id="3544615">{</span>&nbsp;<span class="keyword" id="3544617">return</span>&nbsp;<span class="ident" id="3544624">BlockSize</span>&nbsp;<span class="op" id="3544634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544637">func</span>&nbsp;<span class="op" id="3544642">(</span><span class="ident" id="3544643">c</span>&nbsp;<span class="op" id="3544645">*</span><span class="ident" id="3544646">aesCipher</span><span class="op" id="3544655">)</span>&nbsp;<span class="ident" id="3544657">Encrypt</span><span class="op" id="3544664">(</span><span class="ident" id="3544665">dst</span><span class="op" id="3544668">,</span>&nbsp;<span class="ident" id="3544670">src</span>&nbsp;<span class="op" id="3544674">[</span><span class="op" id="3544675">]</span><span class="builtintype" id="3544676">byte</span><span class="op" id="3544680">)</span>&nbsp;<span class="op" id="3544682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544685">if</span>&nbsp;<span class="builtinfunc" id="3544688">len</span><span class="op" id="3544691">(</span><span class="ident" id="3544692">src</span><span class="op" id="3544695">)</span>&nbsp;<span class="op" id="3544697">&lt;</span>&nbsp;<span class="ident" id="3544699">BlockSize</span>&nbsp;<span class="op" id="3544709">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3544713">panic</span><span class="op" id="3544718">(</span><span class="string" id="3544719">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3544753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3544756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544759">if</span>&nbsp;<span class="builtinfunc" id="3544762">len</span><span class="op" id="3544765">(</span><span class="ident" id="3544766">dst</span><span class="op" id="3544769">)</span>&nbsp;<span class="op" id="3544771">&lt;</span>&nbsp;<span class="ident" id="3544773">BlockSize</span>&nbsp;<span class="op" id="3544783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3544787">panic</span><span class="op" id="3544792">(</span><span class="string" id="3544793">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3544828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3544831">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544834">encryptBlock</span><span class="op" id="3544846">(</span><span class="ident" id="3544847">c</span><span class="op" id="3544848">.</span><span class="ident" id="3544849">enc</span><span class="op" id="3544852">,</span>&nbsp;<span class="ident" id="3544854">dst</span><span class="op" id="3544857">,</span>&nbsp;<span class="ident" id="3544859">src</span><span class="op" id="3544862">)</span><br>
<span class="lineno"></span><span class="op" id="3544864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544867">func</span>&nbsp;<span class="op" id="3544872">(</span><span class="ident" id="3544873">c</span>&nbsp;<span class="op" id="3544875">*</span><span class="ident" id="3544876">aesCipher</span><span class="op" id="3544885">)</span>&nbsp;<span class="ident" id="3544887">Decrypt</span><span class="op" id="3544894">(</span><span class="ident" id="3544895">dst</span><span class="op" id="3544898">,</span>&nbsp;<span class="ident" id="3544900">src</span>&nbsp;<span class="op" id="3544904">[</span><span class="op" id="3544905">]</span><span class="builtintype" id="3544906">byte</span><span class="op" id="3544910">)</span>&nbsp;<span class="op" id="3544912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544915">if</span>&nbsp;<span class="builtinfunc" id="3544918">len</span><span class="op" id="3544921">(</span><span class="ident" id="3544922">src</span><span class="op" id="3544925">)</span>&nbsp;<span class="op" id="3544927">&lt;</span>&nbsp;<span class="ident" id="3544929">BlockSize</span>&nbsp;<span class="op" id="3544939">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3544943">panic</span><span class="op" id="3544948">(</span><span class="string" id="3544949">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3544983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3544986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544989">if</span>&nbsp;<span class="builtinfunc" id="3544992">len</span><span class="op" id="3544995">(</span><span class="ident" id="3544996">dst</span><span class="op" id="3544999">)</span>&nbsp;<span class="op" id="3545001">&lt;</span>&nbsp;<span class="ident" id="3545003">BlockSize</span>&nbsp;<span class="op" id="3545013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3545017">panic</span><span class="op" id="3545022">(</span><span class="string" id="3545023">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3545058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3545061">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545064">decryptBlock</span><span class="op" id="3545076">(</span><span class="ident" id="3545077">c</span><span class="op" id="3545078">.</span><span class="ident" id="3545079">dec</span><span class="op" id="3545082">,</span>&nbsp;<span class="ident" id="3545084">dst</span><span class="op" id="3545087">,</span>&nbsp;<span class="ident" id="3545089">src</span><span class="op" id="3545092">)</span><br>
<span class="lineno"></span><span class="op" id="3545094">}</span>
</div>
</body>
</html>
