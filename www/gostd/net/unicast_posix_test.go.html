<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6799981">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6800037">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6800091">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6800142">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6800160">package</span>&nbsp;<span class="ident" id="6800168">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6800173">import</span>&nbsp;<span class="op" id="6800180">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6800183">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6800194">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6800205">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6800215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6800218">var</span>&nbsp;<span class="ident" id="6800222">listenerTests</span>&nbsp;<span class="op" id="6800236">=</span>&nbsp;<span class="op" id="6800238">[</span><span class="op" id="6800239">]</span><span class="keyword" id="6800240">struct</span>&nbsp;<span class="op" id="6800247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800250">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6800259">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800267">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6800276">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800284">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6800293">bool</span>&nbsp;<span class="comment" id="6800298">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800339">wildcard</span>&nbsp;<span class="builtintype" id="6800348">bool</span>&nbsp;<span class="comment" id="6800353">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="6800383">}</span><span class="op" id="6800384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800387">{</span><span class="ident" id="6800388">net</span><span class="op" id="6800391">:</span>&nbsp;<span class="string" id="6800393">&#34;tcp&#34;</span><span class="op" id="6800398">,</span>&nbsp;<span class="ident" id="6800400">laddr</span><span class="op" id="6800405">:</span>&nbsp;<span class="string" id="6800407">&#34;&#34;</span><span class="op" id="6800409">,</span>&nbsp;<span class="ident" id="6800411">wildcard</span><span class="op" id="6800419">:</span>&nbsp;<span class="builtintype" id="6800421">true</span><span class="op" id="6800425">}</span><span class="op" id="6800426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800429">{</span><span class="ident" id="6800430">net</span><span class="op" id="6800433">:</span>&nbsp;<span class="string" id="6800435">&#34;tcp&#34;</span><span class="op" id="6800440">,</span>&nbsp;<span class="ident" id="6800442">laddr</span><span class="op" id="6800447">:</span>&nbsp;<span class="string" id="6800449">&#34;0.0.0.0&#34;</span><span class="op" id="6800458">,</span>&nbsp;<span class="ident" id="6800460">wildcard</span><span class="op" id="6800468">:</span>&nbsp;<span class="builtintype" id="6800470">true</span><span class="op" id="6800474">}</span><span class="op" id="6800475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800478">{</span><span class="ident" id="6800479">net</span><span class="op" id="6800482">:</span>&nbsp;<span class="string" id="6800484">&#34;tcp&#34;</span><span class="op" id="6800489">,</span>&nbsp;<span class="ident" id="6800491">laddr</span><span class="op" id="6800496">:</span>&nbsp;<span class="string" id="6800498">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6800516">,</span>&nbsp;<span class="ident" id="6800518">wildcard</span><span class="op" id="6800526">:</span>&nbsp;<span class="builtintype" id="6800528">true</span><span class="op" id="6800532">}</span><span class="op" id="6800533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800536">{</span><span class="ident" id="6800537">net</span><span class="op" id="6800540">:</span>&nbsp;<span class="string" id="6800542">&#34;tcp&#34;</span><span class="op" id="6800547">,</span>&nbsp;<span class="ident" id="6800549">laddr</span><span class="op" id="6800554">:</span>&nbsp;<span class="string" id="6800556">&#34;[::]&#34;</span><span class="op" id="6800562">,</span>&nbsp;<span class="ident" id="6800564">ipv6</span><span class="op" id="6800568">:</span>&nbsp;<span class="builtintype" id="6800570">true</span><span class="op" id="6800574">,</span>&nbsp;<span class="ident" id="6800576">wildcard</span><span class="op" id="6800584">:</span>&nbsp;<span class="builtintype" id="6800586">true</span><span class="op" id="6800590">}</span><span class="op" id="6800591">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800595">{</span><span class="ident" id="6800596">net</span><span class="op" id="6800599">:</span>&nbsp;<span class="string" id="6800601">&#34;tcp&#34;</span><span class="op" id="6800606">,</span>&nbsp;<span class="ident" id="6800608">laddr</span><span class="op" id="6800613">:</span>&nbsp;<span class="string" id="6800615">&#34;127.0.0.1&#34;</span><span class="op" id="6800626">}</span><span class="op" id="6800627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800630">{</span><span class="ident" id="6800631">net</span><span class="op" id="6800634">:</span>&nbsp;<span class="string" id="6800636">&#34;tcp&#34;</span><span class="op" id="6800641">,</span>&nbsp;<span class="ident" id="6800643">laddr</span><span class="op" id="6800648">:</span>&nbsp;<span class="string" id="6800650">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6800670">}</span><span class="op" id="6800671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800674">{</span><span class="ident" id="6800675">net</span><span class="op" id="6800678">:</span>&nbsp;<span class="string" id="6800680">&#34;tcp&#34;</span><span class="op" id="6800685">,</span>&nbsp;<span class="ident" id="6800687">laddr</span><span class="op" id="6800692">:</span>&nbsp;<span class="string" id="6800694">&#34;[::1]&#34;</span><span class="op" id="6800701">,</span>&nbsp;<span class="ident" id="6800703">ipv6</span><span class="op" id="6800707">:</span>&nbsp;<span class="builtintype" id="6800709">true</span><span class="op" id="6800713">}</span><span class="op" id="6800714">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800718">{</span><span class="ident" id="6800719">net</span><span class="op" id="6800722">:</span>&nbsp;<span class="string" id="6800724">&#34;tcp4&#34;</span><span class="op" id="6800730">,</span>&nbsp;<span class="ident" id="6800732">laddr</span><span class="op" id="6800737">:</span>&nbsp;<span class="string" id="6800739">&#34;&#34;</span><span class="op" id="6800741">,</span>&nbsp;<span class="ident" id="6800743">wildcard</span><span class="op" id="6800751">:</span>&nbsp;<span class="builtintype" id="6800753">true</span><span class="op" id="6800757">}</span><span class="op" id="6800758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800761">{</span><span class="ident" id="6800762">net</span><span class="op" id="6800765">:</span>&nbsp;<span class="string" id="6800767">&#34;tcp4&#34;</span><span class="op" id="6800773">,</span>&nbsp;<span class="ident" id="6800775">laddr</span><span class="op" id="6800780">:</span>&nbsp;<span class="string" id="6800782">&#34;0.0.0.0&#34;</span><span class="op" id="6800791">,</span>&nbsp;<span class="ident" id="6800793">wildcard</span><span class="op" id="6800801">:</span>&nbsp;<span class="builtintype" id="6800803">true</span><span class="op" id="6800807">}</span><span class="op" id="6800808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800811">{</span><span class="ident" id="6800812">net</span><span class="op" id="6800815">:</span>&nbsp;<span class="string" id="6800817">&#34;tcp4&#34;</span><span class="op" id="6800823">,</span>&nbsp;<span class="ident" id="6800825">laddr</span><span class="op" id="6800830">:</span>&nbsp;<span class="string" id="6800832">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6800850">,</span>&nbsp;<span class="ident" id="6800852">wildcard</span><span class="op" id="6800860">:</span>&nbsp;<span class="builtintype" id="6800862">true</span><span class="op" id="6800866">}</span><span class="op" id="6800867">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800871">{</span><span class="ident" id="6800872">net</span><span class="op" id="6800875">:</span>&nbsp;<span class="string" id="6800877">&#34;tcp4&#34;</span><span class="op" id="6800883">,</span>&nbsp;<span class="ident" id="6800885">laddr</span><span class="op" id="6800890">:</span>&nbsp;<span class="string" id="6800892">&#34;127.0.0.1&#34;</span><span class="op" id="6800903">}</span><span class="op" id="6800904">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800907">{</span><span class="ident" id="6800908">net</span><span class="op" id="6800911">:</span>&nbsp;<span class="string" id="6800913">&#34;tcp4&#34;</span><span class="op" id="6800919">,</span>&nbsp;<span class="ident" id="6800921">laddr</span><span class="op" id="6800926">:</span>&nbsp;<span class="string" id="6800928">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6800948">}</span><span class="op" id="6800949">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800953">{</span><span class="ident" id="6800954">net</span><span class="op" id="6800957">:</span>&nbsp;<span class="string" id="6800959">&#34;tcp6&#34;</span><span class="op" id="6800965">,</span>&nbsp;<span class="ident" id="6800967">laddr</span><span class="op" id="6800972">:</span>&nbsp;<span class="string" id="6800974">&#34;&#34;</span><span class="op" id="6800976">,</span>&nbsp;<span class="ident" id="6800978">ipv6</span><span class="op" id="6800982">:</span>&nbsp;<span class="builtintype" id="6800984">true</span><span class="op" id="6800988">,</span>&nbsp;<span class="ident" id="6800990">wildcard</span><span class="op" id="6800998">:</span>&nbsp;<span class="builtintype" id="6801000">true</span><span class="op" id="6801004">}</span><span class="op" id="6801005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801008">{</span><span class="ident" id="6801009">net</span><span class="op" id="6801012">:</span>&nbsp;<span class="string" id="6801014">&#34;tcp6&#34;</span><span class="op" id="6801020">,</span>&nbsp;<span class="ident" id="6801022">laddr</span><span class="op" id="6801027">:</span>&nbsp;<span class="string" id="6801029">&#34;[::]&#34;</span><span class="op" id="6801035">,</span>&nbsp;<span class="ident" id="6801037">ipv6</span><span class="op" id="6801041">:</span>&nbsp;<span class="builtintype" id="6801043">true</span><span class="op" id="6801047">,</span>&nbsp;<span class="ident" id="6801049">wildcard</span><span class="op" id="6801057">:</span>&nbsp;<span class="builtintype" id="6801059">true</span><span class="op" id="6801063">}</span><span class="op" id="6801064">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801068">{</span><span class="ident" id="6801069">net</span><span class="op" id="6801072">:</span>&nbsp;<span class="string" id="6801074">&#34;tcp6&#34;</span><span class="op" id="6801080">,</span>&nbsp;<span class="ident" id="6801082">laddr</span><span class="op" id="6801087">:</span>&nbsp;<span class="string" id="6801089">&#34;[::1]&#34;</span><span class="op" id="6801096">,</span>&nbsp;<span class="ident" id="6801098">ipv6</span><span class="op" id="6801102">:</span>&nbsp;<span class="builtintype" id="6801104">true</span><span class="op" id="6801108">}</span><span class="op" id="6801109">,</span><br>
<span class="lineno"></span><span class="op" id="6801111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6801114">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6801179">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="6801244">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6801258">func</span>&nbsp;<span class="ident" id="6801263">TestTCPListener</span><span class="op" id="6801278">(</span><span class="ident" id="6801279">t</span>&nbsp;<span class="op" id="6801281">*</span><span class="ident" id="6801282">testing</span><span class="op" id="6801289">.</span><span class="ident" id="6801290">T</span><span class="op" id="6801291">)</span>&nbsp;<span class="op" id="6801293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801296">switch</span>&nbsp;<span class="ident" id="6801303">runtime</span><span class="op" id="6801310">.</span><span class="ident" id="6801311">GOOS</span>&nbsp;<span class="op" id="6801316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801319">case</span>&nbsp;<span class="string" id="6801324">&#34;plan9&#34;</span><span class="op" id="6801331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801335">t</span><span class="op" id="6801336">.</span><span class="ident" id="6801337">Skipf</span><span class="op" id="6801342">(</span><span class="string" id="6801343">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6801364">,</span>&nbsp;<span class="ident" id="6801366">runtime</span><span class="op" id="6801373">.</span><span class="ident" id="6801374">GOOS</span><span class="op" id="6801378">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801385">for</span>&nbsp;<span class="ident" id="6801389">_</span><span class="op" id="6801390">,</span>&nbsp;<span class="ident" id="6801392">tt</span>&nbsp;<span class="op" id="6801395">:=</span>&nbsp;<span class="keyword" id="6801398">range</span>&nbsp;<span class="ident" id="6801404">listenerTests</span>&nbsp;<span class="op" id="6801418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801422">if</span>&nbsp;<span class="ident" id="6801425">tt</span><span class="op" id="6801427">.</span><span class="ident" id="6801428">wildcard</span>&nbsp;<span class="op" id="6801437">&amp;&amp;</span>&nbsp;<span class="op" id="6801440">(</span><span class="ident" id="6801441">testing</span><span class="op" id="6801448">.</span><span class="ident" id="6801449">Short</span><span class="op" id="6801454">(</span><span class="op" id="6801455">)</span>&nbsp;<span class="op" id="6801457">||</span>&nbsp;<span class="op" id="6801460">!</span><span class="op" id="6801461">*</span><span class="ident" id="6801462">testExternal</span><span class="op" id="6801474">)</span>&nbsp;<span class="op" id="6801476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801481">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801496">if</span>&nbsp;<span class="ident" id="6801499">tt</span><span class="op" id="6801501">.</span><span class="ident" id="6801502">ipv6</span>&nbsp;<span class="op" id="6801507">&amp;&amp;</span>&nbsp;<span class="op" id="6801510">!</span><span class="ident" id="6801511">supportsIPv6</span>&nbsp;<span class="op" id="6801524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801529">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801544">l1</span><span class="op" id="6801546">,</span>&nbsp;<span class="ident" id="6801548">port</span>&nbsp;<span class="op" id="6801553">:=</span>&nbsp;<span class="ident" id="6801556">usableListenPort</span><span class="op" id="6801572">(</span><span class="ident" id="6801573">t</span><span class="op" id="6801574">,</span>&nbsp;<span class="ident" id="6801576">tt</span><span class="op" id="6801578">.</span><span class="ident" id="6801579">net</span><span class="op" id="6801582">,</span>&nbsp;<span class="ident" id="6801584">tt</span><span class="op" id="6801586">.</span><span class="ident" id="6801587">laddr</span><span class="op" id="6801592">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801596">checkFirstListener</span><span class="op" id="6801614">(</span><span class="ident" id="6801615">t</span><span class="op" id="6801616">,</span>&nbsp;<span class="ident" id="6801618">tt</span><span class="op" id="6801620">.</span><span class="ident" id="6801621">net</span><span class="op" id="6801624">,</span>&nbsp;<span class="ident" id="6801626">tt</span><span class="op" id="6801628">.</span><span class="ident" id="6801629">laddr</span><span class="op" id="6801634">+</span><span class="string" id="6801635">&#34;:&#34;</span><span class="op" id="6801638">+</span><span class="ident" id="6801639">port</span><span class="op" id="6801643">,</span>&nbsp;<span class="ident" id="6801645">l1</span><span class="op" id="6801647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801651">l2</span><span class="op" id="6801653">,</span>&nbsp;<span class="ident" id="6801655">err</span>&nbsp;<span class="op" id="6801659">:=</span>&nbsp;<span class="ident" id="6801662">Listen</span><span class="op" id="6801668">(</span><span class="ident" id="6801669">tt</span><span class="op" id="6801671">.</span><span class="ident" id="6801672">net</span><span class="op" id="6801675">,</span>&nbsp;<span class="ident" id="6801677">tt</span><span class="op" id="6801679">.</span><span class="ident" id="6801680">laddr</span><span class="op" id="6801685">+</span><span class="string" id="6801686">&#34;:&#34;</span><span class="op" id="6801689">+</span><span class="ident" id="6801690">port</span><span class="op" id="6801694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801698">checkSecondListener</span><span class="op" id="6801717">(</span><span class="ident" id="6801718">t</span><span class="op" id="6801719">,</span>&nbsp;<span class="ident" id="6801721">tt</span><span class="op" id="6801723">.</span><span class="ident" id="6801724">net</span><span class="op" id="6801727">,</span>&nbsp;<span class="ident" id="6801729">tt</span><span class="op" id="6801731">.</span><span class="ident" id="6801732">laddr</span><span class="op" id="6801737">+</span><span class="string" id="6801738">&#34;:&#34;</span><span class="op" id="6801741">+</span><span class="ident" id="6801742">port</span><span class="op" id="6801746">,</span>&nbsp;<span class="ident" id="6801748">err</span><span class="op" id="6801751">,</span>&nbsp;<span class="ident" id="6801753">l2</span><span class="op" id="6801755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801759">l1</span><span class="op" id="6801761">.</span><span class="ident" id="6801762">Close</span><span class="op" id="6801767">(</span><span class="op" id="6801768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801771">}</span><br>
<span class="lineno">65</span><span class="op" id="6801773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6801776">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6801841">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6801906">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="6801920">func</span>&nbsp;<span class="ident" id="6801925">TestUDPListener</span><span class="op" id="6801940">(</span><span class="ident" id="6801941">t</span>&nbsp;<span class="op" id="6801943">*</span><span class="ident" id="6801944">testing</span><span class="op" id="6801951">.</span><span class="ident" id="6801952">T</span><span class="op" id="6801953">)</span>&nbsp;<span class="op" id="6801955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801958">switch</span>&nbsp;<span class="ident" id="6801965">runtime</span><span class="op" id="6801972">.</span><span class="ident" id="6801973">GOOS</span>&nbsp;<span class="op" id="6801978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801981">case</span>&nbsp;<span class="string" id="6801986">&#34;plan9&#34;</span><span class="op" id="6801993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801997">t</span><span class="op" id="6801998">.</span><span class="ident" id="6801999">Skipf</span><span class="op" id="6802004">(</span><span class="string" id="6802005">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6802026">,</span>&nbsp;<span class="ident" id="6802028">runtime</span><span class="op" id="6802035">.</span><span class="ident" id="6802036">GOOS</span><span class="op" id="6802040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802043">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802047">toudpnet</span>&nbsp;<span class="op" id="6802056">:=</span>&nbsp;<span class="keyword" id="6802059">func</span><span class="op" id="6802063">(</span><span class="ident" id="6802064">net</span>&nbsp;<span class="builtintype" id="6802068">string</span><span class="op" id="6802074">)</span>&nbsp;<span class="builtintype" id="6802076">string</span>&nbsp;<span class="op" id="6802083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802087">switch</span>&nbsp;<span class="ident" id="6802094">net</span>&nbsp;<span class="op" id="6802098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802102">case</span>&nbsp;<span class="string" id="6802107">&#34;tcp&#34;</span><span class="op" id="6802112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802117">return</span>&nbsp;<span class="string" id="6802124">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802132">case</span>&nbsp;<span class="string" id="6802137">&#34;tcp4&#34;</span><span class="op" id="6802143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802148">return</span>&nbsp;<span class="string" id="6802155">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802164">case</span>&nbsp;<span class="string" id="6802169">&#34;tcp6&#34;</span><span class="op" id="6802175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802180">return</span>&nbsp;<span class="string" id="6802187">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802196">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802200">return</span>&nbsp;<span class="string" id="6802207">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802220">for</span>&nbsp;<span class="ident" id="6802224">_</span><span class="op" id="6802225">,</span>&nbsp;<span class="ident" id="6802227">tt</span>&nbsp;<span class="op" id="6802230">:=</span>&nbsp;<span class="keyword" id="6802233">range</span>&nbsp;<span class="ident" id="6802239">listenerTests</span>&nbsp;<span class="op" id="6802253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802257">if</span>&nbsp;<span class="ident" id="6802260">tt</span><span class="op" id="6802262">.</span><span class="ident" id="6802263">wildcard</span>&nbsp;<span class="op" id="6802272">&amp;&amp;</span>&nbsp;<span class="op" id="6802275">(</span><span class="ident" id="6802276">testing</span><span class="op" id="6802283">.</span><span class="ident" id="6802284">Short</span><span class="op" id="6802289">(</span><span class="op" id="6802290">)</span>&nbsp;<span class="op" id="6802292">||</span>&nbsp;<span class="op" id="6802295">!</span><span class="op" id="6802296">*</span><span class="ident" id="6802297">testExternal</span><span class="op" id="6802309">)</span>&nbsp;<span class="op" id="6802311">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802316">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802331">if</span>&nbsp;<span class="ident" id="6802334">tt</span><span class="op" id="6802336">.</span><span class="ident" id="6802337">ipv6</span>&nbsp;<span class="op" id="6802342">&amp;&amp;</span>&nbsp;<span class="op" id="6802345">!</span><span class="ident" id="6802346">supportsIPv6</span>&nbsp;<span class="op" id="6802359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802364">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802375">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802379">tt</span><span class="op" id="6802381">.</span><span class="ident" id="6802382">net</span>&nbsp;<span class="op" id="6802386">=</span>&nbsp;<span class="ident" id="6802388">toudpnet</span><span class="op" id="6802396">(</span><span class="ident" id="6802397">tt</span><span class="op" id="6802399">.</span><span class="ident" id="6802400">net</span><span class="op" id="6802403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802407">l1</span><span class="op" id="6802409">,</span>&nbsp;<span class="ident" id="6802411">port</span>&nbsp;<span class="op" id="6802416">:=</span>&nbsp;<span class="ident" id="6802419">usableListenPacketPort</span><span class="op" id="6802441">(</span><span class="ident" id="6802442">t</span><span class="op" id="6802443">,</span>&nbsp;<span class="ident" id="6802445">tt</span><span class="op" id="6802447">.</span><span class="ident" id="6802448">net</span><span class="op" id="6802451">,</span>&nbsp;<span class="ident" id="6802453">tt</span><span class="op" id="6802455">.</span><span class="ident" id="6802456">laddr</span><span class="op" id="6802461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802465">checkFirstListener</span><span class="op" id="6802483">(</span><span class="ident" id="6802484">t</span><span class="op" id="6802485">,</span>&nbsp;<span class="ident" id="6802487">tt</span><span class="op" id="6802489">.</span><span class="ident" id="6802490">net</span><span class="op" id="6802493">,</span>&nbsp;<span class="ident" id="6802495">tt</span><span class="op" id="6802497">.</span><span class="ident" id="6802498">laddr</span><span class="op" id="6802503">+</span><span class="string" id="6802504">&#34;:&#34;</span><span class="op" id="6802507">+</span><span class="ident" id="6802508">port</span><span class="op" id="6802512">,</span>&nbsp;<span class="ident" id="6802514">l1</span><span class="op" id="6802516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802520">l2</span><span class="op" id="6802522">,</span>&nbsp;<span class="ident" id="6802524">err</span>&nbsp;<span class="op" id="6802528">:=</span>&nbsp;<span class="ident" id="6802531">ListenPacket</span><span class="op" id="6802543">(</span><span class="ident" id="6802544">tt</span><span class="op" id="6802546">.</span><span class="ident" id="6802547">net</span><span class="op" id="6802550">,</span>&nbsp;<span class="ident" id="6802552">tt</span><span class="op" id="6802554">.</span><span class="ident" id="6802555">laddr</span><span class="op" id="6802560">+</span><span class="string" id="6802561">&#34;:&#34;</span><span class="op" id="6802564">+</span><span class="ident" id="6802565">port</span><span class="op" id="6802569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802573">checkSecondListener</span><span class="op" id="6802592">(</span><span class="ident" id="6802593">t</span><span class="op" id="6802594">,</span>&nbsp;<span class="ident" id="6802596">tt</span><span class="op" id="6802598">.</span><span class="ident" id="6802599">net</span><span class="op" id="6802602">,</span>&nbsp;<span class="ident" id="6802604">tt</span><span class="op" id="6802606">.</span><span class="ident" id="6802607">laddr</span><span class="op" id="6802612">+</span><span class="string" id="6802613">&#34;:&#34;</span><span class="op" id="6802616">+</span><span class="ident" id="6802617">port</span><span class="op" id="6802621">,</span>&nbsp;<span class="ident" id="6802623">err</span><span class="op" id="6802626">,</span>&nbsp;<span class="ident" id="6802628">l2</span><span class="op" id="6802630">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802634">l1</span><span class="op" id="6802636">.</span><span class="ident" id="6802637">Close</span><span class="op" id="6802642">(</span><span class="op" id="6802643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802646">}</span><br>
<span class="lineno"></span><span class="op" id="6802648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6802651">var</span>&nbsp;<span class="ident" id="6802655">dualStackListenerTests</span>&nbsp;<span class="op" id="6802678">=</span>&nbsp;<span class="op" id="6802680">[</span><span class="op" id="6802681">]</span><span class="keyword" id="6802682">struct</span>&nbsp;<span class="op" id="6802689">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802692">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6802701">string</span>&nbsp;<span class="comment" id="6802708">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802727">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6802736">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802744">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6802753">string</span>&nbsp;<span class="comment" id="6802760">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802780">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6802789">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802797">wildcard</span>&nbsp;<span class="builtintype" id="6802806">bool</span>&nbsp;&nbsp;<span class="comment" id="6802812">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802843">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6802852">error</span>&nbsp;<span class="comment" id="6802858">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="6802896">}</span><span class="op" id="6802897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6802900">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6802982">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803071">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803160">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803246">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803332">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803418">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803507">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803594">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803681">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803768">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803855">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6803942">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804029">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804118">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804205">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804292">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804379">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804466">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804555">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804642">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804729">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804816">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804903">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804907">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804944">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6804978">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805051">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805083">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805156">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805188">//&nbsp;&nbsp;&nbsp;&nbsp;net.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805260">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6805292">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805347">{</span><span class="ident" id="6805348">net1</span><span class="op" id="6805352">:</span>&nbsp;<span class="string" id="6805354">&#34;tcp&#34;</span><span class="op" id="6805359">,</span>&nbsp;<span class="ident" id="6805361">laddr1</span><span class="op" id="6805367">:</span>&nbsp;<span class="string" id="6805369">&#34;&#34;</span><span class="op" id="6805371">,</span>&nbsp;<span class="ident" id="6805373">net2</span><span class="op" id="6805377">:</span>&nbsp;<span class="string" id="6805379">&#34;tcp&#34;</span><span class="op" id="6805384">,</span>&nbsp;<span class="ident" id="6805386">laddr2</span><span class="op" id="6805392">:</span>&nbsp;<span class="string" id="6805394">&#34;&#34;</span><span class="op" id="6805396">,</span>&nbsp;<span class="ident" id="6805398">wildcard</span><span class="op" id="6805406">:</span>&nbsp;<span class="builtintype" id="6805408">true</span><span class="op" id="6805412">,</span>&nbsp;<span class="ident" id="6805414">xerr</span><span class="op" id="6805418">:</span>&nbsp;<span class="ident" id="6805420">syscall</span><span class="op" id="6805427">.</span><span class="ident" id="6805428">EADDRINUSE</span><span class="op" id="6805438">}</span><span class="op" id="6805439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805442">{</span><span class="ident" id="6805443">net1</span><span class="op" id="6805447">:</span>&nbsp;<span class="string" id="6805449">&#34;tcp&#34;</span><span class="op" id="6805454">,</span>&nbsp;<span class="ident" id="6805456">laddr1</span><span class="op" id="6805462">:</span>&nbsp;<span class="string" id="6805464">&#34;&#34;</span><span class="op" id="6805466">,</span>&nbsp;<span class="ident" id="6805468">net2</span><span class="op" id="6805472">:</span>&nbsp;<span class="string" id="6805474">&#34;tcp&#34;</span><span class="op" id="6805479">,</span>&nbsp;<span class="ident" id="6805481">laddr2</span><span class="op" id="6805487">:</span>&nbsp;<span class="string" id="6805489">&#34;0.0.0.0&#34;</span><span class="op" id="6805498">,</span>&nbsp;<span class="ident" id="6805500">wildcard</span><span class="op" id="6805508">:</span>&nbsp;<span class="builtintype" id="6805510">true</span><span class="op" id="6805514">,</span>&nbsp;<span class="ident" id="6805516">xerr</span><span class="op" id="6805520">:</span>&nbsp;<span class="ident" id="6805522">syscall</span><span class="op" id="6805529">.</span><span class="ident" id="6805530">EADDRINUSE</span><span class="op" id="6805540">}</span><span class="op" id="6805541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805544">{</span><span class="ident" id="6805545">net1</span><span class="op" id="6805549">:</span>&nbsp;<span class="string" id="6805551">&#34;tcp&#34;</span><span class="op" id="6805556">,</span>&nbsp;<span class="ident" id="6805558">laddr1</span><span class="op" id="6805564">:</span>&nbsp;<span class="string" id="6805566">&#34;0.0.0.0&#34;</span><span class="op" id="6805575">,</span>&nbsp;<span class="ident" id="6805577">net2</span><span class="op" id="6805581">:</span>&nbsp;<span class="string" id="6805583">&#34;tcp&#34;</span><span class="op" id="6805588">,</span>&nbsp;<span class="ident" id="6805590">laddr2</span><span class="op" id="6805596">:</span>&nbsp;<span class="string" id="6805598">&#34;&#34;</span><span class="op" id="6805600">,</span>&nbsp;<span class="ident" id="6805602">wildcard</span><span class="op" id="6805610">:</span>&nbsp;<span class="builtintype" id="6805612">true</span><span class="op" id="6805616">,</span>&nbsp;<span class="ident" id="6805618">xerr</span><span class="op" id="6805622">:</span>&nbsp;<span class="ident" id="6805624">syscall</span><span class="op" id="6805631">.</span><span class="ident" id="6805632">EADDRINUSE</span><span class="op" id="6805642">}</span><span class="op" id="6805643">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805647">{</span><span class="ident" id="6805648">net1</span><span class="op" id="6805652">:</span>&nbsp;<span class="string" id="6805654">&#34;tcp&#34;</span><span class="op" id="6805659">,</span>&nbsp;<span class="ident" id="6805661">laddr1</span><span class="op" id="6805667">:</span>&nbsp;<span class="string" id="6805669">&#34;&#34;</span><span class="op" id="6805671">,</span>&nbsp;<span class="ident" id="6805673">net2</span><span class="op" id="6805677">:</span>&nbsp;<span class="string" id="6805679">&#34;tcp&#34;</span><span class="op" id="6805684">,</span>&nbsp;<span class="ident" id="6805686">laddr2</span><span class="op" id="6805692">:</span>&nbsp;<span class="string" id="6805694">&#34;[::]&#34;</span><span class="op" id="6805700">,</span>&nbsp;<span class="ident" id="6805702">wildcard</span><span class="op" id="6805710">:</span>&nbsp;<span class="builtintype" id="6805712">true</span><span class="op" id="6805716">,</span>&nbsp;<span class="ident" id="6805718">xerr</span><span class="op" id="6805722">:</span>&nbsp;<span class="ident" id="6805724">syscall</span><span class="op" id="6805731">.</span><span class="ident" id="6805732">EADDRINUSE</span><span class="op" id="6805742">}</span><span class="op" id="6805743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805746">{</span><span class="ident" id="6805747">net1</span><span class="op" id="6805751">:</span>&nbsp;<span class="string" id="6805753">&#34;tcp&#34;</span><span class="op" id="6805758">,</span>&nbsp;<span class="ident" id="6805760">laddr1</span><span class="op" id="6805766">:</span>&nbsp;<span class="string" id="6805768">&#34;[::]&#34;</span><span class="op" id="6805774">,</span>&nbsp;<span class="ident" id="6805776">net2</span><span class="op" id="6805780">:</span>&nbsp;<span class="string" id="6805782">&#34;tcp&#34;</span><span class="op" id="6805787">,</span>&nbsp;<span class="ident" id="6805789">laddr2</span><span class="op" id="6805795">:</span>&nbsp;<span class="string" id="6805797">&#34;&#34;</span><span class="op" id="6805799">,</span>&nbsp;<span class="ident" id="6805801">wildcard</span><span class="op" id="6805809">:</span>&nbsp;<span class="builtintype" id="6805811">true</span><span class="op" id="6805815">,</span>&nbsp;<span class="ident" id="6805817">xerr</span><span class="op" id="6805821">:</span>&nbsp;<span class="ident" id="6805823">syscall</span><span class="op" id="6805830">.</span><span class="ident" id="6805831">EADDRINUSE</span><span class="op" id="6805841">}</span><span class="op" id="6805842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805845">{</span><span class="ident" id="6805846">net1</span><span class="op" id="6805850">:</span>&nbsp;<span class="string" id="6805852">&#34;tcp&#34;</span><span class="op" id="6805857">,</span>&nbsp;<span class="ident" id="6805859">laddr1</span><span class="op" id="6805865">:</span>&nbsp;<span class="string" id="6805867">&#34;0.0.0.0&#34;</span><span class="op" id="6805876">,</span>&nbsp;<span class="ident" id="6805878">net2</span><span class="op" id="6805882">:</span>&nbsp;<span class="string" id="6805884">&#34;tcp&#34;</span><span class="op" id="6805889">,</span>&nbsp;<span class="ident" id="6805891">laddr2</span><span class="op" id="6805897">:</span>&nbsp;<span class="string" id="6805899">&#34;[::]&#34;</span><span class="op" id="6805905">,</span>&nbsp;<span class="ident" id="6805907">wildcard</span><span class="op" id="6805915">:</span>&nbsp;<span class="builtintype" id="6805917">true</span><span class="op" id="6805921">,</span>&nbsp;<span class="ident" id="6805923">xerr</span><span class="op" id="6805927">:</span>&nbsp;<span class="ident" id="6805929">syscall</span><span class="op" id="6805936">.</span><span class="ident" id="6805937">EADDRINUSE</span><span class="op" id="6805947">}</span><span class="op" id="6805948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805951">{</span><span class="ident" id="6805952">net1</span><span class="op" id="6805956">:</span>&nbsp;<span class="string" id="6805958">&#34;tcp&#34;</span><span class="op" id="6805963">,</span>&nbsp;<span class="ident" id="6805965">laddr1</span><span class="op" id="6805971">:</span>&nbsp;<span class="string" id="6805973">&#34;[::]&#34;</span><span class="op" id="6805979">,</span>&nbsp;<span class="ident" id="6805981">net2</span><span class="op" id="6805985">:</span>&nbsp;<span class="string" id="6805987">&#34;tcp&#34;</span><span class="op" id="6805992">,</span>&nbsp;<span class="ident" id="6805994">laddr2</span><span class="op" id="6806000">:</span>&nbsp;<span class="string" id="6806002">&#34;0.0.0.0&#34;</span><span class="op" id="6806011">,</span>&nbsp;<span class="ident" id="6806013">wildcard</span><span class="op" id="6806021">:</span>&nbsp;<span class="builtintype" id="6806023">true</span><span class="op" id="6806027">,</span>&nbsp;<span class="ident" id="6806029">xerr</span><span class="op" id="6806033">:</span>&nbsp;<span class="ident" id="6806035">syscall</span><span class="op" id="6806042">.</span><span class="ident" id="6806043">EADDRINUSE</span><span class="op" id="6806053">}</span><span class="op" id="6806054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806057">{</span><span class="ident" id="6806058">net1</span><span class="op" id="6806062">:</span>&nbsp;<span class="string" id="6806064">&#34;tcp&#34;</span><span class="op" id="6806069">,</span>&nbsp;<span class="ident" id="6806071">laddr1</span><span class="op" id="6806077">:</span>&nbsp;<span class="string" id="6806079">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6806097">,</span>&nbsp;<span class="ident" id="6806099">net2</span><span class="op" id="6806103">:</span>&nbsp;<span class="string" id="6806105">&#34;tcp&#34;</span><span class="op" id="6806110">,</span>&nbsp;<span class="ident" id="6806112">laddr2</span><span class="op" id="6806118">:</span>&nbsp;<span class="string" id="6806120">&#34;[::]&#34;</span><span class="op" id="6806126">,</span>&nbsp;<span class="ident" id="6806128">wildcard</span><span class="op" id="6806136">:</span>&nbsp;<span class="builtintype" id="6806138">true</span><span class="op" id="6806142">,</span>&nbsp;<span class="ident" id="6806144">xerr</span><span class="op" id="6806148">:</span>&nbsp;<span class="ident" id="6806150">syscall</span><span class="op" id="6806157">.</span><span class="ident" id="6806158">EADDRINUSE</span><span class="op" id="6806168">}</span><span class="op" id="6806169">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806172">{</span><span class="ident" id="6806173">net1</span><span class="op" id="6806177">:</span>&nbsp;<span class="string" id="6806179">&#34;tcp&#34;</span><span class="op" id="6806184">,</span>&nbsp;<span class="ident" id="6806186">laddr1</span><span class="op" id="6806192">:</span>&nbsp;<span class="string" id="6806194">&#34;[::]&#34;</span><span class="op" id="6806200">,</span>&nbsp;<span class="ident" id="6806202">net2</span><span class="op" id="6806206">:</span>&nbsp;<span class="string" id="6806208">&#34;tcp&#34;</span><span class="op" id="6806213">,</span>&nbsp;<span class="ident" id="6806215">laddr2</span><span class="op" id="6806221">:</span>&nbsp;<span class="string" id="6806223">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6806241">,</span>&nbsp;<span class="ident" id="6806243">wildcard</span><span class="op" id="6806251">:</span>&nbsp;<span class="builtintype" id="6806253">true</span><span class="op" id="6806257">,</span>&nbsp;<span class="ident" id="6806259">xerr</span><span class="op" id="6806263">:</span>&nbsp;<span class="ident" id="6806265">syscall</span><span class="op" id="6806272">.</span><span class="ident" id="6806273">EADDRINUSE</span><span class="op" id="6806283">}</span><span class="op" id="6806284">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806288">{</span><span class="ident" id="6806289">net1</span><span class="op" id="6806293">:</span>&nbsp;<span class="string" id="6806295">&#34;tcp4&#34;</span><span class="op" id="6806301">,</span>&nbsp;<span class="ident" id="6806303">laddr1</span><span class="op" id="6806309">:</span>&nbsp;<span class="string" id="6806311">&#34;&#34;</span><span class="op" id="6806313">,</span>&nbsp;<span class="ident" id="6806315">net2</span><span class="op" id="6806319">:</span>&nbsp;<span class="string" id="6806321">&#34;tcp6&#34;</span><span class="op" id="6806327">,</span>&nbsp;<span class="ident" id="6806329">laddr2</span><span class="op" id="6806335">:</span>&nbsp;<span class="string" id="6806337">&#34;&#34;</span><span class="op" id="6806339">,</span>&nbsp;<span class="ident" id="6806341">wildcard</span><span class="op" id="6806349">:</span>&nbsp;<span class="builtintype" id="6806351">true</span><span class="op" id="6806355">}</span><span class="op" id="6806356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806359">{</span><span class="ident" id="6806360">net1</span><span class="op" id="6806364">:</span>&nbsp;<span class="string" id="6806366">&#34;tcp6&#34;</span><span class="op" id="6806372">,</span>&nbsp;<span class="ident" id="6806374">laddr1</span><span class="op" id="6806380">:</span>&nbsp;<span class="string" id="6806382">&#34;&#34;</span><span class="op" id="6806384">,</span>&nbsp;<span class="ident" id="6806386">net2</span><span class="op" id="6806390">:</span>&nbsp;<span class="string" id="6806392">&#34;tcp4&#34;</span><span class="op" id="6806398">,</span>&nbsp;<span class="ident" id="6806400">laddr2</span><span class="op" id="6806406">:</span>&nbsp;<span class="string" id="6806408">&#34;&#34;</span><span class="op" id="6806410">,</span>&nbsp;<span class="ident" id="6806412">wildcard</span><span class="op" id="6806420">:</span>&nbsp;<span class="builtintype" id="6806422">true</span><span class="op" id="6806426">}</span><span class="op" id="6806427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806430">{</span><span class="ident" id="6806431">net1</span><span class="op" id="6806435">:</span>&nbsp;<span class="string" id="6806437">&#34;tcp4&#34;</span><span class="op" id="6806443">,</span>&nbsp;<span class="ident" id="6806445">laddr1</span><span class="op" id="6806451">:</span>&nbsp;<span class="string" id="6806453">&#34;0.0.0.0&#34;</span><span class="op" id="6806462">,</span>&nbsp;<span class="ident" id="6806464">net2</span><span class="op" id="6806468">:</span>&nbsp;<span class="string" id="6806470">&#34;tcp6&#34;</span><span class="op" id="6806476">,</span>&nbsp;<span class="ident" id="6806478">laddr2</span><span class="op" id="6806484">:</span>&nbsp;<span class="string" id="6806486">&#34;[::]&#34;</span><span class="op" id="6806492">,</span>&nbsp;<span class="ident" id="6806494">wildcard</span><span class="op" id="6806502">:</span>&nbsp;<span class="builtintype" id="6806504">true</span><span class="op" id="6806508">}</span><span class="op" id="6806509">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806512">{</span><span class="ident" id="6806513">net1</span><span class="op" id="6806517">:</span>&nbsp;<span class="string" id="6806519">&#34;tcp6&#34;</span><span class="op" id="6806525">,</span>&nbsp;<span class="ident" id="6806527">laddr1</span><span class="op" id="6806533">:</span>&nbsp;<span class="string" id="6806535">&#34;[::]&#34;</span><span class="op" id="6806541">,</span>&nbsp;<span class="ident" id="6806543">net2</span><span class="op" id="6806547">:</span>&nbsp;<span class="string" id="6806549">&#34;tcp4&#34;</span><span class="op" id="6806555">,</span>&nbsp;<span class="ident" id="6806557">laddr2</span><span class="op" id="6806563">:</span>&nbsp;<span class="string" id="6806565">&#34;0.0.0.0&#34;</span><span class="op" id="6806574">,</span>&nbsp;<span class="ident" id="6806576">wildcard</span><span class="op" id="6806584">:</span>&nbsp;<span class="builtintype" id="6806586">true</span><span class="op" id="6806590">}</span><span class="op" id="6806591">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806595">{</span><span class="ident" id="6806596">net1</span><span class="op" id="6806600">:</span>&nbsp;<span class="string" id="6806602">&#34;tcp&#34;</span><span class="op" id="6806607">,</span>&nbsp;<span class="ident" id="6806609">laddr1</span><span class="op" id="6806615">:</span>&nbsp;<span class="string" id="6806617">&#34;127.0.0.1&#34;</span><span class="op" id="6806628">,</span>&nbsp;<span class="ident" id="6806630">net2</span><span class="op" id="6806634">:</span>&nbsp;<span class="string" id="6806636">&#34;tcp&#34;</span><span class="op" id="6806641">,</span>&nbsp;<span class="ident" id="6806643">laddr2</span><span class="op" id="6806649">:</span>&nbsp;<span class="string" id="6806651">&#34;[::1]&#34;</span><span class="op" id="6806658">}</span><span class="op" id="6806659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806662">{</span><span class="ident" id="6806663">net1</span><span class="op" id="6806667">:</span>&nbsp;<span class="string" id="6806669">&#34;tcp&#34;</span><span class="op" id="6806674">,</span>&nbsp;<span class="ident" id="6806676">laddr1</span><span class="op" id="6806682">:</span>&nbsp;<span class="string" id="6806684">&#34;[::1]&#34;</span><span class="op" id="6806691">,</span>&nbsp;<span class="ident" id="6806693">net2</span><span class="op" id="6806697">:</span>&nbsp;<span class="string" id="6806699">&#34;tcp&#34;</span><span class="op" id="6806704">,</span>&nbsp;<span class="ident" id="6806706">laddr2</span><span class="op" id="6806712">:</span>&nbsp;<span class="string" id="6806714">&#34;127.0.0.1&#34;</span><span class="op" id="6806725">}</span><span class="op" id="6806726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806729">{</span><span class="ident" id="6806730">net1</span><span class="op" id="6806734">:</span>&nbsp;<span class="string" id="6806736">&#34;tcp4&#34;</span><span class="op" id="6806742">,</span>&nbsp;<span class="ident" id="6806744">laddr1</span><span class="op" id="6806750">:</span>&nbsp;<span class="string" id="6806752">&#34;127.0.0.1&#34;</span><span class="op" id="6806763">,</span>&nbsp;<span class="ident" id="6806765">net2</span><span class="op" id="6806769">:</span>&nbsp;<span class="string" id="6806771">&#34;tcp6&#34;</span><span class="op" id="6806777">,</span>&nbsp;<span class="ident" id="6806779">laddr2</span><span class="op" id="6806785">:</span>&nbsp;<span class="string" id="6806787">&#34;[::1]&#34;</span><span class="op" id="6806794">}</span><span class="op" id="6806795">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806798">{</span><span class="ident" id="6806799">net1</span><span class="op" id="6806803">:</span>&nbsp;<span class="string" id="6806805">&#34;tcp6&#34;</span><span class="op" id="6806811">,</span>&nbsp;<span class="ident" id="6806813">laddr1</span><span class="op" id="6806819">:</span>&nbsp;<span class="string" id="6806821">&#34;[::1]&#34;</span><span class="op" id="6806828">,</span>&nbsp;<span class="ident" id="6806830">net2</span><span class="op" id="6806834">:</span>&nbsp;<span class="string" id="6806836">&#34;tcp4&#34;</span><span class="op" id="6806842">,</span>&nbsp;<span class="ident" id="6806844">laddr2</span><span class="op" id="6806850">:</span>&nbsp;<span class="string" id="6806852">&#34;127.0.0.1&#34;</span><span class="op" id="6806863">}</span><span class="op" id="6806864">,</span><br>
<span class="lineno"></span><span class="op" id="6806866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6806869">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6806933">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="6806996">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6807032">func</span>&nbsp;<span class="ident" id="6807037">TestDualStackTCPListener</span><span class="op" id="6807061">(</span><span class="ident" id="6807062">t</span>&nbsp;<span class="op" id="6807064">*</span><span class="ident" id="6807065">testing</span><span class="op" id="6807072">.</span><span class="ident" id="6807073">T</span><span class="op" id="6807074">)</span>&nbsp;<span class="op" id="6807076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807079">if</span>&nbsp;<span class="ident" id="6807082">testing</span><span class="op" id="6807089">.</span><span class="ident" id="6807090">Short</span><span class="op" id="6807095">(</span><span class="op" id="6807096">)</span>&nbsp;<span class="op" id="6807098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807102">t</span><span class="op" id="6807103">.</span><span class="ident" id="6807104">Skip</span><span class="op" id="6807108">(</span><span class="string" id="6807109">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6807150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807153">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807156">switch</span>&nbsp;<span class="ident" id="6807163">runtime</span><span class="op" id="6807170">.</span><span class="ident" id="6807171">GOOS</span>&nbsp;<span class="op" id="6807176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807179">case</span>&nbsp;<span class="string" id="6807184">&#34;plan9&#34;</span><span class="op" id="6807191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807195">t</span><span class="op" id="6807196">.</span><span class="ident" id="6807197">Skipf</span><span class="op" id="6807202">(</span><span class="string" id="6807203">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6807224">,</span>&nbsp;<span class="ident" id="6807226">runtime</span><span class="op" id="6807233">.</span><span class="ident" id="6807234">GOOS</span><span class="op" id="6807238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807244">if</span>&nbsp;<span class="op" id="6807247">!</span><span class="ident" id="6807248">supportsIPv6</span>&nbsp;<span class="op" id="6807261">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807265">t</span><span class="op" id="6807266">.</span><span class="ident" id="6807267">Skip</span><span class="op" id="6807271">(</span><span class="string" id="6807272">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6807295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807302">for</span>&nbsp;<span class="ident" id="6807306">_</span><span class="op" id="6807307">,</span>&nbsp;<span class="ident" id="6807309">tt</span>&nbsp;<span class="op" id="6807312">:=</span>&nbsp;<span class="keyword" id="6807315">range</span>&nbsp;<span class="ident" id="6807321">dualStackListenerTests</span>&nbsp;<span class="op" id="6807344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807348">if</span>&nbsp;<span class="ident" id="6807351">tt</span><span class="op" id="6807353">.</span><span class="ident" id="6807354">wildcard</span>&nbsp;<span class="op" id="6807363">&amp;&amp;</span>&nbsp;<span class="op" id="6807366">!</span><span class="op" id="6807367">*</span><span class="ident" id="6807368">testExternal</span>&nbsp;<span class="op" id="6807381">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807386">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807401">switch</span>&nbsp;<span class="ident" id="6807408">runtime</span><span class="op" id="6807415">.</span><span class="ident" id="6807416">GOOS</span>&nbsp;<span class="op" id="6807421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807425">case</span>&nbsp;<span class="string" id="6807430">&#34;openbsd&#34;</span><span class="op" id="6807439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6807444">if</span>&nbsp;<span class="ident" id="6807447">tt</span><span class="op" id="6807449">.</span><span class="ident" id="6807450">wildcard</span>&nbsp;<span class="op" id="6807459">&amp;&amp;</span>&nbsp;<span class="ident" id="6807462">differentWildcardAddr</span><span class="op" id="6807483">(</span><span class="ident" id="6807484">tt</span><span class="op" id="6807486">.</span><span class="ident" id="6807487">laddr1</span><span class="op" id="6807493">,</span>&nbsp;<span class="ident" id="6807495">tt</span><span class="op" id="6807497">.</span><span class="ident" id="6807498">laddr2</span><span class="op" id="6807504">)</span>&nbsp;<span class="op" id="6807506">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807512">tt</span><span class="op" id="6807514">.</span><span class="ident" id="6807515">xerr</span>&nbsp;<span class="op" id="6807520">=</span>&nbsp;<span class="builtintype" id="6807522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807537">l1</span><span class="op" id="6807539">,</span>&nbsp;<span class="ident" id="6807541">port</span>&nbsp;<span class="op" id="6807546">:=</span>&nbsp;<span class="ident" id="6807549">usableListenPort</span><span class="op" id="6807565">(</span><span class="ident" id="6807566">t</span><span class="op" id="6807567">,</span>&nbsp;<span class="ident" id="6807569">tt</span><span class="op" id="6807571">.</span><span class="ident" id="6807572">net1</span><span class="op" id="6807576">,</span>&nbsp;<span class="ident" id="6807578">tt</span><span class="op" id="6807580">.</span><span class="ident" id="6807581">laddr1</span><span class="op" id="6807587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807591">laddr</span>&nbsp;<span class="op" id="6807597">:=</span>&nbsp;<span class="ident" id="6807600">tt</span><span class="op" id="6807602">.</span><span class="ident" id="6807603">laddr1</span>&nbsp;<span class="op" id="6807610">+</span>&nbsp;<span class="string" id="6807612">&#34;:&#34;</span>&nbsp;<span class="op" id="6807616">+</span>&nbsp;<span class="ident" id="6807618">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807625">checkFirstListener</span><span class="op" id="6807643">(</span><span class="ident" id="6807644">t</span><span class="op" id="6807645">,</span>&nbsp;<span class="ident" id="6807647">tt</span><span class="op" id="6807649">.</span><span class="ident" id="6807650">net1</span><span class="op" id="6807654">,</span>&nbsp;<span class="ident" id="6807656">laddr</span><span class="op" id="6807661">,</span>&nbsp;<span class="ident" id="6807663">l1</span><span class="op" id="6807665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807669">laddr</span>&nbsp;<span class="op" id="6807675">=</span>&nbsp;<span class="ident" id="6807677">tt</span><span class="op" id="6807679">.</span><span class="ident" id="6807680">laddr2</span>&nbsp;<span class="op" id="6807687">+</span>&nbsp;<span class="string" id="6807689">&#34;:&#34;</span>&nbsp;<span class="op" id="6807693">+</span>&nbsp;<span class="ident" id="6807695">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807702">l2</span><span class="op" id="6807704">,</span>&nbsp;<span class="ident" id="6807706">err</span>&nbsp;<span class="op" id="6807710">:=</span>&nbsp;<span class="ident" id="6807713">Listen</span><span class="op" id="6807719">(</span><span class="ident" id="6807720">tt</span><span class="op" id="6807722">.</span><span class="ident" id="6807723">net2</span><span class="op" id="6807727">,</span>&nbsp;<span class="ident" id="6807729">laddr</span><span class="op" id="6807734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807738">checkDualStackSecondListener</span><span class="op" id="6807766">(</span><span class="ident" id="6807767">t</span><span class="op" id="6807768">,</span>&nbsp;<span class="ident" id="6807770">tt</span><span class="op" id="6807772">.</span><span class="ident" id="6807773">net2</span><span class="op" id="6807777">,</span>&nbsp;<span class="ident" id="6807779">laddr</span><span class="op" id="6807784">,</span>&nbsp;<span class="ident" id="6807786">tt</span><span class="op" id="6807788">.</span><span class="ident" id="6807789">xerr</span><span class="op" id="6807793">,</span>&nbsp;<span class="ident" id="6807795">err</span><span class="op" id="6807798">,</span>&nbsp;<span class="ident" id="6807800">l2</span><span class="op" id="6807802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6807806">l1</span><span class="op" id="6807808">.</span><span class="ident" id="6807809">Close</span><span class="op" id="6807814">(</span><span class="op" id="6807815">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6807818">}</span><br>
<span class="lineno"></span><span class="op" id="6807820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6807823">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6807887">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="6807950">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6807986">func</span>&nbsp;<span class="ident" id="6807991">TestDualStackUDPListener</span><span class="op" id="6808015">(</span><span class="ident" id="6808016">t</span>&nbsp;<span class="op" id="6808018">*</span><span class="ident" id="6808019">testing</span><span class="op" id="6808026">.</span><span class="ident" id="6808027">T</span><span class="op" id="6808028">)</span>&nbsp;<span class="op" id="6808030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808033">if</span>&nbsp;<span class="ident" id="6808036">testing</span><span class="op" id="6808043">.</span><span class="ident" id="6808044">Short</span><span class="op" id="6808049">(</span><span class="op" id="6808050">)</span>&nbsp;<span class="op" id="6808052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808056">t</span><span class="op" id="6808057">.</span><span class="ident" id="6808058">Skip</span><span class="op" id="6808062">(</span><span class="string" id="6808063">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6808104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808107">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808110">switch</span>&nbsp;<span class="ident" id="6808117">runtime</span><span class="op" id="6808124">.</span><span class="ident" id="6808125">GOOS</span>&nbsp;<span class="op" id="6808130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808133">case</span>&nbsp;<span class="string" id="6808138">&#34;plan9&#34;</span><span class="op" id="6808145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808149">t</span><span class="op" id="6808150">.</span><span class="ident" id="6808151">Skipf</span><span class="op" id="6808156">(</span><span class="string" id="6808157">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6808178">,</span>&nbsp;<span class="ident" id="6808180">runtime</span><span class="op" id="6808187">.</span><span class="ident" id="6808188">GOOS</span><span class="op" id="6808192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808198">if</span>&nbsp;<span class="op" id="6808201">!</span><span class="ident" id="6808202">supportsIPv6</span>&nbsp;<span class="op" id="6808215">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808219">t</span><span class="op" id="6808220">.</span><span class="ident" id="6808221">Skip</span><span class="op" id="6808225">(</span><span class="string" id="6808226">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6808249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808256">toudpnet</span>&nbsp;<span class="op" id="6808265">:=</span>&nbsp;<span class="keyword" id="6808268">func</span><span class="op" id="6808272">(</span><span class="ident" id="6808273">net</span>&nbsp;<span class="builtintype" id="6808277">string</span><span class="op" id="6808283">)</span>&nbsp;<span class="builtintype" id="6808285">string</span>&nbsp;<span class="op" id="6808292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808296">switch</span>&nbsp;<span class="ident" id="6808303">net</span>&nbsp;<span class="op" id="6808307">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808311">case</span>&nbsp;<span class="string" id="6808316">&#34;tcp&#34;</span><span class="op" id="6808321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808326">return</span>&nbsp;<span class="string" id="6808333">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808341">case</span>&nbsp;<span class="string" id="6808346">&#34;tcp4&#34;</span><span class="op" id="6808352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808357">return</span>&nbsp;<span class="string" id="6808364">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808373">case</span>&nbsp;<span class="string" id="6808378">&#34;tcp6&#34;</span><span class="op" id="6808384">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808389">return</span>&nbsp;<span class="string" id="6808396">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808409">return</span>&nbsp;<span class="string" id="6808416">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808429">for</span>&nbsp;<span class="ident" id="6808433">_</span><span class="op" id="6808434">,</span>&nbsp;<span class="ident" id="6808436">tt</span>&nbsp;<span class="op" id="6808439">:=</span>&nbsp;<span class="keyword" id="6808442">range</span>&nbsp;<span class="ident" id="6808448">dualStackListenerTests</span>&nbsp;<span class="op" id="6808471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808475">if</span>&nbsp;<span class="ident" id="6808478">tt</span><span class="op" id="6808480">.</span><span class="ident" id="6808481">wildcard</span>&nbsp;<span class="op" id="6808490">&amp;&amp;</span>&nbsp;<span class="op" id="6808493">(</span><span class="ident" id="6808494">testing</span><span class="op" id="6808501">.</span><span class="ident" id="6808502">Short</span><span class="op" id="6808507">(</span><span class="op" id="6808508">)</span>&nbsp;<span class="op" id="6808510">||</span>&nbsp;<span class="op" id="6808513">!</span><span class="op" id="6808514">*</span><span class="ident" id="6808515">testExternal</span><span class="op" id="6808527">)</span>&nbsp;<span class="op" id="6808529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808534">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808549">tt</span><span class="op" id="6808551">.</span><span class="ident" id="6808552">net1</span>&nbsp;<span class="op" id="6808557">=</span>&nbsp;<span class="ident" id="6808559">toudpnet</span><span class="op" id="6808567">(</span><span class="ident" id="6808568">tt</span><span class="op" id="6808570">.</span><span class="ident" id="6808571">net1</span><span class="op" id="6808575">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808579">tt</span><span class="op" id="6808581">.</span><span class="ident" id="6808582">net2</span>&nbsp;<span class="op" id="6808587">=</span>&nbsp;<span class="ident" id="6808589">toudpnet</span><span class="op" id="6808597">(</span><span class="ident" id="6808598">tt</span><span class="op" id="6808600">.</span><span class="ident" id="6808601">net2</span><span class="op" id="6808605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808609">switch</span>&nbsp;<span class="ident" id="6808616">runtime</span><span class="op" id="6808623">.</span><span class="ident" id="6808624">GOOS</span>&nbsp;<span class="op" id="6808629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808633">case</span>&nbsp;<span class="string" id="6808638">&#34;openbsd&#34;</span><span class="op" id="6808647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6808652">if</span>&nbsp;<span class="ident" id="6808655">tt</span><span class="op" id="6808657">.</span><span class="ident" id="6808658">wildcard</span>&nbsp;<span class="op" id="6808667">&amp;&amp;</span>&nbsp;<span class="ident" id="6808670">differentWildcardAddr</span><span class="op" id="6808691">(</span><span class="ident" id="6808692">tt</span><span class="op" id="6808694">.</span><span class="ident" id="6808695">laddr1</span><span class="op" id="6808701">,</span>&nbsp;<span class="ident" id="6808703">tt</span><span class="op" id="6808705">.</span><span class="ident" id="6808706">laddr2</span><span class="op" id="6808712">)</span>&nbsp;<span class="op" id="6808714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808720">tt</span><span class="op" id="6808722">.</span><span class="ident" id="6808723">xerr</span>&nbsp;<span class="op" id="6808728">=</span>&nbsp;<span class="builtintype" id="6808730">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6808741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808745">l1</span><span class="op" id="6808747">,</span>&nbsp;<span class="ident" id="6808749">port</span>&nbsp;<span class="op" id="6808754">:=</span>&nbsp;<span class="ident" id="6808757">usableListenPacketPort</span><span class="op" id="6808779">(</span><span class="ident" id="6808780">t</span><span class="op" id="6808781">,</span>&nbsp;<span class="ident" id="6808783">tt</span><span class="op" id="6808785">.</span><span class="ident" id="6808786">net1</span><span class="op" id="6808790">,</span>&nbsp;<span class="ident" id="6808792">tt</span><span class="op" id="6808794">.</span><span class="ident" id="6808795">laddr1</span><span class="op" id="6808801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808805">laddr</span>&nbsp;<span class="op" id="6808811">:=</span>&nbsp;<span class="ident" id="6808814">tt</span><span class="op" id="6808816">.</span><span class="ident" id="6808817">laddr1</span>&nbsp;<span class="op" id="6808824">+</span>&nbsp;<span class="string" id="6808826">&#34;:&#34;</span>&nbsp;<span class="op" id="6808830">+</span>&nbsp;<span class="ident" id="6808832">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808839">checkFirstListener</span><span class="op" id="6808857">(</span><span class="ident" id="6808858">t</span><span class="op" id="6808859">,</span>&nbsp;<span class="ident" id="6808861">tt</span><span class="op" id="6808863">.</span><span class="ident" id="6808864">net1</span><span class="op" id="6808868">,</span>&nbsp;<span class="ident" id="6808870">laddr</span><span class="op" id="6808875">,</span>&nbsp;<span class="ident" id="6808877">l1</span><span class="op" id="6808879">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808883">laddr</span>&nbsp;<span class="op" id="6808889">=</span>&nbsp;<span class="ident" id="6808891">tt</span><span class="op" id="6808893">.</span><span class="ident" id="6808894">laddr2</span>&nbsp;<span class="op" id="6808901">+</span>&nbsp;<span class="string" id="6808903">&#34;:&#34;</span>&nbsp;<span class="op" id="6808907">+</span>&nbsp;<span class="ident" id="6808909">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808916">l2</span><span class="op" id="6808918">,</span>&nbsp;<span class="ident" id="6808920">err</span>&nbsp;<span class="op" id="6808924">:=</span>&nbsp;<span class="ident" id="6808927">ListenPacket</span><span class="op" id="6808939">(</span><span class="ident" id="6808940">tt</span><span class="op" id="6808942">.</span><span class="ident" id="6808943">net2</span><span class="op" id="6808947">,</span>&nbsp;<span class="ident" id="6808949">laddr</span><span class="op" id="6808954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6808958">checkDualStackSecondListener</span><span class="op" id="6808986">(</span><span class="ident" id="6808987">t</span><span class="op" id="6808988">,</span>&nbsp;<span class="ident" id="6808990">tt</span><span class="op" id="6808992">.</span><span class="ident" id="6808993">net2</span><span class="op" id="6808997">,</span>&nbsp;<span class="ident" id="6808999">laddr</span><span class="op" id="6809004">,</span>&nbsp;<span class="ident" id="6809006">tt</span><span class="op" id="6809008">.</span><span class="ident" id="6809009">xerr</span><span class="op" id="6809013">,</span>&nbsp;<span class="ident" id="6809015">err</span><span class="op" id="6809018">,</span>&nbsp;<span class="ident" id="6809020">l2</span><span class="op" id="6809022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809026">l1</span><span class="op" id="6809028">.</span><span class="ident" id="6809029">Close</span><span class="op" id="6809034">(</span><span class="op" id="6809035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809038">}</span><br>
<span class="lineno">250</span><span class="op" id="6809040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6809043">func</span>&nbsp;<span class="ident" id="6809048">usableListenPort</span><span class="op" id="6809064">(</span><span class="ident" id="6809065">t</span>&nbsp;<span class="op" id="6809067">*</span><span class="ident" id="6809068">testing</span><span class="op" id="6809075">.</span><span class="ident" id="6809076">T</span><span class="op" id="6809077">,</span>&nbsp;<span class="ident" id="6809079">net</span><span class="op" id="6809082">,</span>&nbsp;<span class="ident" id="6809084">laddr</span>&nbsp;<span class="builtintype" id="6809090">string</span><span class="op" id="6809096">)</span>&nbsp;<span class="op" id="6809098">(</span><span class="ident" id="6809099">l</span>&nbsp;<span class="ident" id="6809101">Listener</span><span class="op" id="6809109">,</span>&nbsp;<span class="ident" id="6809111">port</span>&nbsp;<span class="builtintype" id="6809116">string</span><span class="op" id="6809122">)</span>&nbsp;<span class="op" id="6809124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809127">var</span>&nbsp;<span class="ident" id="6809131">nladdr</span>&nbsp;<span class="builtintype" id="6809138">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809146">var</span>&nbsp;<span class="ident" id="6809150">err</span>&nbsp;<span class="builtintype" id="6809154">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809161">switch</span>&nbsp;<span class="ident" id="6809168">net</span>&nbsp;<span class="op" id="6809172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809175">default</span><span class="op" id="6809182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6809186">panic</span><span class="op" id="6809191">(</span><span class="string" id="6809192">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6809216">+</span>&nbsp;<span class="ident" id="6809218">net</span><span class="op" id="6809221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809224">case</span>&nbsp;<span class="string" id="6809229">&#34;tcp&#34;</span><span class="op" id="6809234">,</span>&nbsp;<span class="string" id="6809236">&#34;tcp4&#34;</span><span class="op" id="6809242">,</span>&nbsp;<span class="string" id="6809244">&#34;tcp6&#34;</span><span class="op" id="6809250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809254">l</span><span class="op" id="6809255">,</span>&nbsp;<span class="ident" id="6809257">err</span>&nbsp;<span class="op" id="6809261">=</span>&nbsp;<span class="ident" id="6809263">Listen</span><span class="op" id="6809269">(</span><span class="ident" id="6809270">net</span><span class="op" id="6809273">,</span>&nbsp;<span class="ident" id="6809275">laddr</span><span class="op" id="6809280">+</span><span class="string" id="6809281">&#34;:0&#34;</span><span class="op" id="6809285">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809289">if</span>&nbsp;<span class="ident" id="6809292">err</span>&nbsp;<span class="op" id="6809296">!=</span>&nbsp;<span class="builtintype" id="6809299">nil</span>&nbsp;<span class="op" id="6809303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809308">t</span><span class="op" id="6809309">.</span><span class="ident" id="6809310">Fatalf</span><span class="op" id="6809316">(</span><span class="string" id="6809317">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6809350">,</span>&nbsp;<span class="ident" id="6809352">net</span><span class="op" id="6809355">,</span>&nbsp;<span class="ident" id="6809357">laddr</span><span class="op" id="6809362">,</span>&nbsp;<span class="ident" id="6809364">err</span><span class="op" id="6809367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809375">nladdr</span>&nbsp;<span class="op" id="6809382">=</span>&nbsp;<span class="ident" id="6809384">l</span><span class="op" id="6809385">.</span><span class="op" id="6809386">(</span><span class="op" id="6809387">*</span><span class="ident" id="6809388">TCPListener</span><span class="op" id="6809399">)</span><span class="op" id="6809400">.</span><span class="ident" id="6809401">Addr</span><span class="op" id="6809405">(</span><span class="op" id="6809406">)</span><span class="op" id="6809407">.</span><span class="ident" id="6809408">String</span><span class="op" id="6809414">(</span><span class="op" id="6809415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809418">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809421">_</span><span class="op" id="6809422">,</span>&nbsp;<span class="ident" id="6809424">port</span><span class="op" id="6809428">,</span>&nbsp;<span class="ident" id="6809430">err</span>&nbsp;<span class="op" id="6809434">=</span>&nbsp;<span class="ident" id="6809436">SplitHostPort</span><span class="op" id="6809449">(</span><span class="ident" id="6809450">nladdr</span><span class="op" id="6809456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809459">if</span>&nbsp;<span class="ident" id="6809462">err</span>&nbsp;<span class="op" id="6809466">!=</span>&nbsp;<span class="builtintype" id="6809469">nil</span>&nbsp;<span class="op" id="6809473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809477">t</span><span class="op" id="6809478">.</span><span class="ident" id="6809479">Fatalf</span><span class="op" id="6809485">(</span><span class="string" id="6809486">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6809512">,</span>&nbsp;<span class="ident" id="6809514">err</span><span class="op" id="6809517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809523">return</span>&nbsp;<span class="ident" id="6809530">l</span><span class="op" id="6809531">,</span>&nbsp;<span class="ident" id="6809533">port</span><br>
<span class="lineno">270</span><span class="op" id="6809538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6809541">func</span>&nbsp;<span class="ident" id="6809546">usableListenPacketPort</span><span class="op" id="6809568">(</span><span class="ident" id="6809569">t</span>&nbsp;<span class="op" id="6809571">*</span><span class="ident" id="6809572">testing</span><span class="op" id="6809579">.</span><span class="ident" id="6809580">T</span><span class="op" id="6809581">,</span>&nbsp;<span class="ident" id="6809583">net</span><span class="op" id="6809586">,</span>&nbsp;<span class="ident" id="6809588">laddr</span>&nbsp;<span class="builtintype" id="6809594">string</span><span class="op" id="6809600">)</span>&nbsp;<span class="op" id="6809602">(</span><span class="ident" id="6809603">l</span>&nbsp;<span class="ident" id="6809605">PacketConn</span><span class="op" id="6809615">,</span>&nbsp;<span class="ident" id="6809617">port</span>&nbsp;<span class="builtintype" id="6809622">string</span><span class="op" id="6809628">)</span>&nbsp;<span class="op" id="6809630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809633">var</span>&nbsp;<span class="ident" id="6809637">nladdr</span>&nbsp;<span class="builtintype" id="6809644">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809652">var</span>&nbsp;<span class="ident" id="6809656">err</span>&nbsp;<span class="builtintype" id="6809660">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809667">switch</span>&nbsp;<span class="ident" id="6809674">net</span>&nbsp;<span class="op" id="6809678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809681">default</span><span class="op" id="6809688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6809692">panic</span><span class="op" id="6809697">(</span><span class="string" id="6809698">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6809728">+</span>&nbsp;<span class="ident" id="6809730">net</span><span class="op" id="6809733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809736">case</span>&nbsp;<span class="string" id="6809741">&#34;udp&#34;</span><span class="op" id="6809746">,</span>&nbsp;<span class="string" id="6809748">&#34;udp4&#34;</span><span class="op" id="6809754">,</span>&nbsp;<span class="string" id="6809756">&#34;udp6&#34;</span><span class="op" id="6809762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809766">l</span><span class="op" id="6809767">,</span>&nbsp;<span class="ident" id="6809769">err</span>&nbsp;<span class="op" id="6809773">=</span>&nbsp;<span class="ident" id="6809775">ListenPacket</span><span class="op" id="6809787">(</span><span class="ident" id="6809788">net</span><span class="op" id="6809791">,</span>&nbsp;<span class="ident" id="6809793">laddr</span><span class="op" id="6809798">+</span><span class="string" id="6809799">&#34;:0&#34;</span><span class="op" id="6809803">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809807">if</span>&nbsp;<span class="ident" id="6809810">err</span>&nbsp;<span class="op" id="6809814">!=</span>&nbsp;<span class="builtintype" id="6809817">nil</span>&nbsp;<span class="op" id="6809821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809826">t</span><span class="op" id="6809827">.</span><span class="ident" id="6809828">Fatalf</span><span class="op" id="6809834">(</span><span class="string" id="6809835">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6809874">,</span>&nbsp;<span class="ident" id="6809876">net</span><span class="op" id="6809879">,</span>&nbsp;<span class="ident" id="6809881">laddr</span><span class="op" id="6809886">,</span>&nbsp;<span class="ident" id="6809888">err</span><span class="op" id="6809891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809899">nladdr</span>&nbsp;<span class="op" id="6809906">=</span>&nbsp;<span class="ident" id="6809908">l</span><span class="op" id="6809909">.</span><span class="op" id="6809910">(</span><span class="op" id="6809911">*</span><span class="ident" id="6809912">UDPConn</span><span class="op" id="6809919">)</span><span class="op" id="6809920">.</span><span class="ident" id="6809921">LocalAddr</span><span class="op" id="6809930">(</span><span class="op" id="6809931">)</span><span class="op" id="6809932">.</span><span class="ident" id="6809933">String</span><span class="op" id="6809939">(</span><span class="op" id="6809940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6809943">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6809946">_</span><span class="op" id="6809947">,</span>&nbsp;<span class="ident" id="6809949">port</span><span class="op" id="6809953">,</span>&nbsp;<span class="ident" id="6809955">err</span>&nbsp;<span class="op" id="6809959">=</span>&nbsp;<span class="ident" id="6809961">SplitHostPort</span><span class="op" id="6809974">(</span><span class="ident" id="6809975">nladdr</span><span class="op" id="6809981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6809984">if</span>&nbsp;<span class="ident" id="6809987">err</span>&nbsp;<span class="op" id="6809991">!=</span>&nbsp;<span class="builtintype" id="6809994">nil</span>&nbsp;<span class="op" id="6809998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810002">t</span><span class="op" id="6810003">.</span><span class="ident" id="6810004">Fatalf</span><span class="op" id="6810010">(</span><span class="string" id="6810011">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6810037">,</span>&nbsp;<span class="ident" id="6810039">err</span><span class="op" id="6810042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6810045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810048">return</span>&nbsp;<span class="ident" id="6810055">l</span><span class="op" id="6810056">,</span>&nbsp;<span class="ident" id="6810058">port</span><br>
<span class="lineno">290</span><span class="op" id="6810063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810066">func</span>&nbsp;<span class="ident" id="6810071">differentWildcardAddr</span><span class="op" id="6810092">(</span><span class="ident" id="6810093">i</span><span class="op" id="6810094">,</span>&nbsp;<span class="ident" id="6810096">j</span>&nbsp;<span class="builtintype" id="6810098">string</span><span class="op" id="6810104">)</span>&nbsp;<span class="builtintype" id="6810106">bool</span>&nbsp;<span class="op" id="6810111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810114">if</span>&nbsp;<span class="op" id="6810117">(</span><span class="ident" id="6810118">i</span>&nbsp;<span class="op" id="6810120">==</span>&nbsp;<span class="string" id="6810123">&#34;&#34;</span>&nbsp;<span class="op" id="6810126">||</span>&nbsp;<span class="ident" id="6810129">i</span>&nbsp;<span class="op" id="6810131">==</span>&nbsp;<span class="string" id="6810134">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6810144">||</span>&nbsp;<span class="ident" id="6810147">i</span>&nbsp;<span class="op" id="6810149">==</span>&nbsp;<span class="string" id="6810152">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6810168">)</span>&nbsp;<span class="op" id="6810170">&amp;&amp;</span>&nbsp;<span class="op" id="6810173">(</span><span class="ident" id="6810174">j</span>&nbsp;<span class="op" id="6810176">==</span>&nbsp;<span class="string" id="6810179">&#34;&#34;</span>&nbsp;<span class="op" id="6810182">||</span>&nbsp;<span class="ident" id="6810185">j</span>&nbsp;<span class="op" id="6810187">==</span>&nbsp;<span class="string" id="6810190">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6810200">||</span>&nbsp;<span class="ident" id="6810203">j</span>&nbsp;<span class="op" id="6810205">==</span>&nbsp;<span class="string" id="6810208">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6810224">)</span>&nbsp;<span class="op" id="6810226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810230">return</span>&nbsp;<span class="builtintype" id="6810237">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6810244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810247">if</span>&nbsp;<span class="ident" id="6810250">i</span>&nbsp;<span class="op" id="6810252">==</span>&nbsp;<span class="string" id="6810255">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6810262">&amp;&amp;</span>&nbsp;<span class="ident" id="6810265">j</span>&nbsp;<span class="op" id="6810267">==</span>&nbsp;<span class="string" id="6810270">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6810277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810281">return</span>&nbsp;<span class="builtintype" id="6810288">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6810295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810298">return</span>&nbsp;<span class="builtintype" id="6810305">true</span><br>
<span class="lineno">300</span><span class="op" id="6810310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810313">func</span>&nbsp;<span class="ident" id="6810318">checkFirstListener</span><span class="op" id="6810336">(</span><span class="ident" id="6810337">t</span>&nbsp;<span class="op" id="6810339">*</span><span class="ident" id="6810340">testing</span><span class="op" id="6810347">.</span><span class="ident" id="6810348">T</span><span class="op" id="6810349">,</span>&nbsp;<span class="ident" id="6810351">net</span><span class="op" id="6810354">,</span>&nbsp;<span class="ident" id="6810356">laddr</span>&nbsp;<span class="builtintype" id="6810362">string</span><span class="op" id="6810368">,</span>&nbsp;<span class="ident" id="6810370">l</span>&nbsp;<span class="keyword" id="6810372">interface</span><span class="op" id="6810381">{</span><span class="op" id="6810382">}</span><span class="op" id="6810383">)</span>&nbsp;<span class="op" id="6810385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810388">switch</span>&nbsp;<span class="ident" id="6810395">net</span>&nbsp;<span class="op" id="6810399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810402">case</span>&nbsp;<span class="string" id="6810407">&#34;tcp&#34;</span><span class="op" id="6810412">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810416">fd</span>&nbsp;<span class="op" id="6810419">:=</span>&nbsp;<span class="ident" id="6810422">l</span><span class="op" id="6810423">.</span><span class="op" id="6810424">(</span><span class="op" id="6810425">*</span><span class="ident" id="6810426">TCPListener</span><span class="op" id="6810437">)</span><span class="op" id="6810438">.</span><span class="ident" id="6810439">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810444">checkDualStackAddrFamily</span><span class="op" id="6810468">(</span><span class="ident" id="6810469">t</span><span class="op" id="6810470">,</span>&nbsp;<span class="ident" id="6810472">net</span><span class="op" id="6810475">,</span>&nbsp;<span class="ident" id="6810477">laddr</span><span class="op" id="6810482">,</span>&nbsp;<span class="ident" id="6810484">fd</span><span class="op" id="6810486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810489">case</span>&nbsp;<span class="string" id="6810494">&#34;tcp4&#34;</span><span class="op" id="6810500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810504">fd</span>&nbsp;<span class="op" id="6810507">:=</span>&nbsp;<span class="ident" id="6810510">l</span><span class="op" id="6810511">.</span><span class="op" id="6810512">(</span><span class="op" id="6810513">*</span><span class="ident" id="6810514">TCPListener</span><span class="op" id="6810525">)</span><span class="op" id="6810526">.</span><span class="ident" id="6810527">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810532">if</span>&nbsp;<span class="ident" id="6810535">fd</span><span class="op" id="6810537">.</span><span class="ident" id="6810538">family</span>&nbsp;<span class="op" id="6810545">!=</span>&nbsp;<span class="ident" id="6810548">syscall</span><span class="op" id="6810555">.</span><span class="ident" id="6810556">AF_INET</span>&nbsp;<span class="op" id="6810564">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810569">t</span><span class="op" id="6810570">.</span><span class="ident" id="6810571">Fatalf</span><span class="op" id="6810577">(</span><span class="string" id="6810578">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6810639">,</span>&nbsp;<span class="ident" id="6810641">net</span><span class="op" id="6810644">,</span>&nbsp;<span class="ident" id="6810646">laddr</span><span class="op" id="6810651">,</span>&nbsp;<span class="ident" id="6810653">fd</span><span class="op" id="6810655">.</span><span class="ident" id="6810656">family</span><span class="op" id="6810662">,</span>&nbsp;<span class="ident" id="6810664">syscall</span><span class="op" id="6810671">.</span><span class="ident" id="6810672">AF_INET</span><span class="op" id="6810679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6810683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810686">case</span>&nbsp;<span class="string" id="6810691">&#34;tcp6&#34;</span><span class="op" id="6810697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810701">fd</span>&nbsp;<span class="op" id="6810704">:=</span>&nbsp;<span class="ident" id="6810707">l</span><span class="op" id="6810708">.</span><span class="op" id="6810709">(</span><span class="op" id="6810710">*</span><span class="ident" id="6810711">TCPListener</span><span class="op" id="6810722">)</span><span class="op" id="6810723">.</span><span class="ident" id="6810724">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810729">if</span>&nbsp;<span class="ident" id="6810732">fd</span><span class="op" id="6810734">.</span><span class="ident" id="6810735">family</span>&nbsp;<span class="op" id="6810742">!=</span>&nbsp;<span class="ident" id="6810745">syscall</span><span class="op" id="6810752">.</span><span class="ident" id="6810753">AF_INET6</span>&nbsp;<span class="op" id="6810762">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810767">t</span><span class="op" id="6810768">.</span><span class="ident" id="6810769">Fatalf</span><span class="op" id="6810775">(</span><span class="string" id="6810776">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6810837">,</span>&nbsp;<span class="ident" id="6810839">net</span><span class="op" id="6810842">,</span>&nbsp;<span class="ident" id="6810844">laddr</span><span class="op" id="6810849">,</span>&nbsp;<span class="ident" id="6810851">fd</span><span class="op" id="6810853">.</span><span class="ident" id="6810854">family</span><span class="op" id="6810860">,</span>&nbsp;<span class="ident" id="6810862">syscall</span><span class="op" id="6810869">.</span><span class="ident" id="6810870">AF_INET6</span><span class="op" id="6810878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6810882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810885">case</span>&nbsp;<span class="string" id="6810890">&#34;udp&#34;</span><span class="op" id="6810895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810899">fd</span>&nbsp;<span class="op" id="6810902">:=</span>&nbsp;<span class="ident" id="6810905">l</span><span class="op" id="6810906">.</span><span class="op" id="6810907">(</span><span class="op" id="6810908">*</span><span class="ident" id="6810909">UDPConn</span><span class="op" id="6810916">)</span><span class="op" id="6810917">.</span><span class="ident" id="6810918">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810923">checkDualStackAddrFamily</span><span class="op" id="6810947">(</span><span class="ident" id="6810948">t</span><span class="op" id="6810949">,</span>&nbsp;<span class="ident" id="6810951">net</span><span class="op" id="6810954">,</span>&nbsp;<span class="ident" id="6810956">laddr</span><span class="op" id="6810961">,</span>&nbsp;<span class="ident" id="6810963">fd</span><span class="op" id="6810965">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6810968">case</span>&nbsp;<span class="string" id="6810973">&#34;udp4&#34;</span><span class="op" id="6810979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6810983">fd</span>&nbsp;<span class="op" id="6810986">:=</span>&nbsp;<span class="ident" id="6810989">l</span><span class="op" id="6810990">.</span><span class="op" id="6810991">(</span><span class="op" id="6810992">*</span><span class="ident" id="6810993">UDPConn</span><span class="op" id="6811000">)</span><span class="op" id="6811001">.</span><span class="ident" id="6811002">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811007">if</span>&nbsp;<span class="ident" id="6811010">fd</span><span class="op" id="6811012">.</span><span class="ident" id="6811013">family</span>&nbsp;<span class="op" id="6811020">!=</span>&nbsp;<span class="ident" id="6811023">syscall</span><span class="op" id="6811030">.</span><span class="ident" id="6811031">AF_INET</span>&nbsp;<span class="op" id="6811039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811044">t</span><span class="op" id="6811045">.</span><span class="ident" id="6811046">Fatalf</span><span class="op" id="6811052">(</span><span class="string" id="6811053">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6811120">,</span>&nbsp;<span class="ident" id="6811122">net</span><span class="op" id="6811125">,</span>&nbsp;<span class="ident" id="6811127">laddr</span><span class="op" id="6811132">,</span>&nbsp;<span class="ident" id="6811134">fd</span><span class="op" id="6811136">.</span><span class="ident" id="6811137">family</span><span class="op" id="6811143">,</span>&nbsp;<span class="ident" id="6811145">syscall</span><span class="op" id="6811152">.</span><span class="ident" id="6811153">AF_INET</span><span class="op" id="6811160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811164">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811167">case</span>&nbsp;<span class="string" id="6811172">&#34;udp6&#34;</span><span class="op" id="6811178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811182">fd</span>&nbsp;<span class="op" id="6811185">:=</span>&nbsp;<span class="ident" id="6811188">l</span><span class="op" id="6811189">.</span><span class="op" id="6811190">(</span><span class="op" id="6811191">*</span><span class="ident" id="6811192">UDPConn</span><span class="op" id="6811199">)</span><span class="op" id="6811200">.</span><span class="ident" id="6811201">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811206">if</span>&nbsp;<span class="ident" id="6811209">fd</span><span class="op" id="6811211">.</span><span class="ident" id="6811212">family</span>&nbsp;<span class="op" id="6811219">!=</span>&nbsp;<span class="ident" id="6811222">syscall</span><span class="op" id="6811229">.</span><span class="ident" id="6811230">AF_INET6</span>&nbsp;<span class="op" id="6811239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811244">t</span><span class="op" id="6811245">.</span><span class="ident" id="6811246">Fatalf</span><span class="op" id="6811252">(</span><span class="string" id="6811253">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6811320">,</span>&nbsp;<span class="ident" id="6811322">net</span><span class="op" id="6811325">,</span>&nbsp;<span class="ident" id="6811327">laddr</span><span class="op" id="6811332">,</span>&nbsp;<span class="ident" id="6811334">fd</span><span class="op" id="6811336">.</span><span class="ident" id="6811337">family</span><span class="op" id="6811343">,</span>&nbsp;<span class="ident" id="6811345">syscall</span><span class="op" id="6811352">.</span><span class="ident" id="6811353">AF_INET6</span><span class="op" id="6811361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811365">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811368">default</span><span class="op" id="6811375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811379">t</span><span class="op" id="6811380">.</span><span class="ident" id="6811381">Fatalf</span><span class="op" id="6811387">(</span><span class="string" id="6811388">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6811412">,</span>&nbsp;<span class="ident" id="6811414">net</span><span class="op" id="6811417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811420">}</span><br>
<span class="lineno"></span><span class="op" id="6811422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6811425">func</span>&nbsp;<span class="ident" id="6811430">checkSecondListener</span><span class="op" id="6811449">(</span><span class="ident" id="6811450">t</span>&nbsp;<span class="op" id="6811452">*</span><span class="ident" id="6811453">testing</span><span class="op" id="6811460">.</span><span class="ident" id="6811461">T</span><span class="op" id="6811462">,</span>&nbsp;<span class="ident" id="6811464">net</span><span class="op" id="6811467">,</span>&nbsp;<span class="ident" id="6811469">laddr</span>&nbsp;<span class="builtintype" id="6811475">string</span><span class="op" id="6811481">,</span>&nbsp;<span class="ident" id="6811483">err</span>&nbsp;<span class="builtintype" id="6811487">error</span><span class="op" id="6811492">,</span>&nbsp;<span class="ident" id="6811494">l</span>&nbsp;<span class="keyword" id="6811496">interface</span><span class="op" id="6811505">{</span><span class="op" id="6811506">}</span><span class="op" id="6811507">)</span>&nbsp;<span class="op" id="6811509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811512">switch</span>&nbsp;<span class="ident" id="6811519">net</span>&nbsp;<span class="op" id="6811523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811526">case</span>&nbsp;<span class="string" id="6811531">&#34;tcp&#34;</span><span class="op" id="6811536">,</span>&nbsp;<span class="string" id="6811538">&#34;tcp4&#34;</span><span class="op" id="6811544">,</span>&nbsp;<span class="string" id="6811546">&#34;tcp6&#34;</span><span class="op" id="6811552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811556">if</span>&nbsp;<span class="ident" id="6811559">err</span>&nbsp;<span class="op" id="6811563">==</span>&nbsp;<span class="builtintype" id="6811566">nil</span>&nbsp;<span class="op" id="6811570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811575">l</span><span class="op" id="6811576">.</span><span class="op" id="6811577">(</span><span class="op" id="6811578">*</span><span class="ident" id="6811579">TCPListener</span><span class="op" id="6811590">)</span><span class="op" id="6811591">.</span><span class="ident" id="6811592">Close</span><span class="op" id="6811597">(</span><span class="op" id="6811598">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811603">t</span><span class="op" id="6811604">.</span><span class="ident" id="6811605">Fatalf</span><span class="op" id="6811611">(</span><span class="string" id="6811612">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6811647">,</span>&nbsp;<span class="ident" id="6811649">net</span><span class="op" id="6811652">,</span>&nbsp;<span class="ident" id="6811654">laddr</span><span class="op" id="6811659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811666">case</span>&nbsp;<span class="string" id="6811671">&#34;udp&#34;</span><span class="op" id="6811676">,</span>&nbsp;<span class="string" id="6811678">&#34;udp4&#34;</span><span class="op" id="6811684">,</span>&nbsp;<span class="string" id="6811686">&#34;udp6&#34;</span><span class="op" id="6811692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811696">if</span>&nbsp;<span class="ident" id="6811699">err</span>&nbsp;<span class="op" id="6811703">==</span>&nbsp;<span class="builtintype" id="6811706">nil</span>&nbsp;<span class="op" id="6811710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811715">l</span><span class="op" id="6811716">.</span><span class="op" id="6811717">(</span><span class="op" id="6811718">*</span><span class="ident" id="6811719">UDPConn</span><span class="op" id="6811726">)</span><span class="op" id="6811727">.</span><span class="ident" id="6811728">Close</span><span class="op" id="6811733">(</span><span class="op" id="6811734">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811739">t</span><span class="op" id="6811740">.</span><span class="ident" id="6811741">Fatalf</span><span class="op" id="6811747">(</span><span class="string" id="6811748">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6811789">,</span>&nbsp;<span class="ident" id="6811791">net</span><span class="op" id="6811794">,</span>&nbsp;<span class="ident" id="6811796">laddr</span><span class="op" id="6811801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811808">default</span><span class="op" id="6811815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6811819">t</span><span class="op" id="6811820">.</span><span class="ident" id="6811821">Fatalf</span><span class="op" id="6811827">(</span><span class="string" id="6811828">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6811852">,</span>&nbsp;<span class="ident" id="6811854">net</span><span class="op" id="6811857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6811860">}</span><br>
<span class="lineno">350</span><span class="op" id="6811862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6811865">func</span>&nbsp;<span class="ident" id="6811870">checkDualStackSecondListener</span><span class="op" id="6811898">(</span><span class="ident" id="6811899">t</span>&nbsp;<span class="op" id="6811901">*</span><span class="ident" id="6811902">testing</span><span class="op" id="6811909">.</span><span class="ident" id="6811910">T</span><span class="op" id="6811911">,</span>&nbsp;<span class="ident" id="6811913">net</span><span class="op" id="6811916">,</span>&nbsp;<span class="ident" id="6811918">laddr</span>&nbsp;<span class="builtintype" id="6811924">string</span><span class="op" id="6811930">,</span>&nbsp;<span class="ident" id="6811932">xerr</span><span class="op" id="6811936">,</span>&nbsp;<span class="ident" id="6811938">err</span>&nbsp;<span class="builtintype" id="6811942">error</span><span class="op" id="6811947">,</span>&nbsp;<span class="ident" id="6811949">l</span>&nbsp;<span class="keyword" id="6811951">interface</span><span class="op" id="6811960">{</span><span class="op" id="6811961">}</span><span class="op" id="6811962">)</span>&nbsp;<span class="op" id="6811964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811967">switch</span>&nbsp;<span class="ident" id="6811974">net</span>&nbsp;<span class="op" id="6811978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6811981">case</span>&nbsp;<span class="string" id="6811986">&#34;tcp&#34;</span><span class="op" id="6811991">,</span>&nbsp;<span class="string" id="6811993">&#34;tcp4&#34;</span><span class="op" id="6811999">,</span>&nbsp;<span class="string" id="6812001">&#34;tcp6&#34;</span><span class="op" id="6812007">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812011">if</span>&nbsp;<span class="ident" id="6812014">xerr</span>&nbsp;<span class="op" id="6812019">==</span>&nbsp;<span class="builtintype" id="6812022">nil</span>&nbsp;<span class="op" id="6812026">&amp;&amp;</span>&nbsp;<span class="ident" id="6812029">err</span>&nbsp;<span class="op" id="6812033">!=</span>&nbsp;<span class="builtintype" id="6812036">nil</span>&nbsp;<span class="op" id="6812040">||</span>&nbsp;<span class="ident" id="6812043">xerr</span>&nbsp;<span class="op" id="6812048">!=</span>&nbsp;<span class="builtintype" id="6812051">nil</span>&nbsp;<span class="op" id="6812055">&amp;&amp;</span>&nbsp;<span class="ident" id="6812058">err</span>&nbsp;<span class="op" id="6812062">==</span>&nbsp;<span class="builtintype" id="6812065">nil</span>&nbsp;<span class="op" id="6812069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812074">t</span><span class="op" id="6812075">.</span><span class="ident" id="6812076">Fatalf</span><span class="op" id="6812082">(</span><span class="string" id="6812083">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6812130">,</span>&nbsp;<span class="ident" id="6812132">net</span><span class="op" id="6812135">,</span>&nbsp;<span class="ident" id="6812137">laddr</span><span class="op" id="6812142">,</span>&nbsp;<span class="ident" id="6812144">err</span><span class="op" id="6812147">,</span>&nbsp;<span class="ident" id="6812149">xerr</span><span class="op" id="6812153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6812157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812161">if</span>&nbsp;<span class="ident" id="6812164">err</span>&nbsp;<span class="op" id="6812168">==</span>&nbsp;<span class="builtintype" id="6812171">nil</span>&nbsp;<span class="op" id="6812175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812180">l</span><span class="op" id="6812181">.</span><span class="op" id="6812182">(</span><span class="op" id="6812183">*</span><span class="ident" id="6812184">TCPListener</span><span class="op" id="6812195">)</span><span class="op" id="6812196">.</span><span class="ident" id="6812197">Close</span><span class="op" id="6812202">(</span><span class="op" id="6812203">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6812207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812210">case</span>&nbsp;<span class="string" id="6812215">&#34;udp&#34;</span><span class="op" id="6812220">,</span>&nbsp;<span class="string" id="6812222">&#34;udp4&#34;</span><span class="op" id="6812228">,</span>&nbsp;<span class="string" id="6812230">&#34;udp6&#34;</span><span class="op" id="6812236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812240">if</span>&nbsp;<span class="ident" id="6812243">xerr</span>&nbsp;<span class="op" id="6812248">==</span>&nbsp;<span class="builtintype" id="6812251">nil</span>&nbsp;<span class="op" id="6812255">&amp;&amp;</span>&nbsp;<span class="ident" id="6812258">err</span>&nbsp;<span class="op" id="6812262">!=</span>&nbsp;<span class="builtintype" id="6812265">nil</span>&nbsp;<span class="op" id="6812269">||</span>&nbsp;<span class="ident" id="6812272">xerr</span>&nbsp;<span class="op" id="6812277">!=</span>&nbsp;<span class="builtintype" id="6812280">nil</span>&nbsp;<span class="op" id="6812284">&amp;&amp;</span>&nbsp;<span class="ident" id="6812287">err</span>&nbsp;<span class="op" id="6812291">==</span>&nbsp;<span class="builtintype" id="6812294">nil</span>&nbsp;<span class="op" id="6812298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812303">t</span><span class="op" id="6812304">.</span><span class="ident" id="6812305">Fatalf</span><span class="op" id="6812311">(</span><span class="string" id="6812312">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6812365">,</span>&nbsp;<span class="ident" id="6812367">net</span><span class="op" id="6812370">,</span>&nbsp;<span class="ident" id="6812372">laddr</span><span class="op" id="6812377">,</span>&nbsp;<span class="ident" id="6812379">err</span><span class="op" id="6812382">,</span>&nbsp;<span class="ident" id="6812384">xerr</span><span class="op" id="6812388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6812392">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812396">if</span>&nbsp;<span class="ident" id="6812399">err</span>&nbsp;<span class="op" id="6812403">==</span>&nbsp;<span class="builtintype" id="6812406">nil</span>&nbsp;<span class="op" id="6812410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812415">l</span><span class="op" id="6812416">.</span><span class="op" id="6812417">(</span><span class="op" id="6812418">*</span><span class="ident" id="6812419">UDPConn</span><span class="op" id="6812426">)</span><span class="op" id="6812427">.</span><span class="ident" id="6812428">Close</span><span class="op" id="6812433">(</span><span class="op" id="6812434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6812438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812441">default</span><span class="op" id="6812448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812452">t</span><span class="op" id="6812453">.</span><span class="ident" id="6812454">Fatalf</span><span class="op" id="6812460">(</span><span class="string" id="6812461">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6812485">,</span>&nbsp;<span class="ident" id="6812487">net</span><span class="op" id="6812490">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6812493">}</span><br>
<span class="lineno"></span><span class="op" id="6812495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6812498">func</span>&nbsp;<span class="ident" id="6812503">checkDualStackAddrFamily</span><span class="op" id="6812527">(</span><span class="ident" id="6812528">t</span>&nbsp;<span class="op" id="6812530">*</span><span class="ident" id="6812531">testing</span><span class="op" id="6812538">.</span><span class="ident" id="6812539">T</span><span class="op" id="6812540">,</span>&nbsp;<span class="ident" id="6812542">net</span><span class="op" id="6812545">,</span>&nbsp;<span class="ident" id="6812547">laddr</span>&nbsp;<span class="builtintype" id="6812553">string</span><span class="op" id="6812559">,</span>&nbsp;<span class="ident" id="6812561">fd</span>&nbsp;<span class="op" id="6812564">*</span><span class="ident" id="6812565">netFD</span><span class="op" id="6812570">)</span>&nbsp;<span class="op" id="6812572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812575">switch</span>&nbsp;<span class="ident" id="6812582">a</span>&nbsp;<span class="op" id="6812584">:=</span>&nbsp;<span class="ident" id="6812587">fd</span><span class="op" id="6812589">.</span><span class="ident" id="6812590">laddr</span><span class="op" id="6812595">.</span><span class="op" id="6812596">(</span><span class="keyword" id="6812597">type</span><span class="op" id="6812601">)</span>&nbsp;<span class="op" id="6812603">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812606">case</span>&nbsp;<span class="op" id="6812611">*</span><span class="ident" id="6812612">TCPAddr</span><span class="op" id="6812619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6812623">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6812679">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6812732">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6812789">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812811">if</span>&nbsp;<span class="ident" id="6812814">supportsIPv4map</span>&nbsp;<span class="op" id="6812830">&amp;&amp;</span>&nbsp;<span class="ident" id="6812833">fd</span><span class="op" id="6812835">.</span><span class="ident" id="6812836">laddr</span><span class="op" id="6812841">.</span><span class="op" id="6812842">(</span><span class="op" id="6812843">*</span><span class="ident" id="6812844">TCPAddr</span><span class="op" id="6812851">)</span><span class="op" id="6812852">.</span><span class="ident" id="6812853">isWildcard</span><span class="op" id="6812863">(</span><span class="op" id="6812864">)</span>&nbsp;<span class="op" id="6812866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6812871">if</span>&nbsp;<span class="ident" id="6812874">fd</span><span class="op" id="6812876">.</span><span class="ident" id="6812877">family</span>&nbsp;<span class="op" id="6812884">!=</span>&nbsp;<span class="ident" id="6812887">syscall</span><span class="op" id="6812894">.</span><span class="ident" id="6812895">AF_INET6</span>&nbsp;<span class="op" id="6812904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6812910">t</span><span class="op" id="6812911">.</span><span class="ident" id="6812912">Fatalf</span><span class="op" id="6812918">(</span><span class="string" id="6812919">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6812974">,</span>&nbsp;<span class="ident" id="6812976">net</span><span class="op" id="6812979">,</span>&nbsp;<span class="ident" id="6812981">laddr</span><span class="op" id="6812986">,</span>&nbsp;<span class="ident" id="6812988">fd</span><span class="op" id="6812990">.</span><span class="ident" id="6812991">family</span><span class="op" id="6812997">,</span>&nbsp;<span class="ident" id="6812999">syscall</span><span class="op" id="6813006">.</span><span class="ident" id="6813007">AF_INET6</span><span class="op" id="6813015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813024">}</span>&nbsp;<span class="keyword" id="6813026">else</span>&nbsp;<span class="op" id="6813031">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813036">if</span>&nbsp;<span class="ident" id="6813039">fd</span><span class="op" id="6813041">.</span><span class="ident" id="6813042">family</span>&nbsp;<span class="op" id="6813049">!=</span>&nbsp;<span class="ident" id="6813052">a</span><span class="op" id="6813053">.</span><span class="ident" id="6813054">family</span><span class="op" id="6813060">(</span><span class="op" id="6813061">)</span>&nbsp;<span class="op" id="6813063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813069">t</span><span class="op" id="6813070">.</span><span class="ident" id="6813071">Fatalf</span><span class="op" id="6813077">(</span><span class="string" id="6813078">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6813133">,</span>&nbsp;<span class="ident" id="6813135">net</span><span class="op" id="6813138">,</span>&nbsp;<span class="ident" id="6813140">laddr</span><span class="op" id="6813145">,</span>&nbsp;<span class="ident" id="6813147">fd</span><span class="op" id="6813149">.</span><span class="ident" id="6813150">family</span><span class="op" id="6813156">,</span>&nbsp;<span class="ident" id="6813158">a</span><span class="op" id="6813159">.</span><span class="ident" id="6813160">family</span><span class="op" id="6813166">(</span><span class="op" id="6813167">)</span><span class="op" id="6813168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813180">case</span>&nbsp;<span class="op" id="6813185">*</span><span class="ident" id="6813186">UDPAddr</span><span class="op" id="6813193">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6813197">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6813253">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6813306">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6813363">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813385">if</span>&nbsp;<span class="ident" id="6813388">supportsIPv4map</span>&nbsp;<span class="op" id="6813404">&amp;&amp;</span>&nbsp;<span class="ident" id="6813407">fd</span><span class="op" id="6813409">.</span><span class="ident" id="6813410">laddr</span><span class="op" id="6813415">.</span><span class="op" id="6813416">(</span><span class="op" id="6813417">*</span><span class="ident" id="6813418">UDPAddr</span><span class="op" id="6813425">)</span><span class="op" id="6813426">.</span><span class="ident" id="6813427">isWildcard</span><span class="op" id="6813437">(</span><span class="op" id="6813438">)</span>&nbsp;<span class="op" id="6813440">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813445">if</span>&nbsp;<span class="ident" id="6813448">fd</span><span class="op" id="6813450">.</span><span class="ident" id="6813451">family</span>&nbsp;<span class="op" id="6813458">!=</span>&nbsp;<span class="ident" id="6813461">syscall</span><span class="op" id="6813468">.</span><span class="ident" id="6813469">AF_INET6</span>&nbsp;<span class="op" id="6813478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813484">t</span><span class="op" id="6813485">.</span><span class="ident" id="6813486">Fatalf</span><span class="op" id="6813492">(</span><span class="string" id="6813493">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6813554">,</span>&nbsp;<span class="ident" id="6813556">net</span><span class="op" id="6813559">,</span>&nbsp;<span class="ident" id="6813561">laddr</span><span class="op" id="6813566">,</span>&nbsp;<span class="ident" id="6813568">fd</span><span class="op" id="6813570">.</span><span class="ident" id="6813571">family</span><span class="op" id="6813577">,</span>&nbsp;<span class="ident" id="6813579">syscall</span><span class="op" id="6813586">.</span><span class="ident" id="6813587">AF_INET6</span><span class="op" id="6813595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813604">}</span>&nbsp;<span class="keyword" id="6813606">else</span>&nbsp;<span class="op" id="6813611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813616">if</span>&nbsp;<span class="ident" id="6813619">fd</span><span class="op" id="6813621">.</span><span class="ident" id="6813622">family</span>&nbsp;<span class="op" id="6813629">!=</span>&nbsp;<span class="ident" id="6813632">a</span><span class="op" id="6813633">.</span><span class="ident" id="6813634">family</span><span class="op" id="6813640">(</span><span class="op" id="6813641">)</span>&nbsp;<span class="op" id="6813643">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813649">t</span><span class="op" id="6813650">.</span><span class="ident" id="6813651">Fatalf</span><span class="op" id="6813657">(</span><span class="string" id="6813658">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6813719">,</span>&nbsp;<span class="ident" id="6813721">net</span><span class="op" id="6813724">,</span>&nbsp;<span class="ident" id="6813726">laddr</span><span class="op" id="6813731">,</span>&nbsp;<span class="ident" id="6813733">fd</span><span class="op" id="6813735">.</span><span class="ident" id="6813736">family</span><span class="op" id="6813742">,</span>&nbsp;<span class="ident" id="6813744">a</span><span class="op" id="6813745">.</span><span class="ident" id="6813746">family</span><span class="op" id="6813752">(</span><span class="op" id="6813753">)</span><span class="op" id="6813754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6813766">default</span><span class="op" id="6813773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813777">t</span><span class="op" id="6813778">.</span><span class="ident" id="6813779">Fatalf</span><span class="op" id="6813785">(</span><span class="string" id="6813786">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="6813824">,</span>&nbsp;<span class="ident" id="6813826">a</span><span class="op" id="6813827">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813830">}</span><br>
<span class="lineno"></span><span class="op" id="6813832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6813835">var</span>&nbsp;<span class="ident" id="6813839">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6813866">=</span>&nbsp;<span class="op" id="6813868">[</span><span class="op" id="6813869">]</span><span class="keyword" id="6813870">struct</span>&nbsp;<span class="op" id="6813877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813880">net</span>&nbsp;&nbsp;<span class="builtintype" id="6813885">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6813893">addr</span>&nbsp;<span class="builtintype" id="6813898">string</span><br>
<span class="lineno"></span><span class="op" id="6813905">}</span><span class="op" id="6813906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813909">{</span><span class="string" id="6813910">&#34;tcp6&#34;</span><span class="op" id="6813916">,</span>&nbsp;<span class="string" id="6813918">&#34;127.0.0.1&#34;</span><span class="op" id="6813929">}</span><span class="op" id="6813930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6813933">{</span><span class="string" id="6813934">&#34;tcp6&#34;</span><span class="op" id="6813940">,</span>&nbsp;<span class="string" id="6813942">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6813962">}</span><span class="op" id="6813963">,</span><br>
<span class="lineno"></span><span class="op" id="6813965">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="6813968">func</span>&nbsp;<span class="ident" id="6813973">TestProhibitionaryDialArgs</span><span class="op" id="6813999">(</span><span class="ident" id="6814000">t</span>&nbsp;<span class="op" id="6814002">*</span><span class="ident" id="6814003">testing</span><span class="op" id="6814010">.</span><span class="ident" id="6814011">T</span><span class="op" id="6814012">)</span>&nbsp;<span class="op" id="6814014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814017">switch</span>&nbsp;<span class="ident" id="6814024">runtime</span><span class="op" id="6814031">.</span><span class="ident" id="6814032">GOOS</span>&nbsp;<span class="op" id="6814037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814040">case</span>&nbsp;<span class="string" id="6814045">&#34;plan9&#34;</span><span class="op" id="6814052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814056">t</span><span class="op" id="6814057">.</span><span class="ident" id="6814058">Skipf</span><span class="op" id="6814063">(</span><span class="string" id="6814064">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6814085">,</span>&nbsp;<span class="ident" id="6814087">runtime</span><span class="op" id="6814094">.</span><span class="ident" id="6814095">GOOS</span><span class="op" id="6814099">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6814105">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814175">if</span>&nbsp;<span class="op" id="6814178">!</span><span class="ident" id="6814179">supportsIPv4map</span>&nbsp;<span class="op" id="6814195">||</span>&nbsp;<span class="ident" id="6814198">testing</span><span class="op" id="6814205">.</span><span class="ident" id="6814206">Short</span><span class="op" id="6814211">(</span><span class="op" id="6814212">)</span>&nbsp;<span class="op" id="6814214">||</span>&nbsp;<span class="op" id="6814217">!</span><span class="op" id="6814218">*</span><span class="ident" id="6814219">testExternal</span>&nbsp;<span class="op" id="6814232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814236">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814244">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814248">l</span><span class="op" id="6814249">,</span>&nbsp;<span class="ident" id="6814251">port</span>&nbsp;<span class="op" id="6814256">:=</span>&nbsp;<span class="ident" id="6814259">usableListenPort</span><span class="op" id="6814275">(</span><span class="ident" id="6814276">t</span><span class="op" id="6814277">,</span>&nbsp;<span class="string" id="6814279">&#34;tcp&#34;</span><span class="op" id="6814284">,</span>&nbsp;<span class="string" id="6814286">&#34;[::]&#34;</span><span class="op" id="6814292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814295">defer</span>&nbsp;<span class="ident" id="6814301">l</span><span class="op" id="6814302">.</span><span class="ident" id="6814303">Close</span><span class="op" id="6814308">(</span><span class="op" id="6814309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814313">for</span>&nbsp;<span class="ident" id="6814317">_</span><span class="op" id="6814318">,</span>&nbsp;<span class="ident" id="6814320">tt</span>&nbsp;<span class="op" id="6814323">:=</span>&nbsp;<span class="keyword" id="6814326">range</span>&nbsp;<span class="ident" id="6814332">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6814359">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814363">c</span><span class="op" id="6814364">,</span>&nbsp;<span class="ident" id="6814366">err</span>&nbsp;<span class="op" id="6814370">:=</span>&nbsp;<span class="ident" id="6814373">Dial</span><span class="op" id="6814377">(</span><span class="ident" id="6814378">tt</span><span class="op" id="6814380">.</span><span class="ident" id="6814381">net</span><span class="op" id="6814384">,</span>&nbsp;<span class="ident" id="6814386">tt</span><span class="op" id="6814388">.</span><span class="ident" id="6814389">addr</span><span class="op" id="6814393">+</span><span class="string" id="6814394">&#34;:&#34;</span><span class="op" id="6814397">+</span><span class="ident" id="6814398">port</span><span class="op" id="6814402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814406">if</span>&nbsp;<span class="ident" id="6814409">err</span>&nbsp;<span class="op" id="6814413">==</span>&nbsp;<span class="builtintype" id="6814416">nil</span>&nbsp;<span class="op" id="6814420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814425">c</span><span class="op" id="6814426">.</span><span class="ident" id="6814427">Close</span><span class="op" id="6814432">(</span><span class="op" id="6814433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814438">t</span><span class="op" id="6814439">.</span><span class="ident" id="6814440">Fatalf</span><span class="op" id="6814446">(</span><span class="string" id="6814447">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6814473">,</span>&nbsp;<span class="ident" id="6814475">tt</span><span class="op" id="6814477">.</span><span class="ident" id="6814478">net</span><span class="op" id="6814481">,</span>&nbsp;<span class="ident" id="6814483">tt</span><span class="op" id="6814485">.</span><span class="ident" id="6814486">addr</span><span class="op" id="6814490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814494">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814497">}</span><br>
<span class="lineno"></span><span class="op" id="6814499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6814502">func</span>&nbsp;<span class="ident" id="6814507">TestWildWildcardListener</span><span class="op" id="6814531">(</span><span class="ident" id="6814532">t</span>&nbsp;<span class="op" id="6814534">*</span><span class="ident" id="6814535">testing</span><span class="op" id="6814542">.</span><span class="ident" id="6814543">T</span><span class="op" id="6814544">)</span>&nbsp;<span class="op" id="6814546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814549">switch</span>&nbsp;<span class="ident" id="6814556">runtime</span><span class="op" id="6814563">.</span><span class="ident" id="6814564">GOOS</span>&nbsp;<span class="op" id="6814569">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814572">case</span>&nbsp;<span class="string" id="6814577">&#34;plan9&#34;</span><span class="op" id="6814584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814588">t</span><span class="op" id="6814589">.</span><span class="ident" id="6814590">Skipf</span><span class="op" id="6814595">(</span><span class="string" id="6814596">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6814617">,</span>&nbsp;<span class="ident" id="6814619">runtime</span><span class="op" id="6814626">.</span><span class="ident" id="6814627">GOOS</span><span class="op" id="6814631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814638">if</span>&nbsp;<span class="ident" id="6814641">testing</span><span class="op" id="6814648">.</span><span class="ident" id="6814649">Short</span><span class="op" id="6814654">(</span><span class="op" id="6814655">)</span>&nbsp;<span class="op" id="6814657">||</span>&nbsp;<span class="op" id="6814660">!</span><span class="op" id="6814661">*</span><span class="ident" id="6814662">testExternal</span>&nbsp;<span class="op" id="6814675">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814679">t</span><span class="op" id="6814680">.</span><span class="ident" id="6814681">Skip</span><span class="op" id="6814685">(</span><span class="string" id="6814686">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6814727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814734">defer</span>&nbsp;<span class="keyword" id="6814740">func</span><span class="op" id="6814744">(</span><span class="op" id="6814745">)</span>&nbsp;<span class="op" id="6814747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814751">if</span>&nbsp;<span class="ident" id="6814754">p</span>&nbsp;<span class="op" id="6814756">:=</span>&nbsp;<span class="builtinfunc" id="6814759">recover</span><span class="op" id="6814766">(</span><span class="op" id="6814767">)</span><span class="op" id="6814768">;</span>&nbsp;<span class="ident" id="6814770">p</span>&nbsp;<span class="op" id="6814772">!=</span>&nbsp;<span class="builtintype" id="6814775">nil</span>&nbsp;<span class="op" id="6814779">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814784">t</span><span class="op" id="6814785">.</span><span class="ident" id="6814786">Fatalf</span><span class="op" id="6814792">(</span><span class="string" id="6814793">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6814856">,</span>&nbsp;<span class="ident" id="6814858">p</span><span class="op" id="6814859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814866">}</span><span class="op" id="6814867">(</span><span class="op" id="6814868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814872">if</span>&nbsp;<span class="ident" id="6814875">ln</span><span class="op" id="6814877">,</span>&nbsp;<span class="ident" id="6814879">err</span>&nbsp;<span class="op" id="6814883">:=</span>&nbsp;<span class="ident" id="6814886">Listen</span><span class="op" id="6814892">(</span><span class="string" id="6814893">&#34;tcp&#34;</span><span class="op" id="6814898">,</span>&nbsp;<span class="string" id="6814900">&#34;&#34;</span><span class="op" id="6814902">)</span><span class="op" id="6814903">;</span>&nbsp;<span class="ident" id="6814905">err</span>&nbsp;<span class="op" id="6814909">==</span>&nbsp;<span class="builtintype" id="6814912">nil</span>&nbsp;<span class="op" id="6814916">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814920">ln</span><span class="op" id="6814922">.</span><span class="ident" id="6814923">Close</span><span class="op" id="6814928">(</span><span class="op" id="6814929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6814932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6814935">if</span>&nbsp;<span class="ident" id="6814938">ln</span><span class="op" id="6814940">,</span>&nbsp;<span class="ident" id="6814942">err</span>&nbsp;<span class="op" id="6814946">:=</span>&nbsp;<span class="ident" id="6814949">ListenPacket</span><span class="op" id="6814961">(</span><span class="string" id="6814962">&#34;udp&#34;</span><span class="op" id="6814967">,</span>&nbsp;<span class="string" id="6814969">&#34;&#34;</span><span class="op" id="6814971">)</span><span class="op" id="6814972">;</span>&nbsp;<span class="ident" id="6814974">err</span>&nbsp;<span class="op" id="6814978">==</span>&nbsp;<span class="builtintype" id="6814981">nil</span>&nbsp;<span class="op" id="6814985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814989">ln</span><span class="op" id="6814991">.</span><span class="ident" id="6814992">Close</span><span class="op" id="6814997">(</span><span class="op" id="6814998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815001">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815004">if</span>&nbsp;<span class="ident" id="6815007">ln</span><span class="op" id="6815009">,</span>&nbsp;<span class="ident" id="6815011">err</span>&nbsp;<span class="op" id="6815015">:=</span>&nbsp;<span class="ident" id="6815018">ListenTCP</span><span class="op" id="6815027">(</span><span class="string" id="6815028">&#34;tcp&#34;</span><span class="op" id="6815033">,</span>&nbsp;<span class="builtintype" id="6815035">nil</span><span class="op" id="6815038">)</span><span class="op" id="6815039">;</span>&nbsp;<span class="ident" id="6815041">err</span>&nbsp;<span class="op" id="6815045">==</span>&nbsp;<span class="builtintype" id="6815048">nil</span>&nbsp;<span class="op" id="6815052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815056">ln</span><span class="op" id="6815058">.</span><span class="ident" id="6815059">Close</span><span class="op" id="6815064">(</span><span class="op" id="6815065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815071">if</span>&nbsp;<span class="ident" id="6815074">ln</span><span class="op" id="6815076">,</span>&nbsp;<span class="ident" id="6815078">err</span>&nbsp;<span class="op" id="6815082">:=</span>&nbsp;<span class="ident" id="6815085">ListenUDP</span><span class="op" id="6815094">(</span><span class="string" id="6815095">&#34;udp&#34;</span><span class="op" id="6815100">,</span>&nbsp;<span class="builtintype" id="6815102">nil</span><span class="op" id="6815105">)</span><span class="op" id="6815106">;</span>&nbsp;<span class="ident" id="6815108">err</span>&nbsp;<span class="op" id="6815112">==</span>&nbsp;<span class="builtintype" id="6815115">nil</span>&nbsp;<span class="op" id="6815119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815123">ln</span><span class="op" id="6815125">.</span><span class="ident" id="6815126">Close</span><span class="op" id="6815131">(</span><span class="op" id="6815132">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815138">if</span>&nbsp;<span class="ident" id="6815141">ln</span><span class="op" id="6815143">,</span>&nbsp;<span class="ident" id="6815145">err</span>&nbsp;<span class="op" id="6815149">:=</span>&nbsp;<span class="ident" id="6815152">ListenIP</span><span class="op" id="6815160">(</span><span class="string" id="6815161">&#34;ip:icmp&#34;</span><span class="op" id="6815170">,</span>&nbsp;<span class="builtintype" id="6815172">nil</span><span class="op" id="6815175">)</span><span class="op" id="6815176">;</span>&nbsp;<span class="ident" id="6815178">err</span>&nbsp;<span class="op" id="6815182">==</span>&nbsp;<span class="builtintype" id="6815185">nil</span>&nbsp;<span class="op" id="6815189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815193">ln</span><span class="op" id="6815195">.</span><span class="ident" id="6815196">Close</span><span class="op" id="6815201">(</span><span class="op" id="6815202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815205">}</span><br>
<span class="lineno"></span><span class="op" id="6815207">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
