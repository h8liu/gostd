<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html" class="current">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4498891">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4498946">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4499000">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4499051">package</span>&nbsp;<span class="ident" id="4499059">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4499065">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4499139">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4499213">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4499233">import</span>&nbsp;<span class="op" id="4499240">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499243">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499257">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499274">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499288">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499302">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499318">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499334">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499344">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499350">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4499360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4499363">type</span>&nbsp;<span class="ident" id="4499368">PEMCipher</span>&nbsp;<span class="builtintype" id="4499378">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4499383">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4499448">const</span>&nbsp;<span class="op" id="4499454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499457">_</span>&nbsp;<span class="ident" id="4499459">PEMCipher</span>&nbsp;<span class="op" id="4499469">=</span>&nbsp;<span class="ident" id="4499471">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499477">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499491">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499506">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499523">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499540">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4499556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4499559">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4499618">type</span>&nbsp;<span class="ident" id="4499623">rfc1423Algo</span>&nbsp;<span class="keyword" id="4499635">struct</span>&nbsp;<span class="op" id="4499642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499645">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499656">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499667">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4499678">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499686">cipherFunc</span>&nbsp;<span class="keyword" id="4499697">func</span><span class="op" id="4499701">(</span><span class="ident" id="4499702">key</span>&nbsp;<span class="op" id="4499706">[</span><span class="op" id="4499707">]</span><span class="builtintype" id="4499708">byte</span><span class="op" id="4499712">)</span>&nbsp;<span class="op" id="4499714">(</span><span class="ident" id="4499715">cipher</span><span class="op" id="4499721">.</span><span class="ident" id="4499722">Block</span><span class="op" id="4499727">,</span>&nbsp;<span class="builtintype" id="4499729">error</span><span class="op" id="4499734">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499737">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4499748">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499753">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4499764">int</span><br>
<span class="lineno"></span><span class="op" id="4499768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4499771">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4499839">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4499905">var</span>&nbsp;<span class="ident" id="4499909">rfc1423Algos</span>&nbsp;<span class="op" id="4499922">=</span>&nbsp;<span class="op" id="4499924">[</span><span class="op" id="4499925">]</span><span class="ident" id="4499926">rfc1423Algo</span><span class="op" id="4499937">{</span><span class="op" id="4499938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499941">cipher</span><span class="op" id="4499947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499953">PEMCipherDES</span><span class="op" id="4499965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499968">name</span><span class="op" id="4499972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4499980">&#34;DES-CBC&#34;</span><span class="op" id="4499989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499992">cipherFunc</span><span class="op" id="4500002">:</span>&nbsp;<span class="ident" id="4500004">des</span><span class="op" id="4500007">.</span><span class="ident" id="4500008">NewCipher</span><span class="op" id="4500017">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500020">keySize</span><span class="op" id="4500027">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4500032">8</span><span class="op" id="4500033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500036">blockSize</span><span class="op" id="4500045">:</span>&nbsp;&nbsp;<span class="ident" id="4500048">des</span><span class="op" id="4500051">.</span><span class="ident" id="4500052">BlockSize</span><span class="op" id="4500061">,</span><br>
<span class="lineno"></span><span class="op" id="4500063">}</span><span class="op" id="4500064">,</span>&nbsp;<span class="op" id="4500066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500069">cipher</span><span class="op" id="4500075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500081">PEMCipher3DES</span><span class="op" id="4500094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500097">name</span><span class="op" id="4500101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4500109">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4500123">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500126">cipherFunc</span><span class="op" id="4500136">:</span>&nbsp;<span class="ident" id="4500138">des</span><span class="op" id="4500141">.</span><span class="ident" id="4500142">NewTripleDESCipher</span><span class="op" id="4500160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500163">keySize</span><span class="op" id="4500170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4500175">24</span><span class="op" id="4500177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500180">blockSize</span><span class="op" id="4500189">:</span>&nbsp;&nbsp;<span class="ident" id="4500192">des</span><span class="op" id="4500195">.</span><span class="ident" id="4500196">BlockSize</span><span class="op" id="4500205">,</span><br>
<span class="lineno"></span><span class="op" id="4500207">}</span><span class="op" id="4500208">,</span>&nbsp;<span class="op" id="4500210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500213">cipher</span><span class="op" id="4500219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500225">PEMCipherAES128</span><span class="op" id="4500240">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500243">name</span><span class="op" id="4500247">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4500255">&#34;AES-128-CBC&#34;</span><span class="op" id="4500268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500271">cipherFunc</span><span class="op" id="4500281">:</span>&nbsp;<span class="ident" id="4500283">aes</span><span class="op" id="4500286">.</span><span class="ident" id="4500287">NewCipher</span><span class="op" id="4500296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500299">keySize</span><span class="op" id="4500306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4500311">16</span><span class="op" id="4500313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500316">blockSize</span><span class="op" id="4500325">:</span>&nbsp;&nbsp;<span class="ident" id="4500328">aes</span><span class="op" id="4500331">.</span><span class="ident" id="4500332">BlockSize</span><span class="op" id="4500341">,</span><br>
<span class="lineno"></span><span class="op" id="4500343">}</span><span class="op" id="4500344">,</span>&nbsp;<span class="op" id="4500346">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500349">cipher</span><span class="op" id="4500355">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500361">PEMCipherAES192</span><span class="op" id="4500376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500379">name</span><span class="op" id="4500383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4500391">&#34;AES-192-CBC&#34;</span><span class="op" id="4500404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500407">cipherFunc</span><span class="op" id="4500417">:</span>&nbsp;<span class="ident" id="4500419">aes</span><span class="op" id="4500422">.</span><span class="ident" id="4500423">NewCipher</span><span class="op" id="4500432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500435">keySize</span><span class="op" id="4500442">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4500447">24</span><span class="op" id="4500449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500452">blockSize</span><span class="op" id="4500461">:</span>&nbsp;&nbsp;<span class="ident" id="4500464">aes</span><span class="op" id="4500467">.</span><span class="ident" id="4500468">BlockSize</span><span class="op" id="4500477">,</span><br>
<span class="lineno">70</span><span class="op" id="4500479">}</span><span class="op" id="4500480">,</span>&nbsp;<span class="op" id="4500482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500485">cipher</span><span class="op" id="4500491">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500497">PEMCipherAES256</span><span class="op" id="4500512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500515">name</span><span class="op" id="4500519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4500527">&#34;AES-256-CBC&#34;</span><span class="op" id="4500540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500543">cipherFunc</span><span class="op" id="4500553">:</span>&nbsp;<span class="ident" id="4500555">aes</span><span class="op" id="4500558">.</span><span class="ident" id="4500559">NewCipher</span><span class="op" id="4500568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500571">keySize</span><span class="op" id="4500578">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4500583">32</span><span class="op" id="4500585">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500588">blockSize</span><span class="op" id="4500597">:</span>&nbsp;&nbsp;<span class="ident" id="4500600">aes</span><span class="op" id="4500603">.</span><span class="ident" id="4500604">BlockSize</span><span class="op" id="4500613">,</span><br>
<span class="lineno"></span><span class="op" id="4500615">}</span><span class="op" id="4500616">,</span><br>
<span class="lineno"></span><span class="op" id="4500618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4500621">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4500700">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4500780">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4500803">func</span>&nbsp;<span class="op" id="4500808">(</span><span class="ident" id="4500809">c</span>&nbsp;<span class="ident" id="4500811">rfc1423Algo</span><span class="op" id="4500822">)</span>&nbsp;<span class="ident" id="4500824">deriveKey</span><span class="op" id="4500833">(</span><span class="ident" id="4500834">password</span><span class="op" id="4500842">,</span>&nbsp;<span class="ident" id="4500844">salt</span>&nbsp;<span class="op" id="4500849">[</span><span class="op" id="4500850">]</span><span class="builtintype" id="4500851">byte</span><span class="op" id="4500855">)</span>&nbsp;<span class="op" id="4500857">[</span><span class="op" id="4500858">]</span><span class="builtintype" id="4500859">byte</span>&nbsp;<span class="op" id="4500864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500867">hash</span>&nbsp;<span class="op" id="4500872">:=</span>&nbsp;<span class="ident" id="4500875">md5</span><span class="op" id="4500878">.</span><span class="ident" id="4500879">New</span><span class="op" id="4500882">(</span><span class="op" id="4500883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500886">out</span>&nbsp;<span class="op" id="4500890">:=</span>&nbsp;<span class="builtinfunc" id="4500893">make</span><span class="op" id="4500897">(</span><span class="op" id="4500898">[</span><span class="op" id="4500899">]</span><span class="builtintype" id="4500900">byte</span><span class="op" id="4500904">,</span>&nbsp;<span class="ident" id="4500906">c</span><span class="op" id="4500907">.</span><span class="ident" id="4500908">keySize</span><span class="op" id="4500915">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500918">var</span>&nbsp;<span class="ident" id="4500922">digest</span>&nbsp;<span class="op" id="4500929">[</span><span class="op" id="4500930">]</span><span class="builtintype" id="4500931">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500938">for</span>&nbsp;<span class="ident" id="4500942">i</span>&nbsp;<span class="op" id="4500944">:=</span>&nbsp;<span class="num" id="4500947">0</span><span class="op" id="4500948">;</span>&nbsp;<span class="ident" id="4500950">i</span>&nbsp;<span class="op" id="4500952">&lt;</span>&nbsp;<span class="builtinfunc" id="4500954">len</span><span class="op" id="4500957">(</span><span class="ident" id="4500958">out</span><span class="op" id="4500961">)</span><span class="op" id="4500962">;</span>&nbsp;<span class="ident" id="4500964">i</span>&nbsp;<span class="op" id="4500966">+=</span>&nbsp;<span class="builtinfunc" id="4500969">len</span><span class="op" id="4500972">(</span><span class="ident" id="4500973">digest</span><span class="op" id="4500979">)</span>&nbsp;<span class="op" id="4500981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500985">hash</span><span class="op" id="4500989">.</span><span class="ident" id="4500990">Reset</span><span class="op" id="4500995">(</span><span class="op" id="4500996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501000">hash</span><span class="op" id="4501004">.</span><span class="ident" id="4501005">Write</span><span class="op" id="4501010">(</span><span class="ident" id="4501011">digest</span><span class="op" id="4501017">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501021">hash</span><span class="op" id="4501025">.</span><span class="ident" id="4501026">Write</span><span class="op" id="4501031">(</span><span class="ident" id="4501032">password</span><span class="op" id="4501040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501044">hash</span><span class="op" id="4501048">.</span><span class="ident" id="4501049">Write</span><span class="op" id="4501054">(</span><span class="ident" id="4501055">salt</span><span class="op" id="4501059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501063">digest</span>&nbsp;<span class="op" id="4501070">=</span>&nbsp;<span class="ident" id="4501072">hash</span><span class="op" id="4501076">.</span><span class="ident" id="4501077">Sum</span><span class="op" id="4501080">(</span><span class="ident" id="4501081">digest</span><span class="op" id="4501087">[</span><span class="op" id="4501088">:</span><span class="num" id="4501089">0</span><span class="op" id="4501090">]</span><span class="op" id="4501091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4501095">copy</span><span class="op" id="4501099">(</span><span class="ident" id="4501100">out</span><span class="op" id="4501103">[</span><span class="ident" id="4501104">i</span><span class="op" id="4501105">:</span><span class="op" id="4501106">]</span><span class="op" id="4501107">,</span>&nbsp;<span class="ident" id="4501109">digest</span><span class="op" id="4501115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501118">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501121">return</span>&nbsp;<span class="ident" id="4501128">out</span><br>
<span class="lineno"></span><span class="op" id="4501132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501135">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4501206">func</span>&nbsp;<span class="ident" id="4501211">IsEncryptedPEMBlock</span><span class="op" id="4501230">(</span><span class="ident" id="4501231">b</span>&nbsp;<span class="op" id="4501233">*</span><span class="ident" id="4501234">pem</span><span class="op" id="4501237">.</span><span class="ident" id="4501238">Block</span><span class="op" id="4501243">)</span>&nbsp;<span class="builtintype" id="4501245">bool</span>&nbsp;<span class="op" id="4501250">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501253">_</span><span class="op" id="4501254">,</span>&nbsp;<span class="ident" id="4501256">ok</span>&nbsp;<span class="op" id="4501259">:=</span>&nbsp;<span class="ident" id="4501262">b</span><span class="op" id="4501263">.</span><span class="ident" id="4501264">Headers</span><span class="op" id="4501271">[</span><span class="string" id="4501272">&#34;DEK-Info&#34;</span><span class="op" id="4501282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501285">return</span>&nbsp;<span class="ident" id="4501292">ok</span><br>
<span class="lineno"></span><span class="op" id="4501295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501298">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4501376">var</span>&nbsp;<span class="ident" id="4501380">IncorrectPasswordError</span>&nbsp;<span class="op" id="4501403">=</span>&nbsp;<span class="ident" id="4501405">errors</span><span class="op" id="4501411">.</span><span class="ident" id="4501412">New</span><span class="op" id="4501415">(</span><span class="string" id="4501416">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4501453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501456">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4501537">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4501615">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4501692">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4501770">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4501824">func</span>&nbsp;<span class="ident" id="4501829">DecryptPEMBlock</span><span class="op" id="4501844">(</span><span class="ident" id="4501845">b</span>&nbsp;<span class="op" id="4501847">*</span><span class="ident" id="4501848">pem</span><span class="op" id="4501851">.</span><span class="ident" id="4501852">Block</span><span class="op" id="4501857">,</span>&nbsp;<span class="ident" id="4501859">password</span>&nbsp;<span class="op" id="4501868">[</span><span class="op" id="4501869">]</span><span class="builtintype" id="4501870">byte</span><span class="op" id="4501874">)</span>&nbsp;<span class="op" id="4501876">(</span><span class="op" id="4501877">[</span><span class="op" id="4501878">]</span><span class="builtintype" id="4501879">byte</span><span class="op" id="4501883">,</span>&nbsp;<span class="builtintype" id="4501885">error</span><span class="op" id="4501890">)</span>&nbsp;<span class="op" id="4501892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501895">dek</span><span class="op" id="4501898">,</span>&nbsp;<span class="ident" id="4501900">ok</span>&nbsp;<span class="op" id="4501903">:=</span>&nbsp;<span class="ident" id="4501906">b</span><span class="op" id="4501907">.</span><span class="ident" id="4501908">Headers</span><span class="op" id="4501915">[</span><span class="string" id="4501916">&#34;DEK-Info&#34;</span><span class="op" id="4501926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501929">if</span>&nbsp;<span class="op" id="4501932">!</span><span class="ident" id="4501933">ok</span>&nbsp;<span class="op" id="4501936">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501940">return</span>&nbsp;<span class="builtintype" id="4501947">nil</span><span class="op" id="4501950">,</span>&nbsp;<span class="ident" id="4501952">errors</span><span class="op" id="4501958">.</span><span class="ident" id="4501959">New</span><span class="op" id="4501962">(</span><span class="string" id="4501963">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4501998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502005">idx</span>&nbsp;<span class="op" id="4502009">:=</span>&nbsp;<span class="ident" id="4502012">strings</span><span class="op" id="4502019">.</span><span class="ident" id="4502020">Index</span><span class="op" id="4502025">(</span><span class="ident" id="4502026">dek</span><span class="op" id="4502029">,</span>&nbsp;<span class="string" id="4502031">&#34;,&#34;</span><span class="op" id="4502034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502037">if</span>&nbsp;<span class="ident" id="4502040">idx</span>&nbsp;<span class="op" id="4502044">==</span>&nbsp;<span class="op" id="4502047">-</span><span class="num" id="4502048">1</span>&nbsp;<span class="op" id="4502050">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502054">return</span>&nbsp;<span class="builtintype" id="4502061">nil</span><span class="op" id="4502064">,</span>&nbsp;<span class="ident" id="4502066">errors</span><span class="op" id="4502072">.</span><span class="ident" id="4502073">New</span><span class="op" id="4502076">(</span><span class="string" id="4502077">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4502110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502117">mode</span><span class="op" id="4502121">,</span>&nbsp;<span class="ident" id="4502123">hexIV</span>&nbsp;<span class="op" id="4502129">:=</span>&nbsp;<span class="ident" id="4502132">dek</span><span class="op" id="4502135">[</span><span class="op" id="4502136">:</span><span class="ident" id="4502137">idx</span><span class="op" id="4502140">]</span><span class="op" id="4502141">,</span>&nbsp;<span class="ident" id="4502143">dek</span><span class="op" id="4502146">[</span><span class="ident" id="4502147">idx</span><span class="op" id="4502150">+</span><span class="num" id="4502151">1</span><span class="op" id="4502152">:</span><span class="op" id="4502153">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502156">ciph</span>&nbsp;<span class="op" id="4502161">:=</span>&nbsp;<span class="ident" id="4502164">cipherByName</span><span class="op" id="4502176">(</span><span class="ident" id="4502177">mode</span><span class="op" id="4502181">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502184">if</span>&nbsp;<span class="ident" id="4502187">ciph</span>&nbsp;<span class="op" id="4502192">==</span>&nbsp;<span class="builtintype" id="4502195">nil</span>&nbsp;<span class="op" id="4502199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502203">return</span>&nbsp;<span class="builtintype" id="4502210">nil</span><span class="op" id="4502213">,</span>&nbsp;<span class="ident" id="4502215">errors</span><span class="op" id="4502221">.</span><span class="ident" id="4502222">New</span><span class="op" id="4502225">(</span><span class="string" id="4502226">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4502257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502263">iv</span><span class="op" id="4502265">,</span>&nbsp;<span class="ident" id="4502267">err</span>&nbsp;<span class="op" id="4502271">:=</span>&nbsp;<span class="ident" id="4502274">hex</span><span class="op" id="4502277">.</span><span class="ident" id="4502278">DecodeString</span><span class="op" id="4502290">(</span><span class="ident" id="4502291">hexIV</span><span class="op" id="4502296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502299">if</span>&nbsp;<span class="ident" id="4502302">err</span>&nbsp;<span class="op" id="4502306">!=</span>&nbsp;<span class="builtintype" id="4502309">nil</span>&nbsp;<span class="op" id="4502313">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502317">return</span>&nbsp;<span class="builtintype" id="4502324">nil</span><span class="op" id="4502327">,</span>&nbsp;<span class="ident" id="4502329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502337">if</span>&nbsp;<span class="builtinfunc" id="4502340">len</span><span class="op" id="4502343">(</span><span class="ident" id="4502344">iv</span><span class="op" id="4502346">)</span>&nbsp;<span class="op" id="4502348">!=</span>&nbsp;<span class="ident" id="4502351">ciph</span><span class="op" id="4502355">.</span><span class="ident" id="4502356">blockSize</span>&nbsp;<span class="op" id="4502366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502370">return</span>&nbsp;<span class="builtintype" id="4502377">nil</span><span class="op" id="4502380">,</span>&nbsp;<span class="ident" id="4502382">errors</span><span class="op" id="4502388">.</span><span class="ident" id="4502389">New</span><span class="op" id="4502392">(</span><span class="string" id="4502393">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4502418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502421">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502425">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502496">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502530">key</span>&nbsp;<span class="op" id="4502534">:=</span>&nbsp;<span class="ident" id="4502537">ciph</span><span class="op" id="4502541">.</span><span class="ident" id="4502542">deriveKey</span><span class="op" id="4502551">(</span><span class="ident" id="4502552">password</span><span class="op" id="4502560">,</span>&nbsp;<span class="ident" id="4502562">iv</span><span class="op" id="4502564">[</span><span class="op" id="4502565">:</span><span class="num" id="4502566">8</span><span class="op" id="4502567">]</span><span class="op" id="4502568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502571">block</span><span class="op" id="4502576">,</span>&nbsp;<span class="ident" id="4502578">err</span>&nbsp;<span class="op" id="4502582">:=</span>&nbsp;<span class="ident" id="4502585">ciph</span><span class="op" id="4502589">.</span><span class="ident" id="4502590">cipherFunc</span><span class="op" id="4502600">(</span><span class="ident" id="4502601">key</span><span class="op" id="4502604">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502607">if</span>&nbsp;<span class="ident" id="4502610">err</span>&nbsp;<span class="op" id="4502614">!=</span>&nbsp;<span class="builtintype" id="4502617">nil</span>&nbsp;<span class="op" id="4502621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502625">return</span>&nbsp;<span class="builtintype" id="4502632">nil</span><span class="op" id="4502635">,</span>&nbsp;<span class="ident" id="4502637">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502646">data</span>&nbsp;<span class="op" id="4502651">:=</span>&nbsp;<span class="builtinfunc" id="4502654">make</span><span class="op" id="4502658">(</span><span class="op" id="4502659">[</span><span class="op" id="4502660">]</span><span class="builtintype" id="4502661">byte</span><span class="op" id="4502665">,</span>&nbsp;<span class="builtinfunc" id="4502667">len</span><span class="op" id="4502670">(</span><span class="ident" id="4502671">b</span><span class="op" id="4502672">.</span><span class="ident" id="4502673">Bytes</span><span class="op" id="4502678">)</span><span class="op" id="4502679">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502682">dec</span>&nbsp;<span class="op" id="4502686">:=</span>&nbsp;<span class="ident" id="4502689">cipher</span><span class="op" id="4502695">.</span><span class="ident" id="4502696">NewCBCDecrypter</span><span class="op" id="4502711">(</span><span class="ident" id="4502712">block</span><span class="op" id="4502717">,</span>&nbsp;<span class="ident" id="4502719">iv</span><span class="op" id="4502721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502724">dec</span><span class="op" id="4502727">.</span><span class="ident" id="4502728">CryptBlocks</span><span class="op" id="4502739">(</span><span class="ident" id="4502740">data</span><span class="op" id="4502744">,</span>&nbsp;<span class="ident" id="4502746">b</span><span class="op" id="4502747">.</span><span class="ident" id="4502748">Bytes</span><span class="op" id="4502753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502757">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502836">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502914">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502931">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502947">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502971">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503040">dlen</span>&nbsp;<span class="op" id="4503045">:=</span>&nbsp;<span class="builtinfunc" id="4503048">len</span><span class="op" id="4503051">(</span><span class="ident" id="4503052">data</span><span class="op" id="4503056">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503059">if</span>&nbsp;<span class="ident" id="4503062">dlen</span>&nbsp;<span class="op" id="4503067">==</span>&nbsp;<span class="num" id="4503070">0</span>&nbsp;<span class="op" id="4503072">||</span>&nbsp;<span class="ident" id="4503075">dlen</span><span class="op" id="4503079">%</span><span class="ident" id="4503080">ciph</span><span class="op" id="4503084">.</span><span class="ident" id="4503085">blockSize</span>&nbsp;<span class="op" id="4503095">!=</span>&nbsp;<span class="num" id="4503098">0</span>&nbsp;<span class="op" id="4503100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503104">return</span>&nbsp;<span class="builtintype" id="4503111">nil</span><span class="op" id="4503114">,</span>&nbsp;<span class="ident" id="4503116">errors</span><span class="op" id="4503122">.</span><span class="ident" id="4503123">New</span><span class="op" id="4503126">(</span><span class="string" id="4503127">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4503150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503156">last</span>&nbsp;<span class="op" id="4503161">:=</span>&nbsp;<span class="builtintype" id="4503164">int</span><span class="op" id="4503167">(</span><span class="ident" id="4503168">data</span><span class="op" id="4503172">[</span><span class="ident" id="4503173">dlen</span><span class="op" id="4503177">-</span><span class="num" id="4503178">1</span><span class="op" id="4503179">]</span><span class="op" id="4503180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503183">if</span>&nbsp;<span class="ident" id="4503186">dlen</span>&nbsp;<span class="op" id="4503191">&lt;</span>&nbsp;<span class="ident" id="4503193">last</span>&nbsp;<span class="op" id="4503198">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503202">return</span>&nbsp;<span class="builtintype" id="4503209">nil</span><span class="op" id="4503212">,</span>&nbsp;<span class="ident" id="4503214">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503241">if</span>&nbsp;<span class="ident" id="4503244">last</span>&nbsp;<span class="op" id="4503249">==</span>&nbsp;<span class="num" id="4503252">0</span>&nbsp;<span class="op" id="4503254">||</span>&nbsp;<span class="ident" id="4503257">last</span>&nbsp;<span class="op" id="4503262">&gt;</span>&nbsp;<span class="ident" id="4503264">ciph</span><span class="op" id="4503268">.</span><span class="ident" id="4503269">blockSize</span>&nbsp;<span class="op" id="4503279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503283">return</span>&nbsp;<span class="builtintype" id="4503290">nil</span><span class="op" id="4503293">,</span>&nbsp;<span class="ident" id="4503295">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503319">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503322">for</span>&nbsp;<span class="ident" id="4503326">_</span><span class="op" id="4503327">,</span>&nbsp;<span class="ident" id="4503329">val</span>&nbsp;<span class="op" id="4503333">:=</span>&nbsp;<span class="keyword" id="4503336">range</span>&nbsp;<span class="ident" id="4503342">data</span><span class="op" id="4503346">[</span><span class="ident" id="4503347">dlen</span><span class="op" id="4503351">-</span><span class="ident" id="4503352">last</span><span class="op" id="4503356">:</span><span class="op" id="4503357">]</span>&nbsp;<span class="op" id="4503359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503363">if</span>&nbsp;<span class="builtintype" id="4503366">int</span><span class="op" id="4503369">(</span><span class="ident" id="4503370">val</span><span class="op" id="4503373">)</span>&nbsp;<span class="op" id="4503375">!=</span>&nbsp;<span class="ident" id="4503378">last</span>&nbsp;<span class="op" id="4503383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503388">return</span>&nbsp;<span class="builtintype" id="4503395">nil</span><span class="op" id="4503398">,</span>&nbsp;<span class="ident" id="4503400">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503428">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503431">return</span>&nbsp;<span class="ident" id="4503438">data</span><span class="op" id="4503442">[</span><span class="op" id="4503443">:</span><span class="ident" id="4503444">dlen</span><span class="op" id="4503448">-</span><span class="ident" id="4503449">last</span><span class="op" id="4503453">]</span><span class="op" id="4503454">,</span>&nbsp;<span class="builtintype" id="4503456">nil</span><br>
<span class="lineno"></span><span class="op" id="4503460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503463">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4503536">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4503605">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4503618">func</span>&nbsp;<span class="ident" id="4503623">EncryptPEMBlock</span><span class="op" id="4503638">(</span><span class="ident" id="4503639">rand</span>&nbsp;<span class="ident" id="4503644">io</span><span class="op" id="4503646">.</span><span class="ident" id="4503647">Reader</span><span class="op" id="4503653">,</span>&nbsp;<span class="ident" id="4503655">blockType</span>&nbsp;<span class="builtintype" id="4503665">string</span><span class="op" id="4503671">,</span>&nbsp;<span class="ident" id="4503673">data</span><span class="op" id="4503677">,</span>&nbsp;<span class="ident" id="4503679">password</span>&nbsp;<span class="op" id="4503688">[</span><span class="op" id="4503689">]</span><span class="builtintype" id="4503690">byte</span><span class="op" id="4503694">,</span>&nbsp;<span class="ident" id="4503696">alg</span>&nbsp;<span class="ident" id="4503700">PEMCipher</span><span class="op" id="4503709">)</span>&nbsp;<span class="op" id="4503711">(</span><span class="op" id="4503712">*</span><span class="ident" id="4503713">pem</span><span class="op" id="4503716">.</span><span class="ident" id="4503717">Block</span><span class="op" id="4503722">,</span>&nbsp;<span class="builtintype" id="4503724">error</span><span class="op" id="4503729">)</span>&nbsp;<span class="op" id="4503731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503734">ciph</span>&nbsp;<span class="op" id="4503739">:=</span>&nbsp;<span class="ident" id="4503742">cipherByKey</span><span class="op" id="4503753">(</span><span class="ident" id="4503754">alg</span><span class="op" id="4503757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503760">if</span>&nbsp;<span class="ident" id="4503763">ciph</span>&nbsp;<span class="op" id="4503768">==</span>&nbsp;<span class="builtintype" id="4503771">nil</span>&nbsp;<span class="op" id="4503775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503779">return</span>&nbsp;<span class="builtintype" id="4503786">nil</span><span class="op" id="4503789">,</span>&nbsp;<span class="ident" id="4503791">errors</span><span class="op" id="4503797">.</span><span class="ident" id="4503798">New</span><span class="op" id="4503801">(</span><span class="string" id="4503802">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4503833">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503839">iv</span>&nbsp;<span class="op" id="4503842">:=</span>&nbsp;<span class="builtinfunc" id="4503845">make</span><span class="op" id="4503849">(</span><span class="op" id="4503850">[</span><span class="op" id="4503851">]</span><span class="builtintype" id="4503852">byte</span><span class="op" id="4503856">,</span>&nbsp;<span class="ident" id="4503858">ciph</span><span class="op" id="4503862">.</span><span class="ident" id="4503863">blockSize</span><span class="op" id="4503872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503875">if</span>&nbsp;<span class="ident" id="4503878">_</span><span class="op" id="4503879">,</span>&nbsp;<span class="ident" id="4503881">err</span>&nbsp;<span class="op" id="4503885">:=</span>&nbsp;<span class="ident" id="4503888">io</span><span class="op" id="4503890">.</span><span class="ident" id="4503891">ReadFull</span><span class="op" id="4503899">(</span><span class="ident" id="4503900">rand</span><span class="op" id="4503904">,</span>&nbsp;<span class="ident" id="4503906">iv</span><span class="op" id="4503908">)</span><span class="op" id="4503909">;</span>&nbsp;<span class="ident" id="4503911">err</span>&nbsp;<span class="op" id="4503915">!=</span>&nbsp;<span class="builtintype" id="4503918">nil</span>&nbsp;<span class="op" id="4503922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503926">return</span>&nbsp;<span class="builtintype" id="4503933">nil</span><span class="op" id="4503936">,</span>&nbsp;<span class="ident" id="4503938">errors</span><span class="op" id="4503944">.</span><span class="ident" id="4503945">New</span><span class="op" id="4503948">(</span><span class="string" id="4503949">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4503978">+</span>&nbsp;<span class="ident" id="4503980">err</span><span class="op" id="4503983">.</span><span class="ident" id="4503984">Error</span><span class="op" id="4503989">(</span><span class="op" id="4503990">)</span><span class="op" id="4503991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503994">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4503997">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504061">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504113">key</span>&nbsp;<span class="op" id="4504117">:=</span>&nbsp;<span class="ident" id="4504120">ciph</span><span class="op" id="4504124">.</span><span class="ident" id="4504125">deriveKey</span><span class="op" id="4504134">(</span><span class="ident" id="4504135">password</span><span class="op" id="4504143">,</span>&nbsp;<span class="ident" id="4504145">iv</span><span class="op" id="4504147">[</span><span class="op" id="4504148">:</span><span class="num" id="4504149">8</span><span class="op" id="4504150">]</span><span class="op" id="4504151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504154">block</span><span class="op" id="4504159">,</span>&nbsp;<span class="ident" id="4504161">err</span>&nbsp;<span class="op" id="4504165">:=</span>&nbsp;<span class="ident" id="4504168">ciph</span><span class="op" id="4504172">.</span><span class="ident" id="4504173">cipherFunc</span><span class="op" id="4504183">(</span><span class="ident" id="4504184">key</span><span class="op" id="4504187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504190">if</span>&nbsp;<span class="ident" id="4504193">err</span>&nbsp;<span class="op" id="4504197">!=</span>&nbsp;<span class="builtintype" id="4504200">nil</span>&nbsp;<span class="op" id="4504204">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504208">return</span>&nbsp;<span class="builtintype" id="4504215">nil</span><span class="op" id="4504218">,</span>&nbsp;<span class="ident" id="4504220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504228">enc</span>&nbsp;<span class="op" id="4504232">:=</span>&nbsp;<span class="ident" id="4504235">cipher</span><span class="op" id="4504241">.</span><span class="ident" id="4504242">NewCBCEncrypter</span><span class="op" id="4504257">(</span><span class="ident" id="4504258">block</span><span class="op" id="4504263">,</span>&nbsp;<span class="ident" id="4504265">iv</span><span class="op" id="4504267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504270">pad</span>&nbsp;<span class="op" id="4504274">:=</span>&nbsp;<span class="ident" id="4504277">ciph</span><span class="op" id="4504281">.</span><span class="ident" id="4504282">blockSize</span>&nbsp;<span class="op" id="4504292">-</span>&nbsp;<span class="builtinfunc" id="4504294">len</span><span class="op" id="4504297">(</span><span class="ident" id="4504298">data</span><span class="op" id="4504302">)</span><span class="op" id="4504303">%</span><span class="ident" id="4504304">ciph</span><span class="op" id="4504308">.</span><span class="ident" id="4504309">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504320">encrypted</span>&nbsp;<span class="op" id="4504330">:=</span>&nbsp;<span class="builtinfunc" id="4504333">make</span><span class="op" id="4504337">(</span><span class="op" id="4504338">[</span><span class="op" id="4504339">]</span><span class="builtintype" id="4504340">byte</span><span class="op" id="4504344">,</span>&nbsp;<span class="builtinfunc" id="4504346">len</span><span class="op" id="4504349">(</span><span class="ident" id="4504350">data</span><span class="op" id="4504354">)</span><span class="op" id="4504355">,</span>&nbsp;<span class="builtinfunc" id="4504357">len</span><span class="op" id="4504360">(</span><span class="ident" id="4504361">data</span><span class="op" id="4504365">)</span><span class="op" id="4504366">+</span><span class="ident" id="4504367">pad</span><span class="op" id="4504370">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504373">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504439">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504505">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4504515">copy</span><span class="op" id="4504519">(</span><span class="ident" id="4504520">encrypted</span><span class="op" id="4504529">,</span>&nbsp;<span class="ident" id="4504531">data</span><span class="op" id="4504535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504538">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504568">for</span>&nbsp;<span class="ident" id="4504572">i</span>&nbsp;<span class="op" id="4504574">:=</span>&nbsp;<span class="num" id="4504577">0</span><span class="op" id="4504578">;</span>&nbsp;<span class="ident" id="4504580">i</span>&nbsp;<span class="op" id="4504582">&lt;</span>&nbsp;<span class="ident" id="4504584">pad</span><span class="op" id="4504587">;</span>&nbsp;<span class="ident" id="4504589">i</span><span class="op" id="4504590">++</span>&nbsp;<span class="op" id="4504593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504597">encrypted</span>&nbsp;<span class="op" id="4504607">=</span>&nbsp;<span class="builtinfunc" id="4504609">append</span><span class="op" id="4504615">(</span><span class="ident" id="4504616">encrypted</span><span class="op" id="4504625">,</span>&nbsp;<span class="builtintype" id="4504627">byte</span><span class="op" id="4504631">(</span><span class="ident" id="4504632">pad</span><span class="op" id="4504635">)</span><span class="op" id="4504636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504642">enc</span><span class="op" id="4504645">.</span><span class="ident" id="4504646">CryptBlocks</span><span class="op" id="4504657">(</span><span class="ident" id="4504658">encrypted</span><span class="op" id="4504667">,</span>&nbsp;<span class="ident" id="4504669">encrypted</span><span class="op" id="4504678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504682">return</span>&nbsp;<span class="op" id="4504689">&amp;</span><span class="ident" id="4504690">pem</span><span class="op" id="4504693">.</span><span class="ident" id="4504694">Block</span><span class="op" id="4504699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504703">Type</span><span class="op" id="4504707">:</span>&nbsp;<span class="ident" id="4504709">blockType</span><span class="op" id="4504718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504722">Headers</span><span class="op" id="4504729">:</span>&nbsp;<span class="keyword" id="4504731">map</span><span class="op" id="4504734">[</span><span class="builtintype" id="4504735">string</span><span class="op" id="4504741">]</span><span class="builtintype" id="4504742">string</span><span class="op" id="4504748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4504753">&#34;Proc-Type&#34;</span><span class="op" id="4504764">:</span>&nbsp;<span class="string" id="4504766">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4504779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4504784">&#34;DEK-Info&#34;</span><span class="op" id="4504794">:</span>&nbsp;&nbsp;<span class="ident" id="4504797">ciph</span><span class="op" id="4504801">.</span><span class="ident" id="4504802">name</span>&nbsp;<span class="op" id="4504807">+</span>&nbsp;<span class="string" id="4504809">&#34;,&#34;</span>&nbsp;<span class="op" id="4504813">+</span>&nbsp;<span class="ident" id="4504815">hex</span><span class="op" id="4504818">.</span><span class="ident" id="4504819">EncodeToString</span><span class="op" id="4504833">(</span><span class="ident" id="4504834">iv</span><span class="op" id="4504836">)</span><span class="op" id="4504837">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504841">}</span><span class="op" id="4504842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504846">Bytes</span><span class="op" id="4504851">:</span>&nbsp;<span class="ident" id="4504853">encrypted</span><span class="op" id="4504862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504865">}</span><span class="op" id="4504866">,</span>&nbsp;<span class="builtintype" id="4504868">nil</span><br>
<span class="lineno"></span><span class="op" id="4504872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4504875">func</span>&nbsp;<span class="ident" id="4504880">cipherByName</span><span class="op" id="4504892">(</span><span class="ident" id="4504893">name</span>&nbsp;<span class="builtintype" id="4504898">string</span><span class="op" id="4504904">)</span>&nbsp;<span class="op" id="4504906">*</span><span class="ident" id="4504907">rfc1423Algo</span>&nbsp;<span class="op" id="4504919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504922">for</span>&nbsp;<span class="ident" id="4504926">i</span>&nbsp;<span class="op" id="4504928">:=</span>&nbsp;<span class="keyword" id="4504931">range</span>&nbsp;<span class="ident" id="4504937">rfc1423Algos</span>&nbsp;<span class="op" id="4504950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504954">alg</span>&nbsp;<span class="op" id="4504958">:=</span>&nbsp;<span class="op" id="4504961">&amp;</span><span class="ident" id="4504962">rfc1423Algos</span><span class="op" id="4504974">[</span><span class="ident" id="4504975">i</span><span class="op" id="4504976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504980">if</span>&nbsp;<span class="ident" id="4504983">alg</span><span class="op" id="4504986">.</span><span class="ident" id="4504987">name</span>&nbsp;<span class="op" id="4504992">==</span>&nbsp;<span class="ident" id="4504995">name</span>&nbsp;<span class="op" id="4505000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505005">return</span>&nbsp;<span class="ident" id="4505012">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505024">return</span>&nbsp;<span class="builtintype" id="4505031">nil</span><br>
<span class="lineno"></span><span class="op" id="4505035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4505038">func</span>&nbsp;<span class="ident" id="4505043">cipherByKey</span><span class="op" id="4505054">(</span><span class="ident" id="4505055">key</span>&nbsp;<span class="ident" id="4505059">PEMCipher</span><span class="op" id="4505068">)</span>&nbsp;<span class="op" id="4505070">*</span><span class="ident" id="4505071">rfc1423Algo</span>&nbsp;<span class="op" id="4505083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505086">for</span>&nbsp;<span class="ident" id="4505090">i</span>&nbsp;<span class="op" id="4505092">:=</span>&nbsp;<span class="keyword" id="4505095">range</span>&nbsp;<span class="ident" id="4505101">rfc1423Algos</span>&nbsp;<span class="op" id="4505114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505118">alg</span>&nbsp;<span class="op" id="4505122">:=</span>&nbsp;<span class="op" id="4505125">&amp;</span><span class="ident" id="4505126">rfc1423Algos</span><span class="op" id="4505138">[</span><span class="ident" id="4505139">i</span><span class="op" id="4505140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505144">if</span>&nbsp;<span class="ident" id="4505147">alg</span><span class="op" id="4505150">.</span><span class="ident" id="4505151">cipher</span>&nbsp;<span class="op" id="4505158">==</span>&nbsp;<span class="ident" id="4505161">key</span>&nbsp;<span class="op" id="4505165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505170">return</span>&nbsp;<span class="ident" id="4505177">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505189">return</span>&nbsp;<span class="builtintype" id="4505196">nil</span><br>
<span class="lineno"></span><span class="op" id="4505200">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
