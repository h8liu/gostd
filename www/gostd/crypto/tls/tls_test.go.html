<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html" class="current">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7836000">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7836055">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7836109">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7836160">package</span>&nbsp;<span class="ident" id="7836168">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7836173">import</span>&nbsp;<span class="op" id="7836180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836183">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836192">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836199">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836205">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836212">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836223">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7836234">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7836241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7836244">var</span>&nbsp;<span class="ident" id="7836248">rsaCertPEM</span>&nbsp;<span class="op" id="7836259">=</span>&nbsp;<span class="string" id="7836261">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7836957">var</span>&nbsp;<span class="ident" id="7836961">rsaKeyPEM</span>&nbsp;<span class="op" id="7836971">=</span>&nbsp;<span class="string" id="7836973">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7837474">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7837538">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7837609">var</span>&nbsp;<span class="ident" id="7837613">keyPEM</span>&nbsp;<span class="op" id="7837620">=</span>&nbsp;<span class="string" id="7837622">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7838115">var</span>&nbsp;<span class="ident" id="7838119">ecdsaCertPEM</span>&nbsp;<span class="op" id="7838132">=</span>&nbsp;<span class="string" id="7838134">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7838891">var</span>&nbsp;<span class="ident" id="7838895">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7838907">=</span>&nbsp;<span class="string" id="7838909">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839349">var</span>&nbsp;<span class="ident" id="7839353">keyPairTests</span>&nbsp;<span class="op" id="7839366">=</span>&nbsp;<span class="op" id="7839368">[</span><span class="op" id="7839369">]</span><span class="keyword" id="7839370">struct</span>&nbsp;<span class="op" id="7839377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839380">algo</span>&nbsp;<span class="builtintype" id="7839385">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839393">cert</span>&nbsp;<span class="builtintype" id="7839398">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839406">key</span>&nbsp;&nbsp;<span class="builtintype" id="7839411">string</span><br>
<span class="lineno"></span><span class="op" id="7839418">}</span><span class="op" id="7839419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7839422">{</span><span class="string" id="7839423">&#34;ECDSA&#34;</span><span class="op" id="7839430">,</span>&nbsp;<span class="ident" id="7839432">ecdsaCertPEM</span><span class="op" id="7839444">,</span>&nbsp;<span class="ident" id="7839446">ecdsaKeyPEM</span><span class="op" id="7839457">}</span><span class="op" id="7839458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7839461">{</span><span class="string" id="7839462">&#34;RSA&#34;</span><span class="op" id="7839467">,</span>&nbsp;<span class="ident" id="7839469">rsaCertPEM</span><span class="op" id="7839479">,</span>&nbsp;<span class="ident" id="7839481">rsaKeyPEM</span><span class="op" id="7839490">}</span><span class="op" id="7839491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7839494">{</span><span class="string" id="7839495">&#34;RSA-untyped&#34;</span><span class="op" id="7839508">,</span>&nbsp;<span class="ident" id="7839510">rsaCertPEM</span><span class="op" id="7839520">,</span>&nbsp;<span class="ident" id="7839522">keyPEM</span><span class="op" id="7839528">}</span><span class="op" id="7839529">,</span>&nbsp;<span class="comment" id="7839531">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7839556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839559">func</span>&nbsp;<span class="ident" id="7839564">TestX509KeyPair</span><span class="op" id="7839579">(</span><span class="ident" id="7839580">t</span>&nbsp;<span class="op" id="7839582">*</span><span class="ident" id="7839583">testing</span><span class="op" id="7839590">.</span><span class="ident" id="7839591">T</span><span class="op" id="7839592">)</span>&nbsp;<span class="op" id="7839594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7839597">var</span>&nbsp;<span class="ident" id="7839601">pem</span>&nbsp;<span class="op" id="7839605">[</span><span class="op" id="7839606">]</span><span class="builtintype" id="7839607">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7839613">for</span>&nbsp;<span class="ident" id="7839617">_</span><span class="op" id="7839618">,</span>&nbsp;<span class="ident" id="7839620">test</span>&nbsp;<span class="op" id="7839625">:=</span>&nbsp;<span class="keyword" id="7839628">range</span>&nbsp;<span class="ident" id="7839634">keyPairTests</span>&nbsp;<span class="op" id="7839647">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839651">pem</span>&nbsp;<span class="op" id="7839655">=</span>&nbsp;<span class="op" id="7839657">[</span><span class="op" id="7839658">]</span><span class="builtintype" id="7839659">byte</span><span class="op" id="7839663">(</span><span class="ident" id="7839664">test</span><span class="op" id="7839668">.</span><span class="ident" id="7839669">cert</span>&nbsp;<span class="op" id="7839674">+</span>&nbsp;<span class="ident" id="7839676">test</span><span class="op" id="7839680">.</span><span class="ident" id="7839681">key</span><span class="op" id="7839684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7839688">if</span>&nbsp;<span class="ident" id="7839691">_</span><span class="op" id="7839692">,</span>&nbsp;<span class="ident" id="7839694">err</span>&nbsp;<span class="op" id="7839698">:=</span>&nbsp;<span class="ident" id="7839701">X509KeyPair</span><span class="op" id="7839712">(</span><span class="ident" id="7839713">pem</span><span class="op" id="7839716">,</span>&nbsp;<span class="ident" id="7839718">pem</span><span class="op" id="7839721">)</span><span class="op" id="7839722">;</span>&nbsp;<span class="ident" id="7839724">err</span>&nbsp;<span class="op" id="7839728">!=</span>&nbsp;<span class="builtintype" id="7839731">nil</span>&nbsp;<span class="op" id="7839735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839740">t</span><span class="op" id="7839741">.</span><span class="ident" id="7839742">Errorf</span><span class="op" id="7839748">(</span><span class="string" id="7839749">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7839796">,</span>&nbsp;<span class="ident" id="7839798">test</span><span class="op" id="7839802">.</span><span class="ident" id="7839803">algo</span><span class="op" id="7839807">,</span>&nbsp;<span class="ident" id="7839809">test</span><span class="op" id="7839813">.</span><span class="ident" id="7839814">algo</span><span class="op" id="7839818">,</span>&nbsp;<span class="ident" id="7839820">err</span><span class="op" id="7839823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7839827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839831">pem</span>&nbsp;<span class="op" id="7839835">=</span>&nbsp;<span class="op" id="7839837">[</span><span class="op" id="7839838">]</span><span class="builtintype" id="7839839">byte</span><span class="op" id="7839843">(</span><span class="ident" id="7839844">test</span><span class="op" id="7839848">.</span><span class="ident" id="7839849">key</span>&nbsp;<span class="op" id="7839853">+</span>&nbsp;<span class="ident" id="7839855">test</span><span class="op" id="7839859">.</span><span class="ident" id="7839860">cert</span><span class="op" id="7839864">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7839868">if</span>&nbsp;<span class="ident" id="7839871">_</span><span class="op" id="7839872">,</span>&nbsp;<span class="ident" id="7839874">err</span>&nbsp;<span class="op" id="7839878">:=</span>&nbsp;<span class="ident" id="7839881">X509KeyPair</span><span class="op" id="7839892">(</span><span class="ident" id="7839893">pem</span><span class="op" id="7839896">,</span>&nbsp;<span class="ident" id="7839898">pem</span><span class="op" id="7839901">)</span><span class="op" id="7839902">;</span>&nbsp;<span class="ident" id="7839904">err</span>&nbsp;<span class="op" id="7839908">!=</span>&nbsp;<span class="builtintype" id="7839911">nil</span>&nbsp;<span class="op" id="7839915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7839920">t</span><span class="op" id="7839921">.</span><span class="ident" id="7839922">Errorf</span><span class="op" id="7839928">(</span><span class="string" id="7839929">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7839976">,</span>&nbsp;<span class="ident" id="7839978">test</span><span class="op" id="7839982">.</span><span class="ident" id="7839983">algo</span><span class="op" id="7839987">,</span>&nbsp;<span class="ident" id="7839989">test</span><span class="op" id="7839993">.</span><span class="ident" id="7839994">algo</span><span class="op" id="7839998">,</span>&nbsp;<span class="ident" id="7840000">err</span><span class="op" id="7840003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840010">}</span><br>
<span class="lineno"></span><span class="op" id="7840012">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7840015">func</span>&nbsp;<span class="ident" id="7840020">TestX509MixedKeyPair</span><span class="op" id="7840040">(</span><span class="ident" id="7840041">t</span>&nbsp;<span class="op" id="7840043">*</span><span class="ident" id="7840044">testing</span><span class="op" id="7840051">.</span><span class="ident" id="7840052">T</span><span class="op" id="7840053">)</span>&nbsp;<span class="op" id="7840055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840058">if</span>&nbsp;<span class="ident" id="7840061">_</span><span class="op" id="7840062">,</span>&nbsp;<span class="ident" id="7840064">err</span>&nbsp;<span class="op" id="7840068">:=</span>&nbsp;<span class="ident" id="7840071">X509KeyPair</span><span class="op" id="7840082">(</span><span class="op" id="7840083">[</span><span class="op" id="7840084">]</span><span class="builtintype" id="7840085">byte</span><span class="op" id="7840089">(</span><span class="ident" id="7840090">rsaCertPEM</span><span class="op" id="7840100">)</span><span class="op" id="7840101">,</span>&nbsp;<span class="op" id="7840103">[</span><span class="op" id="7840104">]</span><span class="builtintype" id="7840105">byte</span><span class="op" id="7840109">(</span><span class="ident" id="7840110">ecdsaKeyPEM</span><span class="op" id="7840121">)</span><span class="op" id="7840122">)</span><span class="op" id="7840123">;</span>&nbsp;<span class="ident" id="7840125">err</span>&nbsp;<span class="op" id="7840129">==</span>&nbsp;<span class="builtintype" id="7840132">nil</span>&nbsp;<span class="op" id="7840136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840140">t</span><span class="op" id="7840141">.</span><span class="ident" id="7840142">Error</span><span class="op" id="7840147">(</span><span class="string" id="7840148">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7840206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840209">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840212">if</span>&nbsp;<span class="ident" id="7840215">_</span><span class="op" id="7840216">,</span>&nbsp;<span class="ident" id="7840218">err</span>&nbsp;<span class="op" id="7840222">:=</span>&nbsp;<span class="ident" id="7840225">X509KeyPair</span><span class="op" id="7840236">(</span><span class="op" id="7840237">[</span><span class="op" id="7840238">]</span><span class="builtintype" id="7840239">byte</span><span class="op" id="7840243">(</span><span class="ident" id="7840244">ecdsaCertPEM</span><span class="op" id="7840256">)</span><span class="op" id="7840257">,</span>&nbsp;<span class="op" id="7840259">[</span><span class="op" id="7840260">]</span><span class="builtintype" id="7840261">byte</span><span class="op" id="7840265">(</span><span class="ident" id="7840266">rsaKeyPEM</span><span class="op" id="7840275">)</span><span class="op" id="7840276">)</span><span class="op" id="7840277">;</span>&nbsp;<span class="ident" id="7840279">err</span>&nbsp;<span class="op" id="7840283">==</span>&nbsp;<span class="builtintype" id="7840286">nil</span>&nbsp;<span class="op" id="7840290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840294">t</span><span class="op" id="7840295">.</span><span class="ident" id="7840296">Error</span><span class="op" id="7840301">(</span><span class="string" id="7840302">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7840360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840363">}</span><br>
<span class="lineno"></span><span class="op" id="7840365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7840368">func</span>&nbsp;<span class="ident" id="7840373">newLocalListener</span><span class="op" id="7840389">(</span><span class="ident" id="7840390">t</span>&nbsp;<span class="op" id="7840392">*</span><span class="ident" id="7840393">testing</span><span class="op" id="7840400">.</span><span class="ident" id="7840401">T</span><span class="op" id="7840402">)</span>&nbsp;<span class="ident" id="7840404">net</span><span class="op" id="7840407">.</span><span class="ident" id="7840408">Listener</span>&nbsp;<span class="op" id="7840417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840420">ln</span><span class="op" id="7840422">,</span>&nbsp;<span class="ident" id="7840424">err</span>&nbsp;<span class="op" id="7840428">:=</span>&nbsp;<span class="ident" id="7840431">net</span><span class="op" id="7840434">.</span><span class="ident" id="7840435">Listen</span><span class="op" id="7840441">(</span><span class="string" id="7840442">&#34;tcp&#34;</span><span class="op" id="7840447">,</span>&nbsp;<span class="string" id="7840449">&#34;127.0.0.1:0&#34;</span><span class="op" id="7840462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840465">if</span>&nbsp;<span class="ident" id="7840468">err</span>&nbsp;<span class="op" id="7840472">!=</span>&nbsp;<span class="builtintype" id="7840475">nil</span>&nbsp;<span class="op" id="7840479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840483">ln</span><span class="op" id="7840485">,</span>&nbsp;<span class="ident" id="7840487">err</span>&nbsp;<span class="op" id="7840491">=</span>&nbsp;<span class="ident" id="7840493">net</span><span class="op" id="7840496">.</span><span class="ident" id="7840497">Listen</span><span class="op" id="7840503">(</span><span class="string" id="7840504">&#34;tcp6&#34;</span><span class="op" id="7840510">,</span>&nbsp;<span class="string" id="7840512">&#34;[::1]:0&#34;</span><span class="op" id="7840521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840524">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840527">if</span>&nbsp;<span class="ident" id="7840530">err</span>&nbsp;<span class="op" id="7840534">!=</span>&nbsp;<span class="builtintype" id="7840537">nil</span>&nbsp;<span class="op" id="7840541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840545">t</span><span class="op" id="7840546">.</span><span class="ident" id="7840547">Fatal</span><span class="op" id="7840552">(</span><span class="ident" id="7840553">err</span><span class="op" id="7840556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840562">return</span>&nbsp;<span class="ident" id="7840569">ln</span><br>
<span class="lineno"></span><span class="op" id="7840572">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7840575">func</span>&nbsp;<span class="ident" id="7840580">TestDialTimeout</span><span class="op" id="7840595">(</span><span class="ident" id="7840596">t</span>&nbsp;<span class="op" id="7840598">*</span><span class="ident" id="7840599">testing</span><span class="op" id="7840606">.</span><span class="ident" id="7840607">T</span><span class="op" id="7840608">)</span>&nbsp;<span class="op" id="7840610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840613">if</span>&nbsp;<span class="ident" id="7840616">testing</span><span class="op" id="7840623">.</span><span class="ident" id="7840624">Short</span><span class="op" id="7840629">(</span><span class="op" id="7840630">)</span>&nbsp;<span class="op" id="7840632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840636">t</span><span class="op" id="7840637">.</span><span class="ident" id="7840638">Skip</span><span class="op" id="7840642">(</span><span class="string" id="7840643">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7840667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840670">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840673">listener</span>&nbsp;<span class="op" id="7840682">:=</span>&nbsp;<span class="ident" id="7840685">newLocalListener</span><span class="op" id="7840701">(</span><span class="ident" id="7840702">t</span><span class="op" id="7840703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840707">addr</span>&nbsp;<span class="op" id="7840712">:=</span>&nbsp;<span class="ident" id="7840715">listener</span><span class="op" id="7840723">.</span><span class="ident" id="7840724">Addr</span><span class="op" id="7840728">(</span><span class="op" id="7840729">)</span><span class="op" id="7840730">.</span><span class="ident" id="7840731">String</span><span class="op" id="7840737">(</span><span class="op" id="7840738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840741">defer</span>&nbsp;<span class="ident" id="7840747">listener</span><span class="op" id="7840755">.</span><span class="ident" id="7840756">Close</span><span class="op" id="7840761">(</span><span class="op" id="7840762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840766">complete</span>&nbsp;<span class="op" id="7840775">:=</span>&nbsp;<span class="builtinfunc" id="7840778">make</span><span class="op" id="7840782">(</span><span class="keyword" id="7840783">chan</span>&nbsp;<span class="builtintype" id="7840788">bool</span><span class="op" id="7840792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840795">defer</span>&nbsp;<span class="builtinfunc" id="7840801">close</span><span class="op" id="7840806">(</span><span class="ident" id="7840807">complete</span><span class="op" id="7840815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840819">go</span>&nbsp;<span class="keyword" id="7840822">func</span><span class="op" id="7840826">(</span><span class="op" id="7840827">)</span>&nbsp;<span class="op" id="7840829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840833">conn</span><span class="op" id="7840837">,</span>&nbsp;<span class="ident" id="7840839">err</span>&nbsp;<span class="op" id="7840843">:=</span>&nbsp;<span class="ident" id="7840846">listener</span><span class="op" id="7840854">.</span><span class="ident" id="7840855">Accept</span><span class="op" id="7840861">(</span><span class="op" id="7840862">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840866">if</span>&nbsp;<span class="ident" id="7840869">err</span>&nbsp;<span class="op" id="7840873">!=</span>&nbsp;<span class="builtintype" id="7840876">nil</span>&nbsp;<span class="op" id="7840880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840885">t</span><span class="op" id="7840886">.</span><span class="ident" id="7840887">Error</span><span class="op" id="7840892">(</span><span class="ident" id="7840893">err</span><span class="op" id="7840896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7840901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840914">&lt;-</span><span class="ident" id="7840916">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840927">conn</span><span class="op" id="7840931">.</span><span class="ident" id="7840932">Close</span><span class="op" id="7840937">(</span><span class="op" id="7840938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7840941">}</span><span class="op" id="7840942">(</span><span class="op" id="7840943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840947">dialer</span>&nbsp;<span class="op" id="7840954">:=</span>&nbsp;<span class="op" id="7840957">&amp;</span><span class="ident" id="7840958">net</span><span class="op" id="7840961">.</span><span class="ident" id="7840962">Dialer</span><span class="op" id="7840968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7840972">Timeout</span><span class="op" id="7840979">:</span>&nbsp;<span class="num" id="7840981">10</span>&nbsp;<span class="op" id="7840984">*</span>&nbsp;<span class="ident" id="7840986">time</span><span class="op" id="7840990">.</span><span class="ident" id="7840991">Millisecond</span><span class="op" id="7841002">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7841005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841009">var</span>&nbsp;<span class="ident" id="7841013">err</span>&nbsp;<span class="builtintype" id="7841017">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841024">if</span>&nbsp;<span class="ident" id="7841027">_</span><span class="op" id="7841028">,</span>&nbsp;<span class="ident" id="7841030">err</span>&nbsp;<span class="op" id="7841034">=</span>&nbsp;<span class="ident" id="7841036">DialWithDialer</span><span class="op" id="7841050">(</span><span class="ident" id="7841051">dialer</span><span class="op" id="7841057">,</span>&nbsp;<span class="string" id="7841059">&#34;tcp&#34;</span><span class="op" id="7841064">,</span>&nbsp;<span class="ident" id="7841066">addr</span><span class="op" id="7841070">,</span>&nbsp;<span class="builtintype" id="7841072">nil</span><span class="op" id="7841075">)</span><span class="op" id="7841076">;</span>&nbsp;<span class="ident" id="7841078">err</span>&nbsp;<span class="op" id="7841082">==</span>&nbsp;<span class="builtintype" id="7841085">nil</span>&nbsp;<span class="op" id="7841089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841093">t</span><span class="op" id="7841094">.</span><span class="ident" id="7841095">Fatal</span><span class="op" id="7841100">(</span><span class="string" id="7841101">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7841141">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7841144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841148">if</span>&nbsp;<span class="op" id="7841151">!</span><span class="ident" id="7841152">strings</span><span class="op" id="7841159">.</span><span class="ident" id="7841160">Contains</span><span class="op" id="7841168">(</span><span class="ident" id="7841169">err</span><span class="op" id="7841172">.</span><span class="ident" id="7841173">Error</span><span class="op" id="7841178">(</span><span class="op" id="7841179">)</span><span class="op" id="7841180">,</span>&nbsp;<span class="string" id="7841182">&#34;timed&nbsp;out&#34;</span><span class="op" id="7841193">)</span>&nbsp;<span class="op" id="7841195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841199">t</span><span class="op" id="7841200">.</span><span class="ident" id="7841201">Errorf</span><span class="op" id="7841207">(</span><span class="string" id="7841208">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7841243">,</span>&nbsp;<span class="ident" id="7841245">err</span><span class="op" id="7841248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7841251">}</span><br>
<span class="lineno">160</span><span class="op" id="7841253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7841256">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7841318">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7841386">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7841432">func</span>&nbsp;<span class="ident" id="7841437">TestConnReadNonzeroAndEOF</span><span class="op" id="7841462">(</span><span class="ident" id="7841463">t</span>&nbsp;<span class="op" id="7841465">*</span><span class="ident" id="7841466">testing</span><span class="op" id="7841473">.</span><span class="ident" id="7841474">T</span><span class="op" id="7841475">)</span>&nbsp;<span class="op" id="7841477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841480">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841538">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841596">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841659">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841718">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841781">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841816">if</span>&nbsp;<span class="ident" id="7841819">testing</span><span class="op" id="7841826">.</span><span class="ident" id="7841827">Short</span><span class="op" id="7841832">(</span><span class="op" id="7841833">)</span>&nbsp;<span class="op" id="7841835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841839">t</span><span class="op" id="7841840">.</span><span class="ident" id="7841841">Skip</span><span class="op" id="7841845">(</span><span class="string" id="7841846">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7841870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7841873">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841876">var</span>&nbsp;<span class="ident" id="7841880">err</span>&nbsp;<span class="builtintype" id="7841884">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841891">for</span>&nbsp;<span class="ident" id="7841895">delay</span>&nbsp;<span class="op" id="7841901">:=</span>&nbsp;<span class="ident" id="7841904">time</span><span class="op" id="7841908">.</span><span class="ident" id="7841909">Millisecond</span><span class="op" id="7841920">;</span>&nbsp;<span class="ident" id="7841922">delay</span>&nbsp;<span class="op" id="7841928">&lt;=</span>&nbsp;<span class="num" id="7841931">64</span><span class="op" id="7841933">*</span><span class="ident" id="7841934">time</span><span class="op" id="7841938">.</span><span class="ident" id="7841939">Millisecond</span><span class="op" id="7841950">;</span>&nbsp;<span class="ident" id="7841952">delay</span>&nbsp;<span class="op" id="7841958">*=</span>&nbsp;<span class="num" id="7841961">2</span>&nbsp;<span class="op" id="7841963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841967">if</span>&nbsp;<span class="ident" id="7841970">err</span>&nbsp;<span class="op" id="7841974">=</span>&nbsp;<span class="ident" id="7841976">testConnReadNonzeroAndEOF</span><span class="op" id="7842001">(</span><span class="ident" id="7842002">t</span><span class="op" id="7842003">,</span>&nbsp;<span class="ident" id="7842005">delay</span><span class="op" id="7842010">)</span><span class="op" id="7842011">;</span>&nbsp;<span class="ident" id="7842013">err</span>&nbsp;<span class="op" id="7842017">==</span>&nbsp;<span class="builtintype" id="7842020">nil</span>&nbsp;<span class="op" id="7842024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842029">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842038">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842044">t</span><span class="op" id="7842045">.</span><span class="ident" id="7842046">Error</span><span class="op" id="7842051">(</span><span class="ident" id="7842052">err</span><span class="op" id="7842055">)</span><br>
<span class="lineno"></span><span class="op" id="7842057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842060">func</span>&nbsp;<span class="ident" id="7842065">testConnReadNonzeroAndEOF</span><span class="op" id="7842090">(</span><span class="ident" id="7842091">t</span>&nbsp;<span class="op" id="7842093">*</span><span class="ident" id="7842094">testing</span><span class="op" id="7842101">.</span><span class="ident" id="7842102">T</span><span class="op" id="7842103">,</span>&nbsp;<span class="ident" id="7842105">delay</span>&nbsp;<span class="ident" id="7842111">time</span><span class="op" id="7842115">.</span><span class="ident" id="7842116">Duration</span><span class="op" id="7842124">)</span>&nbsp;<span class="builtintype" id="7842126">error</span>&nbsp;<span class="op" id="7842132">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842135">ln</span>&nbsp;<span class="op" id="7842138">:=</span>&nbsp;<span class="ident" id="7842141">newLocalListener</span><span class="op" id="7842157">(</span><span class="ident" id="7842158">t</span><span class="op" id="7842159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842162">defer</span>&nbsp;<span class="ident" id="7842168">ln</span><span class="op" id="7842170">.</span><span class="ident" id="7842171">Close</span><span class="op" id="7842176">(</span><span class="op" id="7842177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842181">srvCh</span>&nbsp;<span class="op" id="7842187">:=</span>&nbsp;<span class="builtinfunc" id="7842190">make</span><span class="op" id="7842194">(</span><span class="keyword" id="7842195">chan</span>&nbsp;<span class="op" id="7842200">*</span><span class="ident" id="7842201">Conn</span><span class="op" id="7842205">,</span>&nbsp;<span class="num" id="7842207">1</span><span class="op" id="7842208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842211">var</span>&nbsp;<span class="ident" id="7842215">serr</span>&nbsp;<span class="builtintype" id="7842220">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842227">go</span>&nbsp;<span class="keyword" id="7842230">func</span><span class="op" id="7842234">(</span><span class="op" id="7842235">)</span>&nbsp;<span class="op" id="7842237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842241">sconn</span><span class="op" id="7842246">,</span>&nbsp;<span class="ident" id="7842248">err</span>&nbsp;<span class="op" id="7842252">:=</span>&nbsp;<span class="ident" id="7842255">ln</span><span class="op" id="7842257">.</span><span class="ident" id="7842258">Accept</span><span class="op" id="7842264">(</span><span class="op" id="7842265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842269">if</span>&nbsp;<span class="ident" id="7842272">err</span>&nbsp;<span class="op" id="7842276">!=</span>&nbsp;<span class="builtintype" id="7842279">nil</span>&nbsp;<span class="op" id="7842283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842288">serr</span>&nbsp;<span class="op" id="7842293">=</span>&nbsp;<span class="ident" id="7842295">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842302">srvCh</span>&nbsp;<span class="op" id="7842308">&lt;-</span>&nbsp;<span class="builtintype" id="7842311">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842318">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842331">serverConfig</span>&nbsp;<span class="op" id="7842344">:=</span>&nbsp;<span class="op" id="7842347">*</span><span class="ident" id="7842348">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842361">srv</span>&nbsp;<span class="op" id="7842365">:=</span>&nbsp;<span class="ident" id="7842368">Server</span><span class="op" id="7842374">(</span><span class="ident" id="7842375">sconn</span><span class="op" id="7842380">,</span>&nbsp;<span class="op" id="7842382">&amp;</span><span class="ident" id="7842383">serverConfig</span><span class="op" id="7842395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842399">if</span>&nbsp;<span class="ident" id="7842402">err</span>&nbsp;<span class="op" id="7842406">:=</span>&nbsp;<span class="ident" id="7842409">srv</span><span class="op" id="7842412">.</span><span class="ident" id="7842413">Handshake</span><span class="op" id="7842422">(</span><span class="op" id="7842423">)</span><span class="op" id="7842424">;</span>&nbsp;<span class="ident" id="7842426">err</span>&nbsp;<span class="op" id="7842430">!=</span>&nbsp;<span class="builtintype" id="7842433">nil</span>&nbsp;<span class="op" id="7842437">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842442">serr</span>&nbsp;<span class="op" id="7842447">=</span>&nbsp;<span class="ident" id="7842449">fmt</span><span class="op" id="7842452">.</span><span class="ident" id="7842453">Errorf</span><span class="op" id="7842459">(</span><span class="string" id="7842460">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7842475">,</span>&nbsp;<span class="ident" id="7842477">err</span><span class="op" id="7842480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842485">srvCh</span>&nbsp;<span class="op" id="7842491">&lt;-</span>&nbsp;<span class="builtintype" id="7842494">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842501">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842514">srvCh</span>&nbsp;<span class="op" id="7842520">&lt;-</span>&nbsp;<span class="ident" id="7842523">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842528">}</span><span class="op" id="7842529">(</span><span class="op" id="7842530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842534">clientConfig</span>&nbsp;<span class="op" id="7842547">:=</span>&nbsp;<span class="op" id="7842550">*</span><span class="ident" id="7842551">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842563">conn</span><span class="op" id="7842567">,</span>&nbsp;<span class="ident" id="7842569">err</span>&nbsp;<span class="op" id="7842573">:=</span>&nbsp;<span class="ident" id="7842576">Dial</span><span class="op" id="7842580">(</span><span class="string" id="7842581">&#34;tcp&#34;</span><span class="op" id="7842586">,</span>&nbsp;<span class="ident" id="7842588">ln</span><span class="op" id="7842590">.</span><span class="ident" id="7842591">Addr</span><span class="op" id="7842595">(</span><span class="op" id="7842596">)</span><span class="op" id="7842597">.</span><span class="ident" id="7842598">String</span><span class="op" id="7842604">(</span><span class="op" id="7842605">)</span><span class="op" id="7842606">,</span>&nbsp;<span class="op" id="7842608">&amp;</span><span class="ident" id="7842609">clientConfig</span><span class="op" id="7842621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842624">if</span>&nbsp;<span class="ident" id="7842627">err</span>&nbsp;<span class="op" id="7842631">!=</span>&nbsp;<span class="builtintype" id="7842634">nil</span>&nbsp;<span class="op" id="7842638">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842642">t</span><span class="op" id="7842643">.</span><span class="ident" id="7842644">Fatal</span><span class="op" id="7842649">(</span><span class="ident" id="7842650">err</span><span class="op" id="7842653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842659">defer</span>&nbsp;<span class="ident" id="7842665">conn</span><span class="op" id="7842669">.</span><span class="ident" id="7842670">Close</span><span class="op" id="7842675">(</span><span class="op" id="7842676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842680">srv</span>&nbsp;<span class="op" id="7842684">:=</span>&nbsp;<span class="op" id="7842687">&lt;-</span><span class="ident" id="7842689">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842696">if</span>&nbsp;<span class="ident" id="7842699">srv</span>&nbsp;<span class="op" id="7842703">==</span>&nbsp;<span class="builtintype" id="7842706">nil</span>&nbsp;<span class="op" id="7842710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842714">return</span>&nbsp;<span class="ident" id="7842721">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842731">buf</span>&nbsp;<span class="op" id="7842735">:=</span>&nbsp;<span class="builtinfunc" id="7842738">make</span><span class="op" id="7842742">(</span><span class="op" id="7842743">[</span><span class="op" id="7842744">]</span><span class="builtintype" id="7842745">byte</span><span class="op" id="7842749">,</span>&nbsp;<span class="num" id="7842751">6</span><span class="op" id="7842752">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842756">srv</span><span class="op" id="7842759">.</span><span class="ident" id="7842760">Write</span><span class="op" id="7842765">(</span><span class="op" id="7842766">[</span><span class="op" id="7842767">]</span><span class="builtintype" id="7842768">byte</span><span class="op" id="7842772">(</span><span class="string" id="7842773">&#34;foobar&#34;</span><span class="op" id="7842781">)</span><span class="op" id="7842782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842785">n</span><span class="op" id="7842786">,</span>&nbsp;<span class="ident" id="7842788">err</span>&nbsp;<span class="op" id="7842792">:=</span>&nbsp;<span class="ident" id="7842795">conn</span><span class="op" id="7842799">.</span><span class="ident" id="7842800">Read</span><span class="op" id="7842804">(</span><span class="ident" id="7842805">buf</span><span class="op" id="7842808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842811">if</span>&nbsp;<span class="ident" id="7842814">n</span>&nbsp;<span class="op" id="7842816">!=</span>&nbsp;<span class="num" id="7842819">6</span>&nbsp;<span class="op" id="7842821">||</span>&nbsp;<span class="ident" id="7842824">err</span>&nbsp;<span class="op" id="7842828">!=</span>&nbsp;<span class="builtintype" id="7842831">nil</span>&nbsp;<span class="op" id="7842835">||</span>&nbsp;<span class="builtintype" id="7842838">string</span><span class="op" id="7842844">(</span><span class="ident" id="7842845">buf</span><span class="op" id="7842848">)</span>&nbsp;<span class="op" id="7842850">!=</span>&nbsp;<span class="string" id="7842853">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7842862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842866">return</span>&nbsp;<span class="ident" id="7842873">fmt</span><span class="op" id="7842876">.</span><span class="ident" id="7842877">Errorf</span><span class="op" id="7842883">(</span><span class="string" id="7842884">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7842929">,</span>&nbsp;<span class="ident" id="7842931">n</span><span class="op" id="7842932">,</span>&nbsp;<span class="ident" id="7842934">err</span><span class="op" id="7842937">,</span>&nbsp;<span class="ident" id="7842939">buf</span><span class="op" id="7842942">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842949">srv</span><span class="op" id="7842952">.</span><span class="ident" id="7842953">Write</span><span class="op" id="7842958">(</span><span class="op" id="7842959">[</span><span class="op" id="7842960">]</span><span class="builtintype" id="7842961">byte</span><span class="op" id="7842965">(</span><span class="string" id="7842966">&#34;abcdef&#34;</span><span class="op" id="7842974">)</span><span class="op" id="7842975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842978">srv</span><span class="op" id="7842981">.</span><span class="ident" id="7842982">Close</span><span class="op" id="7842987">(</span><span class="op" id="7842988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842991">time</span><span class="op" id="7842995">.</span><span class="ident" id="7842996">Sleep</span><span class="op" id="7843001">(</span><span class="ident" id="7843002">delay</span><span class="op" id="7843007">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843010">n</span><span class="op" id="7843011">,</span>&nbsp;<span class="ident" id="7843013">err</span>&nbsp;<span class="op" id="7843017">=</span>&nbsp;<span class="ident" id="7843019">conn</span><span class="op" id="7843023">.</span><span class="ident" id="7843024">Read</span><span class="op" id="7843028">(</span><span class="ident" id="7843029">buf</span><span class="op" id="7843032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843035">if</span>&nbsp;<span class="ident" id="7843038">n</span>&nbsp;<span class="op" id="7843040">!=</span>&nbsp;<span class="num" id="7843043">6</span>&nbsp;<span class="op" id="7843045">||</span>&nbsp;<span class="builtintype" id="7843048">string</span><span class="op" id="7843054">(</span><span class="ident" id="7843055">buf</span><span class="op" id="7843058">)</span>&nbsp;<span class="op" id="7843060">!=</span>&nbsp;<span class="string" id="7843063">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7843072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843076">return</span>&nbsp;<span class="ident" id="7843083">fmt</span><span class="op" id="7843086">.</span><span class="ident" id="7843087">Errorf</span><span class="op" id="7843093">(</span><span class="string" id="7843094">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7843130">,</span>&nbsp;<span class="ident" id="7843132">n</span><span class="op" id="7843133">,</span>&nbsp;<span class="ident" id="7843135">buf</span><span class="op" id="7843138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843144">if</span>&nbsp;<span class="ident" id="7843147">err</span>&nbsp;<span class="op" id="7843151">!=</span>&nbsp;<span class="ident" id="7843154">io</span><span class="op" id="7843156">.</span><span class="ident" id="7843157">EOF</span>&nbsp;<span class="op" id="7843161">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843165">return</span>&nbsp;<span class="ident" id="7843172">fmt</span><span class="op" id="7843175">.</span><span class="ident" id="7843176">Errorf</span><span class="op" id="7843182">(</span><span class="string" id="7843183">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7843220">,</span>&nbsp;<span class="ident" id="7843222">err</span><span class="op" id="7843225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843231">return</span>&nbsp;<span class="builtintype" id="7843238">nil</span><br>
<span class="lineno"></span><span class="op" id="7843242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7843245">func</span>&nbsp;<span class="ident" id="7843250">TestTLSUniqueMatches</span><span class="op" id="7843270">(</span><span class="ident" id="7843271">t</span>&nbsp;<span class="op" id="7843273">*</span><span class="ident" id="7843274">testing</span><span class="op" id="7843281">.</span><span class="ident" id="7843282">T</span><span class="op" id="7843283">)</span>&nbsp;<span class="op" id="7843285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843288">ln</span>&nbsp;<span class="op" id="7843291">:=</span>&nbsp;<span class="ident" id="7843294">newLocalListener</span><span class="op" id="7843310">(</span><span class="ident" id="7843311">t</span><span class="op" id="7843312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843315">defer</span>&nbsp;<span class="ident" id="7843321">ln</span><span class="op" id="7843323">.</span><span class="ident" id="7843324">Close</span><span class="op" id="7843329">(</span><span class="op" id="7843330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843334">serverTLSUniques</span>&nbsp;<span class="op" id="7843351">:=</span>&nbsp;<span class="builtinfunc" id="7843354">make</span><span class="op" id="7843358">(</span><span class="keyword" id="7843359">chan</span>&nbsp;<span class="op" id="7843364">[</span><span class="op" id="7843365">]</span><span class="builtintype" id="7843366">byte</span><span class="op" id="7843370">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843373">go</span>&nbsp;<span class="keyword" id="7843376">func</span><span class="op" id="7843380">(</span><span class="op" id="7843381">)</span>&nbsp;<span class="op" id="7843383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843387">for</span>&nbsp;<span class="ident" id="7843391">i</span>&nbsp;<span class="op" id="7843393">:=</span>&nbsp;<span class="num" id="7843396">0</span><span class="op" id="7843397">;</span>&nbsp;<span class="ident" id="7843399">i</span>&nbsp;<span class="op" id="7843401">&lt;</span>&nbsp;<span class="num" id="7843403">2</span><span class="op" id="7843404">;</span>&nbsp;<span class="ident" id="7843406">i</span><span class="op" id="7843407">++</span>&nbsp;<span class="op" id="7843410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843415">sconn</span><span class="op" id="7843420">,</span>&nbsp;<span class="ident" id="7843422">err</span>&nbsp;<span class="op" id="7843426">:=</span>&nbsp;<span class="ident" id="7843429">ln</span><span class="op" id="7843431">.</span><span class="ident" id="7843432">Accept</span><span class="op" id="7843438">(</span><span class="op" id="7843439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843444">if</span>&nbsp;<span class="ident" id="7843447">err</span>&nbsp;<span class="op" id="7843451">!=</span>&nbsp;<span class="builtintype" id="7843454">nil</span>&nbsp;<span class="op" id="7843458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843464">t</span><span class="op" id="7843465">.</span><span class="ident" id="7843466">Fatal</span><span class="op" id="7843471">(</span><span class="ident" id="7843472">err</span><span class="op" id="7843475">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843485">serverConfig</span>&nbsp;<span class="op" id="7843498">:=</span>&nbsp;<span class="op" id="7843501">*</span><span class="ident" id="7843502">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843516">srv</span>&nbsp;<span class="op" id="7843520">:=</span>&nbsp;<span class="ident" id="7843523">Server</span><span class="op" id="7843529">(</span><span class="ident" id="7843530">sconn</span><span class="op" id="7843535">,</span>&nbsp;<span class="op" id="7843537">&amp;</span><span class="ident" id="7843538">serverConfig</span><span class="op" id="7843550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843555">if</span>&nbsp;<span class="ident" id="7843558">err</span>&nbsp;<span class="op" id="7843562">:=</span>&nbsp;<span class="ident" id="7843565">srv</span><span class="op" id="7843568">.</span><span class="ident" id="7843569">Handshake</span><span class="op" id="7843578">(</span><span class="op" id="7843579">)</span><span class="op" id="7843580">;</span>&nbsp;<span class="ident" id="7843582">err</span>&nbsp;<span class="op" id="7843586">!=</span>&nbsp;<span class="builtintype" id="7843589">nil</span>&nbsp;<span class="op" id="7843593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843599">t</span><span class="op" id="7843600">.</span><span class="ident" id="7843601">Fatal</span><span class="op" id="7843606">(</span><span class="ident" id="7843607">err</span><span class="op" id="7843610">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843620">serverTLSUniques</span>&nbsp;<span class="op" id="7843637">&lt;-</span>&nbsp;<span class="ident" id="7843640">srv</span><span class="op" id="7843643">.</span><span class="ident" id="7843644">ConnectionState</span><span class="op" id="7843659">(</span><span class="op" id="7843660">)</span><span class="op" id="7843661">.</span><span class="ident" id="7843662">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843677">}</span><span class="op" id="7843678">(</span><span class="op" id="7843679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843683">clientConfig</span>&nbsp;<span class="op" id="7843696">:=</span>&nbsp;<span class="op" id="7843699">*</span><span class="ident" id="7843700">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843712">clientConfig</span><span class="op" id="7843724">.</span><span class="ident" id="7843725">ClientSessionCache</span>&nbsp;<span class="op" id="7843744">=</span>&nbsp;<span class="ident" id="7843746">NewLRUClientSessionCache</span><span class="op" id="7843770">(</span><span class="num" id="7843771">1</span><span class="op" id="7843772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843775">conn</span><span class="op" id="7843779">,</span>&nbsp;<span class="ident" id="7843781">err</span>&nbsp;<span class="op" id="7843785">:=</span>&nbsp;<span class="ident" id="7843788">Dial</span><span class="op" id="7843792">(</span><span class="string" id="7843793">&#34;tcp&#34;</span><span class="op" id="7843798">,</span>&nbsp;<span class="ident" id="7843800">ln</span><span class="op" id="7843802">.</span><span class="ident" id="7843803">Addr</span><span class="op" id="7843807">(</span><span class="op" id="7843808">)</span><span class="op" id="7843809">.</span><span class="ident" id="7843810">String</span><span class="op" id="7843816">(</span><span class="op" id="7843817">)</span><span class="op" id="7843818">,</span>&nbsp;<span class="op" id="7843820">&amp;</span><span class="ident" id="7843821">clientConfig</span><span class="op" id="7843833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843836">if</span>&nbsp;<span class="ident" id="7843839">err</span>&nbsp;<span class="op" id="7843843">!=</span>&nbsp;<span class="builtintype" id="7843846">nil</span>&nbsp;<span class="op" id="7843850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843854">t</span><span class="op" id="7843855">.</span><span class="ident" id="7843856">Fatal</span><span class="op" id="7843861">(</span><span class="ident" id="7843862">err</span><span class="op" id="7843865">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843871">if</span>&nbsp;<span class="op" id="7843874">!</span><span class="ident" id="7843875">bytes</span><span class="op" id="7843880">.</span><span class="ident" id="7843881">Equal</span><span class="op" id="7843886">(</span><span class="ident" id="7843887">conn</span><span class="op" id="7843891">.</span><span class="ident" id="7843892">ConnectionState</span><span class="op" id="7843907">(</span><span class="op" id="7843908">)</span><span class="op" id="7843909">.</span><span class="ident" id="7843910">TLSUnique</span><span class="op" id="7843919">,</span>&nbsp;<span class="op" id="7843921">&lt;-</span><span class="ident" id="7843923">serverTLSUniques</span><span class="op" id="7843939">)</span>&nbsp;<span class="op" id="7843941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843945">t</span><span class="op" id="7843946">.</span><span class="ident" id="7843947">Error</span><span class="op" id="7843952">(</span><span class="string" id="7843953">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7843996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844002">conn</span><span class="op" id="7844006">.</span><span class="ident" id="7844007">Close</span><span class="op" id="7844012">(</span><span class="op" id="7844013">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844017">conn</span><span class="op" id="7844021">,</span>&nbsp;<span class="ident" id="7844023">err</span>&nbsp;<span class="op" id="7844027">=</span>&nbsp;<span class="ident" id="7844029">Dial</span><span class="op" id="7844033">(</span><span class="string" id="7844034">&#34;tcp&#34;</span><span class="op" id="7844039">,</span>&nbsp;<span class="ident" id="7844041">ln</span><span class="op" id="7844043">.</span><span class="ident" id="7844044">Addr</span><span class="op" id="7844048">(</span><span class="op" id="7844049">)</span><span class="op" id="7844050">.</span><span class="ident" id="7844051">String</span><span class="op" id="7844057">(</span><span class="op" id="7844058">)</span><span class="op" id="7844059">,</span>&nbsp;<span class="op" id="7844061">&amp;</span><span class="ident" id="7844062">clientConfig</span><span class="op" id="7844074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844077">if</span>&nbsp;<span class="ident" id="7844080">err</span>&nbsp;<span class="op" id="7844084">!=</span>&nbsp;<span class="builtintype" id="7844087">nil</span>&nbsp;<span class="op" id="7844091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844095">t</span><span class="op" id="7844096">.</span><span class="ident" id="7844097">Fatal</span><span class="op" id="7844102">(</span><span class="ident" id="7844103">err</span><span class="op" id="7844106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844109">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844112">defer</span>&nbsp;<span class="ident" id="7844118">conn</span><span class="op" id="7844122">.</span><span class="ident" id="7844123">Close</span><span class="op" id="7844128">(</span><span class="op" id="7844129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844132">if</span>&nbsp;<span class="op" id="7844135">!</span><span class="ident" id="7844136">conn</span><span class="op" id="7844140">.</span><span class="ident" id="7844141">ConnectionState</span><span class="op" id="7844156">(</span><span class="op" id="7844157">)</span><span class="op" id="7844158">.</span><span class="ident" id="7844159">DidResume</span>&nbsp;<span class="op" id="7844169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844173">t</span><span class="op" id="7844174">.</span><span class="ident" id="7844175">Error</span><span class="op" id="7844180">(</span><span class="string" id="7844181">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7844220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844226">if</span>&nbsp;<span class="op" id="7844229">!</span><span class="ident" id="7844230">bytes</span><span class="op" id="7844235">.</span><span class="ident" id="7844236">Equal</span><span class="op" id="7844241">(</span><span class="ident" id="7844242">conn</span><span class="op" id="7844246">.</span><span class="ident" id="7844247">ConnectionState</span><span class="op" id="7844262">(</span><span class="op" id="7844263">)</span><span class="op" id="7844264">.</span><span class="ident" id="7844265">TLSUnique</span><span class="op" id="7844274">,</span>&nbsp;<span class="op" id="7844276">&lt;-</span><span class="ident" id="7844278">serverTLSUniques</span><span class="op" id="7844294">)</span>&nbsp;<span class="op" id="7844296">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844300">t</span><span class="op" id="7844301">.</span><span class="ident" id="7844302">Error</span><span class="op" id="7844307">(</span><span class="string" id="7844308">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7844383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844386">}</span><br>
<span class="lineno"></span><span class="op" id="7844388">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
