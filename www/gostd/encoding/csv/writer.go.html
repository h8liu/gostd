<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6180079">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6180134">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6180188">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6180239">package</span>&nbsp;<span class="ident" id="6180247">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6180252">import</span>&nbsp;<span class="op" id="6180259">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6180262">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6180271">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6180277">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6180288">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6180299">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6180314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6180317">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6180367">//</span><br>
<span class="lineno"></span><span class="comment" id="6180370">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6180439">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6180515">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6180595">//</span><br>
<span class="lineno"></span><span class="comment" id="6180598">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6180631">//</span><br>
<span class="lineno"></span><span class="comment" id="6180634">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6180710">type</span>&nbsp;<span class="ident" id="6180715">Writer</span>&nbsp;<span class="keyword" id="6180722">struct</span>&nbsp;<span class="op" id="6180729">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180732">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6180740">rune</span>&nbsp;<span class="comment" id="6180745">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180791">UseCRLF</span>&nbsp;<span class="builtintype" id="6180799">bool</span>&nbsp;<span class="comment" id="6180804">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180848">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180856">*</span><span class="ident" id="6180857">bufio</span><span class="op" id="6180862">.</span><span class="ident" id="6180863">Writer</span><br>
<span class="lineno"></span><span class="op" id="6180870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6180873">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6180925">func</span>&nbsp;<span class="ident" id="6180930">NewWriter</span><span class="op" id="6180939">(</span><span class="ident" id="6180940">w</span>&nbsp;<span class="ident" id="6180942">io</span><span class="op" id="6180944">.</span><span class="ident" id="6180945">Writer</span><span class="op" id="6180951">)</span>&nbsp;<span class="op" id="6180953">*</span><span class="ident" id="6180954">Writer</span>&nbsp;<span class="op" id="6180961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180964">return</span>&nbsp;<span class="op" id="6180971">&amp;</span><span class="ident" id="6180972">Writer</span><span class="op" id="6180978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180982">Comma</span><span class="op" id="6180987">:</span>&nbsp;<span class="string" id="6180989">&#39;,&#39;</span><span class="op" id="6180992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180996">w</span><span class="op" id="6180997">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181003">bufio</span><span class="op" id="6181008">.</span><span class="ident" id="6181009">NewWriter</span><span class="op" id="6181018">(</span><span class="ident" id="6181019">w</span><span class="op" id="6181020">)</span><span class="op" id="6181021">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181024">}</span><br>
<span class="lineno"></span><span class="op" id="6181026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6181029">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6181105">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6181173">func</span>&nbsp;<span class="op" id="6181178">(</span><span class="ident" id="6181179">w</span>&nbsp;<span class="op" id="6181181">*</span><span class="ident" id="6181182">Writer</span><span class="op" id="6181188">)</span>&nbsp;<span class="ident" id="6181190">Write</span><span class="op" id="6181195">(</span><span class="ident" id="6181196">record</span>&nbsp;<span class="op" id="6181203">[</span><span class="op" id="6181204">]</span><span class="builtintype" id="6181205">string</span><span class="op" id="6181211">)</span>&nbsp;<span class="op" id="6181213">(</span><span class="ident" id="6181214">err</span>&nbsp;<span class="builtintype" id="6181218">error</span><span class="op" id="6181223">)</span>&nbsp;<span class="op" id="6181225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181228">for</span>&nbsp;<span class="ident" id="6181232">n</span><span class="op" id="6181233">,</span>&nbsp;<span class="ident" id="6181235">field</span>&nbsp;<span class="op" id="6181241">:=</span>&nbsp;<span class="keyword" id="6181244">range</span>&nbsp;<span class="ident" id="6181250">record</span>&nbsp;<span class="op" id="6181257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181261">if</span>&nbsp;<span class="ident" id="6181264">n</span>&nbsp;<span class="op" id="6181266">&gt;</span>&nbsp;<span class="num" id="6181268">0</span>&nbsp;<span class="op" id="6181270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181275">if</span>&nbsp;<span class="ident" id="6181278">_</span><span class="op" id="6181279">,</span>&nbsp;<span class="ident" id="6181281">err</span>&nbsp;<span class="op" id="6181285">=</span>&nbsp;<span class="ident" id="6181287">w</span><span class="op" id="6181288">.</span><span class="ident" id="6181289">w</span><span class="op" id="6181290">.</span><span class="ident" id="6181291">WriteRune</span><span class="op" id="6181300">(</span><span class="ident" id="6181301">w</span><span class="op" id="6181302">.</span><span class="ident" id="6181303">Comma</span><span class="op" id="6181308">)</span><span class="op" id="6181309">;</span>&nbsp;<span class="ident" id="6181311">err</span>&nbsp;<span class="op" id="6181315">!=</span>&nbsp;<span class="ident" id="6181318">nil</span>&nbsp;<span class="op" id="6181322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181328">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6181347">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6181402">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181459">if</span>&nbsp;<span class="op" id="6181462">!</span><span class="ident" id="6181463">w</span><span class="op" id="6181464">.</span><span class="ident" id="6181465">fieldNeedsQuotes</span><span class="op" id="6181481">(</span><span class="ident" id="6181482">field</span><span class="op" id="6181487">)</span>&nbsp;<span class="op" id="6181489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181494">if</span>&nbsp;<span class="ident" id="6181497">_</span><span class="op" id="6181498">,</span>&nbsp;<span class="ident" id="6181500">err</span>&nbsp;<span class="op" id="6181504">=</span>&nbsp;<span class="ident" id="6181506">w</span><span class="op" id="6181507">.</span><span class="ident" id="6181508">w</span><span class="op" id="6181509">.</span><span class="ident" id="6181510">WriteString</span><span class="op" id="6181521">(</span><span class="ident" id="6181522">field</span><span class="op" id="6181527">)</span><span class="op" id="6181528">;</span>&nbsp;<span class="ident" id="6181530">err</span>&nbsp;<span class="op" id="6181534">!=</span>&nbsp;<span class="ident" id="6181537">nil</span>&nbsp;<span class="op" id="6181541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181547">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181562">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181577">if</span>&nbsp;<span class="ident" id="6181580">err</span>&nbsp;<span class="op" id="6181584">=</span>&nbsp;<span class="ident" id="6181586">w</span><span class="op" id="6181587">.</span><span class="ident" id="6181588">w</span><span class="op" id="6181589">.</span><span class="ident" id="6181590">WriteByte</span><span class="op" id="6181599">(</span><span class="string" id="6181600">&#39;&#34;&#39;</span><span class="op" id="6181603">)</span><span class="op" id="6181604">;</span>&nbsp;<span class="ident" id="6181606">err</span>&nbsp;<span class="op" id="6181610">!=</span>&nbsp;<span class="ident" id="6181613">nil</span>&nbsp;<span class="op" id="6181617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181622">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181636">for</span>&nbsp;<span class="ident" id="6181640">_</span><span class="op" id="6181641">,</span>&nbsp;<span class="ident" id="6181643">r1</span>&nbsp;<span class="op" id="6181646">:=</span>&nbsp;<span class="keyword" id="6181649">range</span>&nbsp;<span class="ident" id="6181655">field</span>&nbsp;<span class="op" id="6181661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181666">switch</span>&nbsp;<span class="ident" id="6181673">r1</span>&nbsp;<span class="op" id="6181676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181681">case</span>&nbsp;<span class="string" id="6181686">&#39;&#34;&#39;</span><span class="op" id="6181689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181695">_</span><span class="op" id="6181696">,</span>&nbsp;<span class="ident" id="6181698">err</span>&nbsp;<span class="op" id="6181702">=</span>&nbsp;<span class="ident" id="6181704">w</span><span class="op" id="6181705">.</span><span class="ident" id="6181706">w</span><span class="op" id="6181707">.</span><span class="ident" id="6181708">WriteString</span><span class="op" id="6181719">(</span><span class="string" id="6181720">`&#34;&#34;`</span><span class="op" id="6181724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181729">case</span>&nbsp;<span class="string" id="6181734">&#39;\r&#39;</span><span class="op" id="6181738">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181744">if</span>&nbsp;<span class="op" id="6181747">!</span><span class="ident" id="6181748">w</span><span class="op" id="6181749">.</span><span class="ident" id="6181750">UseCRLF</span>&nbsp;<span class="op" id="6181758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181765">err</span>&nbsp;<span class="op" id="6181769">=</span>&nbsp;<span class="ident" id="6181771">w</span><span class="op" id="6181772">.</span><span class="ident" id="6181773">w</span><span class="op" id="6181774">.</span><span class="ident" id="6181775">WriteByte</span><span class="op" id="6181784">(</span><span class="string" id="6181785">&#39;\r&#39;</span><span class="op" id="6181789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181800">case</span>&nbsp;<span class="string" id="6181805">&#39;\n&#39;</span><span class="op" id="6181809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181815">if</span>&nbsp;<span class="ident" id="6181818">w</span><span class="op" id="6181819">.</span><span class="ident" id="6181820">UseCRLF</span>&nbsp;<span class="op" id="6181828">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181835">_</span><span class="op" id="6181836">,</span>&nbsp;<span class="ident" id="6181838">err</span>&nbsp;<span class="op" id="6181842">=</span>&nbsp;<span class="ident" id="6181844">w</span><span class="op" id="6181845">.</span><span class="ident" id="6181846">w</span><span class="op" id="6181847">.</span><span class="ident" id="6181848">WriteString</span><span class="op" id="6181859">(</span><span class="string" id="6181860">&#34;\r\n&#34;</span><span class="op" id="6181866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181872">}</span>&nbsp;<span class="keyword" id="6181874">else</span>&nbsp;<span class="op" id="6181879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181886">err</span>&nbsp;<span class="op" id="6181890">=</span>&nbsp;<span class="ident" id="6181892">w</span><span class="op" id="6181893">.</span><span class="ident" id="6181894">w</span><span class="op" id="6181895">.</span><span class="ident" id="6181896">WriteByte</span><span class="op" id="6181905">(</span><span class="string" id="6181906">&#39;\n&#39;</span><span class="op" id="6181910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181921">default</span><span class="op" id="6181928">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181934">_</span><span class="op" id="6181935">,</span>&nbsp;<span class="ident" id="6181937">err</span>&nbsp;<span class="op" id="6181941">=</span>&nbsp;<span class="ident" id="6181943">w</span><span class="op" id="6181944">.</span><span class="ident" id="6181945">w</span><span class="op" id="6181946">.</span><span class="ident" id="6181947">WriteRune</span><span class="op" id="6181956">(</span><span class="ident" id="6181957">r1</span><span class="op" id="6181959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181969">if</span>&nbsp;<span class="ident" id="6181972">err</span>&nbsp;<span class="op" id="6181976">!=</span>&nbsp;<span class="ident" id="6181979">nil</span>&nbsp;<span class="op" id="6181983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181999">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182008">if</span>&nbsp;<span class="ident" id="6182011">err</span>&nbsp;<span class="op" id="6182015">=</span>&nbsp;<span class="ident" id="6182017">w</span><span class="op" id="6182018">.</span><span class="ident" id="6182019">w</span><span class="op" id="6182020">.</span><span class="ident" id="6182021">WriteByte</span><span class="op" id="6182030">(</span><span class="string" id="6182031">&#39;&#34;&#39;</span><span class="op" id="6182034">)</span><span class="op" id="6182035">;</span>&nbsp;<span class="ident" id="6182037">err</span>&nbsp;<span class="op" id="6182041">!=</span>&nbsp;<span class="ident" id="6182044">nil</span>&nbsp;<span class="op" id="6182048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182062">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182068">if</span>&nbsp;<span class="ident" id="6182071">w</span><span class="op" id="6182072">.</span><span class="ident" id="6182073">UseCRLF</span>&nbsp;<span class="op" id="6182081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182085">_</span><span class="op" id="6182086">,</span>&nbsp;<span class="ident" id="6182088">err</span>&nbsp;<span class="op" id="6182092">=</span>&nbsp;<span class="ident" id="6182094">w</span><span class="op" id="6182095">.</span><span class="ident" id="6182096">w</span><span class="op" id="6182097">.</span><span class="ident" id="6182098">WriteString</span><span class="op" id="6182109">(</span><span class="string" id="6182110">&#34;\r\n&#34;</span><span class="op" id="6182116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182119">}</span>&nbsp;<span class="keyword" id="6182121">else</span>&nbsp;<span class="op" id="6182126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182130">err</span>&nbsp;<span class="op" id="6182134">=</span>&nbsp;<span class="ident" id="6182136">w</span><span class="op" id="6182137">.</span><span class="ident" id="6182138">w</span><span class="op" id="6182139">.</span><span class="ident" id="6182140">WriteByte</span><span class="op" id="6182149">(</span><span class="string" id="6182150">&#39;\n&#39;</span><span class="op" id="6182154">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182160">return</span><br>
<span class="lineno"></span><span class="op" id="6182167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182170">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6182233">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6182296">func</span>&nbsp;<span class="op" id="6182301">(</span><span class="ident" id="6182302">w</span>&nbsp;<span class="op" id="6182304">*</span><span class="ident" id="6182305">Writer</span><span class="op" id="6182311">)</span>&nbsp;<span class="ident" id="6182313">Flush</span><span class="op" id="6182318">(</span><span class="op" id="6182319">)</span>&nbsp;<span class="op" id="6182321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182324">w</span><span class="op" id="6182325">.</span><span class="ident" id="6182326">w</span><span class="op" id="6182327">.</span><span class="ident" id="6182328">Flush</span><span class="op" id="6182333">(</span><span class="op" id="6182334">)</span><br>
<span class="lineno"></span><span class="op" id="6182336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6182339">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6182418">func</span>&nbsp;<span class="op" id="6182423">(</span><span class="ident" id="6182424">w</span>&nbsp;<span class="op" id="6182426">*</span><span class="ident" id="6182427">Writer</span><span class="op" id="6182433">)</span>&nbsp;<span class="ident" id="6182435">Error</span><span class="op" id="6182440">(</span><span class="op" id="6182441">)</span>&nbsp;<span class="builtintype" id="6182443">error</span>&nbsp;<span class="op" id="6182449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182452">_</span><span class="op" id="6182453">,</span>&nbsp;<span class="ident" id="6182455">err</span>&nbsp;<span class="op" id="6182459">:=</span>&nbsp;<span class="ident" id="6182462">w</span><span class="op" id="6182463">.</span><span class="ident" id="6182464">w</span><span class="op" id="6182465">.</span><span class="ident" id="6182466">Write</span><span class="op" id="6182471">(</span><span class="ident" id="6182472">nil</span><span class="op" id="6182475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182478">return</span>&nbsp;<span class="ident" id="6182485">err</span><br>
<span class="lineno"></span><span class="op" id="6182489">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6182492">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6182571">func</span>&nbsp;<span class="op" id="6182576">(</span><span class="ident" id="6182577">w</span>&nbsp;<span class="op" id="6182579">*</span><span class="ident" id="6182580">Writer</span><span class="op" id="6182586">)</span>&nbsp;<span class="ident" id="6182588">WriteAll</span><span class="op" id="6182596">(</span><span class="ident" id="6182597">records</span>&nbsp;<span class="op" id="6182605">[</span><span class="op" id="6182606">]</span><span class="op" id="6182607">[</span><span class="op" id="6182608">]</span><span class="builtintype" id="6182609">string</span><span class="op" id="6182615">)</span>&nbsp;<span class="op" id="6182617">(</span><span class="ident" id="6182618">err</span>&nbsp;<span class="builtintype" id="6182622">error</span><span class="op" id="6182627">)</span>&nbsp;<span class="op" id="6182629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182632">for</span>&nbsp;<span class="ident" id="6182636">_</span><span class="op" id="6182637">,</span>&nbsp;<span class="ident" id="6182639">record</span>&nbsp;<span class="op" id="6182646">:=</span>&nbsp;<span class="keyword" id="6182649">range</span>&nbsp;<span class="ident" id="6182655">records</span>&nbsp;<span class="op" id="6182663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182667">err</span>&nbsp;<span class="op" id="6182671">=</span>&nbsp;<span class="ident" id="6182673">w</span><span class="op" id="6182674">.</span><span class="ident" id="6182675">Write</span><span class="op" id="6182680">(</span><span class="ident" id="6182681">record</span><span class="op" id="6182687">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182691">if</span>&nbsp;<span class="ident" id="6182694">err</span>&nbsp;<span class="op" id="6182698">!=</span>&nbsp;<span class="ident" id="6182701">nil</span>&nbsp;<span class="op" id="6182705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182710">return</span>&nbsp;<span class="ident" id="6182717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182729">return</span>&nbsp;<span class="ident" id="6182736">w</span><span class="op" id="6182737">.</span><span class="ident" id="6182738">w</span><span class="op" id="6182739">.</span><span class="ident" id="6182740">Flush</span><span class="op" id="6182745">(</span><span class="op" id="6182746">)</span><br>
<span class="lineno">115</span><span class="op" id="6182748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182751">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6182825">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6182885">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6182948">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6183021">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6183097">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6183170">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6183242">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6183311">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6183366">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6183441">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6183481">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6183536">func</span>&nbsp;<span class="op" id="6183541">(</span><span class="ident" id="6183542">w</span>&nbsp;<span class="op" id="6183544">*</span><span class="ident" id="6183545">Writer</span><span class="op" id="6183551">)</span>&nbsp;<span class="ident" id="6183553">fieldNeedsQuotes</span><span class="op" id="6183569">(</span><span class="ident" id="6183570">field</span>&nbsp;<span class="builtintype" id="6183576">string</span><span class="op" id="6183582">)</span>&nbsp;<span class="builtintype" id="6183584">bool</span>&nbsp;<span class="op" id="6183589">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183592">if</span>&nbsp;<span class="ident" id="6183595">field</span>&nbsp;<span class="op" id="6183601">==</span>&nbsp;<span class="string" id="6183604">&#34;&#34;</span>&nbsp;<span class="op" id="6183607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183611">return</span>&nbsp;<span class="builtintype" id="6183618">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183628">if</span>&nbsp;<span class="ident" id="6183631">field</span>&nbsp;<span class="op" id="6183637">==</span>&nbsp;<span class="string" id="6183640">`\.`</span>&nbsp;<span class="op" id="6183645">||</span>&nbsp;<span class="ident" id="6183648">strings</span><span class="op" id="6183655">.</span><span class="ident" id="6183656">IndexRune</span><span class="op" id="6183665">(</span><span class="ident" id="6183666">field</span><span class="op" id="6183671">,</span>&nbsp;<span class="ident" id="6183673">w</span><span class="op" id="6183674">.</span><span class="ident" id="6183675">Comma</span><span class="op" id="6183680">)</span>&nbsp;<span class="op" id="6183682">&gt;=</span>&nbsp;<span class="num" id="6183685">0</span>&nbsp;<span class="op" id="6183687">||</span>&nbsp;<span class="ident" id="6183690">strings</span><span class="op" id="6183697">.</span><span class="ident" id="6183698">IndexAny</span><span class="op" id="6183706">(</span><span class="ident" id="6183707">field</span><span class="op" id="6183712">,</span>&nbsp;<span class="string" id="6183714">&#34;\&#34;\r\n&#34;</span><span class="op" id="6183722">)</span>&nbsp;<span class="op" id="6183724">&gt;=</span>&nbsp;<span class="num" id="6183727">0</span>&nbsp;<span class="op" id="6183729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183733">return</span>&nbsp;<span class="builtintype" id="6183740">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183750">r1</span><span class="op" id="6183752">,</span>&nbsp;<span class="ident" id="6183754">_</span>&nbsp;<span class="op" id="6183756">:=</span>&nbsp;<span class="ident" id="6183759">utf8</span><span class="op" id="6183763">.</span><span class="ident" id="6183764">DecodeRuneInString</span><span class="op" id="6183782">(</span><span class="ident" id="6183783">field</span><span class="op" id="6183788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183791">return</span>&nbsp;<span class="ident" id="6183798">unicode</span><span class="op" id="6183805">.</span><span class="ident" id="6183806">IsSpace</span><span class="op" id="6183813">(</span><span class="ident" id="6183814">r1</span><span class="op" id="6183816">)</span><br>
<span class="lineno"></span><span class="op" id="6183818">}</span>
</div>
</body>
</html>
