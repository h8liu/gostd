<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6260326">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6260381">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6260435">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6260486">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="6260552">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6260573">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="6260643">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="6260659">//</span><br>
<span class="lineno"></span><span class="comment" id="6260662">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="6260729">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6260788">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6260852">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="6260892">package</span>&nbsp;<span class="ident" id="6260900">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6260905">import</span>&nbsp;<span class="op" id="6260912">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260915">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260924">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260931">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260937">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260944">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260956">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260962">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260973">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6260990">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261000">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261011">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261022">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="6261032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6261035">var</span>&nbsp;<span class="ident" id="6261039">trailingPort</span>&nbsp;<span class="op" id="6261052">=</span>&nbsp;<span class="ident" id="6261054">regexp</span><span class="op" id="6261060">.</span><span class="ident" id="6261061">MustCompile</span><span class="op" id="6261072">(</span><span class="string" id="6261073">`:([0-9]+)$`</span><span class="op" id="6261085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6261088">var</span>&nbsp;<span class="ident" id="6261092">osDefaultInheritEnv</span>&nbsp;<span class="op" id="6261112">=</span>&nbsp;<span class="keyword" id="6261114">map</span><span class="op" id="6261117">[</span><span class="builtintype" id="6261118">string</span><span class="op" id="6261124">]</span><span class="op" id="6261125">[</span><span class="op" id="6261126">]</span><span class="builtintype" id="6261127">string</span><span class="op" id="6261133">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261136">&#34;darwin&#34;</span><span class="op" id="6261144">:</span>&nbsp;&nbsp;<span class="op" id="6261147">{</span><span class="string" id="6261148">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="6261167">}</span><span class="op" id="6261168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261171">&#34;freebsd&#34;</span><span class="op" id="6261180">:</span>&nbsp;<span class="op" id="6261182">{</span><span class="string" id="6261183">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261200">}</span><span class="op" id="6261201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261204">&#34;hpux&#34;</span><span class="op" id="6261210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6261215">{</span><span class="string" id="6261216">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261233">,</span>&nbsp;<span class="string" id="6261235">&#34;SHLIB_PATH&#34;</span><span class="op" id="6261247">}</span><span class="op" id="6261248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261251">&#34;irix&#34;</span><span class="op" id="6261257">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6261262">{</span><span class="string" id="6261263">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261280">,</span>&nbsp;<span class="string" id="6261282">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="6261302">,</span>&nbsp;<span class="string" id="6261304">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="6261323">}</span><span class="op" id="6261324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261327">&#34;linux&#34;</span><span class="op" id="6261334">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6261338">{</span><span class="string" id="6261339">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261356">}</span><span class="op" id="6261357">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261360">&#34;openbsd&#34;</span><span class="op" id="6261369">:</span>&nbsp;<span class="op" id="6261371">{</span><span class="string" id="6261372">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261389">}</span><span class="op" id="6261390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261393">&#34;solaris&#34;</span><span class="op" id="6261402">:</span>&nbsp;<span class="op" id="6261404">{</span><span class="string" id="6261405">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6261422">,</span>&nbsp;<span class="string" id="6261424">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="6261444">,</span>&nbsp;<span class="string" id="6261446">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="6261466">}</span><span class="op" id="6261467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6261470">&#34;windows&#34;</span><span class="op" id="6261479">:</span>&nbsp;<span class="op" id="6261481">{</span><span class="string" id="6261482">&#34;SystemRoot&#34;</span><span class="op" id="6261494">,</span>&nbsp;<span class="string" id="6261496">&#34;COMSPEC&#34;</span><span class="op" id="6261505">,</span>&nbsp;<span class="string" id="6261507">&#34;PATHEXT&#34;</span><span class="op" id="6261516">,</span>&nbsp;<span class="string" id="6261518">&#34;WINDIR&#34;</span><span class="op" id="6261526">}</span><span class="op" id="6261527">,</span><br>
<span class="lineno"></span><span class="op" id="6261529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6261532">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="6261602">type</span>&nbsp;<span class="ident" id="6261607">Handler</span>&nbsp;<span class="keyword" id="6261615">struct</span>&nbsp;<span class="op" id="6261622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261625">Path</span>&nbsp;<span class="builtintype" id="6261630">string</span>&nbsp;<span class="comment" id="6261637">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261668">Root</span>&nbsp;<span class="builtintype" id="6261673">string</span>&nbsp;<span class="comment" id="6261680">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261729">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261787">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261844">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6261899">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261922">Dir</span>&nbsp;<span class="builtintype" id="6261926">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261935">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6261946">[</span><span class="op" id="6261947">]</span><span class="builtintype" id="6261948">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6261958">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262021">InheritEnv</span>&nbsp;<span class="op" id="6262032">[</span><span class="op" id="6262033">]</span><span class="builtintype" id="6262034">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6262044">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262101">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6262112">*</span><span class="ident" id="6262113">log</span><span class="op" id="6262116">.</span><span class="ident" id="6262117">Logger</span>&nbsp;<span class="comment" id="6262124">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262176">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6262187">[</span><span class="op" id="6262188">]</span><span class="builtintype" id="6262189">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6262199">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262248">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262309">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262367">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262427">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262483">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262509">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262513">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262578">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262632">PathLocationHandler</span>&nbsp;<span class="ident" id="6262652">http</span><span class="op" id="6262656">.</span><span class="ident" id="6262657">Handler</span><br>
<span class="lineno">70</span><span class="op" id="6262665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6262668">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="6262737">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="6262794">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="6262813">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6262825">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="6262875">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="6262883">func</span>&nbsp;<span class="ident" id="6262888">removeLeadingDuplicates</span><span class="op" id="6262911">(</span><span class="ident" id="6262912">env</span>&nbsp;<span class="op" id="6262916">[</span><span class="op" id="6262917">]</span><span class="builtintype" id="6262918">string</span><span class="op" id="6262924">)</span>&nbsp;<span class="op" id="6262926">(</span><span class="ident" id="6262927">ret</span>&nbsp;<span class="op" id="6262931">[</span><span class="op" id="6262932">]</span><span class="builtintype" id="6262933">string</span><span class="op" id="6262939">)</span>&nbsp;<span class="op" id="6262941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262944">n</span>&nbsp;<span class="op" id="6262946">:=</span>&nbsp;<span class="builtinfunc" id="6262949">len</span><span class="op" id="6262952">(</span><span class="ident" id="6262953">env</span><span class="op" id="6262956">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262959">for</span>&nbsp;<span class="ident" id="6262963">i</span>&nbsp;<span class="op" id="6262965">:=</span>&nbsp;<span class="num" id="6262968">0</span><span class="op" id="6262969">;</span>&nbsp;<span class="ident" id="6262971">i</span>&nbsp;<span class="op" id="6262973">&lt;</span>&nbsp;<span class="ident" id="6262975">n</span><span class="op" id="6262976">;</span>&nbsp;<span class="ident" id="6262978">i</span><span class="op" id="6262979">++</span>&nbsp;<span class="op" id="6262982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262986">e</span>&nbsp;<span class="op" id="6262988">:=</span>&nbsp;<span class="ident" id="6262991">env</span><span class="op" id="6262994">[</span><span class="ident" id="6262995">i</span><span class="op" id="6262996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263000">s</span>&nbsp;<span class="op" id="6263002">:=</span>&nbsp;<span class="ident" id="6263005">strings</span><span class="op" id="6263012">.</span><span class="ident" id="6263013">SplitN</span><span class="op" id="6263019">(</span><span class="ident" id="6263020">e</span><span class="op" id="6263021">,</span>&nbsp;<span class="string" id="6263023">&#34;=&#34;</span><span class="op" id="6263026">,</span>&nbsp;<span class="num" id="6263028">2</span><span class="op" id="6263029">)</span><span class="op" id="6263030">[</span><span class="num" id="6263031">0</span><span class="op" id="6263032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263036">found</span>&nbsp;<span class="op" id="6263042">:=</span>&nbsp;<span class="builtintype" id="6263045">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263053">for</span>&nbsp;<span class="ident" id="6263057">j</span>&nbsp;<span class="op" id="6263059">:=</span>&nbsp;<span class="ident" id="6263062">i</span>&nbsp;<span class="op" id="6263064">+</span>&nbsp;<span class="num" id="6263066">1</span><span class="op" id="6263067">;</span>&nbsp;<span class="ident" id="6263069">j</span>&nbsp;<span class="op" id="6263071">&lt;</span>&nbsp;<span class="ident" id="6263073">n</span><span class="op" id="6263074">;</span>&nbsp;<span class="ident" id="6263076">j</span><span class="op" id="6263077">++</span>&nbsp;<span class="op" id="6263080">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263085">if</span>&nbsp;<span class="ident" id="6263088">s</span>&nbsp;<span class="op" id="6263090">==</span>&nbsp;<span class="ident" id="6263093">strings</span><span class="op" id="6263100">.</span><span class="ident" id="6263101">SplitN</span><span class="op" id="6263107">(</span><span class="ident" id="6263108">env</span><span class="op" id="6263111">[</span><span class="ident" id="6263112">j</span><span class="op" id="6263113">]</span><span class="op" id="6263114">,</span>&nbsp;<span class="string" id="6263116">&#34;=&#34;</span><span class="op" id="6263119">,</span>&nbsp;<span class="num" id="6263121">2</span><span class="op" id="6263122">)</span><span class="op" id="6263123">[</span><span class="num" id="6263124">0</span><span class="op" id="6263125">]</span>&nbsp;<span class="op" id="6263127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263133">found</span>&nbsp;<span class="op" id="6263139">=</span>&nbsp;<span class="builtintype" id="6263141">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263150">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263163">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263167">if</span>&nbsp;<span class="op" id="6263170">!</span><span class="ident" id="6263171">found</span>&nbsp;<span class="op" id="6263177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263182">ret</span>&nbsp;<span class="op" id="6263186">=</span>&nbsp;<span class="builtinfunc" id="6263188">append</span><span class="op" id="6263194">(</span><span class="ident" id="6263195">ret</span><span class="op" id="6263198">,</span>&nbsp;<span class="ident" id="6263200">e</span><span class="op" id="6263201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263211">return</span><br>
<span class="lineno">95</span><span class="op" id="6263218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6263221">func</span>&nbsp;<span class="op" id="6263226">(</span><span class="ident" id="6263227">h</span>&nbsp;<span class="op" id="6263229">*</span><span class="ident" id="6263230">Handler</span><span class="op" id="6263237">)</span>&nbsp;<span class="ident" id="6263239">ServeHTTP</span><span class="op" id="6263248">(</span><span class="ident" id="6263249">rw</span>&nbsp;<span class="ident" id="6263252">http</span><span class="op" id="6263256">.</span><span class="ident" id="6263257">ResponseWriter</span><span class="op" id="6263271">,</span>&nbsp;<span class="ident" id="6263273">req</span>&nbsp;<span class="op" id="6263277">*</span><span class="ident" id="6263278">http</span><span class="op" id="6263282">.</span><span class="ident" id="6263283">Request</span><span class="op" id="6263290">)</span>&nbsp;<span class="op" id="6263292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263295">root</span>&nbsp;<span class="op" id="6263300">:=</span>&nbsp;<span class="ident" id="6263303">h</span><span class="op" id="6263304">.</span><span class="ident" id="6263305">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263311">if</span>&nbsp;<span class="ident" id="6263314">root</span>&nbsp;<span class="op" id="6263319">==</span>&nbsp;<span class="string" id="6263322">&#34;&#34;</span>&nbsp;<span class="op" id="6263325">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263329">root</span>&nbsp;<span class="op" id="6263334">=</span>&nbsp;<span class="string" id="6263336">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263345">if</span>&nbsp;<span class="builtinfunc" id="6263348">len</span><span class="op" id="6263351">(</span><span class="ident" id="6263352">req</span><span class="op" id="6263355">.</span><span class="ident" id="6263356">TransferEncoding</span><span class="op" id="6263372">)</span>&nbsp;<span class="op" id="6263374">&gt;</span>&nbsp;<span class="num" id="6263376">0</span>&nbsp;<span class="op" id="6263378">&amp;&amp;</span>&nbsp;<span class="ident" id="6263381">req</span><span class="op" id="6263384">.</span><span class="ident" id="6263385">TransferEncoding</span><span class="op" id="6263401">[</span><span class="num" id="6263402">0</span><span class="op" id="6263403">]</span>&nbsp;<span class="op" id="6263405">==</span>&nbsp;<span class="string" id="6263408">&#34;chunked&#34;</span>&nbsp;<span class="op" id="6263418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263422">rw</span><span class="op" id="6263424">.</span><span class="ident" id="6263425">WriteHeader</span><span class="op" id="6263436">(</span><span class="ident" id="6263437">http</span><span class="op" id="6263441">.</span><span class="ident" id="6263442">StatusBadRequest</span><span class="op" id="6263458">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263462">rw</span><span class="op" id="6263464">.</span><span class="ident" id="6263465">Write</span><span class="op" id="6263470">(</span><span class="op" id="6263471">[</span><span class="op" id="6263472">]</span><span class="builtintype" id="6263473">byte</span><span class="op" id="6263477">(</span><span class="string" id="6263478">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="6263528">)</span><span class="op" id="6263529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263533">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263545">pathInfo</span>&nbsp;<span class="op" id="6263554">:=</span>&nbsp;<span class="ident" id="6263557">req</span><span class="op" id="6263560">.</span><span class="ident" id="6263561">URL</span><span class="op" id="6263564">.</span><span class="ident" id="6263565">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263571">if</span>&nbsp;<span class="ident" id="6263574">root</span>&nbsp;<span class="op" id="6263579">!=</span>&nbsp;<span class="string" id="6263582">&#34;/&#34;</span>&nbsp;<span class="op" id="6263586">&amp;&amp;</span>&nbsp;<span class="ident" id="6263589">strings</span><span class="op" id="6263596">.</span><span class="ident" id="6263597">HasPrefix</span><span class="op" id="6263606">(</span><span class="ident" id="6263607">pathInfo</span><span class="op" id="6263615">,</span>&nbsp;<span class="ident" id="6263617">root</span><span class="op" id="6263621">)</span>&nbsp;<span class="op" id="6263623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263627">pathInfo</span>&nbsp;<span class="op" id="6263636">=</span>&nbsp;<span class="ident" id="6263638">pathInfo</span><span class="op" id="6263646">[</span><span class="builtinfunc" id="6263647">len</span><span class="op" id="6263650">(</span><span class="ident" id="6263651">root</span><span class="op" id="6263655">)</span><span class="op" id="6263656">:</span><span class="op" id="6263657">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263664">port</span>&nbsp;<span class="op" id="6263669">:=</span>&nbsp;<span class="string" id="6263672">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263678">if</span>&nbsp;<span class="ident" id="6263681">matches</span>&nbsp;<span class="op" id="6263689">:=</span>&nbsp;<span class="ident" id="6263692">trailingPort</span><span class="op" id="6263704">.</span><span class="ident" id="6263705">FindStringSubmatch</span><span class="op" id="6263723">(</span><span class="ident" id="6263724">req</span><span class="op" id="6263727">.</span><span class="ident" id="6263728">Host</span><span class="op" id="6263732">)</span><span class="op" id="6263733">;</span>&nbsp;<span class="builtinfunc" id="6263735">len</span><span class="op" id="6263738">(</span><span class="ident" id="6263739">matches</span><span class="op" id="6263746">)</span>&nbsp;<span class="op" id="6263748">!=</span>&nbsp;<span class="num" id="6263751">0</span>&nbsp;<span class="op" id="6263753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263757">port</span>&nbsp;<span class="op" id="6263762">=</span>&nbsp;<span class="ident" id="6263764">matches</span><span class="op" id="6263771">[</span><span class="num" id="6263772">1</span><span class="op" id="6263773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263780">env</span>&nbsp;<span class="op" id="6263784">:=</span>&nbsp;<span class="op" id="6263787">[</span><span class="op" id="6263788">]</span><span class="builtintype" id="6263789">string</span><span class="op" id="6263795">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263799">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="6263819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263823">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="6263838">+</span>&nbsp;<span class="ident" id="6263840">req</span><span class="op" id="6263843">.</span><span class="ident" id="6263844">Host</span><span class="op" id="6263848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263852">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="6263878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263882">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="6263895">+</span>&nbsp;<span class="ident" id="6263897">req</span><span class="op" id="6263900">.</span><span class="ident" id="6263901">Host</span><span class="op" id="6263905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263909">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="6263936">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263940">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="6263958">+</span>&nbsp;<span class="ident" id="6263960">req</span><span class="op" id="6263963">.</span><span class="ident" id="6263964">Method</span><span class="op" id="6263970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6263974">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="6263990">+</span>&nbsp;<span class="ident" id="6263992">req</span><span class="op" id="6263995">.</span><span class="ident" id="6263996">URL</span><span class="op" id="6263999">.</span><span class="ident" id="6264000">RawQuery</span><span class="op" id="6264008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264012">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="6264027">+</span>&nbsp;<span class="ident" id="6264029">req</span><span class="op" id="6264032">.</span><span class="ident" id="6264033">URL</span><span class="op" id="6264036">.</span><span class="ident" id="6264037">RequestURI</span><span class="op" id="6264047">(</span><span class="op" id="6264048">)</span><span class="op" id="6264049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264053">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="6264066">+</span>&nbsp;<span class="ident" id="6264068">pathInfo</span><span class="op" id="6264076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264080">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="6264095">+</span>&nbsp;<span class="ident" id="6264097">root</span><span class="op" id="6264101">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264105">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="6264124">+</span>&nbsp;<span class="ident" id="6264126">h</span><span class="op" id="6264127">.</span><span class="ident" id="6264128">Path</span><span class="op" id="6264132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264136">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="6264151">+</span>&nbsp;<span class="ident" id="6264153">req</span><span class="op" id="6264156">.</span><span class="ident" id="6264157">RemoteAddr</span><span class="op" id="6264167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264171">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="6264186">+</span>&nbsp;<span class="ident" id="6264188">req</span><span class="op" id="6264191">.</span><span class="ident" id="6264192">RemoteAddr</span><span class="op" id="6264202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6264206">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="6264221">+</span>&nbsp;<span class="ident" id="6264223">port</span><span class="op" id="6264227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264230">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264234">if</span>&nbsp;<span class="ident" id="6264237">req</span><span class="op" id="6264240">.</span><span class="ident" id="6264241">TLS</span>&nbsp;<span class="op" id="6264245">!=</span>&nbsp;<span class="ident" id="6264248">nil</span>&nbsp;<span class="op" id="6264252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264256">env</span>&nbsp;<span class="op" id="6264260">=</span>&nbsp;<span class="builtinfunc" id="6264262">append</span><span class="op" id="6264268">(</span><span class="ident" id="6264269">env</span><span class="op" id="6264272">,</span>&nbsp;<span class="string" id="6264274">&#34;HTTPS=on&#34;</span><span class="op" id="6264284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264291">for</span>&nbsp;<span class="ident" id="6264295">k</span><span class="op" id="6264296">,</span>&nbsp;<span class="ident" id="6264298">v</span>&nbsp;<span class="op" id="6264300">:=</span>&nbsp;<span class="keyword" id="6264303">range</span>&nbsp;<span class="ident" id="6264309">req</span><span class="op" id="6264312">.</span><span class="ident" id="6264313">Header</span>&nbsp;<span class="op" id="6264320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264324">k</span>&nbsp;<span class="op" id="6264326">=</span>&nbsp;<span class="ident" id="6264328">strings</span><span class="op" id="6264335">.</span><span class="ident" id="6264336">Map</span><span class="op" id="6264339">(</span><span class="ident" id="6264340">upperCaseAndUnderscore</span><span class="op" id="6264362">,</span>&nbsp;<span class="ident" id="6264364">k</span><span class="op" id="6264365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264369">joinStr</span>&nbsp;<span class="op" id="6264377">:=</span>&nbsp;<span class="string" id="6264380">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264387">if</span>&nbsp;<span class="ident" id="6264390">k</span>&nbsp;<span class="op" id="6264392">==</span>&nbsp;<span class="string" id="6264395">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="6264404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264409">joinStr</span>&nbsp;<span class="op" id="6264417">=</span>&nbsp;<span class="string" id="6264419">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264430">env</span>&nbsp;<span class="op" id="6264434">=</span>&nbsp;<span class="builtinfunc" id="6264436">append</span><span class="op" id="6264442">(</span><span class="ident" id="6264443">env</span><span class="op" id="6264446">,</span>&nbsp;<span class="string" id="6264448">&#34;HTTP_&#34;</span><span class="op" id="6264455">+</span><span class="ident" id="6264456">k</span><span class="op" id="6264457">+</span><span class="string" id="6264458">&#34;=&#34;</span><span class="op" id="6264461">+</span><span class="ident" id="6264462">strings</span><span class="op" id="6264469">.</span><span class="ident" id="6264470">Join</span><span class="op" id="6264474">(</span><span class="ident" id="6264475">v</span><span class="op" id="6264476">,</span>&nbsp;<span class="ident" id="6264478">joinStr</span><span class="op" id="6264485">)</span><span class="op" id="6264486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264493">if</span>&nbsp;<span class="ident" id="6264496">req</span><span class="op" id="6264499">.</span><span class="ident" id="6264500">ContentLength</span>&nbsp;<span class="op" id="6264514">&gt;</span>&nbsp;<span class="num" id="6264516">0</span>&nbsp;<span class="op" id="6264518">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264522">env</span>&nbsp;<span class="op" id="6264526">=</span>&nbsp;<span class="builtinfunc" id="6264528">append</span><span class="op" id="6264534">(</span><span class="ident" id="6264535">env</span><span class="op" id="6264538">,</span>&nbsp;<span class="ident" id="6264540">fmt</span><span class="op" id="6264543">.</span><span class="ident" id="6264544">Sprintf</span><span class="op" id="6264551">(</span><span class="string" id="6264552">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="6264571">,</span>&nbsp;<span class="ident" id="6264573">req</span><span class="op" id="6264576">.</span><span class="ident" id="6264577">ContentLength</span><span class="op" id="6264590">)</span><span class="op" id="6264591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264597">if</span>&nbsp;<span class="ident" id="6264600">ctype</span>&nbsp;<span class="op" id="6264606">:=</span>&nbsp;<span class="ident" id="6264609">req</span><span class="op" id="6264612">.</span><span class="ident" id="6264613">Header</span><span class="op" id="6264619">.</span><span class="ident" id="6264620">Get</span><span class="op" id="6264623">(</span><span class="string" id="6264624">&#34;Content-Type&#34;</span><span class="op" id="6264638">)</span><span class="op" id="6264639">;</span>&nbsp;<span class="ident" id="6264641">ctype</span>&nbsp;<span class="op" id="6264647">!=</span>&nbsp;<span class="string" id="6264650">&#34;&#34;</span>&nbsp;<span class="op" id="6264653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264657">env</span>&nbsp;<span class="op" id="6264661">=</span>&nbsp;<span class="builtinfunc" id="6264663">append</span><span class="op" id="6264669">(</span><span class="ident" id="6264670">env</span><span class="op" id="6264673">,</span>&nbsp;<span class="string" id="6264675">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="6264690">+</span><span class="ident" id="6264691">ctype</span><span class="op" id="6264696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264699">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264703">if</span>&nbsp;<span class="ident" id="6264706">h</span><span class="op" id="6264707">.</span><span class="ident" id="6264708">Env</span>&nbsp;<span class="op" id="6264712">!=</span>&nbsp;<span class="ident" id="6264715">nil</span>&nbsp;<span class="op" id="6264719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264723">env</span>&nbsp;<span class="op" id="6264727">=</span>&nbsp;<span class="builtinfunc" id="6264729">append</span><span class="op" id="6264735">(</span><span class="ident" id="6264736">env</span><span class="op" id="6264739">,</span>&nbsp;<span class="ident" id="6264741">h</span><span class="op" id="6264742">.</span><span class="ident" id="6264743">Env</span><span class="op" id="6264746">...</span><span class="op" id="6264749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264756">envPath</span>&nbsp;<span class="op" id="6264764">:=</span>&nbsp;<span class="ident" id="6264767">os</span><span class="op" id="6264769">.</span><span class="ident" id="6264770">Getenv</span><span class="op" id="6264776">(</span><span class="string" id="6264777">&#34;PATH&#34;</span><span class="op" id="6264783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264786">if</span>&nbsp;<span class="ident" id="6264789">envPath</span>&nbsp;<span class="op" id="6264797">==</span>&nbsp;<span class="string" id="6264800">&#34;&#34;</span>&nbsp;<span class="op" id="6264803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264807">envPath</span>&nbsp;<span class="op" id="6264815">=</span>&nbsp;<span class="string" id="6264817">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264870">env</span>&nbsp;<span class="op" id="6264874">=</span>&nbsp;<span class="builtinfunc" id="6264876">append</span><span class="op" id="6264882">(</span><span class="ident" id="6264883">env</span><span class="op" id="6264886">,</span>&nbsp;<span class="string" id="6264888">&#34;PATH=&#34;</span><span class="op" id="6264895">+</span><span class="ident" id="6264896">envPath</span><span class="op" id="6264903">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264907">for</span>&nbsp;<span class="ident" id="6264911">_</span><span class="op" id="6264912">,</span>&nbsp;<span class="ident" id="6264914">e</span>&nbsp;<span class="op" id="6264916">:=</span>&nbsp;<span class="keyword" id="6264919">range</span>&nbsp;<span class="ident" id="6264925">h</span><span class="op" id="6264926">.</span><span class="ident" id="6264927">InheritEnv</span>&nbsp;<span class="op" id="6264938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264942">if</span>&nbsp;<span class="ident" id="6264945">v</span>&nbsp;<span class="op" id="6264947">:=</span>&nbsp;<span class="ident" id="6264950">os</span><span class="op" id="6264952">.</span><span class="ident" id="6264953">Getenv</span><span class="op" id="6264959">(</span><span class="ident" id="6264960">e</span><span class="op" id="6264961">)</span><span class="op" id="6264962">;</span>&nbsp;<span class="ident" id="6264964">v</span>&nbsp;<span class="op" id="6264966">!=</span>&nbsp;<span class="string" id="6264969">&#34;&#34;</span>&nbsp;<span class="op" id="6264972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264977">env</span>&nbsp;<span class="op" id="6264981">=</span>&nbsp;<span class="builtinfunc" id="6264983">append</span><span class="op" id="6264989">(</span><span class="ident" id="6264990">env</span><span class="op" id="6264993">,</span>&nbsp;<span class="ident" id="6264995">e</span><span class="op" id="6264996">+</span><span class="string" id="6264997">&#34;=&#34;</span><span class="op" id="6265000">+</span><span class="ident" id="6265001">v</span><span class="op" id="6265002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265006">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265013">for</span>&nbsp;<span class="ident" id="6265017">_</span><span class="op" id="6265018">,</span>&nbsp;<span class="ident" id="6265020">e</span>&nbsp;<span class="op" id="6265022">:=</span>&nbsp;<span class="keyword" id="6265025">range</span>&nbsp;<span class="ident" id="6265031">osDefaultInheritEnv</span><span class="op" id="6265050">[</span><span class="ident" id="6265051">runtime</span><span class="op" id="6265058">.</span><span class="ident" id="6265059">GOOS</span><span class="op" id="6265063">]</span>&nbsp;<span class="op" id="6265065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265069">if</span>&nbsp;<span class="ident" id="6265072">v</span>&nbsp;<span class="op" id="6265074">:=</span>&nbsp;<span class="ident" id="6265077">os</span><span class="op" id="6265079">.</span><span class="ident" id="6265080">Getenv</span><span class="op" id="6265086">(</span><span class="ident" id="6265087">e</span><span class="op" id="6265088">)</span><span class="op" id="6265089">;</span>&nbsp;<span class="ident" id="6265091">v</span>&nbsp;<span class="op" id="6265093">!=</span>&nbsp;<span class="string" id="6265096">&#34;&#34;</span>&nbsp;<span class="op" id="6265099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265104">env</span>&nbsp;<span class="op" id="6265108">=</span>&nbsp;<span class="builtinfunc" id="6265110">append</span><span class="op" id="6265116">(</span><span class="ident" id="6265117">env</span><span class="op" id="6265120">,</span>&nbsp;<span class="ident" id="6265122">e</span><span class="op" id="6265123">+</span><span class="string" id="6265124">&#34;=&#34;</span><span class="op" id="6265127">+</span><span class="ident" id="6265128">v</span><span class="op" id="6265129">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265140">env</span>&nbsp;<span class="op" id="6265144">=</span>&nbsp;<span class="ident" id="6265146">removeLeadingDuplicates</span><span class="op" id="6265169">(</span><span class="ident" id="6265170">env</span><span class="op" id="6265173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265177">var</span>&nbsp;<span class="ident" id="6265181">cwd</span><span class="op" id="6265184">,</span>&nbsp;<span class="ident" id="6265186">path</span>&nbsp;<span class="builtintype" id="6265191">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265199">if</span>&nbsp;<span class="ident" id="6265202">h</span><span class="op" id="6265203">.</span><span class="ident" id="6265204">Dir</span>&nbsp;<span class="op" id="6265208">!=</span>&nbsp;<span class="string" id="6265211">&#34;&#34;</span>&nbsp;<span class="op" id="6265214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265218">path</span>&nbsp;<span class="op" id="6265223">=</span>&nbsp;<span class="ident" id="6265225">h</span><span class="op" id="6265226">.</span><span class="ident" id="6265227">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265234">cwd</span>&nbsp;<span class="op" id="6265238">=</span>&nbsp;<span class="ident" id="6265240">h</span><span class="op" id="6265241">.</span><span class="ident" id="6265242">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265247">}</span>&nbsp;<span class="keyword" id="6265249">else</span>&nbsp;<span class="op" id="6265254">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265258">cwd</span><span class="op" id="6265261">,</span>&nbsp;<span class="ident" id="6265263">path</span>&nbsp;<span class="op" id="6265268">=</span>&nbsp;<span class="ident" id="6265270">filepath</span><span class="op" id="6265278">.</span><span class="ident" id="6265279">Split</span><span class="op" id="6265284">(</span><span class="ident" id="6265285">h</span><span class="op" id="6265286">.</span><span class="ident" id="6265287">Path</span><span class="op" id="6265291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265297">if</span>&nbsp;<span class="ident" id="6265300">cwd</span>&nbsp;<span class="op" id="6265304">==</span>&nbsp;<span class="string" id="6265307">&#34;&#34;</span>&nbsp;<span class="op" id="6265310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265314">cwd</span>&nbsp;<span class="op" id="6265318">=</span>&nbsp;<span class="string" id="6265320">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265325">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265329">internalError</span>&nbsp;<span class="op" id="6265343">:=</span>&nbsp;<span class="keyword" id="6265346">func</span><span class="op" id="6265350">(</span><span class="ident" id="6265351">err</span>&nbsp;<span class="builtintype" id="6265355">error</span><span class="op" id="6265360">)</span>&nbsp;<span class="op" id="6265362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265366">rw</span><span class="op" id="6265368">.</span><span class="ident" id="6265369">WriteHeader</span><span class="op" id="6265380">(</span><span class="ident" id="6265381">http</span><span class="op" id="6265385">.</span><span class="ident" id="6265386">StatusInternalServerError</span><span class="op" id="6265411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265415">h</span><span class="op" id="6265416">.</span><span class="ident" id="6265417">printf</span><span class="op" id="6265423">(</span><span class="string" id="6265424">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6265439">,</span>&nbsp;<span class="ident" id="6265441">err</span><span class="op" id="6265444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265447">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265451">cmd</span>&nbsp;<span class="op" id="6265455">:=</span>&nbsp;<span class="op" id="6265458">&amp;</span><span class="ident" id="6265459">exec</span><span class="op" id="6265463">.</span><span class="ident" id="6265464">Cmd</span><span class="op" id="6265467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265471">Path</span><span class="op" id="6265475">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6265479">path</span><span class="op" id="6265483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265487">Args</span><span class="op" id="6265491">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6265495">append</span><span class="op" id="6265501">(</span><span class="op" id="6265502">[</span><span class="op" id="6265503">]</span><span class="builtintype" id="6265504">string</span><span class="op" id="6265510">{</span><span class="ident" id="6265511">h</span><span class="op" id="6265512">.</span><span class="ident" id="6265513">Path</span><span class="op" id="6265517">}</span><span class="op" id="6265518">,</span>&nbsp;<span class="ident" id="6265520">h</span><span class="op" id="6265521">.</span><span class="ident" id="6265522">Args</span><span class="op" id="6265526">...</span><span class="op" id="6265529">)</span><span class="op" id="6265530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265534">Dir</span><span class="op" id="6265537">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6265542">cwd</span><span class="op" id="6265545">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265549">Env</span><span class="op" id="6265552">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6265557">env</span><span class="op" id="6265560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265564">Stderr</span><span class="op" id="6265570">:</span>&nbsp;<span class="ident" id="6265572">os</span><span class="op" id="6265574">.</span><span class="ident" id="6265575">Stderr</span><span class="op" id="6265581">,</span>&nbsp;<span class="comment" id="6265583">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265598">if</span>&nbsp;<span class="ident" id="6265601">req</span><span class="op" id="6265604">.</span><span class="ident" id="6265605">ContentLength</span>&nbsp;<span class="op" id="6265619">!=</span>&nbsp;<span class="num" id="6265622">0</span>&nbsp;<span class="op" id="6265624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265628">cmd</span><span class="op" id="6265631">.</span><span class="ident" id="6265632">Stdin</span>&nbsp;<span class="op" id="6265638">=</span>&nbsp;<span class="ident" id="6265640">req</span><span class="op" id="6265643">.</span><span class="ident" id="6265644">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265653">stdoutRead</span><span class="op" id="6265663">,</span>&nbsp;<span class="ident" id="6265665">err</span>&nbsp;<span class="op" id="6265669">:=</span>&nbsp;<span class="ident" id="6265672">cmd</span><span class="op" id="6265675">.</span><span class="ident" id="6265676">StdoutPipe</span><span class="op" id="6265686">(</span><span class="op" id="6265687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265690">if</span>&nbsp;<span class="ident" id="6265693">err</span>&nbsp;<span class="op" id="6265697">!=</span>&nbsp;<span class="ident" id="6265700">nil</span>&nbsp;<span class="op" id="6265704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265708">internalError</span><span class="op" id="6265721">(</span><span class="ident" id="6265722">err</span><span class="op" id="6265725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265729">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265741">err</span>&nbsp;<span class="op" id="6265745">=</span>&nbsp;<span class="ident" id="6265747">cmd</span><span class="op" id="6265750">.</span><span class="ident" id="6265751">Start</span><span class="op" id="6265756">(</span><span class="op" id="6265757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265760">if</span>&nbsp;<span class="ident" id="6265763">err</span>&nbsp;<span class="op" id="6265767">!=</span>&nbsp;<span class="ident" id="6265770">nil</span>&nbsp;<span class="op" id="6265774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265778">internalError</span><span class="op" id="6265791">(</span><span class="ident" id="6265792">err</span><span class="op" id="6265795">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265799">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265810">if</span>&nbsp;<span class="ident" id="6265813">hook</span>&nbsp;<span class="op" id="6265818">:=</span>&nbsp;<span class="ident" id="6265821">testHookStartProcess</span><span class="op" id="6265841">;</span>&nbsp;<span class="ident" id="6265843">hook</span>&nbsp;<span class="op" id="6265848">!=</span>&nbsp;<span class="ident" id="6265851">nil</span>&nbsp;<span class="op" id="6265855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265859">hook</span><span class="op" id="6265863">(</span><span class="ident" id="6265864">cmd</span><span class="op" id="6265867">.</span><span class="ident" id="6265868">Process</span><span class="op" id="6265875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265878">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265881">defer</span>&nbsp;<span class="ident" id="6265887">cmd</span><span class="op" id="6265890">.</span><span class="ident" id="6265891">Wait</span><span class="op" id="6265895">(</span><span class="op" id="6265896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265899">defer</span>&nbsp;<span class="ident" id="6265905">stdoutRead</span><span class="op" id="6265915">.</span><span class="ident" id="6265916">Close</span><span class="op" id="6265921">(</span><span class="op" id="6265922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265926">linebody</span>&nbsp;<span class="op" id="6265935">:=</span>&nbsp;<span class="ident" id="6265938">bufio</span><span class="op" id="6265943">.</span><span class="ident" id="6265944">NewReaderSize</span><span class="op" id="6265957">(</span><span class="ident" id="6265958">stdoutRead</span><span class="op" id="6265968">,</span>&nbsp;<span class="num" id="6265970">1024</span><span class="op" id="6265974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265977">headers</span>&nbsp;<span class="op" id="6265985">:=</span>&nbsp;<span class="builtinfunc" id="6265988">make</span><span class="op" id="6265992">(</span><span class="ident" id="6265993">http</span><span class="op" id="6265997">.</span><span class="ident" id="6265998">Header</span><span class="op" id="6266004">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266007">statusCode</span>&nbsp;<span class="op" id="6266018">:=</span>&nbsp;<span class="num" id="6266021">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266024">headerLines</span>&nbsp;<span class="op" id="6266036">:=</span>&nbsp;<span class="num" id="6266039">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266042">sawBlankLine</span>&nbsp;<span class="op" id="6266055">:=</span>&nbsp;<span class="builtintype" id="6266058">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266065">for</span>&nbsp;<span class="op" id="6266069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266073">line</span><span class="op" id="6266077">,</span>&nbsp;<span class="ident" id="6266079">isPrefix</span><span class="op" id="6266087">,</span>&nbsp;<span class="ident" id="6266089">err</span>&nbsp;<span class="op" id="6266093">:=</span>&nbsp;<span class="ident" id="6266096">linebody</span><span class="op" id="6266104">.</span><span class="ident" id="6266105">ReadLine</span><span class="op" id="6266113">(</span><span class="op" id="6266114">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266118">if</span>&nbsp;<span class="ident" id="6266121">isPrefix</span>&nbsp;<span class="op" id="6266130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266135">rw</span><span class="op" id="6266137">.</span><span class="ident" id="6266138">WriteHeader</span><span class="op" id="6266149">(</span><span class="ident" id="6266150">http</span><span class="op" id="6266154">.</span><span class="ident" id="6266155">StatusInternalServerError</span><span class="op" id="6266180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266185">h</span><span class="op" id="6266186">.</span><span class="ident" id="6266187">printf</span><span class="op" id="6266193">(</span><span class="string" id="6266194">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="6266234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266239">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266248">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266252">if</span>&nbsp;<span class="ident" id="6266255">err</span>&nbsp;<span class="op" id="6266259">==</span>&nbsp;<span class="ident" id="6266262">io</span><span class="op" id="6266264">.</span><span class="ident" id="6266265">EOF</span>&nbsp;<span class="op" id="6266269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266274">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266286">if</span>&nbsp;<span class="ident" id="6266289">err</span>&nbsp;<span class="op" id="6266293">!=</span>&nbsp;<span class="ident" id="6266296">nil</span>&nbsp;<span class="op" id="6266300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266305">rw</span><span class="op" id="6266307">.</span><span class="ident" id="6266308">WriteHeader</span><span class="op" id="6266319">(</span><span class="ident" id="6266320">http</span><span class="op" id="6266324">.</span><span class="ident" id="6266325">StatusInternalServerError</span><span class="op" id="6266350">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266355">h</span><span class="op" id="6266356">.</span><span class="ident" id="6266357">printf</span><span class="op" id="6266363">(</span><span class="string" id="6266364">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="6266396">,</span>&nbsp;<span class="ident" id="6266398">err</span><span class="op" id="6266401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266406">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266419">if</span>&nbsp;<span class="builtinfunc" id="6266422">len</span><span class="op" id="6266425">(</span><span class="ident" id="6266426">line</span><span class="op" id="6266430">)</span>&nbsp;<span class="op" id="6266432">==</span>&nbsp;<span class="num" id="6266435">0</span>&nbsp;<span class="op" id="6266437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266442">sawBlankLine</span>&nbsp;<span class="op" id="6266455">=</span>&nbsp;<span class="builtintype" id="6266457">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266465">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266477">headerLines</span><span class="op" id="6266488">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266493">parts</span>&nbsp;<span class="op" id="6266499">:=</span>&nbsp;<span class="ident" id="6266502">strings</span><span class="op" id="6266509">.</span><span class="ident" id="6266510">SplitN</span><span class="op" id="6266516">(</span><span class="builtintype" id="6266517">string</span><span class="op" id="6266523">(</span><span class="ident" id="6266524">line</span><span class="op" id="6266528">)</span><span class="op" id="6266529">,</span>&nbsp;<span class="string" id="6266531">&#34;:&#34;</span><span class="op" id="6266534">,</span>&nbsp;<span class="num" id="6266536">2</span><span class="op" id="6266537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266541">if</span>&nbsp;<span class="builtinfunc" id="6266544">len</span><span class="op" id="6266547">(</span><span class="ident" id="6266548">parts</span><span class="op" id="6266553">)</span>&nbsp;<span class="op" id="6266555">&lt;</span>&nbsp;<span class="num" id="6266557">2</span>&nbsp;<span class="op" id="6266559">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266564">h</span><span class="op" id="6266565">.</span><span class="ident" id="6266566">printf</span><span class="op" id="6266572">(</span><span class="string" id="6266573">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="6266601">,</span>&nbsp;<span class="builtintype" id="6266603">string</span><span class="op" id="6266609">(</span><span class="ident" id="6266610">line</span><span class="op" id="6266614">)</span><span class="op" id="6266615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266620">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266635">header</span><span class="op" id="6266641">,</span>&nbsp;<span class="ident" id="6266643">val</span>&nbsp;<span class="op" id="6266647">:=</span>&nbsp;<span class="ident" id="6266650">parts</span><span class="op" id="6266655">[</span><span class="num" id="6266656">0</span><span class="op" id="6266657">]</span><span class="op" id="6266658">,</span>&nbsp;<span class="ident" id="6266660">parts</span><span class="op" id="6266665">[</span><span class="num" id="6266666">1</span><span class="op" id="6266667">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266671">header</span>&nbsp;<span class="op" id="6266678">=</span>&nbsp;<span class="ident" id="6266680">strings</span><span class="op" id="6266687">.</span><span class="ident" id="6266688">TrimSpace</span><span class="op" id="6266697">(</span><span class="ident" id="6266698">header</span><span class="op" id="6266704">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266708">val</span>&nbsp;<span class="op" id="6266712">=</span>&nbsp;<span class="ident" id="6266714">strings</span><span class="op" id="6266721">.</span><span class="ident" id="6266722">TrimSpace</span><span class="op" id="6266731">(</span><span class="ident" id="6266732">val</span><span class="op" id="6266735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266739">switch</span>&nbsp;<span class="op" id="6266746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266750">case</span>&nbsp;<span class="ident" id="6266755">header</span>&nbsp;<span class="op" id="6266762">==</span>&nbsp;<span class="string" id="6266765">&#34;Status&#34;</span><span class="op" id="6266773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266778">if</span>&nbsp;<span class="builtinfunc" id="6266781">len</span><span class="op" id="6266784">(</span><span class="ident" id="6266785">val</span><span class="op" id="6266788">)</span>&nbsp;<span class="op" id="6266790">&lt;</span>&nbsp;<span class="num" id="6266792">3</span>&nbsp;<span class="op" id="6266794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266800">h</span><span class="op" id="6266801">.</span><span class="ident" id="6266802">printf</span><span class="op" id="6266808">(</span><span class="string" id="6266809">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="6266840">,</span>&nbsp;<span class="ident" id="6266842">val</span><span class="op" id="6266845">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266866">code</span><span class="op" id="6266870">,</span>&nbsp;<span class="ident" id="6266872">err</span>&nbsp;<span class="op" id="6266876">:=</span>&nbsp;<span class="ident" id="6266879">strconv</span><span class="op" id="6266886">.</span><span class="ident" id="6266887">Atoi</span><span class="op" id="6266891">(</span><span class="ident" id="6266892">val</span><span class="op" id="6266895">[</span><span class="num" id="6266896">0</span><span class="op" id="6266897">:</span><span class="num" id="6266898">3</span><span class="op" id="6266899">]</span><span class="op" id="6266900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266905">if</span>&nbsp;<span class="ident" id="6266908">err</span>&nbsp;<span class="op" id="6266912">!=</span>&nbsp;<span class="ident" id="6266915">nil</span>&nbsp;<span class="op" id="6266919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266925">h</span><span class="op" id="6266926">.</span><span class="ident" id="6266927">printf</span><span class="op" id="6266933">(</span><span class="string" id="6266934">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="6266957">,</span>&nbsp;<span class="ident" id="6266959">val</span><span class="op" id="6266962">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266968">h</span><span class="op" id="6266969">.</span><span class="ident" id="6266970">printf</span><span class="op" id="6266976">(</span><span class="string" id="6266977">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="6266995">,</span>&nbsp;<span class="ident" id="6266997">line</span><span class="op" id="6267001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267007">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267022">statusCode</span>&nbsp;<span class="op" id="6267033">=</span>&nbsp;<span class="ident" id="6267035">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267042">default</span><span class="op" id="6267049">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267054">headers</span><span class="op" id="6267061">.</span><span class="ident" id="6267062">Add</span><span class="op" id="6267065">(</span><span class="ident" id="6267066">header</span><span class="op" id="6267072">,</span>&nbsp;<span class="ident" id="6267074">val</span><span class="op" id="6267077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267087">if</span>&nbsp;<span class="ident" id="6267090">headerLines</span>&nbsp;<span class="op" id="6267102">==</span>&nbsp;<span class="num" id="6267105">0</span>&nbsp;<span class="op" id="6267107">||</span>&nbsp;<span class="op" id="6267110">!</span><span class="ident" id="6267111">sawBlankLine</span>&nbsp;<span class="op" id="6267124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267128">rw</span><span class="op" id="6267130">.</span><span class="ident" id="6267131">WriteHeader</span><span class="op" id="6267142">(</span><span class="ident" id="6267143">http</span><span class="op" id="6267147">.</span><span class="ident" id="6267148">StatusInternalServerError</span><span class="op" id="6267173">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267177">h</span><span class="op" id="6267178">.</span><span class="ident" id="6267179">printf</span><span class="op" id="6267185">(</span><span class="string" id="6267186">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="6267203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267207">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267219">if</span>&nbsp;<span class="ident" id="6267222">loc</span>&nbsp;<span class="op" id="6267226">:=</span>&nbsp;<span class="ident" id="6267229">headers</span><span class="op" id="6267236">.</span><span class="ident" id="6267237">Get</span><span class="op" id="6267240">(</span><span class="string" id="6267241">&#34;Location&#34;</span><span class="op" id="6267251">)</span><span class="op" id="6267252">;</span>&nbsp;<span class="ident" id="6267254">loc</span>&nbsp;<span class="op" id="6267258">!=</span>&nbsp;<span class="string" id="6267261">&#34;&#34;</span>&nbsp;<span class="op" id="6267264">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267268">if</span>&nbsp;<span class="ident" id="6267271">strings</span><span class="op" id="6267278">.</span><span class="ident" id="6267279">HasPrefix</span><span class="op" id="6267288">(</span><span class="ident" id="6267289">loc</span><span class="op" id="6267292">,</span>&nbsp;<span class="string" id="6267294">&#34;/&#34;</span><span class="op" id="6267297">)</span>&nbsp;<span class="op" id="6267299">&amp;&amp;</span>&nbsp;<span class="ident" id="6267302">h</span><span class="op" id="6267303">.</span><span class="ident" id="6267304">PathLocationHandler</span>&nbsp;<span class="op" id="6267324">!=</span>&nbsp;<span class="ident" id="6267327">nil</span>&nbsp;<span class="op" id="6267331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267336">h</span><span class="op" id="6267337">.</span><span class="ident" id="6267338">handleInternalRedirect</span><span class="op" id="6267360">(</span><span class="ident" id="6267361">rw</span><span class="op" id="6267363">,</span>&nbsp;<span class="ident" id="6267365">req</span><span class="op" id="6267368">,</span>&nbsp;<span class="ident" id="6267370">loc</span><span class="op" id="6267373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267378">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267391">if</span>&nbsp;<span class="ident" id="6267394">statusCode</span>&nbsp;<span class="op" id="6267405">==</span>&nbsp;<span class="num" id="6267408">0</span>&nbsp;<span class="op" id="6267410">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267415">statusCode</span>&nbsp;<span class="op" id="6267426">=</span>&nbsp;<span class="ident" id="6267428">http</span><span class="op" id="6267432">.</span><span class="ident" id="6267433">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267454">if</span>&nbsp;<span class="ident" id="6267457">statusCode</span>&nbsp;<span class="op" id="6267468">==</span>&nbsp;<span class="num" id="6267471">0</span>&nbsp;<span class="op" id="6267473">&amp;&amp;</span>&nbsp;<span class="ident" id="6267476">headers</span><span class="op" id="6267483">.</span><span class="ident" id="6267484">Get</span><span class="op" id="6267487">(</span><span class="string" id="6267488">&#34;Content-Type&#34;</span><span class="op" id="6267502">)</span>&nbsp;<span class="op" id="6267504">==</span>&nbsp;<span class="string" id="6267507">&#34;&#34;</span>&nbsp;<span class="op" id="6267510">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267514">rw</span><span class="op" id="6267516">.</span><span class="ident" id="6267517">WriteHeader</span><span class="op" id="6267528">(</span><span class="ident" id="6267529">http</span><span class="op" id="6267533">.</span><span class="ident" id="6267534">StatusInternalServerError</span><span class="op" id="6267559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267563">h</span><span class="op" id="6267564">.</span><span class="ident" id="6267565">printf</span><span class="op" id="6267571">(</span><span class="string" id="6267572">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="6267619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267635">if</span>&nbsp;<span class="ident" id="6267638">statusCode</span>&nbsp;<span class="op" id="6267649">==</span>&nbsp;<span class="num" id="6267652">0</span>&nbsp;<span class="op" id="6267654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267658">statusCode</span>&nbsp;<span class="op" id="6267669">=</span>&nbsp;<span class="ident" id="6267671">http</span><span class="op" id="6267675">.</span><span class="ident" id="6267676">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267690">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267751">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267811">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267845">for</span>&nbsp;<span class="ident" id="6267849">k</span><span class="op" id="6267850">,</span>&nbsp;<span class="ident" id="6267852">vv</span>&nbsp;<span class="op" id="6267855">:=</span>&nbsp;<span class="keyword" id="6267858">range</span>&nbsp;<span class="ident" id="6267864">headers</span>&nbsp;<span class="op" id="6267872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267876">for</span>&nbsp;<span class="ident" id="6267880">_</span><span class="op" id="6267881">,</span>&nbsp;<span class="ident" id="6267883">v</span>&nbsp;<span class="op" id="6267885">:=</span>&nbsp;<span class="keyword" id="6267888">range</span>&nbsp;<span class="ident" id="6267894">vv</span>&nbsp;<span class="op" id="6267897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267902">rw</span><span class="op" id="6267904">.</span><span class="ident" id="6267905">Header</span><span class="op" id="6267911">(</span><span class="op" id="6267912">)</span><span class="op" id="6267913">.</span><span class="ident" id="6267914">Add</span><span class="op" id="6267917">(</span><span class="ident" id="6267918">k</span><span class="op" id="6267919">,</span>&nbsp;<span class="ident" id="6267921">v</span><span class="op" id="6267922">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267933">rw</span><span class="op" id="6267935">.</span><span class="ident" id="6267936">WriteHeader</span><span class="op" id="6267947">(</span><span class="ident" id="6267948">statusCode</span><span class="op" id="6267958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267962">_</span><span class="op" id="6267963">,</span>&nbsp;<span class="ident" id="6267965">err</span>&nbsp;<span class="op" id="6267969">=</span>&nbsp;<span class="ident" id="6267971">io</span><span class="op" id="6267973">.</span><span class="ident" id="6267974">Copy</span><span class="op" id="6267978">(</span><span class="ident" id="6267979">rw</span><span class="op" id="6267981">,</span>&nbsp;<span class="ident" id="6267983">linebody</span><span class="op" id="6267991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267994">if</span>&nbsp;<span class="ident" id="6267997">err</span>&nbsp;<span class="op" id="6268001">!=</span>&nbsp;<span class="ident" id="6268004">nil</span>&nbsp;<span class="op" id="6268008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268012">h</span><span class="op" id="6268013">.</span><span class="ident" id="6268014">printf</span><span class="op" id="6268020">(</span><span class="string" id="6268021">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6268042">,</span>&nbsp;<span class="ident" id="6268044">err</span><span class="op" id="6268047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268051">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268107">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268162">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268218">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268271">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268329">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268373">cmd</span><span class="op" id="6268376">.</span><span class="ident" id="6268377">Process</span><span class="op" id="6268384">.</span><span class="ident" id="6268385">Kill</span><span class="op" id="6268389">(</span><span class="op" id="6268390">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268393">}</span><br>
<span class="lineno"></span><span class="op" id="6268395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6268398">func</span>&nbsp;<span class="op" id="6268403">(</span><span class="ident" id="6268404">h</span>&nbsp;<span class="op" id="6268406">*</span><span class="ident" id="6268407">Handler</span><span class="op" id="6268414">)</span>&nbsp;<span class="ident" id="6268416">printf</span><span class="op" id="6268422">(</span><span class="ident" id="6268423">format</span>&nbsp;<span class="builtintype" id="6268430">string</span><span class="op" id="6268436">,</span>&nbsp;<span class="ident" id="6268438">v</span>&nbsp;<span class="op" id="6268440">...</span><span class="keyword" id="6268443">interface</span><span class="op" id="6268452">{</span><span class="op" id="6268453">}</span><span class="op" id="6268454">)</span>&nbsp;<span class="op" id="6268456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268459">if</span>&nbsp;<span class="ident" id="6268462">h</span><span class="op" id="6268463">.</span><span class="ident" id="6268464">Logger</span>&nbsp;<span class="op" id="6268471">!=</span>&nbsp;<span class="ident" id="6268474">nil</span>&nbsp;<span class="op" id="6268478">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268482">h</span><span class="op" id="6268483">.</span><span class="ident" id="6268484">Logger</span><span class="op" id="6268490">.</span><span class="ident" id="6268491">Printf</span><span class="op" id="6268497">(</span><span class="ident" id="6268498">format</span><span class="op" id="6268504">,</span>&nbsp;<span class="ident" id="6268506">v</span><span class="op" id="6268507">...</span><span class="op" id="6268510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268513">}</span>&nbsp;<span class="keyword" id="6268515">else</span>&nbsp;<span class="op" id="6268520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268524">log</span><span class="op" id="6268527">.</span><span class="ident" id="6268528">Printf</span><span class="op" id="6268534">(</span><span class="ident" id="6268535">format</span><span class="op" id="6268541">,</span>&nbsp;<span class="ident" id="6268543">v</span><span class="op" id="6268544">...</span><span class="op" id="6268547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268550">}</span><br>
<span class="lineno"></span><span class="op" id="6268552">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6268555">func</span>&nbsp;<span class="op" id="6268560">(</span><span class="ident" id="6268561">h</span>&nbsp;<span class="op" id="6268563">*</span><span class="ident" id="6268564">Handler</span><span class="op" id="6268571">)</span>&nbsp;<span class="ident" id="6268573">handleInternalRedirect</span><span class="op" id="6268595">(</span><span class="ident" id="6268596">rw</span>&nbsp;<span class="ident" id="6268599">http</span><span class="op" id="6268603">.</span><span class="ident" id="6268604">ResponseWriter</span><span class="op" id="6268618">,</span>&nbsp;<span class="ident" id="6268620">req</span>&nbsp;<span class="op" id="6268624">*</span><span class="ident" id="6268625">http</span><span class="op" id="6268629">.</span><span class="ident" id="6268630">Request</span><span class="op" id="6268637">,</span>&nbsp;<span class="ident" id="6268639">path</span>&nbsp;<span class="builtintype" id="6268644">string</span><span class="op" id="6268650">)</span>&nbsp;<span class="op" id="6268652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268655">url</span><span class="op" id="6268658">,</span>&nbsp;<span class="ident" id="6268660">err</span>&nbsp;<span class="op" id="6268664">:=</span>&nbsp;<span class="ident" id="6268667">req</span><span class="op" id="6268670">.</span><span class="ident" id="6268671">URL</span><span class="op" id="6268674">.</span><span class="ident" id="6268675">Parse</span><span class="op" id="6268680">(</span><span class="ident" id="6268681">path</span><span class="op" id="6268685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268688">if</span>&nbsp;<span class="ident" id="6268691">err</span>&nbsp;<span class="op" id="6268695">!=</span>&nbsp;<span class="ident" id="6268698">nil</span>&nbsp;<span class="op" id="6268702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268706">rw</span><span class="op" id="6268708">.</span><span class="ident" id="6268709">WriteHeader</span><span class="op" id="6268720">(</span><span class="ident" id="6268721">http</span><span class="op" id="6268725">.</span><span class="ident" id="6268726">StatusInternalServerError</span><span class="op" id="6268751">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268755">h</span><span class="op" id="6268756">.</span><span class="ident" id="6268757">printf</span><span class="op" id="6268763">(</span><span class="string" id="6268764">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="6268808">,</span>&nbsp;<span class="ident" id="6268810">path</span><span class="op" id="6268814">,</span>&nbsp;<span class="ident" id="6268816">err</span><span class="op" id="6268819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268823">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268834">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268898">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268959">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269021">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269082">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269144">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269205">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269258">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269320">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269340">newReq</span>&nbsp;<span class="op" id="6269347">:=</span>&nbsp;<span class="op" id="6269350">&amp;</span><span class="ident" id="6269351">http</span><span class="op" id="6269355">.</span><span class="ident" id="6269356">Request</span><span class="op" id="6269363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269367">Method</span><span class="op" id="6269373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6269379">&#34;GET&#34;</span><span class="op" id="6269384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269388">URL</span><span class="op" id="6269391">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269400">url</span><span class="op" id="6269403">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269407">Proto</span><span class="op" id="6269412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6269419">&#34;HTTP/1.1&#34;</span><span class="op" id="6269429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269433">ProtoMajor</span><span class="op" id="6269443">:</span>&nbsp;<span class="num" id="6269445">1</span><span class="op" id="6269446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269450">ProtoMinor</span><span class="op" id="6269460">:</span>&nbsp;<span class="num" id="6269462">1</span><span class="op" id="6269463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269467">Header</span><span class="op" id="6269473">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6269479">make</span><span class="op" id="6269483">(</span><span class="ident" id="6269484">http</span><span class="op" id="6269488">.</span><span class="ident" id="6269489">Header</span><span class="op" id="6269495">)</span><span class="op" id="6269496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269500">Host</span><span class="op" id="6269504">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269512">url</span><span class="op" id="6269515">.</span><span class="ident" id="6269516">Host</span><span class="op" id="6269520">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269524">RemoteAddr</span><span class="op" id="6269534">:</span>&nbsp;<span class="ident" id="6269536">req</span><span class="op" id="6269539">.</span><span class="ident" id="6269540">RemoteAddr</span><span class="op" id="6269550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269554">TLS</span><span class="op" id="6269557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269566">req</span><span class="op" id="6269569">.</span><span class="ident" id="6269570">TLS</span><span class="op" id="6269573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269579">h</span><span class="op" id="6269580">.</span><span class="ident" id="6269581">PathLocationHandler</span><span class="op" id="6269600">.</span><span class="ident" id="6269601">ServeHTTP</span><span class="op" id="6269610">(</span><span class="ident" id="6269611">rw</span><span class="op" id="6269613">,</span>&nbsp;<span class="ident" id="6269615">newReq</span><span class="op" id="6269621">)</span><br>
<span class="lineno"></span><span class="op" id="6269623">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="6269626">func</span>&nbsp;<span class="ident" id="6269631">upperCaseAndUnderscore</span><span class="op" id="6269653">(</span><span class="ident" id="6269654">r</span>&nbsp;<span class="builtintype" id="6269656">rune</span><span class="op" id="6269660">)</span>&nbsp;<span class="builtintype" id="6269662">rune</span>&nbsp;<span class="op" id="6269667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269670">switch</span>&nbsp;<span class="op" id="6269677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269680">case</span>&nbsp;<span class="ident" id="6269685">r</span>&nbsp;<span class="op" id="6269687">&gt;=</span>&nbsp;<span class="string" id="6269690">&#39;a&#39;</span>&nbsp;<span class="op" id="6269694">&amp;&amp;</span>&nbsp;<span class="ident" id="6269697">r</span>&nbsp;<span class="op" id="6269699">&lt;=</span>&nbsp;<span class="string" id="6269702">&#39;z&#39;</span><span class="op" id="6269705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269709">return</span>&nbsp;<span class="ident" id="6269716">r</span>&nbsp;<span class="op" id="6269718">-</span>&nbsp;<span class="op" id="6269720">(</span><span class="string" id="6269721">&#39;a&#39;</span>&nbsp;<span class="op" id="6269725">-</span>&nbsp;<span class="string" id="6269727">&#39;A&#39;</span><span class="op" id="6269730">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269733">case</span>&nbsp;<span class="ident" id="6269738">r</span>&nbsp;<span class="op" id="6269740">==</span>&nbsp;<span class="string" id="6269743">&#39;-&#39;</span><span class="op" id="6269746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269750">return</span>&nbsp;<span class="string" id="6269757">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269762">case</span>&nbsp;<span class="ident" id="6269767">r</span>&nbsp;<span class="op" id="6269769">==</span>&nbsp;<span class="string" id="6269772">&#39;=&#39;</span><span class="op" id="6269775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269779">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269835">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269890">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269942">return</span>&nbsp;<span class="string" id="6269949">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269957">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270010">return</span>&nbsp;<span class="ident" id="6270017">r</span><br>
<span class="lineno">375</span><span class="op" id="6270019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6270022">var</span>&nbsp;<span class="ident" id="6270026">testHookStartProcess</span>&nbsp;<span class="keyword" id="6270047">func</span><span class="op" id="6270051">(</span><span class="op" id="6270052">*</span><span class="ident" id="6270053">os</span><span class="op" id="6270055">.</span><span class="ident" id="6270056">Process</span><span class="op" id="6270063">)</span>&nbsp;<span class="comment" id="6270065">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
