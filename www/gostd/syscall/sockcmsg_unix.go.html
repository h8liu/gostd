<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2221338">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2221394">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2221448">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2221499">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2221564">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2221592">package</span>&nbsp;<span class="ident" id="2221600">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2221609">import</span>&nbsp;<span class="string" id="2221616">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2221626">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2221689">func</span>&nbsp;<span class="ident" id="2221694">cmsgAlignOf</span><span class="op" id="2221705">(</span><span class="ident" id="2221706">salen</span>&nbsp;<span class="builtintype" id="2221712">int</span><span class="op" id="2221715">)</span>&nbsp;<span class="builtintype" id="2221717">int</span>&nbsp;<span class="op" id="2221721">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2221724">salign</span>&nbsp;<span class="op" id="2221731">:=</span>&nbsp;<span class="ident" id="2221734">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2221745">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2221809">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221871">if</span>&nbsp;<span class="ident" id="2221874">darwin64Bit</span>&nbsp;<span class="op" id="2221886">||</span>&nbsp;<span class="ident" id="2221889">dragonfly64Bit</span>&nbsp;<span class="op" id="2221904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2221908">salign</span>&nbsp;<span class="op" id="2221915">=</span>&nbsp;<span class="num" id="2221917">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221923">return</span>&nbsp;<span class="op" id="2221930">(</span><span class="ident" id="2221931">salen</span>&nbsp;<span class="op" id="2221937">+</span>&nbsp;<span class="ident" id="2221939">salign</span>&nbsp;<span class="op" id="2221946">-</span>&nbsp;<span class="num" id="2221948">1</span><span class="op" id="2221949">)</span>&nbsp;<span class="op" id="2221951">&amp;</span>&nbsp;<span class="op" id="2221953">^</span><span class="op" id="2221954">(</span><span class="ident" id="2221955">salign</span>&nbsp;<span class="op" id="2221962">-</span>&nbsp;<span class="num" id="2221964">1</span><span class="op" id="2221965">)</span><br>
<span class="lineno"></span><span class="op" id="2221967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2221970">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2222040">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2222099">func</span>&nbsp;<span class="ident" id="2222104">CmsgLen</span><span class="op" id="2222111">(</span><span class="ident" id="2222112">datalen</span>&nbsp;<span class="builtintype" id="2222120">int</span><span class="op" id="2222123">)</span>&nbsp;<span class="builtintype" id="2222125">int</span>&nbsp;<span class="op" id="2222129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222132">return</span>&nbsp;<span class="ident" id="2222139">cmsgAlignOf</span><span class="op" id="2222150">(</span><span class="ident" id="2222151">SizeofCmsghdr</span><span class="op" id="2222164">)</span>&nbsp;<span class="op" id="2222166">+</span>&nbsp;<span class="ident" id="2222168">datalen</span><br>
<span class="lineno"></span><span class="op" id="2222176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2222179">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2222246">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2222293">func</span>&nbsp;<span class="ident" id="2222298">CmsgSpace</span><span class="op" id="2222307">(</span><span class="ident" id="2222308">datalen</span>&nbsp;<span class="builtintype" id="2222316">int</span><span class="op" id="2222319">)</span>&nbsp;<span class="builtintype" id="2222321">int</span>&nbsp;<span class="op" id="2222325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222328">return</span>&nbsp;<span class="ident" id="2222335">cmsgAlignOf</span><span class="op" id="2222346">(</span><span class="ident" id="2222347">SizeofCmsghdr</span><span class="op" id="2222360">)</span>&nbsp;<span class="op" id="2222362">+</span>&nbsp;<span class="ident" id="2222364">cmsgAlignOf</span><span class="op" id="2222375">(</span><span class="ident" id="2222376">datalen</span><span class="op" id="2222383">)</span><br>
<span class="lineno"></span><span class="op" id="2222385">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2222388">func</span>&nbsp;<span class="ident" id="2222393">cmsgData</span><span class="op" id="2222401">(</span><span class="ident" id="2222402">h</span>&nbsp;<span class="op" id="2222404">*</span><span class="ident" id="2222405">Cmsghdr</span><span class="op" id="2222412">)</span>&nbsp;<span class="ident" id="2222414">unsafe</span><span class="op" id="2222420">.</span><span class="ident" id="2222421">Pointer</span>&nbsp;<span class="op" id="2222429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222432">return</span>&nbsp;<span class="ident" id="2222439">unsafe</span><span class="op" id="2222445">.</span><span class="ident" id="2222446">Pointer</span><span class="op" id="2222453">(</span><span class="builtintype" id="2222454">uintptr</span><span class="op" id="2222461">(</span><span class="ident" id="2222462">unsafe</span><span class="op" id="2222468">.</span><span class="ident" id="2222469">Pointer</span><span class="op" id="2222476">(</span><span class="ident" id="2222477">h</span><span class="op" id="2222478">)</span><span class="op" id="2222479">)</span>&nbsp;<span class="op" id="2222481">+</span>&nbsp;<span class="builtintype" id="2222483">uintptr</span><span class="op" id="2222490">(</span><span class="ident" id="2222491">cmsgAlignOf</span><span class="op" id="2222502">(</span><span class="ident" id="2222503">SizeofCmsghdr</span><span class="op" id="2222516">)</span><span class="op" id="2222517">)</span><span class="op" id="2222518">)</span><br>
<span class="lineno"></span><span class="op" id="2222520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2222523">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2222584">type</span>&nbsp;<span class="ident" id="2222589">SocketControlMessage</span>&nbsp;<span class="keyword" id="2222610">struct</span>&nbsp;<span class="op" id="2222617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222620">Header</span>&nbsp;<span class="ident" id="2222627">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222636">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2222643">[</span><span class="op" id="2222644">]</span><span class="builtintype" id="2222645">byte</span><br>
<span class="lineno"></span><span class="op" id="2222650">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2222653">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2222721">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2222734">func</span>&nbsp;<span class="ident" id="2222739">ParseSocketControlMessage</span><span class="op" id="2222764">(</span><span class="ident" id="2222765">b</span>&nbsp;<span class="op" id="2222767">[</span><span class="op" id="2222768">]</span><span class="builtintype" id="2222769">byte</span><span class="op" id="2222773">)</span>&nbsp;<span class="op" id="2222775">(</span><span class="op" id="2222776">[</span><span class="op" id="2222777">]</span><span class="ident" id="2222778">SocketControlMessage</span><span class="op" id="2222798">,</span>&nbsp;<span class="builtintype" id="2222800">error</span><span class="op" id="2222805">)</span>&nbsp;<span class="op" id="2222807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222810">var</span>&nbsp;<span class="ident" id="2222814">msgs</span>&nbsp;<span class="op" id="2222819">[</span><span class="op" id="2222820">]</span><span class="ident" id="2222821">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222843">i</span>&nbsp;<span class="op" id="2222845">:=</span>&nbsp;<span class="num" id="2222848">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222851">for</span>&nbsp;<span class="ident" id="2222855">i</span><span class="op" id="2222856">+</span><span class="ident" id="2222857">CmsgLen</span><span class="op" id="2222864">(</span><span class="num" id="2222865">0</span><span class="op" id="2222866">)</span>&nbsp;<span class="op" id="2222868">&lt;=</span>&nbsp;<span class="builtinfunc" id="2222871">len</span><span class="op" id="2222874">(</span><span class="ident" id="2222875">b</span><span class="op" id="2222876">)</span>&nbsp;<span class="op" id="2222878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222882">h</span><span class="op" id="2222883">,</span>&nbsp;<span class="ident" id="2222885">dbuf</span><span class="op" id="2222889">,</span>&nbsp;<span class="ident" id="2222891">err</span>&nbsp;<span class="op" id="2222895">:=</span>&nbsp;<span class="ident" id="2222898">socketControlMessageHeaderAndData</span><span class="op" id="2222931">(</span><span class="ident" id="2222932">b</span><span class="op" id="2222933">[</span><span class="ident" id="2222934">i</span><span class="op" id="2222935">:</span><span class="op" id="2222936">]</span><span class="op" id="2222937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222941">if</span>&nbsp;<span class="ident" id="2222944">err</span>&nbsp;<span class="op" id="2222948">!=</span>&nbsp;<span class="ident" id="2222951">nil</span>&nbsp;<span class="op" id="2222955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222960">return</span>&nbsp;<span class="ident" id="2222967">nil</span><span class="op" id="2222970">,</span>&nbsp;<span class="ident" id="2222972">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2222978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222982">m</span>&nbsp;<span class="op" id="2222984">:=</span>&nbsp;<span class="ident" id="2222987">SocketControlMessage</span><span class="op" id="2223007">{</span><span class="ident" id="2223008">Header</span><span class="op" id="2223014">:</span>&nbsp;<span class="op" id="2223016">*</span><span class="ident" id="2223017">h</span><span class="op" id="2223018">,</span>&nbsp;<span class="ident" id="2223020">Data</span><span class="op" id="2223024">:</span>&nbsp;<span class="ident" id="2223026">dbuf</span><span class="op" id="2223030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223034">msgs</span>&nbsp;<span class="op" id="2223039">=</span>&nbsp;<span class="builtinfunc" id="2223041">append</span><span class="op" id="2223047">(</span><span class="ident" id="2223048">msgs</span><span class="op" id="2223052">,</span>&nbsp;<span class="ident" id="2223054">m</span><span class="op" id="2223055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223059">i</span>&nbsp;<span class="op" id="2223061">+=</span>&nbsp;<span class="ident" id="2223064">cmsgAlignOf</span><span class="op" id="2223075">(</span><span class="builtintype" id="2223076">int</span><span class="op" id="2223079">(</span><span class="ident" id="2223080">h</span><span class="op" id="2223081">.</span><span class="ident" id="2223082">Len</span><span class="op" id="2223085">)</span><span class="op" id="2223086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223089">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223092">return</span>&nbsp;<span class="ident" id="2223099">msgs</span><span class="op" id="2223103">,</span>&nbsp;<span class="ident" id="2223105">nil</span><br>
<span class="lineno"></span><span class="op" id="2223109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2223112">func</span>&nbsp;<span class="ident" id="2223117">socketControlMessageHeaderAndData</span><span class="op" id="2223150">(</span><span class="ident" id="2223151">b</span>&nbsp;<span class="op" id="2223153">[</span><span class="op" id="2223154">]</span><span class="builtintype" id="2223155">byte</span><span class="op" id="2223159">)</span>&nbsp;<span class="op" id="2223161">(</span><span class="op" id="2223162">*</span><span class="ident" id="2223163">Cmsghdr</span><span class="op" id="2223170">,</span>&nbsp;<span class="op" id="2223172">[</span><span class="op" id="2223173">]</span><span class="builtintype" id="2223174">byte</span><span class="op" id="2223178">,</span>&nbsp;<span class="builtintype" id="2223180">error</span><span class="op" id="2223185">)</span>&nbsp;<span class="op" id="2223187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223190">h</span>&nbsp;<span class="op" id="2223192">:=</span>&nbsp;<span class="op" id="2223195">(</span><span class="op" id="2223196">*</span><span class="ident" id="2223197">Cmsghdr</span><span class="op" id="2223204">)</span><span class="op" id="2223205">(</span><span class="ident" id="2223206">unsafe</span><span class="op" id="2223212">.</span><span class="ident" id="2223213">Pointer</span><span class="op" id="2223220">(</span><span class="op" id="2223221">&amp;</span><span class="ident" id="2223222">b</span><span class="op" id="2223223">[</span><span class="num" id="2223224">0</span><span class="op" id="2223225">]</span><span class="op" id="2223226">)</span><span class="op" id="2223227">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223230">if</span>&nbsp;<span class="ident" id="2223233">h</span><span class="op" id="2223234">.</span><span class="ident" id="2223235">Len</span>&nbsp;<span class="op" id="2223239">&lt;</span>&nbsp;<span class="ident" id="2223241">SizeofCmsghdr</span>&nbsp;<span class="op" id="2223255">||</span>&nbsp;<span class="builtintype" id="2223258">int</span><span class="op" id="2223261">(</span><span class="ident" id="2223262">h</span><span class="op" id="2223263">.</span><span class="ident" id="2223264">Len</span><span class="op" id="2223267">)</span>&nbsp;<span class="op" id="2223269">&gt;</span>&nbsp;<span class="builtinfunc" id="2223271">len</span><span class="op" id="2223274">(</span><span class="ident" id="2223275">b</span><span class="op" id="2223276">)</span>&nbsp;<span class="op" id="2223278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223282">return</span>&nbsp;<span class="ident" id="2223289">nil</span><span class="op" id="2223292">,</span>&nbsp;<span class="ident" id="2223294">nil</span><span class="op" id="2223297">,</span>&nbsp;<span class="ident" id="2223299">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223310">return</span>&nbsp;<span class="ident" id="2223317">h</span><span class="op" id="2223318">,</span>&nbsp;<span class="ident" id="2223320">b</span><span class="op" id="2223321">[</span><span class="ident" id="2223322">cmsgAlignOf</span><span class="op" id="2223333">(</span><span class="ident" id="2223334">SizeofCmsghdr</span><span class="op" id="2223347">)</span><span class="op" id="2223348">:</span><span class="ident" id="2223349">h</span><span class="op" id="2223350">.</span><span class="ident" id="2223351">Len</span><span class="op" id="2223354">]</span><span class="op" id="2223355">,</span>&nbsp;<span class="ident" id="2223357">nil</span><br>
<span class="lineno"></span><span class="op" id="2223361">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2223364">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2223431">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2223482">func</span>&nbsp;<span class="ident" id="2223487">UnixRights</span><span class="op" id="2223497">(</span><span class="ident" id="2223498">fds</span>&nbsp;<span class="op" id="2223502">...</span><span class="builtintype" id="2223505">int</span><span class="op" id="2223508">)</span>&nbsp;<span class="op" id="2223510">[</span><span class="op" id="2223511">]</span><span class="builtintype" id="2223512">byte</span>&nbsp;<span class="op" id="2223517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223520">datalen</span>&nbsp;<span class="op" id="2223528">:=</span>&nbsp;<span class="builtinfunc" id="2223531">len</span><span class="op" id="2223534">(</span><span class="ident" id="2223535">fds</span><span class="op" id="2223538">)</span>&nbsp;<span class="op" id="2223540">*</span>&nbsp;<span class="num" id="2223542">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223545">b</span>&nbsp;<span class="op" id="2223547">:=</span>&nbsp;<span class="builtinfunc" id="2223550">make</span><span class="op" id="2223554">(</span><span class="op" id="2223555">[</span><span class="op" id="2223556">]</span><span class="builtintype" id="2223557">byte</span><span class="op" id="2223561">,</span>&nbsp;<span class="ident" id="2223563">CmsgSpace</span><span class="op" id="2223572">(</span><span class="ident" id="2223573">datalen</span><span class="op" id="2223580">)</span><span class="op" id="2223581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223584">h</span>&nbsp;<span class="op" id="2223586">:=</span>&nbsp;<span class="op" id="2223589">(</span><span class="op" id="2223590">*</span><span class="ident" id="2223591">Cmsghdr</span><span class="op" id="2223598">)</span><span class="op" id="2223599">(</span><span class="ident" id="2223600">unsafe</span><span class="op" id="2223606">.</span><span class="ident" id="2223607">Pointer</span><span class="op" id="2223614">(</span><span class="op" id="2223615">&amp;</span><span class="ident" id="2223616">b</span><span class="op" id="2223617">[</span><span class="num" id="2223618">0</span><span class="op" id="2223619">]</span><span class="op" id="2223620">)</span><span class="op" id="2223621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223624">h</span><span class="op" id="2223625">.</span><span class="ident" id="2223626">Level</span>&nbsp;<span class="op" id="2223632">=</span>&nbsp;<span class="ident" id="2223634">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223646">h</span><span class="op" id="2223647">.</span><span class="ident" id="2223648">Type</span>&nbsp;<span class="op" id="2223653">=</span>&nbsp;<span class="ident" id="2223655">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223667">h</span><span class="op" id="2223668">.</span><span class="ident" id="2223669">SetLen</span><span class="op" id="2223675">(</span><span class="ident" id="2223676">CmsgLen</span><span class="op" id="2223683">(</span><span class="ident" id="2223684">datalen</span><span class="op" id="2223691">)</span><span class="op" id="2223692">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223695">data</span>&nbsp;<span class="op" id="2223700">:=</span>&nbsp;<span class="builtintype" id="2223703">uintptr</span><span class="op" id="2223710">(</span><span class="ident" id="2223711">cmsgData</span><span class="op" id="2223719">(</span><span class="ident" id="2223720">h</span><span class="op" id="2223721">)</span><span class="op" id="2223722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223725">for</span>&nbsp;<span class="ident" id="2223729">_</span><span class="op" id="2223730">,</span>&nbsp;<span class="ident" id="2223732">fd</span>&nbsp;<span class="op" id="2223735">:=</span>&nbsp;<span class="keyword" id="2223738">range</span>&nbsp;<span class="ident" id="2223744">fds</span>&nbsp;<span class="op" id="2223748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223752">*</span><span class="op" id="2223753">(</span><span class="op" id="2223754">*</span><span class="builtintype" id="2223755">int32</span><span class="op" id="2223760">)</span><span class="op" id="2223761">(</span><span class="ident" id="2223762">unsafe</span><span class="op" id="2223768">.</span><span class="ident" id="2223769">Pointer</span><span class="op" id="2223776">(</span><span class="ident" id="2223777">data</span><span class="op" id="2223781">)</span><span class="op" id="2223782">)</span>&nbsp;<span class="op" id="2223784">=</span>&nbsp;<span class="builtintype" id="2223786">int32</span><span class="op" id="2223791">(</span><span class="ident" id="2223792">fd</span><span class="op" id="2223794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223798">data</span>&nbsp;<span class="op" id="2223803">+=</span>&nbsp;<span class="num" id="2223806">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223809">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223812">return</span>&nbsp;<span class="ident" id="2223819">b</span><br>
<span class="lineno"></span><span class="op" id="2223821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2223824">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2223893">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2223957">func</span>&nbsp;<span class="ident" id="2223962">ParseUnixRights</span><span class="op" id="2223977">(</span><span class="ident" id="2223978">m</span>&nbsp;<span class="op" id="2223980">*</span><span class="ident" id="2223981">SocketControlMessage</span><span class="op" id="2224001">)</span>&nbsp;<span class="op" id="2224003">(</span><span class="op" id="2224004">[</span><span class="op" id="2224005">]</span><span class="builtintype" id="2224006">int</span><span class="op" id="2224009">,</span>&nbsp;<span class="builtintype" id="2224011">error</span><span class="op" id="2224016">)</span>&nbsp;<span class="op" id="2224018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224021">if</span>&nbsp;<span class="ident" id="2224024">m</span><span class="op" id="2224025">.</span><span class="ident" id="2224026">Header</span><span class="op" id="2224032">.</span><span class="ident" id="2224033">Level</span>&nbsp;<span class="op" id="2224039">!=</span>&nbsp;<span class="ident" id="2224042">SOL_SOCKET</span>&nbsp;<span class="op" id="2224053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224057">return</span>&nbsp;<span class="ident" id="2224064">nil</span><span class="op" id="2224067">,</span>&nbsp;<span class="ident" id="2224069">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224080">if</span>&nbsp;<span class="ident" id="2224083">m</span><span class="op" id="2224084">.</span><span class="ident" id="2224085">Header</span><span class="op" id="2224091">.</span><span class="ident" id="2224092">Type</span>&nbsp;<span class="op" id="2224097">!=</span>&nbsp;<span class="ident" id="2224100">SCM_RIGHTS</span>&nbsp;<span class="op" id="2224111">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224115">return</span>&nbsp;<span class="ident" id="2224122">nil</span><span class="op" id="2224125">,</span>&nbsp;<span class="ident" id="2224127">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224138">fds</span>&nbsp;<span class="op" id="2224142">:=</span>&nbsp;<span class="builtinfunc" id="2224145">make</span><span class="op" id="2224149">(</span><span class="op" id="2224150">[</span><span class="op" id="2224151">]</span><span class="builtintype" id="2224152">int</span><span class="op" id="2224155">,</span>&nbsp;<span class="builtinfunc" id="2224157">len</span><span class="op" id="2224160">(</span><span class="ident" id="2224161">m</span><span class="op" id="2224162">.</span><span class="ident" id="2224163">Data</span><span class="op" id="2224167">)</span><span class="op" id="2224168">&gt;&gt;</span><span class="num" id="2224170">2</span><span class="op" id="2224171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224174">for</span>&nbsp;<span class="ident" id="2224178">i</span><span class="op" id="2224179">,</span>&nbsp;<span class="ident" id="2224181">j</span>&nbsp;<span class="op" id="2224183">:=</span>&nbsp;<span class="num" id="2224186">0</span><span class="op" id="2224187">,</span>&nbsp;<span class="num" id="2224189">0</span><span class="op" id="2224190">;</span>&nbsp;<span class="ident" id="2224192">i</span>&nbsp;<span class="op" id="2224194">&lt;</span>&nbsp;<span class="builtinfunc" id="2224196">len</span><span class="op" id="2224199">(</span><span class="ident" id="2224200">m</span><span class="op" id="2224201">.</span><span class="ident" id="2224202">Data</span><span class="op" id="2224206">)</span><span class="op" id="2224207">;</span>&nbsp;<span class="ident" id="2224209">i</span>&nbsp;<span class="op" id="2224211">+=</span>&nbsp;<span class="num" id="2224214">4</span>&nbsp;<span class="op" id="2224216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224220">fds</span><span class="op" id="2224223">[</span><span class="ident" id="2224224">j</span><span class="op" id="2224225">]</span>&nbsp;<span class="op" id="2224227">=</span>&nbsp;<span class="builtintype" id="2224229">int</span><span class="op" id="2224232">(</span><span class="op" id="2224233">*</span><span class="op" id="2224234">(</span><span class="op" id="2224235">*</span><span class="builtintype" id="2224236">int32</span><span class="op" id="2224241">)</span><span class="op" id="2224242">(</span><span class="ident" id="2224243">unsafe</span><span class="op" id="2224249">.</span><span class="ident" id="2224250">Pointer</span><span class="op" id="2224257">(</span><span class="op" id="2224258">&amp;</span><span class="ident" id="2224259">m</span><span class="op" id="2224260">.</span><span class="ident" id="2224261">Data</span><span class="op" id="2224265">[</span><span class="ident" id="2224266">i</span><span class="op" id="2224267">]</span><span class="op" id="2224268">)</span><span class="op" id="2224269">)</span><span class="op" id="2224270">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224274">j</span><span class="op" id="2224275">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224282">return</span>&nbsp;<span class="ident" id="2224289">fds</span><span class="op" id="2224292">,</span>&nbsp;<span class="ident" id="2224294">nil</span><br>
<span class="lineno"></span><span class="op" id="2224298">}</span>
</div>
</body>
</html>
