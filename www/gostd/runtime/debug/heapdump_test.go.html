<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8512396">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8512451">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8512505">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8512556">package</span>&nbsp;<span class="ident" id="8512564">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8512571">import</span>&nbsp;<span class="op" id="8512578">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8512581">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8512594">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8512600">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8512611">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8512621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8512624">func</span>&nbsp;<span class="ident" id="8512629">TestWriteHeapDumpNonempty</span><span class="op" id="8512654">(</span><span class="ident" id="8512655">t</span>&nbsp;<span class="op" id="8512657">*</span><span class="ident" id="8512658">testing</span><span class="op" id="8512665">.</span><span class="ident" id="8512666">T</span><span class="op" id="8512667">)</span>&nbsp;<span class="op" id="8512669">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8512672">if</span>&nbsp;<span class="ident" id="8512675">runtime</span><span class="op" id="8512682">.</span><span class="ident" id="8512683">GOOS</span>&nbsp;<span class="op" id="8512688">==</span>&nbsp;<span class="string" id="8512691">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8512698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512702">t</span><span class="op" id="8512703">.</span><span class="ident" id="8512704">Skip</span><span class="op" id="8512708">(</span><span class="string" id="8512709">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8512750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8512753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512756">f</span><span class="op" id="8512757">,</span>&nbsp;<span class="ident" id="8512759">err</span>&nbsp;<span class="op" id="8512763">:=</span>&nbsp;<span class="ident" id="8512766">ioutil</span><span class="op" id="8512772">.</span><span class="ident" id="8512773">TempFile</span><span class="op" id="8512781">(</span><span class="string" id="8512782">&#34;&#34;</span><span class="op" id="8512784">,</span>&nbsp;<span class="string" id="8512786">&#34;heapdumptest&#34;</span><span class="op" id="8512800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8512803">if</span>&nbsp;<span class="ident" id="8512806">err</span>&nbsp;<span class="op" id="8512810">!=</span>&nbsp;<span class="builtintype" id="8512813">nil</span>&nbsp;<span class="op" id="8512817">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512821">t</span><span class="op" id="8512822">.</span><span class="ident" id="8512823">Fatalf</span><span class="op" id="8512829">(</span><span class="string" id="8512830">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8512851">,</span>&nbsp;<span class="ident" id="8512853">err</span><span class="op" id="8512856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8512859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8512862">defer</span>&nbsp;<span class="ident" id="8512868">os</span><span class="op" id="8512870">.</span><span class="ident" id="8512871">Remove</span><span class="op" id="8512877">(</span><span class="ident" id="8512878">f</span><span class="op" id="8512879">.</span><span class="ident" id="8512880">Name</span><span class="op" id="8512884">(</span><span class="op" id="8512885">)</span><span class="op" id="8512886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8512889">defer</span>&nbsp;<span class="ident" id="8512895">f</span><span class="op" id="8512896">.</span><span class="ident" id="8512897">Close</span><span class="op" id="8512902">(</span><span class="op" id="8512903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512906">WriteHeapDump</span><span class="op" id="8512919">(</span><span class="ident" id="8512920">f</span><span class="op" id="8512921">.</span><span class="ident" id="8512922">Fd</span><span class="op" id="8512924">(</span><span class="op" id="8512925">)</span><span class="op" id="8512926">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512929">fi</span><span class="op" id="8512931">,</span>&nbsp;<span class="ident" id="8512933">err</span>&nbsp;<span class="op" id="8512937">:=</span>&nbsp;<span class="ident" id="8512940">f</span><span class="op" id="8512941">.</span><span class="ident" id="8512942">Stat</span><span class="op" id="8512946">(</span><span class="op" id="8512947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8512950">if</span>&nbsp;<span class="ident" id="8512953">err</span>&nbsp;<span class="op" id="8512957">!=</span>&nbsp;<span class="builtintype" id="8512960">nil</span>&nbsp;<span class="op" id="8512964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8512968">t</span><span class="op" id="8512969">.</span><span class="ident" id="8512970">Fatalf</span><span class="op" id="8512976">(</span><span class="string" id="8512977">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8512994">,</span>&nbsp;<span class="ident" id="8512996">err</span><span class="op" id="8512999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8513002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8513005">const</span>&nbsp;<span class="ident" id="8513011">minSize</span>&nbsp;<span class="op" id="8513019">=</span>&nbsp;<span class="num" id="8513021">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8513024">if</span>&nbsp;<span class="ident" id="8513027">size</span>&nbsp;<span class="op" id="8513032">:=</span>&nbsp;<span class="ident" id="8513035">fi</span><span class="op" id="8513037">.</span><span class="ident" id="8513038">Size</span><span class="op" id="8513042">(</span><span class="op" id="8513043">)</span><span class="op" id="8513044">;</span>&nbsp;<span class="ident" id="8513046">size</span>&nbsp;<span class="op" id="8513051">&lt;</span>&nbsp;<span class="ident" id="8513053">minSize</span>&nbsp;<span class="op" id="8513061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8513065">t</span><span class="op" id="8513066">.</span><span class="ident" id="8513067">Fatalf</span><span class="op" id="8513073">(</span><span class="string" id="8513074">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8513127">,</span>&nbsp;<span class="ident" id="8513129">size</span><span class="op" id="8513133">,</span>&nbsp;<span class="ident" id="8513135">minSize</span><span class="op" id="8513142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8513145">}</span><br>
<span class="lineno"></span><span class="op" id="8513147">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
