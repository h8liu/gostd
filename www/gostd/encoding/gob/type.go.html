<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5039209">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5039264">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5039318">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5039369">package</span>&nbsp;<span class="ident" id="5039377">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5039382">import</span>&nbsp;<span class="op" id="5039389">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039392">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039404">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039414">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039421">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039427">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039438">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039446">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039461">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5039472">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5039487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5039490">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="5039572">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="5039651">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5039660">type</span>&nbsp;<span class="ident" id="5039665">userTypeInfo</span>&nbsp;<span class="keyword" id="5039678">struct</span>&nbsp;<span class="op" id="5039685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039688">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5039700">reflect</span><span class="op" id="5039707">.</span><span class="ident" id="5039708">Type</span>&nbsp;<span class="comment" id="5039713">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039745">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5039757">reflect</span><span class="op" id="5039764">.</span><span class="ident" id="5039765">Type</span>&nbsp;<span class="comment" id="5039770">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039811">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5039823">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5039836">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039886">externalEnc</span>&nbsp;<span class="builtintype" id="5039898">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5039911">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039939">externalDec</span>&nbsp;<span class="builtintype" id="5039951">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5039964">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039991">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5040003">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5040016">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040087">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5040099">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5040112">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="5040182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5040185">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="5040210">const</span>&nbsp;<span class="op" id="5040216">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040219">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5040227">=</span>&nbsp;<span class="num" id="5040229">1</span>&nbsp;<span class="op" id="5040231">+</span>&nbsp;<span class="ident" id="5040233">iota</span>&nbsp;<span class="comment" id="5040238">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040267">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5040286">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040345">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5040364">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="5040418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5040421">var</span>&nbsp;<span class="op" id="5040425">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5040428">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5040491">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040553">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="5040567">sync</span><span class="op" id="5040571">.</span><span class="ident" id="5040572">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040581">userTypeCache</span>&nbsp;<span class="op" id="5040595">=</span>&nbsp;<span class="builtinfunc" id="5040597">make</span><span class="op" id="5040601">(</span><span class="keyword" id="5040602">map</span><span class="op" id="5040605">[</span><span class="ident" id="5040606">reflect</span><span class="op" id="5040613">.</span><span class="ident" id="5040614">Type</span><span class="op" id="5040618">]</span><span class="op" id="5040619">*</span><span class="ident" id="5040620">userTypeInfo</span><span class="op" id="5040632">)</span><br>
<span class="lineno"></span><span class="op" id="5040634">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5040637">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5040725">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="5040815">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="5040833">func</span>&nbsp;<span class="ident" id="5040838">validUserType</span><span class="op" id="5040851">(</span><span class="ident" id="5040852">rt</span>&nbsp;<span class="ident" id="5040855">reflect</span><span class="op" id="5040862">.</span><span class="ident" id="5040863">Type</span><span class="op" id="5040867">)</span>&nbsp;<span class="op" id="5040869">(</span><span class="ident" id="5040870">ut</span>&nbsp;<span class="op" id="5040873">*</span><span class="ident" id="5040874">userTypeInfo</span><span class="op" id="5040886">,</span>&nbsp;<span class="ident" id="5040888">err</span>&nbsp;<span class="builtintype" id="5040892">error</span><span class="op" id="5040897">)</span>&nbsp;<span class="op" id="5040899">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040902">userTypeLock</span><span class="op" id="5040914">.</span><span class="ident" id="5040915">RLock</span><span class="op" id="5040920">(</span><span class="op" id="5040921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040924">ut</span>&nbsp;<span class="op" id="5040927">=</span>&nbsp;<span class="ident" id="5040929">userTypeCache</span><span class="op" id="5040942">[</span><span class="ident" id="5040943">rt</span><span class="op" id="5040945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040948">userTypeLock</span><span class="op" id="5040960">.</span><span class="ident" id="5040961">RUnlock</span><span class="op" id="5040968">(</span><span class="op" id="5040969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040972">if</span>&nbsp;<span class="ident" id="5040975">ut</span>&nbsp;<span class="op" id="5040978">!=</span>&nbsp;<span class="ident" id="5040981">nil</span>&nbsp;<span class="op" id="5040985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040989">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041000">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041044">userTypeLock</span><span class="op" id="5041056">.</span><span class="ident" id="5041057">Lock</span><span class="op" id="5041061">(</span><span class="op" id="5041062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041065">defer</span>&nbsp;<span class="ident" id="5041071">userTypeLock</span><span class="op" id="5041083">.</span><span class="ident" id="5041084">Unlock</span><span class="op" id="5041090">(</span><span class="op" id="5041091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041094">if</span>&nbsp;<span class="ident" id="5041097">ut</span>&nbsp;<span class="op" id="5041100">=</span>&nbsp;<span class="ident" id="5041102">userTypeCache</span><span class="op" id="5041115">[</span><span class="ident" id="5041116">rt</span><span class="op" id="5041118">]</span><span class="op" id="5041119">;</span>&nbsp;<span class="ident" id="5041121">ut</span>&nbsp;<span class="op" id="5041124">!=</span>&nbsp;<span class="ident" id="5041127">nil</span>&nbsp;<span class="op" id="5041131">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041135">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041170">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041181">ut</span>&nbsp;<span class="op" id="5041184">=</span>&nbsp;<span class="builtinfunc" id="5041186">new</span><span class="op" id="5041189">(</span><span class="ident" id="5041190">userTypeInfo</span><span class="op" id="5041202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041205">ut</span><span class="op" id="5041207">.</span><span class="ident" id="5041208">base</span>&nbsp;<span class="op" id="5041213">=</span>&nbsp;<span class="ident" id="5041215">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041219">ut</span><span class="op" id="5041221">.</span><span class="ident" id="5041222">user</span>&nbsp;<span class="op" id="5041227">=</span>&nbsp;<span class="ident" id="5041229">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041233">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041304">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041373">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041441">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041511">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041561">slowpoke</span>&nbsp;<span class="op" id="5041570">:=</span>&nbsp;<span class="ident" id="5041573">ut</span><span class="op" id="5041575">.</span><span class="ident" id="5041576">base</span>&nbsp;<span class="comment" id="5041581">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041615">for</span>&nbsp;<span class="op" id="5041619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041623">pt</span>&nbsp;<span class="op" id="5041626">:=</span>&nbsp;<span class="ident" id="5041629">ut</span><span class="op" id="5041631">.</span><span class="ident" id="5041632">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041639">if</span>&nbsp;<span class="ident" id="5041642">pt</span><span class="op" id="5041644">.</span><span class="ident" id="5041645">Kind</span><span class="op" id="5041649">(</span><span class="op" id="5041650">)</span>&nbsp;<span class="op" id="5041652">!=</span>&nbsp;<span class="ident" id="5041655">reflect</span><span class="op" id="5041662">.</span><span class="ident" id="5041663">Ptr</span>&nbsp;<span class="op" id="5041667">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041672">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041684">ut</span><span class="op" id="5041686">.</span><span class="ident" id="5041687">base</span>&nbsp;<span class="op" id="5041692">=</span>&nbsp;<span class="ident" id="5041694">pt</span><span class="op" id="5041696">.</span><span class="ident" id="5041697">Elem</span><span class="op" id="5041701">(</span><span class="op" id="5041702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041706">if</span>&nbsp;<span class="ident" id="5041709">ut</span><span class="op" id="5041711">.</span><span class="ident" id="5041712">base</span>&nbsp;<span class="op" id="5041717">==</span>&nbsp;<span class="ident" id="5041720">slowpoke</span>&nbsp;<span class="op" id="5041729">{</span>&nbsp;<span class="comment" id="5041731">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041761">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041791">return</span>&nbsp;<span class="ident" id="5041798">nil</span><span class="op" id="5041801">,</span>&nbsp;<span class="ident" id="5041803">errors</span><span class="op" id="5041809">.</span><span class="ident" id="5041810">New</span><span class="op" id="5041813">(</span><span class="string" id="5041814">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5041856">+</span>&nbsp;<span class="ident" id="5041858">ut</span><span class="op" id="5041860">.</span><span class="ident" id="5041861">base</span><span class="op" id="5041865">.</span><span class="ident" id="5041866">String</span><span class="op" id="5041872">(</span><span class="op" id="5041873">)</span><span class="op" id="5041874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041882">if</span>&nbsp;<span class="ident" id="5041885">ut</span><span class="op" id="5041887">.</span><span class="ident" id="5041888">indir</span><span class="op" id="5041893">%</span><span class="num" id="5041894">2</span>&nbsp;<span class="op" id="5041896">==</span>&nbsp;<span class="num" id="5041899">0</span>&nbsp;<span class="op" id="5041901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041906">slowpoke</span>&nbsp;<span class="op" id="5041915">=</span>&nbsp;<span class="ident" id="5041917">slowpoke</span><span class="op" id="5041925">.</span><span class="ident" id="5041926">Elem</span><span class="op" id="5041930">(</span><span class="op" id="5041931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041935">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041939">ut</span><span class="op" id="5041941">.</span><span class="ident" id="5041942">indir</span><span class="op" id="5041947">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041955">if</span>&nbsp;<span class="ident" id="5041958">ok</span><span class="op" id="5041960">,</span>&nbsp;<span class="ident" id="5041962">indir</span>&nbsp;<span class="op" id="5041968">:=</span>&nbsp;<span class="ident" id="5041971">implementsInterface</span><span class="op" id="5041990">(</span><span class="ident" id="5041991">ut</span><span class="op" id="5041993">.</span><span class="ident" id="5041994">user</span><span class="op" id="5041998">,</span>&nbsp;<span class="ident" id="5042000">gobEncoderInterfaceType</span><span class="op" id="5042023">)</span><span class="op" id="5042024">;</span>&nbsp;<span class="ident" id="5042026">ok</span>&nbsp;<span class="op" id="5042029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042033">ut</span><span class="op" id="5042035">.</span><span class="ident" id="5042036">externalEnc</span><span class="op" id="5042047">,</span>&nbsp;<span class="ident" id="5042049">ut</span><span class="op" id="5042051">.</span><span class="ident" id="5042052">encIndir</span>&nbsp;<span class="op" id="5042061">=</span>&nbsp;<span class="ident" id="5042063">xGob</span><span class="op" id="5042067">,</span>&nbsp;<span class="ident" id="5042069">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042076">}</span>&nbsp;<span class="keyword" id="5042078">else</span>&nbsp;<span class="keyword" id="5042083">if</span>&nbsp;<span class="ident" id="5042086">ok</span><span class="op" id="5042088">,</span>&nbsp;<span class="ident" id="5042090">indir</span>&nbsp;<span class="op" id="5042096">:=</span>&nbsp;<span class="ident" id="5042099">implementsInterface</span><span class="op" id="5042118">(</span><span class="ident" id="5042119">ut</span><span class="op" id="5042121">.</span><span class="ident" id="5042122">user</span><span class="op" id="5042126">,</span>&nbsp;<span class="ident" id="5042128">binaryMarshalerInterfaceType</span><span class="op" id="5042156">)</span><span class="op" id="5042157">;</span>&nbsp;<span class="ident" id="5042159">ok</span>&nbsp;<span class="op" id="5042162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042166">ut</span><span class="op" id="5042168">.</span><span class="ident" id="5042169">externalEnc</span><span class="op" id="5042180">,</span>&nbsp;<span class="ident" id="5042182">ut</span><span class="op" id="5042184">.</span><span class="ident" id="5042185">encIndir</span>&nbsp;<span class="op" id="5042194">=</span>&nbsp;<span class="ident" id="5042196">xBinary</span><span class="op" id="5042203">,</span>&nbsp;<span class="ident" id="5042205">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042216">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042300">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042364">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042454">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042502">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042509">if</span>&nbsp;<span class="ident" id="5042512">ok</span><span class="op" id="5042514">,</span>&nbsp;<span class="ident" id="5042516">indir</span>&nbsp;<span class="op" id="5042522">:=</span>&nbsp;<span class="ident" id="5042525">implementsInterface</span><span class="op" id="5042544">(</span><span class="ident" id="5042545">ut</span><span class="op" id="5042547">.</span><span class="ident" id="5042548">user</span><span class="op" id="5042552">,</span>&nbsp;<span class="ident" id="5042554">gobDecoderInterfaceType</span><span class="op" id="5042577">)</span><span class="op" id="5042578">;</span>&nbsp;<span class="ident" id="5042580">ok</span>&nbsp;<span class="op" id="5042583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042587">ut</span><span class="op" id="5042589">.</span><span class="ident" id="5042590">externalDec</span><span class="op" id="5042601">,</span>&nbsp;<span class="ident" id="5042603">ut</span><span class="op" id="5042605">.</span><span class="ident" id="5042606">decIndir</span>&nbsp;<span class="op" id="5042615">=</span>&nbsp;<span class="ident" id="5042617">xGob</span><span class="op" id="5042621">,</span>&nbsp;<span class="ident" id="5042623">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042630">}</span>&nbsp;<span class="keyword" id="5042632">else</span>&nbsp;<span class="keyword" id="5042637">if</span>&nbsp;<span class="ident" id="5042640">ok</span><span class="op" id="5042642">,</span>&nbsp;<span class="ident" id="5042644">indir</span>&nbsp;<span class="op" id="5042650">:=</span>&nbsp;<span class="ident" id="5042653">implementsInterface</span><span class="op" id="5042672">(</span><span class="ident" id="5042673">ut</span><span class="op" id="5042675">.</span><span class="ident" id="5042676">user</span><span class="op" id="5042680">,</span>&nbsp;<span class="ident" id="5042682">binaryUnmarshalerInterfaceType</span><span class="op" id="5042712">)</span><span class="op" id="5042713">;</span>&nbsp;<span class="ident" id="5042715">ok</span>&nbsp;<span class="op" id="5042718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042722">ut</span><span class="op" id="5042724">.</span><span class="ident" id="5042725">externalDec</span><span class="op" id="5042736">,</span>&nbsp;<span class="ident" id="5042738">ut</span><span class="op" id="5042740">.</span><span class="ident" id="5042741">decIndir</span>&nbsp;<span class="op" id="5042750">=</span>&nbsp;<span class="ident" id="5042752">xBinary</span><span class="op" id="5042759">,</span>&nbsp;<span class="ident" id="5042761">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042768">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042772">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042792">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042884">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042932">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042939">userTypeCache</span><span class="op" id="5042952">[</span><span class="ident" id="5042953">rt</span><span class="op" id="5042955">]</span>&nbsp;<span class="op" id="5042957">=</span>&nbsp;<span class="ident" id="5042959">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042963">return</span><br>
<span class="lineno"></span><span class="op" id="5042970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5042973">var</span>&nbsp;<span class="op" id="5042977">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042980">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5043011">=</span>&nbsp;<span class="ident" id="5043013">reflect</span><span class="op" id="5043020">.</span><span class="ident" id="5043021">TypeOf</span><span class="op" id="5043027">(</span><span class="op" id="5043028">(</span><span class="op" id="5043029">*</span><span class="ident" id="5043030">GobEncoder</span><span class="op" id="5043040">)</span><span class="op" id="5043041">(</span><span class="ident" id="5043042">nil</span><span class="op" id="5043045">)</span><span class="op" id="5043046">)</span><span class="op" id="5043047">.</span><span class="ident" id="5043048">Elem</span><span class="op" id="5043052">(</span><span class="op" id="5043053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043056">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5043087">=</span>&nbsp;<span class="ident" id="5043089">reflect</span><span class="op" id="5043096">.</span><span class="ident" id="5043097">TypeOf</span><span class="op" id="5043103">(</span><span class="op" id="5043104">(</span><span class="op" id="5043105">*</span><span class="ident" id="5043106">GobDecoder</span><span class="op" id="5043116">)</span><span class="op" id="5043117">(</span><span class="ident" id="5043118">nil</span><span class="op" id="5043121">)</span><span class="op" id="5043122">)</span><span class="op" id="5043123">.</span><span class="ident" id="5043124">Elem</span><span class="op" id="5043128">(</span><span class="op" id="5043129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043132">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5043163">=</span>&nbsp;<span class="ident" id="5043165">reflect</span><span class="op" id="5043172">.</span><span class="ident" id="5043173">TypeOf</span><span class="op" id="5043179">(</span><span class="op" id="5043180">(</span><span class="op" id="5043181">*</span><span class="ident" id="5043182">encoding</span><span class="op" id="5043190">.</span><span class="ident" id="5043191">BinaryMarshaler</span><span class="op" id="5043206">)</span><span class="op" id="5043207">(</span><span class="ident" id="5043208">nil</span><span class="op" id="5043211">)</span><span class="op" id="5043212">)</span><span class="op" id="5043213">.</span><span class="ident" id="5043214">Elem</span><span class="op" id="5043218">(</span><span class="op" id="5043219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043222">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="5043253">=</span>&nbsp;<span class="ident" id="5043255">reflect</span><span class="op" id="5043262">.</span><span class="ident" id="5043263">TypeOf</span><span class="op" id="5043269">(</span><span class="op" id="5043270">(</span><span class="op" id="5043271">*</span><span class="ident" id="5043272">encoding</span><span class="op" id="5043280">.</span><span class="ident" id="5043281">BinaryUnmarshaler</span><span class="op" id="5043298">)</span><span class="op" id="5043299">(</span><span class="ident" id="5043300">nil</span><span class="op" id="5043303">)</span><span class="op" id="5043304">)</span><span class="op" id="5043305">.</span><span class="ident" id="5043306">Elem</span><span class="op" id="5043310">(</span><span class="op" id="5043311">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043314">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5043345">=</span>&nbsp;<span class="ident" id="5043347">reflect</span><span class="op" id="5043354">.</span><span class="ident" id="5043355">TypeOf</span><span class="op" id="5043361">(</span><span class="op" id="5043362">(</span><span class="op" id="5043363">*</span><span class="ident" id="5043364">encoding</span><span class="op" id="5043372">.</span><span class="ident" id="5043373">TextMarshaler</span><span class="op" id="5043386">)</span><span class="op" id="5043387">(</span><span class="ident" id="5043388">nil</span><span class="op" id="5043391">)</span><span class="op" id="5043392">)</span><span class="op" id="5043393">.</span><span class="ident" id="5043394">Elem</span><span class="op" id="5043398">(</span><span class="op" id="5043399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043402">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5043433">=</span>&nbsp;<span class="ident" id="5043435">reflect</span><span class="op" id="5043442">.</span><span class="ident" id="5043443">TypeOf</span><span class="op" id="5043449">(</span><span class="op" id="5043450">(</span><span class="op" id="5043451">*</span><span class="ident" id="5043452">encoding</span><span class="op" id="5043460">.</span><span class="ident" id="5043461">TextUnmarshaler</span><span class="op" id="5043476">)</span><span class="op" id="5043477">(</span><span class="ident" id="5043478">nil</span><span class="op" id="5043481">)</span><span class="op" id="5043482">)</span><span class="op" id="5043483">.</span><span class="ident" id="5043484">Elem</span><span class="op" id="5043488">(</span><span class="op" id="5043489">)</span><br>
<span class="lineno"></span><span class="op" id="5043491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5043494">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="5043557">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5043593">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5043662">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5043681">func</span>&nbsp;<span class="ident" id="5043686">implementsInterface</span><span class="op" id="5043705">(</span><span class="ident" id="5043706">typ</span><span class="op" id="5043709">,</span>&nbsp;<span class="ident" id="5043711">gobEncDecType</span>&nbsp;<span class="ident" id="5043725">reflect</span><span class="op" id="5043732">.</span><span class="ident" id="5043733">Type</span><span class="op" id="5043737">)</span>&nbsp;<span class="op" id="5043739">(</span><span class="ident" id="5043740">success</span>&nbsp;<span class="builtintype" id="5043748">bool</span><span class="op" id="5043752">,</span>&nbsp;<span class="ident" id="5043754">indir</span>&nbsp;<span class="builtintype" id="5043760">int8</span><span class="op" id="5043764">)</span>&nbsp;<span class="op" id="5043766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043769">if</span>&nbsp;<span class="ident" id="5043772">typ</span>&nbsp;<span class="op" id="5043776">==</span>&nbsp;<span class="ident" id="5043779">nil</span>&nbsp;<span class="op" id="5043783">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043798">rt</span>&nbsp;<span class="op" id="5043801">:=</span>&nbsp;<span class="ident" id="5043804">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043809">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043861">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043929">for</span>&nbsp;<span class="op" id="5043933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043937">if</span>&nbsp;<span class="ident" id="5043940">rt</span><span class="op" id="5043942">.</span><span class="ident" id="5043943">Implements</span><span class="op" id="5043953">(</span><span class="ident" id="5043954">gobEncDecType</span><span class="op" id="5043967">)</span>&nbsp;<span class="op" id="5043969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043974">return</span>&nbsp;<span class="builtintype" id="5043981">true</span><span class="op" id="5043985">,</span>&nbsp;<span class="ident" id="5043987">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043999">if</span>&nbsp;<span class="ident" id="5044002">p</span>&nbsp;<span class="op" id="5044004">:=</span>&nbsp;<span class="ident" id="5044007">rt</span><span class="op" id="5044009">;</span>&nbsp;<span class="ident" id="5044011">p</span><span class="op" id="5044012">.</span><span class="ident" id="5044013">Kind</span><span class="op" id="5044017">(</span><span class="op" id="5044018">)</span>&nbsp;<span class="op" id="5044020">==</span>&nbsp;<span class="ident" id="5044023">reflect</span><span class="op" id="5044030">.</span><span class="ident" id="5044031">Ptr</span>&nbsp;<span class="op" id="5044035">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044040">indir</span><span class="op" id="5044045">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044051">if</span>&nbsp;<span class="ident" id="5044054">indir</span>&nbsp;<span class="op" id="5044060">&gt;</span>&nbsp;<span class="num" id="5044062">100</span>&nbsp;<span class="op" id="5044066">{</span>&nbsp;<span class="comment" id="5044068">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044105">return</span>&nbsp;<span class="builtintype" id="5044112">false</span><span class="op" id="5044117">,</span>&nbsp;<span class="num" id="5044119">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044129">rt</span>&nbsp;<span class="op" id="5044132">=</span>&nbsp;<span class="ident" id="5044134">p</span><span class="op" id="5044135">.</span><span class="ident" id="5044136">Elem</span><span class="op" id="5044140">(</span><span class="op" id="5044141">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044146">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044161">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5044171">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044257">if</span>&nbsp;<span class="ident" id="5044260">typ</span><span class="op" id="5044263">.</span><span class="ident" id="5044264">Kind</span><span class="op" id="5044268">(</span><span class="op" id="5044269">)</span>&nbsp;<span class="op" id="5044271">!=</span>&nbsp;<span class="ident" id="5044274">reflect</span><span class="op" id="5044281">.</span><span class="ident" id="5044282">Ptr</span>&nbsp;<span class="op" id="5044286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5044290">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044337">if</span>&nbsp;<span class="ident" id="5044340">reflect</span><span class="op" id="5044347">.</span><span class="ident" id="5044348">PtrTo</span><span class="op" id="5044353">(</span><span class="ident" id="5044354">typ</span><span class="op" id="5044357">)</span><span class="op" id="5044358">.</span><span class="ident" id="5044359">Implements</span><span class="op" id="5044369">(</span><span class="ident" id="5044370">gobEncDecType</span><span class="op" id="5044383">)</span>&nbsp;<span class="op" id="5044385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044390">return</span>&nbsp;<span class="builtintype" id="5044397">true</span><span class="op" id="5044401">,</span>&nbsp;<span class="op" id="5044403">-</span><span class="num" id="5044404">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044408">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044414">return</span>&nbsp;<span class="builtintype" id="5044421">false</span><span class="op" id="5044426">,</span>&nbsp;<span class="num" id="5044428">0</span><br>
<span class="lineno"></span><span class="op" id="5044430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044433">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="5044520">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5044570">func</span>&nbsp;<span class="ident" id="5044575">userType</span><span class="op" id="5044583">(</span><span class="ident" id="5044584">rt</span>&nbsp;<span class="ident" id="5044587">reflect</span><span class="op" id="5044594">.</span><span class="ident" id="5044595">Type</span><span class="op" id="5044599">)</span>&nbsp;<span class="op" id="5044601">*</span><span class="ident" id="5044602">userTypeInfo</span>&nbsp;<span class="op" id="5044615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044618">ut</span><span class="op" id="5044620">,</span>&nbsp;<span class="ident" id="5044622">err</span>&nbsp;<span class="op" id="5044626">:=</span>&nbsp;<span class="ident" id="5044629">validUserType</span><span class="op" id="5044642">(</span><span class="ident" id="5044643">rt</span><span class="op" id="5044645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044648">if</span>&nbsp;<span class="ident" id="5044651">err</span>&nbsp;<span class="op" id="5044655">!=</span>&nbsp;<span class="ident" id="5044658">nil</span>&nbsp;<span class="op" id="5044662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044666">error_</span><span class="op" id="5044672">(</span><span class="ident" id="5044673">err</span><span class="op" id="5044676">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044682">return</span>&nbsp;<span class="ident" id="5044689">ut</span><br>
<span class="lineno"></span><span class="op" id="5044692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044695">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="5044775">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="5044861">type</span>&nbsp;<span class="ident" id="5044866">typeId</span>&nbsp;<span class="builtintype" id="5044873">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5044880">var</span>&nbsp;<span class="ident" id="5044884">nextId</span>&nbsp;<span class="ident" id="5044891">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044904">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="5044946">var</span>&nbsp;<span class="ident" id="5044950">typeLock</span>&nbsp;<span class="ident" id="5044959">sync</span><span class="op" id="5044963">.</span><span class="ident" id="5044964">Mutex</span>&nbsp;<span class="comment" id="5044970">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="5044999">const</span>&nbsp;<span class="ident" id="5045005">firstUserId</span>&nbsp;<span class="op" id="5045017">=</span>&nbsp;<span class="num" id="5045019">64</span>&nbsp;&nbsp;<span class="comment" id="5045023">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5045060">type</span>&nbsp;<span class="ident" id="5045065">gobType</span>&nbsp;<span class="keyword" id="5045073">interface</span>&nbsp;<span class="op" id="5045083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045086">id</span><span class="op" id="5045088">(</span><span class="op" id="5045089">)</span>&nbsp;<span class="ident" id="5045091">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045099">setId</span><span class="op" id="5045104">(</span><span class="ident" id="5045105">id</span>&nbsp;<span class="ident" id="5045108">typeId</span><span class="op" id="5045114">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045117">name</span><span class="op" id="5045121">(</span><span class="op" id="5045122">)</span>&nbsp;<span class="builtintype" id="5045124">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5045132">string</span><span class="op" id="5045138">(</span><span class="op" id="5045139">)</span>&nbsp;<span class="builtintype" id="5045141">string</span>&nbsp;<span class="comment" id="5045148">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045183">safeString</span><span class="op" id="5045193">(</span><span class="ident" id="5045194">seen</span>&nbsp;<span class="keyword" id="5045199">map</span><span class="op" id="5045202">[</span><span class="ident" id="5045203">typeId</span><span class="op" id="5045209">]</span><span class="builtintype" id="5045210">bool</span><span class="op" id="5045214">)</span>&nbsp;<span class="builtintype" id="5045216">string</span><br>
<span class="lineno"></span><span class="op" id="5045223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5045226">var</span>&nbsp;<span class="ident" id="5045230">types</span>&nbsp;<span class="op" id="5045236">=</span>&nbsp;<span class="builtinfunc" id="5045238">make</span><span class="op" id="5045242">(</span><span class="keyword" id="5045243">map</span><span class="op" id="5045246">[</span><span class="ident" id="5045247">reflect</span><span class="op" id="5045254">.</span><span class="ident" id="5045255">Type</span><span class="op" id="5045259">]</span><span class="ident" id="5045260">gobType</span><span class="op" id="5045267">)</span><br>
<span class="lineno"></span><span class="keyword" id="5045269">var</span>&nbsp;<span class="ident" id="5045273">idToType</span>&nbsp;<span class="op" id="5045282">=</span>&nbsp;<span class="builtinfunc" id="5045284">make</span><span class="op" id="5045288">(</span><span class="keyword" id="5045289">map</span><span class="op" id="5045292">[</span><span class="ident" id="5045293">typeId</span><span class="op" id="5045299">]</span><span class="ident" id="5045300">gobType</span><span class="op" id="5045307">)</span><br>
<span class="lineno"></span><span class="keyword" id="5045309">var</span>&nbsp;<span class="ident" id="5045313">builtinIdToType</span>&nbsp;<span class="keyword" id="5045329">map</span><span class="op" id="5045332">[</span><span class="ident" id="5045333">typeId</span><span class="op" id="5045339">]</span><span class="ident" id="5045340">gobType</span>&nbsp;<span class="comment" id="5045348">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5045397">func</span>&nbsp;<span class="ident" id="5045402">setTypeId</span><span class="op" id="5045411">(</span><span class="ident" id="5045412">typ</span>&nbsp;<span class="ident" id="5045416">gobType</span><span class="op" id="5045423">)</span>&nbsp;<span class="op" id="5045425">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5045428">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045496">if</span>&nbsp;<span class="ident" id="5045499">typ</span><span class="op" id="5045502">.</span><span class="ident" id="5045503">id</span><span class="op" id="5045505">(</span><span class="op" id="5045506">)</span>&nbsp;<span class="op" id="5045508">!=</span>&nbsp;<span class="num" id="5045511">0</span>&nbsp;<span class="op" id="5045513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045528">nextId</span><span class="op" id="5045534">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045538">typ</span><span class="op" id="5045541">.</span><span class="ident" id="5045542">setId</span><span class="op" id="5045547">(</span><span class="ident" id="5045548">nextId</span><span class="op" id="5045554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045557">idToType</span><span class="op" id="5045565">[</span><span class="ident" id="5045566">nextId</span><span class="op" id="5045572">]</span>&nbsp;<span class="op" id="5045574">=</span>&nbsp;<span class="ident" id="5045576">typ</span><br>
<span class="lineno"></span><span class="op" id="5045580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5045583">func</span>&nbsp;<span class="op" id="5045588">(</span><span class="ident" id="5045589">t</span>&nbsp;<span class="ident" id="5045591">typeId</span><span class="op" id="5045597">)</span>&nbsp;<span class="ident" id="5045599">gobType</span><span class="op" id="5045606">(</span><span class="op" id="5045607">)</span>&nbsp;<span class="ident" id="5045609">gobType</span>&nbsp;<span class="op" id="5045617">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045620">if</span>&nbsp;<span class="ident" id="5045623">t</span>&nbsp;<span class="op" id="5045625">==</span>&nbsp;<span class="num" id="5045628">0</span>&nbsp;<span class="op" id="5045630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045634">return</span>&nbsp;<span class="ident" id="5045641">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045649">return</span>&nbsp;<span class="ident" id="5045656">idToType</span><span class="op" id="5045664">[</span><span class="ident" id="5045665">t</span><span class="op" id="5045666">]</span><br>
<span class="lineno"></span><span class="op" id="5045668">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="5045671">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="5045755">func</span>&nbsp;<span class="op" id="5045760">(</span><span class="ident" id="5045761">t</span>&nbsp;<span class="ident" id="5045763">typeId</span><span class="op" id="5045769">)</span>&nbsp;<span class="builtintype" id="5045771">string</span><span class="op" id="5045777">(</span><span class="op" id="5045778">)</span>&nbsp;<span class="builtintype" id="5045780">string</span>&nbsp;<span class="op" id="5045787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045790">if</span>&nbsp;<span class="ident" id="5045793">t</span><span class="op" id="5045794">.</span><span class="ident" id="5045795">gobType</span><span class="op" id="5045802">(</span><span class="op" id="5045803">)</span>&nbsp;<span class="op" id="5045805">==</span>&nbsp;<span class="ident" id="5045808">nil</span>&nbsp;<span class="op" id="5045812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045816">return</span>&nbsp;<span class="string" id="5045823">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045835">return</span>&nbsp;<span class="ident" id="5045842">t</span><span class="op" id="5045843">.</span><span class="ident" id="5045844">gobType</span><span class="op" id="5045851">(</span><span class="op" id="5045852">)</span><span class="op" id="5045853">.</span><span class="builtintype" id="5045854">string</span><span class="op" id="5045860">(</span><span class="op" id="5045861">)</span><br>
<span class="lineno"></span><span class="op" id="5045863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045866">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="5045931">func</span>&nbsp;<span class="op" id="5045936">(</span><span class="ident" id="5045937">t</span>&nbsp;<span class="ident" id="5045939">typeId</span><span class="op" id="5045945">)</span>&nbsp;<span class="ident" id="5045947">name</span><span class="op" id="5045951">(</span><span class="op" id="5045952">)</span>&nbsp;<span class="builtintype" id="5045954">string</span>&nbsp;<span class="op" id="5045961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045964">if</span>&nbsp;<span class="ident" id="5045967">t</span><span class="op" id="5045968">.</span><span class="ident" id="5045969">gobType</span><span class="op" id="5045976">(</span><span class="op" id="5045977">)</span>&nbsp;<span class="op" id="5045979">==</span>&nbsp;<span class="ident" id="5045982">nil</span>&nbsp;<span class="op" id="5045986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045990">return</span>&nbsp;<span class="string" id="5045997">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046009">return</span>&nbsp;<span class="ident" id="5046016">t</span><span class="op" id="5046017">.</span><span class="ident" id="5046018">gobType</span><span class="op" id="5046025">(</span><span class="op" id="5046026">)</span><span class="op" id="5046027">.</span><span class="ident" id="5046028">name</span><span class="op" id="5046032">(</span><span class="op" id="5046033">)</span><br>
<span class="lineno">220</span><span class="op" id="5046035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5046038">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="5046081">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5046156">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="5046233">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5046276">type</span>&nbsp;<span class="ident" id="5046281">CommonType</span>&nbsp;<span class="keyword" id="5046292">struct</span>&nbsp;<span class="op" id="5046299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046302">Name</span>&nbsp;<span class="builtintype" id="5046307">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046315">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5046320">typeId</span><br>
<span class="lineno"></span><span class="op" id="5046327">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5046330">func</span>&nbsp;<span class="op" id="5046335">(</span><span class="ident" id="5046336">t</span>&nbsp;<span class="op" id="5046338">*</span><span class="ident" id="5046339">CommonType</span><span class="op" id="5046349">)</span>&nbsp;<span class="ident" id="5046351">id</span><span class="op" id="5046353">(</span><span class="op" id="5046354">)</span>&nbsp;<span class="ident" id="5046356">typeId</span>&nbsp;<span class="op" id="5046363">{</span>&nbsp;<span class="keyword" id="5046365">return</span>&nbsp;<span class="ident" id="5046372">t</span><span class="op" id="5046373">.</span><span class="ident" id="5046374">Id</span>&nbsp;<span class="op" id="5046377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5046380">func</span>&nbsp;<span class="op" id="5046385">(</span><span class="ident" id="5046386">t</span>&nbsp;<span class="op" id="5046388">*</span><span class="ident" id="5046389">CommonType</span><span class="op" id="5046399">)</span>&nbsp;<span class="ident" id="5046401">setId</span><span class="op" id="5046406">(</span><span class="ident" id="5046407">id</span>&nbsp;<span class="ident" id="5046410">typeId</span><span class="op" id="5046416">)</span>&nbsp;<span class="op" id="5046418">{</span>&nbsp;<span class="ident" id="5046420">t</span><span class="op" id="5046421">.</span><span class="ident" id="5046422">Id</span>&nbsp;<span class="op" id="5046425">=</span>&nbsp;<span class="ident" id="5046427">id</span>&nbsp;<span class="op" id="5046430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5046433">func</span>&nbsp;<span class="op" id="5046438">(</span><span class="ident" id="5046439">t</span>&nbsp;<span class="op" id="5046441">*</span><span class="ident" id="5046442">CommonType</span><span class="op" id="5046452">)</span>&nbsp;<span class="builtintype" id="5046454">string</span><span class="op" id="5046460">(</span><span class="op" id="5046461">)</span>&nbsp;<span class="builtintype" id="5046463">string</span>&nbsp;<span class="op" id="5046470">{</span>&nbsp;<span class="keyword" id="5046472">return</span>&nbsp;<span class="ident" id="5046479">t</span><span class="op" id="5046480">.</span><span class="ident" id="5046481">Name</span>&nbsp;<span class="op" id="5046486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5046489">func</span>&nbsp;<span class="op" id="5046494">(</span><span class="ident" id="5046495">t</span>&nbsp;<span class="op" id="5046497">*</span><span class="ident" id="5046498">CommonType</span><span class="op" id="5046508">)</span>&nbsp;<span class="ident" id="5046510">safeString</span><span class="op" id="5046520">(</span><span class="ident" id="5046521">seen</span>&nbsp;<span class="keyword" id="5046526">map</span><span class="op" id="5046529">[</span><span class="ident" id="5046530">typeId</span><span class="op" id="5046536">]</span><span class="builtintype" id="5046537">bool</span><span class="op" id="5046541">)</span>&nbsp;<span class="builtintype" id="5046543">string</span>&nbsp;<span class="op" id="5046550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046553">return</span>&nbsp;<span class="ident" id="5046560">t</span><span class="op" id="5046561">.</span><span class="ident" id="5046562">Name</span><br>
<span class="lineno"></span><span class="op" id="5046567">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5046570">func</span>&nbsp;<span class="op" id="5046575">(</span><span class="ident" id="5046576">t</span>&nbsp;<span class="op" id="5046578">*</span><span class="ident" id="5046579">CommonType</span><span class="op" id="5046589">)</span>&nbsp;<span class="ident" id="5046591">name</span><span class="op" id="5046595">(</span><span class="op" id="5046596">)</span>&nbsp;<span class="builtintype" id="5046598">string</span>&nbsp;<span class="op" id="5046605">{</span>&nbsp;<span class="keyword" id="5046607">return</span>&nbsp;<span class="ident" id="5046614">t</span><span class="op" id="5046615">.</span><span class="ident" id="5046616">Name</span>&nbsp;<span class="op" id="5046621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5046624">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="5046661">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5046739">var</span>&nbsp;<span class="op" id="5046743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046746">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046798">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046852">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046903">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5046914">=</span>&nbsp;<span class="ident" id="5046916">bootstrapType</span><span class="op" id="5046929">(</span><span class="string" id="5046930">&#34;bool&#34;</span><span class="op" id="5046936">,</span>&nbsp;<span class="op" id="5046938">(</span><span class="op" id="5046939">*</span><span class="builtintype" id="5046940">bool</span><span class="op" id="5046944">)</span><span class="op" id="5046945">(</span><span class="ident" id="5046946">nil</span><span class="op" id="5046949">)</span><span class="op" id="5046950">,</span>&nbsp;<span class="num" id="5046952">1</span><span class="op" id="5046953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046956">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5046967">=</span>&nbsp;<span class="ident" id="5046969">bootstrapType</span><span class="op" id="5046982">(</span><span class="string" id="5046983">&#34;int&#34;</span><span class="op" id="5046988">,</span>&nbsp;<span class="op" id="5046990">(</span><span class="op" id="5046991">*</span><span class="builtintype" id="5046992">int</span><span class="op" id="5046995">)</span><span class="op" id="5046996">(</span><span class="ident" id="5046997">nil</span><span class="op" id="5047000">)</span><span class="op" id="5047001">,</span>&nbsp;<span class="num" id="5047003">2</span><span class="op" id="5047004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047007">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047018">=</span>&nbsp;<span class="ident" id="5047020">bootstrapType</span><span class="op" id="5047033">(</span><span class="string" id="5047034">&#34;uint&#34;</span><span class="op" id="5047040">,</span>&nbsp;<span class="op" id="5047042">(</span><span class="op" id="5047043">*</span><span class="builtintype" id="5047044">uint</span><span class="op" id="5047048">)</span><span class="op" id="5047049">(</span><span class="ident" id="5047050">nil</span><span class="op" id="5047053">)</span><span class="op" id="5047054">,</span>&nbsp;<span class="num" id="5047056">3</span><span class="op" id="5047057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047060">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047071">=</span>&nbsp;<span class="ident" id="5047073">bootstrapType</span><span class="op" id="5047086">(</span><span class="string" id="5047087">&#34;float&#34;</span><span class="op" id="5047094">,</span>&nbsp;<span class="op" id="5047096">(</span><span class="op" id="5047097">*</span><span class="builtintype" id="5047098">float64</span><span class="op" id="5047105">)</span><span class="op" id="5047106">(</span><span class="ident" id="5047107">nil</span><span class="op" id="5047110">)</span><span class="op" id="5047111">,</span>&nbsp;<span class="num" id="5047113">4</span><span class="op" id="5047114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047117">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047128">=</span>&nbsp;<span class="ident" id="5047130">bootstrapType</span><span class="op" id="5047143">(</span><span class="string" id="5047144">&#34;bytes&#34;</span><span class="op" id="5047151">,</span>&nbsp;<span class="op" id="5047153">(</span><span class="op" id="5047154">*</span><span class="op" id="5047155">[</span><span class="op" id="5047156">]</span><span class="builtintype" id="5047157">byte</span><span class="op" id="5047161">)</span><span class="op" id="5047162">(</span><span class="ident" id="5047163">nil</span><span class="op" id="5047166">)</span><span class="op" id="5047167">,</span>&nbsp;<span class="num" id="5047169">5</span><span class="op" id="5047170">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047173">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047184">=</span>&nbsp;<span class="ident" id="5047186">bootstrapType</span><span class="op" id="5047199">(</span><span class="string" id="5047200">&#34;string&#34;</span><span class="op" id="5047208">,</span>&nbsp;<span class="op" id="5047210">(</span><span class="op" id="5047211">*</span><span class="builtintype" id="5047212">string</span><span class="op" id="5047218">)</span><span class="op" id="5047219">(</span><span class="ident" id="5047220">nil</span><span class="op" id="5047223">)</span><span class="op" id="5047224">,</span>&nbsp;<span class="num" id="5047226">6</span><span class="op" id="5047227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047230">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5047241">=</span>&nbsp;<span class="ident" id="5047243">bootstrapType</span><span class="op" id="5047256">(</span><span class="string" id="5047257">&#34;complex&#34;</span><span class="op" id="5047266">,</span>&nbsp;<span class="op" id="5047268">(</span><span class="op" id="5047269">*</span><span class="builtintype" id="5047270">complex128</span><span class="op" id="5047280">)</span><span class="op" id="5047281">(</span><span class="ident" id="5047282">nil</span><span class="op" id="5047285">)</span><span class="op" id="5047286">,</span>&nbsp;<span class="num" id="5047288">7</span><span class="op" id="5047289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047292">tInterface</span>&nbsp;<span class="op" id="5047303">=</span>&nbsp;<span class="ident" id="5047305">bootstrapType</span><span class="op" id="5047318">(</span><span class="string" id="5047319">&#34;interface&#34;</span><span class="op" id="5047330">,</span>&nbsp;<span class="op" id="5047332">(</span><span class="op" id="5047333">*</span><span class="keyword" id="5047334">interface</span><span class="op" id="5047343">{</span><span class="op" id="5047344">}</span><span class="op" id="5047345">)</span><span class="op" id="5047346">(</span><span class="ident" id="5047347">nil</span><span class="op" id="5047350">)</span><span class="op" id="5047351">,</span>&nbsp;<span class="num" id="5047353">8</span><span class="op" id="5047354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5047357">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047403">tReserved7</span>&nbsp;<span class="op" id="5047414">=</span>&nbsp;<span class="ident" id="5047416">bootstrapType</span><span class="op" id="5047429">(</span><span class="string" id="5047430">&#34;_reserved1&#34;</span><span class="op" id="5047442">,</span>&nbsp;<span class="op" id="5047444">(</span><span class="op" id="5047445">*</span><span class="keyword" id="5047446">struct</span><span class="op" id="5047452">{</span>&nbsp;<span class="ident" id="5047454">r7</span>&nbsp;<span class="builtintype" id="5047457">int</span>&nbsp;<span class="op" id="5047461">}</span><span class="op" id="5047462">)</span><span class="op" id="5047463">(</span><span class="ident" id="5047464">nil</span><span class="op" id="5047467">)</span><span class="op" id="5047468">,</span>&nbsp;<span class="num" id="5047470">9</span><span class="op" id="5047471">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047474">tReserved6</span>&nbsp;<span class="op" id="5047485">=</span>&nbsp;<span class="ident" id="5047487">bootstrapType</span><span class="op" id="5047500">(</span><span class="string" id="5047501">&#34;_reserved1&#34;</span><span class="op" id="5047513">,</span>&nbsp;<span class="op" id="5047515">(</span><span class="op" id="5047516">*</span><span class="keyword" id="5047517">struct</span><span class="op" id="5047523">{</span>&nbsp;<span class="ident" id="5047525">r6</span>&nbsp;<span class="builtintype" id="5047528">int</span>&nbsp;<span class="op" id="5047532">}</span><span class="op" id="5047533">)</span><span class="op" id="5047534">(</span><span class="ident" id="5047535">nil</span><span class="op" id="5047538">)</span><span class="op" id="5047539">,</span>&nbsp;<span class="num" id="5047541">10</span><span class="op" id="5047543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047546">tReserved5</span>&nbsp;<span class="op" id="5047557">=</span>&nbsp;<span class="ident" id="5047559">bootstrapType</span><span class="op" id="5047572">(</span><span class="string" id="5047573">&#34;_reserved1&#34;</span><span class="op" id="5047585">,</span>&nbsp;<span class="op" id="5047587">(</span><span class="op" id="5047588">*</span><span class="keyword" id="5047589">struct</span><span class="op" id="5047595">{</span>&nbsp;<span class="ident" id="5047597">r5</span>&nbsp;<span class="builtintype" id="5047600">int</span>&nbsp;<span class="op" id="5047604">}</span><span class="op" id="5047605">)</span><span class="op" id="5047606">(</span><span class="ident" id="5047607">nil</span><span class="op" id="5047610">)</span><span class="op" id="5047611">,</span>&nbsp;<span class="num" id="5047613">11</span><span class="op" id="5047615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047618">tReserved4</span>&nbsp;<span class="op" id="5047629">=</span>&nbsp;<span class="ident" id="5047631">bootstrapType</span><span class="op" id="5047644">(</span><span class="string" id="5047645">&#34;_reserved1&#34;</span><span class="op" id="5047657">,</span>&nbsp;<span class="op" id="5047659">(</span><span class="op" id="5047660">*</span><span class="keyword" id="5047661">struct</span><span class="op" id="5047667">{</span>&nbsp;<span class="ident" id="5047669">r4</span>&nbsp;<span class="builtintype" id="5047672">int</span>&nbsp;<span class="op" id="5047676">}</span><span class="op" id="5047677">)</span><span class="op" id="5047678">(</span><span class="ident" id="5047679">nil</span><span class="op" id="5047682">)</span><span class="op" id="5047683">,</span>&nbsp;<span class="num" id="5047685">12</span><span class="op" id="5047687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047690">tReserved3</span>&nbsp;<span class="op" id="5047701">=</span>&nbsp;<span class="ident" id="5047703">bootstrapType</span><span class="op" id="5047716">(</span><span class="string" id="5047717">&#34;_reserved1&#34;</span><span class="op" id="5047729">,</span>&nbsp;<span class="op" id="5047731">(</span><span class="op" id="5047732">*</span><span class="keyword" id="5047733">struct</span><span class="op" id="5047739">{</span>&nbsp;<span class="ident" id="5047741">r3</span>&nbsp;<span class="builtintype" id="5047744">int</span>&nbsp;<span class="op" id="5047748">}</span><span class="op" id="5047749">)</span><span class="op" id="5047750">(</span><span class="ident" id="5047751">nil</span><span class="op" id="5047754">)</span><span class="op" id="5047755">,</span>&nbsp;<span class="num" id="5047757">13</span><span class="op" id="5047759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047762">tReserved2</span>&nbsp;<span class="op" id="5047773">=</span>&nbsp;<span class="ident" id="5047775">bootstrapType</span><span class="op" id="5047788">(</span><span class="string" id="5047789">&#34;_reserved1&#34;</span><span class="op" id="5047801">,</span>&nbsp;<span class="op" id="5047803">(</span><span class="op" id="5047804">*</span><span class="keyword" id="5047805">struct</span><span class="op" id="5047811">{</span>&nbsp;<span class="ident" id="5047813">r2</span>&nbsp;<span class="builtintype" id="5047816">int</span>&nbsp;<span class="op" id="5047820">}</span><span class="op" id="5047821">)</span><span class="op" id="5047822">(</span><span class="ident" id="5047823">nil</span><span class="op" id="5047826">)</span><span class="op" id="5047827">,</span>&nbsp;<span class="num" id="5047829">14</span><span class="op" id="5047831">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047834">tReserved1</span>&nbsp;<span class="op" id="5047845">=</span>&nbsp;<span class="ident" id="5047847">bootstrapType</span><span class="op" id="5047860">(</span><span class="string" id="5047861">&#34;_reserved1&#34;</span><span class="op" id="5047873">,</span>&nbsp;<span class="op" id="5047875">(</span><span class="op" id="5047876">*</span><span class="keyword" id="5047877">struct</span><span class="op" id="5047883">{</span>&nbsp;<span class="ident" id="5047885">r1</span>&nbsp;<span class="builtintype" id="5047888">int</span>&nbsp;<span class="op" id="5047892">}</span><span class="op" id="5047893">)</span><span class="op" id="5047894">(</span><span class="ident" id="5047895">nil</span><span class="op" id="5047898">)</span><span class="op" id="5047899">,</span>&nbsp;<span class="num" id="5047901">15</span><span class="op" id="5047903">)</span><br>
<span class="lineno"></span><span class="op" id="5047905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047908">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="5047957">var</span>&nbsp;<span class="ident" id="5047961">tWireType</span>&nbsp;<span class="op" id="5047971">=</span>&nbsp;<span class="ident" id="5047973">mustGetTypeInfo</span><span class="op" id="5047988">(</span><span class="ident" id="5047989">reflect</span><span class="op" id="5047996">.</span><span class="ident" id="5047997">TypeOf</span><span class="op" id="5048003">(</span><span class="ident" id="5048004">wireType</span><span class="op" id="5048012">{</span><span class="op" id="5048013">}</span><span class="op" id="5048014">)</span><span class="op" id="5048015">)</span><span class="op" id="5048016">.</span><span class="ident" id="5048017">id</span><br>
<span class="lineno">270</span><span class="keyword" id="5048020">var</span>&nbsp;<span class="ident" id="5048024">wireTypeUserInfo</span>&nbsp;<span class="op" id="5048041">*</span><span class="ident" id="5048042">userTypeInfo</span>&nbsp;<span class="comment" id="5048055">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5048087">func</span>&nbsp;<span class="ident" id="5048092">init</span><span class="op" id="5048096">(</span><span class="op" id="5048097">)</span>&nbsp;<span class="op" id="5048099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048102">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048162">checkId</span><span class="op" id="5048169">(</span><span class="num" id="5048170">16</span><span class="op" id="5048172">,</span>&nbsp;<span class="ident" id="5048174">tWireType</span><span class="op" id="5048183">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048186">checkId</span><span class="op" id="5048193">(</span><span class="num" id="5048194">17</span><span class="op" id="5048196">,</span>&nbsp;<span class="ident" id="5048198">mustGetTypeInfo</span><span class="op" id="5048213">(</span><span class="ident" id="5048214">reflect</span><span class="op" id="5048221">.</span><span class="ident" id="5048222">TypeOf</span><span class="op" id="5048228">(</span><span class="ident" id="5048229">arrayType</span><span class="op" id="5048238">{</span><span class="op" id="5048239">}</span><span class="op" id="5048240">)</span><span class="op" id="5048241">)</span><span class="op" id="5048242">.</span><span class="ident" id="5048243">id</span><span class="op" id="5048245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048248">checkId</span><span class="op" id="5048255">(</span><span class="num" id="5048256">18</span><span class="op" id="5048258">,</span>&nbsp;<span class="ident" id="5048260">mustGetTypeInfo</span><span class="op" id="5048275">(</span><span class="ident" id="5048276">reflect</span><span class="op" id="5048283">.</span><span class="ident" id="5048284">TypeOf</span><span class="op" id="5048290">(</span><span class="ident" id="5048291">CommonType</span><span class="op" id="5048301">{</span><span class="op" id="5048302">}</span><span class="op" id="5048303">)</span><span class="op" id="5048304">)</span><span class="op" id="5048305">.</span><span class="ident" id="5048306">id</span><span class="op" id="5048308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048311">checkId</span><span class="op" id="5048318">(</span><span class="num" id="5048319">19</span><span class="op" id="5048321">,</span>&nbsp;<span class="ident" id="5048323">mustGetTypeInfo</span><span class="op" id="5048338">(</span><span class="ident" id="5048339">reflect</span><span class="op" id="5048346">.</span><span class="ident" id="5048347">TypeOf</span><span class="op" id="5048353">(</span><span class="ident" id="5048354">sliceType</span><span class="op" id="5048363">{</span><span class="op" id="5048364">}</span><span class="op" id="5048365">)</span><span class="op" id="5048366">)</span><span class="op" id="5048367">.</span><span class="ident" id="5048368">id</span><span class="op" id="5048370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048373">checkId</span><span class="op" id="5048380">(</span><span class="num" id="5048381">20</span><span class="op" id="5048383">,</span>&nbsp;<span class="ident" id="5048385">mustGetTypeInfo</span><span class="op" id="5048400">(</span><span class="ident" id="5048401">reflect</span><span class="op" id="5048408">.</span><span class="ident" id="5048409">TypeOf</span><span class="op" id="5048415">(</span><span class="ident" id="5048416">structType</span><span class="op" id="5048426">{</span><span class="op" id="5048427">}</span><span class="op" id="5048428">)</span><span class="op" id="5048429">)</span><span class="op" id="5048430">.</span><span class="ident" id="5048431">id</span><span class="op" id="5048433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048436">checkId</span><span class="op" id="5048443">(</span><span class="num" id="5048444">21</span><span class="op" id="5048446">,</span>&nbsp;<span class="ident" id="5048448">mustGetTypeInfo</span><span class="op" id="5048463">(</span><span class="ident" id="5048464">reflect</span><span class="op" id="5048471">.</span><span class="ident" id="5048472">TypeOf</span><span class="op" id="5048478">(</span><span class="ident" id="5048479">fieldType</span><span class="op" id="5048488">{</span><span class="op" id="5048489">}</span><span class="op" id="5048490">)</span><span class="op" id="5048491">)</span><span class="op" id="5048492">.</span><span class="ident" id="5048493">id</span><span class="op" id="5048495">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048498">checkId</span><span class="op" id="5048505">(</span><span class="num" id="5048506">23</span><span class="op" id="5048508">,</span>&nbsp;<span class="ident" id="5048510">mustGetTypeInfo</span><span class="op" id="5048525">(</span><span class="ident" id="5048526">reflect</span><span class="op" id="5048533">.</span><span class="ident" id="5048534">TypeOf</span><span class="op" id="5048540">(</span><span class="ident" id="5048541">mapType</span><span class="op" id="5048548">{</span><span class="op" id="5048549">}</span><span class="op" id="5048550">)</span><span class="op" id="5048551">)</span><span class="op" id="5048552">.</span><span class="ident" id="5048553">id</span><span class="op" id="5048555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048559">builtinIdToType</span>&nbsp;<span class="op" id="5048575">=</span>&nbsp;<span class="builtinfunc" id="5048577">make</span><span class="op" id="5048581">(</span><span class="keyword" id="5048582">map</span><span class="op" id="5048585">[</span><span class="ident" id="5048586">typeId</span><span class="op" id="5048592">]</span><span class="ident" id="5048593">gobType</span><span class="op" id="5048600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048603">for</span>&nbsp;<span class="ident" id="5048607">k</span><span class="op" id="5048608">,</span>&nbsp;<span class="ident" id="5048610">v</span>&nbsp;<span class="op" id="5048612">:=</span>&nbsp;<span class="keyword" id="5048615">range</span>&nbsp;<span class="ident" id="5048621">idToType</span>&nbsp;<span class="op" id="5048630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048634">builtinIdToType</span><span class="op" id="5048649">[</span><span class="ident" id="5048650">k</span><span class="op" id="5048651">]</span>&nbsp;<span class="op" id="5048653">=</span>&nbsp;<span class="ident" id="5048655">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048662">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048736">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048773">if</span>&nbsp;<span class="ident" id="5048776">nextId</span>&nbsp;<span class="op" id="5048783">&gt;</span>&nbsp;<span class="ident" id="5048785">firstUserId</span>&nbsp;<span class="op" id="5048797">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5048801">panic</span><span class="op" id="5048806">(</span><span class="ident" id="5048807">fmt</span><span class="op" id="5048810">.</span><span class="ident" id="5048811">Sprintln</span><span class="op" id="5048819">(</span><span class="string" id="5048820">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="5048839">,</span>&nbsp;<span class="ident" id="5048841">nextId</span><span class="op" id="5048847">)</span><span class="op" id="5048848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048854">nextId</span>&nbsp;<span class="op" id="5048861">=</span>&nbsp;<span class="ident" id="5048863">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048876">registerBasics</span><span class="op" id="5048890">(</span><span class="op" id="5048891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048894">wireTypeUserInfo</span>&nbsp;<span class="op" id="5048911">=</span>&nbsp;<span class="ident" id="5048913">userType</span><span class="op" id="5048921">(</span><span class="ident" id="5048922">reflect</span><span class="op" id="5048929">.</span><span class="ident" id="5048930">TypeOf</span><span class="op" id="5048936">(</span><span class="op" id="5048937">(</span><span class="op" id="5048938">*</span><span class="ident" id="5048939">wireType</span><span class="op" id="5048947">)</span><span class="op" id="5048948">(</span><span class="ident" id="5048949">nil</span><span class="op" id="5048952">)</span><span class="op" id="5048953">)</span><span class="op" id="5048954">)</span><br>
<span class="lineno">295</span><span class="op" id="5048956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5048959">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5048973">type</span>&nbsp;<span class="ident" id="5048978">arrayType</span>&nbsp;<span class="keyword" id="5048988">struct</span>&nbsp;<span class="op" id="5048995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048998">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049010">Elem</span>&nbsp;<span class="ident" id="5049015">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049023">Len</span>&nbsp;&nbsp;<span class="builtintype" id="5049028">int</span><br>
<span class="lineno"></span><span class="op" id="5049032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5049035">func</span>&nbsp;<span class="ident" id="5049040">newArrayType</span><span class="op" id="5049052">(</span><span class="ident" id="5049053">name</span>&nbsp;<span class="builtintype" id="5049058">string</span><span class="op" id="5049064">)</span>&nbsp;<span class="op" id="5049066">*</span><span class="ident" id="5049067">arrayType</span>&nbsp;<span class="op" id="5049077">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049080">a</span>&nbsp;<span class="op" id="5049082">:=</span>&nbsp;<span class="op" id="5049085">&amp;</span><span class="ident" id="5049086">arrayType</span><span class="op" id="5049095">{</span><span class="ident" id="5049096">CommonType</span><span class="op" id="5049106">{</span><span class="ident" id="5049107">Name</span><span class="op" id="5049111">:</span>&nbsp;<span class="ident" id="5049113">name</span><span class="op" id="5049117">}</span><span class="op" id="5049118">,</span>&nbsp;<span class="num" id="5049120">0</span><span class="op" id="5049121">,</span>&nbsp;<span class="num" id="5049123">0</span><span class="op" id="5049124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049127">return</span>&nbsp;<span class="ident" id="5049134">a</span><br>
<span class="lineno"></span><span class="op" id="5049136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5049139">func</span>&nbsp;<span class="op" id="5049144">(</span><span class="ident" id="5049145">a</span>&nbsp;<span class="op" id="5049147">*</span><span class="ident" id="5049148">arrayType</span><span class="op" id="5049157">)</span>&nbsp;<span class="ident" id="5049159">init</span><span class="op" id="5049163">(</span><span class="ident" id="5049164">elem</span>&nbsp;<span class="ident" id="5049169">gobType</span><span class="op" id="5049176">,</span>&nbsp;<span class="builtinfunc" id="5049178">len</span>&nbsp;<span class="builtintype" id="5049182">int</span><span class="op" id="5049185">)</span>&nbsp;<span class="op" id="5049187">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5049190">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049265">setTypeId</span><span class="op" id="5049274">(</span><span class="ident" id="5049275">a</span><span class="op" id="5049276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049279">a</span><span class="op" id="5049280">.</span><span class="ident" id="5049281">Elem</span>&nbsp;<span class="op" id="5049286">=</span>&nbsp;<span class="ident" id="5049288">elem</span><span class="op" id="5049292">.</span><span class="ident" id="5049293">id</span><span class="op" id="5049295">(</span><span class="op" id="5049296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049299">a</span><span class="op" id="5049300">.</span><span class="ident" id="5049301">Len</span>&nbsp;<span class="op" id="5049305">=</span>&nbsp;<span class="builtinfunc" id="5049307">len</span><br>
<span class="lineno"></span><span class="op" id="5049311">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5049314">func</span>&nbsp;<span class="op" id="5049319">(</span><span class="ident" id="5049320">a</span>&nbsp;<span class="op" id="5049322">*</span><span class="ident" id="5049323">arrayType</span><span class="op" id="5049332">)</span>&nbsp;<span class="ident" id="5049334">safeString</span><span class="op" id="5049344">(</span><span class="ident" id="5049345">seen</span>&nbsp;<span class="keyword" id="5049350">map</span><span class="op" id="5049353">[</span><span class="ident" id="5049354">typeId</span><span class="op" id="5049360">]</span><span class="builtintype" id="5049361">bool</span><span class="op" id="5049365">)</span>&nbsp;<span class="builtintype" id="5049367">string</span>&nbsp;<span class="op" id="5049374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049377">if</span>&nbsp;<span class="ident" id="5049380">seen</span><span class="op" id="5049384">[</span><span class="ident" id="5049385">a</span><span class="op" id="5049386">.</span><span class="ident" id="5049387">Id</span><span class="op" id="5049389">]</span>&nbsp;<span class="op" id="5049391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049395">return</span>&nbsp;<span class="ident" id="5049402">a</span><span class="op" id="5049403">.</span><span class="ident" id="5049404">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049410">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049413">seen</span><span class="op" id="5049417">[</span><span class="ident" id="5049418">a</span><span class="op" id="5049419">.</span><span class="ident" id="5049420">Id</span><span class="op" id="5049422">]</span>&nbsp;<span class="op" id="5049424">=</span>&nbsp;<span class="builtintype" id="5049426">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049432">return</span>&nbsp;<span class="ident" id="5049439">fmt</span><span class="op" id="5049442">.</span><span class="ident" id="5049443">Sprintf</span><span class="op" id="5049450">(</span><span class="string" id="5049451">&#34;[%d]%s&#34;</span><span class="op" id="5049459">,</span>&nbsp;<span class="ident" id="5049461">a</span><span class="op" id="5049462">.</span><span class="ident" id="5049463">Len</span><span class="op" id="5049466">,</span>&nbsp;<span class="ident" id="5049468">a</span><span class="op" id="5049469">.</span><span class="ident" id="5049470">Elem</span><span class="op" id="5049474">.</span><span class="ident" id="5049475">gobType</span><span class="op" id="5049482">(</span><span class="op" id="5049483">)</span><span class="op" id="5049484">.</span><span class="ident" id="5049485">safeString</span><span class="op" id="5049495">(</span><span class="ident" id="5049496">seen</span><span class="op" id="5049500">)</span><span class="op" id="5049501">)</span><br>
<span class="lineno"></span><span class="op" id="5049503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5049506">func</span>&nbsp;<span class="op" id="5049511">(</span><span class="ident" id="5049512">a</span>&nbsp;<span class="op" id="5049514">*</span><span class="ident" id="5049515">arrayType</span><span class="op" id="5049524">)</span>&nbsp;<span class="builtintype" id="5049526">string</span><span class="op" id="5049532">(</span><span class="op" id="5049533">)</span>&nbsp;<span class="builtintype" id="5049535">string</span>&nbsp;<span class="op" id="5049542">{</span>&nbsp;<span class="keyword" id="5049544">return</span>&nbsp;<span class="ident" id="5049551">a</span><span class="op" id="5049552">.</span><span class="ident" id="5049553">safeString</span><span class="op" id="5049563">(</span><span class="builtinfunc" id="5049564">make</span><span class="op" id="5049568">(</span><span class="keyword" id="5049569">map</span><span class="op" id="5049572">[</span><span class="ident" id="5049573">typeId</span><span class="op" id="5049579">]</span><span class="builtintype" id="5049580">bool</span><span class="op" id="5049584">)</span><span class="op" id="5049585">)</span>&nbsp;<span class="op" id="5049587">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5049590">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="5049662">type</span>&nbsp;<span class="ident" id="5049667">gobEncoderType</span>&nbsp;<span class="keyword" id="5049682">struct</span>&nbsp;<span class="op" id="5049689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049692">CommonType</span><br>
<span class="lineno"></span><span class="op" id="5049703">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5049706">func</span>&nbsp;<span class="ident" id="5049711">newGobEncoderType</span><span class="op" id="5049728">(</span><span class="ident" id="5049729">name</span>&nbsp;<span class="builtintype" id="5049734">string</span><span class="op" id="5049740">)</span>&nbsp;<span class="op" id="5049742">*</span><span class="ident" id="5049743">gobEncoderType</span>&nbsp;<span class="op" id="5049758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049761">g</span>&nbsp;<span class="op" id="5049763">:=</span>&nbsp;<span class="op" id="5049766">&amp;</span><span class="ident" id="5049767">gobEncoderType</span><span class="op" id="5049781">{</span><span class="ident" id="5049782">CommonType</span><span class="op" id="5049792">{</span><span class="ident" id="5049793">Name</span><span class="op" id="5049797">:</span>&nbsp;<span class="ident" id="5049799">name</span><span class="op" id="5049803">}</span><span class="op" id="5049804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049807">setTypeId</span><span class="op" id="5049816">(</span><span class="ident" id="5049817">g</span><span class="op" id="5049818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049821">return</span>&nbsp;<span class="ident" id="5049828">g</span><br>
<span class="lineno">335</span><span class="op" id="5049830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5049833">func</span>&nbsp;<span class="op" id="5049838">(</span><span class="ident" id="5049839">g</span>&nbsp;<span class="op" id="5049841">*</span><span class="ident" id="5049842">gobEncoderType</span><span class="op" id="5049856">)</span>&nbsp;<span class="ident" id="5049858">safeString</span><span class="op" id="5049868">(</span><span class="ident" id="5049869">seen</span>&nbsp;<span class="keyword" id="5049874">map</span><span class="op" id="5049877">[</span><span class="ident" id="5049878">typeId</span><span class="op" id="5049884">]</span><span class="builtintype" id="5049885">bool</span><span class="op" id="5049889">)</span>&nbsp;<span class="builtintype" id="5049891">string</span>&nbsp;<span class="op" id="5049898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049901">return</span>&nbsp;<span class="ident" id="5049908">g</span><span class="op" id="5049909">.</span><span class="ident" id="5049910">Name</span><br>
<span class="lineno"></span><span class="op" id="5049915">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="5049918">func</span>&nbsp;<span class="op" id="5049923">(</span><span class="ident" id="5049924">g</span>&nbsp;<span class="op" id="5049926">*</span><span class="ident" id="5049927">gobEncoderType</span><span class="op" id="5049941">)</span>&nbsp;<span class="builtintype" id="5049943">string</span><span class="op" id="5049949">(</span><span class="op" id="5049950">)</span>&nbsp;<span class="builtintype" id="5049952">string</span>&nbsp;<span class="op" id="5049959">{</span>&nbsp;<span class="keyword" id="5049961">return</span>&nbsp;<span class="ident" id="5049968">g</span><span class="op" id="5049969">.</span><span class="ident" id="5049970">Name</span>&nbsp;<span class="op" id="5049975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049978">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5049990">type</span>&nbsp;<span class="ident" id="5049995">mapType</span>&nbsp;<span class="keyword" id="5050003">struct</span>&nbsp;<span class="op" id="5050010">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050013">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050025">Key</span>&nbsp;&nbsp;<span class="ident" id="5050030">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050038">Elem</span>&nbsp;<span class="ident" id="5050043">typeId</span><br>
<span class="lineno"></span><span class="op" id="5050050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5050053">func</span>&nbsp;<span class="ident" id="5050058">newMapType</span><span class="op" id="5050068">(</span><span class="ident" id="5050069">name</span>&nbsp;<span class="builtintype" id="5050074">string</span><span class="op" id="5050080">)</span>&nbsp;<span class="op" id="5050082">*</span><span class="ident" id="5050083">mapType</span>&nbsp;<span class="op" id="5050091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050094">m</span>&nbsp;<span class="op" id="5050096">:=</span>&nbsp;<span class="op" id="5050099">&amp;</span><span class="ident" id="5050100">mapType</span><span class="op" id="5050107">{</span><span class="ident" id="5050108">CommonType</span><span class="op" id="5050118">{</span><span class="ident" id="5050119">Name</span><span class="op" id="5050123">:</span>&nbsp;<span class="ident" id="5050125">name</span><span class="op" id="5050129">}</span><span class="op" id="5050130">,</span>&nbsp;<span class="num" id="5050132">0</span><span class="op" id="5050133">,</span>&nbsp;<span class="num" id="5050135">0</span><span class="op" id="5050136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050139">return</span>&nbsp;<span class="ident" id="5050146">m</span><br>
<span class="lineno"></span><span class="op" id="5050148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5050151">func</span>&nbsp;<span class="op" id="5050156">(</span><span class="ident" id="5050157">m</span>&nbsp;<span class="op" id="5050159">*</span><span class="ident" id="5050160">mapType</span><span class="op" id="5050167">)</span>&nbsp;<span class="ident" id="5050169">init</span><span class="op" id="5050173">(</span><span class="ident" id="5050174">key</span><span class="op" id="5050177">,</span>&nbsp;<span class="ident" id="5050179">elem</span>&nbsp;<span class="ident" id="5050184">gobType</span><span class="op" id="5050191">)</span>&nbsp;<span class="op" id="5050193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050196">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050271">setTypeId</span><span class="op" id="5050280">(</span><span class="ident" id="5050281">m</span><span class="op" id="5050282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050285">m</span><span class="op" id="5050286">.</span><span class="ident" id="5050287">Key</span>&nbsp;<span class="op" id="5050291">=</span>&nbsp;<span class="ident" id="5050293">key</span><span class="op" id="5050296">.</span><span class="ident" id="5050297">id</span><span class="op" id="5050299">(</span><span class="op" id="5050300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050303">m</span><span class="op" id="5050304">.</span><span class="ident" id="5050305">Elem</span>&nbsp;<span class="op" id="5050310">=</span>&nbsp;<span class="ident" id="5050312">elem</span><span class="op" id="5050316">.</span><span class="ident" id="5050317">id</span><span class="op" id="5050319">(</span><span class="op" id="5050320">)</span><br>
<span class="lineno">360</span><span class="op" id="5050322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5050325">func</span>&nbsp;<span class="op" id="5050330">(</span><span class="ident" id="5050331">m</span>&nbsp;<span class="op" id="5050333">*</span><span class="ident" id="5050334">mapType</span><span class="op" id="5050341">)</span>&nbsp;<span class="ident" id="5050343">safeString</span><span class="op" id="5050353">(</span><span class="ident" id="5050354">seen</span>&nbsp;<span class="keyword" id="5050359">map</span><span class="op" id="5050362">[</span><span class="ident" id="5050363">typeId</span><span class="op" id="5050369">]</span><span class="builtintype" id="5050370">bool</span><span class="op" id="5050374">)</span>&nbsp;<span class="builtintype" id="5050376">string</span>&nbsp;<span class="op" id="5050383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050386">if</span>&nbsp;<span class="ident" id="5050389">seen</span><span class="op" id="5050393">[</span><span class="ident" id="5050394">m</span><span class="op" id="5050395">.</span><span class="ident" id="5050396">Id</span><span class="op" id="5050398">]</span>&nbsp;<span class="op" id="5050400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050404">return</span>&nbsp;<span class="ident" id="5050411">m</span><span class="op" id="5050412">.</span><span class="ident" id="5050413">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050422">seen</span><span class="op" id="5050426">[</span><span class="ident" id="5050427">m</span><span class="op" id="5050428">.</span><span class="ident" id="5050429">Id</span><span class="op" id="5050431">]</span>&nbsp;<span class="op" id="5050433">=</span>&nbsp;<span class="builtintype" id="5050435">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050441">key</span>&nbsp;<span class="op" id="5050445">:=</span>&nbsp;<span class="ident" id="5050448">m</span><span class="op" id="5050449">.</span><span class="ident" id="5050450">Key</span><span class="op" id="5050453">.</span><span class="ident" id="5050454">gobType</span><span class="op" id="5050461">(</span><span class="op" id="5050462">)</span><span class="op" id="5050463">.</span><span class="ident" id="5050464">safeString</span><span class="op" id="5050474">(</span><span class="ident" id="5050475">seen</span><span class="op" id="5050479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050482">elem</span>&nbsp;<span class="op" id="5050487">:=</span>&nbsp;<span class="ident" id="5050490">m</span><span class="op" id="5050491">.</span><span class="ident" id="5050492">Elem</span><span class="op" id="5050496">.</span><span class="ident" id="5050497">gobType</span><span class="op" id="5050504">(</span><span class="op" id="5050505">)</span><span class="op" id="5050506">.</span><span class="ident" id="5050507">safeString</span><span class="op" id="5050517">(</span><span class="ident" id="5050518">seen</span><span class="op" id="5050522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050525">return</span>&nbsp;<span class="ident" id="5050532">fmt</span><span class="op" id="5050535">.</span><span class="ident" id="5050536">Sprintf</span><span class="op" id="5050543">(</span><span class="string" id="5050544">&#34;map[%s]%s&#34;</span><span class="op" id="5050555">,</span>&nbsp;<span class="ident" id="5050557">key</span><span class="op" id="5050560">,</span>&nbsp;<span class="ident" id="5050562">elem</span><span class="op" id="5050566">)</span><br>
<span class="lineno">370</span><span class="op" id="5050568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5050571">func</span>&nbsp;<span class="op" id="5050576">(</span><span class="ident" id="5050577">m</span>&nbsp;<span class="op" id="5050579">*</span><span class="ident" id="5050580">mapType</span><span class="op" id="5050587">)</span>&nbsp;<span class="builtintype" id="5050589">string</span><span class="op" id="5050595">(</span><span class="op" id="5050596">)</span>&nbsp;<span class="builtintype" id="5050598">string</span>&nbsp;<span class="op" id="5050605">{</span>&nbsp;<span class="keyword" id="5050607">return</span>&nbsp;<span class="ident" id="5050614">m</span><span class="op" id="5050615">.</span><span class="ident" id="5050616">safeString</span><span class="op" id="5050626">(</span><span class="builtinfunc" id="5050627">make</span><span class="op" id="5050631">(</span><span class="keyword" id="5050632">map</span><span class="op" id="5050635">[</span><span class="ident" id="5050636">typeId</span><span class="op" id="5050642">]</span><span class="builtintype" id="5050643">bool</span><span class="op" id="5050647">)</span><span class="op" id="5050648">)</span>&nbsp;<span class="op" id="5050650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5050653">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="5050667">type</span>&nbsp;<span class="ident" id="5050672">sliceType</span>&nbsp;<span class="keyword" id="5050682">struct</span>&nbsp;<span class="op" id="5050689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050692">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050704">Elem</span>&nbsp;<span class="ident" id="5050709">typeId</span><br>
<span class="lineno"></span><span class="op" id="5050716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5050719">func</span>&nbsp;<span class="ident" id="5050724">newSliceType</span><span class="op" id="5050736">(</span><span class="ident" id="5050737">name</span>&nbsp;<span class="builtintype" id="5050742">string</span><span class="op" id="5050748">)</span>&nbsp;<span class="op" id="5050750">*</span><span class="ident" id="5050751">sliceType</span>&nbsp;<span class="op" id="5050761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050764">s</span>&nbsp;<span class="op" id="5050766">:=</span>&nbsp;<span class="op" id="5050769">&amp;</span><span class="ident" id="5050770">sliceType</span><span class="op" id="5050779">{</span><span class="ident" id="5050780">CommonType</span><span class="op" id="5050790">{</span><span class="ident" id="5050791">Name</span><span class="op" id="5050795">:</span>&nbsp;<span class="ident" id="5050797">name</span><span class="op" id="5050801">}</span><span class="op" id="5050802">,</span>&nbsp;<span class="num" id="5050804">0</span><span class="op" id="5050805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050808">return</span>&nbsp;<span class="ident" id="5050815">s</span><br>
<span class="lineno"></span><span class="op" id="5050817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5050820">func</span>&nbsp;<span class="op" id="5050825">(</span><span class="ident" id="5050826">s</span>&nbsp;<span class="op" id="5050828">*</span><span class="ident" id="5050829">sliceType</span><span class="op" id="5050838">)</span>&nbsp;<span class="ident" id="5050840">init</span><span class="op" id="5050844">(</span><span class="ident" id="5050845">elem</span>&nbsp;<span class="ident" id="5050850">gobType</span><span class="op" id="5050857">)</span>&nbsp;<span class="op" id="5050859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050862">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050937">setTypeId</span><span class="op" id="5050946">(</span><span class="ident" id="5050947">s</span><span class="op" id="5050948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050951">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5051016">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051051">if</span>&nbsp;<span class="ident" id="5051054">elem</span><span class="op" id="5051058">.</span><span class="ident" id="5051059">id</span><span class="op" id="5051061">(</span><span class="op" id="5051062">)</span>&nbsp;<span class="op" id="5051064">==</span>&nbsp;<span class="num" id="5051067">0</span>&nbsp;<span class="op" id="5051069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051073">setTypeId</span><span class="op" id="5051082">(</span><span class="ident" id="5051083">elem</span><span class="op" id="5051087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051093">s</span><span class="op" id="5051094">.</span><span class="ident" id="5051095">Elem</span>&nbsp;<span class="op" id="5051100">=</span>&nbsp;<span class="ident" id="5051102">elem</span><span class="op" id="5051106">.</span><span class="ident" id="5051107">id</span><span class="op" id="5051109">(</span><span class="op" id="5051110">)</span><br>
<span class="lineno"></span><span class="op" id="5051112">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5051115">func</span>&nbsp;<span class="op" id="5051120">(</span><span class="ident" id="5051121">s</span>&nbsp;<span class="op" id="5051123">*</span><span class="ident" id="5051124">sliceType</span><span class="op" id="5051133">)</span>&nbsp;<span class="ident" id="5051135">safeString</span><span class="op" id="5051145">(</span><span class="ident" id="5051146">seen</span>&nbsp;<span class="keyword" id="5051151">map</span><span class="op" id="5051154">[</span><span class="ident" id="5051155">typeId</span><span class="op" id="5051161">]</span><span class="builtintype" id="5051162">bool</span><span class="op" id="5051166">)</span>&nbsp;<span class="builtintype" id="5051168">string</span>&nbsp;<span class="op" id="5051175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051178">if</span>&nbsp;<span class="ident" id="5051181">seen</span><span class="op" id="5051185">[</span><span class="ident" id="5051186">s</span><span class="op" id="5051187">.</span><span class="ident" id="5051188">Id</span><span class="op" id="5051190">]</span>&nbsp;<span class="op" id="5051192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051196">return</span>&nbsp;<span class="ident" id="5051203">s</span><span class="op" id="5051204">.</span><span class="ident" id="5051205">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051211">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051214">seen</span><span class="op" id="5051218">[</span><span class="ident" id="5051219">s</span><span class="op" id="5051220">.</span><span class="ident" id="5051221">Id</span><span class="op" id="5051223">]</span>&nbsp;<span class="op" id="5051225">=</span>&nbsp;<span class="builtintype" id="5051227">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051233">return</span>&nbsp;<span class="ident" id="5051240">fmt</span><span class="op" id="5051243">.</span><span class="ident" id="5051244">Sprintf</span><span class="op" id="5051251">(</span><span class="string" id="5051252">&#34;[]%s&#34;</span><span class="op" id="5051258">,</span>&nbsp;<span class="ident" id="5051260">s</span><span class="op" id="5051261">.</span><span class="ident" id="5051262">Elem</span><span class="op" id="5051266">.</span><span class="ident" id="5051267">gobType</span><span class="op" id="5051274">(</span><span class="op" id="5051275">)</span><span class="op" id="5051276">.</span><span class="ident" id="5051277">safeString</span><span class="op" id="5051287">(</span><span class="ident" id="5051288">seen</span><span class="op" id="5051292">)</span><span class="op" id="5051293">)</span><br>
<span class="lineno"></span><span class="op" id="5051295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5051298">func</span>&nbsp;<span class="op" id="5051303">(</span><span class="ident" id="5051304">s</span>&nbsp;<span class="op" id="5051306">*</span><span class="ident" id="5051307">sliceType</span><span class="op" id="5051316">)</span>&nbsp;<span class="builtintype" id="5051318">string</span><span class="op" id="5051324">(</span><span class="op" id="5051325">)</span>&nbsp;<span class="builtintype" id="5051327">string</span>&nbsp;<span class="op" id="5051334">{</span>&nbsp;<span class="keyword" id="5051336">return</span>&nbsp;<span class="ident" id="5051343">s</span><span class="op" id="5051344">.</span><span class="ident" id="5051345">safeString</span><span class="op" id="5051355">(</span><span class="builtinfunc" id="5051356">make</span><span class="op" id="5051360">(</span><span class="keyword" id="5051361">map</span><span class="op" id="5051364">[</span><span class="ident" id="5051365">typeId</span><span class="op" id="5051371">]</span><span class="builtintype" id="5051372">bool</span><span class="op" id="5051376">)</span><span class="op" id="5051377">)</span>&nbsp;<span class="op" id="5051379">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5051382">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5051397">type</span>&nbsp;<span class="ident" id="5051402">fieldType</span>&nbsp;<span class="keyword" id="5051412">struct</span>&nbsp;<span class="op" id="5051419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051422">Name</span>&nbsp;<span class="builtintype" id="5051427">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051435">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5051440">typeId</span><br>
<span class="lineno">410</span><span class="op" id="5051447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5051450">type</span>&nbsp;<span class="ident" id="5051455">structType</span>&nbsp;<span class="keyword" id="5051466">struct</span>&nbsp;<span class="op" id="5051473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051476">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051488">Field</span>&nbsp;<span class="op" id="5051494">[</span><span class="op" id="5051495">]</span><span class="op" id="5051496">*</span><span class="ident" id="5051497">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="5051507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5051510">func</span>&nbsp;<span class="op" id="5051515">(</span><span class="ident" id="5051516">s</span>&nbsp;<span class="op" id="5051518">*</span><span class="ident" id="5051519">structType</span><span class="op" id="5051529">)</span>&nbsp;<span class="ident" id="5051531">safeString</span><span class="op" id="5051541">(</span><span class="ident" id="5051542">seen</span>&nbsp;<span class="keyword" id="5051547">map</span><span class="op" id="5051550">[</span><span class="ident" id="5051551">typeId</span><span class="op" id="5051557">]</span><span class="builtintype" id="5051558">bool</span><span class="op" id="5051562">)</span>&nbsp;<span class="builtintype" id="5051564">string</span>&nbsp;<span class="op" id="5051571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051574">if</span>&nbsp;<span class="ident" id="5051577">s</span>&nbsp;<span class="op" id="5051579">==</span>&nbsp;<span class="ident" id="5051582">nil</span>&nbsp;<span class="op" id="5051586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051590">return</span>&nbsp;<span class="string" id="5051597">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051609">if</span>&nbsp;<span class="ident" id="5051612">_</span><span class="op" id="5051613">,</span>&nbsp;<span class="ident" id="5051615">ok</span>&nbsp;<span class="op" id="5051618">:=</span>&nbsp;<span class="ident" id="5051621">seen</span><span class="op" id="5051625">[</span><span class="ident" id="5051626">s</span><span class="op" id="5051627">.</span><span class="ident" id="5051628">Id</span><span class="op" id="5051630">]</span><span class="op" id="5051631">;</span>&nbsp;<span class="ident" id="5051633">ok</span>&nbsp;<span class="op" id="5051636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051640">return</span>&nbsp;<span class="ident" id="5051647">s</span><span class="op" id="5051648">.</span><span class="ident" id="5051649">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051658">seen</span><span class="op" id="5051662">[</span><span class="ident" id="5051663">s</span><span class="op" id="5051664">.</span><span class="ident" id="5051665">Id</span><span class="op" id="5051667">]</span>&nbsp;<span class="op" id="5051669">=</span>&nbsp;<span class="builtintype" id="5051671">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051677">str</span>&nbsp;<span class="op" id="5051681">:=</span>&nbsp;<span class="ident" id="5051684">s</span><span class="op" id="5051685">.</span><span class="ident" id="5051686">Name</span>&nbsp;<span class="op" id="5051691">+</span>&nbsp;<span class="string" id="5051693">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051709">for</span>&nbsp;<span class="ident" id="5051713">_</span><span class="op" id="5051714">,</span>&nbsp;<span class="ident" id="5051716">f</span>&nbsp;<span class="op" id="5051718">:=</span>&nbsp;<span class="keyword" id="5051721">range</span>&nbsp;<span class="ident" id="5051727">s</span><span class="op" id="5051728">.</span><span class="ident" id="5051729">Field</span>&nbsp;<span class="op" id="5051735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051739">str</span>&nbsp;<span class="op" id="5051743">+=</span>&nbsp;<span class="ident" id="5051746">fmt</span><span class="op" id="5051749">.</span><span class="ident" id="5051750">Sprintf</span><span class="op" id="5051757">(</span><span class="string" id="5051758">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="5051767">,</span>&nbsp;<span class="ident" id="5051769">f</span><span class="op" id="5051770">.</span><span class="ident" id="5051771">Name</span><span class="op" id="5051775">,</span>&nbsp;<span class="ident" id="5051777">f</span><span class="op" id="5051778">.</span><span class="ident" id="5051779">Id</span><span class="op" id="5051781">.</span><span class="ident" id="5051782">gobType</span><span class="op" id="5051789">(</span><span class="op" id="5051790">)</span><span class="op" id="5051791">.</span><span class="ident" id="5051792">safeString</span><span class="op" id="5051802">(</span><span class="ident" id="5051803">seen</span><span class="op" id="5051807">)</span><span class="op" id="5051808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051814">str</span>&nbsp;<span class="op" id="5051818">+=</span>&nbsp;<span class="string" id="5051821">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051826">return</span>&nbsp;<span class="ident" id="5051833">str</span><br>
<span class="lineno"></span><span class="op" id="5051837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5051840">func</span>&nbsp;<span class="op" id="5051845">(</span><span class="ident" id="5051846">s</span>&nbsp;<span class="op" id="5051848">*</span><span class="ident" id="5051849">structType</span><span class="op" id="5051859">)</span>&nbsp;<span class="builtintype" id="5051861">string</span><span class="op" id="5051867">(</span><span class="op" id="5051868">)</span>&nbsp;<span class="builtintype" id="5051870">string</span>&nbsp;<span class="op" id="5051877">{</span>&nbsp;<span class="keyword" id="5051879">return</span>&nbsp;<span class="ident" id="5051886">s</span><span class="op" id="5051887">.</span><span class="ident" id="5051888">safeString</span><span class="op" id="5051898">(</span><span class="builtinfunc" id="5051899">make</span><span class="op" id="5051903">(</span><span class="keyword" id="5051904">map</span><span class="op" id="5051907">[</span><span class="ident" id="5051908">typeId</span><span class="op" id="5051914">]</span><span class="builtintype" id="5051915">bool</span><span class="op" id="5051919">)</span><span class="op" id="5051920">)</span>&nbsp;<span class="op" id="5051922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5051925">func</span>&nbsp;<span class="ident" id="5051930">newStructType</span><span class="op" id="5051943">(</span><span class="ident" id="5051944">name</span>&nbsp;<span class="builtintype" id="5051949">string</span><span class="op" id="5051955">)</span>&nbsp;<span class="op" id="5051957">*</span><span class="ident" id="5051958">structType</span>&nbsp;<span class="op" id="5051969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051972">s</span>&nbsp;<span class="op" id="5051974">:=</span>&nbsp;<span class="op" id="5051977">&amp;</span><span class="ident" id="5051978">structType</span><span class="op" id="5051988">{</span><span class="ident" id="5051989">CommonType</span><span class="op" id="5051999">{</span><span class="ident" id="5052000">Name</span><span class="op" id="5052004">:</span>&nbsp;<span class="ident" id="5052006">name</span><span class="op" id="5052010">}</span><span class="op" id="5052011">,</span>&nbsp;<span class="ident" id="5052013">nil</span><span class="op" id="5052016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052019">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052083">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052133">setTypeId</span><span class="op" id="5052142">(</span><span class="ident" id="5052143">s</span><span class="op" id="5052144">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052147">return</span>&nbsp;<span class="ident" id="5052154">s</span><br>
<span class="lineno"></span><span class="op" id="5052156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5052159">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5052224">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="5052289">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="5052299">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="5052364">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="5052414">func</span>&nbsp;<span class="ident" id="5052419">newTypeObject</span><span class="op" id="5052432">(</span><span class="ident" id="5052433">name</span>&nbsp;<span class="builtintype" id="5052438">string</span><span class="op" id="5052444">,</span>&nbsp;<span class="ident" id="5052446">ut</span>&nbsp;<span class="op" id="5052449">*</span><span class="ident" id="5052450">userTypeInfo</span><span class="op" id="5052462">,</span>&nbsp;<span class="ident" id="5052464">rt</span>&nbsp;<span class="ident" id="5052467">reflect</span><span class="op" id="5052474">.</span><span class="ident" id="5052475">Type</span><span class="op" id="5052479">)</span>&nbsp;<span class="op" id="5052481">(</span><span class="ident" id="5052482">gobType</span><span class="op" id="5052489">,</span>&nbsp;<span class="builtintype" id="5052491">error</span><span class="op" id="5052496">)</span>&nbsp;<span class="op" id="5052498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052501">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052542">if</span>&nbsp;<span class="ident" id="5052545">ut</span><span class="op" id="5052547">.</span><span class="ident" id="5052548">externalEnc</span>&nbsp;<span class="op" id="5052560">!=</span>&nbsp;<span class="num" id="5052563">0</span>&nbsp;<span class="op" id="5052565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052569">return</span>&nbsp;<span class="ident" id="5052576">newGobEncoderType</span><span class="op" id="5052593">(</span><span class="ident" id="5052594">name</span><span class="op" id="5052598">)</span><span class="op" id="5052599">,</span>&nbsp;<span class="ident" id="5052601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052609">var</span>&nbsp;<span class="ident" id="5052613">err</span>&nbsp;<span class="builtintype" id="5052617">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052624">var</span>&nbsp;<span class="ident" id="5052628">type0</span><span class="op" id="5052633">,</span>&nbsp;<span class="ident" id="5052635">type1</span>&nbsp;<span class="ident" id="5052641">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052650">defer</span>&nbsp;<span class="keyword" id="5052656">func</span><span class="op" id="5052660">(</span><span class="op" id="5052661">)</span>&nbsp;<span class="op" id="5052663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052667">if</span>&nbsp;<span class="ident" id="5052670">err</span>&nbsp;<span class="op" id="5052674">!=</span>&nbsp;<span class="ident" id="5052677">nil</span>&nbsp;<span class="op" id="5052681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5052686">delete</span><span class="op" id="5052692">(</span><span class="ident" id="5052693">types</span><span class="op" id="5052698">,</span>&nbsp;<span class="ident" id="5052700">rt</span><span class="op" id="5052702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052709">}</span><span class="op" id="5052710">(</span><span class="op" id="5052711">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052714">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052785">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052843">switch</span>&nbsp;<span class="ident" id="5052850">t</span>&nbsp;<span class="op" id="5052852">:=</span>&nbsp;<span class="ident" id="5052855">rt</span><span class="op" id="5052857">;</span>&nbsp;<span class="ident" id="5052859">t</span><span class="op" id="5052860">.</span><span class="ident" id="5052861">Kind</span><span class="op" id="5052865">(</span><span class="op" id="5052866">)</span>&nbsp;<span class="op" id="5052868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052871">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052922">case</span>&nbsp;<span class="ident" id="5052927">reflect</span><span class="op" id="5052934">.</span><span class="ident" id="5052935">Bool</span><span class="op" id="5052939">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052943">return</span>&nbsp;<span class="ident" id="5052950">tBool</span><span class="op" id="5052955">.</span><span class="ident" id="5052956">gobType</span><span class="op" id="5052963">(</span><span class="op" id="5052964">)</span><span class="op" id="5052965">,</span>&nbsp;<span class="ident" id="5052967">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052973">case</span>&nbsp;<span class="ident" id="5052978">reflect</span><span class="op" id="5052985">.</span><span class="ident" id="5052986">Int</span><span class="op" id="5052989">,</span>&nbsp;<span class="ident" id="5052991">reflect</span><span class="op" id="5052998">.</span><span class="ident" id="5052999">Int8</span><span class="op" id="5053003">,</span>&nbsp;<span class="ident" id="5053005">reflect</span><span class="op" id="5053012">.</span><span class="ident" id="5053013">Int16</span><span class="op" id="5053018">,</span>&nbsp;<span class="ident" id="5053020">reflect</span><span class="op" id="5053027">.</span><span class="ident" id="5053028">Int32</span><span class="op" id="5053033">,</span>&nbsp;<span class="ident" id="5053035">reflect</span><span class="op" id="5053042">.</span><span class="ident" id="5053043">Int64</span><span class="op" id="5053048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053052">return</span>&nbsp;<span class="ident" id="5053059">tInt</span><span class="op" id="5053063">.</span><span class="ident" id="5053064">gobType</span><span class="op" id="5053071">(</span><span class="op" id="5053072">)</span><span class="op" id="5053073">,</span>&nbsp;<span class="ident" id="5053075">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053081">case</span>&nbsp;<span class="ident" id="5053086">reflect</span><span class="op" id="5053093">.</span><span class="ident" id="5053094">Uint</span><span class="op" id="5053098">,</span>&nbsp;<span class="ident" id="5053100">reflect</span><span class="op" id="5053107">.</span><span class="ident" id="5053108">Uint8</span><span class="op" id="5053113">,</span>&nbsp;<span class="ident" id="5053115">reflect</span><span class="op" id="5053122">.</span><span class="ident" id="5053123">Uint16</span><span class="op" id="5053129">,</span>&nbsp;<span class="ident" id="5053131">reflect</span><span class="op" id="5053138">.</span><span class="ident" id="5053139">Uint32</span><span class="op" id="5053145">,</span>&nbsp;<span class="ident" id="5053147">reflect</span><span class="op" id="5053154">.</span><span class="ident" id="5053155">Uint64</span><span class="op" id="5053161">,</span>&nbsp;<span class="ident" id="5053163">reflect</span><span class="op" id="5053170">.</span><span class="ident" id="5053171">Uintptr</span><span class="op" id="5053178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053182">return</span>&nbsp;<span class="ident" id="5053189">tUint</span><span class="op" id="5053194">.</span><span class="ident" id="5053195">gobType</span><span class="op" id="5053202">(</span><span class="op" id="5053203">)</span><span class="op" id="5053204">,</span>&nbsp;<span class="ident" id="5053206">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053212">case</span>&nbsp;<span class="ident" id="5053217">reflect</span><span class="op" id="5053224">.</span><span class="ident" id="5053225">Float32</span><span class="op" id="5053232">,</span>&nbsp;<span class="ident" id="5053234">reflect</span><span class="op" id="5053241">.</span><span class="ident" id="5053242">Float64</span><span class="op" id="5053249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053253">return</span>&nbsp;<span class="ident" id="5053260">tFloat</span><span class="op" id="5053266">.</span><span class="ident" id="5053267">gobType</span><span class="op" id="5053274">(</span><span class="op" id="5053275">)</span><span class="op" id="5053276">,</span>&nbsp;<span class="ident" id="5053278">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053284">case</span>&nbsp;<span class="ident" id="5053289">reflect</span><span class="op" id="5053296">.</span><span class="ident" id="5053297">Complex64</span><span class="op" id="5053306">,</span>&nbsp;<span class="ident" id="5053308">reflect</span><span class="op" id="5053315">.</span><span class="ident" id="5053316">Complex128</span><span class="op" id="5053326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053330">return</span>&nbsp;<span class="ident" id="5053337">tComplex</span><span class="op" id="5053345">.</span><span class="ident" id="5053346">gobType</span><span class="op" id="5053353">(</span><span class="op" id="5053354">)</span><span class="op" id="5053355">,</span>&nbsp;<span class="ident" id="5053357">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053363">case</span>&nbsp;<span class="ident" id="5053368">reflect</span><span class="op" id="5053375">.</span><span class="ident" id="5053376">String</span><span class="op" id="5053382">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053386">return</span>&nbsp;<span class="ident" id="5053393">tString</span><span class="op" id="5053400">.</span><span class="ident" id="5053401">gobType</span><span class="op" id="5053408">(</span><span class="op" id="5053409">)</span><span class="op" id="5053410">,</span>&nbsp;<span class="ident" id="5053412">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053418">case</span>&nbsp;<span class="ident" id="5053423">reflect</span><span class="op" id="5053430">.</span><span class="ident" id="5053431">Interface</span><span class="op" id="5053440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053444">return</span>&nbsp;<span class="ident" id="5053451">tInterface</span><span class="op" id="5053461">.</span><span class="ident" id="5053462">gobType</span><span class="op" id="5053469">(</span><span class="op" id="5053470">)</span><span class="op" id="5053471">,</span>&nbsp;<span class="ident" id="5053473">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053479">case</span>&nbsp;<span class="ident" id="5053484">reflect</span><span class="op" id="5053491">.</span><span class="ident" id="5053492">Array</span><span class="op" id="5053497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053501">at</span>&nbsp;<span class="op" id="5053504">:=</span>&nbsp;<span class="ident" id="5053507">newArrayType</span><span class="op" id="5053519">(</span><span class="ident" id="5053520">name</span><span class="op" id="5053524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053528">types</span><span class="op" id="5053533">[</span><span class="ident" id="5053534">rt</span><span class="op" id="5053536">]</span>&nbsp;<span class="op" id="5053538">=</span>&nbsp;<span class="ident" id="5053540">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053545">type0</span><span class="op" id="5053550">,</span>&nbsp;<span class="ident" id="5053552">err</span>&nbsp;<span class="op" id="5053556">=</span>&nbsp;<span class="ident" id="5053558">getBaseType</span><span class="op" id="5053569">(</span><span class="string" id="5053570">&#34;&#34;</span><span class="op" id="5053572">,</span>&nbsp;<span class="ident" id="5053574">t</span><span class="op" id="5053575">.</span><span class="ident" id="5053576">Elem</span><span class="op" id="5053580">(</span><span class="op" id="5053581">)</span><span class="op" id="5053582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053586">if</span>&nbsp;<span class="ident" id="5053589">err</span>&nbsp;<span class="op" id="5053593">!=</span>&nbsp;<span class="ident" id="5053596">nil</span>&nbsp;<span class="op" id="5053600">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053605">return</span>&nbsp;<span class="ident" id="5053612">nil</span><span class="op" id="5053615">,</span>&nbsp;<span class="ident" id="5053617">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053627">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053650">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053723">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053801">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053871">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053943">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5054014">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5054081">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054137">at</span><span class="op" id="5054139">.</span><span class="ident" id="5054140">init</span><span class="op" id="5054144">(</span><span class="ident" id="5054145">type0</span><span class="op" id="5054150">,</span>&nbsp;<span class="ident" id="5054152">t</span><span class="op" id="5054153">.</span><span class="ident" id="5054154">Len</span><span class="op" id="5054157">(</span><span class="op" id="5054158">)</span><span class="op" id="5054159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054163">return</span>&nbsp;<span class="ident" id="5054170">at</span><span class="op" id="5054172">,</span>&nbsp;<span class="ident" id="5054174">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054180">case</span>&nbsp;<span class="ident" id="5054185">reflect</span><span class="op" id="5054192">.</span><span class="ident" id="5054193">Map</span><span class="op" id="5054196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054200">mt</span>&nbsp;<span class="op" id="5054203">:=</span>&nbsp;<span class="ident" id="5054206">newMapType</span><span class="op" id="5054216">(</span><span class="ident" id="5054217">name</span><span class="op" id="5054221">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054225">types</span><span class="op" id="5054230">[</span><span class="ident" id="5054231">rt</span><span class="op" id="5054233">]</span>&nbsp;<span class="op" id="5054235">=</span>&nbsp;<span class="ident" id="5054237">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054242">type0</span><span class="op" id="5054247">,</span>&nbsp;<span class="ident" id="5054249">err</span>&nbsp;<span class="op" id="5054253">=</span>&nbsp;<span class="ident" id="5054255">getBaseType</span><span class="op" id="5054266">(</span><span class="string" id="5054267">&#34;&#34;</span><span class="op" id="5054269">,</span>&nbsp;<span class="ident" id="5054271">t</span><span class="op" id="5054272">.</span><span class="ident" id="5054273">Key</span><span class="op" id="5054276">(</span><span class="op" id="5054277">)</span><span class="op" id="5054278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054282">if</span>&nbsp;<span class="ident" id="5054285">err</span>&nbsp;<span class="op" id="5054289">!=</span>&nbsp;<span class="ident" id="5054292">nil</span>&nbsp;<span class="op" id="5054296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054301">return</span>&nbsp;<span class="ident" id="5054308">nil</span><span class="op" id="5054311">,</span>&nbsp;<span class="ident" id="5054313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054319">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054323">type1</span><span class="op" id="5054328">,</span>&nbsp;<span class="ident" id="5054330">err</span>&nbsp;<span class="op" id="5054334">=</span>&nbsp;<span class="ident" id="5054336">getBaseType</span><span class="op" id="5054347">(</span><span class="string" id="5054348">&#34;&#34;</span><span class="op" id="5054350">,</span>&nbsp;<span class="ident" id="5054352">t</span><span class="op" id="5054353">.</span><span class="ident" id="5054354">Elem</span><span class="op" id="5054358">(</span><span class="op" id="5054359">)</span><span class="op" id="5054360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054364">if</span>&nbsp;<span class="ident" id="5054367">err</span>&nbsp;<span class="op" id="5054371">!=</span>&nbsp;<span class="ident" id="5054374">nil</span>&nbsp;<span class="op" id="5054378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054383">return</span>&nbsp;<span class="ident" id="5054390">nil</span><span class="op" id="5054393">,</span>&nbsp;<span class="ident" id="5054395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054405">mt</span><span class="op" id="5054407">.</span><span class="ident" id="5054408">init</span><span class="op" id="5054412">(</span><span class="ident" id="5054413">type0</span><span class="op" id="5054418">,</span>&nbsp;<span class="ident" id="5054420">type1</span><span class="op" id="5054425">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054429">return</span>&nbsp;<span class="ident" id="5054436">mt</span><span class="op" id="5054438">,</span>&nbsp;<span class="ident" id="5054440">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054446">case</span>&nbsp;<span class="ident" id="5054451">reflect</span><span class="op" id="5054458">.</span><span class="ident" id="5054459">Slice</span><span class="op" id="5054464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5054468">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054509">if</span>&nbsp;<span class="ident" id="5054512">t</span><span class="op" id="5054513">.</span><span class="ident" id="5054514">Elem</span><span class="op" id="5054518">(</span><span class="op" id="5054519">)</span><span class="op" id="5054520">.</span><span class="ident" id="5054521">Kind</span><span class="op" id="5054525">(</span><span class="op" id="5054526">)</span>&nbsp;<span class="op" id="5054528">==</span>&nbsp;<span class="ident" id="5054531">reflect</span><span class="op" id="5054538">.</span><span class="ident" id="5054539">Uint8</span>&nbsp;<span class="op" id="5054545">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054550">return</span>&nbsp;<span class="ident" id="5054557">tBytes</span><span class="op" id="5054563">.</span><span class="ident" id="5054564">gobType</span><span class="op" id="5054571">(</span><span class="op" id="5054572">)</span><span class="op" id="5054573">,</span>&nbsp;<span class="ident" id="5054575">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054585">st</span>&nbsp;<span class="op" id="5054588">:=</span>&nbsp;<span class="ident" id="5054591">newSliceType</span><span class="op" id="5054603">(</span><span class="ident" id="5054604">name</span><span class="op" id="5054608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054612">types</span><span class="op" id="5054617">[</span><span class="ident" id="5054618">rt</span><span class="op" id="5054620">]</span>&nbsp;<span class="op" id="5054622">=</span>&nbsp;<span class="ident" id="5054624">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054629">type0</span><span class="op" id="5054634">,</span>&nbsp;<span class="ident" id="5054636">err</span>&nbsp;<span class="op" id="5054640">=</span>&nbsp;<span class="ident" id="5054642">getBaseType</span><span class="op" id="5054653">(</span><span class="ident" id="5054654">t</span><span class="op" id="5054655">.</span><span class="ident" id="5054656">Elem</span><span class="op" id="5054660">(</span><span class="op" id="5054661">)</span><span class="op" id="5054662">.</span><span class="ident" id="5054663">Name</span><span class="op" id="5054667">(</span><span class="op" id="5054668">)</span><span class="op" id="5054669">,</span>&nbsp;<span class="ident" id="5054671">t</span><span class="op" id="5054672">.</span><span class="ident" id="5054673">Elem</span><span class="op" id="5054677">(</span><span class="op" id="5054678">)</span><span class="op" id="5054679">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054683">if</span>&nbsp;<span class="ident" id="5054686">err</span>&nbsp;<span class="op" id="5054690">!=</span>&nbsp;<span class="ident" id="5054693">nil</span>&nbsp;<span class="op" id="5054697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054702">return</span>&nbsp;<span class="ident" id="5054709">nil</span><span class="op" id="5054712">,</span>&nbsp;<span class="ident" id="5054714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054724">st</span><span class="op" id="5054726">.</span><span class="ident" id="5054727">init</span><span class="op" id="5054731">(</span><span class="ident" id="5054732">type0</span><span class="op" id="5054737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054741">return</span>&nbsp;<span class="ident" id="5054748">st</span><span class="op" id="5054750">,</span>&nbsp;<span class="ident" id="5054752">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054758">case</span>&nbsp;<span class="ident" id="5054763">reflect</span><span class="op" id="5054770">.</span><span class="ident" id="5054771">Struct</span><span class="op" id="5054777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054781">st</span>&nbsp;<span class="op" id="5054784">:=</span>&nbsp;<span class="ident" id="5054787">newStructType</span><span class="op" id="5054800">(</span><span class="ident" id="5054801">name</span><span class="op" id="5054805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054809">types</span><span class="op" id="5054814">[</span><span class="ident" id="5054815">rt</span><span class="op" id="5054817">]</span>&nbsp;<span class="op" id="5054819">=</span>&nbsp;<span class="ident" id="5054821">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054826">idToType</span><span class="op" id="5054834">[</span><span class="ident" id="5054835">st</span><span class="op" id="5054837">.</span><span class="ident" id="5054838">id</span><span class="op" id="5054840">(</span><span class="op" id="5054841">)</span><span class="op" id="5054842">]</span>&nbsp;<span class="op" id="5054844">=</span>&nbsp;<span class="ident" id="5054846">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054851">for</span>&nbsp;<span class="ident" id="5054855">i</span>&nbsp;<span class="op" id="5054857">:=</span>&nbsp;<span class="num" id="5054860">0</span><span class="op" id="5054861">;</span>&nbsp;<span class="ident" id="5054863">i</span>&nbsp;<span class="op" id="5054865">&lt;</span>&nbsp;<span class="ident" id="5054867">t</span><span class="op" id="5054868">.</span><span class="ident" id="5054869">NumField</span><span class="op" id="5054877">(</span><span class="op" id="5054878">)</span><span class="op" id="5054879">;</span>&nbsp;<span class="ident" id="5054881">i</span><span class="op" id="5054882">++</span>&nbsp;<span class="op" id="5054885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054890">f</span>&nbsp;<span class="op" id="5054892">:=</span>&nbsp;<span class="ident" id="5054895">t</span><span class="op" id="5054896">.</span><span class="ident" id="5054897">Field</span><span class="op" id="5054902">(</span><span class="ident" id="5054903">i</span><span class="op" id="5054904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054909">if</span>&nbsp;<span class="op" id="5054912">!</span><span class="ident" id="5054913">isSent</span><span class="op" id="5054919">(</span><span class="op" id="5054920">&amp;</span><span class="ident" id="5054921">f</span><span class="op" id="5054922">)</span>&nbsp;<span class="op" id="5054924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054942">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054947">typ</span>&nbsp;<span class="op" id="5054951">:=</span>&nbsp;<span class="ident" id="5054954">userType</span><span class="op" id="5054962">(</span><span class="ident" id="5054963">f</span><span class="op" id="5054964">.</span><span class="ident" id="5054965">Type</span><span class="op" id="5054969">)</span><span class="op" id="5054970">.</span><span class="ident" id="5054971">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054979">tname</span>&nbsp;<span class="op" id="5054985">:=</span>&nbsp;<span class="ident" id="5054988">typ</span><span class="op" id="5054991">.</span><span class="ident" id="5054992">Name</span><span class="op" id="5054996">(</span><span class="op" id="5054997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055002">if</span>&nbsp;<span class="ident" id="5055005">tname</span>&nbsp;<span class="op" id="5055011">==</span>&nbsp;<span class="string" id="5055014">&#34;&#34;</span>&nbsp;<span class="op" id="5055017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055023">t</span>&nbsp;<span class="op" id="5055025">:=</span>&nbsp;<span class="ident" id="5055028">userType</span><span class="op" id="5055036">(</span><span class="ident" id="5055037">f</span><span class="op" id="5055038">.</span><span class="ident" id="5055039">Type</span><span class="op" id="5055043">)</span><span class="op" id="5055044">.</span><span class="ident" id="5055045">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055054">tname</span>&nbsp;<span class="op" id="5055060">=</span>&nbsp;<span class="ident" id="5055062">t</span><span class="op" id="5055063">.</span><span class="ident" id="5055064">String</span><span class="op" id="5055070">(</span><span class="op" id="5055071">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055081">gt</span><span class="op" id="5055083">,</span>&nbsp;<span class="ident" id="5055085">err</span>&nbsp;<span class="op" id="5055089">:=</span>&nbsp;<span class="ident" id="5055092">getBaseType</span><span class="op" id="5055103">(</span><span class="ident" id="5055104">tname</span><span class="op" id="5055109">,</span>&nbsp;<span class="ident" id="5055111">f</span><span class="op" id="5055112">.</span><span class="ident" id="5055113">Type</span><span class="op" id="5055117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055122">if</span>&nbsp;<span class="ident" id="5055125">err</span>&nbsp;<span class="op" id="5055129">!=</span>&nbsp;<span class="ident" id="5055132">nil</span>&nbsp;<span class="op" id="5055136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055142">return</span>&nbsp;<span class="ident" id="5055149">nil</span><span class="op" id="5055152">,</span>&nbsp;<span class="ident" id="5055154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055161">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055166">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055232">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055296">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055365">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055435">if</span>&nbsp;<span class="ident" id="5055438">gt</span><span class="op" id="5055440">.</span><span class="ident" id="5055441">id</span><span class="op" id="5055443">(</span><span class="op" id="5055444">)</span>&nbsp;<span class="op" id="5055446">==</span>&nbsp;<span class="num" id="5055449">0</span>&nbsp;<span class="op" id="5055451">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055457">setTypeId</span><span class="op" id="5055466">(</span><span class="ident" id="5055467">gt</span><span class="op" id="5055469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055479">st</span><span class="op" id="5055481">.</span><span class="ident" id="5055482">Field</span>&nbsp;<span class="op" id="5055488">=</span>&nbsp;<span class="builtinfunc" id="5055490">append</span><span class="op" id="5055496">(</span><span class="ident" id="5055497">st</span><span class="op" id="5055499">.</span><span class="ident" id="5055500">Field</span><span class="op" id="5055505">,</span>&nbsp;<span class="op" id="5055507">&amp;</span><span class="ident" id="5055508">fieldType</span><span class="op" id="5055517">{</span><span class="ident" id="5055518">f</span><span class="op" id="5055519">.</span><span class="ident" id="5055520">Name</span><span class="op" id="5055524">,</span>&nbsp;<span class="ident" id="5055526">gt</span><span class="op" id="5055528">.</span><span class="ident" id="5055529">id</span><span class="op" id="5055531">(</span><span class="op" id="5055532">)</span><span class="op" id="5055533">}</span><span class="op" id="5055534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055542">return</span>&nbsp;<span class="ident" id="5055549">st</span><span class="op" id="5055551">,</span>&nbsp;<span class="ident" id="5055553">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055559">default</span><span class="op" id="5055566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055570">return</span>&nbsp;<span class="ident" id="5055577">nil</span><span class="op" id="5055580">,</span>&nbsp;<span class="ident" id="5055582">errors</span><span class="op" id="5055588">.</span><span class="ident" id="5055589">New</span><span class="op" id="5055592">(</span><span class="string" id="5055593">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5055633">+</span>&nbsp;<span class="ident" id="5055635">rt</span><span class="op" id="5055637">.</span><span class="ident" id="5055638">String</span><span class="op" id="5055644">(</span><span class="op" id="5055645">)</span><span class="op" id="5055646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055649">}</span><br>
<span class="lineno"></span><span class="op" id="5055651">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5055654">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5055725">func</span>&nbsp;<span class="ident" id="5055730">isExported</span><span class="op" id="5055740">(</span><span class="ident" id="5055741">name</span>&nbsp;<span class="builtintype" id="5055746">string</span><span class="op" id="5055752">)</span>&nbsp;<span class="builtintype" id="5055754">bool</span>&nbsp;<span class="op" id="5055759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5055762">rune</span><span class="op" id="5055766">,</span>&nbsp;<span class="ident" id="5055768">_</span>&nbsp;<span class="op" id="5055770">:=</span>&nbsp;<span class="ident" id="5055773">utf8</span><span class="op" id="5055777">.</span><span class="ident" id="5055778">DecodeRuneInString</span><span class="op" id="5055796">(</span><span class="ident" id="5055797">name</span><span class="op" id="5055801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055804">return</span>&nbsp;<span class="ident" id="5055811">unicode</span><span class="op" id="5055818">.</span><span class="ident" id="5055819">IsUpper</span><span class="op" id="5055826">(</span><span class="builtintype" id="5055827">rune</span><span class="op" id="5055831">)</span><br>
<span class="lineno">570</span><span class="op" id="5055833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5055836">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5055902">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5055980">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5056011">func</span>&nbsp;<span class="ident" id="5056016">isSent</span><span class="op" id="5056022">(</span><span class="ident" id="5056023">field</span>&nbsp;<span class="op" id="5056029">*</span><span class="ident" id="5056030">reflect</span><span class="op" id="5056037">.</span><span class="ident" id="5056038">StructField</span><span class="op" id="5056049">)</span>&nbsp;<span class="builtintype" id="5056051">bool</span>&nbsp;<span class="op" id="5056056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056059">if</span>&nbsp;<span class="op" id="5056062">!</span><span class="ident" id="5056063">isExported</span><span class="op" id="5056073">(</span><span class="ident" id="5056074">field</span><span class="op" id="5056079">.</span><span class="ident" id="5056080">Name</span><span class="op" id="5056084">)</span>&nbsp;<span class="op" id="5056086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056090">return</span>&nbsp;<span class="builtintype" id="5056097">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5056107">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5056177">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056225">typ</span>&nbsp;<span class="op" id="5056229">:=</span>&nbsp;<span class="ident" id="5056232">field</span><span class="op" id="5056237">.</span><span class="ident" id="5056238">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056244">for</span>&nbsp;<span class="ident" id="5056248">typ</span><span class="op" id="5056251">.</span><span class="ident" id="5056252">Kind</span><span class="op" id="5056256">(</span><span class="op" id="5056257">)</span>&nbsp;<span class="op" id="5056259">==</span>&nbsp;<span class="ident" id="5056262">reflect</span><span class="op" id="5056269">.</span><span class="ident" id="5056270">Ptr</span>&nbsp;<span class="op" id="5056274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056278">typ</span>&nbsp;<span class="op" id="5056282">=</span>&nbsp;<span class="ident" id="5056284">typ</span><span class="op" id="5056287">.</span><span class="ident" id="5056288">Elem</span><span class="op" id="5056292">(</span><span class="op" id="5056293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056296">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056299">if</span>&nbsp;<span class="ident" id="5056302">typ</span><span class="op" id="5056305">.</span><span class="ident" id="5056306">Kind</span><span class="op" id="5056310">(</span><span class="op" id="5056311">)</span>&nbsp;<span class="op" id="5056313">==</span>&nbsp;<span class="ident" id="5056316">reflect</span><span class="op" id="5056323">.</span><span class="ident" id="5056324">Chan</span>&nbsp;<span class="op" id="5056329">||</span>&nbsp;<span class="ident" id="5056332">typ</span><span class="op" id="5056335">.</span><span class="ident" id="5056336">Kind</span><span class="op" id="5056340">(</span><span class="op" id="5056341">)</span>&nbsp;<span class="op" id="5056343">==</span>&nbsp;<span class="ident" id="5056346">reflect</span><span class="op" id="5056353">.</span><span class="ident" id="5056354">Func</span>&nbsp;<span class="op" id="5056359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056363">return</span>&nbsp;<span class="builtintype" id="5056370">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056380">return</span>&nbsp;<span class="builtintype" id="5056387">true</span><br>
<span class="lineno"></span><span class="op" id="5056392">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5056395">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5056478">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5056504">func</span>&nbsp;<span class="ident" id="5056509">getBaseType</span><span class="op" id="5056520">(</span><span class="ident" id="5056521">name</span>&nbsp;<span class="builtintype" id="5056526">string</span><span class="op" id="5056532">,</span>&nbsp;<span class="ident" id="5056534">rt</span>&nbsp;<span class="ident" id="5056537">reflect</span><span class="op" id="5056544">.</span><span class="ident" id="5056545">Type</span><span class="op" id="5056549">)</span>&nbsp;<span class="op" id="5056551">(</span><span class="ident" id="5056552">gobType</span><span class="op" id="5056559">,</span>&nbsp;<span class="builtintype" id="5056561">error</span><span class="op" id="5056566">)</span>&nbsp;<span class="op" id="5056568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056571">ut</span>&nbsp;<span class="op" id="5056574">:=</span>&nbsp;<span class="ident" id="5056577">userType</span><span class="op" id="5056585">(</span><span class="ident" id="5056586">rt</span><span class="op" id="5056588">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056591">return</span>&nbsp;<span class="ident" id="5056598">getType</span><span class="op" id="5056605">(</span><span class="ident" id="5056606">name</span><span class="op" id="5056610">,</span>&nbsp;<span class="ident" id="5056612">ut</span><span class="op" id="5056614">,</span>&nbsp;<span class="ident" id="5056616">ut</span><span class="op" id="5056618">.</span><span class="ident" id="5056619">base</span><span class="op" id="5056623">)</span><br>
<span class="lineno"></span><span class="op" id="5056625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5056628">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5056695">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5056756">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5056823">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5056854">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5056880">func</span>&nbsp;<span class="ident" id="5056885">getType</span><span class="op" id="5056892">(</span><span class="ident" id="5056893">name</span>&nbsp;<span class="builtintype" id="5056898">string</span><span class="op" id="5056904">,</span>&nbsp;<span class="ident" id="5056906">ut</span>&nbsp;<span class="op" id="5056909">*</span><span class="ident" id="5056910">userTypeInfo</span><span class="op" id="5056922">,</span>&nbsp;<span class="ident" id="5056924">rt</span>&nbsp;<span class="ident" id="5056927">reflect</span><span class="op" id="5056934">.</span><span class="ident" id="5056935">Type</span><span class="op" id="5056939">)</span>&nbsp;<span class="op" id="5056941">(</span><span class="ident" id="5056942">gobType</span><span class="op" id="5056949">,</span>&nbsp;<span class="builtintype" id="5056951">error</span><span class="op" id="5056956">)</span>&nbsp;<span class="op" id="5056958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056961">typ</span><span class="op" id="5056964">,</span>&nbsp;<span class="ident" id="5056966">present</span>&nbsp;<span class="op" id="5056974">:=</span>&nbsp;<span class="ident" id="5056977">types</span><span class="op" id="5056982">[</span><span class="ident" id="5056983">rt</span><span class="op" id="5056985">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056988">if</span>&nbsp;<span class="ident" id="5056991">present</span>&nbsp;<span class="op" id="5056999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057003">return</span>&nbsp;<span class="ident" id="5057010">typ</span><span class="op" id="5057013">,</span>&nbsp;<span class="ident" id="5057015">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057023">typ</span><span class="op" id="5057026">,</span>&nbsp;<span class="ident" id="5057028">err</span>&nbsp;<span class="op" id="5057032">:=</span>&nbsp;<span class="ident" id="5057035">newTypeObject</span><span class="op" id="5057048">(</span><span class="ident" id="5057049">name</span><span class="op" id="5057053">,</span>&nbsp;<span class="ident" id="5057055">ut</span><span class="op" id="5057057">,</span>&nbsp;<span class="ident" id="5057059">rt</span><span class="op" id="5057061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057064">if</span>&nbsp;<span class="ident" id="5057067">err</span>&nbsp;<span class="op" id="5057071">==</span>&nbsp;<span class="ident" id="5057074">nil</span>&nbsp;<span class="op" id="5057078">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057082">types</span><span class="op" id="5057087">[</span><span class="ident" id="5057088">rt</span><span class="op" id="5057090">]</span>&nbsp;<span class="op" id="5057092">=</span>&nbsp;<span class="ident" id="5057094">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057102">return</span>&nbsp;<span class="ident" id="5057109">typ</span><span class="op" id="5057112">,</span>&nbsp;<span class="ident" id="5057114">err</span><br>
<span class="lineno"></span><span class="op" id="5057118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5057121">func</span>&nbsp;<span class="ident" id="5057126">checkId</span><span class="op" id="5057133">(</span><span class="ident" id="5057134">want</span><span class="op" id="5057138">,</span>&nbsp;<span class="ident" id="5057140">got</span>&nbsp;<span class="ident" id="5057144">typeId</span><span class="op" id="5057150">)</span>&nbsp;<span class="op" id="5057152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057155">if</span>&nbsp;<span class="ident" id="5057158">want</span>&nbsp;<span class="op" id="5057163">!=</span>&nbsp;<span class="ident" id="5057166">got</span>&nbsp;<span class="op" id="5057170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057174">fmt</span><span class="op" id="5057177">.</span><span class="ident" id="5057178">Fprintf</span><span class="op" id="5057185">(</span><span class="ident" id="5057186">os</span><span class="op" id="5057188">.</span><span class="ident" id="5057189">Stderr</span><span class="op" id="5057195">,</span>&nbsp;<span class="string" id="5057197">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5057225">,</span>&nbsp;<span class="builtintype" id="5057227">int</span><span class="op" id="5057230">(</span><span class="ident" id="5057231">got</span><span class="op" id="5057234">)</span><span class="op" id="5057235">,</span>&nbsp;<span class="builtintype" id="5057237">int</span><span class="op" id="5057240">(</span><span class="ident" id="5057241">want</span><span class="op" id="5057245">)</span><span class="op" id="5057246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5057250">panic</span><span class="op" id="5057255">(</span><span class="string" id="5057256">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5057284">+</span>&nbsp;<span class="ident" id="5057286">got</span><span class="op" id="5057289">.</span><span class="ident" id="5057290">name</span><span class="op" id="5057294">(</span><span class="op" id="5057295">)</span>&nbsp;<span class="op" id="5057297">+</span>&nbsp;<span class="string" id="5057299">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5057303">+</span>&nbsp;<span class="ident" id="5057305">got</span><span class="op" id="5057308">.</span><span class="builtintype" id="5057309">string</span><span class="op" id="5057315">(</span><span class="op" id="5057316">)</span>&nbsp;<span class="op" id="5057318">+</span>&nbsp;<span class="string" id="5057320">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5057328">+</span>&nbsp;<span class="ident" id="5057330">want</span><span class="op" id="5057334">.</span><span class="builtintype" id="5057335">string</span><span class="op" id="5057341">(</span><span class="op" id="5057342">)</span><span class="op" id="5057343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057346">}</span><br>
<span class="lineno">620</span><span class="op" id="5057348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5057351">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5057428">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5057469">func</span>&nbsp;<span class="ident" id="5057474">bootstrapType</span><span class="op" id="5057487">(</span><span class="ident" id="5057488">name</span>&nbsp;<span class="builtintype" id="5057493">string</span><span class="op" id="5057499">,</span>&nbsp;<span class="ident" id="5057501">e</span>&nbsp;<span class="keyword" id="5057503">interface</span><span class="op" id="5057512">{</span><span class="op" id="5057513">}</span><span class="op" id="5057514">,</span>&nbsp;<span class="ident" id="5057516">expect</span>&nbsp;<span class="ident" id="5057523">typeId</span><span class="op" id="5057529">)</span>&nbsp;<span class="ident" id="5057531">typeId</span>&nbsp;<span class="op" id="5057538">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057541">rt</span>&nbsp;<span class="op" id="5057544">:=</span>&nbsp;<span class="ident" id="5057547">reflect</span><span class="op" id="5057554">.</span><span class="ident" id="5057555">TypeOf</span><span class="op" id="5057561">(</span><span class="ident" id="5057562">e</span><span class="op" id="5057563">)</span><span class="op" id="5057564">.</span><span class="ident" id="5057565">Elem</span><span class="op" id="5057569">(</span><span class="op" id="5057570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057573">_</span><span class="op" id="5057574">,</span>&nbsp;<span class="ident" id="5057576">present</span>&nbsp;<span class="op" id="5057584">:=</span>&nbsp;<span class="ident" id="5057587">types</span><span class="op" id="5057592">[</span><span class="ident" id="5057593">rt</span><span class="op" id="5057595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057598">if</span>&nbsp;<span class="ident" id="5057601">present</span>&nbsp;<span class="op" id="5057609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5057613">panic</span><span class="op" id="5057618">(</span><span class="string" id="5057619">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5057654">+</span>&nbsp;<span class="ident" id="5057656">name</span>&nbsp;<span class="op" id="5057661">+</span>&nbsp;<span class="string" id="5057663">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5057668">+</span>&nbsp;<span class="ident" id="5057670">rt</span><span class="op" id="5057672">.</span><span class="ident" id="5057673">String</span><span class="op" id="5057679">(</span><span class="op" id="5057680">)</span><span class="op" id="5057681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057684">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057687">typ</span>&nbsp;<span class="op" id="5057691">:=</span>&nbsp;<span class="op" id="5057694">&amp;</span><span class="ident" id="5057695">CommonType</span><span class="op" id="5057705">{</span><span class="ident" id="5057706">Name</span><span class="op" id="5057710">:</span>&nbsp;<span class="ident" id="5057712">name</span><span class="op" id="5057716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057719">types</span><span class="op" id="5057724">[</span><span class="ident" id="5057725">rt</span><span class="op" id="5057727">]</span>&nbsp;<span class="op" id="5057729">=</span>&nbsp;<span class="ident" id="5057731">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057736">setTypeId</span><span class="op" id="5057745">(</span><span class="ident" id="5057746">typ</span><span class="op" id="5057749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057752">checkId</span><span class="op" id="5057759">(</span><span class="ident" id="5057760">expect</span><span class="op" id="5057766">,</span>&nbsp;<span class="ident" id="5057768">nextId</span><span class="op" id="5057774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057777">userType</span><span class="op" id="5057785">(</span><span class="ident" id="5057786">rt</span><span class="op" id="5057788">)</span>&nbsp;<span class="comment" id="5057790">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057821">return</span>&nbsp;<span class="ident" id="5057828">nextId</span><br>
<span class="lineno"></span><span class="op" id="5057835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5057838">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5057912">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5057986">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5058060">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5058080">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5058150">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5058227">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5058301">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5058373">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5058418">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5058491">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5058515">type</span>&nbsp;<span class="ident" id="5058520">wireType</span>&nbsp;<span class="keyword" id="5058529">struct</span>&nbsp;<span class="op" id="5058536">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058539">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5058556">*</span><span class="ident" id="5058557">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058568">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5058585">*</span><span class="ident" id="5058586">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058597">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5058614">*</span><span class="ident" id="5058615">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058627">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5058644">*</span><span class="ident" id="5058645">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058654">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5058671">*</span><span class="ident" id="5058672">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058688">BinaryMarshalerT</span>&nbsp;<span class="op" id="5058705">*</span><span class="ident" id="5058706">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058722">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5058739">*</span><span class="ident" id="5058740">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5058755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5058758">func</span>&nbsp;<span class="op" id="5058763">(</span><span class="ident" id="5058764">w</span>&nbsp;<span class="op" id="5058766">*</span><span class="ident" id="5058767">wireType</span><span class="op" id="5058775">)</span>&nbsp;<span class="builtintype" id="5058777">string</span><span class="op" id="5058783">(</span><span class="op" id="5058784">)</span>&nbsp;<span class="builtintype" id="5058786">string</span>&nbsp;<span class="op" id="5058793">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058796">const</span>&nbsp;<span class="ident" id="5058802">unknown</span>&nbsp;<span class="op" id="5058810">=</span>&nbsp;<span class="string" id="5058812">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058828">if</span>&nbsp;<span class="ident" id="5058831">w</span>&nbsp;<span class="op" id="5058833">==</span>&nbsp;<span class="ident" id="5058836">nil</span>&nbsp;<span class="op" id="5058840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058844">return</span>&nbsp;<span class="ident" id="5058851">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5058860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058863">switch</span>&nbsp;<span class="op" id="5058870">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058873">case</span>&nbsp;<span class="ident" id="5058878">w</span><span class="op" id="5058879">.</span><span class="ident" id="5058880">ArrayT</span>&nbsp;<span class="op" id="5058887">!=</span>&nbsp;<span class="ident" id="5058890">nil</span><span class="op" id="5058893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058897">return</span>&nbsp;<span class="ident" id="5058904">w</span><span class="op" id="5058905">.</span><span class="ident" id="5058906">ArrayT</span><span class="op" id="5058912">.</span><span class="ident" id="5058913">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058919">case</span>&nbsp;<span class="ident" id="5058924">w</span><span class="op" id="5058925">.</span><span class="ident" id="5058926">SliceT</span>&nbsp;<span class="op" id="5058933">!=</span>&nbsp;<span class="ident" id="5058936">nil</span><span class="op" id="5058939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058943">return</span>&nbsp;<span class="ident" id="5058950">w</span><span class="op" id="5058951">.</span><span class="ident" id="5058952">SliceT</span><span class="op" id="5058958">.</span><span class="ident" id="5058959">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058965">case</span>&nbsp;<span class="ident" id="5058970">w</span><span class="op" id="5058971">.</span><span class="ident" id="5058972">StructT</span>&nbsp;<span class="op" id="5058980">!=</span>&nbsp;<span class="ident" id="5058983">nil</span><span class="op" id="5058986">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058990">return</span>&nbsp;<span class="ident" id="5058997">w</span><span class="op" id="5058998">.</span><span class="ident" id="5058999">StructT</span><span class="op" id="5059006">.</span><span class="ident" id="5059007">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059013">case</span>&nbsp;<span class="ident" id="5059018">w</span><span class="op" id="5059019">.</span><span class="ident" id="5059020">MapT</span>&nbsp;<span class="op" id="5059025">!=</span>&nbsp;<span class="ident" id="5059028">nil</span><span class="op" id="5059031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059035">return</span>&nbsp;<span class="ident" id="5059042">w</span><span class="op" id="5059043">.</span><span class="ident" id="5059044">MapT</span><span class="op" id="5059048">.</span><span class="ident" id="5059049">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059055">case</span>&nbsp;<span class="ident" id="5059060">w</span><span class="op" id="5059061">.</span><span class="ident" id="5059062">GobEncoderT</span>&nbsp;<span class="op" id="5059074">!=</span>&nbsp;<span class="ident" id="5059077">nil</span><span class="op" id="5059080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059084">return</span>&nbsp;<span class="ident" id="5059091">w</span><span class="op" id="5059092">.</span><span class="ident" id="5059093">GobEncoderT</span><span class="op" id="5059104">.</span><span class="ident" id="5059105">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059111">case</span>&nbsp;<span class="ident" id="5059116">w</span><span class="op" id="5059117">.</span><span class="ident" id="5059118">BinaryMarshalerT</span>&nbsp;<span class="op" id="5059135">!=</span>&nbsp;<span class="ident" id="5059138">nil</span><span class="op" id="5059141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059145">return</span>&nbsp;<span class="ident" id="5059152">w</span><span class="op" id="5059153">.</span><span class="ident" id="5059154">BinaryMarshalerT</span><span class="op" id="5059170">.</span><span class="ident" id="5059171">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059177">case</span>&nbsp;<span class="ident" id="5059182">w</span><span class="op" id="5059183">.</span><span class="ident" id="5059184">TextMarshalerT</span>&nbsp;<span class="op" id="5059199">!=</span>&nbsp;<span class="ident" id="5059202">nil</span><span class="op" id="5059205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059209">return</span>&nbsp;<span class="ident" id="5059216">w</span><span class="op" id="5059217">.</span><span class="ident" id="5059218">TextMarshalerT</span><span class="op" id="5059232">.</span><span class="ident" id="5059233">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5059239">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059242">return</span>&nbsp;<span class="ident" id="5059249">unknown</span><br>
<span class="lineno"></span><span class="op" id="5059257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5059260">type</span>&nbsp;<span class="ident" id="5059265">typeInfo</span>&nbsp;<span class="keyword" id="5059274">struct</span>&nbsp;<span class="op" id="5059281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059284">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5059292">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059300">encInit</span>&nbsp;<span class="ident" id="5059308">sync</span><span class="op" id="5059312">.</span><span class="ident" id="5059313">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5059321">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059354">encoder</span>&nbsp;<span class="ident" id="5059362">atomic</span><span class="op" id="5059368">.</span><span class="ident" id="5059369">Value</span>&nbsp;<span class="comment" id="5059375">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059390">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5059398">*</span><span class="ident" id="5059399">wireType</span><br>
<span class="lineno"></span><span class="op" id="5059408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5059411">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5059478">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5059540">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5059610">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5059680">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5059752">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5059777">var</span>&nbsp;<span class="ident" id="5059781">typeInfoMap</span>&nbsp;<span class="ident" id="5059793">atomic</span><span class="op" id="5059799">.</span><span class="ident" id="5059800">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5059807">func</span>&nbsp;<span class="ident" id="5059812">lookupTypeInfo</span><span class="op" id="5059826">(</span><span class="ident" id="5059827">rt</span>&nbsp;<span class="ident" id="5059830">reflect</span><span class="op" id="5059837">.</span><span class="ident" id="5059838">Type</span><span class="op" id="5059842">)</span>&nbsp;<span class="op" id="5059844">*</span><span class="ident" id="5059845">typeInfo</span>&nbsp;<span class="op" id="5059854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059857">m</span><span class="op" id="5059858">,</span>&nbsp;<span class="ident" id="5059860">_</span>&nbsp;<span class="op" id="5059862">:=</span>&nbsp;<span class="ident" id="5059865">typeInfoMap</span><span class="op" id="5059876">.</span><span class="ident" id="5059877">Load</span><span class="op" id="5059881">(</span><span class="op" id="5059882">)</span><span class="op" id="5059883">.</span><span class="op" id="5059884">(</span><span class="keyword" id="5059885">map</span><span class="op" id="5059888">[</span><span class="ident" id="5059889">reflect</span><span class="op" id="5059896">.</span><span class="ident" id="5059897">Type</span><span class="op" id="5059901">]</span><span class="op" id="5059902">*</span><span class="ident" id="5059903">typeInfo</span><span class="op" id="5059911">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059914">return</span>&nbsp;<span class="ident" id="5059921">m</span><span class="op" id="5059922">[</span><span class="ident" id="5059923">rt</span><span class="op" id="5059925">]</span><br>
<span class="lineno"></span><span class="op" id="5059927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5059930">func</span>&nbsp;<span class="ident" id="5059935">getTypeInfo</span><span class="op" id="5059946">(</span><span class="ident" id="5059947">ut</span>&nbsp;<span class="op" id="5059950">*</span><span class="ident" id="5059951">userTypeInfo</span><span class="op" id="5059963">)</span>&nbsp;<span class="op" id="5059965">(</span><span class="op" id="5059966">*</span><span class="ident" id="5059967">typeInfo</span><span class="op" id="5059975">,</span>&nbsp;<span class="builtintype" id="5059977">error</span><span class="op" id="5059982">)</span>&nbsp;<span class="op" id="5059984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059987">rt</span>&nbsp;<span class="op" id="5059990">:=</span>&nbsp;<span class="ident" id="5059993">ut</span><span class="op" id="5059995">.</span><span class="ident" id="5059996">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060002">if</span>&nbsp;<span class="ident" id="5060005">ut</span><span class="op" id="5060007">.</span><span class="ident" id="5060008">externalEnc</span>&nbsp;<span class="op" id="5060020">!=</span>&nbsp;<span class="num" id="5060023">0</span>&nbsp;<span class="op" id="5060025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5060029">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060076">rt</span>&nbsp;<span class="op" id="5060079">=</span>&nbsp;<span class="ident" id="5060081">ut</span><span class="op" id="5060083">.</span><span class="ident" id="5060084">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060093">if</span>&nbsp;<span class="ident" id="5060096">info</span>&nbsp;<span class="op" id="5060101">:=</span>&nbsp;<span class="ident" id="5060104">lookupTypeInfo</span><span class="op" id="5060118">(</span><span class="ident" id="5060119">rt</span><span class="op" id="5060121">)</span><span class="op" id="5060122">;</span>&nbsp;<span class="ident" id="5060124">info</span>&nbsp;<span class="op" id="5060129">!=</span>&nbsp;<span class="ident" id="5060132">nil</span>&nbsp;<span class="op" id="5060136">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060140">return</span>&nbsp;<span class="ident" id="5060147">info</span><span class="op" id="5060151">,</span>&nbsp;<span class="ident" id="5060153">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060161">return</span>&nbsp;<span class="ident" id="5060168">buildTypeInfo</span><span class="op" id="5060181">(</span><span class="ident" id="5060182">ut</span><span class="op" id="5060184">,</span>&nbsp;<span class="ident" id="5060186">rt</span><span class="op" id="5060188">)</span><br>
<span class="lineno"></span><span class="op" id="5060190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5060193">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5060255">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5060294">func</span>&nbsp;<span class="ident" id="5060299">buildTypeInfo</span><span class="op" id="5060312">(</span><span class="ident" id="5060313">ut</span>&nbsp;<span class="op" id="5060316">*</span><span class="ident" id="5060317">userTypeInfo</span><span class="op" id="5060329">,</span>&nbsp;<span class="ident" id="5060331">rt</span>&nbsp;<span class="ident" id="5060334">reflect</span><span class="op" id="5060341">.</span><span class="ident" id="5060342">Type</span><span class="op" id="5060346">)</span>&nbsp;<span class="op" id="5060348">(</span><span class="op" id="5060349">*</span><span class="ident" id="5060350">typeInfo</span><span class="op" id="5060358">,</span>&nbsp;<span class="builtintype" id="5060360">error</span><span class="op" id="5060365">)</span>&nbsp;<span class="op" id="5060367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060370">typeLock</span><span class="op" id="5060378">.</span><span class="ident" id="5060379">Lock</span><span class="op" id="5060383">(</span><span class="op" id="5060384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060387">defer</span>&nbsp;<span class="ident" id="5060393">typeLock</span><span class="op" id="5060401">.</span><span class="ident" id="5060402">Unlock</span><span class="op" id="5060408">(</span><span class="op" id="5060409">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060413">if</span>&nbsp;<span class="ident" id="5060416">info</span>&nbsp;<span class="op" id="5060421">:=</span>&nbsp;<span class="ident" id="5060424">lookupTypeInfo</span><span class="op" id="5060438">(</span><span class="ident" id="5060439">rt</span><span class="op" id="5060441">)</span><span class="op" id="5060442">;</span>&nbsp;<span class="ident" id="5060444">info</span>&nbsp;<span class="op" id="5060449">!=</span>&nbsp;<span class="ident" id="5060452">nil</span>&nbsp;<span class="op" id="5060456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060460">return</span>&nbsp;<span class="ident" id="5060467">info</span><span class="op" id="5060471">,</span>&nbsp;<span class="ident" id="5060473">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060482">gt</span><span class="op" id="5060484">,</span>&nbsp;<span class="ident" id="5060486">err</span>&nbsp;<span class="op" id="5060490">:=</span>&nbsp;<span class="ident" id="5060493">getBaseType</span><span class="op" id="5060504">(</span><span class="ident" id="5060505">rt</span><span class="op" id="5060507">.</span><span class="ident" id="5060508">Name</span><span class="op" id="5060512">(</span><span class="op" id="5060513">)</span><span class="op" id="5060514">,</span>&nbsp;<span class="ident" id="5060516">rt</span><span class="op" id="5060518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060521">if</span>&nbsp;<span class="ident" id="5060524">err</span>&nbsp;<span class="op" id="5060528">!=</span>&nbsp;<span class="ident" id="5060531">nil</span>&nbsp;<span class="op" id="5060535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060539">return</span>&nbsp;<span class="ident" id="5060546">nil</span><span class="op" id="5060549">,</span>&nbsp;<span class="ident" id="5060551">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060559">info</span>&nbsp;<span class="op" id="5060564">:=</span>&nbsp;<span class="op" id="5060567">&amp;</span><span class="ident" id="5060568">typeInfo</span><span class="op" id="5060576">{</span><span class="ident" id="5060577">id</span><span class="op" id="5060579">:</span>&nbsp;<span class="ident" id="5060581">gt</span><span class="op" id="5060583">.</span><span class="ident" id="5060584">id</span><span class="op" id="5060586">(</span><span class="op" id="5060587">)</span><span class="op" id="5060588">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060592">if</span>&nbsp;<span class="ident" id="5060595">ut</span><span class="op" id="5060597">.</span><span class="ident" id="5060598">externalEnc</span>&nbsp;<span class="op" id="5060610">!=</span>&nbsp;<span class="num" id="5060613">0</span>&nbsp;<span class="op" id="5060615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060619">userType</span><span class="op" id="5060627">,</span>&nbsp;<span class="ident" id="5060629">err</span>&nbsp;<span class="op" id="5060633">:=</span>&nbsp;<span class="ident" id="5060636">getType</span><span class="op" id="5060643">(</span><span class="ident" id="5060644">rt</span><span class="op" id="5060646">.</span><span class="ident" id="5060647">Name</span><span class="op" id="5060651">(</span><span class="op" id="5060652">)</span><span class="op" id="5060653">,</span>&nbsp;<span class="ident" id="5060655">ut</span><span class="op" id="5060657">,</span>&nbsp;<span class="ident" id="5060659">rt</span><span class="op" id="5060661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060665">if</span>&nbsp;<span class="ident" id="5060668">err</span>&nbsp;<span class="op" id="5060672">!=</span>&nbsp;<span class="ident" id="5060675">nil</span>&nbsp;<span class="op" id="5060679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060684">return</span>&nbsp;<span class="ident" id="5060691">nil</span><span class="op" id="5060694">,</span>&nbsp;<span class="ident" id="5060696">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060706">gt</span>&nbsp;<span class="op" id="5060709">:=</span>&nbsp;<span class="ident" id="5060712">userType</span><span class="op" id="5060720">.</span><span class="ident" id="5060721">id</span><span class="op" id="5060723">(</span><span class="op" id="5060724">)</span><span class="op" id="5060725">.</span><span class="ident" id="5060726">gobType</span><span class="op" id="5060733">(</span><span class="op" id="5060734">)</span><span class="op" id="5060735">.</span><span class="op" id="5060736">(</span><span class="op" id="5060737">*</span><span class="ident" id="5060738">gobEncoderType</span><span class="op" id="5060752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060756">switch</span>&nbsp;<span class="ident" id="5060763">ut</span><span class="op" id="5060765">.</span><span class="ident" id="5060766">externalEnc</span>&nbsp;<span class="op" id="5060778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060782">case</span>&nbsp;<span class="ident" id="5060787">xGob</span><span class="op" id="5060791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060796">info</span><span class="op" id="5060800">.</span><span class="ident" id="5060801">wire</span>&nbsp;<span class="op" id="5060806">=</span>&nbsp;<span class="op" id="5060808">&amp;</span><span class="ident" id="5060809">wireType</span><span class="op" id="5060817">{</span><span class="ident" id="5060818">GobEncoderT</span><span class="op" id="5060829">:</span>&nbsp;<span class="ident" id="5060831">gt</span><span class="op" id="5060833">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060837">case</span>&nbsp;<span class="ident" id="5060842">xBinary</span><span class="op" id="5060849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060854">info</span><span class="op" id="5060858">.</span><span class="ident" id="5060859">wire</span>&nbsp;<span class="op" id="5060864">=</span>&nbsp;<span class="op" id="5060866">&amp;</span><span class="ident" id="5060867">wireType</span><span class="op" id="5060875">{</span><span class="ident" id="5060876">BinaryMarshalerT</span><span class="op" id="5060892">:</span>&nbsp;<span class="ident" id="5060894">gt</span><span class="op" id="5060896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5060900">case</span>&nbsp;<span class="ident" id="5060905">xText</span><span class="op" id="5060910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060915">info</span><span class="op" id="5060919">.</span><span class="ident" id="5060920">wire</span>&nbsp;<span class="op" id="5060925">=</span>&nbsp;<span class="op" id="5060927">&amp;</span><span class="ident" id="5060928">wireType</span><span class="op" id="5060936">{</span><span class="ident" id="5060937">TextMarshalerT</span><span class="op" id="5060951">:</span>&nbsp;<span class="ident" id="5060953">gt</span><span class="op" id="5060955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060959">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060963">rt</span>&nbsp;<span class="op" id="5060966">=</span>&nbsp;<span class="ident" id="5060968">ut</span><span class="op" id="5060970">.</span><span class="ident" id="5060971">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5060977">}</span>&nbsp;<span class="keyword" id="5060979">else</span>&nbsp;<span class="op" id="5060984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5060988">t</span>&nbsp;<span class="op" id="5060990">:=</span>&nbsp;<span class="ident" id="5060993">info</span><span class="op" id="5060997">.</span><span class="ident" id="5060998">id</span><span class="op" id="5061000">.</span><span class="ident" id="5061001">gobType</span><span class="op" id="5061008">(</span><span class="op" id="5061009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061013">switch</span>&nbsp;<span class="ident" id="5061020">typ</span>&nbsp;<span class="op" id="5061024">:=</span>&nbsp;<span class="ident" id="5061027">rt</span><span class="op" id="5061029">;</span>&nbsp;<span class="ident" id="5061031">typ</span><span class="op" id="5061034">.</span><span class="ident" id="5061035">Kind</span><span class="op" id="5061039">(</span><span class="op" id="5061040">)</span>&nbsp;<span class="op" id="5061042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061046">case</span>&nbsp;<span class="ident" id="5061051">reflect</span><span class="op" id="5061058">.</span><span class="ident" id="5061059">Array</span><span class="op" id="5061064">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061069">info</span><span class="op" id="5061073">.</span><span class="ident" id="5061074">wire</span>&nbsp;<span class="op" id="5061079">=</span>&nbsp;<span class="op" id="5061081">&amp;</span><span class="ident" id="5061082">wireType</span><span class="op" id="5061090">{</span><span class="ident" id="5061091">ArrayT</span><span class="op" id="5061097">:</span>&nbsp;<span class="ident" id="5061099">t</span><span class="op" id="5061100">.</span><span class="op" id="5061101">(</span><span class="op" id="5061102">*</span><span class="ident" id="5061103">arrayType</span><span class="op" id="5061112">)</span><span class="op" id="5061113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061117">case</span>&nbsp;<span class="ident" id="5061122">reflect</span><span class="op" id="5061129">.</span><span class="ident" id="5061130">Map</span><span class="op" id="5061133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061138">info</span><span class="op" id="5061142">.</span><span class="ident" id="5061143">wire</span>&nbsp;<span class="op" id="5061148">=</span>&nbsp;<span class="op" id="5061150">&amp;</span><span class="ident" id="5061151">wireType</span><span class="op" id="5061159">{</span><span class="ident" id="5061160">MapT</span><span class="op" id="5061164">:</span>&nbsp;<span class="ident" id="5061166">t</span><span class="op" id="5061167">.</span><span class="op" id="5061168">(</span><span class="op" id="5061169">*</span><span class="ident" id="5061170">mapType</span><span class="op" id="5061177">)</span><span class="op" id="5061178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061182">case</span>&nbsp;<span class="ident" id="5061187">reflect</span><span class="op" id="5061194">.</span><span class="ident" id="5061195">Slice</span><span class="op" id="5061200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061205">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061266">if</span>&nbsp;<span class="ident" id="5061269">typ</span><span class="op" id="5061272">.</span><span class="ident" id="5061273">Elem</span><span class="op" id="5061277">(</span><span class="op" id="5061278">)</span><span class="op" id="5061279">.</span><span class="ident" id="5061280">Kind</span><span class="op" id="5061284">(</span><span class="op" id="5061285">)</span>&nbsp;<span class="op" id="5061287">!=</span>&nbsp;<span class="ident" id="5061290">reflect</span><span class="op" id="5061297">.</span><span class="ident" id="5061298">Uint8</span>&nbsp;<span class="op" id="5061304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061310">info</span><span class="op" id="5061314">.</span><span class="ident" id="5061315">wire</span>&nbsp;<span class="op" id="5061320">=</span>&nbsp;<span class="op" id="5061322">&amp;</span><span class="ident" id="5061323">wireType</span><span class="op" id="5061331">{</span><span class="ident" id="5061332">SliceT</span><span class="op" id="5061338">:</span>&nbsp;<span class="ident" id="5061340">t</span><span class="op" id="5061341">.</span><span class="op" id="5061342">(</span><span class="op" id="5061343">*</span><span class="ident" id="5061344">sliceType</span><span class="op" id="5061353">)</span><span class="op" id="5061354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5061359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061363">case</span>&nbsp;<span class="ident" id="5061368">reflect</span><span class="op" id="5061375">.</span><span class="ident" id="5061376">Struct</span><span class="op" id="5061382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061387">info</span><span class="op" id="5061391">.</span><span class="ident" id="5061392">wire</span>&nbsp;<span class="op" id="5061397">=</span>&nbsp;<span class="op" id="5061399">&amp;</span><span class="ident" id="5061400">wireType</span><span class="op" id="5061408">{</span><span class="ident" id="5061409">StructT</span><span class="op" id="5061416">:</span>&nbsp;<span class="ident" id="5061418">t</span><span class="op" id="5061419">.</span><span class="op" id="5061420">(</span><span class="op" id="5061421">*</span><span class="ident" id="5061422">structType</span><span class="op" id="5061432">)</span><span class="op" id="5061433">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5061437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5061440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5061444">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061497">newm</span>&nbsp;<span class="op" id="5061502">:=</span>&nbsp;<span class="builtinfunc" id="5061505">make</span><span class="op" id="5061509">(</span><span class="keyword" id="5061510">map</span><span class="op" id="5061513">[</span><span class="ident" id="5061514">reflect</span><span class="op" id="5061521">.</span><span class="ident" id="5061522">Type</span><span class="op" id="5061526">]</span><span class="op" id="5061527">*</span><span class="ident" id="5061528">typeInfo</span><span class="op" id="5061536">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061539">m</span><span class="op" id="5061540">,</span>&nbsp;<span class="ident" id="5061542">_</span>&nbsp;<span class="op" id="5061544">:=</span>&nbsp;<span class="ident" id="5061547">typeInfoMap</span><span class="op" id="5061558">.</span><span class="ident" id="5061559">Load</span><span class="op" id="5061563">(</span><span class="op" id="5061564">)</span><span class="op" id="5061565">.</span><span class="op" id="5061566">(</span><span class="keyword" id="5061567">map</span><span class="op" id="5061570">[</span><span class="ident" id="5061571">reflect</span><span class="op" id="5061578">.</span><span class="ident" id="5061579">Type</span><span class="op" id="5061583">]</span><span class="op" id="5061584">*</span><span class="ident" id="5061585">typeInfo</span><span class="op" id="5061593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061596">for</span>&nbsp;<span class="ident" id="5061600">k</span><span class="op" id="5061601">,</span>&nbsp;<span class="ident" id="5061603">v</span>&nbsp;<span class="op" id="5061605">:=</span>&nbsp;<span class="keyword" id="5061608">range</span>&nbsp;<span class="ident" id="5061614">m</span>&nbsp;<span class="op" id="5061616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061620">newm</span><span class="op" id="5061624">[</span><span class="ident" id="5061625">k</span><span class="op" id="5061626">]</span>&nbsp;<span class="op" id="5061628">=</span>&nbsp;<span class="ident" id="5061630">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5061633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061636">newm</span><span class="op" id="5061640">[</span><span class="ident" id="5061641">rt</span><span class="op" id="5061643">]</span>&nbsp;<span class="op" id="5061645">=</span>&nbsp;<span class="ident" id="5061647">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061653">typeInfoMap</span><span class="op" id="5061664">.</span><span class="ident" id="5061665">Store</span><span class="op" id="5061670">(</span><span class="ident" id="5061671">newm</span><span class="op" id="5061675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061678">return</span>&nbsp;<span class="ident" id="5061685">info</span><span class="op" id="5061689">,</span>&nbsp;<span class="ident" id="5061691">nil</span><br>
<span class="lineno"></span><span class="op" id="5061695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5061698">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5061756">func</span>&nbsp;<span class="ident" id="5061761">mustGetTypeInfo</span><span class="op" id="5061776">(</span><span class="ident" id="5061777">rt</span>&nbsp;<span class="ident" id="5061780">reflect</span><span class="op" id="5061787">.</span><span class="ident" id="5061788">Type</span><span class="op" id="5061792">)</span>&nbsp;<span class="op" id="5061794">*</span><span class="ident" id="5061795">typeInfo</span>&nbsp;<span class="op" id="5061804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5061807">t</span><span class="op" id="5061808">,</span>&nbsp;<span class="ident" id="5061810">err</span>&nbsp;<span class="op" id="5061814">:=</span>&nbsp;<span class="ident" id="5061817">getTypeInfo</span><span class="op" id="5061828">(</span><span class="ident" id="5061829">userType</span><span class="op" id="5061837">(</span><span class="ident" id="5061838">rt</span><span class="op" id="5061840">)</span><span class="op" id="5061841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061844">if</span>&nbsp;<span class="ident" id="5061847">err</span>&nbsp;<span class="op" id="5061851">!=</span>&nbsp;<span class="ident" id="5061854">nil</span>&nbsp;<span class="op" id="5061858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5061862">panic</span><span class="op" id="5061867">(</span><span class="string" id="5061868">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5061884">+</span>&nbsp;<span class="ident" id="5061886">err</span><span class="op" id="5061889">.</span><span class="ident" id="5061890">Error</span><span class="op" id="5061895">(</span><span class="op" id="5061896">)</span><span class="op" id="5061897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5061900">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5061903">return</span>&nbsp;<span class="ident" id="5061910">t</span><br>
<span class="lineno"></span><span class="op" id="5061912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5061915">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5061984">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5062056">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5062121">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5062186">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5062253">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5062308">//</span><br>
<span class="lineno">790</span><span class="comment" id="5062311">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5062376">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5062443">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5062513">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5062561">type</span>&nbsp;<span class="ident" id="5062566">GobEncoder</span>&nbsp;<span class="keyword" id="5062577">interface</span>&nbsp;<span class="op" id="5062587">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062590">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062658">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062725">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5062744">GobEncode</span><span class="op" id="5062753">(</span><span class="op" id="5062754">)</span>&nbsp;<span class="op" id="5062756">(</span><span class="op" id="5062757">[</span><span class="op" id="5062758">]</span><span class="builtintype" id="5062759">byte</span><span class="op" id="5062763">,</span>&nbsp;<span class="builtintype" id="5062765">error</span><span class="op" id="5062770">)</span><br>
<span class="lineno"></span><span class="op" id="5062772">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5062775">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5062844">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5062909">type</span>&nbsp;<span class="ident" id="5062914">GobDecoder</span>&nbsp;<span class="keyword" id="5062925">interface</span>&nbsp;<span class="op" id="5062935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5062938">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063002">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063070">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063124">GobDecode</span><span class="op" id="5063133">(</span><span class="op" id="5063134">[</span><span class="op" id="5063135">]</span><span class="builtintype" id="5063136">byte</span><span class="op" id="5063140">)</span>&nbsp;<span class="builtintype" id="5063142">error</span><br>
<span class="lineno"></span><span class="op" id="5063148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5063151">var</span>&nbsp;<span class="op" id="5063155">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063158">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5063177">sync</span><span class="op" id="5063181">.</span><span class="ident" id="5063182">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063191">nameToConcreteType</span>&nbsp;<span class="op" id="5063210">=</span>&nbsp;<span class="builtinfunc" id="5063212">make</span><span class="op" id="5063216">(</span><span class="keyword" id="5063217">map</span><span class="op" id="5063220">[</span><span class="builtintype" id="5063221">string</span><span class="op" id="5063227">]</span><span class="ident" id="5063228">reflect</span><span class="op" id="5063235">.</span><span class="ident" id="5063236">Type</span><span class="op" id="5063240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063243">concreteTypeToName</span>&nbsp;<span class="op" id="5063262">=</span>&nbsp;<span class="builtinfunc" id="5063264">make</span><span class="op" id="5063268">(</span><span class="keyword" id="5063269">map</span><span class="op" id="5063272">[</span><span class="ident" id="5063273">reflect</span><span class="op" id="5063280">.</span><span class="ident" id="5063281">Type</span><span class="op" id="5063285">]</span><span class="builtintype" id="5063286">string</span><span class="op" id="5063292">)</span><br>
<span class="lineno"></span><span class="op" id="5063294">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5063297">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5063373">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5063392">func</span>&nbsp;<span class="ident" id="5063397">RegisterName</span><span class="op" id="5063409">(</span><span class="ident" id="5063410">name</span>&nbsp;<span class="builtintype" id="5063415">string</span><span class="op" id="5063421">,</span>&nbsp;<span class="ident" id="5063423">value</span>&nbsp;<span class="keyword" id="5063429">interface</span><span class="op" id="5063438">{</span><span class="op" id="5063439">}</span><span class="op" id="5063440">)</span>&nbsp;<span class="op" id="5063442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5063445">if</span>&nbsp;<span class="ident" id="5063448">name</span>&nbsp;<span class="op" id="5063453">==</span>&nbsp;<span class="string" id="5063456">&#34;&#34;</span>&nbsp;<span class="op" id="5063459">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063463">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5063485">panic</span><span class="op" id="5063490">(</span><span class="string" id="5063491">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5063523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5063526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063529">registerLock</span><span class="op" id="5063541">.</span><span class="ident" id="5063542">Lock</span><span class="op" id="5063546">(</span><span class="op" id="5063547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5063550">defer</span>&nbsp;<span class="ident" id="5063556">registerLock</span><span class="op" id="5063568">.</span><span class="ident" id="5063569">Unlock</span><span class="op" id="5063575">(</span><span class="op" id="5063576">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5063579">ut</span>&nbsp;<span class="op" id="5063582">:=</span>&nbsp;<span class="ident" id="5063585">userType</span><span class="op" id="5063593">(</span><span class="ident" id="5063594">reflect</span><span class="op" id="5063601">.</span><span class="ident" id="5063602">TypeOf</span><span class="op" id="5063608">(</span><span class="ident" id="5063609">value</span><span class="op" id="5063614">)</span><span class="op" id="5063615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063618">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5063684">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5063720">if</span>&nbsp;<span class="ident" id="5063723">t</span><span class="op" id="5063724">,</span>&nbsp;<span class="ident" id="5063726">ok</span>&nbsp;<span class="op" id="5063729">:=</span>&nbsp;<span class="ident" id="5063732">nameToConcreteType</span><span class="op" id="5063750">[</span><span class="ident" id="5063751">name</span><span class="op" id="5063755">]</span><span class="op" id="5063756">;</span>&nbsp;<span class="ident" id="5063758">ok</span>&nbsp;<span class="op" id="5063761">&amp;&amp;</span>&nbsp;<span class="ident" id="5063764">t</span>&nbsp;<span class="op" id="5063766">!=</span>&nbsp;<span class="ident" id="5063769">ut</span><span class="op" id="5063771">.</span><span class="ident" id="5063772">user</span>&nbsp;<span class="op" id="5063777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5063781">panic</span><span class="op" id="5063786">(</span><span class="ident" id="5063787">fmt</span><span class="op" id="5063790">.</span><span class="ident" id="5063791">Sprintf</span><span class="op" id="5063798">(</span><span class="string" id="5063799">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5063850">,</span>&nbsp;<span class="ident" id="5063852">name</span><span class="op" id="5063856">,</span>&nbsp;<span class="ident" id="5063858">t</span><span class="op" id="5063859">,</span>&nbsp;<span class="ident" id="5063861">ut</span><span class="op" id="5063863">.</span><span class="ident" id="5063864">user</span><span class="op" id="5063868">)</span><span class="op" id="5063869">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5063872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5063875">if</span>&nbsp;<span class="ident" id="5063878">n</span><span class="op" id="5063879">,</span>&nbsp;<span class="ident" id="5063881">ok</span>&nbsp;<span class="op" id="5063884">:=</span>&nbsp;<span class="ident" id="5063887">concreteTypeToName</span><span class="op" id="5063905">[</span><span class="ident" id="5063906">ut</span><span class="op" id="5063908">.</span><span class="ident" id="5063909">base</span><span class="op" id="5063913">]</span><span class="op" id="5063914">;</span>&nbsp;<span class="ident" id="5063916">ok</span>&nbsp;<span class="op" id="5063919">&amp;&amp;</span>&nbsp;<span class="ident" id="5063922">n</span>&nbsp;<span class="op" id="5063924">!=</span>&nbsp;<span class="ident" id="5063927">name</span>&nbsp;<span class="op" id="5063932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5063936">panic</span><span class="op" id="5063941">(</span><span class="ident" id="5063942">fmt</span><span class="op" id="5063945">.</span><span class="ident" id="5063946">Sprintf</span><span class="op" id="5063953">(</span><span class="string" id="5063954">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5064005">,</span>&nbsp;<span class="ident" id="5064007">ut</span><span class="op" id="5064009">.</span><span class="ident" id="5064010">user</span><span class="op" id="5064014">,</span>&nbsp;<span class="ident" id="5064016">n</span><span class="op" id="5064017">,</span>&nbsp;<span class="ident" id="5064019">name</span><span class="op" id="5064023">)</span><span class="op" id="5064024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5064027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064030">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064083">nameToConcreteType</span><span class="op" id="5064101">[</span><span class="ident" id="5064102">name</span><span class="op" id="5064106">]</span>&nbsp;<span class="op" id="5064108">=</span>&nbsp;<span class="ident" id="5064110">reflect</span><span class="op" id="5064117">.</span><span class="ident" id="5064118">TypeOf</span><span class="op" id="5064124">(</span><span class="ident" id="5064125">value</span><span class="op" id="5064130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064133">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064211">concreteTypeToName</span><span class="op" id="5064229">[</span><span class="ident" id="5064230">ut</span><span class="op" id="5064232">.</span><span class="ident" id="5064233">base</span><span class="op" id="5064237">]</span>&nbsp;<span class="op" id="5064239">=</span>&nbsp;<span class="ident" id="5064241">name</span><br>
<span class="lineno"></span><span class="op" id="5064246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5064249">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5064324">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5064401">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5064472">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5064549">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5064626">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5064673">func</span>&nbsp;<span class="ident" id="5064678">Register</span><span class="op" id="5064686">(</span><span class="ident" id="5064687">value</span>&nbsp;<span class="keyword" id="5064693">interface</span><span class="op" id="5064702">{</span><span class="op" id="5064703">}</span><span class="op" id="5064704">)</span>&nbsp;<span class="op" id="5064706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064709">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064765">rt</span>&nbsp;<span class="op" id="5064768">:=</span>&nbsp;<span class="ident" id="5064771">reflect</span><span class="op" id="5064778">.</span><span class="ident" id="5064779">TypeOf</span><span class="op" id="5064785">(</span><span class="ident" id="5064786">value</span><span class="op" id="5064791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064794">name</span>&nbsp;<span class="op" id="5064799">:=</span>&nbsp;<span class="ident" id="5064802">rt</span><span class="op" id="5064804">.</span><span class="ident" id="5064805">String</span><span class="op" id="5064811">(</span><span class="op" id="5064812">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064816">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5064913">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5064967">star</span>&nbsp;<span class="op" id="5064972">:=</span>&nbsp;<span class="string" id="5064975">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5064979">if</span>&nbsp;<span class="ident" id="5064982">rt</span><span class="op" id="5064984">.</span><span class="ident" id="5064985">Name</span><span class="op" id="5064989">(</span><span class="op" id="5064990">)</span>&nbsp;<span class="op" id="5064992">==</span>&nbsp;<span class="string" id="5064995">&#34;&#34;</span>&nbsp;<span class="op" id="5064998">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5065002">if</span>&nbsp;<span class="ident" id="5065005">pt</span>&nbsp;<span class="op" id="5065008">:=</span>&nbsp;<span class="ident" id="5065011">rt</span><span class="op" id="5065013">;</span>&nbsp;<span class="ident" id="5065015">pt</span><span class="op" id="5065017">.</span><span class="ident" id="5065018">Kind</span><span class="op" id="5065022">(</span><span class="op" id="5065023">)</span>&nbsp;<span class="op" id="5065025">==</span>&nbsp;<span class="ident" id="5065028">reflect</span><span class="op" id="5065035">.</span><span class="ident" id="5065036">Ptr</span>&nbsp;<span class="op" id="5065040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065045">star</span>&nbsp;<span class="op" id="5065050">=</span>&nbsp;<span class="string" id="5065052">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065059">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065128">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065205">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065231">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065237">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065304">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065324">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065357">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065427">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065449">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065455">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065504">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065510">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065555">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065596">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5065602">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065686">rt</span>&nbsp;<span class="op" id="5065689">=</span>&nbsp;<span class="ident" id="5065691">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5065696">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5065699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5065702">if</span>&nbsp;<span class="ident" id="5065705">rt</span><span class="op" id="5065707">.</span><span class="ident" id="5065708">Name</span><span class="op" id="5065712">(</span><span class="op" id="5065713">)</span>&nbsp;<span class="op" id="5065715">!=</span>&nbsp;<span class="string" id="5065718">&#34;&#34;</span>&nbsp;<span class="op" id="5065721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5065725">if</span>&nbsp;<span class="ident" id="5065728">rt</span><span class="op" id="5065730">.</span><span class="ident" id="5065731">PkgPath</span><span class="op" id="5065738">(</span><span class="op" id="5065739">)</span>&nbsp;<span class="op" id="5065741">==</span>&nbsp;<span class="string" id="5065744">&#34;&#34;</span>&nbsp;<span class="op" id="5065747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065752">name</span>&nbsp;<span class="op" id="5065757">=</span>&nbsp;<span class="ident" id="5065759">star</span>&nbsp;<span class="op" id="5065764">+</span>&nbsp;<span class="ident" id="5065766">rt</span><span class="op" id="5065768">.</span><span class="ident" id="5065769">Name</span><span class="op" id="5065773">(</span><span class="op" id="5065774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5065778">}</span>&nbsp;<span class="keyword" id="5065780">else</span>&nbsp;<span class="op" id="5065785">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065790">name</span>&nbsp;<span class="op" id="5065795">=</span>&nbsp;<span class="ident" id="5065797">star</span>&nbsp;<span class="op" id="5065802">+</span>&nbsp;<span class="ident" id="5065804">rt</span><span class="op" id="5065806">.</span><span class="ident" id="5065807">PkgPath</span><span class="op" id="5065814">(</span><span class="op" id="5065815">)</span>&nbsp;<span class="op" id="5065817">+</span>&nbsp;<span class="string" id="5065819">&#34;.&#34;</span>&nbsp;<span class="op" id="5065823">+</span>&nbsp;<span class="ident" id="5065825">rt</span><span class="op" id="5065827">.</span><span class="ident" id="5065828">Name</span><span class="op" id="5065832">(</span><span class="op" id="5065833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5065837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5065840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065844">RegisterName</span><span class="op" id="5065856">(</span><span class="ident" id="5065857">name</span><span class="op" id="5065861">,</span>&nbsp;<span class="ident" id="5065863">value</span><span class="op" id="5065868">)</span><br>
<span class="lineno">885</span><span class="op" id="5065870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5065873">func</span>&nbsp;<span class="ident" id="5065878">registerBasics</span><span class="op" id="5065892">(</span><span class="op" id="5065893">)</span>&nbsp;<span class="op" id="5065895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065898">Register</span><span class="op" id="5065906">(</span><span class="builtintype" id="5065907">int</span><span class="op" id="5065910">(</span><span class="num" id="5065911">0</span><span class="op" id="5065912">)</span><span class="op" id="5065913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065916">Register</span><span class="op" id="5065924">(</span><span class="builtintype" id="5065925">int8</span><span class="op" id="5065929">(</span><span class="num" id="5065930">0</span><span class="op" id="5065931">)</span><span class="op" id="5065932">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065935">Register</span><span class="op" id="5065943">(</span><span class="builtintype" id="5065944">int16</span><span class="op" id="5065949">(</span><span class="num" id="5065950">0</span><span class="op" id="5065951">)</span><span class="op" id="5065952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065955">Register</span><span class="op" id="5065963">(</span><span class="builtintype" id="5065964">int32</span><span class="op" id="5065969">(</span><span class="num" id="5065970">0</span><span class="op" id="5065971">)</span><span class="op" id="5065972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065975">Register</span><span class="op" id="5065983">(</span><span class="ident" id="5065984">int64</span><span class="op" id="5065989">(</span><span class="num" id="5065990">0</span><span class="op" id="5065991">)</span><span class="op" id="5065992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5065995">Register</span><span class="op" id="5066003">(</span><span class="builtintype" id="5066004">uint</span><span class="op" id="5066008">(</span><span class="num" id="5066009">0</span><span class="op" id="5066010">)</span><span class="op" id="5066011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066014">Register</span><span class="op" id="5066022">(</span><span class="builtintype" id="5066023">uint8</span><span class="op" id="5066028">(</span><span class="num" id="5066029">0</span><span class="op" id="5066030">)</span><span class="op" id="5066031">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066034">Register</span><span class="op" id="5066042">(</span><span class="builtintype" id="5066043">uint16</span><span class="op" id="5066049">(</span><span class="num" id="5066050">0</span><span class="op" id="5066051">)</span><span class="op" id="5066052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066055">Register</span><span class="op" id="5066063">(</span><span class="builtintype" id="5066064">uint32</span><span class="op" id="5066070">(</span><span class="num" id="5066071">0</span><span class="op" id="5066072">)</span><span class="op" id="5066073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066076">Register</span><span class="op" id="5066084">(</span><span class="ident" id="5066085">uint64</span><span class="op" id="5066091">(</span><span class="num" id="5066092">0</span><span class="op" id="5066093">)</span><span class="op" id="5066094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066097">Register</span><span class="op" id="5066105">(</span><span class="builtintype" id="5066106">float32</span><span class="op" id="5066113">(</span><span class="num" id="5066114">0</span><span class="op" id="5066115">)</span><span class="op" id="5066116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066119">Register</span><span class="op" id="5066127">(</span><span class="builtintype" id="5066128">float64</span><span class="op" id="5066135">(</span><span class="num" id="5066136">0</span><span class="op" id="5066137">)</span><span class="op" id="5066138">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066141">Register</span><span class="op" id="5066149">(</span><span class="builtintype" id="5066150">complex64</span><span class="op" id="5066159">(</span><span class="num" id="5066160">0i</span><span class="op" id="5066162">)</span><span class="op" id="5066163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066166">Register</span><span class="op" id="5066174">(</span><span class="builtintype" id="5066175">complex128</span><span class="op" id="5066185">(</span><span class="num" id="5066186">0i</span><span class="op" id="5066188">)</span><span class="op" id="5066189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066192">Register</span><span class="op" id="5066200">(</span><span class="builtintype" id="5066201">uintptr</span><span class="op" id="5066208">(</span><span class="num" id="5066209">0</span><span class="op" id="5066210">)</span><span class="op" id="5066211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066214">Register</span><span class="op" id="5066222">(</span><span class="builtintype" id="5066223">false</span><span class="op" id="5066228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066231">Register</span><span class="op" id="5066239">(</span><span class="string" id="5066240">&#34;&#34;</span><span class="op" id="5066242">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066245">Register</span><span class="op" id="5066253">(</span><span class="op" id="5066254">[</span><span class="op" id="5066255">]</span><span class="builtintype" id="5066256">byte</span><span class="op" id="5066260">(</span><span class="ident" id="5066261">nil</span><span class="op" id="5066264">)</span><span class="op" id="5066265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066268">Register</span><span class="op" id="5066276">(</span><span class="op" id="5066277">[</span><span class="op" id="5066278">]</span><span class="builtintype" id="5066279">int</span><span class="op" id="5066282">(</span><span class="ident" id="5066283">nil</span><span class="op" id="5066286">)</span><span class="op" id="5066287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066290">Register</span><span class="op" id="5066298">(</span><span class="op" id="5066299">[</span><span class="op" id="5066300">]</span><span class="builtintype" id="5066301">int8</span><span class="op" id="5066305">(</span><span class="ident" id="5066306">nil</span><span class="op" id="5066309">)</span><span class="op" id="5066310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066313">Register</span><span class="op" id="5066321">(</span><span class="op" id="5066322">[</span><span class="op" id="5066323">]</span><span class="builtintype" id="5066324">int16</span><span class="op" id="5066329">(</span><span class="ident" id="5066330">nil</span><span class="op" id="5066333">)</span><span class="op" id="5066334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066337">Register</span><span class="op" id="5066345">(</span><span class="op" id="5066346">[</span><span class="op" id="5066347">]</span><span class="builtintype" id="5066348">int32</span><span class="op" id="5066353">(</span><span class="ident" id="5066354">nil</span><span class="op" id="5066357">)</span><span class="op" id="5066358">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066361">Register</span><span class="op" id="5066369">(</span><span class="op" id="5066370">[</span><span class="op" id="5066371">]</span><span class="ident" id="5066372">int64</span><span class="op" id="5066377">(</span><span class="ident" id="5066378">nil</span><span class="op" id="5066381">)</span><span class="op" id="5066382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066385">Register</span><span class="op" id="5066393">(</span><span class="op" id="5066394">[</span><span class="op" id="5066395">]</span><span class="builtintype" id="5066396">uint</span><span class="op" id="5066400">(</span><span class="ident" id="5066401">nil</span><span class="op" id="5066404">)</span><span class="op" id="5066405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066408">Register</span><span class="op" id="5066416">(</span><span class="op" id="5066417">[</span><span class="op" id="5066418">]</span><span class="builtintype" id="5066419">uint8</span><span class="op" id="5066424">(</span><span class="ident" id="5066425">nil</span><span class="op" id="5066428">)</span><span class="op" id="5066429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066432">Register</span><span class="op" id="5066440">(</span><span class="op" id="5066441">[</span><span class="op" id="5066442">]</span><span class="builtintype" id="5066443">uint16</span><span class="op" id="5066449">(</span><span class="ident" id="5066450">nil</span><span class="op" id="5066453">)</span><span class="op" id="5066454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066457">Register</span><span class="op" id="5066465">(</span><span class="op" id="5066466">[</span><span class="op" id="5066467">]</span><span class="builtintype" id="5066468">uint32</span><span class="op" id="5066474">(</span><span class="ident" id="5066475">nil</span><span class="op" id="5066478">)</span><span class="op" id="5066479">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066482">Register</span><span class="op" id="5066490">(</span><span class="op" id="5066491">[</span><span class="op" id="5066492">]</span><span class="ident" id="5066493">uint64</span><span class="op" id="5066499">(</span><span class="ident" id="5066500">nil</span><span class="op" id="5066503">)</span><span class="op" id="5066504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066507">Register</span><span class="op" id="5066515">(</span><span class="op" id="5066516">[</span><span class="op" id="5066517">]</span><span class="builtintype" id="5066518">float32</span><span class="op" id="5066525">(</span><span class="ident" id="5066526">nil</span><span class="op" id="5066529">)</span><span class="op" id="5066530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066533">Register</span><span class="op" id="5066541">(</span><span class="op" id="5066542">[</span><span class="op" id="5066543">]</span><span class="builtintype" id="5066544">float64</span><span class="op" id="5066551">(</span><span class="ident" id="5066552">nil</span><span class="op" id="5066555">)</span><span class="op" id="5066556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066559">Register</span><span class="op" id="5066567">(</span><span class="op" id="5066568">[</span><span class="op" id="5066569">]</span><span class="builtintype" id="5066570">complex64</span><span class="op" id="5066579">(</span><span class="ident" id="5066580">nil</span><span class="op" id="5066583">)</span><span class="op" id="5066584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066587">Register</span><span class="op" id="5066595">(</span><span class="op" id="5066596">[</span><span class="op" id="5066597">]</span><span class="builtintype" id="5066598">complex128</span><span class="op" id="5066608">(</span><span class="ident" id="5066609">nil</span><span class="op" id="5066612">)</span><span class="op" id="5066613">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066616">Register</span><span class="op" id="5066624">(</span><span class="op" id="5066625">[</span><span class="op" id="5066626">]</span><span class="builtintype" id="5066627">uintptr</span><span class="op" id="5066634">(</span><span class="ident" id="5066635">nil</span><span class="op" id="5066638">)</span><span class="op" id="5066639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066642">Register</span><span class="op" id="5066650">(</span><span class="op" id="5066651">[</span><span class="op" id="5066652">]</span><span class="builtintype" id="5066653">bool</span><span class="op" id="5066657">(</span><span class="ident" id="5066658">nil</span><span class="op" id="5066661">)</span><span class="op" id="5066662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5066665">Register</span><span class="op" id="5066673">(</span><span class="op" id="5066674">[</span><span class="op" id="5066675">]</span><span class="builtintype" id="5066676">string</span><span class="op" id="5066682">(</span><span class="ident" id="5066683">nil</span><span class="op" id="5066686">)</span><span class="op" id="5066687">)</span><br>
<span class="lineno"></span><span class="op" id="5066689">}</span>
</div>
</body>
</html>
