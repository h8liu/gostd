<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3436748">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3436804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3436858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3436909">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3436987">package</span>&nbsp;<span class="ident" id="3436995">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3437000">import</span>&nbsp;<span class="op" id="3437007">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3437010">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3437016">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3437027">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3437034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3437037">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3437102">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3437160">type</span>&nbsp;<span class="ident" id="3437165">sockaddr</span>&nbsp;<span class="keyword" id="3437174">interface</span>&nbsp;<span class="op" id="3437184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437187">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437194">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437204">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437261">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437277">family</span><span class="op" id="3437283">(</span><span class="op" id="3437284">)</span>&nbsp;<span class="builtintype" id="3437286">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437292">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437349">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437362">isWildcard</span><span class="op" id="3437372">(</span><span class="op" id="3437373">)</span>&nbsp;<span class="builtintype" id="3437375">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437382">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437440">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437491">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437553">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437562">sockaddr</span><span class="op" id="3437570">(</span><span class="ident" id="3437571">family</span>&nbsp;<span class="builtintype" id="3437578">int</span><span class="op" id="3437581">)</span>&nbsp;<span class="op" id="3437583">(</span><span class="ident" id="3437584">syscall</span><span class="op" id="3437591">.</span><span class="ident" id="3437592">Sockaddr</span><span class="op" id="3437600">,</span>&nbsp;<span class="builtintype" id="3437602">error</span><span class="op" id="3437607">)</span><br>
<span class="lineno">35</span><span class="op" id="3437609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3437612">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3437674">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3437720">func</span>&nbsp;<span class="ident" id="3437725">socket</span><span class="op" id="3437731">(</span><span class="ident" id="3437732">net</span>&nbsp;<span class="builtintype" id="3437736">string</span><span class="op" id="3437742">,</span>&nbsp;<span class="ident" id="3437744">family</span><span class="op" id="3437750">,</span>&nbsp;<span class="ident" id="3437752">sotype</span><span class="op" id="3437758">,</span>&nbsp;<span class="ident" id="3437760">proto</span>&nbsp;<span class="builtintype" id="3437766">int</span><span class="op" id="3437769">,</span>&nbsp;<span class="ident" id="3437771">ipv6only</span>&nbsp;<span class="builtintype" id="3437780">bool</span><span class="op" id="3437784">,</span>&nbsp;<span class="ident" id="3437786">laddr</span><span class="op" id="3437791">,</span>&nbsp;<span class="ident" id="3437793">raddr</span>&nbsp;<span class="ident" id="3437799">sockaddr</span><span class="op" id="3437807">,</span>&nbsp;<span class="ident" id="3437809">deadline</span>&nbsp;<span class="ident" id="3437818">time</span><span class="op" id="3437822">.</span><span class="ident" id="3437823">Time</span><span class="op" id="3437827">)</span>&nbsp;<span class="op" id="3437829">(</span><span class="ident" id="3437830">fd</span>&nbsp;<span class="op" id="3437833">*</span><span class="ident" id="3437834">netFD</span><span class="op" id="3437839">,</span>&nbsp;<span class="ident" id="3437841">err</span>&nbsp;<span class="builtintype" id="3437845">error</span><span class="op" id="3437850">)</span>&nbsp;<span class="op" id="3437852">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437855">s</span><span class="op" id="3437856">,</span>&nbsp;<span class="ident" id="3437858">err</span>&nbsp;<span class="op" id="3437862">:=</span>&nbsp;<span class="ident" id="3437865">sysSocket</span><span class="op" id="3437874">(</span><span class="ident" id="3437875">family</span><span class="op" id="3437881">,</span>&nbsp;<span class="ident" id="3437883">sotype</span><span class="op" id="3437889">,</span>&nbsp;<span class="ident" id="3437891">proto</span><span class="op" id="3437896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437899">if</span>&nbsp;<span class="ident" id="3437902">err</span>&nbsp;<span class="op" id="3437906">!=</span>&nbsp;<span class="ident" id="3437909">nil</span>&nbsp;<span class="op" id="3437913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437917">return</span>&nbsp;<span class="ident" id="3437924">nil</span><span class="op" id="3437927">,</span>&nbsp;<span class="ident" id="3437929">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3437937">if</span>&nbsp;<span class="ident" id="3437940">err</span>&nbsp;<span class="op" id="3437944">=</span>&nbsp;<span class="ident" id="3437946">setDefaultSockopts</span><span class="op" id="3437964">(</span><span class="ident" id="3437965">s</span><span class="op" id="3437966">,</span>&nbsp;<span class="ident" id="3437968">family</span><span class="op" id="3437974">,</span>&nbsp;<span class="ident" id="3437976">sotype</span><span class="op" id="3437982">,</span>&nbsp;<span class="ident" id="3437984">ipv6only</span><span class="op" id="3437992">)</span><span class="op" id="3437993">;</span>&nbsp;<span class="ident" id="3437995">err</span>&nbsp;<span class="op" id="3437999">!=</span>&nbsp;<span class="ident" id="3438002">nil</span>&nbsp;<span class="op" id="3438006">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438010">closesocket</span><span class="op" id="3438021">(</span><span class="ident" id="3438022">s</span><span class="op" id="3438023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438027">return</span>&nbsp;<span class="ident" id="3438034">nil</span><span class="op" id="3438037">,</span>&nbsp;<span class="ident" id="3438039">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438047">if</span>&nbsp;<span class="ident" id="3438050">fd</span><span class="op" id="3438052">,</span>&nbsp;<span class="ident" id="3438054">err</span>&nbsp;<span class="op" id="3438058">=</span>&nbsp;<span class="ident" id="3438060">newFD</span><span class="op" id="3438065">(</span><span class="ident" id="3438066">s</span><span class="op" id="3438067">,</span>&nbsp;<span class="ident" id="3438069">family</span><span class="op" id="3438075">,</span>&nbsp;<span class="ident" id="3438077">sotype</span><span class="op" id="3438083">,</span>&nbsp;<span class="ident" id="3438085">net</span><span class="op" id="3438088">)</span><span class="op" id="3438089">;</span>&nbsp;<span class="ident" id="3438091">err</span>&nbsp;<span class="op" id="3438095">!=</span>&nbsp;<span class="ident" id="3438098">nil</span>&nbsp;<span class="op" id="3438102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438106">closesocket</span><span class="op" id="3438117">(</span><span class="ident" id="3438118">s</span><span class="op" id="3438119">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438123">return</span>&nbsp;<span class="ident" id="3438130">nil</span><span class="op" id="3438133">,</span>&nbsp;<span class="ident" id="3438135">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438144">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438202">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438230">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438234">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438287">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438333">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438337">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438398">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438454">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438458">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438516">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438575">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438588">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438592">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438655">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438712">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438716">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438778">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438839">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438903">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438966">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439001">if</span>&nbsp;<span class="ident" id="3439004">laddr</span>&nbsp;<span class="op" id="3439010">!=</span>&nbsp;<span class="ident" id="3439013">nil</span>&nbsp;<span class="op" id="3439017">&amp;&amp;</span>&nbsp;<span class="ident" id="3439020">raddr</span>&nbsp;<span class="op" id="3439026">==</span>&nbsp;<span class="ident" id="3439029">nil</span>&nbsp;<span class="op" id="3439033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439037">switch</span>&nbsp;<span class="ident" id="3439044">sotype</span>&nbsp;<span class="op" id="3439051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439055">case</span>&nbsp;<span class="ident" id="3439060">syscall</span><span class="op" id="3439067">.</span><span class="ident" id="3439068">SOCK_STREAM</span><span class="op" id="3439079">,</span>&nbsp;<span class="ident" id="3439081">syscall</span><span class="op" id="3439088">.</span><span class="ident" id="3439089">SOCK_SEQPACKET</span><span class="op" id="3439103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439108">if</span>&nbsp;<span class="ident" id="3439111">err</span>&nbsp;<span class="op" id="3439115">:=</span>&nbsp;<span class="ident" id="3439118">fd</span><span class="op" id="3439120">.</span><span class="ident" id="3439121">listenStream</span><span class="op" id="3439133">(</span><span class="ident" id="3439134">laddr</span><span class="op" id="3439139">,</span>&nbsp;<span class="ident" id="3439141">listenerBacklog</span><span class="op" id="3439156">)</span><span class="op" id="3439157">;</span>&nbsp;<span class="ident" id="3439159">err</span>&nbsp;<span class="op" id="3439163">!=</span>&nbsp;<span class="ident" id="3439166">nil</span>&nbsp;<span class="op" id="3439170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439176">fd</span><span class="op" id="3439178">.</span><span class="ident" id="3439179">Close</span><span class="op" id="3439184">(</span><span class="op" id="3439185">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439191">return</span>&nbsp;<span class="ident" id="3439198">nil</span><span class="op" id="3439201">,</span>&nbsp;<span class="ident" id="3439203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439215">return</span>&nbsp;<span class="ident" id="3439222">fd</span><span class="op" id="3439224">,</span>&nbsp;<span class="ident" id="3439226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439232">case</span>&nbsp;<span class="ident" id="3439237">syscall</span><span class="op" id="3439244">.</span><span class="ident" id="3439245">SOCK_DGRAM</span><span class="op" id="3439255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439260">if</span>&nbsp;<span class="ident" id="3439263">err</span>&nbsp;<span class="op" id="3439267">:=</span>&nbsp;<span class="ident" id="3439270">fd</span><span class="op" id="3439272">.</span><span class="ident" id="3439273">listenDatagram</span><span class="op" id="3439287">(</span><span class="ident" id="3439288">laddr</span><span class="op" id="3439293">)</span><span class="op" id="3439294">;</span>&nbsp;<span class="ident" id="3439296">err</span>&nbsp;<span class="op" id="3439300">!=</span>&nbsp;<span class="ident" id="3439303">nil</span>&nbsp;<span class="op" id="3439307">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439313">fd</span><span class="op" id="3439315">.</span><span class="ident" id="3439316">Close</span><span class="op" id="3439321">(</span><span class="op" id="3439322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439328">return</span>&nbsp;<span class="ident" id="3439335">nil</span><span class="op" id="3439338">,</span>&nbsp;<span class="ident" id="3439340">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439352">return</span>&nbsp;<span class="ident" id="3439359">fd</span><span class="op" id="3439361">,</span>&nbsp;<span class="ident" id="3439363">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439369">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439375">if</span>&nbsp;<span class="ident" id="3439378">err</span>&nbsp;<span class="op" id="3439382">:=</span>&nbsp;<span class="ident" id="3439385">fd</span><span class="op" id="3439387">.</span><span class="ident" id="3439388">dial</span><span class="op" id="3439392">(</span><span class="ident" id="3439393">laddr</span><span class="op" id="3439398">,</span>&nbsp;<span class="ident" id="3439400">raddr</span><span class="op" id="3439405">,</span>&nbsp;<span class="ident" id="3439407">deadline</span><span class="op" id="3439415">)</span><span class="op" id="3439416">;</span>&nbsp;<span class="ident" id="3439418">err</span>&nbsp;<span class="op" id="3439422">!=</span>&nbsp;<span class="ident" id="3439425">nil</span>&nbsp;<span class="op" id="3439429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439433">fd</span><span class="op" id="3439435">.</span><span class="ident" id="3439436">Close</span><span class="op" id="3439441">(</span><span class="op" id="3439442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439446">return</span>&nbsp;<span class="ident" id="3439453">nil</span><span class="op" id="3439456">,</span>&nbsp;<span class="ident" id="3439458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439463">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439466">return</span>&nbsp;<span class="ident" id="3439473">fd</span><span class="op" id="3439475">,</span>&nbsp;<span class="ident" id="3439477">nil</span><br>
<span class="lineno"></span><span class="op" id="3439481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3439484">func</span>&nbsp;<span class="op" id="3439489">(</span><span class="ident" id="3439490">fd</span>&nbsp;<span class="op" id="3439493">*</span><span class="ident" id="3439494">netFD</span><span class="op" id="3439499">)</span>&nbsp;<span class="ident" id="3439501">addrFunc</span><span class="op" id="3439509">(</span><span class="op" id="3439510">)</span>&nbsp;<span class="keyword" id="3439512">func</span><span class="op" id="3439516">(</span><span class="ident" id="3439517">syscall</span><span class="op" id="3439524">.</span><span class="ident" id="3439525">Sockaddr</span><span class="op" id="3439533">)</span>&nbsp;<span class="ident" id="3439535">Addr</span>&nbsp;<span class="op" id="3439540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439543">switch</span>&nbsp;<span class="ident" id="3439550">fd</span><span class="op" id="3439552">.</span><span class="ident" id="3439553">family</span>&nbsp;<span class="op" id="3439560">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439563">case</span>&nbsp;<span class="ident" id="3439568">syscall</span><span class="op" id="3439575">.</span><span class="ident" id="3439576">AF_INET</span><span class="op" id="3439583">,</span>&nbsp;<span class="ident" id="3439585">syscall</span><span class="op" id="3439592">.</span><span class="ident" id="3439593">AF_INET6</span><span class="op" id="3439601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439605">switch</span>&nbsp;<span class="ident" id="3439612">fd</span><span class="op" id="3439614">.</span><span class="ident" id="3439615">sotype</span>&nbsp;<span class="op" id="3439622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439626">case</span>&nbsp;<span class="ident" id="3439631">syscall</span><span class="op" id="3439638">.</span><span class="ident" id="3439639">SOCK_STREAM</span><span class="op" id="3439650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439655">return</span>&nbsp;<span class="ident" id="3439662">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439678">case</span>&nbsp;<span class="ident" id="3439683">syscall</span><span class="op" id="3439690">.</span><span class="ident" id="3439691">SOCK_DGRAM</span><span class="op" id="3439701">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439706">return</span>&nbsp;<span class="ident" id="3439713">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439729">case</span>&nbsp;<span class="ident" id="3439734">syscall</span><span class="op" id="3439741">.</span><span class="ident" id="3439742">SOCK_RAW</span><span class="op" id="3439750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439755">return</span>&nbsp;<span class="ident" id="3439762">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439780">case</span>&nbsp;<span class="ident" id="3439785">syscall</span><span class="op" id="3439792">.</span><span class="ident" id="3439793">AF_UNIX</span><span class="op" id="3439800">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439804">switch</span>&nbsp;<span class="ident" id="3439811">fd</span><span class="op" id="3439813">.</span><span class="ident" id="3439814">sotype</span>&nbsp;<span class="op" id="3439821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439825">case</span>&nbsp;<span class="ident" id="3439830">syscall</span><span class="op" id="3439837">.</span><span class="ident" id="3439838">SOCK_STREAM</span><span class="op" id="3439849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439854">return</span>&nbsp;<span class="ident" id="3439861">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439878">case</span>&nbsp;<span class="ident" id="3439883">syscall</span><span class="op" id="3439890">.</span><span class="ident" id="3439891">SOCK_DGRAM</span><span class="op" id="3439901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439906">return</span>&nbsp;<span class="ident" id="3439913">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439934">case</span>&nbsp;<span class="ident" id="3439939">syscall</span><span class="op" id="3439946">.</span><span class="ident" id="3439947">SOCK_SEQPACKET</span><span class="op" id="3439961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439966">return</span>&nbsp;<span class="ident" id="3439973">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440002">return</span>&nbsp;<span class="keyword" id="3440009">func</span><span class="op" id="3440013">(</span><span class="ident" id="3440014">syscall</span><span class="op" id="3440021">.</span><span class="ident" id="3440022">Sockaddr</span><span class="op" id="3440030">)</span>&nbsp;<span class="ident" id="3440032">Addr</span>&nbsp;<span class="op" id="3440037">{</span>&nbsp;<span class="keyword" id="3440039">return</span>&nbsp;<span class="ident" id="3440046">nil</span>&nbsp;<span class="op" id="3440050">}</span><br>
<span class="lineno">120</span><span class="op" id="3440052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3440055">func</span>&nbsp;<span class="op" id="3440060">(</span><span class="ident" id="3440061">fd</span>&nbsp;<span class="op" id="3440064">*</span><span class="ident" id="3440065">netFD</span><span class="op" id="3440070">)</span>&nbsp;<span class="ident" id="3440072">dial</span><span class="op" id="3440076">(</span><span class="ident" id="3440077">laddr</span><span class="op" id="3440082">,</span>&nbsp;<span class="ident" id="3440084">raddr</span>&nbsp;<span class="ident" id="3440090">sockaddr</span><span class="op" id="3440098">,</span>&nbsp;<span class="ident" id="3440100">deadline</span>&nbsp;<span class="ident" id="3440109">time</span><span class="op" id="3440113">.</span><span class="ident" id="3440114">Time</span><span class="op" id="3440118">)</span>&nbsp;<span class="builtintype" id="3440120">error</span>&nbsp;<span class="op" id="3440126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440129">var</span>&nbsp;<span class="ident" id="3440133">err</span>&nbsp;<span class="builtintype" id="3440137">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440144">var</span>&nbsp;<span class="ident" id="3440148">lsa</span>&nbsp;<span class="ident" id="3440152">syscall</span><span class="op" id="3440159">.</span><span class="ident" id="3440160">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440170">if</span>&nbsp;<span class="ident" id="3440173">laddr</span>&nbsp;<span class="op" id="3440179">!=</span>&nbsp;<span class="ident" id="3440182">nil</span>&nbsp;<span class="op" id="3440186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440190">if</span>&nbsp;<span class="ident" id="3440193">lsa</span><span class="op" id="3440196">,</span>&nbsp;<span class="ident" id="3440198">err</span>&nbsp;<span class="op" id="3440202">=</span>&nbsp;<span class="ident" id="3440204">laddr</span><span class="op" id="3440209">.</span><span class="ident" id="3440210">sockaddr</span><span class="op" id="3440218">(</span><span class="ident" id="3440219">fd</span><span class="op" id="3440221">.</span><span class="ident" id="3440222">family</span><span class="op" id="3440228">)</span><span class="op" id="3440229">;</span>&nbsp;<span class="ident" id="3440231">err</span>&nbsp;<span class="op" id="3440235">!=</span>&nbsp;<span class="ident" id="3440238">nil</span>&nbsp;<span class="op" id="3440242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440247">return</span>&nbsp;<span class="ident" id="3440254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440260">}</span>&nbsp;<span class="keyword" id="3440262">else</span>&nbsp;<span class="keyword" id="3440267">if</span>&nbsp;<span class="ident" id="3440270">lsa</span>&nbsp;<span class="op" id="3440274">!=</span>&nbsp;<span class="ident" id="3440277">nil</span>&nbsp;<span class="op" id="3440281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440286">if</span>&nbsp;<span class="ident" id="3440289">err</span>&nbsp;<span class="op" id="3440293">:=</span>&nbsp;<span class="ident" id="3440296">syscall</span><span class="op" id="3440303">.</span><span class="ident" id="3440304">Bind</span><span class="op" id="3440308">(</span><span class="ident" id="3440309">fd</span><span class="op" id="3440311">.</span><span class="ident" id="3440312">sysfd</span><span class="op" id="3440317">,</span>&nbsp;<span class="ident" id="3440319">lsa</span><span class="op" id="3440322">)</span><span class="op" id="3440323">;</span>&nbsp;<span class="ident" id="3440325">err</span>&nbsp;<span class="op" id="3440329">!=</span>&nbsp;<span class="ident" id="3440332">nil</span>&nbsp;<span class="op" id="3440336">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440342">return</span>&nbsp;<span class="ident" id="3440349">os</span><span class="op" id="3440351">.</span><span class="ident" id="3440352">NewSyscallError</span><span class="op" id="3440367">(</span><span class="string" id="3440368">&#34;bind&#34;</span><span class="op" id="3440374">,</span>&nbsp;<span class="ident" id="3440376">err</span><span class="op" id="3440379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440394">var</span>&nbsp;<span class="ident" id="3440398">rsa</span>&nbsp;<span class="ident" id="3440402">syscall</span><span class="op" id="3440409">.</span><span class="ident" id="3440410">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440420">if</span>&nbsp;<span class="ident" id="3440423">raddr</span>&nbsp;<span class="op" id="3440429">!=</span>&nbsp;<span class="ident" id="3440432">nil</span>&nbsp;<span class="op" id="3440436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440440">if</span>&nbsp;<span class="ident" id="3440443">rsa</span><span class="op" id="3440446">,</span>&nbsp;<span class="ident" id="3440448">err</span>&nbsp;<span class="op" id="3440452">=</span>&nbsp;<span class="ident" id="3440454">raddr</span><span class="op" id="3440459">.</span><span class="ident" id="3440460">sockaddr</span><span class="op" id="3440468">(</span><span class="ident" id="3440469">fd</span><span class="op" id="3440471">.</span><span class="ident" id="3440472">family</span><span class="op" id="3440478">)</span><span class="op" id="3440479">;</span>&nbsp;<span class="ident" id="3440481">err</span>&nbsp;<span class="op" id="3440485">!=</span>&nbsp;<span class="ident" id="3440488">nil</span>&nbsp;<span class="op" id="3440492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440497">return</span>&nbsp;<span class="ident" id="3440504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440514">if</span>&nbsp;<span class="ident" id="3440517">err</span>&nbsp;<span class="op" id="3440521">:=</span>&nbsp;<span class="ident" id="3440524">fd</span><span class="op" id="3440526">.</span><span class="ident" id="3440527">connect</span><span class="op" id="3440534">(</span><span class="ident" id="3440535">lsa</span><span class="op" id="3440538">,</span>&nbsp;<span class="ident" id="3440540">rsa</span><span class="op" id="3440543">,</span>&nbsp;<span class="ident" id="3440545">deadline</span><span class="op" id="3440553">)</span><span class="op" id="3440554">;</span>&nbsp;<span class="ident" id="3440556">err</span>&nbsp;<span class="op" id="3440560">!=</span>&nbsp;<span class="ident" id="3440563">nil</span>&nbsp;<span class="op" id="3440567">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440572">return</span>&nbsp;<span class="ident" id="3440579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440589">fd</span><span class="op" id="3440591">.</span><span class="ident" id="3440592">isConnected</span>&nbsp;<span class="op" id="3440604">=</span>&nbsp;<span class="ident" id="3440606">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440612">}</span>&nbsp;<span class="keyword" id="3440614">else</span>&nbsp;<span class="op" id="3440619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440623">if</span>&nbsp;<span class="ident" id="3440626">err</span>&nbsp;<span class="op" id="3440630">:=</span>&nbsp;<span class="ident" id="3440633">fd</span><span class="op" id="3440635">.</span><span class="ident" id="3440636">init</span><span class="op" id="3440640">(</span><span class="op" id="3440641">)</span><span class="op" id="3440642">;</span>&nbsp;<span class="ident" id="3440644">err</span>&nbsp;<span class="op" id="3440648">!=</span>&nbsp;<span class="ident" id="3440651">nil</span>&nbsp;<span class="op" id="3440655">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440660">return</span>&nbsp;<span class="ident" id="3440667">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440679">lsa</span><span class="op" id="3440682">,</span>&nbsp;<span class="ident" id="3440684">_</span>&nbsp;<span class="op" id="3440686">=</span>&nbsp;<span class="ident" id="3440688">syscall</span><span class="op" id="3440695">.</span><span class="ident" id="3440696">Getsockname</span><span class="op" id="3440707">(</span><span class="ident" id="3440708">fd</span><span class="op" id="3440710">.</span><span class="ident" id="3440711">sysfd</span><span class="op" id="3440716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440719">if</span>&nbsp;<span class="ident" id="3440722">rsa</span><span class="op" id="3440725">,</span>&nbsp;<span class="ident" id="3440727">_</span>&nbsp;<span class="op" id="3440729">=</span>&nbsp;<span class="ident" id="3440731">syscall</span><span class="op" id="3440738">.</span><span class="ident" id="3440739">Getpeername</span><span class="op" id="3440750">(</span><span class="ident" id="3440751">fd</span><span class="op" id="3440753">.</span><span class="ident" id="3440754">sysfd</span><span class="op" id="3440759">)</span><span class="op" id="3440760">;</span>&nbsp;<span class="ident" id="3440762">rsa</span>&nbsp;<span class="op" id="3440766">!=</span>&nbsp;<span class="ident" id="3440769">nil</span>&nbsp;<span class="op" id="3440773">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440777">fd</span><span class="op" id="3440779">.</span><span class="ident" id="3440780">setAddr</span><span class="op" id="3440787">(</span><span class="ident" id="3440788">fd</span><span class="op" id="3440790">.</span><span class="ident" id="3440791">addrFunc</span><span class="op" id="3440799">(</span><span class="op" id="3440800">)</span><span class="op" id="3440801">(</span><span class="ident" id="3440802">lsa</span><span class="op" id="3440805">)</span><span class="op" id="3440806">,</span>&nbsp;<span class="ident" id="3440808">fd</span><span class="op" id="3440810">.</span><span class="ident" id="3440811">addrFunc</span><span class="op" id="3440819">(</span><span class="op" id="3440820">)</span><span class="op" id="3440821">(</span><span class="ident" id="3440822">rsa</span><span class="op" id="3440825">)</span><span class="op" id="3440826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440829">}</span>&nbsp;<span class="keyword" id="3440831">else</span>&nbsp;<span class="op" id="3440836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440840">fd</span><span class="op" id="3440842">.</span><span class="ident" id="3440843">setAddr</span><span class="op" id="3440850">(</span><span class="ident" id="3440851">fd</span><span class="op" id="3440853">.</span><span class="ident" id="3440854">addrFunc</span><span class="op" id="3440862">(</span><span class="op" id="3440863">)</span><span class="op" id="3440864">(</span><span class="ident" id="3440865">lsa</span><span class="op" id="3440868">)</span><span class="op" id="3440869">,</span>&nbsp;<span class="ident" id="3440871">raddr</span><span class="op" id="3440876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440882">return</span>&nbsp;<span class="ident" id="3440889">nil</span><br>
<span class="lineno">155</span><span class="op" id="3440893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3440896">func</span>&nbsp;<span class="op" id="3440901">(</span><span class="ident" id="3440902">fd</span>&nbsp;<span class="op" id="3440905">*</span><span class="ident" id="3440906">netFD</span><span class="op" id="3440911">)</span>&nbsp;<span class="ident" id="3440913">listenStream</span><span class="op" id="3440925">(</span><span class="ident" id="3440926">laddr</span>&nbsp;<span class="ident" id="3440932">sockaddr</span><span class="op" id="3440940">,</span>&nbsp;<span class="ident" id="3440942">backlog</span>&nbsp;<span class="builtintype" id="3440950">int</span><span class="op" id="3440953">)</span>&nbsp;<span class="builtintype" id="3440955">error</span>&nbsp;<span class="op" id="3440961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440964">if</span>&nbsp;<span class="ident" id="3440967">err</span>&nbsp;<span class="op" id="3440971">:=</span>&nbsp;<span class="ident" id="3440974">setDefaultListenerSockopts</span><span class="op" id="3441000">(</span><span class="ident" id="3441001">fd</span><span class="op" id="3441003">.</span><span class="ident" id="3441004">sysfd</span><span class="op" id="3441009">)</span><span class="op" id="3441010">;</span>&nbsp;<span class="ident" id="3441012">err</span>&nbsp;<span class="op" id="3441016">!=</span>&nbsp;<span class="ident" id="3441019">nil</span>&nbsp;<span class="op" id="3441023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441027">return</span>&nbsp;<span class="ident" id="3441034">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441042">if</span>&nbsp;<span class="ident" id="3441045">lsa</span><span class="op" id="3441048">,</span>&nbsp;<span class="ident" id="3441050">err</span>&nbsp;<span class="op" id="3441054">:=</span>&nbsp;<span class="ident" id="3441057">laddr</span><span class="op" id="3441062">.</span><span class="ident" id="3441063">sockaddr</span><span class="op" id="3441071">(</span><span class="ident" id="3441072">fd</span><span class="op" id="3441074">.</span><span class="ident" id="3441075">family</span><span class="op" id="3441081">)</span><span class="op" id="3441082">;</span>&nbsp;<span class="ident" id="3441084">err</span>&nbsp;<span class="op" id="3441088">!=</span>&nbsp;<span class="ident" id="3441091">nil</span>&nbsp;<span class="op" id="3441095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441099">return</span>&nbsp;<span class="ident" id="3441106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441111">}</span>&nbsp;<span class="keyword" id="3441113">else</span>&nbsp;<span class="keyword" id="3441118">if</span>&nbsp;<span class="ident" id="3441121">lsa</span>&nbsp;<span class="op" id="3441125">!=</span>&nbsp;<span class="ident" id="3441128">nil</span>&nbsp;<span class="op" id="3441132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441136">if</span>&nbsp;<span class="ident" id="3441139">err</span>&nbsp;<span class="op" id="3441143">:=</span>&nbsp;<span class="ident" id="3441146">syscall</span><span class="op" id="3441153">.</span><span class="ident" id="3441154">Bind</span><span class="op" id="3441158">(</span><span class="ident" id="3441159">fd</span><span class="op" id="3441161">.</span><span class="ident" id="3441162">sysfd</span><span class="op" id="3441167">,</span>&nbsp;<span class="ident" id="3441169">lsa</span><span class="op" id="3441172">)</span><span class="op" id="3441173">;</span>&nbsp;<span class="ident" id="3441175">err</span>&nbsp;<span class="op" id="3441179">!=</span>&nbsp;<span class="ident" id="3441182">nil</span>&nbsp;<span class="op" id="3441186">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441191">return</span>&nbsp;<span class="ident" id="3441198">os</span><span class="op" id="3441200">.</span><span class="ident" id="3441201">NewSyscallError</span><span class="op" id="3441216">(</span><span class="string" id="3441217">&#34;bind&#34;</span><span class="op" id="3441223">,</span>&nbsp;<span class="ident" id="3441225">err</span><span class="op" id="3441228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441238">if</span>&nbsp;<span class="ident" id="3441241">err</span>&nbsp;<span class="op" id="3441245">:=</span>&nbsp;<span class="ident" id="3441248">syscall</span><span class="op" id="3441255">.</span><span class="ident" id="3441256">Listen</span><span class="op" id="3441262">(</span><span class="ident" id="3441263">fd</span><span class="op" id="3441265">.</span><span class="ident" id="3441266">sysfd</span><span class="op" id="3441271">,</span>&nbsp;<span class="ident" id="3441273">backlog</span><span class="op" id="3441280">)</span><span class="op" id="3441281">;</span>&nbsp;<span class="ident" id="3441283">err</span>&nbsp;<span class="op" id="3441287">!=</span>&nbsp;<span class="ident" id="3441290">nil</span>&nbsp;<span class="op" id="3441294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441298">return</span>&nbsp;<span class="ident" id="3441305">os</span><span class="op" id="3441307">.</span><span class="ident" id="3441308">NewSyscallError</span><span class="op" id="3441323">(</span><span class="string" id="3441324">&#34;listen&#34;</span><span class="op" id="3441332">,</span>&nbsp;<span class="ident" id="3441334">err</span><span class="op" id="3441337">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441343">if</span>&nbsp;<span class="ident" id="3441346">err</span>&nbsp;<span class="op" id="3441350">:=</span>&nbsp;<span class="ident" id="3441353">fd</span><span class="op" id="3441355">.</span><span class="ident" id="3441356">init</span><span class="op" id="3441360">(</span><span class="op" id="3441361">)</span><span class="op" id="3441362">;</span>&nbsp;<span class="ident" id="3441364">err</span>&nbsp;<span class="op" id="3441368">!=</span>&nbsp;<span class="ident" id="3441371">nil</span>&nbsp;<span class="op" id="3441375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441379">return</span>&nbsp;<span class="ident" id="3441386">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3441391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441394">lsa</span><span class="op" id="3441397">,</span>&nbsp;<span class="ident" id="3441399">_</span>&nbsp;<span class="op" id="3441401">:=</span>&nbsp;<span class="ident" id="3441404">syscall</span><span class="op" id="3441411">.</span><span class="ident" id="3441412">Getsockname</span><span class="op" id="3441423">(</span><span class="ident" id="3441424">fd</span><span class="op" id="3441426">.</span><span class="ident" id="3441427">sysfd</span><span class="op" id="3441432">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3441435">fd</span><span class="op" id="3441437">.</span><span class="ident" id="3441438">setAddr</span><span class="op" id="3441445">(</span><span class="ident" id="3441446">fd</span><span class="op" id="3441448">.</span><span class="ident" id="3441449">addrFunc</span><span class="op" id="3441457">(</span><span class="op" id="3441458">)</span><span class="op" id="3441459">(</span><span class="ident" id="3441460">lsa</span><span class="op" id="3441463">)</span><span class="op" id="3441464">,</span>&nbsp;<span class="ident" id="3441466">nil</span><span class="op" id="3441469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441472">return</span>&nbsp;<span class="ident" id="3441479">nil</span><br>
<span class="lineno"></span><span class="op" id="3441483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3441486">func</span>&nbsp;<span class="op" id="3441491">(</span><span class="ident" id="3441492">fd</span>&nbsp;<span class="op" id="3441495">*</span><span class="ident" id="3441496">netFD</span><span class="op" id="3441501">)</span>&nbsp;<span class="ident" id="3441503">listenDatagram</span><span class="op" id="3441517">(</span><span class="ident" id="3441518">laddr</span>&nbsp;<span class="ident" id="3441524">sockaddr</span><span class="op" id="3441532">)</span>&nbsp;<span class="builtintype" id="3441534">error</span>&nbsp;<span class="op" id="3441540">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441543">switch</span>&nbsp;<span class="ident" id="3441550">addr</span>&nbsp;<span class="op" id="3441555">:=</span>&nbsp;<span class="ident" id="3441558">laddr</span><span class="op" id="3441563">.</span><span class="op" id="3441564">(</span><span class="keyword" id="3441565">type</span><span class="op" id="3441569">)</span>&nbsp;<span class="op" id="3441571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441574">case</span>&nbsp;<span class="op" id="3441579">*</span><span class="ident" id="3441580">UDPAddr</span><span class="op" id="3441587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441591">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441643">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441700">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441753">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441810">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441860">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3441916">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3441958">if</span>&nbsp;<span class="ident" id="3441961">addr</span><span class="op" id="3441965">.</span><span class="ident" id="3441966">IP</span>&nbsp;<span class="op" id="3441969">!=</span>&nbsp;<span class="ident" id="3441972">nil</span>&nbsp;<span class="op" id="3441976">&amp;&amp;</span>&nbsp;<span class="ident" id="3441979">addr</span><span class="op" id="3441983">.</span><span class="ident" id="3441984">IP</span><span class="op" id="3441986">.</span><span class="ident" id="3441987">IsMulticast</span><span class="op" id="3441998">(</span><span class="op" id="3441999">)</span>&nbsp;<span class="op" id="3442001">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442006">if</span>&nbsp;<span class="ident" id="3442009">err</span>&nbsp;<span class="op" id="3442013">:=</span>&nbsp;<span class="ident" id="3442016">setDefaultMulticastSockopts</span><span class="op" id="3442043">(</span><span class="ident" id="3442044">fd</span><span class="op" id="3442046">.</span><span class="ident" id="3442047">sysfd</span><span class="op" id="3442052">)</span><span class="op" id="3442053">;</span>&nbsp;<span class="ident" id="3442055">err</span>&nbsp;<span class="op" id="3442059">!=</span>&nbsp;<span class="ident" id="3442062">nil</span>&nbsp;<span class="op" id="3442066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442072">return</span>&nbsp;<span class="ident" id="3442079">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442091">addr</span>&nbsp;<span class="op" id="3442096">:=</span>&nbsp;<span class="op" id="3442099">*</span><span class="ident" id="3442100">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442108">switch</span>&nbsp;<span class="ident" id="3442115">fd</span><span class="op" id="3442117">.</span><span class="ident" id="3442118">family</span>&nbsp;<span class="op" id="3442125">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442130">case</span>&nbsp;<span class="ident" id="3442135">syscall</span><span class="op" id="3442142">.</span><span class="ident" id="3442143">AF_INET</span><span class="op" id="3442150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442156">addr</span><span class="op" id="3442160">.</span><span class="ident" id="3442161">IP</span>&nbsp;<span class="op" id="3442164">=</span>&nbsp;<span class="ident" id="3442166">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442178">case</span>&nbsp;<span class="ident" id="3442183">syscall</span><span class="op" id="3442190">.</span><span class="ident" id="3442191">AF_INET6</span><span class="op" id="3442199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442205">addr</span><span class="op" id="3442209">.</span><span class="ident" id="3442210">IP</span>&nbsp;<span class="op" id="3442213">=</span>&nbsp;<span class="ident" id="3442215">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442234">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442239">laddr</span>&nbsp;<span class="op" id="3442245">=</span>&nbsp;<span class="op" id="3442247">&amp;</span><span class="ident" id="3442248">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442261">if</span>&nbsp;<span class="ident" id="3442264">lsa</span><span class="op" id="3442267">,</span>&nbsp;<span class="ident" id="3442269">err</span>&nbsp;<span class="op" id="3442273">:=</span>&nbsp;<span class="ident" id="3442276">laddr</span><span class="op" id="3442281">.</span><span class="ident" id="3442282">sockaddr</span><span class="op" id="3442290">(</span><span class="ident" id="3442291">fd</span><span class="op" id="3442293">.</span><span class="ident" id="3442294">family</span><span class="op" id="3442300">)</span><span class="op" id="3442301">;</span>&nbsp;<span class="ident" id="3442303">err</span>&nbsp;<span class="op" id="3442307">!=</span>&nbsp;<span class="ident" id="3442310">nil</span>&nbsp;<span class="op" id="3442314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442318">return</span>&nbsp;<span class="ident" id="3442325">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442330">}</span>&nbsp;<span class="keyword" id="3442332">else</span>&nbsp;<span class="keyword" id="3442337">if</span>&nbsp;<span class="ident" id="3442340">lsa</span>&nbsp;<span class="op" id="3442344">!=</span>&nbsp;<span class="ident" id="3442347">nil</span>&nbsp;<span class="op" id="3442351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442355">if</span>&nbsp;<span class="ident" id="3442358">err</span>&nbsp;<span class="op" id="3442362">:=</span>&nbsp;<span class="ident" id="3442365">syscall</span><span class="op" id="3442372">.</span><span class="ident" id="3442373">Bind</span><span class="op" id="3442377">(</span><span class="ident" id="3442378">fd</span><span class="op" id="3442380">.</span><span class="ident" id="3442381">sysfd</span><span class="op" id="3442386">,</span>&nbsp;<span class="ident" id="3442388">lsa</span><span class="op" id="3442391">)</span><span class="op" id="3442392">;</span>&nbsp;<span class="ident" id="3442394">err</span>&nbsp;<span class="op" id="3442398">!=</span>&nbsp;<span class="ident" id="3442401">nil</span>&nbsp;<span class="op" id="3442405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442410">return</span>&nbsp;<span class="ident" id="3442417">os</span><span class="op" id="3442419">.</span><span class="ident" id="3442420">NewSyscallError</span><span class="op" id="3442435">(</span><span class="string" id="3442436">&#34;bind&#34;</span><span class="op" id="3442442">,</span>&nbsp;<span class="ident" id="3442444">err</span><span class="op" id="3442447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442454">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442457">if</span>&nbsp;<span class="ident" id="3442460">err</span>&nbsp;<span class="op" id="3442464">:=</span>&nbsp;<span class="ident" id="3442467">fd</span><span class="op" id="3442469">.</span><span class="ident" id="3442470">init</span><span class="op" id="3442474">(</span><span class="op" id="3442475">)</span><span class="op" id="3442476">;</span>&nbsp;<span class="ident" id="3442478">err</span>&nbsp;<span class="op" id="3442482">!=</span>&nbsp;<span class="ident" id="3442485">nil</span>&nbsp;<span class="op" id="3442489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442493">return</span>&nbsp;<span class="ident" id="3442500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3442505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442508">lsa</span><span class="op" id="3442511">,</span>&nbsp;<span class="ident" id="3442513">_</span>&nbsp;<span class="op" id="3442515">:=</span>&nbsp;<span class="ident" id="3442518">syscall</span><span class="op" id="3442525">.</span><span class="ident" id="3442526">Getsockname</span><span class="op" id="3442537">(</span><span class="ident" id="3442538">fd</span><span class="op" id="3442540">.</span><span class="ident" id="3442541">sysfd</span><span class="op" id="3442546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3442549">fd</span><span class="op" id="3442551">.</span><span class="ident" id="3442552">setAddr</span><span class="op" id="3442559">(</span><span class="ident" id="3442560">fd</span><span class="op" id="3442562">.</span><span class="ident" id="3442563">addrFunc</span><span class="op" id="3442571">(</span><span class="op" id="3442572">)</span><span class="op" id="3442573">(</span><span class="ident" id="3442574">lsa</span><span class="op" id="3442577">)</span><span class="op" id="3442578">,</span>&nbsp;<span class="ident" id="3442580">nil</span><span class="op" id="3442583">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3442586">return</span>&nbsp;<span class="ident" id="3442593">nil</span><br>
<span class="lineno"></span><span class="op" id="3442597">}</span>
</div>
</body>
</html>
