<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7357557">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7357612">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7357666">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7357717">package</span>&nbsp;<span class="ident" id="7357725">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7357731">import</span>&nbsp;<span class="op" id="7357738">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7357741">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7357750">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7357756">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7357767">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7357777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7357780">func</span>&nbsp;<span class="ident" id="7357785">TestBodyReadBadTrailer</span><span class="op" id="7357807">(</span><span class="ident" id="7357808">t</span>&nbsp;<span class="op" id="7357810">*</span><span class="ident" id="7357811">testing</span><span class="op" id="7357818">.</span><span class="ident" id="7357819">T</span><span class="op" id="7357820">)</span>&nbsp;<span class="op" id="7357822">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357825">b</span>&nbsp;<span class="op" id="7357827">:=</span>&nbsp;<span class="op" id="7357830">&amp;</span><span class="ident" id="7357831">body</span><span class="op" id="7357835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357839">src</span><span class="op" id="7357842">:</span>&nbsp;<span class="ident" id="7357844">strings</span><span class="op" id="7357851">.</span><span class="ident" id="7357852">NewReader</span><span class="op" id="7357861">(</span><span class="string" id="7357862">&#34;foobar&#34;</span><span class="op" id="7357870">)</span><span class="op" id="7357871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357875">hdr</span><span class="op" id="7357878">:</span>&nbsp;<span class="builtintype" id="7357880">true</span><span class="op" id="7357884">,</span>&nbsp;<span class="comment" id="7357886">//&nbsp;force&nbsp;reading&nbsp;the&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357917">r</span><span class="op" id="7357918">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7357922">bufio</span><span class="op" id="7357927">.</span><span class="ident" id="7357928">NewReader</span><span class="op" id="7357937">(</span><span class="ident" id="7357938">strings</span><span class="op" id="7357945">.</span><span class="ident" id="7357946">NewReader</span><span class="op" id="7357955">(</span><span class="string" id="7357956">&#34;&#34;</span><span class="op" id="7357958">)</span><span class="op" id="7357959">)</span><span class="op" id="7357960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357963">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357966">buf</span>&nbsp;<span class="op" id="7357970">:=</span>&nbsp;<span class="builtinfunc" id="7357973">make</span><span class="op" id="7357977">(</span><span class="op" id="7357978">[</span><span class="op" id="7357979">]</span><span class="builtintype" id="7357980">byte</span><span class="op" id="7357984">,</span>&nbsp;<span class="num" id="7357986">7</span><span class="op" id="7357987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357990">n</span><span class="op" id="7357991">,</span>&nbsp;<span class="ident" id="7357993">err</span>&nbsp;<span class="op" id="7357997">:=</span>&nbsp;<span class="ident" id="7358000">b</span><span class="op" id="7358001">.</span><span class="ident" id="7358002">Read</span><span class="op" id="7358006">(</span><span class="ident" id="7358007">buf</span><span class="op" id="7358010">[</span><span class="op" id="7358011">:</span><span class="num" id="7358012">3</span><span class="op" id="7358013">]</span><span class="op" id="7358014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358017">got</span>&nbsp;<span class="op" id="7358021">:=</span>&nbsp;<span class="builtintype" id="7358024">string</span><span class="op" id="7358030">(</span><span class="ident" id="7358031">buf</span><span class="op" id="7358034">[</span><span class="op" id="7358035">:</span><span class="ident" id="7358036">n</span><span class="op" id="7358037">]</span><span class="op" id="7358038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358041">if</span>&nbsp;<span class="ident" id="7358044">got</span>&nbsp;<span class="op" id="7358048">!=</span>&nbsp;<span class="string" id="7358051">&#34;foo&#34;</span>&nbsp;<span class="op" id="7358057">||</span>&nbsp;<span class="ident" id="7358060">err</span>&nbsp;<span class="op" id="7358064">!=</span>&nbsp;<span class="ident" id="7358067">nil</span>&nbsp;<span class="op" id="7358071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358075">t</span><span class="op" id="7358076">.</span><span class="ident" id="7358077">Fatalf</span><span class="op" id="7358083">(</span><span class="string" id="7358084">`first&nbsp;Read&nbsp;=&nbsp;%d&nbsp;(%q),&nbsp;%v;&nbsp;want&nbsp;3&nbsp;(&#34;foo&#34;)`</span><span class="op" id="7358126">,</span>&nbsp;<span class="ident" id="7358128">n</span><span class="op" id="7358129">,</span>&nbsp;<span class="ident" id="7358131">got</span><span class="op" id="7358134">,</span>&nbsp;<span class="ident" id="7358136">err</span><span class="op" id="7358139">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358146">n</span><span class="op" id="7358147">,</span>&nbsp;<span class="ident" id="7358149">err</span>&nbsp;<span class="op" id="7358153">=</span>&nbsp;<span class="ident" id="7358155">b</span><span class="op" id="7358156">.</span><span class="ident" id="7358157">Read</span><span class="op" id="7358161">(</span><span class="ident" id="7358162">buf</span><span class="op" id="7358165">[</span><span class="op" id="7358166">:</span><span class="op" id="7358167">]</span><span class="op" id="7358168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358171">got</span>&nbsp;<span class="op" id="7358175">=</span>&nbsp;<span class="builtintype" id="7358177">string</span><span class="op" id="7358183">(</span><span class="ident" id="7358184">buf</span><span class="op" id="7358187">[</span><span class="op" id="7358188">:</span><span class="ident" id="7358189">n</span><span class="op" id="7358190">]</span><span class="op" id="7358191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358194">if</span>&nbsp;<span class="ident" id="7358197">got</span>&nbsp;<span class="op" id="7358201">!=</span>&nbsp;<span class="string" id="7358204">&#34;bar&#34;</span>&nbsp;<span class="op" id="7358210">||</span>&nbsp;<span class="ident" id="7358213">err</span>&nbsp;<span class="op" id="7358217">!=</span>&nbsp;<span class="ident" id="7358220">nil</span>&nbsp;<span class="op" id="7358224">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358228">t</span><span class="op" id="7358229">.</span><span class="ident" id="7358230">Fatalf</span><span class="op" id="7358236">(</span><span class="string" id="7358237">`second&nbsp;Read&nbsp;=&nbsp;%d&nbsp;(%q),&nbsp;%v;&nbsp;want&nbsp;3&nbsp;(&#34;bar&#34;)`</span><span class="op" id="7358280">,</span>&nbsp;<span class="ident" id="7358282">n</span><span class="op" id="7358283">,</span>&nbsp;<span class="ident" id="7358285">got</span><span class="op" id="7358288">,</span>&nbsp;<span class="ident" id="7358290">err</span><span class="op" id="7358293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358300">n</span><span class="op" id="7358301">,</span>&nbsp;<span class="ident" id="7358303">err</span>&nbsp;<span class="op" id="7358307">=</span>&nbsp;<span class="ident" id="7358309">b</span><span class="op" id="7358310">.</span><span class="ident" id="7358311">Read</span><span class="op" id="7358315">(</span><span class="ident" id="7358316">buf</span><span class="op" id="7358319">[</span><span class="op" id="7358320">:</span><span class="op" id="7358321">]</span><span class="op" id="7358322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358325">got</span>&nbsp;<span class="op" id="7358329">=</span>&nbsp;<span class="builtintype" id="7358331">string</span><span class="op" id="7358337">(</span><span class="ident" id="7358338">buf</span><span class="op" id="7358341">[</span><span class="op" id="7358342">:</span><span class="ident" id="7358343">n</span><span class="op" id="7358344">]</span><span class="op" id="7358345">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358348">if</span>&nbsp;<span class="ident" id="7358351">err</span>&nbsp;<span class="op" id="7358355">==</span>&nbsp;<span class="ident" id="7358358">nil</span>&nbsp;<span class="op" id="7358362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358366">t</span><span class="op" id="7358367">.</span><span class="ident" id="7358368">Errorf</span><span class="op" id="7358374">(</span><span class="string" id="7358375">&#34;final&nbsp;Read&nbsp;was&nbsp;successful&nbsp;(%q),&nbsp;expected&nbsp;error&nbsp;from&nbsp;trailer&nbsp;read&#34;</span><span class="op" id="7358441">,</span>&nbsp;<span class="ident" id="7358443">got</span><span class="op" id="7358446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358449">}</span><br>
<span class="lineno"></span><span class="op" id="7358451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7358454">func</span>&nbsp;<span class="ident" id="7358459">TestFinalChunkedBodyReadEOF</span><span class="op" id="7358486">(</span><span class="ident" id="7358487">t</span>&nbsp;<span class="op" id="7358489">*</span><span class="ident" id="7358490">testing</span><span class="op" id="7358497">.</span><span class="ident" id="7358498">T</span><span class="op" id="7358499">)</span>&nbsp;<span class="op" id="7358501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358504">res</span><span class="op" id="7358507">,</span>&nbsp;<span class="ident" id="7358509">err</span>&nbsp;<span class="op" id="7358513">:=</span>&nbsp;<span class="ident" id="7358516">ReadResponse</span><span class="op" id="7358528">(</span><span class="ident" id="7358529">bufio</span><span class="op" id="7358534">.</span><span class="ident" id="7358535">NewReader</span><span class="op" id="7358544">(</span><span class="ident" id="7358545">strings</span><span class="op" id="7358552">.</span><span class="ident" id="7358553">NewReader</span><span class="op" id="7358562">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358566">&#34;HTTP/1.1&nbsp;200&nbsp;OK\r\n&#34;</span><span class="op" id="7358587">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358592">&#34;Transfer-Encoding:&nbsp;chunked\r\n&#34;</span><span class="op" id="7358624">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358629">&#34;\r\n&#34;</span><span class="op" id="7358635">+</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358640">&#34;0a\r\n&#34;</span><span class="op" id="7358648">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358653">&#34;Body&nbsp;here\n\r\n&#34;</span><span class="op" id="7358670">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358675">&#34;09\r\n&#34;</span><span class="op" id="7358683">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358688">&#34;continued\r\n&#34;</span><span class="op" id="7358703">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358708">&#34;0\r\n&#34;</span><span class="op" id="7358715">+</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7358720">&#34;\r\n&#34;</span><span class="op" id="7358726">)</span><span class="op" id="7358727">)</span><span class="op" id="7358728">,</span>&nbsp;<span class="ident" id="7358730">nil</span><span class="op" id="7358733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358736">if</span>&nbsp;<span class="ident" id="7358739">err</span>&nbsp;<span class="op" id="7358743">!=</span>&nbsp;<span class="ident" id="7358746">nil</span>&nbsp;<span class="op" id="7358750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358754">t</span><span class="op" id="7358755">.</span><span class="ident" id="7358756">Fatal</span><span class="op" id="7358761">(</span><span class="ident" id="7358762">err</span><span class="op" id="7358765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358771">want</span>&nbsp;<span class="op" id="7358776">:=</span>&nbsp;<span class="string" id="7358779">&#34;Body&nbsp;here\ncontinued&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358803">buf</span>&nbsp;<span class="op" id="7358807">:=</span>&nbsp;<span class="builtinfunc" id="7358810">make</span><span class="op" id="7358814">(</span><span class="op" id="7358815">[</span><span class="op" id="7358816">]</span><span class="builtintype" id="7358817">byte</span><span class="op" id="7358821">,</span>&nbsp;<span class="builtinfunc" id="7358823">len</span><span class="op" id="7358826">(</span><span class="ident" id="7358827">want</span><span class="op" id="7358831">)</span><span class="op" id="7358832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358835">n</span><span class="op" id="7358836">,</span>&nbsp;<span class="ident" id="7358838">err</span>&nbsp;<span class="op" id="7358842">:=</span>&nbsp;<span class="ident" id="7358845">res</span><span class="op" id="7358848">.</span><span class="ident" id="7358849">Body</span><span class="op" id="7358853">.</span><span class="ident" id="7358854">Read</span><span class="op" id="7358858">(</span><span class="ident" id="7358859">buf</span><span class="op" id="7358862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358865">if</span>&nbsp;<span class="ident" id="7358868">n</span>&nbsp;<span class="op" id="7358870">!=</span>&nbsp;<span class="builtinfunc" id="7358873">len</span><span class="op" id="7358876">(</span><span class="ident" id="7358877">want</span><span class="op" id="7358881">)</span>&nbsp;<span class="op" id="7358883">||</span>&nbsp;<span class="ident" id="7358886">err</span>&nbsp;<span class="op" id="7358890">!=</span>&nbsp;<span class="ident" id="7358893">io</span><span class="op" id="7358895">.</span><span class="ident" id="7358896">EOF</span>&nbsp;<span class="op" id="7358900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358904">t</span><span class="op" id="7358905">.</span><span class="ident" id="7358906">Logf</span><span class="op" id="7358910">(</span><span class="string" id="7358911">&#34;body&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7358923">,</span>&nbsp;<span class="ident" id="7358925">res</span><span class="op" id="7358928">.</span><span class="ident" id="7358929">Body</span><span class="op" id="7358933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358937">t</span><span class="op" id="7358938">.</span><span class="ident" id="7358939">Errorf</span><span class="op" id="7358945">(</span><span class="string" id="7358946">&#34;Read&nbsp;=&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7358975">,</span>&nbsp;<span class="ident" id="7358977">n</span><span class="op" id="7358978">,</span>&nbsp;<span class="ident" id="7358980">err</span><span class="op" id="7358983">,</span>&nbsp;<span class="builtinfunc" id="7358985">len</span><span class="op" id="7358988">(</span><span class="ident" id="7358989">want</span><span class="op" id="7358993">)</span><span class="op" id="7358994">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359000">if</span>&nbsp;<span class="builtintype" id="7359003">string</span><span class="op" id="7359009">(</span><span class="ident" id="7359010">buf</span><span class="op" id="7359013">)</span>&nbsp;<span class="op" id="7359015">!=</span>&nbsp;<span class="ident" id="7359018">want</span>&nbsp;<span class="op" id="7359023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359027">t</span><span class="op" id="7359028">.</span><span class="ident" id="7359029">Errorf</span><span class="op" id="7359035">(</span><span class="string" id="7359036">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7359055">,</span>&nbsp;<span class="ident" id="7359057">buf</span><span class="op" id="7359060">,</span>&nbsp;<span class="ident" id="7359062">want</span><span class="op" id="7359066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359069">}</span><br>
<span class="lineno"></span><span class="op" id="7359071">}</span>
</div>
</body>
</html>
