<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html" class="current">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4155956">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4156012">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4156066">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4156117">package</span>&nbsp;<span class="ident" id="4156125">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4156130">import</span>&nbsp;<span class="op" id="4156137">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156140">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156146">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156152">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="4156162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156165">//&nbsp;maxSendfileSize&nbsp;is&nbsp;the&nbsp;largest&nbsp;chunk&nbsp;size&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="4156236">//&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">15</span><span class="keyword" id="4156250">const</span>&nbsp;<span class="ident" id="4156256">maxSendfileSize</span>&nbsp;<span class="builtintype" id="4156272">int</span>&nbsp;<span class="op" id="4156276">=</span>&nbsp;<span class="num" id="4156278">4</span>&nbsp;<span class="op" id="4156280">&lt;&lt;</span>&nbsp;<span class="num" id="4156283">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156287">//&nbsp;sendFile&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;r&nbsp;to&nbsp;c&nbsp;using&nbsp;the&nbsp;sendfile</span><br>
<span class="lineno"></span><span class="comment" id="4156348">//&nbsp;system&nbsp;call&nbsp;to&nbsp;minimize&nbsp;copies.</span><br>
<span class="lineno"></span><span class="comment" id="4156383">//</span><br>
<span class="lineno">20</span><span class="comment" id="4156386">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;true,&nbsp;sendFile&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;and&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4156461">//&nbsp;non-EOF&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4156479">//</span><br>
<span class="lineno"></span><span class="comment" id="4156482">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;false,&nbsp;sendFile&nbsp;performed&nbsp;no&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="4156534">func</span>&nbsp;<span class="ident" id="4156539">sendFile</span><span class="op" id="4156547">(</span><span class="ident" id="4156548">c</span>&nbsp;<span class="op" id="4156550">*</span><span class="ident" id="4156551">netFD</span><span class="op" id="4156556">,</span>&nbsp;<span class="ident" id="4156558">r</span>&nbsp;<span class="ident" id="4156560">io</span><span class="op" id="4156562">.</span><span class="ident" id="4156563">Reader</span><span class="op" id="4156569">)</span>&nbsp;<span class="op" id="4156571">(</span><span class="ident" id="4156572">written</span>&nbsp;<span class="ident" id="4156580">int64</span><span class="op" id="4156585">,</span>&nbsp;<span class="ident" id="4156587">err</span>&nbsp;<span class="builtintype" id="4156591">error</span><span class="op" id="4156596">,</span>&nbsp;<span class="ident" id="4156598">handled</span>&nbsp;<span class="builtintype" id="4156606">bool</span><span class="op" id="4156610">)</span>&nbsp;<span class="op" id="4156612">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156615">var</span>&nbsp;<span class="ident" id="4156619">remain</span>&nbsp;<span class="ident" id="4156626">int64</span>&nbsp;<span class="op" id="4156632">=</span>&nbsp;<span class="num" id="4156634">1</span>&nbsp;<span class="op" id="4156636">&lt;&lt;</span>&nbsp;<span class="num" id="4156639">62</span>&nbsp;<span class="comment" id="4156642">//&nbsp;by&nbsp;default,&nbsp;copy&nbsp;until&nbsp;EOF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156674">lr</span><span class="op" id="4156676">,</span>&nbsp;<span class="ident" id="4156678">ok</span>&nbsp;<span class="op" id="4156681">:=</span>&nbsp;<span class="ident" id="4156684">r</span><span class="op" id="4156685">.</span><span class="op" id="4156686">(</span><span class="op" id="4156687">*</span><span class="ident" id="4156688">io</span><span class="op" id="4156690">.</span><span class="ident" id="4156691">LimitedReader</span><span class="op" id="4156704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156707">if</span>&nbsp;<span class="ident" id="4156710">ok</span>&nbsp;<span class="op" id="4156713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156717">remain</span><span class="op" id="4156723">,</span>&nbsp;<span class="ident" id="4156725">r</span>&nbsp;<span class="op" id="4156727">=</span>&nbsp;<span class="ident" id="4156729">lr</span><span class="op" id="4156731">.</span><span class="ident" id="4156732">N</span><span class="op" id="4156733">,</span>&nbsp;<span class="ident" id="4156735">lr</span><span class="op" id="4156737">.</span><span class="ident" id="4156738">R</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156742">if</span>&nbsp;<span class="ident" id="4156745">remain</span>&nbsp;<span class="op" id="4156752">&lt;=</span>&nbsp;<span class="num" id="4156755">0</span>&nbsp;<span class="op" id="4156757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156762">return</span>&nbsp;<span class="num" id="4156769">0</span><span class="op" id="4156770">,</span>&nbsp;<span class="ident" id="4156772">nil</span><span class="op" id="4156775">,</span>&nbsp;<span class="builtintype" id="4156777">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156790">f</span><span class="op" id="4156791">,</span>&nbsp;<span class="ident" id="4156793">ok</span>&nbsp;<span class="op" id="4156796">:=</span>&nbsp;<span class="ident" id="4156799">r</span><span class="op" id="4156800">.</span><span class="op" id="4156801">(</span><span class="op" id="4156802">*</span><span class="ident" id="4156803">os</span><span class="op" id="4156805">.</span><span class="ident" id="4156806">File</span><span class="op" id="4156810">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156813">if</span>&nbsp;<span class="op" id="4156816">!</span><span class="ident" id="4156817">ok</span>&nbsp;<span class="op" id="4156820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156824">return</span>&nbsp;<span class="num" id="4156831">0</span><span class="op" id="4156832">,</span>&nbsp;<span class="ident" id="4156834">nil</span><span class="op" id="4156837">,</span>&nbsp;<span class="builtintype" id="4156839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156850">if</span>&nbsp;<span class="ident" id="4156853">err</span>&nbsp;<span class="op" id="4156857">:=</span>&nbsp;<span class="ident" id="4156860">c</span><span class="op" id="4156861">.</span><span class="ident" id="4156862">writeLock</span><span class="op" id="4156871">(</span><span class="op" id="4156872">)</span><span class="op" id="4156873">;</span>&nbsp;<span class="ident" id="4156875">err</span>&nbsp;<span class="op" id="4156879">!=</span>&nbsp;<span class="ident" id="4156882">nil</span>&nbsp;<span class="op" id="4156886">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156890">return</span>&nbsp;<span class="num" id="4156897">0</span><span class="op" id="4156898">,</span>&nbsp;<span class="ident" id="4156900">err</span><span class="op" id="4156903">,</span>&nbsp;<span class="builtintype" id="4156905">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156914">defer</span>&nbsp;<span class="ident" id="4156920">c</span><span class="op" id="4156921">.</span><span class="ident" id="4156922">writeUnlock</span><span class="op" id="4156933">(</span><span class="op" id="4156934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156938">dst</span>&nbsp;<span class="op" id="4156942">:=</span>&nbsp;<span class="ident" id="4156945">c</span><span class="op" id="4156946">.</span><span class="ident" id="4156947">sysfd</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156954">src</span>&nbsp;<span class="op" id="4156958">:=</span>&nbsp;<span class="builtintype" id="4156961">int</span><span class="op" id="4156964">(</span><span class="ident" id="4156965">f</span><span class="op" id="4156966">.</span><span class="ident" id="4156967">Fd</span><span class="op" id="4156969">(</span><span class="op" id="4156970">)</span><span class="op" id="4156971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156974">for</span>&nbsp;<span class="ident" id="4156978">remain</span>&nbsp;<span class="op" id="4156985">&gt;</span>&nbsp;<span class="num" id="4156987">0</span>&nbsp;<span class="op" id="4156989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156993">n</span>&nbsp;<span class="op" id="4156995">:=</span>&nbsp;<span class="ident" id="4156998">maxSendfileSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157016">if</span>&nbsp;<span class="ident" id="4157019">int64</span><span class="op" id="4157024">(</span><span class="ident" id="4157025">n</span><span class="op" id="4157026">)</span>&nbsp;<span class="op" id="4157028">&gt;</span>&nbsp;<span class="ident" id="4157030">remain</span>&nbsp;<span class="op" id="4157037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157042">n</span>&nbsp;<span class="op" id="4157044">=</span>&nbsp;<span class="builtintype" id="4157046">int</span><span class="op" id="4157049">(</span><span class="ident" id="4157050">remain</span><span class="op" id="4157056">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157064">n</span><span class="op" id="4157065">,</span>&nbsp;<span class="ident" id="4157067">err1</span>&nbsp;<span class="op" id="4157072">:=</span>&nbsp;<span class="ident" id="4157075">syscall</span><span class="op" id="4157082">.</span><span class="ident" id="4157083">Sendfile</span><span class="op" id="4157091">(</span><span class="ident" id="4157092">dst</span><span class="op" id="4157095">,</span>&nbsp;<span class="ident" id="4157097">src</span><span class="op" id="4157100">,</span>&nbsp;<span class="ident" id="4157102">nil</span><span class="op" id="4157105">,</span>&nbsp;<span class="ident" id="4157107">n</span><span class="op" id="4157108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157112">if</span>&nbsp;<span class="ident" id="4157115">n</span>&nbsp;<span class="op" id="4157117">&gt;</span>&nbsp;<span class="num" id="4157119">0</span>&nbsp;<span class="op" id="4157121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157126">written</span>&nbsp;<span class="op" id="4157134">+=</span>&nbsp;<span class="ident" id="4157137">int64</span><span class="op" id="4157142">(</span><span class="ident" id="4157143">n</span><span class="op" id="4157144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157149">remain</span>&nbsp;<span class="op" id="4157156">-=</span>&nbsp;<span class="ident" id="4157159">int64</span><span class="op" id="4157164">(</span><span class="ident" id="4157165">n</span><span class="op" id="4157166">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157174">if</span>&nbsp;<span class="ident" id="4157177">n</span>&nbsp;<span class="op" id="4157179">==</span>&nbsp;<span class="num" id="4157182">0</span>&nbsp;<span class="op" id="4157184">&amp;&amp;</span>&nbsp;<span class="ident" id="4157187">err1</span>&nbsp;<span class="op" id="4157192">==</span>&nbsp;<span class="ident" id="4157195">nil</span>&nbsp;<span class="op" id="4157199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157204">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157216">if</span>&nbsp;<span class="ident" id="4157219">err1</span>&nbsp;<span class="op" id="4157224">==</span>&nbsp;<span class="ident" id="4157227">syscall</span><span class="op" id="4157234">.</span><span class="ident" id="4157235">EAGAIN</span>&nbsp;<span class="op" id="4157242">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157247">if</span>&nbsp;<span class="ident" id="4157250">err1</span>&nbsp;<span class="op" id="4157255">=</span>&nbsp;<span class="ident" id="4157257">c</span><span class="op" id="4157258">.</span><span class="ident" id="4157259">pd</span><span class="op" id="4157261">.</span><span class="ident" id="4157262">WaitWrite</span><span class="op" id="4157271">(</span><span class="op" id="4157272">)</span><span class="op" id="4157273">;</span>&nbsp;<span class="ident" id="4157275">err1</span>&nbsp;<span class="op" id="4157280">==</span>&nbsp;<span class="ident" id="4157283">nil</span>&nbsp;<span class="op" id="4157287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157293">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157313">if</span>&nbsp;<span class="ident" id="4157316">err1</span>&nbsp;<span class="op" id="4157321">!=</span>&nbsp;<span class="ident" id="4157324">nil</span>&nbsp;<span class="op" id="4157328">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157333">//&nbsp;This&nbsp;includes&nbsp;syscall.ENOSYS&nbsp;(no&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157379">//&nbsp;support)&nbsp;and&nbsp;syscall.EINVAL&nbsp;(fd&nbsp;types&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157429">//&nbsp;don&#39;t&nbsp;implement&nbsp;sendfile&nbsp;together)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157470">err</span>&nbsp;<span class="op" id="4157474">=</span>&nbsp;<span class="op" id="4157476">&amp;</span><span class="ident" id="4157477">OpError</span><span class="op" id="4157484">{</span><span class="string" id="4157485">&#34;sendfile&#34;</span><span class="op" id="4157495">,</span>&nbsp;<span class="ident" id="4157497">c</span><span class="op" id="4157498">.</span><span class="ident" id="4157499">net</span><span class="op" id="4157502">,</span>&nbsp;<span class="ident" id="4157504">c</span><span class="op" id="4157505">.</span><span class="ident" id="4157506">raddr</span><span class="op" id="4157511">,</span>&nbsp;<span class="ident" id="4157513">err1</span><span class="op" id="4157517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157522">break</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157536">if</span>&nbsp;<span class="ident" id="4157539">lr</span>&nbsp;<span class="op" id="4157542">!=</span>&nbsp;<span class="ident" id="4157545">nil</span>&nbsp;<span class="op" id="4157549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157553">lr</span><span class="op" id="4157555">.</span><span class="ident" id="4157556">N</span>&nbsp;<span class="op" id="4157558">=</span>&nbsp;<span class="ident" id="4157560">remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157568">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157571">return</span>&nbsp;<span class="ident" id="4157578">written</span><span class="op" id="4157585">,</span>&nbsp;<span class="ident" id="4157587">err</span><span class="op" id="4157590">,</span>&nbsp;<span class="ident" id="4157592">written</span>&nbsp;<span class="op" id="4157600">&gt;</span>&nbsp;<span class="num" id="4157602">0</span><br>
<span class="lineno"></span><span class="op" id="4157604">}</span>
</div>
</body>
</html>
