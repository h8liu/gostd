<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8038939">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8038995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8039049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8039100">package</span>&nbsp;<span class="ident" id="8039108">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8039113">import</span>&nbsp;<span class="op" id="8039120">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039123">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039132">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039139">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039145">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039156">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039167">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8039178">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8039185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8039188">type</span>&nbsp;<span class="ident" id="8039193">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="8039211">struct</span>&nbsp;<span class="op" id="8039218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8039221">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8039235">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8039243">litAddrOrName</span>&nbsp;<span class="builtintype" id="8039257">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8039265">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039279">*</span><span class="ident" id="8039280">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8039288">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8039302">error</span><br>
<span class="lineno"></span><span class="op" id="8039308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8039311">var</span>&nbsp;<span class="ident" id="8039315">resolveIPAddrTests</span>&nbsp;<span class="op" id="8039334">=</span>&nbsp;<span class="op" id="8039336">[</span><span class="op" id="8039337">]</span><span class="ident" id="8039338">resolveIPAddrTest</span><span class="op" id="8039355">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039358">{</span><span class="string" id="8039359">&#34;ip&#34;</span><span class="op" id="8039363">,</span>&nbsp;<span class="string" id="8039365">&#34;127.0.0.1&#34;</span><span class="op" id="8039376">,</span>&nbsp;<span class="op" id="8039378">&amp;</span><span class="ident" id="8039379">IPAddr</span><span class="op" id="8039385">{</span><span class="ident" id="8039386">IP</span><span class="op" id="8039388">:</span>&nbsp;<span class="ident" id="8039390">IPv4</span><span class="op" id="8039394">(</span><span class="num" id="8039395">127</span><span class="op" id="8039398">,</span>&nbsp;<span class="num" id="8039400">0</span><span class="op" id="8039401">,</span>&nbsp;<span class="num" id="8039403">0</span><span class="op" id="8039404">,</span>&nbsp;<span class="num" id="8039406">1</span><span class="op" id="8039407">)</span><span class="op" id="8039408">}</span><span class="op" id="8039409">,</span>&nbsp;<span class="ident" id="8039411">nil</span><span class="op" id="8039414">}</span><span class="op" id="8039415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039418">{</span><span class="string" id="8039419">&#34;ip4&#34;</span><span class="op" id="8039424">,</span>&nbsp;<span class="string" id="8039426">&#34;127.0.0.1&#34;</span><span class="op" id="8039437">,</span>&nbsp;<span class="op" id="8039439">&amp;</span><span class="ident" id="8039440">IPAddr</span><span class="op" id="8039446">{</span><span class="ident" id="8039447">IP</span><span class="op" id="8039449">:</span>&nbsp;<span class="ident" id="8039451">IPv4</span><span class="op" id="8039455">(</span><span class="num" id="8039456">127</span><span class="op" id="8039459">,</span>&nbsp;<span class="num" id="8039461">0</span><span class="op" id="8039462">,</span>&nbsp;<span class="num" id="8039464">0</span><span class="op" id="8039465">,</span>&nbsp;<span class="num" id="8039467">1</span><span class="op" id="8039468">)</span><span class="op" id="8039469">}</span><span class="op" id="8039470">,</span>&nbsp;<span class="ident" id="8039472">nil</span><span class="op" id="8039475">}</span><span class="op" id="8039476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039479">{</span><span class="string" id="8039480">&#34;ip4:icmp&#34;</span><span class="op" id="8039490">,</span>&nbsp;<span class="string" id="8039492">&#34;127.0.0.1&#34;</span><span class="op" id="8039503">,</span>&nbsp;<span class="op" id="8039505">&amp;</span><span class="ident" id="8039506">IPAddr</span><span class="op" id="8039512">{</span><span class="ident" id="8039513">IP</span><span class="op" id="8039515">:</span>&nbsp;<span class="ident" id="8039517">IPv4</span><span class="op" id="8039521">(</span><span class="num" id="8039522">127</span><span class="op" id="8039525">,</span>&nbsp;<span class="num" id="8039527">0</span><span class="op" id="8039528">,</span>&nbsp;<span class="num" id="8039530">0</span><span class="op" id="8039531">,</span>&nbsp;<span class="num" id="8039533">1</span><span class="op" id="8039534">)</span><span class="op" id="8039535">}</span><span class="op" id="8039536">,</span>&nbsp;<span class="ident" id="8039538">nil</span><span class="op" id="8039541">}</span><span class="op" id="8039542">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039546">{</span><span class="string" id="8039547">&#34;ip&#34;</span><span class="op" id="8039551">,</span>&nbsp;<span class="string" id="8039553">&#34;::1&#34;</span><span class="op" id="8039558">,</span>&nbsp;<span class="op" id="8039560">&amp;</span><span class="ident" id="8039561">IPAddr</span><span class="op" id="8039567">{</span><span class="ident" id="8039568">IP</span><span class="op" id="8039570">:</span>&nbsp;<span class="ident" id="8039572">ParseIP</span><span class="op" id="8039579">(</span><span class="string" id="8039580">&#34;::1&#34;</span><span class="op" id="8039585">)</span><span class="op" id="8039586">}</span><span class="op" id="8039587">,</span>&nbsp;<span class="ident" id="8039589">nil</span><span class="op" id="8039592">}</span><span class="op" id="8039593">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039596">{</span><span class="string" id="8039597">&#34;ip6&#34;</span><span class="op" id="8039602">,</span>&nbsp;<span class="string" id="8039604">&#34;::1&#34;</span><span class="op" id="8039609">,</span>&nbsp;<span class="op" id="8039611">&amp;</span><span class="ident" id="8039612">IPAddr</span><span class="op" id="8039618">{</span><span class="ident" id="8039619">IP</span><span class="op" id="8039621">:</span>&nbsp;<span class="ident" id="8039623">ParseIP</span><span class="op" id="8039630">(</span><span class="string" id="8039631">&#34;::1&#34;</span><span class="op" id="8039636">)</span><span class="op" id="8039637">}</span><span class="op" id="8039638">,</span>&nbsp;<span class="ident" id="8039640">nil</span><span class="op" id="8039643">}</span><span class="op" id="8039644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039647">{</span><span class="string" id="8039648">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8039663">,</span>&nbsp;<span class="string" id="8039665">&#34;::1&#34;</span><span class="op" id="8039670">,</span>&nbsp;<span class="op" id="8039672">&amp;</span><span class="ident" id="8039673">IPAddr</span><span class="op" id="8039679">{</span><span class="ident" id="8039680">IP</span><span class="op" id="8039682">:</span>&nbsp;<span class="ident" id="8039684">ParseIP</span><span class="op" id="8039691">(</span><span class="string" id="8039692">&#34;::1&#34;</span><span class="op" id="8039697">)</span><span class="op" id="8039698">}</span><span class="op" id="8039699">,</span>&nbsp;<span class="ident" id="8039701">nil</span><span class="op" id="8039704">}</span><span class="op" id="8039705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039708">{</span><span class="string" id="8039709">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="8039724">,</span>&nbsp;<span class="string" id="8039726">&#34;::1&#34;</span><span class="op" id="8039731">,</span>&nbsp;<span class="op" id="8039733">&amp;</span><span class="ident" id="8039734">IPAddr</span><span class="op" id="8039740">{</span><span class="ident" id="8039741">IP</span><span class="op" id="8039743">:</span>&nbsp;<span class="ident" id="8039745">ParseIP</span><span class="op" id="8039752">(</span><span class="string" id="8039753">&#34;::1&#34;</span><span class="op" id="8039758">)</span><span class="op" id="8039759">}</span><span class="op" id="8039760">,</span>&nbsp;<span class="ident" id="8039762">nil</span><span class="op" id="8039765">}</span><span class="op" id="8039766">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039770">{</span><span class="string" id="8039771">&#34;ip&#34;</span><span class="op" id="8039775">,</span>&nbsp;<span class="string" id="8039777">&#34;::1%en0&#34;</span><span class="op" id="8039786">,</span>&nbsp;<span class="op" id="8039788">&amp;</span><span class="ident" id="8039789">IPAddr</span><span class="op" id="8039795">{</span><span class="ident" id="8039796">IP</span><span class="op" id="8039798">:</span>&nbsp;<span class="ident" id="8039800">ParseIP</span><span class="op" id="8039807">(</span><span class="string" id="8039808">&#34;::1&#34;</span><span class="op" id="8039813">)</span><span class="op" id="8039814">,</span>&nbsp;<span class="ident" id="8039816">Zone</span><span class="op" id="8039820">:</span>&nbsp;<span class="string" id="8039822">&#34;en0&#34;</span><span class="op" id="8039827">}</span><span class="op" id="8039828">,</span>&nbsp;<span class="ident" id="8039830">nil</span><span class="op" id="8039833">}</span><span class="op" id="8039834">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039837">{</span><span class="string" id="8039838">&#34;ip6&#34;</span><span class="op" id="8039843">,</span>&nbsp;<span class="string" id="8039845">&#34;::1%911&#34;</span><span class="op" id="8039854">,</span>&nbsp;<span class="op" id="8039856">&amp;</span><span class="ident" id="8039857">IPAddr</span><span class="op" id="8039863">{</span><span class="ident" id="8039864">IP</span><span class="op" id="8039866">:</span>&nbsp;<span class="ident" id="8039868">ParseIP</span><span class="op" id="8039875">(</span><span class="string" id="8039876">&#34;::1&#34;</span><span class="op" id="8039881">)</span><span class="op" id="8039882">,</span>&nbsp;<span class="ident" id="8039884">Zone</span><span class="op" id="8039888">:</span>&nbsp;<span class="string" id="8039890">&#34;911&#34;</span><span class="op" id="8039895">}</span><span class="op" id="8039896">,</span>&nbsp;<span class="ident" id="8039898">nil</span><span class="op" id="8039901">}</span><span class="op" id="8039902">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039906">{</span><span class="string" id="8039907">&#34;&#34;</span><span class="op" id="8039909">,</span>&nbsp;<span class="string" id="8039911">&#34;127.0.0.1&#34;</span><span class="op" id="8039922">,</span>&nbsp;<span class="op" id="8039924">&amp;</span><span class="ident" id="8039925">IPAddr</span><span class="op" id="8039931">{</span><span class="ident" id="8039932">IP</span><span class="op" id="8039934">:</span>&nbsp;<span class="ident" id="8039936">IPv4</span><span class="op" id="8039940">(</span><span class="num" id="8039941">127</span><span class="op" id="8039944">,</span>&nbsp;<span class="num" id="8039946">0</span><span class="op" id="8039947">,</span>&nbsp;<span class="num" id="8039949">0</span><span class="op" id="8039950">,</span>&nbsp;<span class="num" id="8039952">1</span><span class="op" id="8039953">)</span><span class="op" id="8039954">}</span><span class="op" id="8039955">,</span>&nbsp;<span class="ident" id="8039957">nil</span><span class="op" id="8039960">}</span><span class="op" id="8039961">,</span>&nbsp;<span class="comment" id="8039963">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8039983">{</span><span class="string" id="8039984">&#34;&#34;</span><span class="op" id="8039986">,</span>&nbsp;<span class="string" id="8039988">&#34;::1&#34;</span><span class="op" id="8039993">,</span>&nbsp;<span class="op" id="8039995">&amp;</span><span class="ident" id="8039996">IPAddr</span><span class="op" id="8040002">{</span><span class="ident" id="8040003">IP</span><span class="op" id="8040005">:</span>&nbsp;<span class="ident" id="8040007">ParseIP</span><span class="op" id="8040014">(</span><span class="string" id="8040015">&#34;::1&#34;</span><span class="op" id="8040020">)</span><span class="op" id="8040021">}</span><span class="op" id="8040022">,</span>&nbsp;<span class="ident" id="8040024">nil</span><span class="op" id="8040027">}</span><span class="op" id="8040028">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8040040">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040061">{</span><span class="string" id="8040062">&#34;l2tp&#34;</span><span class="op" id="8040068">,</span>&nbsp;<span class="string" id="8040070">&#34;127.0.0.1&#34;</span><span class="op" id="8040081">,</span>&nbsp;<span class="ident" id="8040083">nil</span><span class="op" id="8040086">,</span>&nbsp;<span class="ident" id="8040088">UnknownNetworkError</span><span class="op" id="8040107">(</span><span class="string" id="8040108">&#34;l2tp&#34;</span><span class="op" id="8040114">)</span><span class="op" id="8040115">}</span><span class="op" id="8040116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040119">{</span><span class="string" id="8040120">&#34;l2tp:gre&#34;</span><span class="op" id="8040130">,</span>&nbsp;<span class="string" id="8040132">&#34;127.0.0.1&#34;</span><span class="op" id="8040143">,</span>&nbsp;<span class="ident" id="8040145">nil</span><span class="op" id="8040148">,</span>&nbsp;<span class="ident" id="8040150">UnknownNetworkError</span><span class="op" id="8040169">(</span><span class="string" id="8040170">&#34;l2tp:gre&#34;</span><span class="op" id="8040180">)</span><span class="op" id="8040181">}</span><span class="op" id="8040182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040185">{</span><span class="string" id="8040186">&#34;tcp&#34;</span><span class="op" id="8040191">,</span>&nbsp;<span class="string" id="8040193">&#34;1.2.3.4:123&#34;</span><span class="op" id="8040206">,</span>&nbsp;<span class="ident" id="8040208">nil</span><span class="op" id="8040211">,</span>&nbsp;<span class="ident" id="8040213">UnknownNetworkError</span><span class="op" id="8040232">(</span><span class="string" id="8040233">&#34;tcp&#34;</span><span class="op" id="8040238">)</span><span class="op" id="8040239">}</span><span class="op" id="8040240">,</span><br>
<span class="lineno"></span><span class="op" id="8040242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8040245">func</span>&nbsp;<span class="ident" id="8040250">init</span><span class="op" id="8040254">(</span><span class="op" id="8040255">)</span>&nbsp;<span class="op" id="8040257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8040260">if</span>&nbsp;<span class="ident" id="8040263">ifi</span>&nbsp;<span class="op" id="8040267">:=</span>&nbsp;<span class="ident" id="8040270">loopbackInterface</span><span class="op" id="8040287">(</span><span class="op" id="8040288">)</span><span class="op" id="8040289">;</span>&nbsp;<span class="ident" id="8040291">ifi</span>&nbsp;<span class="op" id="8040295">!=</span>&nbsp;<span class="ident" id="8040298">nil</span>&nbsp;<span class="op" id="8040302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8040306">index</span>&nbsp;<span class="op" id="8040312">:=</span>&nbsp;<span class="ident" id="8040315">fmt</span><span class="op" id="8040318">.</span><span class="ident" id="8040319">Sprintf</span><span class="op" id="8040326">(</span><span class="string" id="8040327">&#34;%v&#34;</span><span class="op" id="8040331">,</span>&nbsp;<span class="ident" id="8040333">ifi</span><span class="op" id="8040336">.</span><span class="ident" id="8040337">Index</span><span class="op" id="8040342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8040346">resolveIPAddrTests</span>&nbsp;<span class="op" id="8040365">=</span>&nbsp;<span class="builtinfunc" id="8040367">append</span><span class="op" id="8040373">(</span><span class="ident" id="8040374">resolveIPAddrTests</span><span class="op" id="8040392">,</span>&nbsp;<span class="op" id="8040394">[</span><span class="op" id="8040395">]</span><span class="ident" id="8040396">resolveIPAddrTest</span><span class="op" id="8040413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040418">{</span><span class="string" id="8040419">&#34;ip6&#34;</span><span class="op" id="8040424">,</span>&nbsp;<span class="string" id="8040426">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8040437">+</span>&nbsp;<span class="ident" id="8040439">ifi</span><span class="op" id="8040442">.</span><span class="ident" id="8040443">Name</span><span class="op" id="8040447">,</span>&nbsp;<span class="op" id="8040449">&amp;</span><span class="ident" id="8040450">IPAddr</span><span class="op" id="8040456">{</span><span class="ident" id="8040457">IP</span><span class="op" id="8040459">:</span>&nbsp;<span class="ident" id="8040461">ParseIP</span><span class="op" id="8040468">(</span><span class="string" id="8040469">&#34;fe80::1&#34;</span><span class="op" id="8040478">)</span><span class="op" id="8040479">,</span>&nbsp;<span class="ident" id="8040481">Zone</span><span class="op" id="8040485">:</span>&nbsp;<span class="ident" id="8040487">zoneToString</span><span class="op" id="8040499">(</span><span class="ident" id="8040500">ifi</span><span class="op" id="8040503">.</span><span class="ident" id="8040504">Index</span><span class="op" id="8040509">)</span><span class="op" id="8040510">}</span><span class="op" id="8040511">,</span>&nbsp;<span class="ident" id="8040513">nil</span><span class="op" id="8040516">}</span><span class="op" id="8040517">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040522">{</span><span class="string" id="8040523">&#34;ip6&#34;</span><span class="op" id="8040528">,</span>&nbsp;<span class="string" id="8040530">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8040541">+</span>&nbsp;<span class="ident" id="8040543">index</span><span class="op" id="8040548">,</span>&nbsp;<span class="op" id="8040550">&amp;</span><span class="ident" id="8040551">IPAddr</span><span class="op" id="8040557">{</span><span class="ident" id="8040558">IP</span><span class="op" id="8040560">:</span>&nbsp;<span class="ident" id="8040562">ParseIP</span><span class="op" id="8040569">(</span><span class="string" id="8040570">&#34;fe80::1&#34;</span><span class="op" id="8040579">)</span><span class="op" id="8040580">,</span>&nbsp;<span class="ident" id="8040582">Zone</span><span class="op" id="8040586">:</span>&nbsp;<span class="ident" id="8040588">index</span><span class="op" id="8040593">}</span><span class="op" id="8040594">,</span>&nbsp;<span class="ident" id="8040596">nil</span><span class="op" id="8040599">}</span><span class="op" id="8040600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040604">}</span><span class="op" id="8040605">...</span><span class="op" id="8040608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8040614">if</span>&nbsp;<span class="ident" id="8040617">ips</span><span class="op" id="8040620">,</span>&nbsp;<span class="ident" id="8040622">err</span>&nbsp;<span class="op" id="8040626">:=</span>&nbsp;<span class="ident" id="8040629">LookupIP</span><span class="op" id="8040637">(</span><span class="string" id="8040638">&#34;localhost&#34;</span><span class="op" id="8040649">)</span><span class="op" id="8040650">;</span>&nbsp;<span class="ident" id="8040652">err</span>&nbsp;<span class="op" id="8040656">==</span>&nbsp;<span class="ident" id="8040659">nil</span>&nbsp;<span class="op" id="8040663">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8040666">len</span><span class="op" id="8040669">(</span><span class="ident" id="8040670">ips</span><span class="op" id="8040673">)</span>&nbsp;<span class="op" id="8040675">&gt;</span>&nbsp;<span class="num" id="8040677">1</span>&nbsp;<span class="op" id="8040679">&amp;&amp;</span>&nbsp;<span class="ident" id="8040682">supportsIPv4</span>&nbsp;<span class="op" id="8040695">&amp;&amp;</span>&nbsp;<span class="ident" id="8040698">supportsIPv6</span>&nbsp;<span class="op" id="8040711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8040715">resolveIPAddrTests</span>&nbsp;<span class="op" id="8040734">=</span>&nbsp;<span class="builtinfunc" id="8040736">append</span><span class="op" id="8040742">(</span><span class="ident" id="8040743">resolveIPAddrTests</span><span class="op" id="8040761">,</span>&nbsp;<span class="op" id="8040763">[</span><span class="op" id="8040764">]</span><span class="ident" id="8040765">resolveIPAddrTest</span><span class="op" id="8040782">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040787">{</span><span class="string" id="8040788">&#34;ip&#34;</span><span class="op" id="8040792">,</span>&nbsp;<span class="string" id="8040794">&#34;localhost&#34;</span><span class="op" id="8040805">,</span>&nbsp;<span class="op" id="8040807">&amp;</span><span class="ident" id="8040808">IPAddr</span><span class="op" id="8040814">{</span><span class="ident" id="8040815">IP</span><span class="op" id="8040817">:</span>&nbsp;<span class="ident" id="8040819">IPv4</span><span class="op" id="8040823">(</span><span class="num" id="8040824">127</span><span class="op" id="8040827">,</span>&nbsp;<span class="num" id="8040829">0</span><span class="op" id="8040830">,</span>&nbsp;<span class="num" id="8040832">0</span><span class="op" id="8040833">,</span>&nbsp;<span class="num" id="8040835">1</span><span class="op" id="8040836">)</span><span class="op" id="8040837">}</span><span class="op" id="8040838">,</span>&nbsp;<span class="ident" id="8040840">nil</span><span class="op" id="8040843">}</span><span class="op" id="8040844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040849">{</span><span class="string" id="8040850">&#34;ip4&#34;</span><span class="op" id="8040855">,</span>&nbsp;<span class="string" id="8040857">&#34;localhost&#34;</span><span class="op" id="8040868">,</span>&nbsp;<span class="op" id="8040870">&amp;</span><span class="ident" id="8040871">IPAddr</span><span class="op" id="8040877">{</span><span class="ident" id="8040878">IP</span><span class="op" id="8040880">:</span>&nbsp;<span class="ident" id="8040882">IPv4</span><span class="op" id="8040886">(</span><span class="num" id="8040887">127</span><span class="op" id="8040890">,</span>&nbsp;<span class="num" id="8040892">0</span><span class="op" id="8040893">,</span>&nbsp;<span class="num" id="8040895">0</span><span class="op" id="8040896">,</span>&nbsp;<span class="num" id="8040898">1</span><span class="op" id="8040899">)</span><span class="op" id="8040900">}</span><span class="op" id="8040901">,</span>&nbsp;<span class="ident" id="8040903">nil</span><span class="op" id="8040906">}</span><span class="op" id="8040907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040912">{</span><span class="string" id="8040913">&#34;ip6&#34;</span><span class="op" id="8040918">,</span>&nbsp;<span class="string" id="8040920">&#34;localhost&#34;</span><span class="op" id="8040931">,</span>&nbsp;<span class="op" id="8040933">&amp;</span><span class="ident" id="8040934">IPAddr</span><span class="op" id="8040940">{</span><span class="ident" id="8040941">IP</span><span class="op" id="8040943">:</span>&nbsp;<span class="ident" id="8040945">IPv6loopback</span><span class="op" id="8040957">}</span><span class="op" id="8040958">,</span>&nbsp;<span class="ident" id="8040960">nil</span><span class="op" id="8040963">}</span><span class="op" id="8040964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040968">}</span><span class="op" id="8040969">...</span><span class="op" id="8040972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8040975">}</span><br>
<span class="lineno">60</span><span class="op" id="8040977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8040980">func</span>&nbsp;<span class="ident" id="8040985">skipRawSocketTest</span><span class="op" id="8041002">(</span><span class="ident" id="8041003">t</span>&nbsp;<span class="op" id="8041005">*</span><span class="ident" id="8041006">testing</span><span class="op" id="8041013">.</span><span class="ident" id="8041014">T</span><span class="op" id="8041015">)</span>&nbsp;<span class="op" id="8041017">(</span><span class="ident" id="8041018">skip</span>&nbsp;<span class="builtintype" id="8041023">bool</span><span class="op" id="8041027">,</span>&nbsp;<span class="ident" id="8041029">skipmsg</span>&nbsp;<span class="builtintype" id="8041037">string</span><span class="op" id="8041043">)</span>&nbsp;<span class="op" id="8041045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041048">skip</span><span class="op" id="8041052">,</span>&nbsp;<span class="ident" id="8041054">skipmsg</span><span class="op" id="8041061">,</span>&nbsp;<span class="ident" id="8041063">err</span>&nbsp;<span class="op" id="8041067">:=</span>&nbsp;<span class="ident" id="8041070">skipRawSocketTests</span><span class="op" id="8041088">(</span><span class="op" id="8041089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041092">if</span>&nbsp;<span class="ident" id="8041095">err</span>&nbsp;<span class="op" id="8041099">!=</span>&nbsp;<span class="ident" id="8041102">nil</span>&nbsp;<span class="op" id="8041106">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041110">t</span><span class="op" id="8041111">.</span><span class="ident" id="8041112">Fatal</span><span class="op" id="8041117">(</span><span class="ident" id="8041118">err</span><span class="op" id="8041121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041127">return</span>&nbsp;<span class="ident" id="8041134">skip</span><span class="op" id="8041138">,</span>&nbsp;<span class="ident" id="8041140">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="8041148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8041151">func</span>&nbsp;<span class="ident" id="8041156">TestResolveIPAddr</span><span class="op" id="8041173">(</span><span class="ident" id="8041174">t</span>&nbsp;<span class="op" id="8041176">*</span><span class="ident" id="8041177">testing</span><span class="op" id="8041184">.</span><span class="ident" id="8041185">T</span><span class="op" id="8041186">)</span>&nbsp;<span class="op" id="8041188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041191">switch</span>&nbsp;<span class="ident" id="8041198">runtime</span><span class="op" id="8041205">.</span><span class="ident" id="8041206">GOOS</span>&nbsp;<span class="op" id="8041211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041214">case</span>&nbsp;<span class="string" id="8041219">&#34;nacl&#34;</span><span class="op" id="8041225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041229">t</span><span class="op" id="8041230">.</span><span class="ident" id="8041231">Skipf</span><span class="op" id="8041236">(</span><span class="string" id="8041237">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8041258">,</span>&nbsp;<span class="ident" id="8041260">runtime</span><span class="op" id="8041267">.</span><span class="ident" id="8041268">GOOS</span><span class="op" id="8041272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041275">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041279">for</span>&nbsp;<span class="ident" id="8041283">_</span><span class="op" id="8041284">,</span>&nbsp;<span class="ident" id="8041286">tt</span>&nbsp;<span class="op" id="8041289">:=</span>&nbsp;<span class="keyword" id="8041292">range</span>&nbsp;<span class="ident" id="8041298">resolveIPAddrTests</span>&nbsp;<span class="op" id="8041317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041321">addr</span><span class="op" id="8041325">,</span>&nbsp;<span class="ident" id="8041327">err</span>&nbsp;<span class="op" id="8041331">:=</span>&nbsp;<span class="ident" id="8041334">ResolveIPAddr</span><span class="op" id="8041347">(</span><span class="ident" id="8041348">tt</span><span class="op" id="8041350">.</span><span class="ident" id="8041351">net</span><span class="op" id="8041354">,</span>&nbsp;<span class="ident" id="8041356">tt</span><span class="op" id="8041358">.</span><span class="ident" id="8041359">litAddrOrName</span><span class="op" id="8041372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041376">if</span>&nbsp;<span class="ident" id="8041379">err</span>&nbsp;<span class="op" id="8041383">!=</span>&nbsp;<span class="ident" id="8041386">tt</span><span class="op" id="8041388">.</span><span class="ident" id="8041389">err</span>&nbsp;<span class="op" id="8041393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041398">t</span><span class="op" id="8041399">.</span><span class="ident" id="8041400">Fatalf</span><span class="op" id="8041406">(</span><span class="string" id="8041407">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8041441">,</span>&nbsp;<span class="ident" id="8041443">tt</span><span class="op" id="8041445">.</span><span class="ident" id="8041446">net</span><span class="op" id="8041449">,</span>&nbsp;<span class="ident" id="8041451">tt</span><span class="op" id="8041453">.</span><span class="ident" id="8041454">litAddrOrName</span><span class="op" id="8041467">,</span>&nbsp;<span class="ident" id="8041469">err</span><span class="op" id="8041472">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041476">}</span>&nbsp;<span class="keyword" id="8041478">else</span>&nbsp;<span class="keyword" id="8041483">if</span>&nbsp;<span class="op" id="8041486">!</span><span class="ident" id="8041487">reflect</span><span class="op" id="8041494">.</span><span class="ident" id="8041495">DeepEqual</span><span class="op" id="8041504">(</span><span class="ident" id="8041505">addr</span><span class="op" id="8041509">,</span>&nbsp;<span class="ident" id="8041511">tt</span><span class="op" id="8041513">.</span><span class="ident" id="8041514">addr</span><span class="op" id="8041518">)</span>&nbsp;<span class="op" id="8041520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041525">t</span><span class="op" id="8041526">.</span><span class="ident" id="8041527">Fatalf</span><span class="op" id="8041533">(</span><span class="string" id="8041534">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8041557">,</span>&nbsp;<span class="ident" id="8041559">addr</span><span class="op" id="8041563">,</span>&nbsp;<span class="ident" id="8041565">tt</span><span class="op" id="8041567">.</span><span class="ident" id="8041568">addr</span><span class="op" id="8041572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041579">}</span><br>
<span class="lineno"></span><span class="op" id="8041581">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8041584">var</span>&nbsp;<span class="ident" id="8041588">icmpEchoTests</span>&nbsp;<span class="op" id="8041602">=</span>&nbsp;<span class="op" id="8041604">[</span><span class="op" id="8041605">]</span><span class="keyword" id="8041606">struct</span>&nbsp;<span class="op" id="8041613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041616">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8041622">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041630">laddr</span>&nbsp;<span class="builtintype" id="8041636">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041644">raddr</span>&nbsp;<span class="builtintype" id="8041650">string</span><br>
<span class="lineno">90</span><span class="op" id="8041657">}</span><span class="op" id="8041658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041661">{</span><span class="string" id="8041662">&#34;ip4:icmp&#34;</span><span class="op" id="8041672">,</span>&nbsp;<span class="string" id="8041674">&#34;0.0.0.0&#34;</span><span class="op" id="8041683">,</span>&nbsp;<span class="string" id="8041685">&#34;127.0.0.1&#34;</span><span class="op" id="8041696">}</span><span class="op" id="8041697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041700">{</span><span class="string" id="8041701">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8041716">,</span>&nbsp;<span class="string" id="8041718">&#34;::&#34;</span><span class="op" id="8041722">,</span>&nbsp;<span class="string" id="8041724">&#34;::1&#34;</span><span class="op" id="8041729">}</span><span class="op" id="8041730">,</span><br>
<span class="lineno"></span><span class="op" id="8041732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8041735">func</span>&nbsp;<span class="ident" id="8041740">TestConnICMPEcho</span><span class="op" id="8041756">(</span><span class="ident" id="8041757">t</span>&nbsp;<span class="op" id="8041759">*</span><span class="ident" id="8041760">testing</span><span class="op" id="8041767">.</span><span class="ident" id="8041768">T</span><span class="op" id="8041769">)</span>&nbsp;<span class="op" id="8041771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041774">if</span>&nbsp;<span class="ident" id="8041777">skip</span><span class="op" id="8041781">,</span>&nbsp;<span class="ident" id="8041783">skipmsg</span>&nbsp;<span class="op" id="8041791">:=</span>&nbsp;<span class="ident" id="8041794">skipRawSocketTest</span><span class="op" id="8041811">(</span><span class="ident" id="8041812">t</span><span class="op" id="8041813">)</span><span class="op" id="8041814">;</span>&nbsp;<span class="ident" id="8041816">skip</span>&nbsp;<span class="op" id="8041821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041825">t</span><span class="op" id="8041826">.</span><span class="ident" id="8041827">Skip</span><span class="op" id="8041831">(</span><span class="ident" id="8041832">skipmsg</span><span class="op" id="8041839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041846">for</span>&nbsp;<span class="ident" id="8041850">i</span><span class="op" id="8041851">,</span>&nbsp;<span class="ident" id="8041853">tt</span>&nbsp;<span class="op" id="8041856">:=</span>&nbsp;<span class="keyword" id="8041859">range</span>&nbsp;<span class="ident" id="8041865">icmpEchoTests</span>&nbsp;<span class="op" id="8041879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041883">net</span><span class="op" id="8041886">,</span>&nbsp;<span class="ident" id="8041888">_</span><span class="op" id="8041889">,</span>&nbsp;<span class="ident" id="8041891">err</span>&nbsp;<span class="op" id="8041895">:=</span>&nbsp;<span class="ident" id="8041898">parseNetwork</span><span class="op" id="8041910">(</span><span class="ident" id="8041911">tt</span><span class="op" id="8041913">.</span><span class="ident" id="8041914">net</span><span class="op" id="8041917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041921">if</span>&nbsp;<span class="ident" id="8041924">err</span>&nbsp;<span class="op" id="8041928">!=</span>&nbsp;<span class="ident" id="8041931">nil</span>&nbsp;<span class="op" id="8041935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8041940">t</span><span class="op" id="8041941">.</span><span class="ident" id="8041942">Fatalf</span><span class="op" id="8041948">(</span><span class="string" id="8041949">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8041974">,</span>&nbsp;<span class="ident" id="8041976">err</span><span class="op" id="8041979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8041983">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8041987">if</span>&nbsp;<span class="ident" id="8041990">net</span>&nbsp;<span class="op" id="8041994">==</span>&nbsp;<span class="string" id="8041997">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8042003">&amp;&amp;</span>&nbsp;<span class="op" id="8042006">!</span><span class="ident" id="8042007">supportsIPv6</span>&nbsp;<span class="op" id="8042020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042025">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042041">c</span><span class="op" id="8042042">,</span>&nbsp;<span class="ident" id="8042044">err</span>&nbsp;<span class="op" id="8042048">:=</span>&nbsp;<span class="ident" id="8042051">Dial</span><span class="op" id="8042055">(</span><span class="ident" id="8042056">tt</span><span class="op" id="8042058">.</span><span class="ident" id="8042059">net</span><span class="op" id="8042062">,</span>&nbsp;<span class="ident" id="8042064">tt</span><span class="op" id="8042066">.</span><span class="ident" id="8042067">raddr</span><span class="op" id="8042072">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042076">if</span>&nbsp;<span class="ident" id="8042079">err</span>&nbsp;<span class="op" id="8042083">!=</span>&nbsp;<span class="ident" id="8042086">nil</span>&nbsp;<span class="op" id="8042090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042095">t</span><span class="op" id="8042096">.</span><span class="ident" id="8042097">Fatalf</span><span class="op" id="8042103">(</span><span class="string" id="8042104">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8042121">,</span>&nbsp;<span class="ident" id="8042123">err</span><span class="op" id="8042126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042134">c</span><span class="op" id="8042135">.</span><span class="ident" id="8042136">SetDeadline</span><span class="op" id="8042147">(</span><span class="ident" id="8042148">time</span><span class="op" id="8042152">.</span><span class="ident" id="8042153">Now</span><span class="op" id="8042156">(</span><span class="op" id="8042157">)</span><span class="op" id="8042158">.</span><span class="ident" id="8042159">Add</span><span class="op" id="8042162">(</span><span class="num" id="8042163">100</span>&nbsp;<span class="op" id="8042167">*</span>&nbsp;<span class="ident" id="8042169">time</span><span class="op" id="8042173">.</span><span class="ident" id="8042174">Millisecond</span><span class="op" id="8042185">)</span><span class="op" id="8042186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042190">defer</span>&nbsp;<span class="ident" id="8042196">c</span><span class="op" id="8042197">.</span><span class="ident" id="8042198">Close</span><span class="op" id="8042203">(</span><span class="op" id="8042204">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042209">typ</span>&nbsp;<span class="op" id="8042213">:=</span>&nbsp;<span class="ident" id="8042216">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042236">if</span>&nbsp;<span class="ident" id="8042239">net</span>&nbsp;<span class="op" id="8042243">==</span>&nbsp;<span class="string" id="8042246">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8042252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042257">typ</span>&nbsp;<span class="op" id="8042261">=</span>&nbsp;<span class="ident" id="8042263">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042283">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042287">xid</span><span class="op" id="8042290">,</span>&nbsp;<span class="ident" id="8042292">xseq</span>&nbsp;<span class="op" id="8042297">:=</span>&nbsp;<span class="ident" id="8042300">os</span><span class="op" id="8042302">.</span><span class="ident" id="8042303">Getpid</span><span class="op" id="8042309">(</span><span class="op" id="8042310">)</span><span class="op" id="8042311">&amp;</span><span class="num" id="8042312">0xffff</span><span class="op" id="8042318">,</span>&nbsp;<span class="ident" id="8042320">i</span><span class="op" id="8042321">+</span><span class="num" id="8042322">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042326">wb</span><span class="op" id="8042328">,</span>&nbsp;<span class="ident" id="8042330">err</span>&nbsp;<span class="op" id="8042334">:=</span>&nbsp;<span class="op" id="8042337">(</span><span class="op" id="8042338">&amp;</span><span class="ident" id="8042339">icmpMessage</span><span class="op" id="8042350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042355">Type</span><span class="op" id="8042359">:</span>&nbsp;<span class="ident" id="8042361">typ</span><span class="op" id="8042364">,</span>&nbsp;<span class="ident" id="8042366">Code</span><span class="op" id="8042370">:</span>&nbsp;<span class="num" id="8042372">0</span><span class="op" id="8042373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042378">Body</span><span class="op" id="8042382">:</span>&nbsp;<span class="op" id="8042384">&amp;</span><span class="ident" id="8042385">icmpEcho</span><span class="op" id="8042393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042399">ID</span><span class="op" id="8042401">:</span>&nbsp;<span class="ident" id="8042403">xid</span><span class="op" id="8042406">,</span>&nbsp;<span class="ident" id="8042408">Seq</span><span class="op" id="8042411">:</span>&nbsp;<span class="ident" id="8042413">xseq</span><span class="op" id="8042417">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042423">Data</span><span class="op" id="8042427">:</span>&nbsp;<span class="ident" id="8042429">bytes</span><span class="op" id="8042434">.</span><span class="ident" id="8042435">Repeat</span><span class="op" id="8042441">(</span><span class="op" id="8042442">[</span><span class="op" id="8042443">]</span><span class="builtintype" id="8042444">byte</span><span class="op" id="8042448">(</span><span class="string" id="8042449">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8042471">)</span><span class="op" id="8042472">,</span>&nbsp;<span class="num" id="8042474">3</span><span class="op" id="8042475">)</span><span class="op" id="8042476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042481">}</span><span class="op" id="8042482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042486">}</span><span class="op" id="8042487">)</span><span class="op" id="8042488">.</span><span class="ident" id="8042489">Marshal</span><span class="op" id="8042496">(</span><span class="op" id="8042497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042501">if</span>&nbsp;<span class="ident" id="8042504">err</span>&nbsp;<span class="op" id="8042508">!=</span>&nbsp;<span class="ident" id="8042511">nil</span>&nbsp;<span class="op" id="8042515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042520">t</span><span class="op" id="8042521">.</span><span class="ident" id="8042522">Fatalf</span><span class="op" id="8042528">(</span><span class="string" id="8042529">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8042561">,</span>&nbsp;<span class="ident" id="8042563">err</span><span class="op" id="8042566">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042574">if</span>&nbsp;<span class="ident" id="8042577">_</span><span class="op" id="8042578">,</span>&nbsp;<span class="ident" id="8042580">err</span>&nbsp;<span class="op" id="8042584">:=</span>&nbsp;<span class="ident" id="8042587">c</span><span class="op" id="8042588">.</span><span class="ident" id="8042589">Write</span><span class="op" id="8042594">(</span><span class="ident" id="8042595">wb</span><span class="op" id="8042597">)</span><span class="op" id="8042598">;</span>&nbsp;<span class="ident" id="8042600">err</span>&nbsp;<span class="op" id="8042604">!=</span>&nbsp;<span class="ident" id="8042607">nil</span>&nbsp;<span class="op" id="8042611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042616">t</span><span class="op" id="8042617">.</span><span class="ident" id="8042618">Fatalf</span><span class="op" id="8042624">(</span><span class="string" id="8042625">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8042648">,</span>&nbsp;<span class="ident" id="8042650">err</span><span class="op" id="8042653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042661">var</span>&nbsp;<span class="ident" id="8042665">m</span>&nbsp;<span class="op" id="8042667">*</span><span class="ident" id="8042668">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042682">rb</span>&nbsp;<span class="op" id="8042685">:=</span>&nbsp;<span class="builtinfunc" id="8042688">make</span><span class="op" id="8042692">(</span><span class="op" id="8042693">[</span><span class="op" id="8042694">]</span><span class="builtintype" id="8042695">byte</span><span class="op" id="8042699">,</span>&nbsp;<span class="num" id="8042701">20</span><span class="op" id="8042703">+</span><span class="builtinfunc" id="8042704">len</span><span class="op" id="8042707">(</span><span class="ident" id="8042708">wb</span><span class="op" id="8042710">)</span><span class="op" id="8042711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042715">for</span>&nbsp;<span class="op" id="8042719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042724">if</span>&nbsp;<span class="ident" id="8042727">_</span><span class="op" id="8042728">,</span>&nbsp;<span class="ident" id="8042730">err</span>&nbsp;<span class="op" id="8042734">:=</span>&nbsp;<span class="ident" id="8042737">c</span><span class="op" id="8042738">.</span><span class="ident" id="8042739">Read</span><span class="op" id="8042743">(</span><span class="ident" id="8042744">rb</span><span class="op" id="8042746">)</span><span class="op" id="8042747">;</span>&nbsp;<span class="ident" id="8042749">err</span>&nbsp;<span class="op" id="8042753">!=</span>&nbsp;<span class="ident" id="8042756">nil</span>&nbsp;<span class="op" id="8042760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042766">t</span><span class="op" id="8042767">.</span><span class="ident" id="8042768">Fatalf</span><span class="op" id="8042774">(</span><span class="string" id="8042775">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8042797">,</span>&nbsp;<span class="ident" id="8042799">err</span><span class="op" id="8042802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042807">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042812">if</span>&nbsp;<span class="ident" id="8042815">net</span>&nbsp;<span class="op" id="8042819">==</span>&nbsp;<span class="string" id="8042822">&#34;ip4&#34;</span>&nbsp;<span class="op" id="8042828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042834">rb</span>&nbsp;<span class="op" id="8042837">=</span>&nbsp;<span class="ident" id="8042839">ipv4Payload</span><span class="op" id="8042850">(</span><span class="ident" id="8042851">rb</span><span class="op" id="8042853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042863">if</span>&nbsp;<span class="ident" id="8042866">m</span><span class="op" id="8042867">,</span>&nbsp;<span class="ident" id="8042869">err</span>&nbsp;<span class="op" id="8042873">=</span>&nbsp;<span class="ident" id="8042875">parseICMPMessage</span><span class="op" id="8042891">(</span><span class="ident" id="8042892">rb</span><span class="op" id="8042894">)</span><span class="op" id="8042895">;</span>&nbsp;<span class="ident" id="8042897">err</span>&nbsp;<span class="op" id="8042901">!=</span>&nbsp;<span class="ident" id="8042904">nil</span>&nbsp;<span class="op" id="8042908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8042914">t</span><span class="op" id="8042915">.</span><span class="ident" id="8042916">Fatalf</span><span class="op" id="8042922">(</span><span class="string" id="8042923">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8042952">,</span>&nbsp;<span class="ident" id="8042954">err</span><span class="op" id="8042957">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8042962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042967">switch</span>&nbsp;<span class="ident" id="8042974">m</span><span class="op" id="8042975">.</span><span class="ident" id="8042976">Type</span>&nbsp;<span class="op" id="8042981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8042986">case</span>&nbsp;<span class="ident" id="8042991">icmpv4EchoRequest</span><span class="op" id="8043008">,</span>&nbsp;<span class="ident" id="8043010">icmpv6EchoRequest</span><span class="op" id="8043027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043045">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043050">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043062">switch</span>&nbsp;<span class="ident" id="8043069">p</span>&nbsp;<span class="op" id="8043071">:=</span>&nbsp;<span class="ident" id="8043074">m</span><span class="op" id="8043075">.</span><span class="ident" id="8043076">Body</span><span class="op" id="8043080">.</span><span class="op" id="8043081">(</span><span class="keyword" id="8043082">type</span><span class="op" id="8043086">)</span>&nbsp;<span class="op" id="8043088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043092">case</span>&nbsp;<span class="op" id="8043097">*</span><span class="ident" id="8043098">icmpEcho</span><span class="op" id="8043106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043111">if</span>&nbsp;<span class="ident" id="8043114">p</span><span class="op" id="8043115">.</span><span class="ident" id="8043116">ID</span>&nbsp;<span class="op" id="8043119">!=</span>&nbsp;<span class="ident" id="8043122">xid</span>&nbsp;<span class="op" id="8043126">||</span>&nbsp;<span class="ident" id="8043129">p</span><span class="op" id="8043130">.</span><span class="ident" id="8043131">Seq</span>&nbsp;<span class="op" id="8043135">!=</span>&nbsp;<span class="ident" id="8043138">xseq</span>&nbsp;<span class="op" id="8043143">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043149">t</span><span class="op" id="8043150">.</span><span class="ident" id="8043151">Fatalf</span><span class="op" id="8043157">(</span><span class="string" id="8043158">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8043207">,</span>&nbsp;<span class="ident" id="8043209">p</span><span class="op" id="8043210">.</span><span class="ident" id="8043211">ID</span><span class="op" id="8043213">,</span>&nbsp;<span class="ident" id="8043215">p</span><span class="op" id="8043216">.</span><span class="ident" id="8043217">Seq</span><span class="op" id="8043220">,</span>&nbsp;<span class="ident" id="8043222">xid</span><span class="op" id="8043225">,</span>&nbsp;<span class="ident" id="8043227">xseq</span><span class="op" id="8043231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043240">default</span><span class="op" id="8043247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043252">t</span><span class="op" id="8043253">.</span><span class="ident" id="8043254">Fatalf</span><span class="op" id="8043260">(</span><span class="string" id="8043261">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8043310">,</span>&nbsp;<span class="ident" id="8043312">m</span><span class="op" id="8043313">.</span><span class="ident" id="8043314">Type</span><span class="op" id="8043318">,</span>&nbsp;<span class="ident" id="8043320">m</span><span class="op" id="8043321">.</span><span class="ident" id="8043322">Code</span><span class="op" id="8043326">,</span>&nbsp;<span class="ident" id="8043328">typ</span><span class="op" id="8043331">,</span>&nbsp;<span class="num" id="8043333">0</span><span class="op" id="8043334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043338">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043341">}</span><br>
<span class="lineno"></span><span class="op" id="8043343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8043346">func</span>&nbsp;<span class="ident" id="8043351">TestPacketConnICMPEcho</span><span class="op" id="8043373">(</span><span class="ident" id="8043374">t</span>&nbsp;<span class="op" id="8043376">*</span><span class="ident" id="8043377">testing</span><span class="op" id="8043384">.</span><span class="ident" id="8043385">T</span><span class="op" id="8043386">)</span>&nbsp;<span class="op" id="8043388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043391">if</span>&nbsp;<span class="ident" id="8043394">skip</span><span class="op" id="8043398">,</span>&nbsp;<span class="ident" id="8043400">skipmsg</span>&nbsp;<span class="op" id="8043408">:=</span>&nbsp;<span class="ident" id="8043411">skipRawSocketTest</span><span class="op" id="8043428">(</span><span class="ident" id="8043429">t</span><span class="op" id="8043430">)</span><span class="op" id="8043431">;</span>&nbsp;<span class="ident" id="8043433">skip</span>&nbsp;<span class="op" id="8043438">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043442">t</span><span class="op" id="8043443">.</span><span class="ident" id="8043444">Skip</span><span class="op" id="8043448">(</span><span class="ident" id="8043449">skipmsg</span><span class="op" id="8043456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043463">for</span>&nbsp;<span class="ident" id="8043467">i</span><span class="op" id="8043468">,</span>&nbsp;<span class="ident" id="8043470">tt</span>&nbsp;<span class="op" id="8043473">:=</span>&nbsp;<span class="keyword" id="8043476">range</span>&nbsp;<span class="ident" id="8043482">icmpEchoTests</span>&nbsp;<span class="op" id="8043496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043500">net</span><span class="op" id="8043503">,</span>&nbsp;<span class="ident" id="8043505">_</span><span class="op" id="8043506">,</span>&nbsp;<span class="ident" id="8043508">err</span>&nbsp;<span class="op" id="8043512">:=</span>&nbsp;<span class="ident" id="8043515">parseNetwork</span><span class="op" id="8043527">(</span><span class="ident" id="8043528">tt</span><span class="op" id="8043530">.</span><span class="ident" id="8043531">net</span><span class="op" id="8043534">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043538">if</span>&nbsp;<span class="ident" id="8043541">err</span>&nbsp;<span class="op" id="8043545">!=</span>&nbsp;<span class="ident" id="8043548">nil</span>&nbsp;<span class="op" id="8043552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043557">t</span><span class="op" id="8043558">.</span><span class="ident" id="8043559">Fatalf</span><span class="op" id="8043565">(</span><span class="string" id="8043566">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8043591">,</span>&nbsp;<span class="ident" id="8043593">err</span><span class="op" id="8043596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043604">if</span>&nbsp;<span class="ident" id="8043607">net</span>&nbsp;<span class="op" id="8043611">==</span>&nbsp;<span class="string" id="8043614">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8043620">&amp;&amp;</span>&nbsp;<span class="op" id="8043623">!</span><span class="ident" id="8043624">supportsIPv6</span>&nbsp;<span class="op" id="8043637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043642">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043658">c</span><span class="op" id="8043659">,</span>&nbsp;<span class="ident" id="8043661">err</span>&nbsp;<span class="op" id="8043665">:=</span>&nbsp;<span class="ident" id="8043668">ListenPacket</span><span class="op" id="8043680">(</span><span class="ident" id="8043681">tt</span><span class="op" id="8043683">.</span><span class="ident" id="8043684">net</span><span class="op" id="8043687">,</span>&nbsp;<span class="ident" id="8043689">tt</span><span class="op" id="8043691">.</span><span class="ident" id="8043692">laddr</span><span class="op" id="8043697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043701">if</span>&nbsp;<span class="ident" id="8043704">err</span>&nbsp;<span class="op" id="8043708">!=</span>&nbsp;<span class="ident" id="8043711">nil</span>&nbsp;<span class="op" id="8043715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043720">t</span><span class="op" id="8043721">.</span><span class="ident" id="8043722">Fatalf</span><span class="op" id="8043728">(</span><span class="string" id="8043729">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8043754">,</span>&nbsp;<span class="ident" id="8043756">err</span><span class="op" id="8043759">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043767">c</span><span class="op" id="8043768">.</span><span class="ident" id="8043769">SetDeadline</span><span class="op" id="8043780">(</span><span class="ident" id="8043781">time</span><span class="op" id="8043785">.</span><span class="ident" id="8043786">Now</span><span class="op" id="8043789">(</span><span class="op" id="8043790">)</span><span class="op" id="8043791">.</span><span class="ident" id="8043792">Add</span><span class="op" id="8043795">(</span><span class="num" id="8043796">100</span>&nbsp;<span class="op" id="8043800">*</span>&nbsp;<span class="ident" id="8043802">time</span><span class="op" id="8043806">.</span><span class="ident" id="8043807">Millisecond</span><span class="op" id="8043818">)</span><span class="op" id="8043819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043823">defer</span>&nbsp;<span class="ident" id="8043829">c</span><span class="op" id="8043830">.</span><span class="ident" id="8043831">Close</span><span class="op" id="8043836">(</span><span class="op" id="8043837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043842">ra</span><span class="op" id="8043844">,</span>&nbsp;<span class="ident" id="8043846">err</span>&nbsp;<span class="op" id="8043850">:=</span>&nbsp;<span class="ident" id="8043853">ResolveIPAddr</span><span class="op" id="8043866">(</span><span class="ident" id="8043867">tt</span><span class="op" id="8043869">.</span><span class="ident" id="8043870">net</span><span class="op" id="8043873">,</span>&nbsp;<span class="ident" id="8043875">tt</span><span class="op" id="8043877">.</span><span class="ident" id="8043878">raddr</span><span class="op" id="8043883">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043887">if</span>&nbsp;<span class="ident" id="8043890">err</span>&nbsp;<span class="op" id="8043894">!=</span>&nbsp;<span class="ident" id="8043897">nil</span>&nbsp;<span class="op" id="8043901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043906">t</span><span class="op" id="8043907">.</span><span class="ident" id="8043908">Fatalf</span><span class="op" id="8043914">(</span><span class="string" id="8043915">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8043941">,</span>&nbsp;<span class="ident" id="8043943">err</span><span class="op" id="8043946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8043950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8043954">typ</span>&nbsp;<span class="op" id="8043958">:=</span>&nbsp;<span class="ident" id="8043961">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8043981">if</span>&nbsp;<span class="ident" id="8043984">net</span>&nbsp;<span class="op" id="8043988">==</span>&nbsp;<span class="string" id="8043991">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8043997">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044002">typ</span>&nbsp;<span class="op" id="8044006">=</span>&nbsp;<span class="ident" id="8044008">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044032">xid</span><span class="op" id="8044035">,</span>&nbsp;<span class="ident" id="8044037">xseq</span>&nbsp;<span class="op" id="8044042">:=</span>&nbsp;<span class="ident" id="8044045">os</span><span class="op" id="8044047">.</span><span class="ident" id="8044048">Getpid</span><span class="op" id="8044054">(</span><span class="op" id="8044055">)</span><span class="op" id="8044056">&amp;</span><span class="num" id="8044057">0xffff</span><span class="op" id="8044063">,</span>&nbsp;<span class="ident" id="8044065">i</span><span class="op" id="8044066">+</span><span class="num" id="8044067">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044071">wb</span><span class="op" id="8044073">,</span>&nbsp;<span class="ident" id="8044075">err</span>&nbsp;<span class="op" id="8044079">:=</span>&nbsp;<span class="op" id="8044082">(</span><span class="op" id="8044083">&amp;</span><span class="ident" id="8044084">icmpMessage</span><span class="op" id="8044095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044100">Type</span><span class="op" id="8044104">:</span>&nbsp;<span class="ident" id="8044106">typ</span><span class="op" id="8044109">,</span>&nbsp;<span class="ident" id="8044111">Code</span><span class="op" id="8044115">:</span>&nbsp;<span class="num" id="8044117">0</span><span class="op" id="8044118">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044123">Body</span><span class="op" id="8044127">:</span>&nbsp;<span class="op" id="8044129">&amp;</span><span class="ident" id="8044130">icmpEcho</span><span class="op" id="8044138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044144">ID</span><span class="op" id="8044146">:</span>&nbsp;<span class="ident" id="8044148">xid</span><span class="op" id="8044151">,</span>&nbsp;<span class="ident" id="8044153">Seq</span><span class="op" id="8044156">:</span>&nbsp;<span class="ident" id="8044158">xseq</span><span class="op" id="8044162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044168">Data</span><span class="op" id="8044172">:</span>&nbsp;<span class="ident" id="8044174">bytes</span><span class="op" id="8044179">.</span><span class="ident" id="8044180">Repeat</span><span class="op" id="8044186">(</span><span class="op" id="8044187">[</span><span class="op" id="8044188">]</span><span class="builtintype" id="8044189">byte</span><span class="op" id="8044193">(</span><span class="string" id="8044194">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8044216">)</span><span class="op" id="8044217">,</span>&nbsp;<span class="num" id="8044219">3</span><span class="op" id="8044220">)</span><span class="op" id="8044221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044226">}</span><span class="op" id="8044227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044231">}</span><span class="op" id="8044232">)</span><span class="op" id="8044233">.</span><span class="ident" id="8044234">Marshal</span><span class="op" id="8044241">(</span><span class="op" id="8044242">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044246">if</span>&nbsp;<span class="ident" id="8044249">err</span>&nbsp;<span class="op" id="8044253">!=</span>&nbsp;<span class="ident" id="8044256">nil</span>&nbsp;<span class="op" id="8044260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044265">t</span><span class="op" id="8044266">.</span><span class="ident" id="8044267">Fatalf</span><span class="op" id="8044273">(</span><span class="string" id="8044274">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8044306">,</span>&nbsp;<span class="ident" id="8044308">err</span><span class="op" id="8044311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044319">if</span>&nbsp;<span class="ident" id="8044322">_</span><span class="op" id="8044323">,</span>&nbsp;<span class="ident" id="8044325">err</span>&nbsp;<span class="op" id="8044329">:=</span>&nbsp;<span class="ident" id="8044332">c</span><span class="op" id="8044333">.</span><span class="ident" id="8044334">WriteTo</span><span class="op" id="8044341">(</span><span class="ident" id="8044342">wb</span><span class="op" id="8044344">,</span>&nbsp;<span class="ident" id="8044346">ra</span><span class="op" id="8044348">)</span><span class="op" id="8044349">;</span>&nbsp;<span class="ident" id="8044351">err</span>&nbsp;<span class="op" id="8044355">!=</span>&nbsp;<span class="ident" id="8044358">nil</span>&nbsp;<span class="op" id="8044362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044367">t</span><span class="op" id="8044368">.</span><span class="ident" id="8044369">Fatalf</span><span class="op" id="8044375">(</span><span class="string" id="8044376">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8044407">,</span>&nbsp;<span class="ident" id="8044409">err</span><span class="op" id="8044412">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044420">var</span>&nbsp;<span class="ident" id="8044424">m</span>&nbsp;<span class="op" id="8044426">*</span><span class="ident" id="8044427">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044441">rb</span>&nbsp;<span class="op" id="8044444">:=</span>&nbsp;<span class="builtinfunc" id="8044447">make</span><span class="op" id="8044451">(</span><span class="op" id="8044452">[</span><span class="op" id="8044453">]</span><span class="builtintype" id="8044454">byte</span><span class="op" id="8044458">,</span>&nbsp;<span class="num" id="8044460">20</span><span class="op" id="8044462">+</span><span class="builtinfunc" id="8044463">len</span><span class="op" id="8044466">(</span><span class="ident" id="8044467">wb</span><span class="op" id="8044469">)</span><span class="op" id="8044470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044474">for</span>&nbsp;<span class="op" id="8044478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044483">if</span>&nbsp;<span class="ident" id="8044486">_</span><span class="op" id="8044487">,</span>&nbsp;<span class="ident" id="8044489">_</span><span class="op" id="8044490">,</span>&nbsp;<span class="ident" id="8044492">err</span>&nbsp;<span class="op" id="8044496">:=</span>&nbsp;<span class="ident" id="8044499">c</span><span class="op" id="8044500">.</span><span class="ident" id="8044501">ReadFrom</span><span class="op" id="8044509">(</span><span class="ident" id="8044510">rb</span><span class="op" id="8044512">)</span><span class="op" id="8044513">;</span>&nbsp;<span class="ident" id="8044515">err</span>&nbsp;<span class="op" id="8044519">!=</span>&nbsp;<span class="ident" id="8044522">nil</span>&nbsp;<span class="op" id="8044526">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044532">t</span><span class="op" id="8044533">.</span><span class="ident" id="8044534">Fatalf</span><span class="op" id="8044540">(</span><span class="string" id="8044541">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8044573">,</span>&nbsp;<span class="ident" id="8044575">err</span><span class="op" id="8044578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8044588">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8044611">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8044634">//&nbsp;&nbsp;&nbsp;&nbsp;rb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8044661">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044668">if</span>&nbsp;<span class="ident" id="8044671">m</span><span class="op" id="8044672">,</span>&nbsp;<span class="ident" id="8044674">err</span>&nbsp;<span class="op" id="8044678">=</span>&nbsp;<span class="ident" id="8044680">parseICMPMessage</span><span class="op" id="8044696">(</span><span class="ident" id="8044697">rb</span><span class="op" id="8044699">)</span><span class="op" id="8044700">;</span>&nbsp;<span class="ident" id="8044702">err</span>&nbsp;<span class="op" id="8044706">!=</span>&nbsp;<span class="ident" id="8044709">nil</span>&nbsp;<span class="op" id="8044713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044719">t</span><span class="op" id="8044720">.</span><span class="ident" id="8044721">Fatalf</span><span class="op" id="8044727">(</span><span class="string" id="8044728">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8044757">,</span>&nbsp;<span class="ident" id="8044759">err</span><span class="op" id="8044762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044772">switch</span>&nbsp;<span class="ident" id="8044779">m</span><span class="op" id="8044780">.</span><span class="ident" id="8044781">Type</span>&nbsp;<span class="op" id="8044786">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044791">case</span>&nbsp;<span class="ident" id="8044796">icmpv4EchoRequest</span><span class="op" id="8044813">,</span>&nbsp;<span class="ident" id="8044815">icmpv6EchoRequest</span><span class="op" id="8044832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044838">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044855">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8044863">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044867">switch</span>&nbsp;<span class="ident" id="8044874">p</span>&nbsp;<span class="op" id="8044876">:=</span>&nbsp;<span class="ident" id="8044879">m</span><span class="op" id="8044880">.</span><span class="ident" id="8044881">Body</span><span class="op" id="8044885">.</span><span class="op" id="8044886">(</span><span class="keyword" id="8044887">type</span><span class="op" id="8044891">)</span>&nbsp;<span class="op" id="8044893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044897">case</span>&nbsp;<span class="op" id="8044902">*</span><span class="ident" id="8044903">icmpEcho</span><span class="op" id="8044911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8044916">if</span>&nbsp;<span class="ident" id="8044919">p</span><span class="op" id="8044920">.</span><span class="ident" id="8044921">ID</span>&nbsp;<span class="op" id="8044924">!=</span>&nbsp;<span class="ident" id="8044927">xid</span>&nbsp;<span class="op" id="8044931">||</span>&nbsp;<span class="ident" id="8044934">p</span><span class="op" id="8044935">.</span><span class="ident" id="8044936">Seq</span>&nbsp;<span class="op" id="8044940">!=</span>&nbsp;<span class="ident" id="8044943">xseq</span>&nbsp;<span class="op" id="8044948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8044954">t</span><span class="op" id="8044955">.</span><span class="ident" id="8044956">Fatalf</span><span class="op" id="8044962">(</span><span class="string" id="8044963">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8045012">,</span>&nbsp;<span class="ident" id="8045014">p</span><span class="op" id="8045015">.</span><span class="ident" id="8045016">ID</span><span class="op" id="8045018">,</span>&nbsp;<span class="ident" id="8045020">p</span><span class="op" id="8045021">.</span><span class="ident" id="8045022">Seq</span><span class="op" id="8045025">,</span>&nbsp;<span class="ident" id="8045027">xid</span><span class="op" id="8045030">,</span>&nbsp;<span class="ident" id="8045032">xseq</span><span class="op" id="8045036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045041">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045045">default</span><span class="op" id="8045052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045057">t</span><span class="op" id="8045058">.</span><span class="ident" id="8045059">Fatalf</span><span class="op" id="8045065">(</span><span class="string" id="8045066">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8045115">,</span>&nbsp;<span class="ident" id="8045117">m</span><span class="op" id="8045118">.</span><span class="ident" id="8045119">Type</span><span class="op" id="8045123">,</span>&nbsp;<span class="ident" id="8045125">m</span><span class="op" id="8045126">.</span><span class="ident" id="8045127">Code</span><span class="op" id="8045131">,</span>&nbsp;<span class="ident" id="8045133">typ</span><span class="op" id="8045136">,</span>&nbsp;<span class="num" id="8045138">0</span><span class="op" id="8045139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045146">}</span><br>
<span class="lineno"></span><span class="op" id="8045148">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="8045151">func</span>&nbsp;<span class="ident" id="8045156">ipv4Payload</span><span class="op" id="8045167">(</span><span class="ident" id="8045168">b</span>&nbsp;<span class="op" id="8045170">[</span><span class="op" id="8045171">]</span><span class="builtintype" id="8045172">byte</span><span class="op" id="8045176">)</span>&nbsp;<span class="op" id="8045178">[</span><span class="op" id="8045179">]</span><span class="builtintype" id="8045180">byte</span>&nbsp;<span class="op" id="8045185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045188">if</span>&nbsp;<span class="builtinfunc" id="8045191">len</span><span class="op" id="8045194">(</span><span class="ident" id="8045195">b</span><span class="op" id="8045196">)</span>&nbsp;<span class="op" id="8045198">&lt;</span>&nbsp;<span class="num" id="8045200">20</span>&nbsp;<span class="op" id="8045203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045207">return</span>&nbsp;<span class="ident" id="8045214">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045217">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045220">hdrlen</span>&nbsp;<span class="op" id="8045227">:=</span>&nbsp;<span class="builtintype" id="8045230">int</span><span class="op" id="8045233">(</span><span class="ident" id="8045234">b</span><span class="op" id="8045235">[</span><span class="num" id="8045236">0</span><span class="op" id="8045237">]</span><span class="op" id="8045238">&amp;</span><span class="num" id="8045239">0x0f</span><span class="op" id="8045243">)</span>&nbsp;<span class="op" id="8045245">&lt;&lt;</span>&nbsp;<span class="num" id="8045248">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045251">return</span>&nbsp;<span class="ident" id="8045258">b</span><span class="op" id="8045259">[</span><span class="ident" id="8045260">hdrlen</span><span class="op" id="8045266">:</span><span class="op" id="8045267">]</span><br>
<span class="lineno"></span><span class="op" id="8045269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8045272">var</span>&nbsp;<span class="ident" id="8045276">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8045297">=</span>&nbsp;<span class="op" id="8045299">[</span><span class="op" id="8045300">]</span><span class="keyword" id="8045301">struct</span>&nbsp;<span class="op" id="8045308">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045311">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8045317">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045325">laddr</span>&nbsp;<span class="op" id="8045331">*</span><span class="ident" id="8045332">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="8045339">}</span><span class="op" id="8045340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045343">{</span><span class="string" id="8045344">&#34;ip4:icmp&#34;</span><span class="op" id="8045354">,</span>&nbsp;<span class="op" id="8045356">&amp;</span><span class="ident" id="8045357">IPAddr</span><span class="op" id="8045363">{</span><span class="ident" id="8045364">IP</span><span class="op" id="8045366">:</span>&nbsp;<span class="ident" id="8045368">IPv4</span><span class="op" id="8045372">(</span><span class="num" id="8045373">127</span><span class="op" id="8045376">,</span>&nbsp;<span class="num" id="8045378">0</span><span class="op" id="8045379">,</span>&nbsp;<span class="num" id="8045381">0</span><span class="op" id="8045382">,</span>&nbsp;<span class="num" id="8045384">1</span><span class="op" id="8045385">)</span><span class="op" id="8045386">}</span><span class="op" id="8045387">}</span><span class="op" id="8045388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045391">{</span><span class="string" id="8045392">&#34;ip4:icmp&#34;</span><span class="op" id="8045402">,</span>&nbsp;<span class="op" id="8045404">&amp;</span><span class="ident" id="8045405">IPAddr</span><span class="op" id="8045411">{</span><span class="op" id="8045412">}</span><span class="op" id="8045413">}</span><span class="op" id="8045414">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045417">{</span><span class="string" id="8045418">&#34;ip4:icmp&#34;</span><span class="op" id="8045428">,</span>&nbsp;<span class="ident" id="8045430">nil</span><span class="op" id="8045433">}</span><span class="op" id="8045434">,</span><br>
<span class="lineno"></span><span class="op" id="8045436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8045439">func</span>&nbsp;<span class="ident" id="8045444">TestIPConnLocalName</span><span class="op" id="8045463">(</span><span class="ident" id="8045464">t</span>&nbsp;<span class="op" id="8045466">*</span><span class="ident" id="8045467">testing</span><span class="op" id="8045474">.</span><span class="ident" id="8045475">T</span><span class="op" id="8045476">)</span>&nbsp;<span class="op" id="8045478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045481">switch</span>&nbsp;<span class="ident" id="8045488">runtime</span><span class="op" id="8045495">.</span><span class="ident" id="8045496">GOOS</span>&nbsp;<span class="op" id="8045501">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045504">case</span>&nbsp;<span class="string" id="8045509">&#34;nacl&#34;</span><span class="op" id="8045515">,</span>&nbsp;<span class="string" id="8045517">&#34;plan9&#34;</span><span class="op" id="8045524">,</span>&nbsp;<span class="string" id="8045526">&#34;windows&#34;</span><span class="op" id="8045535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045539">t</span><span class="op" id="8045540">.</span><span class="ident" id="8045541">Skipf</span><span class="op" id="8045546">(</span><span class="string" id="8045547">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8045568">,</span>&nbsp;<span class="ident" id="8045570">runtime</span><span class="op" id="8045577">.</span><span class="ident" id="8045578">GOOS</span><span class="op" id="8045582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045585">default</span><span class="op" id="8045592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045596">if</span>&nbsp;<span class="ident" id="8045599">os</span><span class="op" id="8045601">.</span><span class="ident" id="8045602">Getuid</span><span class="op" id="8045608">(</span><span class="op" id="8045609">)</span>&nbsp;<span class="op" id="8045611">!=</span>&nbsp;<span class="num" id="8045614">0</span>&nbsp;<span class="op" id="8045616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045621">t</span><span class="op" id="8045622">.</span><span class="ident" id="8045623">Skip</span><span class="op" id="8045627">(</span><span class="string" id="8045628">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8045657">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045668">for</span>&nbsp;<span class="ident" id="8045672">_</span><span class="op" id="8045673">,</span>&nbsp;<span class="ident" id="8045675">tt</span>&nbsp;<span class="op" id="8045678">:=</span>&nbsp;<span class="keyword" id="8045681">range</span>&nbsp;<span class="ident" id="8045687">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8045708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045712">c</span><span class="op" id="8045713">,</span>&nbsp;<span class="ident" id="8045715">err</span>&nbsp;<span class="op" id="8045719">:=</span>&nbsp;<span class="ident" id="8045722">ListenIP</span><span class="op" id="8045730">(</span><span class="ident" id="8045731">tt</span><span class="op" id="8045733">.</span><span class="ident" id="8045734">net</span><span class="op" id="8045737">,</span>&nbsp;<span class="ident" id="8045739">tt</span><span class="op" id="8045741">.</span><span class="ident" id="8045742">laddr</span><span class="op" id="8045747">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045751">if</span>&nbsp;<span class="ident" id="8045754">err</span>&nbsp;<span class="op" id="8045758">!=</span>&nbsp;<span class="ident" id="8045761">nil</span>&nbsp;<span class="op" id="8045765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045770">t</span><span class="op" id="8045771">.</span><span class="ident" id="8045772">Fatalf</span><span class="op" id="8045778">(</span><span class="string" id="8045779">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8045800">,</span>&nbsp;<span class="ident" id="8045802">err</span><span class="op" id="8045805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045813">defer</span>&nbsp;<span class="ident" id="8045819">c</span><span class="op" id="8045820">.</span><span class="ident" id="8045821">Close</span><span class="op" id="8045826">(</span><span class="op" id="8045827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045831">if</span>&nbsp;<span class="ident" id="8045834">la</span>&nbsp;<span class="op" id="8045837">:=</span>&nbsp;<span class="ident" id="8045840">c</span><span class="op" id="8045841">.</span><span class="ident" id="8045842">LocalAddr</span><span class="op" id="8045851">(</span><span class="op" id="8045852">)</span><span class="op" id="8045853">;</span>&nbsp;<span class="ident" id="8045855">la</span>&nbsp;<span class="op" id="8045858">==</span>&nbsp;<span class="ident" id="8045861">nil</span>&nbsp;<span class="op" id="8045865">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8045870">t</span><span class="op" id="8045871">.</span><span class="ident" id="8045872">Fatal</span><span class="op" id="8045877">(</span><span class="string" id="8045878">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="8045903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8045910">}</span><br>
<span class="lineno"></span><span class="op" id="8045912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="8045915">func</span>&nbsp;<span class="ident" id="8045920">TestIPConnRemoteName</span><span class="op" id="8045940">(</span><span class="ident" id="8045941">t</span>&nbsp;<span class="op" id="8045943">*</span><span class="ident" id="8045944">testing</span><span class="op" id="8045951">.</span><span class="ident" id="8045952">T</span><span class="op" id="8045953">)</span>&nbsp;<span class="op" id="8045955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045958">switch</span>&nbsp;<span class="ident" id="8045965">runtime</span><span class="op" id="8045972">.</span><span class="ident" id="8045973">GOOS</span>&nbsp;<span class="op" id="8045978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8045981">case</span>&nbsp;<span class="string" id="8045986">&#34;plan9&#34;</span><span class="op" id="8045993">,</span>&nbsp;<span class="string" id="8045995">&#34;windows&#34;</span><span class="op" id="8046004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046008">t</span><span class="op" id="8046009">.</span><span class="ident" id="8046010">Skipf</span><span class="op" id="8046015">(</span><span class="string" id="8046016">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8046037">,</span>&nbsp;<span class="ident" id="8046039">runtime</span><span class="op" id="8046046">.</span><span class="ident" id="8046047">GOOS</span><span class="op" id="8046051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046054">default</span><span class="op" id="8046061">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046065">if</span>&nbsp;<span class="ident" id="8046068">os</span><span class="op" id="8046070">.</span><span class="ident" id="8046071">Getuid</span><span class="op" id="8046077">(</span><span class="op" id="8046078">)</span>&nbsp;<span class="op" id="8046080">!=</span>&nbsp;<span class="num" id="8046083">0</span>&nbsp;<span class="op" id="8046085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046090">t</span><span class="op" id="8046091">.</span><span class="ident" id="8046092">Skip</span><span class="op" id="8046096">(</span><span class="string" id="8046097">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8046126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8046130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8046133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046137">raddr</span>&nbsp;<span class="op" id="8046143">:=</span>&nbsp;<span class="op" id="8046146">&amp;</span><span class="ident" id="8046147">IPAddr</span><span class="op" id="8046153">{</span><span class="ident" id="8046154">IP</span><span class="op" id="8046156">:</span>&nbsp;<span class="ident" id="8046158">IPv4</span><span class="op" id="8046162">(</span><span class="num" id="8046163">127</span><span class="op" id="8046166">,</span>&nbsp;<span class="num" id="8046168">0</span><span class="op" id="8046169">,</span>&nbsp;<span class="num" id="8046171">0</span><span class="op" id="8046172">,</span>&nbsp;<span class="num" id="8046174">1</span><span class="op" id="8046175">)</span><span class="op" id="8046176">.</span><span class="ident" id="8046177">To4</span><span class="op" id="8046180">(</span><span class="op" id="8046181">)</span><span class="op" id="8046182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046185">c</span><span class="op" id="8046186">,</span>&nbsp;<span class="ident" id="8046188">err</span>&nbsp;<span class="op" id="8046192">:=</span>&nbsp;<span class="ident" id="8046195">DialIP</span><span class="op" id="8046201">(</span><span class="string" id="8046202">&#34;ip:tcp&#34;</span><span class="op" id="8046210">,</span>&nbsp;<span class="op" id="8046212">&amp;</span><span class="ident" id="8046213">IPAddr</span><span class="op" id="8046219">{</span><span class="ident" id="8046220">IP</span><span class="op" id="8046222">:</span>&nbsp;<span class="ident" id="8046224">IPv4</span><span class="op" id="8046228">(</span><span class="num" id="8046229">127</span><span class="op" id="8046232">,</span>&nbsp;<span class="num" id="8046234">0</span><span class="op" id="8046235">,</span>&nbsp;<span class="num" id="8046237">0</span><span class="op" id="8046238">,</span>&nbsp;<span class="num" id="8046240">1</span><span class="op" id="8046241">)</span><span class="op" id="8046242">}</span><span class="op" id="8046243">,</span>&nbsp;<span class="ident" id="8046245">raddr</span><span class="op" id="8046250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046253">if</span>&nbsp;<span class="ident" id="8046256">err</span>&nbsp;<span class="op" id="8046260">!=</span>&nbsp;<span class="ident" id="8046263">nil</span>&nbsp;<span class="op" id="8046267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046271">t</span><span class="op" id="8046272">.</span><span class="ident" id="8046273">Fatalf</span><span class="op" id="8046279">(</span><span class="string" id="8046280">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8046299">,</span>&nbsp;<span class="ident" id="8046301">err</span><span class="op" id="8046304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8046307">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046310">defer</span>&nbsp;<span class="ident" id="8046316">c</span><span class="op" id="8046317">.</span><span class="ident" id="8046318">Close</span><span class="op" id="8046323">(</span><span class="op" id="8046324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046327">if</span>&nbsp;<span class="op" id="8046330">!</span><span class="ident" id="8046331">reflect</span><span class="op" id="8046338">.</span><span class="ident" id="8046339">DeepEqual</span><span class="op" id="8046348">(</span><span class="ident" id="8046349">raddr</span><span class="op" id="8046354">,</span>&nbsp;<span class="ident" id="8046356">c</span><span class="op" id="8046357">.</span><span class="ident" id="8046358">RemoteAddr</span><span class="op" id="8046368">(</span><span class="op" id="8046369">)</span><span class="op" id="8046370">)</span>&nbsp;<span class="op" id="8046372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8046376">t</span><span class="op" id="8046377">.</span><span class="ident" id="8046378">Fatalf</span><span class="op" id="8046384">(</span><span class="string" id="8046385">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8046408">,</span>&nbsp;<span class="ident" id="8046410">c</span><span class="op" id="8046411">.</span><span class="ident" id="8046412">RemoteAddr</span><span class="op" id="8046422">(</span><span class="op" id="8046423">)</span><span class="op" id="8046424">,</span>&nbsp;<span class="ident" id="8046426">raddr</span><span class="op" id="8046431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8046434">}</span><br>
<span class="lineno"></span><span class="op" id="8046436">}</span>
</div>
</body>
</html>
