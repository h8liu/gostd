<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4813475">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4813530">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4813584">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4813635">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813694">package</span>&nbsp;<span class="ident" id="4813702">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813707">import</span>&nbsp;<span class="op" id="4813714">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813717">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813736">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813746">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813753">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813761">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4813771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4813774">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="4813833">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4813885">type</span>&nbsp;<span class="ident" id="4813890">Rat</span>&nbsp;<span class="keyword" id="4813894">struct</span>&nbsp;<span class="op" id="4813901">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813904">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813961">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814015">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814075">a</span><span class="op" id="4814076">,</span>&nbsp;<span class="ident" id="4814078">b</span>&nbsp;<span class="ident" id="4814080">Int</span><br>
<span class="lineno"></span><span class="op" id="4814084">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4814087">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4814151">func</span>&nbsp;<span class="ident" id="4814156">NewRat</span><span class="op" id="4814162">(</span><span class="ident" id="4814163">a</span><span class="op" id="4814164">,</span>&nbsp;<span class="ident" id="4814166">b</span>&nbsp;<span class="ident" id="4814168">int64</span><span class="op" id="4814173">)</span>&nbsp;<span class="op" id="4814175">*</span><span class="ident" id="4814176">Rat</span>&nbsp;<span class="op" id="4814180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814183">return</span>&nbsp;<span class="builtinfunc" id="4814190">new</span><span class="op" id="4814193">(</span><span class="ident" id="4814194">Rat</span><span class="op" id="4814197">)</span><span class="op" id="4814198">.</span><span class="ident" id="4814199">SetFrac64</span><span class="op" id="4814208">(</span><span class="ident" id="4814209">a</span><span class="op" id="4814210">,</span>&nbsp;<span class="ident" id="4814212">b</span><span class="op" id="4814213">)</span><br>
<span class="lineno"></span><span class="op" id="4814215">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4814218">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4814267">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4814312">func</span>&nbsp;<span class="op" id="4814317">(</span><span class="ident" id="4814318">z</span>&nbsp;<span class="op" id="4814320">*</span><span class="ident" id="4814321">Rat</span><span class="op" id="4814324">)</span>&nbsp;<span class="ident" id="4814326">SetFloat64</span><span class="op" id="4814336">(</span><span class="ident" id="4814337">f</span>&nbsp;<span class="builtintype" id="4814339">float64</span><span class="op" id="4814346">)</span>&nbsp;<span class="op" id="4814348">*</span><span class="ident" id="4814349">Rat</span>&nbsp;<span class="op" id="4814353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814356">const</span>&nbsp;<span class="ident" id="4814362">expMask</span>&nbsp;<span class="op" id="4814370">=</span>&nbsp;<span class="num" id="4814372">1</span><span class="op" id="4814373">&lt;&lt;</span><span class="num" id="4814375">11</span>&nbsp;<span class="op" id="4814378">-</span>&nbsp;<span class="num" id="4814380">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814383">bits</span>&nbsp;<span class="op" id="4814388">:=</span>&nbsp;<span class="ident" id="4814391">math</span><span class="op" id="4814395">.</span><span class="ident" id="4814396">Float64bits</span><span class="op" id="4814407">(</span><span class="ident" id="4814408">f</span><span class="op" id="4814409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814412">mantissa</span>&nbsp;<span class="op" id="4814421">:=</span>&nbsp;<span class="ident" id="4814424">bits</span>&nbsp;<span class="op" id="4814429">&amp;</span>&nbsp;<span class="op" id="4814431">(</span><span class="num" id="4814432">1</span><span class="op" id="4814433">&lt;&lt;</span><span class="num" id="4814435">52</span>&nbsp;<span class="op" id="4814438">-</span>&nbsp;<span class="num" id="4814440">1</span><span class="op" id="4814441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814444">exp</span>&nbsp;<span class="op" id="4814448">:=</span>&nbsp;<span class="builtintype" id="4814451">int</span><span class="op" id="4814454">(</span><span class="op" id="4814455">(</span><span class="ident" id="4814456">bits</span>&nbsp;<span class="op" id="4814461">&gt;&gt;</span>&nbsp;<span class="num" id="4814464">52</span><span class="op" id="4814466">)</span>&nbsp;<span class="op" id="4814468">&amp;</span>&nbsp;<span class="ident" id="4814470">expMask</span><span class="op" id="4814477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814480">switch</span>&nbsp;<span class="ident" id="4814487">exp</span>&nbsp;<span class="op" id="4814491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814494">case</span>&nbsp;<span class="ident" id="4814499">expMask</span><span class="op" id="4814506">:</span>&nbsp;<span class="comment" id="4814508">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814524">return</span>&nbsp;<span class="ident" id="4814531">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814536">case</span>&nbsp;<span class="num" id="4814541">0</span><span class="op" id="4814542">:</span>&nbsp;<span class="comment" id="4814544">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814558">exp</span>&nbsp;<span class="op" id="4814562">-=</span>&nbsp;<span class="num" id="4814565">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814571">default</span><span class="op" id="4814578">:</span>&nbsp;<span class="comment" id="4814580">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814592">mantissa</span>&nbsp;<span class="op" id="4814601">|=</span>&nbsp;<span class="num" id="4814604">1</span>&nbsp;<span class="op" id="4814606">&lt;&lt;</span>&nbsp;<span class="num" id="4814609">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814614">exp</span>&nbsp;<span class="op" id="4814618">-=</span>&nbsp;<span class="num" id="4814621">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814631">shift</span>&nbsp;<span class="op" id="4814637">:=</span>&nbsp;<span class="num" id="4814640">52</span>&nbsp;<span class="op" id="4814643">-</span>&nbsp;<span class="ident" id="4814645">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814651">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814698">for</span>&nbsp;<span class="ident" id="4814702">mantissa</span><span class="op" id="4814710">&amp;</span><span class="num" id="4814711">1</span>&nbsp;<span class="op" id="4814713">==</span>&nbsp;<span class="num" id="4814716">0</span>&nbsp;<span class="op" id="4814718">&amp;&amp;</span>&nbsp;<span class="ident" id="4814721">shift</span>&nbsp;<span class="op" id="4814727">&gt;</span>&nbsp;<span class="num" id="4814729">0</span>&nbsp;<span class="op" id="4814731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814735">mantissa</span>&nbsp;<span class="op" id="4814744">&gt;&gt;=</span>&nbsp;<span class="num" id="4814748">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814752">shift</span><span class="op" id="4814757">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814761">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814765">z</span><span class="op" id="4814766">.</span><span class="ident" id="4814767">a</span><span class="op" id="4814768">.</span><span class="ident" id="4814769">SetUint64</span><span class="op" id="4814778">(</span><span class="ident" id="4814779">mantissa</span><span class="op" id="4814787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814790">z</span><span class="op" id="4814791">.</span><span class="ident" id="4814792">a</span><span class="op" id="4814793">.</span><span class="ident" id="4814794">neg</span>&nbsp;<span class="op" id="4814798">=</span>&nbsp;<span class="ident" id="4814800">f</span>&nbsp;<span class="op" id="4814802">&lt;</span>&nbsp;<span class="num" id="4814804">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814807">z</span><span class="op" id="4814808">.</span><span class="ident" id="4814809">b</span><span class="op" id="4814810">.</span><span class="ident" id="4814811">Set</span><span class="op" id="4814814">(</span><span class="ident" id="4814815">intOne</span><span class="op" id="4814821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814824">if</span>&nbsp;<span class="ident" id="4814827">shift</span>&nbsp;<span class="op" id="4814833">&gt;</span>&nbsp;<span class="num" id="4814835">0</span>&nbsp;<span class="op" id="4814837">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814841">z</span><span class="op" id="4814842">.</span><span class="ident" id="4814843">b</span><span class="op" id="4814844">.</span><span class="ident" id="4814845">Lsh</span><span class="op" id="4814848">(</span><span class="op" id="4814849">&amp;</span><span class="ident" id="4814850">z</span><span class="op" id="4814851">.</span><span class="ident" id="4814852">b</span><span class="op" id="4814853">,</span>&nbsp;<span class="builtintype" id="4814855">uint</span><span class="op" id="4814859">(</span><span class="ident" id="4814860">shift</span><span class="op" id="4814865">)</span><span class="op" id="4814866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814869">}</span>&nbsp;<span class="keyword" id="4814871">else</span>&nbsp;<span class="op" id="4814876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814880">z</span><span class="op" id="4814881">.</span><span class="ident" id="4814882">a</span><span class="op" id="4814883">.</span><span class="ident" id="4814884">Lsh</span><span class="op" id="4814887">(</span><span class="op" id="4814888">&amp;</span><span class="ident" id="4814889">z</span><span class="op" id="4814890">.</span><span class="ident" id="4814891">a</span><span class="op" id="4814892">,</span>&nbsp;<span class="builtintype" id="4814894">uint</span><span class="op" id="4814898">(</span><span class="op" id="4814899">-</span><span class="ident" id="4814900">shift</span><span class="op" id="4814905">)</span><span class="op" id="4814906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814912">return</span>&nbsp;<span class="ident" id="4814919">z</span><span class="op" id="4814920">.</span><span class="ident" id="4814921">norm</span><span class="op" id="4814925">(</span><span class="op" id="4814926">)</span><br>
<span class="lineno">65</span><span class="op" id="4814928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4814931">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4814987">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4815042">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="4815095">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4815160">func</span>&nbsp;<span class="ident" id="4815165">quotToFloat32</span><span class="op" id="4815178">(</span><span class="ident" id="4815179">a</span><span class="op" id="4815180">,</span>&nbsp;<span class="ident" id="4815182">b</span>&nbsp;<span class="ident" id="4815184">nat</span><span class="op" id="4815187">)</span>&nbsp;<span class="op" id="4815189">(</span><span class="ident" id="4815190">f</span>&nbsp;<span class="builtintype" id="4815192">float32</span><span class="op" id="4815199">,</span>&nbsp;<span class="ident" id="4815201">exact</span>&nbsp;<span class="builtintype" id="4815207">bool</span><span class="op" id="4815211">)</span>&nbsp;<span class="op" id="4815213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815216">const</span>&nbsp;<span class="op" id="4815222">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815226">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815250">Fsize</span>&nbsp;<span class="op" id="4815256">=</span>&nbsp;<span class="num" id="4815258">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815264">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815278">Msize</span>&nbsp;&nbsp;<span class="op" id="4815285">=</span>&nbsp;<span class="num" id="4815287">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815292">Msize1</span>&nbsp;<span class="op" id="4815299">=</span>&nbsp;<span class="ident" id="4815301">Msize</span>&nbsp;<span class="op" id="4815307">+</span>&nbsp;<span class="num" id="4815309">1</span>&nbsp;<span class="comment" id="4815311">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815333">Msize2</span>&nbsp;<span class="op" id="4815340">=</span>&nbsp;<span class="ident" id="4815342">Msize1</span>&nbsp;<span class="op" id="4815349">+</span>&nbsp;<span class="num" id="4815351">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815356">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815370">Esize</span>&nbsp;<span class="op" id="4815376">=</span>&nbsp;<span class="ident" id="4815378">Fsize</span>&nbsp;<span class="op" id="4815384">-</span>&nbsp;<span class="ident" id="4815386">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815395">Ebias</span>&nbsp;<span class="op" id="4815401">=</span>&nbsp;<span class="num" id="4815403">1</span><span class="op" id="4815404">&lt;&lt;</span><span class="op" id="4815406">(</span><span class="ident" id="4815407">Esize</span><span class="op" id="4815412">-</span><span class="num" id="4815413">1</span><span class="op" id="4815414">)</span>&nbsp;<span class="op" id="4815416">-</span>&nbsp;<span class="num" id="4815418">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815422">Emin</span>&nbsp;&nbsp;<span class="op" id="4815428">=</span>&nbsp;<span class="num" id="4815430">1</span>&nbsp;<span class="op" id="4815432">-</span>&nbsp;<span class="ident" id="4815434">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815442">Emax</span>&nbsp;&nbsp;<span class="op" id="4815448">=</span>&nbsp;<span class="ident" id="4815450">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815461">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815532">alen</span>&nbsp;<span class="op" id="4815537">:=</span>&nbsp;<span class="ident" id="4815540">a</span><span class="op" id="4815541">.</span><span class="ident" id="4815542">bitLen</span><span class="op" id="4815548">(</span><span class="op" id="4815549">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815552">if</span>&nbsp;<span class="ident" id="4815555">alen</span>&nbsp;<span class="op" id="4815560">==</span>&nbsp;<span class="num" id="4815563">0</span>&nbsp;<span class="op" id="4815565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815569">return</span>&nbsp;<span class="num" id="4815576">0</span><span class="op" id="4815577">,</span>&nbsp;<span class="builtintype" id="4815579">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815588">blen</span>&nbsp;<span class="op" id="4815593">:=</span>&nbsp;<span class="ident" id="4815596">b</span><span class="op" id="4815597">.</span><span class="ident" id="4815598">bitLen</span><span class="op" id="4815604">(</span><span class="op" id="4815605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815608">if</span>&nbsp;<span class="ident" id="4815611">blen</span>&nbsp;<span class="op" id="4815616">==</span>&nbsp;<span class="num" id="4815619">0</span>&nbsp;<span class="op" id="4815621">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4815625">panic</span><span class="op" id="4815630">(</span><span class="string" id="4815631">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4815649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815656">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815736">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815816">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815888">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815950">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816012">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816079">exp</span>&nbsp;<span class="op" id="4816083">:=</span>&nbsp;<span class="ident" id="4816086">alen</span>&nbsp;<span class="op" id="4816091">-</span>&nbsp;<span class="ident" id="4816093">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816099">var</span>&nbsp;<span class="ident" id="4816103">a2</span><span class="op" id="4816105">,</span>&nbsp;<span class="ident" id="4816107">b2</span>&nbsp;<span class="ident" id="4816110">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816115">a2</span>&nbsp;<span class="op" id="4816118">=</span>&nbsp;<span class="ident" id="4816120">a2</span><span class="op" id="4816122">.</span><span class="ident" id="4816123">set</span><span class="op" id="4816126">(</span><span class="ident" id="4816127">a</span><span class="op" id="4816128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816131">b2</span>&nbsp;<span class="op" id="4816134">=</span>&nbsp;<span class="ident" id="4816136">b2</span><span class="op" id="4816138">.</span><span class="ident" id="4816139">set</span><span class="op" id="4816142">(</span><span class="ident" id="4816143">b</span><span class="op" id="4816144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816147">if</span>&nbsp;<span class="ident" id="4816150">shift</span>&nbsp;<span class="op" id="4816156">:=</span>&nbsp;<span class="ident" id="4816159">Msize2</span>&nbsp;<span class="op" id="4816166">-</span>&nbsp;<span class="ident" id="4816168">exp</span><span class="op" id="4816171">;</span>&nbsp;<span class="ident" id="4816173">shift</span>&nbsp;<span class="op" id="4816179">&gt;</span>&nbsp;<span class="num" id="4816181">0</span>&nbsp;<span class="op" id="4816183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816187">a2</span>&nbsp;<span class="op" id="4816190">=</span>&nbsp;<span class="ident" id="4816192">a2</span><span class="op" id="4816194">.</span><span class="ident" id="4816195">shl</span><span class="op" id="4816198">(</span><span class="ident" id="4816199">a2</span><span class="op" id="4816201">,</span>&nbsp;<span class="builtintype" id="4816203">uint</span><span class="op" id="4816207">(</span><span class="ident" id="4816208">shift</span><span class="op" id="4816213">)</span><span class="op" id="4816214">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816217">}</span>&nbsp;<span class="keyword" id="4816219">else</span>&nbsp;<span class="keyword" id="4816224">if</span>&nbsp;<span class="ident" id="4816227">shift</span>&nbsp;<span class="op" id="4816233">&lt;</span>&nbsp;<span class="num" id="4816235">0</span>&nbsp;<span class="op" id="4816237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816241">b2</span>&nbsp;<span class="op" id="4816244">=</span>&nbsp;<span class="ident" id="4816246">b2</span><span class="op" id="4816248">.</span><span class="ident" id="4816249">shl</span><span class="op" id="4816252">(</span><span class="ident" id="4816253">b2</span><span class="op" id="4816255">,</span>&nbsp;<span class="builtintype" id="4816257">uint</span><span class="op" id="4816261">(</span><span class="op" id="4816262">-</span><span class="ident" id="4816263">shift</span><span class="op" id="4816268">)</span><span class="op" id="4816269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816276">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816338">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816395">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816420">var</span>&nbsp;<span class="ident" id="4816424">q</span>&nbsp;<span class="ident" id="4816426">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816431">q</span><span class="op" id="4816432">,</span>&nbsp;<span class="ident" id="4816434">r</span>&nbsp;<span class="op" id="4816436">:=</span>&nbsp;<span class="ident" id="4816439">q</span><span class="op" id="4816440">.</span><span class="ident" id="4816441">div</span><span class="op" id="4816444">(</span><span class="ident" id="4816445">a2</span><span class="op" id="4816447">,</span>&nbsp;<span class="ident" id="4816449">a2</span><span class="op" id="4816451">,</span>&nbsp;<span class="ident" id="4816453">b2</span><span class="op" id="4816455">)</span>&nbsp;<span class="comment" id="4816457">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816474">mantissa</span>&nbsp;<span class="op" id="4816483">:=</span>&nbsp;<span class="ident" id="4816486">low32</span><span class="op" id="4816491">(</span><span class="ident" id="4816492">q</span><span class="op" id="4816493">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816496">haveRem</span>&nbsp;<span class="op" id="4816504">:=</span>&nbsp;<span class="builtinfunc" id="4816507">len</span><span class="op" id="4816510">(</span><span class="ident" id="4816511">r</span><span class="op" id="4816512">)</span>&nbsp;<span class="op" id="4816514">&gt;</span>&nbsp;<span class="num" id="4816516">0</span>&nbsp;<span class="comment" id="4816518">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816575">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816644">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816696">if</span>&nbsp;<span class="ident" id="4816699">mantissa</span><span class="op" id="4816707">&gt;&gt;</span><span class="ident" id="4816709">Msize2</span>&nbsp;<span class="op" id="4816716">==</span>&nbsp;<span class="num" id="4816719">1</span>&nbsp;<span class="op" id="4816721">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816725">if</span>&nbsp;<span class="ident" id="4816728">mantissa</span><span class="op" id="4816736">&amp;</span><span class="num" id="4816737">1</span>&nbsp;<span class="op" id="4816739">==</span>&nbsp;<span class="num" id="4816742">1</span>&nbsp;<span class="op" id="4816744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816749">haveRem</span>&nbsp;<span class="op" id="4816757">=</span>&nbsp;<span class="builtintype" id="4816759">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816770">mantissa</span>&nbsp;<span class="op" id="4816779">&gt;&gt;=</span>&nbsp;<span class="num" id="4816783">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816787">exp</span><span class="op" id="4816790">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816797">if</span>&nbsp;<span class="ident" id="4816800">mantissa</span><span class="op" id="4816808">&gt;&gt;</span><span class="ident" id="4816810">Msize1</span>&nbsp;<span class="op" id="4816817">!=</span>&nbsp;<span class="num" id="4816820">1</span>&nbsp;<span class="op" id="4816822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4816826">panic</span><span class="op" id="4816831">(</span><span class="ident" id="4816832">fmt</span><span class="op" id="4816835">.</span><span class="ident" id="4816836">Sprintf</span><span class="op" id="4816843">(</span><span class="string" id="4816844">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4816880">,</span>&nbsp;<span class="ident" id="4816882">Msize2</span><span class="op" id="4816888">)</span><span class="op" id="4816889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816896">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816913">if</span>&nbsp;<span class="ident" id="4816916">Emin</span><span class="op" id="4816920">-</span><span class="ident" id="4816921">Msize</span>&nbsp;<span class="op" id="4816927">&lt;=</span>&nbsp;<span class="ident" id="4816930">exp</span>&nbsp;<span class="op" id="4816934">&amp;&amp;</span>&nbsp;<span class="ident" id="4816937">exp</span>&nbsp;<span class="op" id="4816941">&lt;=</span>&nbsp;<span class="ident" id="4816944">Emin</span>&nbsp;<span class="op" id="4816949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816953">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817005">shift</span>&nbsp;<span class="op" id="4817011">:=</span>&nbsp;<span class="builtintype" id="4817014">uint</span><span class="op" id="4817018">(</span><span class="ident" id="4817019">Emin</span>&nbsp;<span class="op" id="4817024">-</span>&nbsp;<span class="op" id="4817026">(</span><span class="ident" id="4817027">exp</span>&nbsp;<span class="op" id="4817031">-</span>&nbsp;<span class="num" id="4817033">1</span><span class="op" id="4817034">)</span><span class="op" id="4817035">)</span>&nbsp;<span class="comment" id="4817037">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817054">lostbits</span>&nbsp;<span class="op" id="4817063">:=</span>&nbsp;<span class="ident" id="4817066">mantissa</span>&nbsp;<span class="op" id="4817075">&amp;</span>&nbsp;<span class="op" id="4817077">(</span><span class="num" id="4817078">1</span><span class="op" id="4817079">&lt;&lt;</span><span class="ident" id="4817081">shift</span>&nbsp;<span class="op" id="4817087">-</span>&nbsp;<span class="num" id="4817089">1</span><span class="op" id="4817090">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817094">haveRem</span>&nbsp;<span class="op" id="4817102">=</span>&nbsp;<span class="ident" id="4817104">haveRem</span>&nbsp;<span class="op" id="4817112">||</span>&nbsp;<span class="ident" id="4817115">lostbits</span>&nbsp;<span class="op" id="4817124">!=</span>&nbsp;<span class="num" id="4817127">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817131">mantissa</span>&nbsp;<span class="op" id="4817140">&gt;&gt;=</span>&nbsp;<span class="ident" id="4817144">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817152">exp</span>&nbsp;<span class="op" id="4817156">=</span>&nbsp;<span class="num" id="4817158">2</span>&nbsp;<span class="op" id="4817160">-</span>&nbsp;<span class="ident" id="4817162">Ebias</span>&nbsp;<span class="comment" id="4817168">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817190">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817228">exact</span>&nbsp;<span class="op" id="4817234">=</span>&nbsp;<span class="op" id="4817236">!</span><span class="ident" id="4817237">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817246">if</span>&nbsp;<span class="ident" id="4817249">mantissa</span><span class="op" id="4817257">&amp;</span><span class="num" id="4817258">1</span>&nbsp;<span class="op" id="4817260">!=</span>&nbsp;<span class="num" id="4817263">0</span>&nbsp;<span class="op" id="4817265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817269">exact</span>&nbsp;<span class="op" id="4817275">=</span>&nbsp;<span class="builtintype" id="4817277">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817285">if</span>&nbsp;<span class="ident" id="4817288">haveRem</span>&nbsp;<span class="op" id="4817296">||</span>&nbsp;<span class="ident" id="4817299">mantissa</span><span class="op" id="4817307">&amp;</span><span class="num" id="4817308">2</span>&nbsp;<span class="op" id="4817310">!=</span>&nbsp;<span class="num" id="4817313">0</span>&nbsp;<span class="op" id="4817315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817320">if</span>&nbsp;<span class="ident" id="4817323">mantissa</span><span class="op" id="4817331">++</span><span class="op" id="4817333">;</span>&nbsp;<span class="ident" id="4817335">mantissa</span>&nbsp;<span class="op" id="4817344">&gt;=</span>&nbsp;<span class="num" id="4817347">1</span><span class="op" id="4817348">&lt;&lt;</span><span class="ident" id="4817350">Msize2</span>&nbsp;<span class="op" id="4817357">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817363">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817424">mantissa</span>&nbsp;<span class="op" id="4817433">&gt;&gt;=</span>&nbsp;<span class="num" id="4817437">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817443">exp</span><span class="op" id="4817446">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817456">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817462">mantissa</span>&nbsp;<span class="op" id="4817471">&gt;&gt;=</span>&nbsp;<span class="num" id="4817475">1</span>&nbsp;<span class="comment" id="4817477">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817539">f</span>&nbsp;<span class="op" id="4817541">=</span>&nbsp;<span class="builtintype" id="4817543">float32</span><span class="op" id="4817550">(</span><span class="ident" id="4817551">math</span><span class="op" id="4817555">.</span><span class="ident" id="4817556">Ldexp</span><span class="op" id="4817561">(</span><span class="builtintype" id="4817562">float64</span><span class="op" id="4817569">(</span><span class="ident" id="4817570">mantissa</span><span class="op" id="4817578">)</span><span class="op" id="4817579">,</span>&nbsp;<span class="ident" id="4817581">exp</span><span class="op" id="4817584">-</span><span class="ident" id="4817585">Msize1</span><span class="op" id="4817591">)</span><span class="op" id="4817592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817595">if</span>&nbsp;<span class="ident" id="4817598">math</span><span class="op" id="4817602">.</span><span class="ident" id="4817603">IsInf</span><span class="op" id="4817608">(</span><span class="builtintype" id="4817609">float64</span><span class="op" id="4817616">(</span><span class="ident" id="4817617">f</span><span class="op" id="4817618">)</span><span class="op" id="4817619">,</span>&nbsp;<span class="num" id="4817621">0</span><span class="op" id="4817622">)</span>&nbsp;<span class="op" id="4817624">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817628">exact</span>&nbsp;<span class="op" id="4817634">=</span>&nbsp;<span class="builtintype" id="4817636">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817646">return</span><br>
<span class="lineno"></span><span class="op" id="4817653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4817656">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4817712">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4817767">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="4817820">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4817885">func</span>&nbsp;<span class="ident" id="4817890">quotToFloat64</span><span class="op" id="4817903">(</span><span class="ident" id="4817904">a</span><span class="op" id="4817905">,</span>&nbsp;<span class="ident" id="4817907">b</span>&nbsp;<span class="ident" id="4817909">nat</span><span class="op" id="4817912">)</span>&nbsp;<span class="op" id="4817914">(</span><span class="ident" id="4817915">f</span>&nbsp;<span class="builtintype" id="4817917">float64</span><span class="op" id="4817924">,</span>&nbsp;<span class="ident" id="4817926">exact</span>&nbsp;<span class="builtintype" id="4817932">bool</span><span class="op" id="4817936">)</span>&nbsp;<span class="op" id="4817938">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817941">const</span>&nbsp;<span class="op" id="4817947">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817951">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817975">Fsize</span>&nbsp;<span class="op" id="4817981">=</span>&nbsp;<span class="num" id="4817983">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817989">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818003">Msize</span>&nbsp;&nbsp;<span class="op" id="4818010">=</span>&nbsp;<span class="num" id="4818012">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818017">Msize1</span>&nbsp;<span class="op" id="4818024">=</span>&nbsp;<span class="ident" id="4818026">Msize</span>&nbsp;<span class="op" id="4818032">+</span>&nbsp;<span class="num" id="4818034">1</span>&nbsp;<span class="comment" id="4818036">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818058">Msize2</span>&nbsp;<span class="op" id="4818065">=</span>&nbsp;<span class="ident" id="4818067">Msize1</span>&nbsp;<span class="op" id="4818074">+</span>&nbsp;<span class="num" id="4818076">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818081">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818095">Esize</span>&nbsp;<span class="op" id="4818101">=</span>&nbsp;<span class="ident" id="4818103">Fsize</span>&nbsp;<span class="op" id="4818109">-</span>&nbsp;<span class="ident" id="4818111">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818120">Ebias</span>&nbsp;<span class="op" id="4818126">=</span>&nbsp;<span class="num" id="4818128">1</span><span class="op" id="4818129">&lt;&lt;</span><span class="op" id="4818131">(</span><span class="ident" id="4818132">Esize</span><span class="op" id="4818137">-</span><span class="num" id="4818138">1</span><span class="op" id="4818139">)</span>&nbsp;<span class="op" id="4818141">-</span>&nbsp;<span class="num" id="4818143">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818147">Emin</span>&nbsp;&nbsp;<span class="op" id="4818153">=</span>&nbsp;<span class="num" id="4818155">1</span>&nbsp;<span class="op" id="4818157">-</span>&nbsp;<span class="ident" id="4818159">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818167">Emax</span>&nbsp;&nbsp;<span class="op" id="4818173">=</span>&nbsp;<span class="ident" id="4818175">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818182">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818186">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818257">alen</span>&nbsp;<span class="op" id="4818262">:=</span>&nbsp;<span class="ident" id="4818265">a</span><span class="op" id="4818266">.</span><span class="ident" id="4818267">bitLen</span><span class="op" id="4818273">(</span><span class="op" id="4818274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818277">if</span>&nbsp;<span class="ident" id="4818280">alen</span>&nbsp;<span class="op" id="4818285">==</span>&nbsp;<span class="num" id="4818288">0</span>&nbsp;<span class="op" id="4818290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818294">return</span>&nbsp;<span class="num" id="4818301">0</span><span class="op" id="4818302">,</span>&nbsp;<span class="builtintype" id="4818304">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818313">blen</span>&nbsp;<span class="op" id="4818318">:=</span>&nbsp;<span class="ident" id="4818321">b</span><span class="op" id="4818322">.</span><span class="ident" id="4818323">bitLen</span><span class="op" id="4818329">(</span><span class="op" id="4818330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818333">if</span>&nbsp;<span class="ident" id="4818336">blen</span>&nbsp;<span class="op" id="4818341">==</span>&nbsp;<span class="num" id="4818344">0</span>&nbsp;<span class="op" id="4818346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4818350">panic</span><span class="op" id="4818355">(</span><span class="string" id="4818356">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4818374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818377">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818381">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818461">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818541">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818613">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818675">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818737">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818804">exp</span>&nbsp;<span class="op" id="4818808">:=</span>&nbsp;<span class="ident" id="4818811">alen</span>&nbsp;<span class="op" id="4818816">-</span>&nbsp;<span class="ident" id="4818818">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818824">var</span>&nbsp;<span class="ident" id="4818828">a2</span><span class="op" id="4818830">,</span>&nbsp;<span class="ident" id="4818832">b2</span>&nbsp;<span class="ident" id="4818835">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818840">a2</span>&nbsp;<span class="op" id="4818843">=</span>&nbsp;<span class="ident" id="4818845">a2</span><span class="op" id="4818847">.</span><span class="ident" id="4818848">set</span><span class="op" id="4818851">(</span><span class="ident" id="4818852">a</span><span class="op" id="4818853">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818856">b2</span>&nbsp;<span class="op" id="4818859">=</span>&nbsp;<span class="ident" id="4818861">b2</span><span class="op" id="4818863">.</span><span class="ident" id="4818864">set</span><span class="op" id="4818867">(</span><span class="ident" id="4818868">b</span><span class="op" id="4818869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818872">if</span>&nbsp;<span class="ident" id="4818875">shift</span>&nbsp;<span class="op" id="4818881">:=</span>&nbsp;<span class="ident" id="4818884">Msize2</span>&nbsp;<span class="op" id="4818891">-</span>&nbsp;<span class="ident" id="4818893">exp</span><span class="op" id="4818896">;</span>&nbsp;<span class="ident" id="4818898">shift</span>&nbsp;<span class="op" id="4818904">&gt;</span>&nbsp;<span class="num" id="4818906">0</span>&nbsp;<span class="op" id="4818908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818912">a2</span>&nbsp;<span class="op" id="4818915">=</span>&nbsp;<span class="ident" id="4818917">a2</span><span class="op" id="4818919">.</span><span class="ident" id="4818920">shl</span><span class="op" id="4818923">(</span><span class="ident" id="4818924">a2</span><span class="op" id="4818926">,</span>&nbsp;<span class="builtintype" id="4818928">uint</span><span class="op" id="4818932">(</span><span class="ident" id="4818933">shift</span><span class="op" id="4818938">)</span><span class="op" id="4818939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818942">}</span>&nbsp;<span class="keyword" id="4818944">else</span>&nbsp;<span class="keyword" id="4818949">if</span>&nbsp;<span class="ident" id="4818952">shift</span>&nbsp;<span class="op" id="4818958">&lt;</span>&nbsp;<span class="num" id="4818960">0</span>&nbsp;<span class="op" id="4818962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818966">b2</span>&nbsp;<span class="op" id="4818969">=</span>&nbsp;<span class="ident" id="4818971">b2</span><span class="op" id="4818973">.</span><span class="ident" id="4818974">shl</span><span class="op" id="4818977">(</span><span class="ident" id="4818978">b2</span><span class="op" id="4818980">,</span>&nbsp;<span class="builtintype" id="4818982">uint</span><span class="op" id="4818986">(</span><span class="op" id="4818987">-</span><span class="ident" id="4818988">shift</span><span class="op" id="4818993">)</span><span class="op" id="4818994">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819001">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819063">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819120">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819145">var</span>&nbsp;<span class="ident" id="4819149">q</span>&nbsp;<span class="ident" id="4819151">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819156">q</span><span class="op" id="4819157">,</span>&nbsp;<span class="ident" id="4819159">r</span>&nbsp;<span class="op" id="4819161">:=</span>&nbsp;<span class="ident" id="4819164">q</span><span class="op" id="4819165">.</span><span class="ident" id="4819166">div</span><span class="op" id="4819169">(</span><span class="ident" id="4819170">a2</span><span class="op" id="4819172">,</span>&nbsp;<span class="ident" id="4819174">a2</span><span class="op" id="4819176">,</span>&nbsp;<span class="ident" id="4819178">b2</span><span class="op" id="4819180">)</span>&nbsp;<span class="comment" id="4819182">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819199">mantissa</span>&nbsp;<span class="op" id="4819208">:=</span>&nbsp;<span class="ident" id="4819211">low64</span><span class="op" id="4819216">(</span><span class="ident" id="4819217">q</span><span class="op" id="4819218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819221">haveRem</span>&nbsp;<span class="op" id="4819229">:=</span>&nbsp;<span class="builtinfunc" id="4819232">len</span><span class="op" id="4819235">(</span><span class="ident" id="4819236">r</span><span class="op" id="4819237">)</span>&nbsp;<span class="op" id="4819239">&gt;</span>&nbsp;<span class="num" id="4819241">0</span>&nbsp;<span class="comment" id="4819243">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819300">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819369">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819421">if</span>&nbsp;<span class="ident" id="4819424">mantissa</span><span class="op" id="4819432">&gt;&gt;</span><span class="ident" id="4819434">Msize2</span>&nbsp;<span class="op" id="4819441">==</span>&nbsp;<span class="num" id="4819444">1</span>&nbsp;<span class="op" id="4819446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819450">if</span>&nbsp;<span class="ident" id="4819453">mantissa</span><span class="op" id="4819461">&amp;</span><span class="num" id="4819462">1</span>&nbsp;<span class="op" id="4819464">==</span>&nbsp;<span class="num" id="4819467">1</span>&nbsp;<span class="op" id="4819469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819474">haveRem</span>&nbsp;<span class="op" id="4819482">=</span>&nbsp;<span class="builtintype" id="4819484">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819495">mantissa</span>&nbsp;<span class="op" id="4819504">&gt;&gt;=</span>&nbsp;<span class="num" id="4819508">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819512">exp</span><span class="op" id="4819515">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819522">if</span>&nbsp;<span class="ident" id="4819525">mantissa</span><span class="op" id="4819533">&gt;&gt;</span><span class="ident" id="4819535">Msize1</span>&nbsp;<span class="op" id="4819542">!=</span>&nbsp;<span class="num" id="4819545">1</span>&nbsp;<span class="op" id="4819547">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4819551">panic</span><span class="op" id="4819556">(</span><span class="ident" id="4819557">fmt</span><span class="op" id="4819560">.</span><span class="ident" id="4819561">Sprintf</span><span class="op" id="4819568">(</span><span class="string" id="4819569">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4819605">,</span>&nbsp;<span class="ident" id="4819607">Msize2</span><span class="op" id="4819613">)</span><span class="op" id="4819614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819621">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819638">if</span>&nbsp;<span class="ident" id="4819641">Emin</span><span class="op" id="4819645">-</span><span class="ident" id="4819646">Msize</span>&nbsp;<span class="op" id="4819652">&lt;=</span>&nbsp;<span class="ident" id="4819655">exp</span>&nbsp;<span class="op" id="4819659">&amp;&amp;</span>&nbsp;<span class="ident" id="4819662">exp</span>&nbsp;<span class="op" id="4819666">&lt;=</span>&nbsp;<span class="ident" id="4819669">Emin</span>&nbsp;<span class="op" id="4819674">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819678">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819730">shift</span>&nbsp;<span class="op" id="4819736">:=</span>&nbsp;<span class="builtintype" id="4819739">uint</span><span class="op" id="4819743">(</span><span class="ident" id="4819744">Emin</span>&nbsp;<span class="op" id="4819749">-</span>&nbsp;<span class="op" id="4819751">(</span><span class="ident" id="4819752">exp</span>&nbsp;<span class="op" id="4819756">-</span>&nbsp;<span class="num" id="4819758">1</span><span class="op" id="4819759">)</span><span class="op" id="4819760">)</span>&nbsp;<span class="comment" id="4819762">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819779">lostbits</span>&nbsp;<span class="op" id="4819788">:=</span>&nbsp;<span class="ident" id="4819791">mantissa</span>&nbsp;<span class="op" id="4819800">&amp;</span>&nbsp;<span class="op" id="4819802">(</span><span class="num" id="4819803">1</span><span class="op" id="4819804">&lt;&lt;</span><span class="ident" id="4819806">shift</span>&nbsp;<span class="op" id="4819812">-</span>&nbsp;<span class="num" id="4819814">1</span><span class="op" id="4819815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819819">haveRem</span>&nbsp;<span class="op" id="4819827">=</span>&nbsp;<span class="ident" id="4819829">haveRem</span>&nbsp;<span class="op" id="4819837">||</span>&nbsp;<span class="ident" id="4819840">lostbits</span>&nbsp;<span class="op" id="4819849">!=</span>&nbsp;<span class="num" id="4819852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819856">mantissa</span>&nbsp;<span class="op" id="4819865">&gt;&gt;=</span>&nbsp;<span class="ident" id="4819869">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819877">exp</span>&nbsp;<span class="op" id="4819881">=</span>&nbsp;<span class="num" id="4819883">2</span>&nbsp;<span class="op" id="4819885">-</span>&nbsp;<span class="ident" id="4819887">Ebias</span>&nbsp;<span class="comment" id="4819893">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819915">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819953">exact</span>&nbsp;<span class="op" id="4819959">=</span>&nbsp;<span class="op" id="4819961">!</span><span class="ident" id="4819962">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819971">if</span>&nbsp;<span class="ident" id="4819974">mantissa</span><span class="op" id="4819982">&amp;</span><span class="num" id="4819983">1</span>&nbsp;<span class="op" id="4819985">!=</span>&nbsp;<span class="num" id="4819988">0</span>&nbsp;<span class="op" id="4819990">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819994">exact</span>&nbsp;<span class="op" id="4820000">=</span>&nbsp;<span class="builtintype" id="4820002">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820010">if</span>&nbsp;<span class="ident" id="4820013">haveRem</span>&nbsp;<span class="op" id="4820021">||</span>&nbsp;<span class="ident" id="4820024">mantissa</span><span class="op" id="4820032">&amp;</span><span class="num" id="4820033">2</span>&nbsp;<span class="op" id="4820035">!=</span>&nbsp;<span class="num" id="4820038">0</span>&nbsp;<span class="op" id="4820040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820045">if</span>&nbsp;<span class="ident" id="4820048">mantissa</span><span class="op" id="4820056">++</span><span class="op" id="4820058">;</span>&nbsp;<span class="ident" id="4820060">mantissa</span>&nbsp;<span class="op" id="4820069">&gt;=</span>&nbsp;<span class="num" id="4820072">1</span><span class="op" id="4820073">&lt;&lt;</span><span class="ident" id="4820075">Msize2</span>&nbsp;<span class="op" id="4820082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4820088">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820149">mantissa</span>&nbsp;<span class="op" id="4820158">&gt;&gt;=</span>&nbsp;<span class="num" id="4820162">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820168">exp</span><span class="op" id="4820171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820187">mantissa</span>&nbsp;<span class="op" id="4820196">&gt;&gt;=</span>&nbsp;<span class="num" id="4820200">1</span>&nbsp;<span class="comment" id="4820202">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820264">f</span>&nbsp;<span class="op" id="4820266">=</span>&nbsp;<span class="ident" id="4820268">math</span><span class="op" id="4820272">.</span><span class="ident" id="4820273">Ldexp</span><span class="op" id="4820278">(</span><span class="builtintype" id="4820279">float64</span><span class="op" id="4820286">(</span><span class="ident" id="4820287">mantissa</span><span class="op" id="4820295">)</span><span class="op" id="4820296">,</span>&nbsp;<span class="ident" id="4820298">exp</span><span class="op" id="4820301">-</span><span class="ident" id="4820302">Msize1</span><span class="op" id="4820308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820311">if</span>&nbsp;<span class="ident" id="4820314">math</span><span class="op" id="4820318">.</span><span class="ident" id="4820319">IsInf</span><span class="op" id="4820324">(</span><span class="ident" id="4820325">f</span><span class="op" id="4820326">,</span>&nbsp;<span class="num" id="4820328">0</span><span class="op" id="4820329">)</span>&nbsp;<span class="op" id="4820331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820335">exact</span>&nbsp;<span class="op" id="4820341">=</span>&nbsp;<span class="builtintype" id="4820343">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820350">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820353">return</span><br>
<span class="lineno"></span><span class="op" id="4820360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820363">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4820436">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="4820509">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4820578">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4820641">func</span>&nbsp;<span class="op" id="4820646">(</span><span class="ident" id="4820647">x</span>&nbsp;<span class="op" id="4820649">*</span><span class="ident" id="4820650">Rat</span><span class="op" id="4820653">)</span>&nbsp;<span class="ident" id="4820655">Float32</span><span class="op" id="4820662">(</span><span class="op" id="4820663">)</span>&nbsp;<span class="op" id="4820665">(</span><span class="ident" id="4820666">f</span>&nbsp;<span class="builtintype" id="4820668">float32</span><span class="op" id="4820675">,</span>&nbsp;<span class="ident" id="4820677">exact</span>&nbsp;<span class="builtintype" id="4820683">bool</span><span class="op" id="4820687">)</span>&nbsp;<span class="op" id="4820689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820692">b</span>&nbsp;<span class="op" id="4820694">:=</span>&nbsp;<span class="ident" id="4820697">x</span><span class="op" id="4820698">.</span><span class="ident" id="4820699">b</span><span class="op" id="4820700">.</span><span class="ident" id="4820701">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820706">if</span>&nbsp;<span class="builtinfunc" id="4820709">len</span><span class="op" id="4820712">(</span><span class="ident" id="4820713">b</span><span class="op" id="4820714">)</span>&nbsp;<span class="op" id="4820716">==</span>&nbsp;<span class="num" id="4820719">0</span>&nbsp;<span class="op" id="4820721">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820725">b</span>&nbsp;<span class="op" id="4820727">=</span>&nbsp;<span class="ident" id="4820729">b</span><span class="op" id="4820730">.</span><span class="ident" id="4820731">set</span><span class="op" id="4820734">(</span><span class="ident" id="4820735">natOne</span><span class="op" id="4820741">)</span>&nbsp;<span class="comment" id="4820743">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820774">f</span><span class="op" id="4820775">,</span>&nbsp;<span class="ident" id="4820777">exact</span>&nbsp;<span class="op" id="4820783">=</span>&nbsp;<span class="ident" id="4820785">quotToFloat32</span><span class="op" id="4820798">(</span><span class="ident" id="4820799">x</span><span class="op" id="4820800">.</span><span class="ident" id="4820801">a</span><span class="op" id="4820802">.</span><span class="ident" id="4820803">abs</span><span class="op" id="4820806">,</span>&nbsp;<span class="ident" id="4820808">b</span><span class="op" id="4820809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820812">if</span>&nbsp;<span class="ident" id="4820815">x</span><span class="op" id="4820816">.</span><span class="ident" id="4820817">a</span><span class="op" id="4820818">.</span><span class="ident" id="4820819">neg</span>&nbsp;<span class="op" id="4820823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820827">f</span>&nbsp;<span class="op" id="4820829">=</span>&nbsp;<span class="op" id="4820831">-</span><span class="ident" id="4820832">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820838">return</span><br>
<span class="lineno"></span><span class="op" id="4820845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820848">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="4820921">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4820994">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4821063">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4821126">func</span>&nbsp;<span class="op" id="4821131">(</span><span class="ident" id="4821132">x</span>&nbsp;<span class="op" id="4821134">*</span><span class="ident" id="4821135">Rat</span><span class="op" id="4821138">)</span>&nbsp;<span class="ident" id="4821140">Float64</span><span class="op" id="4821147">(</span><span class="op" id="4821148">)</span>&nbsp;<span class="op" id="4821150">(</span><span class="ident" id="4821151">f</span>&nbsp;<span class="builtintype" id="4821153">float64</span><span class="op" id="4821160">,</span>&nbsp;<span class="ident" id="4821162">exact</span>&nbsp;<span class="builtintype" id="4821168">bool</span><span class="op" id="4821172">)</span>&nbsp;<span class="op" id="4821174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821177">b</span>&nbsp;<span class="op" id="4821179">:=</span>&nbsp;<span class="ident" id="4821182">x</span><span class="op" id="4821183">.</span><span class="ident" id="4821184">b</span><span class="op" id="4821185">.</span><span class="ident" id="4821186">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821191">if</span>&nbsp;<span class="builtinfunc" id="4821194">len</span><span class="op" id="4821197">(</span><span class="ident" id="4821198">b</span><span class="op" id="4821199">)</span>&nbsp;<span class="op" id="4821201">==</span>&nbsp;<span class="num" id="4821204">0</span>&nbsp;<span class="op" id="4821206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821210">b</span>&nbsp;<span class="op" id="4821212">=</span>&nbsp;<span class="ident" id="4821214">b</span><span class="op" id="4821215">.</span><span class="ident" id="4821216">set</span><span class="op" id="4821219">(</span><span class="ident" id="4821220">natOne</span><span class="op" id="4821226">)</span>&nbsp;<span class="comment" id="4821228">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821259">f</span><span class="op" id="4821260">,</span>&nbsp;<span class="ident" id="4821262">exact</span>&nbsp;<span class="op" id="4821268">=</span>&nbsp;<span class="ident" id="4821270">quotToFloat64</span><span class="op" id="4821283">(</span><span class="ident" id="4821284">x</span><span class="op" id="4821285">.</span><span class="ident" id="4821286">a</span><span class="op" id="4821287">.</span><span class="ident" id="4821288">abs</span><span class="op" id="4821291">,</span>&nbsp;<span class="ident" id="4821293">b</span><span class="op" id="4821294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821297">if</span>&nbsp;<span class="ident" id="4821300">x</span><span class="op" id="4821301">.</span><span class="ident" id="4821302">a</span><span class="op" id="4821303">.</span><span class="ident" id="4821304">neg</span>&nbsp;<span class="op" id="4821308">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821312">f</span>&nbsp;<span class="op" id="4821314">=</span>&nbsp;<span class="op" id="4821316">-</span><span class="ident" id="4821317">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821323">return</span><br>
<span class="lineno"></span><span class="op" id="4821330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="4821333">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4821373">func</span>&nbsp;<span class="op" id="4821378">(</span><span class="ident" id="4821379">z</span>&nbsp;<span class="op" id="4821381">*</span><span class="ident" id="4821382">Rat</span><span class="op" id="4821385">)</span>&nbsp;<span class="ident" id="4821387">SetFrac</span><span class="op" id="4821394">(</span><span class="ident" id="4821395">a</span><span class="op" id="4821396">,</span>&nbsp;<span class="ident" id="4821398">b</span>&nbsp;<span class="op" id="4821400">*</span><span class="ident" id="4821401">Int</span><span class="op" id="4821404">)</span>&nbsp;<span class="op" id="4821406">*</span><span class="ident" id="4821407">Rat</span>&nbsp;<span class="op" id="4821411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821414">z</span><span class="op" id="4821415">.</span><span class="ident" id="4821416">a</span><span class="op" id="4821417">.</span><span class="ident" id="4821418">neg</span>&nbsp;<span class="op" id="4821422">=</span>&nbsp;<span class="ident" id="4821424">a</span><span class="op" id="4821425">.</span><span class="ident" id="4821426">neg</span>&nbsp;<span class="op" id="4821430">!=</span>&nbsp;<span class="ident" id="4821433">b</span><span class="op" id="4821434">.</span><span class="ident" id="4821435">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821440">babs</span>&nbsp;<span class="op" id="4821445">:=</span>&nbsp;<span class="ident" id="4821448">b</span><span class="op" id="4821449">.</span><span class="ident" id="4821450">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821455">if</span>&nbsp;<span class="builtinfunc" id="4821458">len</span><span class="op" id="4821461">(</span><span class="ident" id="4821462">babs</span><span class="op" id="4821466">)</span>&nbsp;<span class="op" id="4821468">==</span>&nbsp;<span class="num" id="4821471">0</span>&nbsp;<span class="op" id="4821473">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4821477">panic</span><span class="op" id="4821482">(</span><span class="string" id="4821483">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4821501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821507">if</span>&nbsp;<span class="op" id="4821510">&amp;</span><span class="ident" id="4821511">z</span><span class="op" id="4821512">.</span><span class="ident" id="4821513">a</span>&nbsp;<span class="op" id="4821515">==</span>&nbsp;<span class="ident" id="4821518">b</span>&nbsp;<span class="op" id="4821520">||</span>&nbsp;<span class="ident" id="4821523">alias</span><span class="op" id="4821528">(</span><span class="ident" id="4821529">z</span><span class="op" id="4821530">.</span><span class="ident" id="4821531">a</span><span class="op" id="4821532">.</span><span class="ident" id="4821533">abs</span><span class="op" id="4821536">,</span>&nbsp;<span class="ident" id="4821538">babs</span><span class="op" id="4821542">)</span>&nbsp;<span class="op" id="4821544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821548">babs</span>&nbsp;<span class="op" id="4821553">=</span>&nbsp;<span class="ident" id="4821555">nat</span><span class="op" id="4821558">(</span><span class="ident" id="4821559">nil</span><span class="op" id="4821562">)</span><span class="op" id="4821563">.</span><span class="ident" id="4821564">set</span><span class="op" id="4821567">(</span><span class="ident" id="4821568">babs</span><span class="op" id="4821572">)</span>&nbsp;<span class="comment" id="4821574">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821590">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821593">z</span><span class="op" id="4821594">.</span><span class="ident" id="4821595">a</span><span class="op" id="4821596">.</span><span class="ident" id="4821597">abs</span>&nbsp;<span class="op" id="4821601">=</span>&nbsp;<span class="ident" id="4821603">z</span><span class="op" id="4821604">.</span><span class="ident" id="4821605">a</span><span class="op" id="4821606">.</span><span class="ident" id="4821607">abs</span><span class="op" id="4821610">.</span><span class="ident" id="4821611">set</span><span class="op" id="4821614">(</span><span class="ident" id="4821615">a</span><span class="op" id="4821616">.</span><span class="ident" id="4821617">abs</span><span class="op" id="4821620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821623">z</span><span class="op" id="4821624">.</span><span class="ident" id="4821625">b</span><span class="op" id="4821626">.</span><span class="ident" id="4821627">abs</span>&nbsp;<span class="op" id="4821631">=</span>&nbsp;<span class="ident" id="4821633">z</span><span class="op" id="4821634">.</span><span class="ident" id="4821635">b</span><span class="op" id="4821636">.</span><span class="ident" id="4821637">abs</span><span class="op" id="4821640">.</span><span class="ident" id="4821641">set</span><span class="op" id="4821644">(</span><span class="ident" id="4821645">babs</span><span class="op" id="4821649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821652">return</span>&nbsp;<span class="ident" id="4821659">z</span><span class="op" id="4821660">.</span><span class="ident" id="4821661">norm</span><span class="op" id="4821665">(</span><span class="op" id="4821666">)</span><br>
<span class="lineno"></span><span class="op" id="4821668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4821671">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4821713">func</span>&nbsp;<span class="op" id="4821718">(</span><span class="ident" id="4821719">z</span>&nbsp;<span class="op" id="4821721">*</span><span class="ident" id="4821722">Rat</span><span class="op" id="4821725">)</span>&nbsp;<span class="ident" id="4821727">SetFrac64</span><span class="op" id="4821736">(</span><span class="ident" id="4821737">a</span><span class="op" id="4821738">,</span>&nbsp;<span class="ident" id="4821740">b</span>&nbsp;<span class="ident" id="4821742">int64</span><span class="op" id="4821747">)</span>&nbsp;<span class="op" id="4821749">*</span><span class="ident" id="4821750">Rat</span>&nbsp;<span class="op" id="4821754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821757">z</span><span class="op" id="4821758">.</span><span class="ident" id="4821759">a</span><span class="op" id="4821760">.</span><span class="ident" id="4821761">SetInt64</span><span class="op" id="4821769">(</span><span class="ident" id="4821770">a</span><span class="op" id="4821771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821774">if</span>&nbsp;<span class="ident" id="4821777">b</span>&nbsp;<span class="op" id="4821779">==</span>&nbsp;<span class="num" id="4821782">0</span>&nbsp;<span class="op" id="4821784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4821788">panic</span><span class="op" id="4821793">(</span><span class="string" id="4821794">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4821812">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821818">if</span>&nbsp;<span class="ident" id="4821821">b</span>&nbsp;<span class="op" id="4821823">&lt;</span>&nbsp;<span class="num" id="4821825">0</span>&nbsp;<span class="op" id="4821827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821831">b</span>&nbsp;<span class="op" id="4821833">=</span>&nbsp;<span class="op" id="4821835">-</span><span class="ident" id="4821836">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821840">z</span><span class="op" id="4821841">.</span><span class="ident" id="4821842">a</span><span class="op" id="4821843">.</span><span class="ident" id="4821844">neg</span>&nbsp;<span class="op" id="4821848">=</span>&nbsp;<span class="op" id="4821850">!</span><span class="ident" id="4821851">z</span><span class="op" id="4821852">.</span><span class="ident" id="4821853">a</span><span class="op" id="4821854">.</span><span class="ident" id="4821855">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821860">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821863">z</span><span class="op" id="4821864">.</span><span class="ident" id="4821865">b</span><span class="op" id="4821866">.</span><span class="ident" id="4821867">abs</span>&nbsp;<span class="op" id="4821871">=</span>&nbsp;<span class="ident" id="4821873">z</span><span class="op" id="4821874">.</span><span class="ident" id="4821875">b</span><span class="op" id="4821876">.</span><span class="ident" id="4821877">abs</span><span class="op" id="4821880">.</span><span class="ident" id="4821881">setUint64</span><span class="op" id="4821890">(</span><span class="ident" id="4821891">uint64</span><span class="op" id="4821897">(</span><span class="ident" id="4821898">b</span><span class="op" id="4821899">)</span><span class="op" id="4821900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821903">return</span>&nbsp;<span class="ident" id="4821910">z</span><span class="op" id="4821911">.</span><span class="ident" id="4821912">norm</span><span class="op" id="4821916">(</span><span class="op" id="4821917">)</span><br>
<span class="lineno"></span><span class="op" id="4821919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821922">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="4821983">func</span>&nbsp;<span class="op" id="4821988">(</span><span class="ident" id="4821989">z</span>&nbsp;<span class="op" id="4821991">*</span><span class="ident" id="4821992">Rat</span><span class="op" id="4821995">)</span>&nbsp;<span class="ident" id="4821997">SetInt</span><span class="op" id="4822003">(</span><span class="ident" id="4822004">x</span>&nbsp;<span class="op" id="4822006">*</span><span class="ident" id="4822007">Int</span><span class="op" id="4822010">)</span>&nbsp;<span class="op" id="4822012">*</span><span class="ident" id="4822013">Rat</span>&nbsp;<span class="op" id="4822017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822020">z</span><span class="op" id="4822021">.</span><span class="ident" id="4822022">a</span><span class="op" id="4822023">.</span><span class="ident" id="4822024">Set</span><span class="op" id="4822027">(</span><span class="ident" id="4822028">x</span><span class="op" id="4822029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822032">z</span><span class="op" id="4822033">.</span><span class="ident" id="4822034">b</span><span class="op" id="4822035">.</span><span class="ident" id="4822036">abs</span>&nbsp;<span class="op" id="4822040">=</span>&nbsp;<span class="ident" id="4822042">z</span><span class="op" id="4822043">.</span><span class="ident" id="4822044">b</span><span class="op" id="4822045">.</span><span class="ident" id="4822046">abs</span><span class="op" id="4822049">.</span><span class="builtinfunc" id="4822050">make</span><span class="op" id="4822054">(</span><span class="num" id="4822055">0</span><span class="op" id="4822056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822059">return</span>&nbsp;<span class="ident" id="4822066">z</span><br>
<span class="lineno"></span><span class="op" id="4822068">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4822071">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4822110">func</span>&nbsp;<span class="op" id="4822115">(</span><span class="ident" id="4822116">z</span>&nbsp;<span class="op" id="4822118">*</span><span class="ident" id="4822119">Rat</span><span class="op" id="4822122">)</span>&nbsp;<span class="ident" id="4822124">SetInt64</span><span class="op" id="4822132">(</span><span class="ident" id="4822133">x</span>&nbsp;<span class="ident" id="4822135">int64</span><span class="op" id="4822140">)</span>&nbsp;<span class="op" id="4822142">*</span><span class="ident" id="4822143">Rat</span>&nbsp;<span class="op" id="4822147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822150">z</span><span class="op" id="4822151">.</span><span class="ident" id="4822152">a</span><span class="op" id="4822153">.</span><span class="ident" id="4822154">SetInt64</span><span class="op" id="4822162">(</span><span class="ident" id="4822163">x</span><span class="op" id="4822164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822167">z</span><span class="op" id="4822168">.</span><span class="ident" id="4822169">b</span><span class="op" id="4822170">.</span><span class="ident" id="4822171">abs</span>&nbsp;<span class="op" id="4822175">=</span>&nbsp;<span class="ident" id="4822177">z</span><span class="op" id="4822178">.</span><span class="ident" id="4822179">b</span><span class="op" id="4822180">.</span><span class="ident" id="4822181">abs</span><span class="op" id="4822184">.</span><span class="builtinfunc" id="4822185">make</span><span class="op" id="4822189">(</span><span class="num" id="4822190">0</span><span class="op" id="4822191">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822194">return</span>&nbsp;<span class="ident" id="4822201">z</span><br>
<span class="lineno"></span><span class="op" id="4822203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822206">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4822264">func</span>&nbsp;<span class="op" id="4822269">(</span><span class="ident" id="4822270">z</span>&nbsp;<span class="op" id="4822272">*</span><span class="ident" id="4822273">Rat</span><span class="op" id="4822276">)</span>&nbsp;<span class="ident" id="4822278">Set</span><span class="op" id="4822281">(</span><span class="ident" id="4822282">x</span>&nbsp;<span class="op" id="4822284">*</span><span class="ident" id="4822285">Rat</span><span class="op" id="4822288">)</span>&nbsp;<span class="op" id="4822290">*</span><span class="ident" id="4822291">Rat</span>&nbsp;<span class="op" id="4822295">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822298">if</span>&nbsp;<span class="ident" id="4822301">z</span>&nbsp;<span class="op" id="4822303">!=</span>&nbsp;<span class="ident" id="4822306">x</span>&nbsp;<span class="op" id="4822308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822312">z</span><span class="op" id="4822313">.</span><span class="ident" id="4822314">a</span><span class="op" id="4822315">.</span><span class="ident" id="4822316">Set</span><span class="op" id="4822319">(</span><span class="op" id="4822320">&amp;</span><span class="ident" id="4822321">x</span><span class="op" id="4822322">.</span><span class="ident" id="4822323">a</span><span class="op" id="4822324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822328">z</span><span class="op" id="4822329">.</span><span class="ident" id="4822330">b</span><span class="op" id="4822331">.</span><span class="ident" id="4822332">Set</span><span class="op" id="4822335">(</span><span class="op" id="4822336">&amp;</span><span class="ident" id="4822337">x</span><span class="op" id="4822338">.</span><span class="ident" id="4822339">b</span><span class="op" id="4822340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822346">return</span>&nbsp;<span class="ident" id="4822353">z</span><br>
<span class="lineno">345</span><span class="op" id="4822355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822358">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4822420">func</span>&nbsp;<span class="op" id="4822425">(</span><span class="ident" id="4822426">z</span>&nbsp;<span class="op" id="4822428">*</span><span class="ident" id="4822429">Rat</span><span class="op" id="4822432">)</span>&nbsp;<span class="ident" id="4822434">Abs</span><span class="op" id="4822437">(</span><span class="ident" id="4822438">x</span>&nbsp;<span class="op" id="4822440">*</span><span class="ident" id="4822441">Rat</span><span class="op" id="4822444">)</span>&nbsp;<span class="op" id="4822446">*</span><span class="ident" id="4822447">Rat</span>&nbsp;<span class="op" id="4822451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822454">z</span><span class="op" id="4822455">.</span><span class="ident" id="4822456">Set</span><span class="op" id="4822459">(</span><span class="ident" id="4822460">x</span><span class="op" id="4822461">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822464">z</span><span class="op" id="4822465">.</span><span class="ident" id="4822466">a</span><span class="op" id="4822467">.</span><span class="ident" id="4822468">neg</span>&nbsp;<span class="op" id="4822472">=</span>&nbsp;<span class="builtintype" id="4822474">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822481">return</span>&nbsp;<span class="ident" id="4822488">z</span><br>
<span class="lineno"></span><span class="op" id="4822490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822493">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="4822528">func</span>&nbsp;<span class="op" id="4822533">(</span><span class="ident" id="4822534">z</span>&nbsp;<span class="op" id="4822536">*</span><span class="ident" id="4822537">Rat</span><span class="op" id="4822540">)</span>&nbsp;<span class="ident" id="4822542">Neg</span><span class="op" id="4822545">(</span><span class="ident" id="4822546">x</span>&nbsp;<span class="op" id="4822548">*</span><span class="ident" id="4822549">Rat</span><span class="op" id="4822552">)</span>&nbsp;<span class="op" id="4822554">*</span><span class="ident" id="4822555">Rat</span>&nbsp;<span class="op" id="4822559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822562">z</span><span class="op" id="4822563">.</span><span class="ident" id="4822564">Set</span><span class="op" id="4822567">(</span><span class="ident" id="4822568">x</span><span class="op" id="4822569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822572">z</span><span class="op" id="4822573">.</span><span class="ident" id="4822574">a</span><span class="op" id="4822575">.</span><span class="ident" id="4822576">neg</span>&nbsp;<span class="op" id="4822580">=</span>&nbsp;<span class="builtinfunc" id="4822582">len</span><span class="op" id="4822585">(</span><span class="ident" id="4822586">z</span><span class="op" id="4822587">.</span><span class="ident" id="4822588">a</span><span class="op" id="4822589">.</span><span class="ident" id="4822590">abs</span><span class="op" id="4822593">)</span>&nbsp;<span class="op" id="4822595">&gt;</span>&nbsp;<span class="num" id="4822597">0</span>&nbsp;<span class="op" id="4822599">&amp;&amp;</span>&nbsp;<span class="op" id="4822602">!</span><span class="ident" id="4822603">z</span><span class="op" id="4822604">.</span><span class="ident" id="4822605">a</span><span class="op" id="4822606">.</span><span class="ident" id="4822607">neg</span>&nbsp;<span class="comment" id="4822611">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822629">return</span>&nbsp;<span class="ident" id="4822636">z</span><br>
<span class="lineno"></span><span class="op" id="4822638">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4822641">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4822677">func</span>&nbsp;<span class="op" id="4822682">(</span><span class="ident" id="4822683">z</span>&nbsp;<span class="op" id="4822685">*</span><span class="ident" id="4822686">Rat</span><span class="op" id="4822689">)</span>&nbsp;<span class="ident" id="4822691">Inv</span><span class="op" id="4822694">(</span><span class="ident" id="4822695">x</span>&nbsp;<span class="op" id="4822697">*</span><span class="ident" id="4822698">Rat</span><span class="op" id="4822701">)</span>&nbsp;<span class="op" id="4822703">*</span><span class="ident" id="4822704">Rat</span>&nbsp;<span class="op" id="4822708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822711">if</span>&nbsp;<span class="builtinfunc" id="4822714">len</span><span class="op" id="4822717">(</span><span class="ident" id="4822718">x</span><span class="op" id="4822719">.</span><span class="ident" id="4822720">a</span><span class="op" id="4822721">.</span><span class="ident" id="4822722">abs</span><span class="op" id="4822725">)</span>&nbsp;<span class="op" id="4822727">==</span>&nbsp;<span class="num" id="4822730">0</span>&nbsp;<span class="op" id="4822732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4822736">panic</span><span class="op" id="4822741">(</span><span class="string" id="4822742">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4822760">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822766">z</span><span class="op" id="4822767">.</span><span class="ident" id="4822768">Set</span><span class="op" id="4822771">(</span><span class="ident" id="4822772">x</span><span class="op" id="4822773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822776">a</span>&nbsp;<span class="op" id="4822778">:=</span>&nbsp;<span class="ident" id="4822781">z</span><span class="op" id="4822782">.</span><span class="ident" id="4822783">b</span><span class="op" id="4822784">.</span><span class="ident" id="4822785">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822790">if</span>&nbsp;<span class="builtinfunc" id="4822793">len</span><span class="op" id="4822796">(</span><span class="ident" id="4822797">a</span><span class="op" id="4822798">)</span>&nbsp;<span class="op" id="4822800">==</span>&nbsp;<span class="num" id="4822803">0</span>&nbsp;<span class="op" id="4822805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822809">a</span>&nbsp;<span class="op" id="4822811">=</span>&nbsp;<span class="ident" id="4822813">a</span><span class="op" id="4822814">.</span><span class="ident" id="4822815">set</span><span class="op" id="4822818">(</span><span class="ident" id="4822819">natOne</span><span class="op" id="4822825">)</span>&nbsp;<span class="comment" id="4822827">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822856">b</span>&nbsp;<span class="op" id="4822858">:=</span>&nbsp;<span class="ident" id="4822861">z</span><span class="op" id="4822862">.</span><span class="ident" id="4822863">a</span><span class="op" id="4822864">.</span><span class="ident" id="4822865">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822870">if</span>&nbsp;<span class="ident" id="4822873">b</span><span class="op" id="4822874">.</span><span class="ident" id="4822875">cmp</span><span class="op" id="4822878">(</span><span class="ident" id="4822879">natOne</span><span class="op" id="4822885">)</span>&nbsp;<span class="op" id="4822887">==</span>&nbsp;<span class="num" id="4822890">0</span>&nbsp;<span class="op" id="4822892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822896">b</span>&nbsp;<span class="op" id="4822898">=</span>&nbsp;<span class="ident" id="4822900">b</span><span class="op" id="4822901">.</span><span class="builtinfunc" id="4822902">make</span><span class="op" id="4822906">(</span><span class="num" id="4822907">0</span><span class="op" id="4822908">)</span>&nbsp;<span class="comment" id="4822910">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822936">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822939">z</span><span class="op" id="4822940">.</span><span class="ident" id="4822941">a</span><span class="op" id="4822942">.</span><span class="ident" id="4822943">abs</span><span class="op" id="4822946">,</span>&nbsp;<span class="ident" id="4822948">z</span><span class="op" id="4822949">.</span><span class="ident" id="4822950">b</span><span class="op" id="4822951">.</span><span class="ident" id="4822952">abs</span>&nbsp;<span class="op" id="4822956">=</span>&nbsp;<span class="ident" id="4822958">a</span><span class="op" id="4822959">,</span>&nbsp;<span class="ident" id="4822961">b</span>&nbsp;<span class="comment" id="4822963">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822987">return</span>&nbsp;<span class="ident" id="4822994">z</span><br>
<span class="lineno"></span><span class="op" id="4822996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822999">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="4823016">//</span><br>
<span class="lineno"></span><span class="comment" id="4823019">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4823035">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4823051">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4823067">//</span><br>
<span class="lineno">385</span><span class="keyword" id="4823070">func</span>&nbsp;<span class="op" id="4823075">(</span><span class="ident" id="4823076">x</span>&nbsp;<span class="op" id="4823078">*</span><span class="ident" id="4823079">Rat</span><span class="op" id="4823082">)</span>&nbsp;<span class="ident" id="4823084">Sign</span><span class="op" id="4823088">(</span><span class="op" id="4823089">)</span>&nbsp;<span class="builtintype" id="4823091">int</span>&nbsp;<span class="op" id="4823095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823098">return</span>&nbsp;<span class="ident" id="4823105">x</span><span class="op" id="4823106">.</span><span class="ident" id="4823107">a</span><span class="op" id="4823108">.</span><span class="ident" id="4823109">Sign</span><span class="op" id="4823113">(</span><span class="op" id="4823114">)</span><br>
<span class="lineno"></span><span class="op" id="4823116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823119">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="4823171">func</span>&nbsp;<span class="op" id="4823176">(</span><span class="ident" id="4823177">x</span>&nbsp;<span class="op" id="4823179">*</span><span class="ident" id="4823180">Rat</span><span class="op" id="4823183">)</span>&nbsp;<span class="ident" id="4823185">IsInt</span><span class="op" id="4823190">(</span><span class="op" id="4823191">)</span>&nbsp;<span class="builtintype" id="4823193">bool</span>&nbsp;<span class="op" id="4823198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823201">return</span>&nbsp;<span class="builtinfunc" id="4823208">len</span><span class="op" id="4823211">(</span><span class="ident" id="4823212">x</span><span class="op" id="4823213">.</span><span class="ident" id="4823214">b</span><span class="op" id="4823215">.</span><span class="ident" id="4823216">abs</span><span class="op" id="4823219">)</span>&nbsp;<span class="op" id="4823221">==</span>&nbsp;<span class="num" id="4823224">0</span>&nbsp;<span class="op" id="4823226">||</span>&nbsp;<span class="ident" id="4823229">x</span><span class="op" id="4823230">.</span><span class="ident" id="4823231">b</span><span class="op" id="4823232">.</span><span class="ident" id="4823233">abs</span><span class="op" id="4823236">.</span><span class="ident" id="4823237">cmp</span><span class="op" id="4823240">(</span><span class="ident" id="4823241">natOne</span><span class="op" id="4823247">)</span>&nbsp;<span class="op" id="4823249">==</span>&nbsp;<span class="num" id="4823252">0</span><br>
<span class="lineno"></span><span class="op" id="4823254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823257">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="4823308">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4823358">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="4823421">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4823480">func</span>&nbsp;<span class="op" id="4823485">(</span><span class="ident" id="4823486">x</span>&nbsp;<span class="op" id="4823488">*</span><span class="ident" id="4823489">Rat</span><span class="op" id="4823492">)</span>&nbsp;<span class="ident" id="4823494">Num</span><span class="op" id="4823497">(</span><span class="op" id="4823498">)</span>&nbsp;<span class="op" id="4823500">*</span><span class="ident" id="4823501">Int</span>&nbsp;<span class="op" id="4823505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823508">return</span>&nbsp;<span class="op" id="4823515">&amp;</span><span class="ident" id="4823516">x</span><span class="op" id="4823517">.</span><span class="ident" id="4823518">a</span><br>
<span class="lineno">400</span><span class="op" id="4823520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823523">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4823580">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4823632">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="4823695">func</span>&nbsp;<span class="op" id="4823700">(</span><span class="ident" id="4823701">x</span>&nbsp;<span class="op" id="4823703">*</span><span class="ident" id="4823704">Rat</span><span class="op" id="4823707">)</span>&nbsp;<span class="ident" id="4823709">Denom</span><span class="op" id="4823714">(</span><span class="op" id="4823715">)</span>&nbsp;<span class="op" id="4823717">*</span><span class="ident" id="4823718">Int</span>&nbsp;<span class="op" id="4823722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823725">x</span><span class="op" id="4823726">.</span><span class="ident" id="4823727">b</span><span class="op" id="4823728">.</span><span class="ident" id="4823729">neg</span>&nbsp;<span class="op" id="4823733">=</span>&nbsp;<span class="builtintype" id="4823735">false</span>&nbsp;<span class="comment" id="4823741">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823771">if</span>&nbsp;<span class="builtinfunc" id="4823774">len</span><span class="op" id="4823777">(</span><span class="ident" id="4823778">x</span><span class="op" id="4823779">.</span><span class="ident" id="4823780">b</span><span class="op" id="4823781">.</span><span class="ident" id="4823782">abs</span><span class="op" id="4823785">)</span>&nbsp;<span class="op" id="4823787">==</span>&nbsp;<span class="num" id="4823790">0</span>&nbsp;<span class="op" id="4823792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823796">x</span><span class="op" id="4823797">.</span><span class="ident" id="4823798">b</span><span class="op" id="4823799">.</span><span class="ident" id="4823800">abs</span>&nbsp;<span class="op" id="4823804">=</span>&nbsp;<span class="ident" id="4823806">x</span><span class="op" id="4823807">.</span><span class="ident" id="4823808">b</span><span class="op" id="4823809">.</span><span class="ident" id="4823810">abs</span><span class="op" id="4823813">.</span><span class="ident" id="4823814">set</span><span class="op" id="4823817">(</span><span class="ident" id="4823818">natOne</span><span class="op" id="4823824">)</span>&nbsp;<span class="comment" id="4823826">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823854">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823857">return</span>&nbsp;<span class="op" id="4823864">&amp;</span><span class="ident" id="4823865">x</span><span class="op" id="4823866">.</span><span class="ident" id="4823867">b</span><br>
<span class="lineno"></span><span class="op" id="4823869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823872">func</span>&nbsp;<span class="op" id="4823877">(</span><span class="ident" id="4823878">z</span>&nbsp;<span class="op" id="4823880">*</span><span class="ident" id="4823881">Rat</span><span class="op" id="4823884">)</span>&nbsp;<span class="ident" id="4823886">norm</span><span class="op" id="4823890">(</span><span class="op" id="4823891">)</span>&nbsp;<span class="op" id="4823893">*</span><span class="ident" id="4823894">Rat</span>&nbsp;<span class="op" id="4823898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823901">switch</span>&nbsp;<span class="op" id="4823908">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823911">case</span>&nbsp;<span class="builtinfunc" id="4823916">len</span><span class="op" id="4823919">(</span><span class="ident" id="4823920">z</span><span class="op" id="4823921">.</span><span class="ident" id="4823922">a</span><span class="op" id="4823923">.</span><span class="ident" id="4823924">abs</span><span class="op" id="4823927">)</span>&nbsp;<span class="op" id="4823929">==</span>&nbsp;<span class="num" id="4823932">0</span><span class="op" id="4823933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4823937">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823982">z</span><span class="op" id="4823983">.</span><span class="ident" id="4823984">a</span><span class="op" id="4823985">.</span><span class="ident" id="4823986">neg</span>&nbsp;<span class="op" id="4823990">=</span>&nbsp;<span class="builtintype" id="4823992">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824000">z</span><span class="op" id="4824001">.</span><span class="ident" id="4824002">b</span><span class="op" id="4824003">.</span><span class="ident" id="4824004">abs</span>&nbsp;<span class="op" id="4824008">=</span>&nbsp;<span class="ident" id="4824010">z</span><span class="op" id="4824011">.</span><span class="ident" id="4824012">b</span><span class="op" id="4824013">.</span><span class="ident" id="4824014">abs</span><span class="op" id="4824017">.</span><span class="builtinfunc" id="4824018">make</span><span class="op" id="4824022">(</span><span class="num" id="4824023">0</span><span class="op" id="4824024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824027">case</span>&nbsp;<span class="builtinfunc" id="4824032">len</span><span class="op" id="4824035">(</span><span class="ident" id="4824036">z</span><span class="op" id="4824037">.</span><span class="ident" id="4824038">b</span><span class="op" id="4824039">.</span><span class="ident" id="4824040">abs</span><span class="op" id="4824043">)</span>&nbsp;<span class="op" id="4824045">==</span>&nbsp;<span class="num" id="4824048">0</span><span class="op" id="4824049">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824053">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824093">case</span>&nbsp;<span class="ident" id="4824098">z</span><span class="op" id="4824099">.</span><span class="ident" id="4824100">b</span><span class="op" id="4824101">.</span><span class="ident" id="4824102">abs</span><span class="op" id="4824105">.</span><span class="ident" id="4824106">cmp</span><span class="op" id="4824109">(</span><span class="ident" id="4824110">natOne</span><span class="op" id="4824116">)</span>&nbsp;<span class="op" id="4824118">==</span>&nbsp;<span class="num" id="4824121">0</span><span class="op" id="4824122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824126">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824164">z</span><span class="op" id="4824165">.</span><span class="ident" id="4824166">b</span><span class="op" id="4824167">.</span><span class="ident" id="4824168">abs</span>&nbsp;<span class="op" id="4824172">=</span>&nbsp;<span class="ident" id="4824174">z</span><span class="op" id="4824175">.</span><span class="ident" id="4824176">b</span><span class="op" id="4824177">.</span><span class="ident" id="4824178">abs</span><span class="op" id="4824181">.</span><span class="builtinfunc" id="4824182">make</span><span class="op" id="4824186">(</span><span class="num" id="4824187">0</span><span class="op" id="4824188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824191">default</span><span class="op" id="4824198">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824202">neg</span>&nbsp;<span class="op" id="4824206">:=</span>&nbsp;<span class="ident" id="4824209">z</span><span class="op" id="4824210">.</span><span class="ident" id="4824211">a</span><span class="op" id="4824212">.</span><span class="ident" id="4824213">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824219">z</span><span class="op" id="4824220">.</span><span class="ident" id="4824221">a</span><span class="op" id="4824222">.</span><span class="ident" id="4824223">neg</span>&nbsp;<span class="op" id="4824227">=</span>&nbsp;<span class="builtintype" id="4824229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824237">z</span><span class="op" id="4824238">.</span><span class="ident" id="4824239">b</span><span class="op" id="4824240">.</span><span class="ident" id="4824241">neg</span>&nbsp;<span class="op" id="4824245">=</span>&nbsp;<span class="builtintype" id="4824247">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824255">if</span>&nbsp;<span class="ident" id="4824258">f</span>&nbsp;<span class="op" id="4824260">:=</span>&nbsp;<span class="ident" id="4824263">NewInt</span><span class="op" id="4824269">(</span><span class="num" id="4824270">0</span><span class="op" id="4824271">)</span><span class="op" id="4824272">.</span><span class="ident" id="4824273">binaryGCD</span><span class="op" id="4824282">(</span><span class="op" id="4824283">&amp;</span><span class="ident" id="4824284">z</span><span class="op" id="4824285">.</span><span class="ident" id="4824286">a</span><span class="op" id="4824287">,</span>&nbsp;<span class="op" id="4824289">&amp;</span><span class="ident" id="4824290">z</span><span class="op" id="4824291">.</span><span class="ident" id="4824292">b</span><span class="op" id="4824293">)</span><span class="op" id="4824294">;</span>&nbsp;<span class="ident" id="4824296">f</span><span class="op" id="4824297">.</span><span class="ident" id="4824298">Cmp</span><span class="op" id="4824301">(</span><span class="ident" id="4824302">intOne</span><span class="op" id="4824308">)</span>&nbsp;<span class="op" id="4824310">!=</span>&nbsp;<span class="num" id="4824313">0</span>&nbsp;<span class="op" id="4824315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824320">z</span><span class="op" id="4824321">.</span><span class="ident" id="4824322">a</span><span class="op" id="4824323">.</span><span class="ident" id="4824324">abs</span><span class="op" id="4824327">,</span>&nbsp;<span class="ident" id="4824329">_</span>&nbsp;<span class="op" id="4824331">=</span>&nbsp;<span class="ident" id="4824333">z</span><span class="op" id="4824334">.</span><span class="ident" id="4824335">a</span><span class="op" id="4824336">.</span><span class="ident" id="4824337">abs</span><span class="op" id="4824340">.</span><span class="ident" id="4824341">div</span><span class="op" id="4824344">(</span><span class="ident" id="4824345">nil</span><span class="op" id="4824348">,</span>&nbsp;<span class="ident" id="4824350">z</span><span class="op" id="4824351">.</span><span class="ident" id="4824352">a</span><span class="op" id="4824353">.</span><span class="ident" id="4824354">abs</span><span class="op" id="4824357">,</span>&nbsp;<span class="ident" id="4824359">f</span><span class="op" id="4824360">.</span><span class="ident" id="4824361">abs</span><span class="op" id="4824364">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824369">z</span><span class="op" id="4824370">.</span><span class="ident" id="4824371">b</span><span class="op" id="4824372">.</span><span class="ident" id="4824373">abs</span><span class="op" id="4824376">,</span>&nbsp;<span class="ident" id="4824378">_</span>&nbsp;<span class="op" id="4824380">=</span>&nbsp;<span class="ident" id="4824382">z</span><span class="op" id="4824383">.</span><span class="ident" id="4824384">b</span><span class="op" id="4824385">.</span><span class="ident" id="4824386">abs</span><span class="op" id="4824389">.</span><span class="ident" id="4824390">div</span><span class="op" id="4824393">(</span><span class="ident" id="4824394">nil</span><span class="op" id="4824397">,</span>&nbsp;<span class="ident" id="4824399">z</span><span class="op" id="4824400">.</span><span class="ident" id="4824401">b</span><span class="op" id="4824402">.</span><span class="ident" id="4824403">abs</span><span class="op" id="4824406">,</span>&nbsp;<span class="ident" id="4824408">f</span><span class="op" id="4824409">.</span><span class="ident" id="4824410">abs</span><span class="op" id="4824413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824418">if</span>&nbsp;<span class="ident" id="4824421">z</span><span class="op" id="4824422">.</span><span class="ident" id="4824423">b</span><span class="op" id="4824424">.</span><span class="ident" id="4824425">abs</span><span class="op" id="4824428">.</span><span class="ident" id="4824429">cmp</span><span class="op" id="4824432">(</span><span class="ident" id="4824433">natOne</span><span class="op" id="4824439">)</span>&nbsp;<span class="op" id="4824441">==</span>&nbsp;<span class="num" id="4824444">0</span>&nbsp;<span class="op" id="4824446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824452">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824492">z</span><span class="op" id="4824493">.</span><span class="ident" id="4824494">b</span><span class="op" id="4824495">.</span><span class="ident" id="4824496">abs</span>&nbsp;<span class="op" id="4824500">=</span>&nbsp;<span class="ident" id="4824502">z</span><span class="op" id="4824503">.</span><span class="ident" id="4824504">b</span><span class="op" id="4824505">.</span><span class="ident" id="4824506">abs</span><span class="op" id="4824509">.</span><span class="builtinfunc" id="4824510">make</span><span class="op" id="4824514">(</span><span class="num" id="4824515">0</span><span class="op" id="4824516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824521">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824529">z</span><span class="op" id="4824530">.</span><span class="ident" id="4824531">a</span><span class="op" id="4824532">.</span><span class="ident" id="4824533">neg</span>&nbsp;<span class="op" id="4824537">=</span>&nbsp;<span class="ident" id="4824539">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824547">return</span>&nbsp;<span class="ident" id="4824554">z</span><br>
<span class="lineno"></span><span class="op" id="4824556">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="4824559">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4824625">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4824691">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4824705">func</span>&nbsp;<span class="ident" id="4824710">mulDenom</span><span class="op" id="4824718">(</span><span class="ident" id="4824719">z</span><span class="op" id="4824720">,</span>&nbsp;<span class="ident" id="4824722">x</span><span class="op" id="4824723">,</span>&nbsp;<span class="ident" id="4824725">y</span>&nbsp;<span class="ident" id="4824727">nat</span><span class="op" id="4824730">)</span>&nbsp;<span class="ident" id="4824732">nat</span>&nbsp;<span class="op" id="4824736">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824739">switch</span>&nbsp;<span class="op" id="4824746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824749">case</span>&nbsp;<span class="builtinfunc" id="4824754">len</span><span class="op" id="4824757">(</span><span class="ident" id="4824758">x</span><span class="op" id="4824759">)</span>&nbsp;<span class="op" id="4824761">==</span>&nbsp;<span class="num" id="4824764">0</span><span class="op" id="4824765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824769">return</span>&nbsp;<span class="ident" id="4824776">z</span><span class="op" id="4824777">.</span><span class="ident" id="4824778">set</span><span class="op" id="4824781">(</span><span class="ident" id="4824782">y</span><span class="op" id="4824783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824786">case</span>&nbsp;<span class="builtinfunc" id="4824791">len</span><span class="op" id="4824794">(</span><span class="ident" id="4824795">y</span><span class="op" id="4824796">)</span>&nbsp;<span class="op" id="4824798">==</span>&nbsp;<span class="num" id="4824801">0</span><span class="op" id="4824802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824806">return</span>&nbsp;<span class="ident" id="4824813">z</span><span class="op" id="4824814">.</span><span class="ident" id="4824815">set</span><span class="op" id="4824818">(</span><span class="ident" id="4824819">x</span><span class="op" id="4824820">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4824823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824826">return</span>&nbsp;<span class="ident" id="4824833">z</span><span class="op" id="4824834">.</span><span class="ident" id="4824835">mul</span><span class="op" id="4824838">(</span><span class="ident" id="4824839">x</span><span class="op" id="4824840">,</span>&nbsp;<span class="ident" id="4824842">y</span><span class="op" id="4824843">)</span><br>
<span class="lineno"></span><span class="op" id="4824845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4824848">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="4824876">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4824947">func</span>&nbsp;<span class="ident" id="4824952">scaleDenom</span><span class="op" id="4824962">(</span><span class="ident" id="4824963">x</span>&nbsp;<span class="op" id="4824965">*</span><span class="ident" id="4824966">Int</span><span class="op" id="4824969">,</span>&nbsp;<span class="ident" id="4824971">f</span>&nbsp;<span class="ident" id="4824973">nat</span><span class="op" id="4824976">)</span>&nbsp;<span class="op" id="4824978">*</span><span class="ident" id="4824979">Int</span>&nbsp;<span class="op" id="4824983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824986">var</span>&nbsp;<span class="ident" id="4824990">z</span>&nbsp;<span class="ident" id="4824992">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4824997">if</span>&nbsp;<span class="builtinfunc" id="4825000">len</span><span class="op" id="4825003">(</span><span class="ident" id="4825004">f</span><span class="op" id="4825005">)</span>&nbsp;<span class="op" id="4825007">==</span>&nbsp;<span class="num" id="4825010">0</span>&nbsp;<span class="op" id="4825012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825016">return</span>&nbsp;<span class="ident" id="4825023">z</span><span class="op" id="4825024">.</span><span class="ident" id="4825025">Set</span><span class="op" id="4825028">(</span><span class="ident" id="4825029">x</span><span class="op" id="4825030">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4825033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825036">z</span><span class="op" id="4825037">.</span><span class="ident" id="4825038">abs</span>&nbsp;<span class="op" id="4825042">=</span>&nbsp;<span class="ident" id="4825044">z</span><span class="op" id="4825045">.</span><span class="ident" id="4825046">abs</span><span class="op" id="4825049">.</span><span class="ident" id="4825050">mul</span><span class="op" id="4825053">(</span><span class="ident" id="4825054">x</span><span class="op" id="4825055">.</span><span class="ident" id="4825056">abs</span><span class="op" id="4825059">,</span>&nbsp;<span class="ident" id="4825061">f</span><span class="op" id="4825062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825065">z</span><span class="op" id="4825066">.</span><span class="ident" id="4825067">neg</span>&nbsp;<span class="op" id="4825071">=</span>&nbsp;<span class="ident" id="4825073">x</span><span class="op" id="4825074">.</span><span class="ident" id="4825075">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825080">return</span>&nbsp;<span class="op" id="4825087">&amp;</span><span class="ident" id="4825088">z</span><br>
<span class="lineno"></span><span class="op" id="4825090">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="4825093">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="4825130">//</span><br>
<span class="lineno"></span><span class="comment" id="4825133">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4825151">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="4825169">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4825187">//</span><br>
<span class="lineno"></span><span class="keyword" id="4825190">func</span>&nbsp;<span class="op" id="4825195">(</span><span class="ident" id="4825196">x</span>&nbsp;<span class="op" id="4825198">*</span><span class="ident" id="4825199">Rat</span><span class="op" id="4825202">)</span>&nbsp;<span class="ident" id="4825204">Cmp</span><span class="op" id="4825207">(</span><span class="ident" id="4825208">y</span>&nbsp;<span class="op" id="4825210">*</span><span class="ident" id="4825211">Rat</span><span class="op" id="4825214">)</span>&nbsp;<span class="builtintype" id="4825216">int</span>&nbsp;<span class="op" id="4825220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825223">return</span>&nbsp;<span class="ident" id="4825230">scaleDenom</span><span class="op" id="4825240">(</span><span class="op" id="4825241">&amp;</span><span class="ident" id="4825242">x</span><span class="op" id="4825243">.</span><span class="ident" id="4825244">a</span><span class="op" id="4825245">,</span>&nbsp;<span class="ident" id="4825247">y</span><span class="op" id="4825248">.</span><span class="ident" id="4825249">b</span><span class="op" id="4825250">.</span><span class="ident" id="4825251">abs</span><span class="op" id="4825254">)</span><span class="op" id="4825255">.</span><span class="ident" id="4825256">Cmp</span><span class="op" id="4825259">(</span><span class="ident" id="4825260">scaleDenom</span><span class="op" id="4825270">(</span><span class="op" id="4825271">&amp;</span><span class="ident" id="4825272">y</span><span class="op" id="4825273">.</span><span class="ident" id="4825274">a</span><span class="op" id="4825275">,</span>&nbsp;<span class="ident" id="4825277">x</span><span class="op" id="4825278">.</span><span class="ident" id="4825279">b</span><span class="op" id="4825280">.</span><span class="ident" id="4825281">abs</span><span class="op" id="4825284">)</span><span class="op" id="4825285">)</span><br>
<span class="lineno"></span><span class="op" id="4825287">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4825290">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4825334">func</span>&nbsp;<span class="op" id="4825339">(</span><span class="ident" id="4825340">z</span>&nbsp;<span class="op" id="4825342">*</span><span class="ident" id="4825343">Rat</span><span class="op" id="4825346">)</span>&nbsp;<span class="ident" id="4825348">Add</span><span class="op" id="4825351">(</span><span class="ident" id="4825352">x</span><span class="op" id="4825353">,</span>&nbsp;<span class="ident" id="4825355">y</span>&nbsp;<span class="op" id="4825357">*</span><span class="ident" id="4825358">Rat</span><span class="op" id="4825361">)</span>&nbsp;<span class="op" id="4825363">*</span><span class="ident" id="4825364">Rat</span>&nbsp;<span class="op" id="4825368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825371">a1</span>&nbsp;<span class="op" id="4825374">:=</span>&nbsp;<span class="ident" id="4825377">scaleDenom</span><span class="op" id="4825387">(</span><span class="op" id="4825388">&amp;</span><span class="ident" id="4825389">x</span><span class="op" id="4825390">.</span><span class="ident" id="4825391">a</span><span class="op" id="4825392">,</span>&nbsp;<span class="ident" id="4825394">y</span><span class="op" id="4825395">.</span><span class="ident" id="4825396">b</span><span class="op" id="4825397">.</span><span class="ident" id="4825398">abs</span><span class="op" id="4825401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825404">a2</span>&nbsp;<span class="op" id="4825407">:=</span>&nbsp;<span class="ident" id="4825410">scaleDenom</span><span class="op" id="4825420">(</span><span class="op" id="4825421">&amp;</span><span class="ident" id="4825422">y</span><span class="op" id="4825423">.</span><span class="ident" id="4825424">a</span><span class="op" id="4825425">,</span>&nbsp;<span class="ident" id="4825427">x</span><span class="op" id="4825428">.</span><span class="ident" id="4825429">b</span><span class="op" id="4825430">.</span><span class="ident" id="4825431">abs</span><span class="op" id="4825434">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825437">z</span><span class="op" id="4825438">.</span><span class="ident" id="4825439">a</span><span class="op" id="4825440">.</span><span class="ident" id="4825441">Add</span><span class="op" id="4825444">(</span><span class="ident" id="4825445">a1</span><span class="op" id="4825447">,</span>&nbsp;<span class="ident" id="4825449">a2</span><span class="op" id="4825451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825454">z</span><span class="op" id="4825455">.</span><span class="ident" id="4825456">b</span><span class="op" id="4825457">.</span><span class="ident" id="4825458">abs</span>&nbsp;<span class="op" id="4825462">=</span>&nbsp;<span class="ident" id="4825464">mulDenom</span><span class="op" id="4825472">(</span><span class="ident" id="4825473">z</span><span class="op" id="4825474">.</span><span class="ident" id="4825475">b</span><span class="op" id="4825476">.</span><span class="ident" id="4825477">abs</span><span class="op" id="4825480">,</span>&nbsp;<span class="ident" id="4825482">x</span><span class="op" id="4825483">.</span><span class="ident" id="4825484">b</span><span class="op" id="4825485">.</span><span class="ident" id="4825486">abs</span><span class="op" id="4825489">,</span>&nbsp;<span class="ident" id="4825491">y</span><span class="op" id="4825492">.</span><span class="ident" id="4825493">b</span><span class="op" id="4825494">.</span><span class="ident" id="4825495">abs</span><span class="op" id="4825498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825501">return</span>&nbsp;<span class="ident" id="4825508">z</span><span class="op" id="4825509">.</span><span class="ident" id="4825510">norm</span><span class="op" id="4825514">(</span><span class="op" id="4825515">)</span><br>
<span class="lineno"></span><span class="op" id="4825517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="4825520">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4825571">func</span>&nbsp;<span class="op" id="4825576">(</span><span class="ident" id="4825577">z</span>&nbsp;<span class="op" id="4825579">*</span><span class="ident" id="4825580">Rat</span><span class="op" id="4825583">)</span>&nbsp;<span class="ident" id="4825585">Sub</span><span class="op" id="4825588">(</span><span class="ident" id="4825589">x</span><span class="op" id="4825590">,</span>&nbsp;<span class="ident" id="4825592">y</span>&nbsp;<span class="op" id="4825594">*</span><span class="ident" id="4825595">Rat</span><span class="op" id="4825598">)</span>&nbsp;<span class="op" id="4825600">*</span><span class="ident" id="4825601">Rat</span>&nbsp;<span class="op" id="4825605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825608">a1</span>&nbsp;<span class="op" id="4825611">:=</span>&nbsp;<span class="ident" id="4825614">scaleDenom</span><span class="op" id="4825624">(</span><span class="op" id="4825625">&amp;</span><span class="ident" id="4825626">x</span><span class="op" id="4825627">.</span><span class="ident" id="4825628">a</span><span class="op" id="4825629">,</span>&nbsp;<span class="ident" id="4825631">y</span><span class="op" id="4825632">.</span><span class="ident" id="4825633">b</span><span class="op" id="4825634">.</span><span class="ident" id="4825635">abs</span><span class="op" id="4825638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825641">a2</span>&nbsp;<span class="op" id="4825644">:=</span>&nbsp;<span class="ident" id="4825647">scaleDenom</span><span class="op" id="4825657">(</span><span class="op" id="4825658">&amp;</span><span class="ident" id="4825659">y</span><span class="op" id="4825660">.</span><span class="ident" id="4825661">a</span><span class="op" id="4825662">,</span>&nbsp;<span class="ident" id="4825664">x</span><span class="op" id="4825665">.</span><span class="ident" id="4825666">b</span><span class="op" id="4825667">.</span><span class="ident" id="4825668">abs</span><span class="op" id="4825671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825674">z</span><span class="op" id="4825675">.</span><span class="ident" id="4825676">a</span><span class="op" id="4825677">.</span><span class="ident" id="4825678">Sub</span><span class="op" id="4825681">(</span><span class="ident" id="4825682">a1</span><span class="op" id="4825684">,</span>&nbsp;<span class="ident" id="4825686">a2</span><span class="op" id="4825688">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825691">z</span><span class="op" id="4825692">.</span><span class="ident" id="4825693">b</span><span class="op" id="4825694">.</span><span class="ident" id="4825695">abs</span>&nbsp;<span class="op" id="4825699">=</span>&nbsp;<span class="ident" id="4825701">mulDenom</span><span class="op" id="4825709">(</span><span class="ident" id="4825710">z</span><span class="op" id="4825711">.</span><span class="ident" id="4825712">b</span><span class="op" id="4825713">.</span><span class="ident" id="4825714">abs</span><span class="op" id="4825717">,</span>&nbsp;<span class="ident" id="4825719">x</span><span class="op" id="4825720">.</span><span class="ident" id="4825721">b</span><span class="op" id="4825722">.</span><span class="ident" id="4825723">abs</span><span class="op" id="4825726">,</span>&nbsp;<span class="ident" id="4825728">y</span><span class="op" id="4825729">.</span><span class="ident" id="4825730">b</span><span class="op" id="4825731">.</span><span class="ident" id="4825732">abs</span><span class="op" id="4825735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825738">return</span>&nbsp;<span class="ident" id="4825745">z</span><span class="op" id="4825746">.</span><span class="ident" id="4825747">norm</span><span class="op" id="4825751">(</span><span class="op" id="4825752">)</span><br>
<span class="lineno"></span><span class="op" id="4825754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4825757">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="4825805">func</span>&nbsp;<span class="op" id="4825810">(</span><span class="ident" id="4825811">z</span>&nbsp;<span class="op" id="4825813">*</span><span class="ident" id="4825814">Rat</span><span class="op" id="4825817">)</span>&nbsp;<span class="ident" id="4825819">Mul</span><span class="op" id="4825822">(</span><span class="ident" id="4825823">x</span><span class="op" id="4825824">,</span>&nbsp;<span class="ident" id="4825826">y</span>&nbsp;<span class="op" id="4825828">*</span><span class="ident" id="4825829">Rat</span><span class="op" id="4825832">)</span>&nbsp;<span class="op" id="4825834">*</span><span class="ident" id="4825835">Rat</span>&nbsp;<span class="op" id="4825839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825842">z</span><span class="op" id="4825843">.</span><span class="ident" id="4825844">a</span><span class="op" id="4825845">.</span><span class="ident" id="4825846">Mul</span><span class="op" id="4825849">(</span><span class="op" id="4825850">&amp;</span><span class="ident" id="4825851">x</span><span class="op" id="4825852">.</span><span class="ident" id="4825853">a</span><span class="op" id="4825854">,</span>&nbsp;<span class="op" id="4825856">&amp;</span><span class="ident" id="4825857">y</span><span class="op" id="4825858">.</span><span class="ident" id="4825859">a</span><span class="op" id="4825860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825863">z</span><span class="op" id="4825864">.</span><span class="ident" id="4825865">b</span><span class="op" id="4825866">.</span><span class="ident" id="4825867">abs</span>&nbsp;<span class="op" id="4825871">=</span>&nbsp;<span class="ident" id="4825873">mulDenom</span><span class="op" id="4825881">(</span><span class="ident" id="4825882">z</span><span class="op" id="4825883">.</span><span class="ident" id="4825884">b</span><span class="op" id="4825885">.</span><span class="ident" id="4825886">abs</span><span class="op" id="4825889">,</span>&nbsp;<span class="ident" id="4825891">x</span><span class="op" id="4825892">.</span><span class="ident" id="4825893">b</span><span class="op" id="4825894">.</span><span class="ident" id="4825895">abs</span><span class="op" id="4825898">,</span>&nbsp;<span class="ident" id="4825900">y</span><span class="op" id="4825901">.</span><span class="ident" id="4825902">b</span><span class="op" id="4825903">.</span><span class="ident" id="4825904">abs</span><span class="op" id="4825907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4825910">return</span>&nbsp;<span class="ident" id="4825917">z</span><span class="op" id="4825918">.</span><span class="ident" id="4825919">norm</span><span class="op" id="4825923">(</span><span class="op" id="4825924">)</span><br>
<span class="lineno"></span><span class="op" id="4825926">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="4825929">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4825978">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="4826034">func</span>&nbsp;<span class="op" id="4826039">(</span><span class="ident" id="4826040">z</span>&nbsp;<span class="op" id="4826042">*</span><span class="ident" id="4826043">Rat</span><span class="op" id="4826046">)</span>&nbsp;<span class="ident" id="4826048">Quo</span><span class="op" id="4826051">(</span><span class="ident" id="4826052">x</span><span class="op" id="4826053">,</span>&nbsp;<span class="ident" id="4826055">y</span>&nbsp;<span class="op" id="4826057">*</span><span class="ident" id="4826058">Rat</span><span class="op" id="4826061">)</span>&nbsp;<span class="op" id="4826063">*</span><span class="ident" id="4826064">Rat</span>&nbsp;<span class="op" id="4826068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826071">if</span>&nbsp;<span class="builtinfunc" id="4826074">len</span><span class="op" id="4826077">(</span><span class="ident" id="4826078">y</span><span class="op" id="4826079">.</span><span class="ident" id="4826080">a</span><span class="op" id="4826081">.</span><span class="ident" id="4826082">abs</span><span class="op" id="4826085">)</span>&nbsp;<span class="op" id="4826087">==</span>&nbsp;<span class="num" id="4826090">0</span>&nbsp;<span class="op" id="4826092">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4826096">panic</span><span class="op" id="4826101">(</span><span class="string" id="4826102">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4826120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826126">a</span>&nbsp;<span class="op" id="4826128">:=</span>&nbsp;<span class="ident" id="4826131">scaleDenom</span><span class="op" id="4826141">(</span><span class="op" id="4826142">&amp;</span><span class="ident" id="4826143">x</span><span class="op" id="4826144">.</span><span class="ident" id="4826145">a</span><span class="op" id="4826146">,</span>&nbsp;<span class="ident" id="4826148">y</span><span class="op" id="4826149">.</span><span class="ident" id="4826150">b</span><span class="op" id="4826151">.</span><span class="ident" id="4826152">abs</span><span class="op" id="4826155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826158">b</span>&nbsp;<span class="op" id="4826160">:=</span>&nbsp;<span class="ident" id="4826163">scaleDenom</span><span class="op" id="4826173">(</span><span class="op" id="4826174">&amp;</span><span class="ident" id="4826175">y</span><span class="op" id="4826176">.</span><span class="ident" id="4826177">a</span><span class="op" id="4826178">,</span>&nbsp;<span class="ident" id="4826180">x</span><span class="op" id="4826181">.</span><span class="ident" id="4826182">b</span><span class="op" id="4826183">.</span><span class="ident" id="4826184">abs</span><span class="op" id="4826187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826190">z</span><span class="op" id="4826191">.</span><span class="ident" id="4826192">a</span><span class="op" id="4826193">.</span><span class="ident" id="4826194">abs</span>&nbsp;<span class="op" id="4826198">=</span>&nbsp;<span class="ident" id="4826200">a</span><span class="op" id="4826201">.</span><span class="ident" id="4826202">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826207">z</span><span class="op" id="4826208">.</span><span class="ident" id="4826209">b</span><span class="op" id="4826210">.</span><span class="ident" id="4826211">abs</span>&nbsp;<span class="op" id="4826215">=</span>&nbsp;<span class="ident" id="4826217">b</span><span class="op" id="4826218">.</span><span class="ident" id="4826219">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826224">z</span><span class="op" id="4826225">.</span><span class="ident" id="4826226">a</span><span class="op" id="4826227">.</span><span class="ident" id="4826228">neg</span>&nbsp;<span class="op" id="4826232">=</span>&nbsp;<span class="ident" id="4826234">a</span><span class="op" id="4826235">.</span><span class="ident" id="4826236">neg</span>&nbsp;<span class="op" id="4826240">!=</span>&nbsp;<span class="ident" id="4826243">b</span><span class="op" id="4826244">.</span><span class="ident" id="4826245">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826250">return</span>&nbsp;<span class="ident" id="4826257">z</span><span class="op" id="4826258">.</span><span class="ident" id="4826259">norm</span><span class="op" id="4826263">(</span><span class="op" id="4826264">)</span><br>
<span class="lineno"></span><span class="op" id="4826266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="4826269">func</span>&nbsp;<span class="ident" id="4826274">ratTok</span><span class="op" id="4826280">(</span><span class="ident" id="4826281">ch</span>&nbsp;<span class="builtintype" id="4826284">rune</span><span class="op" id="4826288">)</span>&nbsp;<span class="builtintype" id="4826290">bool</span>&nbsp;<span class="op" id="4826295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826298">return</span>&nbsp;<span class="ident" id="4826305">strings</span><span class="op" id="4826312">.</span><span class="ident" id="4826313">IndexRune</span><span class="op" id="4826322">(</span><span class="string" id="4826323">&#34;+-/0123456789.eE&#34;</span><span class="op" id="4826341">,</span>&nbsp;<span class="ident" id="4826343">ch</span><span class="op" id="4826345">)</span>&nbsp;<span class="op" id="4826347">&gt;=</span>&nbsp;<span class="num" id="4826350">0</span><br>
<span class="lineno"></span><span class="op" id="4826352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826355">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="4826424">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="4826494">func</span>&nbsp;<span class="op" id="4826499">(</span><span class="ident" id="4826500">z</span>&nbsp;<span class="op" id="4826502">*</span><span class="ident" id="4826503">Rat</span><span class="op" id="4826506">)</span>&nbsp;<span class="ident" id="4826508">Scan</span><span class="op" id="4826512">(</span><span class="ident" id="4826513">s</span>&nbsp;<span class="ident" id="4826515">fmt</span><span class="op" id="4826518">.</span><span class="ident" id="4826519">ScanState</span><span class="op" id="4826528">,</span>&nbsp;<span class="ident" id="4826530">ch</span>&nbsp;<span class="builtintype" id="4826533">rune</span><span class="op" id="4826537">)</span>&nbsp;<span class="builtintype" id="4826539">error</span>&nbsp;<span class="op" id="4826545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826548">tok</span><span class="op" id="4826551">,</span>&nbsp;<span class="ident" id="4826553">err</span>&nbsp;<span class="op" id="4826557">:=</span>&nbsp;<span class="ident" id="4826560">s</span><span class="op" id="4826561">.</span><span class="ident" id="4826562">Token</span><span class="op" id="4826567">(</span><span class="builtintype" id="4826568">true</span><span class="op" id="4826572">,</span>&nbsp;<span class="ident" id="4826574">ratTok</span><span class="op" id="4826580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826583">if</span>&nbsp;<span class="ident" id="4826586">err</span>&nbsp;<span class="op" id="4826590">!=</span>&nbsp;<span class="ident" id="4826593">nil</span>&nbsp;<span class="op" id="4826597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826601">return</span>&nbsp;<span class="ident" id="4826608">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826616">if</span>&nbsp;<span class="ident" id="4826619">strings</span><span class="op" id="4826626">.</span><span class="ident" id="4826627">IndexRune</span><span class="op" id="4826636">(</span><span class="string" id="4826637">&#34;efgEFGv&#34;</span><span class="op" id="4826646">,</span>&nbsp;<span class="ident" id="4826648">ch</span><span class="op" id="4826650">)</span>&nbsp;<span class="op" id="4826652">&lt;</span>&nbsp;<span class="num" id="4826654">0</span>&nbsp;<span class="op" id="4826656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826660">return</span>&nbsp;<span class="ident" id="4826667">errors</span><span class="op" id="4826673">.</span><span class="ident" id="4826674">New</span><span class="op" id="4826677">(</span><span class="string" id="4826678">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="4826702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826708">if</span>&nbsp;<span class="ident" id="4826711">_</span><span class="op" id="4826712">,</span>&nbsp;<span class="ident" id="4826714">ok</span>&nbsp;<span class="op" id="4826717">:=</span>&nbsp;<span class="ident" id="4826720">z</span><span class="op" id="4826721">.</span><span class="ident" id="4826722">SetString</span><span class="op" id="4826731">(</span><span class="builtintype" id="4826732">string</span><span class="op" id="4826738">(</span><span class="ident" id="4826739">tok</span><span class="op" id="4826742">)</span><span class="op" id="4826743">)</span><span class="op" id="4826744">;</span>&nbsp;<span class="op" id="4826746">!</span><span class="ident" id="4826747">ok</span>&nbsp;<span class="op" id="4826750">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826754">return</span>&nbsp;<span class="ident" id="4826761">errors</span><span class="op" id="4826767">.</span><span class="ident" id="4826768">New</span><span class="op" id="4826771">(</span><span class="string" id="4826772">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="4826798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4826801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4826804">return</span>&nbsp;<span class="ident" id="4826811">nil</span><br>
<span class="lineno"></span><span class="op" id="4826815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4826818">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4826895">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4826972">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4827049">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4827098">func</span>&nbsp;<span class="op" id="4827103">(</span><span class="ident" id="4827104">z</span>&nbsp;<span class="op" id="4827106">*</span><span class="ident" id="4827107">Rat</span><span class="op" id="4827110">)</span>&nbsp;<span class="ident" id="4827112">SetString</span><span class="op" id="4827121">(</span><span class="ident" id="4827122">s</span>&nbsp;<span class="builtintype" id="4827124">string</span><span class="op" id="4827130">)</span>&nbsp;<span class="op" id="4827132">(</span><span class="op" id="4827133">*</span><span class="ident" id="4827134">Rat</span><span class="op" id="4827137">,</span>&nbsp;<span class="builtintype" id="4827139">bool</span><span class="op" id="4827143">)</span>&nbsp;<span class="op" id="4827145">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827148">if</span>&nbsp;<span class="builtinfunc" id="4827151">len</span><span class="op" id="4827154">(</span><span class="ident" id="4827155">s</span><span class="op" id="4827156">)</span>&nbsp;<span class="op" id="4827158">==</span>&nbsp;<span class="num" id="4827161">0</span>&nbsp;<span class="op" id="4827163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827167">return</span>&nbsp;<span class="ident" id="4827174">nil</span><span class="op" id="4827177">,</span>&nbsp;<span class="builtintype" id="4827179">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827190">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827215">sep</span>&nbsp;<span class="op" id="4827219">:=</span>&nbsp;<span class="ident" id="4827222">strings</span><span class="op" id="4827229">.</span><span class="ident" id="4827230">Index</span><span class="op" id="4827235">(</span><span class="ident" id="4827236">s</span><span class="op" id="4827237">,</span>&nbsp;<span class="string" id="4827239">&#34;/&#34;</span><span class="op" id="4827242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827245">if</span>&nbsp;<span class="ident" id="4827248">sep</span>&nbsp;<span class="op" id="4827252">&gt;=</span>&nbsp;<span class="num" id="4827255">0</span>&nbsp;<span class="op" id="4827257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827261">if</span>&nbsp;<span class="ident" id="4827264">_</span><span class="op" id="4827265">,</span>&nbsp;<span class="ident" id="4827267">ok</span>&nbsp;<span class="op" id="4827270">:=</span>&nbsp;<span class="ident" id="4827273">z</span><span class="op" id="4827274">.</span><span class="ident" id="4827275">a</span><span class="op" id="4827276">.</span><span class="ident" id="4827277">SetString</span><span class="op" id="4827286">(</span><span class="ident" id="4827287">s</span><span class="op" id="4827288">[</span><span class="num" id="4827289">0</span><span class="op" id="4827290">:</span><span class="ident" id="4827291">sep</span><span class="op" id="4827294">]</span><span class="op" id="4827295">,</span>&nbsp;<span class="num" id="4827297">10</span><span class="op" id="4827299">)</span><span class="op" id="4827300">;</span>&nbsp;<span class="op" id="4827302">!</span><span class="ident" id="4827303">ok</span>&nbsp;<span class="op" id="4827306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827311">return</span>&nbsp;<span class="ident" id="4827318">nil</span><span class="op" id="4827321">,</span>&nbsp;<span class="builtintype" id="4827323">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827331">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827335">s</span>&nbsp;<span class="op" id="4827337">=</span>&nbsp;<span class="ident" id="4827339">s</span><span class="op" id="4827340">[</span><span class="ident" id="4827341">sep</span><span class="op" id="4827344">+</span><span class="num" id="4827345">1</span><span class="op" id="4827346">:</span><span class="op" id="4827347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827351">var</span>&nbsp;<span class="ident" id="4827355">err</span>&nbsp;<span class="builtintype" id="4827359">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827367">if</span>&nbsp;<span class="ident" id="4827370">z</span><span class="op" id="4827371">.</span><span class="ident" id="4827372">b</span><span class="op" id="4827373">.</span><span class="ident" id="4827374">abs</span><span class="op" id="4827377">,</span>&nbsp;<span class="ident" id="4827379">_</span><span class="op" id="4827380">,</span>&nbsp;<span class="ident" id="4827382">err</span>&nbsp;<span class="op" id="4827386">=</span>&nbsp;<span class="ident" id="4827388">z</span><span class="op" id="4827389">.</span><span class="ident" id="4827390">b</span><span class="op" id="4827391">.</span><span class="ident" id="4827392">abs</span><span class="op" id="4827395">.</span><span class="ident" id="4827396">scan</span><span class="op" id="4827400">(</span><span class="ident" id="4827401">strings</span><span class="op" id="4827408">.</span><span class="ident" id="4827409">NewReader</span><span class="op" id="4827418">(</span><span class="ident" id="4827419">s</span><span class="op" id="4827420">)</span><span class="op" id="4827421">,</span>&nbsp;<span class="num" id="4827423">10</span><span class="op" id="4827425">)</span><span class="op" id="4827426">;</span>&nbsp;<span class="ident" id="4827428">err</span>&nbsp;<span class="op" id="4827432">!=</span>&nbsp;<span class="ident" id="4827435">nil</span>&nbsp;<span class="op" id="4827439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827444">return</span>&nbsp;<span class="ident" id="4827451">nil</span><span class="op" id="4827454">,</span>&nbsp;<span class="builtintype" id="4827456">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827464">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827468">if</span>&nbsp;<span class="builtinfunc" id="4827471">len</span><span class="op" id="4827474">(</span><span class="ident" id="4827475">z</span><span class="op" id="4827476">.</span><span class="ident" id="4827477">b</span><span class="op" id="4827478">.</span><span class="ident" id="4827479">abs</span><span class="op" id="4827482">)</span>&nbsp;<span class="op" id="4827484">==</span>&nbsp;<span class="num" id="4827487">0</span>&nbsp;<span class="op" id="4827489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827494">return</span>&nbsp;<span class="ident" id="4827501">nil</span><span class="op" id="4827504">,</span>&nbsp;<span class="builtintype" id="4827506">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827518">return</span>&nbsp;<span class="ident" id="4827525">z</span><span class="op" id="4827526">.</span><span class="ident" id="4827527">norm</span><span class="op" id="4827531">(</span><span class="op" id="4827532">)</span><span class="op" id="4827533">,</span>&nbsp;<span class="builtintype" id="4827535">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827541">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827545">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827575">sep</span>&nbsp;<span class="op" id="4827579">=</span>&nbsp;<span class="ident" id="4827581">strings</span><span class="op" id="4827588">.</span><span class="ident" id="4827589">Index</span><span class="op" id="4827594">(</span><span class="ident" id="4827595">s</span><span class="op" id="4827596">,</span>&nbsp;<span class="string" id="4827598">&#34;.&#34;</span><span class="op" id="4827601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827604">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827630">e</span>&nbsp;<span class="op" id="4827632">:=</span>&nbsp;<span class="ident" id="4827635">strings</span><span class="op" id="4827642">.</span><span class="ident" id="4827643">IndexAny</span><span class="op" id="4827651">(</span><span class="ident" id="4827652">s</span><span class="op" id="4827653">,</span>&nbsp;<span class="string" id="4827655">&#34;eE&#34;</span><span class="op" id="4827659">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827662">var</span>&nbsp;<span class="ident" id="4827666">exp</span>&nbsp;<span class="ident" id="4827670">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827675">if</span>&nbsp;<span class="ident" id="4827678">e</span>&nbsp;<span class="op" id="4827680">&gt;=</span>&nbsp;<span class="num" id="4827683">0</span>&nbsp;<span class="op" id="4827685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827689">if</span>&nbsp;<span class="ident" id="4827692">e</span>&nbsp;<span class="op" id="4827694">&lt;</span>&nbsp;<span class="ident" id="4827696">sep</span>&nbsp;<span class="op" id="4827700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827705">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827752">return</span>&nbsp;<span class="ident" id="4827759">nil</span><span class="op" id="4827762">,</span>&nbsp;<span class="builtintype" id="4827764">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827776">if</span>&nbsp;<span class="ident" id="4827779">_</span><span class="op" id="4827780">,</span>&nbsp;<span class="ident" id="4827782">ok</span>&nbsp;<span class="op" id="4827785">:=</span>&nbsp;<span class="ident" id="4827788">exp</span><span class="op" id="4827791">.</span><span class="ident" id="4827792">SetString</span><span class="op" id="4827801">(</span><span class="ident" id="4827802">s</span><span class="op" id="4827803">[</span><span class="ident" id="4827804">e</span><span class="op" id="4827805">+</span><span class="num" id="4827806">1</span><span class="op" id="4827807">:</span><span class="op" id="4827808">]</span><span class="op" id="4827809">,</span>&nbsp;<span class="num" id="4827811">10</span><span class="op" id="4827813">)</span><span class="op" id="4827814">;</span>&nbsp;<span class="op" id="4827816">!</span><span class="ident" id="4827817">ok</span>&nbsp;<span class="op" id="4827820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827825">return</span>&nbsp;<span class="ident" id="4827832">nil</span><span class="op" id="4827835">,</span>&nbsp;<span class="builtintype" id="4827837">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827849">s</span>&nbsp;<span class="op" id="4827851">=</span>&nbsp;<span class="ident" id="4827853">s</span><span class="op" id="4827854">[</span><span class="num" id="4827855">0</span><span class="op" id="4827856">:</span><span class="ident" id="4827857">e</span><span class="op" id="4827858">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827864">if</span>&nbsp;<span class="ident" id="4827867">sep</span>&nbsp;<span class="op" id="4827871">&gt;=</span>&nbsp;<span class="num" id="4827874">0</span>&nbsp;<span class="op" id="4827876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827880">s</span>&nbsp;<span class="op" id="4827882">=</span>&nbsp;<span class="ident" id="4827884">s</span><span class="op" id="4827885">[</span><span class="num" id="4827886">0</span><span class="op" id="4827887">:</span><span class="ident" id="4827888">sep</span><span class="op" id="4827891">]</span>&nbsp;<span class="op" id="4827893">+</span>&nbsp;<span class="ident" id="4827895">s</span><span class="op" id="4827896">[</span><span class="ident" id="4827897">sep</span><span class="op" id="4827900">+</span><span class="num" id="4827901">1</span><span class="op" id="4827902">:</span><span class="op" id="4827903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827907">exp</span><span class="op" id="4827910">.</span><span class="ident" id="4827911">Sub</span><span class="op" id="4827914">(</span><span class="op" id="4827915">&amp;</span><span class="ident" id="4827916">exp</span><span class="op" id="4827919">,</span>&nbsp;<span class="ident" id="4827921">NewInt</span><span class="op" id="4827927">(</span><span class="ident" id="4827928">int64</span><span class="op" id="4827933">(</span><span class="builtinfunc" id="4827934">len</span><span class="op" id="4827937">(</span><span class="ident" id="4827938">s</span><span class="op" id="4827939">)</span><span class="op" id="4827940">-</span><span class="ident" id="4827941">sep</span><span class="op" id="4827944">)</span><span class="op" id="4827945">)</span><span class="op" id="4827946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827949">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827953">if</span>&nbsp;<span class="ident" id="4827956">_</span><span class="op" id="4827957">,</span>&nbsp;<span class="ident" id="4827959">ok</span>&nbsp;<span class="op" id="4827962">:=</span>&nbsp;<span class="ident" id="4827965">z</span><span class="op" id="4827966">.</span><span class="ident" id="4827967">a</span><span class="op" id="4827968">.</span><span class="ident" id="4827969">SetString</span><span class="op" id="4827978">(</span><span class="ident" id="4827979">s</span><span class="op" id="4827980">,</span>&nbsp;<span class="num" id="4827982">10</span><span class="op" id="4827984">)</span><span class="op" id="4827985">;</span>&nbsp;<span class="op" id="4827987">!</span><span class="ident" id="4827988">ok</span>&nbsp;<span class="op" id="4827991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827995">return</span>&nbsp;<span class="ident" id="4828002">nil</span><span class="op" id="4828005">,</span>&nbsp;<span class="builtintype" id="4828007">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828017">powTen</span>&nbsp;<span class="op" id="4828024">:=</span>&nbsp;<span class="ident" id="4828027">nat</span><span class="op" id="4828030">(</span><span class="ident" id="4828031">nil</span><span class="op" id="4828034">)</span><span class="op" id="4828035">.</span><span class="ident" id="4828036">expNN</span><span class="op" id="4828041">(</span><span class="ident" id="4828042">natTen</span><span class="op" id="4828048">,</span>&nbsp;<span class="ident" id="4828050">exp</span><span class="op" id="4828053">.</span><span class="ident" id="4828054">abs</span><span class="op" id="4828057">,</span>&nbsp;<span class="ident" id="4828059">nil</span><span class="op" id="4828062">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828065">if</span>&nbsp;<span class="ident" id="4828068">exp</span><span class="op" id="4828071">.</span><span class="ident" id="4828072">neg</span>&nbsp;<span class="op" id="4828076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828080">z</span><span class="op" id="4828081">.</span><span class="ident" id="4828082">b</span><span class="op" id="4828083">.</span><span class="ident" id="4828084">abs</span>&nbsp;<span class="op" id="4828088">=</span>&nbsp;<span class="ident" id="4828090">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828099">z</span><span class="op" id="4828100">.</span><span class="ident" id="4828101">norm</span><span class="op" id="4828105">(</span><span class="op" id="4828106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828109">}</span>&nbsp;<span class="keyword" id="4828111">else</span>&nbsp;<span class="op" id="4828116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828120">z</span><span class="op" id="4828121">.</span><span class="ident" id="4828122">a</span><span class="op" id="4828123">.</span><span class="ident" id="4828124">abs</span>&nbsp;<span class="op" id="4828128">=</span>&nbsp;<span class="ident" id="4828130">z</span><span class="op" id="4828131">.</span><span class="ident" id="4828132">a</span><span class="op" id="4828133">.</span><span class="ident" id="4828134">abs</span><span class="op" id="4828137">.</span><span class="ident" id="4828138">mul</span><span class="op" id="4828141">(</span><span class="ident" id="4828142">z</span><span class="op" id="4828143">.</span><span class="ident" id="4828144">a</span><span class="op" id="4828145">.</span><span class="ident" id="4828146">abs</span><span class="op" id="4828149">,</span>&nbsp;<span class="ident" id="4828151">powTen</span><span class="op" id="4828157">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828161">z</span><span class="op" id="4828162">.</span><span class="ident" id="4828163">b</span><span class="op" id="4828164">.</span><span class="ident" id="4828165">abs</span>&nbsp;<span class="op" id="4828169">=</span>&nbsp;<span class="ident" id="4828171">z</span><span class="op" id="4828172">.</span><span class="ident" id="4828173">b</span><span class="op" id="4828174">.</span><span class="ident" id="4828175">abs</span><span class="op" id="4828178">.</span><span class="builtinfunc" id="4828179">make</span><span class="op" id="4828183">(</span><span class="num" id="4828184">0</span><span class="op" id="4828185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828192">return</span>&nbsp;<span class="ident" id="4828199">z</span><span class="op" id="4828200">,</span>&nbsp;<span class="builtintype" id="4828202">true</span><br>
<span class="lineno"></span><span class="op" id="4828207">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="4828210">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="4828293">func</span>&nbsp;<span class="op" id="4828298">(</span><span class="ident" id="4828299">x</span>&nbsp;<span class="op" id="4828301">*</span><span class="ident" id="4828302">Rat</span><span class="op" id="4828305">)</span>&nbsp;<span class="ident" id="4828307">String</span><span class="op" id="4828313">(</span><span class="op" id="4828314">)</span>&nbsp;<span class="builtintype" id="4828316">string</span>&nbsp;<span class="op" id="4828323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828326">s</span>&nbsp;<span class="op" id="4828328">:=</span>&nbsp;<span class="string" id="4828331">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828337">if</span>&nbsp;<span class="builtinfunc" id="4828340">len</span><span class="op" id="4828343">(</span><span class="ident" id="4828344">x</span><span class="op" id="4828345">.</span><span class="ident" id="4828346">b</span><span class="op" id="4828347">.</span><span class="ident" id="4828348">abs</span><span class="op" id="4828351">)</span>&nbsp;<span class="op" id="4828353">!=</span>&nbsp;<span class="num" id="4828356">0</span>&nbsp;<span class="op" id="4828358">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828362">s</span>&nbsp;<span class="op" id="4828364">=</span>&nbsp;<span class="string" id="4828366">&#34;/&#34;</span>&nbsp;<span class="op" id="4828370">+</span>&nbsp;<span class="ident" id="4828372">x</span><span class="op" id="4828373">.</span><span class="ident" id="4828374">b</span><span class="op" id="4828375">.</span><span class="ident" id="4828376">abs</span><span class="op" id="4828379">.</span><span class="ident" id="4828380">decimalString</span><span class="op" id="4828393">(</span><span class="op" id="4828394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828400">return</span>&nbsp;<span class="ident" id="4828407">x</span><span class="op" id="4828408">.</span><span class="ident" id="4828409">a</span><span class="op" id="4828410">.</span><span class="ident" id="4828411">String</span><span class="op" id="4828417">(</span><span class="op" id="4828418">)</span>&nbsp;<span class="op" id="4828420">+</span>&nbsp;<span class="ident" id="4828422">s</span><br>
<span class="lineno"></span><span class="op" id="4828424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="4828427">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="4828506">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4828540">func</span>&nbsp;<span class="op" id="4828545">(</span><span class="ident" id="4828546">x</span>&nbsp;<span class="op" id="4828548">*</span><span class="ident" id="4828549">Rat</span><span class="op" id="4828552">)</span>&nbsp;<span class="ident" id="4828554">RatString</span><span class="op" id="4828563">(</span><span class="op" id="4828564">)</span>&nbsp;<span class="builtintype" id="4828566">string</span>&nbsp;<span class="op" id="4828573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828576">if</span>&nbsp;<span class="ident" id="4828579">x</span><span class="op" id="4828580">.</span><span class="ident" id="4828581">IsInt</span><span class="op" id="4828586">(</span><span class="op" id="4828587">)</span>&nbsp;<span class="op" id="4828589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828593">return</span>&nbsp;<span class="ident" id="4828600">x</span><span class="op" id="4828601">.</span><span class="ident" id="4828602">a</span><span class="op" id="4828603">.</span><span class="ident" id="4828604">String</span><span class="op" id="4828610">(</span><span class="op" id="4828611">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828617">return</span>&nbsp;<span class="ident" id="4828624">x</span><span class="op" id="4828625">.</span><span class="ident" id="4828626">String</span><span class="op" id="4828632">(</span><span class="op" id="4828633">)</span><br>
<span class="lineno"></span><span class="op" id="4828635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4828638">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="4828716">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="4828791">func</span>&nbsp;<span class="op" id="4828796">(</span><span class="ident" id="4828797">x</span>&nbsp;<span class="op" id="4828799">*</span><span class="ident" id="4828800">Rat</span><span class="op" id="4828803">)</span>&nbsp;<span class="ident" id="4828805">FloatString</span><span class="op" id="4828816">(</span><span class="ident" id="4828817">prec</span>&nbsp;<span class="builtintype" id="4828822">int</span><span class="op" id="4828825">)</span>&nbsp;<span class="builtintype" id="4828827">string</span>&nbsp;<span class="op" id="4828834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828837">if</span>&nbsp;<span class="ident" id="4828840">x</span><span class="op" id="4828841">.</span><span class="ident" id="4828842">IsInt</span><span class="op" id="4828847">(</span><span class="op" id="4828848">)</span>&nbsp;<span class="op" id="4828850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828854">s</span>&nbsp;<span class="op" id="4828856">:=</span>&nbsp;<span class="ident" id="4828859">x</span><span class="op" id="4828860">.</span><span class="ident" id="4828861">a</span><span class="op" id="4828862">.</span><span class="ident" id="4828863">String</span><span class="op" id="4828869">(</span><span class="op" id="4828870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828874">if</span>&nbsp;<span class="ident" id="4828877">prec</span>&nbsp;<span class="op" id="4828882">&gt;</span>&nbsp;<span class="num" id="4828884">0</span>&nbsp;<span class="op" id="4828886">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828891">s</span>&nbsp;<span class="op" id="4828893">+=</span>&nbsp;<span class="string" id="4828896">&#34;.&#34;</span>&nbsp;<span class="op" id="4828900">+</span>&nbsp;<span class="ident" id="4828902">strings</span><span class="op" id="4828909">.</span><span class="ident" id="4828910">Repeat</span><span class="op" id="4828916">(</span><span class="string" id="4828917">&#34;0&#34;</span><span class="op" id="4828920">,</span>&nbsp;<span class="ident" id="4828922">prec</span><span class="op" id="4828926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828934">return</span>&nbsp;<span class="ident" id="4828941">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4828947">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828965">q</span><span class="op" id="4828966">,</span>&nbsp;<span class="ident" id="4828968">r</span>&nbsp;<span class="op" id="4828970">:=</span>&nbsp;<span class="ident" id="4828973">nat</span><span class="op" id="4828976">(</span><span class="ident" id="4828977">nil</span><span class="op" id="4828980">)</span><span class="op" id="4828981">.</span><span class="ident" id="4828982">div</span><span class="op" id="4828985">(</span><span class="ident" id="4828986">nat</span><span class="op" id="4828989">(</span><span class="ident" id="4828990">nil</span><span class="op" id="4828993">)</span><span class="op" id="4828994">,</span>&nbsp;<span class="ident" id="4828996">x</span><span class="op" id="4828997">.</span><span class="ident" id="4828998">a</span><span class="op" id="4828999">.</span><span class="ident" id="4829000">abs</span><span class="op" id="4829003">,</span>&nbsp;<span class="ident" id="4829005">x</span><span class="op" id="4829006">.</span><span class="ident" id="4829007">b</span><span class="op" id="4829008">.</span><span class="ident" id="4829009">abs</span><span class="op" id="4829012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829016">p</span>&nbsp;<span class="op" id="4829018">:=</span>&nbsp;<span class="ident" id="4829021">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829029">if</span>&nbsp;<span class="ident" id="4829032">prec</span>&nbsp;<span class="op" id="4829037">&gt;</span>&nbsp;<span class="num" id="4829039">0</span>&nbsp;<span class="op" id="4829041">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829045">p</span>&nbsp;<span class="op" id="4829047">=</span>&nbsp;<span class="ident" id="4829049">nat</span><span class="op" id="4829052">(</span><span class="ident" id="4829053">nil</span><span class="op" id="4829056">)</span><span class="op" id="4829057">.</span><span class="ident" id="4829058">expNN</span><span class="op" id="4829063">(</span><span class="ident" id="4829064">natTen</span><span class="op" id="4829070">,</span>&nbsp;<span class="ident" id="4829072">nat</span><span class="op" id="4829075">(</span><span class="ident" id="4829076">nil</span><span class="op" id="4829079">)</span><span class="op" id="4829080">.</span><span class="ident" id="4829081">setUint64</span><span class="op" id="4829090">(</span><span class="ident" id="4829091">uint64</span><span class="op" id="4829097">(</span><span class="ident" id="4829098">prec</span><span class="op" id="4829102">)</span><span class="op" id="4829103">)</span><span class="op" id="4829104">,</span>&nbsp;<span class="ident" id="4829106">nil</span><span class="op" id="4829109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829116">r</span>&nbsp;<span class="op" id="4829118">=</span>&nbsp;<span class="ident" id="4829120">r</span><span class="op" id="4829121">.</span><span class="ident" id="4829122">mul</span><span class="op" id="4829125">(</span><span class="ident" id="4829126">r</span><span class="op" id="4829127">,</span>&nbsp;<span class="ident" id="4829129">p</span><span class="op" id="4829130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829133">r</span><span class="op" id="4829134">,</span>&nbsp;<span class="ident" id="4829136">r2</span>&nbsp;<span class="op" id="4829139">:=</span>&nbsp;<span class="ident" id="4829142">r</span><span class="op" id="4829143">.</span><span class="ident" id="4829144">div</span><span class="op" id="4829147">(</span><span class="ident" id="4829148">nat</span><span class="op" id="4829151">(</span><span class="ident" id="4829152">nil</span><span class="op" id="4829155">)</span><span class="op" id="4829156">,</span>&nbsp;<span class="ident" id="4829158">r</span><span class="op" id="4829159">,</span>&nbsp;<span class="ident" id="4829161">x</span><span class="op" id="4829162">.</span><span class="ident" id="4829163">b</span><span class="op" id="4829164">.</span><span class="ident" id="4829165">abs</span><span class="op" id="4829168">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4829172">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829203">r2</span>&nbsp;<span class="op" id="4829206">=</span>&nbsp;<span class="ident" id="4829208">r2</span><span class="op" id="4829210">.</span><span class="ident" id="4829211">add</span><span class="op" id="4829214">(</span><span class="ident" id="4829215">r2</span><span class="op" id="4829217">,</span>&nbsp;<span class="ident" id="4829219">r2</span><span class="op" id="4829221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829224">if</span>&nbsp;<span class="ident" id="4829227">x</span><span class="op" id="4829228">.</span><span class="ident" id="4829229">b</span><span class="op" id="4829230">.</span><span class="ident" id="4829231">abs</span><span class="op" id="4829234">.</span><span class="ident" id="4829235">cmp</span><span class="op" id="4829238">(</span><span class="ident" id="4829239">r2</span><span class="op" id="4829241">)</span>&nbsp;<span class="op" id="4829243">&lt;=</span>&nbsp;<span class="num" id="4829246">0</span>&nbsp;<span class="op" id="4829248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829252">r</span>&nbsp;<span class="op" id="4829254">=</span>&nbsp;<span class="ident" id="4829256">r</span><span class="op" id="4829257">.</span><span class="ident" id="4829258">add</span><span class="op" id="4829261">(</span><span class="ident" id="4829262">r</span><span class="op" id="4829263">,</span>&nbsp;<span class="ident" id="4829265">natOne</span><span class="op" id="4829271">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829275">if</span>&nbsp;<span class="ident" id="4829278">r</span><span class="op" id="4829279">.</span><span class="ident" id="4829280">cmp</span><span class="op" id="4829283">(</span><span class="ident" id="4829284">p</span><span class="op" id="4829285">)</span>&nbsp;<span class="op" id="4829287">&gt;=</span>&nbsp;<span class="num" id="4829290">0</span>&nbsp;<span class="op" id="4829292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829297">q</span>&nbsp;<span class="op" id="4829299">=</span>&nbsp;<span class="ident" id="4829301">nat</span><span class="op" id="4829304">(</span><span class="ident" id="4829305">nil</span><span class="op" id="4829308">)</span><span class="op" id="4829309">.</span><span class="ident" id="4829310">add</span><span class="op" id="4829313">(</span><span class="ident" id="4829314">q</span><span class="op" id="4829315">,</span>&nbsp;<span class="ident" id="4829317">natOne</span><span class="op" id="4829323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829328">r</span>&nbsp;<span class="op" id="4829330">=</span>&nbsp;<span class="ident" id="4829332">nat</span><span class="op" id="4829335">(</span><span class="ident" id="4829336">nil</span><span class="op" id="4829339">)</span><span class="op" id="4829340">.</span><span class="ident" id="4829341">sub</span><span class="op" id="4829344">(</span><span class="ident" id="4829345">r</span><span class="op" id="4829346">,</span>&nbsp;<span class="ident" id="4829348">p</span><span class="op" id="4829349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829356">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829360">s</span>&nbsp;<span class="op" id="4829362">:=</span>&nbsp;<span class="ident" id="4829365">q</span><span class="op" id="4829366">.</span><span class="ident" id="4829367">decimalString</span><span class="op" id="4829380">(</span><span class="op" id="4829381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829384">if</span>&nbsp;<span class="ident" id="4829387">x</span><span class="op" id="4829388">.</span><span class="ident" id="4829389">a</span><span class="op" id="4829390">.</span><span class="ident" id="4829391">neg</span>&nbsp;<span class="op" id="4829395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829399">s</span>&nbsp;<span class="op" id="4829401">=</span>&nbsp;<span class="string" id="4829403">&#34;-&#34;</span>&nbsp;<span class="op" id="4829407">+</span>&nbsp;<span class="ident" id="4829409">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829412">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829416">if</span>&nbsp;<span class="ident" id="4829419">prec</span>&nbsp;<span class="op" id="4829424">&gt;</span>&nbsp;<span class="num" id="4829426">0</span>&nbsp;<span class="op" id="4829428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829432">rs</span>&nbsp;<span class="op" id="4829435">:=</span>&nbsp;<span class="ident" id="4829438">r</span><span class="op" id="4829439">.</span><span class="ident" id="4829440">decimalString</span><span class="op" id="4829453">(</span><span class="op" id="4829454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829458">leadingZeros</span>&nbsp;<span class="op" id="4829471">:=</span>&nbsp;<span class="ident" id="4829474">prec</span>&nbsp;<span class="op" id="4829479">-</span>&nbsp;<span class="builtinfunc" id="4829481">len</span><span class="op" id="4829484">(</span><span class="ident" id="4829485">rs</span><span class="op" id="4829487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829491">s</span>&nbsp;<span class="op" id="4829493">+=</span>&nbsp;<span class="string" id="4829496">&#34;.&#34;</span>&nbsp;<span class="op" id="4829500">+</span>&nbsp;<span class="ident" id="4829502">strings</span><span class="op" id="4829509">.</span><span class="ident" id="4829510">Repeat</span><span class="op" id="4829516">(</span><span class="string" id="4829517">&#34;0&#34;</span><span class="op" id="4829520">,</span>&nbsp;<span class="ident" id="4829522">leadingZeros</span><span class="op" id="4829534">)</span>&nbsp;<span class="op" id="4829536">+</span>&nbsp;<span class="ident" id="4829538">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829546">return</span>&nbsp;<span class="ident" id="4829553">s</span><br>
<span class="lineno"></span><span class="op" id="4829555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4829558">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4829633">const</span>&nbsp;<span class="ident" id="4829639">ratGobVersion</span>&nbsp;<span class="builtintype" id="4829653">byte</span>&nbsp;<span class="op" id="4829658">=</span>&nbsp;<span class="num" id="4829660">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829663">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4829717">func</span>&nbsp;<span class="op" id="4829722">(</span><span class="ident" id="4829723">x</span>&nbsp;<span class="op" id="4829725">*</span><span class="ident" id="4829726">Rat</span><span class="op" id="4829729">)</span>&nbsp;<span class="ident" id="4829731">GobEncode</span><span class="op" id="4829740">(</span><span class="op" id="4829741">)</span>&nbsp;<span class="op" id="4829743">(</span><span class="op" id="4829744">[</span><span class="op" id="4829745">]</span><span class="builtintype" id="4829746">byte</span><span class="op" id="4829750">,</span>&nbsp;<span class="builtintype" id="4829752">error</span><span class="op" id="4829757">)</span>&nbsp;<span class="op" id="4829759">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829762">if</span>&nbsp;<span class="ident" id="4829765">x</span>&nbsp;<span class="op" id="4829767">==</span>&nbsp;<span class="ident" id="4829770">nil</span>&nbsp;<span class="op" id="4829774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829778">return</span>&nbsp;<span class="ident" id="4829785">nil</span><span class="op" id="4829788">,</span>&nbsp;<span class="ident" id="4829790">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829798">buf</span>&nbsp;<span class="op" id="4829802">:=</span>&nbsp;<span class="builtinfunc" id="4829805">make</span><span class="op" id="4829809">(</span><span class="op" id="4829810">[</span><span class="op" id="4829811">]</span><span class="builtintype" id="4829812">byte</span><span class="op" id="4829816">,</span>&nbsp;<span class="num" id="4829818">1</span><span class="op" id="4829819">+</span><span class="num" id="4829820">4</span><span class="op" id="4829821">+</span><span class="op" id="4829822">(</span><span class="builtinfunc" id="4829823">len</span><span class="op" id="4829826">(</span><span class="ident" id="4829827">x</span><span class="op" id="4829828">.</span><span class="ident" id="4829829">a</span><span class="op" id="4829830">.</span><span class="ident" id="4829831">abs</span><span class="op" id="4829834">)</span><span class="op" id="4829835">+</span><span class="builtinfunc" id="4829836">len</span><span class="op" id="4829839">(</span><span class="ident" id="4829840">x</span><span class="op" id="4829841">.</span><span class="ident" id="4829842">b</span><span class="op" id="4829843">.</span><span class="ident" id="4829844">abs</span><span class="op" id="4829847">)</span><span class="op" id="4829848">)</span><span class="op" id="4829849">*</span><span class="ident" id="4829850">_S</span><span class="op" id="4829852">)</span>&nbsp;<span class="comment" id="4829854">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829925">i</span>&nbsp;<span class="op" id="4829927">:=</span>&nbsp;<span class="ident" id="4829930">x</span><span class="op" id="4829931">.</span><span class="ident" id="4829932">b</span><span class="op" id="4829933">.</span><span class="ident" id="4829934">abs</span><span class="op" id="4829937">.</span><span class="ident" id="4829938">bytes</span><span class="op" id="4829943">(</span><span class="ident" id="4829944">buf</span><span class="op" id="4829947">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829950">j</span>&nbsp;<span class="op" id="4829952">:=</span>&nbsp;<span class="ident" id="4829955">x</span><span class="op" id="4829956">.</span><span class="ident" id="4829957">a</span><span class="op" id="4829958">.</span><span class="ident" id="4829959">abs</span><span class="op" id="4829962">.</span><span class="ident" id="4829963">bytes</span><span class="op" id="4829968">(</span><span class="ident" id="4829969">buf</span><span class="op" id="4829972">[</span><span class="num" id="4829973">0</span><span class="op" id="4829974">:</span><span class="ident" id="4829975">i</span><span class="op" id="4829976">]</span><span class="op" id="4829977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829980">n</span>&nbsp;<span class="op" id="4829982">:=</span>&nbsp;<span class="ident" id="4829985">i</span>&nbsp;<span class="op" id="4829987">-</span>&nbsp;<span class="ident" id="4829989">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829992">if</span>&nbsp;<span class="builtintype" id="4829995">int</span><span class="op" id="4829998">(</span><span class="builtintype" id="4829999">uint32</span><span class="op" id="4830005">(</span><span class="ident" id="4830006">n</span><span class="op" id="4830007">)</span><span class="op" id="4830008">)</span>&nbsp;<span class="op" id="4830010">!=</span>&nbsp;<span class="ident" id="4830013">n</span>&nbsp;<span class="op" id="4830015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830019">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830049">return</span>&nbsp;<span class="ident" id="4830056">nil</span><span class="op" id="4830059">,</span>&nbsp;<span class="ident" id="4830061">errors</span><span class="op" id="4830067">.</span><span class="ident" id="4830068">New</span><span class="op" id="4830071">(</span><span class="string" id="4830072">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="4830108">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830114">binary</span><span class="op" id="4830120">.</span><span class="ident" id="4830121">BigEndian</span><span class="op" id="4830130">.</span><span class="ident" id="4830131">PutUint32</span><span class="op" id="4830140">(</span><span class="ident" id="4830141">buf</span><span class="op" id="4830144">[</span><span class="ident" id="4830145">j</span><span class="op" id="4830146">-</span><span class="num" id="4830147">4</span><span class="op" id="4830148">:</span><span class="ident" id="4830149">j</span><span class="op" id="4830150">]</span><span class="op" id="4830151">,</span>&nbsp;<span class="builtintype" id="4830153">uint32</span><span class="op" id="4830159">(</span><span class="ident" id="4830160">n</span><span class="op" id="4830161">)</span><span class="op" id="4830162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830165">j</span>&nbsp;<span class="op" id="4830167">-=</span>&nbsp;<span class="num" id="4830170">1</span>&nbsp;<span class="op" id="4830172">+</span>&nbsp;<span class="num" id="4830174">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830177">b</span>&nbsp;<span class="op" id="4830179">:=</span>&nbsp;<span class="ident" id="4830182">ratGobVersion</span>&nbsp;<span class="op" id="4830196">&lt;&lt;</span>&nbsp;<span class="num" id="4830199">1</span>&nbsp;<span class="comment" id="4830201">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830229">if</span>&nbsp;<span class="ident" id="4830232">x</span><span class="op" id="4830233">.</span><span class="ident" id="4830234">a</span><span class="op" id="4830235">.</span><span class="ident" id="4830236">neg</span>&nbsp;<span class="op" id="4830240">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830244">b</span>&nbsp;<span class="op" id="4830246">|=</span>&nbsp;<span class="num" id="4830249">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830255">buf</span><span class="op" id="4830258">[</span><span class="ident" id="4830259">j</span><span class="op" id="4830260">]</span>&nbsp;<span class="op" id="4830262">=</span>&nbsp;<span class="ident" id="4830264">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830267">return</span>&nbsp;<span class="ident" id="4830274">buf</span><span class="op" id="4830277">[</span><span class="ident" id="4830278">j</span><span class="op" id="4830279">:</span><span class="op" id="4830280">]</span><span class="op" id="4830281">,</span>&nbsp;<span class="ident" id="4830283">nil</span><br>
<span class="lineno"></span><span class="op" id="4830287">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="4830290">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4830344">func</span>&nbsp;<span class="op" id="4830349">(</span><span class="ident" id="4830350">z</span>&nbsp;<span class="op" id="4830352">*</span><span class="ident" id="4830353">Rat</span><span class="op" id="4830356">)</span>&nbsp;<span class="ident" id="4830358">GobDecode</span><span class="op" id="4830367">(</span><span class="ident" id="4830368">buf</span>&nbsp;<span class="op" id="4830372">[</span><span class="op" id="4830373">]</span><span class="builtintype" id="4830374">byte</span><span class="op" id="4830378">)</span>&nbsp;<span class="builtintype" id="4830380">error</span>&nbsp;<span class="op" id="4830386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830389">if</span>&nbsp;<span class="builtinfunc" id="4830392">len</span><span class="op" id="4830395">(</span><span class="ident" id="4830396">buf</span><span class="op" id="4830399">)</span>&nbsp;<span class="op" id="4830401">==</span>&nbsp;<span class="num" id="4830404">0</span>&nbsp;<span class="op" id="4830406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830410">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830455">*</span><span class="ident" id="4830456">z</span>&nbsp;<span class="op" id="4830458">=</span>&nbsp;<span class="ident" id="4830460">Rat</span><span class="op" id="4830463">{</span><span class="op" id="4830464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830468">return</span>&nbsp;<span class="ident" id="4830475">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830483">b</span>&nbsp;<span class="op" id="4830485">:=</span>&nbsp;<span class="ident" id="4830488">buf</span><span class="op" id="4830491">[</span><span class="num" id="4830492">0</span><span class="op" id="4830493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830496">if</span>&nbsp;<span class="ident" id="4830499">b</span><span class="op" id="4830500">&gt;&gt;</span><span class="num" id="4830502">1</span>&nbsp;<span class="op" id="4830504">!=</span>&nbsp;<span class="ident" id="4830507">ratGobVersion</span>&nbsp;<span class="op" id="4830521">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830525">return</span>&nbsp;<span class="ident" id="4830532">errors</span><span class="op" id="4830538">.</span><span class="ident" id="4830539">New</span><span class="op" id="4830542">(</span><span class="ident" id="4830543">fmt</span><span class="op" id="4830546">.</span><span class="ident" id="4830547">Sprintf</span><span class="op" id="4830554">(</span><span class="string" id="4830555">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4830605">,</span>&nbsp;<span class="ident" id="4830607">b</span><span class="op" id="4830608">&gt;&gt;</span><span class="num" id="4830610">1</span><span class="op" id="4830611">)</span><span class="op" id="4830612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830618">const</span>&nbsp;<span class="ident" id="4830624">j</span>&nbsp;<span class="op" id="4830626">=</span>&nbsp;<span class="num" id="4830628">1</span>&nbsp;<span class="op" id="4830630">+</span>&nbsp;<span class="num" id="4830632">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830635">i</span>&nbsp;<span class="op" id="4830637">:=</span>&nbsp;<span class="ident" id="4830640">j</span>&nbsp;<span class="op" id="4830642">+</span>&nbsp;<span class="ident" id="4830644">binary</span><span class="op" id="4830650">.</span><span class="ident" id="4830651">BigEndian</span><span class="op" id="4830660">.</span><span class="ident" id="4830661">Uint32</span><span class="op" id="4830667">(</span><span class="ident" id="4830668">buf</span><span class="op" id="4830671">[</span><span class="ident" id="4830672">j</span><span class="op" id="4830673">-</span><span class="num" id="4830674">4</span><span class="op" id="4830675">:</span><span class="ident" id="4830676">j</span><span class="op" id="4830677">]</span><span class="op" id="4830678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830681">z</span><span class="op" id="4830682">.</span><span class="ident" id="4830683">a</span><span class="op" id="4830684">.</span><span class="ident" id="4830685">neg</span>&nbsp;<span class="op" id="4830689">=</span>&nbsp;<span class="ident" id="4830691">b</span><span class="op" id="4830692">&amp;</span><span class="num" id="4830693">1</span>&nbsp;<span class="op" id="4830695">!=</span>&nbsp;<span class="num" id="4830698">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830701">z</span><span class="op" id="4830702">.</span><span class="ident" id="4830703">a</span><span class="op" id="4830704">.</span><span class="ident" id="4830705">abs</span>&nbsp;<span class="op" id="4830709">=</span>&nbsp;<span class="ident" id="4830711">z</span><span class="op" id="4830712">.</span><span class="ident" id="4830713">a</span><span class="op" id="4830714">.</span><span class="ident" id="4830715">abs</span><span class="op" id="4830718">.</span><span class="ident" id="4830719">setBytes</span><span class="op" id="4830727">(</span><span class="ident" id="4830728">buf</span><span class="op" id="4830731">[</span><span class="ident" id="4830732">j</span><span class="op" id="4830733">:</span><span class="ident" id="4830734">i</span><span class="op" id="4830735">]</span><span class="op" id="4830736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830739">z</span><span class="op" id="4830740">.</span><span class="ident" id="4830741">b</span><span class="op" id="4830742">.</span><span class="ident" id="4830743">abs</span>&nbsp;<span class="op" id="4830747">=</span>&nbsp;<span class="ident" id="4830749">z</span><span class="op" id="4830750">.</span><span class="ident" id="4830751">b</span><span class="op" id="4830752">.</span><span class="ident" id="4830753">abs</span><span class="op" id="4830756">.</span><span class="ident" id="4830757">setBytes</span><span class="op" id="4830765">(</span><span class="ident" id="4830766">buf</span><span class="op" id="4830769">[</span><span class="ident" id="4830770">i</span><span class="op" id="4830771">:</span><span class="op" id="4830772">]</span><span class="op" id="4830773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830776">return</span>&nbsp;<span class="ident" id="4830783">nil</span><br>
<span class="lineno"></span><span class="op" id="4830787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4830790">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4830854">func</span>&nbsp;<span class="op" id="4830859">(</span><span class="ident" id="4830860">r</span>&nbsp;<span class="op" id="4830862">*</span><span class="ident" id="4830863">Rat</span><span class="op" id="4830866">)</span>&nbsp;<span class="ident" id="4830868">MarshalText</span><span class="op" id="4830879">(</span><span class="op" id="4830880">)</span>&nbsp;<span class="op" id="4830882">(</span><span class="ident" id="4830883">text</span>&nbsp;<span class="op" id="4830888">[</span><span class="op" id="4830889">]</span><span class="builtintype" id="4830890">byte</span><span class="op" id="4830894">,</span>&nbsp;<span class="ident" id="4830896">err</span>&nbsp;<span class="builtintype" id="4830900">error</span><span class="op" id="4830905">)</span>&nbsp;<span class="op" id="4830907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830910">return</span>&nbsp;<span class="op" id="4830917">[</span><span class="op" id="4830918">]</span><span class="builtintype" id="4830919">byte</span><span class="op" id="4830923">(</span><span class="ident" id="4830924">r</span><span class="op" id="4830925">.</span><span class="ident" id="4830926">RatString</span><span class="op" id="4830935">(</span><span class="op" id="4830936">)</span><span class="op" id="4830937">)</span><span class="op" id="4830938">,</span>&nbsp;<span class="ident" id="4830940">nil</span><br>
<span class="lineno"></span><span class="op" id="4830944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="4830947">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4831015">func</span>&nbsp;<span class="op" id="4831020">(</span><span class="ident" id="4831021">r</span>&nbsp;<span class="op" id="4831023">*</span><span class="ident" id="4831024">Rat</span><span class="op" id="4831027">)</span>&nbsp;<span class="ident" id="4831029">UnmarshalText</span><span class="op" id="4831042">(</span><span class="ident" id="4831043">text</span>&nbsp;<span class="op" id="4831048">[</span><span class="op" id="4831049">]</span><span class="builtintype" id="4831050">byte</span><span class="op" id="4831054">)</span>&nbsp;<span class="builtintype" id="4831056">error</span>&nbsp;<span class="op" id="4831062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831065">if</span>&nbsp;<span class="ident" id="4831068">_</span><span class="op" id="4831069">,</span>&nbsp;<span class="ident" id="4831071">ok</span>&nbsp;<span class="op" id="4831074">:=</span>&nbsp;<span class="ident" id="4831077">r</span><span class="op" id="4831078">.</span><span class="ident" id="4831079">SetString</span><span class="op" id="4831088">(</span><span class="builtintype" id="4831089">string</span><span class="op" id="4831095">(</span><span class="ident" id="4831096">text</span><span class="op" id="4831100">)</span><span class="op" id="4831101">)</span><span class="op" id="4831102">;</span>&nbsp;<span class="op" id="4831104">!</span><span class="ident" id="4831105">ok</span>&nbsp;<span class="op" id="4831108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831112">return</span>&nbsp;<span class="ident" id="4831119">fmt</span><span class="op" id="4831122">.</span><span class="ident" id="4831123">Errorf</span><span class="op" id="4831129">(</span><span class="string" id="4831130">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="4831177">,</span>&nbsp;<span class="ident" id="4831179">text</span><span class="op" id="4831183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831186">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831189">return</span>&nbsp;<span class="ident" id="4831196">nil</span><br>
<span class="lineno"></span><span class="op" id="4831200">}</span>
</div>
</body>
</html>
