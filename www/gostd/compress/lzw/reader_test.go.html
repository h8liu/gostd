<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8207338">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8207393">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8207447">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8207498">package</span>&nbsp;<span class="ident" id="8207506">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8207511">import</span>&nbsp;<span class="op" id="8207518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207521">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207530">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207536">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207549">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207560">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207571">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207582">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8207592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8207595">type</span>&nbsp;<span class="ident" id="8207600">lzwTest</span>&nbsp;<span class="keyword" id="8207608">struct</span>&nbsp;<span class="op" id="8207615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207618">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207629">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207637">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207648">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207656">compressed</span>&nbsp;<span class="builtintype" id="8207667">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8207675">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207686">error</span><br>
<span class="lineno"></span><span class="op" id="8207692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8207695">var</span>&nbsp;<span class="ident" id="8207699">lzwTests</span>&nbsp;<span class="op" id="8207708">=</span>&nbsp;<span class="op" id="8207710">[</span><span class="op" id="8207711">]</span><span class="ident" id="8207712">lzwTest</span><span class="op" id="8207719">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207726">&#34;empty;LSB;8&#34;</span><span class="op" id="8207739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207743">&#34;&#34;</span><span class="op" id="8207745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207749">&#34;\x01\x01&#34;</span><span class="op" id="8207759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207763">nil</span><span class="op" id="8207766">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207769">}</span><span class="op" id="8207770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207777">&#34;empty;MSB;8&#34;</span><span class="op" id="8207790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207794">&#34;&#34;</span><span class="op" id="8207796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207800">&#34;\x80\x80&#34;</span><span class="op" id="8207810">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207814">nil</span><span class="op" id="8207817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207820">}</span><span class="op" id="8207821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207828">&#34;tobe;LSB;7&#34;</span><span class="op" id="8207840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207844">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8207870">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207874">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8207944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8207948">nil</span><span class="op" id="8207951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207954">}</span><span class="op" id="8207955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8207958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207962">&#34;tobe;LSB;8&#34;</span><span class="op" id="8207974">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8207978">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8208004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208008">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="8208090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8208094">nil</span><span class="op" id="8208097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208100">}</span><span class="op" id="8208101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208104">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208108">&#34;tobe;MSB;7&#34;</span><span class="op" id="8208120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208124">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8208150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208154">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8208224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8208228">nil</span><span class="op" id="8208231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208234">}</span><span class="op" id="8208235">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208242">&#34;tobe;MSB;8&#34;</span><span class="op" id="8208254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208258">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8208284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208288">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="8208370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8208374">nil</span><span class="op" id="8208377">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208380">}</span><span class="op" id="8208381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208388">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="8208410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208414">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8208440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208444">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="8208490">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8208494">io</span><span class="op" id="8208496">.</span><span class="ident" id="8208497">ErrUnexpectedEOF</span><span class="op" id="8208513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208516">}</span><span class="op" id="8208517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8208520">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208610">&#34;gif;LSB;8&#34;</span><span class="op" id="8208621">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208625">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="8208687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208691">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="8208737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8208741">nil</span><span class="op" id="8208744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208747">}</span><span class="op" id="8208748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8208751">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208864">&#34;pdf;MSB;8&#34;</span><span class="op" id="8208875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208879">&#34;-----A---B&#34;</span><span class="op" id="8208891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8208895">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="8208933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8208937">nil</span><span class="op" id="8208940">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8208943">}</span><span class="op" id="8208944">,</span><br>
<span class="lineno"></span><span class="op" id="8208946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8208949">func</span>&nbsp;<span class="ident" id="8208954">TestReader</span><span class="op" id="8208964">(</span><span class="ident" id="8208965">t</span>&nbsp;<span class="op" id="8208967">*</span><span class="ident" id="8208968">testing</span><span class="op" id="8208975">.</span><span class="ident" id="8208976">T</span><span class="op" id="8208977">)</span>&nbsp;<span class="op" id="8208979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8208982">var</span>&nbsp;<span class="ident" id="8208986">b</span>&nbsp;<span class="ident" id="8208988">bytes</span><span class="op" id="8208993">.</span><span class="ident" id="8208994">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209002">for</span>&nbsp;<span class="ident" id="8209006">_</span><span class="op" id="8209007">,</span>&nbsp;<span class="ident" id="8209009">tt</span>&nbsp;<span class="op" id="8209012">:=</span>&nbsp;<span class="keyword" id="8209015">range</span>&nbsp;<span class="ident" id="8209021">lzwTests</span>&nbsp;<span class="op" id="8209030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209034">d</span>&nbsp;<span class="op" id="8209036">:=</span>&nbsp;<span class="ident" id="8209039">strings</span><span class="op" id="8209046">.</span><span class="ident" id="8209047">Split</span><span class="op" id="8209052">(</span><span class="ident" id="8209053">tt</span><span class="op" id="8209055">.</span><span class="ident" id="8209056">desc</span><span class="op" id="8209060">,</span>&nbsp;<span class="string" id="8209062">&#34;;&#34;</span><span class="op" id="8209065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209069">var</span>&nbsp;<span class="ident" id="8209073">order</span>&nbsp;<span class="ident" id="8209079">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209087">switch</span>&nbsp;<span class="ident" id="8209094">d</span><span class="op" id="8209095">[</span><span class="num" id="8209096">1</span><span class="op" id="8209097">]</span>&nbsp;<span class="op" id="8209099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209103">case</span>&nbsp;<span class="string" id="8209108">&#34;LSB&#34;</span><span class="op" id="8209113">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209118">order</span>&nbsp;<span class="op" id="8209124">=</span>&nbsp;<span class="ident" id="8209126">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209132">case</span>&nbsp;<span class="string" id="8209137">&#34;MSB&#34;</span><span class="op" id="8209142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209147">order</span>&nbsp;<span class="op" id="8209153">=</span>&nbsp;<span class="ident" id="8209155">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209161">default</span><span class="op" id="8209168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209173">t</span><span class="op" id="8209174">.</span><span class="ident" id="8209175">Errorf</span><span class="op" id="8209181">(</span><span class="string" id="8209182">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="8209200">,</span>&nbsp;<span class="ident" id="8209202">tt</span><span class="op" id="8209204">.</span><span class="ident" id="8209205">desc</span><span class="op" id="8209209">,</span>&nbsp;<span class="ident" id="8209211">d</span><span class="op" id="8209212">[</span><span class="num" id="8209213">1</span><span class="op" id="8209214">]</span><span class="op" id="8209215">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209223">litWidth</span><span class="op" id="8209231">,</span>&nbsp;<span class="ident" id="8209233">_</span>&nbsp;<span class="op" id="8209235">:=</span>&nbsp;<span class="ident" id="8209238">strconv</span><span class="op" id="8209245">.</span><span class="ident" id="8209246">Atoi</span><span class="op" id="8209250">(</span><span class="ident" id="8209251">d</span><span class="op" id="8209252">[</span><span class="num" id="8209253">2</span><span class="op" id="8209254">]</span><span class="op" id="8209255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209259">rc</span>&nbsp;<span class="op" id="8209262">:=</span>&nbsp;<span class="ident" id="8209265">NewReader</span><span class="op" id="8209274">(</span><span class="ident" id="8209275">strings</span><span class="op" id="8209282">.</span><span class="ident" id="8209283">NewReader</span><span class="op" id="8209292">(</span><span class="ident" id="8209293">tt</span><span class="op" id="8209295">.</span><span class="ident" id="8209296">compressed</span><span class="op" id="8209306">)</span><span class="op" id="8209307">,</span>&nbsp;<span class="ident" id="8209309">order</span><span class="op" id="8209314">,</span>&nbsp;<span class="ident" id="8209316">litWidth</span><span class="op" id="8209324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209328">defer</span>&nbsp;<span class="ident" id="8209334">rc</span><span class="op" id="8209336">.</span><span class="ident" id="8209337">Close</span><span class="op" id="8209342">(</span><span class="op" id="8209343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209347">b</span><span class="op" id="8209348">.</span><span class="ident" id="8209349">Reset</span><span class="op" id="8209354">(</span><span class="op" id="8209355">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209359">n</span><span class="op" id="8209360">,</span>&nbsp;<span class="ident" id="8209362">err</span>&nbsp;<span class="op" id="8209366">:=</span>&nbsp;<span class="ident" id="8209369">io</span><span class="op" id="8209371">.</span><span class="ident" id="8209372">Copy</span><span class="op" id="8209376">(</span><span class="op" id="8209377">&amp;</span><span class="ident" id="8209378">b</span><span class="op" id="8209379">,</span>&nbsp;<span class="ident" id="8209381">rc</span><span class="op" id="8209383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209387">if</span>&nbsp;<span class="ident" id="8209390">err</span>&nbsp;<span class="op" id="8209394">!=</span>&nbsp;<span class="builtintype" id="8209397">nil</span>&nbsp;<span class="op" id="8209401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209406">if</span>&nbsp;<span class="ident" id="8209409">err</span>&nbsp;<span class="op" id="8209413">!=</span>&nbsp;<span class="ident" id="8209416">tt</span><span class="op" id="8209418">.</span><span class="ident" id="8209419">err</span>&nbsp;<span class="op" id="8209423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209429">t</span><span class="op" id="8209430">.</span><span class="ident" id="8209431">Errorf</span><span class="op" id="8209437">(</span><span class="string" id="8209438">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8209463">,</span>&nbsp;<span class="ident" id="8209465">tt</span><span class="op" id="8209467">.</span><span class="ident" id="8209468">desc</span><span class="op" id="8209472">,</span>&nbsp;<span class="ident" id="8209474">err</span><span class="op" id="8209477">,</span>&nbsp;<span class="ident" id="8209479">tt</span><span class="op" id="8209481">.</span><span class="ident" id="8209482">err</span><span class="op" id="8209485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209490">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209495">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209510">s</span>&nbsp;<span class="op" id="8209512">:=</span>&nbsp;<span class="ident" id="8209515">b</span><span class="op" id="8209516">.</span><span class="ident" id="8209517">String</span><span class="op" id="8209523">(</span><span class="op" id="8209524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209528">if</span>&nbsp;<span class="ident" id="8209531">s</span>&nbsp;<span class="op" id="8209533">!=</span>&nbsp;<span class="ident" id="8209536">tt</span><span class="op" id="8209538">.</span><span class="ident" id="8209539">raw</span>&nbsp;<span class="op" id="8209543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209548">t</span><span class="op" id="8209549">.</span><span class="ident" id="8209550">Errorf</span><span class="op" id="8209556">(</span><span class="string" id="8209557">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="8209593">,</span>&nbsp;<span class="ident" id="8209595">tt</span><span class="op" id="8209597">.</span><span class="ident" id="8209598">desc</span><span class="op" id="8209602">,</span>&nbsp;<span class="ident" id="8209604">n</span><span class="op" id="8209605">,</span>&nbsp;<span class="ident" id="8209607">s</span><span class="op" id="8209608">,</span>&nbsp;<span class="builtinfunc" id="8209610">len</span><span class="op" id="8209613">(</span><span class="ident" id="8209614">tt</span><span class="op" id="8209616">.</span><span class="ident" id="8209617">raw</span><span class="op" id="8209620">)</span><span class="op" id="8209621">,</span>&nbsp;<span class="ident" id="8209623">tt</span><span class="op" id="8209625">.</span><span class="ident" id="8209626">raw</span><span class="op" id="8209629">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209636">}</span><br>
<span class="lineno"></span><span class="op" id="8209638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8209641">func</span>&nbsp;<span class="ident" id="8209646">benchmarkDecoder</span><span class="op" id="8209662">(</span><span class="ident" id="8209663">b</span>&nbsp;<span class="op" id="8209665">*</span><span class="ident" id="8209666">testing</span><span class="op" id="8209673">.</span><span class="ident" id="8209674">B</span><span class="op" id="8209675">,</span>&nbsp;<span class="ident" id="8209677">n</span>&nbsp;<span class="builtintype" id="8209679">int</span><span class="op" id="8209682">)</span>&nbsp;<span class="op" id="8209684">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209687">b</span><span class="op" id="8209688">.</span><span class="ident" id="8209689">StopTimer</span><span class="op" id="8209698">(</span><span class="op" id="8209699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209702">b</span><span class="op" id="8209703">.</span><span class="ident" id="8209704">SetBytes</span><span class="op" id="8209712">(</span><span class="builtintype" id="8209713">int64</span><span class="op" id="8209718">(</span><span class="ident" id="8209719">n</span><span class="op" id="8209720">)</span><span class="op" id="8209721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209724">buf0</span><span class="op" id="8209728">,</span>&nbsp;<span class="ident" id="8209730">err</span>&nbsp;<span class="op" id="8209734">:=</span>&nbsp;<span class="ident" id="8209737">ioutil</span><span class="op" id="8209743">.</span><span class="ident" id="8209744">ReadFile</span><span class="op" id="8209752">(</span><span class="string" id="8209753">&#34;../testdata/e.txt&#34;</span><span class="op" id="8209772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209775">if</span>&nbsp;<span class="ident" id="8209778">err</span>&nbsp;<span class="op" id="8209782">!=</span>&nbsp;<span class="builtintype" id="8209785">nil</span>&nbsp;<span class="op" id="8209789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209793">b</span><span class="op" id="8209794">.</span><span class="ident" id="8209795">Fatal</span><span class="op" id="8209800">(</span><span class="ident" id="8209801">err</span><span class="op" id="8209804">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209810">if</span>&nbsp;<span class="builtinfunc" id="8209813">len</span><span class="op" id="8209816">(</span><span class="ident" id="8209817">buf0</span><span class="op" id="8209821">)</span>&nbsp;<span class="op" id="8209823">==</span>&nbsp;<span class="num" id="8209826">0</span>&nbsp;<span class="op" id="8209828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209832">b</span><span class="op" id="8209833">.</span><span class="ident" id="8209834">Fatalf</span><span class="op" id="8209840">(</span><span class="string" id="8209841">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="8209864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8209867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209870">compressed</span>&nbsp;<span class="op" id="8209881">:=</span>&nbsp;<span class="builtinfunc" id="8209884">new</span><span class="op" id="8209887">(</span><span class="ident" id="8209888">bytes</span><span class="op" id="8209893">.</span><span class="ident" id="8209894">Buffer</span><span class="op" id="8209900">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8209903">w</span>&nbsp;<span class="op" id="8209905">:=</span>&nbsp;<span class="ident" id="8209908">NewWriter</span><span class="op" id="8209917">(</span><span class="ident" id="8209918">compressed</span><span class="op" id="8209928">,</span>&nbsp;<span class="ident" id="8209930">LSB</span><span class="op" id="8209933">,</span>&nbsp;<span class="num" id="8209935">8</span><span class="op" id="8209936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209939">for</span>&nbsp;<span class="ident" id="8209943">i</span>&nbsp;<span class="op" id="8209945">:=</span>&nbsp;<span class="num" id="8209948">0</span><span class="op" id="8209949">;</span>&nbsp;<span class="ident" id="8209951">i</span>&nbsp;<span class="op" id="8209953">&lt;</span>&nbsp;<span class="ident" id="8209955">n</span><span class="op" id="8209956">;</span>&nbsp;<span class="ident" id="8209958">i</span>&nbsp;<span class="op" id="8209960">+=</span>&nbsp;<span class="builtinfunc" id="8209963">len</span><span class="op" id="8209966">(</span><span class="ident" id="8209967">buf0</span><span class="op" id="8209971">)</span>&nbsp;<span class="op" id="8209973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8209977">if</span>&nbsp;<span class="builtinfunc" id="8209980">len</span><span class="op" id="8209983">(</span><span class="ident" id="8209984">buf0</span><span class="op" id="8209988">)</span>&nbsp;<span class="op" id="8209990">&gt;</span>&nbsp;<span class="ident" id="8209992">n</span><span class="op" id="8209993">-</span><span class="ident" id="8209994">i</span>&nbsp;<span class="op" id="8209996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210001">buf0</span>&nbsp;<span class="op" id="8210006">=</span>&nbsp;<span class="ident" id="8210008">buf0</span><span class="op" id="8210012">[</span><span class="op" id="8210013">:</span><span class="ident" id="8210014">n</span><span class="op" id="8210015">-</span><span class="ident" id="8210016">i</span><span class="op" id="8210017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8210021">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210025">w</span><span class="op" id="8210026">.</span><span class="ident" id="8210027">Write</span><span class="op" id="8210032">(</span><span class="ident" id="8210033">buf0</span><span class="op" id="8210037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8210040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210043">w</span><span class="op" id="8210044">.</span><span class="ident" id="8210045">Close</span><span class="op" id="8210050">(</span><span class="op" id="8210051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210054">buf1</span>&nbsp;<span class="op" id="8210059">:=</span>&nbsp;<span class="ident" id="8210062">compressed</span><span class="op" id="8210072">.</span><span class="ident" id="8210073">Bytes</span><span class="op" id="8210078">(</span><span class="op" id="8210079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210082">buf0</span><span class="op" id="8210086">,</span>&nbsp;<span class="ident" id="8210088">compressed</span><span class="op" id="8210098">,</span>&nbsp;<span class="ident" id="8210100">w</span>&nbsp;<span class="op" id="8210102">=</span>&nbsp;<span class="builtintype" id="8210104">nil</span><span class="op" id="8210107">,</span>&nbsp;<span class="builtintype" id="8210109">nil</span><span class="op" id="8210112">,</span>&nbsp;<span class="builtintype" id="8210114">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210119">runtime</span><span class="op" id="8210126">.</span><span class="ident" id="8210127">GC</span><span class="op" id="8210129">(</span><span class="op" id="8210130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210133">b</span><span class="op" id="8210134">.</span><span class="ident" id="8210135">StartTimer</span><span class="op" id="8210145">(</span><span class="op" id="8210146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8210149">for</span>&nbsp;<span class="ident" id="8210153">i</span>&nbsp;<span class="op" id="8210155">:=</span>&nbsp;<span class="num" id="8210158">0</span><span class="op" id="8210159">;</span>&nbsp;<span class="ident" id="8210161">i</span>&nbsp;<span class="op" id="8210163">&lt;</span>&nbsp;<span class="ident" id="8210165">b</span><span class="op" id="8210166">.</span><span class="ident" id="8210167">N</span><span class="op" id="8210168">;</span>&nbsp;<span class="ident" id="8210170">i</span><span class="op" id="8210171">++</span>&nbsp;<span class="op" id="8210174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210178">io</span><span class="op" id="8210180">.</span><span class="ident" id="8210181">Copy</span><span class="op" id="8210185">(</span><span class="ident" id="8210186">ioutil</span><span class="op" id="8210192">.</span><span class="ident" id="8210193">Discard</span><span class="op" id="8210200">,</span>&nbsp;<span class="ident" id="8210202">NewReader</span><span class="op" id="8210211">(</span><span class="ident" id="8210212">bytes</span><span class="op" id="8210217">.</span><span class="ident" id="8210218">NewReader</span><span class="op" id="8210227">(</span><span class="ident" id="8210228">buf1</span><span class="op" id="8210232">)</span><span class="op" id="8210233">,</span>&nbsp;<span class="ident" id="8210235">LSB</span><span class="op" id="8210238">,</span>&nbsp;<span class="num" id="8210240">8</span><span class="op" id="8210241">)</span><span class="op" id="8210242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8210245">}</span><br>
<span class="lineno">140</span><span class="op" id="8210247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8210250">func</span>&nbsp;<span class="ident" id="8210255">BenchmarkDecoder1e4</span><span class="op" id="8210274">(</span><span class="ident" id="8210275">b</span>&nbsp;<span class="op" id="8210277">*</span><span class="ident" id="8210278">testing</span><span class="op" id="8210285">.</span><span class="ident" id="8210286">B</span><span class="op" id="8210287">)</span>&nbsp;<span class="op" id="8210289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210292">benchmarkDecoder</span><span class="op" id="8210308">(</span><span class="ident" id="8210309">b</span><span class="op" id="8210310">,</span>&nbsp;<span class="num" id="8210312">1e4</span><span class="op" id="8210315">)</span><br>
<span class="lineno"></span><span class="op" id="8210317">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8210320">func</span>&nbsp;<span class="ident" id="8210325">BenchmarkDecoder1e5</span><span class="op" id="8210344">(</span><span class="ident" id="8210345">b</span>&nbsp;<span class="op" id="8210347">*</span><span class="ident" id="8210348">testing</span><span class="op" id="8210355">.</span><span class="ident" id="8210356">B</span><span class="op" id="8210357">)</span>&nbsp;<span class="op" id="8210359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210362">benchmarkDecoder</span><span class="op" id="8210378">(</span><span class="ident" id="8210379">b</span><span class="op" id="8210380">,</span>&nbsp;<span class="num" id="8210382">1e5</span><span class="op" id="8210385">)</span><br>
<span class="lineno"></span><span class="op" id="8210387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="8210390">func</span>&nbsp;<span class="ident" id="8210395">BenchmarkDecoder1e6</span><span class="op" id="8210414">(</span><span class="ident" id="8210415">b</span>&nbsp;<span class="op" id="8210417">*</span><span class="ident" id="8210418">testing</span><span class="op" id="8210425">.</span><span class="ident" id="8210426">B</span><span class="op" id="8210427">)</span>&nbsp;<span class="op" id="8210429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8210432">benchmarkDecoder</span><span class="op" id="8210448">(</span><span class="ident" id="8210449">b</span><span class="op" id="8210450">,</span>&nbsp;<span class="num" id="8210452">1e6</span><span class="op" id="8210455">)</span><br>
<span class="lineno"></span><span class="op" id="8210457">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
