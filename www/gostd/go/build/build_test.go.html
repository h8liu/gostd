<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8281005">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8281061">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8281115">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8281166">package</span>&nbsp;<span class="ident" id="8281174">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281181">import</span>&nbsp;<span class="op" id="8281188">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281191">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281197">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281203">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281220">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281231">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281242">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8281253">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8281263">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281266">func</span>&nbsp;<span class="ident" id="8281271">TestMatch</span><span class="op" id="8281280">(</span><span class="ident" id="8281281">t</span>&nbsp;<span class="op" id="8281283">*</span><span class="ident" id="8281284">testing</span><span class="op" id="8281291">.</span><span class="ident" id="8281292">T</span><span class="op" id="8281293">)</span>&nbsp;<span class="op" id="8281295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281298">ctxt</span>&nbsp;<span class="op" id="8281303">:=</span>&nbsp;<span class="ident" id="8281306">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281315">what</span>&nbsp;<span class="op" id="8281320">:=</span>&nbsp;<span class="string" id="8281323">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281334">match</span>&nbsp;<span class="op" id="8281340">:=</span>&nbsp;<span class="keyword" id="8281343">func</span><span class="op" id="8281347">(</span><span class="ident" id="8281348">tag</span>&nbsp;<span class="builtintype" id="8281352">string</span><span class="op" id="8281358">,</span>&nbsp;<span class="ident" id="8281360">want</span>&nbsp;<span class="keyword" id="8281365">map</span><span class="op" id="8281368">[</span><span class="builtintype" id="8281369">string</span><span class="op" id="8281375">]</span><span class="builtintype" id="8281376">bool</span><span class="op" id="8281380">)</span>&nbsp;<span class="op" id="8281382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281386">m</span>&nbsp;<span class="op" id="8281388">:=</span>&nbsp;<span class="builtinfunc" id="8281391">make</span><span class="op" id="8281395">(</span><span class="keyword" id="8281396">map</span><span class="op" id="8281399">[</span><span class="builtintype" id="8281400">string</span><span class="op" id="8281406">]</span><span class="builtintype" id="8281407">bool</span><span class="op" id="8281411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281415">if</span>&nbsp;<span class="op" id="8281418">!</span><span class="ident" id="8281419">ctxt</span><span class="op" id="8281423">.</span><span class="ident" id="8281424">match</span><span class="op" id="8281429">(</span><span class="ident" id="8281430">tag</span><span class="op" id="8281433">,</span>&nbsp;<span class="ident" id="8281435">m</span><span class="op" id="8281436">)</span>&nbsp;<span class="op" id="8281438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281443">t</span><span class="op" id="8281444">.</span><span class="ident" id="8281445">Errorf</span><span class="op" id="8281451">(</span><span class="string" id="8281452">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="8281490">,</span>&nbsp;<span class="ident" id="8281492">what</span><span class="op" id="8281496">,</span>&nbsp;<span class="ident" id="8281498">tag</span><span class="op" id="8281501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281505">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281509">if</span>&nbsp;<span class="op" id="8281512">!</span><span class="ident" id="8281513">reflect</span><span class="op" id="8281520">.</span><span class="ident" id="8281521">DeepEqual</span><span class="op" id="8281530">(</span><span class="ident" id="8281531">m</span><span class="op" id="8281532">,</span>&nbsp;<span class="ident" id="8281534">want</span><span class="op" id="8281538">)</span>&nbsp;<span class="op" id="8281540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281545">t</span><span class="op" id="8281546">.</span><span class="ident" id="8281547">Errorf</span><span class="op" id="8281553">(</span><span class="string" id="8281554">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8281577">,</span>&nbsp;<span class="ident" id="8281579">tag</span><span class="op" id="8281582">,</span>&nbsp;<span class="ident" id="8281584">m</span><span class="op" id="8281585">,</span>&nbsp;<span class="ident" id="8281587">want</span><span class="op" id="8281591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281601">nomatch</span>&nbsp;<span class="op" id="8281609">:=</span>&nbsp;<span class="keyword" id="8281612">func</span><span class="op" id="8281616">(</span><span class="ident" id="8281617">tag</span>&nbsp;<span class="builtintype" id="8281621">string</span><span class="op" id="8281627">,</span>&nbsp;<span class="ident" id="8281629">want</span>&nbsp;<span class="keyword" id="8281634">map</span><span class="op" id="8281637">[</span><span class="builtintype" id="8281638">string</span><span class="op" id="8281644">]</span><span class="builtintype" id="8281645">bool</span><span class="op" id="8281649">)</span>&nbsp;<span class="op" id="8281651">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281655">m</span>&nbsp;<span class="op" id="8281657">:=</span>&nbsp;<span class="builtinfunc" id="8281660">make</span><span class="op" id="8281664">(</span><span class="keyword" id="8281665">map</span><span class="op" id="8281668">[</span><span class="builtintype" id="8281669">string</span><span class="op" id="8281675">]</span><span class="builtintype" id="8281676">bool</span><span class="op" id="8281680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281684">if</span>&nbsp;<span class="ident" id="8281687">ctxt</span><span class="op" id="8281691">.</span><span class="ident" id="8281692">match</span><span class="op" id="8281697">(</span><span class="ident" id="8281698">tag</span><span class="op" id="8281701">,</span>&nbsp;<span class="ident" id="8281703">m</span><span class="op" id="8281704">)</span>&nbsp;<span class="op" id="8281706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281711">t</span><span class="op" id="8281712">.</span><span class="ident" id="8281713">Errorf</span><span class="op" id="8281719">(</span><span class="string" id="8281720">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="8281758">,</span>&nbsp;<span class="ident" id="8281760">what</span><span class="op" id="8281764">,</span>&nbsp;<span class="ident" id="8281766">tag</span><span class="op" id="8281769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281777">if</span>&nbsp;<span class="op" id="8281780">!</span><span class="ident" id="8281781">reflect</span><span class="op" id="8281788">.</span><span class="ident" id="8281789">DeepEqual</span><span class="op" id="8281798">(</span><span class="ident" id="8281799">m</span><span class="op" id="8281800">,</span>&nbsp;<span class="ident" id="8281802">want</span><span class="op" id="8281806">)</span>&nbsp;<span class="op" id="8281808">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281813">t</span><span class="op" id="8281814">.</span><span class="ident" id="8281815">Errorf</span><span class="op" id="8281821">(</span><span class="string" id="8281822">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8281845">,</span>&nbsp;<span class="ident" id="8281847">tag</span><span class="op" id="8281850">,</span>&nbsp;<span class="ident" id="8281852">m</span><span class="op" id="8281853">,</span>&nbsp;<span class="ident" id="8281855">want</span><span class="op" id="8281859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281870">match</span><span class="op" id="8281875">(</span><span class="ident" id="8281876">runtime</span><span class="op" id="8281883">.</span><span class="ident" id="8281884">GOOS</span><span class="op" id="8281888">+</span><span class="string" id="8281889">&#34;,&#34;</span><span class="op" id="8281892">+</span><span class="ident" id="8281893">runtime</span><span class="op" id="8281900">.</span><span class="ident" id="8281901">GOARCH</span><span class="op" id="8281907">,</span>&nbsp;<span class="keyword" id="8281909">map</span><span class="op" id="8281912">[</span><span class="builtintype" id="8281913">string</span><span class="op" id="8281919">]</span><span class="builtintype" id="8281920">bool</span><span class="op" id="8281924">{</span><span class="ident" id="8281925">runtime</span><span class="op" id="8281932">.</span><span class="ident" id="8281933">GOOS</span><span class="op" id="8281937">:</span>&nbsp;<span class="builtintype" id="8281939">true</span><span class="op" id="8281943">,</span>&nbsp;<span class="ident" id="8281945">runtime</span><span class="op" id="8281952">.</span><span class="ident" id="8281953">GOARCH</span><span class="op" id="8281959">:</span>&nbsp;<span class="builtintype" id="8281961">true</span><span class="op" id="8281965">}</span><span class="op" id="8281966">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281969">match</span><span class="op" id="8281974">(</span><span class="ident" id="8281975">runtime</span><span class="op" id="8281982">.</span><span class="ident" id="8281983">GOOS</span><span class="op" id="8281987">+</span><span class="string" id="8281988">&#34;,&#34;</span><span class="op" id="8281991">+</span><span class="ident" id="8281992">runtime</span><span class="op" id="8281999">.</span><span class="ident" id="8282000">GOARCH</span><span class="op" id="8282006">+</span><span class="string" id="8282007">&#34;,!foo&#34;</span><span class="op" id="8282014">,</span>&nbsp;<span class="keyword" id="8282016">map</span><span class="op" id="8282019">[</span><span class="builtintype" id="8282020">string</span><span class="op" id="8282026">]</span><span class="builtintype" id="8282027">bool</span><span class="op" id="8282031">{</span><span class="ident" id="8282032">runtime</span><span class="op" id="8282039">.</span><span class="ident" id="8282040">GOOS</span><span class="op" id="8282044">:</span>&nbsp;<span class="builtintype" id="8282046">true</span><span class="op" id="8282050">,</span>&nbsp;<span class="ident" id="8282052">runtime</span><span class="op" id="8282059">.</span><span class="ident" id="8282060">GOARCH</span><span class="op" id="8282066">:</span>&nbsp;<span class="builtintype" id="8282068">true</span><span class="op" id="8282072">,</span>&nbsp;<span class="string" id="8282074">&#34;foo&#34;</span><span class="op" id="8282079">:</span>&nbsp;<span class="builtintype" id="8282081">true</span><span class="op" id="8282085">}</span><span class="op" id="8282086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282089">nomatch</span><span class="op" id="8282096">(</span><span class="ident" id="8282097">runtime</span><span class="op" id="8282104">.</span><span class="ident" id="8282105">GOOS</span><span class="op" id="8282109">+</span><span class="string" id="8282110">&#34;,&#34;</span><span class="op" id="8282113">+</span><span class="ident" id="8282114">runtime</span><span class="op" id="8282121">.</span><span class="ident" id="8282122">GOARCH</span><span class="op" id="8282128">+</span><span class="string" id="8282129">&#34;,foo&#34;</span><span class="op" id="8282135">,</span>&nbsp;<span class="keyword" id="8282137">map</span><span class="op" id="8282140">[</span><span class="builtintype" id="8282141">string</span><span class="op" id="8282147">]</span><span class="builtintype" id="8282148">bool</span><span class="op" id="8282152">{</span><span class="ident" id="8282153">runtime</span><span class="op" id="8282160">.</span><span class="ident" id="8282161">GOOS</span><span class="op" id="8282165">:</span>&nbsp;<span class="builtintype" id="8282167">true</span><span class="op" id="8282171">,</span>&nbsp;<span class="ident" id="8282173">runtime</span><span class="op" id="8282180">.</span><span class="ident" id="8282181">GOARCH</span><span class="op" id="8282187">:</span>&nbsp;<span class="builtintype" id="8282189">true</span><span class="op" id="8282193">,</span>&nbsp;<span class="string" id="8282195">&#34;foo&#34;</span><span class="op" id="8282200">:</span>&nbsp;<span class="builtintype" id="8282202">true</span><span class="op" id="8282206">}</span><span class="op" id="8282207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282211">what</span>&nbsp;<span class="op" id="8282216">=</span>&nbsp;<span class="string" id="8282218">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282230">ctxt</span><span class="op" id="8282234">.</span><span class="ident" id="8282235">BuildTags</span>&nbsp;<span class="op" id="8282245">=</span>&nbsp;<span class="op" id="8282247">[</span><span class="op" id="8282248">]</span><span class="builtintype" id="8282249">string</span><span class="op" id="8282255">{</span><span class="string" id="8282256">&#34;foo&#34;</span><span class="op" id="8282261">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282264">match</span><span class="op" id="8282269">(</span><span class="ident" id="8282270">runtime</span><span class="op" id="8282277">.</span><span class="ident" id="8282278">GOOS</span><span class="op" id="8282282">+</span><span class="string" id="8282283">&#34;,&#34;</span><span class="op" id="8282286">+</span><span class="ident" id="8282287">runtime</span><span class="op" id="8282294">.</span><span class="ident" id="8282295">GOARCH</span><span class="op" id="8282301">,</span>&nbsp;<span class="keyword" id="8282303">map</span><span class="op" id="8282306">[</span><span class="builtintype" id="8282307">string</span><span class="op" id="8282313">]</span><span class="builtintype" id="8282314">bool</span><span class="op" id="8282318">{</span><span class="ident" id="8282319">runtime</span><span class="op" id="8282326">.</span><span class="ident" id="8282327">GOOS</span><span class="op" id="8282331">:</span>&nbsp;<span class="builtintype" id="8282333">true</span><span class="op" id="8282337">,</span>&nbsp;<span class="ident" id="8282339">runtime</span><span class="op" id="8282346">.</span><span class="ident" id="8282347">GOARCH</span><span class="op" id="8282353">:</span>&nbsp;<span class="builtintype" id="8282355">true</span><span class="op" id="8282359">}</span><span class="op" id="8282360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282363">match</span><span class="op" id="8282368">(</span><span class="ident" id="8282369">runtime</span><span class="op" id="8282376">.</span><span class="ident" id="8282377">GOOS</span><span class="op" id="8282381">+</span><span class="string" id="8282382">&#34;,&#34;</span><span class="op" id="8282385">+</span><span class="ident" id="8282386">runtime</span><span class="op" id="8282393">.</span><span class="ident" id="8282394">GOARCH</span><span class="op" id="8282400">+</span><span class="string" id="8282401">&#34;,foo&#34;</span><span class="op" id="8282407">,</span>&nbsp;<span class="keyword" id="8282409">map</span><span class="op" id="8282412">[</span><span class="builtintype" id="8282413">string</span><span class="op" id="8282419">]</span><span class="builtintype" id="8282420">bool</span><span class="op" id="8282424">{</span><span class="ident" id="8282425">runtime</span><span class="op" id="8282432">.</span><span class="ident" id="8282433">GOOS</span><span class="op" id="8282437">:</span>&nbsp;<span class="builtintype" id="8282439">true</span><span class="op" id="8282443">,</span>&nbsp;<span class="ident" id="8282445">runtime</span><span class="op" id="8282452">.</span><span class="ident" id="8282453">GOARCH</span><span class="op" id="8282459">:</span>&nbsp;<span class="builtintype" id="8282461">true</span><span class="op" id="8282465">,</span>&nbsp;<span class="string" id="8282467">&#34;foo&#34;</span><span class="op" id="8282472">:</span>&nbsp;<span class="builtintype" id="8282474">true</span><span class="op" id="8282478">}</span><span class="op" id="8282479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282482">nomatch</span><span class="op" id="8282489">(</span><span class="ident" id="8282490">runtime</span><span class="op" id="8282497">.</span><span class="ident" id="8282498">GOOS</span><span class="op" id="8282502">+</span><span class="string" id="8282503">&#34;,&#34;</span><span class="op" id="8282506">+</span><span class="ident" id="8282507">runtime</span><span class="op" id="8282514">.</span><span class="ident" id="8282515">GOARCH</span><span class="op" id="8282521">+</span><span class="string" id="8282522">&#34;,!foo&#34;</span><span class="op" id="8282529">,</span>&nbsp;<span class="keyword" id="8282531">map</span><span class="op" id="8282534">[</span><span class="builtintype" id="8282535">string</span><span class="op" id="8282541">]</span><span class="builtintype" id="8282542">bool</span><span class="op" id="8282546">{</span><span class="ident" id="8282547">runtime</span><span class="op" id="8282554">.</span><span class="ident" id="8282555">GOOS</span><span class="op" id="8282559">:</span>&nbsp;<span class="builtintype" id="8282561">true</span><span class="op" id="8282565">,</span>&nbsp;<span class="ident" id="8282567">runtime</span><span class="op" id="8282574">.</span><span class="ident" id="8282575">GOARCH</span><span class="op" id="8282581">:</span>&nbsp;<span class="builtintype" id="8282583">true</span><span class="op" id="8282587">,</span>&nbsp;<span class="string" id="8282589">&#34;foo&#34;</span><span class="op" id="8282594">:</span>&nbsp;<span class="builtintype" id="8282596">true</span><span class="op" id="8282600">}</span><span class="op" id="8282601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282604">match</span><span class="op" id="8282609">(</span><span class="ident" id="8282610">runtime</span><span class="op" id="8282617">.</span><span class="ident" id="8282618">GOOS</span><span class="op" id="8282622">+</span><span class="string" id="8282623">&#34;,&#34;</span><span class="op" id="8282626">+</span><span class="ident" id="8282627">runtime</span><span class="op" id="8282634">.</span><span class="ident" id="8282635">GOARCH</span><span class="op" id="8282641">+</span><span class="string" id="8282642">&#34;,!bar&#34;</span><span class="op" id="8282649">,</span>&nbsp;<span class="keyword" id="8282651">map</span><span class="op" id="8282654">[</span><span class="builtintype" id="8282655">string</span><span class="op" id="8282661">]</span><span class="builtintype" id="8282662">bool</span><span class="op" id="8282666">{</span><span class="ident" id="8282667">runtime</span><span class="op" id="8282674">.</span><span class="ident" id="8282675">GOOS</span><span class="op" id="8282679">:</span>&nbsp;<span class="builtintype" id="8282681">true</span><span class="op" id="8282685">,</span>&nbsp;<span class="ident" id="8282687">runtime</span><span class="op" id="8282694">.</span><span class="ident" id="8282695">GOARCH</span><span class="op" id="8282701">:</span>&nbsp;<span class="builtintype" id="8282703">true</span><span class="op" id="8282707">,</span>&nbsp;<span class="string" id="8282709">&#34;bar&#34;</span><span class="op" id="8282714">:</span>&nbsp;<span class="builtintype" id="8282716">true</span><span class="op" id="8282720">}</span><span class="op" id="8282721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282724">nomatch</span><span class="op" id="8282731">(</span><span class="ident" id="8282732">runtime</span><span class="op" id="8282739">.</span><span class="ident" id="8282740">GOOS</span><span class="op" id="8282744">+</span><span class="string" id="8282745">&#34;,&#34;</span><span class="op" id="8282748">+</span><span class="ident" id="8282749">runtime</span><span class="op" id="8282756">.</span><span class="ident" id="8282757">GOARCH</span><span class="op" id="8282763">+</span><span class="string" id="8282764">&#34;,bar&#34;</span><span class="op" id="8282770">,</span>&nbsp;<span class="keyword" id="8282772">map</span><span class="op" id="8282775">[</span><span class="builtintype" id="8282776">string</span><span class="op" id="8282782">]</span><span class="builtintype" id="8282783">bool</span><span class="op" id="8282787">{</span><span class="ident" id="8282788">runtime</span><span class="op" id="8282795">.</span><span class="ident" id="8282796">GOOS</span><span class="op" id="8282800">:</span>&nbsp;<span class="builtintype" id="8282802">true</span><span class="op" id="8282806">,</span>&nbsp;<span class="ident" id="8282808">runtime</span><span class="op" id="8282815">.</span><span class="ident" id="8282816">GOARCH</span><span class="op" id="8282822">:</span>&nbsp;<span class="builtintype" id="8282824">true</span><span class="op" id="8282828">,</span>&nbsp;<span class="string" id="8282830">&#34;bar&#34;</span><span class="op" id="8282835">:</span>&nbsp;<span class="builtintype" id="8282837">true</span><span class="op" id="8282841">}</span><span class="op" id="8282842">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282845">nomatch</span><span class="op" id="8282852">(</span><span class="string" id="8282853">&#34;!&#34;</span><span class="op" id="8282856">,</span>&nbsp;<span class="keyword" id="8282858">map</span><span class="op" id="8282861">[</span><span class="builtintype" id="8282862">string</span><span class="op" id="8282868">]</span><span class="builtintype" id="8282869">bool</span><span class="op" id="8282873">{</span><span class="op" id="8282874">}</span><span class="op" id="8282875">)</span><br>
<span class="lineno"></span><span class="op" id="8282877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8282880">func</span>&nbsp;<span class="ident" id="8282885">TestDotSlashImport</span><span class="op" id="8282903">(</span><span class="ident" id="8282904">t</span>&nbsp;<span class="op" id="8282906">*</span><span class="ident" id="8282907">testing</span><span class="op" id="8282914">.</span><span class="ident" id="8282915">T</span><span class="op" id="8282916">)</span>&nbsp;<span class="op" id="8282918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282921">p</span><span class="op" id="8282922">,</span>&nbsp;<span class="ident" id="8282924">err</span>&nbsp;<span class="op" id="8282928">:=</span>&nbsp;<span class="ident" id="8282931">ImportDir</span><span class="op" id="8282940">(</span><span class="string" id="8282941">&#34;testdata/other&#34;</span><span class="op" id="8282957">,</span>&nbsp;<span class="num" id="8282959">0</span><span class="op" id="8282960">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282963">if</span>&nbsp;<span class="ident" id="8282966">err</span>&nbsp;<span class="op" id="8282970">!=</span>&nbsp;<span class="ident" id="8282973">nil</span>&nbsp;<span class="op" id="8282977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282981">t</span><span class="op" id="8282982">.</span><span class="ident" id="8282983">Fatal</span><span class="op" id="8282988">(</span><span class="ident" id="8282989">err</span><span class="op" id="8282992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282998">if</span>&nbsp;<span class="builtinfunc" id="8283001">len</span><span class="op" id="8283004">(</span><span class="ident" id="8283005">p</span><span class="op" id="8283006">.</span><span class="ident" id="8283007">Imports</span><span class="op" id="8283014">)</span>&nbsp;<span class="op" id="8283016">!=</span>&nbsp;<span class="num" id="8283019">1</span>&nbsp;<span class="op" id="8283021">||</span>&nbsp;<span class="ident" id="8283024">p</span><span class="op" id="8283025">.</span><span class="ident" id="8283026">Imports</span><span class="op" id="8283033">[</span><span class="num" id="8283034">0</span><span class="op" id="8283035">]</span>&nbsp;<span class="op" id="8283037">!=</span>&nbsp;<span class="string" id="8283040">&#34;./file&#34;</span>&nbsp;<span class="op" id="8283049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283053">t</span><span class="op" id="8283054">.</span><span class="ident" id="8283055">Fatalf</span><span class="op" id="8283061">(</span><span class="string" id="8283062">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="8283105">,</span>&nbsp;<span class="ident" id="8283107">p</span><span class="op" id="8283108">.</span><span class="ident" id="8283109">Imports</span><span class="op" id="8283116">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283123">p1</span><span class="op" id="8283125">,</span>&nbsp;<span class="ident" id="8283127">err</span>&nbsp;<span class="op" id="8283131">:=</span>&nbsp;<span class="ident" id="8283134">Import</span><span class="op" id="8283140">(</span><span class="string" id="8283141">&#34;./file&#34;</span><span class="op" id="8283149">,</span>&nbsp;<span class="string" id="8283151">&#34;testdata/other&#34;</span><span class="op" id="8283167">,</span>&nbsp;<span class="num" id="8283169">0</span><span class="op" id="8283170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283173">if</span>&nbsp;<span class="ident" id="8283176">err</span>&nbsp;<span class="op" id="8283180">!=</span>&nbsp;<span class="ident" id="8283183">nil</span>&nbsp;<span class="op" id="8283187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283191">t</span><span class="op" id="8283192">.</span><span class="ident" id="8283193">Fatal</span><span class="op" id="8283198">(</span><span class="ident" id="8283199">err</span><span class="op" id="8283202">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283208">if</span>&nbsp;<span class="ident" id="8283211">p1</span><span class="op" id="8283213">.</span><span class="ident" id="8283214">Name</span>&nbsp;<span class="op" id="8283219">!=</span>&nbsp;<span class="string" id="8283222">&#34;file&#34;</span>&nbsp;<span class="op" id="8283229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283233">t</span><span class="op" id="8283234">.</span><span class="ident" id="8283235">Fatalf</span><span class="op" id="8283241">(</span><span class="string" id="8283242">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8283268">,</span>&nbsp;<span class="ident" id="8283270">p1</span><span class="op" id="8283272">.</span><span class="ident" id="8283273">Name</span><span class="op" id="8283277">,</span>&nbsp;<span class="string" id="8283279">&#34;file&#34;</span><span class="op" id="8283285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283291">dir</span>&nbsp;<span class="op" id="8283295">:=</span>&nbsp;<span class="ident" id="8283298">filepath</span><span class="op" id="8283306">.</span><span class="ident" id="8283307">Clean</span><span class="op" id="8283312">(</span><span class="string" id="8283313">&#34;testdata/other/file&#34;</span><span class="op" id="8283334">)</span>&nbsp;<span class="comment" id="8283336">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283366">if</span>&nbsp;<span class="ident" id="8283369">p1</span><span class="op" id="8283371">.</span><span class="ident" id="8283372">Dir</span>&nbsp;<span class="op" id="8283376">!=</span>&nbsp;<span class="ident" id="8283379">dir</span>&nbsp;<span class="op" id="8283383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283387">t</span><span class="op" id="8283388">.</span><span class="ident" id="8283389">Fatalf</span><span class="op" id="8283395">(</span><span class="string" id="8283396">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8283421">,</span>&nbsp;<span class="ident" id="8283423">p1</span><span class="op" id="8283425">.</span><span class="ident" id="8283426">Name</span><span class="op" id="8283430">,</span>&nbsp;<span class="ident" id="8283432">dir</span><span class="op" id="8283435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283438">}</span><br>
<span class="lineno"></span><span class="op" id="8283440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8283443">func</span>&nbsp;<span class="ident" id="8283448">TestEmptyImport</span><span class="op" id="8283463">(</span><span class="ident" id="8283464">t</span>&nbsp;<span class="op" id="8283466">*</span><span class="ident" id="8283467">testing</span><span class="op" id="8283474">.</span><span class="ident" id="8283475">T</span><span class="op" id="8283476">)</span>&nbsp;<span class="op" id="8283478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283481">p</span><span class="op" id="8283482">,</span>&nbsp;<span class="ident" id="8283484">err</span>&nbsp;<span class="op" id="8283488">:=</span>&nbsp;<span class="ident" id="8283491">Import</span><span class="op" id="8283497">(</span><span class="string" id="8283498">&#34;&#34;</span><span class="op" id="8283500">,</span>&nbsp;<span class="ident" id="8283502">Default</span><span class="op" id="8283509">.</span><span class="ident" id="8283510">GOROOT</span><span class="op" id="8283516">,</span>&nbsp;<span class="ident" id="8283518">FindOnly</span><span class="op" id="8283526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283529">if</span>&nbsp;<span class="ident" id="8283532">err</span>&nbsp;<span class="op" id="8283536">==</span>&nbsp;<span class="ident" id="8283539">nil</span>&nbsp;<span class="op" id="8283543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283547">t</span><span class="op" id="8283548">.</span><span class="ident" id="8283549">Fatal</span><span class="op" id="8283554">(</span><span class="string" id="8283555">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="8283587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283590">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283593">if</span>&nbsp;<span class="ident" id="8283596">p</span>&nbsp;<span class="op" id="8283598">==</span>&nbsp;<span class="ident" id="8283601">nil</span>&nbsp;<span class="op" id="8283605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283609">t</span><span class="op" id="8283610">.</span><span class="ident" id="8283611">Fatal</span><span class="op" id="8283616">(</span><span class="string" id="8283617">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="8283651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283657">if</span>&nbsp;<span class="ident" id="8283660">p</span><span class="op" id="8283661">.</span><span class="ident" id="8283662">ImportPath</span>&nbsp;<span class="op" id="8283673">!=</span>&nbsp;<span class="string" id="8283676">&#34;&#34;</span>&nbsp;<span class="op" id="8283679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283683">t</span><span class="op" id="8283684">.</span><span class="ident" id="8283685">Fatalf</span><span class="op" id="8283691">(</span><span class="string" id="8283692">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="8283717">,</span>&nbsp;<span class="ident" id="8283719">p</span><span class="op" id="8283720">.</span><span class="ident" id="8283721">ImportPath</span><span class="op" id="8283731">,</span>&nbsp;<span class="string" id="8283733">&#34;&#34;</span><span class="op" id="8283735">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283738">}</span><br>
<span class="lineno"></span><span class="op" id="8283740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8283743">func</span>&nbsp;<span class="ident" id="8283748">TestEmptyFolderImport</span><span class="op" id="8283769">(</span><span class="ident" id="8283770">t</span>&nbsp;<span class="op" id="8283772">*</span><span class="ident" id="8283773">testing</span><span class="op" id="8283780">.</span><span class="ident" id="8283781">T</span><span class="op" id="8283782">)</span>&nbsp;<span class="op" id="8283784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283787">_</span><span class="op" id="8283788">,</span>&nbsp;<span class="ident" id="8283790">err</span>&nbsp;<span class="op" id="8283794">:=</span>&nbsp;<span class="ident" id="8283797">Import</span><span class="op" id="8283803">(</span><span class="string" id="8283804">&#34;.&#34;</span><span class="op" id="8283807">,</span>&nbsp;<span class="string" id="8283809">&#34;testdata/empty&#34;</span><span class="op" id="8283825">,</span>&nbsp;<span class="num" id="8283827">0</span><span class="op" id="8283828">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283831">if</span>&nbsp;<span class="ident" id="8283834">_</span><span class="op" id="8283835">,</span>&nbsp;<span class="ident" id="8283837">ok</span>&nbsp;<span class="op" id="8283840">:=</span>&nbsp;<span class="ident" id="8283843">err</span><span class="op" id="8283846">.</span><span class="op" id="8283847">(</span><span class="op" id="8283848">*</span><span class="ident" id="8283849">NoGoError</span><span class="op" id="8283858">)</span><span class="op" id="8283859">;</span>&nbsp;<span class="op" id="8283861">!</span><span class="ident" id="8283862">ok</span>&nbsp;<span class="op" id="8283865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283869">t</span><span class="op" id="8283870">.</span><span class="ident" id="8283871">Fatal</span><span class="op" id="8283876">(</span><span class="string" id="8283877">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="8283929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283932">}</span><br>
<span class="lineno"></span><span class="op" id="8283934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8283937">func</span>&nbsp;<span class="ident" id="8283942">TestMultiplePackageImport</span><span class="op" id="8283967">(</span><span class="ident" id="8283968">t</span>&nbsp;<span class="op" id="8283970">*</span><span class="ident" id="8283971">testing</span><span class="op" id="8283978">.</span><span class="ident" id="8283979">T</span><span class="op" id="8283980">)</span>&nbsp;<span class="op" id="8283982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283985">_</span><span class="op" id="8283986">,</span>&nbsp;<span class="ident" id="8283988">err</span>&nbsp;<span class="op" id="8283992">:=</span>&nbsp;<span class="ident" id="8283995">Import</span><span class="op" id="8284001">(</span><span class="string" id="8284002">&#34;.&#34;</span><span class="op" id="8284005">,</span>&nbsp;<span class="string" id="8284007">&#34;testdata/multi&#34;</span><span class="op" id="8284023">,</span>&nbsp;<span class="num" id="8284025">0</span><span class="op" id="8284026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284029">if</span>&nbsp;<span class="ident" id="8284032">_</span><span class="op" id="8284033">,</span>&nbsp;<span class="ident" id="8284035">ok</span>&nbsp;<span class="op" id="8284038">:=</span>&nbsp;<span class="ident" id="8284041">err</span><span class="op" id="8284044">.</span><span class="op" id="8284045">(</span><span class="op" id="8284046">*</span><span class="ident" id="8284047">MultiplePackageError</span><span class="op" id="8284067">)</span><span class="op" id="8284068">;</span>&nbsp;<span class="op" id="8284070">!</span><span class="ident" id="8284071">ok</span>&nbsp;<span class="op" id="8284074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284078">t</span><span class="op" id="8284079">.</span><span class="ident" id="8284080">Fatal</span><span class="op" id="8284085">(</span><span class="string" id="8284086">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="8284149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284152">}</span><br>
<span class="lineno">100</span><span class="op" id="8284154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8284157">func</span>&nbsp;<span class="ident" id="8284162">TestLocalDirectory</span><span class="op" id="8284180">(</span><span class="ident" id="8284181">t</span>&nbsp;<span class="op" id="8284183">*</span><span class="ident" id="8284184">testing</span><span class="op" id="8284191">.</span><span class="ident" id="8284192">T</span><span class="op" id="8284193">)</span>&nbsp;<span class="op" id="8284195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284198">cwd</span><span class="op" id="8284201">,</span>&nbsp;<span class="ident" id="8284203">err</span>&nbsp;<span class="op" id="8284207">:=</span>&nbsp;<span class="ident" id="8284210">os</span><span class="op" id="8284212">.</span><span class="ident" id="8284213">Getwd</span><span class="op" id="8284218">(</span><span class="op" id="8284219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284222">if</span>&nbsp;<span class="ident" id="8284225">err</span>&nbsp;<span class="op" id="8284229">!=</span>&nbsp;<span class="ident" id="8284232">nil</span>&nbsp;<span class="op" id="8284236">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284240">t</span><span class="op" id="8284241">.</span><span class="ident" id="8284242">Fatal</span><span class="op" id="8284247">(</span><span class="ident" id="8284248">err</span><span class="op" id="8284251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284258">p</span><span class="op" id="8284259">,</span>&nbsp;<span class="ident" id="8284261">err</span>&nbsp;<span class="op" id="8284265">:=</span>&nbsp;<span class="ident" id="8284268">ImportDir</span><span class="op" id="8284277">(</span><span class="ident" id="8284278">cwd</span><span class="op" id="8284281">,</span>&nbsp;<span class="num" id="8284283">0</span><span class="op" id="8284284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284287">if</span>&nbsp;<span class="ident" id="8284290">err</span>&nbsp;<span class="op" id="8284294">!=</span>&nbsp;<span class="ident" id="8284297">nil</span>&nbsp;<span class="op" id="8284301">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284305">t</span><span class="op" id="8284306">.</span><span class="ident" id="8284307">Fatal</span><span class="op" id="8284312">(</span><span class="ident" id="8284313">err</span><span class="op" id="8284316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284322">if</span>&nbsp;<span class="ident" id="8284325">p</span><span class="op" id="8284326">.</span><span class="ident" id="8284327">ImportPath</span>&nbsp;<span class="op" id="8284338">!=</span>&nbsp;<span class="string" id="8284341">&#34;go/build&#34;</span>&nbsp;<span class="op" id="8284352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284356">t</span><span class="op" id="8284357">.</span><span class="ident" id="8284358">Fatalf</span><span class="op" id="8284364">(</span><span class="string" id="8284365">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8284389">,</span>&nbsp;<span class="ident" id="8284391">p</span><span class="op" id="8284392">.</span><span class="ident" id="8284393">ImportPath</span><span class="op" id="8284403">,</span>&nbsp;<span class="string" id="8284405">&#34;go/build&#34;</span><span class="op" id="8284415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284418">}</span><br>
<span class="lineno">115</span><span class="op" id="8284420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8284423">func</span>&nbsp;<span class="ident" id="8284428">TestShouldBuild</span><span class="op" id="8284443">(</span><span class="ident" id="8284444">t</span>&nbsp;<span class="op" id="8284446">*</span><span class="ident" id="8284447">testing</span><span class="op" id="8284454">.</span><span class="ident" id="8284455">T</span><span class="op" id="8284456">)</span>&nbsp;<span class="op" id="8284458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284461">const</span>&nbsp;<span class="ident" id="8284467">file1</span>&nbsp;<span class="op" id="8284473">=</span>&nbsp;<span class="string" id="8284475">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="8284496">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284500">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284518">want1</span>&nbsp;<span class="op" id="8284524">:=</span>&nbsp;<span class="keyword" id="8284527">map</span><span class="op" id="8284530">[</span><span class="builtintype" id="8284531">string</span><span class="op" id="8284537">]</span><span class="builtintype" id="8284538">bool</span><span class="op" id="8284542">{</span><span class="string" id="8284543">&#34;tag1&#34;</span><span class="op" id="8284549">:</span>&nbsp;<span class="builtintype" id="8284551">true</span><span class="op" id="8284555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284559">const</span>&nbsp;<span class="ident" id="8284565">file2</span>&nbsp;<span class="op" id="8284571">=</span>&nbsp;<span class="string" id="8284573">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="8284593">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284597">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="8284649">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284653">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="8284672">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284676">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284693">want2</span>&nbsp;<span class="op" id="8284699">:=</span>&nbsp;<span class="keyword" id="8284702">map</span><span class="op" id="8284705">[</span><span class="builtintype" id="8284706">string</span><span class="op" id="8284712">]</span><span class="builtintype" id="8284713">bool</span><span class="op" id="8284717">{</span><span class="string" id="8284718">&#34;cgo&#34;</span><span class="op" id="8284723">:</span>&nbsp;<span class="builtintype" id="8284725">true</span><span class="op" id="8284729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284733">const</span>&nbsp;<span class="ident" id="8284739">file3</span>&nbsp;<span class="op" id="8284745">=</span>&nbsp;<span class="string" id="8284747">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="8284782">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284786">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="8284806">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284810">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="8284868">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284872">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="8284890">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284894">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284932">want3</span>&nbsp;<span class="op" id="8284938">:=</span>&nbsp;<span class="keyword" id="8284941">map</span><span class="op" id="8284944">[</span><span class="builtintype" id="8284945">string</span><span class="op" id="8284951">]</span><span class="builtintype" id="8284952">bool</span><span class="op" id="8284956">{</span><span class="op" id="8284957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284961">ctx</span>&nbsp;<span class="op" id="8284965">:=</span>&nbsp;<span class="op" id="8284968">&amp;</span><span class="ident" id="8284969">Context</span><span class="op" id="8284976">{</span><span class="ident" id="8284977">BuildTags</span><span class="op" id="8284986">:</span>&nbsp;<span class="op" id="8284988">[</span><span class="op" id="8284989">]</span><span class="builtintype" id="8284990">string</span><span class="op" id="8284996">{</span><span class="string" id="8284997">&#34;tag1&#34;</span><span class="op" id="8285003">}</span><span class="op" id="8285004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285007">m</span>&nbsp;<span class="op" id="8285009">:=</span>&nbsp;<span class="keyword" id="8285012">map</span><span class="op" id="8285015">[</span><span class="builtintype" id="8285016">string</span><span class="op" id="8285022">]</span><span class="builtintype" id="8285023">bool</span><span class="op" id="8285027">{</span><span class="op" id="8285028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285031">if</span>&nbsp;<span class="op" id="8285034">!</span><span class="ident" id="8285035">ctx</span><span class="op" id="8285038">.</span><span class="ident" id="8285039">shouldBuild</span><span class="op" id="8285050">(</span><span class="op" id="8285051">[</span><span class="op" id="8285052">]</span><span class="builtintype" id="8285053">byte</span><span class="op" id="8285057">(</span><span class="ident" id="8285058">file1</span><span class="op" id="8285063">)</span><span class="op" id="8285064">,</span>&nbsp;<span class="ident" id="8285066">m</span><span class="op" id="8285067">)</span>&nbsp;<span class="op" id="8285069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285073">t</span><span class="op" id="8285074">.</span><span class="ident" id="8285075">Errorf</span><span class="op" id="8285081">(</span><span class="string" id="8285082">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="8285121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285124">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285127">if</span>&nbsp;<span class="op" id="8285130">!</span><span class="ident" id="8285131">reflect</span><span class="op" id="8285138">.</span><span class="ident" id="8285139">DeepEqual</span><span class="op" id="8285148">(</span><span class="ident" id="8285149">m</span><span class="op" id="8285150">,</span>&nbsp;<span class="ident" id="8285152">want1</span><span class="op" id="8285157">)</span>&nbsp;<span class="op" id="8285159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285163">t</span><span class="op" id="8285164">.</span><span class="ident" id="8285165">Errorf</span><span class="op" id="8285171">(</span><span class="string" id="8285172">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8285210">,</span>&nbsp;<span class="ident" id="8285212">m</span><span class="op" id="8285213">,</span>&nbsp;<span class="ident" id="8285215">want1</span><span class="op" id="8285220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285227">m</span>&nbsp;<span class="op" id="8285229">=</span>&nbsp;<span class="keyword" id="8285231">map</span><span class="op" id="8285234">[</span><span class="builtintype" id="8285235">string</span><span class="op" id="8285241">]</span><span class="builtintype" id="8285242">bool</span><span class="op" id="8285246">{</span><span class="op" id="8285247">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285250">if</span>&nbsp;<span class="ident" id="8285253">ctx</span><span class="op" id="8285256">.</span><span class="ident" id="8285257">shouldBuild</span><span class="op" id="8285268">(</span><span class="op" id="8285269">[</span><span class="op" id="8285270">]</span><span class="builtintype" id="8285271">byte</span><span class="op" id="8285275">(</span><span class="ident" id="8285276">file2</span><span class="op" id="8285281">)</span><span class="op" id="8285282">,</span>&nbsp;<span class="ident" id="8285284">m</span><span class="op" id="8285285">)</span>&nbsp;<span class="op" id="8285287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285291">t</span><span class="op" id="8285292">.</span><span class="ident" id="8285293">Errorf</span><span class="op" id="8285299">(</span><span class="string" id="8285300">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="8285339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285345">if</span>&nbsp;<span class="op" id="8285348">!</span><span class="ident" id="8285349">reflect</span><span class="op" id="8285356">.</span><span class="ident" id="8285357">DeepEqual</span><span class="op" id="8285366">(</span><span class="ident" id="8285367">m</span><span class="op" id="8285368">,</span>&nbsp;<span class="ident" id="8285370">want2</span><span class="op" id="8285375">)</span>&nbsp;<span class="op" id="8285377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285381">t</span><span class="op" id="8285382">.</span><span class="ident" id="8285383">Errorf</span><span class="op" id="8285389">(</span><span class="string" id="8285390">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8285428">,</span>&nbsp;<span class="ident" id="8285430">m</span><span class="op" id="8285431">,</span>&nbsp;<span class="ident" id="8285433">want2</span><span class="op" id="8285438">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285445">m</span>&nbsp;<span class="op" id="8285447">=</span>&nbsp;<span class="keyword" id="8285449">map</span><span class="op" id="8285452">[</span><span class="builtintype" id="8285453">string</span><span class="op" id="8285459">]</span><span class="builtintype" id="8285460">bool</span><span class="op" id="8285464">{</span><span class="op" id="8285465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285468">ctx</span>&nbsp;<span class="op" id="8285472">=</span>&nbsp;<span class="op" id="8285474">&amp;</span><span class="ident" id="8285475">Context</span><span class="op" id="8285482">{</span><span class="ident" id="8285483">BuildTags</span><span class="op" id="8285492">:</span>&nbsp;<span class="ident" id="8285494">nil</span><span class="op" id="8285497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285500">if</span>&nbsp;<span class="op" id="8285503">!</span><span class="ident" id="8285504">ctx</span><span class="op" id="8285507">.</span><span class="ident" id="8285508">shouldBuild</span><span class="op" id="8285519">(</span><span class="op" id="8285520">[</span><span class="op" id="8285521">]</span><span class="builtintype" id="8285522">byte</span><span class="op" id="8285526">(</span><span class="ident" id="8285527">file3</span><span class="op" id="8285532">)</span><span class="op" id="8285533">,</span>&nbsp;<span class="ident" id="8285535">m</span><span class="op" id="8285536">)</span>&nbsp;<span class="op" id="8285538">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285542">t</span><span class="op" id="8285543">.</span><span class="ident" id="8285544">Errorf</span><span class="op" id="8285550">(</span><span class="string" id="8285551">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="8285590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285596">if</span>&nbsp;<span class="op" id="8285599">!</span><span class="ident" id="8285600">reflect</span><span class="op" id="8285607">.</span><span class="ident" id="8285608">DeepEqual</span><span class="op" id="8285617">(</span><span class="ident" id="8285618">m</span><span class="op" id="8285619">,</span>&nbsp;<span class="ident" id="8285621">want3</span><span class="op" id="8285626">)</span>&nbsp;<span class="op" id="8285628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285632">t</span><span class="op" id="8285633">.</span><span class="ident" id="8285634">Errorf</span><span class="op" id="8285640">(</span><span class="string" id="8285641">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8285679">,</span>&nbsp;<span class="ident" id="8285681">m</span><span class="op" id="8285682">,</span>&nbsp;<span class="ident" id="8285684">want3</span><span class="op" id="8285689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285692">}</span><br>
<span class="lineno">160</span><span class="op" id="8285694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8285697">type</span>&nbsp;<span class="ident" id="8285702">readNopCloser</span>&nbsp;<span class="keyword" id="8285716">struct</span>&nbsp;<span class="op" id="8285723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285726">io</span><span class="op" id="8285728">.</span><span class="ident" id="8285729">Reader</span><br>
<span class="lineno"></span><span class="op" id="8285736">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="8285739">func</span>&nbsp;<span class="op" id="8285744">(</span><span class="ident" id="8285745">r</span>&nbsp;<span class="ident" id="8285747">readNopCloser</span><span class="op" id="8285760">)</span>&nbsp;<span class="ident" id="8285762">Close</span><span class="op" id="8285767">(</span><span class="op" id="8285768">)</span>&nbsp;<span class="builtintype" id="8285770">error</span>&nbsp;<span class="op" id="8285776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285779">return</span>&nbsp;<span class="ident" id="8285786">nil</span><br>
<span class="lineno"></span><span class="op" id="8285790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8285793">var</span>&nbsp;<span class="op" id="8285797">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285800">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8285812">=</span>&nbsp;<span class="ident" id="8285814">Context</span><span class="op" id="8285821">{</span><span class="ident" id="8285822">GOARCH</span><span class="op" id="8285828">:</span>&nbsp;<span class="string" id="8285830">&#34;arm&#34;</span><span class="op" id="8285835">,</span>&nbsp;<span class="ident" id="8285837">GOOS</span><span class="op" id="8285841">:</span>&nbsp;<span class="string" id="8285843">&#34;plan9&#34;</span><span class="op" id="8285850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285853">ctxtAndroid</span>&nbsp;<span class="op" id="8285865">=</span>&nbsp;<span class="ident" id="8285867">Context</span><span class="op" id="8285874">{</span><span class="ident" id="8285875">GOARCH</span><span class="op" id="8285881">:</span>&nbsp;<span class="string" id="8285883">&#34;arm&#34;</span><span class="op" id="8285888">,</span>&nbsp;<span class="ident" id="8285890">GOOS</span><span class="op" id="8285894">:</span>&nbsp;<span class="string" id="8285896">&#34;android&#34;</span><span class="op" id="8285905">}</span><br>
<span class="lineno"></span><span class="op" id="8285907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8285910">var</span>&nbsp;<span class="ident" id="8285914">matchFileTests</span>&nbsp;<span class="op" id="8285929">=</span>&nbsp;<span class="op" id="8285931">[</span><span class="op" id="8285932">]</span><span class="keyword" id="8285933">struct</span>&nbsp;<span class="op" id="8285940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285943">ctxt</span>&nbsp;&nbsp;<span class="ident" id="8285949">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285958">name</span>&nbsp;&nbsp;<span class="builtintype" id="8285964">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285972">data</span>&nbsp;&nbsp;<span class="builtintype" id="8285978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285986">match</span>&nbsp;<span class="builtintype" id="8285992">bool</span><br>
<span class="lineno">180</span><span class="op" id="8285997">}</span><span class="op" id="8285998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286001">{</span><span class="ident" id="8286002">ctxtP9</span><span class="op" id="8286008">,</span>&nbsp;<span class="string" id="8286010">&#34;foo_arm.go&#34;</span><span class="op" id="8286022">,</span>&nbsp;<span class="string" id="8286024">&#34;&#34;</span><span class="op" id="8286026">,</span>&nbsp;<span class="builtintype" id="8286028">true</span><span class="op" id="8286032">}</span><span class="op" id="8286033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286036">{</span><span class="ident" id="8286037">ctxtP9</span><span class="op" id="8286043">,</span>&nbsp;<span class="string" id="8286045">&#34;foo1_arm.go&#34;</span><span class="op" id="8286058">,</span>&nbsp;<span class="string" id="8286060">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="8286095">,</span>&nbsp;<span class="builtintype" id="8286097">false</span><span class="op" id="8286102">}</span><span class="op" id="8286103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286106">{</span><span class="ident" id="8286107">ctxtP9</span><span class="op" id="8286113">,</span>&nbsp;<span class="string" id="8286115">&#34;foo_darwin.go&#34;</span><span class="op" id="8286130">,</span>&nbsp;<span class="string" id="8286132">&#34;&#34;</span><span class="op" id="8286134">,</span>&nbsp;<span class="builtintype" id="8286136">false</span><span class="op" id="8286141">}</span><span class="op" id="8286142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286145">{</span><span class="ident" id="8286146">ctxtP9</span><span class="op" id="8286152">,</span>&nbsp;<span class="string" id="8286154">&#34;foo.go&#34;</span><span class="op" id="8286162">,</span>&nbsp;<span class="string" id="8286164">&#34;&#34;</span><span class="op" id="8286166">,</span>&nbsp;<span class="builtintype" id="8286168">true</span><span class="op" id="8286172">}</span><span class="op" id="8286173">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286176">{</span><span class="ident" id="8286177">ctxtP9</span><span class="op" id="8286183">,</span>&nbsp;<span class="string" id="8286185">&#34;foo1.go&#34;</span><span class="op" id="8286194">,</span>&nbsp;<span class="string" id="8286196">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="8286231">,</span>&nbsp;<span class="builtintype" id="8286233">false</span><span class="op" id="8286238">}</span><span class="op" id="8286239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286242">{</span><span class="ident" id="8286243">ctxtP9</span><span class="op" id="8286249">,</span>&nbsp;<span class="string" id="8286251">&#34;foo.badsuffix&#34;</span><span class="op" id="8286266">,</span>&nbsp;<span class="string" id="8286268">&#34;&#34;</span><span class="op" id="8286270">,</span>&nbsp;<span class="builtintype" id="8286272">false</span><span class="op" id="8286277">}</span><span class="op" id="8286278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286281">{</span><span class="ident" id="8286282">ctxtAndroid</span><span class="op" id="8286293">,</span>&nbsp;<span class="string" id="8286295">&#34;foo_linux.go&#34;</span><span class="op" id="8286309">,</span>&nbsp;<span class="string" id="8286311">&#34;&#34;</span><span class="op" id="8286313">,</span>&nbsp;<span class="builtintype" id="8286315">true</span><span class="op" id="8286319">}</span><span class="op" id="8286320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286323">{</span><span class="ident" id="8286324">ctxtAndroid</span><span class="op" id="8286335">,</span>&nbsp;<span class="string" id="8286337">&#34;foo_android.go&#34;</span><span class="op" id="8286353">,</span>&nbsp;<span class="string" id="8286355">&#34;&#34;</span><span class="op" id="8286357">,</span>&nbsp;<span class="builtintype" id="8286359">true</span><span class="op" id="8286363">}</span><span class="op" id="8286364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286367">{</span><span class="ident" id="8286368">ctxtAndroid</span><span class="op" id="8286379">,</span>&nbsp;<span class="string" id="8286381">&#34;foo_plan9.go&#34;</span><span class="op" id="8286395">,</span>&nbsp;<span class="string" id="8286397">&#34;&#34;</span><span class="op" id="8286399">,</span>&nbsp;<span class="builtintype" id="8286401">false</span><span class="op" id="8286406">}</span><span class="op" id="8286407">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286410">{</span><span class="ident" id="8286411">ctxtAndroid</span><span class="op" id="8286422">,</span>&nbsp;<span class="string" id="8286424">&#34;android.go&#34;</span><span class="op" id="8286436">,</span>&nbsp;<span class="string" id="8286438">&#34;&#34;</span><span class="op" id="8286440">,</span>&nbsp;<span class="builtintype" id="8286442">true</span><span class="op" id="8286446">}</span><span class="op" id="8286447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286450">{</span><span class="ident" id="8286451">ctxtAndroid</span><span class="op" id="8286462">,</span>&nbsp;<span class="string" id="8286464">&#34;plan9.go&#34;</span><span class="op" id="8286474">,</span>&nbsp;<span class="string" id="8286476">&#34;&#34;</span><span class="op" id="8286478">,</span>&nbsp;<span class="builtintype" id="8286480">true</span><span class="op" id="8286484">}</span><span class="op" id="8286485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286488">{</span><span class="ident" id="8286489">ctxtAndroid</span><span class="op" id="8286500">,</span>&nbsp;<span class="string" id="8286502">&#34;plan9_test.go&#34;</span><span class="op" id="8286517">,</span>&nbsp;<span class="string" id="8286519">&#34;&#34;</span><span class="op" id="8286521">,</span>&nbsp;<span class="builtintype" id="8286523">true</span><span class="op" id="8286527">}</span><span class="op" id="8286528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286531">{</span><span class="ident" id="8286532">ctxtAndroid</span><span class="op" id="8286543">,</span>&nbsp;<span class="string" id="8286545">&#34;arm.s&#34;</span><span class="op" id="8286552">,</span>&nbsp;<span class="string" id="8286554">&#34;&#34;</span><span class="op" id="8286556">,</span>&nbsp;<span class="builtintype" id="8286558">true</span><span class="op" id="8286562">}</span><span class="op" id="8286563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286566">{</span><span class="ident" id="8286567">ctxtAndroid</span><span class="op" id="8286578">,</span>&nbsp;<span class="string" id="8286580">&#34;amd64.s&#34;</span><span class="op" id="8286589">,</span>&nbsp;<span class="string" id="8286591">&#34;&#34;</span><span class="op" id="8286593">,</span>&nbsp;<span class="builtintype" id="8286595">true</span><span class="op" id="8286599">}</span><span class="op" id="8286600">,</span><br>
<span class="lineno">195</span><span class="op" id="8286602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8286605">func</span>&nbsp;<span class="ident" id="8286610">TestMatchFile</span><span class="op" id="8286623">(</span><span class="ident" id="8286624">t</span>&nbsp;<span class="op" id="8286626">*</span><span class="ident" id="8286627">testing</span><span class="op" id="8286634">.</span><span class="ident" id="8286635">T</span><span class="op" id="8286636">)</span>&nbsp;<span class="op" id="8286638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286641">for</span>&nbsp;<span class="ident" id="8286645">_</span><span class="op" id="8286646">,</span>&nbsp;<span class="ident" id="8286648">tt</span>&nbsp;<span class="op" id="8286651">:=</span>&nbsp;<span class="keyword" id="8286654">range</span>&nbsp;<span class="ident" id="8286660">matchFileTests</span>&nbsp;<span class="op" id="8286675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286679">ctxt</span>&nbsp;<span class="op" id="8286684">:=</span>&nbsp;<span class="ident" id="8286687">tt</span><span class="op" id="8286689">.</span><span class="ident" id="8286690">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286697">ctxt</span><span class="op" id="8286701">.</span><span class="ident" id="8286702">OpenFile</span>&nbsp;<span class="op" id="8286711">=</span>&nbsp;<span class="keyword" id="8286713">func</span><span class="op" id="8286717">(</span><span class="ident" id="8286718">path</span>&nbsp;<span class="builtintype" id="8286723">string</span><span class="op" id="8286729">)</span>&nbsp;<span class="op" id="8286731">(</span><span class="ident" id="8286732">r</span>&nbsp;<span class="ident" id="8286734">io</span><span class="op" id="8286736">.</span><span class="ident" id="8286737">ReadCloser</span><span class="op" id="8286747">,</span>&nbsp;<span class="ident" id="8286749">err</span>&nbsp;<span class="builtintype" id="8286753">error</span><span class="op" id="8286758">)</span>&nbsp;<span class="op" id="8286760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286765">if</span>&nbsp;<span class="ident" id="8286768">path</span>&nbsp;<span class="op" id="8286773">!=</span>&nbsp;<span class="string" id="8286776">&#34;x+&#34;</span><span class="op" id="8286780">+</span><span class="ident" id="8286781">tt</span><span class="op" id="8286783">.</span><span class="ident" id="8286784">name</span>&nbsp;<span class="op" id="8286789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286795">t</span><span class="op" id="8286796">.</span><span class="ident" id="8286797">Fatalf</span><span class="op" id="8286803">(</span><span class="string" id="8286804">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8286840">,</span>&nbsp;<span class="ident" id="8286842">path</span><span class="op" id="8286846">,</span>&nbsp;<span class="string" id="8286848">&#34;x+&#34;</span><span class="op" id="8286852">+</span><span class="ident" id="8286853">tt</span><span class="op" id="8286855">.</span><span class="ident" id="8286856">name</span><span class="op" id="8286860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286870">return</span>&nbsp;<span class="op" id="8286877">&amp;</span><span class="ident" id="8286878">readNopCloser</span><span class="op" id="8286891">{</span><span class="ident" id="8286892">strings</span><span class="op" id="8286899">.</span><span class="ident" id="8286900">NewReader</span><span class="op" id="8286909">(</span><span class="ident" id="8286910">tt</span><span class="op" id="8286912">.</span><span class="ident" id="8286913">data</span><span class="op" id="8286917">)</span><span class="op" id="8286918">}</span><span class="op" id="8286919">,</span>&nbsp;<span class="ident" id="8286921">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286931">ctxt</span><span class="op" id="8286935">.</span><span class="ident" id="8286936">JoinPath</span>&nbsp;<span class="op" id="8286945">=</span>&nbsp;<span class="keyword" id="8286947">func</span><span class="op" id="8286951">(</span><span class="ident" id="8286952">elem</span>&nbsp;<span class="op" id="8286957">...</span><span class="builtintype" id="8286960">string</span><span class="op" id="8286966">)</span>&nbsp;<span class="builtintype" id="8286968">string</span>&nbsp;<span class="op" id="8286975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286980">return</span>&nbsp;<span class="ident" id="8286987">strings</span><span class="op" id="8286994">.</span><span class="ident" id="8286995">Join</span><span class="op" id="8286999">(</span><span class="ident" id="8287000">elem</span><span class="op" id="8287004">,</span>&nbsp;<span class="string" id="8287006">&#34;+&#34;</span><span class="op" id="8287009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287017">match</span><span class="op" id="8287022">,</span>&nbsp;<span class="ident" id="8287024">err</span>&nbsp;<span class="op" id="8287028">:=</span>&nbsp;<span class="ident" id="8287031">ctxt</span><span class="op" id="8287035">.</span><span class="ident" id="8287036">MatchFile</span><span class="op" id="8287045">(</span><span class="string" id="8287046">&#34;x&#34;</span><span class="op" id="8287049">,</span>&nbsp;<span class="ident" id="8287051">tt</span><span class="op" id="8287053">.</span><span class="ident" id="8287054">name</span><span class="op" id="8287058">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287062">if</span>&nbsp;<span class="ident" id="8287065">match</span>&nbsp;<span class="op" id="8287071">!=</span>&nbsp;<span class="ident" id="8287074">tt</span><span class="op" id="8287076">.</span><span class="ident" id="8287077">match</span>&nbsp;<span class="op" id="8287083">||</span>&nbsp;<span class="ident" id="8287086">err</span>&nbsp;<span class="op" id="8287090">!=</span>&nbsp;<span class="ident" id="8287093">nil</span>&nbsp;<span class="op" id="8287097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287102">t</span><span class="op" id="8287103">.</span><span class="ident" id="8287104">Fatalf</span><span class="op" id="8287110">(</span><span class="string" id="8287111">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="8287149">,</span>&nbsp;<span class="ident" id="8287151">tt</span><span class="op" id="8287153">.</span><span class="ident" id="8287154">name</span><span class="op" id="8287158">,</span>&nbsp;<span class="ident" id="8287160">match</span><span class="op" id="8287165">,</span>&nbsp;<span class="ident" id="8287167">err</span><span class="op" id="8287170">,</span>&nbsp;<span class="ident" id="8287172">tt</span><span class="op" id="8287174">.</span><span class="ident" id="8287175">match</span><span class="op" id="8287180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287187">}</span><br>
<span class="lineno"></span><span class="op" id="8287189">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="8287192">func</span>&nbsp;<span class="ident" id="8287197">TestImportCmd</span><span class="op" id="8287210">(</span><span class="ident" id="8287211">t</span>&nbsp;<span class="op" id="8287213">*</span><span class="ident" id="8287214">testing</span><span class="op" id="8287221">.</span><span class="ident" id="8287222">T</span><span class="op" id="8287223">)</span>&nbsp;<span class="op" id="8287225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287228">p</span><span class="op" id="8287229">,</span>&nbsp;<span class="ident" id="8287231">err</span>&nbsp;<span class="op" id="8287235">:=</span>&nbsp;<span class="ident" id="8287238">Import</span><span class="op" id="8287244">(</span><span class="string" id="8287245">&#34;cmd/internal/objfile&#34;</span><span class="op" id="8287267">,</span>&nbsp;<span class="string" id="8287269">&#34;&#34;</span><span class="op" id="8287271">,</span>&nbsp;<span class="num" id="8287273">0</span><span class="op" id="8287274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287277">if</span>&nbsp;<span class="ident" id="8287280">err</span>&nbsp;<span class="op" id="8287284">!=</span>&nbsp;<span class="ident" id="8287287">nil</span>&nbsp;<span class="op" id="8287291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287295">t</span><span class="op" id="8287296">.</span><span class="ident" id="8287297">Fatal</span><span class="op" id="8287302">(</span><span class="ident" id="8287303">err</span><span class="op" id="8287306">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287312">if</span>&nbsp;<span class="op" id="8287315">!</span><span class="ident" id="8287316">strings</span><span class="op" id="8287323">.</span><span class="ident" id="8287324">HasSuffix</span><span class="op" id="8287333">(</span><span class="ident" id="8287334">filepath</span><span class="op" id="8287342">.</span><span class="ident" id="8287343">ToSlash</span><span class="op" id="8287350">(</span><span class="ident" id="8287351">p</span><span class="op" id="8287352">.</span><span class="ident" id="8287353">Dir</span><span class="op" id="8287356">)</span><span class="op" id="8287357">,</span>&nbsp;<span class="string" id="8287359">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="8287385">)</span>&nbsp;<span class="op" id="8287387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287391">t</span><span class="op" id="8287392">.</span><span class="ident" id="8287393">Fatalf</span><span class="op" id="8287399">(</span><span class="string" id="8287400">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8287454">,</span>&nbsp;<span class="ident" id="8287456">filepath</span><span class="op" id="8287464">.</span><span class="ident" id="8287465">ToSlash</span><span class="op" id="8287472">(</span><span class="ident" id="8287473">p</span><span class="op" id="8287474">.</span><span class="ident" id="8287475">Dir</span><span class="op" id="8287478">)</span><span class="op" id="8287479">,</span>&nbsp;<span class="string" id="8287481">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="8287511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287514">}</span><br>
<span class="lineno"></span><span class="op" id="8287516">}</span>
</div>
</body>
</html>
