<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html" class="current">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3320637">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3320692">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3320746">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3320797">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;NewPackage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3320834">package</span>&nbsp;<span class="ident" id="3320842">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3320847">import</span>&nbsp;<span class="op" id="3320854">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3320857">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3320864">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3320878">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3320890">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="3320900">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3320903">type</span>&nbsp;<span class="ident" id="3320908">pkgBuilder</span>&nbsp;<span class="keyword" id="3320919">struct</span>&nbsp;<span class="op" id="3320926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320929">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3320936">*</span><span class="ident" id="3320937">token</span><span class="op" id="3320942">.</span><span class="ident" id="3320943">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320952">errors</span>&nbsp;<span class="ident" id="3320959">scanner</span><span class="op" id="3320966">.</span><span class="ident" id="3320967">ErrorList</span><br>
<span class="lineno"></span><span class="op" id="3320977">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3320980">func</span>&nbsp;<span class="op" id="3320985">(</span><span class="ident" id="3320986">p</span>&nbsp;<span class="op" id="3320988">*</span><span class="ident" id="3320989">pkgBuilder</span><span class="op" id="3320999">)</span>&nbsp;<span class="builtintype" id="3321001">error</span><span class="op" id="3321006">(</span><span class="ident" id="3321007">pos</span>&nbsp;<span class="ident" id="3321011">token</span><span class="op" id="3321016">.</span><span class="ident" id="3321017">Pos</span><span class="op" id="3321020">,</span>&nbsp;<span class="ident" id="3321022">msg</span>&nbsp;<span class="builtintype" id="3321026">string</span><span class="op" id="3321032">)</span>&nbsp;<span class="op" id="3321034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321037">p</span><span class="op" id="3321038">.</span><span class="ident" id="3321039">errors</span><span class="op" id="3321045">.</span><span class="ident" id="3321046">Add</span><span class="op" id="3321049">(</span><span class="ident" id="3321050">p</span><span class="op" id="3321051">.</span><span class="ident" id="3321052">fset</span><span class="op" id="3321056">.</span><span class="ident" id="3321057">Position</span><span class="op" id="3321065">(</span><span class="ident" id="3321066">pos</span><span class="op" id="3321069">)</span><span class="op" id="3321070">,</span>&nbsp;<span class="ident" id="3321072">msg</span><span class="op" id="3321075">)</span><br>
<span class="lineno"></span><span class="op" id="3321077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3321080">func</span>&nbsp;<span class="op" id="3321085">(</span><span class="ident" id="3321086">p</span>&nbsp;<span class="op" id="3321088">*</span><span class="ident" id="3321089">pkgBuilder</span><span class="op" id="3321099">)</span>&nbsp;<span class="ident" id="3321101">errorf</span><span class="op" id="3321107">(</span><span class="ident" id="3321108">pos</span>&nbsp;<span class="ident" id="3321112">token</span><span class="op" id="3321117">.</span><span class="ident" id="3321118">Pos</span><span class="op" id="3321121">,</span>&nbsp;<span class="ident" id="3321123">format</span>&nbsp;<span class="builtintype" id="3321130">string</span><span class="op" id="3321136">,</span>&nbsp;<span class="ident" id="3321138">args</span>&nbsp;<span class="op" id="3321143">...</span><span class="keyword" id="3321146">interface</span><span class="op" id="3321155">{</span><span class="op" id="3321156">}</span><span class="op" id="3321157">)</span>&nbsp;<span class="op" id="3321159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321162">p</span><span class="op" id="3321163">.</span><span class="builtintype" id="3321164">error</span><span class="op" id="3321169">(</span><span class="ident" id="3321170">pos</span><span class="op" id="3321173">,</span>&nbsp;<span class="ident" id="3321175">fmt</span><span class="op" id="3321178">.</span><span class="ident" id="3321179">Sprintf</span><span class="op" id="3321186">(</span><span class="ident" id="3321187">format</span><span class="op" id="3321193">,</span>&nbsp;<span class="ident" id="3321195">args</span><span class="op" id="3321199">...</span><span class="op" id="3321202">)</span><span class="op" id="3321203">)</span><br>
<span class="lineno"></span><span class="op" id="3321205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3321208">func</span>&nbsp;<span class="op" id="3321213">(</span><span class="ident" id="3321214">p</span>&nbsp;<span class="op" id="3321216">*</span><span class="ident" id="3321217">pkgBuilder</span><span class="op" id="3321227">)</span>&nbsp;<span class="ident" id="3321229">declare</span><span class="op" id="3321236">(</span><span class="ident" id="3321237">scope</span><span class="op" id="3321242">,</span>&nbsp;<span class="ident" id="3321244">altScope</span>&nbsp;<span class="op" id="3321253">*</span><span class="ident" id="3321254">Scope</span><span class="op" id="3321259">,</span>&nbsp;<span class="ident" id="3321261">obj</span>&nbsp;<span class="op" id="3321265">*</span><span class="ident" id="3321266">Object</span><span class="op" id="3321272">)</span>&nbsp;<span class="op" id="3321274">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321277">alt</span>&nbsp;<span class="op" id="3321281">:=</span>&nbsp;<span class="ident" id="3321284">scope</span><span class="op" id="3321289">.</span><span class="ident" id="3321290">Insert</span><span class="op" id="3321296">(</span><span class="ident" id="3321297">obj</span><span class="op" id="3321300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321303">if</span>&nbsp;<span class="ident" id="3321306">alt</span>&nbsp;<span class="op" id="3321310">==</span>&nbsp;<span class="ident" id="3321313">nil</span>&nbsp;<span class="op" id="3321317">&amp;&amp;</span>&nbsp;<span class="ident" id="3321320">altScope</span>&nbsp;<span class="op" id="3321329">!=</span>&nbsp;<span class="ident" id="3321332">nil</span>&nbsp;<span class="op" id="3321336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3321340">//&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;conflicting&nbsp;declaration&nbsp;in&nbsp;altScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321399">alt</span>&nbsp;<span class="op" id="3321403">=</span>&nbsp;<span class="ident" id="3321405">altScope</span><span class="op" id="3321413">.</span><span class="ident" id="3321414">Lookup</span><span class="op" id="3321420">(</span><span class="ident" id="3321421">obj</span><span class="op" id="3321424">.</span><span class="ident" id="3321425">Name</span><span class="op" id="3321429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321432">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321435">if</span>&nbsp;<span class="ident" id="3321438">alt</span>&nbsp;<span class="op" id="3321442">!=</span>&nbsp;<span class="ident" id="3321445">nil</span>&nbsp;<span class="op" id="3321449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321453">prevDecl</span>&nbsp;<span class="op" id="3321462">:=</span>&nbsp;<span class="string" id="3321465">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321470">if</span>&nbsp;<span class="ident" id="3321473">pos</span>&nbsp;<span class="op" id="3321477">:=</span>&nbsp;<span class="ident" id="3321480">alt</span><span class="op" id="3321483">.</span><span class="ident" id="3321484">Pos</span><span class="op" id="3321487">(</span><span class="op" id="3321488">)</span><span class="op" id="3321489">;</span>&nbsp;<span class="ident" id="3321491">pos</span><span class="op" id="3321494">.</span><span class="ident" id="3321495">IsValid</span><span class="op" id="3321502">(</span><span class="op" id="3321503">)</span>&nbsp;<span class="op" id="3321505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321510">prevDecl</span>&nbsp;<span class="op" id="3321519">=</span>&nbsp;<span class="ident" id="3321521">fmt</span><span class="op" id="3321524">.</span><span class="ident" id="3321525">Sprintf</span><span class="op" id="3321532">(</span><span class="string" id="3321533">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="3321565">,</span>&nbsp;<span class="ident" id="3321567">p</span><span class="op" id="3321568">.</span><span class="ident" id="3321569">fset</span><span class="op" id="3321573">.</span><span class="ident" id="3321574">Position</span><span class="op" id="3321582">(</span><span class="ident" id="3321583">pos</span><span class="op" id="3321586">)</span><span class="op" id="3321587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321591">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321595">p</span><span class="op" id="3321596">.</span><span class="builtintype" id="3321597">error</span><span class="op" id="3321602">(</span><span class="ident" id="3321603">obj</span><span class="op" id="3321606">.</span><span class="ident" id="3321607">Pos</span><span class="op" id="3321610">(</span><span class="op" id="3321611">)</span><span class="op" id="3321612">,</span>&nbsp;<span class="ident" id="3321614">fmt</span><span class="op" id="3321617">.</span><span class="ident" id="3321618">Sprintf</span><span class="op" id="3321625">(</span><span class="string" id="3321626">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="3321657">,</span>&nbsp;<span class="ident" id="3321659">obj</span><span class="op" id="3321662">.</span><span class="ident" id="3321663">Name</span><span class="op" id="3321667">,</span>&nbsp;<span class="ident" id="3321669">prevDecl</span><span class="op" id="3321677">)</span><span class="op" id="3321678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321681">}</span><br>
<span class="lineno"></span><span class="op" id="3321683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3321686">func</span>&nbsp;<span class="ident" id="3321691">resolve</span><span class="op" id="3321698">(</span><span class="ident" id="3321699">scope</span>&nbsp;<span class="op" id="3321705">*</span><span class="ident" id="3321706">Scope</span><span class="op" id="3321711">,</span>&nbsp;<span class="ident" id="3321713">ident</span>&nbsp;<span class="op" id="3321719">*</span><span class="ident" id="3321720">Ident</span><span class="op" id="3321725">)</span>&nbsp;<span class="builtintype" id="3321727">bool</span>&nbsp;<span class="op" id="3321732">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321735">for</span>&nbsp;<span class="op" id="3321739">;</span>&nbsp;<span class="ident" id="3321741">scope</span>&nbsp;<span class="op" id="3321747">!=</span>&nbsp;<span class="ident" id="3321750">nil</span><span class="op" id="3321753">;</span>&nbsp;<span class="ident" id="3321755">scope</span>&nbsp;<span class="op" id="3321761">=</span>&nbsp;<span class="ident" id="3321763">scope</span><span class="op" id="3321768">.</span><span class="ident" id="3321769">Outer</span>&nbsp;<span class="op" id="3321775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321779">if</span>&nbsp;<span class="ident" id="3321782">obj</span>&nbsp;<span class="op" id="3321786">:=</span>&nbsp;<span class="ident" id="3321789">scope</span><span class="op" id="3321794">.</span><span class="ident" id="3321795">Lookup</span><span class="op" id="3321801">(</span><span class="ident" id="3321802">ident</span><span class="op" id="3321807">.</span><span class="ident" id="3321808">Name</span><span class="op" id="3321812">)</span><span class="op" id="3321813">;</span>&nbsp;<span class="ident" id="3321815">obj</span>&nbsp;<span class="op" id="3321819">!=</span>&nbsp;<span class="ident" id="3321822">nil</span>&nbsp;<span class="op" id="3321826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321831">ident</span><span class="op" id="3321836">.</span><span class="ident" id="3321837">Obj</span>&nbsp;<span class="op" id="3321841">=</span>&nbsp;<span class="ident" id="3321843">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321850">return</span>&nbsp;<span class="builtintype" id="3321857">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321864">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321870">return</span>&nbsp;<span class="builtintype" id="3321877">false</span><br>
<span class="lineno"></span><span class="op" id="3321883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321886">//&nbsp;An&nbsp;Importer&nbsp;resolves&nbsp;import&nbsp;paths&nbsp;to&nbsp;package&nbsp;Objects.</span><br>
<span class="lineno">55</span><span class="comment" id="3321943">//&nbsp;The&nbsp;imports&nbsp;map&nbsp;records&nbsp;the&nbsp;packages&nbsp;already&nbsp;imported,</span><br>
<span class="lineno"></span><span class="comment" id="3322001">//&nbsp;indexed&nbsp;by&nbsp;package&nbsp;id&nbsp;(canonical&nbsp;import&nbsp;path).</span><br>
<span class="lineno"></span><span class="comment" id="3322051">//&nbsp;An&nbsp;Importer&nbsp;must&nbsp;determine&nbsp;the&nbsp;canonical&nbsp;import&nbsp;path&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3322111">//&nbsp;check&nbsp;the&nbsp;map&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;imports&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3322180">//&nbsp;If&nbsp;so,&nbsp;the&nbsp;Importer&nbsp;can&nbsp;return&nbsp;the&nbsp;map&nbsp;entry.&nbsp;&nbsp;Otherwise,&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="3322245">//&nbsp;Importer&nbsp;should&nbsp;load&nbsp;the&nbsp;package&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;path&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3322310">//&nbsp;a&nbsp;new&nbsp;*Object&nbsp;(pkg),&nbsp;record&nbsp;pkg&nbsp;in&nbsp;the&nbsp;imports&nbsp;map,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="3322374">//&nbsp;return&nbsp;pkg.</span><br>
<span class="lineno"></span><span class="keyword" id="3322389">type</span>&nbsp;<span class="ident" id="3322394">Importer</span>&nbsp;<span class="keyword" id="3322403">func</span><span class="op" id="3322407">(</span><span class="ident" id="3322408">imports</span>&nbsp;<span class="keyword" id="3322416">map</span><span class="op" id="3322419">[</span><span class="builtintype" id="3322420">string</span><span class="op" id="3322426">]</span><span class="op" id="3322427">*</span><span class="ident" id="3322428">Object</span><span class="op" id="3322434">,</span>&nbsp;<span class="ident" id="3322436">path</span>&nbsp;<span class="builtintype" id="3322441">string</span><span class="op" id="3322447">)</span>&nbsp;<span class="op" id="3322449">(</span><span class="ident" id="3322450">pkg</span>&nbsp;<span class="op" id="3322454">*</span><span class="ident" id="3322455">Object</span><span class="op" id="3322461">,</span>&nbsp;<span class="ident" id="3322463">err</span>&nbsp;<span class="builtintype" id="3322467">error</span><span class="op" id="3322472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3322475">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;Package&nbsp;node&nbsp;from&nbsp;a&nbsp;set&nbsp;of&nbsp;File&nbsp;nodes.&nbsp;It&nbsp;resolves</span><br>
<span class="lineno"></span><span class="comment" id="3322554">//&nbsp;unresolved&nbsp;identifiers&nbsp;across&nbsp;files&nbsp;and&nbsp;updates&nbsp;each&nbsp;file&#39;s&nbsp;Unresolved&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3322633">//&nbsp;accordingly.&nbsp;If&nbsp;a&nbsp;non-nil&nbsp;importer&nbsp;and&nbsp;universe&nbsp;scope&nbsp;are&nbsp;provided,&nbsp;they&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3322713">//&nbsp;used&nbsp;to&nbsp;resolve&nbsp;identifiers&nbsp;not&nbsp;declared&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;package&nbsp;files.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="3322790">//&nbsp;remaining&nbsp;unresolved&nbsp;identifiers&nbsp;are&nbsp;reported&nbsp;as&nbsp;undeclared.&nbsp;If&nbsp;the&nbsp;files</span><br>
<span class="lineno">70</span><span class="comment" id="3322867">//&nbsp;belong&nbsp;to&nbsp;different&nbsp;packages,&nbsp;one&nbsp;package&nbsp;name&nbsp;is&nbsp;selected&nbsp;and&nbsp;files&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3322944">//&nbsp;different&nbsp;package&nbsp;names&nbsp;are&nbsp;reported&nbsp;and&nbsp;then&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3323002">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;package&nbsp;node&nbsp;and&nbsp;a&nbsp;scanner.ErrorList&nbsp;if&nbsp;there&nbsp;were&nbsp;errors.</span><br>
<span class="lineno"></span><span class="comment" id="3323080">//</span><br>
<span class="lineno"></span><span class="keyword" id="3323083">func</span>&nbsp;<span class="ident" id="3323088">NewPackage</span><span class="op" id="3323098">(</span><span class="ident" id="3323099">fset</span>&nbsp;<span class="op" id="3323104">*</span><span class="ident" id="3323105">token</span><span class="op" id="3323110">.</span><span class="ident" id="3323111">FileSet</span><span class="op" id="3323118">,</span>&nbsp;<span class="ident" id="3323120">files</span>&nbsp;<span class="keyword" id="3323126">map</span><span class="op" id="3323129">[</span><span class="builtintype" id="3323130">string</span><span class="op" id="3323136">]</span><span class="op" id="3323137">*</span><span class="ident" id="3323138">File</span><span class="op" id="3323142">,</span>&nbsp;<span class="ident" id="3323144">importer</span>&nbsp;<span class="ident" id="3323153">Importer</span><span class="op" id="3323161">,</span>&nbsp;<span class="ident" id="3323163">universe</span>&nbsp;<span class="op" id="3323172">*</span><span class="ident" id="3323173">Scope</span><span class="op" id="3323178">)</span>&nbsp;<span class="op" id="3323180">(</span><span class="op" id="3323181">*</span><span class="ident" id="3323182">Package</span><span class="op" id="3323189">,</span>&nbsp;<span class="builtintype" id="3323191">error</span><span class="op" id="3323196">)</span>&nbsp;<span class="op" id="3323198">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323201">var</span>&nbsp;<span class="ident" id="3323205">p</span>&nbsp;<span class="ident" id="3323207">pkgBuilder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323219">p</span><span class="op" id="3323220">.</span><span class="ident" id="3323221">fset</span>&nbsp;<span class="op" id="3323226">=</span>&nbsp;<span class="ident" id="3323228">fset</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323235">//&nbsp;complete&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323262">pkgName</span>&nbsp;<span class="op" id="3323270">:=</span>&nbsp;<span class="string" id="3323273">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323277">pkgScope</span>&nbsp;<span class="op" id="3323286">:=</span>&nbsp;<span class="ident" id="3323289">NewScope</span><span class="op" id="3323297">(</span><span class="ident" id="3323298">universe</span><span class="op" id="3323306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323309">for</span>&nbsp;<span class="ident" id="3323313">_</span><span class="op" id="3323314">,</span>&nbsp;<span class="ident" id="3323316">file</span>&nbsp;<span class="op" id="3323321">:=</span>&nbsp;<span class="keyword" id="3323324">range</span>&nbsp;<span class="ident" id="3323330">files</span>&nbsp;<span class="op" id="3323336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323340">//&nbsp;package&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323370">switch</span>&nbsp;<span class="ident" id="3323377">name</span>&nbsp;<span class="op" id="3323382">:=</span>&nbsp;<span class="ident" id="3323385">file</span><span class="op" id="3323389">.</span><span class="ident" id="3323390">Name</span><span class="op" id="3323394">.</span><span class="ident" id="3323395">Name</span><span class="op" id="3323399">;</span>&nbsp;<span class="op" id="3323401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323405">case</span>&nbsp;<span class="ident" id="3323410">pkgName</span>&nbsp;<span class="op" id="3323418">==</span>&nbsp;<span class="string" id="3323421">&#34;&#34;</span><span class="op" id="3323423">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323428">pkgName</span>&nbsp;<span class="op" id="3323436">=</span>&nbsp;<span class="ident" id="3323438">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323445">case</span>&nbsp;<span class="ident" id="3323450">name</span>&nbsp;<span class="op" id="3323455">!=</span>&nbsp;<span class="ident" id="3323458">pkgName</span><span class="op" id="3323465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323470">p</span><span class="op" id="3323471">.</span><span class="ident" id="3323472">errorf</span><span class="op" id="3323478">(</span><span class="ident" id="3323479">file</span><span class="op" id="3323483">.</span><span class="ident" id="3323484">Package</span><span class="op" id="3323491">,</span>&nbsp;<span class="string" id="3323493">&#34;package&nbsp;%s;&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="3323518">,</span>&nbsp;<span class="ident" id="3323520">name</span><span class="op" id="3323524">,</span>&nbsp;<span class="ident" id="3323526">pkgName</span><span class="op" id="3323533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323538">continue</span>&nbsp;<span class="comment" id="3323547">//&nbsp;ignore&nbsp;this&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3323569">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323574">//&nbsp;collect&nbsp;top-level&nbsp;file&nbsp;objects&nbsp;in&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323627">for</span>&nbsp;<span class="ident" id="3323631">_</span><span class="op" id="3323632">,</span>&nbsp;<span class="ident" id="3323634">obj</span>&nbsp;<span class="op" id="3323638">:=</span>&nbsp;<span class="keyword" id="3323641">range</span>&nbsp;<span class="ident" id="3323647">file</span><span class="op" id="3323651">.</span><span class="ident" id="3323652">Scope</span><span class="op" id="3323657">.</span><span class="ident" id="3323658">Objects</span>&nbsp;<span class="op" id="3323666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323671">p</span><span class="op" id="3323672">.</span><span class="ident" id="3323673">declare</span><span class="op" id="3323680">(</span><span class="ident" id="3323681">pkgScope</span><span class="op" id="3323689">,</span>&nbsp;<span class="ident" id="3323691">nil</span><span class="op" id="3323694">,</span>&nbsp;<span class="ident" id="3323696">obj</span><span class="op" id="3323699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3323703">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3323706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323710">//&nbsp;package&nbsp;global&nbsp;mapping&nbsp;of&nbsp;imported&nbsp;package&nbsp;ids&nbsp;to&nbsp;package&nbsp;objects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323780">imports</span>&nbsp;<span class="op" id="3323788">:=</span>&nbsp;<span class="builtinfunc" id="3323791">make</span><span class="op" id="3323795">(</span><span class="keyword" id="3323796">map</span><span class="op" id="3323799">[</span><span class="builtintype" id="3323800">string</span><span class="op" id="3323806">]</span><span class="op" id="3323807">*</span><span class="ident" id="3323808">Object</span><span class="op" id="3323814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323818">//&nbsp;complete&nbsp;file&nbsp;scopes&nbsp;with&nbsp;imports&nbsp;and&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323880">for</span>&nbsp;<span class="ident" id="3323884">_</span><span class="op" id="3323885">,</span>&nbsp;<span class="ident" id="3323887">file</span>&nbsp;<span class="op" id="3323892">:=</span>&nbsp;<span class="keyword" id="3323895">range</span>&nbsp;<span class="ident" id="3323901">files</span>&nbsp;<span class="op" id="3323907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323911">//&nbsp;ignore&nbsp;file&nbsp;if&nbsp;it&nbsp;belongs&nbsp;to&nbsp;a&nbsp;different&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3323965">//&nbsp;(error&nbsp;has&nbsp;already&nbsp;been&nbsp;reported)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324004">if</span>&nbsp;<span class="ident" id="3324007">file</span><span class="op" id="3324011">.</span><span class="ident" id="3324012">Name</span><span class="op" id="3324016">.</span><span class="ident" id="3324017">Name</span>&nbsp;<span class="op" id="3324022">!=</span>&nbsp;<span class="ident" id="3324025">pkgName</span>&nbsp;<span class="op" id="3324033">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324038">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324054">//&nbsp;build&nbsp;file&nbsp;scope&nbsp;by&nbsp;processing&nbsp;all&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324102">importErrors</span>&nbsp;<span class="op" id="3324115">:=</span>&nbsp;<span class="builtintype" id="3324118">false</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324126">fileScope</span>&nbsp;<span class="op" id="3324136">:=</span>&nbsp;<span class="ident" id="3324139">NewScope</span><span class="op" id="3324147">(</span><span class="ident" id="3324148">pkgScope</span><span class="op" id="3324156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324160">for</span>&nbsp;<span class="ident" id="3324164">_</span><span class="op" id="3324165">,</span>&nbsp;<span class="ident" id="3324167">spec</span>&nbsp;<span class="op" id="3324172">:=</span>&nbsp;<span class="keyword" id="3324175">range</span>&nbsp;<span class="ident" id="3324181">file</span><span class="op" id="3324185">.</span><span class="ident" id="3324186">Imports</span>&nbsp;<span class="op" id="3324194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324199">if</span>&nbsp;<span class="ident" id="3324202">importer</span>&nbsp;<span class="op" id="3324211">==</span>&nbsp;<span class="ident" id="3324214">nil</span>&nbsp;<span class="op" id="3324218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324224">importErrors</span>&nbsp;<span class="op" id="3324237">=</span>&nbsp;<span class="builtintype" id="3324239">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324248">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324265">path</span><span class="op" id="3324269">,</span>&nbsp;<span class="ident" id="3324271">_</span>&nbsp;<span class="op" id="3324273">:=</span>&nbsp;<span class="ident" id="3324276">strconv</span><span class="op" id="3324283">.</span><span class="ident" id="3324284">Unquote</span><span class="op" id="3324291">(</span><span class="ident" id="3324292">spec</span><span class="op" id="3324296">.</span><span class="ident" id="3324297">Path</span><span class="op" id="3324301">.</span><span class="ident" id="3324302">Value</span><span class="op" id="3324307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324312">pkg</span><span class="op" id="3324315">,</span>&nbsp;<span class="ident" id="3324317">err</span>&nbsp;<span class="op" id="3324321">:=</span>&nbsp;<span class="ident" id="3324324">importer</span><span class="op" id="3324332">(</span><span class="ident" id="3324333">imports</span><span class="op" id="3324340">,</span>&nbsp;<span class="ident" id="3324342">path</span><span class="op" id="3324346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324351">if</span>&nbsp;<span class="ident" id="3324354">err</span>&nbsp;<span class="op" id="3324358">!=</span>&nbsp;<span class="ident" id="3324361">nil</span>&nbsp;<span class="op" id="3324365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324371">p</span><span class="op" id="3324372">.</span><span class="ident" id="3324373">errorf</span><span class="op" id="3324379">(</span><span class="ident" id="3324380">spec</span><span class="op" id="3324384">.</span><span class="ident" id="3324385">Path</span><span class="op" id="3324389">.</span><span class="ident" id="3324390">Pos</span><span class="op" id="3324393">(</span><span class="op" id="3324394">)</span><span class="op" id="3324395">,</span>&nbsp;<span class="string" id="3324397">&#34;could&nbsp;not&nbsp;import&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="3324423">,</span>&nbsp;<span class="ident" id="3324425">path</span><span class="op" id="3324429">,</span>&nbsp;<span class="ident" id="3324431">err</span><span class="op" id="3324434">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324440">importErrors</span>&nbsp;<span class="op" id="3324453">=</span>&nbsp;<span class="builtintype" id="3324455">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324464">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324481">//&nbsp;TODO(gri)&nbsp;If&nbsp;a&nbsp;local&nbsp;package&nbsp;name&nbsp;!=&nbsp;&#34;.&#34;&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324541">//&nbsp;global&nbsp;identifier&nbsp;resolution&nbsp;could&nbsp;proceed&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324602">//&nbsp;import&nbsp;failed.&nbsp;Consider&nbsp;adjusting&nbsp;the&nbsp;logic&nbsp;here&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324665">//&nbsp;local&nbsp;name&nbsp;overrides&nbsp;imported&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324714">name</span>&nbsp;<span class="op" id="3324719">:=</span>&nbsp;<span class="ident" id="3324722">pkg</span><span class="op" id="3324725">.</span><span class="ident" id="3324726">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324734">if</span>&nbsp;<span class="ident" id="3324737">spec</span><span class="op" id="3324741">.</span><span class="ident" id="3324742">Name</span>&nbsp;<span class="op" id="3324747">!=</span>&nbsp;<span class="ident" id="3324750">nil</span>&nbsp;<span class="op" id="3324754">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324760">name</span>&nbsp;<span class="op" id="3324765">=</span>&nbsp;<span class="ident" id="3324767">spec</span><span class="op" id="3324771">.</span><span class="ident" id="3324772">Name</span><span class="op" id="3324776">.</span><span class="ident" id="3324777">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324791">//&nbsp;add&nbsp;import&nbsp;to&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324822">if</span>&nbsp;<span class="ident" id="3324825">name</span>&nbsp;<span class="op" id="3324830">==</span>&nbsp;<span class="string" id="3324833">&#34;.&#34;</span>&nbsp;<span class="op" id="3324837">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3324843">//&nbsp;merge&nbsp;imported&nbsp;scope&nbsp;with&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3324887">for</span>&nbsp;<span class="ident" id="3324891">_</span><span class="op" id="3324892">,</span>&nbsp;<span class="ident" id="3324894">obj</span>&nbsp;<span class="op" id="3324898">:=</span>&nbsp;<span class="keyword" id="3324901">range</span>&nbsp;<span class="ident" id="3324907">pkg</span><span class="op" id="3324910">.</span><span class="ident" id="3324911">Data</span><span class="op" id="3324915">.</span><span class="op" id="3324916">(</span><span class="op" id="3324917">*</span><span class="ident" id="3324918">Scope</span><span class="op" id="3324923">)</span><span class="op" id="3324924">.</span><span class="ident" id="3324925">Objects</span>&nbsp;<span class="op" id="3324933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3324940">p</span><span class="op" id="3324941">.</span><span class="ident" id="3324942">declare</span><span class="op" id="3324949">(</span><span class="ident" id="3324950">fileScope</span><span class="op" id="3324959">,</span>&nbsp;<span class="ident" id="3324961">pkgScope</span><span class="op" id="3324969">,</span>&nbsp;<span class="ident" id="3324971">obj</span><span class="op" id="3324974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3324985">}</span>&nbsp;<span class="keyword" id="3324987">else</span>&nbsp;<span class="keyword" id="3324992">if</span>&nbsp;<span class="ident" id="3324995">name</span>&nbsp;<span class="op" id="3325000">!=</span>&nbsp;<span class="string" id="3325003">&#34;_&#34;</span>&nbsp;<span class="op" id="3325007">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325013">//&nbsp;declare&nbsp;imported&nbsp;package&nbsp;object&nbsp;in&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325066">//&nbsp;(do&nbsp;not&nbsp;re-use&nbsp;pkg&nbsp;in&nbsp;the&nbsp;file&nbsp;scope&nbsp;but&nbsp;create</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325121">//&nbsp;a&nbsp;new&nbsp;object&nbsp;instead;&nbsp;the&nbsp;Decl&nbsp;field&nbsp;is&nbsp;different</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325178">//&nbsp;for&nbsp;different&nbsp;files)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325206">obj</span>&nbsp;<span class="op" id="3325210">:=</span>&nbsp;<span class="ident" id="3325213">NewObj</span><span class="op" id="3325219">(</span><span class="ident" id="3325220">Pkg</span><span class="op" id="3325223">,</span>&nbsp;<span class="ident" id="3325225">name</span><span class="op" id="3325229">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325235">obj</span><span class="op" id="3325238">.</span><span class="ident" id="3325239">Decl</span>&nbsp;<span class="op" id="3325244">=</span>&nbsp;<span class="ident" id="3325246">spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325255">obj</span><span class="op" id="3325258">.</span><span class="ident" id="3325259">Data</span>&nbsp;<span class="op" id="3325264">=</span>&nbsp;<span class="ident" id="3325266">pkg</span><span class="op" id="3325269">.</span><span class="ident" id="3325270">Data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325279">p</span><span class="op" id="3325280">.</span><span class="ident" id="3325281">declare</span><span class="op" id="3325288">(</span><span class="ident" id="3325289">fileScope</span><span class="op" id="3325298">,</span>&nbsp;<span class="ident" id="3325300">pkgScope</span><span class="op" id="3325308">,</span>&nbsp;<span class="ident" id="3325310">obj</span><span class="op" id="3325313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325322">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325327">//&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3325352">if</span>&nbsp;<span class="ident" id="3325355">importErrors</span>&nbsp;<span class="op" id="3325368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325373">//&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;universe&nbsp;scope&nbsp;without&nbsp;correct&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325432">//&nbsp;(objects&nbsp;in&nbsp;the&nbsp;universe&nbsp;may&nbsp;be&nbsp;shadowed&nbsp;by&nbsp;imports;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325491">//&nbsp;with&nbsp;missing&nbsp;imports,&nbsp;identifiers&nbsp;might&nbsp;get&nbsp;resolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3325550">//&nbsp;incorrectly&nbsp;to&nbsp;universe&nbsp;objects)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325589">pkgScope</span><span class="op" id="3325597">.</span><span class="ident" id="3325598">Outer</span>&nbsp;<span class="op" id="3325604">=</span>&nbsp;<span class="ident" id="3325606">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325616">i</span>&nbsp;<span class="op" id="3325618">:=</span>&nbsp;<span class="num" id="3325621">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3325625">for</span>&nbsp;<span class="ident" id="3325629">_</span><span class="op" id="3325630">,</span>&nbsp;<span class="ident" id="3325632">ident</span>&nbsp;<span class="op" id="3325638">:=</span>&nbsp;<span class="keyword" id="3325641">range</span>&nbsp;<span class="ident" id="3325647">file</span><span class="op" id="3325651">.</span><span class="ident" id="3325652">Unresolved</span>&nbsp;<span class="op" id="3325663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3325668">if</span>&nbsp;<span class="op" id="3325671">!</span><span class="ident" id="3325672">resolve</span><span class="op" id="3325679">(</span><span class="ident" id="3325680">fileScope</span><span class="op" id="3325689">,</span>&nbsp;<span class="ident" id="3325691">ident</span><span class="op" id="3325696">)</span>&nbsp;<span class="op" id="3325698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325704">p</span><span class="op" id="3325705">.</span><span class="ident" id="3325706">errorf</span><span class="op" id="3325712">(</span><span class="ident" id="3325713">ident</span><span class="op" id="3325718">.</span><span class="ident" id="3325719">Pos</span><span class="op" id="3325722">(</span><span class="op" id="3325723">)</span><span class="op" id="3325724">,</span>&nbsp;<span class="string" id="3325726">&#34;undeclared&nbsp;name:&nbsp;%s&#34;</span><span class="op" id="3325747">,</span>&nbsp;<span class="ident" id="3325749">ident</span><span class="op" id="3325754">.</span><span class="ident" id="3325755">Name</span><span class="op" id="3325759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325765">file</span><span class="op" id="3325769">.</span><span class="ident" id="3325770">Unresolved</span><span class="op" id="3325780">[</span><span class="ident" id="3325781">i</span><span class="op" id="3325782">]</span>&nbsp;<span class="op" id="3325784">=</span>&nbsp;<span class="ident" id="3325786">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325796">i</span><span class="op" id="3325797">++</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325812">file</span><span class="op" id="3325816">.</span><span class="ident" id="3325817">Unresolved</span>&nbsp;<span class="op" id="3325828">=</span>&nbsp;<span class="ident" id="3325830">file</span><span class="op" id="3325834">.</span><span class="ident" id="3325835">Unresolved</span><span class="op" id="3325845">[</span><span class="num" id="3325846">0</span><span class="op" id="3325847">:</span><span class="ident" id="3325848">i</span><span class="op" id="3325849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325853">pkgScope</span><span class="op" id="3325861">.</span><span class="ident" id="3325862">Outer</span>&nbsp;<span class="op" id="3325868">=</span>&nbsp;<span class="ident" id="3325870">universe</span>&nbsp;<span class="comment" id="3325879">//&nbsp;reset&nbsp;universe&nbsp;scope</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3325904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3325908">p</span><span class="op" id="3325909">.</span><span class="ident" id="3325910">errors</span><span class="op" id="3325916">.</span><span class="ident" id="3325917">Sort</span><span class="op" id="3325921">(</span><span class="op" id="3325922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3325925">return</span>&nbsp;<span class="op" id="3325932">&amp;</span><span class="ident" id="3325933">Package</span><span class="op" id="3325940">{</span><span class="ident" id="3325941">pkgName</span><span class="op" id="3325948">,</span>&nbsp;<span class="ident" id="3325950">pkgScope</span><span class="op" id="3325958">,</span>&nbsp;<span class="ident" id="3325960">imports</span><span class="op" id="3325967">,</span>&nbsp;<span class="ident" id="3325969">files</span><span class="op" id="3325974">}</span><span class="op" id="3325975">,</span>&nbsp;<span class="ident" id="3325977">p</span><span class="op" id="3325978">.</span><span class="ident" id="3325979">errors</span><span class="op" id="3325985">.</span><span class="ident" id="3325986">Err</span><span class="op" id="3325989">(</span><span class="op" id="3325990">)</span><br>
<span class="lineno"></span><span class="op" id="3325992">}</span>
</div>
</body>
</html>
