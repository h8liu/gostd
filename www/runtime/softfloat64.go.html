<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment">//&nbsp;Software&nbsp;IEEE754&nbsp;64-bit&nbsp;floating&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Only&nbsp;referred&nbsp;to&nbsp;(and&nbsp;thus&nbsp;linked&nbsp;in)&nbsp;by&nbsp;arm&nbsp;port</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;by&nbsp;tests&nbsp;in&nbsp;this&nbsp;directory.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">package</span>&nbsp;<span class="ident">runtime</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mantbits64</span>&nbsp;<span class="builtintype">uint</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">expbits64</span>&nbsp;&nbsp;<span class="builtintype">uint</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bias64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="op">(</span><span class="ident">expbits64</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nan64</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits64</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">inf64</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">mantbits64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg64</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">expbits64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">mantbits64</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mantbits32</span>&nbsp;<span class="builtintype">uint</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">expbits32</span>&nbsp;&nbsp;<span class="builtintype">uint</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bias32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="op">(</span><span class="ident">expbits32</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nan32</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits32</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">inf32</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">mantbits32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg32</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">expbits32</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">mantbits32</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">sign</span><span class="op">,</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">inf</span><span class="op">,</span>&nbsp;<span class="ident">nan</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sign</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">mantbits64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">expbits64</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">f</span><span class="op">&gt;&gt;</span><span class="ident">mantbits64</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nan</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">inf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;denormalized</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">bias64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">--</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">mantbits64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">bias64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funpack32</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">sign</span><span class="op">,</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">inf</span><span class="op">,</span>&nbsp;<span class="ident">nan</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sign</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">mantbits32</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">expbits32</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">f</span><span class="op">&gt;&gt;</span><span class="ident">mantbits32</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nan</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">inf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">bias32</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">mantbits32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">bias32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">sign</span><span class="op">,</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant0</span><span class="op">,</span>&nbsp;<span class="ident">exp0</span><span class="op">,</span>&nbsp;<span class="ident">trunc0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">4</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">2</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">(</span><span class="ident">trunc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">2</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">++</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">4</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits64</span><span class="op">-</span><span class="num">1</span><span class="op">+</span><span class="ident">bias64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">inf64</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias64</span><span class="op">+</span><span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias64</span><span class="op">-</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">mantbits64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;repeat&nbsp;expecting&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mant0</span><span class="op">,</span>&nbsp;<span class="ident">exp0</span><span class="op">,</span>&nbsp;<span class="ident">trunc0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">(</span><span class="ident">trunc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">2</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">mant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">exp</span><span class="op">-</span><span class="ident">bias64</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits64</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fpack32</span><span class="op">(</span><span class="ident">sign</span><span class="op">,</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant0</span><span class="op">,</span>&nbsp;<span class="ident">exp0</span><span class="op">,</span>&nbsp;<span class="ident">trunc0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">4</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">2</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">(</span><span class="ident">trunc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">2</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">4</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">expbits32</span><span class="op">-</span><span class="num">1</span><span class="op">+</span><span class="ident">bias32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">inf32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias32</span><span class="op">+</span><span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias32</span><span class="op">-</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">mantbits32</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;repeat&nbsp;expecting&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mant0</span><span class="op">,</span>&nbsp;<span class="ident">exp0</span><span class="op">,</span>&nbsp;<span class="ident">trunc0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">bias32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">(</span><span class="ident">trunc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="num">2</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">mant</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sign</span>&nbsp;<span class="op">|</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">exp</span><span class="op">-</span><span class="ident">bias32</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">mantbits32</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword">func</span>&nbsp;<span class="ident">fadd64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">ge</span><span class="op">,</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">gn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">g</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;cases.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">gn</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;NaN&nbsp;+&nbsp;x&nbsp;or&nbsp;x&nbsp;+&nbsp;NaN&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">gs</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;+Inf&nbsp;+&nbsp;-Inf&nbsp;or&nbsp;-Inf&nbsp;+&nbsp;+Inf&nbsp;=&nbsp;NaN</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;±Inf&nbsp;+&nbsp;g&nbsp;=&nbsp;±Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">gi</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;+&nbsp;±Inf&nbsp;=&nbsp;±Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">g</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;-0&nbsp;+&nbsp;-0&nbsp;=&nbsp;-0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;0&nbsp;+&nbsp;g&nbsp;=&nbsp;g&nbsp;but&nbsp;0&nbsp;+&nbsp;-0&nbsp;=&nbsp;+0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">g</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">gs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">g</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;+&nbsp;0&nbsp;=&nbsp;f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">ge</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">ge</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">,</span>&nbsp;<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">ge</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">g</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">ge</span><span class="op">,</span>&nbsp;<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">fe</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">ge</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gm</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gm</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">gs</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">gm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">gm</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">-</span><span class="num">2</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword">func</span>&nbsp;<span class="ident">fsub64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fadd64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">fneg64</span><span class="op">(</span><span class="ident">g</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fneg64</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">^</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">mantbits64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">expbits64</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fmul64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">ge</span><span class="op">,</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">gn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">g</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">gn</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;NaN&nbsp;*&nbsp;g&nbsp;or&nbsp;f&nbsp;*&nbsp;NaN&nbsp;=&nbsp;NaN</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gi</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;Inf&nbsp;*&nbsp;Inf&nbsp;=&nbsp;Inf&nbsp;(with&nbsp;sign&nbsp;adjusted)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">gs</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gi</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;0&nbsp;*&nbsp;Inf&nbsp;=&nbsp;Inf&nbsp;*&nbsp;0&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;0&nbsp;*&nbsp;x&nbsp;=&nbsp;0&nbsp;(with&nbsp;sign&nbsp;adjusted)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">gs</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;x&nbsp;*&nbsp;0&nbsp;=&nbsp;0&nbsp;(with&nbsp;sign&nbsp;adjusted)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">fs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;53-bit&nbsp;*&nbsp;53-bit&nbsp;=&nbsp;107-&nbsp;or&nbsp;108-bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span><span class="op">,</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">mullu</span><span class="op">(</span><span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">mantbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">trunc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">hi</span><span class="op">&lt;&lt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="ident">shift</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">lo</span><span class="op">&gt;&gt;</span><span class="ident">shift</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">fs</span><span class="op">^</span><span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">+</span><span class="ident">ge</span><span class="op">-</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fdiv64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">ge</span><span class="op">,</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">gn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">g</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">gn</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;NaN&nbsp;/&nbsp;g&nbsp;=&nbsp;f&nbsp;/&nbsp;NaN&nbsp;=&nbsp;NaN</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gi</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;±Inf&nbsp;/&nbsp;±Inf&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="op">!</span><span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">!</span><span class="ident">gi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;0&nbsp;/&nbsp;0&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="op">!</span><span class="ident">gi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;Inf&nbsp;/&nbsp;g&nbsp;=&nbsp;f&nbsp;/&nbsp;0&nbsp;=&nbsp;Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">gs</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">inf64</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;/&nbsp;Inf&nbsp;=&nbsp;0&nbsp;/&nbsp;g&nbsp;=&nbsp;Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">gs</span>&nbsp;<span class="op">^</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span><span class="op">,</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">gn</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;53-bit&lt;&lt;54&nbsp;/&nbsp;53-bit&nbsp;=&nbsp;53-&nbsp;or&nbsp;54-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">mantbits64</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">q</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">divlu</span><span class="op">(</span><span class="ident">fm</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="ident">shift</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">&lt;&lt;</span><span class="ident">shift</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">fs</span><span class="op">^</span><span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">q</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">-</span><span class="ident">ge</span><span class="op">-</span><span class="num">2</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno">315</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">f64to32</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs32</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">fs</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fs32</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">inf32</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mantbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">mantbits32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack32</span><span class="op">(</span><span class="ident">fs32</span><span class="op">,</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">fm</span><span class="op">&gt;&gt;</span><span class="ident">d</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">-</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">fm</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">d</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="keyword">func</span>&nbsp;<span class="ident">f32to64</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mantbits64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">mantbits32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack32</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nan64</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs64</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">fs</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fs64</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">inf64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">fs64</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">fm</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">d</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fcmp64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">cmp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">isnan</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gs</span><span class="op">,</span>&nbsp;<span class="ident">gm</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">gi</span><span class="op">,</span>&nbsp;<span class="ident">gn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">g</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fn</span><span class="op">,</span>&nbsp;<span class="ident">gn</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;flag&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="op">!</span><span class="ident">fi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">!</span><span class="ident">gi</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">gm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;±0&nbsp;==&nbsp;±0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">gs</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;&lt;&nbsp;0,&nbsp;g&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">gs</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;&gt;&nbsp;0,&nbsp;g&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">+</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Same&nbsp;sign,&nbsp;not&nbsp;NaN.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Can&nbsp;compare&nbsp;encodings&nbsp;directly&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Reverse&nbsp;for&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">g</span><span class="op">,</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">g</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">g</span><span class="op">,</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">g</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">+</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;f&nbsp;==&nbsp;g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">f64toint</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">val</span>&nbsp;<span class="ident">int64</span><span class="op">,</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">fm</span><span class="op">,</span>&nbsp;<span class="ident">fe</span><span class="op">,</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">funpack64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fi</span><span class="op">,</span>&nbsp;<span class="ident">fn</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;NaN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;&lt;&nbsp;0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">63</span><span class="op">:</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;&gt;=&nbsp;2^63</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fm</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span>&nbsp;<span class="comment">//&nbsp;f&nbsp;==&nbsp;-2^63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">63</span><span class="op">,</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">mantbits64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fe</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">fe</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">mantbits64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fe</span><span class="op">++</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">fm</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">val</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">val</span><span class="op">,</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fintto64</span><span class="op">(</span><span class="ident">val</span>&nbsp;<span class="ident">int64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fs</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">val</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">63</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">val</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fs</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">mant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fpack64</span><span class="op">(</span><span class="ident">fs</span><span class="op">,</span>&nbsp;<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">mantbits64</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;64x64&nbsp;-&gt;&nbsp;128&nbsp;multiply.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;adapted&nbsp;from&nbsp;hacker&#39;s&nbsp;delight.</span><br>
<span class="lineno">420</span><span class="keyword">func</span>&nbsp;<span class="ident">mullu</span><span class="op">(</span><span class="ident">u</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">lo</span><span class="op">,</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">s</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">v0</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u1</span><span class="op">*</span><span class="ident">v0</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">w0</span><span class="op">&gt;&gt;</span><span class="ident">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w1</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">v1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">v</span><span class="op">,</span>&nbsp;<span class="ident">u1</span><span class="op">*</span><span class="ident">v1</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">w2</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">w1</span><span class="op">&gt;&gt;</span><span class="ident">s</span><br>
<span class="lineno">435</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;128/64&nbsp;-&gt;&nbsp;64&nbsp;quotient,&nbsp;64&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;adapted&nbsp;from&nbsp;hacker&#39;s&nbsp;delight</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">divlu</span><span class="op">(</span><span class="ident">u1</span><span class="op">,</span>&nbsp;<span class="ident">u0</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">q</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u1</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">64</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;s&nbsp;=&nbsp;nlz(v);&nbsp;v&nbsp;&lt;&lt;=&nbsp;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">v</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">63</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">++</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">vn1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">vn0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">un32</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u1</span><span class="op">&lt;&lt;</span><span class="ident">s</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">u0</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="ident">s</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">un10</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">un1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un10</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">un0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un10</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">q1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un32</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">vn1</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rhat</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">q1</span><span class="op">*</span><span class="ident">vn1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident">again1</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">q1</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">q1</span><span class="op">*</span><span class="ident">vn0</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">b</span><span class="op">*</span><span class="ident">rhat</span><span class="op">+</span><span class="ident">un1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">q1</span><span class="op">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rhat</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">vn1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">rhat</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">goto</span>&nbsp;<span class="ident">again1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">un21</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un32</span><span class="op">*</span><span class="ident">b</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">un1</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">q1</span><span class="op">*</span><span class="ident">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">q0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">un21</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">vn1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rhat</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">un21</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">q0</span><span class="op">*</span><span class="ident">vn1</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="ident">again2</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">q0</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">q0</span><span class="op">*</span><span class="ident">vn0</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">b</span><span class="op">*</span><span class="ident">rhat</span><span class="op">+</span><span class="ident">un0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">q0</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rhat</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">vn1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">rhat</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">goto</span>&nbsp;<span class="ident">again2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">q1</span><span class="op">*</span><span class="ident">b</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">q0</span><span class="op">,</span>&nbsp;<span class="op">(</span><span class="ident">un21</span><span class="op">*</span><span class="ident">b</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">un0</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">q0</span><span class="op">*</span><span class="ident">v</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">s</span><br>
<span class="lineno">485</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;callable&nbsp;from&nbsp;C</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fadd64c</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fadd64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno">490</span><span class="keyword">func</span>&nbsp;<span class="ident">fsub64c</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fsub64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fmul64c</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmul64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fdiv64c</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fdiv64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fneg64c</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fneg64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">f32to64c</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f32to64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno">495</span><span class="keyword">func</span>&nbsp;<span class="ident">f64to32c</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="builtintype">uint32</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f64to32</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fcmp64c</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">retnan</span>&nbsp;<span class="op">*</span><span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">retnan</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fcmp64</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">g</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fintto64c</span><span class="op">(</span><span class="ident">val</span>&nbsp;<span class="ident">int64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fintto64</span><span class="op">(</span><span class="ident">val</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">f64tointc</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="op">*</span><span class="ident">int64</span><span class="op">,</span>&nbsp;<span class="ident">retok</span>&nbsp;<span class="op">*</span><span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span>&nbsp;<span class="op">*</span><span class="ident">ret</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">retok</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f64toint</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span>&nbsp;<span class="op">}</span>
</div>
</body>
</html>
