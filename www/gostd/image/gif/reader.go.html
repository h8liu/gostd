<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5911308">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5911363">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5911417">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5911468">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5911527">//</span><br>
<span class="lineno"></span><span class="comment" id="5911530">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="5911609">package</span>&nbsp;<span class="ident" id="5911617">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5911622">import</span>&nbsp;<span class="op" id="5911629">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911632">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911641">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911657">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911667">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911674">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911683">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5911698">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5911703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5911706">var</span>&nbsp;<span class="op" id="5911710">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911713">errNotEnough</span>&nbsp;<span class="op" id="5911726">=</span>&nbsp;<span class="ident" id="5911728">errors</span><span class="op" id="5911734">.</span><span class="ident" id="5911735">New</span><span class="op" id="5911738">(</span><span class="string" id="5911739">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="5911767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911770">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5911783">=</span>&nbsp;<span class="ident" id="5911785">errors</span><span class="op" id="5911791">.</span><span class="ident" id="5911792">New</span><span class="op" id="5911795">(</span><span class="string" id="5911796">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="5911822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911825">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="5911838">=</span>&nbsp;<span class="ident" id="5911840">errors</span><span class="op" id="5911846">.</span><span class="ident" id="5911847">New</span><span class="op" id="5911850">(</span><span class="string" id="5911851">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="5911877">)</span><br>
<span class="lineno"></span><span class="op" id="5911879">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5911882">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="5911977">type</span>&nbsp;<span class="ident" id="5911982">reader</span>&nbsp;<span class="keyword" id="5911989">interface</span>&nbsp;<span class="op" id="5911999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912002">io</span><span class="op" id="5912004">.</span><span class="ident" id="5912005">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912013">io</span><span class="op" id="5912015">.</span><span class="ident" id="5912016">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="5912027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912030">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="5912044">const</span>&nbsp;<span class="op" id="5912050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912053">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912065">fColorMapFollows</span>&nbsp;<span class="op" id="5912082">=</span>&nbsp;<span class="num" id="5912084">1</span>&nbsp;<span class="op" id="5912086">&lt;&lt;</span>&nbsp;<span class="num" id="5912089">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912093">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912111">ifLocalColorTable</span>&nbsp;<span class="op" id="5912129">=</span>&nbsp;<span class="num" id="5912131">1</span>&nbsp;<span class="op" id="5912133">&lt;&lt;</span>&nbsp;<span class="num" id="5912136">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912139">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912157">=</span>&nbsp;<span class="num" id="5912159">1</span>&nbsp;<span class="op" id="5912161">&lt;&lt;</span>&nbsp;<span class="num" id="5912164">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912167">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5912185">=</span>&nbsp;<span class="num" id="5912187">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912191">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912218">gcTransparentColorSet</span>&nbsp;<span class="op" id="5912240">=</span>&nbsp;<span class="num" id="5912242">1</span>&nbsp;<span class="op" id="5912244">&lt;&lt;</span>&nbsp;<span class="num" id="5912247">0</span><br>
<span class="lineno"></span><span class="op" id="5912249">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5912252">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="5912275">const</span>&nbsp;<span class="op" id="5912281">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912284">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912301">=</span>&nbsp;<span class="num" id="5912303">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912309">sImageDescriptor</span>&nbsp;<span class="op" id="5912326">=</span>&nbsp;<span class="num" id="5912328">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912334">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912351">=</span>&nbsp;<span class="num" id="5912353">0x3B</span><br>
<span class="lineno"></span><span class="op" id="5912358">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912361">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5912376">const</span>&nbsp;<span class="op" id="5912382">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912385">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912401">=</span>&nbsp;<span class="num" id="5912403">0x01</span>&nbsp;<span class="comment" id="5912408">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912423">eGraphicControl</span>&nbsp;<span class="op" id="5912439">=</span>&nbsp;<span class="num" id="5912441">0xF9</span>&nbsp;<span class="comment" id="5912446">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912466">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912482">=</span>&nbsp;<span class="num" id="5912484">0xFE</span>&nbsp;<span class="comment" id="5912489">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912501">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912517">=</span>&nbsp;<span class="num" id="5912519">0xFF</span>&nbsp;<span class="comment" id="5912524">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="5912539">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5912542">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5912592">type</span>&nbsp;<span class="ident" id="5912597">decoder</span>&nbsp;<span class="keyword" id="5912605">struct</span>&nbsp;<span class="op" id="5912612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912615">r</span>&nbsp;<span class="ident" id="5912617">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912626">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912643">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912659">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912667">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912683">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912688">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912704">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912709">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912725">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912731">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912747">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912753">backgroundIndex</span>&nbsp;<span class="builtintype" id="5912769">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912775">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912791">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912796">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912812">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912818">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912842">aspect</span>&nbsp;<span class="builtintype" id="5912849">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912856">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912883">imageFields</span>&nbsp;<span class="builtintype" id="5912895">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912902">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912929">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5912949">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912955">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="5912975">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912982">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912996">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913011">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913017">globalColorMap</span>&nbsp;<span class="ident" id="5913032">color</span><span class="op" id="5913037">.</span><span class="ident" id="5913038">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913048">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913072">delay</span>&nbsp;<span class="op" id="5913078">[</span><span class="op" id="5913079">]</span><span class="builtintype" id="5913080">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913085">image</span>&nbsp;<span class="op" id="5913091">[</span><span class="op" id="5913092">]</span><span class="op" id="5913093">*</span><span class="ident" id="5913094">image</span><span class="op" id="5913099">.</span><span class="ident" id="5913100">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913110">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5913116">[</span><span class="num" id="5913117">1024</span><span class="op" id="5913121">]</span><span class="builtintype" id="5913122">byte</span>&nbsp;<span class="comment" id="5913127">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="5913176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5913179">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5913246">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5913313">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5913377">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="5913447">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5913516">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="5913545">type</span>&nbsp;<span class="ident" id="5913550">blockReader</span>&nbsp;<span class="keyword" id="5913562">struct</span>&nbsp;<span class="op" id="5913569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913572">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913578">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913586">slice</span>&nbsp;<span class="op" id="5913592">[</span><span class="op" id="5913593">]</span><span class="builtintype" id="5913594">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913600">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913606">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913613">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5913619">[</span><span class="num" id="5913620">256</span><span class="op" id="5913623">]</span><span class="builtintype" id="5913624">byte</span><br>
<span class="lineno"></span><span class="op" id="5913629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5913632">func</span>&nbsp;<span class="op" id="5913637">(</span><span class="ident" id="5913638">b</span>&nbsp;<span class="op" id="5913640">*</span><span class="ident" id="5913641">blockReader</span><span class="op" id="5913652">)</span>&nbsp;<span class="ident" id="5913654">Read</span><span class="op" id="5913658">(</span><span class="ident" id="5913659">p</span>&nbsp;<span class="op" id="5913661">[</span><span class="op" id="5913662">]</span><span class="builtintype" id="5913663">byte</span><span class="op" id="5913667">)</span>&nbsp;<span class="op" id="5913669">(</span><span class="builtintype" id="5913670">int</span><span class="op" id="5913673">,</span>&nbsp;<span class="builtintype" id="5913675">error</span><span class="op" id="5913680">)</span>&nbsp;<span class="op" id="5913682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913685">if</span>&nbsp;<span class="ident" id="5913688">b</span><span class="op" id="5913689">.</span><span class="ident" id="5913690">err</span>&nbsp;<span class="op" id="5913694">!=</span>&nbsp;<span class="ident" id="5913697">nil</span>&nbsp;<span class="op" id="5913701">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913705">return</span>&nbsp;<span class="num" id="5913712">0</span><span class="op" id="5913713">,</span>&nbsp;<span class="ident" id="5913715">b</span><span class="op" id="5913716">.</span><span class="ident" id="5913717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913725">if</span>&nbsp;<span class="builtinfunc" id="5913728">len</span><span class="op" id="5913731">(</span><span class="ident" id="5913732">p</span><span class="op" id="5913733">)</span>&nbsp;<span class="op" id="5913735">==</span>&nbsp;<span class="num" id="5913738">0</span>&nbsp;<span class="op" id="5913740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913744">return</span>&nbsp;<span class="num" id="5913751">0</span><span class="op" id="5913752">,</span>&nbsp;<span class="ident" id="5913754">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913759">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913762">if</span>&nbsp;<span class="builtinfunc" id="5913765">len</span><span class="op" id="5913768">(</span><span class="ident" id="5913769">b</span><span class="op" id="5913770">.</span><span class="ident" id="5913771">slice</span><span class="op" id="5913776">)</span>&nbsp;<span class="op" id="5913778">==</span>&nbsp;<span class="num" id="5913781">0</span>&nbsp;<span class="op" id="5913783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913787">var</span>&nbsp;<span class="ident" id="5913791">blockLen</span>&nbsp;<span class="builtintype" id="5913800">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913808">blockLen</span><span class="op" id="5913816">,</span>&nbsp;<span class="ident" id="5913818">b</span><span class="op" id="5913819">.</span><span class="ident" id="5913820">err</span>&nbsp;<span class="op" id="5913824">=</span>&nbsp;<span class="ident" id="5913826">b</span><span class="op" id="5913827">.</span><span class="ident" id="5913828">r</span><span class="op" id="5913829">.</span><span class="ident" id="5913830">ReadByte</span><span class="op" id="5913838">(</span><span class="op" id="5913839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913843">if</span>&nbsp;<span class="ident" id="5913846">b</span><span class="op" id="5913847">.</span><span class="ident" id="5913848">err</span>&nbsp;<span class="op" id="5913852">!=</span>&nbsp;<span class="ident" id="5913855">nil</span>&nbsp;<span class="op" id="5913859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913864">return</span>&nbsp;<span class="num" id="5913871">0</span><span class="op" id="5913872">,</span>&nbsp;<span class="ident" id="5913874">b</span><span class="op" id="5913875">.</span><span class="ident" id="5913876">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913886">if</span>&nbsp;<span class="ident" id="5913889">blockLen</span>&nbsp;<span class="op" id="5913898">==</span>&nbsp;<span class="num" id="5913901">0</span>&nbsp;<span class="op" id="5913903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913908">b</span><span class="op" id="5913909">.</span><span class="ident" id="5913910">err</span>&nbsp;<span class="op" id="5913914">=</span>&nbsp;<span class="ident" id="5913916">io</span><span class="op" id="5913918">.</span><span class="ident" id="5913919">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913926">return</span>&nbsp;<span class="num" id="5913933">0</span><span class="op" id="5913934">,</span>&nbsp;<span class="ident" id="5913936">b</span><span class="op" id="5913937">.</span><span class="ident" id="5913938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913944">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913948">b</span><span class="op" id="5913949">.</span><span class="ident" id="5913950">slice</span>&nbsp;<span class="op" id="5913956">=</span>&nbsp;<span class="ident" id="5913958">b</span><span class="op" id="5913959">.</span><span class="ident" id="5913960">tmp</span><span class="op" id="5913963">[</span><span class="num" id="5913964">0</span><span class="op" id="5913965">:</span><span class="ident" id="5913966">blockLen</span><span class="op" id="5913974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913978">if</span>&nbsp;<span class="ident" id="5913981">_</span><span class="op" id="5913982">,</span>&nbsp;<span class="ident" id="5913984">b</span><span class="op" id="5913985">.</span><span class="ident" id="5913986">err</span>&nbsp;<span class="op" id="5913990">=</span>&nbsp;<span class="ident" id="5913992">io</span><span class="op" id="5913994">.</span><span class="ident" id="5913995">ReadFull</span><span class="op" id="5914003">(</span><span class="ident" id="5914004">b</span><span class="op" id="5914005">.</span><span class="ident" id="5914006">r</span><span class="op" id="5914007">,</span>&nbsp;<span class="ident" id="5914009">b</span><span class="op" id="5914010">.</span><span class="ident" id="5914011">slice</span><span class="op" id="5914016">)</span><span class="op" id="5914017">;</span>&nbsp;<span class="ident" id="5914019">b</span><span class="op" id="5914020">.</span><span class="ident" id="5914021">err</span>&nbsp;<span class="op" id="5914025">!=</span>&nbsp;<span class="ident" id="5914028">nil</span>&nbsp;<span class="op" id="5914032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914037">return</span>&nbsp;<span class="num" id="5914044">0</span><span class="op" id="5914045">,</span>&nbsp;<span class="ident" id="5914047">b</span><span class="op" id="5914048">.</span><span class="ident" id="5914049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914058">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914061">n</span>&nbsp;<span class="op" id="5914063">:=</span>&nbsp;<span class="builtinfunc" id="5914066">copy</span><span class="op" id="5914070">(</span><span class="ident" id="5914071">p</span><span class="op" id="5914072">,</span>&nbsp;<span class="ident" id="5914074">b</span><span class="op" id="5914075">.</span><span class="ident" id="5914076">slice</span><span class="op" id="5914081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914084">b</span><span class="op" id="5914085">.</span><span class="ident" id="5914086">slice</span>&nbsp;<span class="op" id="5914092">=</span>&nbsp;<span class="ident" id="5914094">b</span><span class="op" id="5914095">.</span><span class="ident" id="5914096">slice</span><span class="op" id="5914101">[</span><span class="ident" id="5914102">n</span><span class="op" id="5914103">:</span><span class="op" id="5914104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914107">return</span>&nbsp;<span class="ident" id="5914114">n</span><span class="op" id="5914115">,</span>&nbsp;<span class="ident" id="5914117">nil</span><br>
<span class="lineno"></span><span class="op" id="5914121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5914124">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5914187">func</span>&nbsp;<span class="op" id="5914192">(</span><span class="ident" id="5914193">d</span>&nbsp;<span class="op" id="5914195">*</span><span class="ident" id="5914196">decoder</span><span class="op" id="5914203">)</span>&nbsp;<span class="ident" id="5914205">decode</span><span class="op" id="5914211">(</span><span class="ident" id="5914212">r</span>&nbsp;<span class="ident" id="5914214">io</span><span class="op" id="5914216">.</span><span class="ident" id="5914217">Reader</span><span class="op" id="5914223">,</span>&nbsp;<span class="ident" id="5914225">configOnly</span>&nbsp;<span class="builtintype" id="5914236">bool</span><span class="op" id="5914240">)</span>&nbsp;<span class="builtintype" id="5914242">error</span>&nbsp;<span class="op" id="5914248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914251">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914301">if</span>&nbsp;<span class="ident" id="5914304">rr</span><span class="op" id="5914306">,</span>&nbsp;<span class="ident" id="5914308">ok</span>&nbsp;<span class="op" id="5914311">:=</span>&nbsp;<span class="ident" id="5914314">r</span><span class="op" id="5914315">.</span><span class="op" id="5914316">(</span><span class="ident" id="5914317">reader</span><span class="op" id="5914323">)</span><span class="op" id="5914324">;</span>&nbsp;<span class="ident" id="5914326">ok</span>&nbsp;<span class="op" id="5914329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914333">d</span><span class="op" id="5914334">.</span><span class="ident" id="5914335">r</span>&nbsp;<span class="op" id="5914337">=</span>&nbsp;<span class="ident" id="5914339">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914343">}</span>&nbsp;<span class="keyword" id="5914345">else</span>&nbsp;<span class="op" id="5914350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914354">d</span><span class="op" id="5914355">.</span><span class="ident" id="5914356">r</span>&nbsp;<span class="op" id="5914358">=</span>&nbsp;<span class="ident" id="5914360">bufio</span><span class="op" id="5914365">.</span><span class="ident" id="5914366">NewReader</span><span class="op" id="5914375">(</span><span class="ident" id="5914376">r</span><span class="op" id="5914377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914384">err</span>&nbsp;<span class="op" id="5914388">:=</span>&nbsp;<span class="ident" id="5914391">d</span><span class="op" id="5914392">.</span><span class="ident" id="5914393">readHeaderAndScreenDescriptor</span><span class="op" id="5914422">(</span><span class="op" id="5914423">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914426">if</span>&nbsp;<span class="ident" id="5914429">err</span>&nbsp;<span class="op" id="5914433">!=</span>&nbsp;<span class="ident" id="5914436">nil</span>&nbsp;<span class="op" id="5914440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914444">return</span>&nbsp;<span class="ident" id="5914451">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914459">if</span>&nbsp;<span class="ident" id="5914462">configOnly</span>&nbsp;<span class="op" id="5914473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914477">return</span>&nbsp;<span class="ident" id="5914484">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914493">if</span>&nbsp;<span class="ident" id="5914496">d</span><span class="op" id="5914497">.</span><span class="ident" id="5914498">headerFields</span><span class="op" id="5914510">&amp;</span><span class="ident" id="5914511">fColorMapFollows</span>&nbsp;<span class="op" id="5914528">!=</span>&nbsp;<span class="num" id="5914531">0</span>&nbsp;<span class="op" id="5914533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914537">if</span>&nbsp;<span class="ident" id="5914540">d</span><span class="op" id="5914541">.</span><span class="ident" id="5914542">globalColorMap</span><span class="op" id="5914556">,</span>&nbsp;<span class="ident" id="5914558">err</span>&nbsp;<span class="op" id="5914562">=</span>&nbsp;<span class="ident" id="5914564">d</span><span class="op" id="5914565">.</span><span class="ident" id="5914566">readColorMap</span><span class="op" id="5914578">(</span><span class="op" id="5914579">)</span><span class="op" id="5914580">;</span>&nbsp;<span class="ident" id="5914582">err</span>&nbsp;<span class="op" id="5914586">!=</span>&nbsp;<span class="ident" id="5914589">nil</span>&nbsp;<span class="op" id="5914593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914598">return</span>&nbsp;<span class="ident" id="5914605">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914618">for</span>&nbsp;<span class="op" id="5914622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914626">c</span><span class="op" id="5914627">,</span>&nbsp;<span class="ident" id="5914629">err</span>&nbsp;<span class="op" id="5914633">:=</span>&nbsp;<span class="ident" id="5914636">d</span><span class="op" id="5914637">.</span><span class="ident" id="5914638">r</span><span class="op" id="5914639">.</span><span class="ident" id="5914640">ReadByte</span><span class="op" id="5914648">(</span><span class="op" id="5914649">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914653">if</span>&nbsp;<span class="ident" id="5914656">err</span>&nbsp;<span class="op" id="5914660">!=</span>&nbsp;<span class="ident" id="5914663">nil</span>&nbsp;<span class="op" id="5914667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914672">return</span>&nbsp;<span class="ident" id="5914679">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914689">switch</span>&nbsp;<span class="ident" id="5914696">c</span>&nbsp;<span class="op" id="5914698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914702">case</span>&nbsp;<span class="ident" id="5914707">sExtension</span><span class="op" id="5914717">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914722">if</span>&nbsp;<span class="ident" id="5914725">err</span>&nbsp;<span class="op" id="5914729">=</span>&nbsp;<span class="ident" id="5914731">d</span><span class="op" id="5914732">.</span><span class="ident" id="5914733">readExtension</span><span class="op" id="5914746">(</span><span class="op" id="5914747">)</span><span class="op" id="5914748">;</span>&nbsp;<span class="ident" id="5914750">err</span>&nbsp;<span class="op" id="5914754">!=</span>&nbsp;<span class="ident" id="5914757">nil</span>&nbsp;<span class="op" id="5914761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914767">return</span>&nbsp;<span class="ident" id="5914774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914786">case</span>&nbsp;<span class="ident" id="5914791">sImageDescriptor</span><span class="op" id="5914807">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914812">m</span><span class="op" id="5914813">,</span>&nbsp;<span class="ident" id="5914815">err</span>&nbsp;<span class="op" id="5914819">:=</span>&nbsp;<span class="ident" id="5914822">d</span><span class="op" id="5914823">.</span><span class="ident" id="5914824">newImageFromDescriptor</span><span class="op" id="5914846">(</span><span class="op" id="5914847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914852">if</span>&nbsp;<span class="ident" id="5914855">err</span>&nbsp;<span class="op" id="5914859">!=</span>&nbsp;<span class="ident" id="5914862">nil</span>&nbsp;<span class="op" id="5914866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914872">return</span>&nbsp;<span class="ident" id="5914879">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914891">useLocalColorMap</span>&nbsp;<span class="op" id="5914908">:=</span>&nbsp;<span class="ident" id="5914911">d</span><span class="op" id="5914912">.</span><span class="ident" id="5914913">imageFields</span><span class="op" id="5914924">&amp;</span><span class="ident" id="5914925">fColorMapFollows</span>&nbsp;<span class="op" id="5914942">!=</span>&nbsp;<span class="num" id="5914945">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914950">if</span>&nbsp;<span class="ident" id="5914953">useLocalColorMap</span>&nbsp;<span class="op" id="5914970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914976">m</span><span class="op" id="5914977">.</span><span class="ident" id="5914978">Palette</span><span class="op" id="5914985">,</span>&nbsp;<span class="ident" id="5914987">err</span>&nbsp;<span class="op" id="5914991">=</span>&nbsp;<span class="ident" id="5914993">d</span><span class="op" id="5914994">.</span><span class="ident" id="5914995">readColorMap</span><span class="op" id="5915007">(</span><span class="op" id="5915008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915014">if</span>&nbsp;<span class="ident" id="5915017">err</span>&nbsp;<span class="op" id="5915021">!=</span>&nbsp;<span class="ident" id="5915024">nil</span>&nbsp;<span class="op" id="5915028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915035">return</span>&nbsp;<span class="ident" id="5915042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915050">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915055">}</span>&nbsp;<span class="keyword" id="5915057">else</span>&nbsp;<span class="op" id="5915062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915068">m</span><span class="op" id="5915069">.</span><span class="ident" id="5915070">Palette</span>&nbsp;<span class="op" id="5915078">=</span>&nbsp;<span class="ident" id="5915080">d</span><span class="op" id="5915081">.</span><span class="ident" id="5915082">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915105">if</span>&nbsp;<span class="ident" id="5915108">d</span><span class="op" id="5915109">.</span><span class="ident" id="5915110">hasTransparentIndex</span>&nbsp;<span class="op" id="5915130">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5915133">int</span><span class="op" id="5915136">(</span><span class="ident" id="5915137">d</span><span class="op" id="5915138">.</span><span class="ident" id="5915139">transparentIndex</span><span class="op" id="5915155">)</span>&nbsp;<span class="op" id="5915157">&lt;</span>&nbsp;<span class="builtinfunc" id="5915159">len</span><span class="op" id="5915162">(</span><span class="ident" id="5915163">m</span><span class="op" id="5915164">.</span><span class="ident" id="5915165">Palette</span><span class="op" id="5915172">)</span>&nbsp;<span class="op" id="5915174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915180">if</span>&nbsp;<span class="op" id="5915183">!</span><span class="ident" id="5915184">useLocalColorMap</span>&nbsp;<span class="op" id="5915201">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915208">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915244">m</span><span class="op" id="5915245">.</span><span class="ident" id="5915246">Palette</span>&nbsp;<span class="op" id="5915254">=</span>&nbsp;<span class="builtinfunc" id="5915256">append</span><span class="op" id="5915262">(</span><span class="ident" id="5915263">color</span><span class="op" id="5915268">.</span><span class="ident" id="5915269">Palette</span><span class="op" id="5915276">(</span><span class="ident" id="5915277">nil</span><span class="op" id="5915280">)</span><span class="op" id="5915281">,</span>&nbsp;<span class="ident" id="5915283">d</span><span class="op" id="5915284">.</span><span class="ident" id="5915285">globalColorMap</span><span class="op" id="5915299">...</span><span class="op" id="5915302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915314">m</span><span class="op" id="5915315">.</span><span class="ident" id="5915316">Palette</span><span class="op" id="5915323">[</span><span class="ident" id="5915324">d</span><span class="op" id="5915325">.</span><span class="ident" id="5915326">transparentIndex</span><span class="op" id="5915342">]</span>&nbsp;<span class="op" id="5915344">=</span>&nbsp;<span class="ident" id="5915346">color</span><span class="op" id="5915351">.</span><span class="ident" id="5915352">RGBA</span><span class="op" id="5915356">{</span><span class="op" id="5915357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915362">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915367">litWidth</span><span class="op" id="5915375">,</span>&nbsp;<span class="ident" id="5915377">err</span>&nbsp;<span class="op" id="5915381">:=</span>&nbsp;<span class="ident" id="5915384">d</span><span class="op" id="5915385">.</span><span class="ident" id="5915386">r</span><span class="op" id="5915387">.</span><span class="ident" id="5915388">ReadByte</span><span class="op" id="5915396">(</span><span class="op" id="5915397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915402">if</span>&nbsp;<span class="ident" id="5915405">err</span>&nbsp;<span class="op" id="5915409">!=</span>&nbsp;<span class="ident" id="5915412">nil</span>&nbsp;<span class="op" id="5915416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915422">return</span>&nbsp;<span class="ident" id="5915429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915441">if</span>&nbsp;<span class="ident" id="5915444">litWidth</span>&nbsp;<span class="op" id="5915453">&lt;</span>&nbsp;<span class="num" id="5915455">2</span>&nbsp;<span class="op" id="5915457">||</span>&nbsp;<span class="ident" id="5915460">litWidth</span>&nbsp;<span class="op" id="5915469">&gt;</span>&nbsp;<span class="num" id="5915471">8</span>&nbsp;<span class="op" id="5915473">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915479">return</span>&nbsp;<span class="ident" id="5915486">fmt</span><span class="op" id="5915489">.</span><span class="ident" id="5915490">Errorf</span><span class="op" id="5915496">(</span><span class="string" id="5915497">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="5915541">,</span>&nbsp;<span class="ident" id="5915543">litWidth</span><span class="op" id="5915551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915561">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915605">br</span>&nbsp;<span class="op" id="5915608">:=</span>&nbsp;<span class="op" id="5915611">&amp;</span><span class="ident" id="5915612">blockReader</span><span class="op" id="5915623">{</span><span class="ident" id="5915624">r</span><span class="op" id="5915625">:</span>&nbsp;<span class="ident" id="5915627">d</span><span class="op" id="5915628">.</span><span class="ident" id="5915629">r</span><span class="op" id="5915630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915635">lzwr</span>&nbsp;<span class="op" id="5915640">:=</span>&nbsp;<span class="ident" id="5915643">lzw</span><span class="op" id="5915646">.</span><span class="ident" id="5915647">NewReader</span><span class="op" id="5915656">(</span><span class="ident" id="5915657">br</span><span class="op" id="5915659">,</span>&nbsp;<span class="ident" id="5915661">lzw</span><span class="op" id="5915664">.</span><span class="ident" id="5915665">LSB</span><span class="op" id="5915668">,</span>&nbsp;<span class="builtintype" id="5915670">int</span><span class="op" id="5915673">(</span><span class="ident" id="5915674">litWidth</span><span class="op" id="5915682">)</span><span class="op" id="5915683">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915688">defer</span>&nbsp;<span class="ident" id="5915694">lzwr</span><span class="op" id="5915698">.</span><span class="ident" id="5915699">Close</span><span class="op" id="5915704">(</span><span class="op" id="5915705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915710">if</span>&nbsp;<span class="ident" id="5915713">_</span><span class="op" id="5915714">,</span>&nbsp;<span class="ident" id="5915716">err</span>&nbsp;<span class="op" id="5915720">=</span>&nbsp;<span class="ident" id="5915722">io</span><span class="op" id="5915724">.</span><span class="ident" id="5915725">ReadFull</span><span class="op" id="5915733">(</span><span class="ident" id="5915734">lzwr</span><span class="op" id="5915738">,</span>&nbsp;<span class="ident" id="5915740">m</span><span class="op" id="5915741">.</span><span class="ident" id="5915742">Pix</span><span class="op" id="5915745">)</span><span class="op" id="5915746">;</span>&nbsp;<span class="ident" id="5915748">err</span>&nbsp;<span class="op" id="5915752">!=</span>&nbsp;<span class="ident" id="5915755">nil</span>&nbsp;<span class="op" id="5915759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915765">if</span>&nbsp;<span class="ident" id="5915768">err</span>&nbsp;<span class="op" id="5915772">!=</span>&nbsp;<span class="ident" id="5915775">io</span><span class="op" id="5915777">.</span><span class="ident" id="5915778">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5915795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915802">return</span>&nbsp;<span class="ident" id="5915809">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915817">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915823">return</span>&nbsp;<span class="ident" id="5915830">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915851">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915913">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915945">if</span>&nbsp;<span class="ident" id="5915948">n</span><span class="op" id="5915949">,</span>&nbsp;<span class="ident" id="5915951">err</span>&nbsp;<span class="op" id="5915955">:=</span>&nbsp;<span class="ident" id="5915958">lzwr</span><span class="op" id="5915962">.</span><span class="ident" id="5915963">Read</span><span class="op" id="5915967">(</span><span class="ident" id="5915968">d</span><span class="op" id="5915969">.</span><span class="ident" id="5915970">tmp</span><span class="op" id="5915973">[</span><span class="op" id="5915974">:</span><span class="num" id="5915975">1</span><span class="op" id="5915976">]</span><span class="op" id="5915977">)</span><span class="op" id="5915978">;</span>&nbsp;<span class="ident" id="5915980">n</span>&nbsp;<span class="op" id="5915982">!=</span>&nbsp;<span class="num" id="5915985">0</span>&nbsp;<span class="op" id="5915987">||</span>&nbsp;<span class="ident" id="5915990">err</span>&nbsp;<span class="op" id="5915994">!=</span>&nbsp;<span class="ident" id="5915997">io</span><span class="op" id="5915999">.</span><span class="ident" id="5916000">EOF</span>&nbsp;<span class="op" id="5916004">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916010">if</span>&nbsp;<span class="ident" id="5916013">err</span>&nbsp;<span class="op" id="5916017">!=</span>&nbsp;<span class="ident" id="5916020">nil</span>&nbsp;<span class="op" id="5916024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916031">return</span>&nbsp;<span class="ident" id="5916038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916052">return</span>&nbsp;<span class="ident" id="5916059">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916073">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916078">if</span>&nbsp;<span class="ident" id="5916081">n</span><span class="op" id="5916082">,</span>&nbsp;<span class="ident" id="5916084">err</span>&nbsp;<span class="op" id="5916088">:=</span>&nbsp;<span class="ident" id="5916091">br</span><span class="op" id="5916093">.</span><span class="ident" id="5916094">Read</span><span class="op" id="5916098">(</span><span class="ident" id="5916099">d</span><span class="op" id="5916100">.</span><span class="ident" id="5916101">tmp</span><span class="op" id="5916104">[</span><span class="op" id="5916105">:</span><span class="num" id="5916106">1</span><span class="op" id="5916107">]</span><span class="op" id="5916108">)</span><span class="op" id="5916109">;</span>&nbsp;<span class="ident" id="5916111">n</span>&nbsp;<span class="op" id="5916113">!=</span>&nbsp;<span class="num" id="5916116">0</span>&nbsp;<span class="op" id="5916118">||</span>&nbsp;<span class="ident" id="5916121">err</span>&nbsp;<span class="op" id="5916125">!=</span>&nbsp;<span class="ident" id="5916128">io</span><span class="op" id="5916130">.</span><span class="ident" id="5916131">EOF</span>&nbsp;<span class="op" id="5916135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916141">if</span>&nbsp;<span class="ident" id="5916144">err</span>&nbsp;<span class="op" id="5916148">!=</span>&nbsp;<span class="ident" id="5916151">nil</span>&nbsp;<span class="op" id="5916155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916162">return</span>&nbsp;<span class="ident" id="5916169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916183">return</span>&nbsp;<span class="ident" id="5916190">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916210">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916269">if</span>&nbsp;<span class="builtinfunc" id="5916272">len</span><span class="op" id="5916275">(</span><span class="ident" id="5916276">m</span><span class="op" id="5916277">.</span><span class="ident" id="5916278">Palette</span><span class="op" id="5916285">)</span>&nbsp;<span class="op" id="5916287">&lt;</span>&nbsp;<span class="num" id="5916289">256</span>&nbsp;<span class="op" id="5916293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916299">for</span>&nbsp;<span class="ident" id="5916303">_</span><span class="op" id="5916304">,</span>&nbsp;<span class="ident" id="5916306">pixel</span>&nbsp;<span class="op" id="5916312">:=</span>&nbsp;<span class="keyword" id="5916315">range</span>&nbsp;<span class="ident" id="5916321">m</span><span class="op" id="5916322">.</span><span class="ident" id="5916323">Pix</span>&nbsp;<span class="op" id="5916327">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916334">if</span>&nbsp;<span class="builtintype" id="5916337">int</span><span class="op" id="5916340">(</span><span class="ident" id="5916341">pixel</span><span class="op" id="5916346">)</span>&nbsp;<span class="op" id="5916348">&gt;=</span>&nbsp;<span class="builtinfunc" id="5916351">len</span><span class="op" id="5916354">(</span><span class="ident" id="5916355">m</span><span class="op" id="5916356">.</span><span class="ident" id="5916357">Palette</span><span class="op" id="5916364">)</span>&nbsp;<span class="op" id="5916366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916374">return</span>&nbsp;<span class="ident" id="5916381">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916409">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916415">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916456">if</span>&nbsp;<span class="ident" id="5916459">d</span><span class="op" id="5916460">.</span><span class="ident" id="5916461">imageFields</span><span class="op" id="5916472">&amp;</span><span class="ident" id="5916473">ifInterlace</span>&nbsp;<span class="op" id="5916485">!=</span>&nbsp;<span class="num" id="5916488">0</span>&nbsp;<span class="op" id="5916490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916496">uninterlace</span><span class="op" id="5916507">(</span><span class="ident" id="5916508">m</span><span class="op" id="5916509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916514">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916520">d</span><span class="op" id="5916521">.</span><span class="ident" id="5916522">image</span>&nbsp;<span class="op" id="5916528">=</span>&nbsp;<span class="builtinfunc" id="5916530">append</span><span class="op" id="5916536">(</span><span class="ident" id="5916537">d</span><span class="op" id="5916538">.</span><span class="ident" id="5916539">image</span><span class="op" id="5916544">,</span>&nbsp;<span class="ident" id="5916546">m</span><span class="op" id="5916547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916552">d</span><span class="op" id="5916553">.</span><span class="ident" id="5916554">delay</span>&nbsp;<span class="op" id="5916560">=</span>&nbsp;<span class="builtinfunc" id="5916562">append</span><span class="op" id="5916568">(</span><span class="ident" id="5916569">d</span><span class="op" id="5916570">.</span><span class="ident" id="5916571">delay</span><span class="op" id="5916576">,</span>&nbsp;<span class="ident" id="5916578">d</span><span class="op" id="5916579">.</span><span class="ident" id="5916580">delayTime</span><span class="op" id="5916589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916594">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916662">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916734">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916795">d</span><span class="op" id="5916796">.</span><span class="ident" id="5916797">delayTime</span>&nbsp;<span class="op" id="5916807">=</span>&nbsp;<span class="num" id="5916809">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916814">d</span><span class="op" id="5916815">.</span><span class="ident" id="5916816">hasTransparentIndex</span>&nbsp;<span class="op" id="5916836">=</span>&nbsp;<span class="builtintype" id="5916838">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916847">case</span>&nbsp;<span class="ident" id="5916852">sTrailer</span><span class="op" id="5916860">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916865">if</span>&nbsp;<span class="builtinfunc" id="5916868">len</span><span class="op" id="5916871">(</span><span class="ident" id="5916872">d</span><span class="op" id="5916873">.</span><span class="ident" id="5916874">image</span><span class="op" id="5916879">)</span>&nbsp;<span class="op" id="5916881">==</span>&nbsp;<span class="num" id="5916884">0</span>&nbsp;<span class="op" id="5916886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916892">return</span>&nbsp;<span class="ident" id="5916899">io</span><span class="op" id="5916901">.</span><span class="ident" id="5916902">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916927">return</span>&nbsp;<span class="ident" id="5916934">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916941">default</span><span class="op" id="5916948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916953">return</span>&nbsp;<span class="ident" id="5916960">fmt</span><span class="op" id="5916963">.</span><span class="ident" id="5916964">Errorf</span><span class="op" id="5916970">(</span><span class="string" id="5916971">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="5917004">,</span>&nbsp;<span class="ident" id="5917006">c</span><span class="op" id="5917007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917014">}</span><br>
<span class="lineno"></span><span class="op" id="5917016">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5917019">func</span>&nbsp;<span class="op" id="5917024">(</span><span class="ident" id="5917025">d</span>&nbsp;<span class="op" id="5917027">*</span><span class="ident" id="5917028">decoder</span><span class="op" id="5917035">)</span>&nbsp;<span class="ident" id="5917037">readHeaderAndScreenDescriptor</span><span class="op" id="5917066">(</span><span class="op" id="5917067">)</span>&nbsp;<span class="builtintype" id="5917069">error</span>&nbsp;<span class="op" id="5917075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917078">_</span><span class="op" id="5917079">,</span>&nbsp;<span class="ident" id="5917081">err</span>&nbsp;<span class="op" id="5917085">:=</span>&nbsp;<span class="ident" id="5917088">io</span><span class="op" id="5917090">.</span><span class="ident" id="5917091">ReadFull</span><span class="op" id="5917099">(</span><span class="ident" id="5917100">d</span><span class="op" id="5917101">.</span><span class="ident" id="5917102">r</span><span class="op" id="5917103">,</span>&nbsp;<span class="ident" id="5917105">d</span><span class="op" id="5917106">.</span><span class="ident" id="5917107">tmp</span><span class="op" id="5917110">[</span><span class="num" id="5917111">0</span><span class="op" id="5917112">:</span><span class="num" id="5917113">13</span><span class="op" id="5917115">]</span><span class="op" id="5917116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917119">if</span>&nbsp;<span class="ident" id="5917122">err</span>&nbsp;<span class="op" id="5917126">!=</span>&nbsp;<span class="ident" id="5917129">nil</span>&nbsp;<span class="op" id="5917133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917137">return</span>&nbsp;<span class="ident" id="5917144">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917152">d</span><span class="op" id="5917153">.</span><span class="ident" id="5917154">vers</span>&nbsp;<span class="op" id="5917159">=</span>&nbsp;<span class="builtintype" id="5917161">string</span><span class="op" id="5917167">(</span><span class="ident" id="5917168">d</span><span class="op" id="5917169">.</span><span class="ident" id="5917170">tmp</span><span class="op" id="5917173">[</span><span class="num" id="5917174">0</span><span class="op" id="5917175">:</span><span class="num" id="5917176">6</span><span class="op" id="5917177">]</span><span class="op" id="5917178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917181">if</span>&nbsp;<span class="ident" id="5917184">d</span><span class="op" id="5917185">.</span><span class="ident" id="5917186">vers</span>&nbsp;<span class="op" id="5917191">!=</span>&nbsp;<span class="string" id="5917194">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="5917203">&amp;&amp;</span>&nbsp;<span class="ident" id="5917206">d</span><span class="op" id="5917207">.</span><span class="ident" id="5917208">vers</span>&nbsp;<span class="op" id="5917213">!=</span>&nbsp;<span class="string" id="5917216">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="5917225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917229">return</span>&nbsp;<span class="ident" id="5917236">fmt</span><span class="op" id="5917239">.</span><span class="ident" id="5917240">Errorf</span><span class="op" id="5917246">(</span><span class="string" id="5917247">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="5917279">,</span>&nbsp;<span class="ident" id="5917281">d</span><span class="op" id="5917282">.</span><span class="ident" id="5917283">vers</span><span class="op" id="5917287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917290">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917293">d</span><span class="op" id="5917294">.</span><span class="ident" id="5917295">width</span>&nbsp;<span class="op" id="5917301">=</span>&nbsp;<span class="builtintype" id="5917303">int</span><span class="op" id="5917306">(</span><span class="ident" id="5917307">d</span><span class="op" id="5917308">.</span><span class="ident" id="5917309">tmp</span><span class="op" id="5917312">[</span><span class="num" id="5917313">6</span><span class="op" id="5917314">]</span><span class="op" id="5917315">)</span>&nbsp;<span class="op" id="5917317">+</span>&nbsp;<span class="builtintype" id="5917319">int</span><span class="op" id="5917322">(</span><span class="ident" id="5917323">d</span><span class="op" id="5917324">.</span><span class="ident" id="5917325">tmp</span><span class="op" id="5917328">[</span><span class="num" id="5917329">7</span><span class="op" id="5917330">]</span><span class="op" id="5917331">)</span><span class="op" id="5917332">&lt;&lt;</span><span class="num" id="5917334">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917337">d</span><span class="op" id="5917338">.</span><span class="ident" id="5917339">height</span>&nbsp;<span class="op" id="5917346">=</span>&nbsp;<span class="builtintype" id="5917348">int</span><span class="op" id="5917351">(</span><span class="ident" id="5917352">d</span><span class="op" id="5917353">.</span><span class="ident" id="5917354">tmp</span><span class="op" id="5917357">[</span><span class="num" id="5917358">8</span><span class="op" id="5917359">]</span><span class="op" id="5917360">)</span>&nbsp;<span class="op" id="5917362">+</span>&nbsp;<span class="builtintype" id="5917364">int</span><span class="op" id="5917367">(</span><span class="ident" id="5917368">d</span><span class="op" id="5917369">.</span><span class="ident" id="5917370">tmp</span><span class="op" id="5917373">[</span><span class="num" id="5917374">9</span><span class="op" id="5917375">]</span><span class="op" id="5917376">)</span><span class="op" id="5917377">&lt;&lt;</span><span class="num" id="5917379">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917382">d</span><span class="op" id="5917383">.</span><span class="ident" id="5917384">headerFields</span>&nbsp;<span class="op" id="5917397">=</span>&nbsp;<span class="ident" id="5917399">d</span><span class="op" id="5917400">.</span><span class="ident" id="5917401">tmp</span><span class="op" id="5917404">[</span><span class="num" id="5917405">10</span><span class="op" id="5917407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917410">d</span><span class="op" id="5917411">.</span><span class="ident" id="5917412">backgroundIndex</span>&nbsp;<span class="op" id="5917428">=</span>&nbsp;<span class="ident" id="5917430">d</span><span class="op" id="5917431">.</span><span class="ident" id="5917432">tmp</span><span class="op" id="5917435">[</span><span class="num" id="5917436">11</span><span class="op" id="5917438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917441">d</span><span class="op" id="5917442">.</span><span class="ident" id="5917443">aspect</span>&nbsp;<span class="op" id="5917450">=</span>&nbsp;<span class="ident" id="5917452">d</span><span class="op" id="5917453">.</span><span class="ident" id="5917454">tmp</span><span class="op" id="5917457">[</span><span class="num" id="5917458">12</span><span class="op" id="5917460">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917463">d</span><span class="op" id="5917464">.</span><span class="ident" id="5917465">loopCount</span>&nbsp;<span class="op" id="5917475">=</span>&nbsp;<span class="op" id="5917477">-</span><span class="num" id="5917478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917481">d</span><span class="op" id="5917482">.</span><span class="ident" id="5917483">pixelSize</span>&nbsp;<span class="op" id="5917493">=</span>&nbsp;<span class="builtintype" id="5917495">uint</span><span class="op" id="5917499">(</span><span class="ident" id="5917500">d</span><span class="op" id="5917501">.</span><span class="ident" id="5917502">headerFields</span><span class="op" id="5917514">&amp;</span><span class="num" id="5917515">7</span><span class="op" id="5917516">)</span>&nbsp;<span class="op" id="5917518">+</span>&nbsp;<span class="num" id="5917520">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917523">return</span>&nbsp;<span class="ident" id="5917530">nil</span><br>
<span class="lineno"></span><span class="op" id="5917534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5917537">func</span>&nbsp;<span class="op" id="5917542">(</span><span class="ident" id="5917543">d</span>&nbsp;<span class="op" id="5917545">*</span><span class="ident" id="5917546">decoder</span><span class="op" id="5917553">)</span>&nbsp;<span class="ident" id="5917555">readColorMap</span><span class="op" id="5917567">(</span><span class="op" id="5917568">)</span>&nbsp;<span class="op" id="5917570">(</span><span class="ident" id="5917571">color</span><span class="op" id="5917576">.</span><span class="ident" id="5917577">Palette</span><span class="op" id="5917584">,</span>&nbsp;<span class="builtintype" id="5917586">error</span><span class="op" id="5917591">)</span>&nbsp;<span class="op" id="5917593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917596">if</span>&nbsp;<span class="ident" id="5917599">d</span><span class="op" id="5917600">.</span><span class="ident" id="5917601">pixelSize</span>&nbsp;<span class="op" id="5917611">&gt;</span>&nbsp;<span class="num" id="5917613">8</span>&nbsp;<span class="op" id="5917615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917619">return</span>&nbsp;<span class="ident" id="5917626">nil</span><span class="op" id="5917629">,</span>&nbsp;<span class="ident" id="5917631">fmt</span><span class="op" id="5917634">.</span><span class="ident" id="5917635">Errorf</span><span class="op" id="5917641">(</span><span class="string" id="5917642">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="5917679">,</span>&nbsp;<span class="ident" id="5917681">d</span><span class="op" id="5917682">.</span><span class="ident" id="5917683">pixelSize</span><span class="op" id="5917692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917698">numColors</span>&nbsp;<span class="op" id="5917708">:=</span>&nbsp;<span class="num" id="5917711">1</span>&nbsp;<span class="op" id="5917713">&lt;&lt;</span>&nbsp;<span class="ident" id="5917716">d</span><span class="op" id="5917717">.</span><span class="ident" id="5917718">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917729">if</span>&nbsp;<span class="ident" id="5917732">d</span><span class="op" id="5917733">.</span><span class="ident" id="5917734">imageFields</span><span class="op" id="5917745">&amp;</span><span class="ident" id="5917746">ifLocalColorTable</span>&nbsp;<span class="op" id="5917764">!=</span>&nbsp;<span class="num" id="5917767">0</span>&nbsp;<span class="op" id="5917769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917773">numColors</span>&nbsp;<span class="op" id="5917783">=</span>&nbsp;<span class="num" id="5917785">1</span>&nbsp;<span class="op" id="5917787">&lt;&lt;</span>&nbsp;<span class="op" id="5917790">(</span><span class="op" id="5917791">(</span><span class="ident" id="5917792">d</span><span class="op" id="5917793">.</span><span class="ident" id="5917794">imageFields</span>&nbsp;<span class="op" id="5917806">&amp;</span>&nbsp;<span class="ident" id="5917808">ifPixelSizeMask</span><span class="op" id="5917823">)</span>&nbsp;<span class="op" id="5917825">+</span>&nbsp;<span class="num" id="5917827">1</span><span class="op" id="5917828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917834">numValues</span>&nbsp;<span class="op" id="5917844">:=</span>&nbsp;<span class="num" id="5917847">3</span>&nbsp;<span class="op" id="5917849">*</span>&nbsp;<span class="ident" id="5917851">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917862">_</span><span class="op" id="5917863">,</span>&nbsp;<span class="ident" id="5917865">err</span>&nbsp;<span class="op" id="5917869">:=</span>&nbsp;<span class="ident" id="5917872">io</span><span class="op" id="5917874">.</span><span class="ident" id="5917875">ReadFull</span><span class="op" id="5917883">(</span><span class="ident" id="5917884">d</span><span class="op" id="5917885">.</span><span class="ident" id="5917886">r</span><span class="op" id="5917887">,</span>&nbsp;<span class="ident" id="5917889">d</span><span class="op" id="5917890">.</span><span class="ident" id="5917891">tmp</span><span class="op" id="5917894">[</span><span class="num" id="5917895">0</span><span class="op" id="5917896">:</span><span class="ident" id="5917897">numValues</span><span class="op" id="5917906">]</span><span class="op" id="5917907">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917910">if</span>&nbsp;<span class="ident" id="5917913">err</span>&nbsp;<span class="op" id="5917917">!=</span>&nbsp;<span class="ident" id="5917920">nil</span>&nbsp;<span class="op" id="5917924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917928">return</span>&nbsp;<span class="ident" id="5917935">nil</span><span class="op" id="5917938">,</span>&nbsp;<span class="ident" id="5917940">fmt</span><span class="op" id="5917943">.</span><span class="ident" id="5917944">Errorf</span><span class="op" id="5917950">(</span><span class="string" id="5917951">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="5917985">,</span>&nbsp;<span class="ident" id="5917987">err</span><span class="op" id="5917990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917996">colorMap</span>&nbsp;<span class="op" id="5918005">:=</span>&nbsp;<span class="builtinfunc" id="5918008">make</span><span class="op" id="5918012">(</span><span class="ident" id="5918013">color</span><span class="op" id="5918018">.</span><span class="ident" id="5918019">Palette</span><span class="op" id="5918026">,</span>&nbsp;<span class="ident" id="5918028">numColors</span><span class="op" id="5918037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918040">j</span>&nbsp;<span class="op" id="5918042">:=</span>&nbsp;<span class="num" id="5918045">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918048">for</span>&nbsp;<span class="ident" id="5918052">i</span>&nbsp;<span class="op" id="5918054">:=</span>&nbsp;<span class="keyword" id="5918057">range</span>&nbsp;<span class="ident" id="5918063">colorMap</span>&nbsp;<span class="op" id="5918072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918076">colorMap</span><span class="op" id="5918084">[</span><span class="ident" id="5918085">i</span><span class="op" id="5918086">]</span>&nbsp;<span class="op" id="5918088">=</span>&nbsp;<span class="ident" id="5918090">color</span><span class="op" id="5918095">.</span><span class="ident" id="5918096">RGBA</span><span class="op" id="5918100">{</span><span class="ident" id="5918101">d</span><span class="op" id="5918102">.</span><span class="ident" id="5918103">tmp</span><span class="op" id="5918106">[</span><span class="ident" id="5918107">j</span><span class="op" id="5918108">+</span><span class="num" id="5918109">0</span><span class="op" id="5918110">]</span><span class="op" id="5918111">,</span>&nbsp;<span class="ident" id="5918113">d</span><span class="op" id="5918114">.</span><span class="ident" id="5918115">tmp</span><span class="op" id="5918118">[</span><span class="ident" id="5918119">j</span><span class="op" id="5918120">+</span><span class="num" id="5918121">1</span><span class="op" id="5918122">]</span><span class="op" id="5918123">,</span>&nbsp;<span class="ident" id="5918125">d</span><span class="op" id="5918126">.</span><span class="ident" id="5918127">tmp</span><span class="op" id="5918130">[</span><span class="ident" id="5918131">j</span><span class="op" id="5918132">+</span><span class="num" id="5918133">2</span><span class="op" id="5918134">]</span><span class="op" id="5918135">,</span>&nbsp;<span class="num" id="5918137">0xFF</span><span class="op" id="5918141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918145">j</span>&nbsp;<span class="op" id="5918147">+=</span>&nbsp;<span class="num" id="5918150">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918156">return</span>&nbsp;<span class="ident" id="5918163">colorMap</span><span class="op" id="5918171">,</span>&nbsp;<span class="ident" id="5918173">nil</span><br>
<span class="lineno">295</span><span class="op" id="5918177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5918180">func</span>&nbsp;<span class="op" id="5918185">(</span><span class="ident" id="5918186">d</span>&nbsp;<span class="op" id="5918188">*</span><span class="ident" id="5918189">decoder</span><span class="op" id="5918196">)</span>&nbsp;<span class="ident" id="5918198">readExtension</span><span class="op" id="5918211">(</span><span class="op" id="5918212">)</span>&nbsp;<span class="builtintype" id="5918214">error</span>&nbsp;<span class="op" id="5918220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918223">extension</span><span class="op" id="5918232">,</span>&nbsp;<span class="ident" id="5918234">err</span>&nbsp;<span class="op" id="5918238">:=</span>&nbsp;<span class="ident" id="5918241">d</span><span class="op" id="5918242">.</span><span class="ident" id="5918243">r</span><span class="op" id="5918244">.</span><span class="ident" id="5918245">ReadByte</span><span class="op" id="5918253">(</span><span class="op" id="5918254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918257">if</span>&nbsp;<span class="ident" id="5918260">err</span>&nbsp;<span class="op" id="5918264">!=</span>&nbsp;<span class="ident" id="5918267">nil</span>&nbsp;<span class="op" id="5918271">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918275">return</span>&nbsp;<span class="ident" id="5918282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918290">size</span>&nbsp;<span class="op" id="5918295">:=</span>&nbsp;<span class="num" id="5918298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918301">switch</span>&nbsp;<span class="ident" id="5918308">extension</span>&nbsp;<span class="op" id="5918318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918321">case</span>&nbsp;<span class="ident" id="5918326">eText</span><span class="op" id="5918331">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918335">size</span>&nbsp;<span class="op" id="5918340">=</span>&nbsp;<span class="num" id="5918342">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918346">case</span>&nbsp;<span class="ident" id="5918351">eGraphicControl</span><span class="op" id="5918366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918370">return</span>&nbsp;<span class="ident" id="5918377">d</span><span class="op" id="5918378">.</span><span class="ident" id="5918379">readGraphicControl</span><span class="op" id="5918397">(</span><span class="op" id="5918398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918401">case</span>&nbsp;<span class="ident" id="5918406">eComment</span><span class="op" id="5918414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918418">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918455">case</span>&nbsp;<span class="ident" id="5918460">eApplication</span><span class="op" id="5918472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918476">b</span><span class="op" id="5918477">,</span>&nbsp;<span class="ident" id="5918479">err</span>&nbsp;<span class="op" id="5918483">:=</span>&nbsp;<span class="ident" id="5918486">d</span><span class="op" id="5918487">.</span><span class="ident" id="5918488">r</span><span class="op" id="5918489">.</span><span class="ident" id="5918490">ReadByte</span><span class="op" id="5918498">(</span><span class="op" id="5918499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918503">if</span>&nbsp;<span class="ident" id="5918506">err</span>&nbsp;<span class="op" id="5918510">!=</span>&nbsp;<span class="ident" id="5918513">nil</span>&nbsp;<span class="op" id="5918517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918522">return</span>&nbsp;<span class="ident" id="5918529">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918535">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918539">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918603">size</span>&nbsp;<span class="op" id="5918608">=</span>&nbsp;<span class="builtintype" id="5918610">int</span><span class="op" id="5918613">(</span><span class="ident" id="5918614">b</span><span class="op" id="5918615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918618">default</span><span class="op" id="5918625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918629">return</span>&nbsp;<span class="ident" id="5918636">fmt</span><span class="op" id="5918639">.</span><span class="ident" id="5918640">Errorf</span><span class="op" id="5918646">(</span><span class="string" id="5918647">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="5918678">,</span>&nbsp;<span class="ident" id="5918680">extension</span><span class="op" id="5918689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918692">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918695">if</span>&nbsp;<span class="ident" id="5918698">size</span>&nbsp;<span class="op" id="5918703">&gt;</span>&nbsp;<span class="num" id="5918705">0</span>&nbsp;<span class="op" id="5918707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918711">if</span>&nbsp;<span class="ident" id="5918714">_</span><span class="op" id="5918715">,</span>&nbsp;<span class="ident" id="5918717">err</span>&nbsp;<span class="op" id="5918721">:=</span>&nbsp;<span class="ident" id="5918724">io</span><span class="op" id="5918726">.</span><span class="ident" id="5918727">ReadFull</span><span class="op" id="5918735">(</span><span class="ident" id="5918736">d</span><span class="op" id="5918737">.</span><span class="ident" id="5918738">r</span><span class="op" id="5918739">,</span>&nbsp;<span class="ident" id="5918741">d</span><span class="op" id="5918742">.</span><span class="ident" id="5918743">tmp</span><span class="op" id="5918746">[</span><span class="num" id="5918747">0</span><span class="op" id="5918748">:</span><span class="ident" id="5918749">size</span><span class="op" id="5918753">]</span><span class="op" id="5918754">)</span><span class="op" id="5918755">;</span>&nbsp;<span class="ident" id="5918757">err</span>&nbsp;<span class="op" id="5918761">!=</span>&nbsp;<span class="ident" id="5918764">nil</span>&nbsp;<span class="op" id="5918768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918773">return</span>&nbsp;<span class="ident" id="5918780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918789">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918793">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918868">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918909">if</span>&nbsp;<span class="ident" id="5918912">extension</span>&nbsp;<span class="op" id="5918922">==</span>&nbsp;<span class="ident" id="5918925">eApplication</span>&nbsp;<span class="op" id="5918938">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5918941">string</span><span class="op" id="5918947">(</span><span class="ident" id="5918948">d</span><span class="op" id="5918949">.</span><span class="ident" id="5918950">tmp</span><span class="op" id="5918953">[</span><span class="op" id="5918954">:</span><span class="ident" id="5918955">size</span><span class="op" id="5918959">]</span><span class="op" id="5918960">)</span>&nbsp;<span class="op" id="5918962">==</span>&nbsp;<span class="string" id="5918965">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="5918979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918983">n</span><span class="op" id="5918984">,</span>&nbsp;<span class="ident" id="5918986">err</span>&nbsp;<span class="op" id="5918990">:=</span>&nbsp;<span class="ident" id="5918993">d</span><span class="op" id="5918994">.</span><span class="ident" id="5918995">readBlock</span><span class="op" id="5919004">(</span><span class="op" id="5919005">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919009">if</span>&nbsp;<span class="ident" id="5919012">n</span>&nbsp;<span class="op" id="5919014">==</span>&nbsp;<span class="num" id="5919017">0</span>&nbsp;<span class="op" id="5919019">||</span>&nbsp;<span class="ident" id="5919022">err</span>&nbsp;<span class="op" id="5919026">!=</span>&nbsp;<span class="ident" id="5919029">nil</span>&nbsp;<span class="op" id="5919033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919038">return</span>&nbsp;<span class="ident" id="5919045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919055">if</span>&nbsp;<span class="ident" id="5919058">n</span>&nbsp;<span class="op" id="5919060">==</span>&nbsp;<span class="num" id="5919063">3</span>&nbsp;<span class="op" id="5919065">&amp;&amp;</span>&nbsp;<span class="ident" id="5919068">d</span><span class="op" id="5919069">.</span><span class="ident" id="5919070">tmp</span><span class="op" id="5919073">[</span><span class="num" id="5919074">0</span><span class="op" id="5919075">]</span>&nbsp;<span class="op" id="5919077">==</span>&nbsp;<span class="num" id="5919080">1</span>&nbsp;<span class="op" id="5919082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919087">d</span><span class="op" id="5919088">.</span><span class="ident" id="5919089">loopCount</span>&nbsp;<span class="op" id="5919099">=</span>&nbsp;<span class="builtintype" id="5919101">int</span><span class="op" id="5919104">(</span><span class="ident" id="5919105">d</span><span class="op" id="5919106">.</span><span class="ident" id="5919107">tmp</span><span class="op" id="5919110">[</span><span class="num" id="5919111">1</span><span class="op" id="5919112">]</span><span class="op" id="5919113">)</span>&nbsp;<span class="op" id="5919115">|</span>&nbsp;<span class="builtintype" id="5919117">int</span><span class="op" id="5919120">(</span><span class="ident" id="5919121">d</span><span class="op" id="5919122">.</span><span class="ident" id="5919123">tmp</span><span class="op" id="5919126">[</span><span class="num" id="5919127">2</span><span class="op" id="5919128">]</span><span class="op" id="5919129">)</span><span class="op" id="5919130">&lt;&lt;</span><span class="num" id="5919132">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919142">for</span>&nbsp;<span class="op" id="5919146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919150">n</span><span class="op" id="5919151">,</span>&nbsp;<span class="ident" id="5919153">err</span>&nbsp;<span class="op" id="5919157">:=</span>&nbsp;<span class="ident" id="5919160">d</span><span class="op" id="5919161">.</span><span class="ident" id="5919162">readBlock</span><span class="op" id="5919171">(</span><span class="op" id="5919172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919176">if</span>&nbsp;<span class="ident" id="5919179">n</span>&nbsp;<span class="op" id="5919181">==</span>&nbsp;<span class="num" id="5919184">0</span>&nbsp;<span class="op" id="5919186">||</span>&nbsp;<span class="ident" id="5919189">err</span>&nbsp;<span class="op" id="5919193">!=</span>&nbsp;<span class="ident" id="5919196">nil</span>&nbsp;<span class="op" id="5919200">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919205">return</span>&nbsp;<span class="ident" id="5919212">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919221">}</span><br>
<span class="lineno"></span><span class="op" id="5919223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="5919226">func</span>&nbsp;<span class="op" id="5919231">(</span><span class="ident" id="5919232">d</span>&nbsp;<span class="op" id="5919234">*</span><span class="ident" id="5919235">decoder</span><span class="op" id="5919242">)</span>&nbsp;<span class="ident" id="5919244">readGraphicControl</span><span class="op" id="5919262">(</span><span class="op" id="5919263">)</span>&nbsp;<span class="builtintype" id="5919265">error</span>&nbsp;<span class="op" id="5919271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919274">if</span>&nbsp;<span class="ident" id="5919277">_</span><span class="op" id="5919278">,</span>&nbsp;<span class="ident" id="5919280">err</span>&nbsp;<span class="op" id="5919284">:=</span>&nbsp;<span class="ident" id="5919287">io</span><span class="op" id="5919289">.</span><span class="ident" id="5919290">ReadFull</span><span class="op" id="5919298">(</span><span class="ident" id="5919299">d</span><span class="op" id="5919300">.</span><span class="ident" id="5919301">r</span><span class="op" id="5919302">,</span>&nbsp;<span class="ident" id="5919304">d</span><span class="op" id="5919305">.</span><span class="ident" id="5919306">tmp</span><span class="op" id="5919309">[</span><span class="num" id="5919310">0</span><span class="op" id="5919311">:</span><span class="num" id="5919312">6</span><span class="op" id="5919313">]</span><span class="op" id="5919314">)</span><span class="op" id="5919315">;</span>&nbsp;<span class="ident" id="5919317">err</span>&nbsp;<span class="op" id="5919321">!=</span>&nbsp;<span class="ident" id="5919324">nil</span>&nbsp;<span class="op" id="5919328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919332">return</span>&nbsp;<span class="ident" id="5919339">fmt</span><span class="op" id="5919342">.</span><span class="ident" id="5919343">Errorf</span><span class="op" id="5919349">(</span><span class="string" id="5919350">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="5919387">,</span>&nbsp;<span class="ident" id="5919389">err</span><span class="op" id="5919392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919398">d</span><span class="op" id="5919399">.</span><span class="ident" id="5919400">flags</span>&nbsp;<span class="op" id="5919406">=</span>&nbsp;<span class="ident" id="5919408">d</span><span class="op" id="5919409">.</span><span class="ident" id="5919410">tmp</span><span class="op" id="5919413">[</span><span class="num" id="5919414">1</span><span class="op" id="5919415">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919418">d</span><span class="op" id="5919419">.</span><span class="ident" id="5919420">delayTime</span>&nbsp;<span class="op" id="5919430">=</span>&nbsp;<span class="builtintype" id="5919432">int</span><span class="op" id="5919435">(</span><span class="ident" id="5919436">d</span><span class="op" id="5919437">.</span><span class="ident" id="5919438">tmp</span><span class="op" id="5919441">[</span><span class="num" id="5919442">2</span><span class="op" id="5919443">]</span><span class="op" id="5919444">)</span>&nbsp;<span class="op" id="5919446">|</span>&nbsp;<span class="builtintype" id="5919448">int</span><span class="op" id="5919451">(</span><span class="ident" id="5919452">d</span><span class="op" id="5919453">.</span><span class="ident" id="5919454">tmp</span><span class="op" id="5919457">[</span><span class="num" id="5919458">3</span><span class="op" id="5919459">]</span><span class="op" id="5919460">)</span><span class="op" id="5919461">&lt;&lt;</span><span class="num" id="5919463">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919466">if</span>&nbsp;<span class="ident" id="5919469">d</span><span class="op" id="5919470">.</span><span class="ident" id="5919471">flags</span><span class="op" id="5919476">&amp;</span><span class="ident" id="5919477">gcTransparentColorSet</span>&nbsp;<span class="op" id="5919499">!=</span>&nbsp;<span class="num" id="5919502">0</span>&nbsp;<span class="op" id="5919504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919508">d</span><span class="op" id="5919509">.</span><span class="ident" id="5919510">transparentIndex</span>&nbsp;<span class="op" id="5919527">=</span>&nbsp;<span class="ident" id="5919529">d</span><span class="op" id="5919530">.</span><span class="ident" id="5919531">tmp</span><span class="op" id="5919534">[</span><span class="num" id="5919535">4</span><span class="op" id="5919536">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919540">d</span><span class="op" id="5919541">.</span><span class="ident" id="5919542">hasTransparentIndex</span>&nbsp;<span class="op" id="5919562">=</span>&nbsp;<span class="builtintype" id="5919564">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919570">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919573">return</span>&nbsp;<span class="ident" id="5919580">nil</span><br>
<span class="lineno"></span><span class="op" id="5919584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5919587">func</span>&nbsp;<span class="op" id="5919592">(</span><span class="ident" id="5919593">d</span>&nbsp;<span class="op" id="5919595">*</span><span class="ident" id="5919596">decoder</span><span class="op" id="5919603">)</span>&nbsp;<span class="ident" id="5919605">newImageFromDescriptor</span><span class="op" id="5919627">(</span><span class="op" id="5919628">)</span>&nbsp;<span class="op" id="5919630">(</span><span class="op" id="5919631">*</span><span class="ident" id="5919632">image</span><span class="op" id="5919637">.</span><span class="ident" id="5919638">Paletted</span><span class="op" id="5919646">,</span>&nbsp;<span class="builtintype" id="5919648">error</span><span class="op" id="5919653">)</span>&nbsp;<span class="op" id="5919655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919658">if</span>&nbsp;<span class="ident" id="5919661">_</span><span class="op" id="5919662">,</span>&nbsp;<span class="ident" id="5919664">err</span>&nbsp;<span class="op" id="5919668">:=</span>&nbsp;<span class="ident" id="5919671">io</span><span class="op" id="5919673">.</span><span class="ident" id="5919674">ReadFull</span><span class="op" id="5919682">(</span><span class="ident" id="5919683">d</span><span class="op" id="5919684">.</span><span class="ident" id="5919685">r</span><span class="op" id="5919686">,</span>&nbsp;<span class="ident" id="5919688">d</span><span class="op" id="5919689">.</span><span class="ident" id="5919690">tmp</span><span class="op" id="5919693">[</span><span class="num" id="5919694">0</span><span class="op" id="5919695">:</span><span class="num" id="5919696">9</span><span class="op" id="5919697">]</span><span class="op" id="5919698">)</span><span class="op" id="5919699">;</span>&nbsp;<span class="ident" id="5919701">err</span>&nbsp;<span class="op" id="5919705">!=</span>&nbsp;<span class="ident" id="5919708">nil</span>&nbsp;<span class="op" id="5919712">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919716">return</span>&nbsp;<span class="ident" id="5919723">nil</span><span class="op" id="5919726">,</span>&nbsp;<span class="ident" id="5919728">fmt</span><span class="op" id="5919731">.</span><span class="ident" id="5919732">Errorf</span><span class="op" id="5919738">(</span><span class="string" id="5919739">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="5919777">,</span>&nbsp;<span class="ident" id="5919779">err</span><span class="op" id="5919782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919788">left</span>&nbsp;<span class="op" id="5919793">:=</span>&nbsp;<span class="builtintype" id="5919796">int</span><span class="op" id="5919799">(</span><span class="ident" id="5919800">d</span><span class="op" id="5919801">.</span><span class="ident" id="5919802">tmp</span><span class="op" id="5919805">[</span><span class="num" id="5919806">0</span><span class="op" id="5919807">]</span><span class="op" id="5919808">)</span>&nbsp;<span class="op" id="5919810">+</span>&nbsp;<span class="builtintype" id="5919812">int</span><span class="op" id="5919815">(</span><span class="ident" id="5919816">d</span><span class="op" id="5919817">.</span><span class="ident" id="5919818">tmp</span><span class="op" id="5919821">[</span><span class="num" id="5919822">1</span><span class="op" id="5919823">]</span><span class="op" id="5919824">)</span><span class="op" id="5919825">&lt;&lt;</span><span class="num" id="5919827">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919830">top</span>&nbsp;<span class="op" id="5919834">:=</span>&nbsp;<span class="builtintype" id="5919837">int</span><span class="op" id="5919840">(</span><span class="ident" id="5919841">d</span><span class="op" id="5919842">.</span><span class="ident" id="5919843">tmp</span><span class="op" id="5919846">[</span><span class="num" id="5919847">2</span><span class="op" id="5919848">]</span><span class="op" id="5919849">)</span>&nbsp;<span class="op" id="5919851">+</span>&nbsp;<span class="builtintype" id="5919853">int</span><span class="op" id="5919856">(</span><span class="ident" id="5919857">d</span><span class="op" id="5919858">.</span><span class="ident" id="5919859">tmp</span><span class="op" id="5919862">[</span><span class="num" id="5919863">3</span><span class="op" id="5919864">]</span><span class="op" id="5919865">)</span><span class="op" id="5919866">&lt;&lt;</span><span class="num" id="5919868">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919871">width</span>&nbsp;<span class="op" id="5919877">:=</span>&nbsp;<span class="builtintype" id="5919880">int</span><span class="op" id="5919883">(</span><span class="ident" id="5919884">d</span><span class="op" id="5919885">.</span><span class="ident" id="5919886">tmp</span><span class="op" id="5919889">[</span><span class="num" id="5919890">4</span><span class="op" id="5919891">]</span><span class="op" id="5919892">)</span>&nbsp;<span class="op" id="5919894">+</span>&nbsp;<span class="builtintype" id="5919896">int</span><span class="op" id="5919899">(</span><span class="ident" id="5919900">d</span><span class="op" id="5919901">.</span><span class="ident" id="5919902">tmp</span><span class="op" id="5919905">[</span><span class="num" id="5919906">5</span><span class="op" id="5919907">]</span><span class="op" id="5919908">)</span><span class="op" id="5919909">&lt;&lt;</span><span class="num" id="5919911">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919914">height</span>&nbsp;<span class="op" id="5919921">:=</span>&nbsp;<span class="builtintype" id="5919924">int</span><span class="op" id="5919927">(</span><span class="ident" id="5919928">d</span><span class="op" id="5919929">.</span><span class="ident" id="5919930">tmp</span><span class="op" id="5919933">[</span><span class="num" id="5919934">6</span><span class="op" id="5919935">]</span><span class="op" id="5919936">)</span>&nbsp;<span class="op" id="5919938">+</span>&nbsp;<span class="builtintype" id="5919940">int</span><span class="op" id="5919943">(</span><span class="ident" id="5919944">d</span><span class="op" id="5919945">.</span><span class="ident" id="5919946">tmp</span><span class="op" id="5919949">[</span><span class="num" id="5919950">7</span><span class="op" id="5919951">]</span><span class="op" id="5919952">)</span><span class="op" id="5919953">&lt;&lt;</span><span class="num" id="5919955">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919958">d</span><span class="op" id="5919959">.</span><span class="ident" id="5919960">imageFields</span>&nbsp;<span class="op" id="5919972">=</span>&nbsp;<span class="ident" id="5919974">d</span><span class="op" id="5919975">.</span><span class="ident" id="5919976">tmp</span><span class="op" id="5919979">[</span><span class="num" id="5919980">8</span><span class="op" id="5919981">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919985">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920042">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920104">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920162">bounds</span>&nbsp;<span class="op" id="5920169">:=</span>&nbsp;<span class="ident" id="5920172">image</span><span class="op" id="5920177">.</span><span class="ident" id="5920178">Rect</span><span class="op" id="5920182">(</span><span class="ident" id="5920183">left</span><span class="op" id="5920187">,</span>&nbsp;<span class="ident" id="5920189">top</span><span class="op" id="5920192">,</span>&nbsp;<span class="ident" id="5920194">left</span><span class="op" id="5920198">+</span><span class="ident" id="5920199">width</span><span class="op" id="5920204">,</span>&nbsp;<span class="ident" id="5920206">top</span><span class="op" id="5920209">+</span><span class="ident" id="5920210">height</span><span class="op" id="5920216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920219">if</span>&nbsp;<span class="ident" id="5920222">bounds</span>&nbsp;<span class="op" id="5920229">!=</span>&nbsp;<span class="ident" id="5920232">bounds</span><span class="op" id="5920238">.</span><span class="ident" id="5920239">Intersect</span><span class="op" id="5920248">(</span><span class="ident" id="5920249">image</span><span class="op" id="5920254">.</span><span class="ident" id="5920255">Rect</span><span class="op" id="5920259">(</span><span class="num" id="5920260">0</span><span class="op" id="5920261">,</span>&nbsp;<span class="num" id="5920263">0</span><span class="op" id="5920264">,</span>&nbsp;<span class="ident" id="5920266">d</span><span class="op" id="5920267">.</span><span class="ident" id="5920268">width</span><span class="op" id="5920273">,</span>&nbsp;<span class="ident" id="5920275">d</span><span class="op" id="5920276">.</span><span class="ident" id="5920277">height</span><span class="op" id="5920283">)</span><span class="op" id="5920284">)</span>&nbsp;<span class="op" id="5920286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920290">return</span>&nbsp;<span class="ident" id="5920297">nil</span><span class="op" id="5920300">,</span>&nbsp;<span class="ident" id="5920302">errors</span><span class="op" id="5920308">.</span><span class="ident" id="5920309">New</span><span class="op" id="5920312">(</span><span class="string" id="5920313">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="5920357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920360">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920363">return</span>&nbsp;<span class="ident" id="5920370">image</span><span class="op" id="5920375">.</span><span class="ident" id="5920376">NewPaletted</span><span class="op" id="5920387">(</span><span class="ident" id="5920388">bounds</span><span class="op" id="5920394">,</span>&nbsp;<span class="ident" id="5920396">nil</span><span class="op" id="5920399">)</span><span class="op" id="5920400">,</span>&nbsp;<span class="ident" id="5920402">nil</span><br>
<span class="lineno"></span><span class="op" id="5920406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5920409">func</span>&nbsp;<span class="op" id="5920414">(</span><span class="ident" id="5920415">d</span>&nbsp;<span class="op" id="5920417">*</span><span class="ident" id="5920418">decoder</span><span class="op" id="5920425">)</span>&nbsp;<span class="ident" id="5920427">readBlock</span><span class="op" id="5920436">(</span><span class="op" id="5920437">)</span>&nbsp;<span class="op" id="5920439">(</span><span class="builtintype" id="5920440">int</span><span class="op" id="5920443">,</span>&nbsp;<span class="builtintype" id="5920445">error</span><span class="op" id="5920450">)</span>&nbsp;<span class="op" id="5920452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920455">n</span><span class="op" id="5920456">,</span>&nbsp;<span class="ident" id="5920458">err</span>&nbsp;<span class="op" id="5920462">:=</span>&nbsp;<span class="ident" id="5920465">d</span><span class="op" id="5920466">.</span><span class="ident" id="5920467">r</span><span class="op" id="5920468">.</span><span class="ident" id="5920469">ReadByte</span><span class="op" id="5920477">(</span><span class="op" id="5920478">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920481">if</span>&nbsp;<span class="ident" id="5920484">n</span>&nbsp;<span class="op" id="5920486">==</span>&nbsp;<span class="num" id="5920489">0</span>&nbsp;<span class="op" id="5920491">||</span>&nbsp;<span class="ident" id="5920494">err</span>&nbsp;<span class="op" id="5920498">!=</span>&nbsp;<span class="ident" id="5920501">nil</span>&nbsp;<span class="op" id="5920505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920509">return</span>&nbsp;<span class="num" id="5920516">0</span><span class="op" id="5920517">,</span>&nbsp;<span class="ident" id="5920519">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920527">return</span>&nbsp;<span class="ident" id="5920534">io</span><span class="op" id="5920536">.</span><span class="ident" id="5920537">ReadFull</span><span class="op" id="5920545">(</span><span class="ident" id="5920546">d</span><span class="op" id="5920547">.</span><span class="ident" id="5920548">r</span><span class="op" id="5920549">,</span>&nbsp;<span class="ident" id="5920551">d</span><span class="op" id="5920552">.</span><span class="ident" id="5920553">tmp</span><span class="op" id="5920556">[</span><span class="num" id="5920557">0</span><span class="op" id="5920558">:</span><span class="ident" id="5920559">n</span><span class="op" id="5920560">]</span><span class="op" id="5920561">)</span><br>
<span class="lineno"></span><span class="op" id="5920563">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="5920566">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="5920643">type</span>&nbsp;<span class="ident" id="5920648">interlaceScan</span>&nbsp;<span class="keyword" id="5920662">struct</span>&nbsp;<span class="op" id="5920669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920672">skip</span><span class="op" id="5920676">,</span>&nbsp;<span class="ident" id="5920678">start</span>&nbsp;<span class="builtintype" id="5920684">int</span><br>
<span class="lineno"></span><span class="op" id="5920688">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="5920691">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5920762">var</span>&nbsp;<span class="ident" id="5920766">interlacing</span>&nbsp;<span class="op" id="5920778">=</span>&nbsp;<span class="op" id="5920780">[</span><span class="op" id="5920781">]</span><span class="ident" id="5920782">interlaceScan</span><span class="op" id="5920795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920798">{</span><span class="num" id="5920799">8</span><span class="op" id="5920800">,</span>&nbsp;<span class="num" id="5920802">0</span><span class="op" id="5920803">}</span><span class="op" id="5920804">,</span>&nbsp;<span class="comment" id="5920806">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920857">{</span><span class="num" id="5920858">8</span><span class="op" id="5920859">,</span>&nbsp;<span class="num" id="5920861">4</span><span class="op" id="5920862">}</span><span class="op" id="5920863">,</span>&nbsp;<span class="comment" id="5920865">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920916">{</span><span class="num" id="5920917">4</span><span class="op" id="5920918">,</span>&nbsp;<span class="num" id="5920920">2</span><span class="op" id="5920921">}</span><span class="op" id="5920922">,</span>&nbsp;<span class="comment" id="5920924">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920975">{</span><span class="num" id="5920976">2</span><span class="op" id="5920977">,</span>&nbsp;<span class="num" id="5920979">1</span><span class="op" id="5920980">}</span><span class="op" id="5920981">,</span>&nbsp;<span class="comment" id="5920983">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="5921033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921036">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="5921111">func</span>&nbsp;<span class="ident" id="5921116">uninterlace</span><span class="op" id="5921127">(</span><span class="ident" id="5921128">m</span>&nbsp;<span class="op" id="5921130">*</span><span class="ident" id="5921131">image</span><span class="op" id="5921136">.</span><span class="ident" id="5921137">Paletted</span><span class="op" id="5921145">)</span>&nbsp;<span class="op" id="5921147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921150">var</span>&nbsp;<span class="ident" id="5921154">nPix</span>&nbsp;<span class="op" id="5921159">[</span><span class="op" id="5921160">]</span><span class="builtintype" id="5921161">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921168">dx</span>&nbsp;<span class="op" id="5921171">:=</span>&nbsp;<span class="ident" id="5921174">m</span><span class="op" id="5921175">.</span><span class="ident" id="5921176">Bounds</span><span class="op" id="5921182">(</span><span class="op" id="5921183">)</span><span class="op" id="5921184">.</span><span class="ident" id="5921185">Dx</span><span class="op" id="5921187">(</span><span class="op" id="5921188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921191">dy</span>&nbsp;<span class="op" id="5921194">:=</span>&nbsp;<span class="ident" id="5921197">m</span><span class="op" id="5921198">.</span><span class="ident" id="5921199">Bounds</span><span class="op" id="5921205">(</span><span class="op" id="5921206">)</span><span class="op" id="5921207">.</span><span class="ident" id="5921208">Dy</span><span class="op" id="5921210">(</span><span class="op" id="5921211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921214">nPix</span>&nbsp;<span class="op" id="5921219">=</span>&nbsp;<span class="builtinfunc" id="5921221">make</span><span class="op" id="5921225">(</span><span class="op" id="5921226">[</span><span class="op" id="5921227">]</span><span class="builtintype" id="5921228">uint8</span><span class="op" id="5921233">,</span>&nbsp;<span class="ident" id="5921235">dx</span><span class="op" id="5921237">*</span><span class="ident" id="5921238">dy</span><span class="op" id="5921240">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921243">offset</span>&nbsp;<span class="op" id="5921250">:=</span>&nbsp;<span class="num" id="5921253">0</span>&nbsp;<span class="comment" id="5921255">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921309">for</span>&nbsp;<span class="ident" id="5921313">_</span><span class="op" id="5921314">,</span>&nbsp;<span class="ident" id="5921316">pass</span>&nbsp;<span class="op" id="5921321">:=</span>&nbsp;<span class="keyword" id="5921324">range</span>&nbsp;<span class="ident" id="5921330">interlacing</span>&nbsp;<span class="op" id="5921342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921346">nOffset</span>&nbsp;<span class="op" id="5921354">:=</span>&nbsp;<span class="ident" id="5921357">pass</span><span class="op" id="5921361">.</span><span class="ident" id="5921362">start</span>&nbsp;<span class="op" id="5921368">*</span>&nbsp;<span class="ident" id="5921370">dx</span>&nbsp;<span class="comment" id="5921373">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921423">for</span>&nbsp;<span class="ident" id="5921427">y</span>&nbsp;<span class="op" id="5921429">:=</span>&nbsp;<span class="ident" id="5921432">pass</span><span class="op" id="5921436">.</span><span class="ident" id="5921437">start</span><span class="op" id="5921442">;</span>&nbsp;<span class="ident" id="5921444">y</span>&nbsp;<span class="op" id="5921446">&lt;</span>&nbsp;<span class="ident" id="5921448">dy</span><span class="op" id="5921450">;</span>&nbsp;<span class="ident" id="5921452">y</span>&nbsp;<span class="op" id="5921454">+=</span>&nbsp;<span class="ident" id="5921457">pass</span><span class="op" id="5921461">.</span><span class="ident" id="5921462">skip</span>&nbsp;<span class="op" id="5921467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5921472">copy</span><span class="op" id="5921476">(</span><span class="ident" id="5921477">nPix</span><span class="op" id="5921481">[</span><span class="ident" id="5921482">nOffset</span><span class="op" id="5921489">:</span><span class="ident" id="5921490">nOffset</span><span class="op" id="5921497">+</span><span class="ident" id="5921498">dx</span><span class="op" id="5921500">]</span><span class="op" id="5921501">,</span>&nbsp;<span class="ident" id="5921503">m</span><span class="op" id="5921504">.</span><span class="ident" id="5921505">Pix</span><span class="op" id="5921508">[</span><span class="ident" id="5921509">offset</span><span class="op" id="5921515">:</span><span class="ident" id="5921516">offset</span><span class="op" id="5921522">+</span><span class="ident" id="5921523">dx</span><span class="op" id="5921525">]</span><span class="op" id="5921526">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921531">offset</span>&nbsp;<span class="op" id="5921538">+=</span>&nbsp;<span class="ident" id="5921541">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921547">nOffset</span>&nbsp;<span class="op" id="5921555">+=</span>&nbsp;<span class="ident" id="5921558">dx</span>&nbsp;<span class="op" id="5921561">*</span>&nbsp;<span class="ident" id="5921563">pass</span><span class="op" id="5921567">.</span><span class="ident" id="5921568">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921581">m</span><span class="op" id="5921582">.</span><span class="ident" id="5921583">Pix</span>&nbsp;<span class="op" id="5921587">=</span>&nbsp;<span class="ident" id="5921589">nPix</span><br>
<span class="lineno">415</span><span class="op" id="5921594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921597">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="5921663">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5921691">func</span>&nbsp;<span class="ident" id="5921696">Decode</span><span class="op" id="5921702">(</span><span class="ident" id="5921703">r</span>&nbsp;<span class="ident" id="5921705">io</span><span class="op" id="5921707">.</span><span class="ident" id="5921708">Reader</span><span class="op" id="5921714">)</span>&nbsp;<span class="op" id="5921716">(</span><span class="ident" id="5921717">image</span><span class="op" id="5921722">.</span><span class="ident" id="5921723">Image</span><span class="op" id="5921728">,</span>&nbsp;<span class="builtintype" id="5921730">error</span><span class="op" id="5921735">)</span>&nbsp;<span class="op" id="5921737">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921740">var</span>&nbsp;<span class="ident" id="5921744">d</span>&nbsp;<span class="ident" id="5921746">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921755">if</span>&nbsp;<span class="ident" id="5921758">err</span>&nbsp;<span class="op" id="5921762">:=</span>&nbsp;<span class="ident" id="5921765">d</span><span class="op" id="5921766">.</span><span class="ident" id="5921767">decode</span><span class="op" id="5921773">(</span><span class="ident" id="5921774">r</span><span class="op" id="5921775">,</span>&nbsp;<span class="builtintype" id="5921777">false</span><span class="op" id="5921782">)</span><span class="op" id="5921783">;</span>&nbsp;<span class="ident" id="5921785">err</span>&nbsp;<span class="op" id="5921789">!=</span>&nbsp;<span class="ident" id="5921792">nil</span>&nbsp;<span class="op" id="5921796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921800">return</span>&nbsp;<span class="ident" id="5921807">nil</span><span class="op" id="5921810">,</span>&nbsp;<span class="ident" id="5921812">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921820">return</span>&nbsp;<span class="ident" id="5921827">d</span><span class="op" id="5921828">.</span><span class="ident" id="5921829">image</span><span class="op" id="5921834">[</span><span class="num" id="5921835">0</span><span class="op" id="5921836">]</span><span class="op" id="5921837">,</span>&nbsp;<span class="ident" id="5921839">nil</span><br>
<span class="lineno">425</span><span class="op" id="5921843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921846">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5921915">type</span>&nbsp;<span class="ident" id="5921920">GIF</span>&nbsp;<span class="keyword" id="5921924">struct</span>&nbsp;<span class="op" id="5921931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921934">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921944">[</span><span class="op" id="5921945">]</span><span class="op" id="5921946">*</span><span class="ident" id="5921947">image</span><span class="op" id="5921952">.</span><span class="ident" id="5921953">Paletted</span>&nbsp;<span class="comment" id="5921962">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921989">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921999">[</span><span class="op" id="5922000">]</span><span class="builtintype" id="5922001">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922017">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922087">LoopCount</span>&nbsp;<span class="builtintype" id="5922097">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922115">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="5922134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922137">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="5922209">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5922236">func</span>&nbsp;<span class="ident" id="5922241">DecodeAll</span><span class="op" id="5922250">(</span><span class="ident" id="5922251">r</span>&nbsp;<span class="ident" id="5922253">io</span><span class="op" id="5922255">.</span><span class="ident" id="5922256">Reader</span><span class="op" id="5922262">)</span>&nbsp;<span class="op" id="5922264">(</span><span class="op" id="5922265">*</span><span class="ident" id="5922266">GIF</span><span class="op" id="5922269">,</span>&nbsp;<span class="builtintype" id="5922271">error</span><span class="op" id="5922276">)</span>&nbsp;<span class="op" id="5922278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922281">var</span>&nbsp;<span class="ident" id="5922285">d</span>&nbsp;<span class="ident" id="5922287">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922296">if</span>&nbsp;<span class="ident" id="5922299">err</span>&nbsp;<span class="op" id="5922303">:=</span>&nbsp;<span class="ident" id="5922306">d</span><span class="op" id="5922307">.</span><span class="ident" id="5922308">decode</span><span class="op" id="5922314">(</span><span class="ident" id="5922315">r</span><span class="op" id="5922316">,</span>&nbsp;<span class="builtintype" id="5922318">false</span><span class="op" id="5922323">)</span><span class="op" id="5922324">;</span>&nbsp;<span class="ident" id="5922326">err</span>&nbsp;<span class="op" id="5922330">!=</span>&nbsp;<span class="ident" id="5922333">nil</span>&nbsp;<span class="op" id="5922337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922341">return</span>&nbsp;<span class="ident" id="5922348">nil</span><span class="op" id="5922351">,</span>&nbsp;<span class="ident" id="5922353">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922361">gif</span>&nbsp;<span class="op" id="5922365">:=</span>&nbsp;<span class="op" id="5922368">&amp;</span><span class="ident" id="5922369">GIF</span><span class="op" id="5922372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922376">Image</span><span class="op" id="5922381">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922387">d</span><span class="op" id="5922388">.</span><span class="ident" id="5922389">image</span><span class="op" id="5922394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922398">LoopCount</span><span class="op" id="5922407">:</span>&nbsp;<span class="ident" id="5922409">d</span><span class="op" id="5922410">.</span><span class="ident" id="5922411">loopCount</span><span class="op" id="5922420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922424">Delay</span><span class="op" id="5922429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922435">d</span><span class="op" id="5922436">.</span><span class="ident" id="5922437">delay</span><span class="op" id="5922442">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922448">return</span>&nbsp;<span class="ident" id="5922455">gif</span><span class="op" id="5922458">,</span>&nbsp;<span class="ident" id="5922460">nil</span><br>
<span class="lineno"></span><span class="op" id="5922464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922467">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="5922544">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5922582">func</span>&nbsp;<span class="ident" id="5922587">DecodeConfig</span><span class="op" id="5922599">(</span><span class="ident" id="5922600">r</span>&nbsp;<span class="ident" id="5922602">io</span><span class="op" id="5922604">.</span><span class="ident" id="5922605">Reader</span><span class="op" id="5922611">)</span>&nbsp;<span class="op" id="5922613">(</span><span class="ident" id="5922614">image</span><span class="op" id="5922619">.</span><span class="ident" id="5922620">Config</span><span class="op" id="5922626">,</span>&nbsp;<span class="builtintype" id="5922628">error</span><span class="op" id="5922633">)</span>&nbsp;<span class="op" id="5922635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922638">var</span>&nbsp;<span class="ident" id="5922642">d</span>&nbsp;<span class="ident" id="5922644">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922653">if</span>&nbsp;<span class="ident" id="5922656">err</span>&nbsp;<span class="op" id="5922660">:=</span>&nbsp;<span class="ident" id="5922663">d</span><span class="op" id="5922664">.</span><span class="ident" id="5922665">decode</span><span class="op" id="5922671">(</span><span class="ident" id="5922672">r</span><span class="op" id="5922673">,</span>&nbsp;<span class="builtintype" id="5922675">true</span><span class="op" id="5922679">)</span><span class="op" id="5922680">;</span>&nbsp;<span class="ident" id="5922682">err</span>&nbsp;<span class="op" id="5922686">!=</span>&nbsp;<span class="ident" id="5922689">nil</span>&nbsp;<span class="op" id="5922693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922697">return</span>&nbsp;<span class="ident" id="5922704">image</span><span class="op" id="5922709">.</span><span class="ident" id="5922710">Config</span><span class="op" id="5922716">{</span><span class="op" id="5922717">}</span><span class="op" id="5922718">,</span>&nbsp;<span class="ident" id="5922720">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922728">return</span>&nbsp;<span class="ident" id="5922735">image</span><span class="op" id="5922740">.</span><span class="ident" id="5922741">Config</span><span class="op" id="5922747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922751">ColorModel</span><span class="op" id="5922761">:</span>&nbsp;<span class="ident" id="5922763">d</span><span class="op" id="5922764">.</span><span class="ident" id="5922765">globalColorMap</span><span class="op" id="5922779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922783">Width</span><span class="op" id="5922788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922795">d</span><span class="op" id="5922796">.</span><span class="ident" id="5922797">width</span><span class="op" id="5922802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922806">Height</span><span class="op" id="5922812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922818">d</span><span class="op" id="5922819">.</span><span class="ident" id="5922820">height</span><span class="op" id="5922826">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922829">}</span><span class="op" id="5922830">,</span>&nbsp;<span class="ident" id="5922832">nil</span><br>
<span class="lineno"></span><span class="op" id="5922836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5922839">func</span>&nbsp;<span class="ident" id="5922844">init</span><span class="op" id="5922848">(</span><span class="op" id="5922849">)</span>&nbsp;<span class="op" id="5922851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922854">image</span><span class="op" id="5922859">.</span><span class="ident" id="5922860">RegisterFormat</span><span class="op" id="5922874">(</span><span class="string" id="5922875">&#34;gif&#34;</span><span class="op" id="5922880">,</span>&nbsp;<span class="string" id="5922882">&#34;GIF8?a&#34;</span><span class="op" id="5922890">,</span>&nbsp;<span class="ident" id="5922892">Decode</span><span class="op" id="5922898">,</span>&nbsp;<span class="ident" id="5922900">DecodeConfig</span><span class="op" id="5922912">)</span><br>
<span class="lineno">465</span><span class="op" id="5922914">}</span>
</div>
</body>
</html>
