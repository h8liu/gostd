<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5285665">package</span>&nbsp;<span class="ident" id="5285673">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5285680">//&nbsp;Inst&nbsp;is&nbsp;an&nbsp;interface&nbsp;for&nbsp;executing&nbsp;one&nbsp;single&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="5285741">type</span>&nbsp;<span class="ident" id="5285746">inst</span>&nbsp;<span class="keyword" id="5285751">interface</span>&nbsp;<span class="op" id="5285761">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285764">I</span><span class="op" id="5285765">(</span><span class="ident" id="5285766">cpu</span>&nbsp;<span class="op" id="5285770">*</span><span class="ident" id="5285771"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5285774">,</span>&nbsp;<span class="ident" id="5285776">in</span>&nbsp;<span class="builtintype" id="5285779">uint32</span><span class="op" id="5285785">)</span>&nbsp;<span class="op" id="5285787">*</span><span class="ident" id="5285788"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span><br>
<span class="lineno"></span><span class="op" id="5285794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5285797">//&nbsp;CPU&nbsp;defines&nbsp;the&nbsp;structure&nbsp;of&nbsp;a&nbsp;processing&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5285848">type</span>&nbsp;<span class="ident" id="5285853">cpu</span>&nbsp;<span class="keyword" id="5285857">struct</span>&nbsp;<span class="op" id="5285864">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285867">regs</span>&nbsp;<span class="op" id="5285872">[</span><span class="op" id="5285873">]</span><span class="builtintype" id="5285874">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285882">ring</span>&nbsp;<span class="builtintype" id="5285887">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285894">phyMem</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285904">*</span><span class="ident" id="5285905"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5309221">phyMemory</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285916">virtMem</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5285926">*</span><span class="ident" id="5285927"><a href="/lonnie.io/e8vm/arch8/virt_memory.go.html#5317171">virtMemory</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285939">interrupt</span>&nbsp;<span class="op" id="5285949">*</span><span class="ident" id="5285950"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5297489">interrupt</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285962">inst</span>&nbsp;&nbsp;<span class="ident" id="5285968"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285746">inst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285974">index</span>&nbsp;<span class="builtintype" id="5285980">byte</span><br>
<span class="lineno"></span><span class="op" id="5285985">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5285988">//&nbsp;InitPC&nbsp;points&nbsp;the&nbsp;default&nbsp;starting&nbsp;value&nbsp;of&nbsp;the&nbsp;program&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="5286056">const</span>&nbsp;<span class="ident" id="5286062">InitPC</span>&nbsp;<span class="op" id="5286069">=</span>&nbsp;<span class="num" id="5286071">0x8000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5286079">//&nbsp;NewCPU&nbsp;creates&nbsp;a&nbsp;CPU&nbsp;with&nbsp;memroy&nbsp;and&nbsp;instruction&nbsp;binding</span><br>
<span class="lineno">25</span><span class="keyword" id="5286139">func</span>&nbsp;<span class="ident" id="5286144">newCPU</span><span class="op" id="5286150">(</span><span class="ident" id="5286151">mem</span>&nbsp;<span class="op" id="5286155">*</span><span class="ident" id="5286156"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5309221">phyMemory</a></span><span class="op" id="5286165">,</span>&nbsp;<span class="ident" id="5286167">i</span>&nbsp;<span class="ident" id="5286169"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285746">inst</a></span><span class="op" id="5286173">,</span>&nbsp;<span class="ident" id="5286175">index</span>&nbsp;<span class="builtintype" id="5286181">byte</span><span class="op" id="5286185">)</span>&nbsp;<span class="op" id="5286187">*</span><span class="ident" id="5286188"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span>&nbsp;<span class="op" id="5286192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286195">if</span>&nbsp;<span class="ident" id="5286198"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286175">index</a></span>&nbsp;<span class="op" id="5286204">&gt;=</span>&nbsp;<span class="num" id="5286207">32</span>&nbsp;<span class="op" id="5286210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5286214">panic</span><span class="op" id="5286219">(</span><span class="string" id="5286220">&#34;too&nbsp;many&nbsp;cores&#34;</span><span class="op" id="5286236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286243">ret</span>&nbsp;<span class="op" id="5286247">:=</span>&nbsp;<span class="builtinfunc" id="5286250">new</span><span class="op" id="5286253">(</span><span class="ident" id="5286254"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5286257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286260"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286263">.</span><span class="ident" id="5286264">regs</span>&nbsp;<span class="op" id="5286269">=</span>&nbsp;<span class="ident" id="5286271"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311652">makeRegs</a></span><span class="op" id="5286279">(</span><span class="op" id="5286280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286283"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286286">.</span><span class="ident" id="5286287">phyMem</span>&nbsp;<span class="op" id="5286294">=</span>&nbsp;<span class="ident" id="5286296"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286151">mem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286301"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286304">.</span><span class="ident" id="5286305">virtMem</span>&nbsp;<span class="op" id="5286313">=</span>&nbsp;<span class="ident" id="5286315"><a href="/lonnie.io/e8vm/arch8/virt_memory.go.html#5317310">newVirtMemory</a></span><span class="op" id="5286328">(</span><span class="ident" id="5286329"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286332">.</span><span class="ident" id="5286333">phyMem</span><span class="op" id="5286339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286342"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286345">.</span><span class="ident" id="5286346">index</span>&nbsp;<span class="op" id="5286352">=</span>&nbsp;<span class="ident" id="5286354"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286175">index</a></span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286362">intPage</span>&nbsp;<span class="op" id="5286370">:=</span>&nbsp;<span class="ident" id="5286373"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286376">.</span><span class="ident" id="5286377">phyMem</span><span class="op" id="5286383">.</span><span class="ident" id="5286384">Page</span><span class="op" id="5286388">(</span><span class="ident" id="5286389"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5309309">pageInterrupt</a></span><span class="op" id="5286402">)</span>&nbsp;<span class="comment" id="5286404">//&nbsp;page&nbsp;1&nbsp;is&nbsp;the&nbsp;interrupt&nbsp;page</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286437">if</span>&nbsp;<span class="ident" id="5286440"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286362">intPage</a></span>&nbsp;<span class="op" id="5286448">==</span>&nbsp;<span class="ident" id="5286451">nil</span>&nbsp;<span class="op" id="5286455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5286459">panic</span><span class="op" id="5286464">(</span><span class="string" id="5286465">&#34;memory&nbsp;too&nbsp;small&#34;</span><span class="op" id="5286483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286486">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286489"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286492">.</span><span class="ident" id="5286493">interrupt</span>&nbsp;<span class="op" id="5286503">=</span>&nbsp;<span class="ident" id="5286505"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5298098">newInterrupt</a></span><span class="op" id="5286517">(</span><span class="ident" id="5286518"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286362">intPage</a></span><span class="op" id="5286525">,</span>&nbsp;<span class="ident" id="5286527"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286175">index</a></span><span class="op" id="5286532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286535"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286538">.</span><span class="ident" id="5286539">inst</span>&nbsp;<span class="op" id="5286544">=</span>&nbsp;<span class="ident" id="5286546"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286167">i</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286550"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><span class="op" id="5286553">.</span><span class="ident" id="5286554">regs</span><span class="op" id="5286558">[</span><span class="ident" id="5286559"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5286561">]</span>&nbsp;<span class="op" id="5286563">=</span>&nbsp;<span class="ident" id="5286565"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286062">InitPC</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286574">return</span>&nbsp;<span class="ident" id="5286581"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286243">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5286585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5286588">//&nbsp;UserMode&nbsp;returns&nbsp;trun&nbsp;when&nbsp;the&nbsp;CPU&nbsp;is&nbsp;in&nbsp;user&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5286643">func</span>&nbsp;<span class="op" id="5286648">(</span><span class="ident" id="5286649">c</span>&nbsp;<span class="op" id="5286651">*</span><span class="ident" id="5286652"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5286655">)</span>&nbsp;<span class="ident" id="5286657">UserMode</span><span class="op" id="5286665">(</span><span class="op" id="5286666">)</span>&nbsp;<span class="builtintype" id="5286668">bool</span>&nbsp;<span class="op" id="5286673">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286676">return</span>&nbsp;<span class="ident" id="5286683"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286649">c</a></span><span class="op" id="5286684">.</span><span class="ident" id="5286685">ring</span>&nbsp;<span class="op" id="5286690">&gt;</span>&nbsp;<span class="num" id="5286692">0</span><br>
<span class="lineno"></span><span class="op" id="5286694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5286697">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;CPU&#39;s&nbsp;internal&nbsp;states,&nbsp;i.e.,&nbsp;registers,</span><br>
<span class="lineno"></span><span class="comment" id="5286757">//&nbsp;the&nbsp;page&nbsp;table,&nbsp;and&nbsp;disables&nbsp;interrupt</span><br>
<span class="lineno">55</span><span class="keyword" id="5286799">func</span>&nbsp;<span class="op" id="5286804">(</span><span class="ident" id="5286805">c</span>&nbsp;<span class="op" id="5286807">*</span><span class="ident" id="5286808"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5286811">)</span>&nbsp;<span class="ident" id="5286813">Reset</span><span class="op" id="5286818">(</span><span class="op" id="5286819">)</span>&nbsp;<span class="op" id="5286821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286824">for</span>&nbsp;<span class="ident" id="5286828">i</span>&nbsp;<span class="op" id="5286830">:=</span>&nbsp;<span class="num" id="5286833">0</span><span class="op" id="5286834">;</span>&nbsp;<span class="ident" id="5286836"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286828">i</a></span>&nbsp;<span class="op" id="5286838">&lt;</span>&nbsp;<span class="ident" id="5286840"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311540">Nreg</a></span><span class="op" id="5286844">;</span>&nbsp;<span class="ident" id="5286846"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286828">i</a></span><span class="op" id="5286847">++</span>&nbsp;<span class="op" id="5286850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286854"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286805">c</a></span><span class="op" id="5286855">.</span><span class="ident" id="5286856">regs</span><span class="op" id="5286860">[</span><span class="ident" id="5286861"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286828">i</a></span><span class="op" id="5286862">]</span>&nbsp;<span class="op" id="5286864">=</span>&nbsp;<span class="num" id="5286866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286872"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286805">c</a></span><span class="op" id="5286873">.</span><span class="ident" id="5286874">regs</span><span class="op" id="5286878">[</span><span class="ident" id="5286879"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5286881">]</span>&nbsp;<span class="op" id="5286883">=</span>&nbsp;<span class="ident" id="5286885"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286062">InitPC</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286893"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286805">c</a></span><span class="op" id="5286894">.</span><span class="ident" id="5286895">virtMem</span><span class="op" id="5286902">.</span><span class="ident" id="5286903">SetTable</span><span class="op" id="5286911">(</span><span class="num" id="5286912">0</span><span class="op" id="5286913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286916"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286805">c</a></span><span class="op" id="5286917">.</span><span class="ident" id="5286918">ring</span>&nbsp;<span class="op" id="5286923">=</span>&nbsp;<span class="num" id="5286925">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286928"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286805">c</a></span><span class="op" id="5286929">.</span><span class="ident" id="5286930">interrupt</span><span class="op" id="5286939">.</span><span class="ident" id="5286940">Disable</span><span class="op" id="5286947">(</span><span class="op" id="5286948">)</span><br>
<span class="lineno"></span><span class="op" id="5286950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="5286953">func</span>&nbsp;<span class="op" id="5286958">(</span><span class="ident" id="5286959">c</span>&nbsp;<span class="op" id="5286961">*</span><span class="ident" id="5286962"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5286965">)</span>&nbsp;<span class="ident" id="5286967">tick</span><span class="op" id="5286971">(</span><span class="op" id="5286972">)</span>&nbsp;<span class="op" id="5286974">*</span><span class="ident" id="5286975"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5286981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286984">pc</span>&nbsp;<span class="op" id="5286987">:=</span>&nbsp;<span class="ident" id="5286990"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5286991">.</span><span class="ident" id="5286992">regs</span><span class="op" id="5286996">[</span><span class="ident" id="5286997"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5286999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287002">inst</span><span class="op" id="5287006">,</span>&nbsp;<span class="ident" id="5287008">e</span>&nbsp;<span class="op" id="5287010">:=</span>&nbsp;<span class="ident" id="5287013"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287014">.</span><span class="ident" id="5287015">readWord</span><span class="op" id="5287023">(</span><span class="ident" id="5287024"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286984">pc</a></span><span class="op" id="5287026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287029">if</span>&nbsp;<span class="ident" id="5287032"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287008">e</a></span>&nbsp;<span class="op" id="5287034">!=</span>&nbsp;<span class="ident" id="5287037">nil</span>&nbsp;<span class="op" id="5287041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287045">return</span>&nbsp;<span class="ident" id="5287052"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287008">e</a></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5287055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287059"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287060">.</span><span class="ident" id="5287061">regs</span><span class="op" id="5287065">[</span><span class="ident" id="5287066"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5287068">]</span>&nbsp;<span class="op" id="5287070">=</span>&nbsp;<span class="ident" id="5287072"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286984">pc</a></span>&nbsp;<span class="op" id="5287075">+</span>&nbsp;<span class="num" id="5287077">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287080">if</span>&nbsp;<span class="ident" id="5287083"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287084">.</span><span class="ident" id="5287085">inst</span>&nbsp;<span class="op" id="5287090">!=</span>&nbsp;<span class="ident" id="5287093">nil</span>&nbsp;<span class="op" id="5287097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287101"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287008">e</a></span>&nbsp;<span class="op" id="5287103">=</span>&nbsp;<span class="ident" id="5287105"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287106">.</span><span class="ident" id="5287107">inst</span><span class="op" id="5287111">.</span><span class="ident" id="5287112">I</span><span class="op" id="5287113">(</span><span class="ident" id="5287114"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287115">,</span>&nbsp;<span class="ident" id="5287117"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287002">inst</a></span><span class="op" id="5287121">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287126">if</span>&nbsp;<span class="ident" id="5287129"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287008">e</a></span>&nbsp;<span class="op" id="5287131">!=</span>&nbsp;<span class="ident" id="5287134">nil</span>&nbsp;<span class="op" id="5287138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287143"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286959">c</a></span><span class="op" id="5287144">.</span><span class="ident" id="5287145">regs</span><span class="op" id="5287149">[</span><span class="ident" id="5287150"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5287152">]</span>&nbsp;<span class="op" id="5287154">=</span>&nbsp;<span class="ident" id="5287156"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286984">pc</a></span>&nbsp;<span class="comment" id="5287159">//&nbsp;restore&nbsp;saved&nbsp;original&nbsp;PC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287191">return</span>&nbsp;<span class="ident" id="5287198"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287008">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5287202">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5287205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287209">return</span>&nbsp;<span class="ident" id="5287216">nil</span><br>
<span class="lineno"></span><span class="op" id="5287220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="5287223">const</span>&nbsp;<span class="op" id="5287229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287232">intFrameSP</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5287245">=</span>&nbsp;<span class="num" id="5287247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287250">intFrameRET</span>&nbsp;&nbsp;<span class="op" id="5287263">=</span>&nbsp;<span class="num" id="5287265">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287268">intFrameArg</span>&nbsp;&nbsp;<span class="op" id="5287281">=</span>&nbsp;<span class="num" id="5287283">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287286">intFrameCode</span>&nbsp;<span class="op" id="5287299">=</span>&nbsp;<span class="num" id="5287301">12</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287305">intFrameRing</span>&nbsp;<span class="op" id="5287318">=</span>&nbsp;<span class="num" id="5287320">13</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287325">intFrameSize</span>&nbsp;<span class="op" id="5287338">=</span>&nbsp;<span class="num" id="5287340">16</span><br>
<span class="lineno"></span><span class="op" id="5287343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5287346">//&nbsp;Interrupt&nbsp;issues&nbsp;an&nbsp;interrupt&nbsp;to&nbsp;the&nbsp;core</span><br>
<span class="lineno"></span><span class="keyword" id="5287391">func</span>&nbsp;<span class="op" id="5287396">(</span><span class="ident" id="5287397">c</span>&nbsp;<span class="op" id="5287399">*</span><span class="ident" id="5287400"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287403">)</span>&nbsp;<span class="ident" id="5287405">Interrupt</span><span class="op" id="5287414">(</span><span class="ident" id="5287415">code</span>&nbsp;<span class="builtintype" id="5287420">byte</span><span class="op" id="5287424">)</span>&nbsp;<span class="op" id="5287426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287429"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287397">c</a></span><span class="op" id="5287430">.</span><span class="ident" id="5287431">interrupt</span><span class="op" id="5287440">.</span><span class="ident" id="5287441">Issue</span><span class="op" id="5287446">(</span><span class="ident" id="5287447"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287415">code</a></span><span class="op" id="5287451">)</span><br>
<span class="lineno"></span><span class="op" id="5287453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5287456">func</span>&nbsp;<span class="op" id="5287461">(</span><span class="ident" id="5287462">c</span>&nbsp;<span class="op" id="5287464">*</span><span class="ident" id="5287465"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287468">)</span>&nbsp;<span class="ident" id="5287470">readWord</span><span class="op" id="5287478">(</span><span class="ident" id="5287479">addr</span>&nbsp;<span class="builtintype" id="5287484">uint32</span><span class="op" id="5287490">)</span>&nbsp;<span class="op" id="5287492">(</span><span class="builtintype" id="5287493">uint32</span><span class="op" id="5287499">,</span>&nbsp;<span class="op" id="5287501">*</span><span class="ident" id="5287502"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span><span class="op" id="5287507">)</span>&nbsp;<span class="op" id="5287509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287512">return</span>&nbsp;<span class="ident" id="5287519"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287462">c</a></span><span class="op" id="5287520">.</span><span class="ident" id="5287521">virtMem</span><span class="op" id="5287528">.</span><span class="ident" id="5287529">ReadWord</span><span class="op" id="5287537">(</span><span class="ident" id="5287538"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287479">addr</a></span><span class="op" id="5287542">,</span>&nbsp;<span class="ident" id="5287544"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287462">c</a></span><span class="op" id="5287545">.</span><span class="ident" id="5287546">ring</span><span class="op" id="5287550">)</span><br>
<span class="lineno"></span><span class="op" id="5287552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287555">func</span>&nbsp;<span class="op" id="5287560">(</span><span class="ident" id="5287561">c</span>&nbsp;<span class="op" id="5287563">*</span><span class="ident" id="5287564"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287567">)</span>&nbsp;<span class="ident" id="5287569">readByte</span><span class="op" id="5287577">(</span><span class="ident" id="5287578">addr</span>&nbsp;<span class="builtintype" id="5287583">uint32</span><span class="op" id="5287589">)</span>&nbsp;<span class="op" id="5287591">(</span><span class="builtintype" id="5287592">uint8</span><span class="op" id="5287597">,</span>&nbsp;<span class="op" id="5287599">*</span><span class="ident" id="5287600"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span><span class="op" id="5287605">)</span>&nbsp;<span class="op" id="5287607">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287610">return</span>&nbsp;<span class="ident" id="5287617"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287561">c</a></span><span class="op" id="5287618">.</span><span class="ident" id="5287619">virtMem</span><span class="op" id="5287626">.</span><span class="ident" id="5287627">ReadByte</span><span class="op" id="5287635">(</span><span class="ident" id="5287636"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287578">addr</a></span><span class="op" id="5287640">,</span>&nbsp;<span class="ident" id="5287642"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287561">c</a></span><span class="op" id="5287643">.</span><span class="ident" id="5287644">ring</span><span class="op" id="5287648">)</span><br>
<span class="lineno"></span><span class="op" id="5287650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287653">func</span>&nbsp;<span class="op" id="5287658">(</span><span class="ident" id="5287659">c</span>&nbsp;<span class="op" id="5287661">*</span><span class="ident" id="5287662"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287665">)</span>&nbsp;<span class="ident" id="5287667">writeWord</span><span class="op" id="5287676">(</span><span class="ident" id="5287677">addr</span>&nbsp;<span class="builtintype" id="5287682">uint32</span><span class="op" id="5287688">,</span>&nbsp;<span class="ident" id="5287690">v</span>&nbsp;<span class="builtintype" id="5287692">uint32</span><span class="op" id="5287698">)</span>&nbsp;<span class="op" id="5287700">*</span><span class="ident" id="5287701"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5287707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287710">return</span>&nbsp;<span class="ident" id="5287717"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287659">c</a></span><span class="op" id="5287718">.</span><span class="ident" id="5287719">virtMem</span><span class="op" id="5287726">.</span><span class="ident" id="5287727">WriteWord</span><span class="op" id="5287736">(</span><span class="ident" id="5287737"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287677">addr</a></span><span class="op" id="5287741">,</span>&nbsp;<span class="ident" id="5287743"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287659">c</a></span><span class="op" id="5287744">.</span><span class="ident" id="5287745">ring</span><span class="op" id="5287749">,</span>&nbsp;<span class="ident" id="5287751"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287690">v</a></span><span class="op" id="5287752">)</span><br>
<span class="lineno">110</span><span class="op" id="5287754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287757">func</span>&nbsp;<span class="op" id="5287762">(</span><span class="ident" id="5287763">c</span>&nbsp;<span class="op" id="5287765">*</span><span class="ident" id="5287766"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287769">)</span>&nbsp;<span class="ident" id="5287771">writeByte</span><span class="op" id="5287780">(</span><span class="ident" id="5287781">addr</span>&nbsp;<span class="builtintype" id="5287786">uint32</span><span class="op" id="5287792">,</span>&nbsp;<span class="ident" id="5287794">v</span>&nbsp;<span class="builtintype" id="5287796">uint8</span><span class="op" id="5287801">)</span>&nbsp;<span class="op" id="5287803">*</span><span class="ident" id="5287804"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5287810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287813">return</span>&nbsp;<span class="ident" id="5287820"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287763">c</a></span><span class="op" id="5287821">.</span><span class="ident" id="5287822">virtMem</span><span class="op" id="5287829">.</span><span class="ident" id="5287830">WriteByte</span><span class="op" id="5287839">(</span><span class="ident" id="5287840"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287781">addr</a></span><span class="op" id="5287844">,</span>&nbsp;<span class="ident" id="5287846"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287763">c</a></span><span class="op" id="5287847">.</span><span class="ident" id="5287848">ring</span><span class="op" id="5287852">,</span>&nbsp;<span class="ident" id="5287854"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287794">v</a></span><span class="op" id="5287855">)</span><br>
<span class="lineno"></span><span class="op" id="5287857">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5287860">//&nbsp;Ienter&nbsp;enters&nbsp;a&nbsp;interrupt&nbsp;routine.</span><br>
<span class="lineno"></span><span class="keyword" id="5287898">func</span>&nbsp;<span class="op" id="5287903">(</span><span class="ident" id="5287904">c</span>&nbsp;<span class="op" id="5287906">*</span><span class="ident" id="5287907"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5287910">)</span>&nbsp;<span class="ident" id="5287912">Ienter</span><span class="op" id="5287918">(</span><span class="ident" id="5287919">code</span>&nbsp;<span class="builtintype" id="5287924">byte</span><span class="op" id="5287928">,</span>&nbsp;<span class="ident" id="5287930">arg</span>&nbsp;<span class="builtintype" id="5287934">uint32</span><span class="op" id="5287940">)</span>&nbsp;<span class="op" id="5287942">*</span><span class="ident" id="5287943"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5287949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287952">ksp</span>&nbsp;<span class="op" id="5287956">:=</span>&nbsp;<span class="ident" id="5287959"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5287960">.</span><span class="ident" id="5287961">interrupt</span><span class="op" id="5287970">.</span><span class="ident" id="5287971">kernelSP</span><span class="op" id="5287979">(</span><span class="op" id="5287980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287983">base</span>&nbsp;<span class="op" id="5287988">:=</span>&nbsp;<span class="ident" id="5287991"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287952">ksp</a></span>&nbsp;<span class="op" id="5287995">-</span>&nbsp;<span class="ident" id="5287997"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287325">intFrameSize</a></span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288012">writeWord</span>&nbsp;<span class="op" id="5288022">:=</span>&nbsp;<span class="keyword" id="5288025">func</span><span class="op" id="5288029">(</span><span class="ident" id="5288030">off</span>&nbsp;<span class="builtintype" id="5288034">uint32</span><span class="op" id="5288040">,</span>&nbsp;<span class="ident" id="5288042">v</span>&nbsp;<span class="builtintype" id="5288044">uint32</span><span class="op" id="5288050">)</span>&nbsp;<span class="op" id="5288052">*</span><span class="ident" id="5288053"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5288059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288063">return</span>&nbsp;<span class="ident" id="5288070"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288071">.</span><span class="ident" id="5288072">virtMem</span><span class="op" id="5288079">.</span><span class="ident" id="5288080">WriteWord</span><span class="op" id="5288089">(</span><span class="ident" id="5288090"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287983">base</a></span><span class="op" id="5288094">+</span><span class="ident" id="5288095"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288030">off</a></span><span class="op" id="5288098">,</span>&nbsp;<span class="num" id="5288100">0</span><span class="op" id="5288101">,</span>&nbsp;<span class="ident" id="5288103"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288042">v</a></span><span class="op" id="5288104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288110">writeByte</span>&nbsp;<span class="op" id="5288120">:=</span>&nbsp;<span class="keyword" id="5288123">func</span><span class="op" id="5288127">(</span><span class="ident" id="5288128">off</span>&nbsp;<span class="builtintype" id="5288132">uint32</span><span class="op" id="5288138">,</span>&nbsp;<span class="ident" id="5288140">b</span>&nbsp;<span class="builtintype" id="5288142">uint8</span><span class="op" id="5288147">)</span>&nbsp;<span class="op" id="5288149">*</span><span class="ident" id="5288150"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5288156">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288160">return</span>&nbsp;<span class="ident" id="5288167"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288168">.</span><span class="ident" id="5288169">virtMem</span><span class="op" id="5288176">.</span><span class="ident" id="5288177">WriteByte</span><span class="op" id="5288186">(</span><span class="ident" id="5288187"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287983">base</a></span><span class="op" id="5288191">+</span><span class="ident" id="5288192"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288128">off</a></span><span class="op" id="5288195">,</span>&nbsp;<span class="num" id="5288197">0</span><span class="op" id="5288198">,</span>&nbsp;<span class="ident" id="5288200"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288140">b</a></span><span class="op" id="5288201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288207">if</span>&nbsp;<span class="ident" id="5288210">e</span>&nbsp;<span class="op" id="5288212">:=</span>&nbsp;<span class="ident" id="5288215"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288012">writeWord</a></span><span class="op" id="5288224">(</span><span class="ident" id="5288225"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287232">intFrameSP</a></span><span class="op" id="5288235">,</span>&nbsp;<span class="ident" id="5288237"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288238">.</span><span class="ident" id="5288239">regs</span><span class="op" id="5288243">[</span><span class="ident" id="5288244"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311618">SP</a></span><span class="op" id="5288246">]</span><span class="op" id="5288247">)</span><span class="op" id="5288248">;</span>&nbsp;<span class="ident" id="5288250"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288210">e</a></span>&nbsp;<span class="op" id="5288252">!=</span>&nbsp;<span class="ident" id="5288255">nil</span>&nbsp;<span class="op" id="5288259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288263">return</span>&nbsp;<span class="ident" id="5288270"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288210">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288273">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288276">if</span>&nbsp;<span class="ident" id="5288279">e</span>&nbsp;<span class="op" id="5288281">:=</span>&nbsp;<span class="ident" id="5288284"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288012">writeWord</a></span><span class="op" id="5288293">(</span><span class="ident" id="5288294"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287250">intFrameRET</a></span><span class="op" id="5288305">,</span>&nbsp;<span class="ident" id="5288307"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288308">.</span><span class="ident" id="5288309">regs</span><span class="op" id="5288313">[</span><span class="ident" id="5288314"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311627">RET</a></span><span class="op" id="5288317">]</span><span class="op" id="5288318">)</span><span class="op" id="5288319">;</span>&nbsp;<span class="ident" id="5288321"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288279">e</a></span>&nbsp;<span class="op" id="5288323">!=</span>&nbsp;<span class="ident" id="5288326">nil</span>&nbsp;<span class="op" id="5288330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288334">return</span>&nbsp;<span class="ident" id="5288341"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288279">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288347">if</span>&nbsp;<span class="ident" id="5288350">e</span>&nbsp;<span class="op" id="5288352">:=</span>&nbsp;<span class="ident" id="5288355"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288012">writeWord</a></span><span class="op" id="5288364">(</span><span class="ident" id="5288365"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287268">intFrameArg</a></span><span class="op" id="5288376">,</span>&nbsp;<span class="ident" id="5288378"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287930">arg</a></span><span class="op" id="5288381">)</span><span class="op" id="5288382">;</span>&nbsp;<span class="ident" id="5288384"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288350">e</a></span>&nbsp;<span class="op" id="5288386">!=</span>&nbsp;<span class="ident" id="5288389">nil</span>&nbsp;<span class="op" id="5288393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288397">return</span>&nbsp;<span class="ident" id="5288404"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288350">e</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288410">if</span>&nbsp;<span class="ident" id="5288413">e</span>&nbsp;<span class="op" id="5288415">:=</span>&nbsp;<span class="ident" id="5288418"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288110">writeByte</a></span><span class="op" id="5288427">(</span><span class="ident" id="5288428"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287286">intFrameCode</a></span><span class="op" id="5288440">,</span>&nbsp;<span class="ident" id="5288442"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287919">code</a></span><span class="op" id="5288446">)</span><span class="op" id="5288447">;</span>&nbsp;<span class="ident" id="5288449"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288413">e</a></span>&nbsp;<span class="op" id="5288451">!=</span>&nbsp;<span class="ident" id="5288454">nil</span>&nbsp;<span class="op" id="5288458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288462">return</span>&nbsp;<span class="ident" id="5288469"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288413">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288475">if</span>&nbsp;<span class="ident" id="5288478">e</span>&nbsp;<span class="op" id="5288480">:=</span>&nbsp;<span class="ident" id="5288483"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288110">writeByte</a></span><span class="op" id="5288492">(</span><span class="ident" id="5288493"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287305">intFrameRing</a></span><span class="op" id="5288505">,</span>&nbsp;<span class="ident" id="5288507"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288508">.</span><span class="ident" id="5288509">ring</span><span class="op" id="5288513">)</span><span class="op" id="5288514">;</span>&nbsp;<span class="ident" id="5288516"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288478">e</a></span>&nbsp;<span class="op" id="5288518">!=</span>&nbsp;<span class="ident" id="5288521">nil</span>&nbsp;<span class="op" id="5288525">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288529">return</span>&nbsp;<span class="ident" id="5288536"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288478">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288543"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288544">.</span><span class="ident" id="5288545">interrupt</span><span class="op" id="5288554">.</span><span class="ident" id="5288555">Disable</span><span class="op" id="5288562">(</span><span class="op" id="5288563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288566"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288567">.</span><span class="ident" id="5288568">regs</span><span class="op" id="5288572">[</span><span class="ident" id="5288573"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311618">SP</a></span><span class="op" id="5288575">]</span>&nbsp;<span class="op" id="5288577">=</span>&nbsp;<span class="ident" id="5288579"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287952">ksp</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288584"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288585">.</span><span class="ident" id="5288586">regs</span><span class="op" id="5288590">[</span><span class="ident" id="5288591"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311627">RET</a></span><span class="op" id="5288594">]</span>&nbsp;<span class="op" id="5288596">=</span>&nbsp;<span class="ident" id="5288598"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288599">.</span><span class="ident" id="5288600">regs</span><span class="op" id="5288604">[</span><span class="ident" id="5288605"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5288607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288610"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288611">.</span><span class="ident" id="5288612">regs</span><span class="op" id="5288616">[</span><span class="ident" id="5288617"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5288619">]</span>&nbsp;<span class="op" id="5288621">=</span>&nbsp;<span class="ident" id="5288623"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288624">.</span><span class="ident" id="5288625">interrupt</span><span class="op" id="5288634">.</span><span class="ident" id="5288635">handlerPC</span><span class="op" id="5288644">(</span><span class="op" id="5288645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288648"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287904">c</a></span><span class="op" id="5288649">.</span><span class="ident" id="5288650">ring</span>&nbsp;<span class="op" id="5288655">=</span>&nbsp;<span class="num" id="5288657">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288661">return</span>&nbsp;<span class="ident" id="5288668">nil</span><br>
<span class="lineno">150</span><span class="op" id="5288672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5288675">//&nbsp;Syscall&nbsp;jumps&nbsp;to&nbsp;the&nbsp;system&nbsp;call&nbsp;handler&nbsp;and&nbsp;switches&nbsp;to&nbsp;ring&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="5288743">func</span>&nbsp;<span class="op" id="5288748">(</span><span class="ident" id="5288749">c</span>&nbsp;<span class="op" id="5288751">*</span><span class="ident" id="5288752"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5288755">)</span>&nbsp;<span class="ident" id="5288757">Syscall</span><span class="op" id="5288764">(</span><span class="op" id="5288765">)</span>&nbsp;<span class="op" id="5288767">*</span><span class="ident" id="5288768"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5288774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288777"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288749">c</a></span><span class="op" id="5288778">.</span><span class="ident" id="5288779">regs</span><span class="op" id="5288783">[</span><span class="ident" id="5288784"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5288786">]</span>&nbsp;<span class="op" id="5288788">=</span>&nbsp;<span class="ident" id="5288790"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288749">c</a></span><span class="op" id="5288791">.</span><span class="ident" id="5288792">interrupt</span><span class="op" id="5288801">.</span><span class="ident" id="5288802">syscallPC</span><span class="op" id="5288811">(</span><span class="op" id="5288812">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288815"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5288749">c</a></span><span class="op" id="5288816">.</span><span class="ident" id="5288817">ring</span>&nbsp;<span class="op" id="5288822">=</span>&nbsp;<span class="num" id="5288824">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288827">return</span>&nbsp;<span class="ident" id="5288834">nil</span><br>
<span class="lineno"></span><span class="op" id="5288838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5288841">//&nbsp;Iret&nbsp;restores&nbsp;from&nbsp;an&nbsp;interrupt.</span><br>
<span class="lineno">160</span><span class="comment" id="5288877">//&nbsp;It&nbsp;restores&nbsp;the&nbsp;SP,&nbsp;RET,&nbsp;PC&nbsp;registers,&nbsp;restores&nbsp;the&nbsp;ring&nbsp;level,</span><br>
<span class="lineno"></span><span class="comment" id="5288944">//&nbsp;clears&nbsp;the&nbsp;served&nbsp;interrupt&nbsp;bit&nbsp;and&nbsp;enables&nbsp;interrupt&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="5289008">func</span>&nbsp;<span class="op" id="5289013">(</span><span class="ident" id="5289014">c</span>&nbsp;<span class="op" id="5289016">*</span><span class="ident" id="5289017"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5289020">)</span>&nbsp;<span class="ident" id="5289022">Iret</span><span class="op" id="5289026">(</span><span class="op" id="5289027">)</span>&nbsp;<span class="op" id="5289029">*</span><span class="ident" id="5289030"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5289036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289039">if</span>&nbsp;<span class="ident" id="5289042"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289043">.</span><span class="ident" id="5289044">ring</span>&nbsp;<span class="op" id="5289049">!=</span>&nbsp;<span class="num" id="5289052">0</span>&nbsp;<span class="op" id="5289054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5289058">panic</span><span class="op" id="5289063">(</span><span class="string" id="5289064">&#34;iret&nbsp;in&nbsp;userland&#34;</span><span class="op" id="5289082">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289089">ksp</span>&nbsp;<span class="op" id="5289093">:=</span>&nbsp;<span class="ident" id="5289096"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289097">.</span><span class="ident" id="5289098">interrupt</span><span class="op" id="5289107">.</span><span class="ident" id="5289108">kernelSP</span><span class="op" id="5289116">(</span><span class="op" id="5289117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289120">base</span>&nbsp;<span class="op" id="5289125">:=</span>&nbsp;<span class="ident" id="5289128"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289089">ksp</a></span>&nbsp;<span class="op" id="5289132">-</span>&nbsp;<span class="ident" id="5289134"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287325">intFrameSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289148">sp</span><span class="op" id="5289150">,</span>&nbsp;<span class="ident" id="5289152">e</span>&nbsp;<span class="op" id="5289154">:=</span>&nbsp;<span class="ident" id="5289157"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289158">.</span><span class="ident" id="5289159">readWord</span><span class="op" id="5289167">(</span><span class="ident" id="5289168"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289120">base</a></span>&nbsp;<span class="op" id="5289173">+</span>&nbsp;<span class="ident" id="5289175"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287232">intFrameSP</a></span><span class="op" id="5289185">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289188">if</span>&nbsp;<span class="ident" id="5289191"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289193">!=</span>&nbsp;<span class="ident" id="5289196">nil</span>&nbsp;<span class="op" id="5289200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289204">return</span>&nbsp;<span class="ident" id="5289211"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289217">ret</span><span class="op" id="5289220">,</span>&nbsp;<span class="ident" id="5289222"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289224">:=</span>&nbsp;<span class="ident" id="5289227"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289228">.</span><span class="ident" id="5289229">readWord</span><span class="op" id="5289237">(</span><span class="ident" id="5289238"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289120">base</a></span>&nbsp;<span class="op" id="5289243">+</span>&nbsp;<span class="ident" id="5289245"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287250">intFrameRET</a></span><span class="op" id="5289256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289259">if</span>&nbsp;<span class="ident" id="5289262"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289264">!=</span>&nbsp;<span class="ident" id="5289267">nil</span>&nbsp;<span class="op" id="5289271">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289275">return</span>&nbsp;<span class="ident" id="5289282"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289288">code</span><span class="op" id="5289292">,</span>&nbsp;<span class="ident" id="5289294"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289296">:=</span>&nbsp;<span class="ident" id="5289299"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289300">.</span><span class="ident" id="5289301">readByte</span><span class="op" id="5289309">(</span><span class="ident" id="5289310"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289120">base</a></span>&nbsp;<span class="op" id="5289315">+</span>&nbsp;<span class="ident" id="5289317"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287286">intFrameCode</a></span><span class="op" id="5289329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289332">if</span>&nbsp;<span class="ident" id="5289335"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289337">!=</span>&nbsp;<span class="ident" id="5289340">nil</span>&nbsp;<span class="op" id="5289344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289348">return</span>&nbsp;<span class="ident" id="5289355"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289361">ring</span><span class="op" id="5289365">,</span>&nbsp;<span class="ident" id="5289367"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289369">:=</span>&nbsp;<span class="ident" id="5289372"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289373">.</span><span class="ident" id="5289374">readByte</span><span class="op" id="5289382">(</span><span class="ident" id="5289383"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289120">base</a></span>&nbsp;<span class="op" id="5289388">+</span>&nbsp;<span class="ident" id="5289390"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287305">intFrameRing</a></span><span class="op" id="5289402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289405">if</span>&nbsp;<span class="ident" id="5289408"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span>&nbsp;<span class="op" id="5289410">!=</span>&nbsp;<span class="ident" id="5289413">nil</span>&nbsp;<span class="op" id="5289417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289421">return</span>&nbsp;<span class="ident" id="5289428"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289152">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289431">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289435"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289436">.</span><span class="ident" id="5289437">regs</span><span class="op" id="5289441">[</span><span class="ident" id="5289442"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="5289444">]</span>&nbsp;<span class="op" id="5289446">=</span>&nbsp;<span class="ident" id="5289448"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289449">.</span><span class="ident" id="5289450">regs</span><span class="op" id="5289454">[</span><span class="ident" id="5289455"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311627">RET</a></span><span class="op" id="5289458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289461"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289462">.</span><span class="ident" id="5289463">regs</span><span class="op" id="5289467">[</span><span class="ident" id="5289468"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311627">RET</a></span><span class="op" id="5289471">]</span>&nbsp;<span class="op" id="5289473">=</span>&nbsp;<span class="ident" id="5289475"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289217">ret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289480"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289481">.</span><span class="ident" id="5289482">regs</span><span class="op" id="5289486">[</span><span class="ident" id="5289487"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311618">SP</a></span><span class="op" id="5289489">]</span>&nbsp;<span class="op" id="5289491">=</span>&nbsp;<span class="ident" id="5289493"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289148">sp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289497"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289498">.</span><span class="ident" id="5289499">ring</span>&nbsp;<span class="op" id="5289504">=</span>&nbsp;<span class="ident" id="5289506"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289361">ring</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289512"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289513">.</span><span class="ident" id="5289514">interrupt</span><span class="op" id="5289523">.</span><span class="ident" id="5289524">Clear</span><span class="op" id="5289529">(</span><span class="ident" id="5289530"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289288">code</a></span><span class="op" id="5289534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289537"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289014">c</a></span><span class="op" id="5289538">.</span><span class="ident" id="5289539">interrupt</span><span class="op" id="5289548">.</span><span class="ident" id="5289549">Enable</span><span class="op" id="5289555">(</span><span class="op" id="5289556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289560">return</span>&nbsp;<span class="ident" id="5289567">nil</span><br>
<span class="lineno"></span><span class="op" id="5289571">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5289574">//&nbsp;Tick&nbsp;executes&nbsp;one&nbsp;instruction,&nbsp;and&nbsp;increases&nbsp;the&nbsp;program&nbsp;counter</span><br>
<span class="lineno"></span><span class="comment" id="5289642">//&nbsp;by&nbsp;4&nbsp;by&nbsp;default.&nbsp;If&nbsp;an&nbsp;exception&nbsp;is&nbsp;met,&nbsp;it&nbsp;will&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5289705">func</span>&nbsp;<span class="op" id="5289710">(</span><span class="ident" id="5289711">c</span>&nbsp;<span class="op" id="5289713">*</span><span class="ident" id="5289714"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="5289717">)</span>&nbsp;<span class="ident" id="5289719">Tick</span><span class="op" id="5289723">(</span><span class="op" id="5289724">)</span>&nbsp;<span class="op" id="5289726">*</span><span class="ident" id="5289727"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="5289733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289736">poll</span><span class="op" id="5289740">,</span>&nbsp;<span class="ident" id="5289742">code</span>&nbsp;<span class="op" id="5289747">:=</span>&nbsp;<span class="ident" id="5289750"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5289751">.</span><span class="ident" id="5289752">interrupt</span><span class="op" id="5289761">.</span><span class="ident" id="5289762">Poll</span><span class="op" id="5289766">(</span><span class="op" id="5289767">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289770">if</span>&nbsp;<span class="ident" id="5289773"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289736">poll</a></span>&nbsp;<span class="op" id="5289778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289782">return</span>&nbsp;<span class="ident" id="5289789"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5289790">.</span><span class="ident" id="5289791">Ienter</span><span class="op" id="5289797">(</span><span class="ident" id="5289798"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289742">code</a></span><span class="op" id="5289802">,</span>&nbsp;<span class="num" id="5289804">0</span><span class="op" id="5289805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5289812">//&nbsp;no&nbsp;interrupt&nbsp;to&nbsp;dispatch,&nbsp;let&#39;s&nbsp;proceed</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289856">e</span>&nbsp;<span class="op" id="5289858">:=</span>&nbsp;<span class="ident" id="5289861"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5289862">.</span><span class="ident" id="5289863">tick</span><span class="op" id="5289867">(</span><span class="op" id="5289868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289871">if</span>&nbsp;<span class="ident" id="5289874"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289856">e</a></span>&nbsp;<span class="op" id="5289876">!=</span>&nbsp;<span class="ident" id="5289879">nil</span>&nbsp;<span class="op" id="5289883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5289887">//&nbsp;proceed&nbsp;attempt&nbsp;failed,&nbsp;handle&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289933"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5289934">.</span><span class="ident" id="5289935">interrupt</span><span class="op" id="5289944">.</span><span class="ident" id="5289945">Issue</span><span class="op" id="5289950">(</span><span class="ident" id="5289951"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289856">e</a></span><span class="op" id="5289952">.</span><span class="ident" id="5289953">Code</span><span class="op" id="5289957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289961">poll</span><span class="op" id="5289965">,</span>&nbsp;<span class="ident" id="5289967">code</span>&nbsp;<span class="op" id="5289972">:=</span>&nbsp;<span class="ident" id="5289975"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5289976">.</span><span class="ident" id="5289977">interrupt</span><span class="op" id="5289986">.</span><span class="ident" id="5289987">Poll</span><span class="op" id="5289991">(</span><span class="op" id="5289992">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289996">if</span>&nbsp;<span class="ident" id="5289999"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289961">poll</a></span>&nbsp;<span class="op" id="5290004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290009">if</span>&nbsp;<span class="ident" id="5290012"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289967">code</a></span>&nbsp;<span class="op" id="5290017">!=</span>&nbsp;<span class="ident" id="5290020"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289856">e</a></span><span class="op" id="5290021">.</span><span class="ident" id="5290022">Code</span>&nbsp;<span class="op" id="5290027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5290033">panic</span><span class="op" id="5290038">(</span><span class="string" id="5290039">&#34;interrupt&nbsp;code&nbsp;is&nbsp;different&#34;</span><span class="op" id="5290068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290078">return</span>&nbsp;<span class="ident" id="5290085"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289711">c</a></span><span class="op" id="5290086">.</span><span class="ident" id="5290087">Ienter</span><span class="op" id="5290093">(</span><span class="ident" id="5290094"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289967">code</a></span><span class="op" id="5290098">,</span>&nbsp;<span class="ident" id="5290100"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289856">e</a></span><span class="op" id="5290101">.</span><span class="ident" id="5290102">Arg</span><span class="op" id="5290105">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290116">return</span>&nbsp;<span class="ident" id="5290123"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5289856">e</a></span><br>
<span class="lineno"></span><span class="op" id="5290125">}</span>
</div>
</body>
</html>
