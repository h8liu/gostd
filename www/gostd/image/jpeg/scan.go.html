<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5913853">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5913908">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5913962">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5914013">package</span>&nbsp;<span class="ident" id="5914021">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5914027">import</span>&nbsp;<span class="op" id="5914034">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5914037">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5914045">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5914048">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5914108">func</span>&nbsp;<span class="op" id="5914113">(</span><span class="ident" id="5914114">d</span>&nbsp;<span class="op" id="5914116">*</span><span class="ident" id="5914117">decoder</span><span class="op" id="5914124">)</span>&nbsp;<span class="ident" id="5914126">makeImg</span><span class="op" id="5914133">(</span><span class="ident" id="5914134">h0</span><span class="op" id="5914136">,</span>&nbsp;<span class="ident" id="5914138">v0</span><span class="op" id="5914140">,</span>&nbsp;<span class="ident" id="5914142">mxx</span><span class="op" id="5914145">,</span>&nbsp;<span class="ident" id="5914147">myy</span>&nbsp;<span class="builtintype" id="5914151">int</span><span class="op" id="5914154">)</span>&nbsp;<span class="op" id="5914156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914159">if</span>&nbsp;<span class="ident" id="5914162">d</span><span class="op" id="5914163">.</span><span class="ident" id="5914164">nComp</span>&nbsp;<span class="op" id="5914170">==</span>&nbsp;<span class="ident" id="5914173">nGrayComponent</span>&nbsp;<span class="op" id="5914188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914192">m</span>&nbsp;<span class="op" id="5914194">:=</span>&nbsp;<span class="ident" id="5914197">image</span><span class="op" id="5914202">.</span><span class="ident" id="5914203">NewGray</span><span class="op" id="5914210">(</span><span class="ident" id="5914211">image</span><span class="op" id="5914216">.</span><span class="ident" id="5914217">Rect</span><span class="op" id="5914221">(</span><span class="num" id="5914222">0</span><span class="op" id="5914223">,</span>&nbsp;<span class="num" id="5914225">0</span><span class="op" id="5914226">,</span>&nbsp;<span class="num" id="5914228">8</span><span class="op" id="5914229">*</span><span class="ident" id="5914230">mxx</span><span class="op" id="5914233">,</span>&nbsp;<span class="num" id="5914235">8</span><span class="op" id="5914236">*</span><span class="ident" id="5914237">myy</span><span class="op" id="5914240">)</span><span class="op" id="5914241">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914245">d</span><span class="op" id="5914246">.</span><span class="ident" id="5914247">img1</span>&nbsp;<span class="op" id="5914252">=</span>&nbsp;<span class="ident" id="5914254">m</span><span class="op" id="5914255">.</span><span class="ident" id="5914256">SubImage</span><span class="op" id="5914264">(</span><span class="ident" id="5914265">image</span><span class="op" id="5914270">.</span><span class="ident" id="5914271">Rect</span><span class="op" id="5914275">(</span><span class="num" id="5914276">0</span><span class="op" id="5914277">,</span>&nbsp;<span class="num" id="5914279">0</span><span class="op" id="5914280">,</span>&nbsp;<span class="ident" id="5914282">d</span><span class="op" id="5914283">.</span><span class="ident" id="5914284">width</span><span class="op" id="5914289">,</span>&nbsp;<span class="ident" id="5914291">d</span><span class="op" id="5914292">.</span><span class="ident" id="5914293">height</span><span class="op" id="5914299">)</span><span class="op" id="5914300">)</span><span class="op" id="5914301">.</span><span class="op" id="5914302">(</span><span class="op" id="5914303">*</span><span class="ident" id="5914304">image</span><span class="op" id="5914309">.</span><span class="ident" id="5914310">Gray</span><span class="op" id="5914314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914318">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914329">var</span>&nbsp;<span class="ident" id="5914333">subsampleRatio</span>&nbsp;<span class="ident" id="5914348">image</span><span class="op" id="5914353">.</span><span class="ident" id="5914354">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914375">switch</span>&nbsp;<span class="op" id="5914382">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914385">case</span>&nbsp;<span class="ident" id="5914390">h0</span>&nbsp;<span class="op" id="5914393">==</span>&nbsp;<span class="num" id="5914396">1</span>&nbsp;<span class="op" id="5914398">&amp;&amp;</span>&nbsp;<span class="ident" id="5914401">v0</span>&nbsp;<span class="op" id="5914404">==</span>&nbsp;<span class="num" id="5914407">1</span><span class="op" id="5914408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914412">subsampleRatio</span>&nbsp;<span class="op" id="5914427">=</span>&nbsp;<span class="ident" id="5914429">image</span><span class="op" id="5914434">.</span><span class="ident" id="5914435">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914459">case</span>&nbsp;<span class="ident" id="5914464">h0</span>&nbsp;<span class="op" id="5914467">==</span>&nbsp;<span class="num" id="5914470">1</span>&nbsp;<span class="op" id="5914472">&amp;&amp;</span>&nbsp;<span class="ident" id="5914475">v0</span>&nbsp;<span class="op" id="5914478">==</span>&nbsp;<span class="num" id="5914481">2</span><span class="op" id="5914482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914486">subsampleRatio</span>&nbsp;<span class="op" id="5914501">=</span>&nbsp;<span class="ident" id="5914503">image</span><span class="op" id="5914508">.</span><span class="ident" id="5914509">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914533">case</span>&nbsp;<span class="ident" id="5914538">h0</span>&nbsp;<span class="op" id="5914541">==</span>&nbsp;<span class="num" id="5914544">2</span>&nbsp;<span class="op" id="5914546">&amp;&amp;</span>&nbsp;<span class="ident" id="5914549">v0</span>&nbsp;<span class="op" id="5914552">==</span>&nbsp;<span class="num" id="5914555">1</span><span class="op" id="5914556">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914560">subsampleRatio</span>&nbsp;<span class="op" id="5914575">=</span>&nbsp;<span class="ident" id="5914577">image</span><span class="op" id="5914582">.</span><span class="ident" id="5914583">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914607">case</span>&nbsp;<span class="ident" id="5914612">h0</span>&nbsp;<span class="op" id="5914615">==</span>&nbsp;<span class="num" id="5914618">2</span>&nbsp;<span class="op" id="5914620">&amp;&amp;</span>&nbsp;<span class="ident" id="5914623">v0</span>&nbsp;<span class="op" id="5914626">==</span>&nbsp;<span class="num" id="5914629">2</span><span class="op" id="5914630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914634">subsampleRatio</span>&nbsp;<span class="op" id="5914649">=</span>&nbsp;<span class="ident" id="5914651">image</span><span class="op" id="5914656">.</span><span class="ident" id="5914657">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914681">default</span><span class="op" id="5914688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5914692">panic</span><span class="op" id="5914697">(</span><span class="string" id="5914698">&#34;unreachable&#34;</span><span class="op" id="5914711">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914717">m</span>&nbsp;<span class="op" id="5914719">:=</span>&nbsp;<span class="ident" id="5914722">image</span><span class="op" id="5914727">.</span><span class="ident" id="5914728">NewYCbCr</span><span class="op" id="5914736">(</span><span class="ident" id="5914737">image</span><span class="op" id="5914742">.</span><span class="ident" id="5914743">Rect</span><span class="op" id="5914747">(</span><span class="num" id="5914748">0</span><span class="op" id="5914749">,</span>&nbsp;<span class="num" id="5914751">0</span><span class="op" id="5914752">,</span>&nbsp;<span class="num" id="5914754">8</span><span class="op" id="5914755">*</span><span class="ident" id="5914756">h0</span><span class="op" id="5914758">*</span><span class="ident" id="5914759">mxx</span><span class="op" id="5914762">,</span>&nbsp;<span class="num" id="5914764">8</span><span class="op" id="5914765">*</span><span class="ident" id="5914766">v0</span><span class="op" id="5914768">*</span><span class="ident" id="5914769">myy</span><span class="op" id="5914772">)</span><span class="op" id="5914773">,</span>&nbsp;<span class="ident" id="5914775">subsampleRatio</span><span class="op" id="5914789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914792">d</span><span class="op" id="5914793">.</span><span class="ident" id="5914794">img3</span>&nbsp;<span class="op" id="5914799">=</span>&nbsp;<span class="ident" id="5914801">m</span><span class="op" id="5914802">.</span><span class="ident" id="5914803">SubImage</span><span class="op" id="5914811">(</span><span class="ident" id="5914812">image</span><span class="op" id="5914817">.</span><span class="ident" id="5914818">Rect</span><span class="op" id="5914822">(</span><span class="num" id="5914823">0</span><span class="op" id="5914824">,</span>&nbsp;<span class="num" id="5914826">0</span><span class="op" id="5914827">,</span>&nbsp;<span class="ident" id="5914829">d</span><span class="op" id="5914830">.</span><span class="ident" id="5914831">width</span><span class="op" id="5914836">,</span>&nbsp;<span class="ident" id="5914838">d</span><span class="op" id="5914839">.</span><span class="ident" id="5914840">height</span><span class="op" id="5914846">)</span><span class="op" id="5914847">)</span><span class="op" id="5914848">.</span><span class="op" id="5914849">(</span><span class="op" id="5914850">*</span><span class="ident" id="5914851">image</span><span class="op" id="5914856">.</span><span class="ident" id="5914857">YCbCr</span><span class="op" id="5914862">)</span><br>
<span class="lineno"></span><span class="op" id="5914864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5914867">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5914898">func</span>&nbsp;<span class="op" id="5914903">(</span><span class="ident" id="5914904">d</span>&nbsp;<span class="op" id="5914906">*</span><span class="ident" id="5914907">decoder</span><span class="op" id="5914914">)</span>&nbsp;<span class="ident" id="5914916">processSOS</span><span class="op" id="5914926">(</span><span class="ident" id="5914927">n</span>&nbsp;<span class="builtintype" id="5914929">int</span><span class="op" id="5914932">)</span>&nbsp;<span class="builtintype" id="5914934">error</span>&nbsp;<span class="op" id="5914940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914943">if</span>&nbsp;<span class="ident" id="5914946">d</span><span class="op" id="5914947">.</span><span class="ident" id="5914948">nComp</span>&nbsp;<span class="op" id="5914954">==</span>&nbsp;<span class="num" id="5914957">0</span>&nbsp;<span class="op" id="5914959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914963">return</span>&nbsp;<span class="ident" id="5914970">FormatError</span><span class="op" id="5914981">(</span><span class="string" id="5914982">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5915002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915005">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915008">if</span>&nbsp;<span class="ident" id="5915011">n</span>&nbsp;<span class="op" id="5915013">&lt;</span>&nbsp;<span class="num" id="5915015">6</span>&nbsp;<span class="op" id="5915017">||</span>&nbsp;<span class="num" id="5915020">4</span><span class="op" id="5915021">+</span><span class="num" id="5915022">2</span><span class="op" id="5915023">*</span><span class="ident" id="5915024">d</span><span class="op" id="5915025">.</span><span class="ident" id="5915026">nComp</span>&nbsp;<span class="op" id="5915032">&lt;</span>&nbsp;<span class="ident" id="5915034">n</span>&nbsp;<span class="op" id="5915036">||</span>&nbsp;<span class="ident" id="5915039">n</span><span class="op" id="5915040">%</span><span class="num" id="5915041">2</span>&nbsp;<span class="op" id="5915043">!=</span>&nbsp;<span class="num" id="5915046">0</span>&nbsp;<span class="op" id="5915048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915052">return</span>&nbsp;<span class="ident" id="5915059">FormatError</span><span class="op" id="5915070">(</span><span class="string" id="5915071">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5915093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915099">if</span>&nbsp;<span class="ident" id="5915102">err</span>&nbsp;<span class="op" id="5915106">:=</span>&nbsp;<span class="ident" id="5915109">d</span><span class="op" id="5915110">.</span><span class="ident" id="5915111">readFull</span><span class="op" id="5915119">(</span><span class="ident" id="5915120">d</span><span class="op" id="5915121">.</span><span class="ident" id="5915122">tmp</span><span class="op" id="5915125">[</span><span class="op" id="5915126">:</span><span class="ident" id="5915127">n</span><span class="op" id="5915128">]</span><span class="op" id="5915129">)</span><span class="op" id="5915130">;</span>&nbsp;<span class="ident" id="5915132">err</span>&nbsp;<span class="op" id="5915136">!=</span>&nbsp;<span class="ident" id="5915139">nil</span>&nbsp;<span class="op" id="5915143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915147">return</span>&nbsp;<span class="ident" id="5915154">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915162">nComp</span>&nbsp;<span class="op" id="5915168">:=</span>&nbsp;<span class="builtintype" id="5915171">int</span><span class="op" id="5915174">(</span><span class="ident" id="5915175">d</span><span class="op" id="5915176">.</span><span class="ident" id="5915177">tmp</span><span class="op" id="5915180">[</span><span class="num" id="5915181">0</span><span class="op" id="5915182">]</span><span class="op" id="5915183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915186">if</span>&nbsp;<span class="ident" id="5915189">n</span>&nbsp;<span class="op" id="5915191">!=</span>&nbsp;<span class="num" id="5915194">4</span><span class="op" id="5915195">+</span><span class="num" id="5915196">2</span><span class="op" id="5915197">*</span><span class="ident" id="5915198">nComp</span>&nbsp;<span class="op" id="5915204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915208">return</span>&nbsp;<span class="ident" id="5915215">FormatError</span><span class="op" id="5915226">(</span><span class="string" id="5915227">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5915278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915281">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915284">var</span>&nbsp;<span class="ident" id="5915288">scan</span>&nbsp;<span class="op" id="5915293">[</span><span class="ident" id="5915294">nColorComponent</span><span class="op" id="5915309">]</span><span class="keyword" id="5915310">struct</span>&nbsp;<span class="op" id="5915317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915321">compIndex</span>&nbsp;<span class="builtintype" id="5915331">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915339">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5915349">uint8</span>&nbsp;<span class="comment" id="5915355">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915379">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5915389">uint8</span>&nbsp;<span class="comment" id="5915395">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915418">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915421">for</span>&nbsp;<span class="ident" id="5915425">i</span>&nbsp;<span class="op" id="5915427">:=</span>&nbsp;<span class="num" id="5915430">0</span><span class="op" id="5915431">;</span>&nbsp;<span class="ident" id="5915433">i</span>&nbsp;<span class="op" id="5915435">&lt;</span>&nbsp;<span class="ident" id="5915437">nComp</span><span class="op" id="5915442">;</span>&nbsp;<span class="ident" id="5915444">i</span><span class="op" id="5915445">++</span>&nbsp;<span class="op" id="5915448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915452">cs</span>&nbsp;<span class="op" id="5915455">:=</span>&nbsp;<span class="ident" id="5915458">d</span><span class="op" id="5915459">.</span><span class="ident" id="5915460">tmp</span><span class="op" id="5915463">[</span><span class="num" id="5915464">1</span><span class="op" id="5915465">+</span><span class="num" id="5915466">2</span><span class="op" id="5915467">*</span><span class="ident" id="5915468">i</span><span class="op" id="5915469">]</span>&nbsp;<span class="comment" id="5915471">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915496">compIndex</span>&nbsp;<span class="op" id="5915506">:=</span>&nbsp;<span class="op" id="5915509">-</span><span class="num" id="5915510">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915514">for</span>&nbsp;<span class="ident" id="5915518">j</span><span class="op" id="5915519">,</span>&nbsp;<span class="ident" id="5915521">comp</span>&nbsp;<span class="op" id="5915526">:=</span>&nbsp;<span class="keyword" id="5915529">range</span>&nbsp;<span class="ident" id="5915535">d</span><span class="op" id="5915536">.</span><span class="ident" id="5915537">comp</span>&nbsp;<span class="op" id="5915542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915547">if</span>&nbsp;<span class="ident" id="5915550">cs</span>&nbsp;<span class="op" id="5915553">==</span>&nbsp;<span class="ident" id="5915556">comp</span><span class="op" id="5915560">.</span><span class="ident" id="5915561">c</span>&nbsp;<span class="op" id="5915563">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915569">compIndex</span>&nbsp;<span class="op" id="5915579">=</span>&nbsp;<span class="ident" id="5915581">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915594">if</span>&nbsp;<span class="ident" id="5915597">compIndex</span>&nbsp;<span class="op" id="5915607">&lt;</span>&nbsp;<span class="num" id="5915609">0</span>&nbsp;<span class="op" id="5915611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915616">return</span>&nbsp;<span class="ident" id="5915623">FormatError</span><span class="op" id="5915634">(</span><span class="string" id="5915635">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5915663">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915671">scan</span><span class="op" id="5915675">[</span><span class="ident" id="5915676">i</span><span class="op" id="5915677">]</span><span class="op" id="5915678">.</span><span class="ident" id="5915679">compIndex</span>&nbsp;<span class="op" id="5915689">=</span>&nbsp;<span class="builtintype" id="5915691">uint8</span><span class="op" id="5915696">(</span><span class="ident" id="5915697">compIndex</span><span class="op" id="5915706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915710">scan</span><span class="op" id="5915714">[</span><span class="ident" id="5915715">i</span><span class="op" id="5915716">]</span><span class="op" id="5915717">.</span><span class="ident" id="5915718">td</span>&nbsp;<span class="op" id="5915721">=</span>&nbsp;<span class="ident" id="5915723">d</span><span class="op" id="5915724">.</span><span class="ident" id="5915725">tmp</span><span class="op" id="5915728">[</span><span class="num" id="5915729">2</span><span class="op" id="5915730">+</span><span class="num" id="5915731">2</span><span class="op" id="5915732">*</span><span class="ident" id="5915733">i</span><span class="op" id="5915734">]</span>&nbsp;<span class="op" id="5915736">&gt;&gt;</span>&nbsp;<span class="num" id="5915739">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915743">if</span>&nbsp;<span class="ident" id="5915746">scan</span><span class="op" id="5915750">[</span><span class="ident" id="5915751">i</span><span class="op" id="5915752">]</span><span class="op" id="5915753">.</span><span class="ident" id="5915754">td</span>&nbsp;<span class="op" id="5915757">&gt;</span>&nbsp;<span class="ident" id="5915759">maxTh</span>&nbsp;<span class="op" id="5915765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915770">return</span>&nbsp;<span class="ident" id="5915777">FormatError</span><span class="op" id="5915788">(</span><span class="string" id="5915789">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5915803">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915811">scan</span><span class="op" id="5915815">[</span><span class="ident" id="5915816">i</span><span class="op" id="5915817">]</span><span class="op" id="5915818">.</span><span class="ident" id="5915819">ta</span>&nbsp;<span class="op" id="5915822">=</span>&nbsp;<span class="ident" id="5915824">d</span><span class="op" id="5915825">.</span><span class="ident" id="5915826">tmp</span><span class="op" id="5915829">[</span><span class="num" id="5915830">2</span><span class="op" id="5915831">+</span><span class="num" id="5915832">2</span><span class="op" id="5915833">*</span><span class="ident" id="5915834">i</span><span class="op" id="5915835">]</span>&nbsp;<span class="op" id="5915837">&amp;</span>&nbsp;<span class="num" id="5915839">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915846">if</span>&nbsp;<span class="ident" id="5915849">scan</span><span class="op" id="5915853">[</span><span class="ident" id="5915854">i</span><span class="op" id="5915855">]</span><span class="op" id="5915856">.</span><span class="ident" id="5915857">ta</span>&nbsp;<span class="op" id="5915860">&gt;</span>&nbsp;<span class="ident" id="5915862">maxTh</span>&nbsp;<span class="op" id="5915868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915873">return</span>&nbsp;<span class="ident" id="5915880">FormatError</span><span class="op" id="5915891">(</span><span class="string" id="5915892">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5915906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915910">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915917">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915976">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916044">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916095">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916099">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916169">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916240">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916310">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916377">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916445">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916514">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916581">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916651">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916714">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916735">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916739">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916808">zigStart</span><span class="op" id="5916816">,</span>&nbsp;<span class="ident" id="5916818">zigEnd</span><span class="op" id="5916824">,</span>&nbsp;<span class="ident" id="5916826">ah</span><span class="op" id="5916828">,</span>&nbsp;<span class="ident" id="5916830">al</span>&nbsp;<span class="op" id="5916833">:=</span>&nbsp;<span class="builtintype" id="5916836">int32</span><span class="op" id="5916841">(</span><span class="num" id="5916842">0</span><span class="op" id="5916843">)</span><span class="op" id="5916844">,</span>&nbsp;<span class="builtintype" id="5916846">int32</span><span class="op" id="5916851">(</span><span class="ident" id="5916852">blockSize</span><span class="op" id="5916861">-</span><span class="num" id="5916862">1</span><span class="op" id="5916863">)</span><span class="op" id="5916864">,</span>&nbsp;<span class="builtintype" id="5916866">uint32</span><span class="op" id="5916872">(</span><span class="num" id="5916873">0</span><span class="op" id="5916874">)</span><span class="op" id="5916875">,</span>&nbsp;<span class="builtintype" id="5916877">uint32</span><span class="op" id="5916883">(</span><span class="num" id="5916884">0</span><span class="op" id="5916885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916888">if</span>&nbsp;<span class="ident" id="5916891">d</span><span class="op" id="5916892">.</span><span class="ident" id="5916893">progressive</span>&nbsp;<span class="op" id="5916905">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916909">zigStart</span>&nbsp;<span class="op" id="5916918">=</span>&nbsp;<span class="builtintype" id="5916920">int32</span><span class="op" id="5916925">(</span><span class="ident" id="5916926">d</span><span class="op" id="5916927">.</span><span class="ident" id="5916928">tmp</span><span class="op" id="5916931">[</span><span class="num" id="5916932">1</span><span class="op" id="5916933">+</span><span class="num" id="5916934">2</span><span class="op" id="5916935">*</span><span class="ident" id="5916936">nComp</span><span class="op" id="5916941">]</span><span class="op" id="5916942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916946">zigEnd</span>&nbsp;<span class="op" id="5916953">=</span>&nbsp;<span class="builtintype" id="5916955">int32</span><span class="op" id="5916960">(</span><span class="ident" id="5916961">d</span><span class="op" id="5916962">.</span><span class="ident" id="5916963">tmp</span><span class="op" id="5916966">[</span><span class="num" id="5916967">2</span><span class="op" id="5916968">+</span><span class="num" id="5916969">2</span><span class="op" id="5916970">*</span><span class="ident" id="5916971">nComp</span><span class="op" id="5916976">]</span><span class="op" id="5916977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916981">ah</span>&nbsp;<span class="op" id="5916984">=</span>&nbsp;<span class="builtintype" id="5916986">uint32</span><span class="op" id="5916992">(</span><span class="ident" id="5916993">d</span><span class="op" id="5916994">.</span><span class="ident" id="5916995">tmp</span><span class="op" id="5916998">[</span><span class="num" id="5916999">3</span><span class="op" id="5917000">+</span><span class="num" id="5917001">2</span><span class="op" id="5917002">*</span><span class="ident" id="5917003">nComp</span><span class="op" id="5917008">]</span>&nbsp;<span class="op" id="5917010">&gt;&gt;</span>&nbsp;<span class="num" id="5917013">4</span><span class="op" id="5917014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917018">al</span>&nbsp;<span class="op" id="5917021">=</span>&nbsp;<span class="builtintype" id="5917023">uint32</span><span class="op" id="5917029">(</span><span class="ident" id="5917030">d</span><span class="op" id="5917031">.</span><span class="ident" id="5917032">tmp</span><span class="op" id="5917035">[</span><span class="num" id="5917036">3</span><span class="op" id="5917037">+</span><span class="num" id="5917038">2</span><span class="op" id="5917039">*</span><span class="ident" id="5917040">nComp</span><span class="op" id="5917045">]</span>&nbsp;<span class="op" id="5917047">&amp;</span>&nbsp;<span class="num" id="5917049">0x0f</span><span class="op" id="5917053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917057">if</span>&nbsp;<span class="op" id="5917060">(</span><span class="ident" id="5917061">zigStart</span>&nbsp;<span class="op" id="5917070">==</span>&nbsp;<span class="num" id="5917073">0</span>&nbsp;<span class="op" id="5917075">&amp;&amp;</span>&nbsp;<span class="ident" id="5917078">zigEnd</span>&nbsp;<span class="op" id="5917085">!=</span>&nbsp;<span class="num" id="5917088">0</span><span class="op" id="5917089">)</span>&nbsp;<span class="op" id="5917091">||</span>&nbsp;<span class="ident" id="5917094">zigStart</span>&nbsp;<span class="op" id="5917103">&gt;</span>&nbsp;<span class="ident" id="5917105">zigEnd</span>&nbsp;<span class="op" id="5917112">||</span>&nbsp;<span class="ident" id="5917115">blockSize</span>&nbsp;<span class="op" id="5917125">&lt;=</span>&nbsp;<span class="ident" id="5917128">zigEnd</span>&nbsp;<span class="op" id="5917135">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917140">return</span>&nbsp;<span class="ident" id="5917147">FormatError</span><span class="op" id="5917158">(</span><span class="string" id="5917159">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5917190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917198">if</span>&nbsp;<span class="ident" id="5917201">zigStart</span>&nbsp;<span class="op" id="5917210">!=</span>&nbsp;<span class="num" id="5917213">0</span>&nbsp;<span class="op" id="5917215">&amp;&amp;</span>&nbsp;<span class="ident" id="5917218">nComp</span>&nbsp;<span class="op" id="5917224">!=</span>&nbsp;<span class="num" id="5917227">1</span>&nbsp;<span class="op" id="5917229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917234">return</span>&nbsp;<span class="ident" id="5917241">FormatError</span><span class="op" id="5917252">(</span><span class="string" id="5917253">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5917310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917314">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917318">if</span>&nbsp;<span class="ident" id="5917321">ah</span>&nbsp;<span class="op" id="5917324">!=</span>&nbsp;<span class="num" id="5917327">0</span>&nbsp;<span class="op" id="5917329">&amp;&amp;</span>&nbsp;<span class="ident" id="5917332">ah</span>&nbsp;<span class="op" id="5917335">!=</span>&nbsp;<span class="ident" id="5917338">al</span><span class="op" id="5917340">+</span><span class="num" id="5917341">1</span>&nbsp;<span class="op" id="5917343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917348">return</span>&nbsp;<span class="ident" id="5917355">FormatError</span><span class="op" id="5917366">(</span><span class="string" id="5917367">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5917404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917415">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917490">h0</span><span class="op" id="5917492">,</span>&nbsp;<span class="ident" id="5917494">v0</span>&nbsp;<span class="op" id="5917497">:=</span>&nbsp;<span class="ident" id="5917500">d</span><span class="op" id="5917501">.</span><span class="ident" id="5917502">comp</span><span class="op" id="5917506">[</span><span class="num" id="5917507">0</span><span class="op" id="5917508">]</span><span class="op" id="5917509">.</span><span class="ident" id="5917510">h</span><span class="op" id="5917511">,</span>&nbsp;<span class="ident" id="5917513">d</span><span class="op" id="5917514">.</span><span class="ident" id="5917515">comp</span><span class="op" id="5917519">[</span><span class="num" id="5917520">0</span><span class="op" id="5917521">]</span><span class="op" id="5917522">.</span><span class="ident" id="5917523">v</span>&nbsp;<span class="comment" id="5917525">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917571">mxx</span>&nbsp;<span class="op" id="5917575">:=</span>&nbsp;<span class="op" id="5917578">(</span><span class="ident" id="5917579">d</span><span class="op" id="5917580">.</span><span class="ident" id="5917581">width</span>&nbsp;<span class="op" id="5917587">+</span>&nbsp;<span class="num" id="5917589">8</span><span class="op" id="5917590">*</span><span class="ident" id="5917591">h0</span>&nbsp;<span class="op" id="5917594">-</span>&nbsp;<span class="num" id="5917596">1</span><span class="op" id="5917597">)</span>&nbsp;<span class="op" id="5917599">/</span>&nbsp;<span class="op" id="5917601">(</span><span class="num" id="5917602">8</span>&nbsp;<span class="op" id="5917604">*</span>&nbsp;<span class="ident" id="5917606">h0</span><span class="op" id="5917608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917611">myy</span>&nbsp;<span class="op" id="5917615">:=</span>&nbsp;<span class="op" id="5917618">(</span><span class="ident" id="5917619">d</span><span class="op" id="5917620">.</span><span class="ident" id="5917621">height</span>&nbsp;<span class="op" id="5917628">+</span>&nbsp;<span class="num" id="5917630">8</span><span class="op" id="5917631">*</span><span class="ident" id="5917632">v0</span>&nbsp;<span class="op" id="5917635">-</span>&nbsp;<span class="num" id="5917637">1</span><span class="op" id="5917638">)</span>&nbsp;<span class="op" id="5917640">/</span>&nbsp;<span class="op" id="5917642">(</span><span class="num" id="5917643">8</span>&nbsp;<span class="op" id="5917645">*</span>&nbsp;<span class="ident" id="5917647">v0</span><span class="op" id="5917649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917652">if</span>&nbsp;<span class="ident" id="5917655">d</span><span class="op" id="5917656">.</span><span class="ident" id="5917657">img1</span>&nbsp;<span class="op" id="5917662">==</span>&nbsp;<span class="ident" id="5917665">nil</span>&nbsp;<span class="op" id="5917669">&amp;&amp;</span>&nbsp;<span class="ident" id="5917672">d</span><span class="op" id="5917673">.</span><span class="ident" id="5917674">img3</span>&nbsp;<span class="op" id="5917679">==</span>&nbsp;<span class="ident" id="5917682">nil</span>&nbsp;<span class="op" id="5917686">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917690">d</span><span class="op" id="5917691">.</span><span class="ident" id="5917692">makeImg</span><span class="op" id="5917699">(</span><span class="ident" id="5917700">h0</span><span class="op" id="5917702">,</span>&nbsp;<span class="ident" id="5917704">v0</span><span class="op" id="5917706">,</span>&nbsp;<span class="ident" id="5917708">mxx</span><span class="op" id="5917711">,</span>&nbsp;<span class="ident" id="5917713">myy</span><span class="op" id="5917716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917722">if</span>&nbsp;<span class="ident" id="5917725">d</span><span class="op" id="5917726">.</span><span class="ident" id="5917727">progressive</span>&nbsp;<span class="op" id="5917739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917743">for</span>&nbsp;<span class="ident" id="5917747">i</span>&nbsp;<span class="op" id="5917749">:=</span>&nbsp;<span class="num" id="5917752">0</span><span class="op" id="5917753">;</span>&nbsp;<span class="ident" id="5917755">i</span>&nbsp;<span class="op" id="5917757">&lt;</span>&nbsp;<span class="ident" id="5917759">nComp</span><span class="op" id="5917764">;</span>&nbsp;<span class="ident" id="5917766">i</span><span class="op" id="5917767">++</span>&nbsp;<span class="op" id="5917770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917775">compIndex</span>&nbsp;<span class="op" id="5917785">:=</span>&nbsp;<span class="ident" id="5917788">scan</span><span class="op" id="5917792">[</span><span class="ident" id="5917793">i</span><span class="op" id="5917794">]</span><span class="op" id="5917795">.</span><span class="ident" id="5917796">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917809">if</span>&nbsp;<span class="ident" id="5917812">d</span><span class="op" id="5917813">.</span><span class="ident" id="5917814">progCoeffs</span><span class="op" id="5917824">[</span><span class="ident" id="5917825">compIndex</span><span class="op" id="5917834">]</span>&nbsp;<span class="op" id="5917836">==</span>&nbsp;<span class="ident" id="5917839">nil</span>&nbsp;<span class="op" id="5917843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917849">d</span><span class="op" id="5917850">.</span><span class="ident" id="5917851">progCoeffs</span><span class="op" id="5917861">[</span><span class="ident" id="5917862">compIndex</span><span class="op" id="5917871">]</span>&nbsp;<span class="op" id="5917873">=</span>&nbsp;<span class="builtinfunc" id="5917875">make</span><span class="op" id="5917879">(</span><span class="op" id="5917880">[</span><span class="op" id="5917881">]</span><span class="ident" id="5917882">block</span><span class="op" id="5917887">,</span>&nbsp;<span class="ident" id="5917889">mxx</span><span class="op" id="5917892">*</span><span class="ident" id="5917893">myy</span><span class="op" id="5917896">*</span><span class="ident" id="5917897">d</span><span class="op" id="5917898">.</span><span class="ident" id="5917899">comp</span><span class="op" id="5917903">[</span><span class="ident" id="5917904">compIndex</span><span class="op" id="5917913">]</span><span class="op" id="5917914">.</span><span class="ident" id="5917915">h</span><span class="op" id="5917916">*</span><span class="ident" id="5917917">d</span><span class="op" id="5917918">.</span><span class="ident" id="5917919">comp</span><span class="op" id="5917923">[</span><span class="ident" id="5917924">compIndex</span><span class="op" id="5917933">]</span><span class="op" id="5917934">.</span><span class="ident" id="5917935">v</span><span class="op" id="5917936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917948">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917952">d</span><span class="op" id="5917953">.</span><span class="ident" id="5917954">bits</span>&nbsp;<span class="op" id="5917959">=</span>&nbsp;<span class="ident" id="5917961">bits</span><span class="op" id="5917965">{</span><span class="op" id="5917966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917969">mcu</span><span class="op" id="5917972">,</span>&nbsp;<span class="ident" id="5917974">expectedRST</span>&nbsp;<span class="op" id="5917986">:=</span>&nbsp;<span class="num" id="5917989">0</span><span class="op" id="5917990">,</span>&nbsp;<span class="builtintype" id="5917992">uint8</span><span class="op" id="5917997">(</span><span class="ident" id="5917998">rst0Marker</span><span class="op" id="5918008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918011">var</span>&nbsp;<span class="op" id="5918015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918019">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918087">b</span>&nbsp;&nbsp;<span class="ident" id="5918090">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918098">dc</span>&nbsp;<span class="op" id="5918101">[</span><span class="ident" id="5918102">nColorComponent</span><span class="op" id="5918117">]</span><span class="builtintype" id="5918118">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918126">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918199">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918273">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918346">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918416">bx</span><span class="op" id="5918418">,</span>&nbsp;<span class="ident" id="5918420">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5918427">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918433">blockCount</span>&nbsp;<span class="builtintype" id="5918444">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918452">for</span>&nbsp;<span class="ident" id="5918456">my</span>&nbsp;<span class="op" id="5918459">:=</span>&nbsp;<span class="num" id="5918462">0</span><span class="op" id="5918463">;</span>&nbsp;<span class="ident" id="5918465">my</span>&nbsp;<span class="op" id="5918468">&lt;</span>&nbsp;<span class="ident" id="5918470">myy</span><span class="op" id="5918473">;</span>&nbsp;<span class="ident" id="5918475">my</span><span class="op" id="5918477">++</span>&nbsp;<span class="op" id="5918480">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918484">for</span>&nbsp;<span class="ident" id="5918488">mx</span>&nbsp;<span class="op" id="5918491">:=</span>&nbsp;<span class="num" id="5918494">0</span><span class="op" id="5918495">;</span>&nbsp;<span class="ident" id="5918497">mx</span>&nbsp;<span class="op" id="5918500">&lt;</span>&nbsp;<span class="ident" id="5918502">mxx</span><span class="op" id="5918505">;</span>&nbsp;<span class="ident" id="5918507">mx</span><span class="op" id="5918509">++</span>&nbsp;<span class="op" id="5918512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918517">for</span>&nbsp;<span class="ident" id="5918521">i</span>&nbsp;<span class="op" id="5918523">:=</span>&nbsp;<span class="num" id="5918526">0</span><span class="op" id="5918527">;</span>&nbsp;<span class="ident" id="5918529">i</span>&nbsp;<span class="op" id="5918531">&lt;</span>&nbsp;<span class="ident" id="5918533">nComp</span><span class="op" id="5918538">;</span>&nbsp;<span class="ident" id="5918540">i</span><span class="op" id="5918541">++</span>&nbsp;<span class="op" id="5918544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918550">compIndex</span>&nbsp;<span class="op" id="5918560">:=</span>&nbsp;<span class="ident" id="5918563">scan</span><span class="op" id="5918567">[</span><span class="ident" id="5918568">i</span><span class="op" id="5918569">]</span><span class="op" id="5918570">.</span><span class="ident" id="5918571">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918585">qt</span>&nbsp;<span class="op" id="5918588">:=</span>&nbsp;<span class="op" id="5918591">&amp;</span><span class="ident" id="5918592">d</span><span class="op" id="5918593">.</span><span class="ident" id="5918594">quant</span><span class="op" id="5918599">[</span><span class="ident" id="5918600">d</span><span class="op" id="5918601">.</span><span class="ident" id="5918602">comp</span><span class="op" id="5918606">[</span><span class="ident" id="5918607">compIndex</span><span class="op" id="5918616">]</span><span class="op" id="5918617">.</span><span class="ident" id="5918618">tq</span><span class="op" id="5918620">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918626">for</span>&nbsp;<span class="ident" id="5918630">j</span>&nbsp;<span class="op" id="5918632">:=</span>&nbsp;<span class="num" id="5918635">0</span><span class="op" id="5918636">;</span>&nbsp;<span class="ident" id="5918638">j</span>&nbsp;<span class="op" id="5918640">&lt;</span>&nbsp;<span class="ident" id="5918642">d</span><span class="op" id="5918643">.</span><span class="ident" id="5918644">comp</span><span class="op" id="5918648">[</span><span class="ident" id="5918649">compIndex</span><span class="op" id="5918658">]</span><span class="op" id="5918659">.</span><span class="ident" id="5918660">h</span><span class="op" id="5918661">*</span><span class="ident" id="5918662">d</span><span class="op" id="5918663">.</span><span class="ident" id="5918664">comp</span><span class="op" id="5918668">[</span><span class="ident" id="5918669">compIndex</span><span class="op" id="5918678">]</span><span class="op" id="5918679">.</span><span class="ident" id="5918680">v</span><span class="op" id="5918681">;</span>&nbsp;<span class="ident" id="5918683">j</span><span class="op" id="5918684">++</span>&nbsp;<span class="op" id="5918687">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918694">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918763">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918832">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918840">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918914">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918930">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918946">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918954">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919031">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919108">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919141">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919157">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919173">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919250">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919278">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919286">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919364">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919439">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919518">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919594">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919627">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919643">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919659">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919723">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919737">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919751">if</span>&nbsp;<span class="ident" id="5919754">nComp</span>&nbsp;<span class="op" id="5919760">!=</span>&nbsp;<span class="num" id="5919763">1</span>&nbsp;<span class="op" id="5919765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919773">bx</span><span class="op" id="5919775">,</span>&nbsp;<span class="ident" id="5919777">by</span>&nbsp;<span class="op" id="5919780">=</span>&nbsp;<span class="ident" id="5919782">d</span><span class="op" id="5919783">.</span><span class="ident" id="5919784">comp</span><span class="op" id="5919788">[</span><span class="ident" id="5919789">compIndex</span><span class="op" id="5919798">]</span><span class="op" id="5919799">.</span><span class="ident" id="5919800">h</span><span class="op" id="5919801">*</span><span class="ident" id="5919802">mx</span><span class="op" id="5919804">,</span>&nbsp;<span class="ident" id="5919806">d</span><span class="op" id="5919807">.</span><span class="ident" id="5919808">comp</span><span class="op" id="5919812">[</span><span class="ident" id="5919813">compIndex</span><span class="op" id="5919822">]</span><span class="op" id="5919823">.</span><span class="ident" id="5919824">v</span><span class="op" id="5919825">*</span><span class="ident" id="5919826">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919835">if</span>&nbsp;<span class="ident" id="5919838">h0</span>&nbsp;<span class="op" id="5919841">==</span>&nbsp;<span class="num" id="5919844">1</span>&nbsp;<span class="op" id="5919846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919855">by</span>&nbsp;<span class="op" id="5919858">+=</span>&nbsp;<span class="ident" id="5919861">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919869">}</span>&nbsp;<span class="keyword" id="5919871">else</span>&nbsp;<span class="op" id="5919876">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919885">bx</span>&nbsp;<span class="op" id="5919888">+=</span>&nbsp;<span class="ident" id="5919891">j</span>&nbsp;<span class="op" id="5919893">%</span>&nbsp;<span class="num" id="5919895">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919904">by</span>&nbsp;<span class="op" id="5919907">+=</span>&nbsp;<span class="ident" id="5919910">j</span>&nbsp;<span class="op" id="5919912">/</span>&nbsp;<span class="num" id="5919914">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919929">}</span>&nbsp;<span class="keyword" id="5919931">else</span>&nbsp;<span class="op" id="5919936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919944">q</span>&nbsp;<span class="op" id="5919946">:=</span>&nbsp;<span class="ident" id="5919949">mxx</span>&nbsp;<span class="op" id="5919953">*</span>&nbsp;<span class="ident" id="5919955">d</span><span class="op" id="5919956">.</span><span class="ident" id="5919957">comp</span><span class="op" id="5919961">[</span><span class="ident" id="5919962">compIndex</span><span class="op" id="5919971">]</span><span class="op" id="5919972">.</span><span class="ident" id="5919973">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919981">bx</span>&nbsp;<span class="op" id="5919984">=</span>&nbsp;<span class="ident" id="5919986">blockCount</span>&nbsp;<span class="op" id="5919997">%</span>&nbsp;<span class="ident" id="5919999">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920007">by</span>&nbsp;<span class="op" id="5920010">=</span>&nbsp;<span class="ident" id="5920012">blockCount</span>&nbsp;<span class="op" id="5920023">/</span>&nbsp;<span class="ident" id="5920025">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920033">blockCount</span><span class="op" id="5920043">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920052">if</span>&nbsp;<span class="ident" id="5920055">bx</span><span class="op" id="5920057">*</span><span class="num" id="5920058">8</span>&nbsp;<span class="op" id="5920060">&gt;=</span>&nbsp;<span class="ident" id="5920063">d</span><span class="op" id="5920064">.</span><span class="ident" id="5920065">width</span>&nbsp;<span class="op" id="5920071">||</span>&nbsp;<span class="ident" id="5920074">by</span><span class="op" id="5920076">*</span><span class="num" id="5920077">8</span>&nbsp;<span class="op" id="5920079">&gt;=</span>&nbsp;<span class="ident" id="5920082">d</span><span class="op" id="5920083">.</span><span class="ident" id="5920084">height</span>&nbsp;<span class="op" id="5920091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920100">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920130">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920203">if</span>&nbsp;<span class="ident" id="5920206">d</span><span class="op" id="5920207">.</span><span class="ident" id="5920208">progressive</span>&nbsp;<span class="op" id="5920220">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920228">b</span>&nbsp;<span class="op" id="5920230">=</span>&nbsp;<span class="ident" id="5920232">d</span><span class="op" id="5920233">.</span><span class="ident" id="5920234">progCoeffs</span><span class="op" id="5920244">[</span><span class="ident" id="5920245">compIndex</span><span class="op" id="5920254">]</span><span class="op" id="5920255">[</span><span class="ident" id="5920256">by</span><span class="op" id="5920258">*</span><span class="ident" id="5920259">mxx</span><span class="op" id="5920262">*</span><span class="ident" id="5920263">d</span><span class="op" id="5920264">.</span><span class="ident" id="5920265">comp</span><span class="op" id="5920269">[</span><span class="ident" id="5920270">compIndex</span><span class="op" id="5920279">]</span><span class="op" id="5920280">.</span><span class="ident" id="5920281">h</span><span class="op" id="5920282">+</span><span class="ident" id="5920283">bx</span><span class="op" id="5920285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920292">}</span>&nbsp;<span class="keyword" id="5920294">else</span>&nbsp;<span class="op" id="5920299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920307">b</span>&nbsp;<span class="op" id="5920309">=</span>&nbsp;<span class="ident" id="5920311">block</span><span class="op" id="5920316">{</span><span class="op" id="5920317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920332">if</span>&nbsp;<span class="ident" id="5920335">ah</span>&nbsp;<span class="op" id="5920338">!=</span>&nbsp;<span class="num" id="5920341">0</span>&nbsp;<span class="op" id="5920343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920351">if</span>&nbsp;<span class="ident" id="5920354">err</span>&nbsp;<span class="op" id="5920358">:=</span>&nbsp;<span class="ident" id="5920361">d</span><span class="op" id="5920362">.</span><span class="ident" id="5920363">refine</span><span class="op" id="5920369">(</span><span class="op" id="5920370">&amp;</span><span class="ident" id="5920371">b</span><span class="op" id="5920372">,</span>&nbsp;<span class="op" id="5920374">&amp;</span><span class="ident" id="5920375">d</span><span class="op" id="5920376">.</span><span class="ident" id="5920377">huff</span><span class="op" id="5920381">[</span><span class="ident" id="5920382">acTable</span><span class="op" id="5920389">]</span><span class="op" id="5920390">[</span><span class="ident" id="5920391">scan</span><span class="op" id="5920395">[</span><span class="ident" id="5920396">i</span><span class="op" id="5920397">]</span><span class="op" id="5920398">.</span><span class="ident" id="5920399">ta</span><span class="op" id="5920401">]</span><span class="op" id="5920402">,</span>&nbsp;<span class="ident" id="5920404">zigStart</span><span class="op" id="5920412">,</span>&nbsp;<span class="ident" id="5920414">zigEnd</span><span class="op" id="5920420">,</span>&nbsp;<span class="num" id="5920422">1</span><span class="op" id="5920423">&lt;&lt;</span><span class="ident" id="5920425">al</span><span class="op" id="5920427">)</span><span class="op" id="5920428">;</span>&nbsp;<span class="ident" id="5920430">err</span>&nbsp;<span class="op" id="5920434">!=</span>&nbsp;<span class="ident" id="5920437">nil</span>&nbsp;<span class="op" id="5920441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920450">return</span>&nbsp;<span class="ident" id="5920457">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920474">}</span>&nbsp;<span class="keyword" id="5920476">else</span>&nbsp;<span class="op" id="5920481">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920489">zig</span>&nbsp;<span class="op" id="5920493">:=</span>&nbsp;<span class="ident" id="5920496">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920511">if</span>&nbsp;<span class="ident" id="5920514">zig</span>&nbsp;<span class="op" id="5920518">==</span>&nbsp;<span class="num" id="5920521">0</span>&nbsp;<span class="op" id="5920523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920532">zig</span><span class="op" id="5920535">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920545">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920615">value</span><span class="op" id="5920620">,</span>&nbsp;<span class="ident" id="5920622">err</span>&nbsp;<span class="op" id="5920626">:=</span>&nbsp;<span class="ident" id="5920629">d</span><span class="op" id="5920630">.</span><span class="ident" id="5920631">decodeHuffman</span><span class="op" id="5920644">(</span><span class="op" id="5920645">&amp;</span><span class="ident" id="5920646">d</span><span class="op" id="5920647">.</span><span class="ident" id="5920648">huff</span><span class="op" id="5920652">[</span><span class="ident" id="5920653">dcTable</span><span class="op" id="5920660">]</span><span class="op" id="5920661">[</span><span class="ident" id="5920662">scan</span><span class="op" id="5920666">[</span><span class="ident" id="5920667">i</span><span class="op" id="5920668">]</span><span class="op" id="5920669">.</span><span class="ident" id="5920670">td</span><span class="op" id="5920672">]</span><span class="op" id="5920673">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920682">if</span>&nbsp;<span class="ident" id="5920685">err</span>&nbsp;<span class="op" id="5920689">!=</span>&nbsp;<span class="ident" id="5920692">nil</span>&nbsp;<span class="op" id="5920696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920706">return</span>&nbsp;<span class="ident" id="5920713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920733">if</span>&nbsp;<span class="ident" id="5920736">value</span>&nbsp;<span class="op" id="5920742">&gt;</span>&nbsp;<span class="num" id="5920744">16</span>&nbsp;<span class="op" id="5920747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920757">return</span>&nbsp;<span class="ident" id="5920764">UnsupportedError</span><span class="op" id="5920780">(</span><span class="string" id="5920781">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5920805">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920823">dcDelta</span><span class="op" id="5920830">,</span>&nbsp;<span class="ident" id="5920832">err</span>&nbsp;<span class="op" id="5920836">:=</span>&nbsp;<span class="ident" id="5920839">d</span><span class="op" id="5920840">.</span><span class="ident" id="5920841">receiveExtend</span><span class="op" id="5920854">(</span><span class="ident" id="5920855">value</span><span class="op" id="5920860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920869">if</span>&nbsp;<span class="ident" id="5920872">err</span>&nbsp;<span class="op" id="5920876">!=</span>&nbsp;<span class="ident" id="5920879">nil</span>&nbsp;<span class="op" id="5920883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920893">return</span>&nbsp;<span class="ident" id="5920900">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920911">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920920">dc</span><span class="op" id="5920922">[</span><span class="ident" id="5920923">compIndex</span><span class="op" id="5920932">]</span>&nbsp;<span class="op" id="5920934">+=</span>&nbsp;<span class="ident" id="5920937">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920952">b</span><span class="op" id="5920953">[</span><span class="num" id="5920954">0</span><span class="op" id="5920955">]</span>&nbsp;<span class="op" id="5920957">=</span>&nbsp;<span class="ident" id="5920959">dc</span><span class="op" id="5920961">[</span><span class="ident" id="5920962">compIndex</span><span class="op" id="5920971">]</span>&nbsp;<span class="op" id="5920973">&lt;&lt;</span>&nbsp;<span class="ident" id="5920976">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920994">if</span>&nbsp;<span class="ident" id="5920997">zig</span>&nbsp;<span class="op" id="5921001">&lt;=</span>&nbsp;<span class="ident" id="5921004">zigEnd</span>&nbsp;<span class="op" id="5921011">&amp;&amp;</span>&nbsp;<span class="ident" id="5921014">d</span><span class="op" id="5921015">.</span><span class="ident" id="5921016">eobRun</span>&nbsp;<span class="op" id="5921023">&gt;</span>&nbsp;<span class="num" id="5921025">0</span>&nbsp;<span class="op" id="5921027">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921036">d</span><span class="op" id="5921037">.</span><span class="ident" id="5921038">eobRun</span><span class="op" id="5921044">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921053">}</span>&nbsp;<span class="keyword" id="5921055">else</span>&nbsp;<span class="op" id="5921060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921069">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921140">huff</span>&nbsp;<span class="op" id="5921145">:=</span>&nbsp;<span class="op" id="5921148">&amp;</span><span class="ident" id="5921149">d</span><span class="op" id="5921150">.</span><span class="ident" id="5921151">huff</span><span class="op" id="5921155">[</span><span class="ident" id="5921156">acTable</span><span class="op" id="5921163">]</span><span class="op" id="5921164">[</span><span class="ident" id="5921165">scan</span><span class="op" id="5921169">[</span><span class="ident" id="5921170">i</span><span class="op" id="5921171">]</span><span class="op" id="5921172">.</span><span class="ident" id="5921173">ta</span><span class="op" id="5921175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921184">for</span>&nbsp;<span class="op" id="5921188">;</span>&nbsp;<span class="ident" id="5921190">zig</span>&nbsp;<span class="op" id="5921194">&lt;=</span>&nbsp;<span class="ident" id="5921197">zigEnd</span><span class="op" id="5921203">;</span>&nbsp;<span class="ident" id="5921205">zig</span><span class="op" id="5921208">++</span>&nbsp;<span class="op" id="5921211">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921221">value</span><span class="op" id="5921226">,</span>&nbsp;<span class="ident" id="5921228">err</span>&nbsp;<span class="op" id="5921232">:=</span>&nbsp;<span class="ident" id="5921235">d</span><span class="op" id="5921236">.</span><span class="ident" id="5921237">decodeHuffman</span><span class="op" id="5921250">(</span><span class="ident" id="5921251">huff</span><span class="op" id="5921255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921265">if</span>&nbsp;<span class="ident" id="5921268">err</span>&nbsp;<span class="op" id="5921272">!=</span>&nbsp;<span class="ident" id="5921275">nil</span>&nbsp;<span class="op" id="5921279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921290">return</span>&nbsp;<span class="ident" id="5921297">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921319">val0</span>&nbsp;<span class="op" id="5921324">:=</span>&nbsp;<span class="ident" id="5921327">value</span>&nbsp;<span class="op" id="5921333">&gt;&gt;</span>&nbsp;<span class="num" id="5921336">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921346">val1</span>&nbsp;<span class="op" id="5921351">:=</span>&nbsp;<span class="ident" id="5921354">value</span>&nbsp;<span class="op" id="5921360">&amp;</span>&nbsp;<span class="num" id="5921362">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921375">if</span>&nbsp;<span class="ident" id="5921378">val1</span>&nbsp;<span class="op" id="5921383">!=</span>&nbsp;<span class="num" id="5921386">0</span>&nbsp;<span class="op" id="5921388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921399">zig</span>&nbsp;<span class="op" id="5921403">+=</span>&nbsp;<span class="builtintype" id="5921406">int32</span><span class="op" id="5921411">(</span><span class="ident" id="5921412">val0</span><span class="op" id="5921416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921427">if</span>&nbsp;<span class="ident" id="5921430">zig</span>&nbsp;<span class="op" id="5921434">&gt;</span>&nbsp;<span class="ident" id="5921436">zigEnd</span>&nbsp;<span class="op" id="5921443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921455">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921481">ac</span><span class="op" id="5921483">,</span>&nbsp;<span class="ident" id="5921485">err</span>&nbsp;<span class="op" id="5921489">:=</span>&nbsp;<span class="ident" id="5921492">d</span><span class="op" id="5921493">.</span><span class="ident" id="5921494">receiveExtend</span><span class="op" id="5921507">(</span><span class="ident" id="5921508">val1</span><span class="op" id="5921512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921523">if</span>&nbsp;<span class="ident" id="5921526">err</span>&nbsp;<span class="op" id="5921530">!=</span>&nbsp;<span class="ident" id="5921533">nil</span>&nbsp;<span class="op" id="5921537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921549">return</span>&nbsp;<span class="ident" id="5921556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921569">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921580">b</span><span class="op" id="5921581">[</span><span class="ident" id="5921582">unzig</span><span class="op" id="5921587">[</span><span class="ident" id="5921588">zig</span><span class="op" id="5921591">]</span><span class="op" id="5921592">]</span>&nbsp;<span class="op" id="5921594">=</span>&nbsp;<span class="ident" id="5921596">ac</span>&nbsp;<span class="op" id="5921599">&lt;&lt;</span>&nbsp;<span class="ident" id="5921602">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921613">}</span>&nbsp;<span class="keyword" id="5921615">else</span>&nbsp;<span class="op" id="5921620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921631">if</span>&nbsp;<span class="ident" id="5921634">val0</span>&nbsp;<span class="op" id="5921639">!=</span>&nbsp;<span class="num" id="5921642">0x0f</span>&nbsp;<span class="op" id="5921647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921659">d</span><span class="op" id="5921660">.</span><span class="ident" id="5921661">eobRun</span>&nbsp;<span class="op" id="5921668">=</span>&nbsp;<span class="builtintype" id="5921670">uint16</span><span class="op" id="5921676">(</span><span class="num" id="5921677">1</span>&nbsp;<span class="op" id="5921679">&lt;&lt;</span>&nbsp;<span class="ident" id="5921682">val0</span><span class="op" id="5921686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921698">if</span>&nbsp;<span class="ident" id="5921701">val0</span>&nbsp;<span class="op" id="5921706">!=</span>&nbsp;<span class="num" id="5921709">0</span>&nbsp;<span class="op" id="5921711">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921724">bits</span><span class="op" id="5921728">,</span>&nbsp;<span class="ident" id="5921730">err</span>&nbsp;<span class="op" id="5921734">:=</span>&nbsp;<span class="ident" id="5921737">d</span><span class="op" id="5921738">.</span><span class="ident" id="5921739">decodeBits</span><span class="op" id="5921749">(</span><span class="builtintype" id="5921750">int32</span><span class="op" id="5921755">(</span><span class="ident" id="5921756">val0</span><span class="op" id="5921760">)</span><span class="op" id="5921761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921774">if</span>&nbsp;<span class="ident" id="5921777">err</span>&nbsp;<span class="op" id="5921781">!=</span>&nbsp;<span class="ident" id="5921784">nil</span>&nbsp;<span class="op" id="5921788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921802">return</span>&nbsp;<span class="ident" id="5921809">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921837">d</span><span class="op" id="5921838">.</span><span class="ident" id="5921839">eobRun</span>&nbsp;<span class="op" id="5921846">|=</span>&nbsp;<span class="builtintype" id="5921849">uint16</span><span class="op" id="5921855">(</span><span class="ident" id="5921856">bits</span><span class="op" id="5921860">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921884">d</span><span class="op" id="5921885">.</span><span class="ident" id="5921886">eobRun</span><span class="op" id="5921892">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921905">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921931">zig</span>&nbsp;<span class="op" id="5921935">+=</span>&nbsp;<span class="num" id="5921938">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921983">if</span>&nbsp;<span class="ident" id="5921986">d</span><span class="op" id="5921987">.</span><span class="ident" id="5921988">progressive</span>&nbsp;<span class="op" id="5922000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922008">if</span>&nbsp;<span class="ident" id="5922011">zigEnd</span>&nbsp;<span class="op" id="5922018">!=</span>&nbsp;<span class="ident" id="5922021">blockSize</span><span class="op" id="5922030">-</span><span class="num" id="5922031">1</span>&nbsp;<span class="op" id="5922033">||</span>&nbsp;<span class="ident" id="5922036">al</span>&nbsp;<span class="op" id="5922039">!=</span>&nbsp;<span class="num" id="5922042">0</span>&nbsp;<span class="op" id="5922044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922053">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922132">d</span><span class="op" id="5922133">.</span><span class="ident" id="5922134">progCoeffs</span><span class="op" id="5922144">[</span><span class="ident" id="5922145">compIndex</span><span class="op" id="5922154">]</span><span class="op" id="5922155">[</span><span class="ident" id="5922156">by</span><span class="op" id="5922158">*</span><span class="ident" id="5922159">mxx</span><span class="op" id="5922162">*</span><span class="ident" id="5922163">d</span><span class="op" id="5922164">.</span><span class="ident" id="5922165">comp</span><span class="op" id="5922169">[</span><span class="ident" id="5922170">compIndex</span><span class="op" id="5922179">]</span><span class="op" id="5922180">.</span><span class="ident" id="5922181">h</span><span class="op" id="5922182">+</span><span class="ident" id="5922183">bx</span><span class="op" id="5922185">]</span>&nbsp;<span class="op" id="5922187">=</span>&nbsp;<span class="ident" id="5922189">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922198">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922284">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922370">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922455">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922541">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922602">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922632">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922710">for</span>&nbsp;<span class="ident" id="5922714">zig</span>&nbsp;<span class="op" id="5922718">:=</span>&nbsp;<span class="num" id="5922721">0</span><span class="op" id="5922722">;</span>&nbsp;<span class="ident" id="5922724">zig</span>&nbsp;<span class="op" id="5922728">&lt;</span>&nbsp;<span class="ident" id="5922730">blockSize</span><span class="op" id="5922739">;</span>&nbsp;<span class="ident" id="5922741">zig</span><span class="op" id="5922744">++</span>&nbsp;<span class="op" id="5922747">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922755">b</span><span class="op" id="5922756">[</span><span class="ident" id="5922757">unzig</span><span class="op" id="5922762">[</span><span class="ident" id="5922763">zig</span><span class="op" id="5922766">]</span><span class="op" id="5922767">]</span>&nbsp;<span class="op" id="5922769">*=</span>&nbsp;<span class="ident" id="5922772">qt</span><span class="op" id="5922774">[</span><span class="ident" id="5922775">zig</span><span class="op" id="5922778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922792">idct</span><span class="op" id="5922796">(</span><span class="op" id="5922797">&amp;</span><span class="ident" id="5922798">b</span><span class="op" id="5922799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922806">dst</span><span class="op" id="5922809">,</span>&nbsp;<span class="ident" id="5922811">stride</span>&nbsp;<span class="op" id="5922818">:=</span>&nbsp;<span class="op" id="5922821">[</span><span class="op" id="5922822">]</span><span class="builtintype" id="5922823">byte</span><span class="op" id="5922827">(</span><span class="ident" id="5922828">nil</span><span class="op" id="5922831">)</span><span class="op" id="5922832">,</span>&nbsp;<span class="num" id="5922834">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922841">if</span>&nbsp;<span class="ident" id="5922844">d</span><span class="op" id="5922845">.</span><span class="ident" id="5922846">nComp</span>&nbsp;<span class="op" id="5922852">==</span>&nbsp;<span class="ident" id="5922855">nGrayComponent</span>&nbsp;<span class="op" id="5922870">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922878">dst</span><span class="op" id="5922881">,</span>&nbsp;<span class="ident" id="5922883">stride</span>&nbsp;<span class="op" id="5922890">=</span>&nbsp;<span class="ident" id="5922892">d</span><span class="op" id="5922893">.</span><span class="ident" id="5922894">img1</span><span class="op" id="5922898">.</span><span class="ident" id="5922899">Pix</span><span class="op" id="5922902">[</span><span class="num" id="5922903">8</span><span class="op" id="5922904">*</span><span class="op" id="5922905">(</span><span class="ident" id="5922906">by</span><span class="op" id="5922908">*</span><span class="ident" id="5922909">d</span><span class="op" id="5922910">.</span><span class="ident" id="5922911">img1</span><span class="op" id="5922915">.</span><span class="ident" id="5922916">Stride</span><span class="op" id="5922922">+</span><span class="ident" id="5922923">bx</span><span class="op" id="5922925">)</span><span class="op" id="5922926">:</span><span class="op" id="5922927">]</span><span class="op" id="5922928">,</span>&nbsp;<span class="ident" id="5922930">d</span><span class="op" id="5922931">.</span><span class="ident" id="5922932">img1</span><span class="op" id="5922936">.</span><span class="ident" id="5922937">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922949">}</span>&nbsp;<span class="keyword" id="5922951">else</span>&nbsp;<span class="op" id="5922956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922964">switch</span>&nbsp;<span class="ident" id="5922971">compIndex</span>&nbsp;<span class="op" id="5922981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922989">case</span>&nbsp;<span class="num" id="5922994">0</span><span class="op" id="5922995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923004">dst</span><span class="op" id="5923007">,</span>&nbsp;<span class="ident" id="5923009">stride</span>&nbsp;<span class="op" id="5923016">=</span>&nbsp;<span class="ident" id="5923018">d</span><span class="op" id="5923019">.</span><span class="ident" id="5923020">img3</span><span class="op" id="5923024">.</span><span class="ident" id="5923025">Y</span><span class="op" id="5923026">[</span><span class="num" id="5923027">8</span><span class="op" id="5923028">*</span><span class="op" id="5923029">(</span><span class="ident" id="5923030">by</span><span class="op" id="5923032">*</span><span class="ident" id="5923033">d</span><span class="op" id="5923034">.</span><span class="ident" id="5923035">img3</span><span class="op" id="5923039">.</span><span class="ident" id="5923040">YStride</span><span class="op" id="5923047">+</span><span class="ident" id="5923048">bx</span><span class="op" id="5923050">)</span><span class="op" id="5923051">:</span><span class="op" id="5923052">]</span><span class="op" id="5923053">,</span>&nbsp;<span class="ident" id="5923055">d</span><span class="op" id="5923056">.</span><span class="ident" id="5923057">img3</span><span class="op" id="5923061">.</span><span class="ident" id="5923062">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923076">case</span>&nbsp;<span class="num" id="5923081">1</span><span class="op" id="5923082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923091">dst</span><span class="op" id="5923094">,</span>&nbsp;<span class="ident" id="5923096">stride</span>&nbsp;<span class="op" id="5923103">=</span>&nbsp;<span class="ident" id="5923105">d</span><span class="op" id="5923106">.</span><span class="ident" id="5923107">img3</span><span class="op" id="5923111">.</span><span class="ident" id="5923112">Cb</span><span class="op" id="5923114">[</span><span class="num" id="5923115">8</span><span class="op" id="5923116">*</span><span class="op" id="5923117">(</span><span class="ident" id="5923118">by</span><span class="op" id="5923120">*</span><span class="ident" id="5923121">d</span><span class="op" id="5923122">.</span><span class="ident" id="5923123">img3</span><span class="op" id="5923127">.</span><span class="ident" id="5923128">CStride</span><span class="op" id="5923135">+</span><span class="ident" id="5923136">bx</span><span class="op" id="5923138">)</span><span class="op" id="5923139">:</span><span class="op" id="5923140">]</span><span class="op" id="5923141">,</span>&nbsp;<span class="ident" id="5923143">d</span><span class="op" id="5923144">.</span><span class="ident" id="5923145">img3</span><span class="op" id="5923149">.</span><span class="ident" id="5923150">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923164">case</span>&nbsp;<span class="num" id="5923169">2</span><span class="op" id="5923170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923179">dst</span><span class="op" id="5923182">,</span>&nbsp;<span class="ident" id="5923184">stride</span>&nbsp;<span class="op" id="5923191">=</span>&nbsp;<span class="ident" id="5923193">d</span><span class="op" id="5923194">.</span><span class="ident" id="5923195">img3</span><span class="op" id="5923199">.</span><span class="ident" id="5923200">Cr</span><span class="op" id="5923202">[</span><span class="num" id="5923203">8</span><span class="op" id="5923204">*</span><span class="op" id="5923205">(</span><span class="ident" id="5923206">by</span><span class="op" id="5923208">*</span><span class="ident" id="5923209">d</span><span class="op" id="5923210">.</span><span class="ident" id="5923211">img3</span><span class="op" id="5923215">.</span><span class="ident" id="5923216">CStride</span><span class="op" id="5923223">+</span><span class="ident" id="5923224">bx</span><span class="op" id="5923226">)</span><span class="op" id="5923227">:</span><span class="op" id="5923228">]</span><span class="op" id="5923229">,</span>&nbsp;<span class="ident" id="5923231">d</span><span class="op" id="5923232">.</span><span class="ident" id="5923233">img3</span><span class="op" id="5923237">.</span><span class="ident" id="5923238">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923252">default</span><span class="op" id="5923259">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923268">return</span>&nbsp;<span class="ident" id="5923275">UnsupportedError</span><span class="op" id="5923291">(</span><span class="string" id="5923292">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5923313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923335">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923400">for</span>&nbsp;<span class="ident" id="5923404">y</span>&nbsp;<span class="op" id="5923406">:=</span>&nbsp;<span class="num" id="5923409">0</span><span class="op" id="5923410">;</span>&nbsp;<span class="ident" id="5923412">y</span>&nbsp;<span class="op" id="5923414">&lt;</span>&nbsp;<span class="num" id="5923416">8</span><span class="op" id="5923417">;</span>&nbsp;<span class="ident" id="5923419">y</span><span class="op" id="5923420">++</span>&nbsp;<span class="op" id="5923423">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923431">y8</span>&nbsp;<span class="op" id="5923434">:=</span>&nbsp;<span class="ident" id="5923437">y</span>&nbsp;<span class="op" id="5923439">*</span>&nbsp;<span class="num" id="5923441">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923449">yStride</span>&nbsp;<span class="op" id="5923457">:=</span>&nbsp;<span class="ident" id="5923460">y</span>&nbsp;<span class="op" id="5923462">*</span>&nbsp;<span class="ident" id="5923464">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923477">for</span>&nbsp;<span class="ident" id="5923481">x</span>&nbsp;<span class="op" id="5923483">:=</span>&nbsp;<span class="num" id="5923486">0</span><span class="op" id="5923487">;</span>&nbsp;<span class="ident" id="5923489">x</span>&nbsp;<span class="op" id="5923491">&lt;</span>&nbsp;<span class="num" id="5923493">8</span><span class="op" id="5923494">;</span>&nbsp;<span class="ident" id="5923496">x</span><span class="op" id="5923497">++</span>&nbsp;<span class="op" id="5923500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923509">c</span>&nbsp;<span class="op" id="5923511">:=</span>&nbsp;<span class="ident" id="5923514">b</span><span class="op" id="5923515">[</span><span class="ident" id="5923516">y8</span><span class="op" id="5923518">+</span><span class="ident" id="5923519">x</span><span class="op" id="5923520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923529">if</span>&nbsp;<span class="ident" id="5923532">c</span>&nbsp;<span class="op" id="5923534">&lt;</span>&nbsp;<span class="op" id="5923536">-</span><span class="num" id="5923537">128</span>&nbsp;<span class="op" id="5923541">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923551">c</span>&nbsp;<span class="op" id="5923553">=</span>&nbsp;<span class="num" id="5923555">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923564">}</span>&nbsp;<span class="keyword" id="5923566">else</span>&nbsp;<span class="keyword" id="5923571">if</span>&nbsp;<span class="ident" id="5923574">c</span>&nbsp;<span class="op" id="5923576">&gt;</span>&nbsp;<span class="num" id="5923578">127</span>&nbsp;<span class="op" id="5923582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923592">c</span>&nbsp;<span class="op" id="5923594">=</span>&nbsp;<span class="num" id="5923596">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923607">}</span>&nbsp;<span class="keyword" id="5923609">else</span>&nbsp;<span class="op" id="5923614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923624">c</span>&nbsp;<span class="op" id="5923626">+=</span>&nbsp;<span class="num" id="5923629">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923649">dst</span><span class="op" id="5923652">[</span><span class="ident" id="5923653">yStride</span><span class="op" id="5923660">+</span><span class="ident" id="5923661">x</span><span class="op" id="5923662">]</span>&nbsp;<span class="op" id="5923664">=</span>&nbsp;<span class="builtintype" id="5923666">uint8</span><span class="op" id="5923671">(</span><span class="ident" id="5923672">c</span><span class="op" id="5923673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923694">}</span>&nbsp;<span class="comment" id="5923696">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923708">}</span>&nbsp;<span class="comment" id="5923710">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923722">mcu</span><span class="op" id="5923725">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923731">if</span>&nbsp;<span class="ident" id="5923734">d</span><span class="op" id="5923735">.</span><span class="ident" id="5923736">ri</span>&nbsp;<span class="op" id="5923739">&gt;</span>&nbsp;<span class="num" id="5923741">0</span>&nbsp;<span class="op" id="5923743">&amp;&amp;</span>&nbsp;<span class="ident" id="5923746">mcu</span><span class="op" id="5923749">%</span><span class="ident" id="5923750">d</span><span class="op" id="5923751">.</span><span class="ident" id="5923752">ri</span>&nbsp;<span class="op" id="5923755">==</span>&nbsp;<span class="num" id="5923758">0</span>&nbsp;<span class="op" id="5923760">&amp;&amp;</span>&nbsp;<span class="ident" id="5923763">mcu</span>&nbsp;<span class="op" id="5923767">&lt;</span>&nbsp;<span class="ident" id="5923769">mxx</span><span class="op" id="5923772">*</span><span class="ident" id="5923773">myy</span>&nbsp;<span class="op" id="5923777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923783">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923883">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923980">if</span>&nbsp;<span class="ident" id="5923983">err</span>&nbsp;<span class="op" id="5923987">:=</span>&nbsp;<span class="ident" id="5923990">d</span><span class="op" id="5923991">.</span><span class="ident" id="5923992">readFull</span><span class="op" id="5924000">(</span><span class="ident" id="5924001">d</span><span class="op" id="5924002">.</span><span class="ident" id="5924003">tmp</span><span class="op" id="5924006">[</span><span class="op" id="5924007">:</span><span class="num" id="5924008">2</span><span class="op" id="5924009">]</span><span class="op" id="5924010">)</span><span class="op" id="5924011">;</span>&nbsp;<span class="ident" id="5924013">err</span>&nbsp;<span class="op" id="5924017">!=</span>&nbsp;<span class="ident" id="5924020">nil</span>&nbsp;<span class="op" id="5924024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924031">return</span>&nbsp;<span class="ident" id="5924038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924052">if</span>&nbsp;<span class="ident" id="5924055">d</span><span class="op" id="5924056">.</span><span class="ident" id="5924057">tmp</span><span class="op" id="5924060">[</span><span class="num" id="5924061">0</span><span class="op" id="5924062">]</span>&nbsp;<span class="op" id="5924064">!=</span>&nbsp;<span class="num" id="5924067">0xff</span>&nbsp;<span class="op" id="5924072">||</span>&nbsp;<span class="ident" id="5924075">d</span><span class="op" id="5924076">.</span><span class="ident" id="5924077">tmp</span><span class="op" id="5924080">[</span><span class="num" id="5924081">1</span><span class="op" id="5924082">]</span>&nbsp;<span class="op" id="5924084">!=</span>&nbsp;<span class="ident" id="5924087">expectedRST</span>&nbsp;<span class="op" id="5924099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924106">return</span>&nbsp;<span class="ident" id="5924113">FormatError</span><span class="op" id="5924124">(</span><span class="string" id="5924125">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5924141">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924153">expectedRST</span><span class="op" id="5924164">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924171">if</span>&nbsp;<span class="ident" id="5924174">expectedRST</span>&nbsp;<span class="op" id="5924186">==</span>&nbsp;<span class="ident" id="5924189">rst7Marker</span><span class="op" id="5924199">+</span><span class="num" id="5924200">1</span>&nbsp;<span class="op" id="5924202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924209">expectedRST</span>&nbsp;<span class="op" id="5924221">=</span>&nbsp;<span class="ident" id="5924223">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924238">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924244">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924278">d</span><span class="op" id="5924279">.</span><span class="ident" id="5924280">bits</span>&nbsp;<span class="op" id="5924285">=</span>&nbsp;<span class="ident" id="5924287">bits</span><span class="op" id="5924291">{</span><span class="op" id="5924292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924298">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924356">dc</span>&nbsp;<span class="op" id="5924359">=</span>&nbsp;<span class="op" id="5924361">[</span><span class="ident" id="5924362">nColorComponent</span><span class="op" id="5924377">]</span><span class="builtintype" id="5924378">int32</span><span class="op" id="5924383">{</span><span class="op" id="5924384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924390">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924458">d</span><span class="op" id="5924459">.</span><span class="ident" id="5924460">eobRun</span>&nbsp;<span class="op" id="5924467">=</span>&nbsp;<span class="num" id="5924469">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924478">}</span>&nbsp;<span class="comment" id="5924480">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924491">}</span>&nbsp;<span class="comment" id="5924493">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924505">return</span>&nbsp;<span class="ident" id="5924512">nil</span><br>
<span class="lineno"></span><span class="op" id="5924516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5924519">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5924598">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5924616">func</span>&nbsp;<span class="op" id="5924621">(</span><span class="ident" id="5924622">d</span>&nbsp;<span class="op" id="5924624">*</span><span class="ident" id="5924625">decoder</span><span class="op" id="5924632">)</span>&nbsp;<span class="ident" id="5924634">refine</span><span class="op" id="5924640">(</span><span class="ident" id="5924641">b</span>&nbsp;<span class="op" id="5924643">*</span><span class="ident" id="5924644">block</span><span class="op" id="5924649">,</span>&nbsp;<span class="ident" id="5924651">h</span>&nbsp;<span class="op" id="5924653">*</span><span class="ident" id="5924654">huffman</span><span class="op" id="5924661">,</span>&nbsp;<span class="ident" id="5924663">zigStart</span><span class="op" id="5924671">,</span>&nbsp;<span class="ident" id="5924673">zigEnd</span><span class="op" id="5924679">,</span>&nbsp;<span class="ident" id="5924681">delta</span>&nbsp;<span class="builtintype" id="5924687">int32</span><span class="op" id="5924692">)</span>&nbsp;<span class="builtintype" id="5924694">error</span>&nbsp;<span class="op" id="5924700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924703">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924743">if</span>&nbsp;<span class="ident" id="5924746">zigStart</span>&nbsp;<span class="op" id="5924755">==</span>&nbsp;<span class="num" id="5924758">0</span>&nbsp;<span class="op" id="5924760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924764">if</span>&nbsp;<span class="ident" id="5924767">zigEnd</span>&nbsp;<span class="op" id="5924774">!=</span>&nbsp;<span class="num" id="5924777">0</span>&nbsp;<span class="op" id="5924779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5924784">panic</span><span class="op" id="5924789">(</span><span class="string" id="5924790">&#34;unreachable&#34;</span><span class="op" id="5924803">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924811">bit</span><span class="op" id="5924814">,</span>&nbsp;<span class="ident" id="5924816">err</span>&nbsp;<span class="op" id="5924820">:=</span>&nbsp;<span class="ident" id="5924823">d</span><span class="op" id="5924824">.</span><span class="ident" id="5924825">decodeBit</span><span class="op" id="5924834">(</span><span class="op" id="5924835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924839">if</span>&nbsp;<span class="ident" id="5924842">err</span>&nbsp;<span class="op" id="5924846">!=</span>&nbsp;<span class="ident" id="5924849">nil</span>&nbsp;<span class="op" id="5924853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924858">return</span>&nbsp;<span class="ident" id="5924865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924871">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924875">if</span>&nbsp;<span class="ident" id="5924878">bit</span>&nbsp;<span class="op" id="5924882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924887">b</span><span class="op" id="5924888">[</span><span class="num" id="5924889">0</span><span class="op" id="5924890">]</span>&nbsp;<span class="op" id="5924892">|=</span>&nbsp;<span class="ident" id="5924895">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924907">return</span>&nbsp;<span class="ident" id="5924914">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924919">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924923">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925005">zig</span>&nbsp;<span class="op" id="5925009">:=</span>&nbsp;<span class="ident" id="5925012">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925022">if</span>&nbsp;<span class="ident" id="5925025">d</span><span class="op" id="5925026">.</span><span class="ident" id="5925027">eobRun</span>&nbsp;<span class="op" id="5925034">==</span>&nbsp;<span class="num" id="5925037">0</span>&nbsp;<span class="op" id="5925039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925042">loop</span><span class="op" id="5925046">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925050">for</span>&nbsp;<span class="op" id="5925054">;</span>&nbsp;<span class="ident" id="5925056">zig</span>&nbsp;<span class="op" id="5925060">&lt;=</span>&nbsp;<span class="ident" id="5925063">zigEnd</span><span class="op" id="5925069">;</span>&nbsp;<span class="ident" id="5925071">zig</span><span class="op" id="5925074">++</span>&nbsp;<span class="op" id="5925077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925082">z</span>&nbsp;<span class="op" id="5925084">:=</span>&nbsp;<span class="builtintype" id="5925087">int32</span><span class="op" id="5925092">(</span><span class="num" id="5925093">0</span><span class="op" id="5925094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925099">value</span><span class="op" id="5925104">,</span>&nbsp;<span class="ident" id="5925106">err</span>&nbsp;<span class="op" id="5925110">:=</span>&nbsp;<span class="ident" id="5925113">d</span><span class="op" id="5925114">.</span><span class="ident" id="5925115">decodeHuffman</span><span class="op" id="5925128">(</span><span class="ident" id="5925129">h</span><span class="op" id="5925130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925135">if</span>&nbsp;<span class="ident" id="5925138">err</span>&nbsp;<span class="op" id="5925142">!=</span>&nbsp;<span class="ident" id="5925145">nil</span>&nbsp;<span class="op" id="5925149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925155">return</span>&nbsp;<span class="ident" id="5925162">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925174">val0</span>&nbsp;<span class="op" id="5925179">:=</span>&nbsp;<span class="ident" id="5925182">value</span>&nbsp;<span class="op" id="5925188">&gt;&gt;</span>&nbsp;<span class="num" id="5925191">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925196">val1</span>&nbsp;<span class="op" id="5925201">:=</span>&nbsp;<span class="ident" id="5925204">value</span>&nbsp;<span class="op" id="5925210">&amp;</span>&nbsp;<span class="num" id="5925212">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925221">switch</span>&nbsp;<span class="ident" id="5925228">val1</span>&nbsp;<span class="op" id="5925233">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925238">case</span>&nbsp;<span class="num" id="5925243">0</span><span class="op" id="5925244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925250">if</span>&nbsp;<span class="ident" id="5925253">val0</span>&nbsp;<span class="op" id="5925258">!=</span>&nbsp;<span class="num" id="5925261">0x0f</span>&nbsp;<span class="op" id="5925266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925273">d</span><span class="op" id="5925274">.</span><span class="ident" id="5925275">eobRun</span>&nbsp;<span class="op" id="5925282">=</span>&nbsp;<span class="builtintype" id="5925284">uint16</span><span class="op" id="5925290">(</span><span class="num" id="5925291">1</span>&nbsp;<span class="op" id="5925293">&lt;&lt;</span>&nbsp;<span class="ident" id="5925296">val0</span><span class="op" id="5925300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925307">if</span>&nbsp;<span class="ident" id="5925310">val0</span>&nbsp;<span class="op" id="5925315">!=</span>&nbsp;<span class="num" id="5925318">0</span>&nbsp;<span class="op" id="5925320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925328">bits</span><span class="op" id="5925332">,</span>&nbsp;<span class="ident" id="5925334">err</span>&nbsp;<span class="op" id="5925338">:=</span>&nbsp;<span class="ident" id="5925341">d</span><span class="op" id="5925342">.</span><span class="ident" id="5925343">decodeBits</span><span class="op" id="5925353">(</span><span class="builtintype" id="5925354">int32</span><span class="op" id="5925359">(</span><span class="ident" id="5925360">val0</span><span class="op" id="5925364">)</span><span class="op" id="5925365">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925373">if</span>&nbsp;<span class="ident" id="5925376">err</span>&nbsp;<span class="op" id="5925380">!=</span>&nbsp;<span class="ident" id="5925383">nil</span>&nbsp;<span class="op" id="5925387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925396">return</span>&nbsp;<span class="ident" id="5925403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925421">d</span><span class="op" id="5925422">.</span><span class="ident" id="5925423">eobRun</span>&nbsp;<span class="op" id="5925430">|=</span>&nbsp;<span class="builtintype" id="5925433">uint16</span><span class="op" id="5925439">(</span><span class="ident" id="5925440">bits</span><span class="op" id="5925444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925451">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925458">break</span>&nbsp;<span class="ident" id="5925464">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925478">case</span>&nbsp;<span class="num" id="5925483">1</span><span class="op" id="5925484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925490">z</span>&nbsp;<span class="op" id="5925492">=</span>&nbsp;<span class="ident" id="5925494">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925504">bit</span><span class="op" id="5925507">,</span>&nbsp;<span class="ident" id="5925509">err</span>&nbsp;<span class="op" id="5925513">:=</span>&nbsp;<span class="ident" id="5925516">d</span><span class="op" id="5925517">.</span><span class="ident" id="5925518">decodeBit</span><span class="op" id="5925527">(</span><span class="op" id="5925528">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925534">if</span>&nbsp;<span class="ident" id="5925537">err</span>&nbsp;<span class="op" id="5925541">!=</span>&nbsp;<span class="ident" id="5925544">nil</span>&nbsp;<span class="op" id="5925548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925555">return</span>&nbsp;<span class="ident" id="5925562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925576">if</span>&nbsp;<span class="op" id="5925579">!</span><span class="ident" id="5925580">bit</span>&nbsp;<span class="op" id="5925584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925591">z</span>&nbsp;<span class="op" id="5925593">=</span>&nbsp;<span class="op" id="5925595">-</span><span class="ident" id="5925596">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925607">default</span><span class="op" id="5925614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925620">return</span>&nbsp;<span class="ident" id="5925627">FormatError</span><span class="op" id="5925638">(</span><span class="string" id="5925639">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5925664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925675">zig</span><span class="op" id="5925678">,</span>&nbsp;<span class="ident" id="5925680">err</span>&nbsp;<span class="op" id="5925684">=</span>&nbsp;<span class="ident" id="5925686">d</span><span class="op" id="5925687">.</span><span class="ident" id="5925688">refineNonZeroes</span><span class="op" id="5925703">(</span><span class="ident" id="5925704">b</span><span class="op" id="5925705">,</span>&nbsp;<span class="ident" id="5925707">zig</span><span class="op" id="5925710">,</span>&nbsp;<span class="ident" id="5925712">zigEnd</span><span class="op" id="5925718">,</span>&nbsp;<span class="builtintype" id="5925720">int32</span><span class="op" id="5925725">(</span><span class="ident" id="5925726">val0</span><span class="op" id="5925730">)</span><span class="op" id="5925731">,</span>&nbsp;<span class="ident" id="5925733">delta</span><span class="op" id="5925738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925743">if</span>&nbsp;<span class="ident" id="5925746">err</span>&nbsp;<span class="op" id="5925750">!=</span>&nbsp;<span class="ident" id="5925753">nil</span>&nbsp;<span class="op" id="5925757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925763">return</span>&nbsp;<span class="ident" id="5925770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925782">if</span>&nbsp;<span class="ident" id="5925785">zig</span>&nbsp;<span class="op" id="5925789">&gt;</span>&nbsp;<span class="ident" id="5925791">zigEnd</span>&nbsp;<span class="op" id="5925798">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925804">return</span>&nbsp;<span class="ident" id="5925811">FormatError</span><span class="op" id="5925822">(</span><span class="string" id="5925823">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5925846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925856">if</span>&nbsp;<span class="ident" id="5925859">z</span>&nbsp;<span class="op" id="5925861">!=</span>&nbsp;<span class="num" id="5925864">0</span>&nbsp;<span class="op" id="5925866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925872">b</span><span class="op" id="5925873">[</span><span class="ident" id="5925874">unzig</span><span class="op" id="5925879">[</span><span class="ident" id="5925880">zig</span><span class="op" id="5925883">]</span><span class="op" id="5925884">]</span>&nbsp;<span class="op" id="5925886">=</span>&nbsp;<span class="ident" id="5925888">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925893">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925903">if</span>&nbsp;<span class="ident" id="5925906">d</span><span class="op" id="5925907">.</span><span class="ident" id="5925908">eobRun</span>&nbsp;<span class="op" id="5925915">&gt;</span>&nbsp;<span class="num" id="5925917">0</span>&nbsp;<span class="op" id="5925919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925923">d</span><span class="op" id="5925924">.</span><span class="ident" id="5925925">eobRun</span><span class="op" id="5925931">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925936">if</span>&nbsp;<span class="ident" id="5925939">_</span><span class="op" id="5925940">,</span>&nbsp;<span class="ident" id="5925942">err</span>&nbsp;<span class="op" id="5925946">:=</span>&nbsp;<span class="ident" id="5925949">d</span><span class="op" id="5925950">.</span><span class="ident" id="5925951">refineNonZeroes</span><span class="op" id="5925966">(</span><span class="ident" id="5925967">b</span><span class="op" id="5925968">,</span>&nbsp;<span class="ident" id="5925970">zig</span><span class="op" id="5925973">,</span>&nbsp;<span class="ident" id="5925975">zigEnd</span><span class="op" id="5925981">,</span>&nbsp;<span class="op" id="5925983">-</span><span class="num" id="5925984">1</span><span class="op" id="5925985">,</span>&nbsp;<span class="ident" id="5925987">delta</span><span class="op" id="5925992">)</span><span class="op" id="5925993">;</span>&nbsp;<span class="ident" id="5925995">err</span>&nbsp;<span class="op" id="5925999">!=</span>&nbsp;<span class="ident" id="5926002">nil</span>&nbsp;<span class="op" id="5926006">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926011">return</span>&nbsp;<span class="ident" id="5926018">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926030">return</span>&nbsp;<span class="ident" id="5926037">nil</span><br>
<span class="lineno"></span><span class="op" id="5926041">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5926044">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5926123">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5926170">func</span>&nbsp;<span class="op" id="5926175">(</span><span class="ident" id="5926176">d</span>&nbsp;<span class="op" id="5926178">*</span><span class="ident" id="5926179">decoder</span><span class="op" id="5926186">)</span>&nbsp;<span class="ident" id="5926188">refineNonZeroes</span><span class="op" id="5926203">(</span><span class="ident" id="5926204">b</span>&nbsp;<span class="op" id="5926206">*</span><span class="ident" id="5926207">block</span><span class="op" id="5926212">,</span>&nbsp;<span class="ident" id="5926214">zig</span><span class="op" id="5926217">,</span>&nbsp;<span class="ident" id="5926219">zigEnd</span><span class="op" id="5926225">,</span>&nbsp;<span class="ident" id="5926227">nz</span><span class="op" id="5926229">,</span>&nbsp;<span class="ident" id="5926231">delta</span>&nbsp;<span class="builtintype" id="5926237">int32</span><span class="op" id="5926242">)</span>&nbsp;<span class="op" id="5926244">(</span><span class="builtintype" id="5926245">int32</span><span class="op" id="5926250">,</span>&nbsp;<span class="builtintype" id="5926252">error</span><span class="op" id="5926257">)</span>&nbsp;<span class="op" id="5926259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926262">for</span>&nbsp;<span class="op" id="5926266">;</span>&nbsp;<span class="ident" id="5926268">zig</span>&nbsp;<span class="op" id="5926272">&lt;=</span>&nbsp;<span class="ident" id="5926275">zigEnd</span><span class="op" id="5926281">;</span>&nbsp;<span class="ident" id="5926283">zig</span><span class="op" id="5926286">++</span>&nbsp;<span class="op" id="5926289">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926293">u</span>&nbsp;<span class="op" id="5926295">:=</span>&nbsp;<span class="ident" id="5926298">unzig</span><span class="op" id="5926303">[</span><span class="ident" id="5926304">zig</span><span class="op" id="5926307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926311">if</span>&nbsp;<span class="ident" id="5926314">b</span><span class="op" id="5926315">[</span><span class="ident" id="5926316">u</span><span class="op" id="5926317">]</span>&nbsp;<span class="op" id="5926319">==</span>&nbsp;<span class="num" id="5926322">0</span>&nbsp;<span class="op" id="5926324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926329">if</span>&nbsp;<span class="ident" id="5926332">nz</span>&nbsp;<span class="op" id="5926335">==</span>&nbsp;<span class="num" id="5926338">0</span>&nbsp;<span class="op" id="5926340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926346">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926355">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926360">nz</span><span class="op" id="5926362">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926368">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926383">bit</span><span class="op" id="5926386">,</span>&nbsp;<span class="ident" id="5926388">err</span>&nbsp;<span class="op" id="5926392">:=</span>&nbsp;<span class="ident" id="5926395">d</span><span class="op" id="5926396">.</span><span class="ident" id="5926397">decodeBit</span><span class="op" id="5926406">(</span><span class="op" id="5926407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926411">if</span>&nbsp;<span class="ident" id="5926414">err</span>&nbsp;<span class="op" id="5926418">!=</span>&nbsp;<span class="ident" id="5926421">nil</span>&nbsp;<span class="op" id="5926425">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926430">return</span>&nbsp;<span class="num" id="5926437">0</span><span class="op" id="5926438">,</span>&nbsp;<span class="ident" id="5926440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926450">if</span>&nbsp;<span class="op" id="5926453">!</span><span class="ident" id="5926454">bit</span>&nbsp;<span class="op" id="5926458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926463">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926474">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926478">if</span>&nbsp;<span class="ident" id="5926481">b</span><span class="op" id="5926482">[</span><span class="ident" id="5926483">u</span><span class="op" id="5926484">]</span>&nbsp;<span class="op" id="5926486">&gt;=</span>&nbsp;<span class="num" id="5926489">0</span>&nbsp;<span class="op" id="5926491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926496">b</span><span class="op" id="5926497">[</span><span class="ident" id="5926498">u</span><span class="op" id="5926499">]</span>&nbsp;<span class="op" id="5926501">+=</span>&nbsp;<span class="ident" id="5926504">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926512">}</span>&nbsp;<span class="keyword" id="5926514">else</span>&nbsp;<span class="op" id="5926519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926524">b</span><span class="op" id="5926525">[</span><span class="ident" id="5926526">u</span><span class="op" id="5926527">]</span>&nbsp;<span class="op" id="5926529">-=</span>&nbsp;<span class="ident" id="5926532">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926540">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926546">return</span>&nbsp;<span class="ident" id="5926553">zig</span><span class="op" id="5926556">,</span>&nbsp;<span class="ident" id="5926558">nil</span><br>
<span class="lineno"></span><span class="op" id="5926562">}</span>
</div>
</body>
</html>
