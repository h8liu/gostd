<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4570479">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4570534">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4570588">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4570639">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4570692">package</span>&nbsp;<span class="ident" id="4570700">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4570709">import</span>&nbsp;<span class="op" id="4570716">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570719">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570726">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570736">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570748">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570754">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570760">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570771">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570782">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4570800">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="4570810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4570813">const</span>&nbsp;<span class="op" id="4570819">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570822">maxNewlines</span>&nbsp;<span class="op" id="4570834">=</span>&nbsp;<span class="num" id="4570836">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4570842">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570890">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570902">=</span>&nbsp;<span class="builtintype" id="4570904">false</span>&nbsp;<span class="comment" id="4570910">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570935">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570947">=</span>&nbsp;<span class="num" id="4570949">1</span>&nbsp;<span class="op" id="4570951">&lt;&lt;</span>&nbsp;<span class="num" id="4570954">30</span><br>
<span class="lineno"></span><span class="op" id="4570957">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4570960">type</span>&nbsp;<span class="ident" id="4570965">whiteSpace</span>&nbsp;<span class="builtintype" id="4570976">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4570982">const</span>&nbsp;<span class="op" id="4570988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570991">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4571000">=</span>&nbsp;<span class="ident" id="4571002">whiteSpace</span><span class="op" id="4571012">(</span><span class="num" id="4571013">0</span><span class="op" id="4571014">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571017">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4571026">=</span>&nbsp;<span class="ident" id="4571028">whiteSpace</span><span class="op" id="4571038">(</span><span class="string" id="4571039">&#39;&nbsp;&#39;</span><span class="op" id="4571042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571045">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4571054">=</span>&nbsp;<span class="ident" id="4571056">whiteSpace</span><span class="op" id="4571066">(</span><span class="string" id="4571067">&#39;\v&#39;</span><span class="op" id="4571071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571074">newline</span>&nbsp;&nbsp;<span class="op" id="4571083">=</span>&nbsp;<span class="ident" id="4571085">whiteSpace</span><span class="op" id="4571095">(</span><span class="string" id="4571096">&#39;\n&#39;</span><span class="op" id="4571100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571103">formfeed</span>&nbsp;<span class="op" id="4571112">=</span>&nbsp;<span class="ident" id="4571114">whiteSpace</span><span class="op" id="4571124">(</span><span class="string" id="4571125">&#39;\f&#39;</span><span class="op" id="4571129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571132">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4571141">=</span>&nbsp;<span class="ident" id="4571143">whiteSpace</span><span class="op" id="4571153">(</span><span class="string" id="4571154">&#39;&gt;&#39;</span><span class="op" id="4571157">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571160">unindent</span>&nbsp;<span class="op" id="4571169">=</span>&nbsp;<span class="ident" id="4571171">whiteSpace</span><span class="op" id="4571181">(</span><span class="string" id="4571182">&#39;&lt;&#39;</span><span class="op" id="4571185">)</span><br>
<span class="lineno"></span><span class="op" id="4571187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4571190">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="4571244">type</span>&nbsp;<span class="ident" id="4571249">pmode</span>&nbsp;<span class="builtintype" id="4571255">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4571260">const</span>&nbsp;<span class="op" id="4571266">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571269">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571286">pmode</span>&nbsp;<span class="op" id="4571292">=</span>&nbsp;<span class="num" id="4571294">1</span>&nbsp;<span class="op" id="4571296">&lt;&lt;</span>&nbsp;<span class="ident" id="4571299">iota</span>&nbsp;<span class="comment" id="4571304">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571352">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571387">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="4571439">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4571442">type</span>&nbsp;<span class="ident" id="4571447">commentInfo</span>&nbsp;<span class="keyword" id="4571459">struct</span>&nbsp;<span class="op" id="4571466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571469">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4571484">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571502">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571528">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4571543">*</span><span class="ident" id="4571544">ast</span><span class="op" id="4571547">.</span><span class="ident" id="4571548">CommentGroup</span>&nbsp;<span class="comment" id="4571561">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571600">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="4571615">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571633">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571714">commentNewline</span>&nbsp;<span class="builtintype" id="4571729">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571747">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="4571794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4571797">type</span>&nbsp;<span class="ident" id="4571802">printer</span>&nbsp;<span class="keyword" id="4571810">struct</span>&nbsp;<span class="op" id="4571817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571820">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571877">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571885">fset</span>&nbsp;<span class="op" id="4571890">*</span><span class="ident" id="4571891">token</span><span class="op" id="4571896">.</span><span class="ident" id="4571897">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571907">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571925">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4571937">[</span><span class="op" id="4571938">]</span><span class="builtintype" id="4571939">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571950">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4571973">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4571985">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4571998">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572022">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572034">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572047">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572072">impliedSemi</span>&nbsp;<span class="builtintype" id="4572084">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572097">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572141">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572153">token</span><span class="op" id="4572158">.</span><span class="ident" id="4572159">Token</span>&nbsp;&nbsp;<span class="comment" id="4572166">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572224">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572236">token</span><span class="op" id="4572241">.</span><span class="ident" id="4572242">Token</span>&nbsp;&nbsp;<span class="comment" id="4572249">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572308">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4572320">[</span><span class="op" id="4572321">]</span><span class="ident" id="4572322">whiteSpace</span>&nbsp;<span class="comment" id="4572333">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572358">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572372">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572439">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572507">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572573">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572639">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572683">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572691">token</span><span class="op" id="4572696">.</span><span class="ident" id="4572697">Position</span>&nbsp;<span class="comment" id="4572706">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572749">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572757">token</span><span class="op" id="4572762">.</span><span class="ident" id="4572763">Position</span>&nbsp;<span class="comment" id="4572772">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572809">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572817">token</span><span class="op" id="4572822">.</span><span class="ident" id="4572823">Position</span>&nbsp;<span class="comment" id="4572832">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4572875">linePtr</span>&nbsp;<span class="op" id="4572883">*</span><span class="builtintype" id="4572884">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572898">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572958">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573019">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4573035">[</span><span class="op" id="4573036">]</span><span class="op" id="4573037">*</span><span class="ident" id="4573038">ast</span><span class="op" id="4573041">.</span><span class="ident" id="4573042">CommentGroup</span>&nbsp;<span class="comment" id="4573055">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573070">useNodeComments</span>&nbsp;<span class="builtintype" id="4573086">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4573106">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4573162">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573229">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4573243">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573285">nodeSizes</span>&nbsp;<span class="keyword" id="4573295">map</span><span class="op" id="4573298">[</span><span class="ident" id="4573299">ast</span><span class="op" id="4573302">.</span><span class="ident" id="4573303">Node</span><span class="op" id="4573307">]</span><span class="builtintype" id="4573308">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4573314">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573365">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="4573376">token</span><span class="op" id="4573381">.</span><span class="ident" id="4573382">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573387">cachedLine</span>&nbsp;<span class="builtintype" id="4573398">int</span>&nbsp;<span class="comment" id="4573402">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="4573437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4573440">func</span>&nbsp;<span class="op" id="4573445">(</span><span class="ident" id="4573446">p</span>&nbsp;<span class="op" id="4573448">*</span><span class="ident" id="4573449">printer</span><span class="op" id="4573456">)</span>&nbsp;<span class="ident" id="4573458">init</span><span class="op" id="4573462">(</span><span class="ident" id="4573463">cfg</span>&nbsp;<span class="op" id="4573467">*</span><span class="ident" id="4573468">Config</span><span class="op" id="4573474">,</span>&nbsp;<span class="ident" id="4573476">fset</span>&nbsp;<span class="op" id="4573481">*</span><span class="ident" id="4573482">token</span><span class="op" id="4573487">.</span><span class="ident" id="4573488">FileSet</span><span class="op" id="4573495">,</span>&nbsp;<span class="ident" id="4573497">nodeSizes</span>&nbsp;<span class="keyword" id="4573507">map</span><span class="op" id="4573510">[</span><span class="ident" id="4573511">ast</span><span class="op" id="4573514">.</span><span class="ident" id="4573515">Node</span><span class="op" id="4573519">]</span><span class="builtintype" id="4573520">int</span><span class="op" id="4573523">)</span>&nbsp;<span class="op" id="4573525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573528">p</span><span class="op" id="4573529">.</span><span class="ident" id="4573530">Config</span>&nbsp;<span class="op" id="4573537">=</span>&nbsp;<span class="op" id="4573539">*</span><span class="ident" id="4573540">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573545">p</span><span class="op" id="4573546">.</span><span class="ident" id="4573547">fset</span>&nbsp;<span class="op" id="4573552">=</span>&nbsp;<span class="ident" id="4573554">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573560">p</span><span class="op" id="4573561">.</span><span class="ident" id="4573562">pos</span>&nbsp;<span class="op" id="4573566">=</span>&nbsp;<span class="ident" id="4573568">token</span><span class="op" id="4573573">.</span><span class="ident" id="4573574">Position</span><span class="op" id="4573582">{</span><span class="ident" id="4573583">Line</span><span class="op" id="4573587">:</span>&nbsp;<span class="num" id="4573589">1</span><span class="op" id="4573590">,</span>&nbsp;<span class="ident" id="4573592">Column</span><span class="op" id="4573598">:</span>&nbsp;<span class="num" id="4573600">1</span><span class="op" id="4573601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573604">p</span><span class="op" id="4573605">.</span><span class="ident" id="4573606">out</span>&nbsp;<span class="op" id="4573610">=</span>&nbsp;<span class="ident" id="4573612">token</span><span class="op" id="4573617">.</span><span class="ident" id="4573618">Position</span><span class="op" id="4573626">{</span><span class="ident" id="4573627">Line</span><span class="op" id="4573631">:</span>&nbsp;<span class="num" id="4573633">1</span><span class="op" id="4573634">,</span>&nbsp;<span class="ident" id="4573636">Column</span><span class="op" id="4573642">:</span>&nbsp;<span class="num" id="4573644">1</span><span class="op" id="4573645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573648">p</span><span class="op" id="4573649">.</span><span class="ident" id="4573650">wsbuf</span>&nbsp;<span class="op" id="4573656">=</span>&nbsp;<span class="builtinfunc" id="4573658">make</span><span class="op" id="4573662">(</span><span class="op" id="4573663">[</span><span class="op" id="4573664">]</span><span class="ident" id="4573665">whiteSpace</span><span class="op" id="4573675">,</span>&nbsp;<span class="num" id="4573677">0</span><span class="op" id="4573678">,</span>&nbsp;<span class="num" id="4573680">16</span><span class="op" id="4573682">)</span>&nbsp;<span class="comment" id="4573684">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573719">p</span><span class="op" id="4573720">.</span><span class="ident" id="4573721">nodeSizes</span>&nbsp;<span class="op" id="4573731">=</span>&nbsp;<span class="ident" id="4573733">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573744">p</span><span class="op" id="4573745">.</span><span class="ident" id="4573746">cachedPos</span>&nbsp;<span class="op" id="4573756">=</span>&nbsp;<span class="op" id="4573758">-</span><span class="num" id="4573759">1</span><br>
<span class="lineno"></span><span class="op" id="4573761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4573764">func</span>&nbsp;<span class="op" id="4573769">(</span><span class="ident" id="4573770">p</span>&nbsp;<span class="op" id="4573772">*</span><span class="ident" id="4573773">printer</span><span class="op" id="4573780">)</span>&nbsp;<span class="ident" id="4573782">internalError</span><span class="op" id="4573795">(</span><span class="ident" id="4573796">msg</span>&nbsp;<span class="op" id="4573800">...</span><span class="keyword" id="4573803">interface</span><span class="op" id="4573812">{</span><span class="op" id="4573813">}</span><span class="op" id="4573814">)</span>&nbsp;<span class="op" id="4573816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4573819">if</span>&nbsp;<span class="ident" id="4573822">debug</span>&nbsp;<span class="op" id="4573828">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573832">fmt</span><span class="op" id="4573835">.</span><span class="ident" id="4573836">Print</span><span class="op" id="4573841">(</span><span class="ident" id="4573842">p</span><span class="op" id="4573843">.</span><span class="ident" id="4573844">pos</span><span class="op" id="4573847">.</span><span class="ident" id="4573848">String</span><span class="op" id="4573854">(</span><span class="op" id="4573855">)</span>&nbsp;<span class="op" id="4573857">+</span>&nbsp;<span class="string" id="4573859">&#34;:&nbsp;&#34;</span><span class="op" id="4573863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4573867">fmt</span><span class="op" id="4573870">.</span><span class="ident" id="4573871">Println</span><span class="op" id="4573878">(</span><span class="ident" id="4573879">msg</span><span class="op" id="4573882">...</span><span class="op" id="4573885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4573889">panic</span><span class="op" id="4573894">(</span><span class="string" id="4573895">&#34;go/printer&#34;</span><span class="op" id="4573907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4573910">}</span><br>
<span class="lineno"></span><span class="op" id="4573912">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4573915">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4573986">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4574062">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4574135">func</span>&nbsp;<span class="op" id="4574140">(</span><span class="ident" id="4574141">p</span>&nbsp;<span class="op" id="4574143">*</span><span class="ident" id="4574144">printer</span><span class="op" id="4574151">)</span>&nbsp;<span class="ident" id="4574153">commentsHaveNewline</span><span class="op" id="4574172">(</span><span class="ident" id="4574173">list</span>&nbsp;<span class="op" id="4574178">[</span><span class="op" id="4574179">]</span><span class="op" id="4574180">*</span><span class="ident" id="4574181">ast</span><span class="op" id="4574184">.</span><span class="ident" id="4574185">Comment</span><span class="op" id="4574192">)</span>&nbsp;<span class="builtintype" id="4574194">bool</span>&nbsp;<span class="op" id="4574199">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4574202">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574220">line</span>&nbsp;<span class="op" id="4574225">:=</span>&nbsp;<span class="ident" id="4574228">p</span><span class="op" id="4574229">.</span><span class="ident" id="4574230">lineFor</span><span class="op" id="4574237">(</span><span class="ident" id="4574238">list</span><span class="op" id="4574242">[</span><span class="num" id="4574243">0</span><span class="op" id="4574244">]</span><span class="op" id="4574245">.</span><span class="ident" id="4574246">Pos</span><span class="op" id="4574249">(</span><span class="op" id="4574250">)</span><span class="op" id="4574251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574254">for</span>&nbsp;<span class="ident" id="4574258">i</span><span class="op" id="4574259">,</span>&nbsp;<span class="ident" id="4574261">c</span>&nbsp;<span class="op" id="4574263">:=</span>&nbsp;<span class="keyword" id="4574266">range</span>&nbsp;<span class="ident" id="4574272">list</span>&nbsp;<span class="op" id="4574277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574281">if</span>&nbsp;<span class="ident" id="4574284">i</span>&nbsp;<span class="op" id="4574286">&gt;</span>&nbsp;<span class="num" id="4574288">0</span>&nbsp;<span class="op" id="4574290">&amp;&amp;</span>&nbsp;<span class="ident" id="4574293">p</span><span class="op" id="4574294">.</span><span class="ident" id="4574295">lineFor</span><span class="op" id="4574302">(</span><span class="ident" id="4574303">list</span><span class="op" id="4574307">[</span><span class="ident" id="4574308">i</span><span class="op" id="4574309">]</span><span class="op" id="4574310">.</span><span class="ident" id="4574311">Pos</span><span class="op" id="4574314">(</span><span class="op" id="4574315">)</span><span class="op" id="4574316">)</span>&nbsp;<span class="op" id="4574318">!=</span>&nbsp;<span class="ident" id="4574321">line</span>&nbsp;<span class="op" id="4574326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4574331">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574371">return</span>&nbsp;<span class="builtintype" id="4574378">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4574385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574389">if</span>&nbsp;<span class="ident" id="4574392">t</span>&nbsp;<span class="op" id="4574394">:=</span>&nbsp;<span class="ident" id="4574397">c</span><span class="op" id="4574398">.</span><span class="ident" id="4574399">Text</span><span class="op" id="4574403">;</span>&nbsp;<span class="builtinfunc" id="4574405">len</span><span class="op" id="4574408">(</span><span class="ident" id="4574409">t</span><span class="op" id="4574410">)</span>&nbsp;<span class="op" id="4574412">&gt;=</span>&nbsp;<span class="num" id="4574415">2</span>&nbsp;<span class="op" id="4574417">&amp;&amp;</span>&nbsp;<span class="op" id="4574420">(</span><span class="ident" id="4574421">t</span><span class="op" id="4574422">[</span><span class="num" id="4574423">1</span><span class="op" id="4574424">]</span>&nbsp;<span class="op" id="4574426">==</span>&nbsp;<span class="string" id="4574429">&#39;/&#39;</span>&nbsp;<span class="op" id="4574433">||</span>&nbsp;<span class="ident" id="4574436">strings</span><span class="op" id="4574443">.</span><span class="ident" id="4574444">Contains</span><span class="op" id="4574452">(</span><span class="ident" id="4574453">t</span><span class="op" id="4574454">,</span>&nbsp;<span class="string" id="4574456">&#34;\n&#34;</span><span class="op" id="4574460">)</span><span class="op" id="4574461">)</span>&nbsp;<span class="op" id="4574463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574468">return</span>&nbsp;<span class="builtintype" id="4574475">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4574482">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4574485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574488">_</span>&nbsp;<span class="op" id="4574490">=</span>&nbsp;<span class="ident" id="4574492">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574498">return</span>&nbsp;<span class="builtintype" id="4574505">false</span><br>
<span class="lineno"></span><span class="op" id="4574511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4574514">func</span>&nbsp;<span class="op" id="4574519">(</span><span class="ident" id="4574520">p</span>&nbsp;<span class="op" id="4574522">*</span><span class="ident" id="4574523">printer</span><span class="op" id="4574530">)</span>&nbsp;<span class="ident" id="4574532">nextComment</span><span class="op" id="4574543">(</span><span class="op" id="4574544">)</span>&nbsp;<span class="op" id="4574546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574549">for</span>&nbsp;<span class="ident" id="4574553">p</span><span class="op" id="4574554">.</span><span class="ident" id="4574555">cindex</span>&nbsp;<span class="op" id="4574562">&lt;</span>&nbsp;<span class="builtinfunc" id="4574564">len</span><span class="op" id="4574567">(</span><span class="ident" id="4574568">p</span><span class="op" id="4574569">.</span><span class="ident" id="4574570">comments</span><span class="op" id="4574578">)</span>&nbsp;<span class="op" id="4574580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574584">c</span>&nbsp;<span class="op" id="4574586">:=</span>&nbsp;<span class="ident" id="4574589">p</span><span class="op" id="4574590">.</span><span class="ident" id="4574591">comments</span><span class="op" id="4574599">[</span><span class="ident" id="4574600">p</span><span class="op" id="4574601">.</span><span class="ident" id="4574602">cindex</span><span class="op" id="4574608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574612">p</span><span class="op" id="4574613">.</span><span class="ident" id="4574614">cindex</span><span class="op" id="4574620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574625">if</span>&nbsp;<span class="ident" id="4574628">list</span>&nbsp;<span class="op" id="4574633">:=</span>&nbsp;<span class="ident" id="4574636">c</span><span class="op" id="4574637">.</span><span class="ident" id="4574638">List</span><span class="op" id="4574642">;</span>&nbsp;<span class="builtinfunc" id="4574644">len</span><span class="op" id="4574647">(</span><span class="ident" id="4574648">list</span><span class="op" id="4574652">)</span>&nbsp;<span class="op" id="4574654">&gt;</span>&nbsp;<span class="num" id="4574656">0</span>&nbsp;<span class="op" id="4574658">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574663">p</span><span class="op" id="4574664">.</span><span class="ident" id="4574665">comment</span>&nbsp;<span class="op" id="4574673">=</span>&nbsp;<span class="ident" id="4574675">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574680">p</span><span class="op" id="4574681">.</span><span class="ident" id="4574682">commentOffset</span>&nbsp;<span class="op" id="4574696">=</span>&nbsp;<span class="ident" id="4574698">p</span><span class="op" id="4574699">.</span><span class="ident" id="4574700">posFor</span><span class="op" id="4574706">(</span><span class="ident" id="4574707">list</span><span class="op" id="4574711">[</span><span class="num" id="4574712">0</span><span class="op" id="4574713">]</span><span class="op" id="4574714">.</span><span class="ident" id="4574715">Pos</span><span class="op" id="4574718">(</span><span class="op" id="4574719">)</span><span class="op" id="4574720">)</span><span class="op" id="4574721">.</span><span class="ident" id="4574722">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574732">p</span><span class="op" id="4574733">.</span><span class="ident" id="4574734">commentNewline</span>&nbsp;<span class="op" id="4574749">=</span>&nbsp;<span class="ident" id="4574751">p</span><span class="op" id="4574752">.</span><span class="ident" id="4574753">commentsHaveNewline</span><span class="op" id="4574772">(</span><span class="ident" id="4574773">list</span><span class="op" id="4574777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4574782">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4574791">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4574795">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4574856">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4574919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4574922">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4574943">p</span><span class="op" id="4574944">.</span><span class="ident" id="4574945">commentOffset</span>&nbsp;<span class="op" id="4574959">=</span>&nbsp;<span class="ident" id="4574961">infinity</span><br>
<span class="lineno">145</span><span class="op" id="4574970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4574973">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="4575040">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4575108">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="4575146">//</span><br>
<span class="lineno"></span><span class="keyword" id="4575149">func</span>&nbsp;<span class="op" id="4575154">(</span><span class="ident" id="4575155">p</span>&nbsp;<span class="op" id="4575157">*</span><span class="ident" id="4575158">printer</span><span class="op" id="4575165">)</span>&nbsp;<span class="ident" id="4575167">commentBefore</span><span class="op" id="4575180">(</span><span class="ident" id="4575181">next</span>&nbsp;<span class="ident" id="4575186">token</span><span class="op" id="4575191">.</span><span class="ident" id="4575192">Position</span><span class="op" id="4575200">)</span>&nbsp;<span class="builtintype" id="4575202">bool</span>&nbsp;<span class="op" id="4575207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4575210">return</span>&nbsp;<span class="ident" id="4575217">p</span><span class="op" id="4575218">.</span><span class="ident" id="4575219">commentOffset</span>&nbsp;<span class="op" id="4575233">&lt;</span>&nbsp;<span class="ident" id="4575235">next</span><span class="op" id="4575239">.</span><span class="ident" id="4575240">Offset</span>&nbsp;<span class="op" id="4575247">&amp;&amp;</span>&nbsp;<span class="op" id="4575250">(</span><span class="op" id="4575251">!</span><span class="ident" id="4575252">p</span><span class="op" id="4575253">.</span><span class="ident" id="4575254">impliedSemi</span>&nbsp;<span class="op" id="4575266">||</span>&nbsp;<span class="op" id="4575269">!</span><span class="ident" id="4575270">p</span><span class="op" id="4575271">.</span><span class="ident" id="4575272">commentNewline</span><span class="op" id="4575286">)</span><br>
<span class="lineno"></span><span class="op" id="4575288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="4575291">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4575346">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4575401">//</span><br>
<span class="lineno"></span><span class="keyword" id="4575404">func</span>&nbsp;<span class="op" id="4575409">(</span><span class="ident" id="4575410">p</span>&nbsp;<span class="op" id="4575412">*</span><span class="ident" id="4575413">printer</span><span class="op" id="4575420">)</span>&nbsp;<span class="ident" id="4575422">commentSizeBefore</span><span class="op" id="4575439">(</span><span class="ident" id="4575440">next</span>&nbsp;<span class="ident" id="4575445">token</span><span class="op" id="4575450">.</span><span class="ident" id="4575451">Position</span><span class="op" id="4575459">)</span>&nbsp;<span class="builtintype" id="4575461">int</span>&nbsp;<span class="op" id="4575465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4575468">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4575537">defer</span>&nbsp;<span class="keyword" id="4575543">func</span><span class="op" id="4575547">(</span><span class="ident" id="4575548">info</span>&nbsp;<span class="ident" id="4575553">commentInfo</span><span class="op" id="4575564">)</span>&nbsp;<span class="op" id="4575566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4575570">p</span><span class="op" id="4575571">.</span><span class="ident" id="4575572">commentInfo</span>&nbsp;<span class="op" id="4575584">=</span>&nbsp;<span class="ident" id="4575586">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4575592">}</span><span class="op" id="4575593">(</span><span class="ident" id="4575594">p</span><span class="op" id="4575595">.</span><span class="ident" id="4575596">commentInfo</span><span class="op" id="4575607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4575611">size</span>&nbsp;<span class="op" id="4575616">:=</span>&nbsp;<span class="num" id="4575619">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4575622">for</span>&nbsp;<span class="ident" id="4575626">p</span><span class="op" id="4575627">.</span><span class="ident" id="4575628">commentBefore</span><span class="op" id="4575641">(</span><span class="ident" id="4575642">next</span><span class="op" id="4575646">)</span>&nbsp;<span class="op" id="4575648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4575652">for</span>&nbsp;<span class="ident" id="4575656">_</span><span class="op" id="4575657">,</span>&nbsp;<span class="ident" id="4575659">c</span>&nbsp;<span class="op" id="4575661">:=</span>&nbsp;<span class="keyword" id="4575664">range</span>&nbsp;<span class="ident" id="4575670">p</span><span class="op" id="4575671">.</span><span class="ident" id="4575672">comment</span><span class="op" id="4575679">.</span><span class="ident" id="4575680">List</span>&nbsp;<span class="op" id="4575685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4575690">size</span>&nbsp;<span class="op" id="4575695">+=</span>&nbsp;<span class="builtinfunc" id="4575698">len</span><span class="op" id="4575701">(</span><span class="ident" id="4575702">c</span><span class="op" id="4575703">.</span><span class="ident" id="4575704">Text</span><span class="op" id="4575708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4575712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4575716">p</span><span class="op" id="4575717">.</span><span class="ident" id="4575718">nextComment</span><span class="op" id="4575729">(</span><span class="op" id="4575730">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4575733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4575736">return</span>&nbsp;<span class="ident" id="4575743">size</span><br>
<span class="lineno"></span><span class="op" id="4575748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4575751">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="4575824">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4575898">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4575974">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4575990">//</span><br>
<span class="lineno"></span><span class="keyword" id="4575993">func</span>&nbsp;<span class="op" id="4575998">(</span><span class="ident" id="4575999">p</span>&nbsp;<span class="op" id="4576001">*</span><span class="ident" id="4576002">printer</span><span class="op" id="4576009">)</span>&nbsp;<span class="ident" id="4576011">recordLine</span><span class="op" id="4576021">(</span><span class="ident" id="4576022">linePtr</span>&nbsp;<span class="op" id="4576030">*</span><span class="builtintype" id="4576031">int</span><span class="op" id="4576034">)</span>&nbsp;<span class="op" id="4576036">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4576039">p</span><span class="op" id="4576040">.</span><span class="ident" id="4576041">linePtr</span>&nbsp;<span class="op" id="4576049">=</span>&nbsp;<span class="ident" id="4576051">linePtr</span><br>
<span class="lineno"></span><span class="op" id="4576059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4576062">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="4576130">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="4576198">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="4576268">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="4576324">//</span><br>
<span class="lineno"></span><span class="keyword" id="4576327">func</span>&nbsp;<span class="op" id="4576332">(</span><span class="ident" id="4576333">p</span>&nbsp;<span class="op" id="4576335">*</span><span class="ident" id="4576336">printer</span><span class="op" id="4576343">)</span>&nbsp;<span class="ident" id="4576345">linesFrom</span><span class="op" id="4576354">(</span><span class="ident" id="4576355">line</span>&nbsp;<span class="builtintype" id="4576360">int</span><span class="op" id="4576363">)</span>&nbsp;<span class="builtintype" id="4576365">int</span>&nbsp;<span class="op" id="4576369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4576372">return</span>&nbsp;<span class="ident" id="4576379">p</span><span class="op" id="4576380">.</span><span class="ident" id="4576381">out</span><span class="op" id="4576384">.</span><span class="ident" id="4576385">Line</span>&nbsp;<span class="op" id="4576390">-</span>&nbsp;<span class="ident" id="4576392">line</span><br>
<span class="lineno">190</span><span class="op" id="4576397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4576400">func</span>&nbsp;<span class="op" id="4576405">(</span><span class="ident" id="4576406">p</span>&nbsp;<span class="op" id="4576408">*</span><span class="ident" id="4576409">printer</span><span class="op" id="4576416">)</span>&nbsp;<span class="ident" id="4576418">posFor</span><span class="op" id="4576424">(</span><span class="ident" id="4576425">pos</span>&nbsp;<span class="ident" id="4576429">token</span><span class="op" id="4576434">.</span><span class="ident" id="4576435">Pos</span><span class="op" id="4576438">)</span>&nbsp;<span class="ident" id="4576440">token</span><span class="op" id="4576445">.</span><span class="ident" id="4576446">Position</span>&nbsp;<span class="op" id="4576455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4576458">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4576520">return</span>&nbsp;<span class="ident" id="4576527">p</span><span class="op" id="4576528">.</span><span class="ident" id="4576529">fset</span><span class="op" id="4576533">.</span><span class="ident" id="4576534">Position</span><span class="op" id="4576542">(</span><span class="ident" id="4576543">pos</span><span class="op" id="4576546">)</span><br>
<span class="lineno">195</span><span class="op" id="4576548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4576551">func</span>&nbsp;<span class="op" id="4576556">(</span><span class="ident" id="4576557">p</span>&nbsp;<span class="op" id="4576559">*</span><span class="ident" id="4576560">printer</span><span class="op" id="4576567">)</span>&nbsp;<span class="ident" id="4576569">lineFor</span><span class="op" id="4576576">(</span><span class="ident" id="4576577">pos</span>&nbsp;<span class="ident" id="4576581">token</span><span class="op" id="4576586">.</span><span class="ident" id="4576587">Pos</span><span class="op" id="4576590">)</span>&nbsp;<span class="builtintype" id="4576592">int</span>&nbsp;<span class="op" id="4576596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4576599">if</span>&nbsp;<span class="ident" id="4576602">pos</span>&nbsp;<span class="op" id="4576606">!=</span>&nbsp;<span class="ident" id="4576609">p</span><span class="op" id="4576610">.</span><span class="ident" id="4576611">cachedPos</span>&nbsp;<span class="op" id="4576621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4576625">p</span><span class="op" id="4576626">.</span><span class="ident" id="4576627">cachedPos</span>&nbsp;<span class="op" id="4576637">=</span>&nbsp;<span class="ident" id="4576639">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4576645">p</span><span class="op" id="4576646">.</span><span class="ident" id="4576647">cachedLine</span>&nbsp;<span class="op" id="4576658">=</span>&nbsp;<span class="ident" id="4576660">p</span><span class="op" id="4576661">.</span><span class="ident" id="4576662">fset</span><span class="op" id="4576666">.</span><span class="ident" id="4576667">Position</span><span class="op" id="4576675">(</span><span class="ident" id="4576676">pos</span><span class="op" id="4576679">)</span><span class="op" id="4576680">.</span><span class="ident" id="4576681">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4576687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4576690">return</span>&nbsp;<span class="ident" id="4576697">p</span><span class="op" id="4576698">.</span><span class="ident" id="4576699">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="4576710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4576713">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="4576788">func</span>&nbsp;<span class="op" id="4576793">(</span><span class="ident" id="4576794">p</span>&nbsp;<span class="op" id="4576796">*</span><span class="ident" id="4576797">printer</span><span class="op" id="4576804">)</span>&nbsp;<span class="ident" id="4576806">atLineBegin</span><span class="op" id="4576817">(</span><span class="ident" id="4576818">pos</span>&nbsp;<span class="ident" id="4576822">token</span><span class="op" id="4576827">.</span><span class="ident" id="4576828">Position</span><span class="op" id="4576836">)</span>&nbsp;<span class="op" id="4576838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4576841">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4576881">if</span>&nbsp;<span class="ident" id="4576884">p</span><span class="op" id="4576885">.</span><span class="ident" id="4576886">Config</span><span class="op" id="4576892">.</span><span class="ident" id="4576893">Mode</span><span class="op" id="4576897">&amp;</span><span class="ident" id="4576898">SourcePos</span>&nbsp;<span class="op" id="4576908">!=</span>&nbsp;<span class="num" id="4576911">0</span>&nbsp;<span class="op" id="4576913">&amp;&amp;</span>&nbsp;<span class="ident" id="4576916">pos</span><span class="op" id="4576919">.</span><span class="ident" id="4576920">IsValid</span><span class="op" id="4576927">(</span><span class="op" id="4576928">)</span>&nbsp;<span class="op" id="4576930">&amp;&amp;</span>&nbsp;<span class="op" id="4576933">(</span><span class="ident" id="4576934">p</span><span class="op" id="4576935">.</span><span class="ident" id="4576936">out</span><span class="op" id="4576939">.</span><span class="ident" id="4576940">Line</span>&nbsp;<span class="op" id="4576945">!=</span>&nbsp;<span class="ident" id="4576948">pos</span><span class="op" id="4576951">.</span><span class="ident" id="4576952">Line</span>&nbsp;<span class="op" id="4576957">||</span>&nbsp;<span class="ident" id="4576960">p</span><span class="op" id="4576961">.</span><span class="ident" id="4576962">out</span><span class="op" id="4576965">.</span><span class="ident" id="4576966">Filename</span>&nbsp;<span class="op" id="4576975">!=</span>&nbsp;<span class="ident" id="4576978">pos</span><span class="op" id="4576981">.</span><span class="ident" id="4576982">Filename</span><span class="op" id="4576990">)</span>&nbsp;<span class="op" id="4576992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4576996">p</span><span class="op" id="4576997">.</span><span class="ident" id="4576998">output</span>&nbsp;<span class="op" id="4577005">=</span>&nbsp;<span class="builtinfunc" id="4577007">append</span><span class="op" id="4577013">(</span><span class="ident" id="4577014">p</span><span class="op" id="4577015">.</span><span class="ident" id="4577016">output</span><span class="op" id="4577022">,</span>&nbsp;<span class="ident" id="4577024">tabwriter</span><span class="op" id="4577033">.</span><span class="ident" id="4577034">Escape</span><span class="op" id="4577040">)</span>&nbsp;<span class="comment" id="4577042">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577100">p</span><span class="op" id="4577101">.</span><span class="ident" id="4577102">output</span>&nbsp;<span class="op" id="4577109">=</span>&nbsp;<span class="builtinfunc" id="4577111">append</span><span class="op" id="4577117">(</span><span class="ident" id="4577118">p</span><span class="op" id="4577119">.</span><span class="ident" id="4577120">output</span><span class="op" id="4577126">,</span>&nbsp;<span class="ident" id="4577128">fmt</span><span class="op" id="4577131">.</span><span class="ident" id="4577132">Sprintf</span><span class="op" id="4577139">(</span><span class="string" id="4577140">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="4577156">,</span>&nbsp;<span class="ident" id="4577158">pos</span><span class="op" id="4577161">.</span><span class="ident" id="4577162">Filename</span><span class="op" id="4577170">,</span>&nbsp;<span class="ident" id="4577172">pos</span><span class="op" id="4577175">.</span><span class="ident" id="4577176">Line</span><span class="op" id="4577180">)</span><span class="op" id="4577181">...</span><span class="op" id="4577184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577188">p</span><span class="op" id="4577189">.</span><span class="ident" id="4577190">output</span>&nbsp;<span class="op" id="4577197">=</span>&nbsp;<span class="builtinfunc" id="4577199">append</span><span class="op" id="4577205">(</span><span class="ident" id="4577206">p</span><span class="op" id="4577207">.</span><span class="ident" id="4577208">output</span><span class="op" id="4577214">,</span>&nbsp;<span class="ident" id="4577216">tabwriter</span><span class="op" id="4577225">.</span><span class="ident" id="4577226">Escape</span><span class="op" id="4577232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577236">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577277">p</span><span class="op" id="4577278">.</span><span class="ident" id="4577279">out</span><span class="op" id="4577282">.</span><span class="ident" id="4577283">Filename</span>&nbsp;<span class="op" id="4577292">=</span>&nbsp;<span class="ident" id="4577294">pos</span><span class="op" id="4577297">.</span><span class="ident" id="4577298">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577309">p</span><span class="op" id="4577310">.</span><span class="ident" id="4577311">out</span><span class="op" id="4577314">.</span><span class="ident" id="4577315">Line</span>&nbsp;<span class="op" id="4577320">=</span>&nbsp;<span class="ident" id="4577322">pos</span><span class="op" id="4577325">.</span><span class="ident" id="4577326">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4577332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577336">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577358">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577401">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577444">n</span>&nbsp;<span class="op" id="4577446">:=</span>&nbsp;<span class="ident" id="4577449">p</span><span class="op" id="4577450">.</span><span class="ident" id="4577451">Config</span><span class="op" id="4577457">.</span><span class="ident" id="4577458">Indent</span>&nbsp;<span class="op" id="4577465">+</span>&nbsp;<span class="ident" id="4577467">p</span><span class="op" id="4577468">.</span><span class="ident" id="4577469">indent</span>&nbsp;<span class="comment" id="4577476">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4577505">for</span>&nbsp;<span class="ident" id="4577509">i</span>&nbsp;<span class="op" id="4577511">:=</span>&nbsp;<span class="num" id="4577514">0</span><span class="op" id="4577515">;</span>&nbsp;<span class="ident" id="4577517">i</span>&nbsp;<span class="op" id="4577519">&lt;</span>&nbsp;<span class="ident" id="4577521">n</span><span class="op" id="4577522">;</span>&nbsp;<span class="ident" id="4577524">i</span><span class="op" id="4577525">++</span>&nbsp;<span class="op" id="4577528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577532">p</span><span class="op" id="4577533">.</span><span class="ident" id="4577534">output</span>&nbsp;<span class="op" id="4577541">=</span>&nbsp;<span class="builtinfunc" id="4577543">append</span><span class="op" id="4577549">(</span><span class="ident" id="4577550">p</span><span class="op" id="4577551">.</span><span class="ident" id="4577552">output</span><span class="op" id="4577558">,</span>&nbsp;<span class="string" id="4577560">&#39;\t&#39;</span><span class="op" id="4577564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4577567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577571">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577592">p</span><span class="op" id="4577593">.</span><span class="ident" id="4577594">pos</span><span class="op" id="4577597">.</span><span class="ident" id="4577598">Offset</span>&nbsp;<span class="op" id="4577605">+=</span>&nbsp;<span class="ident" id="4577608">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577611">p</span><span class="op" id="4577612">.</span><span class="ident" id="4577613">pos</span><span class="op" id="4577616">.</span><span class="ident" id="4577617">Column</span>&nbsp;<span class="op" id="4577624">+=</span>&nbsp;<span class="ident" id="4577627">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577630">p</span><span class="op" id="4577631">.</span><span class="ident" id="4577632">out</span><span class="op" id="4577635">.</span><span class="ident" id="4577636">Column</span>&nbsp;<span class="op" id="4577643">+=</span>&nbsp;<span class="ident" id="4577646">n</span><br>
<span class="lineno"></span><span class="op" id="4577648">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4577651">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="4577713">func</span>&nbsp;<span class="op" id="4577718">(</span><span class="ident" id="4577719">p</span>&nbsp;<span class="op" id="4577721">*</span><span class="ident" id="4577722">printer</span><span class="op" id="4577729">)</span>&nbsp;<span class="ident" id="4577731">writeByte</span><span class="op" id="4577740">(</span><span class="ident" id="4577741">ch</span>&nbsp;<span class="builtintype" id="4577744">byte</span><span class="op" id="4577748">,</span>&nbsp;<span class="ident" id="4577750">n</span>&nbsp;<span class="builtintype" id="4577752">int</span><span class="op" id="4577755">)</span>&nbsp;<span class="op" id="4577757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4577760">if</span>&nbsp;<span class="ident" id="4577763">p</span><span class="op" id="4577764">.</span><span class="ident" id="4577765">out</span><span class="op" id="4577768">.</span><span class="ident" id="4577769">Column</span>&nbsp;<span class="op" id="4577776">==</span>&nbsp;<span class="num" id="4577779">1</span>&nbsp;<span class="op" id="4577781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577785">p</span><span class="op" id="4577786">.</span><span class="ident" id="4577787">atLineBegin</span><span class="op" id="4577798">(</span><span class="ident" id="4577799">p</span><span class="op" id="4577800">.</span><span class="ident" id="4577801">pos</span><span class="op" id="4577804">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4577807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4577811">for</span>&nbsp;<span class="ident" id="4577815">i</span>&nbsp;<span class="op" id="4577817">:=</span>&nbsp;<span class="num" id="4577820">0</span><span class="op" id="4577821">;</span>&nbsp;<span class="ident" id="4577823">i</span>&nbsp;<span class="op" id="4577825">&lt;</span>&nbsp;<span class="ident" id="4577827">n</span><span class="op" id="4577828">;</span>&nbsp;<span class="ident" id="4577830">i</span><span class="op" id="4577831">++</span>&nbsp;<span class="op" id="4577834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577838">p</span><span class="op" id="4577839">.</span><span class="ident" id="4577840">output</span>&nbsp;<span class="op" id="4577847">=</span>&nbsp;<span class="builtinfunc" id="4577849">append</span><span class="op" id="4577855">(</span><span class="ident" id="4577856">p</span><span class="op" id="4577857">.</span><span class="ident" id="4577858">output</span><span class="op" id="4577864">,</span>&nbsp;<span class="ident" id="4577866">ch</span><span class="op" id="4577868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4577871">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4577875">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577896">p</span><span class="op" id="4577897">.</span><span class="ident" id="4577898">pos</span><span class="op" id="4577901">.</span><span class="ident" id="4577902">Offset</span>&nbsp;<span class="op" id="4577909">+=</span>&nbsp;<span class="ident" id="4577912">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4577915">if</span>&nbsp;<span class="ident" id="4577918">ch</span>&nbsp;<span class="op" id="4577921">==</span>&nbsp;<span class="string" id="4577924">&#39;\n&#39;</span>&nbsp;<span class="op" id="4577929">||</span>&nbsp;<span class="ident" id="4577932">ch</span>&nbsp;<span class="op" id="4577935">==</span>&nbsp;<span class="string" id="4577938">&#39;\f&#39;</span>&nbsp;<span class="op" id="4577943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577947">p</span><span class="op" id="4577948">.</span><span class="ident" id="4577949">pos</span><span class="op" id="4577952">.</span><span class="ident" id="4577953">Line</span>&nbsp;<span class="op" id="4577958">+=</span>&nbsp;<span class="ident" id="4577961">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577965">p</span><span class="op" id="4577966">.</span><span class="ident" id="4577967">out</span><span class="op" id="4577970">.</span><span class="ident" id="4577971">Line</span>&nbsp;<span class="op" id="4577976">+=</span>&nbsp;<span class="ident" id="4577979">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4577983">p</span><span class="op" id="4577984">.</span><span class="ident" id="4577985">pos</span><span class="op" id="4577988">.</span><span class="ident" id="4577989">Column</span>&nbsp;<span class="op" id="4577996">=</span>&nbsp;<span class="num" id="4577998">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4578002">p</span><span class="op" id="4578003">.</span><span class="ident" id="4578004">out</span><span class="op" id="4578007">.</span><span class="ident" id="4578008">Column</span>&nbsp;<span class="op" id="4578015">=</span>&nbsp;<span class="num" id="4578017">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4578021">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4578029">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4578032">p</span><span class="op" id="4578033">.</span><span class="ident" id="4578034">pos</span><span class="op" id="4578037">.</span><span class="ident" id="4578038">Column</span>&nbsp;<span class="op" id="4578045">+=</span>&nbsp;<span class="ident" id="4578048">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4578051">p</span><span class="op" id="4578052">.</span><span class="ident" id="4578053">out</span><span class="op" id="4578056">.</span><span class="ident" id="4578057">Column</span>&nbsp;<span class="op" id="4578064">+=</span>&nbsp;<span class="ident" id="4578067">n</span><br>
<span class="lineno"></span><span class="op" id="4578069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4578072">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="4578145">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="4578221">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="4578278">//</span><br>
<span class="lineno"></span><span class="comment" id="4578281">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4578349">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="4578422">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4578494">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="4578570">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4578643">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="4578678">//</span><br>
<span class="lineno">265</span><span class="keyword" id="4578681">func</span>&nbsp;<span class="op" id="4578686">(</span><span class="ident" id="4578687">p</span>&nbsp;<span class="op" id="4578689">*</span><span class="ident" id="4578690">printer</span><span class="op" id="4578697">)</span>&nbsp;<span class="ident" id="4578699">writeString</span><span class="op" id="4578710">(</span><span class="ident" id="4578711">pos</span>&nbsp;<span class="ident" id="4578715">token</span><span class="op" id="4578720">.</span><span class="ident" id="4578721">Position</span><span class="op" id="4578729">,</span>&nbsp;<span class="ident" id="4578731">s</span>&nbsp;<span class="builtintype" id="4578733">string</span><span class="op" id="4578739">,</span>&nbsp;<span class="ident" id="4578741">isLit</span>&nbsp;<span class="builtintype" id="4578747">bool</span><span class="op" id="4578751">)</span>&nbsp;<span class="op" id="4578753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4578756">if</span>&nbsp;<span class="ident" id="4578759">p</span><span class="op" id="4578760">.</span><span class="ident" id="4578761">out</span><span class="op" id="4578764">.</span><span class="ident" id="4578765">Column</span>&nbsp;<span class="op" id="4578772">==</span>&nbsp;<span class="num" id="4578775">1</span>&nbsp;<span class="op" id="4578777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4578781">p</span><span class="op" id="4578782">.</span><span class="ident" id="4578783">atLineBegin</span><span class="op" id="4578794">(</span><span class="ident" id="4578795">pos</span><span class="op" id="4578798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4578801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4578805">if</span>&nbsp;<span class="ident" id="4578808">pos</span><span class="op" id="4578811">.</span><span class="ident" id="4578812">IsValid</span><span class="op" id="4578819">(</span><span class="op" id="4578820">)</span>&nbsp;<span class="op" id="4578822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4578826">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4578894">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4578957">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579022">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579049">p</span><span class="op" id="4579050">.</span><span class="ident" id="4579051">pos</span>&nbsp;<span class="op" id="4579055">=</span>&nbsp;<span class="ident" id="4579057">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579066">if</span>&nbsp;<span class="ident" id="4579069">isLit</span>&nbsp;<span class="op" id="4579075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579079">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579136">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579195">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579257">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579279">p</span><span class="op" id="4579280">.</span><span class="ident" id="4579281">output</span>&nbsp;<span class="op" id="4579288">=</span>&nbsp;<span class="builtinfunc" id="4579290">append</span><span class="op" id="4579296">(</span><span class="ident" id="4579297">p</span><span class="op" id="4579298">.</span><span class="ident" id="4579299">output</span><span class="op" id="4579305">,</span>&nbsp;<span class="ident" id="4579307">tabwriter</span><span class="op" id="4579316">.</span><span class="ident" id="4579317">Escape</span><span class="op" id="4579323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579326">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579330">if</span>&nbsp;<span class="ident" id="4579333">debug</span>&nbsp;<span class="op" id="4579339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579343">p</span><span class="op" id="4579344">.</span><span class="ident" id="4579345">output</span>&nbsp;<span class="op" id="4579352">=</span>&nbsp;<span class="builtinfunc" id="4579354">append</span><span class="op" id="4579360">(</span><span class="ident" id="4579361">p</span><span class="op" id="4579362">.</span><span class="ident" id="4579363">output</span><span class="op" id="4579369">,</span>&nbsp;<span class="ident" id="4579371">fmt</span><span class="op" id="4579374">.</span><span class="ident" id="4579375">Sprintf</span><span class="op" id="4579382">(</span><span class="string" id="4579383">&#34;/*%s*/&#34;</span><span class="op" id="4579391">,</span>&nbsp;<span class="ident" id="4579393">pos</span><span class="op" id="4579396">)</span><span class="op" id="4579397">...</span><span class="op" id="4579400">)</span>&nbsp;<span class="comment" id="4579402">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579430">p</span><span class="op" id="4579431">.</span><span class="ident" id="4579432">output</span>&nbsp;<span class="op" id="4579439">=</span>&nbsp;<span class="builtinfunc" id="4579441">append</span><span class="op" id="4579447">(</span><span class="ident" id="4579448">p</span><span class="op" id="4579449">.</span><span class="ident" id="4579450">output</span><span class="op" id="4579456">,</span>&nbsp;<span class="ident" id="4579458">s</span><span class="op" id="4579459">...</span><span class="op" id="4579462">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579466">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579487">nlines</span>&nbsp;<span class="op" id="4579494">:=</span>&nbsp;<span class="num" id="4579497">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579500">var</span>&nbsp;<span class="ident" id="4579504">li</span>&nbsp;<span class="builtintype" id="4579507">int</span>&nbsp;<span class="comment" id="4579511">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579558">for</span>&nbsp;<span class="ident" id="4579562">i</span>&nbsp;<span class="op" id="4579564">:=</span>&nbsp;<span class="num" id="4579567">0</span><span class="op" id="4579568">;</span>&nbsp;<span class="ident" id="4579570">i</span>&nbsp;<span class="op" id="4579572">&lt;</span>&nbsp;<span class="builtinfunc" id="4579574">len</span><span class="op" id="4579577">(</span><span class="ident" id="4579578">s</span><span class="op" id="4579579">)</span><span class="op" id="4579580">;</span>&nbsp;<span class="ident" id="4579582">i</span><span class="op" id="4579583">++</span>&nbsp;<span class="op" id="4579586">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4579590">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579650">if</span>&nbsp;<span class="ident" id="4579653">s</span><span class="op" id="4579654">[</span><span class="ident" id="4579655">i</span><span class="op" id="4579656">]</span>&nbsp;<span class="op" id="4579658">==</span>&nbsp;<span class="string" id="4579661">&#39;\n&#39;</span>&nbsp;<span class="op" id="4579666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579671">nlines</span><span class="op" id="4579677">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579683">li</span>&nbsp;<span class="op" id="4579686">=</span>&nbsp;<span class="ident" id="4579688">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579692">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579698">p</span><span class="op" id="4579699">.</span><span class="ident" id="4579700">pos</span><span class="op" id="4579703">.</span><span class="ident" id="4579704">Offset</span>&nbsp;<span class="op" id="4579711">+=</span>&nbsp;<span class="builtinfunc" id="4579714">len</span><span class="op" id="4579717">(</span><span class="ident" id="4579718">s</span><span class="op" id="4579719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579722">if</span>&nbsp;<span class="ident" id="4579725">nlines</span>&nbsp;<span class="op" id="4579732">&gt;</span>&nbsp;<span class="num" id="4579734">0</span>&nbsp;<span class="op" id="4579736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579740">p</span><span class="op" id="4579741">.</span><span class="ident" id="4579742">pos</span><span class="op" id="4579745">.</span><span class="ident" id="4579746">Line</span>&nbsp;<span class="op" id="4579751">+=</span>&nbsp;<span class="ident" id="4579754">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579763">p</span><span class="op" id="4579764">.</span><span class="ident" id="4579765">out</span><span class="op" id="4579768">.</span><span class="ident" id="4579769">Line</span>&nbsp;<span class="op" id="4579774">+=</span>&nbsp;<span class="ident" id="4579777">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579786">c</span>&nbsp;<span class="op" id="4579788">:=</span>&nbsp;<span class="builtinfunc" id="4579791">len</span><span class="op" id="4579794">(</span><span class="ident" id="4579795">s</span><span class="op" id="4579796">)</span>&nbsp;<span class="op" id="4579798">-</span>&nbsp;<span class="ident" id="4579800">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579805">p</span><span class="op" id="4579806">.</span><span class="ident" id="4579807">pos</span><span class="op" id="4579810">.</span><span class="ident" id="4579811">Column</span>&nbsp;<span class="op" id="4579818">=</span>&nbsp;<span class="ident" id="4579820">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579824">p</span><span class="op" id="4579825">.</span><span class="ident" id="4579826">out</span><span class="op" id="4579829">.</span><span class="ident" id="4579830">Column</span>&nbsp;<span class="op" id="4579837">=</span>&nbsp;<span class="ident" id="4579839">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579842">}</span>&nbsp;<span class="keyword" id="4579844">else</span>&nbsp;<span class="op" id="4579849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579853">p</span><span class="op" id="4579854">.</span><span class="ident" id="4579855">pos</span><span class="op" id="4579858">.</span><span class="ident" id="4579859">Column</span>&nbsp;<span class="op" id="4579866">+=</span>&nbsp;<span class="builtinfunc" id="4579869">len</span><span class="op" id="4579872">(</span><span class="ident" id="4579873">s</span><span class="op" id="4579874">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579878">p</span><span class="op" id="4579879">.</span><span class="ident" id="4579880">out</span><span class="op" id="4579883">.</span><span class="ident" id="4579884">Column</span>&nbsp;<span class="op" id="4579891">+=</span>&nbsp;<span class="builtinfunc" id="4579894">len</span><span class="op" id="4579897">(</span><span class="ident" id="4579898">s</span><span class="op" id="4579899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4579906">if</span>&nbsp;<span class="ident" id="4579909">isLit</span>&nbsp;<span class="op" id="4579915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579919">p</span><span class="op" id="4579920">.</span><span class="ident" id="4579921">output</span>&nbsp;<span class="op" id="4579928">=</span>&nbsp;<span class="builtinfunc" id="4579930">append</span><span class="op" id="4579936">(</span><span class="ident" id="4579937">p</span><span class="op" id="4579938">.</span><span class="ident" id="4579939">output</span><span class="op" id="4579945">,</span>&nbsp;<span class="ident" id="4579947">tabwriter</span><span class="op" id="4579956">.</span><span class="ident" id="4579957">Escape</span><span class="op" id="4579963">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4579966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4579970">p</span><span class="op" id="4579971">.</span><span class="ident" id="4579972">last</span>&nbsp;<span class="op" id="4579977">=</span>&nbsp;<span class="ident" id="4579979">p</span><span class="op" id="4579980">.</span><span class="ident" id="4579981">pos</span><br>
<span class="lineno"></span><span class="op" id="4579985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="4579988">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4580050">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4580112">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="4580168">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="4580230">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="4580293">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="4580353">//</span><br>
<span class="lineno"></span><span class="keyword" id="4580356">func</span>&nbsp;<span class="op" id="4580361">(</span><span class="ident" id="4580362">p</span>&nbsp;<span class="op" id="4580364">*</span><span class="ident" id="4580365">printer</span><span class="op" id="4580372">)</span>&nbsp;<span class="ident" id="4580374">writeCommentPrefix</span><span class="op" id="4580392">(</span><span class="ident" id="4580393">pos</span><span class="op" id="4580396">,</span>&nbsp;<span class="ident" id="4580398">next</span>&nbsp;<span class="ident" id="4580403">token</span><span class="op" id="4580408">.</span><span class="ident" id="4580409">Position</span><span class="op" id="4580417">,</span>&nbsp;<span class="ident" id="4580419">prev</span><span class="op" id="4580423">,</span>&nbsp;<span class="ident" id="4580425">comment</span>&nbsp;<span class="op" id="4580433">*</span><span class="ident" id="4580434">ast</span><span class="op" id="4580437">.</span><span class="ident" id="4580438">Comment</span><span class="op" id="4580445">,</span>&nbsp;<span class="ident" id="4580447">tok</span>&nbsp;<span class="ident" id="4580451">token</span><span class="op" id="4580456">.</span><span class="ident" id="4580457">Token</span><span class="op" id="4580462">)</span>&nbsp;<span class="op" id="4580464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580467">if</span>&nbsp;<span class="builtinfunc" id="4580470">len</span><span class="op" id="4580473">(</span><span class="ident" id="4580474">p</span><span class="op" id="4580475">.</span><span class="ident" id="4580476">output</span><span class="op" id="4580482">)</span>&nbsp;<span class="op" id="4580484">==</span>&nbsp;<span class="num" id="4580487">0</span>&nbsp;<span class="op" id="4580489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4580493">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580571">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4580579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580583">if</span>&nbsp;<span class="ident" id="4580586">pos</span><span class="op" id="4580589">.</span><span class="ident" id="4580590">IsValid</span><span class="op" id="4580597">(</span><span class="op" id="4580598">)</span>&nbsp;<span class="op" id="4580600">&amp;&amp;</span>&nbsp;<span class="ident" id="4580603">pos</span><span class="op" id="4580606">.</span><span class="ident" id="4580607">Filename</span>&nbsp;<span class="op" id="4580616">!=</span>&nbsp;<span class="ident" id="4580619">p</span><span class="op" id="4580620">.</span><span class="ident" id="4580621">last</span><span class="op" id="4580625">.</span><span class="ident" id="4580626">Filename</span>&nbsp;<span class="op" id="4580635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4580639">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4580697">p</span><span class="op" id="4580698">.</span><span class="ident" id="4580699">writeByte</span><span class="op" id="4580708">(</span><span class="string" id="4580709">&#39;\f&#39;</span><span class="op" id="4580713">,</span>&nbsp;<span class="ident" id="4580715">maxNewlines</span><span class="op" id="4580726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4580738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580742">if</span>&nbsp;<span class="ident" id="4580745">pos</span><span class="op" id="4580748">.</span><span class="ident" id="4580749">Line</span>&nbsp;<span class="op" id="4580754">==</span>&nbsp;<span class="ident" id="4580757">p</span><span class="op" id="4580758">.</span><span class="ident" id="4580759">last</span><span class="op" id="4580763">.</span><span class="ident" id="4580764">Line</span>&nbsp;<span class="op" id="4580769">&amp;&amp;</span>&nbsp;<span class="op" id="4580772">(</span><span class="ident" id="4580773">prev</span>&nbsp;<span class="op" id="4580778">==</span>&nbsp;<span class="ident" id="4580781">nil</span>&nbsp;<span class="op" id="4580785">||</span>&nbsp;<span class="ident" id="4580788">prev</span><span class="op" id="4580792">.</span><span class="ident" id="4580793">Text</span><span class="op" id="4580797">[</span><span class="num" id="4580798">1</span><span class="op" id="4580799">]</span>&nbsp;<span class="op" id="4580801">!=</span>&nbsp;<span class="string" id="4580804">&#39;/&#39;</span><span class="op" id="4580807">)</span>&nbsp;<span class="op" id="4580809">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4580813">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4580857">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4580899">hasSep</span>&nbsp;<span class="op" id="4580906">:=</span>&nbsp;<span class="builtintype" id="4580909">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580917">if</span>&nbsp;<span class="ident" id="4580920">prev</span>&nbsp;<span class="op" id="4580925">==</span>&nbsp;<span class="ident" id="4580928">nil</span>&nbsp;<span class="op" id="4580932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4580937">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4580976">j</span>&nbsp;<span class="op" id="4580978">:=</span>&nbsp;<span class="num" id="4580981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4580986">for</span>&nbsp;<span class="ident" id="4580990">i</span><span class="op" id="4580991">,</span>&nbsp;<span class="ident" id="4580993">ch</span>&nbsp;<span class="op" id="4580996">:=</span>&nbsp;<span class="keyword" id="4580999">range</span>&nbsp;<span class="ident" id="4581005">p</span><span class="op" id="4581006">.</span><span class="ident" id="4581007">wsbuf</span>&nbsp;<span class="op" id="4581013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581019">switch</span>&nbsp;<span class="ident" id="4581026">ch</span>&nbsp;<span class="op" id="4581029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581035">case</span>&nbsp;<span class="ident" id="4581040">blank</span><span class="op" id="4581045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581052">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581095">p</span><span class="op" id="4581096">.</span><span class="ident" id="4581097">wsbuf</span><span class="op" id="4581102">[</span><span class="ident" id="4581103">i</span><span class="op" id="4581104">]</span>&nbsp;<span class="op" id="4581106">=</span>&nbsp;<span class="ident" id="4581108">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581120">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581133">case</span>&nbsp;<span class="ident" id="4581138">vtab</span><span class="op" id="4581142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581149">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581191">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581242">hasSep</span>&nbsp;<span class="op" id="4581249">=</span>&nbsp;<span class="builtintype" id="4581251">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581261">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581274">case</span>&nbsp;<span class="ident" id="4581279">indent</span><span class="op" id="4581285">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581292">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581326">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581345">j</span>&nbsp;<span class="op" id="4581347">=</span>&nbsp;<span class="ident" id="4581349">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581355">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581369">p</span><span class="op" id="4581370">.</span><span class="ident" id="4581371">writeWhitespace</span><span class="op" id="4581386">(</span><span class="ident" id="4581387">j</span><span class="op" id="4581388">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581396">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581443">if</span>&nbsp;<span class="op" id="4581446">!</span><span class="ident" id="4581447">hasSep</span>&nbsp;<span class="op" id="4581454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581459">sep</span>&nbsp;<span class="op" id="4581463">:=</span>&nbsp;<span class="builtintype" id="4581466">byte</span><span class="op" id="4581470">(</span><span class="string" id="4581471">&#39;\t&#39;</span><span class="op" id="4581475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581480">if</span>&nbsp;<span class="ident" id="4581483">pos</span><span class="op" id="4581486">.</span><span class="ident" id="4581487">Line</span>&nbsp;<span class="op" id="4581492">==</span>&nbsp;<span class="ident" id="4581495">next</span><span class="op" id="4581499">.</span><span class="ident" id="4581500">Line</span>&nbsp;<span class="op" id="4581505">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581511">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581563">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581615">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581652">sep</span>&nbsp;<span class="op" id="4581656">=</span>&nbsp;<span class="string" id="4581658">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581665">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581670">p</span><span class="op" id="4581671">.</span><span class="ident" id="4581672">writeByte</span><span class="op" id="4581681">(</span><span class="ident" id="4581682">sep</span><span class="op" id="4581685">,</span>&nbsp;<span class="num" id="4581687">1</span><span class="op" id="4581688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581696">}</span>&nbsp;<span class="keyword" id="4581698">else</span>&nbsp;<span class="op" id="4581703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581707">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581741">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581784">droppedLinebreak</span>&nbsp;<span class="op" id="4581801">:=</span>&nbsp;<span class="builtintype" id="4581804">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581812">j</span>&nbsp;<span class="op" id="4581814">:=</span>&nbsp;<span class="num" id="4581817">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581821">for</span>&nbsp;<span class="ident" id="4581825">i</span><span class="op" id="4581826">,</span>&nbsp;<span class="ident" id="4581828">ch</span>&nbsp;<span class="op" id="4581831">:=</span>&nbsp;<span class="keyword" id="4581834">range</span>&nbsp;<span class="ident" id="4581840">p</span><span class="op" id="4581841">.</span><span class="ident" id="4581842">wsbuf</span>&nbsp;<span class="op" id="4581848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581853">switch</span>&nbsp;<span class="ident" id="4581860">ch</span>&nbsp;<span class="op" id="4581863">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581868">case</span>&nbsp;<span class="ident" id="4581873">blank</span><span class="op" id="4581878">,</span>&nbsp;<span class="ident" id="4581880">vtab</span><span class="op" id="4581884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4581890">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4581949">p</span><span class="op" id="4581950">.</span><span class="ident" id="4581951">wsbuf</span><span class="op" id="4581956">[</span><span class="ident" id="4581957">i</span><span class="op" id="4581958">]</span>&nbsp;<span class="op" id="4581960">=</span>&nbsp;<span class="ident" id="4581962">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581973">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4581985">case</span>&nbsp;<span class="ident" id="4581990">indent</span><span class="op" id="4581996">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582002">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582035">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582047">case</span>&nbsp;<span class="ident" id="4582052">unindent</span><span class="op" id="4582060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582066">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582116">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582163">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582217">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582259">if</span>&nbsp;<span class="ident" id="4582262">i</span><span class="op" id="4582263">+</span><span class="num" id="4582264">1</span>&nbsp;<span class="op" id="4582266">&lt;</span>&nbsp;<span class="builtinfunc" id="4582268">len</span><span class="op" id="4582271">(</span><span class="ident" id="4582272">p</span><span class="op" id="4582273">.</span><span class="ident" id="4582274">wsbuf</span><span class="op" id="4582279">)</span>&nbsp;<span class="op" id="4582281">&amp;&amp;</span>&nbsp;<span class="ident" id="4582284">p</span><span class="op" id="4582285">.</span><span class="ident" id="4582286">wsbuf</span><span class="op" id="4582291">[</span><span class="ident" id="4582292">i</span><span class="op" id="4582293">+</span><span class="num" id="4582294">1</span><span class="op" id="4582295">]</span>&nbsp;<span class="op" id="4582297">==</span>&nbsp;<span class="ident" id="4582300">unindent</span>&nbsp;<span class="op" id="4582309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582316">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4582329">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582335">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582399">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582457">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582514">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582572">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582627">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582685">if</span>&nbsp;<span class="ident" id="4582688">tok</span>&nbsp;<span class="op" id="4582692">!=</span>&nbsp;<span class="ident" id="4582695">token</span><span class="op" id="4582700">.</span><span class="ident" id="4582701">RBRACE</span>&nbsp;<span class="op" id="4582708">&amp;&amp;</span>&nbsp;<span class="ident" id="4582711">pos</span><span class="op" id="4582714">.</span><span class="ident" id="4582715">Column</span>&nbsp;<span class="op" id="4582722">==</span>&nbsp;<span class="ident" id="4582725">next</span><span class="op" id="4582729">.</span><span class="ident" id="4582730">Column</span>&nbsp;<span class="op" id="4582737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582744">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4582757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582762">case</span>&nbsp;<span class="ident" id="4582767">newline</span><span class="op" id="4582774">,</span>&nbsp;<span class="ident" id="4582776">formfeed</span><span class="op" id="4582784">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4582790">p</span><span class="op" id="4582791">.</span><span class="ident" id="4582792">wsbuf</span><span class="op" id="4582797">[</span><span class="ident" id="4582798">i</span><span class="op" id="4582799">]</span>&nbsp;<span class="op" id="4582801">=</span>&nbsp;<span class="ident" id="4582803">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4582814">droppedLinebreak</span>&nbsp;<span class="op" id="4582831">=</span>&nbsp;<span class="ident" id="4582833">prev</span>&nbsp;<span class="op" id="4582838">==</span>&nbsp;<span class="ident" id="4582841">nil</span>&nbsp;<span class="comment" id="4582845">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4582891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4582896">j</span>&nbsp;<span class="op" id="4582898">=</span>&nbsp;<span class="ident" id="4582900">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4582905">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4582913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4582917">p</span><span class="op" id="4582918">.</span><span class="ident" id="4582919">writeWhitespace</span><span class="op" id="4582934">(</span><span class="ident" id="4582935">j</span><span class="op" id="4582936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4582941">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4582996">n</span>&nbsp;<span class="op" id="4582998">:=</span>&nbsp;<span class="num" id="4583001">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583005">if</span>&nbsp;<span class="ident" id="4583008">pos</span><span class="op" id="4583011">.</span><span class="ident" id="4583012">IsValid</span><span class="op" id="4583019">(</span><span class="op" id="4583020">)</span>&nbsp;<span class="op" id="4583022">&amp;&amp;</span>&nbsp;<span class="ident" id="4583025">p</span><span class="op" id="4583026">.</span><span class="ident" id="4583027">last</span><span class="op" id="4583031">.</span><span class="ident" id="4583032">IsValid</span><span class="op" id="4583039">(</span><span class="op" id="4583040">)</span>&nbsp;<span class="op" id="4583042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4583047">n</span>&nbsp;<span class="op" id="4583049">=</span>&nbsp;<span class="ident" id="4583051">pos</span><span class="op" id="4583054">.</span><span class="ident" id="4583055">Line</span>&nbsp;<span class="op" id="4583060">-</span>&nbsp;<span class="ident" id="4583062">p</span><span class="op" id="4583063">.</span><span class="ident" id="4583064">last</span><span class="op" id="4583068">.</span><span class="ident" id="4583069">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583077">if</span>&nbsp;<span class="ident" id="4583080">n</span>&nbsp;<span class="op" id="4583082">&lt;</span>&nbsp;<span class="num" id="4583084">0</span>&nbsp;<span class="op" id="4583086">{</span>&nbsp;<span class="comment" id="4583088">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4583115">n</span>&nbsp;<span class="op" id="4583117">=</span>&nbsp;<span class="num" id="4583119">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583124">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583133">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583187">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583239">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583293">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583347">if</span>&nbsp;<span class="ident" id="4583350">p</span><span class="op" id="4583351">.</span><span class="ident" id="4583352">indent</span>&nbsp;<span class="op" id="4583359">==</span>&nbsp;<span class="num" id="4583362">0</span>&nbsp;<span class="op" id="4583364">&amp;&amp;</span>&nbsp;<span class="ident" id="4583367">droppedLinebreak</span>&nbsp;<span class="op" id="4583384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4583389">n</span><span class="op" id="4583390">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583400">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583448">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583496">if</span>&nbsp;<span class="ident" id="4583499">n</span>&nbsp;<span class="op" id="4583501">==</span>&nbsp;<span class="num" id="4583504">0</span>&nbsp;<span class="op" id="4583506">&amp;&amp;</span>&nbsp;<span class="ident" id="4583509">prev</span>&nbsp;<span class="op" id="4583514">!=</span>&nbsp;<span class="ident" id="4583517">nil</span>&nbsp;<span class="op" id="4583521">&amp;&amp;</span>&nbsp;<span class="ident" id="4583524">prev</span><span class="op" id="4583528">.</span><span class="ident" id="4583529">Text</span><span class="op" id="4583533">[</span><span class="num" id="4583534">1</span><span class="op" id="4583535">]</span>&nbsp;<span class="op" id="4583537">==</span>&nbsp;<span class="string" id="4583540">&#39;/&#39;</span>&nbsp;<span class="op" id="4583544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4583549">n</span>&nbsp;<span class="op" id="4583551">=</span>&nbsp;<span class="num" id="4583553">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583557">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583562">if</span>&nbsp;<span class="ident" id="4583565">n</span>&nbsp;<span class="op" id="4583567">&gt;</span>&nbsp;<span class="num" id="4583569">0</span>&nbsp;<span class="op" id="4583571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583576">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583631">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4583686">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4583730">p</span><span class="op" id="4583731">.</span><span class="ident" id="4583732">writeByte</span><span class="op" id="4583741">(</span><span class="string" id="4583742">&#39;\f&#39;</span><span class="op" id="4583746">,</span>&nbsp;<span class="ident" id="4583748">nlimit</span><span class="op" id="4583754">(</span><span class="ident" id="4583755">n</span><span class="op" id="4583756">)</span><span class="op" id="4583757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583764">}</span><br>
<span class="lineno"></span><span class="op" id="4583766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="4583769">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="4583816">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="4583879">//</span><br>
<span class="lineno"></span><span class="keyword" id="4583882">func</span>&nbsp;<span class="ident" id="4583887">isBlank</span><span class="op" id="4583894">(</span><span class="ident" id="4583895">s</span>&nbsp;<span class="builtintype" id="4583897">string</span><span class="op" id="4583903">)</span>&nbsp;<span class="builtintype" id="4583905">bool</span>&nbsp;<span class="op" id="4583910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583913">for</span>&nbsp;<span class="ident" id="4583917">i</span>&nbsp;<span class="op" id="4583919">:=</span>&nbsp;<span class="num" id="4583922">0</span><span class="op" id="4583923">;</span>&nbsp;<span class="ident" id="4583925">i</span>&nbsp;<span class="op" id="4583927">&lt;</span>&nbsp;<span class="builtinfunc" id="4583929">len</span><span class="op" id="4583932">(</span><span class="ident" id="4583933">s</span><span class="op" id="4583934">)</span><span class="op" id="4583935">;</span>&nbsp;<span class="ident" id="4583937">i</span><span class="op" id="4583938">++</span>&nbsp;<span class="op" id="4583941">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583945">if</span>&nbsp;<span class="ident" id="4583948">s</span><span class="op" id="4583949">[</span><span class="ident" id="4583950">i</span><span class="op" id="4583951">]</span>&nbsp;<span class="op" id="4583953">&gt;</span>&nbsp;<span class="string" id="4583955">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4583959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583964">return</span>&nbsp;<span class="builtintype" id="4583971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4583982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583985">return</span>&nbsp;<span class="builtintype" id="4583992">true</span><br>
<span class="lineno">460</span><span class="op" id="4583997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4584000">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4584054">func</span>&nbsp;<span class="ident" id="4584059">commonPrefix</span><span class="op" id="4584071">(</span><span class="ident" id="4584072">a</span><span class="op" id="4584073">,</span>&nbsp;<span class="ident" id="4584075">b</span>&nbsp;<span class="builtintype" id="4584077">string</span><span class="op" id="4584083">)</span>&nbsp;<span class="builtintype" id="4584085">string</span>&nbsp;<span class="op" id="4584092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584095">i</span>&nbsp;<span class="op" id="4584097">:=</span>&nbsp;<span class="num" id="4584100">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584103">for</span>&nbsp;<span class="ident" id="4584107">i</span>&nbsp;<span class="op" id="4584109">&lt;</span>&nbsp;<span class="builtinfunc" id="4584111">len</span><span class="op" id="4584114">(</span><span class="ident" id="4584115">a</span><span class="op" id="4584116">)</span>&nbsp;<span class="op" id="4584118">&amp;&amp;</span>&nbsp;<span class="ident" id="4584121">i</span>&nbsp;<span class="op" id="4584123">&lt;</span>&nbsp;<span class="builtinfunc" id="4584125">len</span><span class="op" id="4584128">(</span><span class="ident" id="4584129">b</span><span class="op" id="4584130">)</span>&nbsp;<span class="op" id="4584132">&amp;&amp;</span>&nbsp;<span class="ident" id="4584135">a</span><span class="op" id="4584136">[</span><span class="ident" id="4584137">i</span><span class="op" id="4584138">]</span>&nbsp;<span class="op" id="4584140">==</span>&nbsp;<span class="ident" id="4584143">b</span><span class="op" id="4584144">[</span><span class="ident" id="4584145">i</span><span class="op" id="4584146">]</span>&nbsp;<span class="op" id="4584148">&amp;&amp;</span>&nbsp;<span class="op" id="4584151">(</span><span class="ident" id="4584152">a</span><span class="op" id="4584153">[</span><span class="ident" id="4584154">i</span><span class="op" id="4584155">]</span>&nbsp;<span class="op" id="4584157">&lt;=</span>&nbsp;<span class="string" id="4584160">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4584164">||</span>&nbsp;<span class="ident" id="4584167">a</span><span class="op" id="4584168">[</span><span class="ident" id="4584169">i</span><span class="op" id="4584170">]</span>&nbsp;<span class="op" id="4584172">==</span>&nbsp;<span class="string" id="4584175">&#39;*&#39;</span><span class="op" id="4584178">)</span>&nbsp;<span class="op" id="4584180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584184">i</span><span class="op" id="4584185">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4584189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584192">return</span>&nbsp;<span class="ident" id="4584199">a</span><span class="op" id="4584200">[</span><span class="num" id="4584201">0</span><span class="op" id="4584202">:</span><span class="ident" id="4584203">i</span><span class="op" id="4584204">]</span><br>
<span class="lineno"></span><span class="op" id="4584206">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4584209">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4584266">func</span>&nbsp;<span class="ident" id="4584271">trimRight</span><span class="op" id="4584280">(</span><span class="ident" id="4584281">s</span>&nbsp;<span class="builtintype" id="4584283">string</span><span class="op" id="4584289">)</span>&nbsp;<span class="builtintype" id="4584291">string</span>&nbsp;<span class="op" id="4584298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584301">return</span>&nbsp;<span class="ident" id="4584308">strings</span><span class="op" id="4584315">.</span><span class="ident" id="4584316">TrimRightFunc</span><span class="op" id="4584329">(</span><span class="ident" id="4584330">s</span><span class="op" id="4584331">,</span>&nbsp;<span class="ident" id="4584333">unicode</span><span class="op" id="4584340">.</span><span class="ident" id="4584341">IsSpace</span><span class="op" id="4584348">)</span><br>
<span class="lineno"></span><span class="op" id="4584350">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4584353">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4584437">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="4584522">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4584602">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="4584682">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="4584706">//</span><br>
<span class="lineno"></span><span class="keyword" id="4584709">func</span>&nbsp;<span class="ident" id="4584714">stripCommonPrefix</span><span class="op" id="4584731">(</span><span class="ident" id="4584732">lines</span>&nbsp;<span class="op" id="4584738">[</span><span class="op" id="4584739">]</span><span class="builtintype" id="4584740">string</span><span class="op" id="4584746">)</span>&nbsp;<span class="op" id="4584748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584751">if</span>&nbsp;<span class="builtinfunc" id="4584754">len</span><span class="op" id="4584757">(</span><span class="ident" id="4584758">lines</span><span class="op" id="4584763">)</span>&nbsp;<span class="op" id="4584765">&lt;=</span>&nbsp;<span class="num" id="4584768">1</span>&nbsp;<span class="op" id="4584770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584774">return</span>&nbsp;<span class="comment" id="4584781">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4584818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4584821">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4584841">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4584898">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4584955">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585009">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585067">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585125">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585183">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585224">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585286">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585348">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585409">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585470">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585530">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585544">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585548">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585608">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4585668">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585722">var</span>&nbsp;<span class="ident" id="4585726">prefix</span>&nbsp;<span class="builtintype" id="4585733">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585741">if</span>&nbsp;<span class="builtinfunc" id="4585744">len</span><span class="op" id="4585747">(</span><span class="ident" id="4585748">lines</span><span class="op" id="4585753">)</span>&nbsp;<span class="op" id="4585755">&gt;</span>&nbsp;<span class="num" id="4585757">2</span>&nbsp;<span class="op" id="4585759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585763">first</span>&nbsp;<span class="op" id="4585769">:=</span>&nbsp;<span class="builtintype" id="4585772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585779">for</span>&nbsp;<span class="ident" id="4585783">i</span><span class="op" id="4585784">,</span>&nbsp;<span class="ident" id="4585786">line</span>&nbsp;<span class="op" id="4585791">:=</span>&nbsp;<span class="keyword" id="4585794">range</span>&nbsp;<span class="ident" id="4585800">lines</span><span class="op" id="4585805">[</span><span class="num" id="4585806">1</span>&nbsp;<span class="op" id="4585808">:</span>&nbsp;<span class="builtinfunc" id="4585810">len</span><span class="op" id="4585813">(</span><span class="ident" id="4585814">lines</span><span class="op" id="4585819">)</span><span class="op" id="4585820">-</span><span class="num" id="4585821">1</span><span class="op" id="4585822">]</span>&nbsp;<span class="op" id="4585824">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585829">switch</span>&nbsp;<span class="op" id="4585836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585841">case</span>&nbsp;<span class="ident" id="4585846">isBlank</span><span class="op" id="4585853">(</span><span class="ident" id="4585854">line</span><span class="op" id="4585858">)</span><span class="op" id="4585859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585865">lines</span><span class="op" id="4585870">[</span><span class="num" id="4585871">1</span><span class="op" id="4585872">+</span><span class="ident" id="4585873">i</span><span class="op" id="4585874">]</span>&nbsp;<span class="op" id="4585876">=</span>&nbsp;<span class="string" id="4585878">&#34;&#34;</span>&nbsp;<span class="comment" id="4585881">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585914">case</span>&nbsp;<span class="ident" id="4585919">first</span><span class="op" id="4585924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585930">prefix</span>&nbsp;<span class="op" id="4585937">=</span>&nbsp;<span class="ident" id="4585939">commonPrefix</span><span class="op" id="4585951">(</span><span class="ident" id="4585952">line</span><span class="op" id="4585956">,</span>&nbsp;<span class="ident" id="4585958">line</span><span class="op" id="4585962">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585968">first</span>&nbsp;<span class="op" id="4585974">=</span>&nbsp;<span class="builtintype" id="4585976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585985">default</span><span class="op" id="4585992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585998">prefix</span>&nbsp;<span class="op" id="4586005">=</span>&nbsp;<span class="ident" id="4586007">commonPrefix</span><span class="op" id="4586019">(</span><span class="ident" id="4586020">prefix</span><span class="op" id="4586026">,</span>&nbsp;<span class="ident" id="4586028">line</span><span class="op" id="4586032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586041">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586044">}</span>&nbsp;<span class="keyword" id="4586046">else</span>&nbsp;<span class="op" id="4586051">{</span>&nbsp;<span class="comment" id="4586053">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586117">line</span>&nbsp;<span class="op" id="4586122">:=</span>&nbsp;<span class="ident" id="4586125">lines</span><span class="op" id="4586130">[</span><span class="num" id="4586131">1</span><span class="op" id="4586132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586136">prefix</span>&nbsp;<span class="op" id="4586143">=</span>&nbsp;<span class="ident" id="4586145">commonPrefix</span><span class="op" id="4586157">(</span><span class="ident" id="4586158">line</span><span class="op" id="4586162">,</span>&nbsp;<span class="ident" id="4586164">line</span><span class="op" id="4586168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586175">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586255">lineOfStars</span>&nbsp;<span class="op" id="4586267">:=</span>&nbsp;<span class="builtintype" id="4586270">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586277">if</span>&nbsp;<span class="ident" id="4586280">i</span>&nbsp;<span class="op" id="4586282">:=</span>&nbsp;<span class="ident" id="4586285">strings</span><span class="op" id="4586292">.</span><span class="ident" id="4586293">Index</span><span class="op" id="4586298">(</span><span class="ident" id="4586299">prefix</span><span class="op" id="4586305">,</span>&nbsp;<span class="string" id="4586307">&#34;*&#34;</span><span class="op" id="4586310">)</span><span class="op" id="4586311">;</span>&nbsp;<span class="ident" id="4586313">i</span>&nbsp;<span class="op" id="4586315">&gt;=</span>&nbsp;<span class="num" id="4586318">0</span>&nbsp;<span class="op" id="4586320">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586324">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586352">if</span>&nbsp;<span class="ident" id="4586355">i</span>&nbsp;<span class="op" id="4586357">&gt;</span>&nbsp;<span class="num" id="4586359">0</span>&nbsp;<span class="op" id="4586361">&amp;&amp;</span>&nbsp;<span class="ident" id="4586364">prefix</span><span class="op" id="4586370">[</span><span class="ident" id="4586371">i</span><span class="op" id="4586372">-</span><span class="num" id="4586373">1</span><span class="op" id="4586374">]</span>&nbsp;<span class="op" id="4586376">==</span>&nbsp;<span class="string" id="4586379">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4586383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586388">i</span><span class="op" id="4586389">--</span>&nbsp;<span class="comment" id="4586392">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586459">prefix</span>&nbsp;<span class="op" id="4586466">=</span>&nbsp;<span class="ident" id="4586468">prefix</span><span class="op" id="4586474">[</span><span class="num" id="4586475">0</span><span class="op" id="4586476">:</span><span class="ident" id="4586477">i</span><span class="op" id="4586478">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586482">lineOfStars</span>&nbsp;<span class="op" id="4586494">=</span>&nbsp;<span class="builtintype" id="4586496">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586502">}</span>&nbsp;<span class="keyword" id="4586504">else</span>&nbsp;<span class="op" id="4586509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586513">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586544">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586606">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586668">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586731">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586792">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586854">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586915">first</span>&nbsp;<span class="op" id="4586921">:=</span>&nbsp;<span class="ident" id="4586924">lines</span><span class="op" id="4586929">[</span><span class="num" id="4586930">0</span><span class="op" id="4586931">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586935">if</span>&nbsp;<span class="ident" id="4586938">isBlank</span><span class="op" id="4586945">(</span><span class="ident" id="4586946">first</span><span class="op" id="4586951">[</span><span class="num" id="4586952">2</span><span class="op" id="4586953">:</span><span class="op" id="4586954">]</span><span class="op" id="4586955">)</span>&nbsp;<span class="op" id="4586957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586962">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587003">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587050">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587102">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587155">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587180">i</span>&nbsp;<span class="op" id="4587182">:=</span>&nbsp;<span class="builtinfunc" id="4587185">len</span><span class="op" id="4587188">(</span><span class="ident" id="4587189">prefix</span><span class="op" id="4587195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587200">for</span>&nbsp;<span class="ident" id="4587204">n</span>&nbsp;<span class="op" id="4587206">:=</span>&nbsp;<span class="num" id="4587209">0</span><span class="op" id="4587210">;</span>&nbsp;<span class="ident" id="4587212">n</span>&nbsp;<span class="op" id="4587214">&lt;</span>&nbsp;<span class="num" id="4587216">3</span>&nbsp;<span class="op" id="4587218">&amp;&amp;</span>&nbsp;<span class="ident" id="4587221">i</span>&nbsp;<span class="op" id="4587223">&gt;</span>&nbsp;<span class="num" id="4587225">0</span>&nbsp;<span class="op" id="4587227">&amp;&amp;</span>&nbsp;<span class="ident" id="4587230">prefix</span><span class="op" id="4587236">[</span><span class="ident" id="4587237">i</span><span class="op" id="4587238">-</span><span class="num" id="4587239">1</span><span class="op" id="4587240">]</span>&nbsp;<span class="op" id="4587242">==</span>&nbsp;<span class="string" id="4587245">&#39;&nbsp;&#39;</span><span class="op" id="4587248">;</span>&nbsp;<span class="ident" id="4587250">n</span><span class="op" id="4587251">++</span>&nbsp;<span class="op" id="4587254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587260">i</span><span class="op" id="4587261">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587267">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587272">if</span>&nbsp;<span class="ident" id="4587275">i</span>&nbsp;<span class="op" id="4587277">==</span>&nbsp;<span class="builtinfunc" id="4587280">len</span><span class="op" id="4587283">(</span><span class="ident" id="4587284">prefix</span><span class="op" id="4587290">)</span>&nbsp;<span class="op" id="4587292">&amp;&amp;</span>&nbsp;<span class="ident" id="4587295">i</span>&nbsp;<span class="op" id="4587297">&gt;</span>&nbsp;<span class="num" id="4587299">0</span>&nbsp;<span class="op" id="4587301">&amp;&amp;</span>&nbsp;<span class="ident" id="4587304">prefix</span><span class="op" id="4587310">[</span><span class="ident" id="4587311">i</span><span class="op" id="4587312">-</span><span class="num" id="4587313">1</span><span class="op" id="4587314">]</span>&nbsp;<span class="op" id="4587316">==</span>&nbsp;<span class="string" id="4587319">&#39;\t&#39;</span>&nbsp;<span class="op" id="4587324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587330">i</span><span class="op" id="4587331">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587342">prefix</span>&nbsp;<span class="op" id="4587349">=</span>&nbsp;<span class="ident" id="4587351">prefix</span><span class="op" id="4587357">[</span><span class="num" id="4587358">0</span><span class="op" id="4587359">:</span><span class="ident" id="4587360">i</span><span class="op" id="4587361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587365">}</span>&nbsp;<span class="keyword" id="4587367">else</span>&nbsp;<span class="op" id="4587372">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587377">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587414">suffix</span>&nbsp;<span class="op" id="4587421">:=</span>&nbsp;<span class="builtinfunc" id="4587424">make</span><span class="op" id="4587428">(</span><span class="op" id="4587429">[</span><span class="op" id="4587430">]</span><span class="builtintype" id="4587431">byte</span><span class="op" id="4587435">,</span>&nbsp;<span class="builtinfunc" id="4587437">len</span><span class="op" id="4587440">(</span><span class="ident" id="4587441">first</span><span class="op" id="4587446">)</span><span class="op" id="4587447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587452">n</span>&nbsp;<span class="op" id="4587454">:=</span>&nbsp;<span class="num" id="4587457">2</span>&nbsp;<span class="comment" id="4587459">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587488">for</span>&nbsp;<span class="ident" id="4587492">n</span>&nbsp;<span class="op" id="4587494">&lt;</span>&nbsp;<span class="builtinfunc" id="4587496">len</span><span class="op" id="4587499">(</span><span class="ident" id="4587500">first</span><span class="op" id="4587505">)</span>&nbsp;<span class="op" id="4587507">&amp;&amp;</span>&nbsp;<span class="ident" id="4587510">first</span><span class="op" id="4587515">[</span><span class="ident" id="4587516">n</span><span class="op" id="4587517">]</span>&nbsp;<span class="op" id="4587519">&lt;=</span>&nbsp;<span class="string" id="4587522">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4587526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587532">suffix</span><span class="op" id="4587538">[</span><span class="ident" id="4587539">n</span><span class="op" id="4587540">]</span>&nbsp;<span class="op" id="4587542">=</span>&nbsp;<span class="ident" id="4587544">first</span><span class="op" id="4587549">[</span><span class="ident" id="4587550">n</span><span class="op" id="4587551">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587557">n</span><span class="op" id="4587558">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587569">if</span>&nbsp;<span class="ident" id="4587572">n</span>&nbsp;<span class="op" id="4587574">&gt;</span>&nbsp;<span class="num" id="4587576">2</span>&nbsp;<span class="op" id="4587578">&amp;&amp;</span>&nbsp;<span class="ident" id="4587581">suffix</span><span class="op" id="4587587">[</span><span class="num" id="4587588">2</span><span class="op" id="4587589">]</span>&nbsp;<span class="op" id="4587591">==</span>&nbsp;<span class="string" id="4587594">&#39;\t&#39;</span>&nbsp;<span class="op" id="4587599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587605">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587651">suffix</span>&nbsp;<span class="op" id="4587658">=</span>&nbsp;<span class="ident" id="4587660">suffix</span><span class="op" id="4587666">[</span><span class="num" id="4587667">2</span><span class="op" id="4587668">:</span><span class="ident" id="4587669">n</span><span class="op" id="4587670">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587675">}</span>&nbsp;<span class="keyword" id="4587677">else</span>&nbsp;<span class="op" id="4587682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587688">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587723">suffix</span><span class="op" id="4587729">[</span><span class="num" id="4587730">0</span><span class="op" id="4587731">]</span><span class="op" id="4587732">,</span>&nbsp;<span class="ident" id="4587734">suffix</span><span class="op" id="4587740">[</span><span class="num" id="4587741">1</span><span class="op" id="4587742">]</span>&nbsp;<span class="op" id="4587744">=</span>&nbsp;<span class="string" id="4587746">&#39;&nbsp;&#39;</span><span class="op" id="4587749">,</span>&nbsp;<span class="string" id="4587751">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587759">suffix</span>&nbsp;<span class="op" id="4587766">=</span>&nbsp;<span class="ident" id="4587768">suffix</span><span class="op" id="4587774">[</span><span class="num" id="4587775">0</span><span class="op" id="4587776">:</span><span class="ident" id="4587777">n</span><span class="op" id="4587778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587783">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587788">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587846">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587900">prefix</span>&nbsp;<span class="op" id="4587907">=</span>&nbsp;<span class="ident" id="4587909">strings</span><span class="op" id="4587916">.</span><span class="ident" id="4587917">TrimSuffix</span><span class="op" id="4587927">(</span><span class="ident" id="4587928">prefix</span><span class="op" id="4587934">,</span>&nbsp;<span class="builtintype" id="4587936">string</span><span class="op" id="4587942">(</span><span class="ident" id="4587943">suffix</span><span class="op" id="4587949">)</span><span class="op" id="4587950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587957">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587961">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588026">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588091">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588102">last</span>&nbsp;<span class="op" id="4588107">:=</span>&nbsp;<span class="ident" id="4588110">lines</span><span class="op" id="4588115">[</span><span class="builtinfunc" id="4588116">len</span><span class="op" id="4588119">(</span><span class="ident" id="4588120">lines</span><span class="op" id="4588125">)</span><span class="op" id="4588126">-</span><span class="num" id="4588127">1</span><span class="op" id="4588128">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588131">closing</span>&nbsp;<span class="op" id="4588139">:=</span>&nbsp;<span class="string" id="4588142">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588148">i</span>&nbsp;<span class="op" id="4588150">:=</span>&nbsp;<span class="ident" id="4588153">strings</span><span class="op" id="4588160">.</span><span class="ident" id="4588161">Index</span><span class="op" id="4588166">(</span><span class="ident" id="4588167">last</span><span class="op" id="4588171">,</span>&nbsp;<span class="ident" id="4588173">closing</span><span class="op" id="4588180">)</span>&nbsp;<span class="comment" id="4588182">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588221">if</span>&nbsp;<span class="ident" id="4588224">isBlank</span><span class="op" id="4588231">(</span><span class="ident" id="4588232">last</span><span class="op" id="4588236">[</span><span class="num" id="4588237">0</span><span class="op" id="4588238">:</span><span class="ident" id="4588239">i</span><span class="op" id="4588240">]</span><span class="op" id="4588241">)</span>&nbsp;<span class="op" id="4588243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588247">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588287">if</span>&nbsp;<span class="ident" id="4588290">lineOfStars</span>&nbsp;<span class="op" id="4588302">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588307">closing</span>&nbsp;<span class="op" id="4588315">=</span>&nbsp;<span class="string" id="4588317">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="4588323">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588362">lines</span><span class="op" id="4588367">[</span><span class="builtinfunc" id="4588368">len</span><span class="op" id="4588371">(</span><span class="ident" id="4588372">lines</span><span class="op" id="4588377">)</span><span class="op" id="4588378">-</span><span class="num" id="4588379">1</span><span class="op" id="4588380">]</span>&nbsp;<span class="op" id="4588382">=</span>&nbsp;<span class="ident" id="4588384">prefix</span>&nbsp;<span class="op" id="4588391">+</span>&nbsp;<span class="ident" id="4588393">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588402">}</span>&nbsp;<span class="keyword" id="4588404">else</span>&nbsp;<span class="op" id="4588409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588413">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588464">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588516">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588543">prefix</span>&nbsp;<span class="op" id="4588550">=</span>&nbsp;<span class="ident" id="4588552">commonPrefix</span><span class="op" id="4588564">(</span><span class="ident" id="4588565">prefix</span><span class="op" id="4588571">,</span>&nbsp;<span class="ident" id="4588573">last</span><span class="op" id="4588577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588584">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588653">for</span>&nbsp;<span class="ident" id="4588657">i</span><span class="op" id="4588658">,</span>&nbsp;<span class="ident" id="4588660">line</span>&nbsp;<span class="op" id="4588665">:=</span>&nbsp;<span class="keyword" id="4588668">range</span>&nbsp;<span class="ident" id="4588674">lines</span>&nbsp;<span class="op" id="4588680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588684">if</span>&nbsp;<span class="ident" id="4588687">i</span>&nbsp;<span class="op" id="4588689">&gt;</span>&nbsp;<span class="num" id="4588691">0</span>&nbsp;<span class="op" id="4588693">&amp;&amp;</span>&nbsp;<span class="ident" id="4588696">line</span>&nbsp;<span class="op" id="4588701">!=</span>&nbsp;<span class="string" id="4588704">&#34;&#34;</span>&nbsp;<span class="op" id="4588707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588712">lines</span><span class="op" id="4588717">[</span><span class="ident" id="4588718">i</span><span class="op" id="4588719">]</span>&nbsp;<span class="op" id="4588721">=</span>&nbsp;<span class="ident" id="4588723">line</span><span class="op" id="4588727">[</span><span class="builtinfunc" id="4588728">len</span><span class="op" id="4588731">(</span><span class="ident" id="4588732">prefix</span><span class="op" id="4588738">)</span><span class="op" id="4588739">:</span><span class="op" id="4588740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588744">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588747">}</span><br>
<span class="lineno"></span><span class="op" id="4588749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4588752">func</span>&nbsp;<span class="op" id="4588757">(</span><span class="ident" id="4588758">p</span>&nbsp;<span class="op" id="4588760">*</span><span class="ident" id="4588761">printer</span><span class="op" id="4588768">)</span>&nbsp;<span class="ident" id="4588770">writeComment</span><span class="op" id="4588782">(</span><span class="ident" id="4588783">comment</span>&nbsp;<span class="op" id="4588791">*</span><span class="ident" id="4588792">ast</span><span class="op" id="4588795">.</span><span class="ident" id="4588796">Comment</span><span class="op" id="4588803">)</span>&nbsp;<span class="op" id="4588805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588808">text</span>&nbsp;<span class="op" id="4588813">:=</span>&nbsp;<span class="ident" id="4588816">comment</span><span class="op" id="4588823">.</span><span class="ident" id="4588824">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588830">pos</span>&nbsp;<span class="op" id="4588834">:=</span>&nbsp;<span class="ident" id="4588837">p</span><span class="op" id="4588838">.</span><span class="ident" id="4588839">posFor</span><span class="op" id="4588845">(</span><span class="ident" id="4588846">comment</span><span class="op" id="4588853">.</span><span class="ident" id="4588854">Pos</span><span class="op" id="4588857">(</span><span class="op" id="4588858">)</span><span class="op" id="4588859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588863">const</span>&nbsp;<span class="ident" id="4588869">linePrefix</span>&nbsp;<span class="op" id="4588880">=</span>&nbsp;<span class="string" id="4588882">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588893">if</span>&nbsp;<span class="ident" id="4588896">strings</span><span class="op" id="4588903">.</span><span class="ident" id="4588904">HasPrefix</span><span class="op" id="4588913">(</span><span class="ident" id="4588914">text</span><span class="op" id="4588918">,</span>&nbsp;<span class="ident" id="4588920">linePrefix</span><span class="op" id="4588930">)</span>&nbsp;<span class="op" id="4588932">&amp;&amp;</span>&nbsp;<span class="op" id="4588935">(</span><span class="op" id="4588936">!</span><span class="ident" id="4588937">pos</span><span class="op" id="4588940">.</span><span class="ident" id="4588941">IsValid</span><span class="op" id="4588948">(</span><span class="op" id="4588949">)</span>&nbsp;<span class="op" id="4588951">||</span>&nbsp;<span class="ident" id="4588954">pos</span><span class="op" id="4588957">.</span><span class="ident" id="4588958">Column</span>&nbsp;<span class="op" id="4588965">==</span>&nbsp;<span class="num" id="4588968">1</span><span class="op" id="4588969">)</span>&nbsp;<span class="op" id="4588971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588975">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589006">ldir</span>&nbsp;<span class="op" id="4589011">:=</span>&nbsp;<span class="ident" id="4589014">strings</span><span class="op" id="4589021">.</span><span class="ident" id="4589022">TrimSpace</span><span class="op" id="4589031">(</span><span class="ident" id="4589032">text</span><span class="op" id="4589036">[</span><span class="builtinfunc" id="4589037">len</span><span class="op" id="4589040">(</span><span class="ident" id="4589041">linePrefix</span><span class="op" id="4589051">)</span><span class="op" id="4589052">:</span><span class="op" id="4589053">]</span><span class="op" id="4589054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589058">if</span>&nbsp;<span class="ident" id="4589061">i</span>&nbsp;<span class="op" id="4589063">:=</span>&nbsp;<span class="ident" id="4589066">strings</span><span class="op" id="4589073">.</span><span class="ident" id="4589074">LastIndex</span><span class="op" id="4589083">(</span><span class="ident" id="4589084">ldir</span><span class="op" id="4589088">,</span>&nbsp;<span class="string" id="4589090">&#34;:&#34;</span><span class="op" id="4589093">)</span><span class="op" id="4589094">;</span>&nbsp;<span class="ident" id="4589096">i</span>&nbsp;<span class="op" id="4589098">&gt;=</span>&nbsp;<span class="num" id="4589101">0</span>&nbsp;<span class="op" id="4589103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589108">if</span>&nbsp;<span class="ident" id="4589111">line</span><span class="op" id="4589115">,</span>&nbsp;<span class="ident" id="4589117">err</span>&nbsp;<span class="op" id="4589121">:=</span>&nbsp;<span class="ident" id="4589124">strconv</span><span class="op" id="4589131">.</span><span class="ident" id="4589132">Atoi</span><span class="op" id="4589136">(</span><span class="ident" id="4589137">ldir</span><span class="op" id="4589141">[</span><span class="ident" id="4589142">i</span><span class="op" id="4589143">+</span><span class="num" id="4589144">1</span><span class="op" id="4589145">:</span><span class="op" id="4589146">]</span><span class="op" id="4589147">)</span><span class="op" id="4589148">;</span>&nbsp;<span class="ident" id="4589150">err</span>&nbsp;<span class="op" id="4589154">==</span>&nbsp;<span class="ident" id="4589157">nil</span>&nbsp;<span class="op" id="4589161">&amp;&amp;</span>&nbsp;<span class="ident" id="4589164">line</span>&nbsp;<span class="op" id="4589169">&gt;</span>&nbsp;<span class="num" id="4589171">0</span>&nbsp;<span class="op" id="4589173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589179">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589235">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589291">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589347">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589403">indent</span>&nbsp;<span class="op" id="4589410">:=</span>&nbsp;<span class="ident" id="4589413">p</span><span class="op" id="4589414">.</span><span class="ident" id="4589415">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589426">p</span><span class="op" id="4589427">.</span><span class="ident" id="4589428">indent</span>&nbsp;<span class="op" id="4589435">=</span>&nbsp;<span class="num" id="4589437">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589443">defer</span>&nbsp;<span class="keyword" id="4589449">func</span><span class="op" id="4589453">(</span><span class="op" id="4589454">)</span>&nbsp;<span class="op" id="4589456">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589463">p</span><span class="op" id="4589464">.</span><span class="ident" id="4589465">pos</span><span class="op" id="4589468">.</span><span class="ident" id="4589469">Filename</span>&nbsp;<span class="op" id="4589478">=</span>&nbsp;<span class="ident" id="4589480">ldir</span><span class="op" id="4589484">[</span><span class="op" id="4589485">:</span><span class="ident" id="4589486">i</span><span class="op" id="4589487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589494">p</span><span class="op" id="4589495">.</span><span class="ident" id="4589496">pos</span><span class="op" id="4589499">.</span><span class="ident" id="4589500">Line</span>&nbsp;<span class="op" id="4589505">=</span>&nbsp;<span class="ident" id="4589507">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589517">p</span><span class="op" id="4589518">.</span><span class="ident" id="4589519">pos</span><span class="op" id="4589522">.</span><span class="ident" id="4589523">Column</span>&nbsp;<span class="op" id="4589530">=</span>&nbsp;<span class="num" id="4589532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589539">p</span><span class="op" id="4589540">.</span><span class="ident" id="4589541">indent</span>&nbsp;<span class="op" id="4589548">=</span>&nbsp;<span class="ident" id="4589550">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589561">}</span><span class="op" id="4589562">(</span><span class="op" id="4589563">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589579">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589625">if</span>&nbsp;<span class="ident" id="4589628">text</span><span class="op" id="4589632">[</span><span class="num" id="4589633">1</span><span class="op" id="4589634">]</span>&nbsp;<span class="op" id="4589636">==</span>&nbsp;<span class="string" id="4589639">&#39;/&#39;</span>&nbsp;<span class="op" id="4589643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589647">p</span><span class="op" id="4589648">.</span><span class="ident" id="4589649">writeString</span><span class="op" id="4589660">(</span><span class="ident" id="4589661">pos</span><span class="op" id="4589664">,</span>&nbsp;<span class="ident" id="4589666">trimRight</span><span class="op" id="4589675">(</span><span class="ident" id="4589676">text</span><span class="op" id="4589680">)</span><span class="op" id="4589681">,</span>&nbsp;<span class="builtintype" id="4589683">true</span><span class="op" id="4589687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589691">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589703">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589761">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589816">lines</span>&nbsp;<span class="op" id="4589822">:=</span>&nbsp;<span class="ident" id="4589825">strings</span><span class="op" id="4589832">.</span><span class="ident" id="4589833">Split</span><span class="op" id="4589838">(</span><span class="ident" id="4589839">text</span><span class="op" id="4589843">,</span>&nbsp;<span class="string" id="4589845">&#34;\n&#34;</span><span class="op" id="4589849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589853">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589910">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589972">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590033">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590096">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590156">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590186">if</span>&nbsp;<span class="ident" id="4590189">pos</span><span class="op" id="4590192">.</span><span class="ident" id="4590193">IsValid</span><span class="op" id="4590200">(</span><span class="op" id="4590201">)</span>&nbsp;<span class="op" id="4590203">&amp;&amp;</span>&nbsp;<span class="ident" id="4590206">pos</span><span class="op" id="4590209">.</span><span class="ident" id="4590210">Column</span>&nbsp;<span class="op" id="4590217">==</span>&nbsp;<span class="num" id="4590220">1</span>&nbsp;<span class="op" id="4590222">&amp;&amp;</span>&nbsp;<span class="ident" id="4590225">p</span><span class="op" id="4590226">.</span><span class="ident" id="4590227">indent</span>&nbsp;<span class="op" id="4590234">&gt;</span>&nbsp;<span class="num" id="4590236">0</span>&nbsp;<span class="op" id="4590238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590242">for</span>&nbsp;<span class="ident" id="4590246">i</span><span class="op" id="4590247">,</span>&nbsp;<span class="ident" id="4590249">line</span>&nbsp;<span class="op" id="4590254">:=</span>&nbsp;<span class="keyword" id="4590257">range</span>&nbsp;<span class="ident" id="4590263">lines</span><span class="op" id="4590268">[</span><span class="num" id="4590269">1</span><span class="op" id="4590270">:</span><span class="op" id="4590271">]</span>&nbsp;<span class="op" id="4590273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590278">lines</span><span class="op" id="4590283">[</span><span class="num" id="4590284">1</span><span class="op" id="4590285">+</span><span class="ident" id="4590286">i</span><span class="op" id="4590287">]</span>&nbsp;<span class="op" id="4590289">=</span>&nbsp;<span class="string" id="4590291">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="4590297">+</span>&nbsp;<span class="ident" id="4590299">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590309">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590313">stripCommonPrefix</span><span class="op" id="4590330">(</span><span class="ident" id="4590331">lines</span><span class="op" id="4590336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590340">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590388">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590433">for</span>&nbsp;<span class="ident" id="4590437">i</span><span class="op" id="4590438">,</span>&nbsp;<span class="ident" id="4590440">line</span>&nbsp;<span class="op" id="4590445">:=</span>&nbsp;<span class="keyword" id="4590448">range</span>&nbsp;<span class="ident" id="4590454">lines</span>&nbsp;<span class="op" id="4590460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590464">if</span>&nbsp;<span class="ident" id="4590467">i</span>&nbsp;<span class="op" id="4590469">&gt;</span>&nbsp;<span class="num" id="4590471">0</span>&nbsp;<span class="op" id="4590473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590478">p</span><span class="op" id="4590479">.</span><span class="ident" id="4590480">writeByte</span><span class="op" id="4590489">(</span><span class="string" id="4590490">&#39;\f&#39;</span><span class="op" id="4590494">,</span>&nbsp;<span class="num" id="4590496">1</span><span class="op" id="4590497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590502">pos</span>&nbsp;<span class="op" id="4590506">=</span>&nbsp;<span class="ident" id="4590508">p</span><span class="op" id="4590509">.</span><span class="ident" id="4590510">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590516">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590520">if</span>&nbsp;<span class="builtinfunc" id="4590523">len</span><span class="op" id="4590526">(</span><span class="ident" id="4590527">line</span><span class="op" id="4590531">)</span>&nbsp;<span class="op" id="4590533">&gt;</span>&nbsp;<span class="num" id="4590535">0</span>&nbsp;<span class="op" id="4590537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590542">p</span><span class="op" id="4590543">.</span><span class="ident" id="4590544">writeString</span><span class="op" id="4590555">(</span><span class="ident" id="4590556">pos</span><span class="op" id="4590559">,</span>&nbsp;<span class="ident" id="4590561">trimRight</span><span class="op" id="4590570">(</span><span class="ident" id="4590571">line</span><span class="op" id="4590575">)</span><span class="op" id="4590576">,</span>&nbsp;<span class="builtintype" id="4590578">true</span><span class="op" id="4590582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590589">}</span><br>
<span class="lineno"></span><span class="op" id="4590591">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4590594">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="4590665">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="4590736">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4590805">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="4590873">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4590945">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4590956">//</span><br>
<span class="lineno"></span><span class="keyword" id="4590959">func</span>&nbsp;<span class="op" id="4590964">(</span><span class="ident" id="4590965">p</span>&nbsp;<span class="op" id="4590967">*</span><span class="ident" id="4590968">printer</span><span class="op" id="4590975">)</span>&nbsp;<span class="ident" id="4590977">writeCommentSuffix</span><span class="op" id="4590995">(</span><span class="ident" id="4590996">needsLinebreak</span>&nbsp;<span class="builtintype" id="4591011">bool</span><span class="op" id="4591015">)</span>&nbsp;<span class="op" id="4591017">(</span><span class="ident" id="4591018">wroteNewline</span><span class="op" id="4591030">,</span>&nbsp;<span class="ident" id="4591032">droppedFF</span>&nbsp;<span class="builtintype" id="4591042">bool</span><span class="op" id="4591046">)</span>&nbsp;<span class="op" id="4591048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591051">for</span>&nbsp;<span class="ident" id="4591055">i</span><span class="op" id="4591056">,</span>&nbsp;<span class="ident" id="4591058">ch</span>&nbsp;<span class="op" id="4591061">:=</span>&nbsp;<span class="keyword" id="4591064">range</span>&nbsp;<span class="ident" id="4591070">p</span><span class="op" id="4591071">.</span><span class="ident" id="4591072">wsbuf</span>&nbsp;<span class="op" id="4591078">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591082">switch</span>&nbsp;<span class="ident" id="4591089">ch</span>&nbsp;<span class="op" id="4591092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591096">case</span>&nbsp;<span class="ident" id="4591101">blank</span><span class="op" id="4591106">,</span>&nbsp;<span class="ident" id="4591108">vtab</span><span class="op" id="4591112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591117">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591150">p</span><span class="op" id="4591151">.</span><span class="ident" id="4591152">wsbuf</span><span class="op" id="4591157">[</span><span class="ident" id="4591158">i</span><span class="op" id="4591159">]</span>&nbsp;<span class="op" id="4591161">=</span>&nbsp;<span class="ident" id="4591163">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591172">case</span>&nbsp;<span class="ident" id="4591177">indent</span><span class="op" id="4591183">,</span>&nbsp;<span class="ident" id="4591185">unindent</span><span class="op" id="4591193">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591198">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591238">case</span>&nbsp;<span class="ident" id="4591243">newline</span><span class="op" id="4591250">,</span>&nbsp;<span class="ident" id="4591252">formfeed</span><span class="op" id="4591260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591265">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591313">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591360">if</span>&nbsp;<span class="ident" id="4591363">needsLinebreak</span>&nbsp;<span class="op" id="4591378">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591384">needsLinebreak</span>&nbsp;<span class="op" id="4591399">=</span>&nbsp;<span class="builtintype" id="4591401">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591411">wroteNewline</span>&nbsp;<span class="op" id="4591424">=</span>&nbsp;<span class="builtintype" id="4591426">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591434">}</span>&nbsp;<span class="keyword" id="4591436">else</span>&nbsp;<span class="op" id="4591441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591447">if</span>&nbsp;<span class="ident" id="4591450">ch</span>&nbsp;<span class="op" id="4591453">==</span>&nbsp;<span class="ident" id="4591456">formfeed</span>&nbsp;<span class="op" id="4591465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591472">droppedFF</span>&nbsp;<span class="op" id="4591482">=</span>&nbsp;<span class="builtintype" id="4591484">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591499">p</span><span class="op" id="4591500">.</span><span class="ident" id="4591501">wsbuf</span><span class="op" id="4591506">[</span><span class="ident" id="4591507">i</span><span class="op" id="4591508">]</span>&nbsp;<span class="op" id="4591510">=</span>&nbsp;<span class="ident" id="4591512">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591529">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591532">p</span><span class="op" id="4591533">.</span><span class="ident" id="4591534">writeWhitespace</span><span class="op" id="4591549">(</span><span class="builtinfunc" id="4591550">len</span><span class="op" id="4591553">(</span><span class="ident" id="4591554">p</span><span class="op" id="4591555">.</span><span class="ident" id="4591556">wsbuf</span><span class="op" id="4591561">)</span><span class="op" id="4591562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591566">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591601">if</span>&nbsp;<span class="ident" id="4591604">needsLinebreak</span>&nbsp;<span class="op" id="4591619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591623">p</span><span class="op" id="4591624">.</span><span class="ident" id="4591625">writeByte</span><span class="op" id="4591634">(</span><span class="string" id="4591635">&#39;\n&#39;</span><span class="op" id="4591639">,</span>&nbsp;<span class="num" id="4591641">1</span><span class="op" id="4591642">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591646">wroteNewline</span>&nbsp;<span class="op" id="4591659">=</span>&nbsp;<span class="builtintype" id="4591661">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591671">return</span><br>
<span class="lineno"></span><span class="op" id="4591678">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="4591681">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="4591760">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4591841">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="4591920">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="4591998">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4592078">//</span><br>
<span class="lineno"></span><span class="keyword" id="4592081">func</span>&nbsp;<span class="op" id="4592086">(</span><span class="ident" id="4592087">p</span>&nbsp;<span class="op" id="4592089">*</span><span class="ident" id="4592090">printer</span><span class="op" id="4592097">)</span>&nbsp;<span class="ident" id="4592099">intersperseComments</span><span class="op" id="4592118">(</span><span class="ident" id="4592119">next</span>&nbsp;<span class="ident" id="4592124">token</span><span class="op" id="4592129">.</span><span class="ident" id="4592130">Position</span><span class="op" id="4592138">,</span>&nbsp;<span class="ident" id="4592140">tok</span>&nbsp;<span class="ident" id="4592144">token</span><span class="op" id="4592149">.</span><span class="ident" id="4592150">Token</span><span class="op" id="4592155">)</span>&nbsp;<span class="op" id="4592157">(</span><span class="ident" id="4592158">wroteNewline</span><span class="op" id="4592170">,</span>&nbsp;<span class="ident" id="4592172">droppedFF</span>&nbsp;<span class="builtintype" id="4592182">bool</span><span class="op" id="4592186">)</span>&nbsp;<span class="op" id="4592188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592191">var</span>&nbsp;<span class="ident" id="4592195">last</span>&nbsp;<span class="op" id="4592200">*</span><span class="ident" id="4592201">ast</span><span class="op" id="4592204">.</span><span class="ident" id="4592205">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592214">for</span>&nbsp;<span class="ident" id="4592218">p</span><span class="op" id="4592219">.</span><span class="ident" id="4592220">commentBefore</span><span class="op" id="4592233">(</span><span class="ident" id="4592234">next</span><span class="op" id="4592238">)</span>&nbsp;<span class="op" id="4592240">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592244">for</span>&nbsp;<span class="ident" id="4592248">_</span><span class="op" id="4592249">,</span>&nbsp;<span class="ident" id="4592251">c</span>&nbsp;<span class="op" id="4592253">:=</span>&nbsp;<span class="keyword" id="4592256">range</span>&nbsp;<span class="ident" id="4592262">p</span><span class="op" id="4592263">.</span><span class="ident" id="4592264">comment</span><span class="op" id="4592271">.</span><span class="ident" id="4592272">List</span>&nbsp;<span class="op" id="4592277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592282">p</span><span class="op" id="4592283">.</span><span class="ident" id="4592284">writeCommentPrefix</span><span class="op" id="4592302">(</span><span class="ident" id="4592303">p</span><span class="op" id="4592304">.</span><span class="ident" id="4592305">posFor</span><span class="op" id="4592311">(</span><span class="ident" id="4592312">c</span><span class="op" id="4592313">.</span><span class="ident" id="4592314">Pos</span><span class="op" id="4592317">(</span><span class="op" id="4592318">)</span><span class="op" id="4592319">)</span><span class="op" id="4592320">,</span>&nbsp;<span class="ident" id="4592322">next</span><span class="op" id="4592326">,</span>&nbsp;<span class="ident" id="4592328">last</span><span class="op" id="4592332">,</span>&nbsp;<span class="ident" id="4592334">c</span><span class="op" id="4592335">,</span>&nbsp;<span class="ident" id="4592337">tok</span><span class="op" id="4592340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592345">p</span><span class="op" id="4592346">.</span><span class="ident" id="4592347">writeComment</span><span class="op" id="4592359">(</span><span class="ident" id="4592360">c</span><span class="op" id="4592361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592366">last</span>&nbsp;<span class="op" id="4592371">=</span>&nbsp;<span class="ident" id="4592373">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592377">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592381">p</span><span class="op" id="4592382">.</span><span class="ident" id="4592383">nextComment</span><span class="op" id="4592394">(</span><span class="op" id="4592395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592402">if</span>&nbsp;<span class="ident" id="4592405">last</span>&nbsp;<span class="op" id="4592410">!=</span>&nbsp;<span class="ident" id="4592413">nil</span>&nbsp;<span class="op" id="4592417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592421">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592486">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592556">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592624">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592690">if</span>&nbsp;<span class="ident" id="4592693">p</span><span class="op" id="4592694">.</span><span class="ident" id="4592695">mode</span><span class="op" id="4592699">&amp;</span><span class="ident" id="4592700">noExtraBlank</span>&nbsp;<span class="op" id="4592713">==</span>&nbsp;<span class="num" id="4592716">0</span>&nbsp;<span class="op" id="4592718">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592724">last</span><span class="op" id="4592728">.</span><span class="ident" id="4592729">Text</span><span class="op" id="4592733">[</span><span class="num" id="4592734">1</span><span class="op" id="4592735">]</span>&nbsp;<span class="op" id="4592737">==</span>&nbsp;<span class="string" id="4592740">&#39;*&#39;</span>&nbsp;<span class="op" id="4592744">&amp;&amp;</span>&nbsp;<span class="ident" id="4592747">p</span><span class="op" id="4592748">.</span><span class="ident" id="4592749">lineFor</span><span class="op" id="4592756">(</span><span class="ident" id="4592757">last</span><span class="op" id="4592761">.</span><span class="ident" id="4592762">Pos</span><span class="op" id="4592765">(</span><span class="op" id="4592766">)</span><span class="op" id="4592767">)</span>&nbsp;<span class="op" id="4592769">==</span>&nbsp;<span class="ident" id="4592772">next</span><span class="op" id="4592776">.</span><span class="ident" id="4592777">Line</span>&nbsp;<span class="op" id="4592782">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592788">tok</span>&nbsp;<span class="op" id="4592792">!=</span>&nbsp;<span class="ident" id="4592795">token</span><span class="op" id="4592800">.</span><span class="ident" id="4592801">COMMA</span>&nbsp;<span class="op" id="4592807">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592813">(</span><span class="ident" id="4592814">tok</span>&nbsp;<span class="op" id="4592818">!=</span>&nbsp;<span class="ident" id="4592821">token</span><span class="op" id="4592826">.</span><span class="ident" id="4592827">RPAREN</span>&nbsp;<span class="op" id="4592834">||</span>&nbsp;<span class="ident" id="4592837">p</span><span class="op" id="4592838">.</span><span class="ident" id="4592839">prevOpen</span>&nbsp;<span class="op" id="4592848">==</span>&nbsp;<span class="ident" id="4592851">token</span><span class="op" id="4592856">.</span><span class="ident" id="4592857">LPAREN</span><span class="op" id="4592863">)</span>&nbsp;<span class="op" id="4592865">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592871">(</span><span class="ident" id="4592872">tok</span>&nbsp;<span class="op" id="4592876">!=</span>&nbsp;<span class="ident" id="4592879">token</span><span class="op" id="4592884">.</span><span class="ident" id="4592885">RBRACK</span>&nbsp;<span class="op" id="4592892">||</span>&nbsp;<span class="ident" id="4592895">p</span><span class="op" id="4592896">.</span><span class="ident" id="4592897">prevOpen</span>&nbsp;<span class="op" id="4592906">==</span>&nbsp;<span class="ident" id="4592909">token</span><span class="op" id="4592914">.</span><span class="ident" id="4592915">LBRACK</span><span class="op" id="4592921">)</span>&nbsp;<span class="op" id="4592923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592928">p</span><span class="op" id="4592929">.</span><span class="ident" id="4592930">writeByte</span><span class="op" id="4592939">(</span><span class="string" id="4592940">&#39;&nbsp;&#39;</span><span class="op" id="4592943">,</span>&nbsp;<span class="num" id="4592945">1</span><span class="op" id="4592946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592950">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592954">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593019">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593083">needsLinebreak</span>&nbsp;<span class="op" id="4593098">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593104">last</span><span class="op" id="4593108">.</span><span class="ident" id="4593109">Text</span><span class="op" id="4593113">[</span><span class="num" id="4593114">1</span><span class="op" id="4593115">]</span>&nbsp;<span class="op" id="4593117">==</span>&nbsp;<span class="string" id="4593120">&#39;/&#39;</span>&nbsp;<span class="op" id="4593124">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593131">tok</span>&nbsp;<span class="op" id="4593135">==</span>&nbsp;<span class="ident" id="4593138">token</span><span class="op" id="4593143">.</span><span class="ident" id="4593144">RBRACE</span>&nbsp;<span class="op" id="4593151">&amp;&amp;</span>&nbsp;<span class="ident" id="4593154">p</span><span class="op" id="4593155">.</span><span class="ident" id="4593156">mode</span><span class="op" id="4593160">&amp;</span><span class="ident" id="4593161">noExtraLinebreak</span>&nbsp;<span class="op" id="4593178">==</span>&nbsp;<span class="num" id="4593181">0</span>&nbsp;<span class="op" id="4593183">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593190">tok</span>&nbsp;<span class="op" id="4593194">==</span>&nbsp;<span class="ident" id="4593197">token</span><span class="op" id="4593202">.</span><span class="ident" id="4593203">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593209">return</span>&nbsp;<span class="ident" id="4593216">p</span><span class="op" id="4593217">.</span><span class="ident" id="4593218">writeCommentSuffix</span><span class="op" id="4593236">(</span><span class="ident" id="4593237">needsLinebreak</span><span class="op" id="4593251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4593254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593258">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593320">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593378">p</span><span class="op" id="4593379">.</span><span class="ident" id="4593380">internalError</span><span class="op" id="4593393">(</span><span class="string" id="4593394">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="4593447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593450">return</span><br>
<span class="lineno"></span><span class="op" id="4593457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4593460">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="4593518">func</span>&nbsp;<span class="op" id="4593523">(</span><span class="ident" id="4593524">p</span>&nbsp;<span class="op" id="4593526">*</span><span class="ident" id="4593527">printer</span><span class="op" id="4593534">)</span>&nbsp;<span class="ident" id="4593536">writeWhitespace</span><span class="op" id="4593551">(</span><span class="ident" id="4593552">n</span>&nbsp;<span class="builtintype" id="4593554">int</span><span class="op" id="4593557">)</span>&nbsp;<span class="op" id="4593559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593562">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593580">for</span>&nbsp;<span class="ident" id="4593584">i</span>&nbsp;<span class="op" id="4593586">:=</span>&nbsp;<span class="num" id="4593589">0</span><span class="op" id="4593590">;</span>&nbsp;<span class="ident" id="4593592">i</span>&nbsp;<span class="op" id="4593594">&lt;</span>&nbsp;<span class="ident" id="4593596">n</span><span class="op" id="4593597">;</span>&nbsp;<span class="ident" id="4593599">i</span><span class="op" id="4593600">++</span>&nbsp;<span class="op" id="4593603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593607">switch</span>&nbsp;<span class="ident" id="4593614">ch</span>&nbsp;<span class="op" id="4593617">:=</span>&nbsp;<span class="ident" id="4593620">p</span><span class="op" id="4593621">.</span><span class="ident" id="4593622">wsbuf</span><span class="op" id="4593627">[</span><span class="ident" id="4593628">i</span><span class="op" id="4593629">]</span><span class="op" id="4593630">;</span>&nbsp;<span class="ident" id="4593632">ch</span>&nbsp;<span class="op" id="4593635">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593639">case</span>&nbsp;<span class="ident" id="4593644">ignore</span><span class="op" id="4593650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593655">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593668">case</span>&nbsp;<span class="ident" id="4593673">indent</span><span class="op" id="4593679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593684">p</span><span class="op" id="4593685">.</span><span class="ident" id="4593686">indent</span><span class="op" id="4593692">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593697">case</span>&nbsp;<span class="ident" id="4593702">unindent</span><span class="op" id="4593710">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593715">p</span><span class="op" id="4593716">.</span><span class="ident" id="4593717">indent</span><span class="op" id="4593723">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593729">if</span>&nbsp;<span class="ident" id="4593732">p</span><span class="op" id="4593733">.</span><span class="ident" id="4593734">indent</span>&nbsp;<span class="op" id="4593741">&lt;</span>&nbsp;<span class="num" id="4593743">0</span>&nbsp;<span class="op" id="4593745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593751">p</span><span class="op" id="4593752">.</span><span class="ident" id="4593753">internalError</span><span class="op" id="4593766">(</span><span class="string" id="4593767">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="4593790">,</span>&nbsp;<span class="ident" id="4593792">p</span><span class="op" id="4593793">.</span><span class="ident" id="4593794">indent</span><span class="op" id="4593800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593806">p</span><span class="op" id="4593807">.</span><span class="ident" id="4593808">indent</span>&nbsp;<span class="op" id="4593815">=</span>&nbsp;<span class="num" id="4593817">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4593822">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4593826">case</span>&nbsp;<span class="ident" id="4593831">newline</span><span class="op" id="4593838">,</span>&nbsp;<span class="ident" id="4593840">formfeed</span><span class="op" id="4593848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593853">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593911">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593970">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594026">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594082">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594142">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594187">if</span>&nbsp;<span class="ident" id="4594190">i</span><span class="op" id="4594191">+</span><span class="num" id="4594192">1</span>&nbsp;<span class="op" id="4594194">&lt;</span>&nbsp;<span class="ident" id="4594196">n</span>&nbsp;<span class="op" id="4594198">&amp;&amp;</span>&nbsp;<span class="ident" id="4594201">p</span><span class="op" id="4594202">.</span><span class="ident" id="4594203">wsbuf</span><span class="op" id="4594208">[</span><span class="ident" id="4594209">i</span><span class="op" id="4594210">+</span><span class="num" id="4594211">1</span><span class="op" id="4594212">]</span>&nbsp;<span class="op" id="4594214">==</span>&nbsp;<span class="ident" id="4594217">unindent</span>&nbsp;<span class="op" id="4594226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594232">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594288">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594349">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594409">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594472">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594492">p</span><span class="op" id="4594493">.</span><span class="ident" id="4594494">wsbuf</span><span class="op" id="4594499">[</span><span class="ident" id="4594500">i</span><span class="op" id="4594501">]</span><span class="op" id="4594502">,</span>&nbsp;<span class="ident" id="4594504">p</span><span class="op" id="4594505">.</span><span class="ident" id="4594506">wsbuf</span><span class="op" id="4594511">[</span><span class="ident" id="4594512">i</span><span class="op" id="4594513">+</span><span class="num" id="4594514">1</span><span class="op" id="4594515">]</span>&nbsp;<span class="op" id="4594517">=</span>&nbsp;<span class="ident" id="4594519">unindent</span><span class="op" id="4594527">,</span>&nbsp;<span class="ident" id="4594529">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594542">i</span><span class="op" id="4594543">--</span>&nbsp;<span class="comment" id="4594546">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594565">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4594577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594582">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594596">default</span><span class="op" id="4594603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594608">p</span><span class="op" id="4594609">.</span><span class="ident" id="4594610">writeByte</span><span class="op" id="4594619">(</span><span class="builtintype" id="4594620">byte</span><span class="op" id="4594624">(</span><span class="ident" id="4594625">ch</span><span class="op" id="4594627">)</span><span class="op" id="4594628">,</span>&nbsp;<span class="num" id="4594630">1</span><span class="op" id="4594631">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4594635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4594638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594642">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594675">l</span>&nbsp;<span class="op" id="4594677">:=</span>&nbsp;<span class="builtinfunc" id="4594680">copy</span><span class="op" id="4594684">(</span><span class="ident" id="4594685">p</span><span class="op" id="4594686">.</span><span class="ident" id="4594687">wsbuf</span><span class="op" id="4594692">,</span>&nbsp;<span class="ident" id="4594694">p</span><span class="op" id="4594695">.</span><span class="ident" id="4594696">wsbuf</span><span class="op" id="4594701">[</span><span class="ident" id="4594702">n</span><span class="op" id="4594703">:</span><span class="op" id="4594704">]</span><span class="op" id="4594705">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594708">p</span><span class="op" id="4594709">.</span><span class="ident" id="4594710">wsbuf</span>&nbsp;<span class="op" id="4594716">=</span>&nbsp;<span class="ident" id="4594718">p</span><span class="op" id="4594719">.</span><span class="ident" id="4594720">wsbuf</span><span class="op" id="4594725">[</span><span class="op" id="4594726">:</span><span class="ident" id="4594727">l</span><span class="op" id="4594728">]</span><br>
<span class="lineno"></span><span class="op" id="4594730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4594733">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4594813">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4594836">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="4594871">func</span>&nbsp;<span class="ident" id="4594876">nlimit</span><span class="op" id="4594882">(</span><span class="ident" id="4594883">n</span>&nbsp;<span class="builtintype" id="4594885">int</span><span class="op" id="4594888">)</span>&nbsp;<span class="builtintype" id="4594890">int</span>&nbsp;<span class="op" id="4594894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594897">if</span>&nbsp;<span class="ident" id="4594900">n</span>&nbsp;<span class="op" id="4594902">&gt;</span>&nbsp;<span class="ident" id="4594904">maxNewlines</span>&nbsp;<span class="op" id="4594916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4594920">n</span>&nbsp;<span class="op" id="4594922">=</span>&nbsp;<span class="ident" id="4594924">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4594937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4594940">return</span>&nbsp;<span class="ident" id="4594947">n</span><br>
<span class="lineno"></span><span class="op" id="4594949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4594952">func</span>&nbsp;<span class="ident" id="4594957">mayCombine</span><span class="op" id="4594967">(</span><span class="ident" id="4594968">prev</span>&nbsp;<span class="ident" id="4594973">token</span><span class="op" id="4594978">.</span><span class="ident" id="4594979">Token</span><span class="op" id="4594984">,</span>&nbsp;<span class="ident" id="4594986">next</span>&nbsp;<span class="builtintype" id="4594991">byte</span><span class="op" id="4594995">)</span>&nbsp;<span class="op" id="4594997">(</span><span class="ident" id="4594998">b</span>&nbsp;<span class="builtintype" id="4595000">bool</span><span class="op" id="4595004">)</span>&nbsp;<span class="op" id="4595006">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595009">switch</span>&nbsp;<span class="ident" id="4595016">prev</span>&nbsp;<span class="op" id="4595021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595024">case</span>&nbsp;<span class="ident" id="4595029">token</span><span class="op" id="4595034">.</span><span class="ident" id="4595035">INT</span><span class="op" id="4595038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595042">b</span>&nbsp;<span class="op" id="4595044">=</span>&nbsp;<span class="ident" id="4595046">next</span>&nbsp;<span class="op" id="4595051">==</span>&nbsp;<span class="string" id="4595054">&#39;.&#39;</span>&nbsp;<span class="comment" id="4595058">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595065">case</span>&nbsp;<span class="ident" id="4595070">token</span><span class="op" id="4595075">.</span><span class="ident" id="4595076">ADD</span><span class="op" id="4595079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595083">b</span>&nbsp;<span class="op" id="4595085">=</span>&nbsp;<span class="ident" id="4595087">next</span>&nbsp;<span class="op" id="4595092">==</span>&nbsp;<span class="string" id="4595095">&#39;+&#39;</span>&nbsp;<span class="comment" id="4595099">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595106">case</span>&nbsp;<span class="ident" id="4595111">token</span><span class="op" id="4595116">.</span><span class="ident" id="4595117">SUB</span><span class="op" id="4595120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595124">b</span>&nbsp;<span class="op" id="4595126">=</span>&nbsp;<span class="ident" id="4595128">next</span>&nbsp;<span class="op" id="4595133">==</span>&nbsp;<span class="string" id="4595136">&#39;-&#39;</span>&nbsp;<span class="comment" id="4595140">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595147">case</span>&nbsp;<span class="ident" id="4595152">token</span><span class="op" id="4595157">.</span><span class="ident" id="4595158">QUO</span><span class="op" id="4595161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595165">b</span>&nbsp;<span class="op" id="4595167">=</span>&nbsp;<span class="ident" id="4595169">next</span>&nbsp;<span class="op" id="4595174">==</span>&nbsp;<span class="string" id="4595177">&#39;*&#39;</span>&nbsp;<span class="comment" id="4595181">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595188">case</span>&nbsp;<span class="ident" id="4595193">token</span><span class="op" id="4595198">.</span><span class="ident" id="4595199">LSS</span><span class="op" id="4595202">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595206">b</span>&nbsp;<span class="op" id="4595208">=</span>&nbsp;<span class="ident" id="4595210">next</span>&nbsp;<span class="op" id="4595215">==</span>&nbsp;<span class="string" id="4595218">&#39;-&#39;</span>&nbsp;<span class="op" id="4595222">||</span>&nbsp;<span class="ident" id="4595225">next</span>&nbsp;<span class="op" id="4595230">==</span>&nbsp;<span class="string" id="4595233">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="4595237">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595250">case</span>&nbsp;<span class="ident" id="4595255">token</span><span class="op" id="4595260">.</span><span class="ident" id="4595261">AND</span><span class="op" id="4595264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4595268">b</span>&nbsp;<span class="op" id="4595270">=</span>&nbsp;<span class="ident" id="4595272">next</span>&nbsp;<span class="op" id="4595277">==</span>&nbsp;<span class="string" id="4595280">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4595284">||</span>&nbsp;<span class="ident" id="4595287">next</span>&nbsp;<span class="op" id="4595292">==</span>&nbsp;<span class="string" id="4595295">&#39;^&#39;</span>&nbsp;<span class="comment" id="4595299">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4595312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595315">return</span><br>
<span class="lineno">825</span><span class="op" id="4595322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4595325">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="4595395">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="4595465">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="4595534">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="4595584">//</span><br>
<span class="lineno"></span><span class="comment" id="4595587">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4595658">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="4595727">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="4595797">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4595867">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="4595909">//</span><br>
<span class="lineno"></span><span class="keyword" id="4595912">func</span>&nbsp;<span class="op" id="4595917">(</span><span class="ident" id="4595918">p</span>&nbsp;<span class="op" id="4595920">*</span><span class="ident" id="4595921">printer</span><span class="op" id="4595928">)</span>&nbsp;<span class="builtinfunc" id="4595930">print</span><span class="op" id="4595935">(</span><span class="ident" id="4595936">args</span>&nbsp;<span class="op" id="4595941">...</span><span class="keyword" id="4595944">interface</span><span class="op" id="4595953">{</span><span class="op" id="4595954">}</span><span class="op" id="4595955">)</span>&nbsp;<span class="op" id="4595957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4595960">for</span>&nbsp;<span class="ident" id="4595964">_</span><span class="op" id="4595965">,</span>&nbsp;<span class="ident" id="4595967">arg</span>&nbsp;<span class="op" id="4595971">:=</span>&nbsp;<span class="keyword" id="4595974">range</span>&nbsp;<span class="ident" id="4595980">args</span>&nbsp;<span class="op" id="4595985">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4595989">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596028">var</span>&nbsp;<span class="ident" id="4596032">data</span>&nbsp;<span class="builtintype" id="4596037">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596046">var</span>&nbsp;<span class="ident" id="4596050">isLit</span>&nbsp;<span class="builtintype" id="4596056">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596063">var</span>&nbsp;<span class="ident" id="4596067">impliedSemi</span>&nbsp;<span class="builtintype" id="4596079">bool</span>&nbsp;<span class="comment" id="4596084">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596129">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596172">switch</span>&nbsp;<span class="ident" id="4596179">p</span><span class="op" id="4596180">.</span><span class="ident" id="4596181">lastTok</span>&nbsp;<span class="op" id="4596189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596193">case</span>&nbsp;<span class="ident" id="4596198">token</span><span class="op" id="4596203">.</span><span class="ident" id="4596204">ILLEGAL</span><span class="op" id="4596211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596216">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596242">case</span>&nbsp;<span class="ident" id="4596247">token</span><span class="op" id="4596252">.</span><span class="ident" id="4596253">LPAREN</span><span class="op" id="4596259">,</span>&nbsp;<span class="ident" id="4596261">token</span><span class="op" id="4596266">.</span><span class="ident" id="4596267">LBRACK</span><span class="op" id="4596273">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596278">p</span><span class="op" id="4596279">.</span><span class="ident" id="4596280">prevOpen</span>&nbsp;<span class="op" id="4596289">=</span>&nbsp;<span class="ident" id="4596291">p</span><span class="op" id="4596292">.</span><span class="ident" id="4596293">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596303">default</span><span class="op" id="4596310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596315">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596361">p</span><span class="op" id="4596362">.</span><span class="ident" id="4596363">prevOpen</span>&nbsp;<span class="op" id="4596372">=</span>&nbsp;<span class="ident" id="4596374">token</span><span class="op" id="4596379">.</span><span class="ident" id="4596380">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4596390">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596395">switch</span>&nbsp;<span class="ident" id="4596402">x</span>&nbsp;<span class="op" id="4596404">:=</span>&nbsp;<span class="ident" id="4596407">arg</span><span class="op" id="4596410">.</span><span class="op" id="4596411">(</span><span class="keyword" id="4596412">type</span><span class="op" id="4596416">)</span>&nbsp;<span class="op" id="4596418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596422">case</span>&nbsp;<span class="ident" id="4596427">pmode</span><span class="op" id="4596432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596437">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596463">p</span><span class="op" id="4596464">.</span><span class="ident" id="4596465">mode</span>&nbsp;<span class="op" id="4596470">^=</span>&nbsp;<span class="ident" id="4596473">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596478">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596490">case</span>&nbsp;<span class="ident" id="4596495">whiteSpace</span><span class="op" id="4596505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596510">if</span>&nbsp;<span class="ident" id="4596513">x</span>&nbsp;<span class="op" id="4596515">==</span>&nbsp;<span class="ident" id="4596518">ignore</span>&nbsp;<span class="op" id="4596525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596531">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596577">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596625">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596645">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4596657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596662">i</span>&nbsp;<span class="op" id="4596664">:=</span>&nbsp;<span class="builtinfunc" id="4596667">len</span><span class="op" id="4596670">(</span><span class="ident" id="4596671">p</span><span class="op" id="4596672">.</span><span class="ident" id="4596673">wsbuf</span><span class="op" id="4596678">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596683">if</span>&nbsp;<span class="ident" id="4596686">i</span>&nbsp;<span class="op" id="4596688">==</span>&nbsp;<span class="builtinfunc" id="4596691">cap</span><span class="op" id="4596694">(</span><span class="ident" id="4596695">p</span><span class="op" id="4596696">.</span><span class="ident" id="4596697">wsbuf</span><span class="op" id="4596702">)</span>&nbsp;<span class="op" id="4596704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596710">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596768">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4596826">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596875">p</span><span class="op" id="4596876">.</span><span class="ident" id="4596877">writeWhitespace</span><span class="op" id="4596892">(</span><span class="ident" id="4596893">i</span><span class="op" id="4596894">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596900">i</span>&nbsp;<span class="op" id="4596902">=</span>&nbsp;<span class="num" id="4596904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4596909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596914">p</span><span class="op" id="4596915">.</span><span class="ident" id="4596916">wsbuf</span>&nbsp;<span class="op" id="4596922">=</span>&nbsp;<span class="ident" id="4596924">p</span><span class="op" id="4596925">.</span><span class="ident" id="4596926">wsbuf</span><span class="op" id="4596931">[</span><span class="num" id="4596932">0</span>&nbsp;<span class="op" id="4596934">:</span>&nbsp;<span class="ident" id="4596936">i</span><span class="op" id="4596937">+</span><span class="num" id="4596938">1</span><span class="op" id="4596939">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596944">p</span><span class="op" id="4596945">.</span><span class="ident" id="4596946">wsbuf</span><span class="op" id="4596951">[</span><span class="ident" id="4596952">i</span><span class="op" id="4596953">]</span>&nbsp;<span class="op" id="4596955">=</span>&nbsp;<span class="ident" id="4596957">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596962">if</span>&nbsp;<span class="ident" id="4596965">x</span>&nbsp;<span class="op" id="4596967">==</span>&nbsp;<span class="ident" id="4596970">newline</span>&nbsp;<span class="op" id="4596978">||</span>&nbsp;<span class="ident" id="4596981">x</span>&nbsp;<span class="op" id="4596983">==</span>&nbsp;<span class="ident" id="4596986">formfeed</span>&nbsp;<span class="op" id="4596995">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597001">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597058">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597116">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597175">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597195">p</span><span class="op" id="4597196">.</span><span class="ident" id="4597197">impliedSemi</span>&nbsp;<span class="op" id="4597209">=</span>&nbsp;<span class="builtintype" id="4597211">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4597220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597225">p</span><span class="op" id="4597226">.</span><span class="ident" id="4597227">lastTok</span>&nbsp;<span class="op" id="4597235">=</span>&nbsp;<span class="ident" id="4597237">token</span><span class="op" id="4597242">.</span><span class="ident" id="4597243">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597254">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597266">case</span>&nbsp;<span class="op" id="4597271">*</span><span class="ident" id="4597272">ast</span><span class="op" id="4597275">.</span><span class="ident" id="4597276">Ident</span><span class="op" id="4597281">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597286">data</span>&nbsp;<span class="op" id="4597291">=</span>&nbsp;<span class="ident" id="4597293">x</span><span class="op" id="4597294">.</span><span class="ident" id="4597295">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597303">impliedSemi</span>&nbsp;<span class="op" id="4597315">=</span>&nbsp;<span class="builtintype" id="4597317">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597325">p</span><span class="op" id="4597326">.</span><span class="ident" id="4597327">lastTok</span>&nbsp;<span class="op" id="4597335">=</span>&nbsp;<span class="ident" id="4597337">token</span><span class="op" id="4597342">.</span><span class="ident" id="4597343">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597352">case</span>&nbsp;<span class="op" id="4597357">*</span><span class="ident" id="4597358">ast</span><span class="op" id="4597361">.</span><span class="ident" id="4597362">BasicLit</span><span class="op" id="4597370">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597375">data</span>&nbsp;<span class="op" id="4597380">=</span>&nbsp;<span class="ident" id="4597382">x</span><span class="op" id="4597383">.</span><span class="ident" id="4597384">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597393">isLit</span>&nbsp;<span class="op" id="4597399">=</span>&nbsp;<span class="builtintype" id="4597401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597409">impliedSemi</span>&nbsp;<span class="op" id="4597421">=</span>&nbsp;<span class="builtintype" id="4597423">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597431">p</span><span class="op" id="4597432">.</span><span class="ident" id="4597433">lastTok</span>&nbsp;<span class="op" id="4597441">=</span>&nbsp;<span class="ident" id="4597443">x</span><span class="op" id="4597444">.</span><span class="ident" id="4597445">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597453">case</span>&nbsp;<span class="ident" id="4597458">token</span><span class="op" id="4597463">.</span><span class="ident" id="4597464">Token</span><span class="op" id="4597469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597474">s</span>&nbsp;<span class="op" id="4597476">:=</span>&nbsp;<span class="ident" id="4597479">x</span><span class="op" id="4597480">.</span><span class="ident" id="4597481">String</span><span class="op" id="4597487">(</span><span class="op" id="4597488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597493">if</span>&nbsp;<span class="ident" id="4597496">mayCombine</span><span class="op" id="4597506">(</span><span class="ident" id="4597507">p</span><span class="op" id="4597508">.</span><span class="ident" id="4597509">lastTok</span><span class="op" id="4597516">,</span>&nbsp;<span class="ident" id="4597518">s</span><span class="op" id="4597519">[</span><span class="num" id="4597520">0</span><span class="op" id="4597521">]</span><span class="op" id="4597522">)</span>&nbsp;<span class="op" id="4597524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597530">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597580">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597631">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597680">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597732">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597784">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4597828">if</span>&nbsp;<span class="builtinfunc" id="4597831">len</span><span class="op" id="4597834">(</span><span class="ident" id="4597835">p</span><span class="op" id="4597836">.</span><span class="ident" id="4597837">wsbuf</span><span class="op" id="4597842">)</span>&nbsp;<span class="op" id="4597844">!=</span>&nbsp;<span class="num" id="4597847">0</span>&nbsp;<span class="op" id="4597849">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597856">p</span><span class="op" id="4597857">.</span><span class="ident" id="4597858">internalError</span><span class="op" id="4597871">(</span><span class="string" id="4597872">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="4597901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4597907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597913">p</span><span class="op" id="4597914">.</span><span class="ident" id="4597915">wsbuf</span>&nbsp;<span class="op" id="4597921">=</span>&nbsp;<span class="ident" id="4597923">p</span><span class="op" id="4597924">.</span><span class="ident" id="4597925">wsbuf</span><span class="op" id="4597930">[</span><span class="num" id="4597931">0</span><span class="op" id="4597932">:</span><span class="num" id="4597933">1</span><span class="op" id="4597934">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597940">p</span><span class="op" id="4597941">.</span><span class="ident" id="4597942">wsbuf</span><span class="op" id="4597947">[</span><span class="num" id="4597948">0</span><span class="op" id="4597949">]</span>&nbsp;<span class="op" id="4597951">=</span>&nbsp;<span class="string" id="4597953">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4597960">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597965">data</span>&nbsp;<span class="op" id="4597970">=</span>&nbsp;<span class="ident" id="4597972">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4597977">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598037">switch</span>&nbsp;<span class="ident" id="4598044">x</span>&nbsp;<span class="op" id="4598046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598051">case</span>&nbsp;<span class="ident" id="4598056">token</span><span class="op" id="4598061">.</span><span class="ident" id="4598062">BREAK</span><span class="op" id="4598067">,</span>&nbsp;<span class="ident" id="4598069">token</span><span class="op" id="4598074">.</span><span class="ident" id="4598075">CONTINUE</span><span class="op" id="4598083">,</span>&nbsp;<span class="ident" id="4598085">token</span><span class="op" id="4598090">.</span><span class="ident" id="4598091">FALLTHROUGH</span><span class="op" id="4598102">,</span>&nbsp;<span class="ident" id="4598104">token</span><span class="op" id="4598109">.</span><span class="ident" id="4598110">RETURN</span><span class="op" id="4598116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598122">token</span><span class="op" id="4598127">.</span><span class="ident" id="4598128">INC</span><span class="op" id="4598131">,</span>&nbsp;<span class="ident" id="4598133">token</span><span class="op" id="4598138">.</span><span class="ident" id="4598139">DEC</span><span class="op" id="4598142">,</span>&nbsp;<span class="ident" id="4598144">token</span><span class="op" id="4598149">.</span><span class="ident" id="4598150">RPAREN</span><span class="op" id="4598156">,</span>&nbsp;<span class="ident" id="4598158">token</span><span class="op" id="4598163">.</span><span class="ident" id="4598164">RBRACK</span><span class="op" id="4598170">,</span>&nbsp;<span class="ident" id="4598172">token</span><span class="op" id="4598177">.</span><span class="ident" id="4598178">RBRACE</span><span class="op" id="4598184">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598190">impliedSemi</span>&nbsp;<span class="op" id="4598202">=</span>&nbsp;<span class="builtintype" id="4598204">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4598212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598217">p</span><span class="op" id="4598218">.</span><span class="ident" id="4598219">lastTok</span>&nbsp;<span class="op" id="4598227">=</span>&nbsp;<span class="ident" id="4598229">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598234">case</span>&nbsp;<span class="ident" id="4598239">token</span><span class="op" id="4598244">.</span><span class="ident" id="4598245">Pos</span><span class="op" id="4598248">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598253">if</span>&nbsp;<span class="ident" id="4598256">x</span><span class="op" id="4598257">.</span><span class="ident" id="4598258">IsValid</span><span class="op" id="4598265">(</span><span class="op" id="4598266">)</span>&nbsp;<span class="op" id="4598268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598274">p</span><span class="op" id="4598275">.</span><span class="ident" id="4598276">pos</span>&nbsp;<span class="op" id="4598280">=</span>&nbsp;<span class="ident" id="4598282">p</span><span class="op" id="4598283">.</span><span class="ident" id="4598284">posFor</span><span class="op" id="4598290">(</span><span class="ident" id="4598291">x</span><span class="op" id="4598292">)</span>&nbsp;<span class="comment" id="4598294">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4598331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598336">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598348">case</span>&nbsp;<span class="builtintype" id="4598353">string</span><span class="op" id="4598359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598364">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598406">data</span>&nbsp;<span class="op" id="4598411">=</span>&nbsp;<span class="ident" id="4598413">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598418">isLit</span>&nbsp;<span class="op" id="4598424">=</span>&nbsp;<span class="builtintype" id="4598426">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598434">impliedSemi</span>&nbsp;<span class="op" id="4598446">=</span>&nbsp;<span class="builtintype" id="4598448">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598456">p</span><span class="op" id="4598457">.</span><span class="ident" id="4598458">lastTok</span>&nbsp;<span class="op" id="4598466">=</span>&nbsp;<span class="ident" id="4598468">token</span><span class="op" id="4598473">.</span><span class="ident" id="4598474">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598484">default</span><span class="op" id="4598491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598496">fmt</span><span class="op" id="4598499">.</span><span class="ident" id="4598500">Fprintf</span><span class="op" id="4598507">(</span><span class="ident" id="4598508">os</span><span class="op" id="4598510">.</span><span class="ident" id="4598511">Stderr</span><span class="op" id="4598517">,</span>&nbsp;<span class="string" id="4598519">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="4598558">,</span>&nbsp;<span class="ident" id="4598560">arg</span><span class="op" id="4598563">,</span>&nbsp;<span class="ident" id="4598565">arg</span><span class="op" id="4598568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4598573">panic</span><span class="op" id="4598578">(</span><span class="string" id="4598579">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="4598596">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4598600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598604">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598621">next</span>&nbsp;<span class="op" id="4598626">:=</span>&nbsp;<span class="ident" id="4598629">p</span><span class="op" id="4598630">.</span><span class="ident" id="4598631">pos</span>&nbsp;<span class="comment" id="4598635">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598681">wroteNewline</span><span class="op" id="4598693">,</span>&nbsp;<span class="ident" id="4598695">droppedFF</span>&nbsp;<span class="op" id="4598705">:=</span>&nbsp;<span class="ident" id="4598708">p</span><span class="op" id="4598709">.</span><span class="ident" id="4598710">flush</span><span class="op" id="4598715">(</span><span class="ident" id="4598716">next</span><span class="op" id="4598720">,</span>&nbsp;<span class="ident" id="4598722">p</span><span class="op" id="4598723">.</span><span class="ident" id="4598724">lastTok</span><span class="op" id="4598731">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598736">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598797">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598857">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4598922">if</span>&nbsp;<span class="op" id="4598925">!</span><span class="ident" id="4598926">p</span><span class="op" id="4598927">.</span><span class="ident" id="4598928">impliedSemi</span>&nbsp;<span class="op" id="4598940">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4598945">n</span>&nbsp;<span class="op" id="4598947">:=</span>&nbsp;<span class="ident" id="4598950">nlimit</span><span class="op" id="4598956">(</span><span class="ident" id="4598957">next</span><span class="op" id="4598961">.</span><span class="ident" id="4598962">Line</span>&nbsp;<span class="op" id="4598967">-</span>&nbsp;<span class="ident" id="4598969">p</span><span class="op" id="4598970">.</span><span class="ident" id="4598971">pos</span><span class="op" id="4598974">.</span><span class="ident" id="4598975">Line</span><span class="op" id="4598979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4598984">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4599039">if</span>&nbsp;<span class="ident" id="4599042">wroteNewline</span>&nbsp;<span class="op" id="4599055">&amp;&amp;</span>&nbsp;<span class="ident" id="4599058">n</span>&nbsp;<span class="op" id="4599060">==</span>&nbsp;<span class="ident" id="4599063">maxNewlines</span>&nbsp;<span class="op" id="4599075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599081">n</span>&nbsp;<span class="op" id="4599083">=</span>&nbsp;<span class="ident" id="4599085">maxNewlines</span>&nbsp;<span class="op" id="4599097">-</span>&nbsp;<span class="num" id="4599099">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599104">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4599109">if</span>&nbsp;<span class="ident" id="4599112">n</span>&nbsp;<span class="op" id="4599114">&gt;</span>&nbsp;<span class="num" id="4599116">0</span>&nbsp;<span class="op" id="4599118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599124">ch</span>&nbsp;<span class="op" id="4599127">:=</span>&nbsp;<span class="builtintype" id="4599130">byte</span><span class="op" id="4599134">(</span><span class="string" id="4599135">&#39;\n&#39;</span><span class="op" id="4599139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4599145">if</span>&nbsp;<span class="ident" id="4599148">droppedFF</span>&nbsp;<span class="op" id="4599158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599165">ch</span>&nbsp;<span class="op" id="4599168">=</span>&nbsp;<span class="string" id="4599170">&#39;\f&#39;</span>&nbsp;<span class="comment" id="4599175">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599223">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599229">p</span><span class="op" id="4599230">.</span><span class="ident" id="4599231">writeByte</span><span class="op" id="4599240">(</span><span class="ident" id="4599241">ch</span><span class="op" id="4599243">,</span>&nbsp;<span class="ident" id="4599245">n</span><span class="op" id="4599246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599252">impliedSemi</span>&nbsp;<span class="op" id="4599264">=</span>&nbsp;<span class="builtintype" id="4599266">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4599284">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4599353">if</span>&nbsp;<span class="ident" id="4599356">p</span><span class="op" id="4599357">.</span><span class="ident" id="4599358">linePtr</span>&nbsp;<span class="op" id="4599366">!=</span>&nbsp;<span class="ident" id="4599369">nil</span>&nbsp;<span class="op" id="4599373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599378">*</span><span class="ident" id="4599379">p</span><span class="op" id="4599380">.</span><span class="ident" id="4599381">linePtr</span>&nbsp;<span class="op" id="4599389">=</span>&nbsp;<span class="ident" id="4599391">p</span><span class="op" id="4599392">.</span><span class="ident" id="4599393">out</span><span class="op" id="4599396">.</span><span class="ident" id="4599397">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599405">p</span><span class="op" id="4599406">.</span><span class="ident" id="4599407">linePtr</span>&nbsp;<span class="op" id="4599415">=</span>&nbsp;<span class="ident" id="4599417">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599423">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599428">p</span><span class="op" id="4599429">.</span><span class="ident" id="4599430">writeString</span><span class="op" id="4599441">(</span><span class="ident" id="4599442">next</span><span class="op" id="4599446">,</span>&nbsp;<span class="ident" id="4599448">data</span><span class="op" id="4599452">,</span>&nbsp;<span class="ident" id="4599454">isLit</span><span class="op" id="4599459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599463">p</span><span class="op" id="4599464">.</span><span class="ident" id="4599465">impliedSemi</span>&nbsp;<span class="op" id="4599477">=</span>&nbsp;<span class="ident" id="4599479">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599492">}</span><br>
<span class="lineno"></span><span class="op" id="4599494">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="4599497">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="4599569">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="4599642">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4599719">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="4599730">//</span><br>
<span class="lineno"></span><span class="keyword" id="4599733">func</span>&nbsp;<span class="op" id="4599738">(</span><span class="ident" id="4599739">p</span>&nbsp;<span class="op" id="4599741">*</span><span class="ident" id="4599742">printer</span><span class="op" id="4599749">)</span>&nbsp;<span class="ident" id="4599751">flush</span><span class="op" id="4599756">(</span><span class="ident" id="4599757">next</span>&nbsp;<span class="ident" id="4599762">token</span><span class="op" id="4599767">.</span><span class="ident" id="4599768">Position</span><span class="op" id="4599776">,</span>&nbsp;<span class="ident" id="4599778">tok</span>&nbsp;<span class="ident" id="4599782">token</span><span class="op" id="4599787">.</span><span class="ident" id="4599788">Token</span><span class="op" id="4599793">)</span>&nbsp;<span class="op" id="4599795">(</span><span class="ident" id="4599796">wroteNewline</span><span class="op" id="4599808">,</span>&nbsp;<span class="ident" id="4599810">droppedFF</span>&nbsp;<span class="builtintype" id="4599820">bool</span><span class="op" id="4599824">)</span>&nbsp;<span class="op" id="4599826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4599829">if</span>&nbsp;<span class="ident" id="4599832">p</span><span class="op" id="4599833">.</span><span class="ident" id="4599834">commentBefore</span><span class="op" id="4599847">(</span><span class="ident" id="4599848">next</span><span class="op" id="4599852">)</span>&nbsp;<span class="op" id="4599854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4599858">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4599924">wroteNewline</span><span class="op" id="4599936">,</span>&nbsp;<span class="ident" id="4599938">droppedFF</span>&nbsp;<span class="op" id="4599948">=</span>&nbsp;<span class="ident" id="4599950">p</span><span class="op" id="4599951">.</span><span class="ident" id="4599952">intersperseComments</span><span class="op" id="4599971">(</span><span class="ident" id="4599972">next</span><span class="op" id="4599976">,</span>&nbsp;<span class="ident" id="4599978">tok</span><span class="op" id="4599981">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4599984">}</span>&nbsp;<span class="keyword" id="4599986">else</span>&nbsp;<span class="op" id="4599991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4599995">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600041">p</span><span class="op" id="4600042">.</span><span class="ident" id="4600043">writeWhitespace</span><span class="op" id="4600058">(</span><span class="builtinfunc" id="4600059">len</span><span class="op" id="4600062">(</span><span class="ident" id="4600063">p</span><span class="op" id="4600064">.</span><span class="ident" id="4600065">wsbuf</span><span class="op" id="4600070">)</span><span class="op" id="4600071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4600074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600077">return</span><br>
<span class="lineno">990</span><span class="op" id="4600084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4600087">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="4600154">func</span>&nbsp;<span class="ident" id="4600159">getDoc</span><span class="op" id="4600165">(</span><span class="ident" id="4600166">n</span>&nbsp;<span class="ident" id="4600168">ast</span><span class="op" id="4600171">.</span><span class="ident" id="4600172">Node</span><span class="op" id="4600176">)</span>&nbsp;<span class="op" id="4600178">*</span><span class="ident" id="4600179">ast</span><span class="op" id="4600182">.</span><span class="ident" id="4600183">CommentGroup</span>&nbsp;<span class="op" id="4600196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600199">switch</span>&nbsp;<span class="ident" id="4600206">n</span>&nbsp;<span class="op" id="4600208">:=</span>&nbsp;<span class="ident" id="4600211">n</span><span class="op" id="4600212">.</span><span class="op" id="4600213">(</span><span class="keyword" id="4600214">type</span><span class="op" id="4600218">)</span>&nbsp;<span class="op" id="4600220">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600223">case</span>&nbsp;<span class="op" id="4600228">*</span><span class="ident" id="4600229">ast</span><span class="op" id="4600232">.</span><span class="ident" id="4600233">Field</span><span class="op" id="4600238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600242">return</span>&nbsp;<span class="ident" id="4600249">n</span><span class="op" id="4600250">.</span><span class="ident" id="4600251">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600256">case</span>&nbsp;<span class="op" id="4600261">*</span><span class="ident" id="4600262">ast</span><span class="op" id="4600265">.</span><span class="ident" id="4600266">ImportSpec</span><span class="op" id="4600276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600280">return</span>&nbsp;<span class="ident" id="4600287">n</span><span class="op" id="4600288">.</span><span class="ident" id="4600289">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600294">case</span>&nbsp;<span class="op" id="4600299">*</span><span class="ident" id="4600300">ast</span><span class="op" id="4600303">.</span><span class="ident" id="4600304">ValueSpec</span><span class="op" id="4600313">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600317">return</span>&nbsp;<span class="ident" id="4600324">n</span><span class="op" id="4600325">.</span><span class="ident" id="4600326">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600331">case</span>&nbsp;<span class="op" id="4600336">*</span><span class="ident" id="4600337">ast</span><span class="op" id="4600340">.</span><span class="ident" id="4600341">TypeSpec</span><span class="op" id="4600349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600353">return</span>&nbsp;<span class="ident" id="4600360">n</span><span class="op" id="4600361">.</span><span class="ident" id="4600362">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600367">case</span>&nbsp;<span class="op" id="4600372">*</span><span class="ident" id="4600373">ast</span><span class="op" id="4600376">.</span><span class="ident" id="4600377">GenDecl</span><span class="op" id="4600384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600388">return</span>&nbsp;<span class="ident" id="4600395">n</span><span class="op" id="4600396">.</span><span class="ident" id="4600397">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600402">case</span>&nbsp;<span class="op" id="4600407">*</span><span class="ident" id="4600408">ast</span><span class="op" id="4600411">.</span><span class="ident" id="4600412">FuncDecl</span><span class="op" id="4600420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600424">return</span>&nbsp;<span class="ident" id="4600431">n</span><span class="op" id="4600432">.</span><span class="ident" id="4600433">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600438">case</span>&nbsp;<span class="op" id="4600443">*</span><span class="ident" id="4600444">ast</span><span class="op" id="4600447">.</span><span class="ident" id="4600448">File</span><span class="op" id="4600452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600456">return</span>&nbsp;<span class="ident" id="4600463">n</span><span class="op" id="4600464">.</span><span class="ident" id="4600465">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4600470">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600473">return</span>&nbsp;<span class="ident" id="4600480">nil</span><br>
<span class="lineno"></span><span class="op" id="4600484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4600487">func</span>&nbsp;<span class="op" id="4600492">(</span><span class="ident" id="4600493">p</span>&nbsp;<span class="op" id="4600495">*</span><span class="ident" id="4600496">printer</span><span class="op" id="4600503">)</span>&nbsp;<span class="ident" id="4600505">printNode</span><span class="op" id="4600514">(</span><span class="ident" id="4600515">node</span>&nbsp;<span class="keyword" id="4600520">interface</span><span class="op" id="4600529">{</span><span class="op" id="4600530">}</span><span class="op" id="4600531">)</span>&nbsp;<span class="builtintype" id="4600533">error</span>&nbsp;<span class="op" id="4600539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4600542">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600576">var</span>&nbsp;<span class="ident" id="4600580">comments</span>&nbsp;<span class="op" id="4600589">[</span><span class="op" id="4600590">]</span><span class="op" id="4600591">*</span><span class="ident" id="4600592">ast</span><span class="op" id="4600595">.</span><span class="ident" id="4600596">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600610">if</span>&nbsp;<span class="ident" id="4600613">cnode</span><span class="op" id="4600618">,</span>&nbsp;<span class="ident" id="4600620">ok</span>&nbsp;<span class="op" id="4600623">:=</span>&nbsp;<span class="ident" id="4600626">node</span><span class="op" id="4600630">.</span><span class="op" id="4600631">(</span><span class="op" id="4600632">*</span><span class="ident" id="4600633">CommentedNode</span><span class="op" id="4600646">)</span><span class="op" id="4600647">;</span>&nbsp;<span class="ident" id="4600649">ok</span>&nbsp;<span class="op" id="4600652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600656">node</span>&nbsp;<span class="op" id="4600661">=</span>&nbsp;<span class="ident" id="4600663">cnode</span><span class="op" id="4600668">.</span><span class="ident" id="4600669">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600676">comments</span>&nbsp;<span class="op" id="4600685">=</span>&nbsp;<span class="ident" id="4600687">cnode</span><span class="op" id="4600692">.</span><span class="ident" id="4600693">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4600703">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600707">if</span>&nbsp;<span class="ident" id="4600710">comments</span>&nbsp;<span class="op" id="4600719">!=</span>&nbsp;<span class="ident" id="4600722">nil</span>&nbsp;<span class="op" id="4600726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4600730">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600792">n</span><span class="op" id="4600793">,</span>&nbsp;<span class="ident" id="4600795">ok</span>&nbsp;<span class="op" id="4600798">:=</span>&nbsp;<span class="ident" id="4600801">node</span><span class="op" id="4600805">.</span><span class="op" id="4600806">(</span><span class="ident" id="4600807">ast</span><span class="op" id="4600810">.</span><span class="ident" id="4600811">Node</span><span class="op" id="4600815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600819">if</span>&nbsp;<span class="op" id="4600822">!</span><span class="ident" id="4600823">ok</span>&nbsp;<span class="op" id="4600826">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4600831">goto</span>&nbsp;<span class="ident" id="4600836">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4600850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600854">beg</span>&nbsp;<span class="op" id="4600858">:=</span>&nbsp;<span class="ident" id="4600861">n</span><span class="op" id="4600862">.</span><span class="ident" id="4600863">Pos</span><span class="op" id="4600866">(</span><span class="op" id="4600867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4600871">end</span>&nbsp;<span class="op" id="4600875">:=</span>&nbsp;<span class="ident" id="4600878">n</span><span class="op" id="4600879">.</span><span class="ident" id="4600880">End</span><span class="op" id="4600883">(</span><span class="op" id="4600884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4600888">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4600935">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4600979">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601025">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601076">if</span>&nbsp;<span class="ident" id="4601079">doc</span>&nbsp;<span class="op" id="4601083">:=</span>&nbsp;<span class="ident" id="4601086">getDoc</span><span class="op" id="4601092">(</span><span class="ident" id="4601093">n</span><span class="op" id="4601094">)</span><span class="op" id="4601095">;</span>&nbsp;<span class="ident" id="4601097">doc</span>&nbsp;<span class="op" id="4601101">!=</span>&nbsp;<span class="ident" id="4601104">nil</span>&nbsp;<span class="op" id="4601108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601113">beg</span>&nbsp;<span class="op" id="4601117">=</span>&nbsp;<span class="ident" id="4601119">doc</span><span class="op" id="4601122">.</span><span class="ident" id="4601123">Pos</span><span class="op" id="4601126">(</span><span class="op" id="4601127">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601135">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601184">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601211">i</span>&nbsp;<span class="op" id="4601213">:=</span>&nbsp;<span class="num" id="4601216">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601220">for</span>&nbsp;<span class="ident" id="4601224">i</span>&nbsp;<span class="op" id="4601226">&lt;</span>&nbsp;<span class="builtinfunc" id="4601228">len</span><span class="op" id="4601231">(</span><span class="ident" id="4601232">comments</span><span class="op" id="4601240">)</span>&nbsp;<span class="op" id="4601242">&amp;&amp;</span>&nbsp;<span class="ident" id="4601245">comments</span><span class="op" id="4601253">[</span><span class="ident" id="4601254">i</span><span class="op" id="4601255">]</span><span class="op" id="4601256">.</span><span class="ident" id="4601257">End</span><span class="op" id="4601260">(</span><span class="op" id="4601261">)</span>&nbsp;<span class="op" id="4601263">&lt;</span>&nbsp;<span class="ident" id="4601265">beg</span>&nbsp;<span class="op" id="4601269">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601274">i</span><span class="op" id="4601275">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601284">j</span>&nbsp;<span class="op" id="4601286">:=</span>&nbsp;<span class="ident" id="4601289">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601293">for</span>&nbsp;<span class="ident" id="4601297">j</span>&nbsp;<span class="op" id="4601299">&lt;</span>&nbsp;<span class="builtinfunc" id="4601301">len</span><span class="op" id="4601304">(</span><span class="ident" id="4601305">comments</span><span class="op" id="4601313">)</span>&nbsp;<span class="op" id="4601315">&amp;&amp;</span>&nbsp;<span class="ident" id="4601318">comments</span><span class="op" id="4601326">[</span><span class="ident" id="4601327">j</span><span class="op" id="4601328">]</span><span class="op" id="4601329">.</span><span class="ident" id="4601330">Pos</span><span class="op" id="4601333">(</span><span class="op" id="4601334">)</span>&nbsp;<span class="op" id="4601336">&lt;</span>&nbsp;<span class="ident" id="4601338">end</span>&nbsp;<span class="op" id="4601342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601347">j</span><span class="op" id="4601348">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601357">if</span>&nbsp;<span class="ident" id="4601360">i</span>&nbsp;<span class="op" id="4601362">&lt;</span>&nbsp;<span class="ident" id="4601364">j</span>&nbsp;<span class="op" id="4601366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601371">p</span><span class="op" id="4601372">.</span><span class="ident" id="4601373">comments</span>&nbsp;<span class="op" id="4601382">=</span>&nbsp;<span class="ident" id="4601384">comments</span><span class="op" id="4601392">[</span><span class="ident" id="4601393">i</span><span class="op" id="4601394">:</span><span class="ident" id="4601395">j</span><span class="op" id="4601396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601403">}</span>&nbsp;<span class="keyword" id="4601405">else</span>&nbsp;<span class="keyword" id="4601410">if</span>&nbsp;<span class="ident" id="4601413">n</span><span class="op" id="4601414">,</span>&nbsp;<span class="ident" id="4601416">ok</span>&nbsp;<span class="op" id="4601419">:=</span>&nbsp;<span class="ident" id="4601422">node</span><span class="op" id="4601426">.</span><span class="op" id="4601427">(</span><span class="op" id="4601428">*</span><span class="ident" id="4601429">ast</span><span class="op" id="4601432">.</span><span class="ident" id="4601433">File</span><span class="op" id="4601437">)</span><span class="op" id="4601438">;</span>&nbsp;<span class="ident" id="4601440">ok</span>&nbsp;<span class="op" id="4601443">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601447">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601482">p</span><span class="op" id="4601483">.</span><span class="ident" id="4601484">comments</span>&nbsp;<span class="op" id="4601493">=</span>&nbsp;<span class="ident" id="4601495">n</span><span class="op" id="4601496">.</span><span class="ident" id="4601497">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601511">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601559">p</span><span class="op" id="4601560">.</span><span class="ident" id="4601561">useNodeComments</span>&nbsp;<span class="op" id="4601577">=</span>&nbsp;<span class="ident" id="4601579">p</span><span class="op" id="4601580">.</span><span class="ident" id="4601581">comments</span>&nbsp;<span class="op" id="4601590">==</span>&nbsp;<span class="ident" id="4601593">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601599">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601630">p</span><span class="op" id="4601631">.</span><span class="ident" id="4601632">nextComment</span><span class="op" id="4601643">(</span><span class="op" id="4601644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601648">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601664">switch</span>&nbsp;<span class="ident" id="4601671">n</span>&nbsp;<span class="op" id="4601673">:=</span>&nbsp;<span class="ident" id="4601676">node</span><span class="op" id="4601680">.</span><span class="op" id="4601681">(</span><span class="keyword" id="4601682">type</span><span class="op" id="4601686">)</span>&nbsp;<span class="op" id="4601688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601691">case</span>&nbsp;<span class="ident" id="4601696">ast</span><span class="op" id="4601699">.</span><span class="ident" id="4601700">Expr</span><span class="op" id="4601704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601708">p</span><span class="op" id="4601709">.</span><span class="ident" id="4601710">expr</span><span class="op" id="4601714">(</span><span class="ident" id="4601715">n</span><span class="op" id="4601716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601719">case</span>&nbsp;<span class="ident" id="4601724">ast</span><span class="op" id="4601727">.</span><span class="ident" id="4601728">Stmt</span><span class="op" id="4601732">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601736">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4601799">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601858">if</span>&nbsp;<span class="ident" id="4601861">_</span><span class="op" id="4601862">,</span>&nbsp;<span class="ident" id="4601864">ok</span>&nbsp;<span class="op" id="4601867">:=</span>&nbsp;<span class="ident" id="4601870">n</span><span class="op" id="4601871">.</span><span class="op" id="4601872">(</span><span class="op" id="4601873">*</span><span class="ident" id="4601874">ast</span><span class="op" id="4601877">.</span><span class="ident" id="4601878">LabeledStmt</span><span class="op" id="4601889">)</span><span class="op" id="4601890">;</span>&nbsp;<span class="ident" id="4601892">ok</span>&nbsp;<span class="op" id="4601895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601900">p</span><span class="op" id="4601901">.</span><span class="ident" id="4601902">indent</span>&nbsp;<span class="op" id="4601909">=</span>&nbsp;<span class="num" id="4601911">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4601915">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601919">p</span><span class="op" id="4601920">.</span><span class="ident" id="4601921">stmt</span><span class="op" id="4601925">(</span><span class="ident" id="4601926">n</span><span class="op" id="4601927">,</span>&nbsp;<span class="builtintype" id="4601929">false</span><span class="op" id="4601934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601937">case</span>&nbsp;<span class="ident" id="4601942">ast</span><span class="op" id="4601945">.</span><span class="ident" id="4601946">Decl</span><span class="op" id="4601950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601954">p</span><span class="op" id="4601955">.</span><span class="ident" id="4601956">decl</span><span class="op" id="4601960">(</span><span class="ident" id="4601961">n</span><span class="op" id="4601962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4601965">case</span>&nbsp;<span class="ident" id="4601970">ast</span><span class="op" id="4601973">.</span><span class="ident" id="4601974">Spec</span><span class="op" id="4601978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4601982">p</span><span class="op" id="4601983">.</span><span class="ident" id="4601984">spec</span><span class="op" id="4601988">(</span><span class="ident" id="4601989">n</span><span class="op" id="4601990">,</span>&nbsp;<span class="num" id="4601992">1</span><span class="op" id="4601993">,</span>&nbsp;<span class="builtintype" id="4601995">false</span><span class="op" id="4602000">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602003">case</span>&nbsp;<span class="op" id="4602008">[</span><span class="op" id="4602009">]</span><span class="ident" id="4602010">ast</span><span class="op" id="4602013">.</span><span class="ident" id="4602014">Stmt</span><span class="op" id="4602018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4602022">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4602085">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602144">for</span>&nbsp;<span class="ident" id="4602148">_</span><span class="op" id="4602149">,</span>&nbsp;<span class="ident" id="4602151">s</span>&nbsp;<span class="op" id="4602153">:=</span>&nbsp;<span class="keyword" id="4602156">range</span>&nbsp;<span class="ident" id="4602162">n</span>&nbsp;<span class="op" id="4602164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602169">if</span>&nbsp;<span class="ident" id="4602172">_</span><span class="op" id="4602173">,</span>&nbsp;<span class="ident" id="4602175">ok</span>&nbsp;<span class="op" id="4602178">:=</span>&nbsp;<span class="ident" id="4602181">s</span><span class="op" id="4602182">.</span><span class="op" id="4602183">(</span><span class="op" id="4602184">*</span><span class="ident" id="4602185">ast</span><span class="op" id="4602188">.</span><span class="ident" id="4602189">LabeledStmt</span><span class="op" id="4602200">)</span><span class="op" id="4602201">;</span>&nbsp;<span class="ident" id="4602203">ok</span>&nbsp;<span class="op" id="4602206">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602212">p</span><span class="op" id="4602213">.</span><span class="ident" id="4602214">indent</span>&nbsp;<span class="op" id="4602221">=</span>&nbsp;<span class="num" id="4602223">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4602228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4602232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602236">p</span><span class="op" id="4602237">.</span><span class="ident" id="4602238">stmtList</span><span class="op" id="4602246">(</span><span class="ident" id="4602247">n</span><span class="op" id="4602248">,</span>&nbsp;<span class="num" id="4602250">0</span><span class="op" id="4602251">,</span>&nbsp;<span class="builtintype" id="4602253">false</span><span class="op" id="4602258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602261">case</span>&nbsp;<span class="op" id="4602266">[</span><span class="op" id="4602267">]</span><span class="ident" id="4602268">ast</span><span class="op" id="4602271">.</span><span class="ident" id="4602272">Decl</span><span class="op" id="4602276">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602280">p</span><span class="op" id="4602281">.</span><span class="ident" id="4602282">declList</span><span class="op" id="4602290">(</span><span class="ident" id="4602291">n</span><span class="op" id="4602292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602295">case</span>&nbsp;<span class="op" id="4602300">*</span><span class="ident" id="4602301">ast</span><span class="op" id="4602304">.</span><span class="ident" id="4602305">File</span><span class="op" id="4602309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602313">p</span><span class="op" id="4602314">.</span><span class="ident" id="4602315">file</span><span class="op" id="4602319">(</span><span class="ident" id="4602320">n</span><span class="op" id="4602321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602324">default</span><span class="op" id="4602331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602335">goto</span>&nbsp;<span class="ident" id="4602340">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4602353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602357">return</span>&nbsp;<span class="ident" id="4602364">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4602369">unsupported</span><span class="op" id="4602380">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4602383">return</span>&nbsp;<span class="ident" id="4602390">fmt</span><span class="op" id="4602393">.</span><span class="ident" id="4602394">Errorf</span><span class="op" id="4602400">(</span><span class="string" id="4602401">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="4602439">,</span>&nbsp;<span class="ident" id="4602441">node</span><span class="op" id="4602445">)</span><br>
<span class="lineno"></span><span class="op" id="4602447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4602450">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4602530">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="4602542">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="4602609">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4602678">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="4602747">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="4602816">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="4602838">//</span><br>
<span class="lineno"></span><span class="keyword" id="4602841">type</span>&nbsp;<span class="ident" id="4602846">trimmer</span>&nbsp;<span class="keyword" id="4602854">struct</span>&nbsp;<span class="op" id="4602861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602864">output</span>&nbsp;<span class="ident" id="4602871">io</span><span class="op" id="4602873">.</span><span class="ident" id="4602874">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602882">state</span>&nbsp;&nbsp;<span class="builtintype" id="4602889">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4602894">space</span>&nbsp;&nbsp;<span class="op" id="4602901">[</span><span class="op" id="4602902">]</span><span class="builtintype" id="4602903">byte</span><br>
<span class="lineno"></span><span class="op" id="4602908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4602911">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="4602957">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="4603002">const</span>&nbsp;<span class="op" id="4603008">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603011">inSpace</span>&nbsp;&nbsp;<span class="op" id="4603020">=</span>&nbsp;<span class="ident" id="4603022">iota</span>&nbsp;<span class="comment" id="4603027">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603044">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603060">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603107">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603123">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="4603138">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="4603141">func</span>&nbsp;<span class="op" id="4603146">(</span><span class="ident" id="4603147">p</span>&nbsp;<span class="op" id="4603149">*</span><span class="ident" id="4603150">trimmer</span><span class="op" id="4603157">)</span>&nbsp;<span class="ident" id="4603159">resetSpace</span><span class="op" id="4603169">(</span><span class="op" id="4603170">)</span>&nbsp;<span class="op" id="4603172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603175">p</span><span class="op" id="4603176">.</span><span class="ident" id="4603177">state</span>&nbsp;<span class="op" id="4603183">=</span>&nbsp;<span class="ident" id="4603185">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603194">p</span><span class="op" id="4603195">.</span><span class="ident" id="4603196">space</span>&nbsp;<span class="op" id="4603202">=</span>&nbsp;<span class="ident" id="4603204">p</span><span class="op" id="4603205">.</span><span class="ident" id="4603206">space</span><span class="op" id="4603211">[</span><span class="num" id="4603212">0</span><span class="op" id="4603213">:</span><span class="num" id="4603214">0</span><span class="op" id="4603215">]</span><br>
<span class="lineno"></span><span class="op" id="4603217">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="4603220">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4603290">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="4603360">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4603428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="4603495">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4603527">var</span>&nbsp;<span class="ident" id="4603531">aNewline</span>&nbsp;<span class="op" id="4603540">=</span>&nbsp;<span class="op" id="4603542">[</span><span class="op" id="4603543">]</span><span class="builtintype" id="4603544">byte</span><span class="op" id="4603548">(</span><span class="string" id="4603549">&#34;\n&#34;</span><span class="op" id="4603553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4603556">func</span>&nbsp;<span class="op" id="4603561">(</span><span class="ident" id="4603562">p</span>&nbsp;<span class="op" id="4603564">*</span><span class="ident" id="4603565">trimmer</span><span class="op" id="4603572">)</span>&nbsp;<span class="ident" id="4603574">Write</span><span class="op" id="4603579">(</span><span class="ident" id="4603580">data</span>&nbsp;<span class="op" id="4603585">[</span><span class="op" id="4603586">]</span><span class="builtintype" id="4603587">byte</span><span class="op" id="4603591">)</span>&nbsp;<span class="op" id="4603593">(</span><span class="ident" id="4603594">n</span>&nbsp;<span class="builtintype" id="4603596">int</span><span class="op" id="4603599">,</span>&nbsp;<span class="ident" id="4603601">err</span>&nbsp;<span class="builtintype" id="4603605">error</span><span class="op" id="4603610">)</span>&nbsp;<span class="op" id="4603612">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603615">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603631">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603655">//&nbsp;&nbsp;&nbsp;&nbsp;p.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603680">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4603713">//&nbsp;&nbsp;&nbsp;&nbsp;data[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603740">m</span>&nbsp;<span class="op" id="4603742">:=</span>&nbsp;<span class="num" id="4603745">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603748">var</span>&nbsp;<span class="ident" id="4603752">b</span>&nbsp;<span class="builtintype" id="4603754">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603760">for</span>&nbsp;<span class="ident" id="4603764">n</span><span class="op" id="4603765">,</span>&nbsp;<span class="ident" id="4603767">b</span>&nbsp;<span class="op" id="4603769">=</span>&nbsp;<span class="keyword" id="4603771">range</span>&nbsp;<span class="ident" id="4603777">data</span>&nbsp;<span class="op" id="4603782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603786">if</span>&nbsp;<span class="ident" id="4603789">b</span>&nbsp;<span class="op" id="4603791">==</span>&nbsp;<span class="string" id="4603794">&#39;\v&#39;</span>&nbsp;<span class="op" id="4603799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603804">b</span>&nbsp;<span class="op" id="4603806">=</span>&nbsp;<span class="string" id="4603808">&#39;\t&#39;</span>&nbsp;<span class="comment" id="4603813">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4603834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603838">switch</span>&nbsp;<span class="ident" id="4603845">p</span><span class="op" id="4603846">.</span><span class="ident" id="4603847">state</span>&nbsp;<span class="op" id="4603853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603857">case</span>&nbsp;<span class="ident" id="4603862">inSpace</span><span class="op" id="4603869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603874">switch</span>&nbsp;<span class="ident" id="4603881">b</span>&nbsp;<span class="op" id="4603883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603888">case</span>&nbsp;<span class="string" id="4603893">&#39;\t&#39;</span><span class="op" id="4603897">,</span>&nbsp;<span class="string" id="4603899">&#39;&nbsp;&#39;</span><span class="op" id="4603902">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603908">p</span><span class="op" id="4603909">.</span><span class="ident" id="4603910">space</span>&nbsp;<span class="op" id="4603916">=</span>&nbsp;<span class="builtinfunc" id="4603918">append</span><span class="op" id="4603924">(</span><span class="ident" id="4603925">p</span><span class="op" id="4603926">.</span><span class="ident" id="4603927">space</span><span class="op" id="4603932">,</span>&nbsp;<span class="ident" id="4603934">b</span><span class="op" id="4603935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4603940">case</span>&nbsp;<span class="string" id="4603945">&#39;\n&#39;</span><span class="op" id="4603949">,</span>&nbsp;<span class="string" id="4603951">&#39;\f&#39;</span><span class="op" id="4603955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4603961">p</span><span class="op" id="4603962">.</span><span class="ident" id="4603963">resetSpace</span><span class="op" id="4603973">(</span><span class="op" id="4603974">)</span>&nbsp;<span class="comment" id="4603976">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604006">_</span><span class="op" id="4604007">,</span>&nbsp;<span class="ident" id="4604009">err</span>&nbsp;<span class="op" id="4604013">=</span>&nbsp;<span class="ident" id="4604015">p</span><span class="op" id="4604016">.</span><span class="ident" id="4604017">output</span><span class="op" id="4604023">.</span><span class="ident" id="4604024">Write</span><span class="op" id="4604029">(</span><span class="ident" id="4604030">aNewline</span><span class="op" id="4604038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604043">case</span>&nbsp;<span class="ident" id="4604048">tabwriter</span><span class="op" id="4604057">.</span><span class="ident" id="4604058">Escape</span><span class="op" id="4604064">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604070">_</span><span class="op" id="4604071">,</span>&nbsp;<span class="ident" id="4604073">err</span>&nbsp;<span class="op" id="4604077">=</span>&nbsp;<span class="ident" id="4604079">p</span><span class="op" id="4604080">.</span><span class="ident" id="4604081">output</span><span class="op" id="4604087">.</span><span class="ident" id="4604088">Write</span><span class="op" id="4604093">(</span><span class="ident" id="4604094">p</span><span class="op" id="4604095">.</span><span class="ident" id="4604096">space</span><span class="op" id="4604101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604107">p</span><span class="op" id="4604108">.</span><span class="ident" id="4604109">state</span>&nbsp;<span class="op" id="4604115">=</span>&nbsp;<span class="ident" id="4604117">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604130">m</span>&nbsp;<span class="op" id="4604132">=</span>&nbsp;<span class="ident" id="4604134">n</span>&nbsp;<span class="op" id="4604136">+</span>&nbsp;<span class="num" id="4604138">1</span>&nbsp;<span class="comment" id="4604140">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604172">default</span><span class="op" id="4604179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604185">_</span><span class="op" id="4604186">,</span>&nbsp;<span class="ident" id="4604188">err</span>&nbsp;<span class="op" id="4604192">=</span>&nbsp;<span class="ident" id="4604194">p</span><span class="op" id="4604195">.</span><span class="ident" id="4604196">output</span><span class="op" id="4604202">.</span><span class="ident" id="4604203">Write</span><span class="op" id="4604208">(</span><span class="ident" id="4604209">p</span><span class="op" id="4604210">.</span><span class="ident" id="4604211">space</span><span class="op" id="4604216">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604222">p</span><span class="op" id="4604223">.</span><span class="ident" id="4604224">state</span>&nbsp;<span class="op" id="4604230">=</span>&nbsp;<span class="ident" id="4604232">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604243">m</span>&nbsp;<span class="op" id="4604245">=</span>&nbsp;<span class="ident" id="4604247">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604256">case</span>&nbsp;<span class="ident" id="4604261">inEscape</span><span class="op" id="4604269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604274">if</span>&nbsp;<span class="ident" id="4604277">b</span>&nbsp;<span class="op" id="4604279">==</span>&nbsp;<span class="ident" id="4604282">tabwriter</span><span class="op" id="4604291">.</span><span class="ident" id="4604292">Escape</span>&nbsp;<span class="op" id="4604299">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604305">_</span><span class="op" id="4604306">,</span>&nbsp;<span class="ident" id="4604308">err</span>&nbsp;<span class="op" id="4604312">=</span>&nbsp;<span class="ident" id="4604314">p</span><span class="op" id="4604315">.</span><span class="ident" id="4604316">output</span><span class="op" id="4604322">.</span><span class="ident" id="4604323">Write</span><span class="op" id="4604328">(</span><span class="ident" id="4604329">data</span><span class="op" id="4604333">[</span><span class="ident" id="4604334">m</span><span class="op" id="4604335">:</span><span class="ident" id="4604336">n</span><span class="op" id="4604337">]</span><span class="op" id="4604338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604344">p</span><span class="op" id="4604345">.</span><span class="ident" id="4604346">resetSpace</span><span class="op" id="4604356">(</span><span class="op" id="4604357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604366">case</span>&nbsp;<span class="ident" id="4604371">inText</span><span class="op" id="4604377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604382">switch</span>&nbsp;<span class="ident" id="4604389">b</span>&nbsp;<span class="op" id="4604391">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604396">case</span>&nbsp;<span class="string" id="4604401">&#39;\t&#39;</span><span class="op" id="4604405">,</span>&nbsp;<span class="string" id="4604407">&#39;&nbsp;&#39;</span><span class="op" id="4604410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604416">_</span><span class="op" id="4604417">,</span>&nbsp;<span class="ident" id="4604419">err</span>&nbsp;<span class="op" id="4604423">=</span>&nbsp;<span class="ident" id="4604425">p</span><span class="op" id="4604426">.</span><span class="ident" id="4604427">output</span><span class="op" id="4604433">.</span><span class="ident" id="4604434">Write</span><span class="op" id="4604439">(</span><span class="ident" id="4604440">data</span><span class="op" id="4604444">[</span><span class="ident" id="4604445">m</span><span class="op" id="4604446">:</span><span class="ident" id="4604447">n</span><span class="op" id="4604448">]</span><span class="op" id="4604449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604455">p</span><span class="op" id="4604456">.</span><span class="ident" id="4604457">resetSpace</span><span class="op" id="4604467">(</span><span class="op" id="4604468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604474">p</span><span class="op" id="4604475">.</span><span class="ident" id="4604476">space</span>&nbsp;<span class="op" id="4604482">=</span>&nbsp;<span class="builtinfunc" id="4604484">append</span><span class="op" id="4604490">(</span><span class="ident" id="4604491">p</span><span class="op" id="4604492">.</span><span class="ident" id="4604493">space</span><span class="op" id="4604498">,</span>&nbsp;<span class="ident" id="4604500">b</span><span class="op" id="4604501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604506">case</span>&nbsp;<span class="string" id="4604511">&#39;\n&#39;</span><span class="op" id="4604515">,</span>&nbsp;<span class="string" id="4604517">&#39;\f&#39;</span><span class="op" id="4604521">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604527">_</span><span class="op" id="4604528">,</span>&nbsp;<span class="ident" id="4604530">err</span>&nbsp;<span class="op" id="4604534">=</span>&nbsp;<span class="ident" id="4604536">p</span><span class="op" id="4604537">.</span><span class="ident" id="4604538">output</span><span class="op" id="4604544">.</span><span class="ident" id="4604545">Write</span><span class="op" id="4604550">(</span><span class="ident" id="4604551">data</span><span class="op" id="4604555">[</span><span class="ident" id="4604556">m</span><span class="op" id="4604557">:</span><span class="ident" id="4604558">n</span><span class="op" id="4604559">]</span><span class="op" id="4604560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604566">p</span><span class="op" id="4604567">.</span><span class="ident" id="4604568">resetSpace</span><span class="op" id="4604578">(</span><span class="op" id="4604579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604585">_</span><span class="op" id="4604586">,</span>&nbsp;<span class="ident" id="4604588">err</span>&nbsp;<span class="op" id="4604592">=</span>&nbsp;<span class="ident" id="4604594">p</span><span class="op" id="4604595">.</span><span class="ident" id="4604596">output</span><span class="op" id="4604602">.</span><span class="ident" id="4604603">Write</span><span class="op" id="4604608">(</span><span class="ident" id="4604609">aNewline</span><span class="op" id="4604617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604622">case</span>&nbsp;<span class="ident" id="4604627">tabwriter</span><span class="op" id="4604636">.</span><span class="ident" id="4604637">Escape</span><span class="op" id="4604643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604649">_</span><span class="op" id="4604650">,</span>&nbsp;<span class="ident" id="4604652">err</span>&nbsp;<span class="op" id="4604656">=</span>&nbsp;<span class="ident" id="4604658">p</span><span class="op" id="4604659">.</span><span class="ident" id="4604660">output</span><span class="op" id="4604666">.</span><span class="ident" id="4604667">Write</span><span class="op" id="4604672">(</span><span class="ident" id="4604673">data</span><span class="op" id="4604677">[</span><span class="ident" id="4604678">m</span><span class="op" id="4604679">:</span><span class="ident" id="4604680">n</span><span class="op" id="4604681">]</span><span class="op" id="4604682">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604688">p</span><span class="op" id="4604689">.</span><span class="ident" id="4604690">state</span>&nbsp;<span class="op" id="4604696">=</span>&nbsp;<span class="ident" id="4604698">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604711">m</span>&nbsp;<span class="op" id="4604713">=</span>&nbsp;<span class="ident" id="4604715">n</span>&nbsp;<span class="op" id="4604717">+</span>&nbsp;<span class="num" id="4604719">1</span>&nbsp;<span class="comment" id="4604721">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604757">default</span><span class="op" id="4604764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4604769">panic</span><span class="op" id="4604774">(</span><span class="string" id="4604775">&#34;unreachable&#34;</span><span class="op" id="4604788">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604796">if</span>&nbsp;<span class="ident" id="4604799">err</span>&nbsp;<span class="op" id="4604803">!=</span>&nbsp;<span class="ident" id="4604806">nil</span>&nbsp;<span class="op" id="4604810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604815">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604827">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604830">n</span>&nbsp;<span class="op" id="4604832">=</span>&nbsp;<span class="builtinfunc" id="4604834">len</span><span class="op" id="4604837">(</span><span class="ident" id="4604838">data</span><span class="op" id="4604842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604846">switch</span>&nbsp;<span class="ident" id="4604853">p</span><span class="op" id="4604854">.</span><span class="ident" id="4604855">state</span>&nbsp;<span class="op" id="4604861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604864">case</span>&nbsp;<span class="ident" id="4604869">inEscape</span><span class="op" id="4604877">,</span>&nbsp;<span class="ident" id="4604879">inText</span><span class="op" id="4604885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604889">_</span><span class="op" id="4604890">,</span>&nbsp;<span class="ident" id="4604892">err</span>&nbsp;<span class="op" id="4604896">=</span>&nbsp;<span class="ident" id="4604898">p</span><span class="op" id="4604899">.</span><span class="ident" id="4604900">output</span><span class="op" id="4604906">.</span><span class="ident" id="4604907">Write</span><span class="op" id="4604912">(</span><span class="ident" id="4604913">data</span><span class="op" id="4604917">[</span><span class="ident" id="4604918">m</span><span class="op" id="4604919">:</span><span class="ident" id="4604920">n</span><span class="op" id="4604921">]</span><span class="op" id="4604922">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4604926">p</span><span class="op" id="4604927">.</span><span class="ident" id="4604928">resetSpace</span><span class="op" id="4604938">(</span><span class="op" id="4604939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4604946">return</span><br>
<span class="lineno"></span><span class="op" id="4604953">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="4604956">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4605036">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4605057">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="4605122">type</span>&nbsp;<span class="ident" id="4605127">Mode</span>&nbsp;<span class="builtintype" id="4605132">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4605138">const</span>&nbsp;<span class="op" id="4605144">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605147">RawFormat</span>&nbsp;<span class="ident" id="4605157">Mode</span>&nbsp;<span class="op" id="4605162">=</span>&nbsp;<span class="num" id="4605164">1</span>&nbsp;<span class="op" id="4605166">&lt;&lt;</span>&nbsp;<span class="ident" id="4605169">iota</span>&nbsp;<span class="comment" id="4605174">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605231">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4605258">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605312">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4605339">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605384">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4605411">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="4605473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4605476">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4605524">type</span>&nbsp;<span class="ident" id="4605529">Config</span>&nbsp;<span class="keyword" id="4605536">struct</span>&nbsp;<span class="op" id="4605543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605546">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605555">Mode</span>&nbsp;<span class="comment" id="4605560">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605575">Tabwidth</span>&nbsp;<span class="builtintype" id="4605584">int</span>&nbsp;&nbsp;<span class="comment" id="4605589">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605604">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4605613">int</span>&nbsp;&nbsp;<span class="comment" id="4605618">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="4605677">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="4605680">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4605769">func</span>&nbsp;<span class="op" id="4605774">(</span><span class="ident" id="4605775">cfg</span>&nbsp;<span class="op" id="4605779">*</span><span class="ident" id="4605780">Config</span><span class="op" id="4605786">)</span>&nbsp;<span class="ident" id="4605788">fprint</span><span class="op" id="4605794">(</span><span class="ident" id="4605795">output</span>&nbsp;<span class="ident" id="4605802">io</span><span class="op" id="4605804">.</span><span class="ident" id="4605805">Writer</span><span class="op" id="4605811">,</span>&nbsp;<span class="ident" id="4605813">fset</span>&nbsp;<span class="op" id="4605818">*</span><span class="ident" id="4605819">token</span><span class="op" id="4605824">.</span><span class="ident" id="4605825">FileSet</span><span class="op" id="4605832">,</span>&nbsp;<span class="ident" id="4605834">node</span>&nbsp;<span class="keyword" id="4605839">interface</span><span class="op" id="4605848">{</span><span class="op" id="4605849">}</span><span class="op" id="4605850">,</span>&nbsp;<span class="ident" id="4605852">nodeSizes</span>&nbsp;<span class="keyword" id="4605862">map</span><span class="op" id="4605865">[</span><span class="ident" id="4605866">ast</span><span class="op" id="4605869">.</span><span class="ident" id="4605870">Node</span><span class="op" id="4605874">]</span><span class="builtintype" id="4605875">int</span><span class="op" id="4605878">)</span>&nbsp;<span class="op" id="4605880">(</span><span class="ident" id="4605881">err</span>&nbsp;<span class="builtintype" id="4605885">error</span><span class="op" id="4605890">)</span>&nbsp;<span class="op" id="4605892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4605895">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4605910">var</span>&nbsp;<span class="ident" id="4605914">p</span>&nbsp;<span class="ident" id="4605916">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605925">p</span><span class="op" id="4605926">.</span><span class="ident" id="4605927">init</span><span class="op" id="4605931">(</span><span class="ident" id="4605932">cfg</span><span class="op" id="4605935">,</span>&nbsp;<span class="ident" id="4605937">fset</span><span class="op" id="4605941">,</span>&nbsp;<span class="ident" id="4605943">nodeSizes</span><span class="op" id="4605952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4605955">if</span>&nbsp;<span class="ident" id="4605958">err</span>&nbsp;<span class="op" id="4605962">=</span>&nbsp;<span class="ident" id="4605964">p</span><span class="op" id="4605965">.</span><span class="ident" id="4605966">printNode</span><span class="op" id="4605975">(</span><span class="ident" id="4605976">node</span><span class="op" id="4605980">)</span><span class="op" id="4605981">;</span>&nbsp;<span class="ident" id="4605983">err</span>&nbsp;<span class="op" id="4605987">!=</span>&nbsp;<span class="ident" id="4605990">nil</span>&nbsp;<span class="op" id="4605994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4605998">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606009">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606040">p</span><span class="op" id="4606041">.</span><span class="ident" id="4606042">impliedSemi</span>&nbsp;<span class="op" id="4606054">=</span>&nbsp;<span class="builtintype" id="4606056">false</span>&nbsp;<span class="comment" id="4606062">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606090">p</span><span class="op" id="4606091">.</span><span class="ident" id="4606092">flush</span><span class="op" id="4606097">(</span><span class="ident" id="4606098">token</span><span class="op" id="4606103">.</span><span class="ident" id="4606104">Position</span><span class="op" id="4606112">{</span><span class="ident" id="4606113">Offset</span><span class="op" id="4606119">:</span>&nbsp;<span class="ident" id="4606121">infinity</span><span class="op" id="4606129">,</span>&nbsp;<span class="ident" id="4606131">Line</span><span class="op" id="4606135">:</span>&nbsp;<span class="ident" id="4606137">infinity</span><span class="op" id="4606145">}</span><span class="op" id="4606146">,</span>&nbsp;<span class="ident" id="4606148">token</span><span class="op" id="4606153">.</span><span class="ident" id="4606154">EOF</span><span class="op" id="4606157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606161">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606232">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606304">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606369">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606436">output</span>&nbsp;<span class="op" id="4606443">=</span>&nbsp;<span class="op" id="4606445">&amp;</span><span class="ident" id="4606446">trimmer</span><span class="op" id="4606453">{</span><span class="ident" id="4606454">output</span><span class="op" id="4606460">:</span>&nbsp;<span class="ident" id="4606462">output</span><span class="op" id="4606468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606472">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4606525">if</span>&nbsp;<span class="ident" id="4606528">cfg</span><span class="op" id="4606531">.</span><span class="ident" id="4606532">Mode</span><span class="op" id="4606536">&amp;</span><span class="ident" id="4606537">RawFormat</span>&nbsp;<span class="op" id="4606547">==</span>&nbsp;<span class="num" id="4606550">0</span>&nbsp;<span class="op" id="4606552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606556">minwidth</span>&nbsp;<span class="op" id="4606565">:=</span>&nbsp;<span class="ident" id="4606568">cfg</span><span class="op" id="4606571">.</span><span class="ident" id="4606572">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606584">padchar</span>&nbsp;<span class="op" id="4606592">:=</span>&nbsp;<span class="builtintype" id="4606595">byte</span><span class="op" id="4606599">(</span><span class="string" id="4606600">&#39;\t&#39;</span><span class="op" id="4606604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4606608">if</span>&nbsp;<span class="ident" id="4606611">cfg</span><span class="op" id="4606614">.</span><span class="ident" id="4606615">Mode</span><span class="op" id="4606619">&amp;</span><span class="ident" id="4606620">UseSpaces</span>&nbsp;<span class="op" id="4606630">!=</span>&nbsp;<span class="num" id="4606633">0</span>&nbsp;<span class="op" id="4606635">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606640">padchar</span>&nbsp;<span class="op" id="4606648">=</span>&nbsp;<span class="string" id="4606650">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606661">twmode</span>&nbsp;<span class="op" id="4606668">:=</span>&nbsp;<span class="ident" id="4606671">tabwriter</span><span class="op" id="4606680">.</span><span class="ident" id="4606681">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4606703">if</span>&nbsp;<span class="ident" id="4606706">cfg</span><span class="op" id="4606709">.</span><span class="ident" id="4606710">Mode</span><span class="op" id="4606714">&amp;</span><span class="ident" id="4606715">TabIndent</span>&nbsp;<span class="op" id="4606725">!=</span>&nbsp;<span class="num" id="4606728">0</span>&nbsp;<span class="op" id="4606730">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606735">minwidth</span>&nbsp;<span class="op" id="4606744">=</span>&nbsp;<span class="num" id="4606746">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606751">twmode</span>&nbsp;<span class="op" id="4606758">|=</span>&nbsp;<span class="ident" id="4606761">tabwriter</span><span class="op" id="4606770">.</span><span class="ident" id="4606771">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606788">output</span>&nbsp;<span class="op" id="4606795">=</span>&nbsp;<span class="ident" id="4606797">tabwriter</span><span class="op" id="4606806">.</span><span class="ident" id="4606807">NewWriter</span><span class="op" id="4606816">(</span><span class="ident" id="4606817">output</span><span class="op" id="4606823">,</span>&nbsp;<span class="ident" id="4606825">minwidth</span><span class="op" id="4606833">,</span>&nbsp;<span class="ident" id="4606835">cfg</span><span class="op" id="4606838">.</span><span class="ident" id="4606839">Tabwidth</span><span class="op" id="4606847">,</span>&nbsp;<span class="num" id="4606849">1</span><span class="op" id="4606850">,</span>&nbsp;<span class="ident" id="4606852">padchar</span><span class="op" id="4606859">,</span>&nbsp;<span class="ident" id="4606861">twmode</span><span class="op" id="4606867">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606874">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4606931">if</span>&nbsp;<span class="ident" id="4606934">_</span><span class="op" id="4606935">,</span>&nbsp;<span class="ident" id="4606937">err</span>&nbsp;<span class="op" id="4606941">=</span>&nbsp;<span class="ident" id="4606943">output</span><span class="op" id="4606949">.</span><span class="ident" id="4606950">Write</span><span class="op" id="4606955">(</span><span class="ident" id="4606956">p</span><span class="op" id="4606957">.</span><span class="ident" id="4606958">output</span><span class="op" id="4606964">)</span><span class="op" id="4606965">;</span>&nbsp;<span class="ident" id="4606967">err</span>&nbsp;<span class="op" id="4606971">!=</span>&nbsp;<span class="ident" id="4606974">nil</span>&nbsp;<span class="op" id="4606978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4606982">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4606994">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4607022">if</span>&nbsp;<span class="ident" id="4607025">tw</span><span class="op" id="4607027">,</span>&nbsp;<span class="ident" id="4607029">_</span>&nbsp;<span class="op" id="4607031">:=</span>&nbsp;<span class="ident" id="4607034">output</span><span class="op" id="4607040">.</span><span class="op" id="4607041">(</span><span class="op" id="4607042">*</span><span class="ident" id="4607043">tabwriter</span><span class="op" id="4607052">.</span><span class="ident" id="4607053">Writer</span><span class="op" id="4607059">)</span><span class="op" id="4607060">;</span>&nbsp;<span class="ident" id="4607062">tw</span>&nbsp;<span class="op" id="4607065">!=</span>&nbsp;<span class="ident" id="4607068">nil</span>&nbsp;<span class="op" id="4607072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4607076">err</span>&nbsp;<span class="op" id="4607080">=</span>&nbsp;<span class="ident" id="4607082">tw</span><span class="op" id="4607084">.</span><span class="ident" id="4607085">Flush</span><span class="op" id="4607090">(</span><span class="op" id="4607091">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4607094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4607098">return</span><br>
<span class="lineno"></span><span class="op" id="4607105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="4607108">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4607175">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4607241">//</span><br>
<span class="lineno"></span><span class="keyword" id="4607244">type</span>&nbsp;<span class="ident" id="4607249">CommentedNode</span>&nbsp;<span class="keyword" id="4607263">struct</span>&nbsp;<span class="op" id="4607270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4607273">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4607282">interface</span><span class="op" id="4607291">{</span><span class="op" id="4607292">}</span>&nbsp;<span class="comment" id="4607294">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4607354">Comments</span>&nbsp;<span class="op" id="4607363">[</span><span class="op" id="4607364">]</span><span class="op" id="4607365">*</span><span class="ident" id="4607366">ast</span><span class="op" id="4607369">.</span><span class="ident" id="4607370">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="4607383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4607386">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="4607465">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="4607535">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="4607611">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="4607685">//</span><br>
<span class="lineno"></span><span class="keyword" id="4607688">func</span>&nbsp;<span class="op" id="4607693">(</span><span class="ident" id="4607694">cfg</span>&nbsp;<span class="op" id="4607698">*</span><span class="ident" id="4607699">Config</span><span class="op" id="4607705">)</span>&nbsp;<span class="ident" id="4607707">Fprint</span><span class="op" id="4607713">(</span><span class="ident" id="4607714">output</span>&nbsp;<span class="ident" id="4607721">io</span><span class="op" id="4607723">.</span><span class="ident" id="4607724">Writer</span><span class="op" id="4607730">,</span>&nbsp;<span class="ident" id="4607732">fset</span>&nbsp;<span class="op" id="4607737">*</span><span class="ident" id="4607738">token</span><span class="op" id="4607743">.</span><span class="ident" id="4607744">FileSet</span><span class="op" id="4607751">,</span>&nbsp;<span class="ident" id="4607753">node</span>&nbsp;<span class="keyword" id="4607758">interface</span><span class="op" id="4607767">{</span><span class="op" id="4607768">}</span><span class="op" id="4607769">)</span>&nbsp;<span class="builtintype" id="4607771">error</span>&nbsp;<span class="op" id="4607777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4607780">return</span>&nbsp;<span class="ident" id="4607787">cfg</span><span class="op" id="4607790">.</span><span class="ident" id="4607791">fprint</span><span class="op" id="4607797">(</span><span class="ident" id="4607798">output</span><span class="op" id="4607804">,</span>&nbsp;<span class="ident" id="4607806">fset</span><span class="op" id="4607810">,</span>&nbsp;<span class="ident" id="4607812">node</span><span class="op" id="4607816">,</span>&nbsp;<span class="builtinfunc" id="4607818">make</span><span class="op" id="4607822">(</span><span class="keyword" id="4607823">map</span><span class="op" id="4607826">[</span><span class="ident" id="4607827">ast</span><span class="op" id="4607830">.</span><span class="ident" id="4607831">Node</span><span class="op" id="4607835">]</span><span class="builtintype" id="4607836">int</span><span class="op" id="4607839">)</span><span class="op" id="4607840">)</span><br>
<span class="lineno">1285</span><span class="op" id="4607842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4607845">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4607894">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="4607943">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="4607946">func</span>&nbsp;<span class="ident" id="4607951">Fprint</span><span class="op" id="4607957">(</span><span class="ident" id="4607958">output</span>&nbsp;<span class="ident" id="4607965">io</span><span class="op" id="4607967">.</span><span class="ident" id="4607968">Writer</span><span class="op" id="4607974">,</span>&nbsp;<span class="ident" id="4607976">fset</span>&nbsp;<span class="op" id="4607981">*</span><span class="ident" id="4607982">token</span><span class="op" id="4607987">.</span><span class="ident" id="4607988">FileSet</span><span class="op" id="4607995">,</span>&nbsp;<span class="ident" id="4607997">node</span>&nbsp;<span class="keyword" id="4608002">interface</span><span class="op" id="4608011">{</span><span class="op" id="4608012">}</span><span class="op" id="4608013">)</span>&nbsp;<span class="builtintype" id="4608015">error</span>&nbsp;<span class="op" id="4608021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4608024">return</span>&nbsp;<span class="op" id="4608031">(</span><span class="op" id="4608032">&amp;</span><span class="ident" id="4608033">Config</span><span class="op" id="4608039">{</span><span class="ident" id="4608040">Tabwidth</span><span class="op" id="4608048">:</span>&nbsp;<span class="num" id="4608050">8</span><span class="op" id="4608051">}</span><span class="op" id="4608052">)</span><span class="op" id="4608053">.</span><span class="ident" id="4608054">Fprint</span><span class="op" id="4608060">(</span><span class="ident" id="4608061">output</span><span class="op" id="4608067">,</span>&nbsp;<span class="ident" id="4608069">fset</span><span class="op" id="4608073">,</span>&nbsp;<span class="ident" id="4608075">node</span><span class="op" id="4608079">)</span><br>
<span class="lineno"></span><span class="op" id="4608081">}</span>
</div>
</body>
</html>
