<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6581442">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6581497">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6581551">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6581602">package</span>&nbsp;<span class="ident" id="6581610">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6581615">import</span>&nbsp;<span class="op" id="6581622">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581625">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581634">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581650">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581669">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581683">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581699">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581715">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581725">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581732">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581738">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581750">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581757">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581763">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581774">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581791">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581802">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6581813">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6581820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6581823">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6581901">type</span>&nbsp;<span class="ident" id="6581906">zeroSource</span>&nbsp;<span class="keyword" id="6581917">struct</span><span class="op" id="6581923">{</span><span class="op" id="6581924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6581927">func</span>&nbsp;<span class="op" id="6581932">(</span><span class="ident" id="6581933">zeroSource</span><span class="op" id="6581943">)</span>&nbsp;<span class="ident" id="6581945">Read</span><span class="op" id="6581949">(</span><span class="ident" id="6581950">b</span>&nbsp;<span class="op" id="6581952">[</span><span class="op" id="6581953">]</span><span class="builtintype" id="6581954">byte</span><span class="op" id="6581958">)</span>&nbsp;<span class="op" id="6581960">(</span><span class="ident" id="6581961">n</span>&nbsp;<span class="builtintype" id="6581963">int</span><span class="op" id="6581966">,</span>&nbsp;<span class="ident" id="6581968">err</span>&nbsp;<span class="builtintype" id="6581972">error</span><span class="op" id="6581977">)</span>&nbsp;<span class="op" id="6581979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581982">for</span>&nbsp;<span class="ident" id="6581986">i</span>&nbsp;<span class="op" id="6581988">:=</span>&nbsp;<span class="keyword" id="6581991">range</span>&nbsp;<span class="ident" id="6581997">b</span>&nbsp;<span class="op" id="6581999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582003">b</span><span class="op" id="6582004">[</span><span class="ident" id="6582005">i</span><span class="op" id="6582006">]</span>&nbsp;<span class="op" id="6582008">=</span>&nbsp;<span class="num" id="6582010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6582013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6582017">return</span>&nbsp;<span class="builtinfunc" id="6582024">len</span><span class="op" id="6582027">(</span><span class="ident" id="6582028">b</span><span class="op" id="6582029">)</span><span class="op" id="6582030">,</span>&nbsp;<span class="builtintype" id="6582032">nil</span><br>
<span class="lineno"></span><span class="op" id="6582036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6582039">var</span>&nbsp;<span class="ident" id="6582043">testConfig</span>&nbsp;<span class="op" id="6582054">*</span><span class="ident" id="6582055">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6582063">func</span>&nbsp;<span class="ident" id="6582068">init</span><span class="op" id="6582072">(</span><span class="op" id="6582073">)</span>&nbsp;<span class="op" id="6582075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582078">testConfig</span>&nbsp;<span class="op" id="6582089">=</span>&nbsp;<span class="op" id="6582091">&amp;</span><span class="ident" id="6582092">Config</span><span class="op" id="6582098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582102">Time</span><span class="op" id="6582106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6582122">func</span><span class="op" id="6582126">(</span><span class="op" id="6582127">)</span>&nbsp;<span class="ident" id="6582129">time</span><span class="op" id="6582133">.</span><span class="ident" id="6582134">Time</span>&nbsp;<span class="op" id="6582139">{</span>&nbsp;<span class="keyword" id="6582141">return</span>&nbsp;<span class="ident" id="6582148">time</span><span class="op" id="6582152">.</span><span class="ident" id="6582153">Unix</span><span class="op" id="6582157">(</span><span class="num" id="6582158">0</span><span class="op" id="6582159">,</span>&nbsp;<span class="num" id="6582161">0</span><span class="op" id="6582162">)</span>&nbsp;<span class="op" id="6582164">}</span><span class="op" id="6582165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582169">Rand</span><span class="op" id="6582173">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582189">zeroSource</span><span class="op" id="6582199">{</span><span class="op" id="6582200">}</span><span class="op" id="6582201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582205">Certificates</span><span class="op" id="6582217">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6582225">make</span><span class="op" id="6582229">(</span><span class="op" id="6582230">[</span><span class="op" id="6582231">]</span><span class="ident" id="6582232">Certificate</span><span class="op" id="6582243">,</span>&nbsp;<span class="num" id="6582245">2</span><span class="op" id="6582246">)</span><span class="op" id="6582247">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582251">InsecureSkipVerify</span><span class="op" id="6582269">:</span>&nbsp;<span class="builtintype" id="6582271">true</span><span class="op" id="6582275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582279">MinVersion</span><span class="op" id="6582289">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582299">VersionSSL30</span><span class="op" id="6582311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582315">MaxVersion</span><span class="op" id="6582325">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582335">VersionTLS12</span><span class="op" id="6582347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6582350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582353">testConfig</span><span class="op" id="6582363">.</span><span class="ident" id="6582364">Certificates</span><span class="op" id="6582376">[</span><span class="num" id="6582377">0</span><span class="op" id="6582378">]</span><span class="op" id="6582379">.</span><span class="ident" id="6582380">Certificate</span>&nbsp;<span class="op" id="6582392">=</span>&nbsp;<span class="op" id="6582394">[</span><span class="op" id="6582395">]</span><span class="op" id="6582396">[</span><span class="op" id="6582397">]</span><span class="builtintype" id="6582398">byte</span><span class="op" id="6582402">{</span><span class="ident" id="6582403">testRSACertificate</span><span class="op" id="6582421">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582424">testConfig</span><span class="op" id="6582434">.</span><span class="ident" id="6582435">Certificates</span><span class="op" id="6582447">[</span><span class="num" id="6582448">0</span><span class="op" id="6582449">]</span><span class="op" id="6582450">.</span><span class="ident" id="6582451">PrivateKey</span>&nbsp;<span class="op" id="6582462">=</span>&nbsp;<span class="ident" id="6582464">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582483">testConfig</span><span class="op" id="6582493">.</span><span class="ident" id="6582494">Certificates</span><span class="op" id="6582506">[</span><span class="num" id="6582507">1</span><span class="op" id="6582508">]</span><span class="op" id="6582509">.</span><span class="ident" id="6582510">Certificate</span>&nbsp;<span class="op" id="6582522">=</span>&nbsp;<span class="op" id="6582524">[</span><span class="op" id="6582525">]</span><span class="op" id="6582526">[</span><span class="op" id="6582527">]</span><span class="builtintype" id="6582528">byte</span><span class="op" id="6582532">{</span><span class="ident" id="6582533">testSNICertificate</span><span class="op" id="6582551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582554">testConfig</span><span class="op" id="6582564">.</span><span class="ident" id="6582565">Certificates</span><span class="op" id="6582577">[</span><span class="num" id="6582578">1</span><span class="op" id="6582579">]</span><span class="op" id="6582580">.</span><span class="ident" id="6582581">PrivateKey</span>&nbsp;<span class="op" id="6582592">=</span>&nbsp;<span class="ident" id="6582594">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582613">testConfig</span><span class="op" id="6582623">.</span><span class="ident" id="6582624">BuildNameToCertificate</span><span class="op" id="6582646">(</span><span class="op" id="6582647">)</span><br>
<span class="lineno"></span><span class="op" id="6582649">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6582652">func</span>&nbsp;<span class="ident" id="6582657">testClientHelloFailure</span><span class="op" id="6582679">(</span><span class="ident" id="6582680">t</span>&nbsp;<span class="op" id="6582682">*</span><span class="ident" id="6582683">testing</span><span class="op" id="6582690">.</span><span class="ident" id="6582691">T</span><span class="op" id="6582692">,</span>&nbsp;<span class="ident" id="6582694">m</span>&nbsp;<span class="ident" id="6582696">handshakeMessage</span><span class="op" id="6582712">,</span>&nbsp;<span class="ident" id="6582714">expectedSubStr</span>&nbsp;<span class="builtintype" id="6582729">string</span><span class="op" id="6582735">)</span>&nbsp;<span class="op" id="6582737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6582740">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6582781">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6582824">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582844">c</span><span class="op" id="6582845">,</span>&nbsp;<span class="ident" id="6582847">s</span>&nbsp;<span class="op" id="6582849">:=</span>&nbsp;<span class="ident" id="6582852">net</span><span class="op" id="6582855">.</span><span class="ident" id="6582856">Pipe</span><span class="op" id="6582860">(</span><span class="op" id="6582861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6582864">go</span>&nbsp;<span class="keyword" id="6582867">func</span><span class="op" id="6582871">(</span><span class="op" id="6582872">)</span>&nbsp;<span class="op" id="6582874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582878">cli</span>&nbsp;<span class="op" id="6582882">:=</span>&nbsp;<span class="ident" id="6582885">Client</span><span class="op" id="6582891">(</span><span class="ident" id="6582892">c</span><span class="op" id="6582893">,</span>&nbsp;<span class="ident" id="6582895">testConfig</span><span class="op" id="6582905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6582909">if</span>&nbsp;<span class="ident" id="6582912">ch</span><span class="op" id="6582914">,</span>&nbsp;<span class="ident" id="6582916">ok</span>&nbsp;<span class="op" id="6582919">:=</span>&nbsp;<span class="ident" id="6582922">m</span><span class="op" id="6582923">.</span><span class="op" id="6582924">(</span><span class="op" id="6582925">*</span><span class="ident" id="6582926">clientHelloMsg</span><span class="op" id="6582940">)</span><span class="op" id="6582941">;</span>&nbsp;<span class="ident" id="6582943">ok</span>&nbsp;<span class="op" id="6582946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582951">cli</span><span class="op" id="6582954">.</span><span class="ident" id="6582955">vers</span>&nbsp;<span class="op" id="6582960">=</span>&nbsp;<span class="ident" id="6582962">ch</span><span class="op" id="6582964">.</span><span class="ident" id="6582965">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6582972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6582976">cli</span><span class="op" id="6582979">.</span><span class="ident" id="6582980">writeRecord</span><span class="op" id="6582991">(</span><span class="ident" id="6582992">recordTypeHandshake</span><span class="op" id="6583011">,</span>&nbsp;<span class="ident" id="6583013">m</span><span class="op" id="6583014">.</span><span class="ident" id="6583015">marshal</span><span class="op" id="6583022">(</span><span class="op" id="6583023">)</span><span class="op" id="6583024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583028">c</span><span class="op" id="6583029">.</span><span class="ident" id="6583030">Close</span><span class="op" id="6583035">(</span><span class="op" id="6583036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6583039">}</span><span class="op" id="6583040">(</span><span class="op" id="6583041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583044">err</span>&nbsp;<span class="op" id="6583048">:=</span>&nbsp;<span class="ident" id="6583051">Server</span><span class="op" id="6583057">(</span><span class="ident" id="6583058">s</span><span class="op" id="6583059">,</span>&nbsp;<span class="ident" id="6583061">testConfig</span><span class="op" id="6583071">)</span><span class="op" id="6583072">.</span><span class="ident" id="6583073">Handshake</span><span class="op" id="6583082">(</span><span class="op" id="6583083">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583086">s</span><span class="op" id="6583087">.</span><span class="ident" id="6583088">Close</span><span class="op" id="6583093">(</span><span class="op" id="6583094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6583097">if</span>&nbsp;<span class="ident" id="6583100">err</span>&nbsp;<span class="op" id="6583104">==</span>&nbsp;<span class="builtintype" id="6583107">nil</span>&nbsp;<span class="op" id="6583111">||</span>&nbsp;<span class="op" id="6583114">!</span><span class="ident" id="6583115">strings</span><span class="op" id="6583122">.</span><span class="ident" id="6583123">Contains</span><span class="op" id="6583131">(</span><span class="ident" id="6583132">err</span><span class="op" id="6583135">.</span><span class="ident" id="6583136">Error</span><span class="op" id="6583141">(</span><span class="op" id="6583142">)</span><span class="op" id="6583143">,</span>&nbsp;<span class="ident" id="6583145">expectedSubStr</span><span class="op" id="6583159">)</span>&nbsp;<span class="op" id="6583161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583165">t</span><span class="op" id="6583166">.</span><span class="ident" id="6583167">Errorf</span><span class="op" id="6583173">(</span><span class="string" id="6583174">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6583223">,</span>&nbsp;<span class="ident" id="6583225">err</span><span class="op" id="6583228">,</span>&nbsp;<span class="ident" id="6583230">expectedSubStr</span><span class="op" id="6583244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6583247">}</span><br>
<span class="lineno"></span><span class="op" id="6583249">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="6583252">func</span>&nbsp;<span class="ident" id="6583257">TestSimpleError</span><span class="op" id="6583272">(</span><span class="ident" id="6583273">t</span>&nbsp;<span class="op" id="6583275">*</span><span class="ident" id="6583276">testing</span><span class="op" id="6583283">.</span><span class="ident" id="6583284">T</span><span class="op" id="6583285">)</span>&nbsp;<span class="op" id="6583287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583290">testClientHelloFailure</span><span class="op" id="6583312">(</span><span class="ident" id="6583313">t</span><span class="op" id="6583314">,</span>&nbsp;<span class="op" id="6583316">&amp;</span><span class="ident" id="6583317">serverHelloDoneMsg</span><span class="op" id="6583335">{</span><span class="op" id="6583336">}</span><span class="op" id="6583337">,</span>&nbsp;<span class="string" id="6583339">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="6583369">)</span><br>
<span class="lineno"></span><span class="op" id="6583371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6583374">var</span>&nbsp;<span class="ident" id="6583378">badProtocolVersions</span>&nbsp;<span class="op" id="6583398">=</span>&nbsp;<span class="op" id="6583400">[</span><span class="op" id="6583401">]</span><span class="builtintype" id="6583402">uint16</span><span class="op" id="6583408">{</span><span class="num" id="6583409">0x0000</span><span class="op" id="6583415">,</span>&nbsp;<span class="num" id="6583417">0x0005</span><span class="op" id="6583423">,</span>&nbsp;<span class="num" id="6583425">0x0100</span><span class="op" id="6583431">,</span>&nbsp;<span class="num" id="6583433">0x0105</span><span class="op" id="6583439">,</span>&nbsp;<span class="num" id="6583441">0x0200</span><span class="op" id="6583447">,</span>&nbsp;<span class="num" id="6583449">0x0205</span><span class="op" id="6583455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6583458">func</span>&nbsp;<span class="ident" id="6583463">TestRejectBadProtocolVersion</span><span class="op" id="6583491">(</span><span class="ident" id="6583492">t</span>&nbsp;<span class="op" id="6583494">*</span><span class="ident" id="6583495">testing</span><span class="op" id="6583502">.</span><span class="ident" id="6583503">T</span><span class="op" id="6583504">)</span>&nbsp;<span class="op" id="6583506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6583509">for</span>&nbsp;<span class="ident" id="6583513">_</span><span class="op" id="6583514">,</span>&nbsp;<span class="ident" id="6583516">v</span>&nbsp;<span class="op" id="6583518">:=</span>&nbsp;<span class="keyword" id="6583521">range</span>&nbsp;<span class="ident" id="6583527">badProtocolVersions</span>&nbsp;<span class="op" id="6583547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583551">testClientHelloFailure</span><span class="op" id="6583573">(</span><span class="ident" id="6583574">t</span><span class="op" id="6583575">,</span>&nbsp;<span class="op" id="6583577">&amp;</span><span class="ident" id="6583578">clientHelloMsg</span><span class="op" id="6583592">{</span><span class="ident" id="6583593">vers</span><span class="op" id="6583597">:</span>&nbsp;<span class="ident" id="6583599">v</span><span class="op" id="6583600">}</span><span class="op" id="6583601">,</span>&nbsp;<span class="string" id="6583603">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="6583642">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6583645">}</span><br>
<span class="lineno"></span><span class="op" id="6583647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6583650">func</span>&nbsp;<span class="ident" id="6583655">TestNoSuiteOverlap</span><span class="op" id="6583673">(</span><span class="ident" id="6583674">t</span>&nbsp;<span class="op" id="6583676">*</span><span class="ident" id="6583677">testing</span><span class="op" id="6583684">.</span><span class="ident" id="6583685">T</span><span class="op" id="6583686">)</span>&nbsp;<span class="op" id="6583688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583691">clientHello</span>&nbsp;<span class="op" id="6583703">:=</span>&nbsp;<span class="op" id="6583706">&amp;</span><span class="ident" id="6583707">clientHelloMsg</span><span class="op" id="6583721">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583725">vers</span><span class="op" id="6583729">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6583745">0x0301</span><span class="op" id="6583751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583755">cipherSuites</span><span class="op" id="6583767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6583775">[</span><span class="op" id="6583776">]</span><span class="builtintype" id="6583777">uint16</span><span class="op" id="6583783">{</span><span class="num" id="6583784">0xff00</span><span class="op" id="6583790">}</span><span class="op" id="6583791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583795">compressionMethods</span><span class="op" id="6583813">:</span>&nbsp;<span class="op" id="6583815">[</span><span class="op" id="6583816">]</span><span class="builtintype" id="6583817">uint8</span><span class="op" id="6583822">{</span><span class="num" id="6583823">0</span><span class="op" id="6583824">}</span><span class="op" id="6583825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6583828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583831">testClientHelloFailure</span><span class="op" id="6583853">(</span><span class="ident" id="6583854">t</span><span class="op" id="6583855">,</span>&nbsp;<span class="ident" id="6583857">clientHello</span><span class="op" id="6583868">,</span>&nbsp;<span class="string" id="6583870">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="6583923">)</span><br>
<span class="lineno">95</span><span class="op" id="6583925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6583928">func</span>&nbsp;<span class="ident" id="6583933">TestNoCompressionOverlap</span><span class="op" id="6583957">(</span><span class="ident" id="6583958">t</span>&nbsp;<span class="op" id="6583960">*</span><span class="ident" id="6583961">testing</span><span class="op" id="6583968">.</span><span class="ident" id="6583969">T</span><span class="op" id="6583970">)</span>&nbsp;<span class="op" id="6583972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6583975">clientHello</span>&nbsp;<span class="op" id="6583987">:=</span>&nbsp;<span class="op" id="6583990">&amp;</span><span class="ident" id="6583991">clientHelloMsg</span><span class="op" id="6584005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584009">vers</span><span class="op" id="6584013">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6584029">0x0301</span><span class="op" id="6584035">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584039">cipherSuites</span><span class="op" id="6584051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584059">[</span><span class="op" id="6584060">]</span><span class="builtintype" id="6584061">uint16</span><span class="op" id="6584067">{</span><span class="ident" id="6584068">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6584092">}</span><span class="op" id="6584093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584097">compressionMethods</span><span class="op" id="6584115">:</span>&nbsp;<span class="op" id="6584117">[</span><span class="op" id="6584118">]</span><span class="builtintype" id="6584119">uint8</span><span class="op" id="6584124">{</span><span class="num" id="6584125">0xff</span><span class="op" id="6584129">}</span><span class="op" id="6584130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584136">testClientHelloFailure</span><span class="op" id="6584158">(</span><span class="ident" id="6584159">t</span><span class="op" id="6584160">,</span>&nbsp;<span class="ident" id="6584162">clientHello</span><span class="op" id="6584173">,</span>&nbsp;<span class="string" id="6584175">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="6584225">)</span><br>
<span class="lineno"></span><span class="op" id="6584227">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6584230">func</span>&nbsp;<span class="ident" id="6584235">TestTLS12OnlyCipherSuites</span><span class="op" id="6584260">(</span><span class="ident" id="6584261">t</span>&nbsp;<span class="op" id="6584263">*</span><span class="ident" id="6584264">testing</span><span class="op" id="6584271">.</span><span class="ident" id="6584272">T</span><span class="op" id="6584273">)</span>&nbsp;<span class="op" id="6584275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584278">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584349">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6584384">var</span>&nbsp;<span class="ident" id="6584388">zeros</span>&nbsp;<span class="op" id="6584394">[</span><span class="num" id="6584395">32</span><span class="op" id="6584397">]</span><span class="builtintype" id="6584398">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584405">clientHello</span>&nbsp;<span class="op" id="6584417">:=</span>&nbsp;<span class="op" id="6584420">&amp;</span><span class="ident" id="6584421">clientHelloMsg</span><span class="op" id="6584435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584439">vers</span><span class="op" id="6584443">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6584447">VersionTLS11</span><span class="op" id="6584459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584463">random</span><span class="op" id="6584469">:</span>&nbsp;<span class="ident" id="6584471">zeros</span><span class="op" id="6584476">[</span><span class="op" id="6584477">:</span><span class="op" id="6584478">]</span><span class="op" id="6584479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584483">cipherSuites</span><span class="op" id="6584495">:</span>&nbsp;<span class="op" id="6584497">[</span><span class="op" id="6584498">]</span><span class="builtintype" id="6584499">uint16</span><span class="op" id="6584505">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584510">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584562">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584610">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6584662">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584704">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="6584741">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584746">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6584770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584774">}</span><span class="op" id="6584775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584779">compressionMethods</span><span class="op" id="6584797">:</span>&nbsp;<span class="op" id="6584799">[</span><span class="op" id="6584800">]</span><span class="builtintype" id="6584801">uint8</span><span class="op" id="6584806">{</span><span class="ident" id="6584807">compressionNone</span><span class="op" id="6584822">}</span><span class="op" id="6584823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584827">supportedCurves</span><span class="op" id="6584842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584847">[</span><span class="op" id="6584848">]</span><span class="ident" id="6584849">CurveID</span><span class="op" id="6584856">{</span><span class="ident" id="6584857">CurveP256</span><span class="op" id="6584866">,</span>&nbsp;<span class="ident" id="6584868">CurveP384</span><span class="op" id="6584877">,</span>&nbsp;<span class="ident" id="6584879">CurveP521</span><span class="op" id="6584888">}</span><span class="op" id="6584889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584893">supportedPoints</span><span class="op" id="6584908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584913">[</span><span class="op" id="6584914">]</span><span class="builtintype" id="6584915">uint8</span><span class="op" id="6584920">{</span><span class="ident" id="6584921">pointFormatUncompressed</span><span class="op" id="6584944">}</span><span class="op" id="6584945">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6584948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6584952">c</span><span class="op" id="6584953">,</span>&nbsp;<span class="ident" id="6584955">s</span>&nbsp;<span class="op" id="6584957">:=</span>&nbsp;<span class="ident" id="6584960">net</span><span class="op" id="6584963">.</span><span class="ident" id="6584964">Pipe</span><span class="op" id="6584968">(</span><span class="op" id="6584969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6584972">var</span>&nbsp;<span class="ident" id="6584976">reply</span>&nbsp;<span class="keyword" id="6584982">interface</span><span class="op" id="6584991">{</span><span class="op" id="6584992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6584995">var</span>&nbsp;<span class="ident" id="6584999">clientErr</span>&nbsp;<span class="builtintype" id="6585009">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585016">go</span>&nbsp;<span class="keyword" id="6585019">func</span><span class="op" id="6585023">(</span><span class="op" id="6585024">)</span>&nbsp;<span class="op" id="6585026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585030">cli</span>&nbsp;<span class="op" id="6585034">:=</span>&nbsp;<span class="ident" id="6585037">Client</span><span class="op" id="6585043">(</span><span class="ident" id="6585044">c</span><span class="op" id="6585045">,</span>&nbsp;<span class="ident" id="6585047">testConfig</span><span class="op" id="6585057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585061">cli</span><span class="op" id="6585064">.</span><span class="ident" id="6585065">vers</span>&nbsp;<span class="op" id="6585070">=</span>&nbsp;<span class="ident" id="6585072">clientHello</span><span class="op" id="6585083">.</span><span class="ident" id="6585084">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585091">cli</span><span class="op" id="6585094">.</span><span class="ident" id="6585095">writeRecord</span><span class="op" id="6585106">(</span><span class="ident" id="6585107">recordTypeHandshake</span><span class="op" id="6585126">,</span>&nbsp;<span class="ident" id="6585128">clientHello</span><span class="op" id="6585139">.</span><span class="ident" id="6585140">marshal</span><span class="op" id="6585147">(</span><span class="op" id="6585148">)</span><span class="op" id="6585149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585153">reply</span><span class="op" id="6585158">,</span>&nbsp;<span class="ident" id="6585160">clientErr</span>&nbsp;<span class="op" id="6585170">=</span>&nbsp;<span class="ident" id="6585172">cli</span><span class="op" id="6585175">.</span><span class="ident" id="6585176">readHandshake</span><span class="op" id="6585189">(</span><span class="op" id="6585190">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585194">c</span><span class="op" id="6585195">.</span><span class="ident" id="6585196">Close</span><span class="op" id="6585201">(</span><span class="op" id="6585202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585205">}</span><span class="op" id="6585206">(</span><span class="op" id="6585207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585210">config</span>&nbsp;<span class="op" id="6585217">:=</span>&nbsp;<span class="op" id="6585220">*</span><span class="ident" id="6585221">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585233">config</span><span class="op" id="6585239">.</span><span class="ident" id="6585240">CipherSuites</span>&nbsp;<span class="op" id="6585253">=</span>&nbsp;<span class="ident" id="6585255">clientHello</span><span class="op" id="6585266">.</span><span class="ident" id="6585267">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585281">Server</span><span class="op" id="6585287">(</span><span class="ident" id="6585288">s</span><span class="op" id="6585289">,</span>&nbsp;<span class="op" id="6585291">&amp;</span><span class="ident" id="6585292">config</span><span class="op" id="6585298">)</span><span class="op" id="6585299">.</span><span class="ident" id="6585300">Handshake</span><span class="op" id="6585309">(</span><span class="op" id="6585310">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585313">s</span><span class="op" id="6585314">.</span><span class="ident" id="6585315">Close</span><span class="op" id="6585320">(</span><span class="op" id="6585321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585324">if</span>&nbsp;<span class="ident" id="6585327">clientErr</span>&nbsp;<span class="op" id="6585337">!=</span>&nbsp;<span class="builtintype" id="6585340">nil</span>&nbsp;<span class="op" id="6585344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585348">t</span><span class="op" id="6585349">.</span><span class="ident" id="6585350">Fatal</span><span class="op" id="6585355">(</span><span class="ident" id="6585356">clientErr</span><span class="op" id="6585365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585371">serverHello</span><span class="op" id="6585382">,</span>&nbsp;<span class="ident" id="6585384">ok</span>&nbsp;<span class="op" id="6585387">:=</span>&nbsp;<span class="ident" id="6585390">reply</span><span class="op" id="6585395">.</span><span class="op" id="6585396">(</span><span class="op" id="6585397">*</span><span class="ident" id="6585398">serverHelloMsg</span><span class="op" id="6585412">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585415">if</span>&nbsp;<span class="op" id="6585418">!</span><span class="ident" id="6585419">ok</span>&nbsp;<span class="op" id="6585422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585426">t</span><span class="op" id="6585427">.</span><span class="ident" id="6585428">Fatalf</span><span class="op" id="6585434">(</span><span class="string" id="6585435">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="6585486">,</span>&nbsp;<span class="ident" id="6585488">reply</span><span class="op" id="6585493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585499">if</span>&nbsp;<span class="ident" id="6585502">s</span>&nbsp;<span class="op" id="6585504">:=</span>&nbsp;<span class="ident" id="6585507">serverHello</span><span class="op" id="6585518">.</span><span class="ident" id="6585519">cipherSuite</span><span class="op" id="6585530">;</span>&nbsp;<span class="ident" id="6585532">s</span>&nbsp;<span class="op" id="6585534">!=</span>&nbsp;<span class="ident" id="6585537">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6585562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585566">t</span><span class="op" id="6585567">.</span><span class="ident" id="6585568">Fatalf</span><span class="op" id="6585574">(</span><span class="string" id="6585575">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="6585609">,</span>&nbsp;<span class="ident" id="6585611">s</span><span class="op" id="6585612">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585615">}</span><br>
<span class="lineno"></span><span class="op" id="6585617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6585620">func</span>&nbsp;<span class="ident" id="6585625">TestAlertForwarding</span><span class="op" id="6585644">(</span><span class="ident" id="6585645">t</span>&nbsp;<span class="op" id="6585647">*</span><span class="ident" id="6585648">testing</span><span class="op" id="6585655">.</span><span class="ident" id="6585656">T</span><span class="op" id="6585657">)</span>&nbsp;<span class="op" id="6585659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585662">c</span><span class="op" id="6585663">,</span>&nbsp;<span class="ident" id="6585665">s</span>&nbsp;<span class="op" id="6585667">:=</span>&nbsp;<span class="ident" id="6585670">net</span><span class="op" id="6585673">.</span><span class="ident" id="6585674">Pipe</span><span class="op" id="6585678">(</span><span class="op" id="6585679">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585682">go</span>&nbsp;<span class="keyword" id="6585685">func</span><span class="op" id="6585689">(</span><span class="op" id="6585690">)</span>&nbsp;<span class="op" id="6585692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585696">Client</span><span class="op" id="6585702">(</span><span class="ident" id="6585703">c</span><span class="op" id="6585704">,</span>&nbsp;<span class="ident" id="6585706">testConfig</span><span class="op" id="6585716">)</span><span class="op" id="6585717">.</span><span class="ident" id="6585718">sendAlert</span><span class="op" id="6585727">(</span><span class="ident" id="6585728">alertUnknownCA</span><span class="op" id="6585742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585746">c</span><span class="op" id="6585747">.</span><span class="ident" id="6585748">Close</span><span class="op" id="6585753">(</span><span class="op" id="6585754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585757">}</span><span class="op" id="6585758">(</span><span class="op" id="6585759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585763">err</span>&nbsp;<span class="op" id="6585767">:=</span>&nbsp;<span class="ident" id="6585770">Server</span><span class="op" id="6585776">(</span><span class="ident" id="6585777">s</span><span class="op" id="6585778">,</span>&nbsp;<span class="ident" id="6585780">testConfig</span><span class="op" id="6585790">)</span><span class="op" id="6585791">.</span><span class="ident" id="6585792">Handshake</span><span class="op" id="6585801">(</span><span class="op" id="6585802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585805">s</span><span class="op" id="6585806">.</span><span class="ident" id="6585807">Close</span><span class="op" id="6585812">(</span><span class="op" id="6585813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6585816">if</span>&nbsp;<span class="ident" id="6585819">e</span><span class="op" id="6585820">,</span>&nbsp;<span class="ident" id="6585822">ok</span>&nbsp;<span class="op" id="6585825">:=</span>&nbsp;<span class="ident" id="6585828">err</span><span class="op" id="6585831">.</span><span class="op" id="6585832">(</span><span class="op" id="6585833">*</span><span class="ident" id="6585834">net</span><span class="op" id="6585837">.</span><span class="ident" id="6585838">OpError</span><span class="op" id="6585845">)</span><span class="op" id="6585846">;</span>&nbsp;<span class="op" id="6585848">!</span><span class="ident" id="6585849">ok</span>&nbsp;<span class="op" id="6585852">||</span>&nbsp;<span class="ident" id="6585855">e</span><span class="op" id="6585856">.</span><span class="ident" id="6585857">Err</span>&nbsp;<span class="op" id="6585861">!=</span>&nbsp;<span class="builtintype" id="6585864">error</span><span class="op" id="6585869">(</span><span class="ident" id="6585870">alertUnknownCA</span><span class="op" id="6585884">)</span>&nbsp;<span class="op" id="6585886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585890">t</span><span class="op" id="6585891">.</span><span class="ident" id="6585892">Errorf</span><span class="op" id="6585898">(</span><span class="string" id="6585899">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6585928">,</span>&nbsp;<span class="ident" id="6585930">err</span><span class="op" id="6585933">,</span>&nbsp;<span class="builtintype" id="6585935">error</span><span class="op" id="6585940">(</span><span class="ident" id="6585941">alertUnknownCA</span><span class="op" id="6585955">)</span><span class="op" id="6585956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6585959">}</span><br>
<span class="lineno">165</span><span class="op" id="6585961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6585964">func</span>&nbsp;<span class="ident" id="6585969">TestClose</span><span class="op" id="6585978">(</span><span class="ident" id="6585979">t</span>&nbsp;<span class="op" id="6585981">*</span><span class="ident" id="6585982">testing</span><span class="op" id="6585989">.</span><span class="ident" id="6585990">T</span><span class="op" id="6585991">)</span>&nbsp;<span class="op" id="6585993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6585996">c</span><span class="op" id="6585997">,</span>&nbsp;<span class="ident" id="6585999">s</span>&nbsp;<span class="op" id="6586001">:=</span>&nbsp;<span class="ident" id="6586004">net</span><span class="op" id="6586007">.</span><span class="ident" id="6586008">Pipe</span><span class="op" id="6586012">(</span><span class="op" id="6586013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586016">go</span>&nbsp;<span class="ident" id="6586019">c</span><span class="op" id="6586020">.</span><span class="ident" id="6586021">Close</span><span class="op" id="6586026">(</span><span class="op" id="6586027">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586031">err</span>&nbsp;<span class="op" id="6586035">:=</span>&nbsp;<span class="ident" id="6586038">Server</span><span class="op" id="6586044">(</span><span class="ident" id="6586045">s</span><span class="op" id="6586046">,</span>&nbsp;<span class="ident" id="6586048">testConfig</span><span class="op" id="6586058">)</span><span class="op" id="6586059">.</span><span class="ident" id="6586060">Handshake</span><span class="op" id="6586069">(</span><span class="op" id="6586070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586073">s</span><span class="op" id="6586074">.</span><span class="ident" id="6586075">Close</span><span class="op" id="6586080">(</span><span class="op" id="6586081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586084">if</span>&nbsp;<span class="ident" id="6586087">err</span>&nbsp;<span class="op" id="6586091">!=</span>&nbsp;<span class="ident" id="6586094">io</span><span class="op" id="6586096">.</span><span class="ident" id="6586097">EOF</span>&nbsp;<span class="op" id="6586101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586105">t</span><span class="op" id="6586106">.</span><span class="ident" id="6586107">Errorf</span><span class="op" id="6586113">(</span><span class="string" id="6586114">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6586143">,</span>&nbsp;<span class="ident" id="6586145">err</span><span class="op" id="6586148">,</span>&nbsp;<span class="ident" id="6586150">io</span><span class="op" id="6586152">.</span><span class="ident" id="6586153">EOF</span><span class="op" id="6586156">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586159">}</span><br>
<span class="lineno"></span><span class="op" id="6586161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586164">func</span>&nbsp;<span class="ident" id="6586169">testHandshake</span><span class="op" id="6586182">(</span><span class="ident" id="6586183">clientConfig</span><span class="op" id="6586195">,</span>&nbsp;<span class="ident" id="6586197">serverConfig</span>&nbsp;<span class="op" id="6586210">*</span><span class="ident" id="6586211">Config</span><span class="op" id="6586217">)</span>&nbsp;<span class="op" id="6586219">(</span><span class="ident" id="6586220">state</span>&nbsp;<span class="ident" id="6586226">ConnectionState</span><span class="op" id="6586241">,</span>&nbsp;<span class="ident" id="6586243">err</span>&nbsp;<span class="builtintype" id="6586247">error</span><span class="op" id="6586252">)</span>&nbsp;<span class="op" id="6586254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586257">c</span><span class="op" id="6586258">,</span>&nbsp;<span class="ident" id="6586260">s</span>&nbsp;<span class="op" id="6586262">:=</span>&nbsp;<span class="ident" id="6586265">net</span><span class="op" id="6586268">.</span><span class="ident" id="6586269">Pipe</span><span class="op" id="6586273">(</span><span class="op" id="6586274">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586277">done</span>&nbsp;<span class="op" id="6586282">:=</span>&nbsp;<span class="builtinfunc" id="6586285">make</span><span class="op" id="6586289">(</span><span class="keyword" id="6586290">chan</span>&nbsp;<span class="builtintype" id="6586295">bool</span><span class="op" id="6586299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586302">go</span>&nbsp;<span class="keyword" id="6586305">func</span><span class="op" id="6586309">(</span><span class="op" id="6586310">)</span>&nbsp;<span class="op" id="6586312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586316">cli</span>&nbsp;<span class="op" id="6586320">:=</span>&nbsp;<span class="ident" id="6586323">Client</span><span class="op" id="6586329">(</span><span class="ident" id="6586330">c</span><span class="op" id="6586331">,</span>&nbsp;<span class="ident" id="6586333">clientConfig</span><span class="op" id="6586345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586349">cli</span><span class="op" id="6586352">.</span><span class="ident" id="6586353">Handshake</span><span class="op" id="6586362">(</span><span class="op" id="6586363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586367">c</span><span class="op" id="6586368">.</span><span class="ident" id="6586369">Close</span><span class="op" id="6586374">(</span><span class="op" id="6586375">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586379">done</span>&nbsp;<span class="op" id="6586384">&lt;-</span>&nbsp;<span class="builtintype" id="6586387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586393">}</span><span class="op" id="6586394">(</span><span class="op" id="6586395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586398">server</span>&nbsp;<span class="op" id="6586405">:=</span>&nbsp;<span class="ident" id="6586408">Server</span><span class="op" id="6586414">(</span><span class="ident" id="6586415">s</span><span class="op" id="6586416">,</span>&nbsp;<span class="ident" id="6586418">serverConfig</span><span class="op" id="6586430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586433">err</span>&nbsp;<span class="op" id="6586437">=</span>&nbsp;<span class="ident" id="6586439">server</span><span class="op" id="6586445">.</span><span class="ident" id="6586446">Handshake</span><span class="op" id="6586455">(</span><span class="op" id="6586456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586459">if</span>&nbsp;<span class="ident" id="6586462">err</span>&nbsp;<span class="op" id="6586466">==</span>&nbsp;<span class="builtintype" id="6586469">nil</span>&nbsp;<span class="op" id="6586473">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586477">state</span>&nbsp;<span class="op" id="6586483">=</span>&nbsp;<span class="ident" id="6586485">server</span><span class="op" id="6586491">.</span><span class="ident" id="6586492">ConnectionState</span><span class="op" id="6586507">(</span><span class="op" id="6586508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586514">s</span><span class="op" id="6586515">.</span><span class="ident" id="6586516">Close</span><span class="op" id="6586521">(</span><span class="op" id="6586522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586525">&lt;-</span><span class="ident" id="6586527">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586533">return</span><br>
<span class="lineno">195</span><span class="op" id="6586540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586543">func</span>&nbsp;<span class="ident" id="6586548">TestVersion</span><span class="op" id="6586559">(</span><span class="ident" id="6586560">t</span>&nbsp;<span class="op" id="6586562">*</span><span class="ident" id="6586563">testing</span><span class="op" id="6586570">.</span><span class="ident" id="6586571">T</span><span class="op" id="6586572">)</span>&nbsp;<span class="op" id="6586574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586577">serverConfig</span>&nbsp;<span class="op" id="6586590">:=</span>&nbsp;<span class="op" id="6586593">&amp;</span><span class="ident" id="6586594">Config</span><span class="op" id="6586600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586604">Certificates</span><span class="op" id="6586616">:</span>&nbsp;<span class="ident" id="6586618">testConfig</span><span class="op" id="6586628">.</span><span class="ident" id="6586629">Certificates</span><span class="op" id="6586641">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586645">MaxVersion</span><span class="op" id="6586655">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6586659">VersionTLS11</span><span class="op" id="6586671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586677">clientConfig</span>&nbsp;<span class="op" id="6586690">:=</span>&nbsp;<span class="op" id="6586693">&amp;</span><span class="ident" id="6586694">Config</span><span class="op" id="6586700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586704">InsecureSkipVerify</span><span class="op" id="6586722">:</span>&nbsp;<span class="builtintype" id="6586724">true</span><span class="op" id="6586728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586731">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586734">state</span><span class="op" id="6586739">,</span>&nbsp;<span class="ident" id="6586741">err</span>&nbsp;<span class="op" id="6586745">:=</span>&nbsp;<span class="ident" id="6586748">testHandshake</span><span class="op" id="6586761">(</span><span class="ident" id="6586762">clientConfig</span><span class="op" id="6586774">,</span>&nbsp;<span class="ident" id="6586776">serverConfig</span><span class="op" id="6586788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586791">if</span>&nbsp;<span class="ident" id="6586794">err</span>&nbsp;<span class="op" id="6586798">!=</span>&nbsp;<span class="builtintype" id="6586801">nil</span>&nbsp;<span class="op" id="6586805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586809">t</span><span class="op" id="6586810">.</span><span class="ident" id="6586811">Fatalf</span><span class="op" id="6586817">(</span><span class="string" id="6586818">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6586840">,</span>&nbsp;<span class="ident" id="6586842">err</span><span class="op" id="6586845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6586851">if</span>&nbsp;<span class="ident" id="6586854">state</span><span class="op" id="6586859">.</span><span class="ident" id="6586860">Version</span>&nbsp;<span class="op" id="6586868">!=</span>&nbsp;<span class="ident" id="6586871">VersionTLS11</span>&nbsp;<span class="op" id="6586884">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6586888">t</span><span class="op" id="6586889">.</span><span class="ident" id="6586890">Fatalf</span><span class="op" id="6586896">(</span><span class="string" id="6586897">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="6586933">,</span>&nbsp;<span class="ident" id="6586935">state</span><span class="op" id="6586940">.</span><span class="ident" id="6586941">Version</span><span class="op" id="6586948">,</span>&nbsp;<span class="ident" id="6586950">VersionTLS11</span><span class="op" id="6586962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586965">}</span><br>
<span class="lineno"></span><span class="op" id="6586967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586970">func</span>&nbsp;<span class="ident" id="6586975">TestCipherSuitePreference</span><span class="op" id="6587000">(</span><span class="ident" id="6587001">t</span>&nbsp;<span class="op" id="6587003">*</span><span class="ident" id="6587004">testing</span><span class="op" id="6587011">.</span><span class="ident" id="6587012">T</span><span class="op" id="6587013">)</span>&nbsp;<span class="op" id="6587015">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587018">serverConfig</span>&nbsp;<span class="op" id="6587031">:=</span>&nbsp;<span class="op" id="6587034">&amp;</span><span class="ident" id="6587035">Config</span><span class="op" id="6587041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587045">CipherSuites</span><span class="op" id="6587057">:</span>&nbsp;<span class="op" id="6587059">[</span><span class="op" id="6587060">]</span><span class="builtintype" id="6587061">uint16</span><span class="op" id="6587067">{</span><span class="ident" id="6587068">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6587092">,</span>&nbsp;<span class="ident" id="6587094">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6587122">,</span>&nbsp;<span class="ident" id="6587124">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6587154">}</span><span class="op" id="6587155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587159">Certificates</span><span class="op" id="6587171">:</span>&nbsp;<span class="ident" id="6587173">testConfig</span><span class="op" id="6587183">.</span><span class="ident" id="6587184">Certificates</span><span class="op" id="6587196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587200">MaxVersion</span><span class="op" id="6587210">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6587214">VersionTLS11</span><span class="op" id="6587226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587229">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587232">clientConfig</span>&nbsp;<span class="op" id="6587245">:=</span>&nbsp;<span class="op" id="6587248">&amp;</span><span class="ident" id="6587249">Config</span><span class="op" id="6587255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587259">CipherSuites</span><span class="op" id="6587271">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587279">[</span><span class="op" id="6587280">]</span><span class="builtintype" id="6587281">uint16</span><span class="op" id="6587287">{</span><span class="ident" id="6587288">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6587316">,</span>&nbsp;<span class="ident" id="6587318">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6587342">}</span><span class="op" id="6587343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587347">InsecureSkipVerify</span><span class="op" id="6587365">:</span>&nbsp;<span class="builtintype" id="6587367">true</span><span class="op" id="6587371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587377">state</span><span class="op" id="6587382">,</span>&nbsp;<span class="ident" id="6587384">err</span>&nbsp;<span class="op" id="6587388">:=</span>&nbsp;<span class="ident" id="6587391">testHandshake</span><span class="op" id="6587404">(</span><span class="ident" id="6587405">clientConfig</span><span class="op" id="6587417">,</span>&nbsp;<span class="ident" id="6587419">serverConfig</span><span class="op" id="6587431">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6587434">if</span>&nbsp;<span class="ident" id="6587437">err</span>&nbsp;<span class="op" id="6587441">!=</span>&nbsp;<span class="builtintype" id="6587444">nil</span>&nbsp;<span class="op" id="6587448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587452">t</span><span class="op" id="6587453">.</span><span class="ident" id="6587454">Fatalf</span><span class="op" id="6587460">(</span><span class="string" id="6587461">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6587483">,</span>&nbsp;<span class="ident" id="6587485">err</span><span class="op" id="6587488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6587494">if</span>&nbsp;<span class="ident" id="6587497">state</span><span class="op" id="6587502">.</span><span class="ident" id="6587503">CipherSuite</span>&nbsp;<span class="op" id="6587515">!=</span>&nbsp;<span class="ident" id="6587518">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="6587547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6587551">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587614">t</span><span class="op" id="6587615">.</span><span class="ident" id="6587616">Fatalf</span><span class="op" id="6587622">(</span><span class="string" id="6587623">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6587665">,</span>&nbsp;<span class="ident" id="6587667">state</span><span class="op" id="6587672">.</span><span class="ident" id="6587673">CipherSuite</span><span class="op" id="6587684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587691">serverConfig</span><span class="op" id="6587703">.</span><span class="ident" id="6587704">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6587729">=</span>&nbsp;<span class="builtintype" id="6587731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587737">state</span><span class="op" id="6587742">,</span>&nbsp;<span class="ident" id="6587744">err</span>&nbsp;<span class="op" id="6587748">=</span>&nbsp;<span class="ident" id="6587750">testHandshake</span><span class="op" id="6587763">(</span><span class="ident" id="6587764">clientConfig</span><span class="op" id="6587776">,</span>&nbsp;<span class="ident" id="6587778">serverConfig</span><span class="op" id="6587790">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6587793">if</span>&nbsp;<span class="ident" id="6587796">err</span>&nbsp;<span class="op" id="6587800">!=</span>&nbsp;<span class="builtintype" id="6587803">nil</span>&nbsp;<span class="op" id="6587807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587811">t</span><span class="op" id="6587812">.</span><span class="ident" id="6587813">Fatalf</span><span class="op" id="6587819">(</span><span class="string" id="6587820">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6587842">,</span>&nbsp;<span class="ident" id="6587844">err</span><span class="op" id="6587847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6587853">if</span>&nbsp;<span class="ident" id="6587856">state</span><span class="op" id="6587861">.</span><span class="ident" id="6587862">CipherSuite</span>&nbsp;<span class="op" id="6587874">!=</span>&nbsp;<span class="ident" id="6587877">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6587902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6587906">t</span><span class="op" id="6587907">.</span><span class="ident" id="6587908">Fatalf</span><span class="op" id="6587914">(</span><span class="string" id="6587915">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6587957">,</span>&nbsp;<span class="ident" id="6587959">state</span><span class="op" id="6587964">.</span><span class="ident" id="6587965">CipherSuite</span><span class="op" id="6587976">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6587979">}</span><br>
<span class="lineno"></span><span class="op" id="6587981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6587984">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6588059">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6588075">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6588155">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6588174">type</span>&nbsp;<span class="ident" id="6588179">serverTest</span>&nbsp;<span class="keyword" id="6588190">struct</span>&nbsp;<span class="op" id="6588197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588200">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588273">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588314">name</span>&nbsp;<span class="builtintype" id="6588319">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588327">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588393">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588438">command</span>&nbsp;<span class="op" id="6588446">[</span><span class="op" id="6588447">]</span><span class="builtintype" id="6588448">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588456">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588520">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588554">expectedPeerCerts</span>&nbsp;<span class="op" id="6588572">[</span><span class="op" id="6588573">]</span><span class="builtintype" id="6588574">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588582">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588653">config</span>&nbsp;<span class="op" id="6588660">*</span><span class="ident" id="6588661">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588669">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588743">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588781">expectAlert</span>&nbsp;<span class="builtintype" id="6588793">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588799">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588868">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6588940">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="6588970">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6588978">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6589047">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6589120">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589157">validate</span>&nbsp;<span class="keyword" id="6589166">func</span><span class="op" id="6589170">(</span><span class="ident" id="6589171">ConnectionState</span><span class="op" id="6589186">)</span>&nbsp;<span class="builtintype" id="6589188">error</span><br>
<span class="lineno">270</span><span class="op" id="6589194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589197">var</span>&nbsp;<span class="ident" id="6589201">defaultClientCommand</span>&nbsp;<span class="op" id="6589222">=</span>&nbsp;<span class="op" id="6589224">[</span><span class="op" id="6589225">]</span><span class="builtintype" id="6589226">string</span><span class="op" id="6589232">{</span><span class="string" id="6589233">&#34;openssl&#34;</span><span class="op" id="6589242">,</span>&nbsp;<span class="string" id="6589244">&#34;s_client&#34;</span><span class="op" id="6589254">,</span>&nbsp;<span class="string" id="6589256">&#34;-no_ticket&#34;</span><span class="op" id="6589268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6589271">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="6589347">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="6589427">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6589442">func</span>&nbsp;<span class="op" id="6589447">(</span><span class="ident" id="6589448">test</span>&nbsp;<span class="op" id="6589453">*</span><span class="ident" id="6589454">serverTest</span><span class="op" id="6589464">)</span>&nbsp;<span class="ident" id="6589466">connFromCommand</span><span class="op" id="6589481">(</span><span class="op" id="6589482">)</span>&nbsp;<span class="op" id="6589484">(</span><span class="ident" id="6589485">conn</span>&nbsp;<span class="op" id="6589490">*</span><span class="ident" id="6589491">recordingConn</span><span class="op" id="6589504">,</span>&nbsp;<span class="ident" id="6589506">child</span>&nbsp;<span class="op" id="6589512">*</span><span class="ident" id="6589513">exec</span><span class="op" id="6589517">.</span><span class="ident" id="6589518">Cmd</span><span class="op" id="6589521">,</span>&nbsp;<span class="ident" id="6589523">err</span>&nbsp;<span class="builtintype" id="6589527">error</span><span class="op" id="6589532">)</span>&nbsp;<span class="op" id="6589534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589537">l</span><span class="op" id="6589538">,</span>&nbsp;<span class="ident" id="6589540">err</span>&nbsp;<span class="op" id="6589544">:=</span>&nbsp;<span class="ident" id="6589547">net</span><span class="op" id="6589550">.</span><span class="ident" id="6589551">ListenTCP</span><span class="op" id="6589560">(</span><span class="string" id="6589561">&#34;tcp&#34;</span><span class="op" id="6589566">,</span>&nbsp;<span class="op" id="6589568">&amp;</span><span class="ident" id="6589569">net</span><span class="op" id="6589572">.</span><span class="ident" id="6589573">TCPAddr</span><span class="op" id="6589580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589584">IP</span><span class="op" id="6589586">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6589590">net</span><span class="op" id="6589593">.</span><span class="ident" id="6589594">IPv4</span><span class="op" id="6589598">(</span><span class="num" id="6589599">127</span><span class="op" id="6589602">,</span>&nbsp;<span class="num" id="6589604">0</span><span class="op" id="6589605">,</span>&nbsp;<span class="num" id="6589607">0</span><span class="op" id="6589608">,</span>&nbsp;<span class="num" id="6589610">1</span><span class="op" id="6589611">)</span><span class="op" id="6589612">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589616">Port</span><span class="op" id="6589620">:</span>&nbsp;<span class="num" id="6589622">0</span><span class="op" id="6589623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589626">}</span><span class="op" id="6589627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6589630">if</span>&nbsp;<span class="ident" id="6589633">err</span>&nbsp;<span class="op" id="6589637">!=</span>&nbsp;<span class="builtintype" id="6589640">nil</span>&nbsp;<span class="op" id="6589644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6589648">return</span>&nbsp;<span class="builtintype" id="6589655">nil</span><span class="op" id="6589658">,</span>&nbsp;<span class="builtintype" id="6589660">nil</span><span class="op" id="6589663">,</span>&nbsp;<span class="ident" id="6589665">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589670">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6589673">defer</span>&nbsp;<span class="ident" id="6589679">l</span><span class="op" id="6589680">.</span><span class="ident" id="6589681">Close</span><span class="op" id="6589686">(</span><span class="op" id="6589687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589691">port</span>&nbsp;<span class="op" id="6589696">:=</span>&nbsp;<span class="ident" id="6589699">l</span><span class="op" id="6589700">.</span><span class="ident" id="6589701">Addr</span><span class="op" id="6589705">(</span><span class="op" id="6589706">)</span><span class="op" id="6589707">.</span><span class="op" id="6589708">(</span><span class="op" id="6589709">*</span><span class="ident" id="6589710">net</span><span class="op" id="6589713">.</span><span class="ident" id="6589714">TCPAddr</span><span class="op" id="6589721">)</span><span class="op" id="6589722">.</span><span class="ident" id="6589723">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6589730">var</span>&nbsp;<span class="ident" id="6589734">command</span>&nbsp;<span class="op" id="6589742">[</span><span class="op" id="6589743">]</span><span class="builtintype" id="6589744">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589752">command</span>&nbsp;<span class="op" id="6589760">=</span>&nbsp;<span class="builtinfunc" id="6589762">append</span><span class="op" id="6589768">(</span><span class="ident" id="6589769">command</span><span class="op" id="6589776">,</span>&nbsp;<span class="ident" id="6589778">test</span><span class="op" id="6589782">.</span><span class="ident" id="6589783">command</span><span class="op" id="6589790">...</span><span class="op" id="6589793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6589796">if</span>&nbsp;<span class="builtinfunc" id="6589799">len</span><span class="op" id="6589802">(</span><span class="ident" id="6589803">command</span><span class="op" id="6589810">)</span>&nbsp;<span class="op" id="6589812">==</span>&nbsp;<span class="num" id="6589815">0</span>&nbsp;<span class="op" id="6589817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589821">command</span>&nbsp;<span class="op" id="6589829">=</span>&nbsp;<span class="ident" id="6589831">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589856">command</span>&nbsp;<span class="op" id="6589864">=</span>&nbsp;<span class="builtinfunc" id="6589866">append</span><span class="op" id="6589872">(</span><span class="ident" id="6589873">command</span><span class="op" id="6589880">,</span>&nbsp;<span class="string" id="6589882">&#34;-connect&#34;</span><span class="op" id="6589892">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589895">command</span>&nbsp;<span class="op" id="6589903">=</span>&nbsp;<span class="builtinfunc" id="6589905">append</span><span class="op" id="6589911">(</span><span class="ident" id="6589912">command</span><span class="op" id="6589919">,</span>&nbsp;<span class="ident" id="6589921">fmt</span><span class="op" id="6589924">.</span><span class="ident" id="6589925">Sprintf</span><span class="op" id="6589932">(</span><span class="string" id="6589933">&#34;127.0.0.1:%d&#34;</span><span class="op" id="6589947">,</span>&nbsp;<span class="ident" id="6589949">port</span><span class="op" id="6589953">)</span><span class="op" id="6589954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589957">cmd</span>&nbsp;<span class="op" id="6589961">:=</span>&nbsp;<span class="ident" id="6589964">exec</span><span class="op" id="6589968">.</span><span class="ident" id="6589969">Command</span><span class="op" id="6589976">(</span><span class="ident" id="6589977">command</span><span class="op" id="6589984">[</span><span class="num" id="6589985">0</span><span class="op" id="6589986">]</span><span class="op" id="6589987">,</span>&nbsp;<span class="ident" id="6589989">command</span><span class="op" id="6589996">[</span><span class="num" id="6589997">1</span><span class="op" id="6589998">:</span><span class="op" id="6589999">]</span><span class="op" id="6590000">...</span><span class="op" id="6590003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590006">cmd</span><span class="op" id="6590009">.</span><span class="ident" id="6590010">Stdin</span>&nbsp;<span class="op" id="6590016">=</span>&nbsp;<span class="builtintype" id="6590018">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590023">var</span>&nbsp;<span class="ident" id="6590027">output</span>&nbsp;<span class="ident" id="6590034">bytes</span><span class="op" id="6590039">.</span><span class="ident" id="6590040">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590048">cmd</span><span class="op" id="6590051">.</span><span class="ident" id="6590052">Stdout</span>&nbsp;<span class="op" id="6590059">=</span>&nbsp;<span class="op" id="6590061">&amp;</span><span class="ident" id="6590062">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590070">cmd</span><span class="op" id="6590073">.</span><span class="ident" id="6590074">Stderr</span>&nbsp;<span class="op" id="6590081">=</span>&nbsp;<span class="op" id="6590083">&amp;</span><span class="ident" id="6590084">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590092">if</span>&nbsp;<span class="ident" id="6590095">err</span>&nbsp;<span class="op" id="6590099">:=</span>&nbsp;<span class="ident" id="6590102">cmd</span><span class="op" id="6590105">.</span><span class="ident" id="6590106">Start</span><span class="op" id="6590111">(</span><span class="op" id="6590112">)</span><span class="op" id="6590113">;</span>&nbsp;<span class="ident" id="6590115">err</span>&nbsp;<span class="op" id="6590119">!=</span>&nbsp;<span class="builtintype" id="6590122">nil</span>&nbsp;<span class="op" id="6590126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590130">return</span>&nbsp;<span class="builtintype" id="6590137">nil</span><span class="op" id="6590140">,</span>&nbsp;<span class="builtintype" id="6590142">nil</span><span class="op" id="6590145">,</span>&nbsp;<span class="ident" id="6590147">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590156">connChan</span>&nbsp;<span class="op" id="6590165">:=</span>&nbsp;<span class="builtinfunc" id="6590168">make</span><span class="op" id="6590172">(</span><span class="keyword" id="6590173">chan</span>&nbsp;<span class="keyword" id="6590178">interface</span><span class="op" id="6590187">{</span><span class="op" id="6590188">}</span><span class="op" id="6590189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590192">go</span>&nbsp;<span class="keyword" id="6590195">func</span><span class="op" id="6590199">(</span><span class="op" id="6590200">)</span>&nbsp;<span class="op" id="6590202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590206">tcpConn</span><span class="op" id="6590213">,</span>&nbsp;<span class="ident" id="6590215">err</span>&nbsp;<span class="op" id="6590219">:=</span>&nbsp;<span class="ident" id="6590222">l</span><span class="op" id="6590223">.</span><span class="ident" id="6590224">Accept</span><span class="op" id="6590230">(</span><span class="op" id="6590231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590235">if</span>&nbsp;<span class="ident" id="6590238">err</span>&nbsp;<span class="op" id="6590242">!=</span>&nbsp;<span class="builtintype" id="6590245">nil</span>&nbsp;<span class="op" id="6590249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590254">connChan</span>&nbsp;<span class="op" id="6590263">&lt;-</span>&nbsp;<span class="ident" id="6590266">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590276">connChan</span>&nbsp;<span class="op" id="6590285">&lt;-</span>&nbsp;<span class="ident" id="6590288">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590297">}</span><span class="op" id="6590298">(</span><span class="op" id="6590299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590303">var</span>&nbsp;<span class="ident" id="6590307">tcpConn</span>&nbsp;<span class="ident" id="6590315">net</span><span class="op" id="6590318">.</span><span class="ident" id="6590319">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590325">select</span>&nbsp;<span class="op" id="6590332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590335">case</span>&nbsp;<span class="ident" id="6590340">connOrError</span>&nbsp;<span class="op" id="6590352">:=</span>&nbsp;<span class="op" id="6590355">&lt;-</span><span class="ident" id="6590357">connChan</span><span class="op" id="6590365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590369">if</span>&nbsp;<span class="ident" id="6590372">err</span><span class="op" id="6590375">,</span>&nbsp;<span class="ident" id="6590377">ok</span>&nbsp;<span class="op" id="6590380">:=</span>&nbsp;<span class="ident" id="6590383">connOrError</span><span class="op" id="6590394">.</span><span class="op" id="6590395">(</span><span class="builtintype" id="6590396">error</span><span class="op" id="6590401">)</span><span class="op" id="6590402">;</span>&nbsp;<span class="ident" id="6590404">ok</span>&nbsp;<span class="op" id="6590407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590412">return</span>&nbsp;<span class="builtintype" id="6590419">nil</span><span class="op" id="6590422">,</span>&nbsp;<span class="builtintype" id="6590424">nil</span><span class="op" id="6590427">,</span>&nbsp;<span class="ident" id="6590429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590435">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590439">tcpConn</span>&nbsp;<span class="op" id="6590447">=</span>&nbsp;<span class="ident" id="6590449">connOrError</span><span class="op" id="6590460">.</span><span class="op" id="6590461">(</span><span class="ident" id="6590462">net</span><span class="op" id="6590465">.</span><span class="ident" id="6590466">Conn</span><span class="op" id="6590470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590473">case</span>&nbsp;<span class="op" id="6590478">&lt;-</span><span class="ident" id="6590480">time</span><span class="op" id="6590484">.</span><span class="ident" id="6590485">After</span><span class="op" id="6590490">(</span><span class="num" id="6590491">2</span>&nbsp;<span class="op" id="6590493">*</span>&nbsp;<span class="ident" id="6590495">time</span><span class="op" id="6590499">.</span><span class="ident" id="6590500">Second</span><span class="op" id="6590506">)</span><span class="op" id="6590507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590511">output</span><span class="op" id="6590517">.</span><span class="ident" id="6590518">WriteTo</span><span class="op" id="6590525">(</span><span class="ident" id="6590526">os</span><span class="op" id="6590528">.</span><span class="ident" id="6590529">Stdout</span><span class="op" id="6590535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590539">return</span>&nbsp;<span class="builtintype" id="6590546">nil</span><span class="op" id="6590549">,</span>&nbsp;<span class="builtintype" id="6590551">nil</span><span class="op" id="6590554">,</span>&nbsp;<span class="ident" id="6590556">errors</span><span class="op" id="6590562">.</span><span class="ident" id="6590563">New</span><span class="op" id="6590566">(</span><span class="string" id="6590567">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="6590620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590623">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590627">record</span>&nbsp;<span class="op" id="6590634">:=</span>&nbsp;<span class="op" id="6590637">&amp;</span><span class="ident" id="6590638">recordingConn</span><span class="op" id="6590651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590655">Conn</span><span class="op" id="6590659">:</span>&nbsp;<span class="ident" id="6590661">tcpConn</span><span class="op" id="6590668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590675">return</span>&nbsp;<span class="ident" id="6590682">record</span><span class="op" id="6590688">,</span>&nbsp;<span class="ident" id="6590690">cmd</span><span class="op" id="6590693">,</span>&nbsp;<span class="builtintype" id="6590695">nil</span><br>
<span class="lineno"></span><span class="op" id="6590699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590702">func</span>&nbsp;<span class="op" id="6590707">(</span><span class="ident" id="6590708">test</span>&nbsp;<span class="op" id="6590713">*</span><span class="ident" id="6590714">serverTest</span><span class="op" id="6590724">)</span>&nbsp;<span class="ident" id="6590726">dataPath</span><span class="op" id="6590734">(</span><span class="op" id="6590735">)</span>&nbsp;<span class="builtintype" id="6590737">string</span>&nbsp;<span class="op" id="6590744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590747">return</span>&nbsp;<span class="ident" id="6590754">filepath</span><span class="op" id="6590762">.</span><span class="ident" id="6590763">Join</span><span class="op" id="6590767">(</span><span class="string" id="6590768">&#34;testdata&#34;</span><span class="op" id="6590778">,</span>&nbsp;<span class="string" id="6590780">&#34;Server-&#34;</span><span class="op" id="6590789">+</span><span class="ident" id="6590790">test</span><span class="op" id="6590794">.</span><span class="ident" id="6590795">name</span><span class="op" id="6590799">)</span><br>
<span class="lineno">335</span><span class="op" id="6590801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590804">func</span>&nbsp;<span class="op" id="6590809">(</span><span class="ident" id="6590810">test</span>&nbsp;<span class="op" id="6590815">*</span><span class="ident" id="6590816">serverTest</span><span class="op" id="6590826">)</span>&nbsp;<span class="ident" id="6590828">loadData</span><span class="op" id="6590836">(</span><span class="op" id="6590837">)</span>&nbsp;<span class="op" id="6590839">(</span><span class="ident" id="6590840">flows</span>&nbsp;<span class="op" id="6590846">[</span><span class="op" id="6590847">]</span><span class="op" id="6590848">[</span><span class="op" id="6590849">]</span><span class="builtintype" id="6590850">byte</span><span class="op" id="6590854">,</span>&nbsp;<span class="ident" id="6590856">err</span>&nbsp;<span class="builtintype" id="6590860">error</span><span class="op" id="6590865">)</span>&nbsp;<span class="op" id="6590867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590870">in</span><span class="op" id="6590872">,</span>&nbsp;<span class="ident" id="6590874">err</span>&nbsp;<span class="op" id="6590878">:=</span>&nbsp;<span class="ident" id="6590881">os</span><span class="op" id="6590883">.</span><span class="ident" id="6590884">Open</span><span class="op" id="6590888">(</span><span class="ident" id="6590889">test</span><span class="op" id="6590893">.</span><span class="ident" id="6590894">dataPath</span><span class="op" id="6590902">(</span><span class="op" id="6590903">)</span><span class="op" id="6590904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590907">if</span>&nbsp;<span class="ident" id="6590910">err</span>&nbsp;<span class="op" id="6590914">!=</span>&nbsp;<span class="builtintype" id="6590917">nil</span>&nbsp;<span class="op" id="6590921">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590925">return</span>&nbsp;<span class="builtintype" id="6590932">nil</span><span class="op" id="6590935">,</span>&nbsp;<span class="ident" id="6590937">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590945">defer</span>&nbsp;<span class="ident" id="6590951">in</span><span class="op" id="6590953">.</span><span class="ident" id="6590954">Close</span><span class="op" id="6590959">(</span><span class="op" id="6590960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590963">return</span>&nbsp;<span class="ident" id="6590970">parseTestData</span><span class="op" id="6590983">(</span><span class="ident" id="6590984">in</span><span class="op" id="6590986">)</span><br>
<span class="lineno"></span><span class="op" id="6590988">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6590991">func</span>&nbsp;<span class="op" id="6590996">(</span><span class="ident" id="6590997">test</span>&nbsp;<span class="op" id="6591002">*</span><span class="ident" id="6591003">serverTest</span><span class="op" id="6591013">)</span>&nbsp;<span class="ident" id="6591015">run</span><span class="op" id="6591018">(</span><span class="ident" id="6591019">t</span>&nbsp;<span class="op" id="6591021">*</span><span class="ident" id="6591022">testing</span><span class="op" id="6591029">.</span><span class="ident" id="6591030">T</span><span class="op" id="6591031">,</span>&nbsp;<span class="ident" id="6591033">write</span>&nbsp;<span class="builtintype" id="6591039">bool</span><span class="op" id="6591043">)</span>&nbsp;<span class="op" id="6591045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591048">var</span>&nbsp;<span class="ident" id="6591052">clientConn</span><span class="op" id="6591062">,</span>&nbsp;<span class="ident" id="6591064">serverConn</span>&nbsp;<span class="ident" id="6591075">net</span><span class="op" id="6591078">.</span><span class="ident" id="6591079">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591085">var</span>&nbsp;<span class="ident" id="6591089">recordingConn</span>&nbsp;<span class="op" id="6591103">*</span><span class="ident" id="6591104">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591119">var</span>&nbsp;<span class="ident" id="6591123">childProcess</span>&nbsp;<span class="op" id="6591136">*</span><span class="ident" id="6591137">exec</span><span class="op" id="6591141">.</span><span class="ident" id="6591142">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591148">if</span>&nbsp;<span class="ident" id="6591151">write</span>&nbsp;<span class="op" id="6591157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591161">var</span>&nbsp;<span class="ident" id="6591165">err</span>&nbsp;<span class="builtintype" id="6591169">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591177">recordingConn</span><span class="op" id="6591190">,</span>&nbsp;<span class="ident" id="6591192">childProcess</span><span class="op" id="6591204">,</span>&nbsp;<span class="ident" id="6591206">err</span>&nbsp;<span class="op" id="6591210">=</span>&nbsp;<span class="ident" id="6591212">test</span><span class="op" id="6591216">.</span><span class="ident" id="6591217">connFromCommand</span><span class="op" id="6591232">(</span><span class="op" id="6591233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591237">if</span>&nbsp;<span class="ident" id="6591240">err</span>&nbsp;<span class="op" id="6591244">!=</span>&nbsp;<span class="builtintype" id="6591247">nil</span>&nbsp;<span class="op" id="6591251">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591256">t</span><span class="op" id="6591257">.</span><span class="ident" id="6591258">Fatalf</span><span class="op" id="6591264">(</span><span class="string" id="6591265">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6591297">,</span>&nbsp;<span class="ident" id="6591299">err</span><span class="op" id="6591302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591310">serverConn</span>&nbsp;<span class="op" id="6591321">=</span>&nbsp;<span class="ident" id="6591323">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591338">}</span>&nbsp;<span class="keyword" id="6591340">else</span>&nbsp;<span class="op" id="6591345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591349">clientConn</span><span class="op" id="6591359">,</span>&nbsp;<span class="ident" id="6591361">serverConn</span>&nbsp;<span class="op" id="6591372">=</span>&nbsp;<span class="ident" id="6591374">net</span><span class="op" id="6591377">.</span><span class="ident" id="6591378">Pipe</span><span class="op" id="6591382">(</span><span class="op" id="6591383">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591389">config</span>&nbsp;<span class="op" id="6591396">:=</span>&nbsp;<span class="ident" id="6591399">test</span><span class="op" id="6591403">.</span><span class="ident" id="6591404">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591412">if</span>&nbsp;<span class="ident" id="6591415">config</span>&nbsp;<span class="op" id="6591422">==</span>&nbsp;<span class="builtintype" id="6591425">nil</span>&nbsp;<span class="op" id="6591429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591433">config</span>&nbsp;<span class="op" id="6591440">=</span>&nbsp;<span class="ident" id="6591442">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591454">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591457">server</span>&nbsp;<span class="op" id="6591464">:=</span>&nbsp;<span class="ident" id="6591467">Server</span><span class="op" id="6591473">(</span><span class="ident" id="6591474">serverConn</span><span class="op" id="6591484">,</span>&nbsp;<span class="ident" id="6591486">config</span><span class="op" id="6591492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591495">connStateChan</span>&nbsp;<span class="op" id="6591509">:=</span>&nbsp;<span class="builtinfunc" id="6591512">make</span><span class="op" id="6591516">(</span><span class="keyword" id="6591517">chan</span>&nbsp;<span class="ident" id="6591522">ConnectionState</span><span class="op" id="6591537">,</span>&nbsp;<span class="num" id="6591539">1</span><span class="op" id="6591540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591543">go</span>&nbsp;<span class="keyword" id="6591546">func</span><span class="op" id="6591550">(</span><span class="op" id="6591551">)</span>&nbsp;<span class="op" id="6591553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591557">var</span>&nbsp;<span class="ident" id="6591561">err</span>&nbsp;<span class="builtintype" id="6591565">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591573">if</span>&nbsp;<span class="ident" id="6591576">_</span><span class="op" id="6591577">,</span>&nbsp;<span class="ident" id="6591579">err</span>&nbsp;<span class="op" id="6591583">=</span>&nbsp;<span class="ident" id="6591585">server</span><span class="op" id="6591591">.</span><span class="ident" id="6591592">Write</span><span class="op" id="6591597">(</span><span class="op" id="6591598">[</span><span class="op" id="6591599">]</span><span class="builtintype" id="6591600">byte</span><span class="op" id="6591604">(</span><span class="string" id="6591605">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="6591621">)</span><span class="op" id="6591622">)</span><span class="op" id="6591623">;</span>&nbsp;<span class="ident" id="6591625">err</span>&nbsp;<span class="op" id="6591629">!=</span>&nbsp;<span class="builtintype" id="6591632">nil</span>&nbsp;<span class="op" id="6591636">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591641">t</span><span class="op" id="6591642">.</span><span class="ident" id="6591643">Logf</span><span class="op" id="6591647">(</span><span class="string" id="6591648">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="6591677">,</span>&nbsp;<span class="ident" id="6591679">err</span><span class="op" id="6591682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591690">if</span>&nbsp;<span class="builtinfunc" id="6591693">len</span><span class="op" id="6591696">(</span><span class="ident" id="6591697">test</span><span class="op" id="6591701">.</span><span class="ident" id="6591702">expectHandshakeErrorIncluding</span><span class="op" id="6591731">)</span>&nbsp;<span class="op" id="6591733">&gt;</span>&nbsp;<span class="num" id="6591735">0</span>&nbsp;<span class="op" id="6591737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591742">if</span>&nbsp;<span class="ident" id="6591745">err</span>&nbsp;<span class="op" id="6591749">==</span>&nbsp;<span class="builtintype" id="6591752">nil</span>&nbsp;<span class="op" id="6591756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591762">t</span><span class="op" id="6591763">.</span><span class="ident" id="6591764">Errorf</span><span class="op" id="6591770">(</span><span class="string" id="6591771">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="6591810">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591815">}</span>&nbsp;<span class="keyword" id="6591817">else</span>&nbsp;<span class="keyword" id="6591822">if</span>&nbsp;<span class="ident" id="6591825">s</span>&nbsp;<span class="op" id="6591827">:=</span>&nbsp;<span class="ident" id="6591830">err</span><span class="op" id="6591833">.</span><span class="ident" id="6591834">Error</span><span class="op" id="6591839">(</span><span class="op" id="6591840">)</span><span class="op" id="6591841">;</span>&nbsp;<span class="op" id="6591843">!</span><span class="ident" id="6591844">strings</span><span class="op" id="6591851">.</span><span class="ident" id="6591852">Contains</span><span class="op" id="6591860">(</span><span class="ident" id="6591861">s</span><span class="op" id="6591862">,</span>&nbsp;<span class="ident" id="6591864">test</span><span class="op" id="6591868">.</span><span class="ident" id="6591869">expectHandshakeErrorIncluding</span><span class="op" id="6591898">)</span>&nbsp;<span class="op" id="6591900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591906">t</span><span class="op" id="6591907">.</span><span class="ident" id="6591908">Errorf</span><span class="op" id="6591914">(</span><span class="string" id="6591915">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6591960">,</span>&nbsp;<span class="ident" id="6591962">test</span><span class="op" id="6591966">.</span><span class="ident" id="6591967">expectHandshakeErrorIncluding</span><span class="op" id="6591996">,</span>&nbsp;<span class="ident" id="6591998">s</span><span class="op" id="6591999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592012">server</span><span class="op" id="6592018">.</span><span class="ident" id="6592019">Close</span><span class="op" id="6592024">(</span><span class="op" id="6592025">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592029">serverConn</span><span class="op" id="6592039">.</span><span class="ident" id="6592040">Close</span><span class="op" id="6592045">(</span><span class="op" id="6592046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592050">connStateChan</span>&nbsp;<span class="op" id="6592064">&lt;-</span>&nbsp;<span class="ident" id="6592067">server</span><span class="op" id="6592073">.</span><span class="ident" id="6592074">ConnectionState</span><span class="op" id="6592089">(</span><span class="op" id="6592090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592093">}</span><span class="op" id="6592094">(</span><span class="op" id="6592095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592099">if</span>&nbsp;<span class="op" id="6592102">!</span><span class="ident" id="6592103">write</span>&nbsp;<span class="op" id="6592109">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592113">flows</span><span class="op" id="6592118">,</span>&nbsp;<span class="ident" id="6592120">err</span>&nbsp;<span class="op" id="6592124">:=</span>&nbsp;<span class="ident" id="6592127">test</span><span class="op" id="6592131">.</span><span class="ident" id="6592132">loadData</span><span class="op" id="6592140">(</span><span class="op" id="6592141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592145">if</span>&nbsp;<span class="ident" id="6592148">err</span>&nbsp;<span class="op" id="6592152">!=</span>&nbsp;<span class="builtintype" id="6592155">nil</span>&nbsp;<span class="op" id="6592159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592164">if</span>&nbsp;<span class="op" id="6592167">!</span><span class="ident" id="6592168">test</span><span class="op" id="6592172">.</span><span class="ident" id="6592173">expectAlert</span>&nbsp;<span class="op" id="6592185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592191">t</span><span class="op" id="6592192">.</span><span class="ident" id="6592193">Fatalf</span><span class="op" id="6592199">(</span><span class="string" id="6592200">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="6592233">,</span>&nbsp;<span class="ident" id="6592235">test</span><span class="op" id="6592239">.</span><span class="ident" id="6592240">name</span><span class="op" id="6592244">,</span>&nbsp;<span class="ident" id="6592246">test</span><span class="op" id="6592250">.</span><span class="ident" id="6592251">dataPath</span><span class="op" id="6592259">(</span><span class="op" id="6592260">)</span><span class="op" id="6592261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592266">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592274">for</span>&nbsp;<span class="ident" id="6592278">i</span><span class="op" id="6592279">,</span>&nbsp;<span class="ident" id="6592281">b</span>&nbsp;<span class="op" id="6592283">:=</span>&nbsp;<span class="keyword" id="6592286">range</span>&nbsp;<span class="ident" id="6592292">flows</span>&nbsp;<span class="op" id="6592298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592303">if</span>&nbsp;<span class="ident" id="6592306">i</span><span class="op" id="6592307">%</span><span class="num" id="6592308">2</span>&nbsp;<span class="op" id="6592310">==</span>&nbsp;<span class="num" id="6592313">0</span>&nbsp;<span class="op" id="6592315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592321">clientConn</span><span class="op" id="6592331">.</span><span class="ident" id="6592332">Write</span><span class="op" id="6592337">(</span><span class="ident" id="6592338">b</span><span class="op" id="6592339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592345">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592362">bb</span>&nbsp;<span class="op" id="6592365">:=</span>&nbsp;<span class="builtinfunc" id="6592368">make</span><span class="op" id="6592372">(</span><span class="op" id="6592373">[</span><span class="op" id="6592374">]</span><span class="builtintype" id="6592375">byte</span><span class="op" id="6592379">,</span>&nbsp;<span class="builtinfunc" id="6592381">len</span><span class="op" id="6592384">(</span><span class="ident" id="6592385">b</span><span class="op" id="6592386">)</span><span class="op" id="6592387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592392">n</span><span class="op" id="6592393">,</span>&nbsp;<span class="ident" id="6592395">err</span>&nbsp;<span class="op" id="6592399">:=</span>&nbsp;<span class="ident" id="6592402">io</span><span class="op" id="6592404">.</span><span class="ident" id="6592405">ReadFull</span><span class="op" id="6592413">(</span><span class="ident" id="6592414">clientConn</span><span class="op" id="6592424">,</span>&nbsp;<span class="ident" id="6592426">bb</span><span class="op" id="6592428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592433">if</span>&nbsp;<span class="ident" id="6592436">test</span><span class="op" id="6592440">.</span><span class="ident" id="6592441">expectAlert</span>&nbsp;<span class="op" id="6592453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592459">if</span>&nbsp;<span class="ident" id="6592462">err</span>&nbsp;<span class="op" id="6592466">==</span>&nbsp;<span class="builtintype" id="6592469">nil</span>&nbsp;<span class="op" id="6592473">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592480">t</span><span class="op" id="6592481">.</span><span class="ident" id="6592482">Fatal</span><span class="op" id="6592487">(</span><span class="string" id="6592488">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="6592530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592541">}</span>&nbsp;<span class="keyword" id="6592543">else</span>&nbsp;<span class="op" id="6592548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592554">if</span>&nbsp;<span class="ident" id="6592557">err</span>&nbsp;<span class="op" id="6592561">!=</span>&nbsp;<span class="builtintype" id="6592564">nil</span>&nbsp;<span class="op" id="6592568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592575">t</span><span class="op" id="6592576">.</span><span class="ident" id="6592577">Fatalf</span><span class="op" id="6592583">(</span><span class="string" id="6592584">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="6592637">,</span>&nbsp;<span class="ident" id="6592639">test</span><span class="op" id="6592643">.</span><span class="ident" id="6592644">name</span><span class="op" id="6592648">,</span>&nbsp;<span class="ident" id="6592650">i</span><span class="op" id="6592651">+</span><span class="num" id="6592652">1</span><span class="op" id="6592653">,</span>&nbsp;<span class="ident" id="6592655">err</span><span class="op" id="6592658">,</span>&nbsp;<span class="ident" id="6592660">n</span><span class="op" id="6592661">,</span>&nbsp;<span class="builtinfunc" id="6592663">len</span><span class="op" id="6592666">(</span><span class="ident" id="6592667">bb</span><span class="op" id="6592669">)</span><span class="op" id="6592670">,</span>&nbsp;<span class="ident" id="6592672">bb</span><span class="op" id="6592674">[</span><span class="op" id="6592675">:</span><span class="ident" id="6592676">n</span><span class="op" id="6592677">]</span><span class="op" id="6592678">,</span>&nbsp;<span class="ident" id="6592680">b</span><span class="op" id="6592681">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592693">if</span>&nbsp;<span class="op" id="6592696">!</span><span class="ident" id="6592697">bytes</span><span class="op" id="6592702">.</span><span class="ident" id="6592703">Equal</span><span class="op" id="6592708">(</span><span class="ident" id="6592709">b</span><span class="op" id="6592710">,</span>&nbsp;<span class="ident" id="6592712">bb</span><span class="op" id="6592714">)</span>&nbsp;<span class="op" id="6592716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592723">t</span><span class="op" id="6592724">.</span><span class="ident" id="6592725">Fatalf</span><span class="op" id="6592731">(</span><span class="string" id="6592732">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6592774">,</span>&nbsp;<span class="ident" id="6592776">test</span><span class="op" id="6592780">.</span><span class="ident" id="6592781">name</span><span class="op" id="6592785">,</span>&nbsp;<span class="ident" id="6592787">i</span><span class="op" id="6592788">+</span><span class="num" id="6592789">1</span><span class="op" id="6592790">,</span>&nbsp;<span class="ident" id="6592792">bb</span><span class="op" id="6592794">,</span>&nbsp;<span class="ident" id="6592796">b</span><span class="op" id="6592797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592808">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592816">clientConn</span><span class="op" id="6592826">.</span><span class="ident" id="6592827">Close</span><span class="op" id="6592832">(</span><span class="op" id="6592833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6592836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592840">connState</span>&nbsp;<span class="op" id="6592850">:=</span>&nbsp;<span class="op" id="6592853">&lt;-</span><span class="ident" id="6592855">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592870">peerCerts</span>&nbsp;<span class="op" id="6592880">:=</span>&nbsp;<span class="ident" id="6592883">connState</span><span class="op" id="6592892">.</span><span class="ident" id="6592893">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592911">if</span>&nbsp;<span class="builtinfunc" id="6592914">len</span><span class="op" id="6592917">(</span><span class="ident" id="6592918">peerCerts</span><span class="op" id="6592927">)</span>&nbsp;<span class="op" id="6592929">==</span>&nbsp;<span class="builtinfunc" id="6592932">len</span><span class="op" id="6592935">(</span><span class="ident" id="6592936">test</span><span class="op" id="6592940">.</span><span class="ident" id="6592941">expectedPeerCerts</span><span class="op" id="6592958">)</span>&nbsp;<span class="op" id="6592960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592964">for</span>&nbsp;<span class="ident" id="6592968">i</span><span class="op" id="6592969">,</span>&nbsp;<span class="ident" id="6592971">peerCert</span>&nbsp;<span class="op" id="6592980">:=</span>&nbsp;<span class="keyword" id="6592983">range</span>&nbsp;<span class="ident" id="6592989">peerCerts</span>&nbsp;<span class="op" id="6592999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593004">block</span><span class="op" id="6593009">,</span>&nbsp;<span class="ident" id="6593011">_</span>&nbsp;<span class="op" id="6593013">:=</span>&nbsp;<span class="ident" id="6593016">pem</span><span class="op" id="6593019">.</span><span class="ident" id="6593020">Decode</span><span class="op" id="6593026">(</span><span class="op" id="6593027">[</span><span class="op" id="6593028">]</span><span class="builtintype" id="6593029">byte</span><span class="op" id="6593033">(</span><span class="ident" id="6593034">test</span><span class="op" id="6593038">.</span><span class="ident" id="6593039">expectedPeerCerts</span><span class="op" id="6593056">[</span><span class="ident" id="6593057">i</span><span class="op" id="6593058">]</span><span class="op" id="6593059">)</span><span class="op" id="6593060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593065">if</span>&nbsp;<span class="op" id="6593068">!</span><span class="ident" id="6593069">bytes</span><span class="op" id="6593074">.</span><span class="ident" id="6593075">Equal</span><span class="op" id="6593080">(</span><span class="ident" id="6593081">block</span><span class="op" id="6593086">.</span><span class="ident" id="6593087">Bytes</span><span class="op" id="6593092">,</span>&nbsp;<span class="ident" id="6593094">peerCert</span><span class="op" id="6593102">.</span><span class="ident" id="6593103">Raw</span><span class="op" id="6593106">)</span>&nbsp;<span class="op" id="6593108">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593114">t</span><span class="op" id="6593115">.</span><span class="ident" id="6593116">Fatalf</span><span class="op" id="6593122">(</span><span class="string" id="6593123">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="6593153">,</span>&nbsp;<span class="ident" id="6593155">test</span><span class="op" id="6593159">.</span><span class="ident" id="6593160">name</span><span class="op" id="6593164">,</span>&nbsp;<span class="ident" id="6593166">i</span><span class="op" id="6593167">+</span><span class="num" id="6593168">1</span><span class="op" id="6593169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593181">}</span>&nbsp;<span class="keyword" id="6593183">else</span>&nbsp;<span class="op" id="6593188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593192">t</span><span class="op" id="6593193">.</span><span class="ident" id="6593194">Fatalf</span><span class="op" id="6593200">(</span><span class="string" id="6593201">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="6593260">,</span>&nbsp;<span class="ident" id="6593262">test</span><span class="op" id="6593266">.</span><span class="ident" id="6593267">name</span><span class="op" id="6593271">,</span>&nbsp;<span class="builtinfunc" id="6593273">len</span><span class="op" id="6593276">(</span><span class="ident" id="6593277">test</span><span class="op" id="6593281">.</span><span class="ident" id="6593282">expectedPeerCerts</span><span class="op" id="6593299">)</span><span class="op" id="6593300">,</span>&nbsp;<span class="builtinfunc" id="6593302">len</span><span class="op" id="6593305">(</span><span class="ident" id="6593306">peerCerts</span><span class="op" id="6593315">)</span><span class="op" id="6593316">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593323">if</span>&nbsp;<span class="ident" id="6593326">test</span><span class="op" id="6593330">.</span><span class="ident" id="6593331">validate</span>&nbsp;<span class="op" id="6593340">!=</span>&nbsp;<span class="builtintype" id="6593343">nil</span>&nbsp;<span class="op" id="6593347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593351">if</span>&nbsp;<span class="ident" id="6593354">err</span>&nbsp;<span class="op" id="6593358">:=</span>&nbsp;<span class="ident" id="6593361">test</span><span class="op" id="6593365">.</span><span class="ident" id="6593366">validate</span><span class="op" id="6593374">(</span><span class="ident" id="6593375">connState</span><span class="op" id="6593384">)</span><span class="op" id="6593385">;</span>&nbsp;<span class="ident" id="6593387">err</span>&nbsp;<span class="op" id="6593391">!=</span>&nbsp;<span class="builtintype" id="6593394">nil</span>&nbsp;<span class="op" id="6593398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593403">t</span><span class="op" id="6593404">.</span><span class="ident" id="6593405">Fatalf</span><span class="op" id="6593411">(</span><span class="string" id="6593412">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6593450">,</span>&nbsp;<span class="ident" id="6593452">err</span><span class="op" id="6593455">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593466">if</span>&nbsp;<span class="ident" id="6593469">write</span>&nbsp;<span class="op" id="6593475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593479">path</span>&nbsp;<span class="op" id="6593484">:=</span>&nbsp;<span class="ident" id="6593487">test</span><span class="op" id="6593491">.</span><span class="ident" id="6593492">dataPath</span><span class="op" id="6593500">(</span><span class="op" id="6593501">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593505">out</span><span class="op" id="6593508">,</span>&nbsp;<span class="ident" id="6593510">err</span>&nbsp;<span class="op" id="6593514">:=</span>&nbsp;<span class="ident" id="6593517">os</span><span class="op" id="6593519">.</span><span class="ident" id="6593520">OpenFile</span><span class="op" id="6593528">(</span><span class="ident" id="6593529">path</span><span class="op" id="6593533">,</span>&nbsp;<span class="ident" id="6593535">os</span><span class="op" id="6593537">.</span><span class="ident" id="6593538">O_WRONLY</span><span class="op" id="6593546">|</span><span class="ident" id="6593547">os</span><span class="op" id="6593549">.</span><span class="ident" id="6593550">O_CREATE</span><span class="op" id="6593558">|</span><span class="ident" id="6593559">os</span><span class="op" id="6593561">.</span><span class="ident" id="6593562">O_TRUNC</span><span class="op" id="6593569">,</span>&nbsp;<span class="num" id="6593571">0644</span><span class="op" id="6593575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593579">if</span>&nbsp;<span class="ident" id="6593582">err</span>&nbsp;<span class="op" id="6593586">!=</span>&nbsp;<span class="builtintype" id="6593589">nil</span>&nbsp;<span class="op" id="6593593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593598">t</span><span class="op" id="6593599">.</span><span class="ident" id="6593600">Fatalf</span><span class="op" id="6593606">(</span><span class="string" id="6593607">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6593641">,</span>&nbsp;<span class="ident" id="6593643">err</span><span class="op" id="6593646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593654">defer</span>&nbsp;<span class="ident" id="6593660">out</span><span class="op" id="6593663">.</span><span class="ident" id="6593664">Close</span><span class="op" id="6593669">(</span><span class="op" id="6593670">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593674">recordingConn</span><span class="op" id="6593687">.</span><span class="ident" id="6593688">Close</span><span class="op" id="6593693">(</span><span class="op" id="6593694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593698">if</span>&nbsp;<span class="builtinfunc" id="6593701">len</span><span class="op" id="6593704">(</span><span class="ident" id="6593705">recordingConn</span><span class="op" id="6593718">.</span><span class="ident" id="6593719">flows</span><span class="op" id="6593724">)</span>&nbsp;<span class="op" id="6593726">&lt;</span>&nbsp;<span class="num" id="6593728">3</span>&nbsp;<span class="op" id="6593730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593735">childProcess</span><span class="op" id="6593747">.</span><span class="ident" id="6593748">Stdout</span><span class="op" id="6593754">.</span><span class="op" id="6593755">(</span><span class="op" id="6593756">*</span><span class="ident" id="6593757">bytes</span><span class="op" id="6593762">.</span><span class="ident" id="6593763">Buffer</span><span class="op" id="6593769">)</span><span class="op" id="6593770">.</span><span class="ident" id="6593771">WriteTo</span><span class="op" id="6593778">(</span><span class="ident" id="6593779">os</span><span class="op" id="6593781">.</span><span class="ident" id="6593782">Stdout</span><span class="op" id="6593788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6593793">if</span>&nbsp;<span class="builtinfunc" id="6593796">len</span><span class="op" id="6593799">(</span><span class="ident" id="6593800">test</span><span class="op" id="6593804">.</span><span class="ident" id="6593805">expectHandshakeErrorIncluding</span><span class="op" id="6593834">)</span>&nbsp;<span class="op" id="6593836">==</span>&nbsp;<span class="num" id="6593839">0</span>&nbsp;<span class="op" id="6593841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593847">t</span><span class="op" id="6593848">.</span><span class="ident" id="6593849">Fatalf</span><span class="op" id="6593855">(</span><span class="string" id="6593856">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="6593874">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593887">recordingConn</span><span class="op" id="6593900">.</span><span class="ident" id="6593901">WriteTo</span><span class="op" id="6593908">(</span><span class="ident" id="6593909">out</span><span class="op" id="6593912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593916">fmt</span><span class="op" id="6593919">.</span><span class="ident" id="6593920">Printf</span><span class="op" id="6593926">(</span><span class="string" id="6593927">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6593939">,</span>&nbsp;<span class="ident" id="6593941">path</span><span class="op" id="6593945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6593949">childProcess</span><span class="op" id="6593961">.</span><span class="ident" id="6593962">Wait</span><span class="op" id="6593966">(</span><span class="op" id="6593967">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6593970">}</span><br>
<span class="lineno"></span><span class="op" id="6593972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6593975">func</span>&nbsp;<span class="ident" id="6593980">runServerTestForVersion</span><span class="op" id="6594003">(</span><span class="ident" id="6594004">t</span>&nbsp;<span class="op" id="6594006">*</span><span class="ident" id="6594007">testing</span><span class="op" id="6594014">.</span><span class="ident" id="6594015">T</span><span class="op" id="6594016">,</span>&nbsp;<span class="ident" id="6594018">template</span>&nbsp;<span class="op" id="6594027">*</span><span class="ident" id="6594028">serverTest</span><span class="op" id="6594038">,</span>&nbsp;<span class="ident" id="6594040">prefix</span><span class="op" id="6594046">,</span>&nbsp;<span class="ident" id="6594048">option</span>&nbsp;<span class="builtintype" id="6594055">string</span><span class="op" id="6594061">)</span>&nbsp;<span class="op" id="6594063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594066">test</span>&nbsp;<span class="op" id="6594071">:=</span>&nbsp;<span class="op" id="6594074">*</span><span class="ident" id="6594075">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594085">test</span><span class="op" id="6594089">.</span><span class="ident" id="6594090">name</span>&nbsp;<span class="op" id="6594095">=</span>&nbsp;<span class="ident" id="6594097">prefix</span>&nbsp;<span class="op" id="6594104">+</span>&nbsp;<span class="ident" id="6594106">test</span><span class="op" id="6594110">.</span><span class="ident" id="6594111">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6594117">if</span>&nbsp;<span class="builtinfunc" id="6594120">len</span><span class="op" id="6594123">(</span><span class="ident" id="6594124">test</span><span class="op" id="6594128">.</span><span class="ident" id="6594129">command</span><span class="op" id="6594136">)</span>&nbsp;<span class="op" id="6594138">==</span>&nbsp;<span class="num" id="6594141">0</span>&nbsp;<span class="op" id="6594143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594147">test</span><span class="op" id="6594151">.</span><span class="ident" id="6594152">command</span>&nbsp;<span class="op" id="6594160">=</span>&nbsp;<span class="ident" id="6594162">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594187">test</span><span class="op" id="6594191">.</span><span class="ident" id="6594192">command</span>&nbsp;<span class="op" id="6594200">=</span>&nbsp;<span class="builtinfunc" id="6594202">append</span><span class="op" id="6594208">(</span><span class="op" id="6594209">[</span><span class="op" id="6594210">]</span><span class="builtintype" id="6594211">string</span><span class="op" id="6594217">(</span><span class="builtintype" id="6594218">nil</span><span class="op" id="6594221">)</span><span class="op" id="6594222">,</span>&nbsp;<span class="ident" id="6594224">test</span><span class="op" id="6594228">.</span><span class="ident" id="6594229">command</span><span class="op" id="6594236">...</span><span class="op" id="6594239">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594242">test</span><span class="op" id="6594246">.</span><span class="ident" id="6594247">command</span>&nbsp;<span class="op" id="6594255">=</span>&nbsp;<span class="builtinfunc" id="6594257">append</span><span class="op" id="6594263">(</span><span class="ident" id="6594264">test</span><span class="op" id="6594268">.</span><span class="ident" id="6594269">command</span><span class="op" id="6594276">,</span>&nbsp;<span class="ident" id="6594278">option</span><span class="op" id="6594284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594287">test</span><span class="op" id="6594291">.</span><span class="ident" id="6594292">run</span><span class="op" id="6594295">(</span><span class="ident" id="6594296">t</span><span class="op" id="6594297">,</span>&nbsp;<span class="op" id="6594299">*</span><span class="ident" id="6594300">update</span><span class="op" id="6594306">)</span><br>
<span class="lineno"></span><span class="op" id="6594308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594311">func</span>&nbsp;<span class="ident" id="6594316">runServerTestSSLv3</span><span class="op" id="6594334">(</span><span class="ident" id="6594335">t</span>&nbsp;<span class="op" id="6594337">*</span><span class="ident" id="6594338">testing</span><span class="op" id="6594345">.</span><span class="ident" id="6594346">T</span><span class="op" id="6594347">,</span>&nbsp;<span class="ident" id="6594349">template</span>&nbsp;<span class="op" id="6594358">*</span><span class="ident" id="6594359">serverTest</span><span class="op" id="6594369">)</span>&nbsp;<span class="op" id="6594371">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594374">runServerTestForVersion</span><span class="op" id="6594397">(</span><span class="ident" id="6594398">t</span><span class="op" id="6594399">,</span>&nbsp;<span class="ident" id="6594401">template</span><span class="op" id="6594409">,</span>&nbsp;<span class="string" id="6594411">&#34;SSLv3-&#34;</span><span class="op" id="6594419">,</span>&nbsp;<span class="string" id="6594421">&#34;-ssl3&#34;</span><span class="op" id="6594428">)</span><br>
<span class="lineno"></span><span class="op" id="6594430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594433">func</span>&nbsp;<span class="ident" id="6594438">runServerTestTLS10</span><span class="op" id="6594456">(</span><span class="ident" id="6594457">t</span>&nbsp;<span class="op" id="6594459">*</span><span class="ident" id="6594460">testing</span><span class="op" id="6594467">.</span><span class="ident" id="6594468">T</span><span class="op" id="6594469">,</span>&nbsp;<span class="ident" id="6594471">template</span>&nbsp;<span class="op" id="6594480">*</span><span class="ident" id="6594481">serverTest</span><span class="op" id="6594491">)</span>&nbsp;<span class="op" id="6594493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594496">runServerTestForVersion</span><span class="op" id="6594519">(</span><span class="ident" id="6594520">t</span><span class="op" id="6594521">,</span>&nbsp;<span class="ident" id="6594523">template</span><span class="op" id="6594531">,</span>&nbsp;<span class="string" id="6594533">&#34;TLSv10-&#34;</span><span class="op" id="6594542">,</span>&nbsp;<span class="string" id="6594544">&#34;-tls1&#34;</span><span class="op" id="6594551">)</span><br>
<span class="lineno">470</span><span class="op" id="6594553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594556">func</span>&nbsp;<span class="ident" id="6594561">runServerTestTLS11</span><span class="op" id="6594579">(</span><span class="ident" id="6594580">t</span>&nbsp;<span class="op" id="6594582">*</span><span class="ident" id="6594583">testing</span><span class="op" id="6594590">.</span><span class="ident" id="6594591">T</span><span class="op" id="6594592">,</span>&nbsp;<span class="ident" id="6594594">template</span>&nbsp;<span class="op" id="6594603">*</span><span class="ident" id="6594604">serverTest</span><span class="op" id="6594614">)</span>&nbsp;<span class="op" id="6594616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594619">runServerTestForVersion</span><span class="op" id="6594642">(</span><span class="ident" id="6594643">t</span><span class="op" id="6594644">,</span>&nbsp;<span class="ident" id="6594646">template</span><span class="op" id="6594654">,</span>&nbsp;<span class="string" id="6594656">&#34;TLSv11-&#34;</span><span class="op" id="6594665">,</span>&nbsp;<span class="string" id="6594667">&#34;-tls1_1&#34;</span><span class="op" id="6594676">)</span><br>
<span class="lineno"></span><span class="op" id="6594678">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6594681">func</span>&nbsp;<span class="ident" id="6594686">runServerTestTLS12</span><span class="op" id="6594704">(</span><span class="ident" id="6594705">t</span>&nbsp;<span class="op" id="6594707">*</span><span class="ident" id="6594708">testing</span><span class="op" id="6594715">.</span><span class="ident" id="6594716">T</span><span class="op" id="6594717">,</span>&nbsp;<span class="ident" id="6594719">template</span>&nbsp;<span class="op" id="6594728">*</span><span class="ident" id="6594729">serverTest</span><span class="op" id="6594739">)</span>&nbsp;<span class="op" id="6594741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594744">runServerTestForVersion</span><span class="op" id="6594767">(</span><span class="ident" id="6594768">t</span><span class="op" id="6594769">,</span>&nbsp;<span class="ident" id="6594771">template</span><span class="op" id="6594779">,</span>&nbsp;<span class="string" id="6594781">&#34;TLSv12-&#34;</span><span class="op" id="6594790">,</span>&nbsp;<span class="string" id="6594792">&#34;-tls1_2&#34;</span><span class="op" id="6594801">)</span><br>
<span class="lineno"></span><span class="op" id="6594803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6594806">func</span>&nbsp;<span class="ident" id="6594811">TestHandshakeServerRSARC4</span><span class="op" id="6594836">(</span><span class="ident" id="6594837">t</span>&nbsp;<span class="op" id="6594839">*</span><span class="ident" id="6594840">testing</span><span class="op" id="6594847">.</span><span class="ident" id="6594848">T</span><span class="op" id="6594849">)</span>&nbsp;<span class="op" id="6594851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594854">test</span>&nbsp;<span class="op" id="6594859">:=</span>&nbsp;<span class="op" id="6594862">&amp;</span><span class="ident" id="6594863">serverTest</span><span class="op" id="6594873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594877">name</span><span class="op" id="6594881">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6594886">&#34;RSA-RC4&#34;</span><span class="op" id="6594895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594899">command</span><span class="op" id="6594906">:</span>&nbsp;<span class="op" id="6594908">[</span><span class="op" id="6594909">]</span><span class="builtintype" id="6594910">string</span><span class="op" id="6594916">{</span><span class="string" id="6594917">&#34;openssl&#34;</span><span class="op" id="6594926">,</span>&nbsp;<span class="string" id="6594928">&#34;s_client&#34;</span><span class="op" id="6594938">,</span>&nbsp;<span class="string" id="6594940">&#34;-no_ticket&#34;</span><span class="op" id="6594952">,</span>&nbsp;<span class="string" id="6594954">&#34;-cipher&#34;</span><span class="op" id="6594963">,</span>&nbsp;<span class="string" id="6594965">&#34;RC4-SHA&#34;</span><span class="op" id="6594974">}</span><span class="op" id="6594975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594978">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6594981">runServerTestSSLv3</span><span class="op" id="6594999">(</span><span class="ident" id="6595000">t</span><span class="op" id="6595001">,</span>&nbsp;<span class="ident" id="6595003">test</span><span class="op" id="6595007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595010">runServerTestTLS10</span><span class="op" id="6595028">(</span><span class="ident" id="6595029">t</span><span class="op" id="6595030">,</span>&nbsp;<span class="ident" id="6595032">test</span><span class="op" id="6595036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595039">runServerTestTLS11</span><span class="op" id="6595057">(</span><span class="ident" id="6595058">t</span><span class="op" id="6595059">,</span>&nbsp;<span class="ident" id="6595061">test</span><span class="op" id="6595065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595068">runServerTestTLS12</span><span class="op" id="6595086">(</span><span class="ident" id="6595087">t</span><span class="op" id="6595088">,</span>&nbsp;<span class="ident" id="6595090">test</span><span class="op" id="6595094">)</span><br>
<span class="lineno"></span><span class="op" id="6595096">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="6595099">func</span>&nbsp;<span class="ident" id="6595104">TestHandshakeServerRSA3DES</span><span class="op" id="6595130">(</span><span class="ident" id="6595131">t</span>&nbsp;<span class="op" id="6595133">*</span><span class="ident" id="6595134">testing</span><span class="op" id="6595141">.</span><span class="ident" id="6595142">T</span><span class="op" id="6595143">)</span>&nbsp;<span class="op" id="6595145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595148">test</span>&nbsp;<span class="op" id="6595153">:=</span>&nbsp;<span class="op" id="6595156">&amp;</span><span class="ident" id="6595157">serverTest</span><span class="op" id="6595167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595171">name</span><span class="op" id="6595175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595180">&#34;RSA-3DES&#34;</span><span class="op" id="6595190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595194">command</span><span class="op" id="6595201">:</span>&nbsp;<span class="op" id="6595203">[</span><span class="op" id="6595204">]</span><span class="builtintype" id="6595205">string</span><span class="op" id="6595211">{</span><span class="string" id="6595212">&#34;openssl&#34;</span><span class="op" id="6595221">,</span>&nbsp;<span class="string" id="6595223">&#34;s_client&#34;</span><span class="op" id="6595233">,</span>&nbsp;<span class="string" id="6595235">&#34;-no_ticket&#34;</span><span class="op" id="6595247">,</span>&nbsp;<span class="string" id="6595249">&#34;-cipher&#34;</span><span class="op" id="6595258">,</span>&nbsp;<span class="string" id="6595260">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="6595274">}</span><span class="op" id="6595275">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595281">runServerTestSSLv3</span><span class="op" id="6595299">(</span><span class="ident" id="6595300">t</span><span class="op" id="6595301">,</span>&nbsp;<span class="ident" id="6595303">test</span><span class="op" id="6595307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595310">runServerTestTLS10</span><span class="op" id="6595328">(</span><span class="ident" id="6595329">t</span><span class="op" id="6595330">,</span>&nbsp;<span class="ident" id="6595332">test</span><span class="op" id="6595336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595339">runServerTestTLS12</span><span class="op" id="6595357">(</span><span class="ident" id="6595358">t</span><span class="op" id="6595359">,</span>&nbsp;<span class="ident" id="6595361">test</span><span class="op" id="6595365">)</span><br>
<span class="lineno"></span><span class="op" id="6595367">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="6595370">func</span>&nbsp;<span class="ident" id="6595375">TestHandshakeServerRSAAES</span><span class="op" id="6595400">(</span><span class="ident" id="6595401">t</span>&nbsp;<span class="op" id="6595403">*</span><span class="ident" id="6595404">testing</span><span class="op" id="6595411">.</span><span class="ident" id="6595412">T</span><span class="op" id="6595413">)</span>&nbsp;<span class="op" id="6595415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595418">test</span>&nbsp;<span class="op" id="6595423">:=</span>&nbsp;<span class="op" id="6595426">&amp;</span><span class="ident" id="6595427">serverTest</span><span class="op" id="6595437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595441">name</span><span class="op" id="6595445">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595450">&#34;RSA-AES&#34;</span><span class="op" id="6595459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595463">command</span><span class="op" id="6595470">:</span>&nbsp;<span class="op" id="6595472">[</span><span class="op" id="6595473">]</span><span class="builtintype" id="6595474">string</span><span class="op" id="6595480">{</span><span class="string" id="6595481">&#34;openssl&#34;</span><span class="op" id="6595490">,</span>&nbsp;<span class="string" id="6595492">&#34;s_client&#34;</span><span class="op" id="6595502">,</span>&nbsp;<span class="string" id="6595504">&#34;-no_ticket&#34;</span><span class="op" id="6595516">,</span>&nbsp;<span class="string" id="6595518">&#34;-cipher&#34;</span><span class="op" id="6595527">,</span>&nbsp;<span class="string" id="6595529">&#34;AES128-SHA&#34;</span><span class="op" id="6595541">}</span><span class="op" id="6595542">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595548">runServerTestSSLv3</span><span class="op" id="6595566">(</span><span class="ident" id="6595567">t</span><span class="op" id="6595568">,</span>&nbsp;<span class="ident" id="6595570">test</span><span class="op" id="6595574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595577">runServerTestTLS10</span><span class="op" id="6595595">(</span><span class="ident" id="6595596">t</span><span class="op" id="6595597">,</span>&nbsp;<span class="ident" id="6595599">test</span><span class="op" id="6595603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595606">runServerTestTLS12</span><span class="op" id="6595624">(</span><span class="ident" id="6595625">t</span><span class="op" id="6595626">,</span>&nbsp;<span class="ident" id="6595628">test</span><span class="op" id="6595632">)</span><br>
<span class="lineno"></span><span class="op" id="6595634">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="6595637">func</span>&nbsp;<span class="ident" id="6595642">TestHandshakeServerAESGCM</span><span class="op" id="6595667">(</span><span class="ident" id="6595668">t</span>&nbsp;<span class="op" id="6595670">*</span><span class="ident" id="6595671">testing</span><span class="op" id="6595678">.</span><span class="ident" id="6595679">T</span><span class="op" id="6595680">)</span>&nbsp;<span class="op" id="6595682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595685">test</span>&nbsp;<span class="op" id="6595690">:=</span>&nbsp;<span class="op" id="6595693">&amp;</span><span class="ident" id="6595694">serverTest</span><span class="op" id="6595704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595708">name</span><span class="op" id="6595712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595717">&#34;RSA-AES-GCM&#34;</span><span class="op" id="6595730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595734">command</span><span class="op" id="6595741">:</span>&nbsp;<span class="op" id="6595743">[</span><span class="op" id="6595744">]</span><span class="builtintype" id="6595745">string</span><span class="op" id="6595751">{</span><span class="string" id="6595752">&#34;openssl&#34;</span><span class="op" id="6595761">,</span>&nbsp;<span class="string" id="6595763">&#34;s_client&#34;</span><span class="op" id="6595773">,</span>&nbsp;<span class="string" id="6595775">&#34;-no_ticket&#34;</span><span class="op" id="6595787">,</span>&nbsp;<span class="string" id="6595789">&#34;-cipher&#34;</span><span class="op" id="6595798">,</span>&nbsp;<span class="string" id="6595800">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6595829">}</span><span class="op" id="6595830">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595836">runServerTestTLS12</span><span class="op" id="6595854">(</span><span class="ident" id="6595855">t</span><span class="op" id="6595856">,</span>&nbsp;<span class="ident" id="6595858">test</span><span class="op" id="6595862">)</span><br>
<span class="lineno"></span><span class="op" id="6595864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595867">func</span>&nbsp;<span class="ident" id="6595872">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="6595904">(</span><span class="ident" id="6595905">t</span>&nbsp;<span class="op" id="6595907">*</span><span class="ident" id="6595908">testing</span><span class="op" id="6595915">.</span><span class="ident" id="6595916">T</span><span class="op" id="6595917">)</span>&nbsp;<span class="op" id="6595919">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595922">config</span>&nbsp;<span class="op" id="6595929">:=</span>&nbsp;<span class="op" id="6595932">*</span><span class="ident" id="6595933">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595945">config</span><span class="op" id="6595951">.</span><span class="ident" id="6595952">Certificates</span>&nbsp;<span class="op" id="6595965">=</span>&nbsp;<span class="builtinfunc" id="6595967">make</span><span class="op" id="6595971">(</span><span class="op" id="6595972">[</span><span class="op" id="6595973">]</span><span class="ident" id="6595974">Certificate</span><span class="op" id="6595985">,</span>&nbsp;<span class="num" id="6595987">1</span><span class="op" id="6595988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6595991">config</span><span class="op" id="6595997">.</span><span class="ident" id="6595998">Certificates</span><span class="op" id="6596010">[</span><span class="num" id="6596011">0</span><span class="op" id="6596012">]</span><span class="op" id="6596013">.</span><span class="ident" id="6596014">Certificate</span>&nbsp;<span class="op" id="6596026">=</span>&nbsp;<span class="op" id="6596028">[</span><span class="op" id="6596029">]</span><span class="op" id="6596030">[</span><span class="op" id="6596031">]</span><span class="builtintype" id="6596032">byte</span><span class="op" id="6596036">{</span><span class="ident" id="6596037">testECDSACertificate</span><span class="op" id="6596057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596060">config</span><span class="op" id="6596066">.</span><span class="ident" id="6596067">Certificates</span><span class="op" id="6596079">[</span><span class="num" id="6596080">0</span><span class="op" id="6596081">]</span><span class="op" id="6596082">.</span><span class="ident" id="6596083">PrivateKey</span>&nbsp;<span class="op" id="6596094">=</span>&nbsp;<span class="ident" id="6596096">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596117">config</span><span class="op" id="6596123">.</span><span class="ident" id="6596124">BuildNameToCertificate</span><span class="op" id="6596146">(</span><span class="op" id="6596147">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596151">test</span>&nbsp;<span class="op" id="6596156">:=</span>&nbsp;<span class="op" id="6596159">&amp;</span><span class="ident" id="6596160">serverTest</span><span class="op" id="6596170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596174">name</span><span class="op" id="6596178">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6596183">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6596200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596204">command</span><span class="op" id="6596211">:</span>&nbsp;<span class="op" id="6596213">[</span><span class="op" id="6596214">]</span><span class="builtintype" id="6596215">string</span><span class="op" id="6596221">{</span><span class="string" id="6596222">&#34;openssl&#34;</span><span class="op" id="6596231">,</span>&nbsp;<span class="string" id="6596233">&#34;s_client&#34;</span><span class="op" id="6596243">,</span>&nbsp;<span class="string" id="6596245">&#34;-no_ticket&#34;</span><span class="op" id="6596257">,</span>&nbsp;<span class="string" id="6596259">&#34;-cipher&#34;</span><span class="op" id="6596268">,</span>&nbsp;<span class="string" id="6596270">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="6596294">}</span><span class="op" id="6596295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596299">config</span><span class="op" id="6596305">:</span>&nbsp;&nbsp;<span class="op" id="6596308">&amp;</span><span class="ident" id="6596309">config</span><span class="op" id="6596315">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596321">runServerTestTLS10</span><span class="op" id="6596339">(</span><span class="ident" id="6596340">t</span><span class="op" id="6596341">,</span>&nbsp;<span class="ident" id="6596343">test</span><span class="op" id="6596347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596350">runServerTestTLS12</span><span class="op" id="6596368">(</span><span class="ident" id="6596369">t</span><span class="op" id="6596370">,</span>&nbsp;<span class="ident" id="6596372">test</span><span class="op" id="6596376">)</span><br>
<span class="lineno"></span><span class="op" id="6596378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="6596381">func</span>&nbsp;<span class="ident" id="6596386">TestHandshakeServerALPN</span><span class="op" id="6596409">(</span><span class="ident" id="6596410">t</span>&nbsp;<span class="op" id="6596412">*</span><span class="ident" id="6596413">testing</span><span class="op" id="6596420">.</span><span class="ident" id="6596421">T</span><span class="op" id="6596422">)</span>&nbsp;<span class="op" id="6596424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596427">config</span>&nbsp;<span class="op" id="6596434">:=</span>&nbsp;<span class="op" id="6596437">*</span><span class="ident" id="6596438">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596450">config</span><span class="op" id="6596456">.</span><span class="ident" id="6596457">NextProtos</span>&nbsp;<span class="op" id="6596468">=</span>&nbsp;<span class="op" id="6596470">[</span><span class="op" id="6596471">]</span><span class="builtintype" id="6596472">string</span><span class="op" id="6596478">{</span><span class="string" id="6596479">&#34;proto1&#34;</span><span class="op" id="6596487">,</span>&nbsp;<span class="string" id="6596489">&#34;proto2&#34;</span><span class="op" id="6596497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596501">test</span>&nbsp;<span class="op" id="6596506">:=</span>&nbsp;<span class="op" id="6596509">&amp;</span><span class="ident" id="6596510">serverTest</span><span class="op" id="6596520">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596524">name</span><span class="op" id="6596528">:</span>&nbsp;<span class="string" id="6596530">&#34;ALPN&#34;</span><span class="op" id="6596536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6596540">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6596606">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596649">command</span><span class="op" id="6596656">:</span>&nbsp;<span class="op" id="6596658">[</span><span class="op" id="6596659">]</span><span class="builtintype" id="6596660">string</span><span class="op" id="6596666">{</span><span class="string" id="6596667">&#34;openssl&#34;</span><span class="op" id="6596676">,</span>&nbsp;<span class="string" id="6596678">&#34;s_client&#34;</span><span class="op" id="6596688">,</span>&nbsp;<span class="string" id="6596690">&#34;-alpn&#34;</span><span class="op" id="6596697">,</span>&nbsp;<span class="string" id="6596699">&#34;proto2,proto1&#34;</span><span class="op" id="6596714">}</span><span class="op" id="6596715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596719">config</span><span class="op" id="6596725">:</span>&nbsp;&nbsp;<span class="op" id="6596728">&amp;</span><span class="ident" id="6596729">config</span><span class="op" id="6596735">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596739">validate</span><span class="op" id="6596747">:</span>&nbsp;<span class="keyword" id="6596749">func</span><span class="op" id="6596753">(</span><span class="ident" id="6596754">state</span>&nbsp;<span class="ident" id="6596760">ConnectionState</span><span class="op" id="6596775">)</span>&nbsp;<span class="builtintype" id="6596777">error</span>&nbsp;<span class="op" id="6596783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6596788">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596847">if</span>&nbsp;<span class="ident" id="6596850">state</span><span class="op" id="6596855">.</span><span class="ident" id="6596856">NegotiatedProtocol</span>&nbsp;<span class="op" id="6596875">!=</span>&nbsp;<span class="string" id="6596878">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6596887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596893">return</span>&nbsp;<span class="ident" id="6596900">fmt</span><span class="op" id="6596903">.</span><span class="ident" id="6596904">Errorf</span><span class="op" id="6596910">(</span><span class="string" id="6596911">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6596943">,</span>&nbsp;<span class="ident" id="6596945">state</span><span class="op" id="6596950">.</span><span class="ident" id="6596951">NegotiatedProtocol</span><span class="op" id="6596969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596974">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596979">return</span>&nbsp;<span class="builtintype" id="6596986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596992">}</span><span class="op" id="6596993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596999">runServerTestTLS12</span><span class="op" id="6597017">(</span><span class="ident" id="6597018">t</span><span class="op" id="6597019">,</span>&nbsp;<span class="ident" id="6597021">test</span><span class="op" id="6597025">)</span><br>
<span class="lineno"></span><span class="op" id="6597027">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="6597030">func</span>&nbsp;<span class="ident" id="6597035">TestHandshakeServerALPNNoMatch</span><span class="op" id="6597065">(</span><span class="ident" id="6597066">t</span>&nbsp;<span class="op" id="6597068">*</span><span class="ident" id="6597069">testing</span><span class="op" id="6597076">.</span><span class="ident" id="6597077">T</span><span class="op" id="6597078">)</span>&nbsp;<span class="op" id="6597080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597083">config</span>&nbsp;<span class="op" id="6597090">:=</span>&nbsp;<span class="op" id="6597093">*</span><span class="ident" id="6597094">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597106">config</span><span class="op" id="6597112">.</span><span class="ident" id="6597113">NextProtos</span>&nbsp;<span class="op" id="6597124">=</span>&nbsp;<span class="op" id="6597126">[</span><span class="op" id="6597127">]</span><span class="builtintype" id="6597128">string</span><span class="op" id="6597134">{</span><span class="string" id="6597135">&#34;proto3&#34;</span><span class="op" id="6597143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597147">test</span>&nbsp;<span class="op" id="6597152">:=</span>&nbsp;<span class="op" id="6597155">&amp;</span><span class="ident" id="6597156">serverTest</span><span class="op" id="6597166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597170">name</span><span class="op" id="6597174">:</span>&nbsp;<span class="string" id="6597176">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6597190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6597194">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6597260">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597303">command</span><span class="op" id="6597310">:</span>&nbsp;<span class="op" id="6597312">[</span><span class="op" id="6597313">]</span><span class="builtintype" id="6597314">string</span><span class="op" id="6597320">{</span><span class="string" id="6597321">&#34;openssl&#34;</span><span class="op" id="6597330">,</span>&nbsp;<span class="string" id="6597332">&#34;s_client&#34;</span><span class="op" id="6597342">,</span>&nbsp;<span class="string" id="6597344">&#34;-alpn&#34;</span><span class="op" id="6597351">,</span>&nbsp;<span class="string" id="6597353">&#34;proto2,proto1&#34;</span><span class="op" id="6597368">}</span><span class="op" id="6597369">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597373">config</span><span class="op" id="6597379">:</span>&nbsp;&nbsp;<span class="op" id="6597382">&amp;</span><span class="ident" id="6597383">config</span><span class="op" id="6597389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597393">validate</span><span class="op" id="6597401">:</span>&nbsp;<span class="keyword" id="6597403">func</span><span class="op" id="6597407">(</span><span class="ident" id="6597408">state</span>&nbsp;<span class="ident" id="6597414">ConnectionState</span><span class="op" id="6597429">)</span>&nbsp;<span class="builtintype" id="6597431">error</span>&nbsp;<span class="op" id="6597437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6597442">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6597501">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597544">if</span>&nbsp;<span class="ident" id="6597547">state</span><span class="op" id="6597552">.</span><span class="ident" id="6597553">NegotiatedProtocol</span>&nbsp;<span class="op" id="6597572">!=</span>&nbsp;<span class="string" id="6597575">&#34;&#34;</span>&nbsp;<span class="op" id="6597578">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597584">return</span>&nbsp;<span class="ident" id="6597591">fmt</span><span class="op" id="6597594">.</span><span class="ident" id="6597595">Errorf</span><span class="op" id="6597601">(</span><span class="string" id="6597602">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6597630">,</span>&nbsp;<span class="ident" id="6597632">state</span><span class="op" id="6597637">.</span><span class="ident" id="6597638">NegotiatedProtocol</span><span class="op" id="6597656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597666">return</span>&nbsp;<span class="builtintype" id="6597673">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597679">}</span><span class="op" id="6597680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597683">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597686">runServerTestTLS12</span><span class="op" id="6597704">(</span><span class="ident" id="6597705">t</span><span class="op" id="6597706">,</span>&nbsp;<span class="ident" id="6597708">test</span><span class="op" id="6597712">)</span><br>
<span class="lineno"></span><span class="op" id="6597714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6597717">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6597789">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="6597869">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6597933">func</span>&nbsp;<span class="ident" id="6597938">TestHandshakeServerSNI</span><span class="op" id="6597960">(</span><span class="ident" id="6597961">t</span>&nbsp;<span class="op" id="6597963">*</span><span class="ident" id="6597964">testing</span><span class="op" id="6597971">.</span><span class="ident" id="6597972">T</span><span class="op" id="6597973">)</span>&nbsp;<span class="op" id="6597975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597978">test</span>&nbsp;<span class="op" id="6597983">:=</span>&nbsp;<span class="op" id="6597986">&amp;</span><span class="ident" id="6597987">serverTest</span><span class="op" id="6597997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598001">name</span><span class="op" id="6598005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6598010">&#34;SNI&#34;</span><span class="op" id="6598015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598019">command</span><span class="op" id="6598026">:</span>&nbsp;<span class="op" id="6598028">[</span><span class="op" id="6598029">]</span><span class="builtintype" id="6598030">string</span><span class="op" id="6598036">{</span><span class="string" id="6598037">&#34;openssl&#34;</span><span class="op" id="6598046">,</span>&nbsp;<span class="string" id="6598048">&#34;s_client&#34;</span><span class="op" id="6598058">,</span>&nbsp;<span class="string" id="6598060">&#34;-no_ticket&#34;</span><span class="op" id="6598072">,</span>&nbsp;<span class="string" id="6598074">&#34;-cipher&#34;</span><span class="op" id="6598083">,</span>&nbsp;<span class="string" id="6598085">&#34;AES128-SHA&#34;</span><span class="op" id="6598097">,</span>&nbsp;<span class="string" id="6598099">&#34;-servername&#34;</span><span class="op" id="6598112">,</span>&nbsp;<span class="string" id="6598114">&#34;snitest.com&#34;</span><span class="op" id="6598127">}</span><span class="op" id="6598128">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598134">runServerTestTLS12</span><span class="op" id="6598152">(</span><span class="ident" id="6598153">t</span><span class="op" id="6598154">,</span>&nbsp;<span class="ident" id="6598156">test</span><span class="op" id="6598160">)</span><br>
<span class="lineno"></span><span class="op" id="6598162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6598165">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="6598244">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="6598287">func</span>&nbsp;<span class="ident" id="6598292">TestHandshakeServerSNIGetCertificate</span><span class="op" id="6598328">(</span><span class="ident" id="6598329">t</span>&nbsp;<span class="op" id="6598331">*</span><span class="ident" id="6598332">testing</span><span class="op" id="6598339">.</span><span class="ident" id="6598340">T</span><span class="op" id="6598341">)</span>&nbsp;<span class="op" id="6598343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598346">config</span>&nbsp;<span class="op" id="6598353">:=</span>&nbsp;<span class="op" id="6598356">*</span><span class="ident" id="6598357">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6598370">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598439">nameToCert</span>&nbsp;<span class="op" id="6598450">:=</span>&nbsp;<span class="ident" id="6598453">config</span><span class="op" id="6598459">.</span><span class="ident" id="6598460">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598479">config</span><span class="op" id="6598485">.</span><span class="ident" id="6598486">NameToCertificate</span>&nbsp;<span class="op" id="6598504">=</span>&nbsp;<span class="builtintype" id="6598506">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598511">config</span><span class="op" id="6598517">.</span><span class="ident" id="6598518">GetCertificate</span>&nbsp;<span class="op" id="6598533">=</span>&nbsp;<span class="keyword" id="6598535">func</span><span class="op" id="6598539">(</span><span class="ident" id="6598540">clientHello</span>&nbsp;<span class="op" id="6598552">*</span><span class="ident" id="6598553">ClientHelloInfo</span><span class="op" id="6598568">)</span>&nbsp;<span class="op" id="6598570">(</span><span class="op" id="6598571">*</span><span class="ident" id="6598572">Certificate</span><span class="op" id="6598583">,</span>&nbsp;<span class="builtintype" id="6598585">error</span><span class="op" id="6598590">)</span>&nbsp;<span class="op" id="6598592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598596">cert</span><span class="op" id="6598600">,</span>&nbsp;<span class="ident" id="6598602">_</span>&nbsp;<span class="op" id="6598604">:=</span>&nbsp;<span class="ident" id="6598607">nameToCert</span><span class="op" id="6598617">[</span><span class="ident" id="6598618">clientHello</span><span class="op" id="6598629">.</span><span class="ident" id="6598630">ServerName</span><span class="op" id="6598640">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598644">return</span>&nbsp;<span class="ident" id="6598651">cert</span><span class="op" id="6598655">,</span>&nbsp;<span class="builtintype" id="6598657">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598665">test</span>&nbsp;<span class="op" id="6598670">:=</span>&nbsp;<span class="op" id="6598673">&amp;</span><span class="ident" id="6598674">serverTest</span><span class="op" id="6598684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598688">name</span><span class="op" id="6598692">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6598697">&#34;SNI&#34;</span><span class="op" id="6598702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598706">command</span><span class="op" id="6598713">:</span>&nbsp;<span class="op" id="6598715">[</span><span class="op" id="6598716">]</span><span class="builtintype" id="6598717">string</span><span class="op" id="6598723">{</span><span class="string" id="6598724">&#34;openssl&#34;</span><span class="op" id="6598733">,</span>&nbsp;<span class="string" id="6598735">&#34;s_client&#34;</span><span class="op" id="6598745">,</span>&nbsp;<span class="string" id="6598747">&#34;-no_ticket&#34;</span><span class="op" id="6598759">,</span>&nbsp;<span class="string" id="6598761">&#34;-cipher&#34;</span><span class="op" id="6598770">,</span>&nbsp;<span class="string" id="6598772">&#34;AES128-SHA&#34;</span><span class="op" id="6598784">,</span>&nbsp;<span class="string" id="6598786">&#34;-servername&#34;</span><span class="op" id="6598799">,</span>&nbsp;<span class="string" id="6598801">&#34;snitest.com&#34;</span><span class="op" id="6598814">}</span><span class="op" id="6598815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598819">config</span><span class="op" id="6598825">:</span>&nbsp;&nbsp;<span class="op" id="6598828">&amp;</span><span class="ident" id="6598829">config</span><span class="op" id="6598835">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598841">runServerTestTLS12</span><span class="op" id="6598859">(</span><span class="ident" id="6598860">t</span><span class="op" id="6598861">,</span>&nbsp;<span class="ident" id="6598863">test</span><span class="op" id="6598867">)</span><br>
<span class="lineno"></span><span class="op" id="6598869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6598872">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="6598931">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6599006">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6599080">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="6599110">func</span>&nbsp;<span class="ident" id="6599115">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="6599159">(</span><span class="ident" id="6599160">t</span>&nbsp;<span class="op" id="6599162">*</span><span class="ident" id="6599163">testing</span><span class="op" id="6599170">.</span><span class="ident" id="6599171">T</span><span class="op" id="6599172">)</span>&nbsp;<span class="op" id="6599174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599177">config</span>&nbsp;<span class="op" id="6599184">:=</span>&nbsp;<span class="op" id="6599187">*</span><span class="ident" id="6599188">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599201">config</span><span class="op" id="6599207">.</span><span class="ident" id="6599208">GetCertificate</span>&nbsp;<span class="op" id="6599223">=</span>&nbsp;<span class="keyword" id="6599225">func</span><span class="op" id="6599229">(</span><span class="ident" id="6599230">clientHello</span>&nbsp;<span class="op" id="6599242">*</span><span class="ident" id="6599243">ClientHelloInfo</span><span class="op" id="6599258">)</span>&nbsp;<span class="op" id="6599260">(</span><span class="op" id="6599261">*</span><span class="ident" id="6599262">Certificate</span><span class="op" id="6599273">,</span>&nbsp;<span class="builtintype" id="6599275">error</span><span class="op" id="6599280">)</span>&nbsp;<span class="op" id="6599282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599286">return</span>&nbsp;<span class="builtintype" id="6599293">nil</span><span class="op" id="6599296">,</span>&nbsp;<span class="builtintype" id="6599298">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599306">test</span>&nbsp;<span class="op" id="6599311">:=</span>&nbsp;<span class="op" id="6599314">&amp;</span><span class="ident" id="6599315">serverTest</span><span class="op" id="6599325">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599329">name</span><span class="op" id="6599333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6599338">&#34;SNI&#34;</span><span class="op" id="6599343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599347">command</span><span class="op" id="6599354">:</span>&nbsp;<span class="op" id="6599356">[</span><span class="op" id="6599357">]</span><span class="builtintype" id="6599358">string</span><span class="op" id="6599364">{</span><span class="string" id="6599365">&#34;openssl&#34;</span><span class="op" id="6599374">,</span>&nbsp;<span class="string" id="6599376">&#34;s_client&#34;</span><span class="op" id="6599386">,</span>&nbsp;<span class="string" id="6599388">&#34;-no_ticket&#34;</span><span class="op" id="6599400">,</span>&nbsp;<span class="string" id="6599402">&#34;-cipher&#34;</span><span class="op" id="6599411">,</span>&nbsp;<span class="string" id="6599413">&#34;AES128-SHA&#34;</span><span class="op" id="6599425">,</span>&nbsp;<span class="string" id="6599427">&#34;-servername&#34;</span><span class="op" id="6599440">,</span>&nbsp;<span class="string" id="6599442">&#34;snitest.com&#34;</span><span class="op" id="6599455">}</span><span class="op" id="6599456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599460">config</span><span class="op" id="6599466">:</span>&nbsp;&nbsp;<span class="op" id="6599469">&amp;</span><span class="ident" id="6599470">config</span><span class="op" id="6599476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599482">runServerTestTLS12</span><span class="op" id="6599500">(</span><span class="ident" id="6599501">t</span><span class="op" id="6599502">,</span>&nbsp;<span class="ident" id="6599504">test</span><span class="op" id="6599508">)</span><br>
<span class="lineno">625</span><span class="op" id="6599510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6599513">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6599589">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="6599630">func</span>&nbsp;<span class="ident" id="6599635">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="6599676">(</span><span class="ident" id="6599677">t</span>&nbsp;<span class="op" id="6599679">*</span><span class="ident" id="6599680">testing</span><span class="op" id="6599687">.</span><span class="ident" id="6599688">T</span><span class="op" id="6599689">)</span>&nbsp;<span class="op" id="6599691">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599694">config</span>&nbsp;<span class="op" id="6599701">:=</span>&nbsp;<span class="op" id="6599704">*</span><span class="ident" id="6599705">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599718">config</span><span class="op" id="6599724">.</span><span class="ident" id="6599725">GetCertificate</span>&nbsp;<span class="op" id="6599740">=</span>&nbsp;<span class="keyword" id="6599742">func</span><span class="op" id="6599746">(</span><span class="ident" id="6599747">clientHello</span>&nbsp;<span class="op" id="6599759">*</span><span class="ident" id="6599760">ClientHelloInfo</span><span class="op" id="6599775">)</span>&nbsp;<span class="op" id="6599777">(</span><span class="op" id="6599778">*</span><span class="ident" id="6599779">Certificate</span><span class="op" id="6599790">,</span>&nbsp;<span class="builtintype" id="6599792">error</span><span class="op" id="6599797">)</span>&nbsp;<span class="op" id="6599799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599803">return</span>&nbsp;<span class="builtintype" id="6599810">nil</span><span class="op" id="6599813">,</span>&nbsp;<span class="ident" id="6599815">fmt</span><span class="op" id="6599818">.</span><span class="ident" id="6599819">Errorf</span><span class="op" id="6599825">(</span><span class="string" id="6599826">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="6599856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599859">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599862">test</span>&nbsp;<span class="op" id="6599867">:=</span>&nbsp;<span class="op" id="6599870">&amp;</span><span class="ident" id="6599871">serverTest</span><span class="op" id="6599881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599885">name</span><span class="op" id="6599889">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6599898">&#34;SNI&#34;</span><span class="op" id="6599903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599907">command</span><span class="op" id="6599914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599920">[</span><span class="op" id="6599921">]</span><span class="builtintype" id="6599922">string</span><span class="op" id="6599928">{</span><span class="string" id="6599929">&#34;openssl&#34;</span><span class="op" id="6599938">,</span>&nbsp;<span class="string" id="6599940">&#34;s_client&#34;</span><span class="op" id="6599950">,</span>&nbsp;<span class="string" id="6599952">&#34;-no_ticket&#34;</span><span class="op" id="6599964">,</span>&nbsp;<span class="string" id="6599966">&#34;-cipher&#34;</span><span class="op" id="6599975">,</span>&nbsp;<span class="string" id="6599977">&#34;AES128-SHA&#34;</span><span class="op" id="6599989">,</span>&nbsp;<span class="string" id="6599991">&#34;-servername&#34;</span><span class="op" id="6600004">,</span>&nbsp;<span class="string" id="6600006">&#34;snitest.com&#34;</span><span class="op" id="6600019">}</span><span class="op" id="6600020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600024">config</span><span class="op" id="6600030">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600037">&amp;</span><span class="ident" id="6600038">config</span><span class="op" id="6600044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600048">expectAlert</span><span class="op" id="6600059">:</span>&nbsp;<span class="builtintype" id="6600061">true</span><span class="op" id="6600065">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600071">runServerTestTLS12</span><span class="op" id="6600089">(</span><span class="ident" id="6600090">t</span><span class="op" id="6600091">,</span>&nbsp;<span class="ident" id="6600093">test</span><span class="op" id="6600097">)</span><br>
<span class="lineno"></span><span class="op" id="6600099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6600102">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="6600182">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6600256">func</span>&nbsp;<span class="ident" id="6600261">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="6600295">(</span><span class="ident" id="6600296">t</span>&nbsp;<span class="op" id="6600298">*</span><span class="ident" id="6600299">testing</span><span class="op" id="6600306">.</span><span class="ident" id="6600307">T</span><span class="op" id="6600308">)</span>&nbsp;<span class="op" id="6600310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600313">config</span>&nbsp;<span class="op" id="6600320">:=</span>&nbsp;<span class="op" id="6600323">*</span><span class="ident" id="6600324">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600336">config</span><span class="op" id="6600342">.</span><span class="ident" id="6600343">CipherSuites</span>&nbsp;<span class="op" id="6600356">=</span>&nbsp;<span class="op" id="6600358">[</span><span class="op" id="6600359">]</span><span class="builtintype" id="6600360">uint16</span><span class="op" id="6600366">{</span><span class="ident" id="6600367">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6600403">,</span>&nbsp;<span class="ident" id="6600405">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6600439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600442">config</span><span class="op" id="6600448">.</span><span class="ident" id="6600449">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6600474">=</span>&nbsp;<span class="builtintype" id="6600476">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600483">test</span>&nbsp;<span class="op" id="6600488">:=</span>&nbsp;<span class="op" id="6600491">&amp;</span><span class="ident" id="6600492">serverTest</span><span class="op" id="6600502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600506">name</span><span class="op" id="6600510">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6600514">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="6600544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600548">config</span><span class="op" id="6600554">:</span>&nbsp;<span class="op" id="6600556">&amp;</span><span class="ident" id="6600557">config</span><span class="op" id="6600563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600566">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600569">runServerTestTLS12</span><span class="op" id="6600587">(</span><span class="ident" id="6600588">t</span><span class="op" id="6600589">,</span>&nbsp;<span class="ident" id="6600591">test</span><span class="op" id="6600595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600599">config</span>&nbsp;<span class="op" id="6600606">=</span>&nbsp;<span class="op" id="6600608">*</span><span class="ident" id="6600609">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600621">config</span><span class="op" id="6600627">.</span><span class="ident" id="6600628">CipherSuites</span>&nbsp;<span class="op" id="6600641">=</span>&nbsp;<span class="op" id="6600643">[</span><span class="op" id="6600644">]</span><span class="builtintype" id="6600645">uint16</span><span class="op" id="6600651">{</span><span class="ident" id="6600652">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6600686">,</span>&nbsp;<span class="ident" id="6600688">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6600724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600727">config</span><span class="op" id="6600733">.</span><span class="ident" id="6600734">Certificates</span>&nbsp;<span class="op" id="6600747">=</span>&nbsp;<span class="op" id="6600749">[</span><span class="op" id="6600750">]</span><span class="ident" id="6600751">Certificate</span><span class="op" id="6600762">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600771">Certificate</span><span class="op" id="6600782">:</span>&nbsp;<span class="op" id="6600784">[</span><span class="op" id="6600785">]</span><span class="op" id="6600786">[</span><span class="op" id="6600787">]</span><span class="builtintype" id="6600788">byte</span><span class="op" id="6600792">{</span><span class="ident" id="6600793">testECDSACertificate</span><span class="op" id="6600813">}</span><span class="op" id="6600814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600819">PrivateKey</span><span class="op" id="6600829">:</span>&nbsp;&nbsp;<span class="ident" id="6600832">testECDSAPrivateKey</span><span class="op" id="6600851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600855">}</span><span class="op" id="6600856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600859">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600862">config</span><span class="op" id="6600868">.</span><span class="ident" id="6600869">BuildNameToCertificate</span><span class="op" id="6600891">(</span><span class="op" id="6600892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600895">config</span><span class="op" id="6600901">.</span><span class="ident" id="6600902">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6600927">=</span>&nbsp;<span class="builtintype" id="6600929">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600936">test</span>&nbsp;<span class="op" id="6600941">=</span>&nbsp;<span class="op" id="6600943">&amp;</span><span class="ident" id="6600944">serverTest</span><span class="op" id="6600954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600958">name</span><span class="op" id="6600962">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6600966">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="6600998">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601002">config</span><span class="op" id="6601008">:</span>&nbsp;<span class="op" id="6601010">&amp;</span><span class="ident" id="6601011">config</span><span class="op" id="6601017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601023">runServerTestTLS12</span><span class="op" id="6601041">(</span><span class="ident" id="6601042">t</span><span class="op" id="6601043">,</span>&nbsp;<span class="ident" id="6601045">test</span><span class="op" id="6601049">)</span><br>
<span class="lineno"></span><span class="op" id="6601051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6601054">func</span>&nbsp;<span class="ident" id="6601059">TestResumption</span><span class="op" id="6601073">(</span><span class="ident" id="6601074">t</span>&nbsp;<span class="op" id="6601076">*</span><span class="ident" id="6601077">testing</span><span class="op" id="6601084">.</span><span class="ident" id="6601085">T</span><span class="op" id="6601086">)</span>&nbsp;<span class="op" id="6601088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601091">sessionFilePath</span>&nbsp;<span class="op" id="6601107">:=</span>&nbsp;<span class="ident" id="6601110">tempFile</span><span class="op" id="6601118">(</span><span class="string" id="6601119">&#34;&#34;</span><span class="op" id="6601121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601124">defer</span>&nbsp;<span class="ident" id="6601130">os</span><span class="op" id="6601132">.</span><span class="ident" id="6601133">Remove</span><span class="op" id="6601139">(</span><span class="ident" id="6601140">sessionFilePath</span><span class="op" id="6601155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601159">test</span>&nbsp;<span class="op" id="6601164">:=</span>&nbsp;<span class="op" id="6601167">&amp;</span><span class="ident" id="6601168">serverTest</span><span class="op" id="6601178">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601182">name</span><span class="op" id="6601186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6601191">&#34;IssueTicket&#34;</span><span class="op" id="6601204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601208">command</span><span class="op" id="6601215">:</span>&nbsp;<span class="op" id="6601217">[</span><span class="op" id="6601218">]</span><span class="builtintype" id="6601219">string</span><span class="op" id="6601225">{</span><span class="string" id="6601226">&#34;openssl&#34;</span><span class="op" id="6601235">,</span>&nbsp;<span class="string" id="6601237">&#34;s_client&#34;</span><span class="op" id="6601247">,</span>&nbsp;<span class="string" id="6601249">&#34;-cipher&#34;</span><span class="op" id="6601258">,</span>&nbsp;<span class="string" id="6601260">&#34;RC4-SHA&#34;</span><span class="op" id="6601269">,</span>&nbsp;<span class="string" id="6601271">&#34;-sess_out&#34;</span><span class="op" id="6601282">,</span>&nbsp;<span class="ident" id="6601284">sessionFilePath</span><span class="op" id="6601299">}</span><span class="op" id="6601300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601306">runServerTestTLS12</span><span class="op" id="6601324">(</span><span class="ident" id="6601325">t</span><span class="op" id="6601326">,</span>&nbsp;<span class="ident" id="6601328">test</span><span class="op" id="6601332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601336">test</span>&nbsp;<span class="op" id="6601341">=</span>&nbsp;<span class="op" id="6601343">&amp;</span><span class="ident" id="6601344">serverTest</span><span class="op" id="6601354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601358">name</span><span class="op" id="6601362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6601367">&#34;Resume&#34;</span><span class="op" id="6601375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601379">command</span><span class="op" id="6601386">:</span>&nbsp;<span class="op" id="6601388">[</span><span class="op" id="6601389">]</span><span class="builtintype" id="6601390">string</span><span class="op" id="6601396">{</span><span class="string" id="6601397">&#34;openssl&#34;</span><span class="op" id="6601406">,</span>&nbsp;<span class="string" id="6601408">&#34;s_client&#34;</span><span class="op" id="6601418">,</span>&nbsp;<span class="string" id="6601420">&#34;-cipher&#34;</span><span class="op" id="6601429">,</span>&nbsp;<span class="string" id="6601431">&#34;RC4-SHA&#34;</span><span class="op" id="6601440">,</span>&nbsp;<span class="string" id="6601442">&#34;-sess_in&#34;</span><span class="op" id="6601452">,</span>&nbsp;<span class="ident" id="6601454">sessionFilePath</span><span class="op" id="6601469">}</span><span class="op" id="6601470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601476">runServerTestTLS12</span><span class="op" id="6601494">(</span><span class="ident" id="6601495">t</span><span class="op" id="6601496">,</span>&nbsp;<span class="ident" id="6601498">test</span><span class="op" id="6601502">)</span><br>
<span class="lineno">690</span><span class="op" id="6601504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6601507">func</span>&nbsp;<span class="ident" id="6601512">TestResumptionDisabled</span><span class="op" id="6601534">(</span><span class="ident" id="6601535">t</span>&nbsp;<span class="op" id="6601537">*</span><span class="ident" id="6601538">testing</span><span class="op" id="6601545">.</span><span class="ident" id="6601546">T</span><span class="op" id="6601547">)</span>&nbsp;<span class="op" id="6601549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601552">sessionFilePath</span>&nbsp;<span class="op" id="6601568">:=</span>&nbsp;<span class="ident" id="6601571">tempFile</span><span class="op" id="6601579">(</span><span class="string" id="6601580">&#34;&#34;</span><span class="op" id="6601582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601585">defer</span>&nbsp;<span class="ident" id="6601591">os</span><span class="op" id="6601593">.</span><span class="ident" id="6601594">Remove</span><span class="op" id="6601600">(</span><span class="ident" id="6601601">sessionFilePath</span><span class="op" id="6601616">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601620">config</span>&nbsp;<span class="op" id="6601627">:=</span>&nbsp;<span class="op" id="6601630">*</span><span class="ident" id="6601631">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601644">test</span>&nbsp;<span class="op" id="6601649">:=</span>&nbsp;<span class="op" id="6601652">&amp;</span><span class="ident" id="6601653">serverTest</span><span class="op" id="6601663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601667">name</span><span class="op" id="6601671">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6601676">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="6601699">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601703">command</span><span class="op" id="6601710">:</span>&nbsp;<span class="op" id="6601712">[</span><span class="op" id="6601713">]</span><span class="builtintype" id="6601714">string</span><span class="op" id="6601720">{</span><span class="string" id="6601721">&#34;openssl&#34;</span><span class="op" id="6601730">,</span>&nbsp;<span class="string" id="6601732">&#34;s_client&#34;</span><span class="op" id="6601742">,</span>&nbsp;<span class="string" id="6601744">&#34;-cipher&#34;</span><span class="op" id="6601753">,</span>&nbsp;<span class="string" id="6601755">&#34;RC4-SHA&#34;</span><span class="op" id="6601764">,</span>&nbsp;<span class="string" id="6601766">&#34;-sess_out&#34;</span><span class="op" id="6601777">,</span>&nbsp;<span class="ident" id="6601779">sessionFilePath</span><span class="op" id="6601794">}</span><span class="op" id="6601795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601799">config</span><span class="op" id="6601805">:</span>&nbsp;&nbsp;<span class="op" id="6601808">&amp;</span><span class="ident" id="6601809">config</span><span class="op" id="6601815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601821">runServerTestTLS12</span><span class="op" id="6601839">(</span><span class="ident" id="6601840">t</span><span class="op" id="6601841">,</span>&nbsp;<span class="ident" id="6601843">test</span><span class="op" id="6601847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601851">config</span><span class="op" id="6601857">.</span><span class="ident" id="6601858">SessionTicketsDisabled</span>&nbsp;<span class="op" id="6601881">=</span>&nbsp;<span class="builtintype" id="6601883">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601890">test</span>&nbsp;<span class="op" id="6601895">=</span>&nbsp;<span class="op" id="6601897">&amp;</span><span class="ident" id="6601898">serverTest</span><span class="op" id="6601908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601912">name</span><span class="op" id="6601916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6601921">&#34;ResumeDisabled&#34;</span><span class="op" id="6601937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601941">command</span><span class="op" id="6601948">:</span>&nbsp;<span class="op" id="6601950">[</span><span class="op" id="6601951">]</span><span class="builtintype" id="6601952">string</span><span class="op" id="6601958">{</span><span class="string" id="6601959">&#34;openssl&#34;</span><span class="op" id="6601968">,</span>&nbsp;<span class="string" id="6601970">&#34;s_client&#34;</span><span class="op" id="6601980">,</span>&nbsp;<span class="string" id="6601982">&#34;-cipher&#34;</span><span class="op" id="6601991">,</span>&nbsp;<span class="string" id="6601993">&#34;RC4-SHA&#34;</span><span class="op" id="6602002">,</span>&nbsp;<span class="string" id="6602004">&#34;-sess_in&#34;</span><span class="op" id="6602014">,</span>&nbsp;<span class="ident" id="6602016">sessionFilePath</span><span class="op" id="6602031">}</span><span class="op" id="6602032">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602036">config</span><span class="op" id="6602042">:</span>&nbsp;&nbsp;<span class="op" id="6602045">&amp;</span><span class="ident" id="6602046">config</span><span class="op" id="6602052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602058">runServerTestTLS12</span><span class="op" id="6602076">(</span><span class="ident" id="6602077">t</span><span class="op" id="6602078">,</span>&nbsp;<span class="ident" id="6602080">test</span><span class="op" id="6602084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602088">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602160">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="6602228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6602231">func</span>&nbsp;<span class="ident" id="6602236">TestFallbackSCSV</span><span class="op" id="6602252">(</span><span class="ident" id="6602253">t</span>&nbsp;<span class="op" id="6602255">*</span><span class="ident" id="6602256">testing</span><span class="op" id="6602263">.</span><span class="ident" id="6602264">T</span><span class="op" id="6602265">)</span>&nbsp;<span class="op" id="6602267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602270">test</span>&nbsp;<span class="op" id="6602275">:=</span>&nbsp;<span class="op" id="6602278">&amp;</span><span class="ident" id="6602279">serverTest</span><span class="op" id="6602289">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602293">name</span><span class="op" id="6602297">:</span>&nbsp;<span class="string" id="6602299">&#34;FallbackSCSV&#34;</span><span class="op" id="6602313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602317">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602378">command</span><span class="op" id="6602385">:</span>&nbsp;<span class="op" id="6602387">[</span><span class="op" id="6602388">]</span><span class="builtintype" id="6602389">string</span><span class="op" id="6602395">{</span><span class="string" id="6602396">&#34;openssl&#34;</span><span class="op" id="6602405">,</span>&nbsp;<span class="string" id="6602407">&#34;s_client&#34;</span><span class="op" id="6602417">,</span>&nbsp;<span class="string" id="6602419">&#34;-fallback_scsv&#34;</span><span class="op" id="6602435">}</span><span class="op" id="6602436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602440">expectHandshakeErrorIncluding</span><span class="op" id="6602469">:</span>&nbsp;<span class="string" id="6602471">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="6602503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602506">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602509">runServerTestTLS11</span><span class="op" id="6602527">(</span><span class="ident" id="6602528">t</span><span class="op" id="6602529">,</span>&nbsp;<span class="ident" id="6602531">test</span><span class="op" id="6602535">)</span><br>
<span class="lineno"></span><span class="op" id="6602537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6602540">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="6602601">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="6602663">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6602699">const</span>&nbsp;<span class="ident" id="6602705">clientCertificatePEM</span>&nbsp;<span class="op" id="6602726">=</span>&nbsp;<span class="string" id="6602728">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603461">const</span>&nbsp;<span class="ident" id="6603467">clientKeyPEM</span>&nbsp;<span class="op" id="6603480">=</span>&nbsp;<span class="string" id="6603482">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604369">const</span>&nbsp;<span class="ident" id="6604375">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="6604401">=</span>&nbsp;<span class="string" id="6604403">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6605156">const</span>&nbsp;<span class="ident" id="6605162">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="6605180">=</span>&nbsp;<span class="string" id="6605182">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="6605622">func</span>&nbsp;<span class="ident" id="6605627">TestClientAuth</span><span class="op" id="6605641">(</span><span class="ident" id="6605642">t</span>&nbsp;<span class="op" id="6605644">*</span><span class="ident" id="6605645">testing</span><span class="op" id="6605652">.</span><span class="ident" id="6605653">T</span><span class="op" id="6605654">)</span>&nbsp;<span class="op" id="6605656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605659">var</span>&nbsp;<span class="ident" id="6605663">certPath</span><span class="op" id="6605671">,</span>&nbsp;<span class="ident" id="6605673">keyPath</span><span class="op" id="6605680">,</span>&nbsp;<span class="ident" id="6605682">ecdsaCertPath</span><span class="op" id="6605695">,</span>&nbsp;<span class="ident" id="6605697">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="6605710">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605719">if</span>&nbsp;<span class="op" id="6605722">*</span><span class="ident" id="6605723">update</span>&nbsp;<span class="op" id="6605730">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605734">certPath</span>&nbsp;<span class="op" id="6605743">=</span>&nbsp;<span class="ident" id="6605745">tempFile</span><span class="op" id="6605753">(</span><span class="ident" id="6605754">clientCertificatePEM</span><span class="op" id="6605774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605778">defer</span>&nbsp;<span class="ident" id="6605784">os</span><span class="op" id="6605786">.</span><span class="ident" id="6605787">Remove</span><span class="op" id="6605793">(</span><span class="ident" id="6605794">certPath</span><span class="op" id="6605802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605806">keyPath</span>&nbsp;<span class="op" id="6605814">=</span>&nbsp;<span class="ident" id="6605816">tempFile</span><span class="op" id="6605824">(</span><span class="ident" id="6605825">clientKeyPEM</span><span class="op" id="6605837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605841">defer</span>&nbsp;<span class="ident" id="6605847">os</span><span class="op" id="6605849">.</span><span class="ident" id="6605850">Remove</span><span class="op" id="6605856">(</span><span class="ident" id="6605857">keyPath</span><span class="op" id="6605864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605868">ecdsaCertPath</span>&nbsp;<span class="op" id="6605882">=</span>&nbsp;<span class="ident" id="6605884">tempFile</span><span class="op" id="6605892">(</span><span class="ident" id="6605893">clientECDSACertificatePEM</span><span class="op" id="6605918">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605922">defer</span>&nbsp;<span class="ident" id="6605928">os</span><span class="op" id="6605930">.</span><span class="ident" id="6605931">Remove</span><span class="op" id="6605937">(</span><span class="ident" id="6605938">ecdsaCertPath</span><span class="op" id="6605951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605955">ecdsaKeyPath</span>&nbsp;<span class="op" id="6605968">=</span>&nbsp;<span class="ident" id="6605970">tempFile</span><span class="op" id="6605978">(</span><span class="ident" id="6605979">clientECDSAKeyPEM</span><span class="op" id="6605996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606000">defer</span>&nbsp;<span class="ident" id="6606006">os</span><span class="op" id="6606008">.</span><span class="ident" id="6606009">Remove</span><span class="op" id="6606015">(</span><span class="ident" id="6606016">ecdsaKeyPath</span><span class="op" id="6606028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606035">config</span>&nbsp;<span class="op" id="6606042">:=</span>&nbsp;<span class="op" id="6606045">*</span><span class="ident" id="6606046">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606058">config</span><span class="op" id="6606064">.</span><span class="ident" id="6606065">ClientAuth</span>&nbsp;<span class="op" id="6606076">=</span>&nbsp;<span class="ident" id="6606078">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606098">test</span>&nbsp;<span class="op" id="6606103">:=</span>&nbsp;<span class="op" id="6606106">&amp;</span><span class="ident" id="6606107">serverTest</span><span class="op" id="6606117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606121">name</span><span class="op" id="6606125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6606130">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="6606159">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606163">command</span><span class="op" id="6606170">:</span>&nbsp;<span class="op" id="6606172">[</span><span class="op" id="6606173">]</span><span class="builtintype" id="6606174">string</span><span class="op" id="6606180">{</span><span class="string" id="6606181">&#34;openssl&#34;</span><span class="op" id="6606190">,</span>&nbsp;<span class="string" id="6606192">&#34;s_client&#34;</span><span class="op" id="6606202">,</span>&nbsp;<span class="string" id="6606204">&#34;-no_ticket&#34;</span><span class="op" id="6606216">,</span>&nbsp;<span class="string" id="6606218">&#34;-cipher&#34;</span><span class="op" id="6606227">,</span>&nbsp;<span class="string" id="6606229">&#34;RC4-SHA&#34;</span><span class="op" id="6606238">}</span><span class="op" id="6606239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606243">config</span><span class="op" id="6606249">:</span>&nbsp;&nbsp;<span class="op" id="6606252">&amp;</span><span class="ident" id="6606253">config</span><span class="op" id="6606259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606265">runServerTestTLS12</span><span class="op" id="6606283">(</span><span class="ident" id="6606284">t</span><span class="op" id="6606285">,</span>&nbsp;<span class="ident" id="6606287">test</span><span class="op" id="6606291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606295">test</span>&nbsp;<span class="op" id="6606300">=</span>&nbsp;<span class="op" id="6606302">&amp;</span><span class="ident" id="6606303">serverTest</span><span class="op" id="6606313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606317">name</span><span class="op" id="6606321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6606336">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="6606365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606369">command</span><span class="op" id="6606376">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606388">[</span><span class="op" id="6606389">]</span><span class="builtintype" id="6606390">string</span><span class="op" id="6606396">{</span><span class="string" id="6606397">&#34;openssl&#34;</span><span class="op" id="6606406">,</span>&nbsp;<span class="string" id="6606408">&#34;s_client&#34;</span><span class="op" id="6606418">,</span>&nbsp;<span class="string" id="6606420">&#34;-no_ticket&#34;</span><span class="op" id="6606432">,</span>&nbsp;<span class="string" id="6606434">&#34;-cipher&#34;</span><span class="op" id="6606443">,</span>&nbsp;<span class="string" id="6606445">&#34;RC4-SHA&#34;</span><span class="op" id="6606454">,</span>&nbsp;<span class="string" id="6606456">&#34;-cert&#34;</span><span class="op" id="6606463">,</span>&nbsp;<span class="ident" id="6606465">certPath</span><span class="op" id="6606473">,</span>&nbsp;<span class="string" id="6606475">&#34;-key&#34;</span><span class="op" id="6606481">,</span>&nbsp;<span class="ident" id="6606483">keyPath</span><span class="op" id="6606490">}</span><span class="op" id="6606491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606495">config</span><span class="op" id="6606501">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606514">&amp;</span><span class="ident" id="6606515">config</span><span class="op" id="6606521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606525">expectedPeerCerts</span><span class="op" id="6606542">:</span>&nbsp;<span class="op" id="6606544">[</span><span class="op" id="6606545">]</span><span class="builtintype" id="6606546">string</span><span class="op" id="6606552">{</span><span class="ident" id="6606553">clientCertificatePEM</span><span class="op" id="6606573">}</span><span class="op" id="6606574">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606580">runServerTestTLS12</span><span class="op" id="6606598">(</span><span class="ident" id="6606599">t</span><span class="op" id="6606600">,</span>&nbsp;<span class="ident" id="6606602">test</span><span class="op" id="6606606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606610">test</span>&nbsp;<span class="op" id="6606615">=</span>&nbsp;<span class="op" id="6606617">&amp;</span><span class="ident" id="6606618">serverTest</span><span class="op" id="6606628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606632">name</span><span class="op" id="6606636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6606651">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="6606685">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606689">command</span><span class="op" id="6606696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606708">[</span><span class="op" id="6606709">]</span><span class="builtintype" id="6606710">string</span><span class="op" id="6606716">{</span><span class="string" id="6606717">&#34;openssl&#34;</span><span class="op" id="6606726">,</span>&nbsp;<span class="string" id="6606728">&#34;s_client&#34;</span><span class="op" id="6606738">,</span>&nbsp;<span class="string" id="6606740">&#34;-no_ticket&#34;</span><span class="op" id="6606752">,</span>&nbsp;<span class="string" id="6606754">&#34;-cipher&#34;</span><span class="op" id="6606763">,</span>&nbsp;<span class="string" id="6606765">&#34;RC4-SHA&#34;</span><span class="op" id="6606774">,</span>&nbsp;<span class="string" id="6606776">&#34;-cert&#34;</span><span class="op" id="6606783">,</span>&nbsp;<span class="ident" id="6606785">ecdsaCertPath</span><span class="op" id="6606798">,</span>&nbsp;<span class="string" id="6606800">&#34;-key&#34;</span><span class="op" id="6606806">,</span>&nbsp;<span class="ident" id="6606808">ecdsaKeyPath</span><span class="op" id="6606820">}</span><span class="op" id="6606821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606825">config</span><span class="op" id="6606831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606844">&amp;</span><span class="ident" id="6606845">config</span><span class="op" id="6606851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606855">expectedPeerCerts</span><span class="op" id="6606872">:</span>&nbsp;<span class="op" id="6606874">[</span><span class="op" id="6606875">]</span><span class="builtintype" id="6606876">string</span><span class="op" id="6606882">{</span><span class="ident" id="6606883">clientECDSACertificatePEM</span><span class="op" id="6606908">}</span><span class="op" id="6606909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606915">runServerTestTLS12</span><span class="op" id="6606933">(</span><span class="ident" id="6606934">t</span><span class="op" id="6606935">,</span>&nbsp;<span class="ident" id="6606937">test</span><span class="op" id="6606941">)</span><br>
<span class="lineno">830</span><span class="op" id="6606943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6606946">func</span>&nbsp;<span class="ident" id="6606951">bigFromString</span><span class="op" id="6606964">(</span><span class="ident" id="6606965">s</span>&nbsp;<span class="builtintype" id="6606967">string</span><span class="op" id="6606973">)</span>&nbsp;<span class="op" id="6606975">*</span><span class="ident" id="6606976">big</span><span class="op" id="6606979">.</span><span class="ident" id="6606980">Int</span>&nbsp;<span class="op" id="6606984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606987">ret</span>&nbsp;<span class="op" id="6606991">:=</span>&nbsp;<span class="builtinfunc" id="6606994">new</span><span class="op" id="6606997">(</span><span class="ident" id="6606998">big</span><span class="op" id="6607001">.</span><span class="ident" id="6607002">Int</span><span class="op" id="6607005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607008">ret</span><span class="op" id="6607011">.</span><span class="ident" id="6607012">SetString</span><span class="op" id="6607021">(</span><span class="ident" id="6607022">s</span><span class="op" id="6607023">,</span>&nbsp;<span class="num" id="6607025">10</span><span class="op" id="6607027">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607030">return</span>&nbsp;<span class="ident" id="6607037">ret</span><br>
<span class="lineno"></span><span class="op" id="6607041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6607044">func</span>&nbsp;<span class="ident" id="6607049">fromHex</span><span class="op" id="6607056">(</span><span class="ident" id="6607057">s</span>&nbsp;<span class="builtintype" id="6607059">string</span><span class="op" id="6607065">)</span>&nbsp;<span class="op" id="6607067">[</span><span class="op" id="6607068">]</span><span class="builtintype" id="6607069">byte</span>&nbsp;<span class="op" id="6607074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607077">b</span><span class="op" id="6607078">,</span>&nbsp;<span class="ident" id="6607080">_</span>&nbsp;<span class="op" id="6607082">:=</span>&nbsp;<span class="ident" id="6607085">hex</span><span class="op" id="6607088">.</span><span class="ident" id="6607089">DecodeString</span><span class="op" id="6607101">(</span><span class="ident" id="6607102">s</span><span class="op" id="6607103">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607106">return</span>&nbsp;<span class="ident" id="6607113">b</span><br>
<span class="lineno"></span><span class="op" id="6607115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6607118">var</span>&nbsp;<span class="ident" id="6607122">testRSACertificate</span>&nbsp;<span class="op" id="6607141">=</span>&nbsp;<span class="ident" id="6607143">fromHex</span><span class="op" id="6607150">(</span><span class="string" id="6607151">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="6608537">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="6608540">var</span>&nbsp;<span class="ident" id="6608544">testECDSACertificate</span>&nbsp;<span class="op" id="6608565">=</span>&nbsp;<span class="ident" id="6608567">fromHex</span><span class="op" id="6608574">(</span><span class="string" id="6608575">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="6609609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609612">var</span>&nbsp;<span class="ident" id="6609616">testSNICertificate</span>&nbsp;<span class="op" id="6609635">=</span>&nbsp;<span class="ident" id="6609637">fromHex</span><span class="op" id="6609644">(</span><span class="string" id="6609645">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="6610651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6610654">var</span>&nbsp;<span class="ident" id="6610658">testRSAPrivateKey</span>&nbsp;<span class="op" id="6610676">=</span>&nbsp;<span class="op" id="6610678">&amp;</span><span class="ident" id="6610679">rsa</span><span class="op" id="6610682">.</span><span class="ident" id="6610683">PrivateKey</span><span class="op" id="6610693">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610696">PublicKey</span><span class="op" id="6610705">:</span>&nbsp;<span class="ident" id="6610707">rsa</span><span class="op" id="6610710">.</span><span class="ident" id="6610711">PublicKey</span><span class="op" id="6610720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610724">N</span><span class="op" id="6610725">:</span>&nbsp;<span class="ident" id="6610727">bigFromString</span><span class="op" id="6610740">(</span><span class="string" id="6610741">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="6611052">)</span><span class="op" id="6611053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611057">E</span><span class="op" id="6611058">:</span>&nbsp;<span class="num" id="6611060">65537</span><span class="op" id="6611065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611068">}</span><span class="op" id="6611069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611072">D</span><span class="op" id="6611073">:</span>&nbsp;<span class="ident" id="6611075">bigFromString</span><span class="op" id="6611088">(</span><span class="string" id="6611089">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="6611399">)</span><span class="op" id="6611400">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611403">Primes</span><span class="op" id="6611409">:</span>&nbsp;<span class="op" id="6611411">[</span><span class="op" id="6611412">]</span><span class="op" id="6611413">*</span><span class="ident" id="6611414">big</span><span class="op" id="6611417">.</span><span class="ident" id="6611418">Int</span><span class="op" id="6611421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611425">bigFromString</span><span class="op" id="6611438">(</span><span class="string" id="6611439">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="6611596">)</span><span class="op" id="6611597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611601">bigFromString</span><span class="op" id="6611614">(</span><span class="string" id="6611615">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="6611772">)</span><span class="op" id="6611773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611776">}</span><span class="op" id="6611777">,</span><br>
<span class="lineno"></span><span class="op" id="6611779">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="6611782">var</span>&nbsp;<span class="ident" id="6611786">testECDSAPrivateKey</span>&nbsp;<span class="op" id="6611806">=</span>&nbsp;<span class="op" id="6611808">&amp;</span><span class="ident" id="6611809">ecdsa</span><span class="op" id="6611814">.</span><span class="ident" id="6611815">PrivateKey</span><span class="op" id="6611825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611828">PublicKey</span><span class="op" id="6611837">:</span>&nbsp;<span class="ident" id="6611839">ecdsa</span><span class="op" id="6611844">.</span><span class="ident" id="6611845">PublicKey</span><span class="op" id="6611854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611858">Curve</span><span class="op" id="6611863">:</span>&nbsp;<span class="ident" id="6611865">elliptic</span><span class="op" id="6611873">.</span><span class="ident" id="6611874">P521</span><span class="op" id="6611878">(</span><span class="op" id="6611879">)</span><span class="op" id="6611880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611884">X</span><span class="op" id="6611885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611891">bigFromString</span><span class="op" id="6611904">(</span><span class="string" id="6611905">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="6612064">)</span><span class="op" id="6612065">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612069">Y</span><span class="op" id="6612070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612076">bigFromString</span><span class="op" id="6612089">(</span><span class="string" id="6612090">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="6612249">)</span><span class="op" id="6612250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612253">}</span><span class="op" id="6612254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612257">D</span><span class="op" id="6612258">:</span>&nbsp;<span class="ident" id="6612260">bigFromString</span><span class="op" id="6612273">(</span><span class="string" id="6612274">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="6612433">)</span><span class="op" id="6612434">,</span><br>
<span class="lineno"></span><span class="op" id="6612436">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
