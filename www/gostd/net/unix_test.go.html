<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6829824">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6829880">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6829934">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6829985">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830018">package</span>&nbsp;<span class="ident" id="6830026">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830031">import</span>&nbsp;<span class="op" id="6830038">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830041">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830050">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830056">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830067">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830078">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830089">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6830100">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6830107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830110">func</span>&nbsp;<span class="ident" id="6830115">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="6830148">(</span><span class="ident" id="6830149">t</span>&nbsp;<span class="op" id="6830151">*</span><span class="ident" id="6830152">testing</span><span class="op" id="6830159">.</span><span class="ident" id="6830160">T</span><span class="op" id="6830161">)</span>&nbsp;<span class="op" id="6830163">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830166">addr</span>&nbsp;<span class="op" id="6830171">:=</span>&nbsp;<span class="ident" id="6830174">testUnixAddr</span><span class="op" id="6830186">(</span><span class="op" id="6830187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830190">la</span><span class="op" id="6830192">,</span>&nbsp;<span class="ident" id="6830194">err</span>&nbsp;<span class="op" id="6830198">:=</span>&nbsp;<span class="ident" id="6830201">ResolveUnixAddr</span><span class="op" id="6830216">(</span><span class="string" id="6830217">&#34;unixgram&#34;</span><span class="op" id="6830227">,</span>&nbsp;<span class="ident" id="6830229">addr</span><span class="op" id="6830233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830236">if</span>&nbsp;<span class="ident" id="6830239">err</span>&nbsp;<span class="op" id="6830243">!=</span>&nbsp;<span class="builtintype" id="6830246">nil</span>&nbsp;<span class="op" id="6830250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830254">t</span><span class="op" id="6830255">.</span><span class="ident" id="6830256">Fatalf</span><span class="op" id="6830262">(</span><span class="string" id="6830263">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6830291">,</span>&nbsp;<span class="ident" id="6830293">err</span><span class="op" id="6830296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830299">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830302">c</span><span class="op" id="6830303">,</span>&nbsp;<span class="ident" id="6830305">err</span>&nbsp;<span class="op" id="6830309">:=</span>&nbsp;<span class="ident" id="6830312">ListenUnixgram</span><span class="op" id="6830326">(</span><span class="string" id="6830327">&#34;unixgram&#34;</span><span class="op" id="6830337">,</span>&nbsp;<span class="ident" id="6830339">la</span><span class="op" id="6830341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830344">if</span>&nbsp;<span class="ident" id="6830347">err</span>&nbsp;<span class="op" id="6830351">!=</span>&nbsp;<span class="builtintype" id="6830354">nil</span>&nbsp;<span class="op" id="6830358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830362">t</span><span class="op" id="6830363">.</span><span class="ident" id="6830364">Fatalf</span><span class="op" id="6830370">(</span><span class="string" id="6830371">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6830398">,</span>&nbsp;<span class="ident" id="6830400">err</span><span class="op" id="6830403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830409">defer</span>&nbsp;<span class="keyword" id="6830415">func</span><span class="op" id="6830419">(</span><span class="op" id="6830420">)</span>&nbsp;<span class="op" id="6830422">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830426">c</span><span class="op" id="6830427">.</span><span class="ident" id="6830428">Close</span><span class="op" id="6830433">(</span><span class="op" id="6830434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830438">os</span><span class="op" id="6830440">.</span><span class="ident" id="6830441">Remove</span><span class="op" id="6830447">(</span><span class="ident" id="6830448">addr</span><span class="op" id="6830452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830455">}</span><span class="op" id="6830456">(</span><span class="op" id="6830457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830461">off</span>&nbsp;<span class="op" id="6830465">:=</span>&nbsp;<span class="builtinfunc" id="6830468">make</span><span class="op" id="6830472">(</span><span class="keyword" id="6830473">chan</span>&nbsp;<span class="builtintype" id="6830478">bool</span><span class="op" id="6830482">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830485">data</span>&nbsp;<span class="op" id="6830490">:=</span>&nbsp;<span class="op" id="6830493">[</span><span class="num" id="6830494">5</span><span class="op" id="6830495">]</span><span class="builtintype" id="6830496">byte</span><span class="op" id="6830500">{</span><span class="num" id="6830501">1</span><span class="op" id="6830502">,</span>&nbsp;<span class="num" id="6830504">2</span><span class="op" id="6830505">,</span>&nbsp;<span class="num" id="6830507">3</span><span class="op" id="6830508">,</span>&nbsp;<span class="num" id="6830510">4</span><span class="op" id="6830511">,</span>&nbsp;<span class="num" id="6830513">5</span><span class="op" id="6830514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830517">go</span>&nbsp;<span class="keyword" id="6830520">func</span><span class="op" id="6830524">(</span><span class="op" id="6830525">)</span>&nbsp;<span class="op" id="6830527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830531">defer</span>&nbsp;<span class="keyword" id="6830537">func</span><span class="op" id="6830541">(</span><span class="op" id="6830542">)</span>&nbsp;<span class="op" id="6830544">{</span>&nbsp;<span class="ident" id="6830546">off</span>&nbsp;<span class="op" id="6830550">&lt;-</span>&nbsp;<span class="builtintype" id="6830553">true</span>&nbsp;<span class="op" id="6830558">}</span><span class="op" id="6830559">(</span><span class="op" id="6830560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830564">s</span><span class="op" id="6830565">,</span>&nbsp;<span class="ident" id="6830567">err</span>&nbsp;<span class="op" id="6830571">:=</span>&nbsp;<span class="ident" id="6830574">syscall</span><span class="op" id="6830581">.</span><span class="ident" id="6830582">Socket</span><span class="op" id="6830588">(</span><span class="ident" id="6830589">syscall</span><span class="op" id="6830596">.</span><span class="ident" id="6830597">AF_UNIX</span><span class="op" id="6830604">,</span>&nbsp;<span class="ident" id="6830606">syscall</span><span class="op" id="6830613">.</span><span class="ident" id="6830614">SOCK_DGRAM</span><span class="op" id="6830624">,</span>&nbsp;<span class="num" id="6830626">0</span><span class="op" id="6830627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830631">if</span>&nbsp;<span class="ident" id="6830634">err</span>&nbsp;<span class="op" id="6830638">!=</span>&nbsp;<span class="builtintype" id="6830641">nil</span>&nbsp;<span class="op" id="6830645">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830650">t</span><span class="op" id="6830651">.</span><span class="ident" id="6830652">Errorf</span><span class="op" id="6830658">(</span><span class="string" id="6830659">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6830686">,</span>&nbsp;<span class="ident" id="6830688">err</span><span class="op" id="6830691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830709">defer</span>&nbsp;<span class="ident" id="6830715">syscall</span><span class="op" id="6830722">.</span><span class="ident" id="6830723">Close</span><span class="op" id="6830728">(</span><span class="ident" id="6830729">s</span><span class="op" id="6830730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830734">rsa</span>&nbsp;<span class="op" id="6830738">:=</span>&nbsp;<span class="op" id="6830741">&amp;</span><span class="ident" id="6830742">syscall</span><span class="op" id="6830749">.</span><span class="ident" id="6830750">SockaddrUnix</span><span class="op" id="6830762">{</span><span class="ident" id="6830763">Name</span><span class="op" id="6830767">:</span>&nbsp;<span class="ident" id="6830769">addr</span><span class="op" id="6830773">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830777">if</span>&nbsp;<span class="ident" id="6830780">err</span>&nbsp;<span class="op" id="6830784">:=</span>&nbsp;<span class="ident" id="6830787">syscall</span><span class="op" id="6830794">.</span><span class="ident" id="6830795">Sendto</span><span class="op" id="6830801">(</span><span class="ident" id="6830802">s</span><span class="op" id="6830803">,</span>&nbsp;<span class="ident" id="6830805">data</span><span class="op" id="6830809">[</span><span class="op" id="6830810">:</span><span class="op" id="6830811">]</span><span class="op" id="6830812">,</span>&nbsp;<span class="num" id="6830814">0</span><span class="op" id="6830815">,</span>&nbsp;<span class="ident" id="6830817">rsa</span><span class="op" id="6830820">)</span><span class="op" id="6830821">;</span>&nbsp;<span class="ident" id="6830823">err</span>&nbsp;<span class="op" id="6830827">!=</span>&nbsp;<span class="builtintype" id="6830830">nil</span>&nbsp;<span class="op" id="6830834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830839">t</span><span class="op" id="6830840">.</span><span class="ident" id="6830841">Errorf</span><span class="op" id="6830847">(</span><span class="string" id="6830848">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6830875">,</span>&nbsp;<span class="ident" id="6830877">err</span><span class="op" id="6830880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6830885">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830897">}</span><span class="op" id="6830898">(</span><span class="op" id="6830899">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6830903">&lt;-</span><span class="ident" id="6830905">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830910">b</span>&nbsp;<span class="op" id="6830912">:=</span>&nbsp;<span class="builtinfunc" id="6830915">make</span><span class="op" id="6830919">(</span><span class="op" id="6830920">[</span><span class="op" id="6830921">]</span><span class="builtintype" id="6830922">byte</span><span class="op" id="6830926">,</span>&nbsp;<span class="num" id="6830928">64</span><span class="op" id="6830930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830933">c</span><span class="op" id="6830934">.</span><span class="ident" id="6830935">SetReadDeadline</span><span class="op" id="6830950">(</span><span class="ident" id="6830951">time</span><span class="op" id="6830955">.</span><span class="ident" id="6830956">Now</span><span class="op" id="6830959">(</span><span class="op" id="6830960">)</span><span class="op" id="6830961">.</span><span class="ident" id="6830962">Add</span><span class="op" id="6830965">(</span><span class="num" id="6830966">100</span>&nbsp;<span class="op" id="6830970">*</span>&nbsp;<span class="ident" id="6830972">time</span><span class="op" id="6830976">.</span><span class="ident" id="6830977">Millisecond</span><span class="op" id="6830988">)</span><span class="op" id="6830989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6830992">n</span><span class="op" id="6830993">,</span>&nbsp;<span class="ident" id="6830995">from</span><span class="op" id="6830999">,</span>&nbsp;<span class="ident" id="6831001">err</span>&nbsp;<span class="op" id="6831005">:=</span>&nbsp;<span class="ident" id="6831008">c</span><span class="op" id="6831009">.</span><span class="ident" id="6831010">ReadFrom</span><span class="op" id="6831018">(</span><span class="ident" id="6831019">b</span><span class="op" id="6831020">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831023">if</span>&nbsp;<span class="ident" id="6831026">err</span>&nbsp;<span class="op" id="6831030">!=</span>&nbsp;<span class="builtintype" id="6831033">nil</span>&nbsp;<span class="op" id="6831037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831041">t</span><span class="op" id="6831042">.</span><span class="ident" id="6831043">Fatalf</span><span class="op" id="6831049">(</span><span class="string" id="6831050">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6831080">,</span>&nbsp;<span class="ident" id="6831082">err</span><span class="op" id="6831085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831091">if</span>&nbsp;<span class="ident" id="6831094">from</span>&nbsp;<span class="op" id="6831099">!=</span>&nbsp;<span class="builtintype" id="6831102">nil</span>&nbsp;<span class="op" id="6831106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831110">t</span><span class="op" id="6831111">.</span><span class="ident" id="6831112">Fatalf</span><span class="op" id="6831118">(</span><span class="string" id="6831119">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6831143">,</span>&nbsp;<span class="ident" id="6831145">from</span><span class="op" id="6831149">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831155">if</span>&nbsp;<span class="op" id="6831158">!</span><span class="ident" id="6831159">bytes</span><span class="op" id="6831164">.</span><span class="ident" id="6831165">Equal</span><span class="op" id="6831170">(</span><span class="ident" id="6831171">b</span><span class="op" id="6831172">[</span><span class="op" id="6831173">:</span><span class="ident" id="6831174">n</span><span class="op" id="6831175">]</span><span class="op" id="6831176">,</span>&nbsp;<span class="ident" id="6831178">data</span><span class="op" id="6831182">[</span><span class="op" id="6831183">:</span><span class="op" id="6831184">]</span><span class="op" id="6831185">)</span>&nbsp;<span class="op" id="6831187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831191">t</span><span class="op" id="6831192">.</span><span class="ident" id="6831193">Fatalf</span><span class="op" id="6831199">(</span><span class="string" id="6831200">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6831217">,</span>&nbsp;<span class="ident" id="6831219">b</span><span class="op" id="6831220">[</span><span class="op" id="6831221">:</span><span class="ident" id="6831222">n</span><span class="op" id="6831223">]</span><span class="op" id="6831224">,</span>&nbsp;<span class="ident" id="6831226">data</span><span class="op" id="6831230">[</span><span class="op" id="6831231">:</span><span class="op" id="6831232">]</span><span class="op" id="6831233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831236">}</span><br>
<span class="lineno"></span><span class="op" id="6831238">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6831241">func</span>&nbsp;<span class="ident" id="6831246">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="6831281">(</span><span class="ident" id="6831282">t</span>&nbsp;<span class="op" id="6831284">*</span><span class="ident" id="6831285">testing</span><span class="op" id="6831292">.</span><span class="ident" id="6831293">T</span><span class="op" id="6831294">)</span>&nbsp;<span class="op" id="6831296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6831299">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6831356">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831422">addr</span>&nbsp;<span class="op" id="6831427">:=</span>&nbsp;<span class="ident" id="6831430">testUnixAddr</span><span class="op" id="6831442">(</span><span class="op" id="6831443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831446">la</span><span class="op" id="6831448">,</span>&nbsp;<span class="ident" id="6831450">err</span>&nbsp;<span class="op" id="6831454">:=</span>&nbsp;<span class="ident" id="6831457">ResolveUnixAddr</span><span class="op" id="6831472">(</span><span class="string" id="6831473">&#34;unixgram&#34;</span><span class="op" id="6831483">,</span>&nbsp;<span class="ident" id="6831485">addr</span><span class="op" id="6831489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831492">if</span>&nbsp;<span class="ident" id="6831495">err</span>&nbsp;<span class="op" id="6831499">!=</span>&nbsp;<span class="builtintype" id="6831502">nil</span>&nbsp;<span class="op" id="6831506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831510">t</span><span class="op" id="6831511">.</span><span class="ident" id="6831512">Fatalf</span><span class="op" id="6831518">(</span><span class="string" id="6831519">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6831547">,</span>&nbsp;<span class="ident" id="6831549">err</span><span class="op" id="6831552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831555">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831558">c</span><span class="op" id="6831559">,</span>&nbsp;<span class="ident" id="6831561">err</span>&nbsp;<span class="op" id="6831565">:=</span>&nbsp;<span class="ident" id="6831568">ListenUnixgram</span><span class="op" id="6831582">(</span><span class="string" id="6831583">&#34;unixgram&#34;</span><span class="op" id="6831593">,</span>&nbsp;<span class="ident" id="6831595">la</span><span class="op" id="6831597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831600">if</span>&nbsp;<span class="ident" id="6831603">err</span>&nbsp;<span class="op" id="6831607">!=</span>&nbsp;<span class="builtintype" id="6831610">nil</span>&nbsp;<span class="op" id="6831614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831618">t</span><span class="op" id="6831619">.</span><span class="ident" id="6831620">Fatalf</span><span class="op" id="6831626">(</span><span class="string" id="6831627">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6831654">,</span>&nbsp;<span class="ident" id="6831656">err</span><span class="op" id="6831659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831665">defer</span>&nbsp;<span class="keyword" id="6831671">func</span><span class="op" id="6831675">(</span><span class="op" id="6831676">)</span>&nbsp;<span class="op" id="6831678">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831682">c</span><span class="op" id="6831683">.</span><span class="ident" id="6831684">Close</span><span class="op" id="6831689">(</span><span class="op" id="6831690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831694">os</span><span class="op" id="6831696">.</span><span class="ident" id="6831697">Remove</span><span class="op" id="6831703">(</span><span class="ident" id="6831704">addr</span><span class="op" id="6831708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831711">}</span><span class="op" id="6831712">(</span><span class="op" id="6831713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831717">off</span>&nbsp;<span class="op" id="6831721">:=</span>&nbsp;<span class="builtinfunc" id="6831724">make</span><span class="op" id="6831728">(</span><span class="keyword" id="6831729">chan</span>&nbsp;<span class="builtintype" id="6831734">bool</span><span class="op" id="6831738">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831741">go</span>&nbsp;<span class="keyword" id="6831744">func</span><span class="op" id="6831748">(</span><span class="op" id="6831749">)</span>&nbsp;<span class="op" id="6831751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831755">defer</span>&nbsp;<span class="keyword" id="6831761">func</span><span class="op" id="6831765">(</span><span class="op" id="6831766">)</span>&nbsp;<span class="op" id="6831768">{</span>&nbsp;<span class="ident" id="6831770">off</span>&nbsp;<span class="op" id="6831774">&lt;-</span>&nbsp;<span class="builtintype" id="6831777">true</span>&nbsp;<span class="op" id="6831782">}</span><span class="op" id="6831783">(</span><span class="op" id="6831784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831788">c</span><span class="op" id="6831789">,</span>&nbsp;<span class="ident" id="6831791">err</span>&nbsp;<span class="op" id="6831795">:=</span>&nbsp;<span class="ident" id="6831798">DialUnix</span><span class="op" id="6831806">(</span><span class="string" id="6831807">&#34;unixgram&#34;</span><span class="op" id="6831817">,</span>&nbsp;<span class="builtintype" id="6831819">nil</span><span class="op" id="6831822">,</span>&nbsp;<span class="ident" id="6831824">la</span><span class="op" id="6831826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831830">if</span>&nbsp;<span class="ident" id="6831833">err</span>&nbsp;<span class="op" id="6831837">!=</span>&nbsp;<span class="builtintype" id="6831840">nil</span>&nbsp;<span class="op" id="6831844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831849">t</span><span class="op" id="6831850">.</span><span class="ident" id="6831851">Errorf</span><span class="op" id="6831857">(</span><span class="string" id="6831858">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6831879">,</span>&nbsp;<span class="ident" id="6831881">err</span><span class="op" id="6831884">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831889">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6831898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831902">defer</span>&nbsp;<span class="ident" id="6831908">c</span><span class="op" id="6831909">.</span><span class="ident" id="6831910">Close</span><span class="op" id="6831915">(</span><span class="op" id="6831916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6831920">if</span>&nbsp;<span class="ident" id="6831923">_</span><span class="op" id="6831924">,</span>&nbsp;<span class="ident" id="6831926">err</span>&nbsp;<span class="op" id="6831930">:=</span>&nbsp;<span class="ident" id="6831933">c</span><span class="op" id="6831934">.</span><span class="ident" id="6831935">Write</span><span class="op" id="6831940">(</span><span class="op" id="6831941">[</span><span class="op" id="6831942">]</span><span class="builtintype" id="6831943">byte</span><span class="op" id="6831947">{</span><span class="num" id="6831948">1</span><span class="op" id="6831949">,</span>&nbsp;<span class="num" id="6831951">2</span><span class="op" id="6831952">,</span>&nbsp;<span class="num" id="6831954">3</span><span class="op" id="6831955">,</span>&nbsp;<span class="num" id="6831957">4</span><span class="op" id="6831958">,</span>&nbsp;<span class="num" id="6831960">5</span><span class="op" id="6831961">}</span><span class="op" id="6831962">)</span><span class="op" id="6831963">;</span>&nbsp;<span class="ident" id="6831965">err</span>&nbsp;<span class="op" id="6831969">!=</span>&nbsp;<span class="builtintype" id="6831972">nil</span>&nbsp;<span class="op" id="6831976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6831981">t</span><span class="op" id="6831982">.</span><span class="ident" id="6831983">Errorf</span><span class="op" id="6831989">(</span><span class="string" id="6831990">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6832017">,</span>&nbsp;<span class="ident" id="6832019">err</span><span class="op" id="6832022">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832027">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832039">}</span><span class="op" id="6832040">(</span><span class="op" id="6832041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832045">&lt;-</span><span class="ident" id="6832047">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832052">c</span><span class="op" id="6832053">.</span><span class="ident" id="6832054">SetReadDeadline</span><span class="op" id="6832069">(</span><span class="ident" id="6832070">time</span><span class="op" id="6832074">.</span><span class="ident" id="6832075">Now</span><span class="op" id="6832078">(</span><span class="op" id="6832079">)</span><span class="op" id="6832080">.</span><span class="ident" id="6832081">Add</span><span class="op" id="6832084">(</span><span class="num" id="6832085">100</span>&nbsp;<span class="op" id="6832089">*</span>&nbsp;<span class="ident" id="6832091">time</span><span class="op" id="6832095">.</span><span class="ident" id="6832096">Millisecond</span><span class="op" id="6832107">)</span><span class="op" id="6832108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832111">_</span><span class="op" id="6832112">,</span>&nbsp;<span class="ident" id="6832114">from</span><span class="op" id="6832118">,</span>&nbsp;<span class="ident" id="6832120">err</span>&nbsp;<span class="op" id="6832124">:=</span>&nbsp;<span class="ident" id="6832127">c</span><span class="op" id="6832128">.</span><span class="ident" id="6832129">ReadFrom</span><span class="op" id="6832137">(</span><span class="builtintype" id="6832138">nil</span><span class="op" id="6832141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832144">if</span>&nbsp;<span class="ident" id="6832147">err</span>&nbsp;<span class="op" id="6832151">!=</span>&nbsp;<span class="builtintype" id="6832154">nil</span>&nbsp;<span class="op" id="6832158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832162">t</span><span class="op" id="6832163">.</span><span class="ident" id="6832164">Fatalf</span><span class="op" id="6832170">(</span><span class="string" id="6832171">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6832201">,</span>&nbsp;<span class="ident" id="6832203">err</span><span class="op" id="6832206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832209">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832212">if</span>&nbsp;<span class="ident" id="6832215">from</span>&nbsp;<span class="op" id="6832220">!=</span>&nbsp;<span class="builtintype" id="6832223">nil</span>&nbsp;<span class="op" id="6832227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832231">t</span><span class="op" id="6832232">.</span><span class="ident" id="6832233">Fatalf</span><span class="op" id="6832239">(</span><span class="string" id="6832240">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6832264">,</span>&nbsp;<span class="ident" id="6832266">from</span><span class="op" id="6832270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832273">}</span><br>
<span class="lineno"></span><span class="op" id="6832275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6832278">func</span>&nbsp;<span class="ident" id="6832283">TestUnixgramAutobind</span><span class="op" id="6832303">(</span><span class="ident" id="6832304">t</span>&nbsp;<span class="op" id="6832306">*</span><span class="ident" id="6832307">testing</span><span class="op" id="6832314">.</span><span class="ident" id="6832315">T</span><span class="op" id="6832316">)</span>&nbsp;<span class="op" id="6832318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832321">if</span>&nbsp;<span class="ident" id="6832324">runtime</span><span class="op" id="6832331">.</span><span class="ident" id="6832332">GOOS</span>&nbsp;<span class="op" id="6832337">!=</span>&nbsp;<span class="string" id="6832340">&#34;linux&#34;</span>&nbsp;<span class="op" id="6832348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832352">t</span><span class="op" id="6832353">.</span><span class="ident" id="6832354">Skip</span><span class="op" id="6832358">(</span><span class="string" id="6832359">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6832393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832400">laddr</span>&nbsp;<span class="op" id="6832406">:=</span>&nbsp;<span class="op" id="6832409">&amp;</span><span class="ident" id="6832410">UnixAddr</span><span class="op" id="6832418">{</span><span class="ident" id="6832419">Name</span><span class="op" id="6832423">:</span>&nbsp;<span class="string" id="6832425">&#34;&#34;</span><span class="op" id="6832427">,</span>&nbsp;<span class="ident" id="6832429">Net</span><span class="op" id="6832432">:</span>&nbsp;<span class="string" id="6832434">&#34;unixgram&#34;</span><span class="op" id="6832444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832447">c1</span><span class="op" id="6832449">,</span>&nbsp;<span class="ident" id="6832451">err</span>&nbsp;<span class="op" id="6832455">:=</span>&nbsp;<span class="ident" id="6832458">ListenUnixgram</span><span class="op" id="6832472">(</span><span class="string" id="6832473">&#34;unixgram&#34;</span><span class="op" id="6832483">,</span>&nbsp;<span class="ident" id="6832485">laddr</span><span class="op" id="6832490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832493">if</span>&nbsp;<span class="ident" id="6832496">err</span>&nbsp;<span class="op" id="6832500">!=</span>&nbsp;<span class="builtintype" id="6832503">nil</span>&nbsp;<span class="op" id="6832507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832511">t</span><span class="op" id="6832512">.</span><span class="ident" id="6832513">Fatalf</span><span class="op" id="6832519">(</span><span class="string" id="6832520">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6832547">,</span>&nbsp;<span class="ident" id="6832549">err</span><span class="op" id="6832552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832555">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832558">defer</span>&nbsp;<span class="ident" id="6832564">c1</span><span class="op" id="6832566">.</span><span class="ident" id="6832567">Close</span><span class="op" id="6832572">(</span><span class="op" id="6832573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6832577">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832611">autoAddr</span>&nbsp;<span class="op" id="6832620">:=</span>&nbsp;<span class="ident" id="6832623">c1</span><span class="op" id="6832625">.</span><span class="ident" id="6832626">LocalAddr</span><span class="op" id="6832635">(</span><span class="op" id="6832636">)</span><span class="op" id="6832637">.</span><span class="op" id="6832638">(</span><span class="op" id="6832639">*</span><span class="ident" id="6832640">UnixAddr</span><span class="op" id="6832648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832651">if</span>&nbsp;<span class="builtinfunc" id="6832654">len</span><span class="op" id="6832657">(</span><span class="ident" id="6832658">autoAddr</span><span class="op" id="6832666">.</span><span class="ident" id="6832667">Name</span><span class="op" id="6832671">)</span>&nbsp;<span class="op" id="6832673">&lt;=</span>&nbsp;<span class="num" id="6832676">1</span>&nbsp;<span class="op" id="6832678">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832682">t</span><span class="op" id="6832683">.</span><span class="ident" id="6832684">Fatalf</span><span class="op" id="6832690">(</span><span class="string" id="6832691">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6832721">,</span>&nbsp;<span class="ident" id="6832723">autoAddr</span><span class="op" id="6832731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832737">if</span>&nbsp;<span class="ident" id="6832740">autoAddr</span><span class="op" id="6832748">.</span><span class="ident" id="6832749">Name</span><span class="op" id="6832753">[</span><span class="num" id="6832754">0</span><span class="op" id="6832755">]</span>&nbsp;<span class="op" id="6832757">!=</span>&nbsp;<span class="string" id="6832760">&#39;@&#39;</span>&nbsp;<span class="op" id="6832764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832768">t</span><span class="op" id="6832769">.</span><span class="ident" id="6832770">Fatalf</span><span class="op" id="6832776">(</span><span class="string" id="6832777">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6832807">,</span>&nbsp;<span class="ident" id="6832809">autoAddr</span><span class="op" id="6832817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832820">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832824">c2</span><span class="op" id="6832826">,</span>&nbsp;<span class="ident" id="6832828">err</span>&nbsp;<span class="op" id="6832832">:=</span>&nbsp;<span class="ident" id="6832835">DialUnix</span><span class="op" id="6832843">(</span><span class="string" id="6832844">&#34;unixgram&#34;</span><span class="op" id="6832854">,</span>&nbsp;<span class="builtintype" id="6832856">nil</span><span class="op" id="6832859">,</span>&nbsp;<span class="ident" id="6832861">autoAddr</span><span class="op" id="6832869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832872">if</span>&nbsp;<span class="ident" id="6832875">err</span>&nbsp;<span class="op" id="6832879">!=</span>&nbsp;<span class="builtintype" id="6832882">nil</span>&nbsp;<span class="op" id="6832886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6832890">t</span><span class="op" id="6832891">.</span><span class="ident" id="6832892">Fatalf</span><span class="op" id="6832898">(</span><span class="string" id="6832899">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6832920">,</span>&nbsp;<span class="ident" id="6832922">err</span><span class="op" id="6832925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6832928">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832931">defer</span>&nbsp;<span class="ident" id="6832937">c2</span><span class="op" id="6832939">.</span><span class="ident" id="6832940">Close</span><span class="op" id="6832945">(</span><span class="op" id="6832946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6832950">if</span>&nbsp;<span class="op" id="6832953">!</span><span class="ident" id="6832954">reflect</span><span class="op" id="6832961">.</span><span class="ident" id="6832962">DeepEqual</span><span class="op" id="6832971">(</span><span class="ident" id="6832972">c1</span><span class="op" id="6832974">.</span><span class="ident" id="6832975">LocalAddr</span><span class="op" id="6832984">(</span><span class="op" id="6832985">)</span><span class="op" id="6832986">,</span>&nbsp;<span class="ident" id="6832988">c2</span><span class="op" id="6832990">.</span><span class="ident" id="6832991">RemoteAddr</span><span class="op" id="6833001">(</span><span class="op" id="6833002">)</span><span class="op" id="6833003">)</span>&nbsp;<span class="op" id="6833005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833009">t</span><span class="op" id="6833010">.</span><span class="ident" id="6833011">Fatalf</span><span class="op" id="6833017">(</span><span class="string" id="6833018">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6833056">,</span>&nbsp;<span class="ident" id="6833058">c1</span><span class="op" id="6833060">.</span><span class="ident" id="6833061">LocalAddr</span><span class="op" id="6833070">(</span><span class="op" id="6833071">)</span><span class="op" id="6833072">,</span>&nbsp;<span class="ident" id="6833074">c2</span><span class="op" id="6833076">.</span><span class="ident" id="6833077">RemoteAddr</span><span class="op" id="6833087">(</span><span class="op" id="6833088">)</span><span class="op" id="6833089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833092">}</span><br>
<span class="lineno">140</span><span class="op" id="6833094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6833097">func</span>&nbsp;<span class="ident" id="6833102">TestUnixAutobindClose</span><span class="op" id="6833123">(</span><span class="ident" id="6833124">t</span>&nbsp;<span class="op" id="6833126">*</span><span class="ident" id="6833127">testing</span><span class="op" id="6833134">.</span><span class="ident" id="6833135">T</span><span class="op" id="6833136">)</span>&nbsp;<span class="op" id="6833138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833141">if</span>&nbsp;<span class="ident" id="6833144">runtime</span><span class="op" id="6833151">.</span><span class="ident" id="6833152">GOOS</span>&nbsp;<span class="op" id="6833157">!=</span>&nbsp;<span class="string" id="6833160">&#34;linux&#34;</span>&nbsp;<span class="op" id="6833168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833172">t</span><span class="op" id="6833173">.</span><span class="ident" id="6833174">Skip</span><span class="op" id="6833178">(</span><span class="string" id="6833179">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6833213">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833219">laddr</span>&nbsp;<span class="op" id="6833225">:=</span>&nbsp;<span class="op" id="6833228">&amp;</span><span class="ident" id="6833229">UnixAddr</span><span class="op" id="6833237">{</span><span class="ident" id="6833238">Name</span><span class="op" id="6833242">:</span>&nbsp;<span class="string" id="6833244">&#34;&#34;</span><span class="op" id="6833246">,</span>&nbsp;<span class="ident" id="6833248">Net</span><span class="op" id="6833251">:</span>&nbsp;<span class="string" id="6833253">&#34;unix&#34;</span><span class="op" id="6833259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833262">ln</span><span class="op" id="6833264">,</span>&nbsp;<span class="ident" id="6833266">err</span>&nbsp;<span class="op" id="6833270">:=</span>&nbsp;<span class="ident" id="6833273">ListenUnix</span><span class="op" id="6833283">(</span><span class="string" id="6833284">&#34;unix&#34;</span><span class="op" id="6833290">,</span>&nbsp;<span class="ident" id="6833292">laddr</span><span class="op" id="6833297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833300">if</span>&nbsp;<span class="ident" id="6833303">err</span>&nbsp;<span class="op" id="6833307">!=</span>&nbsp;<span class="builtintype" id="6833310">nil</span>&nbsp;<span class="op" id="6833314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833318">t</span><span class="op" id="6833319">.</span><span class="ident" id="6833320">Fatalf</span><span class="op" id="6833326">(</span><span class="string" id="6833327">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6833350">,</span>&nbsp;<span class="ident" id="6833352">err</span><span class="op" id="6833355">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833361">ln</span><span class="op" id="6833363">.</span><span class="ident" id="6833364">Close</span><span class="op" id="6833369">(</span><span class="op" id="6833370">)</span><br>
<span class="lineno"></span><span class="op" id="6833372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6833375">func</span>&nbsp;<span class="ident" id="6833380">TestUnixgramWrite</span><span class="op" id="6833397">(</span><span class="ident" id="6833398">t</span>&nbsp;<span class="op" id="6833400">*</span><span class="ident" id="6833401">testing</span><span class="op" id="6833408">.</span><span class="ident" id="6833409">T</span><span class="op" id="6833410">)</span>&nbsp;<span class="op" id="6833412">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833415">addr</span>&nbsp;<span class="op" id="6833420">:=</span>&nbsp;<span class="ident" id="6833423">testUnixAddr</span><span class="op" id="6833435">(</span><span class="op" id="6833436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833439">laddr</span><span class="op" id="6833444">,</span>&nbsp;<span class="ident" id="6833446">err</span>&nbsp;<span class="op" id="6833450">:=</span>&nbsp;<span class="ident" id="6833453">ResolveUnixAddr</span><span class="op" id="6833468">(</span><span class="string" id="6833469">&#34;unixgram&#34;</span><span class="op" id="6833479">,</span>&nbsp;<span class="ident" id="6833481">addr</span><span class="op" id="6833485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833488">if</span>&nbsp;<span class="ident" id="6833491">err</span>&nbsp;<span class="op" id="6833495">!=</span>&nbsp;<span class="builtintype" id="6833498">nil</span>&nbsp;<span class="op" id="6833502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833506">t</span><span class="op" id="6833507">.</span><span class="ident" id="6833508">Fatalf</span><span class="op" id="6833514">(</span><span class="string" id="6833515">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6833543">,</span>&nbsp;<span class="ident" id="6833545">err</span><span class="op" id="6833548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833551">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833554">c</span><span class="op" id="6833555">,</span>&nbsp;<span class="ident" id="6833557">err</span>&nbsp;<span class="op" id="6833561">:=</span>&nbsp;<span class="ident" id="6833564">ListenPacket</span><span class="op" id="6833576">(</span><span class="string" id="6833577">&#34;unixgram&#34;</span><span class="op" id="6833587">,</span>&nbsp;<span class="ident" id="6833589">addr</span><span class="op" id="6833593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833596">if</span>&nbsp;<span class="ident" id="6833599">err</span>&nbsp;<span class="op" id="6833603">!=</span>&nbsp;<span class="builtintype" id="6833606">nil</span>&nbsp;<span class="op" id="6833610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833614">t</span><span class="op" id="6833615">.</span><span class="ident" id="6833616">Fatalf</span><span class="op" id="6833622">(</span><span class="string" id="6833623">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6833648">,</span>&nbsp;<span class="ident" id="6833650">err</span><span class="op" id="6833653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833659">defer</span>&nbsp;<span class="ident" id="6833665">os</span><span class="op" id="6833667">.</span><span class="ident" id="6833668">Remove</span><span class="op" id="6833674">(</span><span class="ident" id="6833675">addr</span><span class="op" id="6833679">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833682">defer</span>&nbsp;<span class="ident" id="6833688">c</span><span class="op" id="6833689">.</span><span class="ident" id="6833690">Close</span><span class="op" id="6833695">(</span><span class="op" id="6833696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833700">testUnixgramWriteConn</span><span class="op" id="6833721">(</span><span class="ident" id="6833722">t</span><span class="op" id="6833723">,</span>&nbsp;<span class="ident" id="6833725">laddr</span><span class="op" id="6833730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833733">testUnixgramWritePacketConn</span><span class="op" id="6833760">(</span><span class="ident" id="6833761">t</span><span class="op" id="6833762">,</span>&nbsp;<span class="ident" id="6833764">laddr</span><span class="op" id="6833769">)</span><br>
<span class="lineno"></span><span class="op" id="6833771">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6833774">func</span>&nbsp;<span class="ident" id="6833779">testUnixgramWriteConn</span><span class="op" id="6833800">(</span><span class="ident" id="6833801">t</span>&nbsp;<span class="op" id="6833803">*</span><span class="ident" id="6833804">testing</span><span class="op" id="6833811">.</span><span class="ident" id="6833812">T</span><span class="op" id="6833813">,</span>&nbsp;<span class="ident" id="6833815">raddr</span>&nbsp;<span class="op" id="6833821">*</span><span class="ident" id="6833822">UnixAddr</span><span class="op" id="6833830">)</span>&nbsp;<span class="op" id="6833832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833835">c</span><span class="op" id="6833836">,</span>&nbsp;<span class="ident" id="6833838">err</span>&nbsp;<span class="op" id="6833842">:=</span>&nbsp;<span class="ident" id="6833845">Dial</span><span class="op" id="6833849">(</span><span class="string" id="6833850">&#34;unixgram&#34;</span><span class="op" id="6833860">,</span>&nbsp;<span class="ident" id="6833862">raddr</span><span class="op" id="6833867">.</span><span class="ident" id="6833868">String</span><span class="op" id="6833874">(</span><span class="op" id="6833875">)</span><span class="op" id="6833876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833879">if</span>&nbsp;<span class="ident" id="6833882">err</span>&nbsp;<span class="op" id="6833886">!=</span>&nbsp;<span class="builtintype" id="6833889">nil</span>&nbsp;<span class="op" id="6833893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6833897">t</span><span class="op" id="6833898">.</span><span class="ident" id="6833899">Fatalf</span><span class="op" id="6833905">(</span><span class="string" id="6833906">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6833923">,</span>&nbsp;<span class="ident" id="6833925">err</span><span class="op" id="6833928">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6833931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833934">defer</span>&nbsp;<span class="ident" id="6833940">c</span><span class="op" id="6833941">.</span><span class="ident" id="6833942">Close</span><span class="op" id="6833947">(</span><span class="op" id="6833948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6833952">if</span>&nbsp;<span class="ident" id="6833955">_</span><span class="op" id="6833956">,</span>&nbsp;<span class="ident" id="6833958">err</span>&nbsp;<span class="op" id="6833962">:=</span>&nbsp;<span class="ident" id="6833965">c</span><span class="op" id="6833966">.</span><span class="op" id="6833967">(</span><span class="op" id="6833968">*</span><span class="ident" id="6833969">UnixConn</span><span class="op" id="6833977">)</span><span class="op" id="6833978">.</span><span class="ident" id="6833979">WriteToUnix</span><span class="op" id="6833990">(</span><span class="op" id="6833991">[</span><span class="op" id="6833992">]</span><span class="builtintype" id="6833993">byte</span><span class="op" id="6833997">(</span><span class="string" id="6833998">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6834031">)</span><span class="op" id="6834032">,</span>&nbsp;<span class="ident" id="6834034">raddr</span><span class="op" id="6834039">)</span><span class="op" id="6834040">;</span>&nbsp;<span class="ident" id="6834042">err</span>&nbsp;<span class="op" id="6834046">==</span>&nbsp;<span class="builtintype" id="6834049">nil</span>&nbsp;<span class="op" id="6834053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834057">t</span><span class="op" id="6834058">.</span><span class="ident" id="6834059">Fatal</span><span class="op" id="6834064">(</span><span class="string" id="6834065">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6834090">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834093">}</span>&nbsp;<span class="keyword" id="6834095">else</span>&nbsp;<span class="keyword" id="6834100">if</span>&nbsp;<span class="ident" id="6834103">err</span><span class="op" id="6834106">.</span><span class="op" id="6834107">(</span><span class="op" id="6834108">*</span><span class="ident" id="6834109">OpError</span><span class="op" id="6834116">)</span><span class="op" id="6834117">.</span><span class="ident" id="6834118">Err</span>&nbsp;<span class="op" id="6834122">!=</span>&nbsp;<span class="ident" id="6834125">ErrWriteToConnected</span>&nbsp;<span class="op" id="6834145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834149">t</span><span class="op" id="6834150">.</span><span class="ident" id="6834151">Fatalf</span><span class="op" id="6834157">(</span><span class="string" id="6834158">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6834210">,</span>&nbsp;<span class="ident" id="6834212">err</span><span class="op" id="6834215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6834221">if</span>&nbsp;<span class="ident" id="6834224">_</span><span class="op" id="6834225">,</span>&nbsp;<span class="ident" id="6834227">err</span>&nbsp;<span class="op" id="6834231">=</span>&nbsp;<span class="ident" id="6834233">c</span><span class="op" id="6834234">.</span><span class="op" id="6834235">(</span><span class="op" id="6834236">*</span><span class="ident" id="6834237">UnixConn</span><span class="op" id="6834245">)</span><span class="op" id="6834246">.</span><span class="ident" id="6834247">WriteTo</span><span class="op" id="6834254">(</span><span class="op" id="6834255">[</span><span class="op" id="6834256">]</span><span class="builtintype" id="6834257">byte</span><span class="op" id="6834261">(</span><span class="string" id="6834262">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6834295">)</span><span class="op" id="6834296">,</span>&nbsp;<span class="ident" id="6834298">raddr</span><span class="op" id="6834303">)</span><span class="op" id="6834304">;</span>&nbsp;<span class="ident" id="6834306">err</span>&nbsp;<span class="op" id="6834310">==</span>&nbsp;<span class="builtintype" id="6834313">nil</span>&nbsp;<span class="op" id="6834317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834321">t</span><span class="op" id="6834322">.</span><span class="ident" id="6834323">Fatal</span><span class="op" id="6834328">(</span><span class="string" id="6834329">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6834350">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834353">}</span>&nbsp;<span class="keyword" id="6834355">else</span>&nbsp;<span class="keyword" id="6834360">if</span>&nbsp;<span class="ident" id="6834363">err</span><span class="op" id="6834366">.</span><span class="op" id="6834367">(</span><span class="op" id="6834368">*</span><span class="ident" id="6834369">OpError</span><span class="op" id="6834376">)</span><span class="op" id="6834377">.</span><span class="ident" id="6834378">Err</span>&nbsp;<span class="op" id="6834382">!=</span>&nbsp;<span class="ident" id="6834385">ErrWriteToConnected</span>&nbsp;<span class="op" id="6834405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834409">t</span><span class="op" id="6834410">.</span><span class="ident" id="6834411">Fatalf</span><span class="op" id="6834417">(</span><span class="string" id="6834418">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6834466">,</span>&nbsp;<span class="ident" id="6834468">err</span><span class="op" id="6834471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6834477">if</span>&nbsp;<span class="ident" id="6834480">_</span><span class="op" id="6834481">,</span>&nbsp;<span class="ident" id="6834483">_</span><span class="op" id="6834484">,</span>&nbsp;<span class="ident" id="6834486">err</span>&nbsp;<span class="op" id="6834490">=</span>&nbsp;<span class="ident" id="6834492">c</span><span class="op" id="6834493">.</span><span class="op" id="6834494">(</span><span class="op" id="6834495">*</span><span class="ident" id="6834496">UnixConn</span><span class="op" id="6834504">)</span><span class="op" id="6834505">.</span><span class="ident" id="6834506">WriteMsgUnix</span><span class="op" id="6834518">(</span><span class="op" id="6834519">[</span><span class="op" id="6834520">]</span><span class="builtintype" id="6834521">byte</span><span class="op" id="6834525">(</span><span class="string" id="6834526">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6834559">)</span><span class="op" id="6834560">,</span>&nbsp;<span class="builtintype" id="6834562">nil</span><span class="op" id="6834565">,</span>&nbsp;<span class="ident" id="6834567">raddr</span><span class="op" id="6834572">)</span><span class="op" id="6834573">;</span>&nbsp;<span class="ident" id="6834575">err</span>&nbsp;<span class="op" id="6834579">==</span>&nbsp;<span class="builtintype" id="6834582">nil</span>&nbsp;<span class="op" id="6834586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834590">t</span><span class="op" id="6834591">.</span><span class="ident" id="6834592">Fatal</span><span class="op" id="6834597">(</span><span class="string" id="6834598">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6834619">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834622">}</span>&nbsp;<span class="keyword" id="6834624">else</span>&nbsp;<span class="keyword" id="6834629">if</span>&nbsp;<span class="ident" id="6834632">err</span><span class="op" id="6834635">.</span><span class="op" id="6834636">(</span><span class="op" id="6834637">*</span><span class="ident" id="6834638">OpError</span><span class="op" id="6834645">)</span><span class="op" id="6834646">.</span><span class="ident" id="6834647">Err</span>&nbsp;<span class="op" id="6834651">!=</span>&nbsp;<span class="ident" id="6834654">ErrWriteToConnected</span>&nbsp;<span class="op" id="6834674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834678">t</span><span class="op" id="6834679">.</span><span class="ident" id="6834680">Fatalf</span><span class="op" id="6834686">(</span><span class="string" id="6834687">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6834740">,</span>&nbsp;<span class="ident" id="6834742">err</span><span class="op" id="6834745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6834751">if</span>&nbsp;<span class="ident" id="6834754">_</span><span class="op" id="6834755">,</span>&nbsp;<span class="ident" id="6834757">err</span>&nbsp;<span class="op" id="6834761">:=</span>&nbsp;<span class="ident" id="6834764">c</span><span class="op" id="6834765">.</span><span class="ident" id="6834766">Write</span><span class="op" id="6834771">(</span><span class="op" id="6834772">[</span><span class="op" id="6834773">]</span><span class="builtintype" id="6834774">byte</span><span class="op" id="6834778">(</span><span class="string" id="6834779">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6834812">)</span><span class="op" id="6834813">)</span><span class="op" id="6834814">;</span>&nbsp;<span class="ident" id="6834816">err</span>&nbsp;<span class="op" id="6834820">!=</span>&nbsp;<span class="builtintype" id="6834823">nil</span>&nbsp;<span class="op" id="6834827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834831">t</span><span class="op" id="6834832">.</span><span class="ident" id="6834833">Fatalf</span><span class="op" id="6834839">(</span><span class="string" id="6834840">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6834858">,</span>&nbsp;<span class="ident" id="6834860">err</span><span class="op" id="6834863">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6834866">}</span><br>
<span class="lineno"></span><span class="op" id="6834868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6834871">func</span>&nbsp;<span class="ident" id="6834876">testUnixgramWritePacketConn</span><span class="op" id="6834903">(</span><span class="ident" id="6834904">t</span>&nbsp;<span class="op" id="6834906">*</span><span class="ident" id="6834907">testing</span><span class="op" id="6834914">.</span><span class="ident" id="6834915">T</span><span class="op" id="6834916">,</span>&nbsp;<span class="ident" id="6834918">raddr</span>&nbsp;<span class="op" id="6834924">*</span><span class="ident" id="6834925">UnixAddr</span><span class="op" id="6834933">)</span>&nbsp;<span class="op" id="6834935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834938">addr</span>&nbsp;<span class="op" id="6834943">:=</span>&nbsp;<span class="ident" id="6834946">testUnixAddr</span><span class="op" id="6834958">(</span><span class="op" id="6834959">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6834962">c</span><span class="op" id="6834963">,</span>&nbsp;<span class="ident" id="6834965">err</span>&nbsp;<span class="op" id="6834969">:=</span>&nbsp;<span class="ident" id="6834972">ListenPacket</span><span class="op" id="6834984">(</span><span class="string" id="6834985">&#34;unixgram&#34;</span><span class="op" id="6834995">,</span>&nbsp;<span class="ident" id="6834997">addr</span><span class="op" id="6835001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835004">if</span>&nbsp;<span class="ident" id="6835007">err</span>&nbsp;<span class="op" id="6835011">!=</span>&nbsp;<span class="builtintype" id="6835014">nil</span>&nbsp;<span class="op" id="6835018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835022">t</span><span class="op" id="6835023">.</span><span class="ident" id="6835024">Fatalf</span><span class="op" id="6835030">(</span><span class="string" id="6835031">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6835056">,</span>&nbsp;<span class="ident" id="6835058">err</span><span class="op" id="6835061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835067">defer</span>&nbsp;<span class="ident" id="6835073">os</span><span class="op" id="6835075">.</span><span class="ident" id="6835076">Remove</span><span class="op" id="6835082">(</span><span class="ident" id="6835083">addr</span><span class="op" id="6835087">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835090">defer</span>&nbsp;<span class="ident" id="6835096">c</span><span class="op" id="6835097">.</span><span class="ident" id="6835098">Close</span><span class="op" id="6835103">(</span><span class="op" id="6835104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835108">if</span>&nbsp;<span class="ident" id="6835111">_</span><span class="op" id="6835112">,</span>&nbsp;<span class="ident" id="6835114">err</span>&nbsp;<span class="op" id="6835118">:=</span>&nbsp;<span class="ident" id="6835121">c</span><span class="op" id="6835122">.</span><span class="op" id="6835123">(</span><span class="op" id="6835124">*</span><span class="ident" id="6835125">UnixConn</span><span class="op" id="6835133">)</span><span class="op" id="6835134">.</span><span class="ident" id="6835135">WriteToUnix</span><span class="op" id="6835146">(</span><span class="op" id="6835147">[</span><span class="op" id="6835148">]</span><span class="builtintype" id="6835149">byte</span><span class="op" id="6835153">(</span><span class="string" id="6835154">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6835182">)</span><span class="op" id="6835183">,</span>&nbsp;<span class="ident" id="6835185">raddr</span><span class="op" id="6835190">)</span><span class="op" id="6835191">;</span>&nbsp;<span class="ident" id="6835193">err</span>&nbsp;<span class="op" id="6835197">!=</span>&nbsp;<span class="builtintype" id="6835200">nil</span>&nbsp;<span class="op" id="6835204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835208">t</span><span class="op" id="6835209">.</span><span class="ident" id="6835210">Fatalf</span><span class="op" id="6835216">(</span><span class="string" id="6835217">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6835241">,</span>&nbsp;<span class="ident" id="6835243">err</span><span class="op" id="6835246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835249">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835252">if</span>&nbsp;<span class="ident" id="6835255">_</span><span class="op" id="6835256">,</span>&nbsp;<span class="ident" id="6835258">err</span>&nbsp;<span class="op" id="6835262">:=</span>&nbsp;<span class="ident" id="6835265">c</span><span class="op" id="6835266">.</span><span class="ident" id="6835267">WriteTo</span><span class="op" id="6835274">(</span><span class="op" id="6835275">[</span><span class="op" id="6835276">]</span><span class="builtintype" id="6835277">byte</span><span class="op" id="6835281">(</span><span class="string" id="6835282">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6835310">)</span><span class="op" id="6835311">,</span>&nbsp;<span class="ident" id="6835313">raddr</span><span class="op" id="6835318">)</span><span class="op" id="6835319">;</span>&nbsp;<span class="ident" id="6835321">err</span>&nbsp;<span class="op" id="6835325">!=</span>&nbsp;<span class="builtintype" id="6835328">nil</span>&nbsp;<span class="op" id="6835332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835336">t</span><span class="op" id="6835337">.</span><span class="ident" id="6835338">Fatalf</span><span class="op" id="6835344">(</span><span class="string" id="6835345">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6835365">,</span>&nbsp;<span class="ident" id="6835367">err</span><span class="op" id="6835370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835376">if</span>&nbsp;<span class="ident" id="6835379">_</span><span class="op" id="6835380">,</span>&nbsp;<span class="ident" id="6835382">_</span><span class="op" id="6835383">,</span>&nbsp;<span class="ident" id="6835385">err</span>&nbsp;<span class="op" id="6835389">:=</span>&nbsp;<span class="ident" id="6835392">c</span><span class="op" id="6835393">.</span><span class="op" id="6835394">(</span><span class="op" id="6835395">*</span><span class="ident" id="6835396">UnixConn</span><span class="op" id="6835404">)</span><span class="op" id="6835405">.</span><span class="ident" id="6835406">WriteMsgUnix</span><span class="op" id="6835418">(</span><span class="op" id="6835419">[</span><span class="op" id="6835420">]</span><span class="builtintype" id="6835421">byte</span><span class="op" id="6835425">(</span><span class="string" id="6835426">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6835454">)</span><span class="op" id="6835455">,</span>&nbsp;<span class="builtintype" id="6835457">nil</span><span class="op" id="6835460">,</span>&nbsp;<span class="ident" id="6835462">raddr</span><span class="op" id="6835467">)</span><span class="op" id="6835468">;</span>&nbsp;<span class="ident" id="6835470">err</span>&nbsp;<span class="op" id="6835474">!=</span>&nbsp;<span class="builtintype" id="6835477">nil</span>&nbsp;<span class="op" id="6835481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835485">t</span><span class="op" id="6835486">.</span><span class="ident" id="6835487">Fatalf</span><span class="op" id="6835493">(</span><span class="string" id="6835494">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6835519">,</span>&nbsp;<span class="ident" id="6835521">err</span><span class="op" id="6835524">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835530">if</span>&nbsp;<span class="ident" id="6835533">_</span><span class="op" id="6835534">,</span>&nbsp;<span class="ident" id="6835536">err</span>&nbsp;<span class="op" id="6835540">:=</span>&nbsp;<span class="ident" id="6835543">c</span><span class="op" id="6835544">.</span><span class="op" id="6835545">(</span><span class="op" id="6835546">*</span><span class="ident" id="6835547">UnixConn</span><span class="op" id="6835555">)</span><span class="op" id="6835556">.</span><span class="ident" id="6835557">Write</span><span class="op" id="6835562">(</span><span class="op" id="6835563">[</span><span class="op" id="6835564">]</span><span class="builtintype" id="6835565">byte</span><span class="op" id="6835569">(</span><span class="string" id="6835570">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6835598">)</span><span class="op" id="6835599">)</span><span class="op" id="6835600">;</span>&nbsp;<span class="ident" id="6835602">err</span>&nbsp;<span class="op" id="6835606">==</span>&nbsp;<span class="builtintype" id="6835609">nil</span>&nbsp;<span class="op" id="6835613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835617">t</span><span class="op" id="6835618">.</span><span class="ident" id="6835619">Fatal</span><span class="op" id="6835624">(</span><span class="string" id="6835625">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6835644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835647">}</span><br>
<span class="lineno"></span><span class="op" id="6835649">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6835652">func</span>&nbsp;<span class="ident" id="6835657">TestUnixConnLocalAndRemoteNames</span><span class="op" id="6835688">(</span><span class="ident" id="6835689">t</span>&nbsp;<span class="op" id="6835691">*</span><span class="ident" id="6835692">testing</span><span class="op" id="6835699">.</span><span class="ident" id="6835700">T</span><span class="op" id="6835701">)</span>&nbsp;<span class="op" id="6835703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835706">for</span>&nbsp;<span class="ident" id="6835710">_</span><span class="op" id="6835711">,</span>&nbsp;<span class="ident" id="6835713">laddr</span>&nbsp;<span class="op" id="6835719">:=</span>&nbsp;<span class="keyword" id="6835722">range</span>&nbsp;<span class="op" id="6835728">[</span><span class="op" id="6835729">]</span><span class="builtintype" id="6835730">string</span><span class="op" id="6835736">{</span><span class="string" id="6835737">&#34;&#34;</span><span class="op" id="6835739">,</span>&nbsp;<span class="ident" id="6835741">testUnixAddr</span><span class="op" id="6835753">(</span><span class="op" id="6835754">)</span><span class="op" id="6835755">}</span>&nbsp;<span class="op" id="6835757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835761">laddr</span>&nbsp;<span class="op" id="6835767">:=</span>&nbsp;<span class="ident" id="6835770">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835778">taddr</span>&nbsp;<span class="op" id="6835784">:=</span>&nbsp;<span class="ident" id="6835787">testUnixAddr</span><span class="op" id="6835799">(</span><span class="op" id="6835800">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835804">ta</span><span class="op" id="6835806">,</span>&nbsp;<span class="ident" id="6835808">err</span>&nbsp;<span class="op" id="6835812">:=</span>&nbsp;<span class="ident" id="6835815">ResolveUnixAddr</span><span class="op" id="6835830">(</span><span class="string" id="6835831">&#34;unix&#34;</span><span class="op" id="6835837">,</span>&nbsp;<span class="ident" id="6835839">taddr</span><span class="op" id="6835844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835848">if</span>&nbsp;<span class="ident" id="6835851">err</span>&nbsp;<span class="op" id="6835855">!=</span>&nbsp;<span class="builtintype" id="6835858">nil</span>&nbsp;<span class="op" id="6835862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835867">t</span><span class="op" id="6835868">.</span><span class="ident" id="6835869">Fatalf</span><span class="op" id="6835875">(</span><span class="string" id="6835876">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6835904">,</span>&nbsp;<span class="ident" id="6835906">err</span><span class="op" id="6835909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6835913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835917">ln</span><span class="op" id="6835919">,</span>&nbsp;<span class="ident" id="6835921">err</span>&nbsp;<span class="op" id="6835925">:=</span>&nbsp;<span class="ident" id="6835928">ListenUnix</span><span class="op" id="6835938">(</span><span class="string" id="6835939">&#34;unix&#34;</span><span class="op" id="6835945">,</span>&nbsp;<span class="ident" id="6835947">ta</span><span class="op" id="6835949">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6835953">if</span>&nbsp;<span class="ident" id="6835956">err</span>&nbsp;<span class="op" id="6835960">!=</span>&nbsp;<span class="builtintype" id="6835963">nil</span>&nbsp;<span class="op" id="6835967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6835972">t</span><span class="op" id="6835973">.</span><span class="ident" id="6835974">Fatalf</span><span class="op" id="6835980">(</span><span class="string" id="6835981">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6836004">,</span>&nbsp;<span class="ident" id="6836006">err</span><span class="op" id="6836009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836017">defer</span>&nbsp;<span class="keyword" id="6836023">func</span><span class="op" id="6836027">(</span><span class="op" id="6836028">)</span>&nbsp;<span class="op" id="6836030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836035">ln</span><span class="op" id="6836037">.</span><span class="ident" id="6836038">Close</span><span class="op" id="6836043">(</span><span class="op" id="6836044">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836049">os</span><span class="op" id="6836051">.</span><span class="ident" id="6836052">Remove</span><span class="op" id="6836058">(</span><span class="ident" id="6836059">taddr</span><span class="op" id="6836064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836068">}</span><span class="op" id="6836069">(</span><span class="op" id="6836070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836075">done</span>&nbsp;<span class="op" id="6836080">:=</span>&nbsp;<span class="builtinfunc" id="6836083">make</span><span class="op" id="6836087">(</span><span class="keyword" id="6836088">chan</span>&nbsp;<span class="builtintype" id="6836093">int</span><span class="op" id="6836096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836100">go</span>&nbsp;<span class="ident" id="6836103">transponder</span><span class="op" id="6836114">(</span><span class="ident" id="6836115">t</span><span class="op" id="6836116">,</span>&nbsp;<span class="ident" id="6836118">ln</span><span class="op" id="6836120">,</span>&nbsp;<span class="ident" id="6836122">done</span><span class="op" id="6836126">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836131">la</span><span class="op" id="6836133">,</span>&nbsp;<span class="ident" id="6836135">err</span>&nbsp;<span class="op" id="6836139">:=</span>&nbsp;<span class="ident" id="6836142">ResolveUnixAddr</span><span class="op" id="6836157">(</span><span class="string" id="6836158">&#34;unix&#34;</span><span class="op" id="6836164">,</span>&nbsp;<span class="ident" id="6836166">laddr</span><span class="op" id="6836171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836175">if</span>&nbsp;<span class="ident" id="6836178">err</span>&nbsp;<span class="op" id="6836182">!=</span>&nbsp;<span class="builtintype" id="6836185">nil</span>&nbsp;<span class="op" id="6836189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836194">t</span><span class="op" id="6836195">.</span><span class="ident" id="6836196">Fatalf</span><span class="op" id="6836202">(</span><span class="string" id="6836203">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6836231">,</span>&nbsp;<span class="ident" id="6836233">err</span><span class="op" id="6836236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836240">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836244">c</span><span class="op" id="6836245">,</span>&nbsp;<span class="ident" id="6836247">err</span>&nbsp;<span class="op" id="6836251">:=</span>&nbsp;<span class="ident" id="6836254">DialUnix</span><span class="op" id="6836262">(</span><span class="string" id="6836263">&#34;unix&#34;</span><span class="op" id="6836269">,</span>&nbsp;<span class="ident" id="6836271">la</span><span class="op" id="6836273">,</span>&nbsp;<span class="ident" id="6836275">ta</span><span class="op" id="6836277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836281">if</span>&nbsp;<span class="ident" id="6836284">err</span>&nbsp;<span class="op" id="6836288">!=</span>&nbsp;<span class="builtintype" id="6836291">nil</span>&nbsp;<span class="op" id="6836295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836300">t</span><span class="op" id="6836301">.</span><span class="ident" id="6836302">Fatalf</span><span class="op" id="6836308">(</span><span class="string" id="6836309">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6836330">,</span>&nbsp;<span class="ident" id="6836332">err</span><span class="op" id="6836335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836343">defer</span>&nbsp;<span class="keyword" id="6836349">func</span><span class="op" id="6836353">(</span><span class="op" id="6836354">)</span>&nbsp;<span class="op" id="6836356">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836361">c</span><span class="op" id="6836362">.</span><span class="ident" id="6836363">Close</span><span class="op" id="6836368">(</span><span class="op" id="6836369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836374">if</span>&nbsp;<span class="ident" id="6836377">la</span>&nbsp;<span class="op" id="6836380">!=</span>&nbsp;<span class="builtintype" id="6836383">nil</span>&nbsp;<span class="op" id="6836387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836393">defer</span>&nbsp;<span class="ident" id="6836399">os</span><span class="op" id="6836401">.</span><span class="ident" id="6836402">Remove</span><span class="op" id="6836408">(</span><span class="ident" id="6836409">laddr</span><span class="op" id="6836414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836423">}</span><span class="op" id="6836424">(</span><span class="op" id="6836425">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836429">if</span>&nbsp;<span class="ident" id="6836432">_</span><span class="op" id="6836433">,</span>&nbsp;<span class="ident" id="6836435">err</span>&nbsp;<span class="op" id="6836439">:=</span>&nbsp;<span class="ident" id="6836442">c</span><span class="op" id="6836443">.</span><span class="ident" id="6836444">Write</span><span class="op" id="6836449">(</span><span class="op" id="6836450">[</span><span class="op" id="6836451">]</span><span class="builtintype" id="6836452">byte</span><span class="op" id="6836456">(</span><span class="string" id="6836457">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="6836494">)</span><span class="op" id="6836495">)</span><span class="op" id="6836496">;</span>&nbsp;<span class="ident" id="6836498">err</span>&nbsp;<span class="op" id="6836502">!=</span>&nbsp;<span class="builtintype" id="6836505">nil</span>&nbsp;<span class="op" id="6836509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836514">t</span><span class="op" id="6836515">.</span><span class="ident" id="6836516">Fatalf</span><span class="op" id="6836522">(</span><span class="string" id="6836523">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6836550">,</span>&nbsp;<span class="ident" id="6836552">err</span><span class="op" id="6836555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836564">switch</span>&nbsp;<span class="ident" id="6836571">runtime</span><span class="op" id="6836578">.</span><span class="ident" id="6836579">GOOS</span>&nbsp;<span class="op" id="6836584">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836588">case</span>&nbsp;<span class="string" id="6836593">&#34;android&#34;</span><span class="op" id="6836602">,</span>&nbsp;<span class="string" id="6836604">&#34;linux&#34;</span><span class="op" id="6836611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836616">if</span>&nbsp;<span class="ident" id="6836619">laddr</span>&nbsp;<span class="op" id="6836625">==</span>&nbsp;<span class="string" id="6836628">&#34;&#34;</span>&nbsp;<span class="op" id="6836631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836637">laddr</span>&nbsp;<span class="op" id="6836643">=</span>&nbsp;<span class="string" id="6836645">&#34;@&#34;</span>&nbsp;<span class="comment" id="6836649">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836676">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836680">var</span>&nbsp;<span class="ident" id="6836684">connAddrs</span>&nbsp;<span class="op" id="6836694">=</span>&nbsp;<span class="op" id="6836696">[</span><span class="num" id="6836697">3</span><span class="op" id="6836698">]</span><span class="keyword" id="6836699">struct</span><span class="op" id="6836705">{</span>&nbsp;<span class="ident" id="6836707">got</span><span class="op" id="6836710">,</span>&nbsp;<span class="ident" id="6836712">want</span>&nbsp;<span class="ident" id="6836717">Addr</span>&nbsp;<span class="op" id="6836722">}</span><span class="op" id="6836723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836728">{</span><span class="ident" id="6836729">ln</span><span class="op" id="6836731">.</span><span class="ident" id="6836732">Addr</span><span class="op" id="6836736">(</span><span class="op" id="6836737">)</span><span class="op" id="6836738">,</span>&nbsp;<span class="ident" id="6836740">ta</span><span class="op" id="6836742">}</span><span class="op" id="6836743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836748">{</span><span class="ident" id="6836749">c</span><span class="op" id="6836750">.</span><span class="ident" id="6836751">LocalAddr</span><span class="op" id="6836760">(</span><span class="op" id="6836761">)</span><span class="op" id="6836762">,</span>&nbsp;<span class="op" id="6836764">&amp;</span><span class="ident" id="6836765">UnixAddr</span><span class="op" id="6836773">{</span><span class="ident" id="6836774">Name</span><span class="op" id="6836778">:</span>&nbsp;<span class="ident" id="6836780">laddr</span><span class="op" id="6836785">,</span>&nbsp;<span class="ident" id="6836787">Net</span><span class="op" id="6836790">:</span>&nbsp;<span class="string" id="6836792">&#34;unix&#34;</span><span class="op" id="6836798">}</span><span class="op" id="6836799">}</span><span class="op" id="6836800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836805">{</span><span class="ident" id="6836806">c</span><span class="op" id="6836807">.</span><span class="ident" id="6836808">RemoteAddr</span><span class="op" id="6836818">(</span><span class="op" id="6836819">)</span><span class="op" id="6836820">,</span>&nbsp;<span class="ident" id="6836822">ta</span><span class="op" id="6836824">}</span><span class="op" id="6836825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836829">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836833">for</span>&nbsp;<span class="ident" id="6836837">_</span><span class="op" id="6836838">,</span>&nbsp;<span class="ident" id="6836840">ca</span>&nbsp;<span class="op" id="6836843">:=</span>&nbsp;<span class="keyword" id="6836846">range</span>&nbsp;<span class="ident" id="6836852">connAddrs</span>&nbsp;<span class="op" id="6836862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6836867">if</span>&nbsp;<span class="op" id="6836870">!</span><span class="ident" id="6836871">reflect</span><span class="op" id="6836878">.</span><span class="ident" id="6836879">DeepEqual</span><span class="op" id="6836888">(</span><span class="ident" id="6836889">ca</span><span class="op" id="6836891">.</span><span class="ident" id="6836892">got</span><span class="op" id="6836895">,</span>&nbsp;<span class="ident" id="6836897">ca</span><span class="op" id="6836899">.</span><span class="ident" id="6836900">want</span><span class="op" id="6836904">)</span>&nbsp;<span class="op" id="6836906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6836912">t</span><span class="op" id="6836913">.</span><span class="ident" id="6836914">Fatalf</span><span class="op" id="6836920">(</span><span class="string" id="6836921">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6836944">,</span>&nbsp;<span class="ident" id="6836946">ca</span><span class="op" id="6836948">.</span><span class="ident" id="6836949">got</span><span class="op" id="6836952">,</span>&nbsp;<span class="ident" id="6836954">ca</span><span class="op" id="6836956">.</span><span class="ident" id="6836957">want</span><span class="op" id="6836961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836970">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836975">&lt;-</span><span class="ident" id="6836977">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6836983">}</span><br>
<span class="lineno"></span><span class="op" id="6836985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6836988">func</span>&nbsp;<span class="ident" id="6836993">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="6837028">(</span><span class="ident" id="6837029">t</span>&nbsp;<span class="op" id="6837031">*</span><span class="ident" id="6837032">testing</span><span class="op" id="6837039">.</span><span class="ident" id="6837040">T</span><span class="op" id="6837041">)</span>&nbsp;<span class="op" id="6837043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837046">for</span>&nbsp;<span class="ident" id="6837050">_</span><span class="op" id="6837051">,</span>&nbsp;<span class="ident" id="6837053">laddr</span>&nbsp;<span class="op" id="6837059">:=</span>&nbsp;<span class="keyword" id="6837062">range</span>&nbsp;<span class="op" id="6837068">[</span><span class="op" id="6837069">]</span><span class="builtintype" id="6837070">string</span><span class="op" id="6837076">{</span><span class="string" id="6837077">&#34;&#34;</span><span class="op" id="6837079">,</span>&nbsp;<span class="ident" id="6837081">testUnixAddr</span><span class="op" id="6837093">(</span><span class="op" id="6837094">)</span><span class="op" id="6837095">}</span>&nbsp;<span class="op" id="6837097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837101">laddr</span>&nbsp;<span class="op" id="6837107">:=</span>&nbsp;<span class="ident" id="6837110">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837118">taddr</span>&nbsp;<span class="op" id="6837124">:=</span>&nbsp;<span class="ident" id="6837127">testUnixAddr</span><span class="op" id="6837139">(</span><span class="op" id="6837140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837144">ta</span><span class="op" id="6837146">,</span>&nbsp;<span class="ident" id="6837148">err</span>&nbsp;<span class="op" id="6837152">:=</span>&nbsp;<span class="ident" id="6837155">ResolveUnixAddr</span><span class="op" id="6837170">(</span><span class="string" id="6837171">&#34;unixgram&#34;</span><span class="op" id="6837181">,</span>&nbsp;<span class="ident" id="6837183">taddr</span><span class="op" id="6837188">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837192">if</span>&nbsp;<span class="ident" id="6837195">err</span>&nbsp;<span class="op" id="6837199">!=</span>&nbsp;<span class="builtintype" id="6837202">nil</span>&nbsp;<span class="op" id="6837206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837211">t</span><span class="op" id="6837212">.</span><span class="ident" id="6837213">Fatalf</span><span class="op" id="6837219">(</span><span class="string" id="6837220">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6837248">,</span>&nbsp;<span class="ident" id="6837250">err</span><span class="op" id="6837253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837261">c1</span><span class="op" id="6837263">,</span>&nbsp;<span class="ident" id="6837265">err</span>&nbsp;<span class="op" id="6837269">:=</span>&nbsp;<span class="ident" id="6837272">ListenUnixgram</span><span class="op" id="6837286">(</span><span class="string" id="6837287">&#34;unixgram&#34;</span><span class="op" id="6837297">,</span>&nbsp;<span class="ident" id="6837299">ta</span><span class="op" id="6837301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837305">if</span>&nbsp;<span class="ident" id="6837308">err</span>&nbsp;<span class="op" id="6837312">!=</span>&nbsp;<span class="builtintype" id="6837315">nil</span>&nbsp;<span class="op" id="6837319">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837324">t</span><span class="op" id="6837325">.</span><span class="ident" id="6837326">Fatalf</span><span class="op" id="6837332">(</span><span class="string" id="6837333">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6837360">,</span>&nbsp;<span class="ident" id="6837362">err</span><span class="op" id="6837365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837373">defer</span>&nbsp;<span class="keyword" id="6837379">func</span><span class="op" id="6837383">(</span><span class="op" id="6837384">)</span>&nbsp;<span class="op" id="6837386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837391">c1</span><span class="op" id="6837393">.</span><span class="ident" id="6837394">Close</span><span class="op" id="6837399">(</span><span class="op" id="6837400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837405">os</span><span class="op" id="6837407">.</span><span class="ident" id="6837408">Remove</span><span class="op" id="6837414">(</span><span class="ident" id="6837415">taddr</span><span class="op" id="6837420">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837424">}</span><span class="op" id="6837425">(</span><span class="op" id="6837426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837431">var</span>&nbsp;<span class="ident" id="6837435">la</span>&nbsp;<span class="op" id="6837438">*</span><span class="ident" id="6837439">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837450">if</span>&nbsp;<span class="ident" id="6837453">laddr</span>&nbsp;<span class="op" id="6837459">!=</span>&nbsp;<span class="string" id="6837462">&#34;&#34;</span>&nbsp;<span class="op" id="6837465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837470">if</span>&nbsp;<span class="ident" id="6837473">la</span><span class="op" id="6837475">,</span>&nbsp;<span class="ident" id="6837477">err</span>&nbsp;<span class="op" id="6837481">=</span>&nbsp;<span class="ident" id="6837483">ResolveUnixAddr</span><span class="op" id="6837498">(</span><span class="string" id="6837499">&#34;unixgram&#34;</span><span class="op" id="6837509">,</span>&nbsp;<span class="ident" id="6837511">laddr</span><span class="op" id="6837516">)</span><span class="op" id="6837517">;</span>&nbsp;<span class="ident" id="6837519">err</span>&nbsp;<span class="op" id="6837523">!=</span>&nbsp;<span class="builtintype" id="6837526">nil</span>&nbsp;<span class="op" id="6837530">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837536">t</span><span class="op" id="6837537">.</span><span class="ident" id="6837538">Fatalf</span><span class="op" id="6837544">(</span><span class="string" id="6837545">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6837573">,</span>&nbsp;<span class="ident" id="6837575">err</span><span class="op" id="6837578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837591">c2</span><span class="op" id="6837593">,</span>&nbsp;<span class="ident" id="6837595">err</span>&nbsp;<span class="op" id="6837599">:=</span>&nbsp;<span class="ident" id="6837602">DialUnix</span><span class="op" id="6837610">(</span><span class="string" id="6837611">&#34;unixgram&#34;</span><span class="op" id="6837621">,</span>&nbsp;<span class="ident" id="6837623">la</span><span class="op" id="6837625">,</span>&nbsp;<span class="ident" id="6837627">ta</span><span class="op" id="6837629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837633">if</span>&nbsp;<span class="ident" id="6837636">err</span>&nbsp;<span class="op" id="6837640">!=</span>&nbsp;<span class="builtintype" id="6837643">nil</span>&nbsp;<span class="op" id="6837647">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837652">t</span><span class="op" id="6837653">.</span><span class="ident" id="6837654">Fatalf</span><span class="op" id="6837660">(</span><span class="string" id="6837661">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6837682">,</span>&nbsp;<span class="ident" id="6837684">err</span><span class="op" id="6837687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837695">defer</span>&nbsp;<span class="keyword" id="6837701">func</span><span class="op" id="6837705">(</span><span class="op" id="6837706">)</span>&nbsp;<span class="op" id="6837708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837713">c2</span><span class="op" id="6837715">.</span><span class="ident" id="6837716">Close</span><span class="op" id="6837721">(</span><span class="op" id="6837722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837727">if</span>&nbsp;<span class="ident" id="6837730">la</span>&nbsp;<span class="op" id="6837733">!=</span>&nbsp;<span class="builtintype" id="6837736">nil</span>&nbsp;<span class="op" id="6837740">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837746">defer</span>&nbsp;<span class="ident" id="6837752">os</span><span class="op" id="6837754">.</span><span class="ident" id="6837755">Remove</span><span class="op" id="6837761">(</span><span class="ident" id="6837762">laddr</span><span class="op" id="6837767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837776">}</span><span class="op" id="6837777">(</span><span class="op" id="6837778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837783">switch</span>&nbsp;<span class="ident" id="6837790">runtime</span><span class="op" id="6837797">.</span><span class="ident" id="6837798">GOOS</span>&nbsp;<span class="op" id="6837803">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837807">case</span>&nbsp;<span class="string" id="6837812">&#34;android&#34;</span><span class="op" id="6837821">,</span>&nbsp;<span class="string" id="6837823">&#34;linux&#34;</span><span class="op" id="6837830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837835">if</span>&nbsp;<span class="ident" id="6837838">laddr</span>&nbsp;<span class="op" id="6837844">==</span>&nbsp;<span class="string" id="6837847">&#34;&#34;</span>&nbsp;<span class="op" id="6837850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6837856">laddr</span>&nbsp;<span class="op" id="6837862">=</span>&nbsp;<span class="string" id="6837864">&#34;@&#34;</span>&nbsp;<span class="comment" id="6837868">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837895">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6837900">var</span>&nbsp;<span class="ident" id="6837904">connAddrs</span>&nbsp;<span class="op" id="6837914">=</span>&nbsp;<span class="op" id="6837916">[</span><span class="num" id="6837917">4</span><span class="op" id="6837918">]</span><span class="keyword" id="6837919">struct</span><span class="op" id="6837925">{</span>&nbsp;<span class="ident" id="6837927">got</span><span class="op" id="6837930">,</span>&nbsp;<span class="ident" id="6837932">want</span>&nbsp;<span class="ident" id="6837937">Addr</span>&nbsp;<span class="op" id="6837942">}</span><span class="op" id="6837943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837948">{</span><span class="ident" id="6837949">c1</span><span class="op" id="6837951">.</span><span class="ident" id="6837952">LocalAddr</span><span class="op" id="6837961">(</span><span class="op" id="6837962">)</span><span class="op" id="6837963">,</span>&nbsp;<span class="ident" id="6837965">ta</span><span class="op" id="6837967">}</span><span class="op" id="6837968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6837973">{</span><span class="ident" id="6837974">c1</span><span class="op" id="6837976">.</span><span class="ident" id="6837977">RemoteAddr</span><span class="op" id="6837987">(</span><span class="op" id="6837988">)</span><span class="op" id="6837989">,</span>&nbsp;<span class="builtintype" id="6837991">nil</span><span class="op" id="6837994">}</span><span class="op" id="6837995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838000">{</span><span class="ident" id="6838001">c2</span><span class="op" id="6838003">.</span><span class="ident" id="6838004">LocalAddr</span><span class="op" id="6838013">(</span><span class="op" id="6838014">)</span><span class="op" id="6838015">,</span>&nbsp;<span class="op" id="6838017">&amp;</span><span class="ident" id="6838018">UnixAddr</span><span class="op" id="6838026">{</span><span class="ident" id="6838027">Name</span><span class="op" id="6838031">:</span>&nbsp;<span class="ident" id="6838033">laddr</span><span class="op" id="6838038">,</span>&nbsp;<span class="ident" id="6838040">Net</span><span class="op" id="6838043">:</span>&nbsp;<span class="string" id="6838045">&#34;unixgram&#34;</span><span class="op" id="6838055">}</span><span class="op" id="6838056">}</span><span class="op" id="6838057">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838062">{</span><span class="ident" id="6838063">c2</span><span class="op" id="6838065">.</span><span class="ident" id="6838066">RemoteAddr</span><span class="op" id="6838076">(</span><span class="op" id="6838077">)</span><span class="op" id="6838078">,</span>&nbsp;<span class="ident" id="6838080">ta</span><span class="op" id="6838082">}</span><span class="op" id="6838083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838091">for</span>&nbsp;<span class="ident" id="6838095">_</span><span class="op" id="6838096">,</span>&nbsp;<span class="ident" id="6838098">ca</span>&nbsp;<span class="op" id="6838101">:=</span>&nbsp;<span class="keyword" id="6838104">range</span>&nbsp;<span class="ident" id="6838110">connAddrs</span>&nbsp;<span class="op" id="6838120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838125">if</span>&nbsp;<span class="op" id="6838128">!</span><span class="ident" id="6838129">reflect</span><span class="op" id="6838136">.</span><span class="ident" id="6838137">DeepEqual</span><span class="op" id="6838146">(</span><span class="ident" id="6838147">ca</span><span class="op" id="6838149">.</span><span class="ident" id="6838150">got</span><span class="op" id="6838153">,</span>&nbsp;<span class="ident" id="6838155">ca</span><span class="op" id="6838157">.</span><span class="ident" id="6838158">want</span><span class="op" id="6838162">)</span>&nbsp;<span class="op" id="6838164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6838170">t</span><span class="op" id="6838171">.</span><span class="ident" id="6838172">Fatalf</span><span class="op" id="6838178">(</span><span class="string" id="6838179">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6838202">,</span>&nbsp;<span class="ident" id="6838204">ca</span><span class="op" id="6838206">.</span><span class="ident" id="6838207">got</span><span class="op" id="6838210">,</span>&nbsp;<span class="ident" id="6838212">ca</span><span class="op" id="6838214">.</span><span class="ident" id="6838215">want</span><span class="op" id="6838219">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838231">}</span><br>
<span class="lineno"></span><span class="op" id="6838233">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
