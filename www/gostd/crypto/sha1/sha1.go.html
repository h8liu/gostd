<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4296294">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4296349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4296403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4296454">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="4296529">package</span>&nbsp;<span class="ident" id="4296537">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4296543">import</span>&nbsp;<span class="op" id="4296550">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4296553">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4296563">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4296570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4296573">func</span>&nbsp;<span class="ident" id="4296578">init</span><span class="op" id="4296582">(</span><span class="op" id="4296583">)</span>&nbsp;<span class="op" id="4296585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296588">crypto</span><span class="op" id="4296594">.</span><span class="ident" id="4296595">RegisterHash</span><span class="op" id="4296607">(</span><span class="ident" id="4296608">crypto</span><span class="op" id="4296614">.</span><span class="ident" id="4296615">SHA1</span><span class="op" id="4296619">,</span>&nbsp;<span class="ident" id="4296621">New</span><span class="op" id="4296624">)</span><br>
<span class="lineno">15</span><span class="op" id="4296626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296629">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4296670">const</span>&nbsp;<span class="ident" id="4296676">Size</span>&nbsp;<span class="op" id="4296681">=</span>&nbsp;<span class="num" id="4296683">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4296687">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4296722">const</span>&nbsp;<span class="ident" id="4296728">BlockSize</span>&nbsp;<span class="op" id="4296738">=</span>&nbsp;<span class="num" id="4296740">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4296744">const</span>&nbsp;<span class="op" id="4296750">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296753">chunk</span>&nbsp;<span class="op" id="4296759">=</span>&nbsp;<span class="num" id="4296761">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296765">init0</span>&nbsp;<span class="op" id="4296771">=</span>&nbsp;<span class="num" id="4296773">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296785">init1</span>&nbsp;<span class="op" id="4296791">=</span>&nbsp;<span class="num" id="4296793">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296805">init2</span>&nbsp;<span class="op" id="4296811">=</span>&nbsp;<span class="num" id="4296813">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296825">init3</span>&nbsp;<span class="op" id="4296831">=</span>&nbsp;<span class="num" id="4296833">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296845">init4</span>&nbsp;<span class="op" id="4296851">=</span>&nbsp;<span class="num" id="4296853">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="4296864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296867">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4296926">type</span>&nbsp;<span class="ident" id="4296931">digest</span>&nbsp;<span class="keyword" id="4296938">struct</span>&nbsp;<span class="op" id="4296945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296948">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4296952">[</span><span class="num" id="4296953">5</span><span class="op" id="4296954">]</span><span class="builtintype" id="4296955">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296963">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4296967">[</span><span class="ident" id="4296968">chunk</span><span class="op" id="4296973">]</span><span class="builtintype" id="4296974">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296980">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4296984">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4296989">len</span>&nbsp;<span class="ident" id="4296993">uint64</span><br>
<span class="lineno"></span><span class="op" id="4297000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4297003">func</span>&nbsp;<span class="op" id="4297008">(</span><span class="ident" id="4297009">d</span>&nbsp;<span class="op" id="4297011">*</span><span class="ident" id="4297012">digest</span><span class="op" id="4297018">)</span>&nbsp;<span class="ident" id="4297020">Reset</span><span class="op" id="4297025">(</span><span class="op" id="4297026">)</span>&nbsp;<span class="op" id="4297028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297031">d</span><span class="op" id="4297032">.</span><span class="ident" id="4297033">h</span><span class="op" id="4297034">[</span><span class="num" id="4297035">0</span><span class="op" id="4297036">]</span>&nbsp;<span class="op" id="4297038">=</span>&nbsp;<span class="ident" id="4297040">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297047">d</span><span class="op" id="4297048">.</span><span class="ident" id="4297049">h</span><span class="op" id="4297050">[</span><span class="num" id="4297051">1</span><span class="op" id="4297052">]</span>&nbsp;<span class="op" id="4297054">=</span>&nbsp;<span class="ident" id="4297056">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297063">d</span><span class="op" id="4297064">.</span><span class="ident" id="4297065">h</span><span class="op" id="4297066">[</span><span class="num" id="4297067">2</span><span class="op" id="4297068">]</span>&nbsp;<span class="op" id="4297070">=</span>&nbsp;<span class="ident" id="4297072">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297079">d</span><span class="op" id="4297080">.</span><span class="ident" id="4297081">h</span><span class="op" id="4297082">[</span><span class="num" id="4297083">3</span><span class="op" id="4297084">]</span>&nbsp;<span class="op" id="4297086">=</span>&nbsp;<span class="ident" id="4297088">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297095">d</span><span class="op" id="4297096">.</span><span class="ident" id="4297097">h</span><span class="op" id="4297098">[</span><span class="num" id="4297099">4</span><span class="op" id="4297100">]</span>&nbsp;<span class="op" id="4297102">=</span>&nbsp;<span class="ident" id="4297104">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297111">d</span><span class="op" id="4297112">.</span><span class="ident" id="4297113">nx</span>&nbsp;<span class="op" id="4297116">=</span>&nbsp;<span class="num" id="4297118">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297121">d</span><span class="op" id="4297122">.</span><span class="builtinfunc" id="4297123">len</span>&nbsp;<span class="op" id="4297127">=</span>&nbsp;<span class="num" id="4297129">0</span><br>
<span class="lineno"></span><span class="op" id="4297131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4297134">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4297194">func</span>&nbsp;<span class="ident" id="4297199">New</span><span class="op" id="4297202">(</span><span class="op" id="4297203">)</span>&nbsp;<span class="ident" id="4297205">hash</span><span class="op" id="4297209">.</span><span class="ident" id="4297210">Hash</span>&nbsp;<span class="op" id="4297215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297218">d</span>&nbsp;<span class="op" id="4297220">:=</span>&nbsp;<span class="builtinfunc" id="4297223">new</span><span class="op" id="4297226">(</span><span class="ident" id="4297227">digest</span><span class="op" id="4297233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297236">d</span><span class="op" id="4297237">.</span><span class="ident" id="4297238">Reset</span><span class="op" id="4297243">(</span><span class="op" id="4297244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297247">return</span>&nbsp;<span class="ident" id="4297254">d</span><br>
<span class="lineno">55</span><span class="op" id="4297256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4297259">func</span>&nbsp;<span class="op" id="4297264">(</span><span class="ident" id="4297265">d</span>&nbsp;<span class="op" id="4297267">*</span><span class="ident" id="4297268">digest</span><span class="op" id="4297274">)</span>&nbsp;<span class="ident" id="4297276">Size</span><span class="op" id="4297280">(</span><span class="op" id="4297281">)</span>&nbsp;<span class="builtintype" id="4297283">int</span>&nbsp;<span class="op" id="4297287">{</span>&nbsp;<span class="keyword" id="4297289">return</span>&nbsp;<span class="ident" id="4297296">Size</span>&nbsp;<span class="op" id="4297301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4297304">func</span>&nbsp;<span class="op" id="4297309">(</span><span class="ident" id="4297310">d</span>&nbsp;<span class="op" id="4297312">*</span><span class="ident" id="4297313">digest</span><span class="op" id="4297319">)</span>&nbsp;<span class="ident" id="4297321">BlockSize</span><span class="op" id="4297330">(</span><span class="op" id="4297331">)</span>&nbsp;<span class="builtintype" id="4297333">int</span>&nbsp;<span class="op" id="4297337">{</span>&nbsp;<span class="keyword" id="4297339">return</span>&nbsp;<span class="ident" id="4297346">BlockSize</span>&nbsp;<span class="op" id="4297356">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4297359">func</span>&nbsp;<span class="op" id="4297364">(</span><span class="ident" id="4297365">d</span>&nbsp;<span class="op" id="4297367">*</span><span class="ident" id="4297368">digest</span><span class="op" id="4297374">)</span>&nbsp;<span class="ident" id="4297376">Write</span><span class="op" id="4297381">(</span><span class="ident" id="4297382">p</span>&nbsp;<span class="op" id="4297384">[</span><span class="op" id="4297385">]</span><span class="builtintype" id="4297386">byte</span><span class="op" id="4297390">)</span>&nbsp;<span class="op" id="4297392">(</span><span class="ident" id="4297393">nn</span>&nbsp;<span class="builtintype" id="4297396">int</span><span class="op" id="4297399">,</span>&nbsp;<span class="ident" id="4297401">err</span>&nbsp;<span class="builtintype" id="4297405">error</span><span class="op" id="4297410">)</span>&nbsp;<span class="op" id="4297412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297415">nn</span>&nbsp;<span class="op" id="4297418">=</span>&nbsp;<span class="builtinfunc" id="4297420">len</span><span class="op" id="4297423">(</span><span class="ident" id="4297424">p</span><span class="op" id="4297425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297428">d</span><span class="op" id="4297429">.</span><span class="builtinfunc" id="4297430">len</span>&nbsp;<span class="op" id="4297434">+=</span>&nbsp;<span class="ident" id="4297437">uint64</span><span class="op" id="4297443">(</span><span class="ident" id="4297444">nn</span><span class="op" id="4297446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297449">if</span>&nbsp;<span class="ident" id="4297452">d</span><span class="op" id="4297453">.</span><span class="ident" id="4297454">nx</span>&nbsp;<span class="op" id="4297457">&gt;</span>&nbsp;<span class="num" id="4297459">0</span>&nbsp;<span class="op" id="4297461">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297465">n</span>&nbsp;<span class="op" id="4297467">:=</span>&nbsp;<span class="builtinfunc" id="4297470">copy</span><span class="op" id="4297474">(</span><span class="ident" id="4297475">d</span><span class="op" id="4297476">.</span><span class="ident" id="4297477">x</span><span class="op" id="4297478">[</span><span class="ident" id="4297479">d</span><span class="op" id="4297480">.</span><span class="ident" id="4297481">nx</span><span class="op" id="4297483">:</span><span class="op" id="4297484">]</span><span class="op" id="4297485">,</span>&nbsp;<span class="ident" id="4297487">p</span><span class="op" id="4297488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297492">d</span><span class="op" id="4297493">.</span><span class="ident" id="4297494">nx</span>&nbsp;<span class="op" id="4297497">+=</span>&nbsp;<span class="ident" id="4297500">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297504">if</span>&nbsp;<span class="ident" id="4297507">d</span><span class="op" id="4297508">.</span><span class="ident" id="4297509">nx</span>&nbsp;<span class="op" id="4297512">==</span>&nbsp;<span class="ident" id="4297515">chunk</span>&nbsp;<span class="op" id="4297521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297526">block</span><span class="op" id="4297531">(</span><span class="ident" id="4297532">d</span><span class="op" id="4297533">,</span>&nbsp;<span class="ident" id="4297535">d</span><span class="op" id="4297536">.</span><span class="ident" id="4297537">x</span><span class="op" id="4297538">[</span><span class="op" id="4297539">:</span><span class="op" id="4297540">]</span><span class="op" id="4297541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297546">d</span><span class="op" id="4297547">.</span><span class="ident" id="4297548">nx</span>&nbsp;<span class="op" id="4297551">=</span>&nbsp;<span class="num" id="4297553">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297561">p</span>&nbsp;<span class="op" id="4297563">=</span>&nbsp;<span class="ident" id="4297565">p</span><span class="op" id="4297566">[</span><span class="ident" id="4297567">n</span><span class="op" id="4297568">:</span><span class="op" id="4297569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297575">if</span>&nbsp;<span class="builtinfunc" id="4297578">len</span><span class="op" id="4297581">(</span><span class="ident" id="4297582">p</span><span class="op" id="4297583">)</span>&nbsp;<span class="op" id="4297585">&gt;=</span>&nbsp;<span class="ident" id="4297588">chunk</span>&nbsp;<span class="op" id="4297594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297598">n</span>&nbsp;<span class="op" id="4297600">:=</span>&nbsp;<span class="builtinfunc" id="4297603">len</span><span class="op" id="4297606">(</span><span class="ident" id="4297607">p</span><span class="op" id="4297608">)</span>&nbsp;<span class="op" id="4297610">&amp;^</span>&nbsp;<span class="op" id="4297613">(</span><span class="ident" id="4297614">chunk</span>&nbsp;<span class="op" id="4297620">-</span>&nbsp;<span class="num" id="4297622">1</span><span class="op" id="4297623">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297627">block</span><span class="op" id="4297632">(</span><span class="ident" id="4297633">d</span><span class="op" id="4297634">,</span>&nbsp;<span class="ident" id="4297636">p</span><span class="op" id="4297637">[</span><span class="op" id="4297638">:</span><span class="ident" id="4297639">n</span><span class="op" id="4297640">]</span><span class="op" id="4297641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297645">p</span>&nbsp;<span class="op" id="4297647">=</span>&nbsp;<span class="ident" id="4297649">p</span><span class="op" id="4297650">[</span><span class="ident" id="4297651">n</span><span class="op" id="4297652">:</span><span class="op" id="4297653">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297659">if</span>&nbsp;<span class="builtinfunc" id="4297662">len</span><span class="op" id="4297665">(</span><span class="ident" id="4297666">p</span><span class="op" id="4297667">)</span>&nbsp;<span class="op" id="4297669">&gt;</span>&nbsp;<span class="num" id="4297671">0</span>&nbsp;<span class="op" id="4297673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297677">d</span><span class="op" id="4297678">.</span><span class="ident" id="4297679">nx</span>&nbsp;<span class="op" id="4297682">=</span>&nbsp;<span class="builtinfunc" id="4297684">copy</span><span class="op" id="4297688">(</span><span class="ident" id="4297689">d</span><span class="op" id="4297690">.</span><span class="ident" id="4297691">x</span><span class="op" id="4297692">[</span><span class="op" id="4297693">:</span><span class="op" id="4297694">]</span><span class="op" id="4297695">,</span>&nbsp;<span class="ident" id="4297697">p</span><span class="op" id="4297698">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297704">return</span><br>
<span class="lineno"></span><span class="op" id="4297711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4297714">func</span>&nbsp;<span class="op" id="4297719">(</span><span class="ident" id="4297720">d0</span>&nbsp;<span class="op" id="4297723">*</span><span class="ident" id="4297724">digest</span><span class="op" id="4297730">)</span>&nbsp;<span class="ident" id="4297732">Sum</span><span class="op" id="4297735">(</span><span class="ident" id="4297736">in</span>&nbsp;<span class="op" id="4297739">[</span><span class="op" id="4297740">]</span><span class="builtintype" id="4297741">byte</span><span class="op" id="4297745">)</span>&nbsp;<span class="op" id="4297747">[</span><span class="op" id="4297748">]</span><span class="builtintype" id="4297749">byte</span>&nbsp;<span class="op" id="4297754">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4297757">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297824">d</span>&nbsp;<span class="op" id="4297826">:=</span>&nbsp;<span class="op" id="4297829">*</span><span class="ident" id="4297830">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297834">hash</span>&nbsp;<span class="op" id="4297839">:=</span>&nbsp;<span class="ident" id="4297842">d</span><span class="op" id="4297843">.</span><span class="ident" id="4297844">checkSum</span><span class="op" id="4297852">(</span><span class="op" id="4297853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297856">return</span>&nbsp;<span class="builtinfunc" id="4297863">append</span><span class="op" id="4297869">(</span><span class="ident" id="4297870">in</span><span class="op" id="4297872">,</span>&nbsp;<span class="ident" id="4297874">hash</span><span class="op" id="4297878">[</span><span class="op" id="4297879">:</span><span class="op" id="4297880">]</span><span class="op" id="4297881">...</span><span class="op" id="4297884">)</span><br>
<span class="lineno"></span><span class="op" id="4297886">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4297889">func</span>&nbsp;<span class="op" id="4297894">(</span><span class="ident" id="4297895">d</span>&nbsp;<span class="op" id="4297897">*</span><span class="ident" id="4297898">digest</span><span class="op" id="4297904">)</span>&nbsp;<span class="ident" id="4297906">checkSum</span><span class="op" id="4297914">(</span><span class="op" id="4297915">)</span>&nbsp;<span class="op" id="4297917">[</span><span class="ident" id="4297918">Size</span><span class="op" id="4297922">]</span><span class="builtintype" id="4297923">byte</span>&nbsp;<span class="op" id="4297928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4297931">len</span>&nbsp;<span class="op" id="4297935">:=</span>&nbsp;<span class="ident" id="4297938">d</span><span class="op" id="4297939">.</span><span class="builtinfunc" id="4297940">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4297945">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298005">var</span>&nbsp;<span class="ident" id="4298009">tmp</span>&nbsp;<span class="op" id="4298013">[</span><span class="num" id="4298014">64</span><span class="op" id="4298016">]</span><span class="builtintype" id="4298017">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298023">tmp</span><span class="op" id="4298026">[</span><span class="num" id="4298027">0</span><span class="op" id="4298028">]</span>&nbsp;<span class="op" id="4298030">=</span>&nbsp;<span class="num" id="4298032">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298038">if</span>&nbsp;<span class="builtinfunc" id="4298041">len</span><span class="op" id="4298044">%</span><span class="num" id="4298045">64</span>&nbsp;<span class="op" id="4298048">&lt;</span>&nbsp;<span class="num" id="4298050">56</span>&nbsp;<span class="op" id="4298053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298057">d</span><span class="op" id="4298058">.</span><span class="ident" id="4298059">Write</span><span class="op" id="4298064">(</span><span class="ident" id="4298065">tmp</span><span class="op" id="4298068">[</span><span class="num" id="4298069">0</span>&nbsp;<span class="op" id="4298071">:</span>&nbsp;<span class="num" id="4298073">56</span><span class="op" id="4298075">-</span><span class="builtinfunc" id="4298076">len</span><span class="op" id="4298079">%</span><span class="num" id="4298080">64</span><span class="op" id="4298082">]</span><span class="op" id="4298083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298086">}</span>&nbsp;<span class="keyword" id="4298088">else</span>&nbsp;<span class="op" id="4298093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298097">d</span><span class="op" id="4298098">.</span><span class="ident" id="4298099">Write</span><span class="op" id="4298104">(</span><span class="ident" id="4298105">tmp</span><span class="op" id="4298108">[</span><span class="num" id="4298109">0</span>&nbsp;<span class="op" id="4298111">:</span>&nbsp;<span class="num" id="4298113">64</span><span class="op" id="4298115">+</span><span class="num" id="4298116">56</span><span class="op" id="4298118">-</span><span class="builtinfunc" id="4298119">len</span><span class="op" id="4298122">%</span><span class="num" id="4298123">64</span><span class="op" id="4298125">]</span><span class="op" id="4298126">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298133">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4298153">len</span>&nbsp;<span class="op" id="4298157">&lt;&lt;=</span>&nbsp;<span class="num" id="4298161">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298164">for</span>&nbsp;<span class="ident" id="4298168">i</span>&nbsp;<span class="op" id="4298170">:=</span>&nbsp;<span class="builtintype" id="4298173">uint</span><span class="op" id="4298177">(</span><span class="num" id="4298178">0</span><span class="op" id="4298179">)</span><span class="op" id="4298180">;</span>&nbsp;<span class="ident" id="4298182">i</span>&nbsp;<span class="op" id="4298184">&lt;</span>&nbsp;<span class="num" id="4298186">8</span><span class="op" id="4298187">;</span>&nbsp;<span class="ident" id="4298189">i</span><span class="op" id="4298190">++</span>&nbsp;<span class="op" id="4298193">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298197">tmp</span><span class="op" id="4298200">[</span><span class="ident" id="4298201">i</span><span class="op" id="4298202">]</span>&nbsp;<span class="op" id="4298204">=</span>&nbsp;<span class="builtintype" id="4298206">byte</span><span class="op" id="4298210">(</span><span class="builtinfunc" id="4298211">len</span>&nbsp;<span class="op" id="4298215">&gt;&gt;</span>&nbsp;<span class="op" id="4298218">(</span><span class="num" id="4298219">56</span>&nbsp;<span class="op" id="4298222">-</span>&nbsp;<span class="num" id="4298224">8</span><span class="op" id="4298225">*</span><span class="ident" id="4298226">i</span><span class="op" id="4298227">)</span><span class="op" id="4298228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298234">d</span><span class="op" id="4298235">.</span><span class="ident" id="4298236">Write</span><span class="op" id="4298241">(</span><span class="ident" id="4298242">tmp</span><span class="op" id="4298245">[</span><span class="num" id="4298246">0</span><span class="op" id="4298247">:</span><span class="num" id="4298248">8</span><span class="op" id="4298249">]</span><span class="op" id="4298250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298254">if</span>&nbsp;<span class="ident" id="4298257">d</span><span class="op" id="4298258">.</span><span class="ident" id="4298259">nx</span>&nbsp;<span class="op" id="4298262">!=</span>&nbsp;<span class="num" id="4298265">0</span>&nbsp;<span class="op" id="4298267">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4298271">panic</span><span class="op" id="4298276">(</span><span class="string" id="4298277">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4298288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298295">var</span>&nbsp;<span class="ident" id="4298299">digest</span>&nbsp;<span class="op" id="4298306">[</span><span class="ident" id="4298307">Size</span><span class="op" id="4298311">]</span><span class="builtintype" id="4298312">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298318">for</span>&nbsp;<span class="ident" id="4298322">i</span><span class="op" id="4298323">,</span>&nbsp;<span class="ident" id="4298325">s</span>&nbsp;<span class="op" id="4298327">:=</span>&nbsp;<span class="keyword" id="4298330">range</span>&nbsp;<span class="ident" id="4298336">d</span><span class="op" id="4298337">.</span><span class="ident" id="4298338">h</span>&nbsp;<span class="op" id="4298340">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298344">digest</span><span class="op" id="4298350">[</span><span class="ident" id="4298351">i</span><span class="op" id="4298352">*</span><span class="num" id="4298353">4</span><span class="op" id="4298354">]</span>&nbsp;<span class="op" id="4298356">=</span>&nbsp;<span class="builtintype" id="4298358">byte</span><span class="op" id="4298362">(</span><span class="ident" id="4298363">s</span>&nbsp;<span class="op" id="4298365">&gt;&gt;</span>&nbsp;<span class="num" id="4298368">24</span><span class="op" id="4298370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298374">digest</span><span class="op" id="4298380">[</span><span class="ident" id="4298381">i</span><span class="op" id="4298382">*</span><span class="num" id="4298383">4</span><span class="op" id="4298384">+</span><span class="num" id="4298385">1</span><span class="op" id="4298386">]</span>&nbsp;<span class="op" id="4298388">=</span>&nbsp;<span class="builtintype" id="4298390">byte</span><span class="op" id="4298394">(</span><span class="ident" id="4298395">s</span>&nbsp;<span class="op" id="4298397">&gt;&gt;</span>&nbsp;<span class="num" id="4298400">16</span><span class="op" id="4298402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298406">digest</span><span class="op" id="4298412">[</span><span class="ident" id="4298413">i</span><span class="op" id="4298414">*</span><span class="num" id="4298415">4</span><span class="op" id="4298416">+</span><span class="num" id="4298417">2</span><span class="op" id="4298418">]</span>&nbsp;<span class="op" id="4298420">=</span>&nbsp;<span class="builtintype" id="4298422">byte</span><span class="op" id="4298426">(</span><span class="ident" id="4298427">s</span>&nbsp;<span class="op" id="4298429">&gt;&gt;</span>&nbsp;<span class="num" id="4298432">8</span><span class="op" id="4298433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298437">digest</span><span class="op" id="4298443">[</span><span class="ident" id="4298444">i</span><span class="op" id="4298445">*</span><span class="num" id="4298446">4</span><span class="op" id="4298447">+</span><span class="num" id="4298448">3</span><span class="op" id="4298449">]</span>&nbsp;<span class="op" id="4298451">=</span>&nbsp;<span class="builtintype" id="4298453">byte</span><span class="op" id="4298457">(</span><span class="ident" id="4298458">s</span><span class="op" id="4298459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298462">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298466">return</span>&nbsp;<span class="ident" id="4298473">digest</span><br>
<span class="lineno"></span><span class="op" id="4298480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4298483">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="4298529">func</span>&nbsp;<span class="ident" id="4298534">Sum</span><span class="op" id="4298537">(</span><span class="ident" id="4298538">data</span>&nbsp;<span class="op" id="4298543">[</span><span class="op" id="4298544">]</span><span class="builtintype" id="4298545">byte</span><span class="op" id="4298549">)</span>&nbsp;<span class="op" id="4298551">[</span><span class="ident" id="4298552">Size</span><span class="op" id="4298556">]</span><span class="builtintype" id="4298557">byte</span>&nbsp;<span class="op" id="4298562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298565">var</span>&nbsp;<span class="ident" id="4298569">d</span>&nbsp;<span class="ident" id="4298571">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298579">d</span><span class="op" id="4298580">.</span><span class="ident" id="4298581">Reset</span><span class="op" id="4298586">(</span><span class="op" id="4298587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298590">d</span><span class="op" id="4298591">.</span><span class="ident" id="4298592">Write</span><span class="op" id="4298597">(</span><span class="ident" id="4298598">data</span><span class="op" id="4298602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298605">return</span>&nbsp;<span class="ident" id="4298612">d</span><span class="op" id="4298613">.</span><span class="ident" id="4298614">checkSum</span><span class="op" id="4298622">(</span><span class="op" id="4298623">)</span><br>
<span class="lineno">130</span><span class="op" id="4298625">}</span>
</div>
</body>
</html>
