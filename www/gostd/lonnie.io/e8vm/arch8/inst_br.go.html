<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3569189">package</span>&nbsp;<span class="ident" id="3569197">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3569204">//&nbsp;InstBr&nbsp;exectues&nbsp;branch&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="3569242">type</span>&nbsp;<span class="ident" id="3569247">instBr</span>&nbsp;<span class="keyword" id="3569254">struct</span><span class="op" id="3569260">{</span><span class="op" id="3569261">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="3569264">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3569295">//&nbsp;Might&nbsp;return&nbsp;invalid&nbsp;instruction&nbsp;exception.</span><br>
<span class="lineno"></span><span class="keyword" id="3569342">func</span>&nbsp;<span class="op" id="3569347">(</span><span class="ident" id="3569348">i</span>&nbsp;<span class="op" id="3569350">*</span><span class="ident" id="3569351">instBr</span><span class="op" id="3569357">)</span>&nbsp;<span class="ident" id="3569359">I</span><span class="op" id="3569360">(</span><span class="ident" id="3569361">cpu</span>&nbsp;<span class="op" id="3569365">*</span><span class="ident" id="3569366">cpu</span><span class="op" id="3569369">,</span>&nbsp;<span class="ident" id="3569371">in</span>&nbsp;<span class="builtintype" id="3569374">uint32</span><span class="op" id="3569380">)</span>&nbsp;<span class="op" id="3569382">*</span><span class="ident" id="3569383">Excep</span>&nbsp;<span class="op" id="3569389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569392">op</span>&nbsp;<span class="op" id="3569395">:=</span>&nbsp;<span class="op" id="3569398">(</span><span class="ident" id="3569399">in</span>&nbsp;<span class="op" id="3569402">&gt;&gt;</span>&nbsp;<span class="num" id="3569405">24</span><span class="op" id="3569407">)</span>&nbsp;<span class="op" id="3569409">&amp;</span>&nbsp;<span class="num" id="3569411">0xff</span>&nbsp;&nbsp;<span class="comment" id="3569417">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569429">src1</span>&nbsp;<span class="op" id="3569434">:=</span>&nbsp;<span class="op" id="3569437">(</span><span class="ident" id="3569438">in</span>&nbsp;<span class="op" id="3569441">&gt;&gt;</span>&nbsp;<span class="num" id="3569444">21</span><span class="op" id="3569446">)</span>&nbsp;<span class="op" id="3569448">&amp;</span>&nbsp;<span class="num" id="3569450">0x7</span>&nbsp;<span class="comment" id="3569454">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569466">src2</span>&nbsp;<span class="op" id="3569471">:=</span>&nbsp;<span class="op" id="3569474">(</span><span class="ident" id="3569475">in</span>&nbsp;<span class="op" id="3569478">&gt;&gt;</span>&nbsp;<span class="num" id="3569481">18</span><span class="op" id="3569483">)</span>&nbsp;<span class="op" id="3569485">&amp;</span>&nbsp;<span class="num" id="3569487">0x7</span>&nbsp;<span class="comment" id="3569491">//&nbsp;(21:18]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569503">im</span>&nbsp;<span class="op" id="3569506">:=</span>&nbsp;<span class="ident" id="3569509">in</span>&nbsp;<span class="op" id="3569512">&amp;</span>&nbsp;<span class="num" id="3569514">0x3ffff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3569528">//&nbsp;(18:0]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569540">s1</span>&nbsp;<span class="op" id="3569543">:=</span>&nbsp;<span class="ident" id="3569546">cpu</span><span class="op" id="3569549">.</span><span class="ident" id="3569550">regs</span><span class="op" id="3569554">[</span><span class="ident" id="3569555">src1</span><span class="op" id="3569559">]</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569562">s2</span>&nbsp;<span class="op" id="3569565">:=</span>&nbsp;<span class="ident" id="3569568">cpu</span><span class="op" id="3569571">.</span><span class="ident" id="3569572">regs</span><span class="op" id="3569576">[</span><span class="ident" id="3569577">src2</span><span class="op" id="3569581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569584">pc</span>&nbsp;<span class="op" id="3569587">:=</span>&nbsp;<span class="ident" id="3569590">cpu</span><span class="op" id="3569593">.</span><span class="ident" id="3569594">regs</span><span class="op" id="3569598">[</span><span class="ident" id="3569599">PC</span><span class="op" id="3569601">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569604">br</span>&nbsp;<span class="op" id="3569607">:=</span>&nbsp;<span class="ident" id="3569610">pc</span>&nbsp;<span class="op" id="3569613">+</span>&nbsp;<span class="builtintype" id="3569615">uint32</span><span class="op" id="3569621">(</span><span class="builtintype" id="3569622">int32</span><span class="op" id="3569627">(</span><span class="ident" id="3569628">im</span><span class="op" id="3569630">&lt;&lt;</span><span class="num" id="3569632">14</span><span class="op" id="3569634">)</span><span class="op" id="3569635">&gt;&gt;</span><span class="num" id="3569637">12</span><span class="op" id="3569639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569643">switch</span>&nbsp;<span class="ident" id="3569650">op</span>&nbsp;<span class="op" id="3569653">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569656">case</span>&nbsp;<span class="num" id="3569661">32</span><span class="op" id="3569663">:</span>&nbsp;<span class="comment" id="3569665">//&nbsp;bne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569674">if</span>&nbsp;<span class="ident" id="3569677">s1</span>&nbsp;<span class="op" id="3569680">!=</span>&nbsp;<span class="ident" id="3569683">s2</span>&nbsp;<span class="op" id="3569686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569691">pc</span>&nbsp;<span class="op" id="3569694">=</span>&nbsp;<span class="ident" id="3569696">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569704">case</span>&nbsp;<span class="num" id="3569709">33</span><span class="op" id="3569711">:</span>&nbsp;<span class="comment" id="3569713">//&nbsp;beq</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569722">if</span>&nbsp;<span class="ident" id="3569725">s1</span>&nbsp;<span class="op" id="3569728">==</span>&nbsp;<span class="ident" id="3569731">s2</span>&nbsp;<span class="op" id="3569734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569739">pc</span>&nbsp;<span class="op" id="3569742">=</span>&nbsp;<span class="ident" id="3569744">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569752">default</span><span class="op" id="3569759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569763">return</span>&nbsp;<span class="ident" id="3569770">errInvalidInst</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569790">cpu</span><span class="op" id="3569793">.</span><span class="ident" id="3569794">regs</span><span class="op" id="3569798">[</span><span class="ident" id="3569799">PC</span><span class="op" id="3569801">]</span>&nbsp;<span class="op" id="3569803">=</span>&nbsp;<span class="ident" id="3569805">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569809">return</span>&nbsp;<span class="ident" id="3569816">nil</span><br>
<span class="lineno"></span><span class="op" id="3569820">}</span>
</div>
</body>
</html>
