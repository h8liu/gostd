<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3853630">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3853685">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3853739">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3853790">package</span>&nbsp;<span class="ident" id="3853798">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3853806">import</span>&nbsp;<span class="string" id="3853813">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3853819">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3853897">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3853929">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3854001">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3854056">type</span>&nbsp;<span class="ident" id="3854061">StreamReader</span>&nbsp;<span class="keyword" id="3854074">struct</span>&nbsp;<span class="op" id="3854081">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854084">S</span>&nbsp;<span class="ident" id="3854086">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854094">R</span>&nbsp;<span class="ident" id="3854096">io</span><span class="op" id="3854098">.</span><span class="ident" id="3854099">Reader</span><br>
<span class="lineno"></span><span class="op" id="3854106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3854109">func</span>&nbsp;<span class="op" id="3854114">(</span><span class="ident" id="3854115">r</span>&nbsp;<span class="ident" id="3854117">StreamReader</span><span class="op" id="3854129">)</span>&nbsp;<span class="ident" id="3854131">Read</span><span class="op" id="3854135">(</span><span class="ident" id="3854136">dst</span>&nbsp;<span class="op" id="3854140">[</span><span class="op" id="3854141">]</span><span class="builtintype" id="3854142">byte</span><span class="op" id="3854146">)</span>&nbsp;<span class="op" id="3854148">(</span><span class="ident" id="3854149">n</span>&nbsp;<span class="builtintype" id="3854151">int</span><span class="op" id="3854154">,</span>&nbsp;<span class="ident" id="3854156">err</span>&nbsp;<span class="builtintype" id="3854160">error</span><span class="op" id="3854165">)</span>&nbsp;<span class="op" id="3854167">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854170">n</span><span class="op" id="3854171">,</span>&nbsp;<span class="ident" id="3854173">err</span>&nbsp;<span class="op" id="3854177">=</span>&nbsp;<span class="ident" id="3854179">r</span><span class="op" id="3854180">.</span><span class="ident" id="3854181">R</span><span class="op" id="3854182">.</span><span class="ident" id="3854183">Read</span><span class="op" id="3854187">(</span><span class="ident" id="3854188">dst</span><span class="op" id="3854191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854194">r</span><span class="op" id="3854195">.</span><span class="ident" id="3854196">S</span><span class="op" id="3854197">.</span><span class="ident" id="3854198">XORKeyStream</span><span class="op" id="3854210">(</span><span class="ident" id="3854211">dst</span><span class="op" id="3854214">[</span><span class="op" id="3854215">:</span><span class="ident" id="3854216">n</span><span class="op" id="3854217">]</span><span class="op" id="3854218">,</span>&nbsp;<span class="ident" id="3854220">dst</span><span class="op" id="3854223">[</span><span class="op" id="3854224">:</span><span class="ident" id="3854225">n</span><span class="op" id="3854226">]</span><span class="op" id="3854227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854230">return</span><br>
<span class="lineno"></span><span class="op" id="3854237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3854240">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3854312">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3854385">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3854462">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3854527">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3854564">type</span>&nbsp;<span class="ident" id="3854569">StreamWriter</span>&nbsp;<span class="keyword" id="3854582">struct</span>&nbsp;<span class="op" id="3854589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854592">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3854596">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854604">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3854608">io</span><span class="op" id="3854610">.</span><span class="ident" id="3854611">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854619">Err</span>&nbsp;<span class="builtintype" id="3854623">error</span>&nbsp;<span class="comment" id="3854629">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3854639">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3854642">func</span>&nbsp;<span class="op" id="3854647">(</span><span class="ident" id="3854648">w</span>&nbsp;<span class="ident" id="3854650">StreamWriter</span><span class="op" id="3854662">)</span>&nbsp;<span class="ident" id="3854664">Write</span><span class="op" id="3854669">(</span><span class="ident" id="3854670">src</span>&nbsp;<span class="op" id="3854674">[</span><span class="op" id="3854675">]</span><span class="builtintype" id="3854676">byte</span><span class="op" id="3854680">)</span>&nbsp;<span class="op" id="3854682">(</span><span class="ident" id="3854683">n</span>&nbsp;<span class="builtintype" id="3854685">int</span><span class="op" id="3854688">,</span>&nbsp;<span class="ident" id="3854690">err</span>&nbsp;<span class="builtintype" id="3854694">error</span><span class="op" id="3854699">)</span>&nbsp;<span class="op" id="3854701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854704">c</span>&nbsp;<span class="op" id="3854706">:=</span>&nbsp;<span class="builtinfunc" id="3854709">make</span><span class="op" id="3854713">(</span><span class="op" id="3854714">[</span><span class="op" id="3854715">]</span><span class="builtintype" id="3854716">byte</span><span class="op" id="3854720">,</span>&nbsp;<span class="builtinfunc" id="3854722">len</span><span class="op" id="3854725">(</span><span class="ident" id="3854726">src</span><span class="op" id="3854729">)</span><span class="op" id="3854730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854733">w</span><span class="op" id="3854734">.</span><span class="ident" id="3854735">S</span><span class="op" id="3854736">.</span><span class="ident" id="3854737">XORKeyStream</span><span class="op" id="3854749">(</span><span class="ident" id="3854750">c</span><span class="op" id="3854751">,</span>&nbsp;<span class="ident" id="3854753">src</span><span class="op" id="3854756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854759">n</span><span class="op" id="3854760">,</span>&nbsp;<span class="ident" id="3854762">err</span>&nbsp;<span class="op" id="3854766">=</span>&nbsp;<span class="ident" id="3854768">w</span><span class="op" id="3854769">.</span><span class="ident" id="3854770">W</span><span class="op" id="3854771">.</span><span class="ident" id="3854772">Write</span><span class="op" id="3854777">(</span><span class="ident" id="3854778">c</span><span class="op" id="3854779">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854782">if</span>&nbsp;<span class="ident" id="3854785">n</span>&nbsp;<span class="op" id="3854787">!=</span>&nbsp;<span class="builtinfunc" id="3854790">len</span><span class="op" id="3854793">(</span><span class="ident" id="3854794">src</span><span class="op" id="3854797">)</span>&nbsp;<span class="op" id="3854799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854803">if</span>&nbsp;<span class="ident" id="3854806">err</span>&nbsp;<span class="op" id="3854810">==</span>&nbsp;<span class="ident" id="3854813">nil</span>&nbsp;<span class="op" id="3854817">{</span>&nbsp;<span class="comment" id="3854819">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854845">err</span>&nbsp;<span class="op" id="3854849">=</span>&nbsp;<span class="ident" id="3854851">io</span><span class="op" id="3854853">.</span><span class="ident" id="3854854">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854873">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854876">return</span><br>
<span class="lineno"></span><span class="op" id="3854883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3854886">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3854974">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3855025">func</span>&nbsp;<span class="op" id="3855030">(</span><span class="ident" id="3855031">w</span>&nbsp;<span class="ident" id="3855033">StreamWriter</span><span class="op" id="3855045">)</span>&nbsp;<span class="ident" id="3855047">Close</span><span class="op" id="3855052">(</span><span class="op" id="3855053">)</span>&nbsp;<span class="builtintype" id="3855055">error</span>&nbsp;<span class="op" id="3855061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855064">if</span>&nbsp;<span class="ident" id="3855067">c</span><span class="op" id="3855068">,</span>&nbsp;<span class="ident" id="3855070">ok</span>&nbsp;<span class="op" id="3855073">:=</span>&nbsp;<span class="ident" id="3855076">w</span><span class="op" id="3855077">.</span><span class="ident" id="3855078">W</span><span class="op" id="3855079">.</span><span class="op" id="3855080">(</span><span class="ident" id="3855081">io</span><span class="op" id="3855083">.</span><span class="ident" id="3855084">Closer</span><span class="op" id="3855090">)</span><span class="op" id="3855091">;</span>&nbsp;<span class="ident" id="3855093">ok</span>&nbsp;<span class="op" id="3855096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855100">return</span>&nbsp;<span class="ident" id="3855107">c</span><span class="op" id="3855108">.</span><span class="ident" id="3855109">Close</span><span class="op" id="3855114">(</span><span class="op" id="3855115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855121">return</span>&nbsp;<span class="ident" id="3855128">nil</span><br>
<span class="lineno">55</span><span class="op" id="3855132">}</span>
</div>
</body>
</html>
