<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3823832">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3823888">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3823942">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3823993">package</span>&nbsp;<span class="ident" id="3824001">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3824009">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3824071">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3824091">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3824165">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3824193">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3824268">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3824306">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3824375">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3824448">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3824523">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3824575">//</span><br>
<span class="lineno"></span><span class="comment" id="3824578">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3824594">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3824663">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3824742">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3824821">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3824897">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3824976">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3825054">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3825135">import</span>&nbsp;<span class="op" id="3825142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3825145">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3825155">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3825160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3825163">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3825237">const</span>&nbsp;<span class="op" id="3825243">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825246">MaxVarintLen16</span>&nbsp;<span class="op" id="3825261">=</span>&nbsp;<span class="num" id="3825263">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825266">MaxVarintLen32</span>&nbsp;<span class="op" id="3825281">=</span>&nbsp;<span class="num" id="3825283">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825286">MaxVarintLen64</span>&nbsp;<span class="op" id="3825301">=</span>&nbsp;<span class="num" id="3825303">10</span><br>
<span class="lineno"></span><span class="op" id="3825306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3825309">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3825390">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3825444">func</span>&nbsp;<span class="ident" id="3825449">PutUvarint</span><span class="op" id="3825459">(</span><span class="ident" id="3825460">buf</span>&nbsp;<span class="op" id="3825464">[</span><span class="op" id="3825465">]</span><span class="builtintype" id="3825466">byte</span><span class="op" id="3825470">,</span>&nbsp;<span class="ident" id="3825472">x</span>&nbsp;<span class="ident" id="3825474">uint64</span><span class="op" id="3825480">)</span>&nbsp;<span class="builtintype" id="3825482">int</span>&nbsp;<span class="op" id="3825486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825489">i</span>&nbsp;<span class="op" id="3825491">:=</span>&nbsp;<span class="num" id="3825494">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825497">for</span>&nbsp;<span class="ident" id="3825501">x</span>&nbsp;<span class="op" id="3825503">&gt;=</span>&nbsp;<span class="num" id="3825506">0x80</span>&nbsp;<span class="op" id="3825511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825515">buf</span><span class="op" id="3825518">[</span><span class="ident" id="3825519">i</span><span class="op" id="3825520">]</span>&nbsp;<span class="op" id="3825522">=</span>&nbsp;<span class="builtintype" id="3825524">byte</span><span class="op" id="3825528">(</span><span class="ident" id="3825529">x</span><span class="op" id="3825530">)</span>&nbsp;<span class="op" id="3825532">|</span>&nbsp;<span class="num" id="3825534">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825541">x</span>&nbsp;<span class="op" id="3825543">&gt;&gt;=</span>&nbsp;<span class="num" id="3825547">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825551">i</span><span class="op" id="3825552">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825559">buf</span><span class="op" id="3825562">[</span><span class="ident" id="3825563">i</span><span class="op" id="3825564">]</span>&nbsp;<span class="op" id="3825566">=</span>&nbsp;<span class="builtintype" id="3825568">byte</span><span class="op" id="3825572">(</span><span class="ident" id="3825573">x</span><span class="op" id="3825574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825577">return</span>&nbsp;<span class="ident" id="3825584">i</span>&nbsp;<span class="op" id="3825586">+</span>&nbsp;<span class="num" id="3825588">1</span><br>
<span class="lineno">50</span><span class="op" id="3825590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3825593">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3825661">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3825729">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3825775">//</span><br>
<span class="lineno"></span><span class="comment" id="3825778">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3825803">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3825851">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3825902">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3825905">func</span>&nbsp;<span class="ident" id="3825910">Uvarint</span><span class="op" id="3825917">(</span><span class="ident" id="3825918">buf</span>&nbsp;<span class="op" id="3825922">[</span><span class="op" id="3825923">]</span><span class="builtintype" id="3825924">byte</span><span class="op" id="3825928">)</span>&nbsp;<span class="op" id="3825930">(</span><span class="ident" id="3825931">uint64</span><span class="op" id="3825937">,</span>&nbsp;<span class="builtintype" id="3825939">int</span><span class="op" id="3825942">)</span>&nbsp;<span class="op" id="3825944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825947">var</span>&nbsp;<span class="ident" id="3825951">x</span>&nbsp;<span class="ident" id="3825953">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825961">var</span>&nbsp;<span class="ident" id="3825965">s</span>&nbsp;<span class="builtintype" id="3825967">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825973">for</span>&nbsp;<span class="ident" id="3825977">i</span><span class="op" id="3825978">,</span>&nbsp;<span class="ident" id="3825980">b</span>&nbsp;<span class="op" id="3825982">:=</span>&nbsp;<span class="keyword" id="3825985">range</span>&nbsp;<span class="ident" id="3825991">buf</span>&nbsp;<span class="op" id="3825995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825999">if</span>&nbsp;<span class="ident" id="3826002">b</span>&nbsp;<span class="op" id="3826004">&lt;</span>&nbsp;<span class="num" id="3826006">0x80</span>&nbsp;<span class="op" id="3826011">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826016">if</span>&nbsp;<span class="ident" id="3826019">i</span>&nbsp;<span class="op" id="3826021">&gt;</span>&nbsp;<span class="num" id="3826023">9</span>&nbsp;<span class="op" id="3826025">||</span>&nbsp;<span class="ident" id="3826028">i</span>&nbsp;<span class="op" id="3826030">==</span>&nbsp;<span class="num" id="3826033">9</span>&nbsp;<span class="op" id="3826035">&amp;&amp;</span>&nbsp;<span class="ident" id="3826038">b</span>&nbsp;<span class="op" id="3826040">&gt;</span>&nbsp;<span class="num" id="3826042">1</span>&nbsp;<span class="op" id="3826044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826050">return</span>&nbsp;<span class="num" id="3826057">0</span><span class="op" id="3826058">,</span>&nbsp;<span class="op" id="3826060">-</span><span class="op" id="3826061">(</span><span class="ident" id="3826062">i</span>&nbsp;<span class="op" id="3826064">+</span>&nbsp;<span class="num" id="3826066">1</span><span class="op" id="3826067">)</span>&nbsp;<span class="comment" id="3826069">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826089">return</span>&nbsp;<span class="ident" id="3826096">x</span>&nbsp;<span class="op" id="3826098">|</span>&nbsp;<span class="ident" id="3826100">uint64</span><span class="op" id="3826106">(</span><span class="ident" id="3826107">b</span><span class="op" id="3826108">)</span><span class="op" id="3826109">&lt;&lt;</span><span class="ident" id="3826111">s</span><span class="op" id="3826112">,</span>&nbsp;<span class="ident" id="3826114">i</span>&nbsp;<span class="op" id="3826116">+</span>&nbsp;<span class="num" id="3826118">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826122">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826126">x</span>&nbsp;<span class="op" id="3826128">|=</span>&nbsp;<span class="ident" id="3826131">uint64</span><span class="op" id="3826137">(</span><span class="ident" id="3826138">b</span><span class="op" id="3826139">&amp;</span><span class="num" id="3826140">0x7f</span><span class="op" id="3826144">)</span>&nbsp;<span class="op" id="3826146">&lt;&lt;</span>&nbsp;<span class="ident" id="3826149">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826153">s</span>&nbsp;<span class="op" id="3826155">+=</span>&nbsp;<span class="num" id="3826158">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826164">return</span>&nbsp;<span class="num" id="3826171">0</span><span class="op" id="3826172">,</span>&nbsp;<span class="num" id="3826174">0</span><br>
<span class="lineno"></span><span class="op" id="3826176">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3826179">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3826259">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3826312">func</span>&nbsp;<span class="ident" id="3826317">PutVarint</span><span class="op" id="3826326">(</span><span class="ident" id="3826327">buf</span>&nbsp;<span class="op" id="3826331">[</span><span class="op" id="3826332">]</span><span class="builtintype" id="3826333">byte</span><span class="op" id="3826337">,</span>&nbsp;<span class="ident" id="3826339">x</span>&nbsp;<span class="ident" id="3826341">int64</span><span class="op" id="3826346">)</span>&nbsp;<span class="builtintype" id="3826348">int</span>&nbsp;<span class="op" id="3826352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826355">ux</span>&nbsp;<span class="op" id="3826358">:=</span>&nbsp;<span class="ident" id="3826361">uint64</span><span class="op" id="3826367">(</span><span class="ident" id="3826368">x</span><span class="op" id="3826369">)</span>&nbsp;<span class="op" id="3826371">&lt;&lt;</span>&nbsp;<span class="num" id="3826374">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826377">if</span>&nbsp;<span class="ident" id="3826380">x</span>&nbsp;<span class="op" id="3826382">&lt;</span>&nbsp;<span class="num" id="3826384">0</span>&nbsp;<span class="op" id="3826386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826390">ux</span>&nbsp;<span class="op" id="3826393">=</span>&nbsp;<span class="op" id="3826395">^</span><span class="ident" id="3826396">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826403">return</span>&nbsp;<span class="ident" id="3826410">PutUvarint</span><span class="op" id="3826420">(</span><span class="ident" id="3826421">buf</span><span class="op" id="3826424">,</span>&nbsp;<span class="ident" id="3826426">ux</span><span class="op" id="3826428">)</span><br>
<span class="lineno"></span><span class="op" id="3826430">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3826433">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3826500">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3826568">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3826633">//</span><br>
<span class="lineno">90</span><span class="comment" id="3826636">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3826661">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3826709">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3826760">//</span><br>
<span class="lineno"></span><span class="keyword" id="3826763">func</span>&nbsp;<span class="ident" id="3826768">Varint</span><span class="op" id="3826774">(</span><span class="ident" id="3826775">buf</span>&nbsp;<span class="op" id="3826779">[</span><span class="op" id="3826780">]</span><span class="builtintype" id="3826781">byte</span><span class="op" id="3826785">)</span>&nbsp;<span class="op" id="3826787">(</span><span class="ident" id="3826788">int64</span><span class="op" id="3826793">,</span>&nbsp;<span class="builtintype" id="3826795">int</span><span class="op" id="3826798">)</span>&nbsp;<span class="op" id="3826800">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826803">ux</span><span class="op" id="3826805">,</span>&nbsp;<span class="ident" id="3826807">n</span>&nbsp;<span class="op" id="3826809">:=</span>&nbsp;<span class="ident" id="3826812">Uvarint</span><span class="op" id="3826819">(</span><span class="ident" id="3826820">buf</span><span class="op" id="3826823">)</span>&nbsp;<span class="comment" id="3826825">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826865">x</span>&nbsp;<span class="op" id="3826867">:=</span>&nbsp;<span class="ident" id="3826870">int64</span><span class="op" id="3826875">(</span><span class="ident" id="3826876">ux</span>&nbsp;<span class="op" id="3826879">&gt;&gt;</span>&nbsp;<span class="num" id="3826882">1</span><span class="op" id="3826883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826886">if</span>&nbsp;<span class="ident" id="3826889">ux</span><span class="op" id="3826891">&amp;</span><span class="num" id="3826892">1</span>&nbsp;<span class="op" id="3826894">!=</span>&nbsp;<span class="num" id="3826897">0</span>&nbsp;<span class="op" id="3826899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826903">x</span>&nbsp;<span class="op" id="3826905">=</span>&nbsp;<span class="op" id="3826907">^</span><span class="ident" id="3826908">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826911">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826914">return</span>&nbsp;<span class="ident" id="3826921">x</span><span class="op" id="3826922">,</span>&nbsp;<span class="ident" id="3826924">n</span><br>
<span class="lineno"></span><span class="op" id="3826926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3826929">var</span>&nbsp;<span class="ident" id="3826933">overflow</span>&nbsp;<span class="op" id="3826942">=</span>&nbsp;<span class="ident" id="3826944">errors</span><span class="op" id="3826950">.</span><span class="ident" id="3826951">New</span><span class="op" id="3826954">(</span><span class="string" id="3826955">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3826998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3827001">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3827085">func</span>&nbsp;<span class="ident" id="3827090">ReadUvarint</span><span class="op" id="3827101">(</span><span class="ident" id="3827102">r</span>&nbsp;<span class="ident" id="3827104">io</span><span class="op" id="3827106">.</span><span class="ident" id="3827107">ByteReader</span><span class="op" id="3827117">)</span>&nbsp;<span class="op" id="3827119">(</span><span class="ident" id="3827120">uint64</span><span class="op" id="3827126">,</span>&nbsp;<span class="builtintype" id="3827128">error</span><span class="op" id="3827133">)</span>&nbsp;<span class="op" id="3827135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827138">var</span>&nbsp;<span class="ident" id="3827142">x</span>&nbsp;<span class="ident" id="3827144">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827152">var</span>&nbsp;<span class="ident" id="3827156">s</span>&nbsp;<span class="builtintype" id="3827158">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827164">for</span>&nbsp;<span class="ident" id="3827168">i</span>&nbsp;<span class="op" id="3827170">:=</span>&nbsp;<span class="num" id="3827173">0</span><span class="op" id="3827174">;</span>&nbsp;<span class="op" id="3827176">;</span>&nbsp;<span class="ident" id="3827178">i</span><span class="op" id="3827179">++</span>&nbsp;<span class="op" id="3827182">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827186">b</span><span class="op" id="3827187">,</span>&nbsp;<span class="ident" id="3827189">err</span>&nbsp;<span class="op" id="3827193">:=</span>&nbsp;<span class="ident" id="3827196">r</span><span class="op" id="3827197">.</span><span class="ident" id="3827198">ReadByte</span><span class="op" id="3827206">(</span><span class="op" id="3827207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827211">if</span>&nbsp;<span class="ident" id="3827214">err</span>&nbsp;<span class="op" id="3827218">!=</span>&nbsp;<span class="ident" id="3827221">nil</span>&nbsp;<span class="op" id="3827225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827230">return</span>&nbsp;<span class="ident" id="3827237">x</span><span class="op" id="3827238">,</span>&nbsp;<span class="ident" id="3827240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827250">if</span>&nbsp;<span class="ident" id="3827253">b</span>&nbsp;<span class="op" id="3827255">&lt;</span>&nbsp;<span class="num" id="3827257">0x80</span>&nbsp;<span class="op" id="3827262">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827267">if</span>&nbsp;<span class="ident" id="3827270">i</span>&nbsp;<span class="op" id="3827272">&gt;</span>&nbsp;<span class="num" id="3827274">9</span>&nbsp;<span class="op" id="3827276">||</span>&nbsp;<span class="ident" id="3827279">i</span>&nbsp;<span class="op" id="3827281">==</span>&nbsp;<span class="num" id="3827284">9</span>&nbsp;<span class="op" id="3827286">&amp;&amp;</span>&nbsp;<span class="ident" id="3827289">b</span>&nbsp;<span class="op" id="3827291">&gt;</span>&nbsp;<span class="num" id="3827293">1</span>&nbsp;<span class="op" id="3827295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827301">return</span>&nbsp;<span class="ident" id="3827308">x</span><span class="op" id="3827309">,</span>&nbsp;<span class="ident" id="3827311">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827328">return</span>&nbsp;<span class="ident" id="3827335">x</span>&nbsp;<span class="op" id="3827337">|</span>&nbsp;<span class="ident" id="3827339">uint64</span><span class="op" id="3827345">(</span><span class="ident" id="3827346">b</span><span class="op" id="3827347">)</span><span class="op" id="3827348">&lt;&lt;</span><span class="ident" id="3827350">s</span><span class="op" id="3827351">,</span>&nbsp;<span class="ident" id="3827353">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827359">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827363">x</span>&nbsp;<span class="op" id="3827365">|=</span>&nbsp;<span class="ident" id="3827368">uint64</span><span class="op" id="3827374">(</span><span class="ident" id="3827375">b</span><span class="op" id="3827376">&amp;</span><span class="num" id="3827377">0x7f</span><span class="op" id="3827381">)</span>&nbsp;<span class="op" id="3827383">&lt;&lt;</span>&nbsp;<span class="ident" id="3827386">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827390">s</span>&nbsp;<span class="op" id="3827392">+=</span>&nbsp;<span class="num" id="3827395">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827398">}</span><br>
<span class="lineno"></span><span class="op" id="3827400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3827403">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3827484">func</span>&nbsp;<span class="ident" id="3827489">ReadVarint</span><span class="op" id="3827499">(</span><span class="ident" id="3827500">r</span>&nbsp;<span class="ident" id="3827502">io</span><span class="op" id="3827504">.</span><span class="ident" id="3827505">ByteReader</span><span class="op" id="3827515">)</span>&nbsp;<span class="op" id="3827517">(</span><span class="ident" id="3827518">int64</span><span class="op" id="3827523">,</span>&nbsp;<span class="builtintype" id="3827525">error</span><span class="op" id="3827530">)</span>&nbsp;<span class="op" id="3827532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827535">ux</span><span class="op" id="3827537">,</span>&nbsp;<span class="ident" id="3827539">err</span>&nbsp;<span class="op" id="3827543">:=</span>&nbsp;<span class="ident" id="3827546">ReadUvarint</span><span class="op" id="3827557">(</span><span class="ident" id="3827558">r</span><span class="op" id="3827559">)</span>&nbsp;<span class="comment" id="3827561">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827601">x</span>&nbsp;<span class="op" id="3827603">:=</span>&nbsp;<span class="ident" id="3827606">int64</span><span class="op" id="3827611">(</span><span class="ident" id="3827612">ux</span>&nbsp;<span class="op" id="3827615">&gt;&gt;</span>&nbsp;<span class="num" id="3827618">1</span><span class="op" id="3827619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827622">if</span>&nbsp;<span class="ident" id="3827625">ux</span><span class="op" id="3827627">&amp;</span><span class="num" id="3827628">1</span>&nbsp;<span class="op" id="3827630">!=</span>&nbsp;<span class="num" id="3827633">0</span>&nbsp;<span class="op" id="3827635">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827639">x</span>&nbsp;<span class="op" id="3827641">=</span>&nbsp;<span class="op" id="3827643">^</span><span class="ident" id="3827644">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827650">return</span>&nbsp;<span class="ident" id="3827657">x</span><span class="op" id="3827658">,</span>&nbsp;<span class="ident" id="3827660">err</span><br>
<span class="lineno"></span><span class="op" id="3827664">}</span>
</div>
</body>
</html>
