<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7856645">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7856700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7856754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7856805">package</span>&nbsp;<span class="ident" id="7856813">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7856819">import</span>&nbsp;<span class="op" id="7856826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7856829">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7856838">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7856848">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7856854">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7856864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7856867">var</span>&nbsp;<span class="ident" id="7856871">sizeTests</span>&nbsp;<span class="op" id="7856881">=</span>&nbsp;<span class="op" id="7856883">[</span><span class="op" id="7856884">]</span><span class="keyword" id="7856885">struct</span>&nbsp;<span class="op" id="7856892">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7856895">size</span>&nbsp;&nbsp;<span class="builtintype" id="7856901">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7856909">bytes</span>&nbsp;<span class="op" id="7856915">[</span><span class="op" id="7856916">]</span><span class="builtintype" id="7856917">byte</span><br>
<span class="lineno"></span><span class="op" id="7856922">}</span><span class="op" id="7856923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7856926">{</span><span class="num" id="7856927">0</span><span class="op" id="7856928">,</span>&nbsp;<span class="op" id="7856930">[</span><span class="op" id="7856931">]</span><span class="builtintype" id="7856932">byte</span><span class="op" id="7856936">{</span><span class="num" id="7856937">0x00</span><span class="op" id="7856941">}</span><span class="op" id="7856942">}</span><span class="op" id="7856943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7856946">{</span><span class="num" id="7856947">127</span><span class="op" id="7856950">,</span>&nbsp;<span class="op" id="7856952">[</span><span class="op" id="7856953">]</span><span class="builtintype" id="7856954">byte</span><span class="op" id="7856958">{</span><span class="num" id="7856959">0x7F</span><span class="op" id="7856963">}</span><span class="op" id="7856964">}</span><span class="op" id="7856965">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7856968">{</span><span class="num" id="7856969">128</span><span class="op" id="7856972">,</span>&nbsp;<span class="op" id="7856974">[</span><span class="op" id="7856975">]</span><span class="builtintype" id="7856976">byte</span><span class="op" id="7856980">{</span><span class="num" id="7856981">0x80</span><span class="op" id="7856985">,</span>&nbsp;<span class="num" id="7856987">0x00</span><span class="op" id="7856991">,</span>&nbsp;<span class="num" id="7856993">0x00</span><span class="op" id="7856997">,</span>&nbsp;<span class="num" id="7856999">0x80</span><span class="op" id="7857003">}</span><span class="op" id="7857004">}</span><span class="op" id="7857005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857008">{</span><span class="num" id="7857009">1000</span><span class="op" id="7857013">,</span>&nbsp;<span class="op" id="7857015">[</span><span class="op" id="7857016">]</span><span class="builtintype" id="7857017">byte</span><span class="op" id="7857021">{</span><span class="num" id="7857022">0x80</span><span class="op" id="7857026">,</span>&nbsp;<span class="num" id="7857028">0x00</span><span class="op" id="7857032">,</span>&nbsp;<span class="num" id="7857034">0x03</span><span class="op" id="7857038">,</span>&nbsp;<span class="num" id="7857040">0xE8</span><span class="op" id="7857044">}</span><span class="op" id="7857045">}</span><span class="op" id="7857046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857049">{</span><span class="num" id="7857050">33554431</span><span class="op" id="7857058">,</span>&nbsp;<span class="op" id="7857060">[</span><span class="op" id="7857061">]</span><span class="builtintype" id="7857062">byte</span><span class="op" id="7857066">{</span><span class="num" id="7857067">0x81</span><span class="op" id="7857071">,</span>&nbsp;<span class="num" id="7857073">0xFF</span><span class="op" id="7857077">,</span>&nbsp;<span class="num" id="7857079">0xFF</span><span class="op" id="7857083">,</span>&nbsp;<span class="num" id="7857085">0xFF</span><span class="op" id="7857089">}</span><span class="op" id="7857090">}</span><span class="op" id="7857091">,</span><br>
<span class="lineno"></span><span class="op" id="7857093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7857096">func</span>&nbsp;<span class="ident" id="7857101">TestSize</span><span class="op" id="7857109">(</span><span class="ident" id="7857110">t</span>&nbsp;<span class="op" id="7857112">*</span><span class="ident" id="7857113">testing</span><span class="op" id="7857120">.</span><span class="ident" id="7857121">T</span><span class="op" id="7857122">)</span>&nbsp;<span class="op" id="7857124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857127">b</span>&nbsp;<span class="op" id="7857129">:=</span>&nbsp;<span class="builtinfunc" id="7857132">make</span><span class="op" id="7857136">(</span><span class="op" id="7857137">[</span><span class="op" id="7857138">]</span><span class="builtintype" id="7857139">byte</span><span class="op" id="7857143">,</span>&nbsp;<span class="num" id="7857145">4</span><span class="op" id="7857146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7857149">for</span>&nbsp;<span class="ident" id="7857153">i</span><span class="op" id="7857154">,</span>&nbsp;<span class="ident" id="7857156">test</span>&nbsp;<span class="op" id="7857161">:=</span>&nbsp;<span class="keyword" id="7857164">range</span>&nbsp;<span class="ident" id="7857170">sizeTests</span>&nbsp;<span class="op" id="7857180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857184">n</span>&nbsp;<span class="op" id="7857186">:=</span>&nbsp;<span class="ident" id="7857189">encodeSize</span><span class="op" id="7857199">(</span><span class="ident" id="7857200">b</span><span class="op" id="7857201">,</span>&nbsp;<span class="ident" id="7857203">test</span><span class="op" id="7857207">.</span><span class="ident" id="7857208">size</span><span class="op" id="7857212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7857216">if</span>&nbsp;<span class="op" id="7857219">!</span><span class="ident" id="7857220">bytes</span><span class="op" id="7857225">.</span><span class="ident" id="7857226">Equal</span><span class="op" id="7857231">(</span><span class="ident" id="7857232">b</span><span class="op" id="7857233">[</span><span class="op" id="7857234">:</span><span class="ident" id="7857235">n</span><span class="op" id="7857236">]</span><span class="op" id="7857237">,</span>&nbsp;<span class="ident" id="7857239">test</span><span class="op" id="7857243">.</span><span class="ident" id="7857244">bytes</span><span class="op" id="7857249">)</span>&nbsp;<span class="op" id="7857251">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857256">t</span><span class="op" id="7857257">.</span><span class="ident" id="7857258">Errorf</span><span class="op" id="7857264">(</span><span class="string" id="7857265">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="7857293">,</span>&nbsp;<span class="ident" id="7857295">i</span><span class="op" id="7857296">,</span>&nbsp;<span class="ident" id="7857298">test</span><span class="op" id="7857302">.</span><span class="ident" id="7857303">bytes</span><span class="op" id="7857308">,</span>&nbsp;<span class="ident" id="7857310">b</span><span class="op" id="7857311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857319">size</span><span class="op" id="7857323">,</span>&nbsp;<span class="ident" id="7857325">n</span>&nbsp;<span class="op" id="7857327">:=</span>&nbsp;<span class="ident" id="7857330">readSize</span><span class="op" id="7857338">(</span><span class="ident" id="7857339">test</span><span class="op" id="7857343">.</span><span class="ident" id="7857344">bytes</span><span class="op" id="7857349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7857353">if</span>&nbsp;<span class="ident" id="7857356">size</span>&nbsp;<span class="op" id="7857361">!=</span>&nbsp;<span class="ident" id="7857364">test</span><span class="op" id="7857368">.</span><span class="ident" id="7857369">size</span>&nbsp;<span class="op" id="7857374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857379">t</span><span class="op" id="7857380">.</span><span class="ident" id="7857381">Errorf</span><span class="op" id="7857387">(</span><span class="string" id="7857388">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7857413">,</span>&nbsp;<span class="ident" id="7857415">i</span><span class="op" id="7857416">,</span>&nbsp;<span class="ident" id="7857418">test</span><span class="op" id="7857422">.</span><span class="ident" id="7857423">size</span><span class="op" id="7857427">,</span>&nbsp;<span class="ident" id="7857429">size</span><span class="op" id="7857433">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7857441">if</span>&nbsp;<span class="builtinfunc" id="7857444">len</span><span class="op" id="7857447">(</span><span class="ident" id="7857448">test</span><span class="op" id="7857452">.</span><span class="ident" id="7857453">bytes</span><span class="op" id="7857458">)</span>&nbsp;<span class="op" id="7857460">!=</span>&nbsp;<span class="ident" id="7857463">n</span>&nbsp;<span class="op" id="7857465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857470">t</span><span class="op" id="7857471">.</span><span class="ident" id="7857472">Errorf</span><span class="op" id="7857478">(</span><span class="string" id="7857479">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="7857513">,</span>&nbsp;<span class="ident" id="7857515">i</span><span class="op" id="7857516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857523">}</span><br>
<span class="lineno">40</span><span class="op" id="7857525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7857528">var</span>&nbsp;<span class="ident" id="7857532">streamTests</span>&nbsp;<span class="op" id="7857544">=</span>&nbsp;<span class="op" id="7857546">[</span><span class="op" id="7857547">]</span><span class="keyword" id="7857548">struct</span>&nbsp;<span class="op" id="7857555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857558">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7857566">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857574">recType</span>&nbsp;<span class="ident" id="7857582">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857591">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7857599">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857607">content</span>&nbsp;<span class="op" id="7857615">[</span><span class="op" id="7857616">]</span><span class="builtintype" id="7857617">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857623">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857631">[</span><span class="op" id="7857632">]</span><span class="builtintype" id="7857633">byte</span><br>
<span class="lineno"></span><span class="op" id="7857638">}</span><span class="op" id="7857639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857642">{</span><span class="string" id="7857643">&#34;single&nbsp;record&#34;</span><span class="op" id="7857658">,</span>&nbsp;<span class="ident" id="7857660">typeStdout</span><span class="op" id="7857670">,</span>&nbsp;<span class="num" id="7857672">1</span><span class="op" id="7857673">,</span>&nbsp;<span class="ident" id="7857675">nil</span><span class="op" id="7857678">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857682">[</span><span class="op" id="7857683">]</span><span class="builtintype" id="7857684">byte</span><span class="op" id="7857688">{</span><span class="num" id="7857689">1</span><span class="op" id="7857690">,</span>&nbsp;<span class="builtintype" id="7857692">byte</span><span class="op" id="7857696">(</span><span class="ident" id="7857697">typeStdout</span><span class="op" id="7857707">)</span><span class="op" id="7857708">,</span>&nbsp;<span class="num" id="7857710">0</span><span class="op" id="7857711">,</span>&nbsp;<span class="num" id="7857713">1</span><span class="op" id="7857714">,</span>&nbsp;<span class="num" id="7857716">0</span><span class="op" id="7857717">,</span>&nbsp;<span class="num" id="7857719">0</span><span class="op" id="7857720">,</span>&nbsp;<span class="num" id="7857722">0</span><span class="op" id="7857723">,</span>&nbsp;<span class="num" id="7857725">0</span><span class="op" id="7857726">}</span><span class="op" id="7857727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857730">}</span><span class="op" id="7857731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7857734">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857787">{</span><span class="string" id="7857788">&#34;two&nbsp;records&#34;</span><span class="op" id="7857801">,</span>&nbsp;<span class="ident" id="7857803">typeStdin</span><span class="op" id="7857812">,</span>&nbsp;<span class="num" id="7857814">300</span><span class="op" id="7857817">,</span>&nbsp;<span class="builtinfunc" id="7857819">make</span><span class="op" id="7857823">(</span><span class="op" id="7857824">[</span><span class="op" id="7857825">]</span><span class="builtintype" id="7857826">byte</span><span class="op" id="7857830">,</span>&nbsp;<span class="num" id="7857832">66000</span><span class="op" id="7857837">)</span><span class="op" id="7857838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857842">bytes</span><span class="op" id="7857847">.</span><span class="ident" id="7857848">Join</span><span class="op" id="7857852">(</span><span class="op" id="7857853">[</span><span class="op" id="7857854">]</span><span class="op" id="7857855">[</span><span class="op" id="7857856">]</span><span class="builtintype" id="7857857">byte</span><span class="op" id="7857861">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7857866">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7857900">{</span><span class="num" id="7857901">1</span><span class="op" id="7857902">,</span>&nbsp;<span class="builtintype" id="7857904">byte</span><span class="op" id="7857908">(</span><span class="ident" id="7857909">typeStdin</span><span class="op" id="7857918">)</span><span class="op" id="7857919">,</span>&nbsp;<span class="num" id="7857921">0x01</span><span class="op" id="7857925">,</span>&nbsp;<span class="num" id="7857927">0x2C</span><span class="op" id="7857931">,</span>&nbsp;<span class="num" id="7857933">0xFF</span><span class="op" id="7857937">,</span>&nbsp;<span class="num" id="7857939">0xFF</span><span class="op" id="7857943">,</span>&nbsp;<span class="num" id="7857945">1</span><span class="op" id="7857946">,</span>&nbsp;<span class="num" id="7857948">0</span><span class="op" id="7857949">}</span><span class="op" id="7857950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7857955">make</span><span class="op" id="7857959">(</span><span class="op" id="7857960">[</span><span class="op" id="7857961">]</span><span class="builtintype" id="7857962">byte</span><span class="op" id="7857966">,</span>&nbsp;<span class="num" id="7857968">65536</span><span class="op" id="7857973">)</span><span class="op" id="7857974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7857979">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858007">{</span><span class="num" id="7858008">1</span><span class="op" id="7858009">,</span>&nbsp;<span class="builtintype" id="7858011">byte</span><span class="op" id="7858015">(</span><span class="ident" id="7858016">typeStdin</span><span class="op" id="7858025">)</span><span class="op" id="7858026">,</span>&nbsp;<span class="num" id="7858028">0x01</span><span class="op" id="7858032">,</span>&nbsp;<span class="num" id="7858034">0x2C</span><span class="op" id="7858038">,</span>&nbsp;<span class="num" id="7858040">0x01</span><span class="op" id="7858044">,</span>&nbsp;<span class="num" id="7858046">0xD1</span><span class="op" id="7858050">,</span>&nbsp;<span class="num" id="7858052">7</span><span class="op" id="7858053">,</span>&nbsp;<span class="num" id="7858055">0</span><span class="op" id="7858056">}</span><span class="op" id="7858057">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7858062">make</span><span class="op" id="7858066">(</span><span class="op" id="7858067">[</span><span class="op" id="7858068">]</span><span class="builtintype" id="7858069">byte</span><span class="op" id="7858073">,</span>&nbsp;<span class="num" id="7858075">472</span><span class="op" id="7858078">)</span><span class="op" id="7858079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7858084">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858118">{</span><span class="num" id="7858119">1</span><span class="op" id="7858120">,</span>&nbsp;<span class="builtintype" id="7858122">byte</span><span class="op" id="7858126">(</span><span class="ident" id="7858127">typeStdin</span><span class="op" id="7858136">)</span><span class="op" id="7858137">,</span>&nbsp;<span class="num" id="7858139">0x01</span><span class="op" id="7858143">,</span>&nbsp;<span class="num" id="7858145">0x2C</span><span class="op" id="7858149">,</span>&nbsp;<span class="num" id="7858151">0</span><span class="op" id="7858152">,</span>&nbsp;<span class="num" id="7858154">0</span><span class="op" id="7858155">,</span>&nbsp;<span class="num" id="7858157">0</span><span class="op" id="7858158">,</span>&nbsp;<span class="num" id="7858160">0</span><span class="op" id="7858161">}</span><span class="op" id="7858162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858166">}</span><span class="op" id="7858167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858172">nil</span><span class="op" id="7858175">)</span><span class="op" id="7858176">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858179">}</span><span class="op" id="7858180">,</span><br>
<span class="lineno"></span><span class="op" id="7858182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858185">type</span>&nbsp;<span class="ident" id="7858190">nilCloser</span>&nbsp;<span class="keyword" id="7858200">struct</span>&nbsp;<span class="op" id="7858207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858210">io</span><span class="op" id="7858212">.</span><span class="ident" id="7858213">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="7858224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858227">func</span>&nbsp;<span class="op" id="7858232">(</span><span class="ident" id="7858233">c</span>&nbsp;<span class="op" id="7858235">*</span><span class="ident" id="7858236">nilCloser</span><span class="op" id="7858245">)</span>&nbsp;<span class="ident" id="7858247">Close</span><span class="op" id="7858252">(</span><span class="op" id="7858253">)</span>&nbsp;<span class="builtintype" id="7858255">error</span>&nbsp;<span class="op" id="7858261">{</span>&nbsp;<span class="keyword" id="7858263">return</span>&nbsp;<span class="ident" id="7858270">nil</span>&nbsp;<span class="op" id="7858274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858277">func</span>&nbsp;<span class="ident" id="7858282">TestStreams</span><span class="op" id="7858293">(</span><span class="ident" id="7858294">t</span>&nbsp;<span class="op" id="7858296">*</span><span class="ident" id="7858297">testing</span><span class="op" id="7858304">.</span><span class="ident" id="7858305">T</span><span class="op" id="7858306">)</span>&nbsp;<span class="op" id="7858308">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858311">var</span>&nbsp;<span class="ident" id="7858315">rec</span>&nbsp;<span class="ident" id="7858319">record</span><br>
<span class="lineno"></span><span class="ident" id="7858326">outer</span><span class="op" id="7858331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858334">for</span>&nbsp;<span class="ident" id="7858338">_</span><span class="op" id="7858339">,</span>&nbsp;<span class="ident" id="7858341">test</span>&nbsp;<span class="op" id="7858346">:=</span>&nbsp;<span class="keyword" id="7858349">range</span>&nbsp;<span class="ident" id="7858355">streamTests</span>&nbsp;<span class="op" id="7858367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858371">buf</span>&nbsp;<span class="op" id="7858375">:=</span>&nbsp;<span class="ident" id="7858378">bytes</span><span class="op" id="7858383">.</span><span class="ident" id="7858384">NewBuffer</span><span class="op" id="7858393">(</span><span class="ident" id="7858394">test</span><span class="op" id="7858398">.</span><span class="ident" id="7858399">raw</span><span class="op" id="7858402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858406">var</span>&nbsp;<span class="ident" id="7858410">content</span>&nbsp;<span class="op" id="7858418">[</span><span class="op" id="7858419">]</span><span class="builtintype" id="7858420">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858427">for</span>&nbsp;<span class="ident" id="7858431">buf</span><span class="op" id="7858434">.</span><span class="ident" id="7858435">Len</span><span class="op" id="7858438">(</span><span class="op" id="7858439">)</span>&nbsp;<span class="op" id="7858441">&gt;</span>&nbsp;<span class="num" id="7858443">0</span>&nbsp;<span class="op" id="7858445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858450">if</span>&nbsp;<span class="ident" id="7858453">err</span>&nbsp;<span class="op" id="7858457">:=</span>&nbsp;<span class="ident" id="7858460">rec</span><span class="op" id="7858463">.</span><span class="ident" id="7858464">read</span><span class="op" id="7858468">(</span><span class="ident" id="7858469">buf</span><span class="op" id="7858472">)</span><span class="op" id="7858473">;</span>&nbsp;<span class="ident" id="7858475">err</span>&nbsp;<span class="op" id="7858479">!=</span>&nbsp;<span class="ident" id="7858482">nil</span>&nbsp;<span class="op" id="7858486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858492">t</span><span class="op" id="7858493">.</span><span class="ident" id="7858494">Errorf</span><span class="op" id="7858500">(</span><span class="string" id="7858501">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7858531">,</span>&nbsp;<span class="ident" id="7858533">test</span><span class="op" id="7858537">.</span><span class="ident" id="7858538">desc</span><span class="op" id="7858542">,</span>&nbsp;<span class="ident" id="7858544">err</span><span class="op" id="7858547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858553">continue</span>&nbsp;<span class="ident" id="7858562">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858571">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858576">content</span>&nbsp;<span class="op" id="7858584">=</span>&nbsp;<span class="builtinfunc" id="7858586">append</span><span class="op" id="7858592">(</span><span class="ident" id="7858593">content</span><span class="op" id="7858600">,</span>&nbsp;<span class="ident" id="7858602">rec</span><span class="op" id="7858605">.</span><span class="ident" id="7858606">content</span><span class="op" id="7858613">(</span><span class="op" id="7858614">)</span><span class="op" id="7858615">...</span><span class="op" id="7858618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858626">if</span>&nbsp;<span class="ident" id="7858629">rec</span><span class="op" id="7858632">.</span><span class="ident" id="7858633">h</span><span class="op" id="7858634">.</span><span class="ident" id="7858635">Type</span>&nbsp;<span class="op" id="7858640">!=</span>&nbsp;<span class="ident" id="7858643">test</span><span class="op" id="7858647">.</span><span class="ident" id="7858648">recType</span>&nbsp;<span class="op" id="7858656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858661">t</span><span class="op" id="7858662">.</span><span class="ident" id="7858663">Errorf</span><span class="op" id="7858669">(</span><span class="string" id="7858670">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7858699">,</span>&nbsp;<span class="ident" id="7858701">test</span><span class="op" id="7858705">.</span><span class="ident" id="7858706">desc</span><span class="op" id="7858710">,</span>&nbsp;<span class="ident" id="7858712">rec</span><span class="op" id="7858715">.</span><span class="ident" id="7858716">h</span><span class="op" id="7858717">.</span><span class="ident" id="7858718">Type</span><span class="op" id="7858722">,</span>&nbsp;<span class="ident" id="7858724">test</span><span class="op" id="7858728">.</span><span class="ident" id="7858729">recType</span><span class="op" id="7858736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858741">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858756">if</span>&nbsp;<span class="ident" id="7858759">rec</span><span class="op" id="7858762">.</span><span class="ident" id="7858763">h</span><span class="op" id="7858764">.</span><span class="ident" id="7858765">Id</span>&nbsp;<span class="op" id="7858768">!=</span>&nbsp;<span class="ident" id="7858771">test</span><span class="op" id="7858775">.</span><span class="ident" id="7858776">reqId</span>&nbsp;<span class="op" id="7858782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858787">t</span><span class="op" id="7858788">.</span><span class="ident" id="7858789">Errorf</span><span class="op" id="7858795">(</span><span class="string" id="7858796">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7858831">,</span>&nbsp;<span class="ident" id="7858833">test</span><span class="op" id="7858837">.</span><span class="ident" id="7858838">desc</span><span class="op" id="7858842">,</span>&nbsp;<span class="ident" id="7858844">rec</span><span class="op" id="7858847">.</span><span class="ident" id="7858848">h</span><span class="op" id="7858849">.</span><span class="ident" id="7858850">Id</span><span class="op" id="7858852">,</span>&nbsp;<span class="ident" id="7858854">test</span><span class="op" id="7858858">.</span><span class="ident" id="7858859">reqId</span><span class="op" id="7858864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858869">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858880">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858884">if</span>&nbsp;<span class="op" id="7858887">!</span><span class="ident" id="7858888">bytes</span><span class="op" id="7858893">.</span><span class="ident" id="7858894">Equal</span><span class="op" id="7858899">(</span><span class="ident" id="7858900">content</span><span class="op" id="7858907">,</span>&nbsp;<span class="ident" id="7858909">test</span><span class="op" id="7858913">.</span><span class="ident" id="7858914">content</span><span class="op" id="7858921">)</span>&nbsp;<span class="op" id="7858923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858928">t</span><span class="op" id="7858929">.</span><span class="ident" id="7858930">Errorf</span><span class="op" id="7858936">(</span><span class="string" id="7858937">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7858961">,</span>&nbsp;<span class="ident" id="7858963">test</span><span class="op" id="7858967">.</span><span class="ident" id="7858968">desc</span><span class="op" id="7858972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7858977">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7858988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7858992">buf</span><span class="op" id="7858995">.</span><span class="ident" id="7858996">Reset</span><span class="op" id="7859001">(</span><span class="op" id="7859002">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859006">c</span>&nbsp;<span class="op" id="7859008">:=</span>&nbsp;<span class="ident" id="7859011">newConn</span><span class="op" id="7859018">(</span><span class="op" id="7859019">&amp;</span><span class="ident" id="7859020">nilCloser</span><span class="op" id="7859029">{</span><span class="ident" id="7859030">buf</span><span class="op" id="7859033">}</span><span class="op" id="7859034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859038">w</span>&nbsp;<span class="op" id="7859040">:=</span>&nbsp;<span class="ident" id="7859043">newWriter</span><span class="op" id="7859052">(</span><span class="ident" id="7859053">c</span><span class="op" id="7859054">,</span>&nbsp;<span class="ident" id="7859056">test</span><span class="op" id="7859060">.</span><span class="ident" id="7859061">recType</span><span class="op" id="7859068">,</span>&nbsp;<span class="ident" id="7859070">test</span><span class="op" id="7859074">.</span><span class="ident" id="7859075">reqId</span><span class="op" id="7859080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859084">if</span>&nbsp;<span class="ident" id="7859087">_</span><span class="op" id="7859088">,</span>&nbsp;<span class="ident" id="7859090">err</span>&nbsp;<span class="op" id="7859094">:=</span>&nbsp;<span class="ident" id="7859097">w</span><span class="op" id="7859098">.</span><span class="ident" id="7859099">Write</span><span class="op" id="7859104">(</span><span class="ident" id="7859105">test</span><span class="op" id="7859109">.</span><span class="ident" id="7859110">content</span><span class="op" id="7859117">)</span><span class="op" id="7859118">;</span>&nbsp;<span class="ident" id="7859120">err</span>&nbsp;<span class="op" id="7859124">!=</span>&nbsp;<span class="ident" id="7859127">nil</span>&nbsp;<span class="op" id="7859131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859136">t</span><span class="op" id="7859137">.</span><span class="ident" id="7859138">Errorf</span><span class="op" id="7859144">(</span><span class="string" id="7859145">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7859175">,</span>&nbsp;<span class="ident" id="7859177">test</span><span class="op" id="7859181">.</span><span class="ident" id="7859182">desc</span><span class="op" id="7859186">,</span>&nbsp;<span class="ident" id="7859188">err</span><span class="op" id="7859191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859196">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7859207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859211">if</span>&nbsp;<span class="ident" id="7859214">err</span>&nbsp;<span class="op" id="7859218">:=</span>&nbsp;<span class="ident" id="7859221">w</span><span class="op" id="7859222">.</span><span class="ident" id="7859223">Close</span><span class="op" id="7859228">(</span><span class="op" id="7859229">)</span><span class="op" id="7859230">;</span>&nbsp;<span class="ident" id="7859232">err</span>&nbsp;<span class="op" id="7859236">!=</span>&nbsp;<span class="ident" id="7859239">nil</span>&nbsp;<span class="op" id="7859243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859248">t</span><span class="op" id="7859249">.</span><span class="ident" id="7859250">Errorf</span><span class="op" id="7859256">(</span><span class="string" id="7859257">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="7859287">,</span>&nbsp;<span class="ident" id="7859289">test</span><span class="op" id="7859293">.</span><span class="ident" id="7859294">desc</span><span class="op" id="7859298">,</span>&nbsp;<span class="ident" id="7859300">err</span><span class="op" id="7859303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859308">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7859319">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859323">if</span>&nbsp;<span class="op" id="7859326">!</span><span class="ident" id="7859327">bytes</span><span class="op" id="7859332">.</span><span class="ident" id="7859333">Equal</span><span class="op" id="7859338">(</span><span class="ident" id="7859339">buf</span><span class="op" id="7859342">.</span><span class="ident" id="7859343">Bytes</span><span class="op" id="7859348">(</span><span class="op" id="7859349">)</span><span class="op" id="7859350">,</span>&nbsp;<span class="ident" id="7859352">test</span><span class="op" id="7859356">.</span><span class="ident" id="7859357">raw</span><span class="op" id="7859360">)</span>&nbsp;<span class="op" id="7859362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859367">t</span><span class="op" id="7859368">.</span><span class="ident" id="7859369">Errorf</span><span class="op" id="7859375">(</span><span class="string" id="7859376">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7859401">,</span>&nbsp;<span class="ident" id="7859403">test</span><span class="op" id="7859407">.</span><span class="ident" id="7859408">desc</span><span class="op" id="7859412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7859416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7859419">}</span><br>
<span class="lineno"></span><span class="op" id="7859421">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7859424">type</span>&nbsp;<span class="ident" id="7859429">writeOnlyConn</span>&nbsp;<span class="keyword" id="7859443">struct</span>&nbsp;<span class="op" id="7859450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859453">buf</span>&nbsp;<span class="op" id="7859457">[</span><span class="op" id="7859458">]</span><span class="builtintype" id="7859459">byte</span><br>
<span class="lineno"></span><span class="op" id="7859464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7859467">func</span>&nbsp;<span class="op" id="7859472">(</span><span class="ident" id="7859473">c</span>&nbsp;<span class="op" id="7859475">*</span><span class="ident" id="7859476">writeOnlyConn</span><span class="op" id="7859489">)</span>&nbsp;<span class="ident" id="7859491">Write</span><span class="op" id="7859496">(</span><span class="ident" id="7859497">p</span>&nbsp;<span class="op" id="7859499">[</span><span class="op" id="7859500">]</span><span class="builtintype" id="7859501">byte</span><span class="op" id="7859505">)</span>&nbsp;<span class="op" id="7859507">(</span><span class="builtintype" id="7859508">int</span><span class="op" id="7859511">,</span>&nbsp;<span class="builtintype" id="7859513">error</span><span class="op" id="7859518">)</span>&nbsp;<span class="op" id="7859520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859523">c</span><span class="op" id="7859524">.</span><span class="ident" id="7859525">buf</span>&nbsp;<span class="op" id="7859529">=</span>&nbsp;<span class="builtinfunc" id="7859531">append</span><span class="op" id="7859537">(</span><span class="ident" id="7859538">c</span><span class="op" id="7859539">.</span><span class="ident" id="7859540">buf</span><span class="op" id="7859543">,</span>&nbsp;<span class="ident" id="7859545">p</span><span class="op" id="7859546">...</span><span class="op" id="7859549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859552">return</span>&nbsp;<span class="builtinfunc" id="7859559">len</span><span class="op" id="7859562">(</span><span class="ident" id="7859563">p</span><span class="op" id="7859564">)</span><span class="op" id="7859565">,</span>&nbsp;<span class="ident" id="7859567">nil</span><br>
<span class="lineno"></span><span class="op" id="7859571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7859574">func</span>&nbsp;<span class="op" id="7859579">(</span><span class="ident" id="7859580">c</span>&nbsp;<span class="op" id="7859582">*</span><span class="ident" id="7859583">writeOnlyConn</span><span class="op" id="7859596">)</span>&nbsp;<span class="ident" id="7859598">Read</span><span class="op" id="7859602">(</span><span class="ident" id="7859603">p</span>&nbsp;<span class="op" id="7859605">[</span><span class="op" id="7859606">]</span><span class="builtintype" id="7859607">byte</span><span class="op" id="7859611">)</span>&nbsp;<span class="op" id="7859613">(</span><span class="builtintype" id="7859614">int</span><span class="op" id="7859617">,</span>&nbsp;<span class="builtintype" id="7859619">error</span><span class="op" id="7859624">)</span>&nbsp;<span class="op" id="7859626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859629">return</span>&nbsp;<span class="num" id="7859636">0</span><span class="op" id="7859637">,</span>&nbsp;<span class="ident" id="7859639">errors</span><span class="op" id="7859645">.</span><span class="ident" id="7859646">New</span><span class="op" id="7859649">(</span><span class="string" id="7859650">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="7859670">)</span><br>
<span class="lineno"></span><span class="op" id="7859672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7859675">func</span>&nbsp;<span class="op" id="7859680">(</span><span class="ident" id="7859681">c</span>&nbsp;<span class="op" id="7859683">*</span><span class="ident" id="7859684">writeOnlyConn</span><span class="op" id="7859697">)</span>&nbsp;<span class="ident" id="7859699">Close</span><span class="op" id="7859704">(</span><span class="op" id="7859705">)</span>&nbsp;<span class="builtintype" id="7859707">error</span>&nbsp;<span class="op" id="7859713">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859716">return</span>&nbsp;<span class="ident" id="7859723">nil</span><br>
<span class="lineno"></span><span class="op" id="7859727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7859730">func</span>&nbsp;<span class="ident" id="7859735">TestGetValues</span><span class="op" id="7859748">(</span><span class="ident" id="7859749">t</span>&nbsp;<span class="op" id="7859751">*</span><span class="ident" id="7859752">testing</span><span class="op" id="7859759">.</span><span class="ident" id="7859760">T</span><span class="op" id="7859761">)</span>&nbsp;<span class="op" id="7859763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859766">var</span>&nbsp;<span class="ident" id="7859770">rec</span>&nbsp;<span class="ident" id="7859774">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859782">rec</span><span class="op" id="7859785">.</span><span class="ident" id="7859786">h</span><span class="op" id="7859787">.</span><span class="ident" id="7859788">Type</span>&nbsp;<span class="op" id="7859793">=</span>&nbsp;<span class="ident" id="7859795">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859811">wc</span>&nbsp;<span class="op" id="7859814">:=</span>&nbsp;<span class="builtinfunc" id="7859817">new</span><span class="op" id="7859820">(</span><span class="ident" id="7859821">writeOnlyConn</span><span class="op" id="7859834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859837">c</span>&nbsp;<span class="op" id="7859839">:=</span>&nbsp;<span class="ident" id="7859842">newChild</span><span class="op" id="7859850">(</span><span class="ident" id="7859851">wc</span><span class="op" id="7859853">,</span>&nbsp;<span class="ident" id="7859855">nil</span><span class="op" id="7859858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859861">err</span>&nbsp;<span class="op" id="7859865">:=</span>&nbsp;<span class="ident" id="7859868">c</span><span class="op" id="7859869">.</span><span class="ident" id="7859870">handleRecord</span><span class="op" id="7859882">(</span><span class="op" id="7859883">&amp;</span><span class="ident" id="7859884">rec</span><span class="op" id="7859887">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859890">if</span>&nbsp;<span class="ident" id="7859893">err</span>&nbsp;<span class="op" id="7859897">!=</span>&nbsp;<span class="ident" id="7859900">nil</span>&nbsp;<span class="op" id="7859904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7859908">t</span><span class="op" id="7859909">.</span><span class="ident" id="7859910">Fatalf</span><span class="op" id="7859916">(</span><span class="string" id="7859917">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="7859935">,</span>&nbsp;<span class="ident" id="7859937">err</span><span class="op" id="7859940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7859943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7859947">const</span>&nbsp;<span class="ident" id="7859953">want</span>&nbsp;<span class="op" id="7859958">=</span>&nbsp;<span class="string" id="7859960">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="7859993">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7859997">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="7860024">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7860028">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7860086">if</span>&nbsp;<span class="ident" id="7860089">got</span>&nbsp;<span class="op" id="7860093">:=</span>&nbsp;<span class="builtintype" id="7860096">string</span><span class="op" id="7860102">(</span><span class="ident" id="7860103">wc</span><span class="op" id="7860105">.</span><span class="ident" id="7860106">buf</span><span class="op" id="7860109">)</span><span class="op" id="7860110">;</span>&nbsp;<span class="ident" id="7860112">got</span>&nbsp;<span class="op" id="7860116">!=</span>&nbsp;<span class="ident" id="7860119">want</span>&nbsp;<span class="op" id="7860124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7860128">t</span><span class="op" id="7860129">.</span><span class="ident" id="7860130">Errorf</span><span class="op" id="7860136">(</span><span class="string" id="7860137">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7860159">,</span>&nbsp;<span class="ident" id="7860161">got</span><span class="op" id="7860164">,</span>&nbsp;<span class="ident" id="7860166">want</span><span class="op" id="7860170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7860173">}</span><br>
<span class="lineno">150</span><span class="op" id="7860175">}</span>
</div>
</body>
</html>
