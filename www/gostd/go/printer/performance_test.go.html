<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html" class="current">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7993954">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7994009">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7994063">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7994114">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="7994178">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7994212">package</span>&nbsp;<span class="ident" id="7994220">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7994229">import</span>&nbsp;<span class="op" id="7994236">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994239">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994248">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994258">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994271">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994277">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994290">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7994297">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7994307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7994310">var</span>&nbsp;<span class="ident" id="7994314">testfile</span>&nbsp;<span class="op" id="7994323">*</span><span class="ident" id="7994324">ast</span><span class="op" id="7994327">.</span><span class="ident" id="7994328">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7994334">func</span>&nbsp;<span class="ident" id="7994339">testprint</span><span class="op" id="7994348">(</span><span class="ident" id="7994349">out</span>&nbsp;<span class="ident" id="7994353">io</span><span class="op" id="7994355">.</span><span class="ident" id="7994356">Writer</span><span class="op" id="7994362">,</span>&nbsp;<span class="ident" id="7994364">file</span>&nbsp;<span class="op" id="7994369">*</span><span class="ident" id="7994370">ast</span><span class="op" id="7994373">.</span><span class="ident" id="7994374">File</span><span class="op" id="7994378">)</span>&nbsp;<span class="op" id="7994380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994383">if</span>&nbsp;<span class="ident" id="7994386">err</span>&nbsp;<span class="op" id="7994390">:=</span>&nbsp;<span class="op" id="7994393">(</span><span class="op" id="7994394">&amp;</span><span class="ident" id="7994395">Config</span><span class="op" id="7994401">{</span><span class="ident" id="7994402">TabIndent</span>&nbsp;<span class="op" id="7994412">|</span>&nbsp;<span class="ident" id="7994414">UseSpaces</span><span class="op" id="7994423">,</span>&nbsp;<span class="num" id="7994425">8</span><span class="op" id="7994426">,</span>&nbsp;<span class="num" id="7994428">0</span><span class="op" id="7994429">}</span><span class="op" id="7994430">)</span><span class="op" id="7994431">.</span><span class="ident" id="7994432">Fprint</span><span class="op" id="7994438">(</span><span class="ident" id="7994439">out</span><span class="op" id="7994442">,</span>&nbsp;<span class="ident" id="7994444">fset</span><span class="op" id="7994448">,</span>&nbsp;<span class="ident" id="7994450">file</span><span class="op" id="7994454">)</span><span class="op" id="7994455">;</span>&nbsp;<span class="ident" id="7994457">err</span>&nbsp;<span class="op" id="7994461">!=</span>&nbsp;<span class="ident" id="7994464">nil</span>&nbsp;<span class="op" id="7994468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994472">log</span><span class="op" id="7994475">.</span><span class="ident" id="7994476">Fatalf</span><span class="op" id="7994482">(</span><span class="string" id="7994483">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7994500">,</span>&nbsp;<span class="ident" id="7994502">err</span><span class="op" id="7994505">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994508">}</span><br>
<span class="lineno"></span><span class="op" id="7994510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7994513">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="7994588">func</span>&nbsp;<span class="ident" id="7994593">initialize</span><span class="op" id="7994603">(</span><span class="op" id="7994604">)</span>&nbsp;<span class="op" id="7994606">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994609">const</span>&nbsp;<span class="ident" id="7994615">filename</span>&nbsp;<span class="op" id="7994624">=</span>&nbsp;<span class="string" id="7994626">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994649">src</span><span class="op" id="7994652">,</span>&nbsp;<span class="ident" id="7994654">err</span>&nbsp;<span class="op" id="7994658">:=</span>&nbsp;<span class="ident" id="7994661">ioutil</span><span class="op" id="7994667">.</span><span class="ident" id="7994668">ReadFile</span><span class="op" id="7994676">(</span><span class="ident" id="7994677">filename</span><span class="op" id="7994685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994688">if</span>&nbsp;<span class="ident" id="7994691">err</span>&nbsp;<span class="op" id="7994695">!=</span>&nbsp;<span class="ident" id="7994698">nil</span>&nbsp;<span class="op" id="7994702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994706">log</span><span class="op" id="7994709">.</span><span class="ident" id="7994710">Fatalf</span><span class="op" id="7994716">(</span><span class="string" id="7994717">&#34;%s&#34;</span><span class="op" id="7994721">,</span>&nbsp;<span class="ident" id="7994723">err</span><span class="op" id="7994726">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994733">file</span><span class="op" id="7994737">,</span>&nbsp;<span class="ident" id="7994739">err</span>&nbsp;<span class="op" id="7994743">:=</span>&nbsp;<span class="ident" id="7994746">parser</span><span class="op" id="7994752">.</span><span class="ident" id="7994753">ParseFile</span><span class="op" id="7994762">(</span><span class="ident" id="7994763">fset</span><span class="op" id="7994767">,</span>&nbsp;<span class="ident" id="7994769">filename</span><span class="op" id="7994777">,</span>&nbsp;<span class="ident" id="7994779">src</span><span class="op" id="7994782">,</span>&nbsp;<span class="ident" id="7994784">parser</span><span class="op" id="7994790">.</span><span class="ident" id="7994791">ParseComments</span><span class="op" id="7994804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994807">if</span>&nbsp;<span class="ident" id="7994810">err</span>&nbsp;<span class="op" id="7994814">!=</span>&nbsp;<span class="ident" id="7994817">nil</span>&nbsp;<span class="op" id="7994821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994825">log</span><span class="op" id="7994828">.</span><span class="ident" id="7994829">Fatalf</span><span class="op" id="7994835">(</span><span class="string" id="7994836">&#34;%s&#34;</span><span class="op" id="7994840">,</span>&nbsp;<span class="ident" id="7994842">err</span><span class="op" id="7994845">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994852">var</span>&nbsp;<span class="ident" id="7994856">buf</span>&nbsp;<span class="ident" id="7994860">bytes</span><span class="op" id="7994865">.</span><span class="ident" id="7994866">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994874">testprint</span><span class="op" id="7994883">(</span><span class="op" id="7994884">&amp;</span><span class="ident" id="7994885">buf</span><span class="op" id="7994888">,</span>&nbsp;<span class="ident" id="7994890">file</span><span class="op" id="7994894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994897">if</span>&nbsp;<span class="op" id="7994900">!</span><span class="ident" id="7994901">bytes</span><span class="op" id="7994906">.</span><span class="ident" id="7994907">Equal</span><span class="op" id="7994912">(</span><span class="ident" id="7994913">buf</span><span class="op" id="7994916">.</span><span class="ident" id="7994917">Bytes</span><span class="op" id="7994922">(</span><span class="op" id="7994923">)</span><span class="op" id="7994924">,</span>&nbsp;<span class="ident" id="7994926">src</span><span class="op" id="7994929">)</span>&nbsp;<span class="op" id="7994931">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994935">log</span><span class="op" id="7994938">.</span><span class="ident" id="7994939">Fatalf</span><span class="op" id="7994945">(</span><span class="string" id="7994946">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="7994978">,</span>&nbsp;<span class="ident" id="7994980">filename</span><span class="op" id="7994988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994995">testfile</span>&nbsp;<span class="op" id="7995004">=</span>&nbsp;<span class="ident" id="7995006">file</span><br>
<span class="lineno"></span><span class="op" id="7995011">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="7995014">func</span>&nbsp;<span class="ident" id="7995019">BenchmarkPrint</span><span class="op" id="7995033">(</span><span class="ident" id="7995034">b</span>&nbsp;<span class="op" id="7995036">*</span><span class="ident" id="7995037">testing</span><span class="op" id="7995044">.</span><span class="ident" id="7995045">B</span><span class="op" id="7995046">)</span>&nbsp;<span class="op" id="7995048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995051">if</span>&nbsp;<span class="ident" id="7995054">testfile</span>&nbsp;<span class="op" id="7995063">==</span>&nbsp;<span class="ident" id="7995066">nil</span>&nbsp;<span class="op" id="7995070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995074">initialize</span><span class="op" id="7995084">(</span><span class="op" id="7995085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995088">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995091">for</span>&nbsp;<span class="ident" id="7995095">i</span>&nbsp;<span class="op" id="7995097">:=</span>&nbsp;<span class="num" id="7995100">0</span><span class="op" id="7995101">;</span>&nbsp;<span class="ident" id="7995103">i</span>&nbsp;<span class="op" id="7995105">&lt;</span>&nbsp;<span class="ident" id="7995107">b</span><span class="op" id="7995108">.</span><span class="ident" id="7995109">N</span><span class="op" id="7995110">;</span>&nbsp;<span class="ident" id="7995112">i</span><span class="op" id="7995113">++</span>&nbsp;<span class="op" id="7995116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995120">testprint</span><span class="op" id="7995129">(</span><span class="ident" id="7995130">ioutil</span><span class="op" id="7995136">.</span><span class="ident" id="7995137">Discard</span><span class="op" id="7995144">,</span>&nbsp;<span class="ident" id="7995146">testfile</span><span class="op" id="7995154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995157">}</span><br>
<span class="lineno"></span><span class="op" id="7995159">}</span>
</div>
</body>
</html>
