<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6775091">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6775146">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6775200">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6775251">package</span>&nbsp;<span class="ident" id="6775259">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6775264">import</span>&nbsp;<span class="op" id="6775271">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775274">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775281">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775287">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775300">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775311">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6775322">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6775329">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6775332">func</span>&nbsp;<span class="ident" id="6775337">isTimeout</span><span class="op" id="6775346">(</span><span class="ident" id="6775347">err</span>&nbsp;<span class="builtintype" id="6775351">error</span><span class="op" id="6775356">)</span>&nbsp;<span class="builtintype" id="6775358">bool</span>&nbsp;<span class="op" id="6775363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775366">e</span><span class="op" id="6775367">,</span>&nbsp;<span class="ident" id="6775369">ok</span>&nbsp;<span class="op" id="6775372">:=</span>&nbsp;<span class="ident" id="6775375">err</span><span class="op" id="6775378">.</span><span class="op" id="6775379">(</span><span class="ident" id="6775380">Error</span><span class="op" id="6775385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775388">return</span>&nbsp;<span class="ident" id="6775395">ok</span>&nbsp;<span class="op" id="6775398">&amp;&amp;</span>&nbsp;<span class="ident" id="6775401">e</span><span class="op" id="6775402">.</span><span class="ident" id="6775403">Timeout</span><span class="op" id="6775410">(</span><span class="op" id="6775411">)</span><br>
<span class="lineno"></span><span class="op" id="6775413">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6775416">type</span>&nbsp;<span class="ident" id="6775421">copyRes</span>&nbsp;<span class="keyword" id="6775429">struct</span>&nbsp;<span class="op" id="6775436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775439">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6775443">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775450">err</span>&nbsp;<span class="builtintype" id="6775454">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775461">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6775465">time</span><span class="op" id="6775469">.</span><span class="ident" id="6775470">Duration</span><br>
<span class="lineno">25</span><span class="op" id="6775479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6775482">func</span>&nbsp;<span class="ident" id="6775487">TestAcceptTimeout</span><span class="op" id="6775504">(</span><span class="ident" id="6775505">t</span>&nbsp;<span class="op" id="6775507">*</span><span class="ident" id="6775508">testing</span><span class="op" id="6775515">.</span><span class="ident" id="6775516">T</span><span class="op" id="6775517">)</span>&nbsp;<span class="op" id="6775519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775522">switch</span>&nbsp;<span class="ident" id="6775529">runtime</span><span class="op" id="6775536">.</span><span class="ident" id="6775537">GOOS</span>&nbsp;<span class="op" id="6775542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775545">case</span>&nbsp;<span class="string" id="6775550">&#34;plan9&#34;</span><span class="op" id="6775557">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775561">t</span><span class="op" id="6775562">.</span><span class="ident" id="6775563">Skipf</span><span class="op" id="6775568">(</span><span class="string" id="6775569">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6775590">,</span>&nbsp;<span class="ident" id="6775592">runtime</span><span class="op" id="6775599">.</span><span class="ident" id="6775600">GOOS</span><span class="op" id="6775604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775611">ln</span>&nbsp;<span class="op" id="6775614">:=</span>&nbsp;<span class="ident" id="6775617">newLocalListener</span><span class="op" id="6775633">(</span><span class="ident" id="6775634">t</span><span class="op" id="6775635">)</span><span class="op" id="6775636">.</span><span class="op" id="6775637">(</span><span class="op" id="6775638">*</span><span class="ident" id="6775639">TCPListener</span><span class="op" id="6775650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775653">defer</span>&nbsp;<span class="ident" id="6775659">ln</span><span class="op" id="6775661">.</span><span class="ident" id="6775662">Close</span><span class="op" id="6775667">(</span><span class="op" id="6775668">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775671">ln</span><span class="op" id="6775673">.</span><span class="ident" id="6775674">SetDeadline</span><span class="op" id="6775685">(</span><span class="ident" id="6775686">time</span><span class="op" id="6775690">.</span><span class="ident" id="6775691">Now</span><span class="op" id="6775694">(</span><span class="op" id="6775695">)</span><span class="op" id="6775696">.</span><span class="ident" id="6775697">Add</span><span class="op" id="6775700">(</span><span class="op" id="6775701">-</span><span class="num" id="6775702">1</span>&nbsp;<span class="op" id="6775704">*</span>&nbsp;<span class="ident" id="6775706">time</span><span class="op" id="6775710">.</span><span class="ident" id="6775711">Second</span><span class="op" id="6775717">)</span><span class="op" id="6775718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775721">if</span>&nbsp;<span class="ident" id="6775724">_</span><span class="op" id="6775725">,</span>&nbsp;<span class="ident" id="6775727">err</span>&nbsp;<span class="op" id="6775731">:=</span>&nbsp;<span class="ident" id="6775734">ln</span><span class="op" id="6775736">.</span><span class="ident" id="6775737">Accept</span><span class="op" id="6775743">(</span><span class="op" id="6775744">)</span><span class="op" id="6775745">;</span>&nbsp;<span class="op" id="6775747">!</span><span class="ident" id="6775748">isTimeout</span><span class="op" id="6775757">(</span><span class="ident" id="6775758">err</span><span class="op" id="6775761">)</span>&nbsp;<span class="op" id="6775763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775767">t</span><span class="op" id="6775768">.</span><span class="ident" id="6775769">Fatalf</span><span class="op" id="6775775">(</span><span class="string" id="6775776">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6775809">,</span>&nbsp;<span class="ident" id="6775811">errTimeout</span><span class="op" id="6775821">,</span>&nbsp;<span class="ident" id="6775823">err</span><span class="op" id="6775826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775832">if</span>&nbsp;<span class="ident" id="6775835">_</span><span class="op" id="6775836">,</span>&nbsp;<span class="ident" id="6775838">err</span>&nbsp;<span class="op" id="6775842">:=</span>&nbsp;<span class="ident" id="6775845">ln</span><span class="op" id="6775847">.</span><span class="ident" id="6775848">Accept</span><span class="op" id="6775854">(</span><span class="op" id="6775855">)</span><span class="op" id="6775856">;</span>&nbsp;<span class="op" id="6775858">!</span><span class="ident" id="6775859">isTimeout</span><span class="op" id="6775868">(</span><span class="ident" id="6775869">err</span><span class="op" id="6775872">)</span>&nbsp;<span class="op" id="6775874">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775878">t</span><span class="op" id="6775879">.</span><span class="ident" id="6775880">Fatalf</span><span class="op" id="6775886">(</span><span class="string" id="6775887">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6775920">,</span>&nbsp;<span class="ident" id="6775922">errTimeout</span><span class="op" id="6775932">,</span>&nbsp;<span class="ident" id="6775934">err</span><span class="op" id="6775937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775943">ln</span><span class="op" id="6775945">.</span><span class="ident" id="6775946">SetDeadline</span><span class="op" id="6775957">(</span><span class="ident" id="6775958">time</span><span class="op" id="6775962">.</span><span class="ident" id="6775963">Now</span><span class="op" id="6775966">(</span><span class="op" id="6775967">)</span><span class="op" id="6775968">.</span><span class="ident" id="6775969">Add</span><span class="op" id="6775972">(</span><span class="num" id="6775973">100</span>&nbsp;<span class="op" id="6775977">*</span>&nbsp;<span class="ident" id="6775979">time</span><span class="op" id="6775983">.</span><span class="ident" id="6775984">Millisecond</span><span class="op" id="6775995">)</span><span class="op" id="6775996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775999">if</span>&nbsp;<span class="ident" id="6776002">_</span><span class="op" id="6776003">,</span>&nbsp;<span class="ident" id="6776005">err</span>&nbsp;<span class="op" id="6776009">:=</span>&nbsp;<span class="ident" id="6776012">ln</span><span class="op" id="6776014">.</span><span class="ident" id="6776015">Accept</span><span class="op" id="6776021">(</span><span class="op" id="6776022">)</span><span class="op" id="6776023">;</span>&nbsp;<span class="op" id="6776025">!</span><span class="ident" id="6776026">isTimeout</span><span class="op" id="6776035">(</span><span class="ident" id="6776036">err</span><span class="op" id="6776039">)</span>&nbsp;<span class="op" id="6776041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776045">t</span><span class="op" id="6776046">.</span><span class="ident" id="6776047">Fatalf</span><span class="op" id="6776053">(</span><span class="string" id="6776054">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6776087">,</span>&nbsp;<span class="ident" id="6776089">errTimeout</span><span class="op" id="6776099">,</span>&nbsp;<span class="ident" id="6776101">err</span><span class="op" id="6776104">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776110">if</span>&nbsp;<span class="ident" id="6776113">_</span><span class="op" id="6776114">,</span>&nbsp;<span class="ident" id="6776116">err</span>&nbsp;<span class="op" id="6776120">:=</span>&nbsp;<span class="ident" id="6776123">ln</span><span class="op" id="6776125">.</span><span class="ident" id="6776126">Accept</span><span class="op" id="6776132">(</span><span class="op" id="6776133">)</span><span class="op" id="6776134">;</span>&nbsp;<span class="op" id="6776136">!</span><span class="ident" id="6776137">isTimeout</span><span class="op" id="6776146">(</span><span class="ident" id="6776147">err</span><span class="op" id="6776150">)</span>&nbsp;<span class="op" id="6776152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776156">t</span><span class="op" id="6776157">.</span><span class="ident" id="6776158">Fatalf</span><span class="op" id="6776164">(</span><span class="string" id="6776165">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6776198">,</span>&nbsp;<span class="ident" id="6776200">errTimeout</span><span class="op" id="6776210">,</span>&nbsp;<span class="ident" id="6776212">err</span><span class="op" id="6776215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776221">ln</span><span class="op" id="6776223">.</span><span class="ident" id="6776224">SetDeadline</span><span class="op" id="6776235">(</span><span class="ident" id="6776236">noDeadline</span><span class="op" id="6776246">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776249">errc</span>&nbsp;<span class="op" id="6776254">:=</span>&nbsp;<span class="builtinfunc" id="6776257">make</span><span class="op" id="6776261">(</span><span class="keyword" id="6776262">chan</span>&nbsp;<span class="builtintype" id="6776267">error</span><span class="op" id="6776272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776275">go</span>&nbsp;<span class="keyword" id="6776278">func</span><span class="op" id="6776282">(</span><span class="op" id="6776283">)</span>&nbsp;<span class="op" id="6776285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776289">_</span><span class="op" id="6776290">,</span>&nbsp;<span class="ident" id="6776292">err</span>&nbsp;<span class="op" id="6776296">:=</span>&nbsp;<span class="ident" id="6776299">ln</span><span class="op" id="6776301">.</span><span class="ident" id="6776302">Accept</span><span class="op" id="6776308">(</span><span class="op" id="6776309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776313">errc</span>&nbsp;<span class="op" id="6776318">&lt;-</span>&nbsp;<span class="ident" id="6776321">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776326">}</span><span class="op" id="6776327">(</span><span class="op" id="6776328">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776331">time</span><span class="op" id="6776335">.</span><span class="ident" id="6776336">Sleep</span><span class="op" id="6776341">(</span><span class="num" id="6776342">100</span>&nbsp;<span class="op" id="6776346">*</span>&nbsp;<span class="ident" id="6776348">time</span><span class="op" id="6776352">.</span><span class="ident" id="6776353">Millisecond</span><span class="op" id="6776364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776367">select</span>&nbsp;<span class="op" id="6776374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776377">case</span>&nbsp;<span class="ident" id="6776382">err</span>&nbsp;<span class="op" id="6776386">:=</span>&nbsp;<span class="op" id="6776389">&lt;-</span><span class="ident" id="6776391">errc</span><span class="op" id="6776395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776399">t</span><span class="op" id="6776400">.</span><span class="ident" id="6776401">Fatalf</span><span class="op" id="6776407">(</span><span class="string" id="6776408">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6776468">,</span>&nbsp;<span class="ident" id="6776470">err</span><span class="op" id="6776473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776476">default</span><span class="op" id="6776483">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776489">ln</span><span class="op" id="6776491">.</span><span class="ident" id="6776492">Close</span><span class="op" id="6776497">(</span><span class="op" id="6776498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776501">switch</span>&nbsp;<span class="ident" id="6776508">nerr</span>&nbsp;<span class="op" id="6776513">:=</span>&nbsp;<span class="op" id="6776516">&lt;-</span><span class="ident" id="6776518">errc</span><span class="op" id="6776522">;</span>&nbsp;<span class="ident" id="6776524">err</span>&nbsp;<span class="op" id="6776528">:=</span>&nbsp;<span class="ident" id="6776531">nerr</span><span class="op" id="6776535">.</span><span class="op" id="6776536">(</span><span class="keyword" id="6776537">type</span><span class="op" id="6776541">)</span>&nbsp;<span class="op" id="6776543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776546">case</span>&nbsp;<span class="op" id="6776551">*</span><span class="ident" id="6776552">OpError</span><span class="op" id="6776559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776563">if</span>&nbsp;<span class="ident" id="6776566">err</span><span class="op" id="6776569">.</span><span class="ident" id="6776570">Err</span>&nbsp;<span class="op" id="6776574">!=</span>&nbsp;<span class="ident" id="6776577">errClosing</span>&nbsp;<span class="op" id="6776588">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776593">t</span><span class="op" id="6776594">.</span><span class="ident" id="6776595">Fatalf</span><span class="op" id="6776601">(</span><span class="string" id="6776602">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6776635">,</span>&nbsp;<span class="ident" id="6776637">errClosing</span><span class="op" id="6776647">,</span>&nbsp;<span class="ident" id="6776649">err</span><span class="op" id="6776652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776659">default</span><span class="op" id="6776666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776670">if</span>&nbsp;<span class="ident" id="6776673">err</span>&nbsp;<span class="op" id="6776677">!=</span>&nbsp;<span class="ident" id="6776680">errClosing</span>&nbsp;<span class="op" id="6776691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776696">t</span><span class="op" id="6776697">.</span><span class="ident" id="6776698">Fatalf</span><span class="op" id="6776704">(</span><span class="string" id="6776705">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6776738">,</span>&nbsp;<span class="ident" id="6776740">errClosing</span><span class="op" id="6776750">,</span>&nbsp;<span class="ident" id="6776752">err</span><span class="op" id="6776755">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776762">}</span><br>
<span class="lineno"></span><span class="op" id="6776764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776767">func</span>&nbsp;<span class="ident" id="6776772">TestReadTimeout</span><span class="op" id="6776787">(</span><span class="ident" id="6776788">t</span>&nbsp;<span class="op" id="6776790">*</span><span class="ident" id="6776791">testing</span><span class="op" id="6776798">.</span><span class="ident" id="6776799">T</span><span class="op" id="6776800">)</span>&nbsp;<span class="op" id="6776802">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776805">switch</span>&nbsp;<span class="ident" id="6776812">runtime</span><span class="op" id="6776819">.</span><span class="ident" id="6776820">GOOS</span>&nbsp;<span class="op" id="6776825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776828">case</span>&nbsp;<span class="string" id="6776833">&#34;plan9&#34;</span><span class="op" id="6776840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776844">t</span><span class="op" id="6776845">.</span><span class="ident" id="6776846">Skipf</span><span class="op" id="6776851">(</span><span class="string" id="6776852">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6776873">,</span>&nbsp;<span class="ident" id="6776875">runtime</span><span class="op" id="6776882">.</span><span class="ident" id="6776883">GOOS</span><span class="op" id="6776887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776894">ln</span>&nbsp;<span class="op" id="6776897">:=</span>&nbsp;<span class="ident" id="6776900">newLocalListener</span><span class="op" id="6776916">(</span><span class="ident" id="6776917">t</span><span class="op" id="6776918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776921">defer</span>&nbsp;<span class="ident" id="6776927">ln</span><span class="op" id="6776929">.</span><span class="ident" id="6776930">Close</span><span class="op" id="6776935">(</span><span class="op" id="6776936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776939">c</span><span class="op" id="6776940">,</span>&nbsp;<span class="ident" id="6776942">err</span>&nbsp;<span class="op" id="6776946">:=</span>&nbsp;<span class="ident" id="6776949">DialTCP</span><span class="op" id="6776956">(</span><span class="string" id="6776957">&#34;tcp&#34;</span><span class="op" id="6776962">,</span>&nbsp;<span class="builtintype" id="6776964">nil</span><span class="op" id="6776967">,</span>&nbsp;<span class="ident" id="6776969">ln</span><span class="op" id="6776971">.</span><span class="ident" id="6776972">Addr</span><span class="op" id="6776976">(</span><span class="op" id="6776977">)</span><span class="op" id="6776978">.</span><span class="op" id="6776979">(</span><span class="op" id="6776980">*</span><span class="ident" id="6776981">TCPAddr</span><span class="op" id="6776988">)</span><span class="op" id="6776989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776992">if</span>&nbsp;<span class="ident" id="6776995">err</span>&nbsp;<span class="op" id="6776999">!=</span>&nbsp;<span class="builtintype" id="6777002">nil</span>&nbsp;<span class="op" id="6777006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777010">t</span><span class="op" id="6777011">.</span><span class="ident" id="6777012">Fatalf</span><span class="op" id="6777018">(</span><span class="string" id="6777019">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6777032">,</span>&nbsp;<span class="ident" id="6777034">err</span><span class="op" id="6777037">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777043">defer</span>&nbsp;<span class="ident" id="6777049">c</span><span class="op" id="6777050">.</span><span class="ident" id="6777051">Close</span><span class="op" id="6777056">(</span><span class="op" id="6777057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777060">c</span><span class="op" id="6777061">.</span><span class="ident" id="6777062">SetDeadline</span><span class="op" id="6777073">(</span><span class="ident" id="6777074">time</span><span class="op" id="6777078">.</span><span class="ident" id="6777079">Now</span><span class="op" id="6777082">(</span><span class="op" id="6777083">)</span><span class="op" id="6777084">.</span><span class="ident" id="6777085">Add</span><span class="op" id="6777088">(</span><span class="ident" id="6777089">time</span><span class="op" id="6777093">.</span><span class="ident" id="6777094">Hour</span><span class="op" id="6777098">)</span><span class="op" id="6777099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777102">c</span><span class="op" id="6777103">.</span><span class="ident" id="6777104">SetReadDeadline</span><span class="op" id="6777119">(</span><span class="ident" id="6777120">time</span><span class="op" id="6777124">.</span><span class="ident" id="6777125">Now</span><span class="op" id="6777128">(</span><span class="op" id="6777129">)</span><span class="op" id="6777130">.</span><span class="ident" id="6777131">Add</span><span class="op" id="6777134">(</span><span class="op" id="6777135">-</span><span class="num" id="6777136">1</span>&nbsp;<span class="op" id="6777138">*</span>&nbsp;<span class="ident" id="6777140">time</span><span class="op" id="6777144">.</span><span class="ident" id="6777145">Second</span><span class="op" id="6777151">)</span><span class="op" id="6777152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777155">buf</span>&nbsp;<span class="op" id="6777159">:=</span>&nbsp;<span class="builtinfunc" id="6777162">make</span><span class="op" id="6777166">(</span><span class="op" id="6777167">[</span><span class="op" id="6777168">]</span><span class="builtintype" id="6777169">byte</span><span class="op" id="6777173">,</span>&nbsp;<span class="num" id="6777175">1</span><span class="op" id="6777176">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777179">if</span>&nbsp;<span class="ident" id="6777182">_</span><span class="op" id="6777183">,</span>&nbsp;<span class="ident" id="6777185">err</span>&nbsp;<span class="op" id="6777189">=</span>&nbsp;<span class="ident" id="6777191">c</span><span class="op" id="6777192">.</span><span class="ident" id="6777193">Read</span><span class="op" id="6777197">(</span><span class="ident" id="6777198">buf</span><span class="op" id="6777201">)</span><span class="op" id="6777202">;</span>&nbsp;<span class="op" id="6777204">!</span><span class="ident" id="6777205">isTimeout</span><span class="op" id="6777214">(</span><span class="ident" id="6777215">err</span><span class="op" id="6777218">)</span>&nbsp;<span class="op" id="6777220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777224">t</span><span class="op" id="6777225">.</span><span class="ident" id="6777226">Fatalf</span><span class="op" id="6777232">(</span><span class="string" id="6777233">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6777264">,</span>&nbsp;<span class="ident" id="6777266">errTimeout</span><span class="op" id="6777276">,</span>&nbsp;<span class="ident" id="6777278">err</span><span class="op" id="6777281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777287">if</span>&nbsp;<span class="ident" id="6777290">_</span><span class="op" id="6777291">,</span>&nbsp;<span class="ident" id="6777293">err</span>&nbsp;<span class="op" id="6777297">=</span>&nbsp;<span class="ident" id="6777299">c</span><span class="op" id="6777300">.</span><span class="ident" id="6777301">Read</span><span class="op" id="6777305">(</span><span class="ident" id="6777306">buf</span><span class="op" id="6777309">)</span><span class="op" id="6777310">;</span>&nbsp;<span class="op" id="6777312">!</span><span class="ident" id="6777313">isTimeout</span><span class="op" id="6777322">(</span><span class="ident" id="6777323">err</span><span class="op" id="6777326">)</span>&nbsp;<span class="op" id="6777328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777332">t</span><span class="op" id="6777333">.</span><span class="ident" id="6777334">Fatalf</span><span class="op" id="6777340">(</span><span class="string" id="6777341">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6777372">,</span>&nbsp;<span class="ident" id="6777374">errTimeout</span><span class="op" id="6777384">,</span>&nbsp;<span class="ident" id="6777386">err</span><span class="op" id="6777389">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777395">c</span><span class="op" id="6777396">.</span><span class="ident" id="6777397">SetDeadline</span><span class="op" id="6777408">(</span><span class="ident" id="6777409">time</span><span class="op" id="6777413">.</span><span class="ident" id="6777414">Now</span><span class="op" id="6777417">(</span><span class="op" id="6777418">)</span><span class="op" id="6777419">.</span><span class="ident" id="6777420">Add</span><span class="op" id="6777423">(</span><span class="num" id="6777424">100</span>&nbsp;<span class="op" id="6777428">*</span>&nbsp;<span class="ident" id="6777430">time</span><span class="op" id="6777434">.</span><span class="ident" id="6777435">Millisecond</span><span class="op" id="6777446">)</span><span class="op" id="6777447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777450">if</span>&nbsp;<span class="ident" id="6777453">_</span><span class="op" id="6777454">,</span>&nbsp;<span class="ident" id="6777456">err</span>&nbsp;<span class="op" id="6777460">=</span>&nbsp;<span class="ident" id="6777462">c</span><span class="op" id="6777463">.</span><span class="ident" id="6777464">Read</span><span class="op" id="6777468">(</span><span class="ident" id="6777469">buf</span><span class="op" id="6777472">)</span><span class="op" id="6777473">;</span>&nbsp;<span class="op" id="6777475">!</span><span class="ident" id="6777476">isTimeout</span><span class="op" id="6777485">(</span><span class="ident" id="6777486">err</span><span class="op" id="6777489">)</span>&nbsp;<span class="op" id="6777491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777495">t</span><span class="op" id="6777496">.</span><span class="ident" id="6777497">Fatalf</span><span class="op" id="6777503">(</span><span class="string" id="6777504">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6777535">,</span>&nbsp;<span class="ident" id="6777537">errTimeout</span><span class="op" id="6777547">,</span>&nbsp;<span class="ident" id="6777549">err</span><span class="op" id="6777552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777555">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777558">if</span>&nbsp;<span class="ident" id="6777561">_</span><span class="op" id="6777562">,</span>&nbsp;<span class="ident" id="6777564">err</span>&nbsp;<span class="op" id="6777568">=</span>&nbsp;<span class="ident" id="6777570">c</span><span class="op" id="6777571">.</span><span class="ident" id="6777572">Read</span><span class="op" id="6777576">(</span><span class="ident" id="6777577">buf</span><span class="op" id="6777580">)</span><span class="op" id="6777581">;</span>&nbsp;<span class="op" id="6777583">!</span><span class="ident" id="6777584">isTimeout</span><span class="op" id="6777593">(</span><span class="ident" id="6777594">err</span><span class="op" id="6777597">)</span>&nbsp;<span class="op" id="6777599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777603">t</span><span class="op" id="6777604">.</span><span class="ident" id="6777605">Fatalf</span><span class="op" id="6777611">(</span><span class="string" id="6777612">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6777643">,</span>&nbsp;<span class="ident" id="6777645">errTimeout</span><span class="op" id="6777655">,</span>&nbsp;<span class="ident" id="6777657">err</span><span class="op" id="6777660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777666">c</span><span class="op" id="6777667">.</span><span class="ident" id="6777668">SetReadDeadline</span><span class="op" id="6777683">(</span><span class="ident" id="6777684">noDeadline</span><span class="op" id="6777694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777697">c</span><span class="op" id="6777698">.</span><span class="ident" id="6777699">SetWriteDeadline</span><span class="op" id="6777715">(</span><span class="ident" id="6777716">time</span><span class="op" id="6777720">.</span><span class="ident" id="6777721">Now</span><span class="op" id="6777724">(</span><span class="op" id="6777725">)</span><span class="op" id="6777726">.</span><span class="ident" id="6777727">Add</span><span class="op" id="6777730">(</span><span class="op" id="6777731">-</span><span class="num" id="6777732">1</span>&nbsp;<span class="op" id="6777734">*</span>&nbsp;<span class="ident" id="6777736">time</span><span class="op" id="6777740">.</span><span class="ident" id="6777741">Second</span><span class="op" id="6777747">)</span><span class="op" id="6777748">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777751">errc</span>&nbsp;<span class="op" id="6777756">:=</span>&nbsp;<span class="builtinfunc" id="6777759">make</span><span class="op" id="6777763">(</span><span class="keyword" id="6777764">chan</span>&nbsp;<span class="builtintype" id="6777769">error</span><span class="op" id="6777774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777777">go</span>&nbsp;<span class="keyword" id="6777780">func</span><span class="op" id="6777784">(</span><span class="op" id="6777785">)</span>&nbsp;<span class="op" id="6777787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777791">_</span><span class="op" id="6777792">,</span>&nbsp;<span class="ident" id="6777794">err</span>&nbsp;<span class="op" id="6777798">:=</span>&nbsp;<span class="ident" id="6777801">c</span><span class="op" id="6777802">.</span><span class="ident" id="6777803">Read</span><span class="op" id="6777807">(</span><span class="ident" id="6777808">buf</span><span class="op" id="6777811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777815">errc</span>&nbsp;<span class="op" id="6777820">&lt;-</span>&nbsp;<span class="ident" id="6777823">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777828">}</span><span class="op" id="6777829">(</span><span class="op" id="6777830">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777833">time</span><span class="op" id="6777837">.</span><span class="ident" id="6777838">Sleep</span><span class="op" id="6777843">(</span><span class="num" id="6777844">100</span>&nbsp;<span class="op" id="6777848">*</span>&nbsp;<span class="ident" id="6777850">time</span><span class="op" id="6777854">.</span><span class="ident" id="6777855">Millisecond</span><span class="op" id="6777866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777869">select</span>&nbsp;<span class="op" id="6777876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777879">case</span>&nbsp;<span class="ident" id="6777884">err</span>&nbsp;<span class="op" id="6777888">:=</span>&nbsp;<span class="op" id="6777891">&lt;-</span><span class="ident" id="6777893">errc</span><span class="op" id="6777897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777901">t</span><span class="op" id="6777902">.</span><span class="ident" id="6777903">Fatalf</span><span class="op" id="6777909">(</span><span class="string" id="6777910">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6777968">,</span>&nbsp;<span class="ident" id="6777970">err</span><span class="op" id="6777973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777976">default</span><span class="op" id="6777983">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777989">c</span><span class="op" id="6777990">.</span><span class="ident" id="6777991">Close</span><span class="op" id="6777996">(</span><span class="op" id="6777997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778000">switch</span>&nbsp;<span class="ident" id="6778007">nerr</span>&nbsp;<span class="op" id="6778012">:=</span>&nbsp;<span class="op" id="6778015">&lt;-</span><span class="ident" id="6778017">errc</span><span class="op" id="6778021">;</span>&nbsp;<span class="ident" id="6778023">err</span>&nbsp;<span class="op" id="6778027">:=</span>&nbsp;<span class="ident" id="6778030">nerr</span><span class="op" id="6778034">.</span><span class="op" id="6778035">(</span><span class="keyword" id="6778036">type</span><span class="op" id="6778040">)</span>&nbsp;<span class="op" id="6778042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778045">case</span>&nbsp;<span class="op" id="6778050">*</span><span class="ident" id="6778051">OpError</span><span class="op" id="6778058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778062">if</span>&nbsp;<span class="ident" id="6778065">err</span><span class="op" id="6778068">.</span><span class="ident" id="6778069">Err</span>&nbsp;<span class="op" id="6778073">!=</span>&nbsp;<span class="ident" id="6778076">errClosing</span>&nbsp;<span class="op" id="6778087">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778092">t</span><span class="op" id="6778093">.</span><span class="ident" id="6778094">Fatalf</span><span class="op" id="6778100">(</span><span class="string" id="6778101">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6778132">,</span>&nbsp;<span class="ident" id="6778134">errClosing</span><span class="op" id="6778144">,</span>&nbsp;<span class="ident" id="6778146">err</span><span class="op" id="6778149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778156">default</span><span class="op" id="6778163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778167">if</span>&nbsp;<span class="ident" id="6778170">err</span>&nbsp;<span class="op" id="6778174">==</span>&nbsp;<span class="ident" id="6778177">io</span><span class="op" id="6778179">.</span><span class="ident" id="6778180">EOF</span>&nbsp;<span class="op" id="6778184">&amp;&amp;</span>&nbsp;<span class="ident" id="6778187">runtime</span><span class="op" id="6778194">.</span><span class="ident" id="6778195">GOOS</span>&nbsp;<span class="op" id="6778200">==</span>&nbsp;<span class="string" id="6778203">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6778210">{</span>&nbsp;<span class="comment" id="6778212">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778254">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778266">if</span>&nbsp;<span class="ident" id="6778269">err</span>&nbsp;<span class="op" id="6778273">!=</span>&nbsp;<span class="ident" id="6778276">errClosing</span>&nbsp;<span class="op" id="6778287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778292">t</span><span class="op" id="6778293">.</span><span class="ident" id="6778294">Fatalf</span><span class="op" id="6778300">(</span><span class="string" id="6778301">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6778332">,</span>&nbsp;<span class="ident" id="6778334">errClosing</span><span class="op" id="6778344">,</span>&nbsp;<span class="ident" id="6778346">err</span><span class="op" id="6778349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778356">}</span><br>
<span class="lineno">130</span><span class="op" id="6778358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6778361">func</span>&nbsp;<span class="ident" id="6778366">TestWriteTimeout</span><span class="op" id="6778382">(</span><span class="ident" id="6778383">t</span>&nbsp;<span class="op" id="6778385">*</span><span class="ident" id="6778386">testing</span><span class="op" id="6778393">.</span><span class="ident" id="6778394">T</span><span class="op" id="6778395">)</span>&nbsp;<span class="op" id="6778397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778400">switch</span>&nbsp;<span class="ident" id="6778407">runtime</span><span class="op" id="6778414">.</span><span class="ident" id="6778415">GOOS</span>&nbsp;<span class="op" id="6778420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778423">case</span>&nbsp;<span class="string" id="6778428">&#34;plan9&#34;</span><span class="op" id="6778435">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778439">t</span><span class="op" id="6778440">.</span><span class="ident" id="6778441">Skipf</span><span class="op" id="6778446">(</span><span class="string" id="6778447">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6778468">,</span>&nbsp;<span class="ident" id="6778470">runtime</span><span class="op" id="6778477">.</span><span class="ident" id="6778478">GOOS</span><span class="op" id="6778482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778489">ln</span>&nbsp;<span class="op" id="6778492">:=</span>&nbsp;<span class="ident" id="6778495">newLocalListener</span><span class="op" id="6778511">(</span><span class="ident" id="6778512">t</span><span class="op" id="6778513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778516">defer</span>&nbsp;<span class="ident" id="6778522">ln</span><span class="op" id="6778524">.</span><span class="ident" id="6778525">Close</span><span class="op" id="6778530">(</span><span class="op" id="6778531">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778534">c</span><span class="op" id="6778535">,</span>&nbsp;<span class="ident" id="6778537">err</span>&nbsp;<span class="op" id="6778541">:=</span>&nbsp;<span class="ident" id="6778544">DialTCP</span><span class="op" id="6778551">(</span><span class="string" id="6778552">&#34;tcp&#34;</span><span class="op" id="6778557">,</span>&nbsp;<span class="builtintype" id="6778559">nil</span><span class="op" id="6778562">,</span>&nbsp;<span class="ident" id="6778564">ln</span><span class="op" id="6778566">.</span><span class="ident" id="6778567">Addr</span><span class="op" id="6778571">(</span><span class="op" id="6778572">)</span><span class="op" id="6778573">.</span><span class="op" id="6778574">(</span><span class="op" id="6778575">*</span><span class="ident" id="6778576">TCPAddr</span><span class="op" id="6778583">)</span><span class="op" id="6778584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778587">if</span>&nbsp;<span class="ident" id="6778590">err</span>&nbsp;<span class="op" id="6778594">!=</span>&nbsp;<span class="builtintype" id="6778597">nil</span>&nbsp;<span class="op" id="6778601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778605">t</span><span class="op" id="6778606">.</span><span class="ident" id="6778607">Fatalf</span><span class="op" id="6778613">(</span><span class="string" id="6778614">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6778627">,</span>&nbsp;<span class="ident" id="6778629">err</span><span class="op" id="6778632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778638">defer</span>&nbsp;<span class="ident" id="6778644">c</span><span class="op" id="6778645">.</span><span class="ident" id="6778646">Close</span><span class="op" id="6778651">(</span><span class="op" id="6778652">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778655">c</span><span class="op" id="6778656">.</span><span class="ident" id="6778657">SetDeadline</span><span class="op" id="6778668">(</span><span class="ident" id="6778669">time</span><span class="op" id="6778673">.</span><span class="ident" id="6778674">Now</span><span class="op" id="6778677">(</span><span class="op" id="6778678">)</span><span class="op" id="6778679">.</span><span class="ident" id="6778680">Add</span><span class="op" id="6778683">(</span><span class="ident" id="6778684">time</span><span class="op" id="6778688">.</span><span class="ident" id="6778689">Hour</span><span class="op" id="6778693">)</span><span class="op" id="6778694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778697">c</span><span class="op" id="6778698">.</span><span class="ident" id="6778699">SetWriteDeadline</span><span class="op" id="6778715">(</span><span class="ident" id="6778716">time</span><span class="op" id="6778720">.</span><span class="ident" id="6778721">Now</span><span class="op" id="6778724">(</span><span class="op" id="6778725">)</span><span class="op" id="6778726">.</span><span class="ident" id="6778727">Add</span><span class="op" id="6778730">(</span><span class="op" id="6778731">-</span><span class="num" id="6778732">1</span>&nbsp;<span class="op" id="6778734">*</span>&nbsp;<span class="ident" id="6778736">time</span><span class="op" id="6778740">.</span><span class="ident" id="6778741">Second</span><span class="op" id="6778747">)</span><span class="op" id="6778748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778751">buf</span>&nbsp;<span class="op" id="6778755">:=</span>&nbsp;<span class="builtinfunc" id="6778758">make</span><span class="op" id="6778762">(</span><span class="op" id="6778763">[</span><span class="op" id="6778764">]</span><span class="builtintype" id="6778765">byte</span><span class="op" id="6778769">,</span>&nbsp;<span class="num" id="6778771">4096</span><span class="op" id="6778775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778778">writeUntilTimeout</span>&nbsp;<span class="op" id="6778796">:=</span>&nbsp;<span class="keyword" id="6778799">func</span><span class="op" id="6778803">(</span><span class="op" id="6778804">)</span>&nbsp;<span class="op" id="6778806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778810">for</span>&nbsp;<span class="op" id="6778814">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778819">_</span><span class="op" id="6778820">,</span>&nbsp;<span class="ident" id="6778822">err</span>&nbsp;<span class="op" id="6778826">:=</span>&nbsp;<span class="ident" id="6778829">c</span><span class="op" id="6778830">.</span><span class="ident" id="6778831">Write</span><span class="op" id="6778836">(</span><span class="ident" id="6778837">buf</span><span class="op" id="6778840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778845">if</span>&nbsp;<span class="ident" id="6778848">err</span>&nbsp;<span class="op" id="6778852">!=</span>&nbsp;<span class="builtintype" id="6778855">nil</span>&nbsp;<span class="op" id="6778859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778865">if</span>&nbsp;<span class="ident" id="6778868">isTimeout</span><span class="op" id="6778877">(</span><span class="ident" id="6778878">err</span><span class="op" id="6778881">)</span>&nbsp;<span class="op" id="6778883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6778890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778901">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778907">t</span><span class="op" id="6778908">.</span><span class="ident" id="6778909">Fatalf</span><span class="op" id="6778915">(</span><span class="string" id="6778916">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6778948">,</span>&nbsp;<span class="ident" id="6778950">errTimeout</span><span class="op" id="6778960">,</span>&nbsp;<span class="ident" id="6778962">err</span><span class="op" id="6778965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6778977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6778980">writeUntilTimeout</span><span class="op" id="6778997">(</span><span class="op" id="6778998">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779001">c</span><span class="op" id="6779002">.</span><span class="ident" id="6779003">SetDeadline</span><span class="op" id="6779014">(</span><span class="ident" id="6779015">time</span><span class="op" id="6779019">.</span><span class="ident" id="6779020">Now</span><span class="op" id="6779023">(</span><span class="op" id="6779024">)</span><span class="op" id="6779025">.</span><span class="ident" id="6779026">Add</span><span class="op" id="6779029">(</span><span class="num" id="6779030">10</span>&nbsp;<span class="op" id="6779033">*</span>&nbsp;<span class="ident" id="6779035">time</span><span class="op" id="6779039">.</span><span class="ident" id="6779040">Millisecond</span><span class="op" id="6779051">)</span><span class="op" id="6779052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779055">writeUntilTimeout</span><span class="op" id="6779072">(</span><span class="op" id="6779073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779076">writeUntilTimeout</span><span class="op" id="6779093">(</span><span class="op" id="6779094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779097">c</span><span class="op" id="6779098">.</span><span class="ident" id="6779099">SetWriteDeadline</span><span class="op" id="6779115">(</span><span class="ident" id="6779116">noDeadline</span><span class="op" id="6779126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779129">c</span><span class="op" id="6779130">.</span><span class="ident" id="6779131">SetReadDeadline</span><span class="op" id="6779146">(</span><span class="ident" id="6779147">time</span><span class="op" id="6779151">.</span><span class="ident" id="6779152">Now</span><span class="op" id="6779155">(</span><span class="op" id="6779156">)</span><span class="op" id="6779157">.</span><span class="ident" id="6779158">Add</span><span class="op" id="6779161">(</span><span class="op" id="6779162">-</span><span class="num" id="6779163">1</span>&nbsp;<span class="op" id="6779165">*</span>&nbsp;<span class="ident" id="6779167">time</span><span class="op" id="6779171">.</span><span class="ident" id="6779172">Second</span><span class="op" id="6779178">)</span><span class="op" id="6779179">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779182">errc</span>&nbsp;<span class="op" id="6779187">:=</span>&nbsp;<span class="builtinfunc" id="6779190">make</span><span class="op" id="6779194">(</span><span class="keyword" id="6779195">chan</span>&nbsp;<span class="builtintype" id="6779200">error</span><span class="op" id="6779205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779208">go</span>&nbsp;<span class="keyword" id="6779211">func</span><span class="op" id="6779215">(</span><span class="op" id="6779216">)</span>&nbsp;<span class="op" id="6779218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779222">for</span>&nbsp;<span class="op" id="6779226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779231">_</span><span class="op" id="6779232">,</span>&nbsp;<span class="ident" id="6779234">err</span>&nbsp;<span class="op" id="6779238">:=</span>&nbsp;<span class="ident" id="6779241">c</span><span class="op" id="6779242">.</span><span class="ident" id="6779243">Write</span><span class="op" id="6779248">(</span><span class="ident" id="6779249">buf</span><span class="op" id="6779252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779257">if</span>&nbsp;<span class="ident" id="6779260">err</span>&nbsp;<span class="op" id="6779264">!=</span>&nbsp;<span class="builtintype" id="6779267">nil</span>&nbsp;<span class="op" id="6779271">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779277">errc</span>&nbsp;<span class="op" id="6779282">&lt;-</span>&nbsp;<span class="ident" id="6779285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779299">}</span><span class="op" id="6779300">(</span><span class="op" id="6779301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779304">time</span><span class="op" id="6779308">.</span><span class="ident" id="6779309">Sleep</span><span class="op" id="6779314">(</span><span class="num" id="6779315">100</span>&nbsp;<span class="op" id="6779319">*</span>&nbsp;<span class="ident" id="6779321">time</span><span class="op" id="6779325">.</span><span class="ident" id="6779326">Millisecond</span><span class="op" id="6779337">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779340">select</span>&nbsp;<span class="op" id="6779347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779350">case</span>&nbsp;<span class="ident" id="6779355">err</span>&nbsp;<span class="op" id="6779359">:=</span>&nbsp;<span class="op" id="6779362">&lt;-</span><span class="ident" id="6779364">errc</span><span class="op" id="6779368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779372">t</span><span class="op" id="6779373">.</span><span class="ident" id="6779374">Fatalf</span><span class="op" id="6779380">(</span><span class="string" id="6779381">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6779440">,</span>&nbsp;<span class="ident" id="6779442">err</span><span class="op" id="6779445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779448">default</span><span class="op" id="6779455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779458">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779461">c</span><span class="op" id="6779462">.</span><span class="ident" id="6779463">Close</span><span class="op" id="6779468">(</span><span class="op" id="6779469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779472">switch</span>&nbsp;<span class="ident" id="6779479">nerr</span>&nbsp;<span class="op" id="6779484">:=</span>&nbsp;<span class="op" id="6779487">&lt;-</span><span class="ident" id="6779489">errc</span><span class="op" id="6779493">;</span>&nbsp;<span class="ident" id="6779495">err</span>&nbsp;<span class="op" id="6779499">:=</span>&nbsp;<span class="ident" id="6779502">nerr</span><span class="op" id="6779506">.</span><span class="op" id="6779507">(</span><span class="keyword" id="6779508">type</span><span class="op" id="6779512">)</span>&nbsp;<span class="op" id="6779514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779517">case</span>&nbsp;<span class="op" id="6779522">*</span><span class="ident" id="6779523">OpError</span><span class="op" id="6779530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779534">if</span>&nbsp;<span class="ident" id="6779537">err</span><span class="op" id="6779540">.</span><span class="ident" id="6779541">Err</span>&nbsp;<span class="op" id="6779545">!=</span>&nbsp;<span class="ident" id="6779548">errClosing</span>&nbsp;<span class="op" id="6779559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779564">t</span><span class="op" id="6779565">.</span><span class="ident" id="6779566">Fatalf</span><span class="op" id="6779572">(</span><span class="string" id="6779573">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6779605">,</span>&nbsp;<span class="ident" id="6779607">errClosing</span><span class="op" id="6779617">,</span>&nbsp;<span class="ident" id="6779619">err</span><span class="op" id="6779622">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779629">default</span><span class="op" id="6779636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779640">if</span>&nbsp;<span class="ident" id="6779643">err</span>&nbsp;<span class="op" id="6779647">!=</span>&nbsp;<span class="ident" id="6779650">errClosing</span>&nbsp;<span class="op" id="6779661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779666">t</span><span class="op" id="6779667">.</span><span class="ident" id="6779668">Fatalf</span><span class="op" id="6779674">(</span><span class="string" id="6779675">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6779707">,</span>&nbsp;<span class="ident" id="6779709">errClosing</span><span class="op" id="6779719">,</span>&nbsp;<span class="ident" id="6779721">err</span><span class="op" id="6779724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779728">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779731">}</span><br>
<span class="lineno"></span><span class="op" id="6779733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6779736">func</span>&nbsp;<span class="ident" id="6779741">testTimeout</span><span class="op" id="6779752">(</span><span class="ident" id="6779753">t</span>&nbsp;<span class="op" id="6779755">*</span><span class="ident" id="6779756">testing</span><span class="op" id="6779763">.</span><span class="ident" id="6779764">T</span><span class="op" id="6779765">,</span>&nbsp;<span class="ident" id="6779767">net</span><span class="op" id="6779770">,</span>&nbsp;<span class="ident" id="6779772">addr</span>&nbsp;<span class="builtintype" id="6779777">string</span><span class="op" id="6779783">,</span>&nbsp;<span class="ident" id="6779785">readFrom</span>&nbsp;<span class="builtintype" id="6779794">bool</span><span class="op" id="6779798">)</span>&nbsp;<span class="op" id="6779800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779803">c</span><span class="op" id="6779804">,</span>&nbsp;<span class="ident" id="6779806">err</span>&nbsp;<span class="op" id="6779810">:=</span>&nbsp;<span class="ident" id="6779813">Dial</span><span class="op" id="6779817">(</span><span class="ident" id="6779818">net</span><span class="op" id="6779821">,</span>&nbsp;<span class="ident" id="6779823">addr</span><span class="op" id="6779827">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779830">if</span>&nbsp;<span class="ident" id="6779833">err</span>&nbsp;<span class="op" id="6779837">!=</span>&nbsp;<span class="builtintype" id="6779840">nil</span>&nbsp;<span class="op" id="6779844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779848">t</span><span class="op" id="6779849">.</span><span class="ident" id="6779850">Errorf</span><span class="op" id="6779856">(</span><span class="string" id="6779857">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6779882">,</span>&nbsp;<span class="ident" id="6779884">net</span><span class="op" id="6779887">,</span>&nbsp;<span class="ident" id="6779889">addr</span><span class="op" id="6779893">,</span>&nbsp;<span class="ident" id="6779895">err</span><span class="op" id="6779898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779902">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779913">defer</span>&nbsp;<span class="ident" id="6779919">c</span><span class="op" id="6779920">.</span><span class="ident" id="6779921">Close</span><span class="op" id="6779926">(</span><span class="op" id="6779927">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779930">what</span>&nbsp;<span class="op" id="6779935">:=</span>&nbsp;<span class="string" id="6779938">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6779946">if</span>&nbsp;<span class="ident" id="6779949">readFrom</span>&nbsp;<span class="op" id="6779958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779962">what</span>&nbsp;<span class="op" id="6779967">=</span>&nbsp;<span class="string" id="6779969">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6779985">errc</span>&nbsp;<span class="op" id="6779990">:=</span>&nbsp;<span class="builtinfunc" id="6779993">make</span><span class="op" id="6779997">(</span><span class="keyword" id="6779998">chan</span>&nbsp;<span class="builtintype" id="6780003">error</span><span class="op" id="6780008">,</span>&nbsp;<span class="num" id="6780010">1</span><span class="op" id="6780011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780014">go</span>&nbsp;<span class="keyword" id="6780017">func</span><span class="op" id="6780021">(</span><span class="op" id="6780022">)</span>&nbsp;<span class="op" id="6780024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780028">t0</span>&nbsp;<span class="op" id="6780031">:=</span>&nbsp;<span class="ident" id="6780034">time</span><span class="op" id="6780038">.</span><span class="ident" id="6780039">Now</span><span class="op" id="6780042">(</span><span class="op" id="6780043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780047">c</span><span class="op" id="6780048">.</span><span class="ident" id="6780049">SetReadDeadline</span><span class="op" id="6780064">(</span><span class="ident" id="6780065">time</span><span class="op" id="6780069">.</span><span class="ident" id="6780070">Now</span><span class="op" id="6780073">(</span><span class="op" id="6780074">)</span><span class="op" id="6780075">.</span><span class="ident" id="6780076">Add</span><span class="op" id="6780079">(</span><span class="num" id="6780080">100</span>&nbsp;<span class="op" id="6780084">*</span>&nbsp;<span class="ident" id="6780086">time</span><span class="op" id="6780090">.</span><span class="ident" id="6780091">Millisecond</span><span class="op" id="6780102">)</span><span class="op" id="6780103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780107">var</span>&nbsp;<span class="ident" id="6780111">b</span>&nbsp;<span class="op" id="6780113">[</span><span class="num" id="6780114">100</span><span class="op" id="6780117">]</span><span class="builtintype" id="6780118">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780125">var</span>&nbsp;<span class="ident" id="6780129">n</span>&nbsp;<span class="builtintype" id="6780131">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780137">var</span>&nbsp;<span class="ident" id="6780141">err</span>&nbsp;<span class="builtintype" id="6780145">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780153">if</span>&nbsp;<span class="ident" id="6780156">readFrom</span>&nbsp;<span class="op" id="6780165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780170">n</span><span class="op" id="6780171">,</span>&nbsp;<span class="ident" id="6780173">_</span><span class="op" id="6780174">,</span>&nbsp;<span class="ident" id="6780176">err</span>&nbsp;<span class="op" id="6780180">=</span>&nbsp;<span class="ident" id="6780182">c</span><span class="op" id="6780183">.</span><span class="op" id="6780184">(</span><span class="ident" id="6780185">PacketConn</span><span class="op" id="6780195">)</span><span class="op" id="6780196">.</span><span class="ident" id="6780197">ReadFrom</span><span class="op" id="6780205">(</span><span class="ident" id="6780206">b</span><span class="op" id="6780207">[</span><span class="num" id="6780208">0</span><span class="op" id="6780209">:</span><span class="op" id="6780210">]</span><span class="op" id="6780211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780215">}</span>&nbsp;<span class="keyword" id="6780217">else</span>&nbsp;<span class="op" id="6780222">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780227">n</span><span class="op" id="6780228">,</span>&nbsp;<span class="ident" id="6780230">err</span>&nbsp;<span class="op" id="6780234">=</span>&nbsp;<span class="ident" id="6780236">c</span><span class="op" id="6780237">.</span><span class="ident" id="6780238">Read</span><span class="op" id="6780242">(</span><span class="ident" id="6780243">b</span><span class="op" id="6780244">[</span><span class="num" id="6780245">0</span><span class="op" id="6780246">:</span><span class="op" id="6780247">]</span><span class="op" id="6780248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780256">t1</span>&nbsp;<span class="op" id="6780259">:=</span>&nbsp;<span class="ident" id="6780262">time</span><span class="op" id="6780266">.</span><span class="ident" id="6780267">Now</span><span class="op" id="6780270">(</span><span class="op" id="6780271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780275">if</span>&nbsp;<span class="ident" id="6780278">n</span>&nbsp;<span class="op" id="6780280">!=</span>&nbsp;<span class="num" id="6780283">0</span>&nbsp;<span class="op" id="6780285">||</span>&nbsp;<span class="ident" id="6780288">err</span>&nbsp;<span class="op" id="6780292">==</span>&nbsp;<span class="builtintype" id="6780295">nil</span>&nbsp;<span class="op" id="6780299">||</span>&nbsp;<span class="op" id="6780302">!</span><span class="ident" id="6780303">err</span><span class="op" id="6780306">.</span><span class="op" id="6780307">(</span><span class="ident" id="6780308">Error</span><span class="op" id="6780313">)</span><span class="op" id="6780314">.</span><span class="ident" id="6780315">Timeout</span><span class="op" id="6780322">(</span><span class="op" id="6780323">)</span>&nbsp;<span class="op" id="6780325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780330">errc</span>&nbsp;<span class="op" id="6780335">&lt;-</span>&nbsp;<span class="ident" id="6780338">fmt</span><span class="op" id="6780341">.</span><span class="ident" id="6780342">Errorf</span><span class="op" id="6780348">(</span><span class="string" id="6780349">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6780395">,</span>&nbsp;<span class="ident" id="6780397">what</span><span class="op" id="6780401">,</span>&nbsp;<span class="ident" id="6780403">net</span><span class="op" id="6780406">,</span>&nbsp;<span class="ident" id="6780408">addr</span><span class="op" id="6780412">,</span>&nbsp;<span class="ident" id="6780414">n</span><span class="op" id="6780415">,</span>&nbsp;<span class="ident" id="6780417">err</span><span class="op" id="6780420">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780438">if</span>&nbsp;<span class="ident" id="6780441">dt</span>&nbsp;<span class="op" id="6780444">:=</span>&nbsp;<span class="ident" id="6780447">t1</span><span class="op" id="6780449">.</span><span class="ident" id="6780450">Sub</span><span class="op" id="6780453">(</span><span class="ident" id="6780454">t0</span><span class="op" id="6780456">)</span><span class="op" id="6780457">;</span>&nbsp;<span class="ident" id="6780459">dt</span>&nbsp;<span class="op" id="6780462">&lt;</span>&nbsp;<span class="num" id="6780464">50</span><span class="op" id="6780466">*</span><span class="ident" id="6780467">time</span><span class="op" id="6780471">.</span><span class="ident" id="6780472">Millisecond</span>&nbsp;<span class="op" id="6780484">||</span>&nbsp;<span class="op" id="6780487">!</span><span class="ident" id="6780488">testing</span><span class="op" id="6780495">.</span><span class="ident" id="6780496">Short</span><span class="op" id="6780501">(</span><span class="op" id="6780502">)</span>&nbsp;<span class="op" id="6780504">&amp;&amp;</span>&nbsp;<span class="ident" id="6780507">dt</span>&nbsp;<span class="op" id="6780510">&gt;</span>&nbsp;<span class="num" id="6780512">250</span><span class="op" id="6780515">*</span><span class="ident" id="6780516">time</span><span class="op" id="6780520">.</span><span class="ident" id="6780521">Millisecond</span>&nbsp;<span class="op" id="6780533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780538">errc</span>&nbsp;<span class="op" id="6780543">&lt;-</span>&nbsp;<span class="ident" id="6780546">fmt</span><span class="op" id="6780549">.</span><span class="ident" id="6780550">Errorf</span><span class="op" id="6780556">(</span><span class="string" id="6780557">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6780592">,</span>&nbsp;<span class="ident" id="6780594">what</span><span class="op" id="6780598">,</span>&nbsp;<span class="ident" id="6780600">net</span><span class="op" id="6780603">,</span>&nbsp;<span class="ident" id="6780605">addr</span><span class="op" id="6780609">,</span>&nbsp;<span class="ident" id="6780611">dt</span><span class="op" id="6780613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780618">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780631">errc</span>&nbsp;<span class="op" id="6780636">&lt;-</span>&nbsp;<span class="builtintype" id="6780639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780644">}</span><span class="op" id="6780645">(</span><span class="op" id="6780646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780649">select</span>&nbsp;<span class="op" id="6780656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780659">case</span>&nbsp;<span class="ident" id="6780664">err</span>&nbsp;<span class="op" id="6780668">:=</span>&nbsp;<span class="op" id="6780671">&lt;-</span><span class="ident" id="6780673">errc</span><span class="op" id="6780677">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780681">if</span>&nbsp;<span class="ident" id="6780684">err</span>&nbsp;<span class="op" id="6780688">!=</span>&nbsp;<span class="builtintype" id="6780691">nil</span>&nbsp;<span class="op" id="6780695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780700">t</span><span class="op" id="6780701">.</span><span class="ident" id="6780702">Error</span><span class="op" id="6780707">(</span><span class="ident" id="6780708">err</span><span class="op" id="6780711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780718">case</span>&nbsp;<span class="op" id="6780723">&lt;-</span><span class="ident" id="6780725">time</span><span class="op" id="6780729">.</span><span class="ident" id="6780730">After</span><span class="op" id="6780735">(</span><span class="num" id="6780736">1</span>&nbsp;<span class="op" id="6780738">*</span>&nbsp;<span class="ident" id="6780740">time</span><span class="op" id="6780744">.</span><span class="ident" id="6780745">Second</span><span class="op" id="6780751">)</span><span class="op" id="6780752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780756">t</span><span class="op" id="6780757">.</span><span class="ident" id="6780758">Errorf</span><span class="op" id="6780764">(</span><span class="string" id="6780765">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6780811">,</span>&nbsp;<span class="ident" id="6780813">what</span><span class="op" id="6780817">,</span>&nbsp;<span class="ident" id="6780819">net</span><span class="op" id="6780822">,</span>&nbsp;<span class="ident" id="6780824">addr</span><span class="op" id="6780828">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780831">}</span><br>
<span class="lineno"></span><span class="op" id="6780833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6780836">func</span>&nbsp;<span class="ident" id="6780841">TestTimeoutUDP</span><span class="op" id="6780855">(</span><span class="ident" id="6780856">t</span>&nbsp;<span class="op" id="6780858">*</span><span class="ident" id="6780859">testing</span><span class="op" id="6780866">.</span><span class="ident" id="6780867">T</span><span class="op" id="6780868">)</span>&nbsp;<span class="op" id="6780870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780873">switch</span>&nbsp;<span class="ident" id="6780880">runtime</span><span class="op" id="6780887">.</span><span class="ident" id="6780888">GOOS</span>&nbsp;<span class="op" id="6780893">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6780896">case</span>&nbsp;<span class="string" id="6780901">&#34;plan9&#34;</span><span class="op" id="6780908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6780912">t</span><span class="op" id="6780913">.</span><span class="ident" id="6780914">Skipf</span><span class="op" id="6780919">(</span><span class="string" id="6780920">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6780941">,</span>&nbsp;<span class="ident" id="6780943">runtime</span><span class="op" id="6780950">.</span><span class="ident" id="6780951">GOOS</span><span class="op" id="6780955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6780958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6780962">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781005">listening</span>&nbsp;<span class="op" id="6781015">:=</span>&nbsp;<span class="builtinfunc" id="6781018">make</span><span class="op" id="6781022">(</span><span class="keyword" id="6781023">chan</span>&nbsp;<span class="builtintype" id="6781028">string</span><span class="op" id="6781034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781037">done</span>&nbsp;<span class="op" id="6781042">:=</span>&nbsp;<span class="builtinfunc" id="6781045">make</span><span class="op" id="6781049">(</span><span class="keyword" id="6781050">chan</span>&nbsp;<span class="builtintype" id="6781055">int</span><span class="op" id="6781058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781061">go</span>&nbsp;<span class="ident" id="6781064">runDatagramPacketConnServer</span><span class="op" id="6781091">(</span><span class="ident" id="6781092">t</span><span class="op" id="6781093">,</span>&nbsp;<span class="string" id="6781095">&#34;udp&#34;</span><span class="op" id="6781100">,</span>&nbsp;<span class="string" id="6781102">&#34;127.0.0.1:0&#34;</span><span class="op" id="6781115">,</span>&nbsp;<span class="ident" id="6781117">listening</span><span class="op" id="6781126">,</span>&nbsp;<span class="ident" id="6781128">done</span><span class="op" id="6781132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781135">addr</span>&nbsp;<span class="op" id="6781140">:=</span>&nbsp;<span class="op" id="6781143">&lt;-</span><span class="ident" id="6781145">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781157">testTimeout</span><span class="op" id="6781168">(</span><span class="ident" id="6781169">t</span><span class="op" id="6781170">,</span>&nbsp;<span class="string" id="6781172">&#34;udp&#34;</span><span class="op" id="6781177">,</span>&nbsp;<span class="ident" id="6781179">addr</span><span class="op" id="6781183">,</span>&nbsp;<span class="builtintype" id="6781185">false</span><span class="op" id="6781190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781193">testTimeout</span><span class="op" id="6781204">(</span><span class="ident" id="6781205">t</span><span class="op" id="6781206">,</span>&nbsp;<span class="string" id="6781208">&#34;udp&#34;</span><span class="op" id="6781213">,</span>&nbsp;<span class="ident" id="6781215">addr</span><span class="op" id="6781219">,</span>&nbsp;<span class="builtintype" id="6781221">true</span><span class="op" id="6781225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781228">&lt;-</span><span class="ident" id="6781230">done</span><br>
<span class="lineno"></span><span class="op" id="6781235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6781238">func</span>&nbsp;<span class="ident" id="6781243">TestTimeoutTCP</span><span class="op" id="6781257">(</span><span class="ident" id="6781258">t</span>&nbsp;<span class="op" id="6781260">*</span><span class="ident" id="6781261">testing</span><span class="op" id="6781268">.</span><span class="ident" id="6781269">T</span><span class="op" id="6781270">)</span>&nbsp;<span class="op" id="6781272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781275">switch</span>&nbsp;<span class="ident" id="6781282">runtime</span><span class="op" id="6781289">.</span><span class="ident" id="6781290">GOOS</span>&nbsp;<span class="op" id="6781295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781298">case</span>&nbsp;<span class="string" id="6781303">&#34;plan9&#34;</span><span class="op" id="6781310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781314">t</span><span class="op" id="6781315">.</span><span class="ident" id="6781316">Skipf</span><span class="op" id="6781321">(</span><span class="string" id="6781322">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6781343">,</span>&nbsp;<span class="ident" id="6781345">runtime</span><span class="op" id="6781352">.</span><span class="ident" id="6781353">GOOS</span><span class="op" id="6781357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781360">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6781364">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781407">listening</span>&nbsp;<span class="op" id="6781417">:=</span>&nbsp;<span class="builtinfunc" id="6781420">make</span><span class="op" id="6781424">(</span><span class="keyword" id="6781425">chan</span>&nbsp;<span class="builtintype" id="6781430">string</span><span class="op" id="6781436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781439">done</span>&nbsp;<span class="op" id="6781444">:=</span>&nbsp;<span class="builtinfunc" id="6781447">make</span><span class="op" id="6781451">(</span><span class="keyword" id="6781452">chan</span>&nbsp;<span class="builtintype" id="6781457">int</span><span class="op" id="6781460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781463">go</span>&nbsp;<span class="ident" id="6781466">runStreamConnServer</span><span class="op" id="6781485">(</span><span class="ident" id="6781486">t</span><span class="op" id="6781487">,</span>&nbsp;<span class="string" id="6781489">&#34;tcp&#34;</span><span class="op" id="6781494">,</span>&nbsp;<span class="string" id="6781496">&#34;127.0.0.1:0&#34;</span><span class="op" id="6781509">,</span>&nbsp;<span class="ident" id="6781511">listening</span><span class="op" id="6781520">,</span>&nbsp;<span class="ident" id="6781522">done</span><span class="op" id="6781526">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781529">addr</span>&nbsp;<span class="op" id="6781534">:=</span>&nbsp;<span class="op" id="6781537">&lt;-</span><span class="ident" id="6781539">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781551">testTimeout</span><span class="op" id="6781562">(</span><span class="ident" id="6781563">t</span><span class="op" id="6781564">,</span>&nbsp;<span class="string" id="6781566">&#34;tcp&#34;</span><span class="op" id="6781571">,</span>&nbsp;<span class="ident" id="6781573">addr</span><span class="op" id="6781577">,</span>&nbsp;<span class="builtintype" id="6781579">false</span><span class="op" id="6781584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781587">&lt;-</span><span class="ident" id="6781589">done</span><br>
<span class="lineno"></span><span class="op" id="6781594">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6781597">func</span>&nbsp;<span class="ident" id="6781602">TestDeadlineReset</span><span class="op" id="6781619">(</span><span class="ident" id="6781620">t</span>&nbsp;<span class="op" id="6781622">*</span><span class="ident" id="6781623">testing</span><span class="op" id="6781630">.</span><span class="ident" id="6781631">T</span><span class="op" id="6781632">)</span>&nbsp;<span class="op" id="6781634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781637">switch</span>&nbsp;<span class="ident" id="6781644">runtime</span><span class="op" id="6781651">.</span><span class="ident" id="6781652">GOOS</span>&nbsp;<span class="op" id="6781657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781660">case</span>&nbsp;<span class="string" id="6781665">&#34;plan9&#34;</span><span class="op" id="6781672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781676">t</span><span class="op" id="6781677">.</span><span class="ident" id="6781678">Skipf</span><span class="op" id="6781683">(</span><span class="string" id="6781684">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6781705">,</span>&nbsp;<span class="ident" id="6781707">runtime</span><span class="op" id="6781714">.</span><span class="ident" id="6781715">GOOS</span><span class="op" id="6781719">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781725">ln</span><span class="op" id="6781727">,</span>&nbsp;<span class="ident" id="6781729">err</span>&nbsp;<span class="op" id="6781733">:=</span>&nbsp;<span class="ident" id="6781736">Listen</span><span class="op" id="6781742">(</span><span class="string" id="6781743">&#34;tcp&#34;</span><span class="op" id="6781748">,</span>&nbsp;<span class="string" id="6781750">&#34;127.0.0.1:0&#34;</span><span class="op" id="6781763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781766">if</span>&nbsp;<span class="ident" id="6781769">err</span>&nbsp;<span class="op" id="6781773">!=</span>&nbsp;<span class="builtintype" id="6781776">nil</span>&nbsp;<span class="op" id="6781780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781784">t</span><span class="op" id="6781785">.</span><span class="ident" id="6781786">Fatal</span><span class="op" id="6781791">(</span><span class="ident" id="6781792">err</span><span class="op" id="6781795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6781798">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781801">defer</span>&nbsp;<span class="ident" id="6781807">ln</span><span class="op" id="6781809">.</span><span class="ident" id="6781810">Close</span><span class="op" id="6781815">(</span><span class="op" id="6781816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781819">tl</span>&nbsp;<span class="op" id="6781822">:=</span>&nbsp;<span class="ident" id="6781825">ln</span><span class="op" id="6781827">.</span><span class="op" id="6781828">(</span><span class="op" id="6781829">*</span><span class="ident" id="6781830">TCPListener</span><span class="op" id="6781841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781844">tl</span><span class="op" id="6781846">.</span><span class="ident" id="6781847">SetDeadline</span><span class="op" id="6781858">(</span><span class="ident" id="6781859">time</span><span class="op" id="6781863">.</span><span class="ident" id="6781864">Now</span><span class="op" id="6781867">(</span><span class="op" id="6781868">)</span><span class="op" id="6781869">.</span><span class="ident" id="6781870">Add</span><span class="op" id="6781873">(</span><span class="num" id="6781874">1</span>&nbsp;<span class="op" id="6781876">*</span>&nbsp;<span class="ident" id="6781878">time</span><span class="op" id="6781882">.</span><span class="ident" id="6781883">Minute</span><span class="op" id="6781889">)</span><span class="op" id="6781890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781893">tl</span><span class="op" id="6781895">.</span><span class="ident" id="6781896">SetDeadline</span><span class="op" id="6781907">(</span><span class="ident" id="6781908">noDeadline</span><span class="op" id="6781918">)</span>&nbsp;<span class="comment" id="6781920">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781933">errc</span>&nbsp;<span class="op" id="6781938">:=</span>&nbsp;<span class="builtinfunc" id="6781941">make</span><span class="op" id="6781945">(</span><span class="keyword" id="6781946">chan</span>&nbsp;<span class="builtintype" id="6781951">error</span><span class="op" id="6781956">,</span>&nbsp;<span class="num" id="6781958">1</span><span class="op" id="6781959">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6781962">go</span>&nbsp;<span class="keyword" id="6781965">func</span><span class="op" id="6781969">(</span><span class="op" id="6781970">)</span>&nbsp;<span class="op" id="6781972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6781976">_</span><span class="op" id="6781977">,</span>&nbsp;<span class="ident" id="6781979">err</span>&nbsp;<span class="op" id="6781983">:=</span>&nbsp;<span class="ident" id="6781986">ln</span><span class="op" id="6781988">.</span><span class="ident" id="6781989">Accept</span><span class="op" id="6781995">(</span><span class="op" id="6781996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782000">errc</span>&nbsp;<span class="op" id="6782005">&lt;-</span>&nbsp;<span class="ident" id="6782008">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782013">}</span><span class="op" id="6782014">(</span><span class="op" id="6782015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782018">select</span>&nbsp;<span class="op" id="6782025">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782028">case</span>&nbsp;<span class="op" id="6782033">&lt;-</span><span class="ident" id="6782035">time</span><span class="op" id="6782039">.</span><span class="ident" id="6782040">After</span><span class="op" id="6782045">(</span><span class="num" id="6782046">50</span>&nbsp;<span class="op" id="6782049">*</span>&nbsp;<span class="ident" id="6782051">time</span><span class="op" id="6782055">.</span><span class="ident" id="6782056">Millisecond</span><span class="op" id="6782067">)</span><span class="op" id="6782068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6782072">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782082">case</span>&nbsp;<span class="ident" id="6782087">err</span>&nbsp;<span class="op" id="6782091">:=</span>&nbsp;<span class="op" id="6782094">&lt;-</span><span class="ident" id="6782096">errc</span><span class="op" id="6782100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6782104">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6782146">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782168">t</span><span class="op" id="6782169">.</span><span class="ident" id="6782170">Errorf</span><span class="op" id="6782176">(</span><span class="string" id="6782177">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="6782216">,</span>&nbsp;<span class="ident" id="6782218">err</span><span class="op" id="6782221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782224">}</span><br>
<span class="lineno"></span><span class="op" id="6782226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6782229">func</span>&nbsp;<span class="ident" id="6782234">TestTimeoutAccept</span><span class="op" id="6782251">(</span><span class="ident" id="6782252">t</span>&nbsp;<span class="op" id="6782254">*</span><span class="ident" id="6782255">testing</span><span class="op" id="6782262">.</span><span class="ident" id="6782263">T</span><span class="op" id="6782264">)</span>&nbsp;<span class="op" id="6782266">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782269">switch</span>&nbsp;<span class="ident" id="6782276">runtime</span><span class="op" id="6782283">.</span><span class="ident" id="6782284">GOOS</span>&nbsp;<span class="op" id="6782289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782292">case</span>&nbsp;<span class="string" id="6782297">&#34;plan9&#34;</span><span class="op" id="6782304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782308">t</span><span class="op" id="6782309">.</span><span class="ident" id="6782310">Skipf</span><span class="op" id="6782315">(</span><span class="string" id="6782316">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6782337">,</span>&nbsp;<span class="ident" id="6782339">runtime</span><span class="op" id="6782346">.</span><span class="ident" id="6782347">GOOS</span><span class="op" id="6782351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782357">ln</span><span class="op" id="6782359">,</span>&nbsp;<span class="ident" id="6782361">err</span>&nbsp;<span class="op" id="6782365">:=</span>&nbsp;<span class="ident" id="6782368">Listen</span><span class="op" id="6782374">(</span><span class="string" id="6782375">&#34;tcp&#34;</span><span class="op" id="6782380">,</span>&nbsp;<span class="string" id="6782382">&#34;127.0.0.1:0&#34;</span><span class="op" id="6782395">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782398">if</span>&nbsp;<span class="ident" id="6782401">err</span>&nbsp;<span class="op" id="6782405">!=</span>&nbsp;<span class="builtintype" id="6782408">nil</span>&nbsp;<span class="op" id="6782412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782416">t</span><span class="op" id="6782417">.</span><span class="ident" id="6782418">Fatal</span><span class="op" id="6782423">(</span><span class="ident" id="6782424">err</span><span class="op" id="6782427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782433">defer</span>&nbsp;<span class="ident" id="6782439">ln</span><span class="op" id="6782441">.</span><span class="ident" id="6782442">Close</span><span class="op" id="6782447">(</span><span class="op" id="6782448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782451">tl</span>&nbsp;<span class="op" id="6782454">:=</span>&nbsp;<span class="ident" id="6782457">ln</span><span class="op" id="6782459">.</span><span class="op" id="6782460">(</span><span class="op" id="6782461">*</span><span class="ident" id="6782462">TCPListener</span><span class="op" id="6782473">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782476">tl</span><span class="op" id="6782478">.</span><span class="ident" id="6782479">SetDeadline</span><span class="op" id="6782490">(</span><span class="ident" id="6782491">time</span><span class="op" id="6782495">.</span><span class="ident" id="6782496">Now</span><span class="op" id="6782499">(</span><span class="op" id="6782500">)</span><span class="op" id="6782501">.</span><span class="ident" id="6782502">Add</span><span class="op" id="6782505">(</span><span class="num" id="6782506">100</span>&nbsp;<span class="op" id="6782510">*</span>&nbsp;<span class="ident" id="6782512">time</span><span class="op" id="6782516">.</span><span class="ident" id="6782517">Millisecond</span><span class="op" id="6782528">)</span><span class="op" id="6782529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782532">errc</span>&nbsp;<span class="op" id="6782537">:=</span>&nbsp;<span class="builtinfunc" id="6782540">make</span><span class="op" id="6782544">(</span><span class="keyword" id="6782545">chan</span>&nbsp;<span class="builtintype" id="6782550">error</span><span class="op" id="6782555">,</span>&nbsp;<span class="num" id="6782557">1</span><span class="op" id="6782558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782561">go</span>&nbsp;<span class="keyword" id="6782564">func</span><span class="op" id="6782568">(</span><span class="op" id="6782569">)</span>&nbsp;<span class="op" id="6782571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782575">_</span><span class="op" id="6782576">,</span>&nbsp;<span class="ident" id="6782578">err</span>&nbsp;<span class="op" id="6782582">:=</span>&nbsp;<span class="ident" id="6782585">ln</span><span class="op" id="6782587">.</span><span class="ident" id="6782588">Accept</span><span class="op" id="6782594">(</span><span class="op" id="6782595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782599">errc</span>&nbsp;<span class="op" id="6782604">&lt;-</span>&nbsp;<span class="ident" id="6782607">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782612">}</span><span class="op" id="6782613">(</span><span class="op" id="6782614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782617">select</span>&nbsp;<span class="op" id="6782624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782627">case</span>&nbsp;<span class="op" id="6782632">&lt;-</span><span class="ident" id="6782634">time</span><span class="op" id="6782638">.</span><span class="ident" id="6782639">After</span><span class="op" id="6782644">(</span><span class="num" id="6782645">1</span>&nbsp;<span class="op" id="6782647">*</span>&nbsp;<span class="ident" id="6782649">time</span><span class="op" id="6782653">.</span><span class="ident" id="6782654">Second</span><span class="op" id="6782660">)</span><span class="op" id="6782661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6782665">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782706">t</span><span class="op" id="6782707">.</span><span class="ident" id="6782708">Errorf</span><span class="op" id="6782714">(</span><span class="string" id="6782715">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="6782757">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782760">case</span>&nbsp;<span class="op" id="6782765">&lt;-</span><span class="ident" id="6782767">errc</span><span class="op" id="6782771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6782775">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782785">}</span><br>
<span class="lineno"></span><span class="op" id="6782787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6782790">func</span>&nbsp;<span class="ident" id="6782795">TestReadWriteDeadline</span><span class="op" id="6782816">(</span><span class="ident" id="6782817">t</span>&nbsp;<span class="op" id="6782819">*</span><span class="ident" id="6782820">testing</span><span class="op" id="6782827">.</span><span class="ident" id="6782828">T</span><span class="op" id="6782829">)</span>&nbsp;<span class="op" id="6782831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782834">switch</span>&nbsp;<span class="ident" id="6782841">runtime</span><span class="op" id="6782848">.</span><span class="ident" id="6782849">GOOS</span>&nbsp;<span class="op" id="6782854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782857">case</span>&nbsp;<span class="string" id="6782862">&#34;plan9&#34;</span><span class="op" id="6782869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782873">t</span><span class="op" id="6782874">.</span><span class="ident" id="6782875">Skipf</span><span class="op" id="6782880">(</span><span class="string" id="6782881">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6782902">,</span>&nbsp;<span class="ident" id="6782904">runtime</span><span class="op" id="6782911">.</span><span class="ident" id="6782912">GOOS</span><span class="op" id="6782916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6782919">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6782923">const</span>&nbsp;<span class="op" id="6782929">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782933">readTimeout</span>&nbsp;&nbsp;<span class="op" id="6782946">=</span>&nbsp;<span class="num" id="6782948">50</span>&nbsp;<span class="op" id="6782951">*</span>&nbsp;<span class="ident" id="6782953">time</span><span class="op" id="6782957">.</span><span class="ident" id="6782958">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6782972">writeTimeout</span>&nbsp;<span class="op" id="6782985">=</span>&nbsp;<span class="num" id="6782987">250</span>&nbsp;<span class="op" id="6782991">*</span>&nbsp;<span class="ident" id="6782993">time</span><span class="op" id="6782997">.</span><span class="ident" id="6782998">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783011">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783014">checkTimeout</span>&nbsp;<span class="op" id="6783027">:=</span>&nbsp;<span class="keyword" id="6783030">func</span><span class="op" id="6783034">(</span><span class="ident" id="6783035">command</span>&nbsp;<span class="builtintype" id="6783043">string</span><span class="op" id="6783049">,</span>&nbsp;<span class="ident" id="6783051">start</span>&nbsp;<span class="ident" id="6783057">time</span><span class="op" id="6783061">.</span><span class="ident" id="6783062">Time</span><span class="op" id="6783066">,</span>&nbsp;<span class="ident" id="6783068">should</span>&nbsp;<span class="ident" id="6783075">time</span><span class="op" id="6783079">.</span><span class="ident" id="6783080">Duration</span><span class="op" id="6783088">)</span>&nbsp;<span class="op" id="6783090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783094">is</span>&nbsp;<span class="op" id="6783097">:=</span>&nbsp;<span class="ident" id="6783100">time</span><span class="op" id="6783104">.</span><span class="ident" id="6783105">Now</span><span class="op" id="6783108">(</span><span class="op" id="6783109">)</span><span class="op" id="6783110">.</span><span class="ident" id="6783111">Sub</span><span class="op" id="6783114">(</span><span class="ident" id="6783115">start</span><span class="op" id="6783120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783124">d</span>&nbsp;<span class="op" id="6783126">:=</span>&nbsp;<span class="ident" id="6783129">is</span>&nbsp;<span class="op" id="6783132">-</span>&nbsp;<span class="ident" id="6783134">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783143">if</span>&nbsp;<span class="ident" id="6783146">d</span>&nbsp;<span class="op" id="6783148">&lt;</span>&nbsp;<span class="op" id="6783150">-</span><span class="num" id="6783151">30</span><span class="op" id="6783153">*</span><span class="ident" id="6783154">time</span><span class="op" id="6783158">.</span><span class="ident" id="6783159">Millisecond</span>&nbsp;<span class="op" id="6783171">||</span>&nbsp;<span class="op" id="6783174">!</span><span class="ident" id="6783175">testing</span><span class="op" id="6783182">.</span><span class="ident" id="6783183">Short</span><span class="op" id="6783188">(</span><span class="op" id="6783189">)</span>&nbsp;<span class="op" id="6783191">&amp;&amp;</span>&nbsp;<span class="num" id="6783194">150</span><span class="op" id="6783197">*</span><span class="ident" id="6783198">time</span><span class="op" id="6783202">.</span><span class="ident" id="6783203">Millisecond</span>&nbsp;<span class="op" id="6783215">&lt;</span>&nbsp;<span class="ident" id="6783217">d</span>&nbsp;<span class="op" id="6783219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783224">t</span><span class="op" id="6783225">.</span><span class="ident" id="6783226">Errorf</span><span class="op" id="6783232">(</span><span class="string" id="6783233">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="6783276">,</span>&nbsp;<span class="ident" id="6783278">command</span><span class="op" id="6783285">,</span>&nbsp;<span class="ident" id="6783287">is</span><span class="op" id="6783289">,</span>&nbsp;<span class="ident" id="6783291">should</span><span class="op" id="6783297">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783308">ln</span><span class="op" id="6783310">,</span>&nbsp;<span class="ident" id="6783312">err</span>&nbsp;<span class="op" id="6783316">:=</span>&nbsp;<span class="ident" id="6783319">Listen</span><span class="op" id="6783325">(</span><span class="string" id="6783326">&#34;tcp&#34;</span><span class="op" id="6783331">,</span>&nbsp;<span class="string" id="6783333">&#34;127.0.0.1:0&#34;</span><span class="op" id="6783346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783349">if</span>&nbsp;<span class="ident" id="6783352">err</span>&nbsp;<span class="op" id="6783356">!=</span>&nbsp;<span class="builtintype" id="6783359">nil</span>&nbsp;<span class="op" id="6783363">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783367">t</span><span class="op" id="6783368">.</span><span class="ident" id="6783369">Fatalf</span><span class="op" id="6783375">(</span><span class="string" id="6783376">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6783397">,</span>&nbsp;<span class="ident" id="6783399">err</span><span class="op" id="6783402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783408">defer</span>&nbsp;<span class="ident" id="6783414">ln</span><span class="op" id="6783416">.</span><span class="ident" id="6783417">Close</span><span class="op" id="6783422">(</span><span class="op" id="6783423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783427">lnquit</span>&nbsp;<span class="op" id="6783434">:=</span>&nbsp;<span class="builtinfunc" id="6783437">make</span><span class="op" id="6783441">(</span><span class="keyword" id="6783442">chan</span>&nbsp;<span class="builtintype" id="6783447">bool</span><span class="op" id="6783451">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783455">go</span>&nbsp;<span class="keyword" id="6783458">func</span><span class="op" id="6783462">(</span><span class="op" id="6783463">)</span>&nbsp;<span class="op" id="6783465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783469">c</span><span class="op" id="6783470">,</span>&nbsp;<span class="ident" id="6783472">err</span>&nbsp;<span class="op" id="6783476">:=</span>&nbsp;<span class="ident" id="6783479">ln</span><span class="op" id="6783481">.</span><span class="ident" id="6783482">Accept</span><span class="op" id="6783488">(</span><span class="op" id="6783489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783493">if</span>&nbsp;<span class="ident" id="6783496">err</span>&nbsp;<span class="op" id="6783500">!=</span>&nbsp;<span class="builtintype" id="6783503">nil</span>&nbsp;<span class="op" id="6783507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783512">t</span><span class="op" id="6783513">.</span><span class="ident" id="6783514">Errorf</span><span class="op" id="6783520">(</span><span class="string" id="6783521">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6783533">,</span>&nbsp;<span class="ident" id="6783535">err</span><span class="op" id="6783538">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783556">defer</span>&nbsp;<span class="ident" id="6783562">c</span><span class="op" id="6783563">.</span><span class="ident" id="6783564">Close</span><span class="op" id="6783569">(</span><span class="op" id="6783570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783574">lnquit</span>&nbsp;<span class="op" id="6783581">&lt;-</span>&nbsp;<span class="builtintype" id="6783584">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783590">}</span><span class="op" id="6783591">(</span><span class="op" id="6783592">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783596">c</span><span class="op" id="6783597">,</span>&nbsp;<span class="ident" id="6783599">err</span>&nbsp;<span class="op" id="6783603">:=</span>&nbsp;<span class="ident" id="6783606">Dial</span><span class="op" id="6783610">(</span><span class="string" id="6783611">&#34;tcp&#34;</span><span class="op" id="6783616">,</span>&nbsp;<span class="ident" id="6783618">ln</span><span class="op" id="6783620">.</span><span class="ident" id="6783621">Addr</span><span class="op" id="6783625">(</span><span class="op" id="6783626">)</span><span class="op" id="6783627">.</span><span class="ident" id="6783628">String</span><span class="op" id="6783634">(</span><span class="op" id="6783635">)</span><span class="op" id="6783636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783639">if</span>&nbsp;<span class="ident" id="6783642">err</span>&nbsp;<span class="op" id="6783646">!=</span>&nbsp;<span class="builtintype" id="6783649">nil</span>&nbsp;<span class="op" id="6783653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783657">t</span><span class="op" id="6783658">.</span><span class="ident" id="6783659">Fatalf</span><span class="op" id="6783665">(</span><span class="string" id="6783666">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6783676">,</span>&nbsp;<span class="ident" id="6783678">err</span><span class="op" id="6783681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783684">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783687">defer</span>&nbsp;<span class="ident" id="6783693">c</span><span class="op" id="6783694">.</span><span class="ident" id="6783695">Close</span><span class="op" id="6783700">(</span><span class="op" id="6783701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783705">start</span>&nbsp;<span class="op" id="6783711">:=</span>&nbsp;<span class="ident" id="6783714">time</span><span class="op" id="6783718">.</span><span class="ident" id="6783719">Now</span><span class="op" id="6783722">(</span><span class="op" id="6783723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783726">err</span>&nbsp;<span class="op" id="6783730">=</span>&nbsp;<span class="ident" id="6783732">c</span><span class="op" id="6783733">.</span><span class="ident" id="6783734">SetReadDeadline</span><span class="op" id="6783749">(</span><span class="ident" id="6783750">start</span><span class="op" id="6783755">.</span><span class="ident" id="6783756">Add</span><span class="op" id="6783759">(</span><span class="ident" id="6783760">readTimeout</span><span class="op" id="6783771">)</span><span class="op" id="6783772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783775">if</span>&nbsp;<span class="ident" id="6783778">err</span>&nbsp;<span class="op" id="6783782">!=</span>&nbsp;<span class="builtintype" id="6783785">nil</span>&nbsp;<span class="op" id="6783789">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783793">t</span><span class="op" id="6783794">.</span><span class="ident" id="6783795">Fatalf</span><span class="op" id="6783801">(</span><span class="string" id="6783802">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="6783823">,</span>&nbsp;<span class="ident" id="6783825">err</span><span class="op" id="6783828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783834">err</span>&nbsp;<span class="op" id="6783838">=</span>&nbsp;<span class="ident" id="6783840">c</span><span class="op" id="6783841">.</span><span class="ident" id="6783842">SetWriteDeadline</span><span class="op" id="6783858">(</span><span class="ident" id="6783859">start</span><span class="op" id="6783864">.</span><span class="ident" id="6783865">Add</span><span class="op" id="6783868">(</span><span class="ident" id="6783869">writeTimeout</span><span class="op" id="6783881">)</span><span class="op" id="6783882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783885">if</span>&nbsp;<span class="ident" id="6783888">err</span>&nbsp;<span class="op" id="6783892">!=</span>&nbsp;<span class="builtintype" id="6783895">nil</span>&nbsp;<span class="op" id="6783899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783903">t</span><span class="op" id="6783904">.</span><span class="ident" id="6783905">Fatalf</span><span class="op" id="6783911">(</span><span class="string" id="6783912">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="6783934">,</span>&nbsp;<span class="ident" id="6783936">err</span><span class="op" id="6783939">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6783942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6783946">quit</span>&nbsp;<span class="op" id="6783951">:=</span>&nbsp;<span class="builtinfunc" id="6783954">make</span><span class="op" id="6783958">(</span><span class="keyword" id="6783959">chan</span>&nbsp;<span class="builtintype" id="6783964">bool</span><span class="op" id="6783968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783972">go</span>&nbsp;<span class="keyword" id="6783975">func</span><span class="op" id="6783979">(</span><span class="op" id="6783980">)</span>&nbsp;<span class="op" id="6783982">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6783986">var</span>&nbsp;<span class="ident" id="6783990">buf</span>&nbsp;<span class="op" id="6783994">[</span><span class="num" id="6783995">10</span><span class="op" id="6783997">]</span><span class="builtintype" id="6783998">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784005">_</span><span class="op" id="6784006">,</span>&nbsp;<span class="ident" id="6784008">err</span>&nbsp;<span class="op" id="6784012">:=</span>&nbsp;<span class="ident" id="6784015">c</span><span class="op" id="6784016">.</span><span class="ident" id="6784017">Read</span><span class="op" id="6784021">(</span><span class="ident" id="6784022">buf</span><span class="op" id="6784025">[</span><span class="op" id="6784026">:</span><span class="op" id="6784027">]</span><span class="op" id="6784028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784032">if</span>&nbsp;<span class="ident" id="6784035">err</span>&nbsp;<span class="op" id="6784039">==</span>&nbsp;<span class="builtintype" id="6784042">nil</span>&nbsp;<span class="op" id="6784046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784051">t</span><span class="op" id="6784052">.</span><span class="ident" id="6784053">Errorf</span><span class="op" id="6784059">(</span><span class="string" id="6784060">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="6784085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784089">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784093">checkTimeout</span><span class="op" id="6784105">(</span><span class="string" id="6784106">&#34;Read&#34;</span><span class="op" id="6784112">,</span>&nbsp;<span class="ident" id="6784114">start</span><span class="op" id="6784119">,</span>&nbsp;<span class="ident" id="6784121">readTimeout</span><span class="op" id="6784132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784136">quit</span>&nbsp;<span class="op" id="6784141">&lt;-</span>&nbsp;<span class="builtintype" id="6784144">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784150">}</span><span class="op" id="6784151">(</span><span class="op" id="6784152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784156">go</span>&nbsp;<span class="keyword" id="6784159">func</span><span class="op" id="6784163">(</span><span class="op" id="6784164">)</span>&nbsp;<span class="op" id="6784166">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784170">var</span>&nbsp;<span class="ident" id="6784174">buf</span>&nbsp;<span class="op" id="6784178">[</span><span class="num" id="6784179">10000</span><span class="op" id="6784184">]</span><span class="builtintype" id="6784185">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784192">for</span>&nbsp;<span class="op" id="6784196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784201">_</span><span class="op" id="6784202">,</span>&nbsp;<span class="ident" id="6784204">err</span>&nbsp;<span class="op" id="6784208">:=</span>&nbsp;<span class="ident" id="6784211">c</span><span class="op" id="6784212">.</span><span class="ident" id="6784213">Write</span><span class="op" id="6784218">(</span><span class="ident" id="6784219">buf</span><span class="op" id="6784222">[</span><span class="op" id="6784223">:</span><span class="op" id="6784224">]</span><span class="op" id="6784225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784230">if</span>&nbsp;<span class="ident" id="6784233">err</span>&nbsp;<span class="op" id="6784237">!=</span>&nbsp;<span class="builtintype" id="6784240">nil</span>&nbsp;<span class="op" id="6784244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784250">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784267">checkTimeout</span><span class="op" id="6784279">(</span><span class="string" id="6784280">&#34;Write&#34;</span><span class="op" id="6784287">,</span>&nbsp;<span class="ident" id="6784289">start</span><span class="op" id="6784294">,</span>&nbsp;<span class="ident" id="6784296">writeTimeout</span><span class="op" id="6784308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784312">quit</span>&nbsp;<span class="op" id="6784317">&lt;-</span>&nbsp;<span class="builtintype" id="6784320">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784326">}</span><span class="op" id="6784327">(</span><span class="op" id="6784328">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784332">&lt;-</span><span class="ident" id="6784334">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784340">&lt;-</span><span class="ident" id="6784342">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784348">&lt;-</span><span class="ident" id="6784350">lnquit</span><br>
<span class="lineno"></span><span class="op" id="6784357">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="6784360">type</span>&nbsp;<span class="ident" id="6784365">neverEnding</span>&nbsp;<span class="builtintype" id="6784377">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6784383">func</span>&nbsp;<span class="op" id="6784388">(</span><span class="ident" id="6784389">b</span>&nbsp;<span class="ident" id="6784391">neverEnding</span><span class="op" id="6784402">)</span>&nbsp;<span class="ident" id="6784404">Read</span><span class="op" id="6784408">(</span><span class="ident" id="6784409">p</span>&nbsp;<span class="op" id="6784411">[</span><span class="op" id="6784412">]</span><span class="builtintype" id="6784413">byte</span><span class="op" id="6784417">)</span>&nbsp;<span class="op" id="6784419">(</span><span class="ident" id="6784420">n</span>&nbsp;<span class="builtintype" id="6784422">int</span><span class="op" id="6784425">,</span>&nbsp;<span class="ident" id="6784427">err</span>&nbsp;<span class="builtintype" id="6784431">error</span><span class="op" id="6784436">)</span>&nbsp;<span class="op" id="6784438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784441">for</span>&nbsp;<span class="ident" id="6784445">i</span>&nbsp;<span class="op" id="6784447">:=</span>&nbsp;<span class="keyword" id="6784450">range</span>&nbsp;<span class="ident" id="6784456">p</span>&nbsp;<span class="op" id="6784458">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784462">p</span><span class="op" id="6784463">[</span><span class="ident" id="6784464">i</span><span class="op" id="6784465">]</span>&nbsp;<span class="op" id="6784467">=</span>&nbsp;<span class="builtintype" id="6784469">byte</span><span class="op" id="6784473">(</span><span class="ident" id="6784474">b</span><span class="op" id="6784475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784481">return</span>&nbsp;<span class="builtinfunc" id="6784488">len</span><span class="op" id="6784491">(</span><span class="ident" id="6784492">p</span><span class="op" id="6784493">)</span><span class="op" id="6784494">,</span>&nbsp;<span class="builtintype" id="6784496">nil</span><br>
<span class="lineno"></span><span class="op" id="6784500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6784503">func</span>&nbsp;<span class="ident" id="6784508">TestVariousDeadlines1Proc</span><span class="op" id="6784533">(</span><span class="ident" id="6784534">t</span>&nbsp;<span class="op" id="6784536">*</span><span class="ident" id="6784537">testing</span><span class="op" id="6784544">.</span><span class="ident" id="6784545">T</span><span class="op" id="6784546">)</span>&nbsp;<span class="op" id="6784548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784551">testVariousDeadlines</span><span class="op" id="6784571">(</span><span class="ident" id="6784572">t</span><span class="op" id="6784573">,</span>&nbsp;<span class="num" id="6784575">1</span><span class="op" id="6784576">)</span><br>
<span class="lineno"></span><span class="op" id="6784578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6784581">func</span>&nbsp;<span class="ident" id="6784586">TestVariousDeadlines4Proc</span><span class="op" id="6784611">(</span><span class="ident" id="6784612">t</span>&nbsp;<span class="op" id="6784614">*</span><span class="ident" id="6784615">testing</span><span class="op" id="6784622">.</span><span class="ident" id="6784623">T</span><span class="op" id="6784624">)</span>&nbsp;<span class="op" id="6784626">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784629">testVariousDeadlines</span><span class="op" id="6784649">(</span><span class="ident" id="6784650">t</span><span class="op" id="6784651">,</span>&nbsp;<span class="num" id="6784653">4</span><span class="op" id="6784654">)</span><br>
<span class="lineno"></span><span class="op" id="6784656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6784659">func</span>&nbsp;<span class="ident" id="6784664">testVariousDeadlines</span><span class="op" id="6784684">(</span><span class="ident" id="6784685">t</span>&nbsp;<span class="op" id="6784687">*</span><span class="ident" id="6784688">testing</span><span class="op" id="6784695">.</span><span class="ident" id="6784696">T</span><span class="op" id="6784697">,</span>&nbsp;<span class="ident" id="6784699">maxProcs</span>&nbsp;<span class="builtintype" id="6784708">int</span><span class="op" id="6784711">)</span>&nbsp;<span class="op" id="6784713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784716">switch</span>&nbsp;<span class="ident" id="6784723">runtime</span><span class="op" id="6784730">.</span><span class="ident" id="6784731">GOOS</span>&nbsp;<span class="op" id="6784736">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784739">case</span>&nbsp;<span class="string" id="6784744">&#34;plan9&#34;</span><span class="op" id="6784751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784755">t</span><span class="op" id="6784756">.</span><span class="ident" id="6784757">Skipf</span><span class="op" id="6784762">(</span><span class="string" id="6784763">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6784784">,</span>&nbsp;<span class="ident" id="6784786">runtime</span><span class="op" id="6784793">.</span><span class="ident" id="6784794">GOOS</span><span class="op" id="6784798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6784801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784805">defer</span>&nbsp;<span class="ident" id="6784811">runtime</span><span class="op" id="6784818">.</span><span class="ident" id="6784819">GOMAXPROCS</span><span class="op" id="6784829">(</span><span class="ident" id="6784830">runtime</span><span class="op" id="6784837">.</span><span class="ident" id="6784838">GOMAXPROCS</span><span class="op" id="6784848">(</span><span class="ident" id="6784849">maxProcs</span><span class="op" id="6784857">)</span><span class="op" id="6784858">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784861">ln</span>&nbsp;<span class="op" id="6784864">:=</span>&nbsp;<span class="ident" id="6784867">newLocalListener</span><span class="op" id="6784883">(</span><span class="ident" id="6784884">t</span><span class="op" id="6784885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6784888">defer</span>&nbsp;<span class="ident" id="6784894">ln</span><span class="op" id="6784896">.</span><span class="ident" id="6784897">Close</span><span class="op" id="6784902">(</span><span class="op" id="6784903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6784906">acceptc</span>&nbsp;<span class="op" id="6784914">:=</span>&nbsp;<span class="builtinfunc" id="6784917">make</span><span class="op" id="6784921">(</span><span class="keyword" id="6784922">chan</span>&nbsp;<span class="builtintype" id="6784927">error</span><span class="op" id="6784932">,</span>&nbsp;<span class="num" id="6784934">1</span><span class="op" id="6784935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6784939">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6785009">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785032">servec</span>&nbsp;<span class="op" id="6785039">:=</span>&nbsp;<span class="builtinfunc" id="6785042">make</span><span class="op" id="6785046">(</span><span class="keyword" id="6785047">chan</span>&nbsp;<span class="ident" id="6785052">copyRes</span><span class="op" id="6785059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785062">go</span>&nbsp;<span class="keyword" id="6785065">func</span><span class="op" id="6785069">(</span><span class="op" id="6785070">)</span>&nbsp;<span class="op" id="6785072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785076">for</span>&nbsp;<span class="op" id="6785080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785085">c</span><span class="op" id="6785086">,</span>&nbsp;<span class="ident" id="6785088">err</span>&nbsp;<span class="op" id="6785092">:=</span>&nbsp;<span class="ident" id="6785095">ln</span><span class="op" id="6785097">.</span><span class="ident" id="6785098">Accept</span><span class="op" id="6785104">(</span><span class="op" id="6785105">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785110">if</span>&nbsp;<span class="ident" id="6785113">err</span>&nbsp;<span class="op" id="6785117">!=</span>&nbsp;<span class="builtintype" id="6785120">nil</span>&nbsp;<span class="op" id="6785124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785130">acceptc</span>&nbsp;<span class="op" id="6785138">&lt;-</span>&nbsp;<span class="ident" id="6785141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785149">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785164">go</span>&nbsp;<span class="keyword" id="6785167">func</span><span class="op" id="6785171">(</span><span class="op" id="6785172">)</span>&nbsp;<span class="op" id="6785174">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785180">t0</span>&nbsp;<span class="op" id="6785183">:=</span>&nbsp;<span class="ident" id="6785186">time</span><span class="op" id="6785190">.</span><span class="ident" id="6785191">Now</span><span class="op" id="6785194">(</span><span class="op" id="6785195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785201">n</span><span class="op" id="6785202">,</span>&nbsp;<span class="ident" id="6785204">err</span>&nbsp;<span class="op" id="6785208">:=</span>&nbsp;<span class="ident" id="6785211">io</span><span class="op" id="6785213">.</span><span class="ident" id="6785214">Copy</span><span class="op" id="6785218">(</span><span class="ident" id="6785219">c</span><span class="op" id="6785220">,</span>&nbsp;<span class="ident" id="6785222">neverEnding</span><span class="op" id="6785233">(</span><span class="string" id="6785234">&#39;a&#39;</span><span class="op" id="6785237">)</span><span class="op" id="6785238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785244">d</span>&nbsp;<span class="op" id="6785246">:=</span>&nbsp;<span class="ident" id="6785249">time</span><span class="op" id="6785253">.</span><span class="ident" id="6785254">Since</span><span class="op" id="6785259">(</span><span class="ident" id="6785260">t0</span><span class="op" id="6785262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785268">c</span><span class="op" id="6785269">.</span><span class="ident" id="6785270">Close</span><span class="op" id="6785275">(</span><span class="op" id="6785276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785282">servec</span>&nbsp;<span class="op" id="6785289">&lt;-</span>&nbsp;<span class="ident" id="6785292">copyRes</span><span class="op" id="6785299">{</span><span class="ident" id="6785300">n</span><span class="op" id="6785301">,</span>&nbsp;<span class="ident" id="6785303">err</span><span class="op" id="6785306">,</span>&nbsp;<span class="ident" id="6785308">d</span><span class="op" id="6785309">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785314">}</span><span class="op" id="6785315">(</span><span class="op" id="6785316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785323">}</span><span class="op" id="6785324">(</span><span class="op" id="6785325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785329">for</span>&nbsp;<span class="ident" id="6785333">_</span><span class="op" id="6785334">,</span>&nbsp;<span class="ident" id="6785336">timeout</span>&nbsp;<span class="op" id="6785344">:=</span>&nbsp;<span class="keyword" id="6785347">range</span>&nbsp;<span class="op" id="6785353">[</span><span class="op" id="6785354">]</span><span class="ident" id="6785355">time</span><span class="op" id="6785359">.</span><span class="ident" id="6785360">Duration</span><span class="op" id="6785368">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785372">1</span>&nbsp;<span class="op" id="6785374">*</span>&nbsp;<span class="ident" id="6785376">time</span><span class="op" id="6785380">.</span><span class="ident" id="6785381">Nanosecond</span><span class="op" id="6785391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785395">2</span>&nbsp;<span class="op" id="6785397">*</span>&nbsp;<span class="ident" id="6785399">time</span><span class="op" id="6785403">.</span><span class="ident" id="6785404">Nanosecond</span><span class="op" id="6785414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785418">5</span>&nbsp;<span class="op" id="6785420">*</span>&nbsp;<span class="ident" id="6785422">time</span><span class="op" id="6785426">.</span><span class="ident" id="6785427">Nanosecond</span><span class="op" id="6785437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785441">50</span>&nbsp;<span class="op" id="6785444">*</span>&nbsp;<span class="ident" id="6785446">time</span><span class="op" id="6785450">.</span><span class="ident" id="6785451">Nanosecond</span><span class="op" id="6785461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785465">100</span>&nbsp;<span class="op" id="6785469">*</span>&nbsp;<span class="ident" id="6785471">time</span><span class="op" id="6785475">.</span><span class="ident" id="6785476">Nanosecond</span><span class="op" id="6785486">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785490">200</span>&nbsp;<span class="op" id="6785494">*</span>&nbsp;<span class="ident" id="6785496">time</span><span class="op" id="6785500">.</span><span class="ident" id="6785501">Nanosecond</span><span class="op" id="6785511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785515">500</span>&nbsp;<span class="op" id="6785519">*</span>&nbsp;<span class="ident" id="6785521">time</span><span class="op" id="6785525">.</span><span class="ident" id="6785526">Nanosecond</span><span class="op" id="6785536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785540">750</span>&nbsp;<span class="op" id="6785544">*</span>&nbsp;<span class="ident" id="6785546">time</span><span class="op" id="6785550">.</span><span class="ident" id="6785551">Nanosecond</span><span class="op" id="6785561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785565">1</span>&nbsp;<span class="op" id="6785567">*</span>&nbsp;<span class="ident" id="6785569">time</span><span class="op" id="6785573">.</span><span class="ident" id="6785574">Microsecond</span><span class="op" id="6785585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785589">5</span>&nbsp;<span class="op" id="6785591">*</span>&nbsp;<span class="ident" id="6785593">time</span><span class="op" id="6785597">.</span><span class="ident" id="6785598">Microsecond</span><span class="op" id="6785609">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785613">25</span>&nbsp;<span class="op" id="6785616">*</span>&nbsp;<span class="ident" id="6785618">time</span><span class="op" id="6785622">.</span><span class="ident" id="6785623">Microsecond</span><span class="op" id="6785634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785638">250</span>&nbsp;<span class="op" id="6785642">*</span>&nbsp;<span class="ident" id="6785644">time</span><span class="op" id="6785648">.</span><span class="ident" id="6785649">Microsecond</span><span class="op" id="6785660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785664">500</span>&nbsp;<span class="op" id="6785668">*</span>&nbsp;<span class="ident" id="6785670">time</span><span class="op" id="6785674">.</span><span class="ident" id="6785675">Microsecond</span><span class="op" id="6785686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785690">1</span>&nbsp;<span class="op" id="6785692">*</span>&nbsp;<span class="ident" id="6785694">time</span><span class="op" id="6785698">.</span><span class="ident" id="6785699">Millisecond</span><span class="op" id="6785710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785714">5</span>&nbsp;<span class="op" id="6785716">*</span>&nbsp;<span class="ident" id="6785718">time</span><span class="op" id="6785722">.</span><span class="ident" id="6785723">Millisecond</span><span class="op" id="6785734">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785738">100</span>&nbsp;<span class="op" id="6785742">*</span>&nbsp;<span class="ident" id="6785744">time</span><span class="op" id="6785748">.</span><span class="ident" id="6785749">Millisecond</span><span class="op" id="6785760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785764">250</span>&nbsp;<span class="op" id="6785768">*</span>&nbsp;<span class="ident" id="6785770">time</span><span class="op" id="6785774">.</span><span class="ident" id="6785775">Millisecond</span><span class="op" id="6785786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785790">500</span>&nbsp;<span class="op" id="6785794">*</span>&nbsp;<span class="ident" id="6785796">time</span><span class="op" id="6785800">.</span><span class="ident" id="6785801">Millisecond</span><span class="op" id="6785812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6785816">1</span>&nbsp;<span class="op" id="6785818">*</span>&nbsp;<span class="ident" id="6785820">time</span><span class="op" id="6785824">.</span><span class="ident" id="6785825">Second</span><span class="op" id="6785831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785834">}</span>&nbsp;<span class="op" id="6785836">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785840">numRuns</span>&nbsp;<span class="op" id="6785848">:=</span>&nbsp;<span class="num" id="6785851">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785855">if</span>&nbsp;<span class="ident" id="6785858">testing</span><span class="op" id="6785865">.</span><span class="ident" id="6785866">Short</span><span class="op" id="6785871">(</span><span class="op" id="6785872">)</span>&nbsp;<span class="op" id="6785874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785879">numRuns</span>&nbsp;<span class="op" id="6785887">=</span>&nbsp;<span class="num" id="6785889">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785894">if</span>&nbsp;<span class="ident" id="6785897">timeout</span>&nbsp;<span class="op" id="6785905">&gt;</span>&nbsp;<span class="num" id="6785907">500</span><span class="op" id="6785910">*</span><span class="ident" id="6785911">time</span><span class="op" id="6785915">.</span><span class="ident" id="6785916">Microsecond</span>&nbsp;<span class="op" id="6785928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785934">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6785950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6785954">for</span>&nbsp;<span class="ident" id="6785958">run</span>&nbsp;<span class="op" id="6785962">:=</span>&nbsp;<span class="num" id="6785965">0</span><span class="op" id="6785966">;</span>&nbsp;<span class="ident" id="6785968">run</span>&nbsp;<span class="op" id="6785972">&lt;</span>&nbsp;<span class="ident" id="6785974">numRuns</span><span class="op" id="6785981">;</span>&nbsp;<span class="ident" id="6785983">run</span><span class="op" id="6785986">++</span>&nbsp;<span class="op" id="6785989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6785994">name</span>&nbsp;<span class="op" id="6785999">:=</span>&nbsp;<span class="ident" id="6786002">fmt</span><span class="op" id="6786005">.</span><span class="ident" id="6786006">Sprintf</span><span class="op" id="6786013">(</span><span class="string" id="6786014">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="6786028">,</span>&nbsp;<span class="ident" id="6786030">timeout</span><span class="op" id="6786037">,</span>&nbsp;<span class="ident" id="6786039">run</span><span class="op" id="6786042">+</span><span class="num" id="6786043">1</span><span class="op" id="6786044">,</span>&nbsp;<span class="ident" id="6786046">numRuns</span><span class="op" id="6786053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786058">t</span><span class="op" id="6786059">.</span><span class="ident" id="6786060">Log</span><span class="op" id="6786063">(</span><span class="ident" id="6786064">name</span><span class="op" id="6786068">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786074">c</span><span class="op" id="6786075">,</span>&nbsp;<span class="ident" id="6786077">err</span>&nbsp;<span class="op" id="6786081">:=</span>&nbsp;<span class="ident" id="6786084">Dial</span><span class="op" id="6786088">(</span><span class="string" id="6786089">&#34;tcp&#34;</span><span class="op" id="6786094">,</span>&nbsp;<span class="ident" id="6786096">ln</span><span class="op" id="6786098">.</span><span class="ident" id="6786099">Addr</span><span class="op" id="6786103">(</span><span class="op" id="6786104">)</span><span class="op" id="6786105">.</span><span class="ident" id="6786106">String</span><span class="op" id="6786112">(</span><span class="op" id="6786113">)</span><span class="op" id="6786114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786119">if</span>&nbsp;<span class="ident" id="6786122">err</span>&nbsp;<span class="op" id="6786126">!=</span>&nbsp;<span class="builtintype" id="6786129">nil</span>&nbsp;<span class="op" id="6786133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786139">t</span><span class="op" id="6786140">.</span><span class="ident" id="6786141">Fatalf</span><span class="op" id="6786147">(</span><span class="string" id="6786148">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6786158">,</span>&nbsp;<span class="ident" id="6786160">err</span><span class="op" id="6786163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6786168">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786173">clientc</span>&nbsp;<span class="op" id="6786181">:=</span>&nbsp;<span class="builtinfunc" id="6786184">make</span><span class="op" id="6786188">(</span><span class="keyword" id="6786189">chan</span>&nbsp;<span class="ident" id="6786194">copyRes</span><span class="op" id="6786201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786206">go</span>&nbsp;<span class="keyword" id="6786209">func</span><span class="op" id="6786213">(</span><span class="op" id="6786214">)</span>&nbsp;<span class="op" id="6786216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786222">t0</span>&nbsp;<span class="op" id="6786225">:=</span>&nbsp;<span class="ident" id="6786228">time</span><span class="op" id="6786232">.</span><span class="ident" id="6786233">Now</span><span class="op" id="6786236">(</span><span class="op" id="6786237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786243">c</span><span class="op" id="6786244">.</span><span class="ident" id="6786245">SetDeadline</span><span class="op" id="6786256">(</span><span class="ident" id="6786257">t0</span><span class="op" id="6786259">.</span><span class="ident" id="6786260">Add</span><span class="op" id="6786263">(</span><span class="ident" id="6786264">timeout</span><span class="op" id="6786271">)</span><span class="op" id="6786272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786278">n</span><span class="op" id="6786279">,</span>&nbsp;<span class="ident" id="6786281">err</span>&nbsp;<span class="op" id="6786285">:=</span>&nbsp;<span class="ident" id="6786288">io</span><span class="op" id="6786290">.</span><span class="ident" id="6786291">Copy</span><span class="op" id="6786295">(</span><span class="ident" id="6786296">ioutil</span><span class="op" id="6786302">.</span><span class="ident" id="6786303">Discard</span><span class="op" id="6786310">,</span>&nbsp;<span class="ident" id="6786312">c</span><span class="op" id="6786313">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786319">d</span>&nbsp;<span class="op" id="6786321">:=</span>&nbsp;<span class="ident" id="6786324">time</span><span class="op" id="6786328">.</span><span class="ident" id="6786329">Since</span><span class="op" id="6786334">(</span><span class="ident" id="6786335">t0</span><span class="op" id="6786337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786343">c</span><span class="op" id="6786344">.</span><span class="ident" id="6786345">Close</span><span class="op" id="6786350">(</span><span class="op" id="6786351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786357">clientc</span>&nbsp;<span class="op" id="6786365">&lt;-</span>&nbsp;<span class="ident" id="6786368">copyRes</span><span class="op" id="6786375">{</span><span class="ident" id="6786376">n</span><span class="op" id="6786377">,</span>&nbsp;<span class="ident" id="6786379">err</span><span class="op" id="6786382">,</span>&nbsp;<span class="ident" id="6786384">d</span><span class="op" id="6786385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6786390">}</span><span class="op" id="6786391">(</span><span class="op" id="6786392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786398">tooLong</span>&nbsp;<span class="op" id="6786406">:=</span>&nbsp;<span class="num" id="6786409">5</span>&nbsp;<span class="op" id="6786411">*</span>&nbsp;<span class="ident" id="6786413">time</span><span class="op" id="6786417">.</span><span class="ident" id="6786418">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786428">select</span>&nbsp;<span class="op" id="6786435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786440">case</span>&nbsp;<span class="ident" id="6786445">res</span>&nbsp;<span class="op" id="6786449">:=</span>&nbsp;<span class="op" id="6786452">&lt;-</span><span class="ident" id="6786454">clientc</span><span class="op" id="6786461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786467">if</span>&nbsp;<span class="ident" id="6786470">isTimeout</span><span class="op" id="6786479">(</span><span class="ident" id="6786480">res</span><span class="op" id="6786483">.</span><span class="ident" id="6786484">err</span><span class="op" id="6786487">)</span>&nbsp;<span class="op" id="6786489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786496">t</span><span class="op" id="6786497">.</span><span class="ident" id="6786498">Logf</span><span class="op" id="6786502">(</span><span class="string" id="6786503">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6786559">,</span>&nbsp;<span class="ident" id="6786561">name</span><span class="op" id="6786565">,</span>&nbsp;<span class="ident" id="6786567">res</span><span class="op" id="6786570">.</span><span class="ident" id="6786571">d</span><span class="op" id="6786572">,</span>&nbsp;<span class="ident" id="6786574">res</span><span class="op" id="6786577">.</span><span class="ident" id="6786578">n</span><span class="op" id="6786579">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6786585">}</span>&nbsp;<span class="keyword" id="6786587">else</span>&nbsp;<span class="op" id="6786592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786599">t</span><span class="op" id="6786600">.</span><span class="ident" id="6786601">Fatalf</span><span class="op" id="6786607">(</span><span class="string" id="6786608">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="6786653">,</span>&nbsp;<span class="ident" id="6786655">name</span><span class="op" id="6786659">,</span>&nbsp;<span class="ident" id="6786661">res</span><span class="op" id="6786664">.</span><span class="ident" id="6786665">n</span><span class="op" id="6786666">,</span>&nbsp;<span class="ident" id="6786668">res</span><span class="op" id="6786671">.</span><span class="ident" id="6786672">err</span><span class="op" id="6786675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6786681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786686">case</span>&nbsp;<span class="op" id="6786691">&lt;-</span><span class="ident" id="6786693">time</span><span class="op" id="6786697">.</span><span class="ident" id="6786698">After</span><span class="op" id="6786703">(</span><span class="ident" id="6786704">tooLong</span><span class="op" id="6786711">)</span><span class="op" id="6786712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786718">t</span><span class="op" id="6786719">.</span><span class="ident" id="6786720">Fatalf</span><span class="op" id="6786726">(</span><span class="string" id="6786727">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="6786792">,</span>&nbsp;<span class="ident" id="6786794">name</span><span class="op" id="6786798">,</span>&nbsp;<span class="ident" id="6786800">tooLong</span><span class="op" id="6786807">,</span>&nbsp;<span class="ident" id="6786809">timeout</span><span class="op" id="6786816">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6786821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786827">select</span>&nbsp;<span class="op" id="6786834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786839">case</span>&nbsp;<span class="ident" id="6786844">res</span>&nbsp;<span class="op" id="6786848">:=</span>&nbsp;<span class="op" id="6786851">&lt;-</span><span class="ident" id="6786853">servec</span><span class="op" id="6786859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786865">t</span><span class="op" id="6786866">.</span><span class="ident" id="6786867">Logf</span><span class="op" id="6786871">(</span><span class="string" id="6786872">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="6786907">,</span>&nbsp;<span class="ident" id="6786909">name</span><span class="op" id="6786913">,</span>&nbsp;<span class="ident" id="6786915">res</span><span class="op" id="6786918">.</span><span class="ident" id="6786919">d</span><span class="op" id="6786920">,</span>&nbsp;<span class="ident" id="6786922">res</span><span class="op" id="6786925">.</span><span class="ident" id="6786926">n</span><span class="op" id="6786927">,</span>&nbsp;<span class="ident" id="6786929">res</span><span class="op" id="6786932">.</span><span class="ident" id="6786933">err</span><span class="op" id="6786936">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6786941">case</span>&nbsp;<span class="ident" id="6786946">err</span>&nbsp;<span class="op" id="6786950">:=</span>&nbsp;<span class="op" id="6786953">&lt;-</span><span class="ident" id="6786955">acceptc</span><span class="op" id="6786962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6786968">t</span><span class="op" id="6786969">.</span><span class="ident" id="6786970">Fatalf</span><span class="op" id="6786976">(</span><span class="string" id="6786977">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6787005">,</span>&nbsp;<span class="ident" id="6787007">name</span><span class="op" id="6787011">,</span>&nbsp;<span class="ident" id="6787013">err</span><span class="op" id="6787016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787021">case</span>&nbsp;<span class="op" id="6787026">&lt;-</span><span class="ident" id="6787028">time</span><span class="op" id="6787032">.</span><span class="ident" id="6787033">After</span><span class="op" id="6787038">(</span><span class="ident" id="6787039">tooLong</span><span class="op" id="6787046">)</span><span class="op" id="6787047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787053">t</span><span class="op" id="6787054">.</span><span class="ident" id="6787055">Fatalf</span><span class="op" id="6787061">(</span><span class="string" id="6787062">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="6787116">,</span>&nbsp;<span class="ident" id="6787118">name</span><span class="op" id="6787122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787127">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787134">}</span><br>
<span class="lineno"></span><span class="op" id="6787136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6787139">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="6787209">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6787246">func</span>&nbsp;<span class="ident" id="6787251">TestReadDeadlineDataAvailable</span><span class="op" id="6787280">(</span><span class="ident" id="6787281">t</span>&nbsp;<span class="op" id="6787283">*</span><span class="ident" id="6787284">testing</span><span class="op" id="6787291">.</span><span class="ident" id="6787292">T</span><span class="op" id="6787293">)</span>&nbsp;<span class="op" id="6787295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787298">switch</span>&nbsp;<span class="ident" id="6787305">runtime</span><span class="op" id="6787312">.</span><span class="ident" id="6787313">GOOS</span>&nbsp;<span class="op" id="6787318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787321">case</span>&nbsp;<span class="string" id="6787326">&#34;plan9&#34;</span><span class="op" id="6787333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787337">t</span><span class="op" id="6787338">.</span><span class="ident" id="6787339">Skipf</span><span class="op" id="6787344">(</span><span class="string" id="6787345">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6787366">,</span>&nbsp;<span class="ident" id="6787368">runtime</span><span class="op" id="6787375">.</span><span class="ident" id="6787376">GOOS</span><span class="op" id="6787380">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787387">ln</span>&nbsp;<span class="op" id="6787390">:=</span>&nbsp;<span class="ident" id="6787393">newLocalListener</span><span class="op" id="6787409">(</span><span class="ident" id="6787410">t</span><span class="op" id="6787411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787414">defer</span>&nbsp;<span class="ident" id="6787420">ln</span><span class="op" id="6787422">.</span><span class="ident" id="6787423">Close</span><span class="op" id="6787428">(</span><span class="op" id="6787429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787433">servec</span>&nbsp;<span class="op" id="6787440">:=</span>&nbsp;<span class="builtinfunc" id="6787443">make</span><span class="op" id="6787447">(</span><span class="keyword" id="6787448">chan</span>&nbsp;<span class="ident" id="6787453">copyRes</span><span class="op" id="6787460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787463">const</span>&nbsp;<span class="ident" id="6787469">msg</span>&nbsp;<span class="op" id="6787473">=</span>&nbsp;<span class="string" id="6787475">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787535">go</span>&nbsp;<span class="keyword" id="6787538">func</span><span class="op" id="6787542">(</span><span class="op" id="6787543">)</span>&nbsp;<span class="op" id="6787545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787549">c</span><span class="op" id="6787550">,</span>&nbsp;<span class="ident" id="6787552">err</span>&nbsp;<span class="op" id="6787556">:=</span>&nbsp;<span class="ident" id="6787559">ln</span><span class="op" id="6787561">.</span><span class="ident" id="6787562">Accept</span><span class="op" id="6787568">(</span><span class="op" id="6787569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787573">if</span>&nbsp;<span class="ident" id="6787576">err</span>&nbsp;<span class="op" id="6787580">!=</span>&nbsp;<span class="builtintype" id="6787583">nil</span>&nbsp;<span class="op" id="6787587">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787592">t</span><span class="op" id="6787593">.</span><span class="ident" id="6787594">Errorf</span><span class="op" id="6787600">(</span><span class="string" id="6787601">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6787613">,</span>&nbsp;<span class="ident" id="6787615">err</span><span class="op" id="6787618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787636">defer</span>&nbsp;<span class="ident" id="6787642">c</span><span class="op" id="6787643">.</span><span class="ident" id="6787644">Close</span><span class="op" id="6787649">(</span><span class="op" id="6787650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787654">n</span><span class="op" id="6787655">,</span>&nbsp;<span class="ident" id="6787657">err</span>&nbsp;<span class="op" id="6787661">:=</span>&nbsp;<span class="ident" id="6787664">c</span><span class="op" id="6787665">.</span><span class="ident" id="6787666">Write</span><span class="op" id="6787671">(</span><span class="op" id="6787672">[</span><span class="op" id="6787673">]</span><span class="builtintype" id="6787674">byte</span><span class="op" id="6787678">(</span><span class="ident" id="6787679">msg</span><span class="op" id="6787682">)</span><span class="op" id="6787683">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787687">servec</span>&nbsp;<span class="op" id="6787694">&lt;-</span>&nbsp;<span class="ident" id="6787697">copyRes</span><span class="op" id="6787704">{</span><span class="ident" id="6787705">n</span><span class="op" id="6787706">:</span>&nbsp;<span class="builtintype" id="6787708">int64</span><span class="op" id="6787713">(</span><span class="ident" id="6787714">n</span><span class="op" id="6787715">)</span><span class="op" id="6787716">,</span>&nbsp;<span class="ident" id="6787718">err</span><span class="op" id="6787721">:</span>&nbsp;<span class="ident" id="6787723">err</span><span class="op" id="6787726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787729">}</span><span class="op" id="6787730">(</span><span class="op" id="6787731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787735">c</span><span class="op" id="6787736">,</span>&nbsp;<span class="ident" id="6787738">err</span>&nbsp;<span class="op" id="6787742">:=</span>&nbsp;<span class="ident" id="6787745">Dial</span><span class="op" id="6787749">(</span><span class="string" id="6787750">&#34;tcp&#34;</span><span class="op" id="6787755">,</span>&nbsp;<span class="ident" id="6787757">ln</span><span class="op" id="6787759">.</span><span class="ident" id="6787760">Addr</span><span class="op" id="6787764">(</span><span class="op" id="6787765">)</span><span class="op" id="6787766">.</span><span class="ident" id="6787767">String</span><span class="op" id="6787773">(</span><span class="op" id="6787774">)</span><span class="op" id="6787775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787778">if</span>&nbsp;<span class="ident" id="6787781">err</span>&nbsp;<span class="op" id="6787785">!=</span>&nbsp;<span class="builtintype" id="6787788">nil</span>&nbsp;<span class="op" id="6787792">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787796">t</span><span class="op" id="6787797">.</span><span class="ident" id="6787798">Fatalf</span><span class="op" id="6787804">(</span><span class="string" id="6787805">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6787815">,</span>&nbsp;<span class="ident" id="6787817">err</span><span class="op" id="6787820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6787823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787826">defer</span>&nbsp;<span class="ident" id="6787832">c</span><span class="op" id="6787833">.</span><span class="ident" id="6787834">Close</span><span class="op" id="6787839">(</span><span class="op" id="6787840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6787843">if</span>&nbsp;<span class="ident" id="6787846">res</span>&nbsp;<span class="op" id="6787850">:=</span>&nbsp;<span class="op" id="6787853">&lt;-</span><span class="ident" id="6787855">servec</span><span class="op" id="6787861">;</span>&nbsp;<span class="ident" id="6787863">res</span><span class="op" id="6787866">.</span><span class="ident" id="6787867">err</span>&nbsp;<span class="op" id="6787871">!=</span>&nbsp;<span class="builtintype" id="6787874">nil</span>&nbsp;<span class="op" id="6787878">||</span>&nbsp;<span class="ident" id="6787881">res</span><span class="op" id="6787884">.</span><span class="ident" id="6787885">n</span>&nbsp;<span class="op" id="6787887">!=</span>&nbsp;<span class="builtintype" id="6787890">int64</span><span class="op" id="6787895">(</span><span class="builtinfunc" id="6787896">len</span><span class="op" id="6787899">(</span><span class="ident" id="6787900">msg</span><span class="op" id="6787903">)</span><span class="op" id="6787904">)</span>&nbsp;<span class="op" id="6787906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6787910">t</span><span class="op" id="6787911">.</span><span class="ident" id="6787912">Fatalf</span><span class="op" id="6787918">(</span><span class="string" id="6787919">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="6787978">,</span>&nbsp;<span class="ident" id="6787980">res</span><span class="op" id="6787983">.</span><span class="ident" id="6787984">n</span><span class="op" id="6787985">,</span>&nbsp;<span class="ident" id="6787987">res</span><span class="op" id="6787990">.</span><span class="ident" id="6787991">err</span><span class="op" id="6787994">,</span>&nbsp;<span class="builtinfunc" id="6787996">len</span><span class="op" id="6787999">(</span><span class="ident" id="6788000">msg</span><span class="op" id="6788003">)</span><span class="op" id="6788004">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788010">c</span><span class="op" id="6788011">.</span><span class="ident" id="6788012">SetReadDeadline</span><span class="op" id="6788027">(</span><span class="ident" id="6788028">time</span><span class="op" id="6788032">.</span><span class="ident" id="6788033">Now</span><span class="op" id="6788036">(</span><span class="op" id="6788037">)</span><span class="op" id="6788038">.</span><span class="ident" id="6788039">Add</span><span class="op" id="6788042">(</span><span class="op" id="6788043">-</span><span class="num" id="6788044">5</span>&nbsp;<span class="op" id="6788046">*</span>&nbsp;<span class="ident" id="6788048">time</span><span class="op" id="6788052">.</span><span class="ident" id="6788053">Second</span><span class="op" id="6788059">)</span><span class="op" id="6788060">)</span>&nbsp;<span class="comment" id="6788062">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788079">buf</span>&nbsp;<span class="op" id="6788083">:=</span>&nbsp;<span class="builtinfunc" id="6788086">make</span><span class="op" id="6788090">(</span><span class="op" id="6788091">[</span><span class="op" id="6788092">]</span><span class="builtintype" id="6788093">byte</span><span class="op" id="6788097">,</span>&nbsp;<span class="builtinfunc" id="6788099">len</span><span class="op" id="6788102">(</span><span class="ident" id="6788103">msg</span><span class="op" id="6788106">)</span><span class="op" id="6788107">/</span><span class="num" id="6788108">2</span><span class="op" id="6788109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788112">n</span><span class="op" id="6788113">,</span>&nbsp;<span class="ident" id="6788115">err</span>&nbsp;<span class="op" id="6788119">:=</span>&nbsp;<span class="ident" id="6788122">c</span><span class="op" id="6788123">.</span><span class="ident" id="6788124">Read</span><span class="op" id="6788128">(</span><span class="ident" id="6788129">buf</span><span class="op" id="6788132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788135">if</span>&nbsp;<span class="ident" id="6788138">n</span>&nbsp;<span class="op" id="6788140">&gt;</span>&nbsp;<span class="num" id="6788142">0</span>&nbsp;<span class="op" id="6788144">||</span>&nbsp;<span class="op" id="6788147">!</span><span class="ident" id="6788148">isTimeout</span><span class="op" id="6788157">(</span><span class="ident" id="6788158">err</span><span class="op" id="6788161">)</span>&nbsp;<span class="op" id="6788163">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788167">t</span><span class="op" id="6788168">.</span><span class="ident" id="6788169">Fatalf</span><span class="op" id="6788175">(</span><span class="string" id="6788176">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="6788223">,</span>&nbsp;<span class="ident" id="6788225">n</span><span class="op" id="6788226">,</span>&nbsp;<span class="ident" id="6788228">buf</span><span class="op" id="6788231">[</span><span class="op" id="6788232">:</span><span class="ident" id="6788233">n</span><span class="op" id="6788234">]</span><span class="op" id="6788235">,</span>&nbsp;<span class="ident" id="6788237">err</span><span class="op" id="6788240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788243">}</span><br>
<span class="lineno"></span><span class="op" id="6788245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6788248">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="6788322">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="6788369">func</span>&nbsp;<span class="ident" id="6788374">TestWriteDeadlineBufferAvailable</span><span class="op" id="6788406">(</span><span class="ident" id="6788407">t</span>&nbsp;<span class="op" id="6788409">*</span><span class="ident" id="6788410">testing</span><span class="op" id="6788417">.</span><span class="ident" id="6788418">T</span><span class="op" id="6788419">)</span>&nbsp;<span class="op" id="6788421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788424">switch</span>&nbsp;<span class="ident" id="6788431">runtime</span><span class="op" id="6788438">.</span><span class="ident" id="6788439">GOOS</span>&nbsp;<span class="op" id="6788444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788447">case</span>&nbsp;<span class="string" id="6788452">&#34;plan9&#34;</span><span class="op" id="6788459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788463">t</span><span class="op" id="6788464">.</span><span class="ident" id="6788465">Skipf</span><span class="op" id="6788470">(</span><span class="string" id="6788471">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6788492">,</span>&nbsp;<span class="ident" id="6788494">runtime</span><span class="op" id="6788501">.</span><span class="ident" id="6788502">GOOS</span><span class="op" id="6788506">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788513">ln</span>&nbsp;<span class="op" id="6788516">:=</span>&nbsp;<span class="ident" id="6788519">newLocalListener</span><span class="op" id="6788535">(</span><span class="ident" id="6788536">t</span><span class="op" id="6788537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788540">defer</span>&nbsp;<span class="ident" id="6788546">ln</span><span class="op" id="6788548">.</span><span class="ident" id="6788549">Close</span><span class="op" id="6788554">(</span><span class="op" id="6788555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788559">servec</span>&nbsp;<span class="op" id="6788566">:=</span>&nbsp;<span class="builtinfunc" id="6788569">make</span><span class="op" id="6788573">(</span><span class="keyword" id="6788574">chan</span>&nbsp;<span class="ident" id="6788579">copyRes</span><span class="op" id="6788586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788589">go</span>&nbsp;<span class="keyword" id="6788592">func</span><span class="op" id="6788596">(</span><span class="op" id="6788597">)</span>&nbsp;<span class="op" id="6788599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788603">c</span><span class="op" id="6788604">,</span>&nbsp;<span class="ident" id="6788606">err</span>&nbsp;<span class="op" id="6788610">:=</span>&nbsp;<span class="ident" id="6788613">ln</span><span class="op" id="6788615">.</span><span class="ident" id="6788616">Accept</span><span class="op" id="6788622">(</span><span class="op" id="6788623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788627">if</span>&nbsp;<span class="ident" id="6788630">err</span>&nbsp;<span class="op" id="6788634">!=</span>&nbsp;<span class="builtintype" id="6788637">nil</span>&nbsp;<span class="op" id="6788641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788646">t</span><span class="op" id="6788647">.</span><span class="ident" id="6788648">Errorf</span><span class="op" id="6788654">(</span><span class="string" id="6788655">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6788667">,</span>&nbsp;<span class="ident" id="6788669">err</span><span class="op" id="6788672">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788677">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788690">defer</span>&nbsp;<span class="ident" id="6788696">c</span><span class="op" id="6788697">.</span><span class="ident" id="6788698">Close</span><span class="op" id="6788703">(</span><span class="op" id="6788704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788708">c</span><span class="op" id="6788709">.</span><span class="ident" id="6788710">SetWriteDeadline</span><span class="op" id="6788726">(</span><span class="ident" id="6788727">time</span><span class="op" id="6788731">.</span><span class="ident" id="6788732">Now</span><span class="op" id="6788735">(</span><span class="op" id="6788736">)</span><span class="op" id="6788737">.</span><span class="ident" id="6788738">Add</span><span class="op" id="6788741">(</span><span class="op" id="6788742">-</span><span class="num" id="6788743">5</span>&nbsp;<span class="op" id="6788745">*</span>&nbsp;<span class="ident" id="6788747">time</span><span class="op" id="6788751">.</span><span class="ident" id="6788752">Second</span><span class="op" id="6788758">)</span><span class="op" id="6788759">)</span>&nbsp;<span class="comment" id="6788761">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788778">n</span><span class="op" id="6788779">,</span>&nbsp;<span class="ident" id="6788781">err</span>&nbsp;<span class="op" id="6788785">:=</span>&nbsp;<span class="ident" id="6788788">c</span><span class="op" id="6788789">.</span><span class="ident" id="6788790">Write</span><span class="op" id="6788795">(</span><span class="op" id="6788796">[</span><span class="op" id="6788797">]</span><span class="builtintype" id="6788798">byte</span><span class="op" id="6788802">{</span><span class="string" id="6788803">&#39;x&#39;</span><span class="op" id="6788806">}</span><span class="op" id="6788807">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788811">servec</span>&nbsp;<span class="op" id="6788818">&lt;-</span>&nbsp;<span class="ident" id="6788821">copyRes</span><span class="op" id="6788828">{</span><span class="ident" id="6788829">n</span><span class="op" id="6788830">:</span>&nbsp;<span class="builtintype" id="6788832">int64</span><span class="op" id="6788837">(</span><span class="ident" id="6788838">n</span><span class="op" id="6788839">)</span><span class="op" id="6788840">,</span>&nbsp;<span class="ident" id="6788842">err</span><span class="op" id="6788845">:</span>&nbsp;<span class="ident" id="6788847">err</span><span class="op" id="6788850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788853">}</span><span class="op" id="6788854">(</span><span class="op" id="6788855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788859">c</span><span class="op" id="6788860">,</span>&nbsp;<span class="ident" id="6788862">err</span>&nbsp;<span class="op" id="6788866">:=</span>&nbsp;<span class="ident" id="6788869">Dial</span><span class="op" id="6788873">(</span><span class="string" id="6788874">&#34;tcp&#34;</span><span class="op" id="6788879">,</span>&nbsp;<span class="ident" id="6788881">ln</span><span class="op" id="6788883">.</span><span class="ident" id="6788884">Addr</span><span class="op" id="6788888">(</span><span class="op" id="6788889">)</span><span class="op" id="6788890">.</span><span class="ident" id="6788891">String</span><span class="op" id="6788897">(</span><span class="op" id="6788898">)</span><span class="op" id="6788899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788902">if</span>&nbsp;<span class="ident" id="6788905">err</span>&nbsp;<span class="op" id="6788909">!=</span>&nbsp;<span class="builtintype" id="6788912">nil</span>&nbsp;<span class="op" id="6788916">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788920">t</span><span class="op" id="6788921">.</span><span class="ident" id="6788922">Fatalf</span><span class="op" id="6788928">(</span><span class="string" id="6788929">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6788939">,</span>&nbsp;<span class="ident" id="6788941">err</span><span class="op" id="6788944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6788947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788950">defer</span>&nbsp;<span class="ident" id="6788956">c</span><span class="op" id="6788957">.</span><span class="ident" id="6788958">Close</span><span class="op" id="6788963">(</span><span class="op" id="6788964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6788967">res</span>&nbsp;<span class="op" id="6788971">:=</span>&nbsp;<span class="op" id="6788974">&lt;-</span><span class="ident" id="6788976">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6788984">if</span>&nbsp;<span class="ident" id="6788987">res</span><span class="op" id="6788990">.</span><span class="ident" id="6788991">n</span>&nbsp;<span class="op" id="6788993">!=</span>&nbsp;<span class="num" id="6788996">0</span>&nbsp;<span class="op" id="6788998">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789002">t</span><span class="op" id="6789003">.</span><span class="ident" id="6789004">Errorf</span><span class="op" id="6789010">(</span><span class="string" id="6789011">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6789031">,</span>&nbsp;<span class="ident" id="6789033">res</span><span class="op" id="6789036">.</span><span class="ident" id="6789037">n</span><span class="op" id="6789038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789044">if</span>&nbsp;<span class="op" id="6789047">!</span><span class="ident" id="6789048">isTimeout</span><span class="op" id="6789057">(</span><span class="ident" id="6789058">res</span><span class="op" id="6789061">.</span><span class="ident" id="6789062">err</span><span class="op" id="6789065">)</span>&nbsp;<span class="op" id="6789067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789071">t</span><span class="op" id="6789072">.</span><span class="ident" id="6789073">Errorf</span><span class="op" id="6789079">(</span><span class="string" id="6789080">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6789112">,</span>&nbsp;<span class="ident" id="6789114">res</span><span class="op" id="6789117">.</span><span class="ident" id="6789118">err</span><span class="op" id="6789121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789124">}</span><br>
<span class="lineno">600</span><span class="op" id="6789126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6789129">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="6789209">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="6789255">func</span>&nbsp;<span class="ident" id="6789260">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="6789297">(</span><span class="ident" id="6789298">t</span>&nbsp;<span class="op" id="6789300">*</span><span class="ident" id="6789301">testing</span><span class="op" id="6789308">.</span><span class="ident" id="6789309">T</span><span class="op" id="6789310">)</span>&nbsp;<span class="op" id="6789312">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789315">switch</span>&nbsp;<span class="ident" id="6789322">runtime</span><span class="op" id="6789329">.</span><span class="ident" id="6789330">GOOS</span>&nbsp;<span class="op" id="6789335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789338">case</span>&nbsp;<span class="string" id="6789343">&#34;plan9&#34;</span><span class="op" id="6789350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789354">t</span><span class="op" id="6789355">.</span><span class="ident" id="6789356">Skipf</span><span class="op" id="6789361">(</span><span class="string" id="6789362">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6789383">,</span>&nbsp;<span class="ident" id="6789385">runtime</span><span class="op" id="6789392">.</span><span class="ident" id="6789393">GOOS</span><span class="op" id="6789397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789404">ln</span>&nbsp;<span class="op" id="6789407">:=</span>&nbsp;<span class="ident" id="6789410">newLocalListener</span><span class="op" id="6789426">(</span><span class="ident" id="6789427">t</span><span class="op" id="6789428">)</span><span class="op" id="6789429">.</span><span class="op" id="6789430">(</span><span class="op" id="6789431">*</span><span class="ident" id="6789432">TCPListener</span><span class="op" id="6789443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789446">defer</span>&nbsp;<span class="ident" id="6789452">ln</span><span class="op" id="6789454">.</span><span class="ident" id="6789455">Close</span><span class="op" id="6789460">(</span><span class="op" id="6789461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789465">go</span>&nbsp;<span class="keyword" id="6789468">func</span><span class="op" id="6789472">(</span><span class="op" id="6789473">)</span>&nbsp;<span class="op" id="6789475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789479">c</span><span class="op" id="6789480">,</span>&nbsp;<span class="ident" id="6789482">err</span>&nbsp;<span class="op" id="6789486">:=</span>&nbsp;<span class="ident" id="6789489">Dial</span><span class="op" id="6789493">(</span><span class="string" id="6789494">&#34;tcp&#34;</span><span class="op" id="6789499">,</span>&nbsp;<span class="ident" id="6789501">ln</span><span class="op" id="6789503">.</span><span class="ident" id="6789504">Addr</span><span class="op" id="6789508">(</span><span class="op" id="6789509">)</span><span class="op" id="6789510">.</span><span class="ident" id="6789511">String</span><span class="op" id="6789517">(</span><span class="op" id="6789518">)</span><span class="op" id="6789519">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789523">if</span>&nbsp;<span class="ident" id="6789526">err</span>&nbsp;<span class="op" id="6789530">!=</span>&nbsp;<span class="builtintype" id="6789533">nil</span>&nbsp;<span class="op" id="6789537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789542">t</span><span class="op" id="6789543">.</span><span class="ident" id="6789544">Errorf</span><span class="op" id="6789550">(</span><span class="string" id="6789551">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6789561">,</span>&nbsp;<span class="ident" id="6789563">err</span><span class="op" id="6789566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789571">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789584">defer</span>&nbsp;<span class="ident" id="6789590">c</span><span class="op" id="6789591">.</span><span class="ident" id="6789592">Close</span><span class="op" id="6789597">(</span><span class="op" id="6789598">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789602">var</span>&nbsp;<span class="ident" id="6789606">buf</span>&nbsp;<span class="op" id="6789610">[</span><span class="num" id="6789611">1</span><span class="op" id="6789612">]</span><span class="builtintype" id="6789613">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789620">c</span><span class="op" id="6789621">.</span><span class="ident" id="6789622">Read</span><span class="op" id="6789626">(</span><span class="ident" id="6789627">buf</span><span class="op" id="6789630">[</span><span class="op" id="6789631">:</span><span class="op" id="6789632">]</span><span class="op" id="6789633">)</span>&nbsp;<span class="comment" id="6789635">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789688">}</span><span class="op" id="6789689">(</span><span class="op" id="6789690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789693">time</span><span class="op" id="6789697">.</span><span class="ident" id="6789698">Sleep</span><span class="op" id="6789703">(</span><span class="num" id="6789704">10</span>&nbsp;<span class="op" id="6789707">*</span>&nbsp;<span class="ident" id="6789709">time</span><span class="op" id="6789713">.</span><span class="ident" id="6789714">Millisecond</span><span class="op" id="6789725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789728">ln</span><span class="op" id="6789730">.</span><span class="ident" id="6789731">SetDeadline</span><span class="op" id="6789742">(</span><span class="ident" id="6789743">time</span><span class="op" id="6789747">.</span><span class="ident" id="6789748">Now</span><span class="op" id="6789751">(</span><span class="op" id="6789752">)</span><span class="op" id="6789753">.</span><span class="ident" id="6789754">Add</span><span class="op" id="6789757">(</span><span class="op" id="6789758">-</span><span class="num" id="6789759">5</span>&nbsp;<span class="op" id="6789761">*</span>&nbsp;<span class="ident" id="6789763">time</span><span class="op" id="6789767">.</span><span class="ident" id="6789768">Second</span><span class="op" id="6789774">)</span><span class="op" id="6789775">)</span>&nbsp;<span class="comment" id="6789777">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789793">c</span><span class="op" id="6789794">,</span>&nbsp;<span class="ident" id="6789796">err</span>&nbsp;<span class="op" id="6789800">:=</span>&nbsp;<span class="ident" id="6789803">ln</span><span class="op" id="6789805">.</span><span class="ident" id="6789806">Accept</span><span class="op" id="6789812">(</span><span class="op" id="6789813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789816">if</span>&nbsp;<span class="ident" id="6789819">err</span>&nbsp;<span class="op" id="6789823">==</span>&nbsp;<span class="builtintype" id="6789826">nil</span>&nbsp;<span class="op" id="6789830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789834">defer</span>&nbsp;<span class="ident" id="6789840">c</span><span class="op" id="6789841">.</span><span class="ident" id="6789842">Close</span><span class="op" id="6789847">(</span><span class="op" id="6789848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6789854">if</span>&nbsp;<span class="op" id="6789857">!</span><span class="ident" id="6789858">isTimeout</span><span class="op" id="6789867">(</span><span class="ident" id="6789868">err</span><span class="op" id="6789871">)</span>&nbsp;<span class="op" id="6789873">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789877">t</span><span class="op" id="6789878">.</span><span class="ident" id="6789879">Fatalf</span><span class="op" id="6789885">(</span><span class="string" id="6789886">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6789916">,</span>&nbsp;<span class="ident" id="6789918">err</span><span class="op" id="6789921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6789924">}</span><br>
<span class="lineno"></span><span class="op" id="6789926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6789929">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="6790001">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6790055">func</span>&nbsp;<span class="ident" id="6790060">TestConnectDeadlineInThePast</span><span class="op" id="6790088">(</span><span class="ident" id="6790089">t</span>&nbsp;<span class="op" id="6790091">*</span><span class="ident" id="6790092">testing</span><span class="op" id="6790099">.</span><span class="ident" id="6790100">T</span><span class="op" id="6790101">)</span>&nbsp;<span class="op" id="6790103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790106">switch</span>&nbsp;<span class="ident" id="6790113">runtime</span><span class="op" id="6790120">.</span><span class="ident" id="6790121">GOOS</span>&nbsp;<span class="op" id="6790126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790129">case</span>&nbsp;<span class="string" id="6790134">&#34;plan9&#34;</span><span class="op" id="6790141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790145">t</span><span class="op" id="6790146">.</span><span class="ident" id="6790147">Skipf</span><span class="op" id="6790152">(</span><span class="string" id="6790153">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6790174">,</span>&nbsp;<span class="ident" id="6790176">runtime</span><span class="op" id="6790183">.</span><span class="ident" id="6790184">GOOS</span><span class="op" id="6790188">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790195">ln</span>&nbsp;<span class="op" id="6790198">:=</span>&nbsp;<span class="ident" id="6790201">newLocalListener</span><span class="op" id="6790217">(</span><span class="ident" id="6790218">t</span><span class="op" id="6790219">)</span><span class="op" id="6790220">.</span><span class="op" id="6790221">(</span><span class="op" id="6790222">*</span><span class="ident" id="6790223">TCPListener</span><span class="op" id="6790234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790237">defer</span>&nbsp;<span class="ident" id="6790243">ln</span><span class="op" id="6790245">.</span><span class="ident" id="6790246">Close</span><span class="op" id="6790251">(</span><span class="op" id="6790252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790256">go</span>&nbsp;<span class="keyword" id="6790259">func</span><span class="op" id="6790263">(</span><span class="op" id="6790264">)</span>&nbsp;<span class="op" id="6790266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790270">c</span><span class="op" id="6790271">,</span>&nbsp;<span class="ident" id="6790273">err</span>&nbsp;<span class="op" id="6790277">:=</span>&nbsp;<span class="ident" id="6790280">ln</span><span class="op" id="6790282">.</span><span class="ident" id="6790283">Accept</span><span class="op" id="6790289">(</span><span class="op" id="6790290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790294">if</span>&nbsp;<span class="ident" id="6790297">err</span>&nbsp;<span class="op" id="6790301">==</span>&nbsp;<span class="builtintype" id="6790304">nil</span>&nbsp;<span class="op" id="6790308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790313">defer</span>&nbsp;<span class="ident" id="6790319">c</span><span class="op" id="6790320">.</span><span class="ident" id="6790321">Close</span><span class="op" id="6790326">(</span><span class="op" id="6790327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790331">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790334">}</span><span class="op" id="6790335">(</span><span class="op" id="6790336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790339">time</span><span class="op" id="6790343">.</span><span class="ident" id="6790344">Sleep</span><span class="op" id="6790349">(</span><span class="num" id="6790350">10</span>&nbsp;<span class="op" id="6790353">*</span>&nbsp;<span class="ident" id="6790355">time</span><span class="op" id="6790359">.</span><span class="ident" id="6790360">Millisecond</span><span class="op" id="6790371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790374">c</span><span class="op" id="6790375">,</span>&nbsp;<span class="ident" id="6790377">err</span>&nbsp;<span class="op" id="6790381">:=</span>&nbsp;<span class="ident" id="6790384">DialTimeout</span><span class="op" id="6790395">(</span><span class="string" id="6790396">&#34;tcp&#34;</span><span class="op" id="6790401">,</span>&nbsp;<span class="ident" id="6790403">ln</span><span class="op" id="6790405">.</span><span class="ident" id="6790406">Addr</span><span class="op" id="6790410">(</span><span class="op" id="6790411">)</span><span class="op" id="6790412">.</span><span class="ident" id="6790413">String</span><span class="op" id="6790419">(</span><span class="op" id="6790420">)</span><span class="op" id="6790421">,</span>&nbsp;<span class="op" id="6790423">-</span><span class="num" id="6790424">5</span><span class="op" id="6790425">*</span><span class="ident" id="6790426">time</span><span class="op" id="6790430">.</span><span class="ident" id="6790431">Second</span><span class="op" id="6790437">)</span>&nbsp;<span class="comment" id="6790439">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790455">if</span>&nbsp;<span class="ident" id="6790458">err</span>&nbsp;<span class="op" id="6790462">==</span>&nbsp;<span class="builtintype" id="6790465">nil</span>&nbsp;<span class="op" id="6790469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790473">defer</span>&nbsp;<span class="ident" id="6790479">c</span><span class="op" id="6790480">.</span><span class="ident" id="6790481">Close</span><span class="op" id="6790486">(</span><span class="op" id="6790487">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790493">if</span>&nbsp;<span class="op" id="6790496">!</span><span class="ident" id="6790497">isTimeout</span><span class="op" id="6790506">(</span><span class="ident" id="6790507">err</span><span class="op" id="6790510">)</span>&nbsp;<span class="op" id="6790512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790516">t</span><span class="op" id="6790517">.</span><span class="ident" id="6790518">Fatalf</span><span class="op" id="6790524">(</span><span class="string" id="6790525">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6790560">,</span>&nbsp;<span class="ident" id="6790562">err</span><span class="op" id="6790565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790568">}</span><br>
<span class="lineno"></span><span class="op" id="6790570">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="6790573">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="6790635">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="6790677">func</span>&nbsp;<span class="ident" id="6790682">TestProlongTimeout</span><span class="op" id="6790700">(</span><span class="ident" id="6790701">t</span>&nbsp;<span class="op" id="6790703">*</span><span class="ident" id="6790704">testing</span><span class="op" id="6790711">.</span><span class="ident" id="6790712">T</span><span class="op" id="6790713">)</span>&nbsp;<span class="op" id="6790715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790718">switch</span>&nbsp;<span class="ident" id="6790725">runtime</span><span class="op" id="6790732">.</span><span class="ident" id="6790733">GOOS</span>&nbsp;<span class="op" id="6790738">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790741">case</span>&nbsp;<span class="string" id="6790746">&#34;plan9&#34;</span><span class="op" id="6790753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790757">t</span><span class="op" id="6790758">.</span><span class="ident" id="6790759">Skipf</span><span class="op" id="6790764">(</span><span class="string" id="6790765">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6790786">,</span>&nbsp;<span class="ident" id="6790788">runtime</span><span class="op" id="6790795">.</span><span class="ident" id="6790796">GOOS</span><span class="op" id="6790800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790807">ln</span>&nbsp;<span class="op" id="6790810">:=</span>&nbsp;<span class="ident" id="6790813">newLocalListener</span><span class="op" id="6790829">(</span><span class="ident" id="6790830">t</span><span class="op" id="6790831">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790834">defer</span>&nbsp;<span class="ident" id="6790840">ln</span><span class="op" id="6790842">.</span><span class="ident" id="6790843">Close</span><span class="op" id="6790848">(</span><span class="op" id="6790849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790852">connected</span>&nbsp;<span class="op" id="6790862">:=</span>&nbsp;<span class="builtinfunc" id="6790865">make</span><span class="op" id="6790869">(</span><span class="keyword" id="6790870">chan</span>&nbsp;<span class="builtintype" id="6790875">bool</span><span class="op" id="6790879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790882">go</span>&nbsp;<span class="keyword" id="6790885">func</span><span class="op" id="6790889">(</span><span class="op" id="6790890">)</span>&nbsp;<span class="op" id="6790892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790896">s</span><span class="op" id="6790897">,</span>&nbsp;<span class="ident" id="6790899">err</span>&nbsp;<span class="op" id="6790903">:=</span>&nbsp;<span class="ident" id="6790906">ln</span><span class="op" id="6790908">.</span><span class="ident" id="6790909">Accept</span><span class="op" id="6790915">(</span><span class="op" id="6790916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790920">connected</span>&nbsp;<span class="op" id="6790930">&lt;-</span>&nbsp;<span class="builtintype" id="6790933">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790940">if</span>&nbsp;<span class="ident" id="6790943">err</span>&nbsp;<span class="op" id="6790947">!=</span>&nbsp;<span class="builtintype" id="6790950">nil</span>&nbsp;<span class="op" id="6790954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790959">t</span><span class="op" id="6790960">.</span><span class="ident" id="6790961">Errorf</span><span class="op" id="6790967">(</span><span class="string" id="6790968">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="6790983">,</span>&nbsp;<span class="ident" id="6790985">err</span><span class="op" id="6790988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790993">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791006">defer</span>&nbsp;<span class="ident" id="6791012">s</span><span class="op" id="6791013">.</span><span class="ident" id="6791014">Close</span><span class="op" id="6791019">(</span><span class="op" id="6791020">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791024">s</span><span class="op" id="6791025">.</span><span class="ident" id="6791026">SetDeadline</span><span class="op" id="6791037">(</span><span class="ident" id="6791038">time</span><span class="op" id="6791042">.</span><span class="ident" id="6791043">Now</span><span class="op" id="6791046">(</span><span class="op" id="6791047">)</span><span class="op" id="6791048">.</span><span class="ident" id="6791049">Add</span><span class="op" id="6791052">(</span><span class="ident" id="6791053">time</span><span class="op" id="6791057">.</span><span class="ident" id="6791058">Hour</span><span class="op" id="6791062">)</span><span class="op" id="6791063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791067">go</span>&nbsp;<span class="keyword" id="6791070">func</span><span class="op" id="6791074">(</span><span class="op" id="6791075">)</span>&nbsp;<span class="op" id="6791077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791082">var</span>&nbsp;<span class="ident" id="6791086">buf</span>&nbsp;<span class="op" id="6791090">[</span><span class="num" id="6791091">4096</span><span class="op" id="6791095">]</span><span class="builtintype" id="6791096">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791104">for</span>&nbsp;<span class="op" id="6791108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791114">_</span><span class="op" id="6791115">,</span>&nbsp;<span class="ident" id="6791117">err</span>&nbsp;<span class="op" id="6791121">:=</span>&nbsp;<span class="ident" id="6791124">s</span><span class="op" id="6791125">.</span><span class="ident" id="6791126">Write</span><span class="op" id="6791131">(</span><span class="ident" id="6791132">buf</span><span class="op" id="6791135">[</span><span class="op" id="6791136">:</span><span class="op" id="6791137">]</span><span class="op" id="6791138">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791144">if</span>&nbsp;<span class="ident" id="6791147">err</span>&nbsp;<span class="op" id="6791151">!=</span>&nbsp;<span class="builtintype" id="6791154">nil</span>&nbsp;<span class="op" id="6791158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791165">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791181">s</span><span class="op" id="6791182">.</span><span class="ident" id="6791183">SetDeadline</span><span class="op" id="6791194">(</span><span class="ident" id="6791195">time</span><span class="op" id="6791199">.</span><span class="ident" id="6791200">Now</span><span class="op" id="6791203">(</span><span class="op" id="6791204">)</span><span class="op" id="6791205">.</span><span class="ident" id="6791206">Add</span><span class="op" id="6791209">(</span><span class="ident" id="6791210">time</span><span class="op" id="6791214">.</span><span class="ident" id="6791215">Hour</span><span class="op" id="6791219">)</span><span class="op" id="6791220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791225">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791229">}</span><span class="op" id="6791230">(</span><span class="op" id="6791231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791235">buf</span>&nbsp;<span class="op" id="6791239">:=</span>&nbsp;<span class="builtinfunc" id="6791242">make</span><span class="op" id="6791246">(</span><span class="op" id="6791247">[</span><span class="op" id="6791248">]</span><span class="builtintype" id="6791249">byte</span><span class="op" id="6791253">,</span>&nbsp;<span class="num" id="6791255">1</span><span class="op" id="6791256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791260">for</span>&nbsp;<span class="op" id="6791264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791269">_</span><span class="op" id="6791270">,</span>&nbsp;<span class="ident" id="6791272">err</span>&nbsp;<span class="op" id="6791276">:=</span>&nbsp;<span class="ident" id="6791279">s</span><span class="op" id="6791280">.</span><span class="ident" id="6791281">Read</span><span class="op" id="6791285">(</span><span class="ident" id="6791286">buf</span><span class="op" id="6791289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791294">if</span>&nbsp;<span class="ident" id="6791297">err</span>&nbsp;<span class="op" id="6791301">!=</span>&nbsp;<span class="builtintype" id="6791304">nil</span>&nbsp;<span class="op" id="6791308">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791314">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791328">s</span><span class="op" id="6791329">.</span><span class="ident" id="6791330">SetDeadline</span><span class="op" id="6791341">(</span><span class="ident" id="6791342">time</span><span class="op" id="6791346">.</span><span class="ident" id="6791347">Now</span><span class="op" id="6791350">(</span><span class="op" id="6791351">)</span><span class="op" id="6791352">.</span><span class="ident" id="6791353">Add</span><span class="op" id="6791356">(</span><span class="ident" id="6791357">time</span><span class="op" id="6791361">.</span><span class="ident" id="6791362">Hour</span><span class="op" id="6791366">)</span><span class="op" id="6791367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791374">}</span><span class="op" id="6791375">(</span><span class="op" id="6791376">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791379">c</span><span class="op" id="6791380">,</span>&nbsp;<span class="ident" id="6791382">err</span>&nbsp;<span class="op" id="6791386">:=</span>&nbsp;<span class="ident" id="6791389">Dial</span><span class="op" id="6791393">(</span><span class="string" id="6791394">&#34;tcp&#34;</span><span class="op" id="6791399">,</span>&nbsp;<span class="ident" id="6791401">ln</span><span class="op" id="6791403">.</span><span class="ident" id="6791404">Addr</span><span class="op" id="6791408">(</span><span class="op" id="6791409">)</span><span class="op" id="6791410">.</span><span class="ident" id="6791411">String</span><span class="op" id="6791417">(</span><span class="op" id="6791418">)</span><span class="op" id="6791419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791422">if</span>&nbsp;<span class="ident" id="6791425">err</span>&nbsp;<span class="op" id="6791429">!=</span>&nbsp;<span class="builtintype" id="6791432">nil</span>&nbsp;<span class="op" id="6791436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791440">t</span><span class="op" id="6791441">.</span><span class="ident" id="6791442">Fatalf</span><span class="op" id="6791448">(</span><span class="string" id="6791449">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="6791462">,</span>&nbsp;<span class="ident" id="6791464">err</span><span class="op" id="6791467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791473">defer</span>&nbsp;<span class="ident" id="6791479">c</span><span class="op" id="6791480">.</span><span class="ident" id="6791481">Close</span><span class="op" id="6791486">(</span><span class="op" id="6791487">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791490">&lt;-</span><span class="ident" id="6791492">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791503">for</span>&nbsp;<span class="ident" id="6791507">i</span>&nbsp;<span class="op" id="6791509">:=</span>&nbsp;<span class="num" id="6791512">0</span><span class="op" id="6791513">;</span>&nbsp;<span class="ident" id="6791515">i</span>&nbsp;<span class="op" id="6791517">&lt;</span>&nbsp;<span class="num" id="6791519">1024</span><span class="op" id="6791523">;</span>&nbsp;<span class="ident" id="6791525">i</span><span class="op" id="6791526">++</span>&nbsp;<span class="op" id="6791529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791533">var</span>&nbsp;<span class="ident" id="6791537">buf</span>&nbsp;<span class="op" id="6791541">[</span><span class="num" id="6791542">1</span><span class="op" id="6791543">]</span><span class="builtintype" id="6791544">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791551">c</span><span class="op" id="6791552">.</span><span class="ident" id="6791553">Write</span><span class="op" id="6791558">(</span><span class="ident" id="6791559">buf</span><span class="op" id="6791562">[</span><span class="op" id="6791563">:</span><span class="op" id="6791564">]</span><span class="op" id="6791565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791568">}</span><br>
<span class="lineno">710</span><span class="op" id="6791570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6791573">func</span>&nbsp;<span class="ident" id="6791578">TestDeadlineRace</span><span class="op" id="6791594">(</span><span class="ident" id="6791595">t</span>&nbsp;<span class="op" id="6791597">*</span><span class="ident" id="6791598">testing</span><span class="op" id="6791605">.</span><span class="ident" id="6791606">T</span><span class="op" id="6791607">)</span>&nbsp;<span class="op" id="6791609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791612">switch</span>&nbsp;<span class="ident" id="6791619">runtime</span><span class="op" id="6791626">.</span><span class="ident" id="6791627">GOOS</span>&nbsp;<span class="op" id="6791632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791635">case</span>&nbsp;<span class="string" id="6791640">&#34;nacl&#34;</span><span class="op" id="6791646">,</span>&nbsp;<span class="string" id="6791648">&#34;plan9&#34;</span><span class="op" id="6791655">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791659">t</span><span class="op" id="6791660">.</span><span class="ident" id="6791661">Skipf</span><span class="op" id="6791666">(</span><span class="string" id="6791667">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6791688">,</span>&nbsp;<span class="ident" id="6791690">runtime</span><span class="op" id="6791697">.</span><span class="ident" id="6791698">GOOS</span><span class="op" id="6791702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791709">N</span>&nbsp;<span class="op" id="6791711">:=</span>&nbsp;<span class="num" id="6791714">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791720">if</span>&nbsp;<span class="ident" id="6791723">testing</span><span class="op" id="6791730">.</span><span class="ident" id="6791731">Short</span><span class="op" id="6791736">(</span><span class="op" id="6791737">)</span>&nbsp;<span class="op" id="6791739">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791743">N</span>&nbsp;<span class="op" id="6791745">=</span>&nbsp;<span class="num" id="6791747">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791754">defer</span>&nbsp;<span class="ident" id="6791760">runtime</span><span class="op" id="6791767">.</span><span class="ident" id="6791768">GOMAXPROCS</span><span class="op" id="6791778">(</span><span class="ident" id="6791779">runtime</span><span class="op" id="6791786">.</span><span class="ident" id="6791787">GOMAXPROCS</span><span class="op" id="6791797">(</span><span class="num" id="6791798">4</span><span class="op" id="6791799">)</span><span class="op" id="6791800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791803">ln</span>&nbsp;<span class="op" id="6791806">:=</span>&nbsp;<span class="ident" id="6791809">newLocalListener</span><span class="op" id="6791825">(</span><span class="ident" id="6791826">t</span><span class="op" id="6791827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791830">defer</span>&nbsp;<span class="ident" id="6791836">ln</span><span class="op" id="6791838">.</span><span class="ident" id="6791839">Close</span><span class="op" id="6791844">(</span><span class="op" id="6791845">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791848">c</span><span class="op" id="6791849">,</span>&nbsp;<span class="ident" id="6791851">err</span>&nbsp;<span class="op" id="6791855">:=</span>&nbsp;<span class="ident" id="6791858">Dial</span><span class="op" id="6791862">(</span><span class="string" id="6791863">&#34;tcp&#34;</span><span class="op" id="6791868">,</span>&nbsp;<span class="ident" id="6791870">ln</span><span class="op" id="6791872">.</span><span class="ident" id="6791873">Addr</span><span class="op" id="6791877">(</span><span class="op" id="6791878">)</span><span class="op" id="6791879">.</span><span class="ident" id="6791880">String</span><span class="op" id="6791886">(</span><span class="op" id="6791887">)</span><span class="op" id="6791888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791891">if</span>&nbsp;<span class="ident" id="6791894">err</span>&nbsp;<span class="op" id="6791898">!=</span>&nbsp;<span class="builtintype" id="6791901">nil</span>&nbsp;<span class="op" id="6791905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791909">t</span><span class="op" id="6791910">.</span><span class="ident" id="6791911">Fatalf</span><span class="op" id="6791917">(</span><span class="string" id="6791918">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6791928">,</span>&nbsp;<span class="ident" id="6791930">err</span><span class="op" id="6791933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791939">defer</span>&nbsp;<span class="ident" id="6791945">c</span><span class="op" id="6791946">.</span><span class="ident" id="6791947">Close</span><span class="op" id="6791952">(</span><span class="op" id="6791953">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791956">done</span>&nbsp;<span class="op" id="6791961">:=</span>&nbsp;<span class="builtinfunc" id="6791964">make</span><span class="op" id="6791968">(</span><span class="keyword" id="6791969">chan</span>&nbsp;<span class="builtintype" id="6791974">bool</span><span class="op" id="6791978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791981">go</span>&nbsp;<span class="keyword" id="6791984">func</span><span class="op" id="6791988">(</span><span class="op" id="6791989">)</span>&nbsp;<span class="op" id="6791991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791995">t</span>&nbsp;<span class="op" id="6791997">:=</span>&nbsp;<span class="ident" id="6792000">time</span><span class="op" id="6792004">.</span><span class="ident" id="6792005">NewTicker</span><span class="op" id="6792014">(</span><span class="num" id="6792015">2</span>&nbsp;<span class="op" id="6792017">*</span>&nbsp;<span class="ident" id="6792019">time</span><span class="op" id="6792023">.</span><span class="ident" id="6792024">Microsecond</span><span class="op" id="6792035">)</span><span class="op" id="6792036">.</span><span class="ident" id="6792037">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792041">for</span>&nbsp;<span class="ident" id="6792045">i</span>&nbsp;<span class="op" id="6792047">:=</span>&nbsp;<span class="num" id="6792050">0</span><span class="op" id="6792051">;</span>&nbsp;<span class="ident" id="6792053">i</span>&nbsp;<span class="op" id="6792055">&lt;</span>&nbsp;<span class="ident" id="6792057">N</span><span class="op" id="6792058">;</span>&nbsp;<span class="ident" id="6792060">i</span><span class="op" id="6792061">++</span>&nbsp;<span class="op" id="6792064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792069">if</span>&nbsp;<span class="ident" id="6792072">err</span>&nbsp;<span class="op" id="6792076">:=</span>&nbsp;<span class="ident" id="6792079">c</span><span class="op" id="6792080">.</span><span class="ident" id="6792081">SetDeadline</span><span class="op" id="6792092">(</span><span class="ident" id="6792093">time</span><span class="op" id="6792097">.</span><span class="ident" id="6792098">Now</span><span class="op" id="6792101">(</span><span class="op" id="6792102">)</span><span class="op" id="6792103">.</span><span class="ident" id="6792104">Add</span><span class="op" id="6792107">(</span><span class="num" id="6792108">2</span>&nbsp;<span class="op" id="6792110">*</span>&nbsp;<span class="ident" id="6792112">time</span><span class="op" id="6792116">.</span><span class="ident" id="6792117">Microsecond</span><span class="op" id="6792128">)</span><span class="op" id="6792129">)</span><span class="op" id="6792130">;</span>&nbsp;<span class="ident" id="6792132">err</span>&nbsp;<span class="op" id="6792136">!=</span>&nbsp;<span class="builtintype" id="6792139">nil</span>&nbsp;<span class="op" id="6792143">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792149">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792163">&lt;-</span><span class="ident" id="6792165">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792173">done</span>&nbsp;<span class="op" id="6792178">&lt;-</span>&nbsp;<span class="builtintype" id="6792181">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792187">}</span><span class="op" id="6792188">(</span><span class="op" id="6792189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792192">var</span>&nbsp;<span class="ident" id="6792196">buf</span>&nbsp;<span class="op" id="6792200">[</span><span class="num" id="6792201">1</span><span class="op" id="6792202">]</span><span class="builtintype" id="6792203">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792209">for</span>&nbsp;<span class="ident" id="6792213">i</span>&nbsp;<span class="op" id="6792215">:=</span>&nbsp;<span class="num" id="6792218">0</span><span class="op" id="6792219">;</span>&nbsp;<span class="ident" id="6792221">i</span>&nbsp;<span class="op" id="6792223">&lt;</span>&nbsp;<span class="ident" id="6792225">N</span><span class="op" id="6792226">;</span>&nbsp;<span class="ident" id="6792228">i</span><span class="op" id="6792229">++</span>&nbsp;<span class="op" id="6792232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792236">c</span><span class="op" id="6792237">.</span><span class="ident" id="6792238">Read</span><span class="op" id="6792242">(</span><span class="ident" id="6792243">buf</span><span class="op" id="6792246">[</span><span class="op" id="6792247">:</span><span class="op" id="6792248">]</span><span class="op" id="6792249">)</span>&nbsp;<span class="comment" id="6792251">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792286">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792289">c</span><span class="op" id="6792290">.</span><span class="ident" id="6792291">Close</span><span class="op" id="6792296">(</span><span class="op" id="6792297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792300">&lt;-</span><span class="ident" id="6792302">done</span><br>
<span class="lineno"></span><span class="op" id="6792307">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
