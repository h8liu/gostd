<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5347953">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5348008">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5348062">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5348113">package</span>&nbsp;<span class="ident" id="5348121">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5348131">import</span>&nbsp;<span class="op" id="5348138">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5348141">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5348148">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5348159">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="5348181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5348184">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="5348245">type</span>&nbsp;<span class="ident" id="5348250">common</span>&nbsp;<span class="keyword" id="5348257">struct</span>&nbsp;<span class="op" id="5348264">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348267">tmpl</span>&nbsp;<span class="keyword" id="5348272">map</span><span class="op" id="5348275">[</span><span class="builtintype" id="5348276">string</span><span class="op" id="5348282">]</span><span class="op" id="5348283">*</span><span class="ident" id="5348284">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348294">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348354">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348413">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348450">parseFuncs</span>&nbsp;<span class="ident" id="5348461">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348470">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="5348481">map</span><span class="op" id="5348484">[</span><span class="builtintype" id="5348485">string</span><span class="op" id="5348491">]</span><span class="ident" id="5348492">reflect</span><span class="op" id="5348499">.</span><span class="ident" id="5348500">Value</span><br>
<span class="lineno"></span><span class="op" id="5348506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5348509">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="5348581">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="5348654">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5348693">type</span>&nbsp;<span class="ident" id="5348698">Template</span>&nbsp;<span class="keyword" id="5348707">struct</span>&nbsp;<span class="op" id="5348714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348717">name</span>&nbsp;<span class="builtintype" id="5348722">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348730">*</span><span class="ident" id="5348731">parse</span><span class="op" id="5348736">.</span><span class="ident" id="5348737">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348743">*</span><span class="ident" id="5348744">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348752">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="5348763">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348771">rightDelim</span>&nbsp;<span class="builtintype" id="5348782">string</span><br>
<span class="lineno"></span><span class="op" id="5348789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5348792">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="5348845">func</span>&nbsp;<span class="ident" id="5348850">New</span><span class="op" id="5348853">(</span><span class="ident" id="5348854">name</span>&nbsp;<span class="builtintype" id="5348859">string</span><span class="op" id="5348865">)</span>&nbsp;<span class="op" id="5348867">*</span><span class="ident" id="5348868">Template</span>&nbsp;<span class="op" id="5348877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348880">return</span>&nbsp;<span class="op" id="5348887">&amp;</span><span class="ident" id="5348888">Template</span><span class="op" id="5348896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348900">name</span><span class="op" id="5348904">:</span>&nbsp;<span class="ident" id="5348906">name</span><span class="op" id="5348910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348913">}</span><br>
<span class="lineno"></span><span class="op" id="5348915">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5348918">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5348960">func</span>&nbsp;<span class="op" id="5348965">(</span><span class="ident" id="5348966">t</span>&nbsp;<span class="op" id="5348968">*</span><span class="ident" id="5348969">Template</span><span class="op" id="5348977">)</span>&nbsp;<span class="ident" id="5348979">Name</span><span class="op" id="5348983">(</span><span class="op" id="5348984">)</span>&nbsp;<span class="builtintype" id="5348986">string</span>&nbsp;<span class="op" id="5348993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348996">return</span>&nbsp;<span class="ident" id="5349003">t</span><span class="op" id="5349004">.</span><span class="ident" id="5349005">name</span><br>
<span class="lineno"></span><span class="op" id="5349010">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5349013">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5349093">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5349169">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="5349215">func</span>&nbsp;<span class="op" id="5349220">(</span><span class="ident" id="5349221">t</span>&nbsp;<span class="op" id="5349223">*</span><span class="ident" id="5349224">Template</span><span class="op" id="5349232">)</span>&nbsp;<span class="ident" id="5349234">New</span><span class="op" id="5349237">(</span><span class="ident" id="5349238">name</span>&nbsp;<span class="builtintype" id="5349243">string</span><span class="op" id="5349249">)</span>&nbsp;<span class="op" id="5349251">*</span><span class="ident" id="5349252">Template</span>&nbsp;<span class="op" id="5349261">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349264">t</span><span class="op" id="5349265">.</span><span class="ident" id="5349266">init</span><span class="op" id="5349270">(</span><span class="op" id="5349271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349274">return</span>&nbsp;<span class="op" id="5349281">&amp;</span><span class="ident" id="5349282">Template</span><span class="op" id="5349290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349294">name</span><span class="op" id="5349298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349306">name</span><span class="op" id="5349310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349314">common</span><span class="op" id="5349320">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349326">t</span><span class="op" id="5349327">.</span><span class="ident" id="5349328">common</span><span class="op" id="5349334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349338">leftDelim</span><span class="op" id="5349347">:</span>&nbsp;&nbsp;<span class="ident" id="5349350">t</span><span class="op" id="5349351">.</span><span class="ident" id="5349352">leftDelim</span><span class="op" id="5349361">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349365">rightDelim</span><span class="op" id="5349375">:</span>&nbsp;<span class="ident" id="5349377">t</span><span class="op" id="5349378">.</span><span class="ident" id="5349379">rightDelim</span><span class="op" id="5349389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349392">}</span><br>
<span class="lineno"></span><span class="op" id="5349394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5349397">func</span>&nbsp;<span class="op" id="5349402">(</span><span class="ident" id="5349403">t</span>&nbsp;<span class="op" id="5349405">*</span><span class="ident" id="5349406">Template</span><span class="op" id="5349414">)</span>&nbsp;<span class="ident" id="5349416">init</span><span class="op" id="5349420">(</span><span class="op" id="5349421">)</span>&nbsp;<span class="op" id="5349423">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349426">if</span>&nbsp;<span class="ident" id="5349429">t</span><span class="op" id="5349430">.</span><span class="ident" id="5349431">common</span>&nbsp;<span class="op" id="5349438">==</span>&nbsp;<span class="ident" id="5349441">nil</span>&nbsp;<span class="op" id="5349445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349449">t</span><span class="op" id="5349450">.</span><span class="ident" id="5349451">common</span>&nbsp;<span class="op" id="5349458">=</span>&nbsp;<span class="builtinfunc" id="5349460">new</span><span class="op" id="5349463">(</span><span class="ident" id="5349464">common</span><span class="op" id="5349470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349474">t</span><span class="op" id="5349475">.</span><span class="ident" id="5349476">tmpl</span>&nbsp;<span class="op" id="5349481">=</span>&nbsp;<span class="builtinfunc" id="5349483">make</span><span class="op" id="5349487">(</span><span class="keyword" id="5349488">map</span><span class="op" id="5349491">[</span><span class="builtintype" id="5349492">string</span><span class="op" id="5349498">]</span><span class="op" id="5349499">*</span><span class="ident" id="5349500">Template</span><span class="op" id="5349508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349512">t</span><span class="op" id="5349513">.</span><span class="ident" id="5349514">parseFuncs</span>&nbsp;<span class="op" id="5349525">=</span>&nbsp;<span class="builtinfunc" id="5349527">make</span><span class="op" id="5349531">(</span><span class="ident" id="5349532">FuncMap</span><span class="op" id="5349539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349543">t</span><span class="op" id="5349544">.</span><span class="ident" id="5349545">execFuncs</span>&nbsp;<span class="op" id="5349555">=</span>&nbsp;<span class="builtinfunc" id="5349557">make</span><span class="op" id="5349561">(</span><span class="keyword" id="5349562">map</span><span class="op" id="5349565">[</span><span class="builtintype" id="5349566">string</span><span class="op" id="5349572">]</span><span class="ident" id="5349573">reflect</span><span class="op" id="5349580">.</span><span class="ident" id="5349581">Value</span><span class="op" id="5349586">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349589">}</span><br>
<span class="lineno"></span><span class="op" id="5349591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5349594">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5349665">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="5349742">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="5349817">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="5349896">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="5349974">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="5350025">func</span>&nbsp;<span class="op" id="5350030">(</span><span class="ident" id="5350031">t</span>&nbsp;<span class="op" id="5350033">*</span><span class="ident" id="5350034">Template</span><span class="op" id="5350042">)</span>&nbsp;<span class="ident" id="5350044">Clone</span><span class="op" id="5350049">(</span><span class="op" id="5350050">)</span>&nbsp;<span class="op" id="5350052">(</span><span class="op" id="5350053">*</span><span class="ident" id="5350054">Template</span><span class="op" id="5350062">,</span>&nbsp;<span class="builtintype" id="5350064">error</span><span class="op" id="5350069">)</span>&nbsp;<span class="op" id="5350071">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350074">nt</span>&nbsp;<span class="op" id="5350077">:=</span>&nbsp;<span class="ident" id="5350080">t</span><span class="op" id="5350081">.</span><span class="builtinfunc" id="5350082">copy</span><span class="op" id="5350086">(</span><span class="ident" id="5350087">nil</span><span class="op" id="5350090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350093">nt</span><span class="op" id="5350095">.</span><span class="ident" id="5350096">init</span><span class="op" id="5350100">(</span><span class="op" id="5350101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350104">nt</span><span class="op" id="5350106">.</span><span class="ident" id="5350107">tmpl</span><span class="op" id="5350111">[</span><span class="ident" id="5350112">t</span><span class="op" id="5350113">.</span><span class="ident" id="5350114">name</span><span class="op" id="5350118">]</span>&nbsp;<span class="op" id="5350120">=</span>&nbsp;<span class="ident" id="5350122">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350126">for</span>&nbsp;<span class="ident" id="5350130">k</span><span class="op" id="5350131">,</span>&nbsp;<span class="ident" id="5350133">v</span>&nbsp;<span class="op" id="5350135">:=</span>&nbsp;<span class="keyword" id="5350138">range</span>&nbsp;<span class="ident" id="5350144">t</span><span class="op" id="5350145">.</span><span class="ident" id="5350146">tmpl</span>&nbsp;<span class="op" id="5350151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350155">if</span>&nbsp;<span class="ident" id="5350158">k</span>&nbsp;<span class="op" id="5350160">==</span>&nbsp;<span class="ident" id="5350163">t</span><span class="op" id="5350164">.</span><span class="ident" id="5350165">name</span>&nbsp;<span class="op" id="5350170">{</span>&nbsp;<span class="comment" id="5350172">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350197">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350212">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350271">tmpl</span>&nbsp;<span class="op" id="5350276">:=</span>&nbsp;<span class="ident" id="5350279">v</span><span class="op" id="5350280">.</span><span class="builtinfunc" id="5350281">copy</span><span class="op" id="5350285">(</span><span class="ident" id="5350286">nt</span><span class="op" id="5350288">.</span><span class="ident" id="5350289">common</span><span class="op" id="5350295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350299">nt</span><span class="op" id="5350301">.</span><span class="ident" id="5350302">tmpl</span><span class="op" id="5350306">[</span><span class="ident" id="5350307">k</span><span class="op" id="5350308">]</span>&nbsp;<span class="op" id="5350310">=</span>&nbsp;<span class="ident" id="5350312">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350321">for</span>&nbsp;<span class="ident" id="5350325">k</span><span class="op" id="5350326">,</span>&nbsp;<span class="ident" id="5350328">v</span>&nbsp;<span class="op" id="5350330">:=</span>&nbsp;<span class="keyword" id="5350333">range</span>&nbsp;<span class="ident" id="5350339">t</span><span class="op" id="5350340">.</span><span class="ident" id="5350341">parseFuncs</span>&nbsp;<span class="op" id="5350352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350356">nt</span><span class="op" id="5350358">.</span><span class="ident" id="5350359">parseFuncs</span><span class="op" id="5350369">[</span><span class="ident" id="5350370">k</span><span class="op" id="5350371">]</span>&nbsp;<span class="op" id="5350373">=</span>&nbsp;<span class="ident" id="5350375">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350381">for</span>&nbsp;<span class="ident" id="5350385">k</span><span class="op" id="5350386">,</span>&nbsp;<span class="ident" id="5350388">v</span>&nbsp;<span class="op" id="5350390">:=</span>&nbsp;<span class="keyword" id="5350393">range</span>&nbsp;<span class="ident" id="5350399">t</span><span class="op" id="5350400">.</span><span class="ident" id="5350401">execFuncs</span>&nbsp;<span class="op" id="5350411">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350415">nt</span><span class="op" id="5350417">.</span><span class="ident" id="5350418">execFuncs</span><span class="op" id="5350427">[</span><span class="ident" id="5350428">k</span><span class="op" id="5350429">]</span>&nbsp;<span class="op" id="5350431">=</span>&nbsp;<span class="ident" id="5350433">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350439">return</span>&nbsp;<span class="ident" id="5350446">nt</span><span class="op" id="5350448">,</span>&nbsp;<span class="ident" id="5350450">nil</span><br>
<span class="lineno"></span><span class="op" id="5350454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5350457">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="5350527">func</span>&nbsp;<span class="op" id="5350532">(</span><span class="ident" id="5350533">t</span>&nbsp;<span class="op" id="5350535">*</span><span class="ident" id="5350536">Template</span><span class="op" id="5350544">)</span>&nbsp;<span class="builtinfunc" id="5350546">copy</span><span class="op" id="5350550">(</span><span class="ident" id="5350551">c</span>&nbsp;<span class="op" id="5350553">*</span><span class="ident" id="5350554">common</span><span class="op" id="5350560">)</span>&nbsp;<span class="op" id="5350562">*</span><span class="ident" id="5350563">Template</span>&nbsp;<span class="op" id="5350572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350575">nt</span>&nbsp;<span class="op" id="5350578">:=</span>&nbsp;<span class="ident" id="5350581">New</span><span class="op" id="5350584">(</span><span class="ident" id="5350585">t</span><span class="op" id="5350586">.</span><span class="ident" id="5350587">name</span><span class="op" id="5350591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350594">nt</span><span class="op" id="5350596">.</span><span class="ident" id="5350597">Tree</span>&nbsp;<span class="op" id="5350602">=</span>&nbsp;<span class="ident" id="5350604">t</span><span class="op" id="5350605">.</span><span class="ident" id="5350606">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350612">nt</span><span class="op" id="5350614">.</span><span class="ident" id="5350615">common</span>&nbsp;<span class="op" id="5350622">=</span>&nbsp;<span class="ident" id="5350624">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350627">nt</span><span class="op" id="5350629">.</span><span class="ident" id="5350630">leftDelim</span>&nbsp;<span class="op" id="5350640">=</span>&nbsp;<span class="ident" id="5350642">t</span><span class="op" id="5350643">.</span><span class="ident" id="5350644">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350655">nt</span><span class="op" id="5350657">.</span><span class="ident" id="5350658">rightDelim</span>&nbsp;<span class="op" id="5350669">=</span>&nbsp;<span class="ident" id="5350671">t</span><span class="op" id="5350672">.</span><span class="ident" id="5350673">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350685">return</span>&nbsp;<span class="ident" id="5350692">nt</span><br>
<span class="lineno"></span><span class="op" id="5350695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5350698">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="5350766">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="5350795">func</span>&nbsp;<span class="op" id="5350800">(</span><span class="ident" id="5350801">t</span>&nbsp;<span class="op" id="5350803">*</span><span class="ident" id="5350804">Template</span><span class="op" id="5350812">)</span>&nbsp;<span class="ident" id="5350814">AddParseTree</span><span class="op" id="5350826">(</span><span class="ident" id="5350827">name</span>&nbsp;<span class="builtintype" id="5350832">string</span><span class="op" id="5350838">,</span>&nbsp;<span class="ident" id="5350840">tree</span>&nbsp;<span class="op" id="5350845">*</span><span class="ident" id="5350846">parse</span><span class="op" id="5350851">.</span><span class="ident" id="5350852">Tree</span><span class="op" id="5350856">)</span>&nbsp;<span class="op" id="5350858">(</span><span class="op" id="5350859">*</span><span class="ident" id="5350860">Template</span><span class="op" id="5350868">,</span>&nbsp;<span class="builtintype" id="5350870">error</span><span class="op" id="5350875">)</span>&nbsp;<span class="op" id="5350877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350880">if</span>&nbsp;<span class="ident" id="5350883">t</span><span class="op" id="5350884">.</span><span class="ident" id="5350885">common</span>&nbsp;<span class="op" id="5350892">!=</span>&nbsp;<span class="ident" id="5350895">nil</span>&nbsp;<span class="op" id="5350899">&amp;&amp;</span>&nbsp;<span class="ident" id="5350902">t</span><span class="op" id="5350903">.</span><span class="ident" id="5350904">tmpl</span><span class="op" id="5350908">[</span><span class="ident" id="5350909">name</span><span class="op" id="5350913">]</span>&nbsp;<span class="op" id="5350915">!=</span>&nbsp;<span class="ident" id="5350918">nil</span>&nbsp;<span class="op" id="5350922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350926">return</span>&nbsp;<span class="ident" id="5350933">nil</span><span class="op" id="5350936">,</span>&nbsp;<span class="ident" id="5350938">fmt</span><span class="op" id="5350941">.</span><span class="ident" id="5350942">Errorf</span><span class="op" id="5350948">(</span><span class="string" id="5350949">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="5350988">,</span>&nbsp;<span class="ident" id="5350990">name</span><span class="op" id="5350994">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351000">nt</span>&nbsp;<span class="op" id="5351003">:=</span>&nbsp;<span class="ident" id="5351006">t</span><span class="op" id="5351007">.</span><span class="ident" id="5351008">New</span><span class="op" id="5351011">(</span><span class="ident" id="5351012">name</span><span class="op" id="5351016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351019">nt</span><span class="op" id="5351021">.</span><span class="ident" id="5351022">Tree</span>&nbsp;<span class="op" id="5351027">=</span>&nbsp;<span class="ident" id="5351029">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351035">t</span><span class="op" id="5351036">.</span><span class="ident" id="5351037">tmpl</span><span class="op" id="5351041">[</span><span class="ident" id="5351042">name</span><span class="op" id="5351046">]</span>&nbsp;<span class="op" id="5351048">=</span>&nbsp;<span class="ident" id="5351050">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351054">return</span>&nbsp;<span class="ident" id="5351061">nt</span><span class="op" id="5351063">,</span>&nbsp;<span class="ident" id="5351065">nil</span><br>
<span class="lineno">115</span><span class="op" id="5351069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5351072">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="5351149">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="5351160">func</span>&nbsp;<span class="op" id="5351165">(</span><span class="ident" id="5351166">t</span>&nbsp;<span class="op" id="5351168">*</span><span class="ident" id="5351169">Template</span><span class="op" id="5351177">)</span>&nbsp;<span class="ident" id="5351179">Templates</span><span class="op" id="5351188">(</span><span class="op" id="5351189">)</span>&nbsp;<span class="op" id="5351191">[</span><span class="op" id="5351192">]</span><span class="op" id="5351193">*</span><span class="ident" id="5351194">Template</span>&nbsp;<span class="op" id="5351203">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351206">if</span>&nbsp;<span class="ident" id="5351209">t</span><span class="op" id="5351210">.</span><span class="ident" id="5351211">common</span>&nbsp;<span class="op" id="5351218">==</span>&nbsp;<span class="ident" id="5351221">nil</span>&nbsp;<span class="op" id="5351225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351229">return</span>&nbsp;<span class="ident" id="5351236">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351244">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351291">m</span>&nbsp;<span class="op" id="5351293">:=</span>&nbsp;<span class="builtinfunc" id="5351296">make</span><span class="op" id="5351300">(</span><span class="op" id="5351301">[</span><span class="op" id="5351302">]</span><span class="op" id="5351303">*</span><span class="ident" id="5351304">Template</span><span class="op" id="5351312">,</span>&nbsp;<span class="num" id="5351314">0</span><span class="op" id="5351315">,</span>&nbsp;<span class="builtinfunc" id="5351317">len</span><span class="op" id="5351320">(</span><span class="ident" id="5351321">t</span><span class="op" id="5351322">.</span><span class="ident" id="5351323">tmpl</span><span class="op" id="5351327">)</span><span class="op" id="5351328">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351331">for</span>&nbsp;<span class="ident" id="5351335">_</span><span class="op" id="5351336">,</span>&nbsp;<span class="ident" id="5351338">v</span>&nbsp;<span class="op" id="5351340">:=</span>&nbsp;<span class="keyword" id="5351343">range</span>&nbsp;<span class="ident" id="5351349">t</span><span class="op" id="5351350">.</span><span class="ident" id="5351351">tmpl</span>&nbsp;<span class="op" id="5351356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351360">m</span>&nbsp;<span class="op" id="5351362">=</span>&nbsp;<span class="builtinfunc" id="5351364">append</span><span class="op" id="5351370">(</span><span class="ident" id="5351371">m</span><span class="op" id="5351372">,</span>&nbsp;<span class="ident" id="5351374">v</span><span class="op" id="5351375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351381">return</span>&nbsp;<span class="ident" id="5351388">m</span><br>
<span class="lineno"></span><span class="op" id="5351390">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5351393">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5351470">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="5351542">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5351618">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="5351654">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="5351716">func</span>&nbsp;<span class="op" id="5351721">(</span><span class="ident" id="5351722">t</span>&nbsp;<span class="op" id="5351724">*</span><span class="ident" id="5351725">Template</span><span class="op" id="5351733">)</span>&nbsp;<span class="ident" id="5351735">Delims</span><span class="op" id="5351741">(</span><span class="ident" id="5351742">left</span><span class="op" id="5351746">,</span>&nbsp;<span class="ident" id="5351748">right</span>&nbsp;<span class="builtintype" id="5351754">string</span><span class="op" id="5351760">)</span>&nbsp;<span class="op" id="5351762">*</span><span class="ident" id="5351763">Template</span>&nbsp;<span class="op" id="5351772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351775">t</span><span class="op" id="5351776">.</span><span class="ident" id="5351777">leftDelim</span>&nbsp;<span class="op" id="5351787">=</span>&nbsp;<span class="ident" id="5351789">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351795">t</span><span class="op" id="5351796">.</span><span class="ident" id="5351797">rightDelim</span>&nbsp;<span class="op" id="5351808">=</span>&nbsp;<span class="ident" id="5351810">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351817">return</span>&nbsp;<span class="ident" id="5351824">t</span><br>
<span class="lineno">140</span><span class="op" id="5351826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5351829">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5351908">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5351985">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="5352060">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="5352111">func</span>&nbsp;<span class="op" id="5352116">(</span><span class="ident" id="5352117">t</span>&nbsp;<span class="op" id="5352119">*</span><span class="ident" id="5352120">Template</span><span class="op" id="5352128">)</span>&nbsp;<span class="ident" id="5352130">Funcs</span><span class="op" id="5352135">(</span><span class="ident" id="5352136">funcMap</span>&nbsp;<span class="ident" id="5352144">FuncMap</span><span class="op" id="5352151">)</span>&nbsp;<span class="op" id="5352153">*</span><span class="ident" id="5352154">Template</span>&nbsp;<span class="op" id="5352163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352166">t</span><span class="op" id="5352167">.</span><span class="ident" id="5352168">init</span><span class="op" id="5352172">(</span><span class="op" id="5352173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352176">addValueFuncs</span><span class="op" id="5352189">(</span><span class="ident" id="5352190">t</span><span class="op" id="5352191">.</span><span class="ident" id="5352192">execFuncs</span><span class="op" id="5352201">,</span>&nbsp;<span class="ident" id="5352203">funcMap</span><span class="op" id="5352210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352213">addFuncs</span><span class="op" id="5352221">(</span><span class="ident" id="5352222">t</span><span class="op" id="5352223">.</span><span class="ident" id="5352224">parseFuncs</span><span class="op" id="5352234">,</span>&nbsp;<span class="ident" id="5352236">funcMap</span><span class="op" id="5352243">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352246">return</span>&nbsp;<span class="ident" id="5352253">t</span><br>
<span class="lineno"></span><span class="op" id="5352255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5352258">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="5352336">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="5352376">func</span>&nbsp;<span class="op" id="5352381">(</span><span class="ident" id="5352382">t</span>&nbsp;<span class="op" id="5352384">*</span><span class="ident" id="5352385">Template</span><span class="op" id="5352393">)</span>&nbsp;<span class="ident" id="5352395">Lookup</span><span class="op" id="5352401">(</span><span class="ident" id="5352402">name</span>&nbsp;<span class="builtintype" id="5352407">string</span><span class="op" id="5352413">)</span>&nbsp;<span class="op" id="5352415">*</span><span class="ident" id="5352416">Template</span>&nbsp;<span class="op" id="5352425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352428">if</span>&nbsp;<span class="ident" id="5352431">t</span><span class="op" id="5352432">.</span><span class="ident" id="5352433">common</span>&nbsp;<span class="op" id="5352440">==</span>&nbsp;<span class="ident" id="5352443">nil</span>&nbsp;<span class="op" id="5352447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352451">return</span>&nbsp;<span class="ident" id="5352458">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5352463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352466">return</span>&nbsp;<span class="ident" id="5352473">t</span><span class="op" id="5352474">.</span><span class="ident" id="5352475">tmpl</span><span class="op" id="5352479">[</span><span class="ident" id="5352480">name</span><span class="op" id="5352484">]</span><br>
<span class="lineno">160</span><span class="op" id="5352486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5352489">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5352567">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="5352647">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="5352725">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="5352798">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5352873">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5352951">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="5353026">func</span>&nbsp;<span class="op" id="5353031">(</span><span class="ident" id="5353032">t</span>&nbsp;<span class="op" id="5353034">*</span><span class="ident" id="5353035">Template</span><span class="op" id="5353043">)</span>&nbsp;<span class="ident" id="5353045">Parse</span><span class="op" id="5353050">(</span><span class="ident" id="5353051">text</span>&nbsp;<span class="builtintype" id="5353056">string</span><span class="op" id="5353062">)</span>&nbsp;<span class="op" id="5353064">(</span><span class="op" id="5353065">*</span><span class="ident" id="5353066">Template</span><span class="op" id="5353074">,</span>&nbsp;<span class="builtintype" id="5353076">error</span><span class="op" id="5353081">)</span>&nbsp;<span class="op" id="5353083">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353086">t</span><span class="op" id="5353087">.</span><span class="ident" id="5353088">init</span><span class="op" id="5353092">(</span><span class="op" id="5353093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353096">trees</span><span class="op" id="5353101">,</span>&nbsp;<span class="ident" id="5353103">err</span>&nbsp;<span class="op" id="5353107">:=</span>&nbsp;<span class="ident" id="5353110">parse</span><span class="op" id="5353115">.</span><span class="ident" id="5353116">Parse</span><span class="op" id="5353121">(</span><span class="ident" id="5353122">t</span><span class="op" id="5353123">.</span><span class="ident" id="5353124">name</span><span class="op" id="5353128">,</span>&nbsp;<span class="ident" id="5353130">text</span><span class="op" id="5353134">,</span>&nbsp;<span class="ident" id="5353136">t</span><span class="op" id="5353137">.</span><span class="ident" id="5353138">leftDelim</span><span class="op" id="5353147">,</span>&nbsp;<span class="ident" id="5353149">t</span><span class="op" id="5353150">.</span><span class="ident" id="5353151">rightDelim</span><span class="op" id="5353161">,</span>&nbsp;<span class="ident" id="5353163">t</span><span class="op" id="5353164">.</span><span class="ident" id="5353165">parseFuncs</span><span class="op" id="5353175">,</span>&nbsp;<span class="ident" id="5353177">builtins</span><span class="op" id="5353185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353188">if</span>&nbsp;<span class="ident" id="5353191">err</span>&nbsp;<span class="op" id="5353195">!=</span>&nbsp;<span class="ident" id="5353198">nil</span>&nbsp;<span class="op" id="5353202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353206">return</span>&nbsp;<span class="ident" id="5353213">nil</span><span class="op" id="5353216">,</span>&nbsp;<span class="ident" id="5353218">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353223">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353226">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353310">for</span>&nbsp;<span class="ident" id="5353314">name</span><span class="op" id="5353318">,</span>&nbsp;<span class="ident" id="5353320">tree</span>&nbsp;<span class="op" id="5353325">:=</span>&nbsp;<span class="keyword" id="5353328">range</span>&nbsp;<span class="ident" id="5353334">trees</span>&nbsp;<span class="op" id="5353340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353344">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353426">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353484">tmpl</span>&nbsp;<span class="op" id="5353489">:=</span>&nbsp;<span class="ident" id="5353492">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353496">if</span>&nbsp;<span class="ident" id="5353499">name</span>&nbsp;<span class="op" id="5353504">!=</span>&nbsp;<span class="ident" id="5353507">t</span><span class="op" id="5353508">.</span><span class="ident" id="5353509">name</span>&nbsp;<span class="op" id="5353514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353519">tmpl</span>&nbsp;<span class="op" id="5353524">=</span>&nbsp;<span class="ident" id="5353526">t</span><span class="op" id="5353527">.</span><span class="ident" id="5353528">New</span><span class="op" id="5353531">(</span><span class="ident" id="5353532">name</span><span class="op" id="5353536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353544">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353614">if</span>&nbsp;<span class="ident" id="5353617">replace</span><span class="op" id="5353624">,</span>&nbsp;<span class="ident" id="5353626">err</span>&nbsp;<span class="op" id="5353630">:=</span>&nbsp;<span class="ident" id="5353633">t</span><span class="op" id="5353634">.</span><span class="ident" id="5353635">associate</span><span class="op" id="5353644">(</span><span class="ident" id="5353645">tmpl</span><span class="op" id="5353649">,</span>&nbsp;<span class="ident" id="5353651">tree</span><span class="op" id="5353655">)</span><span class="op" id="5353656">;</span>&nbsp;<span class="ident" id="5353658">err</span>&nbsp;<span class="op" id="5353662">!=</span>&nbsp;<span class="ident" id="5353665">nil</span>&nbsp;<span class="op" id="5353669">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353674">return</span>&nbsp;<span class="ident" id="5353681">nil</span><span class="op" id="5353684">,</span>&nbsp;<span class="ident" id="5353686">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353692">}</span>&nbsp;<span class="keyword" id="5353694">else</span>&nbsp;<span class="keyword" id="5353699">if</span>&nbsp;<span class="ident" id="5353702">replace</span>&nbsp;<span class="op" id="5353710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353715">tmpl</span><span class="op" id="5353719">.</span><span class="ident" id="5353720">Tree</span>&nbsp;<span class="op" id="5353725">=</span>&nbsp;<span class="ident" id="5353727">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353738">tmpl</span><span class="op" id="5353742">.</span><span class="ident" id="5353743">leftDelim</span>&nbsp;<span class="op" id="5353753">=</span>&nbsp;<span class="ident" id="5353755">t</span><span class="op" id="5353756">.</span><span class="ident" id="5353757">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353769">tmpl</span><span class="op" id="5353773">.</span><span class="ident" id="5353774">rightDelim</span>&nbsp;<span class="op" id="5353785">=</span>&nbsp;<span class="ident" id="5353787">t</span><span class="op" id="5353788">.</span><span class="ident" id="5353789">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353804">return</span>&nbsp;<span class="ident" id="5353811">t</span><span class="op" id="5353812">,</span>&nbsp;<span class="ident" id="5353814">nil</span><br>
<span class="lineno"></span><span class="op" id="5353818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="5353821">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5353899">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="5353970">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="5354040">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5354113">func</span>&nbsp;<span class="op" id="5354118">(</span><span class="ident" id="5354119">t</span>&nbsp;<span class="op" id="5354121">*</span><span class="ident" id="5354122">Template</span><span class="op" id="5354130">)</span>&nbsp;<span class="ident" id="5354132">associate</span><span class="op" id="5354141">(</span><span class="builtinfunc" id="5354142">new</span>&nbsp;<span class="op" id="5354146">*</span><span class="ident" id="5354147">Template</span><span class="op" id="5354155">,</span>&nbsp;<span class="ident" id="5354157">tree</span>&nbsp;<span class="op" id="5354162">*</span><span class="ident" id="5354163">parse</span><span class="op" id="5354168">.</span><span class="ident" id="5354169">Tree</span><span class="op" id="5354173">)</span>&nbsp;<span class="op" id="5354175">(</span><span class="builtintype" id="5354176">bool</span><span class="op" id="5354180">,</span>&nbsp;<span class="builtintype" id="5354182">error</span><span class="op" id="5354187">)</span>&nbsp;<span class="op" id="5354189">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354192">if</span>&nbsp;<span class="builtinfunc" id="5354195">new</span><span class="op" id="5354198">.</span><span class="ident" id="5354199">common</span>&nbsp;<span class="op" id="5354206">!=</span>&nbsp;<span class="ident" id="5354209">t</span><span class="op" id="5354210">.</span><span class="ident" id="5354211">common</span>&nbsp;<span class="op" id="5354218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5354222">panic</span><span class="op" id="5354227">(</span><span class="string" id="5354228">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="5354266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354272">name</span>&nbsp;<span class="op" id="5354277">:=</span>&nbsp;<span class="builtinfunc" id="5354280">new</span><span class="op" id="5354283">.</span><span class="ident" id="5354284">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354290">if</span>&nbsp;<span class="ident" id="5354293">old</span>&nbsp;<span class="op" id="5354297">:=</span>&nbsp;<span class="ident" id="5354300">t</span><span class="op" id="5354301">.</span><span class="ident" id="5354302">tmpl</span><span class="op" id="5354306">[</span><span class="ident" id="5354307">name</span><span class="op" id="5354311">]</span><span class="op" id="5354312">;</span>&nbsp;<span class="ident" id="5354314">old</span>&nbsp;<span class="op" id="5354318">!=</span>&nbsp;<span class="ident" id="5354321">nil</span>&nbsp;<span class="op" id="5354325">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354329">oldIsEmpty</span>&nbsp;<span class="op" id="5354340">:=</span>&nbsp;<span class="ident" id="5354343">parse</span><span class="op" id="5354348">.</span><span class="ident" id="5354349">IsEmptyTree</span><span class="op" id="5354360">(</span><span class="ident" id="5354361">old</span><span class="op" id="5354364">.</span><span class="ident" id="5354365">Root</span><span class="op" id="5354369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354373">newIsEmpty</span>&nbsp;<span class="op" id="5354384">:=</span>&nbsp;<span class="ident" id="5354387">parse</span><span class="op" id="5354392">.</span><span class="ident" id="5354393">IsEmptyTree</span><span class="op" id="5354404">(</span><span class="ident" id="5354405">tree</span><span class="op" id="5354409">.</span><span class="ident" id="5354410">Root</span><span class="op" id="5354414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354418">if</span>&nbsp;<span class="ident" id="5354421">newIsEmpty</span>&nbsp;<span class="op" id="5354432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354437">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354512">return</span>&nbsp;<span class="builtintype" id="5354519">false</span><span class="op" id="5354524">,</span>&nbsp;<span class="ident" id="5354526">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354536">if</span>&nbsp;<span class="op" id="5354539">!</span><span class="ident" id="5354540">oldIsEmpty</span>&nbsp;<span class="op" id="5354551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354556">return</span>&nbsp;<span class="builtintype" id="5354563">false</span><span class="op" id="5354568">,</span>&nbsp;<span class="ident" id="5354570">fmt</span><span class="op" id="5354573">.</span><span class="ident" id="5354574">Errorf</span><span class="op" id="5354580">(</span><span class="string" id="5354581">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="5354620">,</span>&nbsp;<span class="ident" id="5354622">name</span><span class="op" id="5354626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354633">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354636">t</span><span class="op" id="5354637">.</span><span class="ident" id="5354638">tmpl</span><span class="op" id="5354642">[</span><span class="ident" id="5354643">name</span><span class="op" id="5354647">]</span>&nbsp;<span class="op" id="5354649">=</span>&nbsp;<span class="builtinfunc" id="5354651">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354656">return</span>&nbsp;<span class="builtintype" id="5354663">true</span><span class="op" id="5354667">,</span>&nbsp;<span class="ident" id="5354669">nil</span><br>
<span class="lineno"></span><span class="op" id="5354673">}</span>
</div>
</body>
</html>
