<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5480471">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5480526">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5480580">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5480631">package</span>&nbsp;<span class="ident" id="5480639">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480644">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5480663">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5480686">import</span>&nbsp;<span class="op" id="5480693">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480696">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480705">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480715">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480721">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480734">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480740">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480751">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5480762">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5480769">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5480772">var</span>&nbsp;<span class="op" id="5480776">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480779">ErrHeader</span>&nbsp;<span class="op" id="5480789">=</span>&nbsp;<span class="ident" id="5480791">errors</span><span class="op" id="5480797">.</span><span class="ident" id="5480798">New</span><span class="op" id="5480801">(</span><span class="string" id="5480802">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5480835">)</span><br>
<span class="lineno"></span><span class="op" id="5480837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5480840">const</span>&nbsp;<span class="ident" id="5480846">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5480867">=</span>&nbsp;<span class="num" id="5480869">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480872">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5480945">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5480995">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5481078">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5481151">type</span>&nbsp;<span class="ident" id="5481156">Reader</span>&nbsp;<span class="keyword" id="5481163">struct</span>&nbsp;<span class="op" id="5481170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481173">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481181">io</span><span class="op" id="5481183">.</span><span class="ident" id="5481184">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481192">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5481200">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481207">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481215">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5481231">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481288">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481296">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5481312">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481346">hdrBuff</span>&nbsp;<span class="op" id="5481354">[</span><span class="ident" id="5481355">blockSize</span><span class="op" id="5481364">]</span><span class="builtintype" id="5481365">byte</span>&nbsp;<span class="comment" id="5481370">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5481401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5481404">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5481485">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5481539">type</span>&nbsp;<span class="ident" id="5481544">numBytesReader</span>&nbsp;<span class="keyword" id="5481559">interface</span>&nbsp;<span class="op" id="5481569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481572">io</span><span class="op" id="5481574">.</span><span class="ident" id="5481575">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481583">numBytes</span><span class="op" id="5481591">(</span><span class="op" id="5481592">)</span>&nbsp;<span class="ident" id="5481594">int64</span><br>
<span class="lineno"></span><span class="op" id="5481600">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5481603">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5481684">type</span>&nbsp;<span class="ident" id="5481689">regFileReader</span>&nbsp;<span class="keyword" id="5481703">struct</span>&nbsp;<span class="op" id="5481710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481713">r</span>&nbsp;&nbsp;<span class="ident" id="5481716">io</span><span class="op" id="5481718">.</span><span class="ident" id="5481719">Reader</span>&nbsp;<span class="comment" id="5481726">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481748">nb</span>&nbsp;<span class="ident" id="5481751">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5481761">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5481810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5481813">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5481904">type</span>&nbsp;<span class="ident" id="5481909">sparseFileReader</span>&nbsp;<span class="keyword" id="5481926">struct</span>&nbsp;<span class="op" id="5481933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481936">rfr</span>&nbsp;<span class="op" id="5481940">*</span><span class="ident" id="5481941">regFileReader</span>&nbsp;<span class="comment" id="5481955">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481994">sp</span>&nbsp;&nbsp;<span class="op" id="5481998">[</span><span class="op" id="5481999">]</span><span class="ident" id="5482000">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5482013">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482045">pos</span>&nbsp;<span class="ident" id="5482049">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5482064">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482097">tot</span>&nbsp;<span class="ident" id="5482101">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5482116">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5482142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5482145">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5482203">const</span>&nbsp;<span class="op" id="5482209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482212">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5482234">=</span>&nbsp;<span class="string" id="5482236">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482260">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482282">=</span>&nbsp;<span class="string" id="5482284">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482305">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5482327">=</span>&nbsp;<span class="string" id="5482329">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482352">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482374">=</span>&nbsp;<span class="string" id="5482376">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482394">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482416">=</span>&nbsp;<span class="string" id="5482418">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482437">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482459">=</span>&nbsp;<span class="string" id="5482461">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482481">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482503">=</span>&nbsp;<span class="string" id="5482505">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482525">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482547">=</span>&nbsp;<span class="string" id="5482549">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482568">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5482590">=</span>&nbsp;<span class="string" id="5482592">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5482614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482617">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5482656">const</span>&nbsp;<span class="op" id="5482662">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482665">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482708">=</span>&nbsp;<span class="num" id="5482710">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482715">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482758">=</span>&nbsp;<span class="num" id="5482760">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482765">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482808">=</span>&nbsp;<span class="num" id="5482810">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482813">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5482856">=</span>&nbsp;<span class="num" id="5482858">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482863">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482906">=</span>&nbsp;<span class="num" id="5482908">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482912">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482955">=</span>&nbsp;<span class="num" id="5482957">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482961">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5483004">=</span>&nbsp;<span class="num" id="5483006">12</span><br>
<span class="lineno"></span><span class="op" id="5483009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483012">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5483062">func</span>&nbsp;<span class="ident" id="5483067">NewReader</span><span class="op" id="5483076">(</span><span class="ident" id="5483077">r</span>&nbsp;<span class="ident" id="5483079">io</span><span class="op" id="5483081">.</span><span class="ident" id="5483082">Reader</span><span class="op" id="5483088">)</span>&nbsp;<span class="op" id="5483090">*</span><span class="ident" id="5483091">Reader</span>&nbsp;<span class="op" id="5483098">{</span>&nbsp;<span class="keyword" id="5483100">return</span>&nbsp;<span class="op" id="5483107">&amp;</span><span class="ident" id="5483108">Reader</span><span class="op" id="5483114">{</span><span class="ident" id="5483115">r</span><span class="op" id="5483116">:</span>&nbsp;<span class="ident" id="5483118">r</span><span class="op" id="5483119">}</span>&nbsp;<span class="op" id="5483121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483124">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5483179">func</span>&nbsp;<span class="op" id="5483184">(</span><span class="ident" id="5483185">tr</span>&nbsp;<span class="op" id="5483188">*</span><span class="ident" id="5483189">Reader</span><span class="op" id="5483195">)</span>&nbsp;<span class="ident" id="5483197">Next</span><span class="op" id="5483201">(</span><span class="op" id="5483202">)</span>&nbsp;<span class="op" id="5483204">(</span><span class="op" id="5483205">*</span><span class="ident" id="5483206">Header</span><span class="op" id="5483212">,</span>&nbsp;<span class="builtintype" id="5483214">error</span><span class="op" id="5483219">)</span>&nbsp;<span class="op" id="5483221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483224">var</span>&nbsp;<span class="ident" id="5483228">hdr</span>&nbsp;<span class="op" id="5483232">*</span><span class="ident" id="5483233">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483241">if</span>&nbsp;<span class="ident" id="5483244">tr</span><span class="op" id="5483246">.</span><span class="ident" id="5483247">err</span>&nbsp;<span class="op" id="5483251">==</span>&nbsp;<span class="ident" id="5483254">nil</span>&nbsp;<span class="op" id="5483258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483262">tr</span><span class="op" id="5483264">.</span><span class="ident" id="5483265">skipUnread</span><span class="op" id="5483275">(</span><span class="op" id="5483276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483282">if</span>&nbsp;<span class="ident" id="5483285">tr</span><span class="op" id="5483287">.</span><span class="ident" id="5483288">err</span>&nbsp;<span class="op" id="5483292">!=</span>&nbsp;<span class="ident" id="5483295">nil</span>&nbsp;<span class="op" id="5483299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483303">return</span>&nbsp;<span class="ident" id="5483310">hdr</span><span class="op" id="5483313">,</span>&nbsp;<span class="ident" id="5483315">tr</span><span class="op" id="5483317">.</span><span class="ident" id="5483318">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483326">hdr</span>&nbsp;<span class="op" id="5483330">=</span>&nbsp;<span class="ident" id="5483332">tr</span><span class="op" id="5483334">.</span><span class="ident" id="5483335">readHeader</span><span class="op" id="5483345">(</span><span class="op" id="5483346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483349">if</span>&nbsp;<span class="ident" id="5483352">hdr</span>&nbsp;<span class="op" id="5483356">==</span>&nbsp;<span class="ident" id="5483359">nil</span>&nbsp;<span class="op" id="5483363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483367">return</span>&nbsp;<span class="ident" id="5483374">hdr</span><span class="op" id="5483377">,</span>&nbsp;<span class="ident" id="5483379">tr</span><span class="op" id="5483381">.</span><span class="ident" id="5483382">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483387">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483390">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483420">switch</span>&nbsp;<span class="ident" id="5483427">hdr</span><span class="op" id="5483430">.</span><span class="ident" id="5483431">Typeflag</span>&nbsp;<span class="op" id="5483440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483443">case</span>&nbsp;<span class="ident" id="5483448">TypeXHeader</span><span class="op" id="5483459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483463">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483489">headers</span><span class="op" id="5483496">,</span>&nbsp;<span class="ident" id="5483498">err</span>&nbsp;<span class="op" id="5483502">:=</span>&nbsp;<span class="ident" id="5483505">parsePAX</span><span class="op" id="5483513">(</span><span class="ident" id="5483514">tr</span><span class="op" id="5483516">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483520">if</span>&nbsp;<span class="ident" id="5483523">err</span>&nbsp;<span class="op" id="5483527">!=</span>&nbsp;<span class="ident" id="5483530">nil</span>&nbsp;<span class="op" id="5483534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483539">return</span>&nbsp;<span class="ident" id="5483546">nil</span><span class="op" id="5483549">,</span>&nbsp;<span class="ident" id="5483551">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483561">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483599">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483637">tr</span><span class="op" id="5483639">.</span><span class="ident" id="5483640">skipUnread</span><span class="op" id="5483650">(</span><span class="op" id="5483651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483655">hdr</span>&nbsp;<span class="op" id="5483659">=</span>&nbsp;<span class="ident" id="5483661">tr</span><span class="op" id="5483663">.</span><span class="ident" id="5483664">readHeader</span><span class="op" id="5483674">(</span><span class="op" id="5483675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483679">mergePAX</span><span class="op" id="5483687">(</span><span class="ident" id="5483688">hdr</span><span class="op" id="5483691">,</span>&nbsp;<span class="ident" id="5483693">headers</span><span class="op" id="5483700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483705">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483745">sp</span><span class="op" id="5483747">,</span>&nbsp;<span class="ident" id="5483749">err</span>&nbsp;<span class="op" id="5483753">:=</span>&nbsp;<span class="ident" id="5483756">tr</span><span class="op" id="5483758">.</span><span class="ident" id="5483759">checkForGNUSparsePAXHeaders</span><span class="op" id="5483786">(</span><span class="ident" id="5483787">hdr</span><span class="op" id="5483790">,</span>&nbsp;<span class="ident" id="5483792">headers</span><span class="op" id="5483799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483803">if</span>&nbsp;<span class="ident" id="5483806">err</span>&nbsp;<span class="op" id="5483810">!=</span>&nbsp;<span class="ident" id="5483813">nil</span>&nbsp;<span class="op" id="5483817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483822">tr</span><span class="op" id="5483824">.</span><span class="ident" id="5483825">err</span>&nbsp;<span class="op" id="5483829">=</span>&nbsp;<span class="ident" id="5483831">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483838">return</span>&nbsp;<span class="ident" id="5483845">nil</span><span class="op" id="5483848">,</span>&nbsp;<span class="ident" id="5483850">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483856">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483860">if</span>&nbsp;<span class="ident" id="5483863">sp</span>&nbsp;<span class="op" id="5483866">!=</span>&nbsp;<span class="ident" id="5483869">nil</span>&nbsp;<span class="op" id="5483873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483878">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483930">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483989">tr</span><span class="op" id="5483991">.</span><span class="ident" id="5483992">curr</span>&nbsp;<span class="op" id="5483997">=</span>&nbsp;<span class="op" id="5483999">&amp;</span><span class="ident" id="5484000">sparseFileReader</span><span class="op" id="5484016">{</span><span class="ident" id="5484017">rfr</span><span class="op" id="5484020">:</span>&nbsp;<span class="ident" id="5484022">tr</span><span class="op" id="5484024">.</span><span class="ident" id="5484025">curr</span><span class="op" id="5484029">.</span><span class="op" id="5484030">(</span><span class="op" id="5484031">*</span><span class="ident" id="5484032">regFileReader</span><span class="op" id="5484045">)</span><span class="op" id="5484046">,</span>&nbsp;<span class="ident" id="5484048">sp</span><span class="op" id="5484050">:</span>&nbsp;<span class="ident" id="5484052">sp</span><span class="op" id="5484054">,</span>&nbsp;<span class="ident" id="5484056">tot</span><span class="op" id="5484059">:</span>&nbsp;<span class="ident" id="5484061">hdr</span><span class="op" id="5484064">.</span><span class="ident" id="5484065">Size</span><span class="op" id="5484069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484073">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484077">return</span>&nbsp;<span class="ident" id="5484084">hdr</span><span class="op" id="5484087">,</span>&nbsp;<span class="ident" id="5484089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484094">case</span>&nbsp;<span class="ident" id="5484099">TypeGNULongName</span><span class="op" id="5484114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484118">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484192">realname</span><span class="op" id="5484200">,</span>&nbsp;<span class="ident" id="5484202">err</span>&nbsp;<span class="op" id="5484206">:=</span>&nbsp;<span class="ident" id="5484209">ioutil</span><span class="op" id="5484215">.</span><span class="ident" id="5484216">ReadAll</span><span class="op" id="5484223">(</span><span class="ident" id="5484224">tr</span><span class="op" id="5484226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484230">if</span>&nbsp;<span class="ident" id="5484233">err</span>&nbsp;<span class="op" id="5484237">!=</span>&nbsp;<span class="ident" id="5484240">nil</span>&nbsp;<span class="op" id="5484244">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484249">return</span>&nbsp;<span class="ident" id="5484256">nil</span><span class="op" id="5484259">,</span>&nbsp;<span class="ident" id="5484261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484271">hdr</span><span class="op" id="5484274">,</span>&nbsp;<span class="ident" id="5484276">err</span>&nbsp;<span class="op" id="5484280">:=</span>&nbsp;<span class="ident" id="5484283">tr</span><span class="op" id="5484285">.</span><span class="ident" id="5484286">Next</span><span class="op" id="5484290">(</span><span class="op" id="5484291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484295">hdr</span><span class="op" id="5484298">.</span><span class="ident" id="5484299">Name</span>&nbsp;<span class="op" id="5484304">=</span>&nbsp;<span class="ident" id="5484306">cString</span><span class="op" id="5484313">(</span><span class="ident" id="5484314">realname</span><span class="op" id="5484322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484326">return</span>&nbsp;<span class="ident" id="5484333">hdr</span><span class="op" id="5484336">,</span>&nbsp;<span class="ident" id="5484338">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484343">case</span>&nbsp;<span class="ident" id="5484348">TypeGNULongLink</span><span class="op" id="5484363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484367">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484404">realname</span><span class="op" id="5484412">,</span>&nbsp;<span class="ident" id="5484414">err</span>&nbsp;<span class="op" id="5484418">:=</span>&nbsp;<span class="ident" id="5484421">ioutil</span><span class="op" id="5484427">.</span><span class="ident" id="5484428">ReadAll</span><span class="op" id="5484435">(</span><span class="ident" id="5484436">tr</span><span class="op" id="5484438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484442">if</span>&nbsp;<span class="ident" id="5484445">err</span>&nbsp;<span class="op" id="5484449">!=</span>&nbsp;<span class="ident" id="5484452">nil</span>&nbsp;<span class="op" id="5484456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484461">return</span>&nbsp;<span class="ident" id="5484468">nil</span><span class="op" id="5484471">,</span>&nbsp;<span class="ident" id="5484473">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484483">hdr</span><span class="op" id="5484486">,</span>&nbsp;<span class="ident" id="5484488">err</span>&nbsp;<span class="op" id="5484492">:=</span>&nbsp;<span class="ident" id="5484495">tr</span><span class="op" id="5484497">.</span><span class="ident" id="5484498">Next</span><span class="op" id="5484502">(</span><span class="op" id="5484503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484507">hdr</span><span class="op" id="5484510">.</span><span class="ident" id="5484511">Linkname</span>&nbsp;<span class="op" id="5484520">=</span>&nbsp;<span class="ident" id="5484522">cString</span><span class="op" id="5484529">(</span><span class="ident" id="5484530">realname</span><span class="op" id="5484538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484542">return</span>&nbsp;<span class="ident" id="5484549">hdr</span><span class="op" id="5484552">,</span>&nbsp;<span class="ident" id="5484554">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484559">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484562">return</span>&nbsp;<span class="ident" id="5484569">hdr</span><span class="op" id="5484572">,</span>&nbsp;<span class="ident" id="5484574">tr</span><span class="op" id="5484576">.</span><span class="ident" id="5484577">err</span><br>
<span class="lineno"></span><span class="op" id="5484581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5484584">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5484686">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5484796">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5484829">func</span>&nbsp;<span class="op" id="5484834">(</span><span class="ident" id="5484835">tr</span>&nbsp;<span class="op" id="5484838">*</span><span class="ident" id="5484839">Reader</span><span class="op" id="5484845">)</span>&nbsp;<span class="ident" id="5484847">checkForGNUSparsePAXHeaders</span><span class="op" id="5484874">(</span><span class="ident" id="5484875">hdr</span>&nbsp;<span class="op" id="5484879">*</span><span class="ident" id="5484880">Header</span><span class="op" id="5484886">,</span>&nbsp;<span class="ident" id="5484888">headers</span>&nbsp;<span class="keyword" id="5484896">map</span><span class="op" id="5484899">[</span><span class="builtintype" id="5484900">string</span><span class="op" id="5484906">]</span><span class="builtintype" id="5484907">string</span><span class="op" id="5484913">)</span>&nbsp;<span class="op" id="5484915">(</span><span class="op" id="5484916">[</span><span class="op" id="5484917">]</span><span class="ident" id="5484918">sparseEntry</span><span class="op" id="5484929">,</span>&nbsp;<span class="builtintype" id="5484931">error</span><span class="op" id="5484936">)</span>&nbsp;<span class="op" id="5484938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484941">var</span>&nbsp;<span class="ident" id="5484945">sparseFormat</span>&nbsp;<span class="builtintype" id="5484958">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484967">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485006">major</span><span class="op" id="5485011">,</span>&nbsp;<span class="ident" id="5485013">majorOk</span>&nbsp;<span class="op" id="5485021">:=</span>&nbsp;<span class="ident" id="5485024">headers</span><span class="op" id="5485031">[</span><span class="ident" id="5485032">paxGNUSparseMajor</span><span class="op" id="5485049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485052">minor</span><span class="op" id="5485057">,</span>&nbsp;<span class="ident" id="5485059">minorOk</span>&nbsp;<span class="op" id="5485067">:=</span>&nbsp;<span class="ident" id="5485070">headers</span><span class="op" id="5485077">[</span><span class="ident" id="5485078">paxGNUSparseMinor</span><span class="op" id="5485095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485098">sparseName</span><span class="op" id="5485108">,</span>&nbsp;<span class="ident" id="5485110">sparseNameOk</span>&nbsp;<span class="op" id="5485123">:=</span>&nbsp;<span class="ident" id="5485126">headers</span><span class="op" id="5485133">[</span><span class="ident" id="5485134">paxGNUSparseName</span><span class="op" id="5485150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485153">_</span><span class="op" id="5485154">,</span>&nbsp;<span class="ident" id="5485156">sparseMapOk</span>&nbsp;<span class="op" id="5485168">:=</span>&nbsp;<span class="ident" id="5485171">headers</span><span class="op" id="5485178">[</span><span class="ident" id="5485179">paxGNUSparseMap</span><span class="op" id="5485194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485197">sparseSize</span><span class="op" id="5485207">,</span>&nbsp;<span class="ident" id="5485209">sparseSizeOk</span>&nbsp;<span class="op" id="5485222">:=</span>&nbsp;<span class="ident" id="5485225">headers</span><span class="op" id="5485232">[</span><span class="ident" id="5485233">paxGNUSparseSize</span><span class="op" id="5485249">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485252">sparseRealSize</span><span class="op" id="5485266">,</span>&nbsp;<span class="ident" id="5485268">sparseRealSizeOk</span>&nbsp;<span class="op" id="5485285">:=</span>&nbsp;<span class="ident" id="5485288">headers</span><span class="op" id="5485295">[</span><span class="ident" id="5485296">paxGNUSparseRealSize</span><span class="op" id="5485316">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485320">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485401">if</span>&nbsp;<span class="ident" id="5485404">majorOk</span>&nbsp;<span class="op" id="5485412">&amp;&amp;</span>&nbsp;<span class="ident" id="5485415">minorOk</span>&nbsp;<span class="op" id="5485423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485427">sparseFormat</span>&nbsp;<span class="op" id="5485440">=</span>&nbsp;<span class="ident" id="5485442">major</span>&nbsp;<span class="op" id="5485448">+</span>&nbsp;<span class="string" id="5485450">&#34;.&#34;</span>&nbsp;<span class="op" id="5485454">+</span>&nbsp;<span class="ident" id="5485456">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485463">}</span>&nbsp;<span class="keyword" id="5485465">else</span>&nbsp;<span class="keyword" id="5485470">if</span>&nbsp;<span class="ident" id="5485473">sparseNameOk</span>&nbsp;<span class="op" id="5485486">&amp;&amp;</span>&nbsp;<span class="ident" id="5485489">sparseMapOk</span>&nbsp;<span class="op" id="5485501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485505">sparseFormat</span>&nbsp;<span class="op" id="5485518">=</span>&nbsp;<span class="string" id="5485520">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485527">}</span>&nbsp;<span class="keyword" id="5485529">else</span>&nbsp;<span class="keyword" id="5485534">if</span>&nbsp;<span class="ident" id="5485537">sparseSizeOk</span>&nbsp;<span class="op" id="5485550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485554">sparseFormat</span>&nbsp;<span class="op" id="5485567">=</span>&nbsp;<span class="string" id="5485569">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485576">}</span>&nbsp;<span class="keyword" id="5485578">else</span>&nbsp;<span class="op" id="5485583">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485587">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485626">return</span>&nbsp;<span class="ident" id="5485633">nil</span><span class="op" id="5485636">,</span>&nbsp;<span class="ident" id="5485638">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485647">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485683">if</span>&nbsp;<span class="ident" id="5485686">sparseFormat</span>&nbsp;<span class="op" id="5485699">!=</span>&nbsp;<span class="string" id="5485702">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5485708">&amp;&amp;</span>&nbsp;<span class="ident" id="5485711">sparseFormat</span>&nbsp;<span class="op" id="5485724">!=</span>&nbsp;<span class="string" id="5485727">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5485733">&amp;&amp;</span>&nbsp;<span class="ident" id="5485736">sparseFormat</span>&nbsp;<span class="op" id="5485749">!=</span>&nbsp;<span class="string" id="5485752">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5485758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485762">return</span>&nbsp;<span class="ident" id="5485769">nil</span><span class="op" id="5485772">,</span>&nbsp;<span class="ident" id="5485774">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485783">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485826">if</span>&nbsp;<span class="ident" id="5485829">sparseNameOk</span>&nbsp;<span class="op" id="5485842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485846">hdr</span><span class="op" id="5485849">.</span><span class="ident" id="5485850">Name</span>&nbsp;<span class="op" id="5485855">=</span>&nbsp;<span class="ident" id="5485857">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485872">if</span>&nbsp;<span class="ident" id="5485875">sparseSizeOk</span>&nbsp;<span class="op" id="5485888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485892">realSize</span><span class="op" id="5485900">,</span>&nbsp;<span class="ident" id="5485902">err</span>&nbsp;<span class="op" id="5485906">:=</span>&nbsp;<span class="ident" id="5485909">strconv</span><span class="op" id="5485916">.</span><span class="ident" id="5485917">ParseInt</span><span class="op" id="5485925">(</span><span class="ident" id="5485926">sparseSize</span><span class="op" id="5485936">,</span>&nbsp;<span class="num" id="5485938">10</span><span class="op" id="5485940">,</span>&nbsp;<span class="num" id="5485942">0</span><span class="op" id="5485943">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485947">if</span>&nbsp;<span class="ident" id="5485950">err</span>&nbsp;<span class="op" id="5485954">!=</span>&nbsp;<span class="ident" id="5485957">nil</span>&nbsp;<span class="op" id="5485961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485966">return</span>&nbsp;<span class="ident" id="5485973">nil</span><span class="op" id="5485976">,</span>&nbsp;<span class="ident" id="5485978">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485994">hdr</span><span class="op" id="5485997">.</span><span class="ident" id="5485998">Size</span>&nbsp;<span class="op" id="5486003">=</span>&nbsp;<span class="ident" id="5486005">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486015">}</span>&nbsp;<span class="keyword" id="5486017">else</span>&nbsp;<span class="keyword" id="5486022">if</span>&nbsp;<span class="ident" id="5486025">sparseRealSizeOk</span>&nbsp;<span class="op" id="5486042">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486046">realSize</span><span class="op" id="5486054">,</span>&nbsp;<span class="ident" id="5486056">err</span>&nbsp;<span class="op" id="5486060">:=</span>&nbsp;<span class="ident" id="5486063">strconv</span><span class="op" id="5486070">.</span><span class="ident" id="5486071">ParseInt</span><span class="op" id="5486079">(</span><span class="ident" id="5486080">sparseRealSize</span><span class="op" id="5486094">,</span>&nbsp;<span class="num" id="5486096">10</span><span class="op" id="5486098">,</span>&nbsp;<span class="num" id="5486100">0</span><span class="op" id="5486101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486105">if</span>&nbsp;<span class="ident" id="5486108">err</span>&nbsp;<span class="op" id="5486112">!=</span>&nbsp;<span class="ident" id="5486115">nil</span>&nbsp;<span class="op" id="5486119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486124">return</span>&nbsp;<span class="ident" id="5486131">nil</span><span class="op" id="5486134">,</span>&nbsp;<span class="ident" id="5486136">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486152">hdr</span><span class="op" id="5486155">.</span><span class="ident" id="5486156">Size</span>&nbsp;<span class="op" id="5486161">=</span>&nbsp;<span class="ident" id="5486163">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486177">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486253">var</span>&nbsp;<span class="ident" id="5486257">sp</span>&nbsp;<span class="op" id="5486260">[</span><span class="op" id="5486261">]</span><span class="ident" id="5486262">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486275">var</span>&nbsp;<span class="ident" id="5486279">err</span>&nbsp;<span class="builtintype" id="5486283">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486290">switch</span>&nbsp;<span class="ident" id="5486297">sparseFormat</span>&nbsp;<span class="op" id="5486310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486313">case</span>&nbsp;<span class="string" id="5486318">&#34;0.0&#34;</span><span class="op" id="5486323">,</span>&nbsp;<span class="string" id="5486325">&#34;0.1&#34;</span><span class="op" id="5486330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486334">sp</span><span class="op" id="5486336">,</span>&nbsp;<span class="ident" id="5486338">err</span>&nbsp;<span class="op" id="5486342">=</span>&nbsp;<span class="ident" id="5486344">readGNUSparseMap0x1</span><span class="op" id="5486363">(</span><span class="ident" id="5486364">headers</span><span class="op" id="5486371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486374">case</span>&nbsp;<span class="string" id="5486379">&#34;1.0&#34;</span><span class="op" id="5486384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486388">sp</span><span class="op" id="5486390">,</span>&nbsp;<span class="ident" id="5486392">err</span>&nbsp;<span class="op" id="5486396">=</span>&nbsp;<span class="ident" id="5486398">readGNUSparseMap1x0</span><span class="op" id="5486417">(</span><span class="ident" id="5486418">tr</span><span class="op" id="5486420">.</span><span class="ident" id="5486421">curr</span><span class="op" id="5486425">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486431">return</span>&nbsp;<span class="ident" id="5486438">sp</span><span class="op" id="5486440">,</span>&nbsp;<span class="ident" id="5486442">err</span><br>
<span class="lineno"></span><span class="op" id="5486446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5486449">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5486514">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5486570">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5486630">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5486692">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5486725">func</span>&nbsp;<span class="ident" id="5486730">mergePAX</span><span class="op" id="5486738">(</span><span class="ident" id="5486739">hdr</span>&nbsp;<span class="op" id="5486743">*</span><span class="ident" id="5486744">Header</span><span class="op" id="5486750">,</span>&nbsp;<span class="ident" id="5486752">headers</span>&nbsp;<span class="keyword" id="5486760">map</span><span class="op" id="5486763">[</span><span class="builtintype" id="5486764">string</span><span class="op" id="5486770">]</span><span class="builtintype" id="5486771">string</span><span class="op" id="5486777">)</span>&nbsp;<span class="builtintype" id="5486779">error</span>&nbsp;<span class="op" id="5486785">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486788">for</span>&nbsp;<span class="ident" id="5486792">k</span><span class="op" id="5486793">,</span>&nbsp;<span class="ident" id="5486795">v</span>&nbsp;<span class="op" id="5486797">:=</span>&nbsp;<span class="keyword" id="5486800">range</span>&nbsp;<span class="ident" id="5486806">headers</span>&nbsp;<span class="op" id="5486814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486818">switch</span>&nbsp;<span class="ident" id="5486825">k</span>&nbsp;<span class="op" id="5486827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486831">case</span>&nbsp;<span class="ident" id="5486836">paxPath</span><span class="op" id="5486843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486848">hdr</span><span class="op" id="5486851">.</span><span class="ident" id="5486852">Name</span>&nbsp;<span class="op" id="5486857">=</span>&nbsp;<span class="ident" id="5486859">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486863">case</span>&nbsp;<span class="ident" id="5486868">paxLinkpath</span><span class="op" id="5486879">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486884">hdr</span><span class="op" id="5486887">.</span><span class="ident" id="5486888">Linkname</span>&nbsp;<span class="op" id="5486897">=</span>&nbsp;<span class="ident" id="5486899">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486903">case</span>&nbsp;<span class="ident" id="5486908">paxGname</span><span class="op" id="5486916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486921">hdr</span><span class="op" id="5486924">.</span><span class="ident" id="5486925">Gname</span>&nbsp;<span class="op" id="5486931">=</span>&nbsp;<span class="ident" id="5486933">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486937">case</span>&nbsp;<span class="ident" id="5486942">paxUname</span><span class="op" id="5486950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486955">hdr</span><span class="op" id="5486958">.</span><span class="ident" id="5486959">Uname</span>&nbsp;<span class="op" id="5486965">=</span>&nbsp;<span class="ident" id="5486967">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486971">case</span>&nbsp;<span class="ident" id="5486976">paxUid</span><span class="op" id="5486982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486987">uid</span><span class="op" id="5486990">,</span>&nbsp;<span class="ident" id="5486992">err</span>&nbsp;<span class="op" id="5486996">:=</span>&nbsp;<span class="ident" id="5486999">strconv</span><span class="op" id="5487006">.</span><span class="ident" id="5487007">ParseInt</span><span class="op" id="5487015">(</span><span class="ident" id="5487016">v</span><span class="op" id="5487017">,</span>&nbsp;<span class="num" id="5487019">10</span><span class="op" id="5487021">,</span>&nbsp;<span class="num" id="5487023">0</span><span class="op" id="5487024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487029">if</span>&nbsp;<span class="ident" id="5487032">err</span>&nbsp;<span class="op" id="5487036">!=</span>&nbsp;<span class="ident" id="5487039">nil</span>&nbsp;<span class="op" id="5487043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487049">return</span>&nbsp;<span class="ident" id="5487056">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487063">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487068">hdr</span><span class="op" id="5487071">.</span><span class="ident" id="5487072">Uid</span>&nbsp;<span class="op" id="5487076">=</span>&nbsp;<span class="builtintype" id="5487078">int</span><span class="op" id="5487081">(</span><span class="ident" id="5487082">uid</span><span class="op" id="5487085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487089">case</span>&nbsp;<span class="ident" id="5487094">paxGid</span><span class="op" id="5487100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487105">gid</span><span class="op" id="5487108">,</span>&nbsp;<span class="ident" id="5487110">err</span>&nbsp;<span class="op" id="5487114">:=</span>&nbsp;<span class="ident" id="5487117">strconv</span><span class="op" id="5487124">.</span><span class="ident" id="5487125">ParseInt</span><span class="op" id="5487133">(</span><span class="ident" id="5487134">v</span><span class="op" id="5487135">,</span>&nbsp;<span class="num" id="5487137">10</span><span class="op" id="5487139">,</span>&nbsp;<span class="num" id="5487141">0</span><span class="op" id="5487142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487147">if</span>&nbsp;<span class="ident" id="5487150">err</span>&nbsp;<span class="op" id="5487154">!=</span>&nbsp;<span class="ident" id="5487157">nil</span>&nbsp;<span class="op" id="5487161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487167">return</span>&nbsp;<span class="ident" id="5487174">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487186">hdr</span><span class="op" id="5487189">.</span><span class="ident" id="5487190">Gid</span>&nbsp;<span class="op" id="5487194">=</span>&nbsp;<span class="builtintype" id="5487196">int</span><span class="op" id="5487199">(</span><span class="ident" id="5487200">gid</span><span class="op" id="5487203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487207">case</span>&nbsp;<span class="ident" id="5487212">paxAtime</span><span class="op" id="5487220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487225">t</span><span class="op" id="5487226">,</span>&nbsp;<span class="ident" id="5487228">err</span>&nbsp;<span class="op" id="5487232">:=</span>&nbsp;<span class="ident" id="5487235">parsePAXTime</span><span class="op" id="5487247">(</span><span class="ident" id="5487248">v</span><span class="op" id="5487249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487254">if</span>&nbsp;<span class="ident" id="5487257">err</span>&nbsp;<span class="op" id="5487261">!=</span>&nbsp;<span class="ident" id="5487264">nil</span>&nbsp;<span class="op" id="5487268">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487274">return</span>&nbsp;<span class="ident" id="5487281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487293">hdr</span><span class="op" id="5487296">.</span><span class="ident" id="5487297">AccessTime</span>&nbsp;<span class="op" id="5487308">=</span>&nbsp;<span class="ident" id="5487310">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487314">case</span>&nbsp;<span class="ident" id="5487319">paxMtime</span><span class="op" id="5487327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487332">t</span><span class="op" id="5487333">,</span>&nbsp;<span class="ident" id="5487335">err</span>&nbsp;<span class="op" id="5487339">:=</span>&nbsp;<span class="ident" id="5487342">parsePAXTime</span><span class="op" id="5487354">(</span><span class="ident" id="5487355">v</span><span class="op" id="5487356">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487361">if</span>&nbsp;<span class="ident" id="5487364">err</span>&nbsp;<span class="op" id="5487368">!=</span>&nbsp;<span class="ident" id="5487371">nil</span>&nbsp;<span class="op" id="5487375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487381">return</span>&nbsp;<span class="ident" id="5487388">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487400">hdr</span><span class="op" id="5487403">.</span><span class="ident" id="5487404">ModTime</span>&nbsp;<span class="op" id="5487412">=</span>&nbsp;<span class="ident" id="5487414">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487418">case</span>&nbsp;<span class="ident" id="5487423">paxCtime</span><span class="op" id="5487431">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487436">t</span><span class="op" id="5487437">,</span>&nbsp;<span class="ident" id="5487439">err</span>&nbsp;<span class="op" id="5487443">:=</span>&nbsp;<span class="ident" id="5487446">parsePAXTime</span><span class="op" id="5487458">(</span><span class="ident" id="5487459">v</span><span class="op" id="5487460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487465">if</span>&nbsp;<span class="ident" id="5487468">err</span>&nbsp;<span class="op" id="5487472">!=</span>&nbsp;<span class="ident" id="5487475">nil</span>&nbsp;<span class="op" id="5487479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487485">return</span>&nbsp;<span class="ident" id="5487492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487504">hdr</span><span class="op" id="5487507">.</span><span class="ident" id="5487508">ChangeTime</span>&nbsp;<span class="op" id="5487519">=</span>&nbsp;<span class="ident" id="5487521">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487525">case</span>&nbsp;<span class="ident" id="5487530">paxSize</span><span class="op" id="5487537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487542">size</span><span class="op" id="5487546">,</span>&nbsp;<span class="ident" id="5487548">err</span>&nbsp;<span class="op" id="5487552">:=</span>&nbsp;<span class="ident" id="5487555">strconv</span><span class="op" id="5487562">.</span><span class="ident" id="5487563">ParseInt</span><span class="op" id="5487571">(</span><span class="ident" id="5487572">v</span><span class="op" id="5487573">,</span>&nbsp;<span class="num" id="5487575">10</span><span class="op" id="5487577">,</span>&nbsp;<span class="num" id="5487579">0</span><span class="op" id="5487580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487585">if</span>&nbsp;<span class="ident" id="5487588">err</span>&nbsp;<span class="op" id="5487592">!=</span>&nbsp;<span class="ident" id="5487595">nil</span>&nbsp;<span class="op" id="5487599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487605">return</span>&nbsp;<span class="ident" id="5487612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487619">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487624">hdr</span><span class="op" id="5487627">.</span><span class="ident" id="5487628">Size</span>&nbsp;<span class="op" id="5487633">=</span>&nbsp;<span class="ident" id="5487635">int64</span><span class="op" id="5487640">(</span><span class="ident" id="5487641">size</span><span class="op" id="5487645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487649">default</span><span class="op" id="5487656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487661">if</span>&nbsp;<span class="ident" id="5487664">strings</span><span class="op" id="5487671">.</span><span class="ident" id="5487672">HasPrefix</span><span class="op" id="5487681">(</span><span class="ident" id="5487682">k</span><span class="op" id="5487683">,</span>&nbsp;<span class="ident" id="5487685">paxXattr</span><span class="op" id="5487693">)</span>&nbsp;<span class="op" id="5487695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487701">if</span>&nbsp;<span class="ident" id="5487704">hdr</span><span class="op" id="5487707">.</span><span class="ident" id="5487708">Xattrs</span>&nbsp;<span class="op" id="5487715">==</span>&nbsp;<span class="ident" id="5487718">nil</span>&nbsp;<span class="op" id="5487722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487729">hdr</span><span class="op" id="5487732">.</span><span class="ident" id="5487733">Xattrs</span>&nbsp;<span class="op" id="5487740">=</span>&nbsp;<span class="builtinfunc" id="5487742">make</span><span class="op" id="5487746">(</span><span class="keyword" id="5487747">map</span><span class="op" id="5487750">[</span><span class="builtintype" id="5487751">string</span><span class="op" id="5487757">]</span><span class="builtintype" id="5487758">string</span><span class="op" id="5487764">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487776">hdr</span><span class="op" id="5487779">.</span><span class="ident" id="5487780">Xattrs</span><span class="op" id="5487786">[</span><span class="ident" id="5487787">k</span><span class="op" id="5487788">[</span><span class="builtinfunc" id="5487789">len</span><span class="op" id="5487792">(</span><span class="ident" id="5487793">paxXattr</span><span class="op" id="5487801">)</span><span class="op" id="5487802">:</span><span class="op" id="5487803">]</span><span class="op" id="5487804">]</span>&nbsp;<span class="op" id="5487806">=</span>&nbsp;<span class="ident" id="5487808">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487820">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487823">return</span>&nbsp;<span class="ident" id="5487830">nil</span><br>
<span class="lineno"></span><span class="op" id="5487834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5487837">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5487902">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5487928">func</span>&nbsp;<span class="ident" id="5487933">parsePAXTime</span><span class="op" id="5487945">(</span><span class="ident" id="5487946">t</span>&nbsp;<span class="builtintype" id="5487948">string</span><span class="op" id="5487954">)</span>&nbsp;<span class="op" id="5487956">(</span><span class="ident" id="5487957">time</span><span class="op" id="5487961">.</span><span class="ident" id="5487962">Time</span><span class="op" id="5487966">,</span>&nbsp;<span class="builtintype" id="5487968">error</span><span class="op" id="5487973">)</span>&nbsp;<span class="op" id="5487975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487978">buf</span>&nbsp;<span class="op" id="5487982">:=</span>&nbsp;<span class="op" id="5487985">[</span><span class="op" id="5487986">]</span><span class="builtintype" id="5487987">byte</span><span class="op" id="5487991">(</span><span class="ident" id="5487992">t</span><span class="op" id="5487993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487996">pos</span>&nbsp;<span class="op" id="5488000">:=</span>&nbsp;<span class="ident" id="5488003">bytes</span><span class="op" id="5488008">.</span><span class="ident" id="5488009">IndexByte</span><span class="op" id="5488018">(</span><span class="ident" id="5488019">buf</span><span class="op" id="5488022">,</span>&nbsp;<span class="string" id="5488024">&#39;.&#39;</span><span class="op" id="5488027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488030">var</span>&nbsp;<span class="ident" id="5488034">seconds</span><span class="op" id="5488041">,</span>&nbsp;<span class="ident" id="5488043">nanoseconds</span>&nbsp;<span class="ident" id="5488055">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488062">var</span>&nbsp;<span class="ident" id="5488066">err</span>&nbsp;<span class="builtintype" id="5488070">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488077">if</span>&nbsp;<span class="ident" id="5488080">pos</span>&nbsp;<span class="op" id="5488084">==</span>&nbsp;<span class="op" id="5488087">-</span><span class="num" id="5488088">1</span>&nbsp;<span class="op" id="5488090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488094">seconds</span><span class="op" id="5488101">,</span>&nbsp;<span class="ident" id="5488103">err</span>&nbsp;<span class="op" id="5488107">=</span>&nbsp;<span class="ident" id="5488109">strconv</span><span class="op" id="5488116">.</span><span class="ident" id="5488117">ParseInt</span><span class="op" id="5488125">(</span><span class="ident" id="5488126">t</span><span class="op" id="5488127">,</span>&nbsp;<span class="num" id="5488129">10</span><span class="op" id="5488131">,</span>&nbsp;<span class="num" id="5488133">0</span><span class="op" id="5488134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488138">if</span>&nbsp;<span class="ident" id="5488141">err</span>&nbsp;<span class="op" id="5488145">!=</span>&nbsp;<span class="ident" id="5488148">nil</span>&nbsp;<span class="op" id="5488152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488157">return</span>&nbsp;<span class="ident" id="5488164">time</span><span class="op" id="5488168">.</span><span class="ident" id="5488169">Time</span><span class="op" id="5488173">{</span><span class="op" id="5488174">}</span><span class="op" id="5488175">,</span>&nbsp;<span class="ident" id="5488177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488183">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488186">}</span>&nbsp;<span class="keyword" id="5488188">else</span>&nbsp;<span class="op" id="5488193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488197">seconds</span><span class="op" id="5488204">,</span>&nbsp;<span class="ident" id="5488206">err</span>&nbsp;<span class="op" id="5488210">=</span>&nbsp;<span class="ident" id="5488212">strconv</span><span class="op" id="5488219">.</span><span class="ident" id="5488220">ParseInt</span><span class="op" id="5488228">(</span><span class="builtintype" id="5488229">string</span><span class="op" id="5488235">(</span><span class="ident" id="5488236">buf</span><span class="op" id="5488239">[</span><span class="op" id="5488240">:</span><span class="ident" id="5488241">pos</span><span class="op" id="5488244">]</span><span class="op" id="5488245">)</span><span class="op" id="5488246">,</span>&nbsp;<span class="num" id="5488248">10</span><span class="op" id="5488250">,</span>&nbsp;<span class="num" id="5488252">0</span><span class="op" id="5488253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488257">if</span>&nbsp;<span class="ident" id="5488260">err</span>&nbsp;<span class="op" id="5488264">!=</span>&nbsp;<span class="ident" id="5488267">nil</span>&nbsp;<span class="op" id="5488271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488276">return</span>&nbsp;<span class="ident" id="5488283">time</span><span class="op" id="5488287">.</span><span class="ident" id="5488288">Time</span><span class="op" id="5488292">{</span><span class="op" id="5488293">}</span><span class="op" id="5488294">,</span>&nbsp;<span class="ident" id="5488296">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488302">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488306">nano_buf</span>&nbsp;<span class="op" id="5488315">:=</span>&nbsp;<span class="builtintype" id="5488318">string</span><span class="op" id="5488324">(</span><span class="ident" id="5488325">buf</span><span class="op" id="5488328">[</span><span class="ident" id="5488329">pos</span><span class="op" id="5488332">+</span><span class="num" id="5488333">1</span><span class="op" id="5488334">:</span><span class="op" id="5488335">]</span><span class="op" id="5488336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488340">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488391">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488451">if</span>&nbsp;<span class="builtinfunc" id="5488454">len</span><span class="op" id="5488457">(</span><span class="ident" id="5488458">nano_buf</span><span class="op" id="5488466">)</span>&nbsp;<span class="op" id="5488468">&lt;</span>&nbsp;<span class="ident" id="5488470">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5488491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488496">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488512">nano_buf</span>&nbsp;<span class="op" id="5488521">+=</span>&nbsp;<span class="ident" id="5488524">strings</span><span class="op" id="5488531">.</span><span class="ident" id="5488532">Repeat</span><span class="op" id="5488538">(</span><span class="string" id="5488539">&#34;0&#34;</span><span class="op" id="5488542">,</span>&nbsp;<span class="ident" id="5488544">maxNanoSecondIntSize</span><span class="op" id="5488564">-</span><span class="builtinfunc" id="5488565">len</span><span class="op" id="5488568">(</span><span class="ident" id="5488569">nano_buf</span><span class="op" id="5488577">)</span><span class="op" id="5488578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488582">}</span>&nbsp;<span class="keyword" id="5488584">else</span>&nbsp;<span class="keyword" id="5488589">if</span>&nbsp;<span class="builtinfunc" id="5488592">len</span><span class="op" id="5488595">(</span><span class="ident" id="5488596">nano_buf</span><span class="op" id="5488604">)</span>&nbsp;<span class="op" id="5488606">&gt;</span>&nbsp;<span class="ident" id="5488608">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5488629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488634">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488655">nano_buf</span>&nbsp;<span class="op" id="5488664">=</span>&nbsp;<span class="ident" id="5488666">nano_buf</span><span class="op" id="5488674">[</span><span class="op" id="5488675">:</span><span class="ident" id="5488676">maxNanoSecondIntSize</span><span class="op" id="5488696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488700">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488704">nanoseconds</span><span class="op" id="5488715">,</span>&nbsp;<span class="ident" id="5488717">err</span>&nbsp;<span class="op" id="5488721">=</span>&nbsp;<span class="ident" id="5488723">strconv</span><span class="op" id="5488730">.</span><span class="ident" id="5488731">ParseInt</span><span class="op" id="5488739">(</span><span class="builtintype" id="5488740">string</span><span class="op" id="5488746">(</span><span class="ident" id="5488747">nano_buf</span><span class="op" id="5488755">)</span><span class="op" id="5488756">,</span>&nbsp;<span class="num" id="5488758">10</span><span class="op" id="5488760">,</span>&nbsp;<span class="num" id="5488762">0</span><span class="op" id="5488763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488767">if</span>&nbsp;<span class="ident" id="5488770">err</span>&nbsp;<span class="op" id="5488774">!=</span>&nbsp;<span class="ident" id="5488777">nil</span>&nbsp;<span class="op" id="5488781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488786">return</span>&nbsp;<span class="ident" id="5488793">time</span><span class="op" id="5488797">.</span><span class="ident" id="5488798">Time</span><span class="op" id="5488802">{</span><span class="op" id="5488803">}</span><span class="op" id="5488804">,</span>&nbsp;<span class="ident" id="5488806">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488815">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488818">ts</span>&nbsp;<span class="op" id="5488821">:=</span>&nbsp;<span class="ident" id="5488824">time</span><span class="op" id="5488828">.</span><span class="ident" id="5488829">Unix</span><span class="op" id="5488833">(</span><span class="ident" id="5488834">seconds</span><span class="op" id="5488841">,</span>&nbsp;<span class="ident" id="5488843">nanoseconds</span><span class="op" id="5488854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488857">return</span>&nbsp;<span class="ident" id="5488864">ts</span><span class="op" id="5488866">,</span>&nbsp;<span class="ident" id="5488868">nil</span><br>
<span class="lineno"></span><span class="op" id="5488872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5488875">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5488907">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5488977">func</span>&nbsp;<span class="ident" id="5488982">parsePAX</span><span class="op" id="5488990">(</span><span class="ident" id="5488991">r</span>&nbsp;<span class="ident" id="5488993">io</span><span class="op" id="5488995">.</span><span class="ident" id="5488996">Reader</span><span class="op" id="5489002">)</span>&nbsp;<span class="op" id="5489004">(</span><span class="keyword" id="5489005">map</span><span class="op" id="5489008">[</span><span class="builtintype" id="5489009">string</span><span class="op" id="5489015">]</span><span class="builtintype" id="5489016">string</span><span class="op" id="5489022">,</span>&nbsp;<span class="builtintype" id="5489024">error</span><span class="op" id="5489029">)</span>&nbsp;<span class="op" id="5489031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489034">buf</span><span class="op" id="5489037">,</span>&nbsp;<span class="ident" id="5489039">err</span>&nbsp;<span class="op" id="5489043">:=</span>&nbsp;<span class="ident" id="5489046">ioutil</span><span class="op" id="5489052">.</span><span class="ident" id="5489053">ReadAll</span><span class="op" id="5489060">(</span><span class="ident" id="5489061">r</span><span class="op" id="5489062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489065">if</span>&nbsp;<span class="ident" id="5489068">err</span>&nbsp;<span class="op" id="5489072">!=</span>&nbsp;<span class="ident" id="5489075">nil</span>&nbsp;<span class="op" id="5489079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489083">return</span>&nbsp;<span class="ident" id="5489090">nil</span><span class="op" id="5489093">,</span>&nbsp;<span class="ident" id="5489095">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489104">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489147">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489238">var</span>&nbsp;<span class="ident" id="5489242">sparseMap</span>&nbsp;<span class="ident" id="5489252">bytes</span><span class="op" id="5489257">.</span><span class="ident" id="5489258">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489267">headers</span>&nbsp;<span class="op" id="5489275">:=</span>&nbsp;<span class="builtinfunc" id="5489278">make</span><span class="op" id="5489282">(</span><span class="keyword" id="5489283">map</span><span class="op" id="5489286">[</span><span class="builtintype" id="5489287">string</span><span class="op" id="5489293">]</span><span class="builtintype" id="5489294">string</span><span class="op" id="5489300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489303">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489337">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489382">for</span>&nbsp;<span class="builtinfunc" id="5489386">len</span><span class="op" id="5489389">(</span><span class="ident" id="5489390">buf</span><span class="op" id="5489393">)</span>&nbsp;<span class="op" id="5489395">&gt;</span>&nbsp;<span class="num" id="5489397">0</span>&nbsp;<span class="op" id="5489399">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489403">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489447">var</span>&nbsp;<span class="ident" id="5489451">sp</span>&nbsp;<span class="builtintype" id="5489454">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489460">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489505">sp</span>&nbsp;<span class="op" id="5489508">=</span>&nbsp;<span class="ident" id="5489510">bytes</span><span class="op" id="5489515">.</span><span class="ident" id="5489516">IndexByte</span><span class="op" id="5489525">(</span><span class="ident" id="5489526">buf</span><span class="op" id="5489529">,</span>&nbsp;<span class="string" id="5489531">&#39;&nbsp;&#39;</span><span class="op" id="5489534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489538">if</span>&nbsp;<span class="ident" id="5489541">sp</span>&nbsp;<span class="op" id="5489544">==</span>&nbsp;<span class="op" id="5489547">-</span><span class="num" id="5489548">1</span>&nbsp;<span class="op" id="5489550">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489555">return</span>&nbsp;<span class="ident" id="5489562">nil</span><span class="op" id="5489565">,</span>&nbsp;<span class="ident" id="5489567">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489583">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489632">n</span><span class="op" id="5489633">,</span>&nbsp;<span class="ident" id="5489635">err</span>&nbsp;<span class="op" id="5489639">:=</span>&nbsp;<span class="ident" id="5489642">strconv</span><span class="op" id="5489649">.</span><span class="ident" id="5489650">ParseInt</span><span class="op" id="5489658">(</span><span class="builtintype" id="5489659">string</span><span class="op" id="5489665">(</span><span class="ident" id="5489666">buf</span><span class="op" id="5489669">[</span><span class="op" id="5489670">:</span><span class="ident" id="5489671">sp</span><span class="op" id="5489673">]</span><span class="op" id="5489674">)</span><span class="op" id="5489675">,</span>&nbsp;<span class="num" id="5489677">10</span><span class="op" id="5489679">,</span>&nbsp;<span class="num" id="5489681">0</span><span class="op" id="5489682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489686">if</span>&nbsp;<span class="ident" id="5489689">err</span>&nbsp;<span class="op" id="5489693">!=</span>&nbsp;<span class="ident" id="5489696">nil</span>&nbsp;<span class="op" id="5489700">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489705">return</span>&nbsp;<span class="ident" id="5489712">nil</span><span class="op" id="5489715">,</span>&nbsp;<span class="ident" id="5489717">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489733">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489797">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489863">var</span>&nbsp;<span class="ident" id="5489867">record</span>&nbsp;<span class="op" id="5489874">[</span><span class="op" id="5489875">]</span><span class="builtintype" id="5489876">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489883">record</span><span class="op" id="5489889">,</span>&nbsp;<span class="ident" id="5489891">buf</span>&nbsp;<span class="op" id="5489895">=</span>&nbsp;<span class="ident" id="5489897">buf</span><span class="op" id="5489900">[</span><span class="ident" id="5489901">sp</span><span class="op" id="5489903">+</span><span class="num" id="5489904">1</span><span class="op" id="5489905">:</span><span class="ident" id="5489906">n</span><span class="op" id="5489907">-</span><span class="num" id="5489908">1</span><span class="op" id="5489909">]</span><span class="op" id="5489910">,</span>&nbsp;<span class="ident" id="5489912">buf</span><span class="op" id="5489915">[</span><span class="ident" id="5489916">n</span><span class="op" id="5489917">:</span><span class="op" id="5489918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489922">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489986">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490017">eq</span>&nbsp;<span class="op" id="5490020">:=</span>&nbsp;<span class="ident" id="5490023">bytes</span><span class="op" id="5490028">.</span><span class="ident" id="5490029">IndexByte</span><span class="op" id="5490038">(</span><span class="ident" id="5490039">record</span><span class="op" id="5490045">,</span>&nbsp;<span class="string" id="5490047">&#39;=&#39;</span><span class="op" id="5490050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490054">if</span>&nbsp;<span class="ident" id="5490057">eq</span>&nbsp;<span class="op" id="5490060">==</span>&nbsp;<span class="op" id="5490063">-</span><span class="num" id="5490064">1</span>&nbsp;<span class="op" id="5490066">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490071">return</span>&nbsp;<span class="ident" id="5490078">nil</span><span class="op" id="5490081">,</span>&nbsp;<span class="ident" id="5490083">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490099">key</span><span class="op" id="5490102">,</span>&nbsp;<span class="ident" id="5490104">value</span>&nbsp;<span class="op" id="5490110">:=</span>&nbsp;<span class="ident" id="5490113">record</span><span class="op" id="5490119">[</span><span class="op" id="5490120">:</span><span class="ident" id="5490121">eq</span><span class="op" id="5490123">]</span><span class="op" id="5490124">,</span>&nbsp;<span class="ident" id="5490126">record</span><span class="op" id="5490132">[</span><span class="ident" id="5490133">eq</span><span class="op" id="5490135">+</span><span class="num" id="5490136">1</span><span class="op" id="5490137">:</span><span class="op" id="5490138">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490143">keyStr</span>&nbsp;<span class="op" id="5490150">:=</span>&nbsp;<span class="builtintype" id="5490153">string</span><span class="op" id="5490159">(</span><span class="ident" id="5490160">key</span><span class="op" id="5490163">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490167">if</span>&nbsp;<span class="ident" id="5490170">keyStr</span>&nbsp;<span class="op" id="5490177">==</span>&nbsp;<span class="ident" id="5490180">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5490199">||</span>&nbsp;<span class="ident" id="5490202">keyStr</span>&nbsp;<span class="op" id="5490209">==</span>&nbsp;<span class="ident" id="5490212">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5490233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490238">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490332">sparseMap</span><span class="op" id="5490341">.</span><span class="ident" id="5490342">Write</span><span class="op" id="5490347">(</span><span class="ident" id="5490348">value</span><span class="op" id="5490353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490358">sparseMap</span><span class="op" id="5490367">.</span><span class="ident" id="5490368">Write</span><span class="op" id="5490373">(</span><span class="op" id="5490374">[</span><span class="op" id="5490375">]</span><span class="builtintype" id="5490376">byte</span><span class="op" id="5490380">{</span><span class="string" id="5490381">&#39;,&#39;</span><span class="op" id="5490384">}</span><span class="op" id="5490385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490389">}</span>&nbsp;<span class="keyword" id="5490391">else</span>&nbsp;<span class="op" id="5490396">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490401">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490453">headers</span><span class="op" id="5490460">[</span><span class="ident" id="5490461">keyStr</span><span class="op" id="5490467">]</span>&nbsp;<span class="op" id="5490469">=</span>&nbsp;<span class="builtintype" id="5490471">string</span><span class="op" id="5490477">(</span><span class="ident" id="5490478">value</span><span class="op" id="5490483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490493">if</span>&nbsp;<span class="ident" id="5490496">sparseMap</span><span class="op" id="5490505">.</span><span class="ident" id="5490506">Len</span><span class="op" id="5490509">(</span><span class="op" id="5490510">)</span>&nbsp;<span class="op" id="5490512">!=</span>&nbsp;<span class="num" id="5490515">0</span>&nbsp;<span class="op" id="5490517">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490521">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490583">sparseMap</span><span class="op" id="5490592">.</span><span class="ident" id="5490593">Truncate</span><span class="op" id="5490601">(</span><span class="ident" id="5490602">sparseMap</span><span class="op" id="5490611">.</span><span class="ident" id="5490612">Len</span><span class="op" id="5490615">(</span><span class="op" id="5490616">)</span>&nbsp;<span class="op" id="5490618">-</span>&nbsp;<span class="num" id="5490620">1</span><span class="op" id="5490621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490625">headers</span><span class="op" id="5490632">[</span><span class="ident" id="5490633">paxGNUSparseMap</span><span class="op" id="5490648">]</span>&nbsp;<span class="op" id="5490650">=</span>&nbsp;<span class="ident" id="5490652">sparseMap</span><span class="op" id="5490661">.</span><span class="ident" id="5490662">String</span><span class="op" id="5490668">(</span><span class="op" id="5490669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490675">return</span>&nbsp;<span class="ident" id="5490682">headers</span><span class="op" id="5490689">,</span>&nbsp;<span class="ident" id="5490691">nil</span><br>
<span class="lineno">365</span><span class="op" id="5490695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5490698">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5490758">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5490834">func</span>&nbsp;<span class="ident" id="5490839">cString</span><span class="op" id="5490846">(</span><span class="ident" id="5490847">b</span>&nbsp;<span class="op" id="5490849">[</span><span class="op" id="5490850">]</span><span class="builtintype" id="5490851">byte</span><span class="op" id="5490855">)</span>&nbsp;<span class="builtintype" id="5490857">string</span>&nbsp;<span class="op" id="5490864">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490867">n</span>&nbsp;<span class="op" id="5490869">:=</span>&nbsp;<span class="num" id="5490872">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490875">for</span>&nbsp;<span class="ident" id="5490879">n</span>&nbsp;<span class="op" id="5490881">&lt;</span>&nbsp;<span class="builtinfunc" id="5490883">len</span><span class="op" id="5490886">(</span><span class="ident" id="5490887">b</span><span class="op" id="5490888">)</span>&nbsp;<span class="op" id="5490890">&amp;&amp;</span>&nbsp;<span class="ident" id="5490893">b</span><span class="op" id="5490894">[</span><span class="ident" id="5490895">n</span><span class="op" id="5490896">]</span>&nbsp;<span class="op" id="5490898">!=</span>&nbsp;<span class="num" id="5490901">0</span>&nbsp;<span class="op" id="5490903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490907">n</span><span class="op" id="5490908">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490915">return</span>&nbsp;<span class="builtintype" id="5490922">string</span><span class="op" id="5490928">(</span><span class="ident" id="5490929">b</span><span class="op" id="5490930">[</span><span class="num" id="5490931">0</span><span class="op" id="5490932">:</span><span class="ident" id="5490933">n</span><span class="op" id="5490934">]</span><span class="op" id="5490935">)</span><br>
<span class="lineno">375</span><span class="op" id="5490937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5490940">func</span>&nbsp;<span class="op" id="5490945">(</span><span class="ident" id="5490946">tr</span>&nbsp;<span class="op" id="5490949">*</span><span class="ident" id="5490950">Reader</span><span class="op" id="5490956">)</span>&nbsp;<span class="ident" id="5490958">octal</span><span class="op" id="5490963">(</span><span class="ident" id="5490964">b</span>&nbsp;<span class="op" id="5490966">[</span><span class="op" id="5490967">]</span><span class="builtintype" id="5490968">byte</span><span class="op" id="5490972">)</span>&nbsp;<span class="ident" id="5490974">int64</span>&nbsp;<span class="op" id="5490980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490983">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491018">if</span>&nbsp;<span class="builtinfunc" id="5491021">len</span><span class="op" id="5491024">(</span><span class="ident" id="5491025">b</span><span class="op" id="5491026">)</span>&nbsp;<span class="op" id="5491028">&gt;</span>&nbsp;<span class="num" id="5491030">0</span>&nbsp;<span class="op" id="5491032">&amp;&amp;</span>&nbsp;<span class="ident" id="5491035">b</span><span class="op" id="5491036">[</span><span class="num" id="5491037">0</span><span class="op" id="5491038">]</span><span class="op" id="5491039">&amp;</span><span class="num" id="5491040">0x80</span>&nbsp;<span class="op" id="5491045">!=</span>&nbsp;<span class="num" id="5491048">0</span>&nbsp;<span class="op" id="5491050">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491054">var</span>&nbsp;<span class="ident" id="5491058">x</span>&nbsp;<span class="ident" id="5491060">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491068">for</span>&nbsp;<span class="ident" id="5491072">i</span><span class="op" id="5491073">,</span>&nbsp;<span class="ident" id="5491075">c</span>&nbsp;<span class="op" id="5491077">:=</span>&nbsp;<span class="keyword" id="5491080">range</span>&nbsp;<span class="ident" id="5491086">b</span>&nbsp;<span class="op" id="5491088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491093">if</span>&nbsp;<span class="ident" id="5491096">i</span>&nbsp;<span class="op" id="5491098">==</span>&nbsp;<span class="num" id="5491101">0</span>&nbsp;<span class="op" id="5491103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491109">c</span>&nbsp;<span class="op" id="5491111">&amp;=</span>&nbsp;<span class="num" id="5491114">0x7f</span>&nbsp;<span class="comment" id="5491119">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491157">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491162">x</span>&nbsp;<span class="op" id="5491164">=</span>&nbsp;<span class="ident" id="5491166">x</span><span class="op" id="5491167">&lt;&lt;</span><span class="num" id="5491169">8</span>&nbsp;<span class="op" id="5491171">|</span>&nbsp;<span class="ident" id="5491173">int64</span><span class="op" id="5491178">(</span><span class="ident" id="5491179">c</span><span class="op" id="5491180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491188">return</span>&nbsp;<span class="ident" id="5491195">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491202">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491258">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491315">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491335">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491392">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491405">b</span>&nbsp;<span class="op" id="5491407">=</span>&nbsp;<span class="ident" id="5491409">bytes</span><span class="op" id="5491414">.</span><span class="ident" id="5491415">Trim</span><span class="op" id="5491419">(</span><span class="ident" id="5491420">b</span><span class="op" id="5491421">,</span>&nbsp;<span class="string" id="5491423">&#34;&nbsp;\x00&#34;</span><span class="op" id="5491430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491434">if</span>&nbsp;<span class="builtinfunc" id="5491437">len</span><span class="op" id="5491440">(</span><span class="ident" id="5491441">b</span><span class="op" id="5491442">)</span>&nbsp;<span class="op" id="5491444">==</span>&nbsp;<span class="num" id="5491447">0</span>&nbsp;<span class="op" id="5491449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491453">return</span>&nbsp;<span class="num" id="5491460">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491463">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491466">x</span><span class="op" id="5491467">,</span>&nbsp;<span class="ident" id="5491469">err</span>&nbsp;<span class="op" id="5491473">:=</span>&nbsp;<span class="ident" id="5491476">strconv</span><span class="op" id="5491483">.</span><span class="ident" id="5491484">ParseUint</span><span class="op" id="5491493">(</span><span class="ident" id="5491494">cString</span><span class="op" id="5491501">(</span><span class="ident" id="5491502">b</span><span class="op" id="5491503">)</span><span class="op" id="5491504">,</span>&nbsp;<span class="num" id="5491506">8</span><span class="op" id="5491507">,</span>&nbsp;<span class="num" id="5491509">64</span><span class="op" id="5491511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491514">if</span>&nbsp;<span class="ident" id="5491517">err</span>&nbsp;<span class="op" id="5491521">!=</span>&nbsp;<span class="ident" id="5491524">nil</span>&nbsp;<span class="op" id="5491528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491532">tr</span><span class="op" id="5491534">.</span><span class="ident" id="5491535">err</span>&nbsp;<span class="op" id="5491539">=</span>&nbsp;<span class="ident" id="5491541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491549">return</span>&nbsp;<span class="ident" id="5491556">int64</span><span class="op" id="5491561">(</span><span class="ident" id="5491562">x</span><span class="op" id="5491563">)</span><br>
<span class="lineno">405</span><span class="op" id="5491565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491568">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5491667">func</span>&nbsp;<span class="op" id="5491672">(</span><span class="ident" id="5491673">tr</span>&nbsp;<span class="op" id="5491676">*</span><span class="ident" id="5491677">Reader</span><span class="op" id="5491683">)</span>&nbsp;<span class="ident" id="5491685">skipUnread</span><span class="op" id="5491695">(</span><span class="op" id="5491696">)</span>&nbsp;<span class="op" id="5491698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491701">nr</span>&nbsp;<span class="op" id="5491704">:=</span>&nbsp;<span class="ident" id="5491707">tr</span><span class="op" id="5491709">.</span><span class="ident" id="5491710">numBytes</span><span class="op" id="5491718">(</span><span class="op" id="5491719">)</span>&nbsp;<span class="op" id="5491721">+</span>&nbsp;<span class="ident" id="5491723">tr</span><span class="op" id="5491725">.</span><span class="ident" id="5491726">pad</span>&nbsp;<span class="comment" id="5491730">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491758">tr</span><span class="op" id="5491760">.</span><span class="ident" id="5491761">curr</span><span class="op" id="5491765">,</span>&nbsp;<span class="ident" id="5491767">tr</span><span class="op" id="5491769">.</span><span class="ident" id="5491770">pad</span>&nbsp;<span class="op" id="5491774">=</span>&nbsp;<span class="ident" id="5491776">nil</span><span class="op" id="5491779">,</span>&nbsp;<span class="num" id="5491781">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491784">if</span>&nbsp;<span class="ident" id="5491787">sr</span><span class="op" id="5491789">,</span>&nbsp;<span class="ident" id="5491791">ok</span>&nbsp;<span class="op" id="5491794">:=</span>&nbsp;<span class="ident" id="5491797">tr</span><span class="op" id="5491799">.</span><span class="ident" id="5491800">r</span><span class="op" id="5491801">.</span><span class="op" id="5491802">(</span><span class="ident" id="5491803">io</span><span class="op" id="5491805">.</span><span class="ident" id="5491806">Seeker</span><span class="op" id="5491812">)</span><span class="op" id="5491813">;</span>&nbsp;<span class="ident" id="5491815">ok</span>&nbsp;<span class="op" id="5491818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491822">if</span>&nbsp;<span class="ident" id="5491825">_</span><span class="op" id="5491826">,</span>&nbsp;<span class="ident" id="5491828">err</span>&nbsp;<span class="op" id="5491832">:=</span>&nbsp;<span class="ident" id="5491835">sr</span><span class="op" id="5491837">.</span><span class="ident" id="5491838">Seek</span><span class="op" id="5491842">(</span><span class="ident" id="5491843">nr</span><span class="op" id="5491845">,</span>&nbsp;<span class="ident" id="5491847">os</span><span class="op" id="5491849">.</span><span class="ident" id="5491850">SEEK_CUR</span><span class="op" id="5491858">)</span><span class="op" id="5491859">;</span>&nbsp;<span class="ident" id="5491861">err</span>&nbsp;<span class="op" id="5491865">==</span>&nbsp;<span class="ident" id="5491868">nil</span>&nbsp;<span class="op" id="5491872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491877">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491886">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491892">_</span><span class="op" id="5491893">,</span>&nbsp;<span class="ident" id="5491895">tr</span><span class="op" id="5491897">.</span><span class="ident" id="5491898">err</span>&nbsp;<span class="op" id="5491902">=</span>&nbsp;<span class="ident" id="5491904">io</span><span class="op" id="5491906">.</span><span class="ident" id="5491907">CopyN</span><span class="op" id="5491912">(</span><span class="ident" id="5491913">ioutil</span><span class="op" id="5491919">.</span><span class="ident" id="5491920">Discard</span><span class="op" id="5491927">,</span>&nbsp;<span class="ident" id="5491929">tr</span><span class="op" id="5491931">.</span><span class="ident" id="5491932">r</span><span class="op" id="5491933">,</span>&nbsp;<span class="ident" id="5491935">nr</span><span class="op" id="5491937">)</span><br>
<span class="lineno"></span><span class="op" id="5491939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491942">func</span>&nbsp;<span class="op" id="5491947">(</span><span class="ident" id="5491948">tr</span>&nbsp;<span class="op" id="5491951">*</span><span class="ident" id="5491952">Reader</span><span class="op" id="5491958">)</span>&nbsp;<span class="ident" id="5491960">verifyChecksum</span><span class="op" id="5491974">(</span><span class="ident" id="5491975">header</span>&nbsp;<span class="op" id="5491982">[</span><span class="op" id="5491983">]</span><span class="builtintype" id="5491984">byte</span><span class="op" id="5491988">)</span>&nbsp;<span class="builtintype" id="5491990">bool</span>&nbsp;<span class="op" id="5491995">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491998">if</span>&nbsp;<span class="ident" id="5492001">tr</span><span class="op" id="5492003">.</span><span class="ident" id="5492004">err</span>&nbsp;<span class="op" id="5492008">!=</span>&nbsp;<span class="ident" id="5492011">nil</span>&nbsp;<span class="op" id="5492015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492019">return</span>&nbsp;<span class="builtintype" id="5492026">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492037">given</span>&nbsp;<span class="op" id="5492043">:=</span>&nbsp;<span class="ident" id="5492046">tr</span><span class="op" id="5492048">.</span><span class="ident" id="5492049">octal</span><span class="op" id="5492054">(</span><span class="ident" id="5492055">header</span><span class="op" id="5492061">[</span><span class="num" id="5492062">148</span><span class="op" id="5492065">:</span><span class="num" id="5492066">156</span><span class="op" id="5492069">]</span><span class="op" id="5492070">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492073">unsigned</span><span class="op" id="5492081">,</span>&nbsp;<span class="ident" id="5492083">signed</span>&nbsp;<span class="op" id="5492090">:=</span>&nbsp;<span class="ident" id="5492093">checksum</span><span class="op" id="5492101">(</span><span class="ident" id="5492102">header</span><span class="op" id="5492108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492111">return</span>&nbsp;<span class="ident" id="5492118">given</span>&nbsp;<span class="op" id="5492124">==</span>&nbsp;<span class="ident" id="5492127">unsigned</span>&nbsp;<span class="op" id="5492136">||</span>&nbsp;<span class="ident" id="5492139">given</span>&nbsp;<span class="op" id="5492145">==</span>&nbsp;<span class="ident" id="5492148">signed</span><br>
<span class="lineno"></span><span class="op" id="5492155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5492158">func</span>&nbsp;<span class="op" id="5492163">(</span><span class="ident" id="5492164">tr</span>&nbsp;<span class="op" id="5492167">*</span><span class="ident" id="5492168">Reader</span><span class="op" id="5492174">)</span>&nbsp;<span class="ident" id="5492176">readHeader</span><span class="op" id="5492186">(</span><span class="op" id="5492187">)</span>&nbsp;<span class="op" id="5492189">*</span><span class="ident" id="5492190">Header</span>&nbsp;<span class="op" id="5492197">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492200">header</span>&nbsp;<span class="op" id="5492207">:=</span>&nbsp;<span class="ident" id="5492210">tr</span><span class="op" id="5492212">.</span><span class="ident" id="5492213">hdrBuff</span><span class="op" id="5492220">[</span><span class="op" id="5492221">:</span><span class="op" id="5492222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492225">copy</span><span class="op" id="5492229">(</span><span class="ident" id="5492230">header</span><span class="op" id="5492236">,</span>&nbsp;<span class="ident" id="5492238">zeroBlock</span><span class="op" id="5492247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492251">if</span>&nbsp;<span class="ident" id="5492254">_</span><span class="op" id="5492255">,</span>&nbsp;<span class="ident" id="5492257">tr</span><span class="op" id="5492259">.</span><span class="ident" id="5492260">err</span>&nbsp;<span class="op" id="5492264">=</span>&nbsp;<span class="ident" id="5492266">io</span><span class="op" id="5492268">.</span><span class="ident" id="5492269">ReadFull</span><span class="op" id="5492277">(</span><span class="ident" id="5492278">tr</span><span class="op" id="5492280">.</span><span class="ident" id="5492281">r</span><span class="op" id="5492282">,</span>&nbsp;<span class="ident" id="5492284">header</span><span class="op" id="5492290">)</span><span class="op" id="5492291">;</span>&nbsp;<span class="ident" id="5492293">tr</span><span class="op" id="5492295">.</span><span class="ident" id="5492296">err</span>&nbsp;<span class="op" id="5492300">!=</span>&nbsp;<span class="ident" id="5492303">nil</span>&nbsp;<span class="op" id="5492307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492311">return</span>&nbsp;<span class="ident" id="5492318">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5492327">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492386">if</span>&nbsp;<span class="ident" id="5492389">bytes</span><span class="op" id="5492394">.</span><span class="ident" id="5492395">Equal</span><span class="op" id="5492400">(</span><span class="ident" id="5492401">header</span><span class="op" id="5492407">,</span>&nbsp;<span class="ident" id="5492409">zeroBlock</span><span class="op" id="5492418">[</span><span class="num" id="5492419">0</span><span class="op" id="5492420">:</span><span class="ident" id="5492421">blockSize</span><span class="op" id="5492430">]</span><span class="op" id="5492431">)</span>&nbsp;<span class="op" id="5492433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492437">if</span>&nbsp;<span class="ident" id="5492440">_</span><span class="op" id="5492441">,</span>&nbsp;<span class="ident" id="5492443">tr</span><span class="op" id="5492445">.</span><span class="ident" id="5492446">err</span>&nbsp;<span class="op" id="5492450">=</span>&nbsp;<span class="ident" id="5492452">io</span><span class="op" id="5492454">.</span><span class="ident" id="5492455">ReadFull</span><span class="op" id="5492463">(</span><span class="ident" id="5492464">tr</span><span class="op" id="5492466">.</span><span class="ident" id="5492467">r</span><span class="op" id="5492468">,</span>&nbsp;<span class="ident" id="5492470">header</span><span class="op" id="5492476">)</span><span class="op" id="5492477">;</span>&nbsp;<span class="ident" id="5492479">tr</span><span class="op" id="5492481">.</span><span class="ident" id="5492482">err</span>&nbsp;<span class="op" id="5492486">!=</span>&nbsp;<span class="ident" id="5492489">nil</span>&nbsp;<span class="op" id="5492493">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492498">return</span>&nbsp;<span class="ident" id="5492505">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492515">if</span>&nbsp;<span class="ident" id="5492518">bytes</span><span class="op" id="5492523">.</span><span class="ident" id="5492524">Equal</span><span class="op" id="5492529">(</span><span class="ident" id="5492530">header</span><span class="op" id="5492536">,</span>&nbsp;<span class="ident" id="5492538">zeroBlock</span><span class="op" id="5492547">[</span><span class="num" id="5492548">0</span><span class="op" id="5492549">:</span><span class="ident" id="5492550">blockSize</span><span class="op" id="5492559">]</span><span class="op" id="5492560">)</span>&nbsp;<span class="op" id="5492562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492567">tr</span><span class="op" id="5492569">.</span><span class="ident" id="5492570">err</span>&nbsp;<span class="op" id="5492574">=</span>&nbsp;<span class="ident" id="5492576">io</span><span class="op" id="5492578">.</span><span class="ident" id="5492579">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492585">}</span>&nbsp;<span class="keyword" id="5492587">else</span>&nbsp;<span class="op" id="5492592">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492597">tr</span><span class="op" id="5492599">.</span><span class="ident" id="5492600">err</span>&nbsp;<span class="op" id="5492604">=</span>&nbsp;<span class="ident" id="5492606">ErrHeader</span>&nbsp;<span class="comment" id="5492616">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492660">return</span>&nbsp;<span class="ident" id="5492667">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492676">if</span>&nbsp;<span class="op" id="5492679">!</span><span class="ident" id="5492680">tr</span><span class="op" id="5492682">.</span><span class="ident" id="5492683">verifyChecksum</span><span class="op" id="5492697">(</span><span class="ident" id="5492698">header</span><span class="op" id="5492704">)</span>&nbsp;<span class="op" id="5492706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492710">tr</span><span class="op" id="5492712">.</span><span class="ident" id="5492713">err</span>&nbsp;<span class="op" id="5492717">=</span>&nbsp;<span class="ident" id="5492719">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492731">return</span>&nbsp;<span class="ident" id="5492738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5492747">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492758">hdr</span>&nbsp;<span class="op" id="5492762">:=</span>&nbsp;<span class="builtinfunc" id="5492765">new</span><span class="op" id="5492768">(</span><span class="ident" id="5492769">Header</span><span class="op" id="5492775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492778">s</span>&nbsp;<span class="op" id="5492780">:=</span>&nbsp;<span class="ident" id="5492783">slicer</span><span class="op" id="5492789">(</span><span class="ident" id="5492790">header</span><span class="op" id="5492796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492800">hdr</span><span class="op" id="5492803">.</span><span class="ident" id="5492804">Name</span>&nbsp;<span class="op" id="5492809">=</span>&nbsp;<span class="ident" id="5492811">cString</span><span class="op" id="5492818">(</span><span class="ident" id="5492819">s</span><span class="op" id="5492820">.</span><span class="ident" id="5492821">next</span><span class="op" id="5492825">(</span><span class="num" id="5492826">100</span><span class="op" id="5492829">)</span><span class="op" id="5492830">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492833">hdr</span><span class="op" id="5492836">.</span><span class="ident" id="5492837">Mode</span>&nbsp;<span class="op" id="5492842">=</span>&nbsp;<span class="ident" id="5492844">tr</span><span class="op" id="5492846">.</span><span class="ident" id="5492847">octal</span><span class="op" id="5492852">(</span><span class="ident" id="5492853">s</span><span class="op" id="5492854">.</span><span class="ident" id="5492855">next</span><span class="op" id="5492859">(</span><span class="num" id="5492860">8</span><span class="op" id="5492861">)</span><span class="op" id="5492862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492865">hdr</span><span class="op" id="5492868">.</span><span class="ident" id="5492869">Uid</span>&nbsp;<span class="op" id="5492873">=</span>&nbsp;<span class="builtintype" id="5492875">int</span><span class="op" id="5492878">(</span><span class="ident" id="5492879">tr</span><span class="op" id="5492881">.</span><span class="ident" id="5492882">octal</span><span class="op" id="5492887">(</span><span class="ident" id="5492888">s</span><span class="op" id="5492889">.</span><span class="ident" id="5492890">next</span><span class="op" id="5492894">(</span><span class="num" id="5492895">8</span><span class="op" id="5492896">)</span><span class="op" id="5492897">)</span><span class="op" id="5492898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492901">hdr</span><span class="op" id="5492904">.</span><span class="ident" id="5492905">Gid</span>&nbsp;<span class="op" id="5492909">=</span>&nbsp;<span class="builtintype" id="5492911">int</span><span class="op" id="5492914">(</span><span class="ident" id="5492915">tr</span><span class="op" id="5492917">.</span><span class="ident" id="5492918">octal</span><span class="op" id="5492923">(</span><span class="ident" id="5492924">s</span><span class="op" id="5492925">.</span><span class="ident" id="5492926">next</span><span class="op" id="5492930">(</span><span class="num" id="5492931">8</span><span class="op" id="5492932">)</span><span class="op" id="5492933">)</span><span class="op" id="5492934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492937">hdr</span><span class="op" id="5492940">.</span><span class="ident" id="5492941">Size</span>&nbsp;<span class="op" id="5492946">=</span>&nbsp;<span class="ident" id="5492948">tr</span><span class="op" id="5492950">.</span><span class="ident" id="5492951">octal</span><span class="op" id="5492956">(</span><span class="ident" id="5492957">s</span><span class="op" id="5492958">.</span><span class="ident" id="5492959">next</span><span class="op" id="5492963">(</span><span class="num" id="5492964">12</span><span class="op" id="5492966">)</span><span class="op" id="5492967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492970">hdr</span><span class="op" id="5492973">.</span><span class="ident" id="5492974">ModTime</span>&nbsp;<span class="op" id="5492982">=</span>&nbsp;<span class="ident" id="5492984">time</span><span class="op" id="5492988">.</span><span class="ident" id="5492989">Unix</span><span class="op" id="5492993">(</span><span class="ident" id="5492994">tr</span><span class="op" id="5492996">.</span><span class="ident" id="5492997">octal</span><span class="op" id="5493002">(</span><span class="ident" id="5493003">s</span><span class="op" id="5493004">.</span><span class="ident" id="5493005">next</span><span class="op" id="5493009">(</span><span class="num" id="5493010">12</span><span class="op" id="5493012">)</span><span class="op" id="5493013">)</span><span class="op" id="5493014">,</span>&nbsp;<span class="num" id="5493016">0</span><span class="op" id="5493017">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493020">s</span><span class="op" id="5493021">.</span><span class="ident" id="5493022">next</span><span class="op" id="5493026">(</span><span class="num" id="5493027">8</span><span class="op" id="5493028">)</span>&nbsp;<span class="comment" id="5493030">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493041">hdr</span><span class="op" id="5493044">.</span><span class="ident" id="5493045">Typeflag</span>&nbsp;<span class="op" id="5493054">=</span>&nbsp;<span class="ident" id="5493056">s</span><span class="op" id="5493057">.</span><span class="ident" id="5493058">next</span><span class="op" id="5493062">(</span><span class="num" id="5493063">1</span><span class="op" id="5493064">)</span><span class="op" id="5493065">[</span><span class="num" id="5493066">0</span><span class="op" id="5493067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493070">hdr</span><span class="op" id="5493073">.</span><span class="ident" id="5493074">Linkname</span>&nbsp;<span class="op" id="5493083">=</span>&nbsp;<span class="ident" id="5493085">cString</span><span class="op" id="5493092">(</span><span class="ident" id="5493093">s</span><span class="op" id="5493094">.</span><span class="ident" id="5493095">next</span><span class="op" id="5493099">(</span><span class="num" id="5493100">100</span><span class="op" id="5493103">)</span><span class="op" id="5493104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493108">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493171">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493237">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493299">magic</span>&nbsp;<span class="op" id="5493305">:=</span>&nbsp;<span class="builtintype" id="5493308">string</span><span class="op" id="5493314">(</span><span class="ident" id="5493315">s</span><span class="op" id="5493316">.</span><span class="ident" id="5493317">next</span><span class="op" id="5493321">(</span><span class="num" id="5493322">8</span><span class="op" id="5493323">)</span><span class="op" id="5493324">)</span>&nbsp;<span class="comment" id="5493326">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493362">var</span>&nbsp;<span class="ident" id="5493366">format</span>&nbsp;<span class="builtintype" id="5493373">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493381">switch</span>&nbsp;<span class="op" id="5493388">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493391">case</span>&nbsp;<span class="ident" id="5493396">magic</span><span class="op" id="5493401">[</span><span class="op" id="5493402">:</span><span class="num" id="5493403">6</span><span class="op" id="5493404">]</span>&nbsp;<span class="op" id="5493406">==</span>&nbsp;<span class="string" id="5493409">&#34;ustar\x00&#34;</span><span class="op" id="5493420">:</span>&nbsp;<span class="comment" id="5493422">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493451">if</span>&nbsp;<span class="builtintype" id="5493454">string</span><span class="op" id="5493460">(</span><span class="ident" id="5493461">header</span><span class="op" id="5493467">[</span><span class="num" id="5493468">508</span><span class="op" id="5493471">:</span><span class="num" id="5493472">512</span><span class="op" id="5493475">]</span><span class="op" id="5493476">)</span>&nbsp;<span class="op" id="5493478">==</span>&nbsp;<span class="string" id="5493481">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5493491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493496">format</span>&nbsp;<span class="op" id="5493503">=</span>&nbsp;<span class="string" id="5493505">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493514">}</span>&nbsp;<span class="keyword" id="5493516">else</span>&nbsp;<span class="op" id="5493521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493526">format</span>&nbsp;<span class="op" id="5493533">=</span>&nbsp;<span class="string" id="5493535">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493548">case</span>&nbsp;<span class="ident" id="5493553">magic</span>&nbsp;<span class="op" id="5493559">==</span>&nbsp;<span class="string" id="5493562">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5493575">:</span>&nbsp;<span class="comment" id="5493577">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493594">format</span>&nbsp;<span class="op" id="5493601">=</span>&nbsp;<span class="string" id="5493603">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493614">switch</span>&nbsp;<span class="ident" id="5493621">format</span>&nbsp;<span class="op" id="5493628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493631">case</span>&nbsp;<span class="string" id="5493636">&#34;posix&#34;</span><span class="op" id="5493643">,</span>&nbsp;<span class="string" id="5493645">&#34;gnu&#34;</span><span class="op" id="5493650">,</span>&nbsp;<span class="string" id="5493652">&#34;star&#34;</span><span class="op" id="5493658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493662">hdr</span><span class="op" id="5493665">.</span><span class="ident" id="5493666">Uname</span>&nbsp;<span class="op" id="5493672">=</span>&nbsp;<span class="ident" id="5493674">cString</span><span class="op" id="5493681">(</span><span class="ident" id="5493682">s</span><span class="op" id="5493683">.</span><span class="ident" id="5493684">next</span><span class="op" id="5493688">(</span><span class="num" id="5493689">32</span><span class="op" id="5493691">)</span><span class="op" id="5493692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493696">hdr</span><span class="op" id="5493699">.</span><span class="ident" id="5493700">Gname</span>&nbsp;<span class="op" id="5493706">=</span>&nbsp;<span class="ident" id="5493708">cString</span><span class="op" id="5493715">(</span><span class="ident" id="5493716">s</span><span class="op" id="5493717">.</span><span class="ident" id="5493718">next</span><span class="op" id="5493722">(</span><span class="num" id="5493723">32</span><span class="op" id="5493725">)</span><span class="op" id="5493726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493730">devmajor</span>&nbsp;<span class="op" id="5493739">:=</span>&nbsp;<span class="ident" id="5493742">s</span><span class="op" id="5493743">.</span><span class="ident" id="5493744">next</span><span class="op" id="5493748">(</span><span class="num" id="5493749">8</span><span class="op" id="5493750">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493754">devminor</span>&nbsp;<span class="op" id="5493763">:=</span>&nbsp;<span class="ident" id="5493766">s</span><span class="op" id="5493767">.</span><span class="ident" id="5493768">next</span><span class="op" id="5493772">(</span><span class="num" id="5493773">8</span><span class="op" id="5493774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493778">if</span>&nbsp;<span class="ident" id="5493781">hdr</span><span class="op" id="5493784">.</span><span class="ident" id="5493785">Typeflag</span>&nbsp;<span class="op" id="5493794">==</span>&nbsp;<span class="ident" id="5493797">TypeChar</span>&nbsp;<span class="op" id="5493806">||</span>&nbsp;<span class="ident" id="5493809">hdr</span><span class="op" id="5493812">.</span><span class="ident" id="5493813">Typeflag</span>&nbsp;<span class="op" id="5493822">==</span>&nbsp;<span class="ident" id="5493825">TypeBlock</span>&nbsp;<span class="op" id="5493835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493840">hdr</span><span class="op" id="5493843">.</span><span class="ident" id="5493844">Devmajor</span>&nbsp;<span class="op" id="5493853">=</span>&nbsp;<span class="ident" id="5493855">tr</span><span class="op" id="5493857">.</span><span class="ident" id="5493858">octal</span><span class="op" id="5493863">(</span><span class="ident" id="5493864">devmajor</span><span class="op" id="5493872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493877">hdr</span><span class="op" id="5493880">.</span><span class="ident" id="5493881">Devminor</span>&nbsp;<span class="op" id="5493890">=</span>&nbsp;<span class="ident" id="5493892">tr</span><span class="op" id="5493894">.</span><span class="ident" id="5493895">octal</span><span class="op" id="5493900">(</span><span class="ident" id="5493901">devminor</span><span class="op" id="5493909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493913">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493917">var</span>&nbsp;<span class="ident" id="5493921">prefix</span>&nbsp;<span class="builtintype" id="5493928">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493937">switch</span>&nbsp;<span class="ident" id="5493944">format</span>&nbsp;<span class="op" id="5493951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493955">case</span>&nbsp;<span class="string" id="5493960">&#34;posix&#34;</span><span class="op" id="5493967">,</span>&nbsp;<span class="string" id="5493969">&#34;gnu&#34;</span><span class="op" id="5493974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493979">prefix</span>&nbsp;<span class="op" id="5493986">=</span>&nbsp;<span class="ident" id="5493988">cString</span><span class="op" id="5493995">(</span><span class="ident" id="5493996">s</span><span class="op" id="5493997">.</span><span class="ident" id="5493998">next</span><span class="op" id="5494002">(</span><span class="num" id="5494003">155</span><span class="op" id="5494006">)</span><span class="op" id="5494007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494011">case</span>&nbsp;<span class="string" id="5494016">&#34;star&#34;</span><span class="op" id="5494022">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494027">prefix</span>&nbsp;<span class="op" id="5494034">=</span>&nbsp;<span class="ident" id="5494036">cString</span><span class="op" id="5494043">(</span><span class="ident" id="5494044">s</span><span class="op" id="5494045">.</span><span class="ident" id="5494046">next</span><span class="op" id="5494050">(</span><span class="num" id="5494051">131</span><span class="op" id="5494054">)</span><span class="op" id="5494055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494060">hdr</span><span class="op" id="5494063">.</span><span class="ident" id="5494064">AccessTime</span>&nbsp;<span class="op" id="5494075">=</span>&nbsp;<span class="ident" id="5494077">time</span><span class="op" id="5494081">.</span><span class="ident" id="5494082">Unix</span><span class="op" id="5494086">(</span><span class="ident" id="5494087">tr</span><span class="op" id="5494089">.</span><span class="ident" id="5494090">octal</span><span class="op" id="5494095">(</span><span class="ident" id="5494096">s</span><span class="op" id="5494097">.</span><span class="ident" id="5494098">next</span><span class="op" id="5494102">(</span><span class="num" id="5494103">12</span><span class="op" id="5494105">)</span><span class="op" id="5494106">)</span><span class="op" id="5494107">,</span>&nbsp;<span class="num" id="5494109">0</span><span class="op" id="5494110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494115">hdr</span><span class="op" id="5494118">.</span><span class="ident" id="5494119">ChangeTime</span>&nbsp;<span class="op" id="5494130">=</span>&nbsp;<span class="ident" id="5494132">time</span><span class="op" id="5494136">.</span><span class="ident" id="5494137">Unix</span><span class="op" id="5494141">(</span><span class="ident" id="5494142">tr</span><span class="op" id="5494144">.</span><span class="ident" id="5494145">octal</span><span class="op" id="5494150">(</span><span class="ident" id="5494151">s</span><span class="op" id="5494152">.</span><span class="ident" id="5494153">next</span><span class="op" id="5494157">(</span><span class="num" id="5494158">12</span><span class="op" id="5494160">)</span><span class="op" id="5494161">)</span><span class="op" id="5494162">,</span>&nbsp;<span class="num" id="5494164">0</span><span class="op" id="5494165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494173">if</span>&nbsp;<span class="builtinfunc" id="5494176">len</span><span class="op" id="5494179">(</span><span class="ident" id="5494180">prefix</span><span class="op" id="5494186">)</span>&nbsp;<span class="op" id="5494188">&gt;</span>&nbsp;<span class="num" id="5494190">0</span>&nbsp;<span class="op" id="5494192">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494197">hdr</span><span class="op" id="5494200">.</span><span class="ident" id="5494201">Name</span>&nbsp;<span class="op" id="5494206">=</span>&nbsp;<span class="ident" id="5494208">prefix</span>&nbsp;<span class="op" id="5494215">+</span>&nbsp;<span class="string" id="5494217">&#34;/&#34;</span>&nbsp;<span class="op" id="5494221">+</span>&nbsp;<span class="ident" id="5494223">hdr</span><span class="op" id="5494226">.</span><span class="ident" id="5494227">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494241">if</span>&nbsp;<span class="ident" id="5494244">tr</span><span class="op" id="5494246">.</span><span class="ident" id="5494247">err</span>&nbsp;<span class="op" id="5494251">!=</span>&nbsp;<span class="ident" id="5494254">nil</span>&nbsp;<span class="op" id="5494258">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494262">tr</span><span class="op" id="5494264">.</span><span class="ident" id="5494265">err</span>&nbsp;<span class="op" id="5494269">=</span>&nbsp;<span class="ident" id="5494271">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494283">return</span>&nbsp;<span class="ident" id="5494290">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494299">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494357">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494402">nb</span>&nbsp;<span class="op" id="5494405">:=</span>&nbsp;<span class="ident" id="5494408">int64</span><span class="op" id="5494413">(</span><span class="ident" id="5494414">hdr</span><span class="op" id="5494417">.</span><span class="ident" id="5494418">Size</span><span class="op" id="5494422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494425">tr</span><span class="op" id="5494427">.</span><span class="ident" id="5494428">pad</span>&nbsp;<span class="op" id="5494432">=</span>&nbsp;<span class="op" id="5494434">-</span><span class="ident" id="5494435">nb</span>&nbsp;<span class="op" id="5494438">&amp;</span>&nbsp;<span class="op" id="5494440">(</span><span class="ident" id="5494441">blockSize</span>&nbsp;<span class="op" id="5494451">-</span>&nbsp;<span class="num" id="5494453">1</span><span class="op" id="5494454">)</span>&nbsp;<span class="comment" id="5494456">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494489">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494522">tr</span><span class="op" id="5494524">.</span><span class="ident" id="5494525">curr</span>&nbsp;<span class="op" id="5494530">=</span>&nbsp;<span class="op" id="5494532">&amp;</span><span class="ident" id="5494533">regFileReader</span><span class="op" id="5494546">{</span><span class="ident" id="5494547">r</span><span class="op" id="5494548">:</span>&nbsp;<span class="ident" id="5494550">tr</span><span class="op" id="5494552">.</span><span class="ident" id="5494553">r</span><span class="op" id="5494554">,</span>&nbsp;<span class="ident" id="5494556">nb</span><span class="op" id="5494558">:</span>&nbsp;<span class="ident" id="5494560">nb</span><span class="op" id="5494562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494566">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494609">if</span>&nbsp;<span class="ident" id="5494612">hdr</span><span class="op" id="5494615">.</span><span class="ident" id="5494616">Typeflag</span>&nbsp;<span class="op" id="5494625">==</span>&nbsp;<span class="ident" id="5494628">TypeGNUSparse</span>&nbsp;<span class="op" id="5494642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494646">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494682">hdr</span><span class="op" id="5494685">.</span><span class="ident" id="5494686">Size</span>&nbsp;<span class="op" id="5494691">=</span>&nbsp;<span class="ident" id="5494693">tr</span><span class="op" id="5494695">.</span><span class="ident" id="5494696">octal</span><span class="op" id="5494701">(</span><span class="ident" id="5494702">header</span><span class="op" id="5494708">[</span><span class="num" id="5494709">483</span><span class="op" id="5494712">:</span><span class="num" id="5494713">495</span><span class="op" id="5494716">]</span><span class="op" id="5494717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494722">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494748">sp</span>&nbsp;<span class="op" id="5494751">:=</span>&nbsp;<span class="ident" id="5494754">tr</span><span class="op" id="5494756">.</span><span class="ident" id="5494757">readOldGNUSparseMap</span><span class="op" id="5494776">(</span><span class="ident" id="5494777">header</span><span class="op" id="5494783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494787">if</span>&nbsp;<span class="ident" id="5494790">tr</span><span class="op" id="5494792">.</span><span class="ident" id="5494793">err</span>&nbsp;<span class="op" id="5494797">!=</span>&nbsp;<span class="ident" id="5494800">nil</span>&nbsp;<span class="op" id="5494804">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494809">return</span>&nbsp;<span class="ident" id="5494816">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494826">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494898">tr</span><span class="op" id="5494900">.</span><span class="ident" id="5494901">curr</span>&nbsp;<span class="op" id="5494906">=</span>&nbsp;<span class="op" id="5494908">&amp;</span><span class="ident" id="5494909">sparseFileReader</span><span class="op" id="5494925">{</span><span class="ident" id="5494926">rfr</span><span class="op" id="5494929">:</span>&nbsp;<span class="ident" id="5494931">tr</span><span class="op" id="5494933">.</span><span class="ident" id="5494934">curr</span><span class="op" id="5494938">.</span><span class="op" id="5494939">(</span><span class="op" id="5494940">*</span><span class="ident" id="5494941">regFileReader</span><span class="op" id="5494954">)</span><span class="op" id="5494955">,</span>&nbsp;<span class="ident" id="5494957">sp</span><span class="op" id="5494959">:</span>&nbsp;<span class="ident" id="5494961">sp</span><span class="op" id="5494963">,</span>&nbsp;<span class="ident" id="5494965">tot</span><span class="op" id="5494968">:</span>&nbsp;<span class="ident" id="5494970">hdr</span><span class="op" id="5494973">.</span><span class="ident" id="5494974">Size</span><span class="op" id="5494978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494981">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494985">return</span>&nbsp;<span class="ident" id="5494992">hdr</span><br>
<span class="lineno"></span><span class="op" id="5494996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5494999">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5495068">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5495138">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5495156">type</span>&nbsp;<span class="ident" id="5495161">sparseEntry</span>&nbsp;<span class="keyword" id="5495173">struct</span>&nbsp;<span class="op" id="5495180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495183">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5495192">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495199">numBytes</span>&nbsp;<span class="ident" id="5495208">int64</span><br>
<span class="lineno">545</span><span class="op" id="5495214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5495217">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5495301">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5495403">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5495487">func</span>&nbsp;<span class="op" id="5495492">(</span><span class="ident" id="5495493">tr</span>&nbsp;<span class="op" id="5495496">*</span><span class="ident" id="5495497">Reader</span><span class="op" id="5495503">)</span>&nbsp;<span class="ident" id="5495505">readOldGNUSparseMap</span><span class="op" id="5495524">(</span><span class="ident" id="5495525">header</span>&nbsp;<span class="op" id="5495532">[</span><span class="op" id="5495533">]</span><span class="builtintype" id="5495534">byte</span><span class="op" id="5495538">)</span>&nbsp;<span class="op" id="5495540">[</span><span class="op" id="5495541">]</span><span class="ident" id="5495542">sparseEntry</span>&nbsp;<span class="op" id="5495554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495557">isExtended</span>&nbsp;<span class="op" id="5495568">:=</span>&nbsp;<span class="ident" id="5495571">header</span><span class="op" id="5495577">[</span><span class="ident" id="5495578">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5495616">]</span>&nbsp;<span class="op" id="5495618">!=</span>&nbsp;<span class="num" id="5495621">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495624">spCap</span>&nbsp;<span class="op" id="5495630">:=</span>&nbsp;<span class="ident" id="5495633">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495667">if</span>&nbsp;<span class="ident" id="5495670">isExtended</span>&nbsp;<span class="op" id="5495681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495685">spCap</span>&nbsp;<span class="op" id="5495691">+=</span>&nbsp;<span class="ident" id="5495694">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495735">sp</span>&nbsp;<span class="op" id="5495738">:=</span>&nbsp;<span class="builtinfunc" id="5495741">make</span><span class="op" id="5495745">(</span><span class="op" id="5495746">[</span><span class="op" id="5495747">]</span><span class="ident" id="5495748">sparseEntry</span><span class="op" id="5495759">,</span>&nbsp;<span class="num" id="5495761">0</span><span class="op" id="5495762">,</span>&nbsp;<span class="ident" id="5495764">spCap</span><span class="op" id="5495769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495772">s</span>&nbsp;<span class="op" id="5495774">:=</span>&nbsp;<span class="ident" id="5495777">slicer</span><span class="op" id="5495783">(</span><span class="ident" id="5495784">header</span><span class="op" id="5495790">[</span><span class="ident" id="5495791">oldGNUSparseMainHeaderOffset</span><span class="op" id="5495819">:</span><span class="op" id="5495820">]</span><span class="op" id="5495821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5495825">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495876">for</span>&nbsp;<span class="ident" id="5495880">i</span>&nbsp;<span class="op" id="5495882">:=</span>&nbsp;<span class="num" id="5495885">0</span><span class="op" id="5495886">;</span>&nbsp;<span class="ident" id="5495888">i</span>&nbsp;<span class="op" id="5495890">&lt;</span>&nbsp;<span class="ident" id="5495892">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="5495924">;</span>&nbsp;<span class="ident" id="5495926">i</span><span class="op" id="5495927">++</span>&nbsp;<span class="op" id="5495930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495934">offset</span>&nbsp;<span class="op" id="5495941">:=</span>&nbsp;<span class="ident" id="5495944">tr</span><span class="op" id="5495946">.</span><span class="ident" id="5495947">octal</span><span class="op" id="5495952">(</span><span class="ident" id="5495953">s</span><span class="op" id="5495954">.</span><span class="ident" id="5495955">next</span><span class="op" id="5495959">(</span><span class="ident" id="5495960">oldGNUSparseOffsetSize</span><span class="op" id="5495982">)</span><span class="op" id="5495983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495987">numBytes</span>&nbsp;<span class="op" id="5495996">:=</span>&nbsp;<span class="ident" id="5495999">tr</span><span class="op" id="5496001">.</span><span class="ident" id="5496002">octal</span><span class="op" id="5496007">(</span><span class="ident" id="5496008">s</span><span class="op" id="5496009">.</span><span class="ident" id="5496010">next</span><span class="op" id="5496014">(</span><span class="ident" id="5496015">oldGNUSparseNumBytesSize</span><span class="op" id="5496039">)</span><span class="op" id="5496040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496044">if</span>&nbsp;<span class="ident" id="5496047">tr</span><span class="op" id="5496049">.</span><span class="ident" id="5496050">err</span>&nbsp;<span class="op" id="5496054">!=</span>&nbsp;<span class="ident" id="5496057">nil</span>&nbsp;<span class="op" id="5496061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496066">tr</span><span class="op" id="5496068">.</span><span class="ident" id="5496069">err</span>&nbsp;<span class="op" id="5496073">=</span>&nbsp;<span class="ident" id="5496075">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496088">return</span>&nbsp;<span class="ident" id="5496095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496105">if</span>&nbsp;<span class="ident" id="5496108">offset</span>&nbsp;<span class="op" id="5496115">==</span>&nbsp;<span class="num" id="5496118">0</span>&nbsp;<span class="op" id="5496120">&amp;&amp;</span>&nbsp;<span class="ident" id="5496123">numBytes</span>&nbsp;<span class="op" id="5496132">==</span>&nbsp;<span class="num" id="5496135">0</span>&nbsp;<span class="op" id="5496137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496150">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496154">sp</span>&nbsp;<span class="op" id="5496157">=</span>&nbsp;<span class="builtinfunc" id="5496159">append</span><span class="op" id="5496165">(</span><span class="ident" id="5496166">sp</span><span class="op" id="5496168">,</span>&nbsp;<span class="ident" id="5496170">sparseEntry</span><span class="op" id="5496181">{</span><span class="ident" id="5496182">offset</span><span class="op" id="5496188">:</span>&nbsp;<span class="ident" id="5496190">offset</span><span class="op" id="5496196">,</span>&nbsp;<span class="ident" id="5496198">numBytes</span><span class="op" id="5496206">:</span>&nbsp;<span class="ident" id="5496208">numBytes</span><span class="op" id="5496216">}</span><span class="op" id="5496217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496224">for</span>&nbsp;<span class="ident" id="5496228">isExtended</span>&nbsp;<span class="op" id="5496239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5496243">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496320">sparseHeader</span>&nbsp;<span class="op" id="5496333">:=</span>&nbsp;<span class="builtinfunc" id="5496336">make</span><span class="op" id="5496340">(</span><span class="op" id="5496341">[</span><span class="op" id="5496342">]</span><span class="builtintype" id="5496343">byte</span><span class="op" id="5496347">,</span>&nbsp;<span class="ident" id="5496349">blockSize</span><span class="op" id="5496358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496362">if</span>&nbsp;<span class="ident" id="5496365">_</span><span class="op" id="5496366">,</span>&nbsp;<span class="ident" id="5496368">tr</span><span class="op" id="5496370">.</span><span class="ident" id="5496371">err</span>&nbsp;<span class="op" id="5496375">=</span>&nbsp;<span class="ident" id="5496377">io</span><span class="op" id="5496379">.</span><span class="ident" id="5496380">ReadFull</span><span class="op" id="5496388">(</span><span class="ident" id="5496389">tr</span><span class="op" id="5496391">.</span><span class="ident" id="5496392">r</span><span class="op" id="5496393">,</span>&nbsp;<span class="ident" id="5496395">sparseHeader</span><span class="op" id="5496407">)</span><span class="op" id="5496408">;</span>&nbsp;<span class="ident" id="5496410">tr</span><span class="op" id="5496412">.</span><span class="ident" id="5496413">err</span>&nbsp;<span class="op" id="5496417">!=</span>&nbsp;<span class="ident" id="5496420">nil</span>&nbsp;<span class="op" id="5496424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496429">return</span>&nbsp;<span class="ident" id="5496436">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496446">isExtended</span>&nbsp;<span class="op" id="5496457">=</span>&nbsp;<span class="ident" id="5496459">sparseHeader</span><span class="op" id="5496471">[</span><span class="ident" id="5496472">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="5496514">]</span>&nbsp;<span class="op" id="5496516">!=</span>&nbsp;<span class="num" id="5496519">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496523">s</span>&nbsp;<span class="op" id="5496525">=</span>&nbsp;<span class="ident" id="5496527">slicer</span><span class="op" id="5496533">(</span><span class="ident" id="5496534">sparseHeader</span><span class="op" id="5496546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496550">for</span>&nbsp;<span class="ident" id="5496554">i</span>&nbsp;<span class="op" id="5496556">:=</span>&nbsp;<span class="num" id="5496559">0</span><span class="op" id="5496560">;</span>&nbsp;<span class="ident" id="5496562">i</span>&nbsp;<span class="op" id="5496564">&lt;</span>&nbsp;<span class="ident" id="5496566">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="5496602">;</span>&nbsp;<span class="ident" id="5496604">i</span><span class="op" id="5496605">++</span>&nbsp;<span class="op" id="5496608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496613">offset</span>&nbsp;<span class="op" id="5496620">:=</span>&nbsp;<span class="ident" id="5496623">tr</span><span class="op" id="5496625">.</span><span class="ident" id="5496626">octal</span><span class="op" id="5496631">(</span><span class="ident" id="5496632">s</span><span class="op" id="5496633">.</span><span class="ident" id="5496634">next</span><span class="op" id="5496638">(</span><span class="ident" id="5496639">oldGNUSparseOffsetSize</span><span class="op" id="5496661">)</span><span class="op" id="5496662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496667">numBytes</span>&nbsp;<span class="op" id="5496676">:=</span>&nbsp;<span class="ident" id="5496679">tr</span><span class="op" id="5496681">.</span><span class="ident" id="5496682">octal</span><span class="op" id="5496687">(</span><span class="ident" id="5496688">s</span><span class="op" id="5496689">.</span><span class="ident" id="5496690">next</span><span class="op" id="5496694">(</span><span class="ident" id="5496695">oldGNUSparseNumBytesSize</span><span class="op" id="5496719">)</span><span class="op" id="5496720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496725">if</span>&nbsp;<span class="ident" id="5496728">tr</span><span class="op" id="5496730">.</span><span class="ident" id="5496731">err</span>&nbsp;<span class="op" id="5496735">!=</span>&nbsp;<span class="ident" id="5496738">nil</span>&nbsp;<span class="op" id="5496742">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496748">tr</span><span class="op" id="5496750">.</span><span class="ident" id="5496751">err</span>&nbsp;<span class="op" id="5496755">=</span>&nbsp;<span class="ident" id="5496757">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496771">return</span>&nbsp;<span class="ident" id="5496778">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496790">if</span>&nbsp;<span class="ident" id="5496793">offset</span>&nbsp;<span class="op" id="5496800">==</span>&nbsp;<span class="num" id="5496803">0</span>&nbsp;<span class="op" id="5496805">&amp;&amp;</span>&nbsp;<span class="ident" id="5496808">numBytes</span>&nbsp;<span class="op" id="5496817">==</span>&nbsp;<span class="num" id="5496820">0</span>&nbsp;<span class="op" id="5496822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496828">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496842">sp</span>&nbsp;<span class="op" id="5496845">=</span>&nbsp;<span class="builtinfunc" id="5496847">append</span><span class="op" id="5496853">(</span><span class="ident" id="5496854">sp</span><span class="op" id="5496856">,</span>&nbsp;<span class="ident" id="5496858">sparseEntry</span><span class="op" id="5496869">{</span><span class="ident" id="5496870">offset</span><span class="op" id="5496876">:</span>&nbsp;<span class="ident" id="5496878">offset</span><span class="op" id="5496884">,</span>&nbsp;<span class="ident" id="5496886">numBytes</span><span class="op" id="5496894">:</span>&nbsp;<span class="ident" id="5496896">numBytes</span><span class="op" id="5496904">}</span><span class="op" id="5496905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5496912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5496915">return</span>&nbsp;<span class="ident" id="5496922">sp</span><br>
<span class="lineno">595</span><span class="op" id="5496925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5496928">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="5497022">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5497122">func</span>&nbsp;<span class="ident" id="5497127">readGNUSparseMap1x0</span><span class="op" id="5497146">(</span><span class="ident" id="5497147">r</span>&nbsp;<span class="ident" id="5497149">io</span><span class="op" id="5497151">.</span><span class="ident" id="5497152">Reader</span><span class="op" id="5497158">)</span>&nbsp;<span class="op" id="5497160">(</span><span class="op" id="5497161">[</span><span class="op" id="5497162">]</span><span class="ident" id="5497163">sparseEntry</span><span class="op" id="5497174">,</span>&nbsp;<span class="builtintype" id="5497176">error</span><span class="op" id="5497181">)</span>&nbsp;<span class="op" id="5497183">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497186">buf</span>&nbsp;<span class="op" id="5497190">:=</span>&nbsp;<span class="builtinfunc" id="5497193">make</span><span class="op" id="5497197">(</span><span class="op" id="5497198">[</span><span class="op" id="5497199">]</span><span class="builtintype" id="5497200">byte</span><span class="op" id="5497204">,</span>&nbsp;<span class="num" id="5497206">2</span><span class="op" id="5497207">*</span><span class="ident" id="5497208">blockSize</span><span class="op" id="5497217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497220">sparseHeader</span>&nbsp;<span class="op" id="5497233">:=</span>&nbsp;<span class="ident" id="5497236">buf</span><span class="op" id="5497239">[</span><span class="op" id="5497240">:</span><span class="ident" id="5497241">blockSize</span><span class="op" id="5497250">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497254">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497337">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497409">readDecimal</span>&nbsp;<span class="op" id="5497421">:=</span>&nbsp;<span class="keyword" id="5497424">func</span><span class="op" id="5497428">(</span><span class="op" id="5497429">)</span>&nbsp;<span class="op" id="5497431">(</span><span class="ident" id="5497432">int64</span><span class="op" id="5497437">,</span>&nbsp;<span class="builtintype" id="5497439">error</span><span class="op" id="5497444">)</span>&nbsp;<span class="op" id="5497446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497450">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497472">nl</span>&nbsp;<span class="op" id="5497475">:=</span>&nbsp;<span class="ident" id="5497478">bytes</span><span class="op" id="5497483">.</span><span class="ident" id="5497484">IndexByte</span><span class="op" id="5497493">(</span><span class="ident" id="5497494">sparseHeader</span><span class="op" id="5497506">,</span>&nbsp;<span class="string" id="5497508">&#39;\n&#39;</span><span class="op" id="5497512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497516">if</span>&nbsp;<span class="ident" id="5497519">nl</span>&nbsp;<span class="op" id="5497522">==</span>&nbsp;<span class="op" id="5497525">-</span><span class="num" id="5497526">1</span>&nbsp;<span class="op" id="5497528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497533">if</span>&nbsp;<span class="builtinfunc" id="5497536">len</span><span class="op" id="5497539">(</span><span class="ident" id="5497540">sparseHeader</span><span class="op" id="5497552">)</span>&nbsp;<span class="op" id="5497554">&gt;=</span>&nbsp;<span class="ident" id="5497557">blockSize</span>&nbsp;<span class="op" id="5497567">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497573">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497597">return</span>&nbsp;<span class="num" id="5497604">0</span><span class="op" id="5497605">,</span>&nbsp;<span class="ident" id="5497607">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497625">oldLen</span>&nbsp;<span class="op" id="5497632">:=</span>&nbsp;<span class="builtinfunc" id="5497635">len</span><span class="op" id="5497638">(</span><span class="ident" id="5497639">sparseHeader</span><span class="op" id="5497651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497656">newLen</span>&nbsp;<span class="op" id="5497663">:=</span>&nbsp;<span class="ident" id="5497666">oldLen</span>&nbsp;<span class="op" id="5497673">+</span>&nbsp;<span class="ident" id="5497675">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497688">if</span>&nbsp;<span class="builtinfunc" id="5497691">cap</span><span class="op" id="5497694">(</span><span class="ident" id="5497695">sparseHeader</span><span class="op" id="5497707">)</span>&nbsp;<span class="op" id="5497709">&lt;</span>&nbsp;<span class="ident" id="5497711">newLen</span>&nbsp;<span class="op" id="5497718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497724">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5497796">copy</span><span class="op" id="5497800">(</span><span class="ident" id="5497801">buf</span><span class="op" id="5497804">,</span>&nbsp;<span class="ident" id="5497806">sparseHeader</span><span class="op" id="5497818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497824">sparseHeader</span>&nbsp;<span class="op" id="5497837">=</span>&nbsp;<span class="ident" id="5497839">buf</span><span class="op" id="5497842">[</span><span class="op" id="5497843">:</span><span class="ident" id="5497844">newLen</span><span class="op" id="5497850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497855">}</span>&nbsp;<span class="keyword" id="5497857">else</span>&nbsp;<span class="op" id="5497862">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497868">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497920">sparseHeader</span>&nbsp;<span class="op" id="5497933">=</span>&nbsp;<span class="ident" id="5497935">sparseHeader</span><span class="op" id="5497947">[</span><span class="op" id="5497948">:</span><span class="ident" id="5497949">newLen</span><span class="op" id="5497955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497966">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498027">if</span>&nbsp;<span class="ident" id="5498030">_</span><span class="op" id="5498031">,</span>&nbsp;<span class="ident" id="5498033">err</span>&nbsp;<span class="op" id="5498037">:=</span>&nbsp;<span class="ident" id="5498040">io</span><span class="op" id="5498042">.</span><span class="ident" id="5498043">ReadFull</span><span class="op" id="5498051">(</span><span class="ident" id="5498052">r</span><span class="op" id="5498053">,</span>&nbsp;<span class="ident" id="5498055">sparseHeader</span><span class="op" id="5498067">[</span><span class="ident" id="5498068">oldLen</span><span class="op" id="5498074">:</span><span class="ident" id="5498075">newLen</span><span class="op" id="5498081">]</span><span class="op" id="5498082">)</span><span class="op" id="5498083">;</span>&nbsp;<span class="ident" id="5498085">err</span>&nbsp;<span class="op" id="5498089">!=</span>&nbsp;<span class="ident" id="5498092">nil</span>&nbsp;<span class="op" id="5498096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498102">return</span>&nbsp;<span class="num" id="5498109">0</span><span class="op" id="5498110">,</span>&nbsp;<span class="ident" id="5498112">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498125">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498166">nl</span>&nbsp;<span class="op" id="5498169">=</span>&nbsp;<span class="ident" id="5498171">bytes</span><span class="op" id="5498176">.</span><span class="ident" id="5498177">IndexByte</span><span class="op" id="5498186">(</span><span class="ident" id="5498187">sparseHeader</span><span class="op" id="5498199">[</span><span class="ident" id="5498200">oldLen</span><span class="op" id="5498206">:</span><span class="ident" id="5498207">newLen</span><span class="op" id="5498213">]</span><span class="op" id="5498214">,</span>&nbsp;<span class="string" id="5498216">&#39;\n&#39;</span><span class="op" id="5498220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498225">if</span>&nbsp;<span class="ident" id="5498228">nl</span>&nbsp;<span class="op" id="5498231">==</span>&nbsp;<span class="op" id="5498234">-</span><span class="num" id="5498235">1</span>&nbsp;<span class="op" id="5498237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498243">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498267">return</span>&nbsp;<span class="num" id="5498274">0</span><span class="op" id="5498275">,</span>&nbsp;<span class="ident" id="5498277">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498290">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498295">nl</span>&nbsp;<span class="op" id="5498298">+=</span>&nbsp;<span class="ident" id="5498301">oldLen</span>&nbsp;<span class="comment" id="5498308">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498357">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498408">n</span><span class="op" id="5498409">,</span>&nbsp;<span class="ident" id="5498411">err</span>&nbsp;<span class="op" id="5498415">:=</span>&nbsp;<span class="ident" id="5498418">strconv</span><span class="op" id="5498425">.</span><span class="ident" id="5498426">ParseInt</span><span class="op" id="5498434">(</span><span class="builtintype" id="5498435">string</span><span class="op" id="5498441">(</span><span class="ident" id="5498442">sparseHeader</span><span class="op" id="5498454">[</span><span class="op" id="5498455">:</span><span class="ident" id="5498456">nl</span><span class="op" id="5498458">]</span><span class="op" id="5498459">)</span><span class="op" id="5498460">,</span>&nbsp;<span class="num" id="5498462">10</span><span class="op" id="5498464">,</span>&nbsp;<span class="num" id="5498466">0</span><span class="op" id="5498467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498471">if</span>&nbsp;<span class="ident" id="5498474">err</span>&nbsp;<span class="op" id="5498478">!=</span>&nbsp;<span class="ident" id="5498481">nil</span>&nbsp;<span class="op" id="5498485">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498490">return</span>&nbsp;<span class="num" id="5498497">0</span><span class="op" id="5498498">,</span>&nbsp;<span class="ident" id="5498500">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498517">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498565">sparseHeader</span>&nbsp;<span class="op" id="5498578">=</span>&nbsp;<span class="ident" id="5498580">sparseHeader</span><span class="op" id="5498592">[</span><span class="ident" id="5498593">nl</span><span class="op" id="5498595">+</span><span class="num" id="5498596">1</span><span class="op" id="5498597">:</span><span class="op" id="5498598">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498602">return</span>&nbsp;<span class="ident" id="5498609">n</span><span class="op" id="5498610">,</span>&nbsp;<span class="ident" id="5498612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498621">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498646">if</span>&nbsp;<span class="ident" id="5498649">_</span><span class="op" id="5498650">,</span>&nbsp;<span class="ident" id="5498652">err</span>&nbsp;<span class="op" id="5498656">:=</span>&nbsp;<span class="ident" id="5498659">io</span><span class="op" id="5498661">.</span><span class="ident" id="5498662">ReadFull</span><span class="op" id="5498670">(</span><span class="ident" id="5498671">r</span><span class="op" id="5498672">,</span>&nbsp;<span class="ident" id="5498674">sparseHeader</span><span class="op" id="5498686">)</span><span class="op" id="5498687">;</span>&nbsp;<span class="ident" id="5498689">err</span>&nbsp;<span class="op" id="5498693">!=</span>&nbsp;<span class="ident" id="5498696">nil</span>&nbsp;<span class="op" id="5498700">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498704">return</span>&nbsp;<span class="ident" id="5498711">nil</span><span class="op" id="5498714">,</span>&nbsp;<span class="ident" id="5498716">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498725">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498775">numEntries</span><span class="op" id="5498785">,</span>&nbsp;<span class="ident" id="5498787">err</span>&nbsp;<span class="op" id="5498791">:=</span>&nbsp;<span class="ident" id="5498794">readDecimal</span><span class="op" id="5498805">(</span><span class="op" id="5498806">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498809">if</span>&nbsp;<span class="ident" id="5498812">err</span>&nbsp;<span class="op" id="5498816">!=</span>&nbsp;<span class="ident" id="5498819">nil</span>&nbsp;<span class="op" id="5498823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498827">return</span>&nbsp;<span class="ident" id="5498834">nil</span><span class="op" id="5498837">,</span>&nbsp;<span class="ident" id="5498839">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498848">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498873">sp</span>&nbsp;<span class="op" id="5498876">:=</span>&nbsp;<span class="builtinfunc" id="5498879">make</span><span class="op" id="5498883">(</span><span class="op" id="5498884">[</span><span class="op" id="5498885">]</span><span class="ident" id="5498886">sparseEntry</span><span class="op" id="5498897">,</span>&nbsp;<span class="num" id="5498899">0</span><span class="op" id="5498900">,</span>&nbsp;<span class="ident" id="5498902">numEntries</span><span class="op" id="5498912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498915">for</span>&nbsp;<span class="ident" id="5498919">i</span>&nbsp;<span class="op" id="5498921">:=</span>&nbsp;<span class="ident" id="5498924">int64</span><span class="op" id="5498929">(</span><span class="num" id="5498930">0</span><span class="op" id="5498931">)</span><span class="op" id="5498932">;</span>&nbsp;<span class="ident" id="5498934">i</span>&nbsp;<span class="op" id="5498936">&lt;</span>&nbsp;<span class="ident" id="5498938">numEntries</span><span class="op" id="5498948">;</span>&nbsp;<span class="ident" id="5498950">i</span><span class="op" id="5498951">++</span>&nbsp;<span class="op" id="5498954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498958">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498979">offset</span><span class="op" id="5498985">,</span>&nbsp;<span class="ident" id="5498987">err</span>&nbsp;<span class="op" id="5498991">:=</span>&nbsp;<span class="ident" id="5498994">readDecimal</span><span class="op" id="5499005">(</span><span class="op" id="5499006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499010">if</span>&nbsp;<span class="ident" id="5499013">err</span>&nbsp;<span class="op" id="5499017">!=</span>&nbsp;<span class="ident" id="5499020">nil</span>&nbsp;<span class="op" id="5499024">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499029">return</span>&nbsp;<span class="ident" id="5499036">nil</span><span class="op" id="5499039">,</span>&nbsp;<span class="ident" id="5499041">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499051">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499070">numBytes</span><span class="op" id="5499078">,</span>&nbsp;<span class="ident" id="5499080">err</span>&nbsp;<span class="op" id="5499084">:=</span>&nbsp;<span class="ident" id="5499087">readDecimal</span><span class="op" id="5499098">(</span><span class="op" id="5499099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499103">if</span>&nbsp;<span class="ident" id="5499106">err</span>&nbsp;<span class="op" id="5499110">!=</span>&nbsp;<span class="ident" id="5499113">nil</span>&nbsp;<span class="op" id="5499117">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499122">return</span>&nbsp;<span class="ident" id="5499129">nil</span><span class="op" id="5499132">,</span>&nbsp;<span class="ident" id="5499134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499145">sp</span>&nbsp;<span class="op" id="5499148">=</span>&nbsp;<span class="builtinfunc" id="5499150">append</span><span class="op" id="5499156">(</span><span class="ident" id="5499157">sp</span><span class="op" id="5499159">,</span>&nbsp;<span class="ident" id="5499161">sparseEntry</span><span class="op" id="5499172">{</span><span class="ident" id="5499173">offset</span><span class="op" id="5499179">:</span>&nbsp;<span class="ident" id="5499181">offset</span><span class="op" id="5499187">,</span>&nbsp;<span class="ident" id="5499189">numBytes</span><span class="op" id="5499197">:</span>&nbsp;<span class="ident" id="5499199">numBytes</span><span class="op" id="5499207">}</span><span class="op" id="5499208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499211">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499215">return</span>&nbsp;<span class="ident" id="5499222">sp</span><span class="op" id="5499224">,</span>&nbsp;<span class="ident" id="5499226">nil</span><br>
<span class="lineno"></span><span class="op" id="5499230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5499233">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="5499327">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5499375">func</span>&nbsp;<span class="ident" id="5499380">readGNUSparseMap0x1</span><span class="op" id="5499399">(</span><span class="ident" id="5499400">headers</span>&nbsp;<span class="keyword" id="5499408">map</span><span class="op" id="5499411">[</span><span class="builtintype" id="5499412">string</span><span class="op" id="5499418">]</span><span class="builtintype" id="5499419">string</span><span class="op" id="5499425">)</span>&nbsp;<span class="op" id="5499427">(</span><span class="op" id="5499428">[</span><span class="op" id="5499429">]</span><span class="ident" id="5499430">sparseEntry</span><span class="op" id="5499441">,</span>&nbsp;<span class="builtintype" id="5499443">error</span><span class="op" id="5499448">)</span>&nbsp;<span class="op" id="5499450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499453">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499479">numEntriesStr</span><span class="op" id="5499492">,</span>&nbsp;<span class="ident" id="5499494">ok</span>&nbsp;<span class="op" id="5499497">:=</span>&nbsp;<span class="ident" id="5499500">headers</span><span class="op" id="5499507">[</span><span class="ident" id="5499508">paxGNUSparseNumBlocks</span><span class="op" id="5499529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499532">if</span>&nbsp;<span class="op" id="5499535">!</span><span class="ident" id="5499536">ok</span>&nbsp;<span class="op" id="5499539">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499543">return</span>&nbsp;<span class="ident" id="5499550">nil</span><span class="op" id="5499553">,</span>&nbsp;<span class="ident" id="5499555">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499569">numEntries</span><span class="op" id="5499579">,</span>&nbsp;<span class="ident" id="5499581">err</span>&nbsp;<span class="op" id="5499585">:=</span>&nbsp;<span class="ident" id="5499588">strconv</span><span class="op" id="5499595">.</span><span class="ident" id="5499596">ParseInt</span><span class="op" id="5499604">(</span><span class="ident" id="5499605">numEntriesStr</span><span class="op" id="5499618">,</span>&nbsp;<span class="num" id="5499620">10</span><span class="op" id="5499622">,</span>&nbsp;<span class="num" id="5499624">0</span><span class="op" id="5499625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499628">if</span>&nbsp;<span class="ident" id="5499631">err</span>&nbsp;<span class="op" id="5499635">!=</span>&nbsp;<span class="ident" id="5499638">nil</span>&nbsp;<span class="op" id="5499642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499646">return</span>&nbsp;<span class="ident" id="5499653">nil</span><span class="op" id="5499656">,</span>&nbsp;<span class="ident" id="5499658">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499673">sparseMap</span>&nbsp;<span class="op" id="5499683">:=</span>&nbsp;<span class="ident" id="5499686">strings</span><span class="op" id="5499693">.</span><span class="ident" id="5499694">Split</span><span class="op" id="5499699">(</span><span class="ident" id="5499700">headers</span><span class="op" id="5499707">[</span><span class="ident" id="5499708">paxGNUSparseMap</span><span class="op" id="5499723">]</span><span class="op" id="5499724">,</span>&nbsp;<span class="string" id="5499726">&#34;,&#34;</span><span class="op" id="5499729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499733">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499793">if</span>&nbsp;<span class="ident" id="5499796">int64</span><span class="op" id="5499801">(</span><span class="builtinfunc" id="5499802">len</span><span class="op" id="5499805">(</span><span class="ident" id="5499806">sparseMap</span><span class="op" id="5499815">)</span><span class="op" id="5499816">)</span>&nbsp;<span class="op" id="5499818">!=</span>&nbsp;<span class="num" id="5499821">2</span><span class="op" id="5499822">*</span><span class="ident" id="5499823">numEntries</span>&nbsp;<span class="op" id="5499834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499838">return</span>&nbsp;<span class="ident" id="5499845">nil</span><span class="op" id="5499848">,</span>&nbsp;<span class="ident" id="5499850">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499865">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499912">sp</span>&nbsp;<span class="op" id="5499915">:=</span>&nbsp;<span class="builtinfunc" id="5499918">make</span><span class="op" id="5499922">(</span><span class="op" id="5499923">[</span><span class="op" id="5499924">]</span><span class="ident" id="5499925">sparseEntry</span><span class="op" id="5499936">,</span>&nbsp;<span class="num" id="5499938">0</span><span class="op" id="5499939">,</span>&nbsp;<span class="ident" id="5499941">numEntries</span><span class="op" id="5499951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499954">for</span>&nbsp;<span class="ident" id="5499958">i</span>&nbsp;<span class="op" id="5499960">:=</span>&nbsp;<span class="ident" id="5499963">int64</span><span class="op" id="5499968">(</span><span class="num" id="5499969">0</span><span class="op" id="5499970">)</span><span class="op" id="5499971">;</span>&nbsp;<span class="ident" id="5499973">i</span>&nbsp;<span class="op" id="5499975">&lt;</span>&nbsp;<span class="ident" id="5499977">numEntries</span><span class="op" id="5499987">;</span>&nbsp;<span class="ident" id="5499989">i</span><span class="op" id="5499990">++</span>&nbsp;<span class="op" id="5499993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499997">offset</span><span class="op" id="5500003">,</span>&nbsp;<span class="ident" id="5500005">err</span>&nbsp;<span class="op" id="5500009">:=</span>&nbsp;<span class="ident" id="5500012">strconv</span><span class="op" id="5500019">.</span><span class="ident" id="5500020">ParseInt</span><span class="op" id="5500028">(</span><span class="ident" id="5500029">sparseMap</span><span class="op" id="5500038">[</span><span class="num" id="5500039">2</span><span class="op" id="5500040">*</span><span class="ident" id="5500041">i</span><span class="op" id="5500042">]</span><span class="op" id="5500043">,</span>&nbsp;<span class="num" id="5500045">10</span><span class="op" id="5500047">,</span>&nbsp;<span class="num" id="5500049">0</span><span class="op" id="5500050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500054">if</span>&nbsp;<span class="ident" id="5500057">err</span>&nbsp;<span class="op" id="5500061">!=</span>&nbsp;<span class="ident" id="5500064">nil</span>&nbsp;<span class="op" id="5500068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500073">return</span>&nbsp;<span class="ident" id="5500080">nil</span><span class="op" id="5500083">,</span>&nbsp;<span class="ident" id="5500085">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500101">numBytes</span><span class="op" id="5500109">,</span>&nbsp;<span class="ident" id="5500111">err</span>&nbsp;<span class="op" id="5500115">:=</span>&nbsp;<span class="ident" id="5500118">strconv</span><span class="op" id="5500125">.</span><span class="ident" id="5500126">ParseInt</span><span class="op" id="5500134">(</span><span class="ident" id="5500135">sparseMap</span><span class="op" id="5500144">[</span><span class="num" id="5500145">2</span><span class="op" id="5500146">*</span><span class="ident" id="5500147">i</span><span class="op" id="5500148">+</span><span class="num" id="5500149">1</span><span class="op" id="5500150">]</span><span class="op" id="5500151">,</span>&nbsp;<span class="num" id="5500153">10</span><span class="op" id="5500155">,</span>&nbsp;<span class="num" id="5500157">0</span><span class="op" id="5500158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500162">if</span>&nbsp;<span class="ident" id="5500165">err</span>&nbsp;<span class="op" id="5500169">!=</span>&nbsp;<span class="ident" id="5500172">nil</span>&nbsp;<span class="op" id="5500176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500181">return</span>&nbsp;<span class="ident" id="5500188">nil</span><span class="op" id="5500191">,</span>&nbsp;<span class="ident" id="5500193">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500205">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500209">sp</span>&nbsp;<span class="op" id="5500212">=</span>&nbsp;<span class="builtinfunc" id="5500214">append</span><span class="op" id="5500220">(</span><span class="ident" id="5500221">sp</span><span class="op" id="5500223">,</span>&nbsp;<span class="ident" id="5500225">sparseEntry</span><span class="op" id="5500236">{</span><span class="ident" id="5500237">offset</span><span class="op" id="5500243">:</span>&nbsp;<span class="ident" id="5500245">offset</span><span class="op" id="5500251">,</span>&nbsp;<span class="ident" id="5500253">numBytes</span><span class="op" id="5500261">:</span>&nbsp;<span class="ident" id="5500263">numBytes</span><span class="op" id="5500271">}</span><span class="op" id="5500272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500279">return</span>&nbsp;<span class="ident" id="5500286">sp</span><span class="op" id="5500288">,</span>&nbsp;<span class="ident" id="5500290">nil</span><br>
<span class="lineno"></span><span class="op" id="5500294">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="5500297">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5500378">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5500435">func</span>&nbsp;<span class="op" id="5500440">(</span><span class="ident" id="5500441">tr</span>&nbsp;<span class="op" id="5500444">*</span><span class="ident" id="5500445">Reader</span><span class="op" id="5500451">)</span>&nbsp;<span class="ident" id="5500453">numBytes</span><span class="op" id="5500461">(</span><span class="op" id="5500462">)</span>&nbsp;<span class="ident" id="5500464">int64</span>&nbsp;<span class="op" id="5500470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500473">if</span>&nbsp;<span class="ident" id="5500476">tr</span><span class="op" id="5500478">.</span><span class="ident" id="5500479">curr</span>&nbsp;<span class="op" id="5500484">==</span>&nbsp;<span class="ident" id="5500487">nil</span>&nbsp;<span class="op" id="5500491">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500495">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500529">return</span>&nbsp;<span class="num" id="5500536">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500542">return</span>&nbsp;<span class="ident" id="5500549">tr</span><span class="op" id="5500551">.</span><span class="ident" id="5500552">curr</span><span class="op" id="5500556">.</span><span class="ident" id="5500557">numBytes</span><span class="op" id="5500565">(</span><span class="op" id="5500566">)</span><br>
<span class="lineno"></span><span class="op" id="5500568">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5500571">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5500628">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="5500691">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="5500745">func</span>&nbsp;<span class="op" id="5500750">(</span><span class="ident" id="5500751">tr</span>&nbsp;<span class="op" id="5500754">*</span><span class="ident" id="5500755">Reader</span><span class="op" id="5500761">)</span>&nbsp;<span class="ident" id="5500763">Read</span><span class="op" id="5500767">(</span><span class="ident" id="5500768">b</span>&nbsp;<span class="op" id="5500770">[</span><span class="op" id="5500771">]</span><span class="builtintype" id="5500772">byte</span><span class="op" id="5500776">)</span>&nbsp;<span class="op" id="5500778">(</span><span class="ident" id="5500779">n</span>&nbsp;<span class="builtintype" id="5500781">int</span><span class="op" id="5500784">,</span>&nbsp;<span class="ident" id="5500786">err</span>&nbsp;<span class="builtintype" id="5500790">error</span><span class="op" id="5500795">)</span>&nbsp;<span class="op" id="5500797">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500800">if</span>&nbsp;<span class="ident" id="5500803">tr</span><span class="op" id="5500805">.</span><span class="ident" id="5500806">curr</span>&nbsp;<span class="op" id="5500811">==</span>&nbsp;<span class="ident" id="5500814">nil</span>&nbsp;<span class="op" id="5500818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500822">return</span>&nbsp;<span class="num" id="5500829">0</span><span class="op" id="5500830">,</span>&nbsp;<span class="ident" id="5500832">io</span><span class="op" id="5500834">.</span><span class="ident" id="5500835">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500843">n</span><span class="op" id="5500844">,</span>&nbsp;<span class="ident" id="5500846">err</span>&nbsp;<span class="op" id="5500850">=</span>&nbsp;<span class="ident" id="5500852">tr</span><span class="op" id="5500854">.</span><span class="ident" id="5500855">curr</span><span class="op" id="5500859">.</span><span class="ident" id="5500860">Read</span><span class="op" id="5500864">(</span><span class="ident" id="5500865">b</span><span class="op" id="5500866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500869">if</span>&nbsp;<span class="ident" id="5500872">err</span>&nbsp;<span class="op" id="5500876">!=</span>&nbsp;<span class="ident" id="5500879">nil</span>&nbsp;<span class="op" id="5500883">&amp;&amp;</span>&nbsp;<span class="ident" id="5500886">err</span>&nbsp;<span class="op" id="5500890">!=</span>&nbsp;<span class="ident" id="5500893">io</span><span class="op" id="5500895">.</span><span class="ident" id="5500896">EOF</span>&nbsp;<span class="op" id="5500900">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500904">tr</span><span class="op" id="5500906">.</span><span class="ident" id="5500907">err</span>&nbsp;<span class="op" id="5500911">=</span>&nbsp;<span class="ident" id="5500913">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500921">return</span><br>
<span class="lineno"></span><span class="op" id="5500928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="5500931">func</span>&nbsp;<span class="op" id="5500936">(</span><span class="ident" id="5500937">rfr</span>&nbsp;<span class="op" id="5500941">*</span><span class="ident" id="5500942">regFileReader</span><span class="op" id="5500955">)</span>&nbsp;<span class="ident" id="5500957">Read</span><span class="op" id="5500961">(</span><span class="ident" id="5500962">b</span>&nbsp;<span class="op" id="5500964">[</span><span class="op" id="5500965">]</span><span class="builtintype" id="5500966">byte</span><span class="op" id="5500970">)</span>&nbsp;<span class="op" id="5500972">(</span><span class="ident" id="5500973">n</span>&nbsp;<span class="builtintype" id="5500975">int</span><span class="op" id="5500978">,</span>&nbsp;<span class="ident" id="5500980">err</span>&nbsp;<span class="builtintype" id="5500984">error</span><span class="op" id="5500989">)</span>&nbsp;<span class="op" id="5500991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500994">if</span>&nbsp;<span class="ident" id="5500997">rfr</span><span class="op" id="5501000">.</span><span class="ident" id="5501001">nb</span>&nbsp;<span class="op" id="5501004">==</span>&nbsp;<span class="num" id="5501007">0</span>&nbsp;<span class="op" id="5501009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501013">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501032">return</span>&nbsp;<span class="num" id="5501039">0</span><span class="op" id="5501040">,</span>&nbsp;<span class="ident" id="5501042">io</span><span class="op" id="5501044">.</span><span class="ident" id="5501045">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501050">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501053">if</span>&nbsp;<span class="ident" id="5501056">int64</span><span class="op" id="5501061">(</span><span class="builtinfunc" id="5501062">len</span><span class="op" id="5501065">(</span><span class="ident" id="5501066">b</span><span class="op" id="5501067">)</span><span class="op" id="5501068">)</span>&nbsp;<span class="op" id="5501070">&gt;</span>&nbsp;<span class="ident" id="5501072">rfr</span><span class="op" id="5501075">.</span><span class="ident" id="5501076">nb</span>&nbsp;<span class="op" id="5501079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501083">b</span>&nbsp;<span class="op" id="5501085">=</span>&nbsp;<span class="ident" id="5501087">b</span><span class="op" id="5501088">[</span><span class="num" id="5501089">0</span><span class="op" id="5501090">:</span><span class="ident" id="5501091">rfr</span><span class="op" id="5501094">.</span><span class="ident" id="5501095">nb</span><span class="op" id="5501097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501103">n</span><span class="op" id="5501104">,</span>&nbsp;<span class="ident" id="5501106">err</span>&nbsp;<span class="op" id="5501110">=</span>&nbsp;<span class="ident" id="5501112">rfr</span><span class="op" id="5501115">.</span><span class="ident" id="5501116">r</span><span class="op" id="5501117">.</span><span class="ident" id="5501118">Read</span><span class="op" id="5501122">(</span><span class="ident" id="5501123">b</span><span class="op" id="5501124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501127">rfr</span><span class="op" id="5501130">.</span><span class="ident" id="5501131">nb</span>&nbsp;<span class="op" id="5501134">-=</span>&nbsp;<span class="ident" id="5501137">int64</span><span class="op" id="5501142">(</span><span class="ident" id="5501143">n</span><span class="op" id="5501144">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501148">if</span>&nbsp;<span class="ident" id="5501151">err</span>&nbsp;<span class="op" id="5501155">==</span>&nbsp;<span class="ident" id="5501158">io</span><span class="op" id="5501160">.</span><span class="ident" id="5501161">EOF</span>&nbsp;<span class="op" id="5501165">&amp;&amp;</span>&nbsp;<span class="ident" id="5501168">rfr</span><span class="op" id="5501171">.</span><span class="ident" id="5501172">nb</span>&nbsp;<span class="op" id="5501175">&gt;</span>&nbsp;<span class="num" id="5501177">0</span>&nbsp;<span class="op" id="5501179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501183">err</span>&nbsp;<span class="op" id="5501187">=</span>&nbsp;<span class="ident" id="5501189">io</span><span class="op" id="5501191">.</span><span class="ident" id="5501192">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501213">return</span><br>
<span class="lineno">755</span><span class="op" id="5501220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5501223">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5501315">func</span>&nbsp;<span class="op" id="5501320">(</span><span class="ident" id="5501321">rfr</span>&nbsp;<span class="op" id="5501325">*</span><span class="ident" id="5501326">regFileReader</span><span class="op" id="5501339">)</span>&nbsp;<span class="ident" id="5501341">numBytes</span><span class="op" id="5501349">(</span><span class="op" id="5501350">)</span>&nbsp;<span class="ident" id="5501352">int64</span>&nbsp;<span class="op" id="5501358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501361">return</span>&nbsp;<span class="ident" id="5501368">rfr</span><span class="op" id="5501371">.</span><span class="ident" id="5501372">nb</span><br>
<span class="lineno">760</span><span class="op" id="5501375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5501378">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="5501441">func</span>&nbsp;<span class="op" id="5501446">(</span><span class="ident" id="5501447">sfr</span>&nbsp;<span class="op" id="5501451">*</span><span class="ident" id="5501452">sparseFileReader</span><span class="op" id="5501468">)</span>&nbsp;<span class="ident" id="5501470">readHole</span><span class="op" id="5501478">(</span><span class="ident" id="5501479">b</span>&nbsp;<span class="op" id="5501481">[</span><span class="op" id="5501482">]</span><span class="builtintype" id="5501483">byte</span><span class="op" id="5501487">,</span>&nbsp;<span class="ident" id="5501489">toOffset</span>&nbsp;<span class="ident" id="5501498">int64</span><span class="op" id="5501503">)</span>&nbsp;<span class="builtintype" id="5501505">int</span>&nbsp;<span class="op" id="5501509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501512">n64</span>&nbsp;<span class="op" id="5501516">:=</span>&nbsp;<span class="ident" id="5501519">toOffset</span>&nbsp;<span class="op" id="5501528">-</span>&nbsp;<span class="ident" id="5501530">sfr</span><span class="op" id="5501533">.</span><span class="ident" id="5501534">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501539">if</span>&nbsp;<span class="ident" id="5501542">n64</span>&nbsp;<span class="op" id="5501546">&gt;</span>&nbsp;<span class="ident" id="5501548">int64</span><span class="op" id="5501553">(</span><span class="builtinfunc" id="5501554">len</span><span class="op" id="5501557">(</span><span class="ident" id="5501558">b</span><span class="op" id="5501559">)</span><span class="op" id="5501560">)</span>&nbsp;<span class="op" id="5501562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501566">n64</span>&nbsp;<span class="op" id="5501570">=</span>&nbsp;<span class="ident" id="5501572">int64</span><span class="op" id="5501577">(</span><span class="builtinfunc" id="5501578">len</span><span class="op" id="5501581">(</span><span class="ident" id="5501582">b</span><span class="op" id="5501583">)</span><span class="op" id="5501584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501590">n</span>&nbsp;<span class="op" id="5501592">:=</span>&nbsp;<span class="builtintype" id="5501595">int</span><span class="op" id="5501598">(</span><span class="ident" id="5501599">n64</span><span class="op" id="5501602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501605">for</span>&nbsp;<span class="ident" id="5501609">i</span>&nbsp;<span class="op" id="5501611">:=</span>&nbsp;<span class="num" id="5501614">0</span><span class="op" id="5501615">;</span>&nbsp;<span class="ident" id="5501617">i</span>&nbsp;<span class="op" id="5501619">&lt;</span>&nbsp;<span class="ident" id="5501621">n</span><span class="op" id="5501622">;</span>&nbsp;<span class="ident" id="5501624">i</span><span class="op" id="5501625">++</span>&nbsp;<span class="op" id="5501628">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501632">b</span><span class="op" id="5501633">[</span><span class="ident" id="5501634">i</span><span class="op" id="5501635">]</span>&nbsp;<span class="op" id="5501637">=</span>&nbsp;<span class="num" id="5501639">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501645">sfr</span><span class="op" id="5501648">.</span><span class="ident" id="5501649">pos</span>&nbsp;<span class="op" id="5501653">+=</span>&nbsp;<span class="ident" id="5501656">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501661">return</span>&nbsp;<span class="ident" id="5501668">n</span><br>
<span class="lineno"></span><span class="op" id="5501670">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="5501673">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="5501726">func</span>&nbsp;<span class="op" id="5501731">(</span><span class="ident" id="5501732">sfr</span>&nbsp;<span class="op" id="5501736">*</span><span class="ident" id="5501737">sparseFileReader</span><span class="op" id="5501753">)</span>&nbsp;<span class="ident" id="5501755">Read</span><span class="op" id="5501759">(</span><span class="ident" id="5501760">b</span>&nbsp;<span class="op" id="5501762">[</span><span class="op" id="5501763">]</span><span class="builtintype" id="5501764">byte</span><span class="op" id="5501768">)</span>&nbsp;<span class="op" id="5501770">(</span><span class="ident" id="5501771">n</span>&nbsp;<span class="builtintype" id="5501773">int</span><span class="op" id="5501776">,</span>&nbsp;<span class="ident" id="5501778">err</span>&nbsp;<span class="builtintype" id="5501782">error</span><span class="op" id="5501787">)</span>&nbsp;<span class="op" id="5501789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501792">if</span>&nbsp;<span class="builtinfunc" id="5501795">len</span><span class="op" id="5501798">(</span><span class="ident" id="5501799">sfr</span><span class="op" id="5501802">.</span><span class="ident" id="5501803">sp</span><span class="op" id="5501805">)</span>&nbsp;<span class="op" id="5501807">==</span>&nbsp;<span class="num" id="5501810">0</span>&nbsp;<span class="op" id="5501812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501816">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501858">if</span>&nbsp;<span class="ident" id="5501861">sfr</span><span class="op" id="5501864">.</span><span class="ident" id="5501865">pos</span>&nbsp;<span class="op" id="5501869">&lt;</span>&nbsp;<span class="ident" id="5501871">sfr</span><span class="op" id="5501874">.</span><span class="ident" id="5501875">tot</span>&nbsp;<span class="op" id="5501879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501884">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501913">n</span>&nbsp;<span class="op" id="5501915">=</span>&nbsp;<span class="ident" id="5501917">sfr</span><span class="op" id="5501920">.</span><span class="ident" id="5501921">readHole</span><span class="op" id="5501929">(</span><span class="ident" id="5501930">b</span><span class="op" id="5501931">,</span>&nbsp;<span class="ident" id="5501933">sfr</span><span class="op" id="5501936">.</span><span class="ident" id="5501937">tot</span><span class="op" id="5501940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501945">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501954">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501958">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502003">return</span>&nbsp;<span class="num" id="5502010">0</span><span class="op" id="5502011">,</span>&nbsp;<span class="ident" id="5502013">io</span><span class="op" id="5502015">.</span><span class="ident" id="5502016">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502024">if</span>&nbsp;<span class="ident" id="5502027">sfr</span><span class="op" id="5502030">.</span><span class="ident" id="5502031">pos</span>&nbsp;<span class="op" id="5502035">&lt;</span>&nbsp;<span class="ident" id="5502037">sfr</span><span class="op" id="5502040">.</span><span class="ident" id="5502041">sp</span><span class="op" id="5502043">[</span><span class="num" id="5502044">0</span><span class="op" id="5502045">]</span><span class="op" id="5502046">.</span><span class="ident" id="5502047">offset</span>&nbsp;<span class="op" id="5502054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502058">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502079">n</span>&nbsp;<span class="op" id="5502081">=</span>&nbsp;<span class="ident" id="5502083">sfr</span><span class="op" id="5502086">.</span><span class="ident" id="5502087">readHole</span><span class="op" id="5502095">(</span><span class="ident" id="5502096">b</span><span class="op" id="5502097">,</span>&nbsp;<span class="ident" id="5502099">sfr</span><span class="op" id="5502102">.</span><span class="ident" id="5502103">sp</span><span class="op" id="5502105">[</span><span class="num" id="5502106">0</span><span class="op" id="5502107">]</span><span class="op" id="5502108">.</span><span class="ident" id="5502109">offset</span><span class="op" id="5502115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502131">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502198">posInFragment</span>&nbsp;<span class="op" id="5502212">:=</span>&nbsp;<span class="ident" id="5502215">sfr</span><span class="op" id="5502218">.</span><span class="ident" id="5502219">pos</span>&nbsp;<span class="op" id="5502223">-</span>&nbsp;<span class="ident" id="5502225">sfr</span><span class="op" id="5502228">.</span><span class="ident" id="5502229">sp</span><span class="op" id="5502231">[</span><span class="num" id="5502232">0</span><span class="op" id="5502233">]</span><span class="op" id="5502234">.</span><span class="ident" id="5502235">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502243">bytesLeft</span>&nbsp;<span class="op" id="5502253">:=</span>&nbsp;<span class="ident" id="5502256">sfr</span><span class="op" id="5502259">.</span><span class="ident" id="5502260">sp</span><span class="op" id="5502262">[</span><span class="num" id="5502263">0</span><span class="op" id="5502264">]</span><span class="op" id="5502265">.</span><span class="ident" id="5502266">numBytes</span>&nbsp;<span class="op" id="5502275">-</span>&nbsp;<span class="ident" id="5502277">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502292">if</span>&nbsp;<span class="ident" id="5502295">int64</span><span class="op" id="5502300">(</span><span class="builtinfunc" id="5502301">len</span><span class="op" id="5502304">(</span><span class="ident" id="5502305">b</span><span class="op" id="5502306">)</span><span class="op" id="5502307">)</span>&nbsp;<span class="op" id="5502309">&gt;</span>&nbsp;<span class="ident" id="5502311">bytesLeft</span>&nbsp;<span class="op" id="5502321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502325">b</span>&nbsp;<span class="op" id="5502327">=</span>&nbsp;<span class="ident" id="5502329">b</span><span class="op" id="5502330">[</span><span class="num" id="5502331">0</span><span class="op" id="5502332">:</span><span class="ident" id="5502333">bytesLeft</span><span class="op" id="5502342">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502345">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502349">n</span><span class="op" id="5502350">,</span>&nbsp;<span class="ident" id="5502352">err</span>&nbsp;<span class="op" id="5502356">=</span>&nbsp;<span class="ident" id="5502358">sfr</span><span class="op" id="5502361">.</span><span class="ident" id="5502362">rfr</span><span class="op" id="5502365">.</span><span class="ident" id="5502366">Read</span><span class="op" id="5502370">(</span><span class="ident" id="5502371">b</span><span class="op" id="5502372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502375">sfr</span><span class="op" id="5502378">.</span><span class="ident" id="5502379">pos</span>&nbsp;<span class="op" id="5502383">+=</span>&nbsp;<span class="ident" id="5502386">int64</span><span class="op" id="5502391">(</span><span class="ident" id="5502392">n</span><span class="op" id="5502393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502397">if</span>&nbsp;<span class="ident" id="5502400">int64</span><span class="op" id="5502405">(</span><span class="ident" id="5502406">n</span><span class="op" id="5502407">)</span>&nbsp;<span class="op" id="5502409">==</span>&nbsp;<span class="ident" id="5502412">bytesLeft</span>&nbsp;<span class="op" id="5502422">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502426">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502461">sfr</span><span class="op" id="5502464">.</span><span class="ident" id="5502465">sp</span>&nbsp;<span class="op" id="5502468">=</span>&nbsp;<span class="ident" id="5502470">sfr</span><span class="op" id="5502473">.</span><span class="ident" id="5502474">sp</span><span class="op" id="5502476">[</span><span class="num" id="5502477">1</span><span class="op" id="5502478">:</span><span class="op" id="5502479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502486">if</span>&nbsp;<span class="ident" id="5502489">err</span>&nbsp;<span class="op" id="5502493">==</span>&nbsp;<span class="ident" id="5502496">io</span><span class="op" id="5502498">.</span><span class="ident" id="5502499">EOF</span>&nbsp;<span class="op" id="5502503">&amp;&amp;</span>&nbsp;<span class="ident" id="5502506">sfr</span><span class="op" id="5502509">.</span><span class="ident" id="5502510">pos</span>&nbsp;<span class="op" id="5502514">&lt;</span>&nbsp;<span class="ident" id="5502516">sfr</span><span class="op" id="5502519">.</span><span class="ident" id="5502520">tot</span>&nbsp;<span class="op" id="5502524">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5502528">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502606">err</span>&nbsp;<span class="op" id="5502610">=</span>&nbsp;<span class="ident" id="5502612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502620">return</span><br>
<span class="lineno"></span><span class="op" id="5502627">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5502630">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5502704">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5502747">func</span>&nbsp;<span class="op" id="5502752">(</span><span class="ident" id="5502753">sfr</span>&nbsp;<span class="op" id="5502757">*</span><span class="ident" id="5502758">sparseFileReader</span><span class="op" id="5502774">)</span>&nbsp;<span class="ident" id="5502776">numBytes</span><span class="op" id="5502784">(</span><span class="op" id="5502785">)</span>&nbsp;<span class="ident" id="5502787">int64</span>&nbsp;<span class="op" id="5502793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502796">return</span>&nbsp;<span class="ident" id="5502803">sfr</span><span class="op" id="5502806">.</span><span class="ident" id="5502807">rfr</span><span class="op" id="5502810">.</span><span class="ident" id="5502811">nb</span><br>
<span class="lineno">820</span><span class="op" id="5502814">}</span>
</div>
</body>
</html>
