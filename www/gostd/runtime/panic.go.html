<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html" class="current">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1648210">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1648265">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1648319">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1648370">package</span>&nbsp;<span class="ident" id="1648378">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648387">import</span>&nbsp;<span class="string" id="1648394">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648404">var</span>&nbsp;<span class="ident" id="1648408">indexError</span>&nbsp;<span class="op" id="1648419">=</span>&nbsp;<span class="builtintype" id="1648421">error</span><span class="op" id="1648426">(</span><span class="ident" id="1648427">errorString</span><span class="op" id="1648438">(</span><span class="string" id="1648439">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1648459">)</span><span class="op" id="1648460">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1648463">func</span>&nbsp;<span class="ident" id="1648468">panicindex</span><span class="op" id="1648478">(</span><span class="op" id="1648479">)</span>&nbsp;<span class="op" id="1648481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1648484">panic</span><span class="op" id="1648489">(</span><span class="ident" id="1648490">indexError</span><span class="op" id="1648500">)</span><br>
<span class="lineno"></span><span class="op" id="1648502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1648505">var</span>&nbsp;<span class="ident" id="1648509">sliceError</span>&nbsp;<span class="op" id="1648520">=</span>&nbsp;<span class="builtintype" id="1648522">error</span><span class="op" id="1648527">(</span><span class="ident" id="1648528">errorString</span><span class="op" id="1648539">(</span><span class="string" id="1648540">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1648567">)</span><span class="op" id="1648568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648571">func</span>&nbsp;<span class="ident" id="1648576">panicslice</span><span class="op" id="1648586">(</span><span class="op" id="1648587">)</span>&nbsp;<span class="op" id="1648589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1648592">panic</span><span class="op" id="1648597">(</span><span class="ident" id="1648598">sliceError</span><span class="op" id="1648608">)</span><br>
<span class="lineno"></span><span class="op" id="1648610">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1648613">var</span>&nbsp;<span class="ident" id="1648617">divideError</span>&nbsp;<span class="op" id="1648629">=</span>&nbsp;<span class="builtintype" id="1648631">error</span><span class="op" id="1648636">(</span><span class="ident" id="1648637">errorString</span><span class="op" id="1648648">(</span><span class="string" id="1648649">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1648673">)</span><span class="op" id="1648674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648677">func</span>&nbsp;<span class="ident" id="1648682">panicdivide</span><span class="op" id="1648693">(</span><span class="op" id="1648694">)</span>&nbsp;<span class="op" id="1648696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1648699">panic</span><span class="op" id="1648704">(</span><span class="ident" id="1648705">divideError</span><span class="op" id="1648716">)</span><br>
<span class="lineno">25</span><span class="op" id="1648718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648721">var</span>&nbsp;<span class="ident" id="1648725">overflowError</span>&nbsp;<span class="op" id="1648739">=</span>&nbsp;<span class="builtintype" id="1648741">error</span><span class="op" id="1648746">(</span><span class="ident" id="1648747">errorString</span><span class="op" id="1648758">(</span><span class="string" id="1648759">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1648777">)</span><span class="op" id="1648778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648781">func</span>&nbsp;<span class="ident" id="1648786">panicoverflow</span><span class="op" id="1648799">(</span><span class="op" id="1648800">)</span>&nbsp;<span class="op" id="1648802">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1648805">panic</span><span class="op" id="1648810">(</span><span class="ident" id="1648811">overflowError</span><span class="op" id="1648824">)</span><br>
<span class="lineno"></span><span class="op" id="1648826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648829">var</span>&nbsp;<span class="ident" id="1648833">floatError</span>&nbsp;<span class="op" id="1648844">=</span>&nbsp;<span class="builtintype" id="1648846">error</span><span class="op" id="1648851">(</span><span class="ident" id="1648852">errorString</span><span class="op" id="1648863">(</span><span class="string" id="1648864">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1648886">)</span><span class="op" id="1648887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1648890">func</span>&nbsp;<span class="ident" id="1648895">panicfloat</span><span class="op" id="1648905">(</span><span class="op" id="1648906">)</span>&nbsp;<span class="op" id="1648908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1648911">panic</span><span class="op" id="1648916">(</span><span class="ident" id="1648917">floatError</span><span class="op" id="1648927">)</span><br>
<span class="lineno"></span><span class="op" id="1648929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648932">var</span>&nbsp;<span class="ident" id="1648936">memoryError</span>&nbsp;<span class="op" id="1648948">=</span>&nbsp;<span class="builtintype" id="1648950">error</span><span class="op" id="1648955">(</span><span class="ident" id="1648956">errorString</span><span class="op" id="1648967">(</span><span class="string" id="1648968">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1649019">)</span><span class="op" id="1649020">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1649023">func</span>&nbsp;<span class="ident" id="1649028">panicmem</span><span class="op" id="1649036">(</span><span class="op" id="1649037">)</span>&nbsp;<span class="op" id="1649039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649042">panic</span><span class="op" id="1649047">(</span><span class="ident" id="1649048">memoryError</span><span class="op" id="1649059">)</span><br>
<span class="lineno"></span><span class="op" id="1649061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1649064">func</span>&nbsp;<span class="ident" id="1649069">throwreturn</span><span class="op" id="1649080">(</span><span class="op" id="1649081">)</span>&nbsp;<span class="op" id="1649083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649086">gothrow</span><span class="op" id="1649093">(</span><span class="string" id="1649094">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1649153">)</span><br>
<span class="lineno"></span><span class="op" id="1649155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1649158">func</span>&nbsp;<span class="ident" id="1649163">throwinit</span><span class="op" id="1649172">(</span><span class="op" id="1649173">)</span>&nbsp;<span class="op" id="1649175">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649178">gothrow</span><span class="op" id="1649185">(</span><span class="string" id="1649186">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1649238">)</span><br>
<span class="lineno"></span><span class="op" id="1649240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1649243">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1649309">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1649370">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1649383">func</span>&nbsp;<span class="ident" id="1649388">deferproc</span><span class="op" id="1649397">(</span><span class="ident" id="1649398">siz</span>&nbsp;<span class="builtintype" id="1649402">int32</span><span class="op" id="1649407">,</span>&nbsp;<span class="ident" id="1649409">fn</span>&nbsp;<span class="op" id="1649412">*</span><span class="ident" id="1649413">funcval</span><span class="op" id="1649420">)</span>&nbsp;<span class="op" id="1649422">{</span>&nbsp;<span class="comment" id="1649424">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649454">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649518">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649585">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649653">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649720">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649759">argp</span>&nbsp;<span class="op" id="1649764">:=</span>&nbsp;<span class="builtintype" id="1649767">uintptr</span><span class="op" id="1649774">(</span><span class="ident" id="1649775">unsafe</span><span class="op" id="1649781">.</span><span class="ident" id="1649782">Pointer</span><span class="op" id="1649789">(</span><span class="op" id="1649790">&amp;</span><span class="ident" id="1649791">fn</span><span class="op" id="1649793">)</span><span class="op" id="1649794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649797">argp</span>&nbsp;<span class="op" id="1649802">+=</span>&nbsp;<span class="ident" id="1649805">unsafe</span><span class="op" id="1649811">.</span><span class="ident" id="1649812">Sizeof</span><span class="op" id="1649818">(</span><span class="ident" id="1649819">fn</span><span class="op" id="1649821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649824">if</span>&nbsp;<span class="ident" id="1649827">GOARCH</span>&nbsp;<span class="op" id="1649834">==</span>&nbsp;<span class="string" id="1649837">&#34;arm&#34;</span>&nbsp;<span class="op" id="1649843">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649847">argp</span>&nbsp;<span class="op" id="1649852">+=</span>&nbsp;<span class="ident" id="1649855">ptrSize</span>&nbsp;<span class="comment" id="1649863">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649904">mp</span>&nbsp;<span class="op" id="1649907">:=</span>&nbsp;<span class="ident" id="1649910">acquirem</span><span class="op" id="1649918">(</span><span class="op" id="1649919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649922">mp</span><span class="op" id="1649924">.</span><span class="ident" id="1649925">scalararg</span><span class="op" id="1649934">[</span><span class="num" id="1649935">0</span><span class="op" id="1649936">]</span>&nbsp;<span class="op" id="1649938">=</span>&nbsp;<span class="builtintype" id="1649940">uintptr</span><span class="op" id="1649947">(</span><span class="ident" id="1649948">siz</span><span class="op" id="1649951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649954">mp</span><span class="op" id="1649956">.</span><span class="ident" id="1649957">ptrarg</span><span class="op" id="1649963">[</span><span class="num" id="1649964">0</span><span class="op" id="1649965">]</span>&nbsp;<span class="op" id="1649967">=</span>&nbsp;<span class="ident" id="1649969">unsafe</span><span class="op" id="1649975">.</span><span class="ident" id="1649976">Pointer</span><span class="op" id="1649983">(</span><span class="ident" id="1649984">fn</span><span class="op" id="1649986">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649989">mp</span><span class="op" id="1649991">.</span><span class="ident" id="1649992">scalararg</span><span class="op" id="1650001">[</span><span class="num" id="1650002">1</span><span class="op" id="1650003">]</span>&nbsp;<span class="op" id="1650005">=</span>&nbsp;<span class="ident" id="1650007">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650013">mp</span><span class="op" id="1650015">.</span><span class="ident" id="1650016">scalararg</span><span class="op" id="1650025">[</span><span class="num" id="1650026">2</span><span class="op" id="1650027">]</span>&nbsp;<span class="op" id="1650029">=</span>&nbsp;<span class="ident" id="1650031">getcallerpc</span><span class="op" id="1650042">(</span><span class="ident" id="1650043">unsafe</span><span class="op" id="1650049">.</span><span class="ident" id="1650050">Pointer</span><span class="op" id="1650057">(</span><span class="op" id="1650058">&amp;</span><span class="ident" id="1650059">siz</span><span class="op" id="1650062">)</span><span class="op" id="1650063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650067">if</span>&nbsp;<span class="ident" id="1650070">mp</span><span class="op" id="1650072">.</span><span class="ident" id="1650073">curg</span>&nbsp;<span class="op" id="1650078">!=</span>&nbsp;<span class="ident" id="1650081">getg</span><span class="op" id="1650085">(</span><span class="op" id="1650086">)</span>&nbsp;<span class="op" id="1650088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650092">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650132">gothrow</span><span class="op" id="1650139">(</span><span class="string" id="1650140">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1650152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650159">onM</span><span class="op" id="1650162">(</span><span class="ident" id="1650163">deferproc_m</span><span class="op" id="1650174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650178">releasem</span><span class="op" id="1650186">(</span><span class="ident" id="1650187">mp</span><span class="op" id="1650189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650193">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650227">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650266">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650300">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650343">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650388">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650439">return0</span><span class="op" id="1650446">(</span><span class="op" id="1650447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650450">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650502">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1650541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1650544">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1650647">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1650703">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1650790">const</span>&nbsp;<span class="op" id="1650796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650799">deferHeaderSize</span>&nbsp;<span class="op" id="1650815">=</span>&nbsp;<span class="ident" id="1650817">unsafe</span><span class="op" id="1650823">.</span><span class="ident" id="1650824">Sizeof</span><span class="op" id="1650830">(</span><span class="ident" id="1650831">_defer</span><span class="op" id="1650837">{</span><span class="op" id="1650838">}</span><span class="op" id="1650839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650842">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1650858">=</span>&nbsp;<span class="op" id="1650860">(</span><span class="ident" id="1650861">deferHeaderSize</span>&nbsp;<span class="op" id="1650877">+</span>&nbsp;<span class="num" id="1650879">15</span><span class="op" id="1650881">)</span>&nbsp;<span class="op" id="1650883">&amp;^</span>&nbsp;<span class="num" id="1650886">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650890">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1650906">=</span>&nbsp;<span class="ident" id="1650908">minDeferAlloc</span>&nbsp;<span class="op" id="1650922">-</span>&nbsp;<span class="ident" id="1650924">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1650940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1650943">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1650979">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1650992">func</span>&nbsp;<span class="ident" id="1650997">deferclass</span><span class="op" id="1651007">(</span><span class="ident" id="1651008">siz</span>&nbsp;<span class="builtintype" id="1651012">uintptr</span><span class="op" id="1651019">)</span>&nbsp;<span class="builtintype" id="1651021">uintptr</span>&nbsp;<span class="op" id="1651029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651032">if</span>&nbsp;<span class="ident" id="1651035">siz</span>&nbsp;<span class="op" id="1651039">&lt;=</span>&nbsp;<span class="ident" id="1651042">minDeferArgs</span>&nbsp;<span class="op" id="1651055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651059">return</span>&nbsp;<span class="num" id="1651066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651072">return</span>&nbsp;<span class="op" id="1651079">(</span><span class="ident" id="1651080">siz</span>&nbsp;<span class="op" id="1651084">-</span>&nbsp;<span class="ident" id="1651086">minDeferArgs</span>&nbsp;<span class="op" id="1651099">+</span>&nbsp;<span class="num" id="1651101">15</span><span class="op" id="1651103">)</span>&nbsp;<span class="op" id="1651105">/</span>&nbsp;<span class="num" id="1651107">16</span><br>
<span class="lineno">110</span><span class="op" id="1651110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1651113">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1651170">func</span>&nbsp;<span class="ident" id="1651175">totaldefersize</span><span class="op" id="1651189">(</span><span class="ident" id="1651190">siz</span>&nbsp;<span class="builtintype" id="1651194">uintptr</span><span class="op" id="1651201">)</span>&nbsp;<span class="builtintype" id="1651203">uintptr</span>&nbsp;<span class="op" id="1651211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651214">if</span>&nbsp;<span class="ident" id="1651217">siz</span>&nbsp;<span class="op" id="1651221">&lt;=</span>&nbsp;<span class="ident" id="1651224">minDeferArgs</span>&nbsp;<span class="op" id="1651237">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651241">return</span>&nbsp;<span class="ident" id="1651248">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651266">return</span>&nbsp;<span class="ident" id="1651273">deferHeaderSize</span>&nbsp;<span class="op" id="1651289">+</span>&nbsp;<span class="ident" id="1651291">siz</span><br>
<span class="lineno"></span><span class="op" id="1651295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1651298">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1651367">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1651410">func</span>&nbsp;<span class="ident" id="1651415">testdefersizes</span><span class="op" id="1651429">(</span><span class="op" id="1651430">)</span>&nbsp;<span class="op" id="1651432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651435">var</span>&nbsp;<span class="ident" id="1651439">m</span>&nbsp;<span class="op" id="1651441">[</span><span class="builtinfunc" id="1651442">len</span><span class="op" id="1651445">(</span><span class="ident" id="1651446">p</span><span class="op" id="1651447">{</span><span class="op" id="1651448">}</span><span class="op" id="1651449">.</span><span class="ident" id="1651450">deferpool</span><span class="op" id="1651459">)</span><span class="op" id="1651460">]</span><span class="builtintype" id="1651461">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651469">for</span>&nbsp;<span class="ident" id="1651473">i</span>&nbsp;<span class="op" id="1651475">:=</span>&nbsp;<span class="keyword" id="1651478">range</span>&nbsp;<span class="ident" id="1651484">m</span>&nbsp;<span class="op" id="1651486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651490">m</span><span class="op" id="1651491">[</span><span class="ident" id="1651492">i</span><span class="op" id="1651493">]</span>&nbsp;<span class="op" id="1651495">=</span>&nbsp;<span class="op" id="1651497">-</span><span class="num" id="1651498">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651504">for</span>&nbsp;<span class="ident" id="1651508">i</span>&nbsp;<span class="op" id="1651510">:=</span>&nbsp;<span class="builtintype" id="1651513">uintptr</span><span class="op" id="1651520">(</span><span class="num" id="1651521">0</span><span class="op" id="1651522">)</span><span class="op" id="1651523">;</span>&nbsp;<span class="op" id="1651525">;</span>&nbsp;<span class="ident" id="1651527">i</span><span class="op" id="1651528">++</span>&nbsp;<span class="op" id="1651531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651535">defersc</span>&nbsp;<span class="op" id="1651543">:=</span>&nbsp;<span class="ident" id="1651546">deferclass</span><span class="op" id="1651556">(</span><span class="ident" id="1651557">i</span><span class="op" id="1651558">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651562">if</span>&nbsp;<span class="ident" id="1651565">defersc</span>&nbsp;<span class="op" id="1651573">&gt;=</span>&nbsp;<span class="builtintype" id="1651576">uintptr</span><span class="op" id="1651583">(</span><span class="builtinfunc" id="1651584">len</span><span class="op" id="1651587">(</span><span class="ident" id="1651588">m</span><span class="op" id="1651589">)</span><span class="op" id="1651590">)</span>&nbsp;<span class="op" id="1651592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651597">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651609">siz</span>&nbsp;<span class="op" id="1651613">:=</span>&nbsp;<span class="ident" id="1651616">goroundupsize</span><span class="op" id="1651629">(</span><span class="ident" id="1651630">totaldefersize</span><span class="op" id="1651644">(</span><span class="ident" id="1651645">i</span><span class="op" id="1651646">)</span><span class="op" id="1651647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651651">if</span>&nbsp;<span class="ident" id="1651654">m</span><span class="op" id="1651655">[</span><span class="ident" id="1651656">defersc</span><span class="op" id="1651663">]</span>&nbsp;<span class="op" id="1651665">&lt;</span>&nbsp;<span class="num" id="1651667">0</span>&nbsp;<span class="op" id="1651669">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651674">m</span><span class="op" id="1651675">[</span><span class="ident" id="1651676">defersc</span><span class="op" id="1651683">]</span>&nbsp;<span class="op" id="1651685">=</span>&nbsp;<span class="builtintype" id="1651687">int32</span><span class="op" id="1651692">(</span><span class="ident" id="1651693">siz</span><span class="op" id="1651696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651701">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651716">if</span>&nbsp;<span class="ident" id="1651719">m</span><span class="op" id="1651720">[</span><span class="ident" id="1651721">defersc</span><span class="op" id="1651728">]</span>&nbsp;<span class="op" id="1651730">!=</span>&nbsp;<span class="builtintype" id="1651733">int32</span><span class="op" id="1651738">(</span><span class="ident" id="1651739">siz</span><span class="op" id="1651742">)</span>&nbsp;<span class="op" id="1651744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1651749">print</span><span class="op" id="1651754">(</span><span class="string" id="1651755">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1651781">,</span>&nbsp;<span class="ident" id="1651783">i</span><span class="op" id="1651784">,</span>&nbsp;<span class="string" id="1651786">&#34;&nbsp;siz=&#34;</span><span class="op" id="1651793">,</span>&nbsp;<span class="ident" id="1651795">siz</span><span class="op" id="1651798">,</span>&nbsp;<span class="string" id="1651800">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1651811">,</span>&nbsp;<span class="ident" id="1651813">defersc</span><span class="op" id="1651820">,</span>&nbsp;<span class="string" id="1651822">&#34;\n&#34;</span><span class="op" id="1651826">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651831">gothrow</span><span class="op" id="1651838">(</span><span class="string" id="1651839">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1651861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651868">}</span><br>
<span class="lineno"></span><span class="op" id="1651870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1651873">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1651933">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1651983">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1651996">func</span>&nbsp;<span class="ident" id="1652001">deferArgs</span><span class="op" id="1652010">(</span><span class="ident" id="1652011">d</span>&nbsp;<span class="op" id="1652013">*</span><span class="ident" id="1652014">_defer</span><span class="op" id="1652020">)</span>&nbsp;<span class="ident" id="1652022">unsafe</span><span class="op" id="1652028">.</span><span class="ident" id="1652029">Pointer</span>&nbsp;<span class="op" id="1652037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652040">return</span>&nbsp;<span class="ident" id="1652047">add</span><span class="op" id="1652050">(</span><span class="ident" id="1652051">unsafe</span><span class="op" id="1652057">.</span><span class="ident" id="1652058">Pointer</span><span class="op" id="1652065">(</span><span class="ident" id="1652066">d</span><span class="op" id="1652067">)</span><span class="op" id="1652068">,</span>&nbsp;<span class="ident" id="1652070">unsafe</span><span class="op" id="1652076">.</span><span class="ident" id="1652077">Sizeof</span><span class="op" id="1652083">(</span><span class="op" id="1652084">*</span><span class="ident" id="1652085">d</span><span class="op" id="1652086">)</span><span class="op" id="1652087">)</span><br>
<span class="lineno">150</span><span class="op" id="1652089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1652092">var</span>&nbsp;<span class="ident" id="1652096">deferType</span>&nbsp;<span class="op" id="1652106">*</span><span class="ident" id="1652107">_type</span>&nbsp;<span class="comment" id="1652113">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1652139">func</span>&nbsp;<span class="ident" id="1652144">init</span><span class="op" id="1652148">(</span><span class="op" id="1652149">)</span>&nbsp;<span class="op" id="1652151">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652154">var</span>&nbsp;<span class="ident" id="1652158">x</span>&nbsp;<span class="keyword" id="1652160">interface</span><span class="op" id="1652169">{</span><span class="op" id="1652170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652173">x</span>&nbsp;<span class="op" id="1652175">=</span>&nbsp;<span class="op" id="1652177">(</span><span class="op" id="1652178">*</span><span class="ident" id="1652179">_defer</span><span class="op" id="1652185">)</span><span class="op" id="1652186">(</span><span class="ident" id="1652187">nil</span><span class="op" id="1652190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652193">deferType</span>&nbsp;<span class="op" id="1652203">=</span>&nbsp;<span class="op" id="1652205">(</span><span class="op" id="1652206">*</span><span class="op" id="1652207">(</span><span class="op" id="1652208">*</span><span class="op" id="1652209">*</span><span class="ident" id="1652210">ptrtype</span><span class="op" id="1652217">)</span><span class="op" id="1652218">(</span><span class="ident" id="1652219">unsafe</span><span class="op" id="1652225">.</span><span class="ident" id="1652226">Pointer</span><span class="op" id="1652233">(</span><span class="op" id="1652234">&amp;</span><span class="ident" id="1652235">x</span><span class="op" id="1652236">)</span><span class="op" id="1652237">)</span><span class="op" id="1652238">)</span><span class="op" id="1652239">.</span><span class="ident" id="1652240">elem</span><br>
<span class="lineno"></span><span class="op" id="1652245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1652248">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1652295">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1652342">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1652367">func</span>&nbsp;<span class="ident" id="1652372">newdefer</span><span class="op" id="1652380">(</span><span class="ident" id="1652381">siz</span>&nbsp;<span class="builtintype" id="1652385">int32</span><span class="op" id="1652390">)</span>&nbsp;<span class="op" id="1652392">*</span><span class="ident" id="1652393">_defer</span>&nbsp;<span class="op" id="1652400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652403">var</span>&nbsp;<span class="ident" id="1652407">d</span>&nbsp;<span class="op" id="1652409">*</span><span class="ident" id="1652410">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652418">sc</span>&nbsp;<span class="op" id="1652421">:=</span>&nbsp;<span class="ident" id="1652424">deferclass</span><span class="op" id="1652434">(</span><span class="builtintype" id="1652435">uintptr</span><span class="op" id="1652442">(</span><span class="ident" id="1652443">siz</span><span class="op" id="1652446">)</span><span class="op" id="1652447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652450">mp</span>&nbsp;<span class="op" id="1652453">:=</span>&nbsp;<span class="ident" id="1652456">acquirem</span><span class="op" id="1652464">(</span><span class="op" id="1652465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652468">if</span>&nbsp;<span class="ident" id="1652471">sc</span>&nbsp;<span class="op" id="1652474">&lt;</span>&nbsp;<span class="builtintype" id="1652476">uintptr</span><span class="op" id="1652483">(</span><span class="builtinfunc" id="1652484">len</span><span class="op" id="1652487">(</span><span class="ident" id="1652488">p</span><span class="op" id="1652489">{</span><span class="op" id="1652490">}</span><span class="op" id="1652491">.</span><span class="ident" id="1652492">deferpool</span><span class="op" id="1652501">)</span><span class="op" id="1652502">)</span>&nbsp;<span class="op" id="1652504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652508">pp</span>&nbsp;<span class="op" id="1652511">:=</span>&nbsp;<span class="ident" id="1652514">mp</span><span class="op" id="1652516">.</span><span class="ident" id="1652517">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652521">d</span>&nbsp;<span class="op" id="1652523">=</span>&nbsp;<span class="ident" id="1652525">pp</span><span class="op" id="1652527">.</span><span class="ident" id="1652528">deferpool</span><span class="op" id="1652537">[</span><span class="ident" id="1652538">sc</span><span class="op" id="1652540">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652544">if</span>&nbsp;<span class="ident" id="1652547">d</span>&nbsp;<span class="op" id="1652549">!=</span>&nbsp;<span class="ident" id="1652552">nil</span>&nbsp;<span class="op" id="1652556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652561">pp</span><span class="op" id="1652563">.</span><span class="ident" id="1652564">deferpool</span><span class="op" id="1652573">[</span><span class="ident" id="1652574">sc</span><span class="op" id="1652576">]</span>&nbsp;<span class="op" id="1652578">=</span>&nbsp;<span class="ident" id="1652580">d</span><span class="op" id="1652581">.</span><span class="ident" id="1652582">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652595">if</span>&nbsp;<span class="ident" id="1652598">d</span>&nbsp;<span class="op" id="1652600">==</span>&nbsp;<span class="ident" id="1652603">nil</span>&nbsp;<span class="op" id="1652607">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652611">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652641">total</span>&nbsp;<span class="op" id="1652647">:=</span>&nbsp;<span class="ident" id="1652650">goroundupsize</span><span class="op" id="1652663">(</span><span class="ident" id="1652664">totaldefersize</span><span class="op" id="1652678">(</span><span class="builtintype" id="1652679">uintptr</span><span class="op" id="1652686">(</span><span class="ident" id="1652687">siz</span><span class="op" id="1652690">)</span><span class="op" id="1652691">)</span><span class="op" id="1652692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652696">d</span>&nbsp;<span class="op" id="1652698">=</span>&nbsp;<span class="op" id="1652700">(</span><span class="op" id="1652701">*</span><span class="ident" id="1652702">_defer</span><span class="op" id="1652708">)</span><span class="op" id="1652709">(</span><span class="ident" id="1652710">mallocgc</span><span class="op" id="1652718">(</span><span class="ident" id="1652719">total</span><span class="op" id="1652724">,</span>&nbsp;<span class="ident" id="1652726">deferType</span><span class="op" id="1652735">,</span>&nbsp;<span class="num" id="1652737">0</span><span class="op" id="1652738">)</span><span class="op" id="1652739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652745">d</span><span class="op" id="1652746">.</span><span class="ident" id="1652747">siz</span>&nbsp;<span class="op" id="1652751">=</span>&nbsp;<span class="ident" id="1652753">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652758">gp</span>&nbsp;<span class="op" id="1652761">:=</span>&nbsp;<span class="ident" id="1652764">mp</span><span class="op" id="1652766">.</span><span class="ident" id="1652767">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652773">d</span><span class="op" id="1652774">.</span><span class="ident" id="1652775">link</span>&nbsp;<span class="op" id="1652780">=</span>&nbsp;<span class="ident" id="1652782">gp</span><span class="op" id="1652784">.</span><span class="ident" id="1652785">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652793">gp</span><span class="op" id="1652795">.</span><span class="ident" id="1652796">_defer</span>&nbsp;<span class="op" id="1652803">=</span>&nbsp;<span class="ident" id="1652805">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652808">releasem</span><span class="op" id="1652816">(</span><span class="ident" id="1652817">mp</span><span class="op" id="1652819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652822">return</span>&nbsp;<span class="ident" id="1652829">d</span><br>
<span class="lineno">185</span><span class="op" id="1652831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1652834">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1652859">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1652904">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1652917">func</span>&nbsp;<span class="ident" id="1652922">freedefer</span><span class="op" id="1652931">(</span><span class="ident" id="1652932">d</span>&nbsp;<span class="op" id="1652934">*</span><span class="ident" id="1652935">_defer</span><span class="op" id="1652941">)</span>&nbsp;<span class="op" id="1652943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652946">if</span>&nbsp;<span class="ident" id="1652949">d</span><span class="op" id="1652950">.</span><span class="ident" id="1652951">_panic</span>&nbsp;<span class="op" id="1652958">!=</span>&nbsp;<span class="ident" id="1652961">nil</span>&nbsp;<span class="op" id="1652965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652969">freedeferpanic</span><span class="op" id="1652983">(</span><span class="op" id="1652984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652990">if</span>&nbsp;<span class="ident" id="1652993">d</span><span class="op" id="1652994">.</span><span class="ident" id="1652995">fn</span>&nbsp;<span class="op" id="1652998">!=</span>&nbsp;<span class="ident" id="1653001">nil</span>&nbsp;<span class="op" id="1653005">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653009">freedeferfn</span><span class="op" id="1653020">(</span><span class="op" id="1653021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1653024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653027">sc</span>&nbsp;<span class="op" id="1653030">:=</span>&nbsp;<span class="ident" id="1653033">deferclass</span><span class="op" id="1653043">(</span><span class="builtintype" id="1653044">uintptr</span><span class="op" id="1653051">(</span><span class="ident" id="1653052">d</span><span class="op" id="1653053">.</span><span class="ident" id="1653054">siz</span><span class="op" id="1653057">)</span><span class="op" id="1653058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1653061">if</span>&nbsp;<span class="ident" id="1653064">sc</span>&nbsp;<span class="op" id="1653067">&lt;</span>&nbsp;<span class="builtintype" id="1653069">uintptr</span><span class="op" id="1653076">(</span><span class="builtinfunc" id="1653077">len</span><span class="op" id="1653080">(</span><span class="ident" id="1653081">p</span><span class="op" id="1653082">{</span><span class="op" id="1653083">}</span><span class="op" id="1653084">.</span><span class="ident" id="1653085">deferpool</span><span class="op" id="1653094">)</span><span class="op" id="1653095">)</span>&nbsp;<span class="op" id="1653097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653101">mp</span>&nbsp;<span class="op" id="1653104">:=</span>&nbsp;<span class="ident" id="1653107">acquirem</span><span class="op" id="1653115">(</span><span class="op" id="1653116">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653120">pp</span>&nbsp;<span class="op" id="1653123">:=</span>&nbsp;<span class="ident" id="1653126">mp</span><span class="op" id="1653128">.</span><span class="ident" id="1653129">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1653133">*</span><span class="ident" id="1653134">d</span>&nbsp;<span class="op" id="1653136">=</span>&nbsp;<span class="ident" id="1653138">_defer</span><span class="op" id="1653144">{</span><span class="op" id="1653145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653149">d</span><span class="op" id="1653150">.</span><span class="ident" id="1653151">link</span>&nbsp;<span class="op" id="1653156">=</span>&nbsp;<span class="ident" id="1653158">pp</span><span class="op" id="1653160">.</span><span class="ident" id="1653161">deferpool</span><span class="op" id="1653170">[</span><span class="ident" id="1653171">sc</span><span class="op" id="1653173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653177">pp</span><span class="op" id="1653179">.</span><span class="ident" id="1653180">deferpool</span><span class="op" id="1653189">[</span><span class="ident" id="1653190">sc</span><span class="op" id="1653192">]</span>&nbsp;<span class="op" id="1653194">=</span>&nbsp;<span class="ident" id="1653196">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653200">releasem</span><span class="op" id="1653208">(</span><span class="ident" id="1653209">mp</span><span class="op" id="1653211">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1653214">}</span><br>
<span class="lineno"></span><span class="op" id="1653216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1653219">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1653268">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1653314">func</span>&nbsp;<span class="ident" id="1653319">freedeferpanic</span><span class="op" id="1653333">(</span><span class="op" id="1653334">)</span>&nbsp;<span class="op" id="1653336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653339">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653396">gothrow</span><span class="op" id="1653403">(</span><span class="string" id="1653404">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1653436">)</span><br>
<span class="lineno"></span><span class="op" id="1653438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1653441">func</span>&nbsp;<span class="ident" id="1653446">freedeferfn</span><span class="op" id="1653457">(</span><span class="op" id="1653458">)</span>&nbsp;<span class="op" id="1653460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653463">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653516">gothrow</span><span class="op" id="1653523">(</span><span class="string" id="1653524">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1653552">)</span><br>
<span class="lineno"></span><span class="op" id="1653554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1653557">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1653601">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1653658">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1653689">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtime·jmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1653759">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1653824">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1653889">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1653960">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1654033">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1654098">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1654130">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1654199">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1654253">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1654266">func</span>&nbsp;<span class="ident" id="1654271">deferreturn</span><span class="op" id="1654282">(</span><span class="ident" id="1654283">arg0</span>&nbsp;<span class="builtintype" id="1654288">uintptr</span><span class="op" id="1654295">)</span>&nbsp;<span class="op" id="1654297">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654300">gp</span>&nbsp;<span class="op" id="1654303">:=</span>&nbsp;<span class="ident" id="1654306">getg</span><span class="op" id="1654310">(</span><span class="op" id="1654311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654314">d</span>&nbsp;<span class="op" id="1654316">:=</span>&nbsp;<span class="ident" id="1654319">gp</span><span class="op" id="1654321">.</span><span class="ident" id="1654322">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1654330">if</span>&nbsp;<span class="ident" id="1654333">d</span>&nbsp;<span class="op" id="1654335">==</span>&nbsp;<span class="ident" id="1654338">nil</span>&nbsp;<span class="op" id="1654342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1654346">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654354">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654357">argp</span>&nbsp;<span class="op" id="1654362">:=</span>&nbsp;<span class="builtintype" id="1654365">uintptr</span><span class="op" id="1654372">(</span><span class="ident" id="1654373">unsafe</span><span class="op" id="1654379">.</span><span class="ident" id="1654380">Pointer</span><span class="op" id="1654387">(</span><span class="op" id="1654388">&amp;</span><span class="ident" id="1654389">arg0</span><span class="op" id="1654393">)</span><span class="op" id="1654394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1654397">if</span>&nbsp;<span class="ident" id="1654400">d</span><span class="op" id="1654401">.</span><span class="ident" id="1654402">argp</span>&nbsp;<span class="op" id="1654407">!=</span>&nbsp;<span class="ident" id="1654410">argp</span>&nbsp;<span class="op" id="1654415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1654419">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1654431">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1654460">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1654524">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1654588">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654616">mp</span>&nbsp;<span class="op" id="1654619">:=</span>&nbsp;<span class="ident" id="1654622">acquirem</span><span class="op" id="1654630">(</span><span class="op" id="1654631">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654634">memmove</span><span class="op" id="1654641">(</span><span class="ident" id="1654642">unsafe</span><span class="op" id="1654648">.</span><span class="ident" id="1654649">Pointer</span><span class="op" id="1654656">(</span><span class="ident" id="1654657">argp</span><span class="op" id="1654661">)</span><span class="op" id="1654662">,</span>&nbsp;<span class="ident" id="1654664">deferArgs</span><span class="op" id="1654673">(</span><span class="ident" id="1654674">d</span><span class="op" id="1654675">)</span><span class="op" id="1654676">,</span>&nbsp;<span class="builtintype" id="1654678">uintptr</span><span class="op" id="1654685">(</span><span class="ident" id="1654686">d</span><span class="op" id="1654687">.</span><span class="ident" id="1654688">siz</span><span class="op" id="1654691">)</span><span class="op" id="1654692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654695">fn</span>&nbsp;<span class="op" id="1654698">:=</span>&nbsp;<span class="ident" id="1654701">d</span><span class="op" id="1654702">.</span><span class="ident" id="1654703">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654707">d</span><span class="op" id="1654708">.</span><span class="ident" id="1654709">fn</span>&nbsp;<span class="op" id="1654712">=</span>&nbsp;<span class="ident" id="1654714">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654719">gp</span><span class="op" id="1654721">.</span><span class="ident" id="1654722">_defer</span>&nbsp;<span class="op" id="1654729">=</span>&nbsp;<span class="ident" id="1654731">d</span><span class="op" id="1654732">.</span><span class="ident" id="1654733">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654739">freedefer</span><span class="op" id="1654748">(</span><span class="ident" id="1654749">d</span><span class="op" id="1654750">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654753">releasem</span><span class="op" id="1654761">(</span><span class="ident" id="1654762">mp</span><span class="op" id="1654764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654767">jmpdefer</span><span class="op" id="1654775">(</span><span class="ident" id="1654776">fn</span><span class="op" id="1654778">,</span>&nbsp;<span class="ident" id="1654780">argp</span><span class="op" id="1654784">)</span><br>
<span class="lineno"></span><span class="op" id="1654786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1654789">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1654872">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1654956">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1655045">//</span><br>
<span class="lineno"></span><span class="comment" id="1655048">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1655116">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1655182">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1655238">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1655292">func</span>&nbsp;<span class="ident" id="1655297">Goexit</span><span class="op" id="1655303">(</span><span class="op" id="1655304">)</span>&nbsp;<span class="op" id="1655306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1655309">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1655367">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1655428">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655455">gp</span>&nbsp;<span class="op" id="1655458">:=</span>&nbsp;<span class="ident" id="1655461">getg</span><span class="op" id="1655465">(</span><span class="op" id="1655466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655469">for</span>&nbsp;<span class="op" id="1655473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655477">d</span>&nbsp;<span class="op" id="1655479">:=</span>&nbsp;<span class="ident" id="1655482">gp</span><span class="op" id="1655484">.</span><span class="ident" id="1655485">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655494">if</span>&nbsp;<span class="ident" id="1655497">d</span>&nbsp;<span class="op" id="1655499">==</span>&nbsp;<span class="ident" id="1655502">nil</span>&nbsp;<span class="op" id="1655506">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655511">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1655519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655523">if</span>&nbsp;<span class="ident" id="1655526">d</span><span class="op" id="1655527">.</span><span class="ident" id="1655528">started</span>&nbsp;<span class="op" id="1655536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655541">if</span>&nbsp;<span class="ident" id="1655544">d</span><span class="op" id="1655545">.</span><span class="ident" id="1655546">_panic</span>&nbsp;<span class="op" id="1655553">!=</span>&nbsp;<span class="ident" id="1655556">nil</span>&nbsp;<span class="op" id="1655560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655566">d</span><span class="op" id="1655567">.</span><span class="ident" id="1655568">_panic</span><span class="op" id="1655574">.</span><span class="ident" id="1655575">aborted</span>&nbsp;<span class="op" id="1655583">=</span>&nbsp;<span class="builtintype" id="1655585">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655594">d</span><span class="op" id="1655595">.</span><span class="ident" id="1655596">_panic</span>&nbsp;<span class="op" id="1655603">=</span>&nbsp;<span class="ident" id="1655605">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1655612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655617">d</span><span class="op" id="1655618">.</span><span class="ident" id="1655619">fn</span>&nbsp;<span class="op" id="1655622">=</span>&nbsp;<span class="ident" id="1655624">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655631">gp</span><span class="op" id="1655633">.</span><span class="ident" id="1655634">_defer</span>&nbsp;<span class="op" id="1655641">=</span>&nbsp;<span class="ident" id="1655643">d</span><span class="op" id="1655644">.</span><span class="ident" id="1655645">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655653">freedefer</span><span class="op" id="1655662">(</span><span class="ident" id="1655663">d</span><span class="op" id="1655664">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655669">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1655680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655684">d</span><span class="op" id="1655685">.</span><span class="ident" id="1655686">started</span>&nbsp;<span class="op" id="1655694">=</span>&nbsp;<span class="builtintype" id="1655696">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655703">reflectcall</span><span class="op" id="1655714">(</span><span class="ident" id="1655715">unsafe</span><span class="op" id="1655721">.</span><span class="ident" id="1655722">Pointer</span><span class="op" id="1655729">(</span><span class="ident" id="1655730">d</span><span class="op" id="1655731">.</span><span class="ident" id="1655732">fn</span><span class="op" id="1655734">)</span><span class="op" id="1655735">,</span>&nbsp;<span class="ident" id="1655737">deferArgs</span><span class="op" id="1655746">(</span><span class="ident" id="1655747">d</span><span class="op" id="1655748">)</span><span class="op" id="1655749">,</span>&nbsp;<span class="builtintype" id="1655751">uint32</span><span class="op" id="1655757">(</span><span class="ident" id="1655758">d</span><span class="op" id="1655759">.</span><span class="ident" id="1655760">siz</span><span class="op" id="1655763">)</span><span class="op" id="1655764">,</span>&nbsp;<span class="builtintype" id="1655766">uint32</span><span class="op" id="1655772">(</span><span class="ident" id="1655773">d</span><span class="op" id="1655774">.</span><span class="ident" id="1655775">siz</span><span class="op" id="1655778">)</span><span class="op" id="1655779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1655783">if</span>&nbsp;<span class="ident" id="1655786">gp</span><span class="op" id="1655788">.</span><span class="ident" id="1655789">_defer</span>&nbsp;<span class="op" id="1655796">!=</span>&nbsp;<span class="ident" id="1655799">d</span>&nbsp;<span class="op" id="1655801">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655806">gothrow</span><span class="op" id="1655813">(</span><span class="string" id="1655814">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1655841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1655845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655849">d</span><span class="op" id="1655850">.</span><span class="ident" id="1655851">_panic</span>&nbsp;<span class="op" id="1655858">=</span>&nbsp;<span class="ident" id="1655860">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655866">d</span><span class="op" id="1655867">.</span><span class="ident" id="1655868">fn</span>&nbsp;<span class="op" id="1655871">=</span>&nbsp;<span class="ident" id="1655873">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655879">gp</span><span class="op" id="1655881">.</span><span class="ident" id="1655882">_defer</span>&nbsp;<span class="op" id="1655889">=</span>&nbsp;<span class="ident" id="1655891">d</span><span class="op" id="1655892">.</span><span class="ident" id="1655893">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655900">freedefer</span><span class="op" id="1655909">(</span><span class="ident" id="1655910">d</span><span class="op" id="1655911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1655915">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1655978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655981">goexit</span><span class="op" id="1655987">(</span><span class="op" id="1655988">)</span><br>
<span class="lineno"></span><span class="op" id="1655990">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1655993">func</span>&nbsp;<span class="ident" id="1655998">canpanic</span><span class="op" id="1656006">(</span><span class="op" id="1656007">*</span><span class="ident" id="1656008">g</span><span class="op" id="1656009">)</span>&nbsp;<span class="builtintype" id="1656011">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1656017">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1656076">func</span>&nbsp;<span class="ident" id="1656081">printpanics</span><span class="op" id="1656092">(</span><span class="ident" id="1656093">p</span>&nbsp;<span class="op" id="1656095">*</span><span class="ident" id="1656096">_panic</span><span class="op" id="1656102">)</span>&nbsp;<span class="op" id="1656104">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656107">if</span>&nbsp;<span class="ident" id="1656110">p</span><span class="op" id="1656111">.</span><span class="ident" id="1656112">link</span>&nbsp;<span class="op" id="1656117">!=</span>&nbsp;<span class="ident" id="1656120">nil</span>&nbsp;<span class="op" id="1656124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656128">printpanics</span><span class="op" id="1656139">(</span><span class="ident" id="1656140">p</span><span class="op" id="1656141">.</span><span class="ident" id="1656142">link</span><span class="op" id="1656146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656150">print</span><span class="op" id="1656155">(</span><span class="string" id="1656156">&#34;\t&#34;</span><span class="op" id="1656160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656166">print</span><span class="op" id="1656171">(</span><span class="string" id="1656172">&#34;panic:&nbsp;&#34;</span><span class="op" id="1656181">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656184">printany</span><span class="op" id="1656192">(</span><span class="ident" id="1656193">p</span><span class="op" id="1656194">.</span><span class="ident" id="1656195">arg</span><span class="op" id="1656198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656201">if</span>&nbsp;<span class="ident" id="1656204">p</span><span class="op" id="1656205">.</span><span class="ident" id="1656206">recovered</span>&nbsp;<span class="op" id="1656216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656220">print</span><span class="op" id="1656225">(</span><span class="string" id="1656226">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1656240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656246">print</span><span class="op" id="1656251">(</span><span class="string" id="1656252">&#34;\n&#34;</span><span class="op" id="1656256">)</span><br>
<span class="lineno">315</span><span class="op" id="1656258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1656261">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1656318">func</span>&nbsp;<span class="ident" id="1656323">gopanic</span><span class="op" id="1656330">(</span><span class="ident" id="1656331">e</span>&nbsp;<span class="keyword" id="1656333">interface</span><span class="op" id="1656342">{</span><span class="op" id="1656343">}</span><span class="op" id="1656344">)</span>&nbsp;<span class="op" id="1656346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656349">gp</span>&nbsp;<span class="op" id="1656352">:=</span>&nbsp;<span class="ident" id="1656355">getg</span><span class="op" id="1656359">(</span><span class="op" id="1656360">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656363">if</span>&nbsp;<span class="ident" id="1656366">gp</span><span class="op" id="1656368">.</span><span class="ident" id="1656369">m</span><span class="op" id="1656370">.</span><span class="ident" id="1656371">curg</span>&nbsp;<span class="op" id="1656376">!=</span>&nbsp;<span class="ident" id="1656379">gp</span>&nbsp;<span class="op" id="1656382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656386">gothrow</span><span class="op" id="1656393">(</span><span class="string" id="1656394">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1656412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656419">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656474">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656521">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656578">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656618">if</span>&nbsp;<span class="ident" id="1656621">gp</span><span class="op" id="1656623">.</span><span class="ident" id="1656624">m</span><span class="op" id="1656625">.</span><span class="ident" id="1656626">softfloat</span>&nbsp;<span class="op" id="1656636">!=</span>&nbsp;<span class="num" id="1656639">0</span>&nbsp;<span class="op" id="1656641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656645">gp</span><span class="op" id="1656647">.</span><span class="ident" id="1656648">m</span><span class="op" id="1656649">.</span><span class="ident" id="1656650">locks</span><span class="op" id="1656655">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656660">gp</span><span class="op" id="1656662">.</span><span class="ident" id="1656663">m</span><span class="op" id="1656664">.</span><span class="ident" id="1656665">softfloat</span>&nbsp;<span class="op" id="1656675">=</span>&nbsp;<span class="num" id="1656677">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656681">gothrow</span><span class="op" id="1656688">(</span><span class="string" id="1656689">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1656713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656719">if</span>&nbsp;<span class="ident" id="1656722">gp</span><span class="op" id="1656724">.</span><span class="ident" id="1656725">m</span><span class="op" id="1656726">.</span><span class="ident" id="1656727">mallocing</span>&nbsp;<span class="op" id="1656737">!=</span>&nbsp;<span class="num" id="1656740">0</span>&nbsp;<span class="op" id="1656742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656746">print</span><span class="op" id="1656751">(</span><span class="string" id="1656752">&#34;panic:&nbsp;&#34;</span><span class="op" id="1656761">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656765">printany</span><span class="op" id="1656773">(</span><span class="ident" id="1656774">e</span><span class="op" id="1656775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656779">print</span><span class="op" id="1656784">(</span><span class="string" id="1656785">&#34;\n&#34;</span><span class="op" id="1656789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656793">gothrow</span><span class="op" id="1656800">(</span><span class="string" id="1656801">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1656822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656828">if</span>&nbsp;<span class="ident" id="1656831">gp</span><span class="op" id="1656833">.</span><span class="ident" id="1656834">m</span><span class="op" id="1656835">.</span><span class="ident" id="1656836">gcing</span>&nbsp;<span class="op" id="1656842">!=</span>&nbsp;<span class="num" id="1656845">0</span>&nbsp;<span class="op" id="1656847">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656851">print</span><span class="op" id="1656856">(</span><span class="string" id="1656857">&#34;panic:&nbsp;&#34;</span><span class="op" id="1656866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656870">printany</span><span class="op" id="1656878">(</span><span class="ident" id="1656879">e</span><span class="op" id="1656880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656884">print</span><span class="op" id="1656889">(</span><span class="string" id="1656890">&#34;\n&#34;</span><span class="op" id="1656894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656898">gothrow</span><span class="op" id="1656905">(</span><span class="string" id="1656906">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1656923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656926">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656929">if</span>&nbsp;<span class="ident" id="1656932">gp</span><span class="op" id="1656934">.</span><span class="ident" id="1656935">m</span><span class="op" id="1656936">.</span><span class="ident" id="1656937">locks</span>&nbsp;<span class="op" id="1656943">!=</span>&nbsp;<span class="num" id="1656946">0</span>&nbsp;<span class="op" id="1656948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656952">print</span><span class="op" id="1656957">(</span><span class="string" id="1656958">&#34;panic:&nbsp;&#34;</span><span class="op" id="1656967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656971">printany</span><span class="op" id="1656979">(</span><span class="ident" id="1656980">e</span><span class="op" id="1656981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1656985">print</span><span class="op" id="1656990">(</span><span class="string" id="1656991">&#34;\n&#34;</span><span class="op" id="1656995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656999">gothrow</span><span class="op" id="1657006">(</span><span class="string" id="1657007">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1657028">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657035">var</span>&nbsp;<span class="ident" id="1657039">p</span>&nbsp;<span class="ident" id="1657041">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657049">p</span><span class="op" id="1657050">.</span><span class="ident" id="1657051">arg</span>&nbsp;<span class="op" id="1657055">=</span>&nbsp;<span class="ident" id="1657057">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657060">p</span><span class="op" id="1657061">.</span><span class="ident" id="1657062">link</span>&nbsp;<span class="op" id="1657067">=</span>&nbsp;<span class="ident" id="1657069">gp</span><span class="op" id="1657071">.</span><span class="ident" id="1657072">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657080">gp</span><span class="op" id="1657082">.</span><span class="ident" id="1657083">_panic</span>&nbsp;<span class="op" id="1657090">=</span>&nbsp;<span class="op" id="1657092">(</span><span class="op" id="1657093">*</span><span class="ident" id="1657094">_panic</span><span class="op" id="1657100">)</span><span class="op" id="1657101">(</span><span class="ident" id="1657102">noescape</span><span class="op" id="1657110">(</span><span class="ident" id="1657111">unsafe</span><span class="op" id="1657117">.</span><span class="ident" id="1657118">Pointer</span><span class="op" id="1657125">(</span><span class="op" id="1657126">&amp;</span><span class="ident" id="1657127">p</span><span class="op" id="1657128">)</span><span class="op" id="1657129">)</span><span class="op" id="1657130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657134">for</span>&nbsp;<span class="op" id="1657138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657142">d</span>&nbsp;<span class="op" id="1657144">:=</span>&nbsp;<span class="ident" id="1657147">gp</span><span class="op" id="1657149">.</span><span class="ident" id="1657150">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657159">if</span>&nbsp;<span class="ident" id="1657162">d</span>&nbsp;<span class="op" id="1657164">==</span>&nbsp;<span class="ident" id="1657167">nil</span>&nbsp;<span class="op" id="1657171">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657176">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657189">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657300">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657381">if</span>&nbsp;<span class="ident" id="1657384">d</span><span class="op" id="1657385">.</span><span class="ident" id="1657386">started</span>&nbsp;<span class="op" id="1657394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657399">if</span>&nbsp;<span class="ident" id="1657402">d</span><span class="op" id="1657403">.</span><span class="ident" id="1657404">_panic</span>&nbsp;<span class="op" id="1657411">!=</span>&nbsp;<span class="ident" id="1657414">nil</span>&nbsp;<span class="op" id="1657418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657424">d</span><span class="op" id="1657425">.</span><span class="ident" id="1657426">_panic</span><span class="op" id="1657432">.</span><span class="ident" id="1657433">aborted</span>&nbsp;<span class="op" id="1657441">=</span>&nbsp;<span class="builtintype" id="1657443">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657456">d</span><span class="op" id="1657457">.</span><span class="ident" id="1657458">_panic</span>&nbsp;<span class="op" id="1657465">=</span>&nbsp;<span class="ident" id="1657467">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657474">d</span><span class="op" id="1657475">.</span><span class="ident" id="1657476">fn</span>&nbsp;<span class="op" id="1657479">=</span>&nbsp;<span class="ident" id="1657481">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657488">gp</span><span class="op" id="1657490">.</span><span class="ident" id="1657491">_defer</span>&nbsp;<span class="op" id="1657498">=</span>&nbsp;<span class="ident" id="1657500">d</span><span class="op" id="1657501">.</span><span class="ident" id="1657502">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657510">freedefer</span><span class="op" id="1657519">(</span><span class="ident" id="1657520">d</span><span class="op" id="1657521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657526">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657537">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657542">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657606">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657674">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657752">d</span><span class="op" id="1657753">.</span><span class="ident" id="1657754">started</span>&nbsp;<span class="op" id="1657762">=</span>&nbsp;<span class="builtintype" id="1657764">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657772">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657821">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657887">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657961">d</span><span class="op" id="1657962">.</span><span class="ident" id="1657963">_panic</span>&nbsp;<span class="op" id="1657970">=</span>&nbsp;<span class="op" id="1657972">(</span><span class="op" id="1657973">*</span><span class="ident" id="1657974">_panic</span><span class="op" id="1657980">)</span><span class="op" id="1657981">(</span><span class="ident" id="1657982">noescape</span><span class="op" id="1657990">(</span><span class="op" id="1657991">(</span><span class="ident" id="1657992">unsafe</span><span class="op" id="1657998">.</span><span class="ident" id="1657999">Pointer</span><span class="op" id="1658006">)</span><span class="op" id="1658007">(</span><span class="op" id="1658008">&amp;</span><span class="ident" id="1658009">p</span><span class="op" id="1658010">)</span><span class="op" id="1658011">)</span><span class="op" id="1658012">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658017">p</span><span class="op" id="1658018">.</span><span class="ident" id="1658019">argp</span>&nbsp;<span class="op" id="1658024">=</span>&nbsp;<span class="ident" id="1658026">unsafe</span><span class="op" id="1658032">.</span><span class="ident" id="1658033">Pointer</span><span class="op" id="1658040">(</span><span class="ident" id="1658041">getargp</span><span class="op" id="1658048">(</span><span class="num" id="1658049">0</span><span class="op" id="1658050">)</span><span class="op" id="1658051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658055">reflectcall</span><span class="op" id="1658066">(</span><span class="ident" id="1658067">unsafe</span><span class="op" id="1658073">.</span><span class="ident" id="1658074">Pointer</span><span class="op" id="1658081">(</span><span class="ident" id="1658082">d</span><span class="op" id="1658083">.</span><span class="ident" id="1658084">fn</span><span class="op" id="1658086">)</span><span class="op" id="1658087">,</span>&nbsp;<span class="ident" id="1658089">deferArgs</span><span class="op" id="1658098">(</span><span class="ident" id="1658099">d</span><span class="op" id="1658100">)</span><span class="op" id="1658101">,</span>&nbsp;<span class="builtintype" id="1658103">uint32</span><span class="op" id="1658109">(</span><span class="ident" id="1658110">d</span><span class="op" id="1658111">.</span><span class="ident" id="1658112">siz</span><span class="op" id="1658115">)</span><span class="op" id="1658116">,</span>&nbsp;<span class="builtintype" id="1658118">uint32</span><span class="op" id="1658124">(</span><span class="ident" id="1658125">d</span><span class="op" id="1658126">.</span><span class="ident" id="1658127">siz</span><span class="op" id="1658130">)</span><span class="op" id="1658131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658135">p</span><span class="op" id="1658136">.</span><span class="ident" id="1658137">argp</span>&nbsp;<span class="op" id="1658142">=</span>&nbsp;<span class="ident" id="1658144">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658151">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658193">if</span>&nbsp;<span class="ident" id="1658196">gp</span><span class="op" id="1658198">.</span><span class="ident" id="1658199">_defer</span>&nbsp;<span class="op" id="1658206">!=</span>&nbsp;<span class="ident" id="1658209">d</span>&nbsp;<span class="op" id="1658211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658216">gothrow</span><span class="op" id="1658223">(</span><span class="string" id="1658224">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1658250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658258">d</span><span class="op" id="1658259">.</span><span class="ident" id="1658260">_panic</span>&nbsp;<span class="op" id="1658267">=</span>&nbsp;<span class="ident" id="1658269">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658275">d</span><span class="op" id="1658276">.</span><span class="ident" id="1658277">fn</span>&nbsp;<span class="op" id="1658280">=</span>&nbsp;<span class="ident" id="1658282">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658288">gp</span><span class="op" id="1658290">.</span><span class="ident" id="1658291">_defer</span>&nbsp;<span class="op" id="1658298">=</span>&nbsp;<span class="ident" id="1658300">d</span><span class="op" id="1658301">.</span><span class="ident" id="1658302">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658310">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658387">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658397">pc</span>&nbsp;<span class="op" id="1658400">:=</span>&nbsp;<span class="ident" id="1658403">d</span><span class="op" id="1658404">.</span><span class="ident" id="1658405">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658410">argp</span>&nbsp;<span class="op" id="1658415">:=</span>&nbsp;<span class="ident" id="1658418">unsafe</span><span class="op" id="1658424">.</span><span class="ident" id="1658425">Pointer</span><span class="op" id="1658432">(</span><span class="ident" id="1658433">d</span><span class="op" id="1658434">.</span><span class="ident" id="1658435">argp</span><span class="op" id="1658439">)</span>&nbsp;<span class="comment" id="1658441">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658500">freedefer</span><span class="op" id="1658509">(</span><span class="ident" id="1658510">d</span><span class="op" id="1658511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658515">if</span>&nbsp;<span class="ident" id="1658518">p</span><span class="op" id="1658519">.</span><span class="ident" id="1658520">recovered</span>&nbsp;<span class="op" id="1658530">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658535">gp</span><span class="op" id="1658537">.</span><span class="ident" id="1658538">_panic</span>&nbsp;<span class="op" id="1658545">=</span>&nbsp;<span class="ident" id="1658547">p</span><span class="op" id="1658548">.</span><span class="ident" id="1658549">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658557">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658621">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658654">for</span>&nbsp;<span class="ident" id="1658658">gp</span><span class="op" id="1658660">.</span><span class="ident" id="1658661">_panic</span>&nbsp;<span class="op" id="1658668">!=</span>&nbsp;<span class="ident" id="1658671">nil</span>&nbsp;<span class="op" id="1658675">&amp;&amp;</span>&nbsp;<span class="ident" id="1658678">gp</span><span class="op" id="1658680">.</span><span class="ident" id="1658681">_panic</span><span class="op" id="1658687">.</span><span class="ident" id="1658688">aborted</span>&nbsp;<span class="op" id="1658696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658702">gp</span><span class="op" id="1658704">.</span><span class="ident" id="1658705">_panic</span>&nbsp;<span class="op" id="1658712">=</span>&nbsp;<span class="ident" id="1658714">gp</span><span class="op" id="1658716">.</span><span class="ident" id="1658717">_panic</span><span class="op" id="1658723">.</span><span class="ident" id="1658724">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658737">if</span>&nbsp;<span class="ident" id="1658740">gp</span><span class="op" id="1658742">.</span><span class="ident" id="1658743">_panic</span>&nbsp;<span class="op" id="1658750">==</span>&nbsp;<span class="ident" id="1658753">nil</span>&nbsp;<span class="op" id="1658757">{</span>&nbsp;<span class="comment" id="1658759">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658791">gp</span><span class="op" id="1658793">.</span><span class="ident" id="1658794">sig</span>&nbsp;<span class="op" id="1658798">=</span>&nbsp;<span class="num" id="1658800">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658810">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658869">gp</span><span class="op" id="1658871">.</span><span class="ident" id="1658872">sigcode0</span>&nbsp;<span class="op" id="1658881">=</span>&nbsp;<span class="builtintype" id="1658883">uintptr</span><span class="op" id="1658890">(</span><span class="ident" id="1658891">argp</span><span class="op" id="1658895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658900">gp</span><span class="op" id="1658902">.</span><span class="ident" id="1658903">sigcode1</span>&nbsp;<span class="op" id="1658912">=</span>&nbsp;<span class="ident" id="1658914">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658920">mcall</span><span class="op" id="1658925">(</span><span class="ident" id="1658926">recovery_m</span><span class="op" id="1658936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658941">gothrow</span><span class="op" id="1658948">(</span><span class="string" id="1658949">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1658966">)</span>&nbsp;<span class="comment" id="1658968">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658997">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659004">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659057">startpanic</span><span class="op" id="1659067">(</span><span class="op" id="1659068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659071">printpanics</span><span class="op" id="1659082">(</span><span class="ident" id="1659083">gp</span><span class="op" id="1659085">.</span><span class="ident" id="1659086">_panic</span><span class="op" id="1659092">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659095">dopanic</span><span class="op" id="1659102">(</span><span class="num" id="1659103">0</span><span class="op" id="1659104">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1659112">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659134">*</span><span class="op" id="1659135">(</span><span class="op" id="1659136">*</span><span class="builtintype" id="1659137">int</span><span class="op" id="1659140">)</span><span class="op" id="1659141">(</span><span class="ident" id="1659142">nil</span><span class="op" id="1659145">)</span>&nbsp;<span class="op" id="1659147">=</span>&nbsp;<span class="num" id="1659149">0</span>&nbsp;<span class="comment" id="1659151">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1659166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1659169">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1659218">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1659262">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1659275">func</span>&nbsp;<span class="ident" id="1659280">getargp</span><span class="op" id="1659287">(</span><span class="ident" id="1659288">x</span>&nbsp;<span class="builtintype" id="1659290">int</span><span class="op" id="1659293">)</span>&nbsp;<span class="builtintype" id="1659295">uintptr</span>&nbsp;<span class="op" id="1659303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659306">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659369">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659426">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659491">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659551">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659596">if</span>&nbsp;<span class="ident" id="1659599">x</span>&nbsp;<span class="op" id="1659601">&gt;</span>&nbsp;<span class="num" id="1659603">0</span>&nbsp;<span class="op" id="1659605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659609">return</span>&nbsp;<span class="ident" id="1659616">getcallersp</span><span class="op" id="1659627">(</span><span class="ident" id="1659628">unsafe</span><span class="op" id="1659634">.</span><span class="ident" id="1659635">Pointer</span><span class="op" id="1659642">(</span><span class="op" id="1659643">&amp;</span><span class="ident" id="1659644">x</span><span class="op" id="1659645">)</span><span class="op" id="1659646">)</span>&nbsp;<span class="op" id="1659648">*</span>&nbsp;<span class="num" id="1659650">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659656">return</span>&nbsp;<span class="builtintype" id="1659663">uintptr</span><span class="op" id="1659670">(</span><span class="ident" id="1659671">noescape</span><span class="op" id="1659679">(</span><span class="ident" id="1659680">unsafe</span><span class="op" id="1659686">.</span><span class="ident" id="1659687">Pointer</span><span class="op" id="1659694">(</span><span class="op" id="1659695">&amp;</span><span class="ident" id="1659696">x</span><span class="op" id="1659697">)</span><span class="op" id="1659698">)</span><span class="op" id="1659699">)</span><br>
<span class="lineno"></span><span class="op" id="1659701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1659704">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1659763">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1659818">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1659859">//</span><br>
<span class="lineno"></span><span class="comment" id="1659862">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1659911">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1659947">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1659960">func</span>&nbsp;<span class="ident" id="1659965">gorecover</span><span class="op" id="1659974">(</span><span class="ident" id="1659975">argp</span>&nbsp;<span class="builtintype" id="1659980">uintptr</span><span class="op" id="1659987">)</span>&nbsp;<span class="keyword" id="1659989">interface</span><span class="op" id="1659998">{</span><span class="op" id="1659999">}</span>&nbsp;<span class="op" id="1660001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660004">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660083">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660140">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660188">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660263">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660308">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660366">gp</span>&nbsp;<span class="op" id="1660369">:=</span>&nbsp;<span class="ident" id="1660372">getg</span><span class="op" id="1660376">(</span><span class="op" id="1660377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660380">p</span>&nbsp;<span class="op" id="1660382">:=</span>&nbsp;<span class="ident" id="1660385">gp</span><span class="op" id="1660387">.</span><span class="ident" id="1660388">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660396">if</span>&nbsp;<span class="ident" id="1660399">p</span>&nbsp;<span class="op" id="1660401">!=</span>&nbsp;<span class="ident" id="1660404">nil</span>&nbsp;<span class="op" id="1660408">&amp;&amp;</span>&nbsp;<span class="op" id="1660411">!</span><span class="ident" id="1660412">p</span><span class="op" id="1660413">.</span><span class="ident" id="1660414">recovered</span>&nbsp;<span class="op" id="1660424">&amp;&amp;</span>&nbsp;<span class="ident" id="1660427">argp</span>&nbsp;<span class="op" id="1660432">==</span>&nbsp;<span class="builtintype" id="1660435">uintptr</span><span class="op" id="1660442">(</span><span class="ident" id="1660443">p</span><span class="op" id="1660444">.</span><span class="ident" id="1660445">argp</span><span class="op" id="1660449">)</span>&nbsp;<span class="op" id="1660451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660455">p</span><span class="op" id="1660456">.</span><span class="ident" id="1660457">recovered</span>&nbsp;<span class="op" id="1660467">=</span>&nbsp;<span class="builtintype" id="1660469">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660476">return</span>&nbsp;<span class="ident" id="1660483">p</span><span class="op" id="1660484">.</span><span class="ident" id="1660485">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660493">return</span>&nbsp;<span class="ident" id="1660500">nil</span><br>
<span class="lineno">465</span><span class="op" id="1660504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660507">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1660520">func</span>&nbsp;<span class="ident" id="1660525">startpanic</span><span class="op" id="1660535">(</span><span class="op" id="1660536">)</span>&nbsp;<span class="op" id="1660538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660541">onM_signalok</span><span class="op" id="1660553">(</span><span class="ident" id="1660554">startpanic_m</span><span class="op" id="1660566">)</span><br>
<span class="lineno">470</span><span class="op" id="1660568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660571">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1660584">func</span>&nbsp;<span class="ident" id="1660589">dopanic</span><span class="op" id="1660596">(</span><span class="ident" id="1660597">unused</span>&nbsp;<span class="builtintype" id="1660604">int</span><span class="op" id="1660607">)</span>&nbsp;<span class="op" id="1660609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660612">gp</span>&nbsp;<span class="op" id="1660615">:=</span>&nbsp;<span class="ident" id="1660618">getg</span><span class="op" id="1660622">(</span><span class="op" id="1660623">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660626">mp</span>&nbsp;<span class="op" id="1660629">:=</span>&nbsp;<span class="ident" id="1660632">acquirem</span><span class="op" id="1660640">(</span><span class="op" id="1660641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660644">mp</span><span class="op" id="1660646">.</span><span class="ident" id="1660647">ptrarg</span><span class="op" id="1660653">[</span><span class="num" id="1660654">0</span><span class="op" id="1660655">]</span>&nbsp;<span class="op" id="1660657">=</span>&nbsp;<span class="ident" id="1660659">unsafe</span><span class="op" id="1660665">.</span><span class="ident" id="1660666">Pointer</span><span class="op" id="1660673">(</span><span class="ident" id="1660674">gp</span><span class="op" id="1660676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660679">mp</span><span class="op" id="1660681">.</span><span class="ident" id="1660682">scalararg</span><span class="op" id="1660691">[</span><span class="num" id="1660692">0</span><span class="op" id="1660693">]</span>&nbsp;<span class="op" id="1660695">=</span>&nbsp;<span class="ident" id="1660697">getcallerpc</span><span class="op" id="1660708">(</span><span class="op" id="1660709">(</span><span class="ident" id="1660710">unsafe</span><span class="op" id="1660716">.</span><span class="ident" id="1660717">Pointer</span><span class="op" id="1660724">)</span><span class="op" id="1660725">(</span><span class="op" id="1660726">&amp;</span><span class="ident" id="1660727">unused</span><span class="op" id="1660733">)</span><span class="op" id="1660734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660737">mp</span><span class="op" id="1660739">.</span><span class="ident" id="1660740">scalararg</span><span class="op" id="1660749">[</span><span class="num" id="1660750">1</span><span class="op" id="1660751">]</span>&nbsp;<span class="op" id="1660753">=</span>&nbsp;<span class="ident" id="1660755">getcallersp</span><span class="op" id="1660766">(</span><span class="op" id="1660767">(</span><span class="ident" id="1660768">unsafe</span><span class="op" id="1660774">.</span><span class="ident" id="1660775">Pointer</span><span class="op" id="1660782">)</span><span class="op" id="1660783">(</span><span class="op" id="1660784">&amp;</span><span class="ident" id="1660785">unused</span><span class="op" id="1660791">)</span><span class="op" id="1660792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660795">onM_signalok</span><span class="op" id="1660807">(</span><span class="ident" id="1660808">dopanic_m</span><span class="op" id="1660817">)</span>&nbsp;<span class="comment" id="1660819">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660843">*</span><span class="op" id="1660844">(</span><span class="op" id="1660845">*</span><span class="builtintype" id="1660846">int</span><span class="op" id="1660849">)</span><span class="op" id="1660850">(</span><span class="ident" id="1660851">nil</span><span class="op" id="1660854">)</span>&nbsp;<span class="op" id="1660856">=</span>&nbsp;<span class="num" id="1660858">0</span><br>
<span class="lineno"></span><span class="op" id="1660860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660863">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1660876">func</span>&nbsp;<span class="ident" id="1660881">throw</span><span class="op" id="1660886">(</span><span class="ident" id="1660887">s</span>&nbsp;<span class="op" id="1660889">*</span><span class="builtintype" id="1660890">byte</span><span class="op" id="1660894">)</span>&nbsp;<span class="op" id="1660896">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660899">gp</span>&nbsp;<span class="op" id="1660902">:=</span>&nbsp;<span class="ident" id="1660905">getg</span><span class="op" id="1660909">(</span><span class="op" id="1660910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660913">if</span>&nbsp;<span class="ident" id="1660916">gp</span><span class="op" id="1660918">.</span><span class="ident" id="1660919">m</span><span class="op" id="1660920">.</span><span class="ident" id="1660921">throwing</span>&nbsp;<span class="op" id="1660930">==</span>&nbsp;<span class="num" id="1660933">0</span>&nbsp;<span class="op" id="1660935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660939">gp</span><span class="op" id="1660941">.</span><span class="ident" id="1660942">m</span><span class="op" id="1660943">.</span><span class="ident" id="1660944">throwing</span>&nbsp;<span class="op" id="1660953">=</span>&nbsp;<span class="num" id="1660955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660961">startpanic</span><span class="op" id="1660971">(</span><span class="op" id="1660972">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1660975">print</span><span class="op" id="1660980">(</span><span class="string" id="1660981">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1660996">,</span>&nbsp;<span class="ident" id="1660998">gostringnocopy</span><span class="op" id="1661012">(</span><span class="ident" id="1661013">s</span><span class="op" id="1661014">)</span><span class="op" id="1661015">,</span>&nbsp;<span class="string" id="1661017">&#34;\n&#34;</span><span class="op" id="1661021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661024">dopanic</span><span class="op" id="1661031">(</span><span class="num" id="1661032">0</span><span class="op" id="1661033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661036">*</span><span class="op" id="1661037">(</span><span class="op" id="1661038">*</span><span class="builtintype" id="1661039">int</span><span class="op" id="1661042">)</span><span class="op" id="1661043">(</span><span class="ident" id="1661044">nil</span><span class="op" id="1661047">)</span>&nbsp;<span class="op" id="1661049">=</span>&nbsp;<span class="num" id="1661051">0</span>&nbsp;<span class="comment" id="1661053">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1661068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1661071">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1661084">func</span>&nbsp;<span class="ident" id="1661089">gothrow</span><span class="op" id="1661096">(</span><span class="ident" id="1661097">s</span>&nbsp;<span class="builtintype" id="1661099">string</span><span class="op" id="1661105">)</span>&nbsp;<span class="op" id="1661107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661110">gp</span>&nbsp;<span class="op" id="1661113">:=</span>&nbsp;<span class="ident" id="1661116">getg</span><span class="op" id="1661120">(</span><span class="op" id="1661121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661124">if</span>&nbsp;<span class="ident" id="1661127">gp</span><span class="op" id="1661129">.</span><span class="ident" id="1661130">m</span><span class="op" id="1661131">.</span><span class="ident" id="1661132">throwing</span>&nbsp;<span class="op" id="1661141">==</span>&nbsp;<span class="num" id="1661144">0</span>&nbsp;<span class="op" id="1661146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661150">gp</span><span class="op" id="1661152">.</span><span class="ident" id="1661153">m</span><span class="op" id="1661154">.</span><span class="ident" id="1661155">throwing</span>&nbsp;<span class="op" id="1661164">=</span>&nbsp;<span class="num" id="1661166">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661172">startpanic</span><span class="op" id="1661182">(</span><span class="op" id="1661183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1661186">print</span><span class="op" id="1661191">(</span><span class="string" id="1661192">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1661207">,</span>&nbsp;<span class="ident" id="1661209">s</span><span class="op" id="1661210">,</span>&nbsp;<span class="string" id="1661212">&#34;\n&#34;</span><span class="op" id="1661216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661219">dopanic</span><span class="op" id="1661226">(</span><span class="num" id="1661227">0</span><span class="op" id="1661228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661231">*</span><span class="op" id="1661232">(</span><span class="op" id="1661233">*</span><span class="builtintype" id="1661234">int</span><span class="op" id="1661237">)</span><span class="op" id="1661238">(</span><span class="ident" id="1661239">nil</span><span class="op" id="1661242">)</span>&nbsp;<span class="op" id="1661244">=</span>&nbsp;<span class="num" id="1661246">0</span>&nbsp;<span class="comment" id="1661248">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1661263">}</span>
</div>
</body>
</html>
