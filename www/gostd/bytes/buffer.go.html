<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1552789">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1552844">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1552898">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1552949">package</span>&nbsp;<span class="ident" id="1552957">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1552964">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1553008">import</span>&nbsp;<span class="op" id="1553015">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1553018">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1553028">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1553034">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1553049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1553052">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1553129">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1553191">type</span>&nbsp;<span class="ident" id="1553196">Buffer</span>&nbsp;<span class="keyword" id="1553203">struct</span>&nbsp;<span class="op" id="1553210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553213">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1553223">[</span><span class="op" id="1553224">]</span><span class="builtintype" id="1553225">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553241">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553288">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1553298">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553316">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553363">runeBytes</span>&nbsp;<span class="op" id="1553373">[</span><span class="ident" id="1553374">utf8</span><span class="op" id="1553378">.</span><span class="ident" id="1553379">UTFMax</span><span class="op" id="1553385">]</span><span class="builtintype" id="1553386">byte</span>&nbsp;<span class="comment" id="1553391">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553447">bootstrap</span>&nbsp;<span class="op" id="1553457">[</span><span class="num" id="1553458">64</span><span class="op" id="1553460">]</span><span class="builtintype" id="1553461">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553475">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553554">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1553564">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553582">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1553642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1553645">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1553707">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1553760">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1553788">type</span>&nbsp;<span class="ident" id="1553793">readOp</span>&nbsp;<span class="builtintype" id="1553800">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1553805">const</span>&nbsp;<span class="op" id="1553811">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553814">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1553825">readOp</span>&nbsp;<span class="op" id="1553832">=</span>&nbsp;<span class="ident" id="1553834">iota</span>&nbsp;<span class="comment" id="1553839">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553863">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553888">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553903">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1553928">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1553957">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1553960">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1554051">var</span>&nbsp;<span class="ident" id="1554055">ErrTooLarge</span>&nbsp;<span class="op" id="1554067">=</span>&nbsp;<span class="ident" id="1554069">errors</span><span class="op" id="1554075">.</span><span class="ident" id="1554076">New</span><span class="op" id="1554079">(</span><span class="string" id="1554080">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1554105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1554108">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1554186">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1554259">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1554332">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1554382">func</span>&nbsp;<span class="op" id="1554387">(</span><span class="ident" id="1554388">b</span>&nbsp;<span class="op" id="1554390">*</span><span class="ident" id="1554391">Buffer</span><span class="op" id="1554397">)</span>&nbsp;<span class="ident" id="1554399">Bytes</span><span class="op" id="1554404">(</span><span class="op" id="1554405">)</span>&nbsp;<span class="op" id="1554407">[</span><span class="op" id="1554408">]</span><span class="builtintype" id="1554409">byte</span>&nbsp;<span class="op" id="1554414">{</span>&nbsp;<span class="keyword" id="1554416">return</span>&nbsp;<span class="ident" id="1554423">b</span><span class="op" id="1554424">.</span><span class="ident" id="1554425">buf</span><span class="op" id="1554428">[</span><span class="ident" id="1554429">b</span><span class="op" id="1554430">.</span><span class="ident" id="1554431">off</span><span class="op" id="1554434">:</span><span class="op" id="1554435">]</span>&nbsp;<span class="op" id="1554437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1554440">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1554507">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1554576">func</span>&nbsp;<span class="op" id="1554581">(</span><span class="ident" id="1554582">b</span>&nbsp;<span class="op" id="1554584">*</span><span class="ident" id="1554585">Buffer</span><span class="op" id="1554591">)</span>&nbsp;<span class="ident" id="1554593">String</span><span class="op" id="1554599">(</span><span class="op" id="1554600">)</span>&nbsp;<span class="builtintype" id="1554602">string</span>&nbsp;<span class="op" id="1554609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554612">if</span>&nbsp;<span class="ident" id="1554615">b</span>&nbsp;<span class="op" id="1554617">==</span>&nbsp;<span class="ident" id="1554620">nil</span>&nbsp;<span class="op" id="1554624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1554628">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554668">return</span>&nbsp;<span class="string" id="1554675">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554687">return</span>&nbsp;<span class="builtintype" id="1554694">string</span><span class="op" id="1554700">(</span><span class="ident" id="1554701">b</span><span class="op" id="1554702">.</span><span class="ident" id="1554703">buf</span><span class="op" id="1554706">[</span><span class="ident" id="1554707">b</span><span class="op" id="1554708">.</span><span class="ident" id="1554709">off</span><span class="op" id="1554712">:</span><span class="op" id="1554713">]</span><span class="op" id="1554714">)</span><br>
<span class="lineno"></span><span class="op" id="1554716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1554719">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1554791">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1554821">func</span>&nbsp;<span class="op" id="1554826">(</span><span class="ident" id="1554827">b</span>&nbsp;<span class="op" id="1554829">*</span><span class="ident" id="1554830">Buffer</span><span class="op" id="1554836">)</span>&nbsp;<span class="ident" id="1554838">Len</span><span class="op" id="1554841">(</span><span class="op" id="1554842">)</span>&nbsp;<span class="builtintype" id="1554844">int</span>&nbsp;<span class="op" id="1554848">{</span>&nbsp;<span class="keyword" id="1554850">return</span>&nbsp;<span class="builtinfunc" id="1554857">len</span><span class="op" id="1554860">(</span><span class="ident" id="1554861">b</span><span class="op" id="1554862">.</span><span class="ident" id="1554863">buf</span><span class="op" id="1554866">)</span>&nbsp;<span class="op" id="1554868">-</span>&nbsp;<span class="ident" id="1554870">b</span><span class="op" id="1554871">.</span><span class="ident" id="1554872">off</span>&nbsp;<span class="op" id="1554876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1554879">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1554950">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1555022">func</span>&nbsp;<span class="op" id="1555027">(</span><span class="ident" id="1555028">b</span>&nbsp;<span class="op" id="1555030">*</span><span class="ident" id="1555031">Buffer</span><span class="op" id="1555037">)</span>&nbsp;<span class="ident" id="1555039">Truncate</span><span class="op" id="1555047">(</span><span class="ident" id="1555048">n</span>&nbsp;<span class="builtintype" id="1555050">int</span><span class="op" id="1555053">)</span>&nbsp;<span class="op" id="1555055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555058">b</span><span class="op" id="1555059">.</span><span class="ident" id="1555060">lastRead</span>&nbsp;<span class="op" id="1555069">=</span>&nbsp;<span class="ident" id="1555071">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555082">switch</span>&nbsp;<span class="op" id="1555089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555092">case</span>&nbsp;<span class="ident" id="1555097">n</span>&nbsp;<span class="op" id="1555099">&lt;</span>&nbsp;<span class="num" id="1555101">0</span>&nbsp;<span class="op" id="1555103">||</span>&nbsp;<span class="ident" id="1555106">n</span>&nbsp;<span class="op" id="1555108">&gt;</span>&nbsp;<span class="ident" id="1555110">b</span><span class="op" id="1555111">.</span><span class="ident" id="1555112">Len</span><span class="op" id="1555115">(</span><span class="op" id="1555116">)</span><span class="op" id="1555117">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1555121">panic</span><span class="op" id="1555126">(</span><span class="string" id="1555127">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1555166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555169">case</span>&nbsp;<span class="ident" id="1555174">n</span>&nbsp;<span class="op" id="1555176">==</span>&nbsp;<span class="num" id="1555179">0</span><span class="op" id="1555180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555184">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555209">b</span><span class="op" id="1555210">.</span><span class="ident" id="1555211">off</span>&nbsp;<span class="op" id="1555215">=</span>&nbsp;<span class="num" id="1555217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555220">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555223">b</span><span class="op" id="1555224">.</span><span class="ident" id="1555225">buf</span>&nbsp;<span class="op" id="1555229">=</span>&nbsp;<span class="ident" id="1555231">b</span><span class="op" id="1555232">.</span><span class="ident" id="1555233">buf</span><span class="op" id="1555236">[</span><span class="num" id="1555237">0</span>&nbsp;<span class="op" id="1555239">:</span>&nbsp;<span class="ident" id="1555241">b</span><span class="op" id="1555242">.</span><span class="ident" id="1555243">off</span><span class="op" id="1555246">+</span><span class="ident" id="1555247">n</span><span class="op" id="1555248">]</span><br>
<span class="lineno"></span><span class="op" id="1555250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1555253">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1555302">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1555345">func</span>&nbsp;<span class="op" id="1555350">(</span><span class="ident" id="1555351">b</span>&nbsp;<span class="op" id="1555353">*</span><span class="ident" id="1555354">Buffer</span><span class="op" id="1555360">)</span>&nbsp;<span class="ident" id="1555362">Reset</span><span class="op" id="1555367">(</span><span class="op" id="1555368">)</span>&nbsp;<span class="op" id="1555370">{</span>&nbsp;<span class="ident" id="1555372">b</span><span class="op" id="1555373">.</span><span class="ident" id="1555374">Truncate</span><span class="op" id="1555382">(</span><span class="num" id="1555383">0</span><span class="op" id="1555384">)</span>&nbsp;<span class="op" id="1555386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1555389">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1555451">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1555506">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1555566">func</span>&nbsp;<span class="op" id="1555571">(</span><span class="ident" id="1555572">b</span>&nbsp;<span class="op" id="1555574">*</span><span class="ident" id="1555575">Buffer</span><span class="op" id="1555581">)</span>&nbsp;<span class="ident" id="1555583">grow</span><span class="op" id="1555587">(</span><span class="ident" id="1555588">n</span>&nbsp;<span class="builtintype" id="1555590">int</span><span class="op" id="1555593">)</span>&nbsp;<span class="builtintype" id="1555595">int</span>&nbsp;<span class="op" id="1555599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555602">m</span>&nbsp;<span class="op" id="1555604">:=</span>&nbsp;<span class="ident" id="1555607">b</span><span class="op" id="1555608">.</span><span class="ident" id="1555609">Len</span><span class="op" id="1555612">(</span><span class="op" id="1555613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555616">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555664">if</span>&nbsp;<span class="ident" id="1555667">m</span>&nbsp;<span class="op" id="1555669">==</span>&nbsp;<span class="num" id="1555672">0</span>&nbsp;<span class="op" id="1555674">&amp;&amp;</span>&nbsp;<span class="ident" id="1555677">b</span><span class="op" id="1555678">.</span><span class="ident" id="1555679">off</span>&nbsp;<span class="op" id="1555683">!=</span>&nbsp;<span class="num" id="1555686">0</span>&nbsp;<span class="op" id="1555688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555692">b</span><span class="op" id="1555693">.</span><span class="ident" id="1555694">Truncate</span><span class="op" id="1555702">(</span><span class="num" id="1555703">0</span><span class="op" id="1555704">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555710">if</span>&nbsp;<span class="builtinfunc" id="1555713">len</span><span class="op" id="1555716">(</span><span class="ident" id="1555717">b</span><span class="op" id="1555718">.</span><span class="ident" id="1555719">buf</span><span class="op" id="1555722">)</span><span class="op" id="1555723">+</span><span class="ident" id="1555724">n</span>&nbsp;<span class="op" id="1555726">&gt;</span>&nbsp;<span class="builtinfunc" id="1555728">cap</span><span class="op" id="1555731">(</span><span class="ident" id="1555732">b</span><span class="op" id="1555733">.</span><span class="ident" id="1555734">buf</span><span class="op" id="1555737">)</span>&nbsp;<span class="op" id="1555739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555743">var</span>&nbsp;<span class="ident" id="1555747">buf</span>&nbsp;<span class="op" id="1555751">[</span><span class="op" id="1555752">]</span><span class="builtintype" id="1555753">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555760">if</span>&nbsp;<span class="ident" id="1555763">b</span><span class="op" id="1555764">.</span><span class="ident" id="1555765">buf</span>&nbsp;<span class="op" id="1555769">==</span>&nbsp;<span class="ident" id="1555772">nil</span>&nbsp;<span class="op" id="1555776">&amp;&amp;</span>&nbsp;<span class="ident" id="1555779">n</span>&nbsp;<span class="op" id="1555781">&lt;=</span>&nbsp;<span class="builtinfunc" id="1555784">len</span><span class="op" id="1555787">(</span><span class="ident" id="1555788">b</span><span class="op" id="1555789">.</span><span class="ident" id="1555790">bootstrap</span><span class="op" id="1555799">)</span>&nbsp;<span class="op" id="1555801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555806">buf</span>&nbsp;<span class="op" id="1555810">=</span>&nbsp;<span class="ident" id="1555812">b</span><span class="op" id="1555813">.</span><span class="ident" id="1555814">bootstrap</span><span class="op" id="1555823">[</span><span class="num" id="1555824">0</span><span class="op" id="1555825">:</span><span class="op" id="1555826">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555830">}</span>&nbsp;<span class="keyword" id="1555832">else</span>&nbsp;<span class="keyword" id="1555837">if</span>&nbsp;<span class="ident" id="1555840">m</span><span class="op" id="1555841">+</span><span class="ident" id="1555842">n</span>&nbsp;<span class="op" id="1555844">&lt;=</span>&nbsp;<span class="builtinfunc" id="1555847">cap</span><span class="op" id="1555850">(</span><span class="ident" id="1555851">b</span><span class="op" id="1555852">.</span><span class="ident" id="1555853">buf</span><span class="op" id="1555856">)</span><span class="op" id="1555857">/</span><span class="num" id="1555858">2</span>&nbsp;<span class="op" id="1555860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555865">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555924">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555982">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556037">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1556077">copy</span><span class="op" id="1556081">(</span><span class="ident" id="1556082">b</span><span class="op" id="1556083">.</span><span class="ident" id="1556084">buf</span><span class="op" id="1556087">[</span><span class="op" id="1556088">:</span><span class="op" id="1556089">]</span><span class="op" id="1556090">,</span>&nbsp;<span class="ident" id="1556092">b</span><span class="op" id="1556093">.</span><span class="ident" id="1556094">buf</span><span class="op" id="1556097">[</span><span class="ident" id="1556098">b</span><span class="op" id="1556099">.</span><span class="ident" id="1556100">off</span><span class="op" id="1556103">:</span><span class="op" id="1556104">]</span><span class="op" id="1556105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556110">buf</span>&nbsp;<span class="op" id="1556114">=</span>&nbsp;<span class="ident" id="1556116">b</span><span class="op" id="1556117">.</span><span class="ident" id="1556118">buf</span><span class="op" id="1556121">[</span><span class="op" id="1556122">:</span><span class="ident" id="1556123">m</span><span class="op" id="1556124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556128">}</span>&nbsp;<span class="keyword" id="1556130">else</span>&nbsp;<span class="op" id="1556135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556140">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556172">buf</span>&nbsp;<span class="op" id="1556176">=</span>&nbsp;<span class="ident" id="1556178">makeSlice</span><span class="op" id="1556187">(</span><span class="num" id="1556188">2</span><span class="op" id="1556189">*</span><span class="builtinfunc" id="1556190">cap</span><span class="op" id="1556193">(</span><span class="ident" id="1556194">b</span><span class="op" id="1556195">.</span><span class="ident" id="1556196">buf</span><span class="op" id="1556199">)</span>&nbsp;<span class="op" id="1556201">+</span>&nbsp;<span class="ident" id="1556203">n</span><span class="op" id="1556204">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1556209">copy</span><span class="op" id="1556213">(</span><span class="ident" id="1556214">buf</span><span class="op" id="1556217">,</span>&nbsp;<span class="ident" id="1556219">b</span><span class="op" id="1556220">.</span><span class="ident" id="1556221">buf</span><span class="op" id="1556224">[</span><span class="ident" id="1556225">b</span><span class="op" id="1556226">.</span><span class="ident" id="1556227">off</span><span class="op" id="1556230">:</span><span class="op" id="1556231">]</span><span class="op" id="1556232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556240">b</span><span class="op" id="1556241">.</span><span class="ident" id="1556242">buf</span>&nbsp;<span class="op" id="1556246">=</span>&nbsp;<span class="ident" id="1556248">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556254">b</span><span class="op" id="1556255">.</span><span class="ident" id="1556256">off</span>&nbsp;<span class="op" id="1556260">=</span>&nbsp;<span class="num" id="1556262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556265">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556268">b</span><span class="op" id="1556269">.</span><span class="ident" id="1556270">buf</span>&nbsp;<span class="op" id="1556274">=</span>&nbsp;<span class="ident" id="1556276">b</span><span class="op" id="1556277">.</span><span class="ident" id="1556278">buf</span><span class="op" id="1556281">[</span><span class="num" id="1556282">0</span>&nbsp;<span class="op" id="1556284">:</span>&nbsp;<span class="ident" id="1556286">b</span><span class="op" id="1556287">.</span><span class="ident" id="1556288">off</span><span class="op" id="1556291">+</span><span class="ident" id="1556292">m</span><span class="op" id="1556293">+</span><span class="ident" id="1556294">n</span><span class="op" id="1556295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556298">return</span>&nbsp;<span class="ident" id="1556305">b</span><span class="op" id="1556306">.</span><span class="ident" id="1556307">off</span>&nbsp;<span class="op" id="1556311">+</span>&nbsp;<span class="ident" id="1556313">m</span><br>
<span class="lineno"></span><span class="op" id="1556315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1556318">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1556392">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1556466">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1556504">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1556542">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1556602">func</span>&nbsp;<span class="op" id="1556607">(</span><span class="ident" id="1556608">b</span>&nbsp;<span class="op" id="1556610">*</span><span class="ident" id="1556611">Buffer</span><span class="op" id="1556617">)</span>&nbsp;<span class="ident" id="1556619">Grow</span><span class="op" id="1556623">(</span><span class="ident" id="1556624">n</span>&nbsp;<span class="builtintype" id="1556626">int</span><span class="op" id="1556629">)</span>&nbsp;<span class="op" id="1556631">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556634">if</span>&nbsp;<span class="ident" id="1556637">n</span>&nbsp;<span class="op" id="1556639">&lt;</span>&nbsp;<span class="num" id="1556641">0</span>&nbsp;<span class="op" id="1556643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1556647">panic</span><span class="op" id="1556652">(</span><span class="string" id="1556653">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1556688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556694">m</span>&nbsp;<span class="op" id="1556696">:=</span>&nbsp;<span class="ident" id="1556699">b</span><span class="op" id="1556700">.</span><span class="ident" id="1556701">grow</span><span class="op" id="1556705">(</span><span class="ident" id="1556706">n</span><span class="op" id="1556707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556710">b</span><span class="op" id="1556711">.</span><span class="ident" id="1556712">buf</span>&nbsp;<span class="op" id="1556716">=</span>&nbsp;<span class="ident" id="1556718">b</span><span class="op" id="1556719">.</span><span class="ident" id="1556720">buf</span><span class="op" id="1556723">[</span><span class="num" id="1556724">0</span><span class="op" id="1556725">:</span><span class="ident" id="1556726">m</span><span class="op" id="1556727">]</span><br>
<span class="lineno">120</span><span class="op" id="1556729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1556732">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1556804">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1556880">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1556944">func</span>&nbsp;<span class="op" id="1556949">(</span><span class="ident" id="1556950">b</span>&nbsp;<span class="op" id="1556952">*</span><span class="ident" id="1556953">Buffer</span><span class="op" id="1556959">)</span>&nbsp;<span class="ident" id="1556961">Write</span><span class="op" id="1556966">(</span><span class="ident" id="1556967">p</span>&nbsp;<span class="op" id="1556969">[</span><span class="op" id="1556970">]</span><span class="builtintype" id="1556971">byte</span><span class="op" id="1556975">)</span>&nbsp;<span class="op" id="1556977">(</span><span class="ident" id="1556978">n</span>&nbsp;<span class="builtintype" id="1556980">int</span><span class="op" id="1556983">,</span>&nbsp;<span class="ident" id="1556985">err</span>&nbsp;<span class="builtintype" id="1556989">error</span><span class="op" id="1556994">)</span>&nbsp;<span class="op" id="1556996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556999">b</span><span class="op" id="1557000">.</span><span class="ident" id="1557001">lastRead</span>&nbsp;<span class="op" id="1557010">=</span>&nbsp;<span class="ident" id="1557012">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557023">m</span>&nbsp;<span class="op" id="1557025">:=</span>&nbsp;<span class="ident" id="1557028">b</span><span class="op" id="1557029">.</span><span class="ident" id="1557030">grow</span><span class="op" id="1557034">(</span><span class="builtinfunc" id="1557035">len</span><span class="op" id="1557038">(</span><span class="ident" id="1557039">p</span><span class="op" id="1557040">)</span><span class="op" id="1557041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557044">return</span>&nbsp;<span class="builtinfunc" id="1557051">copy</span><span class="op" id="1557055">(</span><span class="ident" id="1557056">b</span><span class="op" id="1557057">.</span><span class="ident" id="1557058">buf</span><span class="op" id="1557061">[</span><span class="ident" id="1557062">m</span><span class="op" id="1557063">:</span><span class="op" id="1557064">]</span><span class="op" id="1557065">,</span>&nbsp;<span class="ident" id="1557067">p</span><span class="op" id="1557068">)</span><span class="op" id="1557069">,</span>&nbsp;<span class="ident" id="1557071">nil</span><br>
<span class="lineno"></span><span class="op" id="1557075">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1557078">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1557156">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1557232">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1557302">func</span>&nbsp;<span class="op" id="1557307">(</span><span class="ident" id="1557308">b</span>&nbsp;<span class="op" id="1557310">*</span><span class="ident" id="1557311">Buffer</span><span class="op" id="1557317">)</span>&nbsp;<span class="ident" id="1557319">WriteString</span><span class="op" id="1557330">(</span><span class="ident" id="1557331">s</span>&nbsp;<span class="builtintype" id="1557333">string</span><span class="op" id="1557339">)</span>&nbsp;<span class="op" id="1557341">(</span><span class="ident" id="1557342">n</span>&nbsp;<span class="builtintype" id="1557344">int</span><span class="op" id="1557347">,</span>&nbsp;<span class="ident" id="1557349">err</span>&nbsp;<span class="builtintype" id="1557353">error</span><span class="op" id="1557358">)</span>&nbsp;<span class="op" id="1557360">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557363">b</span><span class="op" id="1557364">.</span><span class="ident" id="1557365">lastRead</span>&nbsp;<span class="op" id="1557374">=</span>&nbsp;<span class="ident" id="1557376">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557387">m</span>&nbsp;<span class="op" id="1557389">:=</span>&nbsp;<span class="ident" id="1557392">b</span><span class="op" id="1557393">.</span><span class="ident" id="1557394">grow</span><span class="op" id="1557398">(</span><span class="builtinfunc" id="1557399">len</span><span class="op" id="1557402">(</span><span class="ident" id="1557403">s</span><span class="op" id="1557404">)</span><span class="op" id="1557405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557408">return</span>&nbsp;<span class="builtinfunc" id="1557415">copy</span><span class="op" id="1557419">(</span><span class="ident" id="1557420">b</span><span class="op" id="1557421">.</span><span class="ident" id="1557422">buf</span><span class="op" id="1557425">[</span><span class="ident" id="1557426">m</span><span class="op" id="1557427">:</span><span class="op" id="1557428">]</span><span class="op" id="1557429">,</span>&nbsp;<span class="ident" id="1557431">s</span><span class="op" id="1557432">)</span><span class="op" id="1557433">,</span>&nbsp;<span class="ident" id="1557435">nil</span><br>
<span class="lineno"></span><span class="op" id="1557439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1557442">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1557504">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1557581">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1557655">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1557677">const</span>&nbsp;<span class="ident" id="1557683">MinRead</span>&nbsp;<span class="op" id="1557691">=</span>&nbsp;<span class="num" id="1557693">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1557698">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1557776">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1557853">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1557929">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1557996">func</span>&nbsp;<span class="op" id="1558001">(</span><span class="ident" id="1558002">b</span>&nbsp;<span class="op" id="1558004">*</span><span class="ident" id="1558005">Buffer</span><span class="op" id="1558011">)</span>&nbsp;<span class="ident" id="1558013">ReadFrom</span><span class="op" id="1558021">(</span><span class="ident" id="1558022">r</span>&nbsp;<span class="ident" id="1558024">io</span><span class="op" id="1558026">.</span><span class="ident" id="1558027">Reader</span><span class="op" id="1558033">)</span>&nbsp;<span class="op" id="1558035">(</span><span class="ident" id="1558036">n</span>&nbsp;<span class="ident" id="1558038">int64</span><span class="op" id="1558043">,</span>&nbsp;<span class="ident" id="1558045">err</span>&nbsp;<span class="builtintype" id="1558049">error</span><span class="op" id="1558054">)</span>&nbsp;<span class="op" id="1558056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558059">b</span><span class="op" id="1558060">.</span><span class="ident" id="1558061">lastRead</span>&nbsp;<span class="op" id="1558070">=</span>&nbsp;<span class="ident" id="1558072">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558083">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558131">if</span>&nbsp;<span class="ident" id="1558134">b</span><span class="op" id="1558135">.</span><span class="ident" id="1558136">off</span>&nbsp;<span class="op" id="1558140">&gt;=</span>&nbsp;<span class="builtinfunc" id="1558143">len</span><span class="op" id="1558146">(</span><span class="ident" id="1558147">b</span><span class="op" id="1558148">.</span><span class="ident" id="1558149">buf</span><span class="op" id="1558152">)</span>&nbsp;<span class="op" id="1558154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558158">b</span><span class="op" id="1558159">.</span><span class="ident" id="1558160">Truncate</span><span class="op" id="1558168">(</span><span class="num" id="1558169">0</span><span class="op" id="1558170">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558176">for</span>&nbsp;<span class="op" id="1558180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558184">if</span>&nbsp;<span class="ident" id="1558187">free</span>&nbsp;<span class="op" id="1558192">:=</span>&nbsp;<span class="builtinfunc" id="1558195">cap</span><span class="op" id="1558198">(</span><span class="ident" id="1558199">b</span><span class="op" id="1558200">.</span><span class="ident" id="1558201">buf</span><span class="op" id="1558204">)</span>&nbsp;<span class="op" id="1558206">-</span>&nbsp;<span class="builtinfunc" id="1558208">len</span><span class="op" id="1558211">(</span><span class="ident" id="1558212">b</span><span class="op" id="1558213">.</span><span class="ident" id="1558214">buf</span><span class="op" id="1558217">)</span><span class="op" id="1558218">;</span>&nbsp;<span class="ident" id="1558220">free</span>&nbsp;<span class="op" id="1558225">&lt;</span>&nbsp;<span class="ident" id="1558227">MinRead</span>&nbsp;<span class="op" id="1558235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558240">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558270">newBuf</span>&nbsp;<span class="op" id="1558277">:=</span>&nbsp;<span class="ident" id="1558280">b</span><span class="op" id="1558281">.</span><span class="ident" id="1558282">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558289">if</span>&nbsp;<span class="ident" id="1558292">b</span><span class="op" id="1558293">.</span><span class="ident" id="1558294">off</span><span class="op" id="1558297">+</span><span class="ident" id="1558298">free</span>&nbsp;<span class="op" id="1558303">&lt;</span>&nbsp;<span class="ident" id="1558305">MinRead</span>&nbsp;<span class="op" id="1558313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558319">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558370">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558400">newBuf</span>&nbsp;<span class="op" id="1558407">=</span>&nbsp;<span class="ident" id="1558409">makeSlice</span><span class="op" id="1558418">(</span><span class="num" id="1558419">2</span><span class="op" id="1558420">*</span><span class="builtinfunc" id="1558421">cap</span><span class="op" id="1558424">(</span><span class="ident" id="1558425">b</span><span class="op" id="1558426">.</span><span class="ident" id="1558427">buf</span><span class="op" id="1558430">)</span>&nbsp;<span class="op" id="1558432">+</span>&nbsp;<span class="ident" id="1558434">MinRead</span><span class="op" id="1558441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558446">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1558451">copy</span><span class="op" id="1558455">(</span><span class="ident" id="1558456">newBuf</span><span class="op" id="1558462">,</span>&nbsp;<span class="ident" id="1558464">b</span><span class="op" id="1558465">.</span><span class="ident" id="1558466">buf</span><span class="op" id="1558469">[</span><span class="ident" id="1558470">b</span><span class="op" id="1558471">.</span><span class="ident" id="1558472">off</span><span class="op" id="1558475">:</span><span class="op" id="1558476">]</span><span class="op" id="1558477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558482">b</span><span class="op" id="1558483">.</span><span class="ident" id="1558484">buf</span>&nbsp;<span class="op" id="1558488">=</span>&nbsp;<span class="ident" id="1558490">newBuf</span><span class="op" id="1558496">[</span><span class="op" id="1558497">:</span><span class="builtinfunc" id="1558498">len</span><span class="op" id="1558501">(</span><span class="ident" id="1558502">b</span><span class="op" id="1558503">.</span><span class="ident" id="1558504">buf</span><span class="op" id="1558507">)</span><span class="op" id="1558508">-</span><span class="ident" id="1558509">b</span><span class="op" id="1558510">.</span><span class="ident" id="1558511">off</span><span class="op" id="1558514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558519">b</span><span class="op" id="1558520">.</span><span class="ident" id="1558521">off</span>&nbsp;<span class="op" id="1558525">=</span>&nbsp;<span class="num" id="1558527">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558535">m</span><span class="op" id="1558536">,</span>&nbsp;<span class="ident" id="1558538">e</span>&nbsp;<span class="op" id="1558540">:=</span>&nbsp;<span class="ident" id="1558543">r</span><span class="op" id="1558544">.</span><span class="ident" id="1558545">Read</span><span class="op" id="1558549">(</span><span class="ident" id="1558550">b</span><span class="op" id="1558551">.</span><span class="ident" id="1558552">buf</span><span class="op" id="1558555">[</span><span class="builtinfunc" id="1558556">len</span><span class="op" id="1558559">(</span><span class="ident" id="1558560">b</span><span class="op" id="1558561">.</span><span class="ident" id="1558562">buf</span><span class="op" id="1558565">)</span><span class="op" id="1558566">:</span><span class="builtinfunc" id="1558567">cap</span><span class="op" id="1558570">(</span><span class="ident" id="1558571">b</span><span class="op" id="1558572">.</span><span class="ident" id="1558573">buf</span><span class="op" id="1558576">)</span><span class="op" id="1558577">]</span><span class="op" id="1558578">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558582">b</span><span class="op" id="1558583">.</span><span class="ident" id="1558584">buf</span>&nbsp;<span class="op" id="1558588">=</span>&nbsp;<span class="ident" id="1558590">b</span><span class="op" id="1558591">.</span><span class="ident" id="1558592">buf</span><span class="op" id="1558595">[</span><span class="num" id="1558596">0</span>&nbsp;<span class="op" id="1558598">:</span>&nbsp;<span class="builtinfunc" id="1558600">len</span><span class="op" id="1558603">(</span><span class="ident" id="1558604">b</span><span class="op" id="1558605">.</span><span class="ident" id="1558606">buf</span><span class="op" id="1558609">)</span><span class="op" id="1558610">+</span><span class="ident" id="1558611">m</span><span class="op" id="1558612">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558616">n</span>&nbsp;<span class="op" id="1558618">+=</span>&nbsp;<span class="ident" id="1558621">int64</span><span class="op" id="1558626">(</span><span class="ident" id="1558627">m</span><span class="op" id="1558628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558632">if</span>&nbsp;<span class="ident" id="1558635">e</span>&nbsp;<span class="op" id="1558637">==</span>&nbsp;<span class="ident" id="1558640">io</span><span class="op" id="1558642">.</span><span class="ident" id="1558643">EOF</span>&nbsp;<span class="op" id="1558647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558652">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558660">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558664">if</span>&nbsp;<span class="ident" id="1558667">e</span>&nbsp;<span class="op" id="1558669">!=</span>&nbsp;<span class="ident" id="1558672">nil</span>&nbsp;<span class="op" id="1558676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558681">return</span>&nbsp;<span class="ident" id="1558688">n</span><span class="op" id="1558689">,</span>&nbsp;<span class="ident" id="1558691">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558701">return</span>&nbsp;<span class="ident" id="1558708">n</span><span class="op" id="1558709">,</span>&nbsp;<span class="ident" id="1558711">nil</span>&nbsp;<span class="comment" id="1558715">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1558755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1558758">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1558835">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1558856">func</span>&nbsp;<span class="ident" id="1558861">makeSlice</span><span class="op" id="1558870">(</span><span class="ident" id="1558871">n</span>&nbsp;<span class="builtintype" id="1558873">int</span><span class="op" id="1558876">)</span>&nbsp;<span class="op" id="1558878">[</span><span class="op" id="1558879">]</span><span class="builtintype" id="1558880">byte</span>&nbsp;<span class="op" id="1558885">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558888">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558931">defer</span>&nbsp;<span class="keyword" id="1558937">func</span><span class="op" id="1558941">(</span><span class="op" id="1558942">)</span>&nbsp;<span class="op" id="1558944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558948">if</span>&nbsp;<span class="builtinfunc" id="1558951">recover</span><span class="op" id="1558958">(</span><span class="op" id="1558959">)</span>&nbsp;<span class="op" id="1558961">!=</span>&nbsp;<span class="ident" id="1558964">nil</span>&nbsp;<span class="op" id="1558968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1558973">panic</span><span class="op" id="1558978">(</span><span class="ident" id="1558979">ErrTooLarge</span><span class="op" id="1558990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558994">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558997">}</span><span class="op" id="1558998">(</span><span class="op" id="1558999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559002">return</span>&nbsp;<span class="builtinfunc" id="1559009">make</span><span class="op" id="1559013">(</span><span class="op" id="1559014">[</span><span class="op" id="1559015">]</span><span class="builtintype" id="1559016">byte</span><span class="op" id="1559020">,</span>&nbsp;<span class="ident" id="1559022">n</span><span class="op" id="1559023">)</span><br>
<span class="lineno"></span><span class="op" id="1559025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1559028">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1559104">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1559181">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1559251">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1559301">func</span>&nbsp;<span class="op" id="1559306">(</span><span class="ident" id="1559307">b</span>&nbsp;<span class="op" id="1559309">*</span><span class="ident" id="1559310">Buffer</span><span class="op" id="1559316">)</span>&nbsp;<span class="ident" id="1559318">WriteTo</span><span class="op" id="1559325">(</span><span class="ident" id="1559326">w</span>&nbsp;<span class="ident" id="1559328">io</span><span class="op" id="1559330">.</span><span class="ident" id="1559331">Writer</span><span class="op" id="1559337">)</span>&nbsp;<span class="op" id="1559339">(</span><span class="ident" id="1559340">n</span>&nbsp;<span class="ident" id="1559342">int64</span><span class="op" id="1559347">,</span>&nbsp;<span class="ident" id="1559349">err</span>&nbsp;<span class="builtintype" id="1559353">error</span><span class="op" id="1559358">)</span>&nbsp;<span class="op" id="1559360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559363">b</span><span class="op" id="1559364">.</span><span class="ident" id="1559365">lastRead</span>&nbsp;<span class="op" id="1559374">=</span>&nbsp;<span class="ident" id="1559376">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559387">if</span>&nbsp;<span class="ident" id="1559390">b</span><span class="op" id="1559391">.</span><span class="ident" id="1559392">off</span>&nbsp;<span class="op" id="1559396">&lt;</span>&nbsp;<span class="builtinfunc" id="1559398">len</span><span class="op" id="1559401">(</span><span class="ident" id="1559402">b</span><span class="op" id="1559403">.</span><span class="ident" id="1559404">buf</span><span class="op" id="1559407">)</span>&nbsp;<span class="op" id="1559409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559413">nBytes</span>&nbsp;<span class="op" id="1559420">:=</span>&nbsp;<span class="ident" id="1559423">b</span><span class="op" id="1559424">.</span><span class="ident" id="1559425">Len</span><span class="op" id="1559428">(</span><span class="op" id="1559429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559433">m</span><span class="op" id="1559434">,</span>&nbsp;<span class="ident" id="1559436">e</span>&nbsp;<span class="op" id="1559438">:=</span>&nbsp;<span class="ident" id="1559441">w</span><span class="op" id="1559442">.</span><span class="ident" id="1559443">Write</span><span class="op" id="1559448">(</span><span class="ident" id="1559449">b</span><span class="op" id="1559450">.</span><span class="ident" id="1559451">buf</span><span class="op" id="1559454">[</span><span class="ident" id="1559455">b</span><span class="op" id="1559456">.</span><span class="ident" id="1559457">off</span><span class="op" id="1559460">:</span><span class="op" id="1559461">]</span><span class="op" id="1559462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559466">if</span>&nbsp;<span class="ident" id="1559469">m</span>&nbsp;<span class="op" id="1559471">&gt;</span>&nbsp;<span class="ident" id="1559473">nBytes</span>&nbsp;<span class="op" id="1559480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1559485">panic</span><span class="op" id="1559490">(</span><span class="string" id="1559491">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1559534">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559542">b</span><span class="op" id="1559543">.</span><span class="ident" id="1559544">off</span>&nbsp;<span class="op" id="1559548">+=</span>&nbsp;<span class="ident" id="1559551">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559555">n</span>&nbsp;<span class="op" id="1559557">=</span>&nbsp;<span class="ident" id="1559559">int64</span><span class="op" id="1559564">(</span><span class="ident" id="1559565">m</span><span class="op" id="1559566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559570">if</span>&nbsp;<span class="ident" id="1559573">e</span>&nbsp;<span class="op" id="1559575">!=</span>&nbsp;<span class="ident" id="1559578">nil</span>&nbsp;<span class="op" id="1559582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559587">return</span>&nbsp;<span class="ident" id="1559594">n</span><span class="op" id="1559595">,</span>&nbsp;<span class="ident" id="1559597">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559605">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559663">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559694">if</span>&nbsp;<span class="ident" id="1559697">m</span>&nbsp;<span class="op" id="1559699">!=</span>&nbsp;<span class="ident" id="1559702">nBytes</span>&nbsp;<span class="op" id="1559709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559714">return</span>&nbsp;<span class="ident" id="1559721">n</span><span class="op" id="1559722">,</span>&nbsp;<span class="ident" id="1559724">io</span><span class="op" id="1559726">.</span><span class="ident" id="1559727">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559749">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559781">b</span><span class="op" id="1559782">.</span><span class="ident" id="1559783">Truncate</span><span class="op" id="1559791">(</span><span class="num" id="1559792">0</span><span class="op" id="1559793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559796">return</span><br>
<span class="lineno">220</span><span class="op" id="1559803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1559806">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1559883">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1559960">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1560033">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1560049">func</span>&nbsp;<span class="op" id="1560054">(</span><span class="ident" id="1560055">b</span>&nbsp;<span class="op" id="1560057">*</span><span class="ident" id="1560058">Buffer</span><span class="op" id="1560064">)</span>&nbsp;<span class="ident" id="1560066">WriteByte</span><span class="op" id="1560075">(</span><span class="ident" id="1560076">c</span>&nbsp;<span class="builtintype" id="1560078">byte</span><span class="op" id="1560082">)</span>&nbsp;<span class="builtintype" id="1560084">error</span>&nbsp;<span class="op" id="1560090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560093">b</span><span class="op" id="1560094">.</span><span class="ident" id="1560095">lastRead</span>&nbsp;<span class="op" id="1560104">=</span>&nbsp;<span class="ident" id="1560106">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560117">m</span>&nbsp;<span class="op" id="1560119">:=</span>&nbsp;<span class="ident" id="1560122">b</span><span class="op" id="1560123">.</span><span class="ident" id="1560124">grow</span><span class="op" id="1560128">(</span><span class="num" id="1560129">1</span><span class="op" id="1560130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560133">b</span><span class="op" id="1560134">.</span><span class="ident" id="1560135">buf</span><span class="op" id="1560138">[</span><span class="ident" id="1560139">m</span><span class="op" id="1560140">]</span>&nbsp;<span class="op" id="1560142">=</span>&nbsp;<span class="ident" id="1560144">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560147">return</span>&nbsp;<span class="ident" id="1560154">nil</span><br>
<span class="lineno"></span><span class="op" id="1560158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1560161">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1560232">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1560305">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1560383">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1560450">func</span>&nbsp;<span class="op" id="1560455">(</span><span class="ident" id="1560456">b</span>&nbsp;<span class="op" id="1560458">*</span><span class="ident" id="1560459">Buffer</span><span class="op" id="1560465">)</span>&nbsp;<span class="ident" id="1560467">WriteRune</span><span class="op" id="1560476">(</span><span class="ident" id="1560477">r</span>&nbsp;<span class="builtintype" id="1560479">rune</span><span class="op" id="1560483">)</span>&nbsp;<span class="op" id="1560485">(</span><span class="ident" id="1560486">n</span>&nbsp;<span class="builtintype" id="1560488">int</span><span class="op" id="1560491">,</span>&nbsp;<span class="ident" id="1560493">err</span>&nbsp;<span class="builtintype" id="1560497">error</span><span class="op" id="1560502">)</span>&nbsp;<span class="op" id="1560504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560507">if</span>&nbsp;<span class="ident" id="1560510">r</span>&nbsp;<span class="op" id="1560512">&lt;</span>&nbsp;<span class="ident" id="1560514">utf8</span><span class="op" id="1560518">.</span><span class="ident" id="1560519">RuneSelf</span>&nbsp;<span class="op" id="1560528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560532">b</span><span class="op" id="1560533">.</span><span class="ident" id="1560534">WriteByte</span><span class="op" id="1560543">(</span><span class="builtintype" id="1560544">byte</span><span class="op" id="1560548">(</span><span class="ident" id="1560549">r</span><span class="op" id="1560550">)</span><span class="op" id="1560551">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560555">return</span>&nbsp;<span class="num" id="1560562">1</span><span class="op" id="1560563">,</span>&nbsp;<span class="ident" id="1560565">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560573">n</span>&nbsp;<span class="op" id="1560575">=</span>&nbsp;<span class="ident" id="1560577">utf8</span><span class="op" id="1560581">.</span><span class="ident" id="1560582">EncodeRune</span><span class="op" id="1560592">(</span><span class="ident" id="1560593">b</span><span class="op" id="1560594">.</span><span class="ident" id="1560595">runeBytes</span><span class="op" id="1560604">[</span><span class="num" id="1560605">0</span><span class="op" id="1560606">:</span><span class="op" id="1560607">]</span><span class="op" id="1560608">,</span>&nbsp;<span class="ident" id="1560610">r</span><span class="op" id="1560611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560614">b</span><span class="op" id="1560615">.</span><span class="ident" id="1560616">Write</span><span class="op" id="1560621">(</span><span class="ident" id="1560622">b</span><span class="op" id="1560623">.</span><span class="ident" id="1560624">runeBytes</span><span class="op" id="1560633">[</span><span class="num" id="1560634">0</span><span class="op" id="1560635">:</span><span class="ident" id="1560636">n</span><span class="op" id="1560637">]</span><span class="op" id="1560638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560641">return</span>&nbsp;<span class="ident" id="1560648">n</span><span class="op" id="1560649">,</span>&nbsp;<span class="ident" id="1560651">nil</span><br>
<span class="lineno">245</span><span class="op" id="1560655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1560658">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1560730">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1560802">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1560874">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1560898">func</span>&nbsp;<span class="op" id="1560903">(</span><span class="ident" id="1560904">b</span>&nbsp;<span class="op" id="1560906">*</span><span class="ident" id="1560907">Buffer</span><span class="op" id="1560913">)</span>&nbsp;<span class="ident" id="1560915">Read</span><span class="op" id="1560919">(</span><span class="ident" id="1560920">p</span>&nbsp;<span class="op" id="1560922">[</span><span class="op" id="1560923">]</span><span class="builtintype" id="1560924">byte</span><span class="op" id="1560928">)</span>&nbsp;<span class="op" id="1560930">(</span><span class="ident" id="1560931">n</span>&nbsp;<span class="builtintype" id="1560933">int</span><span class="op" id="1560936">,</span>&nbsp;<span class="ident" id="1560938">err</span>&nbsp;<span class="builtintype" id="1560942">error</span><span class="op" id="1560947">)</span>&nbsp;<span class="op" id="1560949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560952">b</span><span class="op" id="1560953">.</span><span class="ident" id="1560954">lastRead</span>&nbsp;<span class="op" id="1560963">=</span>&nbsp;<span class="ident" id="1560965">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560976">if</span>&nbsp;<span class="ident" id="1560979">b</span><span class="op" id="1560980">.</span><span class="ident" id="1560981">off</span>&nbsp;<span class="op" id="1560985">&gt;=</span>&nbsp;<span class="builtinfunc" id="1560988">len</span><span class="op" id="1560991">(</span><span class="ident" id="1560992">b</span><span class="op" id="1560993">.</span><span class="ident" id="1560994">buf</span><span class="op" id="1560997">)</span>&nbsp;<span class="op" id="1560999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1561003">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561049">b</span><span class="op" id="1561050">.</span><span class="ident" id="1561051">Truncate</span><span class="op" id="1561059">(</span><span class="num" id="1561060">0</span><span class="op" id="1561061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561065">if</span>&nbsp;<span class="builtinfunc" id="1561068">len</span><span class="op" id="1561071">(</span><span class="ident" id="1561072">p</span><span class="op" id="1561073">)</span>&nbsp;<span class="op" id="1561075">==</span>&nbsp;<span class="num" id="1561078">0</span>&nbsp;<span class="op" id="1561080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561098">return</span>&nbsp;<span class="num" id="1561105">0</span><span class="op" id="1561106">,</span>&nbsp;<span class="ident" id="1561108">io</span><span class="op" id="1561110">.</span><span class="ident" id="1561111">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561119">n</span>&nbsp;<span class="op" id="1561121">=</span>&nbsp;<span class="builtinfunc" id="1561123">copy</span><span class="op" id="1561127">(</span><span class="ident" id="1561128">p</span><span class="op" id="1561129">,</span>&nbsp;<span class="ident" id="1561131">b</span><span class="op" id="1561132">.</span><span class="ident" id="1561133">buf</span><span class="op" id="1561136">[</span><span class="ident" id="1561137">b</span><span class="op" id="1561138">.</span><span class="ident" id="1561139">off</span><span class="op" id="1561142">:</span><span class="op" id="1561143">]</span><span class="op" id="1561144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561147">b</span><span class="op" id="1561148">.</span><span class="ident" id="1561149">off</span>&nbsp;<span class="op" id="1561153">+=</span>&nbsp;<span class="ident" id="1561156">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561159">if</span>&nbsp;<span class="ident" id="1561162">n</span>&nbsp;<span class="op" id="1561164">&gt;</span>&nbsp;<span class="num" id="1561166">0</span>&nbsp;<span class="op" id="1561168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561172">b</span><span class="op" id="1561173">.</span><span class="ident" id="1561174">lastRead</span>&nbsp;<span class="op" id="1561183">=</span>&nbsp;<span class="ident" id="1561185">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561196">return</span><br>
<span class="lineno"></span><span class="op" id="1561203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1561206">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1561275">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1561342">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1561424">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1561498">func</span>&nbsp;<span class="op" id="1561503">(</span><span class="ident" id="1561504">b</span>&nbsp;<span class="op" id="1561506">*</span><span class="ident" id="1561507">Buffer</span><span class="op" id="1561513">)</span>&nbsp;<span class="ident" id="1561515">Next</span><span class="op" id="1561519">(</span><span class="ident" id="1561520">n</span>&nbsp;<span class="builtintype" id="1561522">int</span><span class="op" id="1561525">)</span>&nbsp;<span class="op" id="1561527">[</span><span class="op" id="1561528">]</span><span class="builtintype" id="1561529">byte</span>&nbsp;<span class="op" id="1561534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561537">b</span><span class="op" id="1561538">.</span><span class="ident" id="1561539">lastRead</span>&nbsp;<span class="op" id="1561548">=</span>&nbsp;<span class="ident" id="1561550">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561561">m</span>&nbsp;<span class="op" id="1561563">:=</span>&nbsp;<span class="ident" id="1561566">b</span><span class="op" id="1561567">.</span><span class="ident" id="1561568">Len</span><span class="op" id="1561571">(</span><span class="op" id="1561572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561575">if</span>&nbsp;<span class="ident" id="1561578">n</span>&nbsp;<span class="op" id="1561580">&gt;</span>&nbsp;<span class="ident" id="1561582">m</span>&nbsp;<span class="op" id="1561584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561588">n</span>&nbsp;<span class="op" id="1561590">=</span>&nbsp;<span class="ident" id="1561592">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561598">data</span>&nbsp;<span class="op" id="1561603">:=</span>&nbsp;<span class="ident" id="1561606">b</span><span class="op" id="1561607">.</span><span class="ident" id="1561608">buf</span><span class="op" id="1561611">[</span><span class="ident" id="1561612">b</span><span class="op" id="1561613">.</span><span class="ident" id="1561614">off</span>&nbsp;<span class="op" id="1561618">:</span>&nbsp;<span class="ident" id="1561620">b</span><span class="op" id="1561621">.</span><span class="ident" id="1561622">off</span><span class="op" id="1561625">+</span><span class="ident" id="1561626">n</span><span class="op" id="1561627">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561630">b</span><span class="op" id="1561631">.</span><span class="ident" id="1561632">off</span>&nbsp;<span class="op" id="1561636">+=</span>&nbsp;<span class="ident" id="1561639">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561642">if</span>&nbsp;<span class="ident" id="1561645">n</span>&nbsp;<span class="op" id="1561647">&gt;</span>&nbsp;<span class="num" id="1561649">0</span>&nbsp;<span class="op" id="1561651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561655">b</span><span class="op" id="1561656">.</span><span class="ident" id="1561657">lastRead</span>&nbsp;<span class="op" id="1561666">=</span>&nbsp;<span class="ident" id="1561668">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561679">return</span>&nbsp;<span class="ident" id="1561686">data</span><br>
<span class="lineno">285</span><span class="op" id="1561691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1561694">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1561755">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1561808">func</span>&nbsp;<span class="op" id="1561813">(</span><span class="ident" id="1561814">b</span>&nbsp;<span class="op" id="1561816">*</span><span class="ident" id="1561817">Buffer</span><span class="op" id="1561823">)</span>&nbsp;<span class="ident" id="1561825">ReadByte</span><span class="op" id="1561833">(</span><span class="op" id="1561834">)</span>&nbsp;<span class="op" id="1561836">(</span><span class="ident" id="1561837">c</span>&nbsp;<span class="builtintype" id="1561839">byte</span><span class="op" id="1561843">,</span>&nbsp;<span class="ident" id="1561845">err</span>&nbsp;<span class="builtintype" id="1561849">error</span><span class="op" id="1561854">)</span>&nbsp;<span class="op" id="1561856">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561859">b</span><span class="op" id="1561860">.</span><span class="ident" id="1561861">lastRead</span>&nbsp;<span class="op" id="1561870">=</span>&nbsp;<span class="ident" id="1561872">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561883">if</span>&nbsp;<span class="ident" id="1561886">b</span><span class="op" id="1561887">.</span><span class="ident" id="1561888">off</span>&nbsp;<span class="op" id="1561892">&gt;=</span>&nbsp;<span class="builtinfunc" id="1561895">len</span><span class="op" id="1561898">(</span><span class="ident" id="1561899">b</span><span class="op" id="1561900">.</span><span class="ident" id="1561901">buf</span><span class="op" id="1561904">)</span>&nbsp;<span class="op" id="1561906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1561910">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561956">b</span><span class="op" id="1561957">.</span><span class="ident" id="1561958">Truncate</span><span class="op" id="1561966">(</span><span class="num" id="1561967">0</span><span class="op" id="1561968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561972">return</span>&nbsp;<span class="num" id="1561979">0</span><span class="op" id="1561980">,</span>&nbsp;<span class="ident" id="1561982">io</span><span class="op" id="1561984">.</span><span class="ident" id="1561985">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561993">c</span>&nbsp;<span class="op" id="1561995">=</span>&nbsp;<span class="ident" id="1561997">b</span><span class="op" id="1561998">.</span><span class="ident" id="1561999">buf</span><span class="op" id="1562002">[</span><span class="ident" id="1562003">b</span><span class="op" id="1562004">.</span><span class="ident" id="1562005">off</span><span class="op" id="1562008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562011">b</span><span class="op" id="1562012">.</span><span class="ident" id="1562013">off</span><span class="op" id="1562016">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562020">b</span><span class="op" id="1562021">.</span><span class="ident" id="1562022">lastRead</span>&nbsp;<span class="op" id="1562031">=</span>&nbsp;<span class="ident" id="1562033">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562041">return</span>&nbsp;<span class="ident" id="1562048">c</span><span class="op" id="1562049">,</span>&nbsp;<span class="ident" id="1562051">nil</span><br>
<span class="lineno">300</span><span class="op" id="1562055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1562058">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1562111">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1562150">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1562210">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1562262">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1562306">func</span>&nbsp;<span class="op" id="1562311">(</span><span class="ident" id="1562312">b</span>&nbsp;<span class="op" id="1562314">*</span><span class="ident" id="1562315">Buffer</span><span class="op" id="1562321">)</span>&nbsp;<span class="ident" id="1562323">ReadRune</span><span class="op" id="1562331">(</span><span class="op" id="1562332">)</span>&nbsp;<span class="op" id="1562334">(</span><span class="ident" id="1562335">r</span>&nbsp;<span class="builtintype" id="1562337">rune</span><span class="op" id="1562341">,</span>&nbsp;<span class="ident" id="1562343">size</span>&nbsp;<span class="builtintype" id="1562348">int</span><span class="op" id="1562351">,</span>&nbsp;<span class="ident" id="1562353">err</span>&nbsp;<span class="builtintype" id="1562357">error</span><span class="op" id="1562362">)</span>&nbsp;<span class="op" id="1562364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562367">b</span><span class="op" id="1562368">.</span><span class="ident" id="1562369">lastRead</span>&nbsp;<span class="op" id="1562378">=</span>&nbsp;<span class="ident" id="1562380">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562391">if</span>&nbsp;<span class="ident" id="1562394">b</span><span class="op" id="1562395">.</span><span class="ident" id="1562396">off</span>&nbsp;<span class="op" id="1562400">&gt;=</span>&nbsp;<span class="builtinfunc" id="1562403">len</span><span class="op" id="1562406">(</span><span class="ident" id="1562407">b</span><span class="op" id="1562408">.</span><span class="ident" id="1562409">buf</span><span class="op" id="1562412">)</span>&nbsp;<span class="op" id="1562414">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1562418">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562464">b</span><span class="op" id="1562465">.</span><span class="ident" id="1562466">Truncate</span><span class="op" id="1562474">(</span><span class="num" id="1562475">0</span><span class="op" id="1562476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562480">return</span>&nbsp;<span class="num" id="1562487">0</span><span class="op" id="1562488">,</span>&nbsp;<span class="num" id="1562490">0</span><span class="op" id="1562491">,</span>&nbsp;<span class="ident" id="1562493">io</span><span class="op" id="1562495">.</span><span class="ident" id="1562496">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562504">b</span><span class="op" id="1562505">.</span><span class="ident" id="1562506">lastRead</span>&nbsp;<span class="op" id="1562515">=</span>&nbsp;<span class="ident" id="1562517">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562529">c</span>&nbsp;<span class="op" id="1562531">:=</span>&nbsp;<span class="ident" id="1562534">b</span><span class="op" id="1562535">.</span><span class="ident" id="1562536">buf</span><span class="op" id="1562539">[</span><span class="ident" id="1562540">b</span><span class="op" id="1562541">.</span><span class="ident" id="1562542">off</span><span class="op" id="1562545">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562548">if</span>&nbsp;<span class="ident" id="1562551">c</span>&nbsp;<span class="op" id="1562553">&lt;</span>&nbsp;<span class="ident" id="1562555">utf8</span><span class="op" id="1562559">.</span><span class="ident" id="1562560">RuneSelf</span>&nbsp;<span class="op" id="1562569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562573">b</span><span class="op" id="1562574">.</span><span class="ident" id="1562575">off</span><span class="op" id="1562578">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562583">return</span>&nbsp;<span class="builtintype" id="1562590">rune</span><span class="op" id="1562594">(</span><span class="ident" id="1562595">c</span><span class="op" id="1562596">)</span><span class="op" id="1562597">,</span>&nbsp;<span class="num" id="1562599">1</span><span class="op" id="1562600">,</span>&nbsp;<span class="ident" id="1562602">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562607">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562610">r</span><span class="op" id="1562611">,</span>&nbsp;<span class="ident" id="1562613">n</span>&nbsp;<span class="op" id="1562615">:=</span>&nbsp;<span class="ident" id="1562618">utf8</span><span class="op" id="1562622">.</span><span class="ident" id="1562623">DecodeRune</span><span class="op" id="1562633">(</span><span class="ident" id="1562634">b</span><span class="op" id="1562635">.</span><span class="ident" id="1562636">buf</span><span class="op" id="1562639">[</span><span class="ident" id="1562640">b</span><span class="op" id="1562641">.</span><span class="ident" id="1562642">off</span><span class="op" id="1562645">:</span><span class="op" id="1562646">]</span><span class="op" id="1562647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562650">b</span><span class="op" id="1562651">.</span><span class="ident" id="1562652">off</span>&nbsp;<span class="op" id="1562656">+=</span>&nbsp;<span class="ident" id="1562659">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562662">return</span>&nbsp;<span class="ident" id="1562669">r</span><span class="op" id="1562670">,</span>&nbsp;<span class="ident" id="1562672">n</span><span class="op" id="1562673">,</span>&nbsp;<span class="ident" id="1562675">nil</span><br>
<span class="lineno"></span><span class="op" id="1562679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1562682">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1562740">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1562804">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1562869">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1562936">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1562965">func</span>&nbsp;<span class="op" id="1562970">(</span><span class="ident" id="1562971">b</span>&nbsp;<span class="op" id="1562973">*</span><span class="ident" id="1562974">Buffer</span><span class="op" id="1562980">)</span>&nbsp;<span class="ident" id="1562982">UnreadRune</span><span class="op" id="1562992">(</span><span class="op" id="1562993">)</span>&nbsp;<span class="builtintype" id="1562995">error</span>&nbsp;<span class="op" id="1563001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563004">if</span>&nbsp;<span class="ident" id="1563007">b</span><span class="op" id="1563008">.</span><span class="ident" id="1563009">lastRead</span>&nbsp;<span class="op" id="1563018">!=</span>&nbsp;<span class="ident" id="1563021">opReadRune</span>&nbsp;<span class="op" id="1563032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563036">return</span>&nbsp;<span class="ident" id="1563043">errors</span><span class="op" id="1563049">.</span><span class="ident" id="1563050">New</span><span class="op" id="1563053">(</span><span class="string" id="1563054">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1563117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563123">b</span><span class="op" id="1563124">.</span><span class="ident" id="1563125">lastRead</span>&nbsp;<span class="op" id="1563134">=</span>&nbsp;<span class="ident" id="1563136">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563147">if</span>&nbsp;<span class="ident" id="1563150">b</span><span class="op" id="1563151">.</span><span class="ident" id="1563152">off</span>&nbsp;<span class="op" id="1563156">&gt;</span>&nbsp;<span class="num" id="1563158">0</span>&nbsp;<span class="op" id="1563160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563164">_</span><span class="op" id="1563165">,</span>&nbsp;<span class="ident" id="1563167">n</span>&nbsp;<span class="op" id="1563169">:=</span>&nbsp;<span class="ident" id="1563172">utf8</span><span class="op" id="1563176">.</span><span class="ident" id="1563177">DecodeLastRune</span><span class="op" id="1563191">(</span><span class="ident" id="1563192">b</span><span class="op" id="1563193">.</span><span class="ident" id="1563194">buf</span><span class="op" id="1563197">[</span><span class="num" id="1563198">0</span><span class="op" id="1563199">:</span><span class="ident" id="1563200">b</span><span class="op" id="1563201">.</span><span class="ident" id="1563202">off</span><span class="op" id="1563205">]</span><span class="op" id="1563206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563210">b</span><span class="op" id="1563211">.</span><span class="ident" id="1563212">off</span>&nbsp;<span class="op" id="1563216">-=</span>&nbsp;<span class="ident" id="1563219">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563225">return</span>&nbsp;<span class="ident" id="1563232">nil</span><br>
<span class="lineno">340</span><span class="op" id="1563236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1563239">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1563303">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1563377">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1563398">func</span>&nbsp;<span class="op" id="1563403">(</span><span class="ident" id="1563404">b</span>&nbsp;<span class="op" id="1563406">*</span><span class="ident" id="1563407">Buffer</span><span class="op" id="1563413">)</span>&nbsp;<span class="ident" id="1563415">UnreadByte</span><span class="op" id="1563425">(</span><span class="op" id="1563426">)</span>&nbsp;<span class="builtintype" id="1563428">error</span>&nbsp;<span class="op" id="1563434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563437">if</span>&nbsp;<span class="ident" id="1563440">b</span><span class="op" id="1563441">.</span><span class="ident" id="1563442">lastRead</span>&nbsp;<span class="op" id="1563451">!=</span>&nbsp;<span class="ident" id="1563454">opReadRune</span>&nbsp;<span class="op" id="1563465">&amp;&amp;</span>&nbsp;<span class="ident" id="1563468">b</span><span class="op" id="1563469">.</span><span class="ident" id="1563470">lastRead</span>&nbsp;<span class="op" id="1563479">!=</span>&nbsp;<span class="ident" id="1563482">opRead</span>&nbsp;<span class="op" id="1563489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563493">return</span>&nbsp;<span class="ident" id="1563500">errors</span><span class="op" id="1563506">.</span><span class="ident" id="1563507">New</span><span class="op" id="1563510">(</span><span class="string" id="1563511">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1563572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563578">b</span><span class="op" id="1563579">.</span><span class="ident" id="1563580">lastRead</span>&nbsp;<span class="op" id="1563589">=</span>&nbsp;<span class="ident" id="1563591">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563602">if</span>&nbsp;<span class="ident" id="1563605">b</span><span class="op" id="1563606">.</span><span class="ident" id="1563607">off</span>&nbsp;<span class="op" id="1563611">&gt;</span>&nbsp;<span class="num" id="1563613">0</span>&nbsp;<span class="op" id="1563615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563619">b</span><span class="op" id="1563620">.</span><span class="ident" id="1563621">off</span><span class="op" id="1563624">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563631">return</span>&nbsp;<span class="ident" id="1563638">nil</span><br>
<span class="lineno"></span><span class="op" id="1563642">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1563645">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1563714">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1563790">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1563854">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1563936">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1564017">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1564027">func</span>&nbsp;<span class="op" id="1564032">(</span><span class="ident" id="1564033">b</span>&nbsp;<span class="op" id="1564035">*</span><span class="ident" id="1564036">Buffer</span><span class="op" id="1564042">)</span>&nbsp;<span class="ident" id="1564044">ReadBytes</span><span class="op" id="1564053">(</span><span class="ident" id="1564054">delim</span>&nbsp;<span class="builtintype" id="1564060">byte</span><span class="op" id="1564064">)</span>&nbsp;<span class="op" id="1564066">(</span><span class="ident" id="1564067">line</span>&nbsp;<span class="op" id="1564072">[</span><span class="op" id="1564073">]</span><span class="builtintype" id="1564074">byte</span><span class="op" id="1564078">,</span>&nbsp;<span class="ident" id="1564080">err</span>&nbsp;<span class="builtintype" id="1564084">error</span><span class="op" id="1564089">)</span>&nbsp;<span class="op" id="1564091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564094">slice</span><span class="op" id="1564099">,</span>&nbsp;<span class="ident" id="1564101">err</span>&nbsp;<span class="op" id="1564105">:=</span>&nbsp;<span class="ident" id="1564108">b</span><span class="op" id="1564109">.</span><span class="ident" id="1564110">readSlice</span><span class="op" id="1564119">(</span><span class="ident" id="1564120">delim</span><span class="op" id="1564125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1564128">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1564187">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564222">line</span>&nbsp;<span class="op" id="1564227">=</span>&nbsp;<span class="builtinfunc" id="1564229">append</span><span class="op" id="1564235">(</span><span class="ident" id="1564236">line</span><span class="op" id="1564240">,</span>&nbsp;<span class="ident" id="1564242">slice</span><span class="op" id="1564247">...</span><span class="op" id="1564250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564253">return</span><br>
<span class="lineno"></span><span class="op" id="1564260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1564263">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1564343">func</span>&nbsp;<span class="op" id="1564348">(</span><span class="ident" id="1564349">b</span>&nbsp;<span class="op" id="1564351">*</span><span class="ident" id="1564352">Buffer</span><span class="op" id="1564358">)</span>&nbsp;<span class="ident" id="1564360">readSlice</span><span class="op" id="1564369">(</span><span class="ident" id="1564370">delim</span>&nbsp;<span class="builtintype" id="1564376">byte</span><span class="op" id="1564380">)</span>&nbsp;<span class="op" id="1564382">(</span><span class="ident" id="1564383">line</span>&nbsp;<span class="op" id="1564388">[</span><span class="op" id="1564389">]</span><span class="builtintype" id="1564390">byte</span><span class="op" id="1564394">,</span>&nbsp;<span class="ident" id="1564396">err</span>&nbsp;<span class="builtintype" id="1564400">error</span><span class="op" id="1564405">)</span>&nbsp;<span class="op" id="1564407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564410">i</span>&nbsp;<span class="op" id="1564412">:=</span>&nbsp;<span class="ident" id="1564415">IndexByte</span><span class="op" id="1564424">(</span><span class="ident" id="1564425">b</span><span class="op" id="1564426">.</span><span class="ident" id="1564427">buf</span><span class="op" id="1564430">[</span><span class="ident" id="1564431">b</span><span class="op" id="1564432">.</span><span class="ident" id="1564433">off</span><span class="op" id="1564436">:</span><span class="op" id="1564437">]</span><span class="op" id="1564438">,</span>&nbsp;<span class="ident" id="1564440">delim</span><span class="op" id="1564445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564448">end</span>&nbsp;<span class="op" id="1564452">:=</span>&nbsp;<span class="ident" id="1564455">b</span><span class="op" id="1564456">.</span><span class="ident" id="1564457">off</span>&nbsp;<span class="op" id="1564461">+</span>&nbsp;<span class="ident" id="1564463">i</span>&nbsp;<span class="op" id="1564465">+</span>&nbsp;<span class="num" id="1564467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564470">if</span>&nbsp;<span class="ident" id="1564473">i</span>&nbsp;<span class="op" id="1564475">&lt;</span>&nbsp;<span class="num" id="1564477">0</span>&nbsp;<span class="op" id="1564479">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564483">end</span>&nbsp;<span class="op" id="1564487">=</span>&nbsp;<span class="builtinfunc" id="1564489">len</span><span class="op" id="1564492">(</span><span class="ident" id="1564493">b</span><span class="op" id="1564494">.</span><span class="ident" id="1564495">buf</span><span class="op" id="1564498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564502">err</span>&nbsp;<span class="op" id="1564506">=</span>&nbsp;<span class="ident" id="1564508">io</span><span class="op" id="1564510">.</span><span class="ident" id="1564511">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564519">line</span>&nbsp;<span class="op" id="1564524">=</span>&nbsp;<span class="ident" id="1564526">b</span><span class="op" id="1564527">.</span><span class="ident" id="1564528">buf</span><span class="op" id="1564531">[</span><span class="ident" id="1564532">b</span><span class="op" id="1564533">.</span><span class="ident" id="1564534">off</span><span class="op" id="1564537">:</span><span class="ident" id="1564538">end</span><span class="op" id="1564541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564544">b</span><span class="op" id="1564545">.</span><span class="ident" id="1564546">off</span>&nbsp;<span class="op" id="1564550">=</span>&nbsp;<span class="ident" id="1564552">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564557">b</span><span class="op" id="1564558">.</span><span class="ident" id="1564559">lastRead</span>&nbsp;<span class="op" id="1564568">=</span>&nbsp;<span class="ident" id="1564570">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564578">return</span>&nbsp;<span class="ident" id="1564585">line</span><span class="op" id="1564589">,</span>&nbsp;<span class="ident" id="1564591">err</span><br>
<span class="lineno"></span><span class="op" id="1564595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1564598">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1564668">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1564745">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1564810">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1564892">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1564971">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1564984">func</span>&nbsp;<span class="op" id="1564989">(</span><span class="ident" id="1564990">b</span>&nbsp;<span class="op" id="1564992">*</span><span class="ident" id="1564993">Buffer</span><span class="op" id="1564999">)</span>&nbsp;<span class="ident" id="1565001">ReadString</span><span class="op" id="1565011">(</span><span class="ident" id="1565012">delim</span>&nbsp;<span class="builtintype" id="1565018">byte</span><span class="op" id="1565022">)</span>&nbsp;<span class="op" id="1565024">(</span><span class="ident" id="1565025">line</span>&nbsp;<span class="builtintype" id="1565030">string</span><span class="op" id="1565036">,</span>&nbsp;<span class="ident" id="1565038">err</span>&nbsp;<span class="builtintype" id="1565042">error</span><span class="op" id="1565047">)</span>&nbsp;<span class="op" id="1565049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1565052">slice</span><span class="op" id="1565057">,</span>&nbsp;<span class="ident" id="1565059">err</span>&nbsp;<span class="op" id="1565063">:=</span>&nbsp;<span class="ident" id="1565066">b</span><span class="op" id="1565067">.</span><span class="ident" id="1565068">readSlice</span><span class="op" id="1565077">(</span><span class="ident" id="1565078">delim</span><span class="op" id="1565083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565086">return</span>&nbsp;<span class="builtintype" id="1565093">string</span><span class="op" id="1565099">(</span><span class="ident" id="1565100">slice</span><span class="op" id="1565105">)</span><span class="op" id="1565106">,</span>&nbsp;<span class="ident" id="1565108">err</span><br>
<span class="lineno"></span><span class="op" id="1565112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1565115">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1565190">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1565266">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1565339">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1565401">//</span><br>
<span class="lineno">400</span><span class="comment" id="1565404">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1565475">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1565513">func</span>&nbsp;<span class="ident" id="1565518">NewBuffer</span><span class="op" id="1565527">(</span><span class="ident" id="1565528">buf</span>&nbsp;<span class="op" id="1565532">[</span><span class="op" id="1565533">]</span><span class="builtintype" id="1565534">byte</span><span class="op" id="1565538">)</span>&nbsp;<span class="op" id="1565540">*</span><span class="ident" id="1565541">Buffer</span>&nbsp;<span class="op" id="1565548">{</span>&nbsp;<span class="keyword" id="1565550">return</span>&nbsp;<span class="op" id="1565557">&amp;</span><span class="ident" id="1565558">Buffer</span><span class="op" id="1565564">{</span><span class="ident" id="1565565">buf</span><span class="op" id="1565568">:</span>&nbsp;<span class="ident" id="1565570">buf</span><span class="op" id="1565573">}</span>&nbsp;<span class="op" id="1565575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1565578">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1565656">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1565732">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1565743">//</span><br>
<span class="lineno"></span><span class="comment" id="1565746">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1565817">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1565855">func</span>&nbsp;<span class="ident" id="1565860">NewBufferString</span><span class="op" id="1565875">(</span><span class="ident" id="1565876">s</span>&nbsp;<span class="builtintype" id="1565878">string</span><span class="op" id="1565884">)</span>&nbsp;<span class="op" id="1565886">*</span><span class="ident" id="1565887">Buffer</span>&nbsp;<span class="op" id="1565894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565897">return</span>&nbsp;<span class="op" id="1565904">&amp;</span><span class="ident" id="1565905">Buffer</span><span class="op" id="1565911">{</span><span class="ident" id="1565912">buf</span><span class="op" id="1565915">:</span>&nbsp;<span class="op" id="1565917">[</span><span class="op" id="1565918">]</span><span class="builtintype" id="1565919">byte</span><span class="op" id="1565923">(</span><span class="ident" id="1565924">s</span><span class="op" id="1565925">)</span><span class="op" id="1565926">}</span><br>
<span class="lineno"></span><span class="op" id="1565928">}</span>
</div>
</body>
</html>
