<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html" class="current">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4023284">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4023339">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4023393">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4023444">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4024098">package</span>&nbsp;<span class="ident" id="4024106">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024112">import</span>&nbsp;<span class="op" id="4024119">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4024122">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4024139">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4024146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4024149">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4024162">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4024227">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4024288">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4024332">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4024376">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024424">type</span>&nbsp;<span class="ident" id="4024429">hmac</span>&nbsp;<span class="keyword" id="4024434">struct</span>&nbsp;<span class="op" id="4024441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024444">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4024457">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024462">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4024475">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024480">key</span><span class="op" id="4024483">,</span>&nbsp;<span class="ident" id="4024485">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4024493">[</span><span class="op" id="4024494">]</span><span class="builtintype" id="4024495">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024501">outer</span><span class="op" id="4024506">,</span>&nbsp;<span class="ident" id="4024508">inner</span>&nbsp;<span class="ident" id="4024514">hash</span><span class="op" id="4024518">.</span><span class="ident" id="4024519">Hash</span><br>
<span class="lineno"></span><span class="op" id="4024524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024527">func</span>&nbsp;<span class="op" id="4024532">(</span><span class="ident" id="4024533">h</span>&nbsp;<span class="op" id="4024535">*</span><span class="ident" id="4024536">hmac</span><span class="op" id="4024540">)</span>&nbsp;<span class="ident" id="4024542">tmpPad</span><span class="op" id="4024548">(</span><span class="ident" id="4024549">xor</span>&nbsp;<span class="builtintype" id="4024553">byte</span><span class="op" id="4024557">)</span>&nbsp;<span class="op" id="4024559">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4024562">for</span>&nbsp;<span class="ident" id="4024566">i</span><span class="op" id="4024567">,</span>&nbsp;<span class="ident" id="4024569">k</span>&nbsp;<span class="op" id="4024571">:=</span>&nbsp;<span class="keyword" id="4024574">range</span>&nbsp;<span class="ident" id="4024580">h</span><span class="op" id="4024581">.</span><span class="ident" id="4024582">key</span>&nbsp;<span class="op" id="4024586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024590">h</span><span class="op" id="4024591">.</span><span class="ident" id="4024592">tmp</span><span class="op" id="4024595">[</span><span class="ident" id="4024596">i</span><span class="op" id="4024597">]</span>&nbsp;<span class="op" id="4024599">=</span>&nbsp;<span class="ident" id="4024601">xor</span>&nbsp;<span class="op" id="4024605">^</span>&nbsp;<span class="ident" id="4024607">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4024610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4024613">for</span>&nbsp;<span class="ident" id="4024617">i</span>&nbsp;<span class="op" id="4024619">:=</span>&nbsp;<span class="builtinfunc" id="4024622">len</span><span class="op" id="4024625">(</span><span class="ident" id="4024626">h</span><span class="op" id="4024627">.</span><span class="ident" id="4024628">key</span><span class="op" id="4024631">)</span><span class="op" id="4024632">;</span>&nbsp;<span class="ident" id="4024634">i</span>&nbsp;<span class="op" id="4024636">&lt;</span>&nbsp;<span class="ident" id="4024638">h</span><span class="op" id="4024639">.</span><span class="ident" id="4024640">blocksize</span><span class="op" id="4024649">;</span>&nbsp;<span class="ident" id="4024651">i</span><span class="op" id="4024652">++</span>&nbsp;<span class="op" id="4024655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024659">h</span><span class="op" id="4024660">.</span><span class="ident" id="4024661">tmp</span><span class="op" id="4024664">[</span><span class="ident" id="4024665">i</span><span class="op" id="4024666">]</span>&nbsp;<span class="op" id="4024668">=</span>&nbsp;<span class="ident" id="4024670">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4024675">}</span><br>
<span class="lineno"></span><span class="op" id="4024677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024680">func</span>&nbsp;<span class="op" id="4024685">(</span><span class="ident" id="4024686">h</span>&nbsp;<span class="op" id="4024688">*</span><span class="ident" id="4024689">hmac</span><span class="op" id="4024693">)</span>&nbsp;<span class="ident" id="4024695">Sum</span><span class="op" id="4024698">(</span><span class="ident" id="4024699">in</span>&nbsp;<span class="op" id="4024702">[</span><span class="op" id="4024703">]</span><span class="builtintype" id="4024704">byte</span><span class="op" id="4024708">)</span>&nbsp;<span class="op" id="4024710">[</span><span class="op" id="4024711">]</span><span class="builtintype" id="4024712">byte</span>&nbsp;<span class="op" id="4024717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024720">origLen</span>&nbsp;<span class="op" id="4024728">:=</span>&nbsp;<span class="builtinfunc" id="4024731">len</span><span class="op" id="4024734">(</span><span class="ident" id="4024735">in</span><span class="op" id="4024737">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024740">in</span>&nbsp;<span class="op" id="4024743">=</span>&nbsp;<span class="ident" id="4024745">h</span><span class="op" id="4024746">.</span><span class="ident" id="4024747">inner</span><span class="op" id="4024752">.</span><span class="ident" id="4024753">Sum</span><span class="op" id="4024756">(</span><span class="ident" id="4024757">in</span><span class="op" id="4024759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024762">h</span><span class="op" id="4024763">.</span><span class="ident" id="4024764">tmpPad</span><span class="op" id="4024770">(</span><span class="num" id="4024771">0x5c</span><span class="op" id="4024775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4024778">copy</span><span class="op" id="4024782">(</span><span class="ident" id="4024783">h</span><span class="op" id="4024784">.</span><span class="ident" id="4024785">tmp</span><span class="op" id="4024788">[</span><span class="ident" id="4024789">h</span><span class="op" id="4024790">.</span><span class="ident" id="4024791">blocksize</span><span class="op" id="4024800">:</span><span class="op" id="4024801">]</span><span class="op" id="4024802">,</span>&nbsp;<span class="ident" id="4024804">in</span><span class="op" id="4024806">[</span><span class="ident" id="4024807">origLen</span><span class="op" id="4024814">:</span><span class="op" id="4024815">]</span><span class="op" id="4024816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024819">h</span><span class="op" id="4024820">.</span><span class="ident" id="4024821">outer</span><span class="op" id="4024826">.</span><span class="ident" id="4024827">Reset</span><span class="op" id="4024832">(</span><span class="op" id="4024833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4024836">h</span><span class="op" id="4024837">.</span><span class="ident" id="4024838">outer</span><span class="op" id="4024843">.</span><span class="ident" id="4024844">Write</span><span class="op" id="4024849">(</span><span class="ident" id="4024850">h</span><span class="op" id="4024851">.</span><span class="ident" id="4024852">tmp</span><span class="op" id="4024855">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4024858">return</span>&nbsp;<span class="ident" id="4024865">h</span><span class="op" id="4024866">.</span><span class="ident" id="4024867">outer</span><span class="op" id="4024872">.</span><span class="ident" id="4024873">Sum</span><span class="op" id="4024876">(</span><span class="ident" id="4024877">in</span><span class="op" id="4024879">[</span><span class="op" id="4024880">:</span><span class="ident" id="4024881">origLen</span><span class="op" id="4024888">]</span><span class="op" id="4024889">)</span><br>
<span class="lineno"></span><span class="op" id="4024891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024894">func</span>&nbsp;<span class="op" id="4024899">(</span><span class="ident" id="4024900">h</span>&nbsp;<span class="op" id="4024902">*</span><span class="ident" id="4024903">hmac</span><span class="op" id="4024907">)</span>&nbsp;<span class="ident" id="4024909">Write</span><span class="op" id="4024914">(</span><span class="ident" id="4024915">p</span>&nbsp;<span class="op" id="4024917">[</span><span class="op" id="4024918">]</span><span class="builtintype" id="4024919">byte</span><span class="op" id="4024923">)</span>&nbsp;<span class="op" id="4024925">(</span><span class="ident" id="4024926">n</span>&nbsp;<span class="builtintype" id="4024928">int</span><span class="op" id="4024931">,</span>&nbsp;<span class="ident" id="4024933">err</span>&nbsp;<span class="builtintype" id="4024937">error</span><span class="op" id="4024942">)</span>&nbsp;<span class="op" id="4024944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4024947">return</span>&nbsp;<span class="ident" id="4024954">h</span><span class="op" id="4024955">.</span><span class="ident" id="4024956">inner</span><span class="op" id="4024961">.</span><span class="ident" id="4024962">Write</span><span class="op" id="4024967">(</span><span class="ident" id="4024968">p</span><span class="op" id="4024969">)</span><br>
<span class="lineno">65</span><span class="op" id="4024971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024974">func</span>&nbsp;<span class="op" id="4024979">(</span><span class="ident" id="4024980">h</span>&nbsp;<span class="op" id="4024982">*</span><span class="ident" id="4024983">hmac</span><span class="op" id="4024987">)</span>&nbsp;<span class="ident" id="4024989">Size</span><span class="op" id="4024993">(</span><span class="op" id="4024994">)</span>&nbsp;<span class="builtintype" id="4024996">int</span>&nbsp;<span class="op" id="4025000">{</span>&nbsp;<span class="keyword" id="4025002">return</span>&nbsp;<span class="ident" id="4025009">h</span><span class="op" id="4025010">.</span><span class="ident" id="4025011">size</span>&nbsp;<span class="op" id="4025016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4025019">func</span>&nbsp;<span class="op" id="4025024">(</span><span class="ident" id="4025025">h</span>&nbsp;<span class="op" id="4025027">*</span><span class="ident" id="4025028">hmac</span><span class="op" id="4025032">)</span>&nbsp;<span class="ident" id="4025034">BlockSize</span><span class="op" id="4025043">(</span><span class="op" id="4025044">)</span>&nbsp;<span class="builtintype" id="4025046">int</span>&nbsp;<span class="op" id="4025050">{</span>&nbsp;<span class="keyword" id="4025052">return</span>&nbsp;<span class="ident" id="4025059">h</span><span class="op" id="4025060">.</span><span class="ident" id="4025061">blocksize</span>&nbsp;<span class="op" id="4025071">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4025074">func</span>&nbsp;<span class="op" id="4025079">(</span><span class="ident" id="4025080">h</span>&nbsp;<span class="op" id="4025082">*</span><span class="ident" id="4025083">hmac</span><span class="op" id="4025087">)</span>&nbsp;<span class="ident" id="4025089">Reset</span><span class="op" id="4025094">(</span><span class="op" id="4025095">)</span>&nbsp;<span class="op" id="4025097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025100">h</span><span class="op" id="4025101">.</span><span class="ident" id="4025102">inner</span><span class="op" id="4025107">.</span><span class="ident" id="4025108">Reset</span><span class="op" id="4025113">(</span><span class="op" id="4025114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025117">h</span><span class="op" id="4025118">.</span><span class="ident" id="4025119">tmpPad</span><span class="op" id="4025125">(</span><span class="num" id="4025126">0x36</span><span class="op" id="4025130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025133">h</span><span class="op" id="4025134">.</span><span class="ident" id="4025135">inner</span><span class="op" id="4025140">.</span><span class="ident" id="4025141">Write</span><span class="op" id="4025146">(</span><span class="ident" id="4025147">h</span><span class="op" id="4025148">.</span><span class="ident" id="4025149">tmp</span><span class="op" id="4025152">[</span><span class="op" id="4025153">:</span><span class="ident" id="4025154">h</span><span class="op" id="4025155">.</span><span class="ident" id="4025156">blocksize</span><span class="op" id="4025165">]</span><span class="op" id="4025166">)</span><br>
<span class="lineno">75</span><span class="op" id="4025168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4025171">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4025242">func</span>&nbsp;<span class="ident" id="4025247">New</span><span class="op" id="4025250">(</span><span class="ident" id="4025251">h</span>&nbsp;<span class="keyword" id="4025253">func</span><span class="op" id="4025257">(</span><span class="op" id="4025258">)</span>&nbsp;<span class="ident" id="4025260">hash</span><span class="op" id="4025264">.</span><span class="ident" id="4025265">Hash</span><span class="op" id="4025269">,</span>&nbsp;<span class="ident" id="4025271">key</span>&nbsp;<span class="op" id="4025275">[</span><span class="op" id="4025276">]</span><span class="builtintype" id="4025277">byte</span><span class="op" id="4025281">)</span>&nbsp;<span class="ident" id="4025283">hash</span><span class="op" id="4025287">.</span><span class="ident" id="4025288">Hash</span>&nbsp;<span class="op" id="4025293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025296">hm</span>&nbsp;<span class="op" id="4025299">:=</span>&nbsp;<span class="builtinfunc" id="4025302">new</span><span class="op" id="4025305">(</span><span class="ident" id="4025306">hmac</span><span class="op" id="4025310">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025313">hm</span><span class="op" id="4025315">.</span><span class="ident" id="4025316">outer</span>&nbsp;<span class="op" id="4025322">=</span>&nbsp;<span class="ident" id="4025324">h</span><span class="op" id="4025325">(</span><span class="op" id="4025326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025329">hm</span><span class="op" id="4025331">.</span><span class="ident" id="4025332">inner</span>&nbsp;<span class="op" id="4025338">=</span>&nbsp;<span class="ident" id="4025340">h</span><span class="op" id="4025341">(</span><span class="op" id="4025342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025345">hm</span><span class="op" id="4025347">.</span><span class="ident" id="4025348">size</span>&nbsp;<span class="op" id="4025353">=</span>&nbsp;<span class="ident" id="4025355">hm</span><span class="op" id="4025357">.</span><span class="ident" id="4025358">inner</span><span class="op" id="4025363">.</span><span class="ident" id="4025364">Size</span><span class="op" id="4025368">(</span><span class="op" id="4025369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025372">hm</span><span class="op" id="4025374">.</span><span class="ident" id="4025375">blocksize</span>&nbsp;<span class="op" id="4025385">=</span>&nbsp;<span class="ident" id="4025387">hm</span><span class="op" id="4025389">.</span><span class="ident" id="4025390">inner</span><span class="op" id="4025395">.</span><span class="ident" id="4025396">BlockSize</span><span class="op" id="4025405">(</span><span class="op" id="4025406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025409">hm</span><span class="op" id="4025411">.</span><span class="ident" id="4025412">tmp</span>&nbsp;<span class="op" id="4025416">=</span>&nbsp;<span class="builtinfunc" id="4025418">make</span><span class="op" id="4025422">(</span><span class="op" id="4025423">[</span><span class="op" id="4025424">]</span><span class="builtintype" id="4025425">byte</span><span class="op" id="4025429">,</span>&nbsp;<span class="ident" id="4025431">hm</span><span class="op" id="4025433">.</span><span class="ident" id="4025434">blocksize</span><span class="op" id="4025443">+</span><span class="ident" id="4025444">hm</span><span class="op" id="4025446">.</span><span class="ident" id="4025447">size</span><span class="op" id="4025451">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4025454">if</span>&nbsp;<span class="builtinfunc" id="4025457">len</span><span class="op" id="4025460">(</span><span class="ident" id="4025461">key</span><span class="op" id="4025464">)</span>&nbsp;<span class="op" id="4025466">&gt;</span>&nbsp;<span class="ident" id="4025468">hm</span><span class="op" id="4025470">.</span><span class="ident" id="4025471">blocksize</span>&nbsp;<span class="op" id="4025481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4025485">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025518">hm</span><span class="op" id="4025520">.</span><span class="ident" id="4025521">outer</span><span class="op" id="4025526">.</span><span class="ident" id="4025527">Write</span><span class="op" id="4025532">(</span><span class="ident" id="4025533">key</span><span class="op" id="4025536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025540">key</span>&nbsp;<span class="op" id="4025544">=</span>&nbsp;<span class="ident" id="4025546">hm</span><span class="op" id="4025548">.</span><span class="ident" id="4025549">outer</span><span class="op" id="4025554">.</span><span class="ident" id="4025555">Sum</span><span class="op" id="4025558">(</span><span class="ident" id="4025559">nil</span><span class="op" id="4025562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4025565">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025568">hm</span><span class="op" id="4025570">.</span><span class="ident" id="4025571">key</span>&nbsp;<span class="op" id="4025575">=</span>&nbsp;<span class="builtinfunc" id="4025577">make</span><span class="op" id="4025581">(</span><span class="op" id="4025582">[</span><span class="op" id="4025583">]</span><span class="builtintype" id="4025584">byte</span><span class="op" id="4025588">,</span>&nbsp;<span class="builtinfunc" id="4025590">len</span><span class="op" id="4025593">(</span><span class="ident" id="4025594">key</span><span class="op" id="4025597">)</span><span class="op" id="4025598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4025601">copy</span><span class="op" id="4025605">(</span><span class="ident" id="4025606">hm</span><span class="op" id="4025608">.</span><span class="ident" id="4025609">key</span><span class="op" id="4025612">,</span>&nbsp;<span class="ident" id="4025614">key</span><span class="op" id="4025617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4025620">hm</span><span class="op" id="4025622">.</span><span class="ident" id="4025623">Reset</span><span class="op" id="4025628">(</span><span class="op" id="4025629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4025632">return</span>&nbsp;<span class="ident" id="4025639">hm</span><br>
<span class="lineno"></span><span class="op" id="4025642">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4025645">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4025721">func</span>&nbsp;<span class="ident" id="4025726">Equal</span><span class="op" id="4025731">(</span><span class="ident" id="4025732">mac1</span><span class="op" id="4025736">,</span>&nbsp;<span class="ident" id="4025738">mac2</span>&nbsp;<span class="op" id="4025743">[</span><span class="op" id="4025744">]</span><span class="builtintype" id="4025745">byte</span><span class="op" id="4025749">)</span>&nbsp;<span class="builtintype" id="4025751">bool</span>&nbsp;<span class="op" id="4025756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4025759">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4025828">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4025901">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4025915">return</span>&nbsp;<span class="builtinfunc" id="4025922">len</span><span class="op" id="4025925">(</span><span class="ident" id="4025926">mac1</span><span class="op" id="4025930">)</span>&nbsp;<span class="op" id="4025932">==</span>&nbsp;<span class="builtinfunc" id="4025935">len</span><span class="op" id="4025938">(</span><span class="ident" id="4025939">mac2</span><span class="op" id="4025943">)</span>&nbsp;<span class="op" id="4025945">&amp;&amp;</span>&nbsp;<span class="ident" id="4025948">subtle</span><span class="op" id="4025954">.</span><span class="ident" id="4025955">ConstantTimeCompare</span><span class="op" id="4025974">(</span><span class="ident" id="4025975">mac1</span><span class="op" id="4025979">,</span>&nbsp;<span class="ident" id="4025981">mac2</span><span class="op" id="4025985">)</span>&nbsp;<span class="op" id="4025987">==</span>&nbsp;<span class="num" id="4025990">1</span><br>
<span class="lineno"></span><span class="op" id="4025992">}</span>
</div>
</body>
</html>
