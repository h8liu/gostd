<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3387807">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3387862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3387916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3387967">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3388040">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3388055">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3388127">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3388201">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3388250">package</span>&nbsp;<span class="ident" id="3388258">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388269">import</span>&nbsp;<span class="op" id="3388276">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3388279">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3388288">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3388297">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3388304">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3388309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3388312">type</span>&nbsp;<span class="ident" id="3388317">qpReader</span>&nbsp;<span class="keyword" id="3388326">struct</span>&nbsp;<span class="op" id="3388333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388336">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3388341">*</span><span class="ident" id="3388342">bufio</span><span class="op" id="3388347">.</span><span class="ident" id="3388348">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388356">rerr</span>&nbsp;<span class="builtintype" id="3388361">error</span>&nbsp;&nbsp;<span class="comment" id="3388368">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388388">line</span>&nbsp;<span class="op" id="3388393">[</span><span class="op" id="3388394">]</span><span class="builtintype" id="3388395">byte</span>&nbsp;<span class="comment" id="3388400">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3388436">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3388439">func</span>&nbsp;<span class="ident" id="3388444">newQuotedPrintableReader</span><span class="op" id="3388468">(</span><span class="ident" id="3388469">r</span>&nbsp;<span class="ident" id="3388471">io</span><span class="op" id="3388473">.</span><span class="ident" id="3388474">Reader</span><span class="op" id="3388480">)</span>&nbsp;<span class="ident" id="3388482">io</span><span class="op" id="3388484">.</span><span class="ident" id="3388485">Reader</span>&nbsp;<span class="op" id="3388492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388495">return</span>&nbsp;<span class="op" id="3388502">&amp;</span><span class="ident" id="3388503">qpReader</span><span class="op" id="3388511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388515">br</span><span class="op" id="3388517">:</span>&nbsp;<span class="ident" id="3388519">bufio</span><span class="op" id="3388524">.</span><span class="ident" id="3388525">NewReader</span><span class="op" id="3388534">(</span><span class="ident" id="3388535">r</span><span class="op" id="3388536">)</span><span class="op" id="3388537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388540">}</span><br>
<span class="lineno">30</span><span class="op" id="3388542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388545">func</span>&nbsp;<span class="ident" id="3388550">fromHex</span><span class="op" id="3388557">(</span><span class="ident" id="3388558">b</span>&nbsp;<span class="builtintype" id="3388560">byte</span><span class="op" id="3388564">)</span>&nbsp;<span class="op" id="3388566">(</span><span class="builtintype" id="3388567">byte</span><span class="op" id="3388571">,</span>&nbsp;<span class="builtintype" id="3388573">error</span><span class="op" id="3388578">)</span>&nbsp;<span class="op" id="3388580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388583">switch</span>&nbsp;<span class="op" id="3388590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388593">case</span>&nbsp;<span class="ident" id="3388598">b</span>&nbsp;<span class="op" id="3388600">&gt;=</span>&nbsp;<span class="string" id="3388603">&#39;0&#39;</span>&nbsp;<span class="op" id="3388607">&amp;&amp;</span>&nbsp;<span class="ident" id="3388610">b</span>&nbsp;<span class="op" id="3388612">&lt;=</span>&nbsp;<span class="string" id="3388615">&#39;9&#39;</span><span class="op" id="3388618">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388622">return</span>&nbsp;<span class="ident" id="3388629">b</span>&nbsp;<span class="op" id="3388631">-</span>&nbsp;<span class="string" id="3388633">&#39;0&#39;</span><span class="op" id="3388636">,</span>&nbsp;<span class="ident" id="3388638">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388643">case</span>&nbsp;<span class="ident" id="3388648">b</span>&nbsp;<span class="op" id="3388650">&gt;=</span>&nbsp;<span class="string" id="3388653">&#39;A&#39;</span>&nbsp;<span class="op" id="3388657">&amp;&amp;</span>&nbsp;<span class="ident" id="3388660">b</span>&nbsp;<span class="op" id="3388662">&lt;=</span>&nbsp;<span class="string" id="3388665">&#39;F&#39;</span><span class="op" id="3388668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388672">return</span>&nbsp;<span class="ident" id="3388679">b</span>&nbsp;<span class="op" id="3388681">-</span>&nbsp;<span class="string" id="3388683">&#39;A&#39;</span>&nbsp;<span class="op" id="3388687">+</span>&nbsp;<span class="num" id="3388689">10</span><span class="op" id="3388691">,</span>&nbsp;<span class="ident" id="3388693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388701">return</span>&nbsp;<span class="num" id="3388708">0</span><span class="op" id="3388709">,</span>&nbsp;<span class="ident" id="3388711">fmt</span><span class="op" id="3388714">.</span><span class="ident" id="3388715">Errorf</span><span class="op" id="3388721">(</span><span class="string" id="3388722">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3388775">,</span>&nbsp;<span class="ident" id="3388777">b</span><span class="op" id="3388778">)</span><br>
<span class="lineno">40</span><span class="op" id="3388780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388783">func</span>&nbsp;<span class="op" id="3388788">(</span><span class="ident" id="3388789">q</span>&nbsp;<span class="op" id="3388791">*</span><span class="ident" id="3388792">qpReader</span><span class="op" id="3388800">)</span>&nbsp;<span class="ident" id="3388802">readHexByte</span><span class="op" id="3388813">(</span><span class="ident" id="3388814">v</span>&nbsp;<span class="op" id="3388816">[</span><span class="op" id="3388817">]</span><span class="builtintype" id="3388818">byte</span><span class="op" id="3388822">)</span>&nbsp;<span class="op" id="3388824">(</span><span class="ident" id="3388825">b</span>&nbsp;<span class="builtintype" id="3388827">byte</span><span class="op" id="3388831">,</span>&nbsp;<span class="ident" id="3388833">err</span>&nbsp;<span class="builtintype" id="3388837">error</span><span class="op" id="3388842">)</span>&nbsp;<span class="op" id="3388844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388847">if</span>&nbsp;<span class="builtinfunc" id="3388850">len</span><span class="op" id="3388853">(</span><span class="ident" id="3388854">v</span><span class="op" id="3388855">)</span>&nbsp;<span class="op" id="3388857">&lt;</span>&nbsp;<span class="num" id="3388859">2</span>&nbsp;<span class="op" id="3388861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388865">return</span>&nbsp;<span class="num" id="3388872">0</span><span class="op" id="3388873">,</span>&nbsp;<span class="ident" id="3388875">io</span><span class="op" id="3388877">.</span><span class="ident" id="3388878">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388899">var</span>&nbsp;<span class="ident" id="3388903">hb</span><span class="op" id="3388905">,</span>&nbsp;<span class="ident" id="3388907">lb</span>&nbsp;<span class="builtintype" id="3388910">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388916">if</span>&nbsp;<span class="ident" id="3388919">hb</span><span class="op" id="3388921">,</span>&nbsp;<span class="ident" id="3388923">err</span>&nbsp;<span class="op" id="3388927">=</span>&nbsp;<span class="ident" id="3388929">fromHex</span><span class="op" id="3388936">(</span><span class="ident" id="3388937">v</span><span class="op" id="3388938">[</span><span class="num" id="3388939">0</span><span class="op" id="3388940">]</span><span class="op" id="3388941">)</span><span class="op" id="3388942">;</span>&nbsp;<span class="ident" id="3388944">err</span>&nbsp;<span class="op" id="3388948">!=</span>&nbsp;<span class="ident" id="3388951">nil</span>&nbsp;<span class="op" id="3388955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388959">return</span>&nbsp;<span class="num" id="3388966">0</span><span class="op" id="3388967">,</span>&nbsp;<span class="ident" id="3388969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388974">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388977">if</span>&nbsp;<span class="ident" id="3388980">lb</span><span class="op" id="3388982">,</span>&nbsp;<span class="ident" id="3388984">err</span>&nbsp;<span class="op" id="3388988">=</span>&nbsp;<span class="ident" id="3388990">fromHex</span><span class="op" id="3388997">(</span><span class="ident" id="3388998">v</span><span class="op" id="3388999">[</span><span class="num" id="3389000">1</span><span class="op" id="3389001">]</span><span class="op" id="3389002">)</span><span class="op" id="3389003">;</span>&nbsp;<span class="ident" id="3389005">err</span>&nbsp;<span class="op" id="3389009">!=</span>&nbsp;<span class="ident" id="3389012">nil</span>&nbsp;<span class="op" id="3389016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389020">return</span>&nbsp;<span class="num" id="3389027">0</span><span class="op" id="3389028">,</span>&nbsp;<span class="ident" id="3389030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389038">return</span>&nbsp;<span class="ident" id="3389045">hb</span><span class="op" id="3389047">&lt;&lt;</span><span class="num" id="3389049">4</span>&nbsp;<span class="op" id="3389051">|</span>&nbsp;<span class="ident" id="3389053">lb</span><span class="op" id="3389055">,</span>&nbsp;<span class="ident" id="3389057">nil</span><br>
<span class="lineno"></span><span class="op" id="3389061">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3389064">func</span>&nbsp;<span class="ident" id="3389069">isQPDiscardWhitespace</span><span class="op" id="3389090">(</span><span class="ident" id="3389091">r</span>&nbsp;<span class="builtintype" id="3389093">rune</span><span class="op" id="3389097">)</span>&nbsp;<span class="builtintype" id="3389099">bool</span>&nbsp;<span class="op" id="3389104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389107">switch</span>&nbsp;<span class="ident" id="3389114">r</span>&nbsp;<span class="op" id="3389116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389119">case</span>&nbsp;<span class="string" id="3389124">&#39;\n&#39;</span><span class="op" id="3389128">,</span>&nbsp;<span class="string" id="3389130">&#39;\r&#39;</span><span class="op" id="3389134">,</span>&nbsp;<span class="string" id="3389136">&#39;&nbsp;&#39;</span><span class="op" id="3389139">,</span>&nbsp;<span class="string" id="3389141">&#39;\t&#39;</span><span class="op" id="3389145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389149">return</span>&nbsp;<span class="builtintype" id="3389156">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389165">return</span>&nbsp;<span class="builtintype" id="3389172">false</span><br>
<span class="lineno"></span><span class="op" id="3389178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3389181">var</span>&nbsp;<span class="op" id="3389185">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389188">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389199">=</span>&nbsp;<span class="op" id="3389201">[</span><span class="op" id="3389202">]</span><span class="builtintype" id="3389203">byte</span><span class="op" id="3389207">(</span><span class="string" id="3389208">&#34;\r\n&#34;</span><span class="op" id="3389214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389217">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389228">=</span>&nbsp;<span class="op" id="3389230">[</span><span class="op" id="3389231">]</span><span class="builtintype" id="3389232">byte</span><span class="op" id="3389236">(</span><span class="string" id="3389237">&#34;\n&#34;</span><span class="op" id="3389241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389244">softSuffix</span>&nbsp;<span class="op" id="3389255">=</span>&nbsp;<span class="op" id="3389257">[</span><span class="op" id="3389258">]</span><span class="builtintype" id="3389259">byte</span><span class="op" id="3389263">(</span><span class="string" id="3389264">&#34;=&#34;</span><span class="op" id="3389267">)</span><br>
<span class="lineno"></span><span class="op" id="3389269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3389272">func</span>&nbsp;<span class="op" id="3389277">(</span><span class="ident" id="3389278">q</span>&nbsp;<span class="op" id="3389280">*</span><span class="ident" id="3389281">qpReader</span><span class="op" id="3389289">)</span>&nbsp;<span class="ident" id="3389291">Read</span><span class="op" id="3389295">(</span><span class="ident" id="3389296">p</span>&nbsp;<span class="op" id="3389298">[</span><span class="op" id="3389299">]</span><span class="builtintype" id="3389300">byte</span><span class="op" id="3389304">)</span>&nbsp;<span class="op" id="3389306">(</span><span class="ident" id="3389307">n</span>&nbsp;<span class="builtintype" id="3389309">int</span><span class="op" id="3389312">,</span>&nbsp;<span class="ident" id="3389314">err</span>&nbsp;<span class="builtintype" id="3389318">error</span><span class="op" id="3389323">)</span>&nbsp;<span class="op" id="3389325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389328">for</span>&nbsp;<span class="builtinfunc" id="3389332">len</span><span class="op" id="3389335">(</span><span class="ident" id="3389336">p</span><span class="op" id="3389337">)</span>&nbsp;<span class="op" id="3389339">&gt;</span>&nbsp;<span class="num" id="3389341">0</span>&nbsp;<span class="op" id="3389343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389347">if</span>&nbsp;<span class="builtinfunc" id="3389350">len</span><span class="op" id="3389353">(</span><span class="ident" id="3389354">q</span><span class="op" id="3389355">.</span><span class="ident" id="3389356">line</span><span class="op" id="3389360">)</span>&nbsp;<span class="op" id="3389362">==</span>&nbsp;<span class="num" id="3389365">0</span>&nbsp;<span class="op" id="3389367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389372">if</span>&nbsp;<span class="ident" id="3389375">q</span><span class="op" id="3389376">.</span><span class="ident" id="3389377">rerr</span>&nbsp;<span class="op" id="3389382">!=</span>&nbsp;<span class="ident" id="3389385">nil</span>&nbsp;<span class="op" id="3389389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389395">return</span>&nbsp;<span class="ident" id="3389402">n</span><span class="op" id="3389403">,</span>&nbsp;<span class="ident" id="3389405">q</span><span class="op" id="3389406">.</span><span class="ident" id="3389407">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389420">q</span><span class="op" id="3389421">.</span><span class="ident" id="3389422">line</span><span class="op" id="3389426">,</span>&nbsp;<span class="ident" id="3389428">q</span><span class="op" id="3389429">.</span><span class="ident" id="3389430">rerr</span>&nbsp;<span class="op" id="3389435">=</span>&nbsp;<span class="ident" id="3389437">q</span><span class="op" id="3389438">.</span><span class="ident" id="3389439">br</span><span class="op" id="3389441">.</span><span class="ident" id="3389442">ReadSlice</span><span class="op" id="3389451">(</span><span class="string" id="3389452">&#39;\n&#39;</span><span class="op" id="3389456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389462">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389514">hasLF</span>&nbsp;<span class="op" id="3389520">:=</span>&nbsp;<span class="ident" id="3389523">bytes</span><span class="op" id="3389528">.</span><span class="ident" id="3389529">HasSuffix</span><span class="op" id="3389538">(</span><span class="ident" id="3389539">q</span><span class="op" id="3389540">.</span><span class="ident" id="3389541">line</span><span class="op" id="3389545">,</span>&nbsp;<span class="ident" id="3389547">lf</span><span class="op" id="3389549">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389554">hasCR</span>&nbsp;<span class="op" id="3389560">:=</span>&nbsp;<span class="ident" id="3389563">bytes</span><span class="op" id="3389568">.</span><span class="ident" id="3389569">HasSuffix</span><span class="op" id="3389578">(</span><span class="ident" id="3389579">q</span><span class="op" id="3389580">.</span><span class="ident" id="3389581">line</span><span class="op" id="3389585">,</span>&nbsp;<span class="ident" id="3389587">crlf</span><span class="op" id="3389591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389596">wholeLine</span>&nbsp;<span class="op" id="3389606">:=</span>&nbsp;<span class="ident" id="3389609">q</span><span class="op" id="3389610">.</span><span class="ident" id="3389611">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389619">q</span><span class="op" id="3389620">.</span><span class="ident" id="3389621">line</span>&nbsp;<span class="op" id="3389626">=</span>&nbsp;<span class="ident" id="3389628">bytes</span><span class="op" id="3389633">.</span><span class="ident" id="3389634">TrimRightFunc</span><span class="op" id="3389647">(</span><span class="ident" id="3389648">wholeLine</span><span class="op" id="3389657">,</span>&nbsp;<span class="ident" id="3389659">isQPDiscardWhitespace</span><span class="op" id="3389680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389685">if</span>&nbsp;<span class="ident" id="3389688">bytes</span><span class="op" id="3389693">.</span><span class="ident" id="3389694">HasSuffix</span><span class="op" id="3389703">(</span><span class="ident" id="3389704">q</span><span class="op" id="3389705">.</span><span class="ident" id="3389706">line</span><span class="op" id="3389710">,</span>&nbsp;<span class="ident" id="3389712">softSuffix</span><span class="op" id="3389722">)</span>&nbsp;<span class="op" id="3389724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389730">rightStripped</span>&nbsp;<span class="op" id="3389744">:=</span>&nbsp;<span class="ident" id="3389747">wholeLine</span><span class="op" id="3389756">[</span><span class="builtinfunc" id="3389757">len</span><span class="op" id="3389760">(</span><span class="ident" id="3389761">q</span><span class="op" id="3389762">.</span><span class="ident" id="3389763">line</span><span class="op" id="3389767">)</span><span class="op" id="3389768">:</span><span class="op" id="3389769">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389775">q</span><span class="op" id="3389776">.</span><span class="ident" id="3389777">line</span>&nbsp;<span class="op" id="3389782">=</span>&nbsp;<span class="ident" id="3389784">q</span><span class="op" id="3389785">.</span><span class="ident" id="3389786">line</span><span class="op" id="3389790">[</span><span class="op" id="3389791">:</span><span class="builtinfunc" id="3389792">len</span><span class="op" id="3389795">(</span><span class="ident" id="3389796">q</span><span class="op" id="3389797">.</span><span class="ident" id="3389798">line</span><span class="op" id="3389802">)</span><span class="op" id="3389803">-</span><span class="num" id="3389804">1</span><span class="op" id="3389805">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389811">if</span>&nbsp;<span class="op" id="3389814">!</span><span class="ident" id="3389815">bytes</span><span class="op" id="3389820">.</span><span class="ident" id="3389821">HasPrefix</span><span class="op" id="3389830">(</span><span class="ident" id="3389831">rightStripped</span><span class="op" id="3389844">,</span>&nbsp;<span class="ident" id="3389846">lf</span><span class="op" id="3389848">)</span>&nbsp;<span class="op" id="3389850">&amp;&amp;</span>&nbsp;<span class="op" id="3389853">!</span><span class="ident" id="3389854">bytes</span><span class="op" id="3389859">.</span><span class="ident" id="3389860">HasPrefix</span><span class="op" id="3389869">(</span><span class="ident" id="3389870">rightStripped</span><span class="op" id="3389883">,</span>&nbsp;<span class="ident" id="3389885">crlf</span><span class="op" id="3389889">)</span>&nbsp;<span class="op" id="3389891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389898">q</span><span class="op" id="3389899">.</span><span class="ident" id="3389900">rerr</span>&nbsp;<span class="op" id="3389905">=</span>&nbsp;<span class="ident" id="3389907">fmt</span><span class="op" id="3389910">.</span><span class="ident" id="3389911">Errorf</span><span class="op" id="3389917">(</span><span class="string" id="3389918">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3389956">,</span>&nbsp;<span class="ident" id="3389958">rightStripped</span><span class="op" id="3389971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389982">}</span>&nbsp;<span class="keyword" id="3389984">else</span>&nbsp;<span class="keyword" id="3389989">if</span>&nbsp;<span class="ident" id="3389992">hasLF</span>&nbsp;<span class="op" id="3389998">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390004">if</span>&nbsp;<span class="ident" id="3390007">hasCR</span>&nbsp;<span class="op" id="3390013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390020">q</span><span class="op" id="3390021">.</span><span class="ident" id="3390022">line</span>&nbsp;<span class="op" id="3390027">=</span>&nbsp;<span class="builtinfunc" id="3390029">append</span><span class="op" id="3390035">(</span><span class="ident" id="3390036">q</span><span class="op" id="3390037">.</span><span class="ident" id="3390038">line</span><span class="op" id="3390042">,</span>&nbsp;<span class="string" id="3390044">&#39;\r&#39;</span><span class="op" id="3390048">,</span>&nbsp;<span class="string" id="3390050">&#39;\n&#39;</span><span class="op" id="3390054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390060">}</span>&nbsp;<span class="keyword" id="3390062">else</span>&nbsp;<span class="op" id="3390067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390074">q</span><span class="op" id="3390075">.</span><span class="ident" id="3390076">line</span>&nbsp;<span class="op" id="3390081">=</span>&nbsp;<span class="builtinfunc" id="3390083">append</span><span class="op" id="3390089">(</span><span class="ident" id="3390090">q</span><span class="op" id="3390091">.</span><span class="ident" id="3390092">line</span><span class="op" id="3390096">,</span>&nbsp;<span class="string" id="3390098">&#39;\n&#39;</span><span class="op" id="3390102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390108">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390118">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390133">b</span>&nbsp;<span class="op" id="3390135">:=</span>&nbsp;<span class="ident" id="3390138">q</span><span class="op" id="3390139">.</span><span class="ident" id="3390140">line</span><span class="op" id="3390144">[</span><span class="num" id="3390145">0</span><span class="op" id="3390146">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390151">switch</span>&nbsp;<span class="op" id="3390158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390162">case</span>&nbsp;<span class="ident" id="3390167">b</span>&nbsp;<span class="op" id="3390169">==</span>&nbsp;<span class="string" id="3390172">&#39;=&#39;</span><span class="op" id="3390175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390180">b</span><span class="op" id="3390181">,</span>&nbsp;<span class="ident" id="3390183">err</span>&nbsp;<span class="op" id="3390187">=</span>&nbsp;<span class="ident" id="3390189">q</span><span class="op" id="3390190">.</span><span class="ident" id="3390191">readHexByte</span><span class="op" id="3390202">(</span><span class="ident" id="3390203">q</span><span class="op" id="3390204">.</span><span class="ident" id="3390205">line</span><span class="op" id="3390209">[</span><span class="num" id="3390210">1</span><span class="op" id="3390211">:</span><span class="op" id="3390212">]</span><span class="op" id="3390213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390218">if</span>&nbsp;<span class="ident" id="3390221">err</span>&nbsp;<span class="op" id="3390225">!=</span>&nbsp;<span class="ident" id="3390228">nil</span>&nbsp;<span class="op" id="3390232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390238">return</span>&nbsp;<span class="ident" id="3390245">n</span><span class="op" id="3390246">,</span>&nbsp;<span class="ident" id="3390248">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390260">q</span><span class="op" id="3390261">.</span><span class="ident" id="3390262">line</span>&nbsp;<span class="op" id="3390267">=</span>&nbsp;<span class="ident" id="3390269">q</span><span class="op" id="3390270">.</span><span class="ident" id="3390271">line</span><span class="op" id="3390275">[</span><span class="num" id="3390276">2</span><span class="op" id="3390277">:</span><span class="op" id="3390278">]</span>&nbsp;<span class="comment" id="3390280">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390319">case</span>&nbsp;<span class="ident" id="3390324">b</span>&nbsp;<span class="op" id="3390326">==</span>&nbsp;<span class="string" id="3390329">&#39;\t&#39;</span>&nbsp;<span class="op" id="3390334">||</span>&nbsp;<span class="ident" id="3390337">b</span>&nbsp;<span class="op" id="3390339">==</span>&nbsp;<span class="string" id="3390342">&#39;\r&#39;</span>&nbsp;<span class="op" id="3390347">||</span>&nbsp;<span class="ident" id="3390350">b</span>&nbsp;<span class="op" id="3390352">==</span>&nbsp;<span class="string" id="3390355">&#39;\n&#39;</span><span class="op" id="3390359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390364">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390372">case</span>&nbsp;<span class="ident" id="3390377">b</span>&nbsp;<span class="op" id="3390379">&lt;</span>&nbsp;<span class="string" id="3390381">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3390385">||</span>&nbsp;<span class="ident" id="3390388">b</span>&nbsp;<span class="op" id="3390390">&gt;</span>&nbsp;<span class="string" id="3390392">&#39;~&#39;</span><span class="op" id="3390395">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390400">return</span>&nbsp;<span class="ident" id="3390407">n</span><span class="op" id="3390408">,</span>&nbsp;<span class="ident" id="3390410">fmt</span><span class="op" id="3390413">.</span><span class="ident" id="3390414">Errorf</span><span class="op" id="3390420">(</span><span class="string" id="3390421">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3390488">,</span>&nbsp;<span class="ident" id="3390490">b</span><span class="op" id="3390491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390499">p</span><span class="op" id="3390500">[</span><span class="num" id="3390501">0</span><span class="op" id="3390502">]</span>&nbsp;<span class="op" id="3390504">=</span>&nbsp;<span class="ident" id="3390506">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390510">p</span>&nbsp;<span class="op" id="3390512">=</span>&nbsp;<span class="ident" id="3390514">p</span><span class="op" id="3390515">[</span><span class="num" id="3390516">1</span><span class="op" id="3390517">:</span><span class="op" id="3390518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390522">q</span><span class="op" id="3390523">.</span><span class="ident" id="3390524">line</span>&nbsp;<span class="op" id="3390529">=</span>&nbsp;<span class="ident" id="3390531">q</span><span class="op" id="3390532">.</span><span class="ident" id="3390533">line</span><span class="op" id="3390537">[</span><span class="num" id="3390538">1</span><span class="op" id="3390539">:</span><span class="op" id="3390540">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390544">n</span><span class="op" id="3390545">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390552">return</span>&nbsp;<span class="ident" id="3390559">n</span><span class="op" id="3390560">,</span>&nbsp;<span class="ident" id="3390562">nil</span><br>
<span class="lineno"></span><span class="op" id="3390566">}</span>
</div>
</body>
</html>
