<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6368825">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6368880">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6368934">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6368985">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6369039">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="6369087">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="6369139">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6369190">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="6369263">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6369335">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="6369412">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6369486">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="6369564">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6369639">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="6369716">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6369777">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="6369848">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="6369925">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6370000">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="6370079">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6370155">package</span>&nbsp;<span class="ident" id="6370163">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6370176">import</span>&nbsp;<span class="string" id="6370183">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6370191">func</span>&nbsp;<span class="ident" id="6370196">qsufsort</span><span class="op" id="6370204">(</span><span class="ident" id="6370205">data</span>&nbsp;<span class="op" id="6370210">[</span><span class="op" id="6370211">]</span><span class="builtintype" id="6370212">byte</span><span class="op" id="6370216">)</span>&nbsp;<span class="op" id="6370218">[</span><span class="op" id="6370219">]</span><span class="builtintype" id="6370220">int</span>&nbsp;<span class="op" id="6370224">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370227">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370271">sa</span>&nbsp;<span class="op" id="6370274">:=</span>&nbsp;<span class="ident" id="6370277">sortedByFirstByte</span><span class="op" id="6370294">(</span><span class="ident" id="6370295">data</span><span class="op" id="6370299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370302">if</span>&nbsp;<span class="builtinfunc" id="6370305">len</span><span class="op" id="6370308">(</span><span class="ident" id="6370309">sa</span><span class="op" id="6370311">)</span>&nbsp;<span class="op" id="6370313">&lt;</span>&nbsp;<span class="num" id="6370315">2</span>&nbsp;<span class="op" id="6370317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370321">return</span>&nbsp;<span class="ident" id="6370328">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370332">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370335">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370373">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370449">inv</span>&nbsp;<span class="op" id="6370453">:=</span>&nbsp;<span class="ident" id="6370456">initGroups</span><span class="op" id="6370466">(</span><span class="ident" id="6370467">sa</span><span class="op" id="6370469">,</span>&nbsp;<span class="ident" id="6370471">data</span><span class="op" id="6370475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370479">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370510">sufSortable</span>&nbsp;<span class="op" id="6370522">:=</span>&nbsp;<span class="op" id="6370525">&amp;</span><span class="ident" id="6370526">suffixSortable</span><span class="op" id="6370540">{</span><span class="ident" id="6370541">sa</span><span class="op" id="6370543">:</span>&nbsp;<span class="ident" id="6370545">sa</span><span class="op" id="6370547">,</span>&nbsp;<span class="ident" id="6370549">inv</span><span class="op" id="6370552">:</span>&nbsp;<span class="ident" id="6370554">inv</span><span class="op" id="6370557">,</span>&nbsp;<span class="ident" id="6370559">h</span><span class="op" id="6370560">:</span>&nbsp;<span class="num" id="6370562">1</span><span class="op" id="6370563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370567">for</span>&nbsp;<span class="ident" id="6370571">sa</span><span class="op" id="6370573">[</span><span class="num" id="6370574">0</span><span class="op" id="6370575">]</span>&nbsp;<span class="op" id="6370577">&gt;</span>&nbsp;<span class="op" id="6370579">-</span><span class="builtinfunc" id="6370580">len</span><span class="op" id="6370583">(</span><span class="ident" id="6370584">sa</span><span class="op" id="6370586">)</span>&nbsp;<span class="op" id="6370588">{</span>&nbsp;<span class="comment" id="6370590">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370639">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370694">pi</span>&nbsp;<span class="op" id="6370697">:=</span>&nbsp;<span class="num" id="6370700">0</span>&nbsp;<span class="comment" id="6370702">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370743">sl</span>&nbsp;<span class="op" id="6370746">:=</span>&nbsp;<span class="num" id="6370749">0</span>&nbsp;<span class="comment" id="6370751">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370794">for</span>&nbsp;<span class="ident" id="6370798">pi</span>&nbsp;<span class="op" id="6370801">&lt;</span>&nbsp;<span class="builtinfunc" id="6370803">len</span><span class="op" id="6370806">(</span><span class="ident" id="6370807">sa</span><span class="op" id="6370809">)</span>&nbsp;<span class="op" id="6370811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370816">if</span>&nbsp;<span class="ident" id="6370819">s</span>&nbsp;<span class="op" id="6370821">:=</span>&nbsp;<span class="ident" id="6370824">sa</span><span class="op" id="6370826">[</span><span class="ident" id="6370827">pi</span><span class="op" id="6370829">]</span><span class="op" id="6370830">;</span>&nbsp;<span class="ident" id="6370832">s</span>&nbsp;<span class="op" id="6370834">&lt;</span>&nbsp;<span class="num" id="6370836">0</span>&nbsp;<span class="op" id="6370838">{</span>&nbsp;<span class="comment" id="6370840">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370873">pi</span>&nbsp;<span class="op" id="6370876">-=</span>&nbsp;<span class="ident" id="6370879">s</span>&nbsp;<span class="comment" id="6370881">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370911">sl</span>&nbsp;<span class="op" id="6370914">+=</span>&nbsp;<span class="ident" id="6370917">s</span>&nbsp;<span class="comment" id="6370919">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370950">}</span>&nbsp;<span class="keyword" id="6370952">else</span>&nbsp;<span class="op" id="6370957">{</span>&nbsp;<span class="comment" id="6370959">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370994">if</span>&nbsp;<span class="ident" id="6370997">sl</span>&nbsp;<span class="op" id="6371000">!=</span>&nbsp;<span class="num" id="6371003">0</span>&nbsp;<span class="op" id="6371005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371012">sa</span><span class="op" id="6371014">[</span><span class="ident" id="6371015">pi</span><span class="op" id="6371017">+</span><span class="ident" id="6371018">sl</span><span class="op" id="6371020">]</span>&nbsp;<span class="op" id="6371022">=</span>&nbsp;<span class="ident" id="6371024">sl</span>&nbsp;<span class="comment" id="6371027">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371067">sl</span>&nbsp;<span class="op" id="6371070">=</span>&nbsp;<span class="num" id="6371072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371078">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371084">pk</span>&nbsp;<span class="op" id="6371087">:=</span>&nbsp;<span class="ident" id="6371090">inv</span><span class="op" id="6371093">[</span><span class="ident" id="6371094">s</span><span class="op" id="6371095">]</span>&nbsp;<span class="op" id="6371097">+</span>&nbsp;<span class="num" id="6371099">1</span>&nbsp;<span class="comment" id="6371101">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371148">sufSortable</span><span class="op" id="6371159">.</span><span class="ident" id="6371160">sa</span>&nbsp;<span class="op" id="6371163">=</span>&nbsp;<span class="ident" id="6371165">sa</span><span class="op" id="6371167">[</span><span class="ident" id="6371168">pi</span><span class="op" id="6371170">:</span><span class="ident" id="6371171">pk</span><span class="op" id="6371173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371179">sort</span><span class="op" id="6371183">.</span><span class="ident" id="6371184">Sort</span><span class="op" id="6371188">(</span><span class="ident" id="6371189">sufSortable</span><span class="op" id="6371200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371206">sufSortable</span><span class="op" id="6371217">.</span><span class="ident" id="6371218">updateGroups</span><span class="op" id="6371230">(</span><span class="ident" id="6371231">pi</span><span class="op" id="6371233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371239">pi</span>&nbsp;<span class="op" id="6371242">=</span>&nbsp;<span class="ident" id="6371244">pk</span>&nbsp;<span class="comment" id="6371247">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371272">if</span>&nbsp;<span class="ident" id="6371275">sl</span>&nbsp;<span class="op" id="6371278">!=</span>&nbsp;<span class="num" id="6371281">0</span>&nbsp;<span class="op" id="6371283">{</span>&nbsp;<span class="comment" id="6371285">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371329">sa</span><span class="op" id="6371331">[</span><span class="ident" id="6371332">pi</span><span class="op" id="6371334">+</span><span class="ident" id="6371335">sl</span><span class="op" id="6371337">]</span>&nbsp;<span class="op" id="6371339">=</span>&nbsp;<span class="ident" id="6371341">sl</span>&nbsp;<span class="comment" id="6371344">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371384">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371389">sufSortable</span><span class="op" id="6371400">.</span><span class="ident" id="6371401">h</span>&nbsp;<span class="op" id="6371403">*=</span>&nbsp;<span class="num" id="6371406">2</span>&nbsp;<span class="comment" id="6371408">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371436">for</span>&nbsp;<span class="ident" id="6371440">i</span>&nbsp;<span class="op" id="6371442">:=</span>&nbsp;<span class="keyword" id="6371445">range</span>&nbsp;<span class="ident" id="6371451">sa</span>&nbsp;<span class="op" id="6371454">{</span>&nbsp;<span class="comment" id="6371456">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371499">sa</span><span class="op" id="6371501">[</span><span class="ident" id="6371502">inv</span><span class="op" id="6371505">[</span><span class="ident" id="6371506">i</span><span class="op" id="6371507">]</span><span class="op" id="6371508">]</span>&nbsp;<span class="op" id="6371510">=</span>&nbsp;<span class="ident" id="6371512">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371518">return</span>&nbsp;<span class="ident" id="6371525">sa</span><br>
<span class="lineno"></span><span class="op" id="6371528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6371531">func</span>&nbsp;<span class="ident" id="6371536">sortedByFirstByte</span><span class="op" id="6371553">(</span><span class="ident" id="6371554">data</span>&nbsp;<span class="op" id="6371559">[</span><span class="op" id="6371560">]</span><span class="builtintype" id="6371561">byte</span><span class="op" id="6371565">)</span>&nbsp;<span class="op" id="6371567">[</span><span class="op" id="6371568">]</span><span class="builtintype" id="6371569">int</span>&nbsp;<span class="op" id="6371573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371576">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371598">var</span>&nbsp;<span class="ident" id="6371602">count</span>&nbsp;<span class="op" id="6371608">[</span><span class="num" id="6371609">256</span><span class="op" id="6371612">]</span><span class="builtintype" id="6371613">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371618">for</span>&nbsp;<span class="ident" id="6371622">_</span><span class="op" id="6371623">,</span>&nbsp;<span class="ident" id="6371625">b</span>&nbsp;<span class="op" id="6371627">:=</span>&nbsp;<span class="keyword" id="6371630">range</span>&nbsp;<span class="ident" id="6371636">data</span>&nbsp;<span class="op" id="6371641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371645">count</span><span class="op" id="6371650">[</span><span class="ident" id="6371651">b</span><span class="op" id="6371652">]</span><span class="op" id="6371653">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371660">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371731">sum</span>&nbsp;<span class="op" id="6371735">:=</span>&nbsp;<span class="num" id="6371738">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371741">for</span>&nbsp;<span class="ident" id="6371745">b</span>&nbsp;<span class="op" id="6371747">:=</span>&nbsp;<span class="keyword" id="6371750">range</span>&nbsp;<span class="ident" id="6371756">count</span>&nbsp;<span class="op" id="6371762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371766">count</span><span class="op" id="6371771">[</span><span class="ident" id="6371772">b</span><span class="op" id="6371773">]</span><span class="op" id="6371774">,</span>&nbsp;<span class="ident" id="6371776">sum</span>&nbsp;<span class="op" id="6371780">=</span>&nbsp;<span class="ident" id="6371782">sum</span><span class="op" id="6371785">,</span>&nbsp;<span class="ident" id="6371787">count</span><span class="op" id="6371792">[</span><span class="ident" id="6371793">b</span><span class="op" id="6371794">]</span><span class="op" id="6371795">+</span><span class="ident" id="6371796">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371804">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371873">sa</span>&nbsp;<span class="op" id="6371876">:=</span>&nbsp;<span class="builtinfunc" id="6371879">make</span><span class="op" id="6371883">(</span><span class="op" id="6371884">[</span><span class="op" id="6371885">]</span><span class="builtintype" id="6371886">int</span><span class="op" id="6371889">,</span>&nbsp;<span class="builtinfunc" id="6371891">len</span><span class="op" id="6371894">(</span><span class="ident" id="6371895">data</span><span class="op" id="6371899">)</span><span class="op" id="6371900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371903">for</span>&nbsp;<span class="ident" id="6371907">i</span><span class="op" id="6371908">,</span>&nbsp;<span class="ident" id="6371910">b</span>&nbsp;<span class="op" id="6371912">:=</span>&nbsp;<span class="keyword" id="6371915">range</span>&nbsp;<span class="ident" id="6371921">data</span>&nbsp;<span class="op" id="6371926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371930">sa</span><span class="op" id="6371932">[</span><span class="ident" id="6371933">count</span><span class="op" id="6371938">[</span><span class="ident" id="6371939">b</span><span class="op" id="6371940">]</span><span class="op" id="6371941">]</span>&nbsp;<span class="op" id="6371943">=</span>&nbsp;<span class="ident" id="6371945">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371949">count</span><span class="op" id="6371954">[</span><span class="ident" id="6371955">b</span><span class="op" id="6371956">]</span><span class="op" id="6371957">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371964">return</span>&nbsp;<span class="ident" id="6371971">sa</span><br>
<span class="lineno"></span><span class="op" id="6371974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6371977">func</span>&nbsp;<span class="ident" id="6371982">initGroups</span><span class="op" id="6371992">(</span><span class="ident" id="6371993">sa</span>&nbsp;<span class="op" id="6371996">[</span><span class="op" id="6371997">]</span><span class="builtintype" id="6371998">int</span><span class="op" id="6372001">,</span>&nbsp;<span class="ident" id="6372003">data</span>&nbsp;<span class="op" id="6372008">[</span><span class="op" id="6372009">]</span><span class="builtintype" id="6372010">byte</span><span class="op" id="6372014">)</span>&nbsp;<span class="op" id="6372016">[</span><span class="op" id="6372017">]</span><span class="builtintype" id="6372018">int</span>&nbsp;<span class="op" id="6372022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372025">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372092">inv</span>&nbsp;<span class="op" id="6372096">:=</span>&nbsp;<span class="builtinfunc" id="6372099">make</span><span class="op" id="6372103">(</span><span class="op" id="6372104">[</span><span class="op" id="6372105">]</span><span class="builtintype" id="6372106">int</span><span class="op" id="6372109">,</span>&nbsp;<span class="builtinfunc" id="6372111">len</span><span class="op" id="6372114">(</span><span class="ident" id="6372115">data</span><span class="op" id="6372119">)</span><span class="op" id="6372120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372123">prevGroup</span>&nbsp;<span class="op" id="6372133">:=</span>&nbsp;<span class="builtinfunc" id="6372136">len</span><span class="op" id="6372139">(</span><span class="ident" id="6372140">sa</span><span class="op" id="6372142">)</span>&nbsp;<span class="op" id="6372144">-</span>&nbsp;<span class="num" id="6372146">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372149">groupByte</span>&nbsp;<span class="op" id="6372159">:=</span>&nbsp;<span class="ident" id="6372162">data</span><span class="op" id="6372166">[</span><span class="ident" id="6372167">sa</span><span class="op" id="6372169">[</span><span class="ident" id="6372170">prevGroup</span><span class="op" id="6372179">]</span><span class="op" id="6372180">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372183">for</span>&nbsp;<span class="ident" id="6372187">i</span>&nbsp;<span class="op" id="6372189">:=</span>&nbsp;<span class="builtinfunc" id="6372192">len</span><span class="op" id="6372195">(</span><span class="ident" id="6372196">sa</span><span class="op" id="6372198">)</span>&nbsp;<span class="op" id="6372200">-</span>&nbsp;<span class="num" id="6372202">1</span><span class="op" id="6372203">;</span>&nbsp;<span class="ident" id="6372205">i</span>&nbsp;<span class="op" id="6372207">&gt;=</span>&nbsp;<span class="num" id="6372210">0</span><span class="op" id="6372211">;</span>&nbsp;<span class="ident" id="6372213">i</span><span class="op" id="6372214">--</span>&nbsp;<span class="op" id="6372217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372221">if</span>&nbsp;<span class="ident" id="6372224">b</span>&nbsp;<span class="op" id="6372226">:=</span>&nbsp;<span class="ident" id="6372229">data</span><span class="op" id="6372233">[</span><span class="ident" id="6372234">sa</span><span class="op" id="6372236">[</span><span class="ident" id="6372237">i</span><span class="op" id="6372238">]</span><span class="op" id="6372239">]</span><span class="op" id="6372240">;</span>&nbsp;<span class="ident" id="6372242">b</span>&nbsp;<span class="op" id="6372244">&lt;</span>&nbsp;<span class="ident" id="6372246">groupByte</span>&nbsp;<span class="op" id="6372256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372261">if</span>&nbsp;<span class="ident" id="6372264">prevGroup</span>&nbsp;<span class="op" id="6372274">==</span>&nbsp;<span class="ident" id="6372277">i</span><span class="op" id="6372278">+</span><span class="num" id="6372279">1</span>&nbsp;<span class="op" id="6372281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372287">sa</span><span class="op" id="6372289">[</span><span class="ident" id="6372290">i</span><span class="op" id="6372291">+</span><span class="num" id="6372292">1</span><span class="op" id="6372293">]</span>&nbsp;<span class="op" id="6372295">=</span>&nbsp;<span class="op" id="6372297">-</span><span class="num" id="6372298">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372303">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372308">groupByte</span>&nbsp;<span class="op" id="6372318">=</span>&nbsp;<span class="ident" id="6372320">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372325">prevGroup</span>&nbsp;<span class="op" id="6372335">=</span>&nbsp;<span class="ident" id="6372337">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372345">inv</span><span class="op" id="6372348">[</span><span class="ident" id="6372349">sa</span><span class="op" id="6372351">[</span><span class="ident" id="6372352">i</span><span class="op" id="6372353">]</span><span class="op" id="6372354">]</span>&nbsp;<span class="op" id="6372356">=</span>&nbsp;<span class="ident" id="6372358">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372370">if</span>&nbsp;<span class="ident" id="6372373">prevGroup</span>&nbsp;<span class="op" id="6372383">==</span>&nbsp;<span class="num" id="6372386">0</span>&nbsp;<span class="op" id="6372388">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372393">sa</span><span class="op" id="6372395">[</span><span class="num" id="6372396">0</span><span class="op" id="6372397">]</span>&nbsp;<span class="op" id="6372399">=</span>&nbsp;<span class="op" id="6372401">-</span><span class="num" id="6372402">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372412">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372473">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372536">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372580">lastByte</span>&nbsp;<span class="op" id="6372589">:=</span>&nbsp;<span class="ident" id="6372592">data</span><span class="op" id="6372596">[</span><span class="builtinfunc" id="6372597">len</span><span class="op" id="6372600">(</span><span class="ident" id="6372601">data</span><span class="op" id="6372605">)</span><span class="op" id="6372606">-</span><span class="num" id="6372607">1</span><span class="op" id="6372608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372611">s</span>&nbsp;<span class="op" id="6372613">:=</span>&nbsp;<span class="op" id="6372616">-</span><span class="num" id="6372617">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372620">for</span>&nbsp;<span class="ident" id="6372624">i</span>&nbsp;<span class="op" id="6372626">:=</span>&nbsp;<span class="keyword" id="6372629">range</span>&nbsp;<span class="ident" id="6372635">sa</span>&nbsp;<span class="op" id="6372638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372642">if</span>&nbsp;<span class="ident" id="6372645">sa</span><span class="op" id="6372647">[</span><span class="ident" id="6372648">i</span><span class="op" id="6372649">]</span>&nbsp;<span class="op" id="6372651">&gt;=</span>&nbsp;<span class="num" id="6372654">0</span>&nbsp;<span class="op" id="6372656">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372661">if</span>&nbsp;<span class="ident" id="6372664">data</span><span class="op" id="6372668">[</span><span class="ident" id="6372669">sa</span><span class="op" id="6372671">[</span><span class="ident" id="6372672">i</span><span class="op" id="6372673">]</span><span class="op" id="6372674">]</span>&nbsp;<span class="op" id="6372676">==</span>&nbsp;<span class="ident" id="6372679">lastByte</span>&nbsp;<span class="op" id="6372688">&amp;&amp;</span>&nbsp;<span class="ident" id="6372691">s</span>&nbsp;<span class="op" id="6372693">==</span>&nbsp;<span class="op" id="6372696">-</span><span class="num" id="6372697">1</span>&nbsp;<span class="op" id="6372699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372705">s</span>&nbsp;<span class="op" id="6372707">=</span>&nbsp;<span class="ident" id="6372709">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372719">if</span>&nbsp;<span class="ident" id="6372722">sa</span><span class="op" id="6372724">[</span><span class="ident" id="6372725">i</span><span class="op" id="6372726">]</span>&nbsp;<span class="op" id="6372728">==</span>&nbsp;<span class="builtinfunc" id="6372731">len</span><span class="op" id="6372734">(</span><span class="ident" id="6372735">sa</span><span class="op" id="6372737">)</span><span class="op" id="6372738">-</span><span class="num" id="6372739">1</span>&nbsp;<span class="op" id="6372741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372747">sa</span><span class="op" id="6372749">[</span><span class="ident" id="6372750">i</span><span class="op" id="6372751">]</span><span class="op" id="6372752">,</span>&nbsp;<span class="ident" id="6372754">sa</span><span class="op" id="6372756">[</span><span class="ident" id="6372757">s</span><span class="op" id="6372758">]</span>&nbsp;<span class="op" id="6372760">=</span>&nbsp;<span class="ident" id="6372762">sa</span><span class="op" id="6372764">[</span><span class="ident" id="6372765">s</span><span class="op" id="6372766">]</span><span class="op" id="6372767">,</span>&nbsp;<span class="ident" id="6372769">sa</span><span class="op" id="6372771">[</span><span class="ident" id="6372772">i</span><span class="op" id="6372773">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372779">inv</span><span class="op" id="6372782">[</span><span class="ident" id="6372783">sa</span><span class="op" id="6372785">[</span><span class="ident" id="6372786">s</span><span class="op" id="6372787">]</span><span class="op" id="6372788">]</span>&nbsp;<span class="op" id="6372790">=</span>&nbsp;<span class="ident" id="6372792">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372798">sa</span><span class="op" id="6372800">[</span><span class="ident" id="6372801">s</span><span class="op" id="6372802">]</span>&nbsp;<span class="op" id="6372804">=</span>&nbsp;<span class="op" id="6372806">-</span><span class="num" id="6372807">1</span>&nbsp;<span class="comment" id="6372809">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372852">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372865">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372871">return</span>&nbsp;<span class="ident" id="6372878">inv</span><br>
<span class="lineno"></span><span class="op" id="6372882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372885">type</span>&nbsp;<span class="ident" id="6372890">suffixSortable</span>&nbsp;<span class="keyword" id="6372905">struct</span>&nbsp;<span class="op" id="6372912">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372915">sa</span>&nbsp;&nbsp;<span class="op" id="6372919">[</span><span class="op" id="6372920">]</span><span class="builtintype" id="6372921">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372926">inv</span>&nbsp;<span class="op" id="6372930">[</span><span class="op" id="6372931">]</span><span class="builtintype" id="6372932">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372937">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6372941">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372946">buf</span>&nbsp;<span class="op" id="6372950">[</span><span class="op" id="6372951">]</span><span class="builtintype" id="6372952">int</span>&nbsp;<span class="comment" id="6372956">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="6372980">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6372983">func</span>&nbsp;<span class="op" id="6372988">(</span><span class="ident" id="6372989">x</span>&nbsp;<span class="op" id="6372991">*</span><span class="ident" id="6372992">suffixSortable</span><span class="op" id="6373006">)</span>&nbsp;<span class="ident" id="6373008">Len</span><span class="op" id="6373011">(</span><span class="op" id="6373012">)</span>&nbsp;<span class="builtintype" id="6373014">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373028">{</span>&nbsp;<span class="keyword" id="6373030">return</span>&nbsp;<span class="builtinfunc" id="6373037">len</span><span class="op" id="6373040">(</span><span class="ident" id="6373041">x</span><span class="op" id="6373042">.</span><span class="ident" id="6373043">sa</span><span class="op" id="6373045">)</span>&nbsp;<span class="op" id="6373047">}</span><br>
<span class="lineno"></span><span class="keyword" id="6373049">func</span>&nbsp;<span class="op" id="6373054">(</span><span class="ident" id="6373055">x</span>&nbsp;<span class="op" id="6373057">*</span><span class="ident" id="6373058">suffixSortable</span><span class="op" id="6373072">)</span>&nbsp;<span class="ident" id="6373074">Less</span><span class="op" id="6373078">(</span><span class="ident" id="6373079">i</span><span class="op" id="6373080">,</span>&nbsp;<span class="ident" id="6373082">j</span>&nbsp;<span class="builtintype" id="6373084">int</span><span class="op" id="6373087">)</span>&nbsp;<span class="builtintype" id="6373089">bool</span>&nbsp;<span class="op" id="6373094">{</span>&nbsp;<span class="keyword" id="6373096">return</span>&nbsp;<span class="ident" id="6373103">x</span><span class="op" id="6373104">.</span><span class="ident" id="6373105">inv</span><span class="op" id="6373108">[</span><span class="ident" id="6373109">x</span><span class="op" id="6373110">.</span><span class="ident" id="6373111">sa</span><span class="op" id="6373113">[</span><span class="ident" id="6373114">i</span><span class="op" id="6373115">]</span><span class="op" id="6373116">+</span><span class="ident" id="6373117">x</span><span class="op" id="6373118">.</span><span class="ident" id="6373119">h</span><span class="op" id="6373120">]</span>&nbsp;<span class="op" id="6373122">&lt;</span>&nbsp;<span class="ident" id="6373124">x</span><span class="op" id="6373125">.</span><span class="ident" id="6373126">inv</span><span class="op" id="6373129">[</span><span class="ident" id="6373130">x</span><span class="op" id="6373131">.</span><span class="ident" id="6373132">sa</span><span class="op" id="6373134">[</span><span class="ident" id="6373135">j</span><span class="op" id="6373136">]</span><span class="op" id="6373137">+</span><span class="ident" id="6373138">x</span><span class="op" id="6373139">.</span><span class="ident" id="6373140">h</span><span class="op" id="6373141">]</span>&nbsp;<span class="op" id="6373143">}</span><br>
<span class="lineno"></span><span class="keyword" id="6373145">func</span>&nbsp;<span class="op" id="6373150">(</span><span class="ident" id="6373151">x</span>&nbsp;<span class="op" id="6373153">*</span><span class="ident" id="6373154">suffixSortable</span><span class="op" id="6373168">)</span>&nbsp;<span class="ident" id="6373170">Swap</span><span class="op" id="6373174">(</span><span class="ident" id="6373175">i</span><span class="op" id="6373176">,</span>&nbsp;<span class="ident" id="6373178">j</span>&nbsp;<span class="builtintype" id="6373180">int</span><span class="op" id="6373183">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6373190">{</span>&nbsp;<span class="ident" id="6373192">x</span><span class="op" id="6373193">.</span><span class="ident" id="6373194">sa</span><span class="op" id="6373196">[</span><span class="ident" id="6373197">i</span><span class="op" id="6373198">]</span><span class="op" id="6373199">,</span>&nbsp;<span class="ident" id="6373201">x</span><span class="op" id="6373202">.</span><span class="ident" id="6373203">sa</span><span class="op" id="6373205">[</span><span class="ident" id="6373206">j</span><span class="op" id="6373207">]</span>&nbsp;<span class="op" id="6373209">=</span>&nbsp;<span class="ident" id="6373211">x</span><span class="op" id="6373212">.</span><span class="ident" id="6373213">sa</span><span class="op" id="6373215">[</span><span class="ident" id="6373216">j</span><span class="op" id="6373217">]</span><span class="op" id="6373218">,</span>&nbsp;<span class="ident" id="6373220">x</span><span class="op" id="6373221">.</span><span class="ident" id="6373222">sa</span><span class="op" id="6373224">[</span><span class="ident" id="6373225">i</span><span class="op" id="6373226">]</span>&nbsp;<span class="op" id="6373228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6373231">func</span>&nbsp;<span class="op" id="6373236">(</span><span class="ident" id="6373237">x</span>&nbsp;<span class="op" id="6373239">*</span><span class="ident" id="6373240">suffixSortable</span><span class="op" id="6373254">)</span>&nbsp;<span class="ident" id="6373256">updateGroups</span><span class="op" id="6373268">(</span><span class="ident" id="6373269">offset</span>&nbsp;<span class="builtintype" id="6373276">int</span><span class="op" id="6373279">)</span>&nbsp;<span class="op" id="6373281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373284">bounds</span>&nbsp;<span class="op" id="6373291">:=</span>&nbsp;<span class="ident" id="6373294">x</span><span class="op" id="6373295">.</span><span class="ident" id="6373296">buf</span><span class="op" id="6373299">[</span><span class="num" id="6373300">0</span><span class="op" id="6373301">:</span><span class="num" id="6373302">0</span><span class="op" id="6373303">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373306">group</span>&nbsp;<span class="op" id="6373312">:=</span>&nbsp;<span class="ident" id="6373315">x</span><span class="op" id="6373316">.</span><span class="ident" id="6373317">inv</span><span class="op" id="6373320">[</span><span class="ident" id="6373321">x</span><span class="op" id="6373322">.</span><span class="ident" id="6373323">sa</span><span class="op" id="6373325">[</span><span class="num" id="6373326">0</span><span class="op" id="6373327">]</span><span class="op" id="6373328">+</span><span class="ident" id="6373329">x</span><span class="op" id="6373330">.</span><span class="ident" id="6373331">h</span><span class="op" id="6373332">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373335">for</span>&nbsp;<span class="ident" id="6373339">i</span>&nbsp;<span class="op" id="6373341">:=</span>&nbsp;<span class="num" id="6373344">1</span><span class="op" id="6373345">;</span>&nbsp;<span class="ident" id="6373347">i</span>&nbsp;<span class="op" id="6373349">&lt;</span>&nbsp;<span class="builtinfunc" id="6373351">len</span><span class="op" id="6373354">(</span><span class="ident" id="6373355">x</span><span class="op" id="6373356">.</span><span class="ident" id="6373357">sa</span><span class="op" id="6373359">)</span><span class="op" id="6373360">;</span>&nbsp;<span class="ident" id="6373362">i</span><span class="op" id="6373363">++</span>&nbsp;<span class="op" id="6373366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373370">if</span>&nbsp;<span class="ident" id="6373373">g</span>&nbsp;<span class="op" id="6373375">:=</span>&nbsp;<span class="ident" id="6373378">x</span><span class="op" id="6373379">.</span><span class="ident" id="6373380">inv</span><span class="op" id="6373383">[</span><span class="ident" id="6373384">x</span><span class="op" id="6373385">.</span><span class="ident" id="6373386">sa</span><span class="op" id="6373388">[</span><span class="ident" id="6373389">i</span><span class="op" id="6373390">]</span><span class="op" id="6373391">+</span><span class="ident" id="6373392">x</span><span class="op" id="6373393">.</span><span class="ident" id="6373394">h</span><span class="op" id="6373395">]</span><span class="op" id="6373396">;</span>&nbsp;<span class="ident" id="6373398">g</span>&nbsp;<span class="op" id="6373400">&gt;</span>&nbsp;<span class="ident" id="6373402">group</span>&nbsp;<span class="op" id="6373408">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373413">bounds</span>&nbsp;<span class="op" id="6373420">=</span>&nbsp;<span class="builtinfunc" id="6373422">append</span><span class="op" id="6373428">(</span><span class="ident" id="6373429">bounds</span><span class="op" id="6373435">,</span>&nbsp;<span class="ident" id="6373437">i</span><span class="op" id="6373438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373443">group</span>&nbsp;<span class="op" id="6373449">=</span>&nbsp;<span class="ident" id="6373451">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373461">bounds</span>&nbsp;<span class="op" id="6373468">=</span>&nbsp;<span class="builtinfunc" id="6373470">append</span><span class="op" id="6373476">(</span><span class="ident" id="6373477">bounds</span><span class="op" id="6373483">,</span>&nbsp;<span class="builtinfunc" id="6373485">len</span><span class="op" id="6373488">(</span><span class="ident" id="6373489">x</span><span class="op" id="6373490">.</span><span class="ident" id="6373491">sa</span><span class="op" id="6373493">)</span><span class="op" id="6373494">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373497">x</span><span class="op" id="6373498">.</span><span class="ident" id="6373499">buf</span>&nbsp;<span class="op" id="6373503">=</span>&nbsp;<span class="ident" id="6373505">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6373514">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373582">prev</span>&nbsp;<span class="op" id="6373587">:=</span>&nbsp;<span class="num" id="6373590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373593">for</span>&nbsp;<span class="ident" id="6373597">_</span><span class="op" id="6373598">,</span>&nbsp;<span class="ident" id="6373600">b</span>&nbsp;<span class="op" id="6373602">:=</span>&nbsp;<span class="keyword" id="6373605">range</span>&nbsp;<span class="ident" id="6373611">bounds</span>&nbsp;<span class="op" id="6373618">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373622">for</span>&nbsp;<span class="ident" id="6373626">i</span>&nbsp;<span class="op" id="6373628">:=</span>&nbsp;<span class="ident" id="6373631">prev</span><span class="op" id="6373635">;</span>&nbsp;<span class="ident" id="6373637">i</span>&nbsp;<span class="op" id="6373639">&lt;</span>&nbsp;<span class="ident" id="6373641">b</span><span class="op" id="6373642">;</span>&nbsp;<span class="ident" id="6373644">i</span><span class="op" id="6373645">++</span>&nbsp;<span class="op" id="6373648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373653">x</span><span class="op" id="6373654">.</span><span class="ident" id="6373655">inv</span><span class="op" id="6373658">[</span><span class="ident" id="6373659">x</span><span class="op" id="6373660">.</span><span class="ident" id="6373661">sa</span><span class="op" id="6373663">[</span><span class="ident" id="6373664">i</span><span class="op" id="6373665">]</span><span class="op" id="6373666">]</span>&nbsp;<span class="op" id="6373668">=</span>&nbsp;<span class="ident" id="6373670">offset</span>&nbsp;<span class="op" id="6373677">+</span>&nbsp;<span class="ident" id="6373679">b</span>&nbsp;<span class="op" id="6373681">-</span>&nbsp;<span class="num" id="6373683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373691">if</span>&nbsp;<span class="ident" id="6373694">b</span><span class="op" id="6373695">-</span><span class="ident" id="6373696">prev</span>&nbsp;<span class="op" id="6373701">==</span>&nbsp;<span class="num" id="6373704">1</span>&nbsp;<span class="op" id="6373706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373711">x</span><span class="op" id="6373712">.</span><span class="ident" id="6373713">sa</span><span class="op" id="6373715">[</span><span class="ident" id="6373716">prev</span><span class="op" id="6373720">]</span>&nbsp;<span class="op" id="6373722">=</span>&nbsp;<span class="op" id="6373724">-</span><span class="num" id="6373725">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373733">prev</span>&nbsp;<span class="op" id="6373738">=</span>&nbsp;<span class="ident" id="6373740">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373743">}</span><br>
<span class="lineno"></span><span class="op" id="6373745">}</span>
</div>
</body>
</html>
