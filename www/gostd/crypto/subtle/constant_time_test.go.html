<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html" class="current">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7015333">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7015388">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7015442">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7015493">package</span>&nbsp;<span class="ident" id="7015501">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7015509">import</span>&nbsp;<span class="op" id="7015516">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7015519">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7015530">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7015546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7015549">type</span>&nbsp;<span class="ident" id="7015554">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="7015584">struct</span>&nbsp;<span class="op" id="7015591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015594">a</span><span class="op" id="7015595">,</span>&nbsp;<span class="ident" id="7015597">b</span>&nbsp;<span class="op" id="7015599">[</span><span class="op" id="7015600">]</span><span class="builtintype" id="7015601">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015607">out</span>&nbsp;&nbsp;<span class="builtintype" id="7015612">int</span><br>
<span class="lineno">15</span><span class="op" id="7015616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7015619">var</span>&nbsp;<span class="ident" id="7015623">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7015651">=</span>&nbsp;<span class="op" id="7015653">[</span><span class="op" id="7015654">]</span><span class="ident" id="7015655">TestConstantTimeCompareStruct</span><span class="op" id="7015684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015687">{</span><span class="op" id="7015688">[</span><span class="op" id="7015689">]</span><span class="builtintype" id="7015690">byte</span><span class="op" id="7015694">{</span><span class="op" id="7015695">}</span><span class="op" id="7015696">,</span>&nbsp;<span class="op" id="7015698">[</span><span class="op" id="7015699">]</span><span class="builtintype" id="7015700">byte</span><span class="op" id="7015704">{</span><span class="op" id="7015705">}</span><span class="op" id="7015706">,</span>&nbsp;<span class="num" id="7015708">1</span><span class="op" id="7015709">}</span><span class="op" id="7015710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015713">{</span><span class="op" id="7015714">[</span><span class="op" id="7015715">]</span><span class="builtintype" id="7015716">byte</span><span class="op" id="7015720">{</span><span class="num" id="7015721">0x11</span><span class="op" id="7015725">}</span><span class="op" id="7015726">,</span>&nbsp;<span class="op" id="7015728">[</span><span class="op" id="7015729">]</span><span class="builtintype" id="7015730">byte</span><span class="op" id="7015734">{</span><span class="num" id="7015735">0x11</span><span class="op" id="7015739">}</span><span class="op" id="7015740">,</span>&nbsp;<span class="num" id="7015742">1</span><span class="op" id="7015743">}</span><span class="op" id="7015744">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015747">{</span><span class="op" id="7015748">[</span><span class="op" id="7015749">]</span><span class="builtintype" id="7015750">byte</span><span class="op" id="7015754">{</span><span class="num" id="7015755">0x12</span><span class="op" id="7015759">}</span><span class="op" id="7015760">,</span>&nbsp;<span class="op" id="7015762">[</span><span class="op" id="7015763">]</span><span class="builtintype" id="7015764">byte</span><span class="op" id="7015768">{</span><span class="num" id="7015769">0x11</span><span class="op" id="7015773">}</span><span class="op" id="7015774">,</span>&nbsp;<span class="num" id="7015776">0</span><span class="op" id="7015777">}</span><span class="op" id="7015778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015781">{</span><span class="op" id="7015782">[</span><span class="op" id="7015783">]</span><span class="builtintype" id="7015784">byte</span><span class="op" id="7015788">{</span><span class="num" id="7015789">0x11</span><span class="op" id="7015793">}</span><span class="op" id="7015794">,</span>&nbsp;<span class="op" id="7015796">[</span><span class="op" id="7015797">]</span><span class="builtintype" id="7015798">byte</span><span class="op" id="7015802">{</span><span class="num" id="7015803">0x11</span><span class="op" id="7015807">,</span>&nbsp;<span class="num" id="7015809">0x12</span><span class="op" id="7015813">}</span><span class="op" id="7015814">,</span>&nbsp;<span class="num" id="7015816">0</span><span class="op" id="7015817">}</span><span class="op" id="7015818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015821">{</span><span class="op" id="7015822">[</span><span class="op" id="7015823">]</span><span class="builtintype" id="7015824">byte</span><span class="op" id="7015828">{</span><span class="num" id="7015829">0x11</span><span class="op" id="7015833">,</span>&nbsp;<span class="num" id="7015835">0x12</span><span class="op" id="7015839">}</span><span class="op" id="7015840">,</span>&nbsp;<span class="op" id="7015842">[</span><span class="op" id="7015843">]</span><span class="builtintype" id="7015844">byte</span><span class="op" id="7015848">{</span><span class="num" id="7015849">0x11</span><span class="op" id="7015853">}</span><span class="op" id="7015854">,</span>&nbsp;<span class="num" id="7015856">0</span><span class="op" id="7015857">}</span><span class="op" id="7015858">,</span><br>
<span class="lineno"></span><span class="op" id="7015860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7015863">func</span>&nbsp;<span class="ident" id="7015868">TestConstantTimeCompare</span><span class="op" id="7015891">(</span><span class="ident" id="7015892">t</span>&nbsp;<span class="op" id="7015894">*</span><span class="ident" id="7015895">testing</span><span class="op" id="7015902">.</span><span class="ident" id="7015903">T</span><span class="op" id="7015904">)</span>&nbsp;<span class="op" id="7015906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015909">for</span>&nbsp;<span class="ident" id="7015913">i</span><span class="op" id="7015914">,</span>&nbsp;<span class="ident" id="7015916">test</span>&nbsp;<span class="op" id="7015921">:=</span>&nbsp;<span class="keyword" id="7015924">range</span>&nbsp;<span class="ident" id="7015930">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7015958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015962">if</span>&nbsp;<span class="ident" id="7015965">r</span>&nbsp;<span class="op" id="7015967">:=</span>&nbsp;<span class="ident" id="7015970">ConstantTimeCompare</span><span class="op" id="7015989">(</span><span class="ident" id="7015990">test</span><span class="op" id="7015994">.</span><span class="ident" id="7015995">a</span><span class="op" id="7015996">,</span>&nbsp;<span class="ident" id="7015998">test</span><span class="op" id="7016002">.</span><span class="ident" id="7016003">b</span><span class="op" id="7016004">)</span><span class="op" id="7016005">;</span>&nbsp;<span class="ident" id="7016007">r</span>&nbsp;<span class="op" id="7016009">!=</span>&nbsp;<span class="ident" id="7016012">test</span><span class="op" id="7016016">.</span><span class="ident" id="7016017">out</span>&nbsp;<span class="op" id="7016021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016026">t</span><span class="op" id="7016027">.</span><span class="ident" id="7016028">Errorf</span><span class="op" id="7016034">(</span><span class="string" id="7016035">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7016069">,</span>&nbsp;<span class="ident" id="7016071">i</span><span class="op" id="7016072">,</span>&nbsp;<span class="ident" id="7016074">r</span><span class="op" id="7016075">,</span>&nbsp;<span class="ident" id="7016077">test</span><span class="op" id="7016081">.</span><span class="ident" id="7016082">out</span><span class="op" id="7016085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016089">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016092">}</span><br>
<span class="lineno"></span><span class="op" id="7016094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016097">type</span>&nbsp;<span class="ident" id="7016102">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="7016131">struct</span>&nbsp;<span class="op" id="7016138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016141">a</span><span class="op" id="7016142">,</span>&nbsp;<span class="ident" id="7016144">b</span>&nbsp;<span class="builtintype" id="7016146">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016153">out</span>&nbsp;&nbsp;<span class="builtintype" id="7016158">int</span><br>
<span class="lineno"></span><span class="op" id="7016162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016165">var</span>&nbsp;<span class="ident" id="7016169">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7016196">=</span>&nbsp;<span class="op" id="7016198">[</span><span class="op" id="7016199">]</span><span class="ident" id="7016200">TestConstantTimeByteEqStruct</span><span class="op" id="7016228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016231">{</span><span class="num" id="7016232">0</span><span class="op" id="7016233">,</span>&nbsp;<span class="num" id="7016235">0</span><span class="op" id="7016236">,</span>&nbsp;<span class="num" id="7016238">1</span><span class="op" id="7016239">}</span><span class="op" id="7016240">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016243">{</span><span class="num" id="7016244">0</span><span class="op" id="7016245">,</span>&nbsp;<span class="num" id="7016247">1</span><span class="op" id="7016248">,</span>&nbsp;<span class="num" id="7016250">0</span><span class="op" id="7016251">}</span><span class="op" id="7016252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016255">{</span><span class="num" id="7016256">1</span><span class="op" id="7016257">,</span>&nbsp;<span class="num" id="7016259">0</span><span class="op" id="7016260">,</span>&nbsp;<span class="num" id="7016262">0</span><span class="op" id="7016263">}</span><span class="op" id="7016264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016267">{</span><span class="num" id="7016268">0xff</span><span class="op" id="7016272">,</span>&nbsp;<span class="num" id="7016274">0xff</span><span class="op" id="7016278">,</span>&nbsp;<span class="num" id="7016280">1</span><span class="op" id="7016281">}</span><span class="op" id="7016282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016285">{</span><span class="num" id="7016286">0xff</span><span class="op" id="7016290">,</span>&nbsp;<span class="num" id="7016292">0xfe</span><span class="op" id="7016296">,</span>&nbsp;<span class="num" id="7016298">0</span><span class="op" id="7016299">}</span><span class="op" id="7016300">,</span><br>
<span class="lineno"></span><span class="op" id="7016302">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7016305">func</span>&nbsp;<span class="ident" id="7016310">byteEq</span><span class="op" id="7016316">(</span><span class="ident" id="7016317">a</span><span class="op" id="7016318">,</span>&nbsp;<span class="ident" id="7016320">b</span>&nbsp;<span class="builtintype" id="7016322">uint8</span><span class="op" id="7016327">)</span>&nbsp;<span class="builtintype" id="7016329">int</span>&nbsp;<span class="op" id="7016333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016336">if</span>&nbsp;<span class="ident" id="7016339">a</span>&nbsp;<span class="op" id="7016341">==</span>&nbsp;<span class="ident" id="7016344">b</span>&nbsp;<span class="op" id="7016346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016350">return</span>&nbsp;<span class="num" id="7016357">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016360">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016363">return</span>&nbsp;<span class="num" id="7016370">0</span><br>
<span class="lineno"></span><span class="op" id="7016372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016375">func</span>&nbsp;<span class="ident" id="7016380">TestConstantTimeByteEq</span><span class="op" id="7016402">(</span><span class="ident" id="7016403">t</span>&nbsp;<span class="op" id="7016405">*</span><span class="ident" id="7016406">testing</span><span class="op" id="7016413">.</span><span class="ident" id="7016414">T</span><span class="op" id="7016415">)</span>&nbsp;<span class="op" id="7016417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016420">for</span>&nbsp;<span class="ident" id="7016424">i</span><span class="op" id="7016425">,</span>&nbsp;<span class="ident" id="7016427">test</span>&nbsp;<span class="op" id="7016432">:=</span>&nbsp;<span class="keyword" id="7016435">range</span>&nbsp;<span class="ident" id="7016441">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7016468">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016472">if</span>&nbsp;<span class="ident" id="7016475">r</span>&nbsp;<span class="op" id="7016477">:=</span>&nbsp;<span class="ident" id="7016480">ConstantTimeByteEq</span><span class="op" id="7016498">(</span><span class="ident" id="7016499">test</span><span class="op" id="7016503">.</span><span class="ident" id="7016504">a</span><span class="op" id="7016505">,</span>&nbsp;<span class="ident" id="7016507">test</span><span class="op" id="7016511">.</span><span class="ident" id="7016512">b</span><span class="op" id="7016513">)</span><span class="op" id="7016514">;</span>&nbsp;<span class="ident" id="7016516">r</span>&nbsp;<span class="op" id="7016518">!=</span>&nbsp;<span class="ident" id="7016521">test</span><span class="op" id="7016525">.</span><span class="ident" id="7016526">out</span>&nbsp;<span class="op" id="7016530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016535">t</span><span class="op" id="7016536">.</span><span class="ident" id="7016537">Errorf</span><span class="op" id="7016543">(</span><span class="string" id="7016544">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7016578">,</span>&nbsp;<span class="ident" id="7016580">i</span><span class="op" id="7016581">,</span>&nbsp;<span class="ident" id="7016583">r</span><span class="op" id="7016584">,</span>&nbsp;<span class="ident" id="7016586">test</span><span class="op" id="7016590">.</span><span class="ident" id="7016591">out</span><span class="op" id="7016594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016604">err</span>&nbsp;<span class="op" id="7016608">:=</span>&nbsp;<span class="ident" id="7016611">quick</span><span class="op" id="7016616">.</span><span class="ident" id="7016617">CheckEqual</span><span class="op" id="7016627">(</span><span class="ident" id="7016628">ConstantTimeByteEq</span><span class="op" id="7016646">,</span>&nbsp;<span class="ident" id="7016648">byteEq</span><span class="op" id="7016654">,</span>&nbsp;<span class="builtintype" id="7016656">nil</span><span class="op" id="7016659">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016662">if</span>&nbsp;<span class="ident" id="7016665">err</span>&nbsp;<span class="op" id="7016669">!=</span>&nbsp;<span class="builtintype" id="7016672">nil</span>&nbsp;<span class="op" id="7016676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016680">t</span><span class="op" id="7016681">.</span><span class="ident" id="7016682">Error</span><span class="op" id="7016687">(</span><span class="ident" id="7016688">err</span><span class="op" id="7016691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016694">}</span><br>
<span class="lineno"></span><span class="op" id="7016696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7016699">func</span>&nbsp;<span class="ident" id="7016704">eq</span><span class="op" id="7016706">(</span><span class="ident" id="7016707">a</span><span class="op" id="7016708">,</span>&nbsp;<span class="ident" id="7016710">b</span>&nbsp;<span class="builtintype" id="7016712">int32</span><span class="op" id="7016717">)</span>&nbsp;<span class="builtintype" id="7016719">int</span>&nbsp;<span class="op" id="7016723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016726">if</span>&nbsp;<span class="ident" id="7016729">a</span>&nbsp;<span class="op" id="7016731">==</span>&nbsp;<span class="ident" id="7016734">b</span>&nbsp;<span class="op" id="7016736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016740">return</span>&nbsp;<span class="num" id="7016747">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016753">return</span>&nbsp;<span class="num" id="7016760">0</span><br>
<span class="lineno">70</span><span class="op" id="7016762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016765">func</span>&nbsp;<span class="ident" id="7016770">TestConstantTimeEq</span><span class="op" id="7016788">(</span><span class="ident" id="7016789">t</span>&nbsp;<span class="op" id="7016791">*</span><span class="ident" id="7016792">testing</span><span class="op" id="7016799">.</span><span class="ident" id="7016800">T</span><span class="op" id="7016801">)</span>&nbsp;<span class="op" id="7016803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016806">err</span>&nbsp;<span class="op" id="7016810">:=</span>&nbsp;<span class="ident" id="7016813">quick</span><span class="op" id="7016818">.</span><span class="ident" id="7016819">CheckEqual</span><span class="op" id="7016829">(</span><span class="ident" id="7016830">ConstantTimeEq</span><span class="op" id="7016844">,</span>&nbsp;<span class="ident" id="7016846">eq</span><span class="op" id="7016848">,</span>&nbsp;<span class="builtintype" id="7016850">nil</span><span class="op" id="7016853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016856">if</span>&nbsp;<span class="ident" id="7016859">err</span>&nbsp;<span class="op" id="7016863">!=</span>&nbsp;<span class="builtintype" id="7016866">nil</span>&nbsp;<span class="op" id="7016870">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016874">t</span><span class="op" id="7016875">.</span><span class="ident" id="7016876">Error</span><span class="op" id="7016881">(</span><span class="ident" id="7016882">err</span><span class="op" id="7016885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016888">}</span><br>
<span class="lineno"></span><span class="op" id="7016890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016893">func</span>&nbsp;<span class="ident" id="7016898">makeCopy</span><span class="op" id="7016906">(</span><span class="ident" id="7016907">v</span>&nbsp;<span class="builtintype" id="7016909">int</span><span class="op" id="7016912">,</span>&nbsp;<span class="ident" id="7016914">x</span><span class="op" id="7016915">,</span>&nbsp;<span class="ident" id="7016917">y</span>&nbsp;<span class="op" id="7016919">[</span><span class="op" id="7016920">]</span><span class="builtintype" id="7016921">byte</span><span class="op" id="7016925">)</span>&nbsp;<span class="op" id="7016927">[</span><span class="op" id="7016928">]</span><span class="builtintype" id="7016929">byte</span>&nbsp;<span class="op" id="7016934">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016937">if</span>&nbsp;<span class="builtinfunc" id="7016940">len</span><span class="op" id="7016943">(</span><span class="ident" id="7016944">x</span><span class="op" id="7016945">)</span>&nbsp;<span class="op" id="7016947">&gt;</span>&nbsp;<span class="builtinfunc" id="7016949">len</span><span class="op" id="7016952">(</span><span class="ident" id="7016953">y</span><span class="op" id="7016954">)</span>&nbsp;<span class="op" id="7016956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016960">x</span>&nbsp;<span class="op" id="7016962">=</span>&nbsp;<span class="ident" id="7016964">x</span><span class="op" id="7016965">[</span><span class="num" id="7016966">0</span><span class="op" id="7016967">:</span><span class="builtinfunc" id="7016968">len</span><span class="op" id="7016971">(</span><span class="ident" id="7016972">y</span><span class="op" id="7016973">)</span><span class="op" id="7016974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016977">}</span>&nbsp;<span class="keyword" id="7016979">else</span>&nbsp;<span class="op" id="7016984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016988">y</span>&nbsp;<span class="op" id="7016990">=</span>&nbsp;<span class="ident" id="7016992">y</span><span class="op" id="7016993">[</span><span class="num" id="7016994">0</span><span class="op" id="7016995">:</span><span class="builtinfunc" id="7016996">len</span><span class="op" id="7016999">(</span><span class="ident" id="7017000">x</span><span class="op" id="7017001">)</span><span class="op" id="7017002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017005">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017008">if</span>&nbsp;<span class="ident" id="7017011">v</span>&nbsp;<span class="op" id="7017013">==</span>&nbsp;<span class="num" id="7017016">1</span>&nbsp;<span class="op" id="7017018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7017022">copy</span><span class="op" id="7017026">(</span><span class="ident" id="7017027">x</span><span class="op" id="7017028">,</span>&nbsp;<span class="ident" id="7017030">y</span><span class="op" id="7017031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017037">return</span>&nbsp;<span class="ident" id="7017044">x</span><br>
<span class="lineno"></span><span class="op" id="7017046">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7017049">func</span>&nbsp;<span class="ident" id="7017054">constantTimeCopyWrapper</span><span class="op" id="7017077">(</span><span class="ident" id="7017078">v</span>&nbsp;<span class="builtintype" id="7017080">int</span><span class="op" id="7017083">,</span>&nbsp;<span class="ident" id="7017085">x</span><span class="op" id="7017086">,</span>&nbsp;<span class="ident" id="7017088">y</span>&nbsp;<span class="op" id="7017090">[</span><span class="op" id="7017091">]</span><span class="builtintype" id="7017092">byte</span><span class="op" id="7017096">)</span>&nbsp;<span class="op" id="7017098">[</span><span class="op" id="7017099">]</span><span class="builtintype" id="7017100">byte</span>&nbsp;<span class="op" id="7017105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017108">if</span>&nbsp;<span class="builtinfunc" id="7017111">len</span><span class="op" id="7017114">(</span><span class="ident" id="7017115">x</span><span class="op" id="7017116">)</span>&nbsp;<span class="op" id="7017118">&gt;</span>&nbsp;<span class="builtinfunc" id="7017120">len</span><span class="op" id="7017123">(</span><span class="ident" id="7017124">y</span><span class="op" id="7017125">)</span>&nbsp;<span class="op" id="7017127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017131">x</span>&nbsp;<span class="op" id="7017133">=</span>&nbsp;<span class="ident" id="7017135">x</span><span class="op" id="7017136">[</span><span class="num" id="7017137">0</span><span class="op" id="7017138">:</span><span class="builtinfunc" id="7017139">len</span><span class="op" id="7017142">(</span><span class="ident" id="7017143">y</span><span class="op" id="7017144">)</span><span class="op" id="7017145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017148">}</span>&nbsp;<span class="keyword" id="7017150">else</span>&nbsp;<span class="op" id="7017155">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017159">y</span>&nbsp;<span class="op" id="7017161">=</span>&nbsp;<span class="ident" id="7017163">y</span><span class="op" id="7017164">[</span><span class="num" id="7017165">0</span><span class="op" id="7017166">:</span><span class="builtinfunc" id="7017167">len</span><span class="op" id="7017170">(</span><span class="ident" id="7017171">x</span><span class="op" id="7017172">)</span><span class="op" id="7017173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017179">v</span>&nbsp;<span class="op" id="7017181">&amp;=</span>&nbsp;<span class="num" id="7017184">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017187">ConstantTimeCopy</span><span class="op" id="7017203">(</span><span class="ident" id="7017204">v</span><span class="op" id="7017205">,</span>&nbsp;<span class="ident" id="7017207">x</span><span class="op" id="7017208">,</span>&nbsp;<span class="ident" id="7017210">y</span><span class="op" id="7017211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017214">return</span>&nbsp;<span class="ident" id="7017221">x</span><br>
<span class="lineno">100</span><span class="op" id="7017223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017226">func</span>&nbsp;<span class="ident" id="7017231">TestConstantTimeCopy</span><span class="op" id="7017251">(</span><span class="ident" id="7017252">t</span>&nbsp;<span class="op" id="7017254">*</span><span class="ident" id="7017255">testing</span><span class="op" id="7017262">.</span><span class="ident" id="7017263">T</span><span class="op" id="7017264">)</span>&nbsp;<span class="op" id="7017266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017269">err</span>&nbsp;<span class="op" id="7017273">:=</span>&nbsp;<span class="ident" id="7017276">quick</span><span class="op" id="7017281">.</span><span class="ident" id="7017282">CheckEqual</span><span class="op" id="7017292">(</span><span class="ident" id="7017293">constantTimeCopyWrapper</span><span class="op" id="7017316">,</span>&nbsp;<span class="ident" id="7017318">makeCopy</span><span class="op" id="7017326">,</span>&nbsp;<span class="builtintype" id="7017328">nil</span><span class="op" id="7017331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017334">if</span>&nbsp;<span class="ident" id="7017337">err</span>&nbsp;<span class="op" id="7017341">!=</span>&nbsp;<span class="builtintype" id="7017344">nil</span>&nbsp;<span class="op" id="7017348">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017352">t</span><span class="op" id="7017353">.</span><span class="ident" id="7017354">Error</span><span class="op" id="7017359">(</span><span class="ident" id="7017360">err</span><span class="op" id="7017363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017366">}</span><br>
<span class="lineno"></span><span class="op" id="7017368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017371">var</span>&nbsp;<span class="ident" id="7017375">lessOrEqTests</span>&nbsp;<span class="op" id="7017389">=</span>&nbsp;<span class="op" id="7017391">[</span><span class="op" id="7017392">]</span><span class="keyword" id="7017393">struct</span>&nbsp;<span class="op" id="7017400">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017403">x</span><span class="op" id="7017404">,</span>&nbsp;<span class="ident" id="7017406">y</span><span class="op" id="7017407">,</span>&nbsp;<span class="ident" id="7017409">result</span>&nbsp;<span class="builtintype" id="7017416">int</span><br>
<span class="lineno"></span><span class="op" id="7017420">}</span><span class="op" id="7017421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017424">{</span><span class="num" id="7017425">0</span><span class="op" id="7017426">,</span>&nbsp;<span class="num" id="7017428">0</span><span class="op" id="7017429">,</span>&nbsp;<span class="num" id="7017431">1</span><span class="op" id="7017432">}</span><span class="op" id="7017433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017436">{</span><span class="num" id="7017437">1</span><span class="op" id="7017438">,</span>&nbsp;<span class="num" id="7017440">0</span><span class="op" id="7017441">,</span>&nbsp;<span class="num" id="7017443">0</span><span class="op" id="7017444">}</span><span class="op" id="7017445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017448">{</span><span class="num" id="7017449">0</span><span class="op" id="7017450">,</span>&nbsp;<span class="num" id="7017452">1</span><span class="op" id="7017453">,</span>&nbsp;<span class="num" id="7017455">1</span><span class="op" id="7017456">}</span><span class="op" id="7017457">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017460">{</span><span class="num" id="7017461">10</span><span class="op" id="7017463">,</span>&nbsp;<span class="num" id="7017465">20</span><span class="op" id="7017467">,</span>&nbsp;<span class="num" id="7017469">1</span><span class="op" id="7017470">}</span><span class="op" id="7017471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017474">{</span><span class="num" id="7017475">20</span><span class="op" id="7017477">,</span>&nbsp;<span class="num" id="7017479">10</span><span class="op" id="7017481">,</span>&nbsp;<span class="num" id="7017483">0</span><span class="op" id="7017484">}</span><span class="op" id="7017485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017488">{</span><span class="num" id="7017489">10</span><span class="op" id="7017491">,</span>&nbsp;<span class="num" id="7017493">10</span><span class="op" id="7017495">,</span>&nbsp;<span class="num" id="7017497">1</span><span class="op" id="7017498">}</span><span class="op" id="7017499">,</span><br>
<span class="lineno"></span><span class="op" id="7017501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7017504">func</span>&nbsp;<span class="ident" id="7017509">TestConstantTimeLessOrEq</span><span class="op" id="7017533">(</span><span class="ident" id="7017534">t</span>&nbsp;<span class="op" id="7017536">*</span><span class="ident" id="7017537">testing</span><span class="op" id="7017544">.</span><span class="ident" id="7017545">T</span><span class="op" id="7017546">)</span>&nbsp;<span class="op" id="7017548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017551">for</span>&nbsp;<span class="ident" id="7017555">i</span><span class="op" id="7017556">,</span>&nbsp;<span class="ident" id="7017558">test</span>&nbsp;<span class="op" id="7017563">:=</span>&nbsp;<span class="keyword" id="7017566">range</span>&nbsp;<span class="ident" id="7017572">lessOrEqTests</span>&nbsp;<span class="op" id="7017586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017590">result</span>&nbsp;<span class="op" id="7017597">:=</span>&nbsp;<span class="ident" id="7017600">ConstantTimeLessOrEq</span><span class="op" id="7017620">(</span><span class="ident" id="7017621">test</span><span class="op" id="7017625">.</span><span class="ident" id="7017626">x</span><span class="op" id="7017627">,</span>&nbsp;<span class="ident" id="7017629">test</span><span class="op" id="7017633">.</span><span class="ident" id="7017634">y</span><span class="op" id="7017635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017639">if</span>&nbsp;<span class="ident" id="7017642">result</span>&nbsp;<span class="op" id="7017649">!=</span>&nbsp;<span class="ident" id="7017652">test</span><span class="op" id="7017656">.</span><span class="ident" id="7017657">result</span>&nbsp;<span class="op" id="7017664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017669">t</span><span class="op" id="7017670">.</span><span class="ident" id="7017671">Errorf</span><span class="op" id="7017677">(</span><span class="string" id="7017678">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7017714">,</span>&nbsp;<span class="ident" id="7017716">i</span><span class="op" id="7017717">,</span>&nbsp;<span class="ident" id="7017719">test</span><span class="op" id="7017723">.</span><span class="ident" id="7017724">x</span><span class="op" id="7017725">,</span>&nbsp;<span class="ident" id="7017727">test</span><span class="op" id="7017731">.</span><span class="ident" id="7017732">y</span><span class="op" id="7017733">,</span>&nbsp;<span class="ident" id="7017735">result</span><span class="op" id="7017741">,</span>&nbsp;<span class="ident" id="7017743">test</span><span class="op" id="7017747">.</span><span class="ident" id="7017748">result</span><span class="op" id="7017754">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017761">}</span><br>
<span class="lineno"></span><span class="op" id="7017763">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
