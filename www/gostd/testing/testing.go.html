<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6192499">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6192554">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6192608">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6192659">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6192733">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6192819">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6192860">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6192892">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6192973">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6193024">//</span><br>
<span class="lineno"></span><span class="comment" id="6193027">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6193112">//</span><br>
<span class="lineno"></span><span class="comment" id="6193115">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6193189">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6193267">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6193342">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6193418">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6193485">//</span><br>
<span class="lineno">20</span><span class="comment" id="6193488">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6193560">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6193593">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6193639">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6193671">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6193725">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6193738">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6193753">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6193762">//</span><br>
<span class="lineno"></span><span class="comment" id="6193765">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6193779">//</span><br>
<span class="lineno"></span><span class="comment" id="6193782">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6193807">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6193844">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6193921">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6193986">//</span><br>
<span class="lineno"></span><span class="comment" id="6193989">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6194036">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6194099">//</span><br>
<span class="lineno"></span><span class="comment" id="6194102">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6194150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6194193">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6194231">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6194267">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6194280">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6194289">//</span><br>
<span class="lineno"></span><span class="comment" id="6194292">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6194354">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6194435">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6194484">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6194531">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6194604">//</span><br>
<span class="lineno"></span><span class="comment" id="6194607">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6194678">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6194695">//</span><br>
<span class="lineno">55</span><span class="comment" id="6194698">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6194742">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6194769">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6194795">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6194833">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6194858">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6194871">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6194880">//</span><br>
<span class="lineno"></span><span class="comment" id="6194883">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6194961">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6195042">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6195068">//</span><br>
<span class="lineno"></span><span class="comment" id="6195071">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6195125">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6195204">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6195252">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6195288">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6195319">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6195350">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6195398">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6195415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6195429">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6195438">//</span><br>
<span class="lineno"></span><span class="comment" id="6195441">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6195453">//</span><br>
<span class="lineno">80</span><span class="comment" id="6195456">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6195530">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6195615">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6195694">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6195768">//</span><br>
<span class="lineno">85</span><span class="comment" id="6195771">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6195800">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6195836">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6195868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6195877">//</span><br>
<span class="lineno">90</span><span class="comment" id="6195880">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6195915">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6195956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6195994">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6196020">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6196049">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6196075">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196084">//</span><br>
<span class="lineno"></span><span class="comment" id="6196087">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6196163">//</span><br>
<span class="lineno">100</span><span class="comment" id="6196166">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6196255">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6196282">//</span><br>
<span class="lineno"></span><span class="comment" id="6196285">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196315">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6196346">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196377">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196410">//</span><br>
<span class="lineno"></span><span class="comment" id="6196413">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6196497">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6196570">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6196592">//</span><br>
<span class="lineno"></span><span class="comment" id="6196595">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196632">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196670">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6196708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6196748">//</span><br>
<span class="lineno"></span><span class="comment" id="6196751">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6196829">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6196907">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6196959">//</span><br>
<span class="lineno"></span><span class="comment" id="6196962">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6196970">//</span><br>
<span class="lineno"></span><span class="comment" id="6196973">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6197051">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6197132">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6197205">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6197244">//</span><br>
<span class="lineno"></span><span class="comment" id="6197247">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6197278">//</span><br>
<span class="lineno">130</span><span class="comment" id="6197281">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6197359">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6197434">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6197507">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6197544">//</span><br>
<span class="lineno">135</span><span class="comment" id="6197547">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6197593">//</span><br>
<span class="lineno"></span><span class="comment" id="6197596">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6197648">//</span><br>
<span class="lineno"></span><span class="comment" id="6197651">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6197737">package</span>&nbsp;<span class="ident" id="6197745">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6197754">import</span>&nbsp;<span class="op" id="6197761">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197764">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197773">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197781">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197788">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197794">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197805">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197822">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197833">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197844">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6197852">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6197859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6197862">var</span>&nbsp;<span class="op" id="6197866">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6197869">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6197948">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198025">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198103">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198180">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198210">short</span>&nbsp;<span class="op" id="6198216">=</span>&nbsp;<span class="ident" id="6198218">flag</span><span class="op" id="6198222">.</span><span class="ident" id="6198223">Bool</span><span class="op" id="6198227">(</span><span class="string" id="6198228">&#34;test.short&#34;</span><span class="op" id="6198240">,</span>&nbsp;<span class="builtintype" id="6198242">false</span><span class="op" id="6198247">,</span>&nbsp;<span class="string" id="6198249">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6198286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198290">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198369">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198448">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198535">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198569">outputDir</span>&nbsp;<span class="op" id="6198579">=</span>&nbsp;<span class="ident" id="6198581">flag</span><span class="op" id="6198585">.</span><span class="ident" id="6198586">String</span><span class="op" id="6198592">(</span><span class="string" id="6198593">&#34;test.outputdir&#34;</span><span class="op" id="6198609">,</span>&nbsp;<span class="string" id="6198611">&#34;&#34;</span><span class="op" id="6198613">,</span>&nbsp;<span class="string" id="6198615">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6198653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6198657">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198717">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198734">=</span>&nbsp;<span class="ident" id="6198736">flag</span><span class="op" id="6198740">.</span><span class="ident" id="6198741">Bool</span><span class="op" id="6198745">(</span><span class="string" id="6198746">&#34;test.v&#34;</span><span class="op" id="6198754">,</span>&nbsp;<span class="builtintype" id="6198756">false</span><span class="op" id="6198761">,</span>&nbsp;<span class="string" id="6198763">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6198797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198800">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198817">=</span>&nbsp;<span class="ident" id="6198819">flag</span><span class="op" id="6198823">.</span><span class="ident" id="6198824">String</span><span class="op" id="6198830">(</span><span class="string" id="6198831">&#34;test.coverprofile&#34;</span><span class="op" id="6198850">,</span>&nbsp;<span class="string" id="6198852">&#34;&#34;</span><span class="op" id="6198854">,</span>&nbsp;<span class="string" id="6198856">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6198916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198919">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198936">=</span>&nbsp;<span class="ident" id="6198938">flag</span><span class="op" id="6198942">.</span><span class="ident" id="6198943">String</span><span class="op" id="6198949">(</span><span class="string" id="6198950">&#34;test.run&#34;</span><span class="op" id="6198960">,</span>&nbsp;<span class="string" id="6198962">&#34;&#34;</span><span class="op" id="6198964">,</span>&nbsp;<span class="string" id="6198966">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6199022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199025">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199042">=</span>&nbsp;<span class="ident" id="6199044">flag</span><span class="op" id="6199048">.</span><span class="ident" id="6199049">String</span><span class="op" id="6199055">(</span><span class="string" id="6199056">&#34;test.memprofile&#34;</span><span class="op" id="6199073">,</span>&nbsp;<span class="string" id="6199075">&#34;&#34;</span><span class="op" id="6199077">,</span>&nbsp;<span class="string" id="6199079">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6199137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199140">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6199157">=</span>&nbsp;<span class="ident" id="6199159">flag</span><span class="op" id="6199163">.</span><span class="ident" id="6199164">Int</span><span class="op" id="6199167">(</span><span class="string" id="6199168">&#34;test.memprofilerate&#34;</span><span class="op" id="6199189">,</span>&nbsp;<span class="num" id="6199191">0</span><span class="op" id="6199192">,</span>&nbsp;<span class="string" id="6199194">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6199231">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199234">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199251">=</span>&nbsp;<span class="ident" id="6199253">flag</span><span class="op" id="6199257">.</span><span class="ident" id="6199258">String</span><span class="op" id="6199264">(</span><span class="string" id="6199265">&#34;test.cpuprofile&#34;</span><span class="op" id="6199282">,</span>&nbsp;<span class="string" id="6199284">&#34;&#34;</span><span class="op" id="6199286">,</span>&nbsp;<span class="string" id="6199288">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6199344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199347">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199364">=</span>&nbsp;<span class="ident" id="6199366">flag</span><span class="op" id="6199370">.</span><span class="ident" id="6199371">String</span><span class="op" id="6199377">(</span><span class="string" id="6199378">&#34;test.blockprofile&#34;</span><span class="op" id="6199397">,</span>&nbsp;<span class="string" id="6199399">&#34;&#34;</span><span class="op" id="6199401">,</span>&nbsp;<span class="string" id="6199403">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6199473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199476">blockProfileRate</span>&nbsp;<span class="op" id="6199493">=</span>&nbsp;<span class="ident" id="6199495">flag</span><span class="op" id="6199499">.</span><span class="ident" id="6199500">Int</span><span class="op" id="6199503">(</span><span class="string" id="6199504">&#34;test.blockprofilerate&#34;</span><span class="op" id="6199527">,</span>&nbsp;<span class="num" id="6199529">1</span><span class="op" id="6199530">,</span>&nbsp;<span class="string" id="6199532">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6199578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199581">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199598">=</span>&nbsp;<span class="ident" id="6199600">flag</span><span class="op" id="6199604">.</span><span class="ident" id="6199605">Duration</span><span class="op" id="6199613">(</span><span class="string" id="6199614">&#34;test.timeout&#34;</span><span class="op" id="6199628">,</span>&nbsp;<span class="num" id="6199630">0</span><span class="op" id="6199631">,</span>&nbsp;<span class="string" id="6199633">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6199690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199693">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199710">=</span>&nbsp;<span class="ident" id="6199712">flag</span><span class="op" id="6199716">.</span><span class="ident" id="6199717">String</span><span class="op" id="6199723">(</span><span class="string" id="6199724">&#34;test.cpu&#34;</span><span class="op" id="6199734">,</span>&nbsp;<span class="string" id="6199736">&#34;&#34;</span><span class="op" id="6199738">,</span>&nbsp;<span class="string" id="6199740">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6199801">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199804">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6199821">=</span>&nbsp;<span class="ident" id="6199823">flag</span><span class="op" id="6199827">.</span><span class="ident" id="6199828">Int</span><span class="op" id="6199831">(</span><span class="string" id="6199832">&#34;test.parallel&#34;</span><span class="op" id="6199847">,</span>&nbsp;<span class="ident" id="6199849">runtime</span><span class="op" id="6199856">.</span><span class="ident" id="6199857">GOMAXPROCS</span><span class="op" id="6199867">(</span><span class="num" id="6199868">0</span><span class="op" id="6199869">)</span><span class="op" id="6199870">,</span>&nbsp;<span class="string" id="6199872">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6199898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199902">haveExamples</span>&nbsp;<span class="builtintype" id="6199915">bool</span>&nbsp;<span class="comment" id="6199920">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6199945">cpuList</span>&nbsp;<span class="op" id="6199953">[</span><span class="op" id="6199954">]</span><span class="builtintype" id="6199955">int</span><br>
<span class="lineno">185</span><span class="op" id="6199959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6199962">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6200018">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6200061">type</span>&nbsp;<span class="ident" id="6200066">common</span>&nbsp;<span class="keyword" id="6200073">struct</span>&nbsp;<span class="op" id="6200080">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200083">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6200092">sync</span><span class="op" id="6200096">.</span><span class="ident" id="6200097">RWMutex</span>&nbsp;<span class="comment" id="6200105">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200134">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6200143">[</span><span class="op" id="6200144">]</span><span class="builtintype" id="6200145">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6200156">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200199">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6200208">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6200221">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200255">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6200264">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6200277">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200317">finished</span>&nbsp;<span class="builtintype" id="6200326">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200333">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6200342">time</span><span class="op" id="6200346">.</span><span class="ident" id="6200347">Time</span>&nbsp;<span class="comment" id="6200352">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200387">duration</span>&nbsp;<span class="ident" id="6200396">time</span><span class="op" id="6200400">.</span><span class="ident" id="6200401">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200411">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6200420">interface</span><span class="op" id="6200429">{</span><span class="op" id="6200430">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6200437">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200481">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6200490">chan</span>&nbsp;<span class="keyword" id="6200495">interface</span><span class="op" id="6200504">{</span><span class="op" id="6200505">}</span>&nbsp;<span class="comment" id="6200507">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6200535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6200538">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6200592">func</span>&nbsp;<span class="ident" id="6200597">Short</span><span class="op" id="6200602">(</span><span class="op" id="6200603">)</span>&nbsp;<span class="builtintype" id="6200605">bool</span>&nbsp;<span class="op" id="6200610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6200613">return</span>&nbsp;<span class="op" id="6200620">*</span><span class="ident" id="6200621">short</span><br>
<span class="lineno">205</span><span class="op" id="6200627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6200630">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6200682">func</span>&nbsp;<span class="ident" id="6200687">Verbose</span><span class="op" id="6200694">(</span><span class="op" id="6200695">)</span>&nbsp;<span class="builtintype" id="6200697">bool</span>&nbsp;<span class="op" id="6200702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6200705">return</span>&nbsp;<span class="op" id="6200712">*</span><span class="ident" id="6200713">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6200720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6200723">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6200795">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6200875">func</span>&nbsp;<span class="ident" id="6200880">decorate</span><span class="op" id="6200888">(</span><span class="ident" id="6200889">s</span>&nbsp;<span class="builtintype" id="6200891">string</span><span class="op" id="6200897">)</span>&nbsp;<span class="builtintype" id="6200899">string</span>&nbsp;<span class="op" id="6200906">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6200909">_</span><span class="op" id="6200910">,</span>&nbsp;<span class="ident" id="6200912">file</span><span class="op" id="6200916">,</span>&nbsp;<span class="ident" id="6200918">line</span><span class="op" id="6200922">,</span>&nbsp;<span class="ident" id="6200924">ok</span>&nbsp;<span class="op" id="6200927">:=</span>&nbsp;<span class="ident" id="6200930">runtime</span><span class="op" id="6200937">.</span><span class="ident" id="6200938">Caller</span><span class="op" id="6200944">(</span><span class="num" id="6200945">3</span><span class="op" id="6200946">)</span>&nbsp;<span class="comment" id="6200948">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6200986">if</span>&nbsp;<span class="ident" id="6200989">ok</span>&nbsp;<span class="op" id="6200992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6200996">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201049">if</span>&nbsp;<span class="ident" id="6201052">index</span>&nbsp;<span class="op" id="6201058">:=</span>&nbsp;<span class="ident" id="6201061">strings</span><span class="op" id="6201068">.</span><span class="ident" id="6201069">LastIndex</span><span class="op" id="6201078">(</span><span class="ident" id="6201079">file</span><span class="op" id="6201083">,</span>&nbsp;<span class="string" id="6201085">&#34;/&#34;</span><span class="op" id="6201088">)</span><span class="op" id="6201089">;</span>&nbsp;<span class="ident" id="6201091">index</span>&nbsp;<span class="op" id="6201097">&gt;=</span>&nbsp;<span class="num" id="6201100">0</span>&nbsp;<span class="op" id="6201102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201107">file</span>&nbsp;<span class="op" id="6201112">=</span>&nbsp;<span class="ident" id="6201114">file</span><span class="op" id="6201118">[</span><span class="ident" id="6201119">index</span><span class="op" id="6201124">+</span><span class="num" id="6201125">1</span><span class="op" id="6201126">:</span><span class="op" id="6201127">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201131">}</span>&nbsp;<span class="keyword" id="6201133">else</span>&nbsp;<span class="keyword" id="6201138">if</span>&nbsp;<span class="ident" id="6201141">index</span>&nbsp;<span class="op" id="6201147">=</span>&nbsp;<span class="ident" id="6201149">strings</span><span class="op" id="6201156">.</span><span class="ident" id="6201157">LastIndex</span><span class="op" id="6201166">(</span><span class="ident" id="6201167">file</span><span class="op" id="6201171">,</span>&nbsp;<span class="string" id="6201173">&#34;\\&#34;</span><span class="op" id="6201177">)</span><span class="op" id="6201178">;</span>&nbsp;<span class="ident" id="6201180">index</span>&nbsp;<span class="op" id="6201186">&gt;=</span>&nbsp;<span class="num" id="6201189">0</span>&nbsp;<span class="op" id="6201191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201196">file</span>&nbsp;<span class="op" id="6201201">=</span>&nbsp;<span class="ident" id="6201203">file</span><span class="op" id="6201207">[</span><span class="ident" id="6201208">index</span><span class="op" id="6201213">+</span><span class="num" id="6201214">1</span><span class="op" id="6201215">:</span><span class="op" id="6201216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201223">}</span>&nbsp;<span class="keyword" id="6201225">else</span>&nbsp;<span class="op" id="6201230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201234">file</span>&nbsp;<span class="op" id="6201239">=</span>&nbsp;<span class="string" id="6201241">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201249">line</span>&nbsp;<span class="op" id="6201254">=</span>&nbsp;<span class="num" id="6201256">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201262">buf</span>&nbsp;<span class="op" id="6201266">:=</span>&nbsp;<span class="builtinfunc" id="6201269">new</span><span class="op" id="6201272">(</span><span class="ident" id="6201273">bytes</span><span class="op" id="6201278">.</span><span class="ident" id="6201279">Buffer</span><span class="op" id="6201285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6201288">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201333">buf</span><span class="op" id="6201336">.</span><span class="ident" id="6201337">WriteByte</span><span class="op" id="6201346">(</span><span class="string" id="6201347">&#39;\t&#39;</span><span class="op" id="6201351">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201354">fmt</span><span class="op" id="6201357">.</span><span class="ident" id="6201358">Fprintf</span><span class="op" id="6201365">(</span><span class="ident" id="6201366">buf</span><span class="op" id="6201369">,</span>&nbsp;<span class="string" id="6201371">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6201380">,</span>&nbsp;<span class="ident" id="6201382">file</span><span class="op" id="6201386">,</span>&nbsp;<span class="ident" id="6201388">line</span><span class="op" id="6201392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201395">lines</span>&nbsp;<span class="op" id="6201401">:=</span>&nbsp;<span class="ident" id="6201404">strings</span><span class="op" id="6201411">.</span><span class="ident" id="6201412">Split</span><span class="op" id="6201417">(</span><span class="ident" id="6201418">s</span><span class="op" id="6201419">,</span>&nbsp;<span class="string" id="6201421">&#34;\n&#34;</span><span class="op" id="6201425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201428">if</span>&nbsp;<span class="ident" id="6201431">l</span>&nbsp;<span class="op" id="6201433">:=</span>&nbsp;<span class="builtinfunc" id="6201436">len</span><span class="op" id="6201439">(</span><span class="ident" id="6201440">lines</span><span class="op" id="6201445">)</span><span class="op" id="6201446">;</span>&nbsp;<span class="ident" id="6201448">l</span>&nbsp;<span class="op" id="6201450">&gt;</span>&nbsp;<span class="num" id="6201452">1</span>&nbsp;<span class="op" id="6201454">&amp;&amp;</span>&nbsp;<span class="ident" id="6201457">lines</span><span class="op" id="6201462">[</span><span class="ident" id="6201463">l</span><span class="op" id="6201464">-</span><span class="num" id="6201465">1</span><span class="op" id="6201466">]</span>&nbsp;<span class="op" id="6201468">==</span>&nbsp;<span class="string" id="6201471">&#34;&#34;</span>&nbsp;<span class="op" id="6201474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201478">lines</span>&nbsp;<span class="op" id="6201484">=</span>&nbsp;<span class="ident" id="6201486">lines</span><span class="op" id="6201491">[</span><span class="op" id="6201492">:</span><span class="ident" id="6201493">l</span><span class="op" id="6201494">-</span><span class="num" id="6201495">1</span><span class="op" id="6201496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201499">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201502">for</span>&nbsp;<span class="ident" id="6201506">i</span><span class="op" id="6201507">,</span>&nbsp;<span class="ident" id="6201509">line</span>&nbsp;<span class="op" id="6201514">:=</span>&nbsp;<span class="keyword" id="6201517">range</span>&nbsp;<span class="ident" id="6201523">lines</span>&nbsp;<span class="op" id="6201529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201533">if</span>&nbsp;<span class="ident" id="6201536">i</span>&nbsp;<span class="op" id="6201538">&gt;</span>&nbsp;<span class="num" id="6201540">0</span>&nbsp;<span class="op" id="6201542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6201547">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201608">buf</span><span class="op" id="6201611">.</span><span class="ident" id="6201612">WriteString</span><span class="op" id="6201623">(</span><span class="string" id="6201624">&#34;\n\t\t&#34;</span><span class="op" id="6201632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201636">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201640">buf</span><span class="op" id="6201643">.</span><span class="ident" id="6201644">WriteString</span><span class="op" id="6201655">(</span><span class="ident" id="6201656">line</span><span class="op" id="6201660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6201663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201666">buf</span><span class="op" id="6201669">.</span><span class="ident" id="6201670">WriteByte</span><span class="op" id="6201679">(</span><span class="string" id="6201680">&#39;\n&#39;</span><span class="op" id="6201684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201687">return</span>&nbsp;<span class="ident" id="6201694">buf</span><span class="op" id="6201697">.</span><span class="ident" id="6201698">String</span><span class="op" id="6201704">(</span><span class="op" id="6201705">)</span><br>
<span class="lineno"></span><span class="op" id="6201707">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6201710">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6201779">func</span>&nbsp;<span class="ident" id="6201784">fmtDuration</span><span class="op" id="6201795">(</span><span class="ident" id="6201796">d</span>&nbsp;<span class="ident" id="6201798">time</span><span class="op" id="6201802">.</span><span class="ident" id="6201803">Duration</span><span class="op" id="6201811">)</span>&nbsp;<span class="builtintype" id="6201813">string</span>&nbsp;<span class="op" id="6201820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6201823">return</span>&nbsp;<span class="ident" id="6201830">fmt</span><span class="op" id="6201833">.</span><span class="ident" id="6201834">Sprintf</span><span class="op" id="6201841">(</span><span class="string" id="6201842">&#34;%.2fs&#34;</span><span class="op" id="6201849">,</span>&nbsp;<span class="ident" id="6201851">d</span><span class="op" id="6201852">.</span><span class="ident" id="6201853">Seconds</span><span class="op" id="6201860">(</span><span class="op" id="6201861">)</span><span class="op" id="6201862">)</span><br>
<span class="lineno"></span><span class="op" id="6201864">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6201867">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6201909">type</span>&nbsp;<span class="ident" id="6201914">TB</span>&nbsp;<span class="keyword" id="6201917">interface</span>&nbsp;<span class="op" id="6201927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201930">Error</span><span class="op" id="6201935">(</span><span class="ident" id="6201936">args</span>&nbsp;<span class="op" id="6201941">...</span><span class="keyword" id="6201944">interface</span><span class="op" id="6201953">{</span><span class="op" id="6201954">}</span><span class="op" id="6201955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6201958">Errorf</span><span class="op" id="6201964">(</span><span class="ident" id="6201965">format</span>&nbsp;<span class="builtintype" id="6201972">string</span><span class="op" id="6201978">,</span>&nbsp;<span class="ident" id="6201980">args</span>&nbsp;<span class="op" id="6201985">...</span><span class="keyword" id="6201988">interface</span><span class="op" id="6201997">{</span><span class="op" id="6201998">}</span><span class="op" id="6201999">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202002">Fail</span><span class="op" id="6202006">(</span><span class="op" id="6202007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202010">FailNow</span><span class="op" id="6202017">(</span><span class="op" id="6202018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202021">Failed</span><span class="op" id="6202027">(</span><span class="op" id="6202028">)</span>&nbsp;<span class="builtintype" id="6202030">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202036">Fatal</span><span class="op" id="6202041">(</span><span class="ident" id="6202042">args</span>&nbsp;<span class="op" id="6202047">...</span><span class="keyword" id="6202050">interface</span><span class="op" id="6202059">{</span><span class="op" id="6202060">}</span><span class="op" id="6202061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202064">Fatalf</span><span class="op" id="6202070">(</span><span class="ident" id="6202071">format</span>&nbsp;<span class="builtintype" id="6202078">string</span><span class="op" id="6202084">,</span>&nbsp;<span class="ident" id="6202086">args</span>&nbsp;<span class="op" id="6202091">...</span><span class="keyword" id="6202094">interface</span><span class="op" id="6202103">{</span><span class="op" id="6202104">}</span><span class="op" id="6202105">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202108">Log</span><span class="op" id="6202111">(</span><span class="ident" id="6202112">args</span>&nbsp;<span class="op" id="6202117">...</span><span class="keyword" id="6202120">interface</span><span class="op" id="6202129">{</span><span class="op" id="6202130">}</span><span class="op" id="6202131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202134">Logf</span><span class="op" id="6202138">(</span><span class="ident" id="6202139">format</span>&nbsp;<span class="builtintype" id="6202146">string</span><span class="op" id="6202152">,</span>&nbsp;<span class="ident" id="6202154">args</span>&nbsp;<span class="op" id="6202159">...</span><span class="keyword" id="6202162">interface</span><span class="op" id="6202171">{</span><span class="op" id="6202172">}</span><span class="op" id="6202173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202176">Skip</span><span class="op" id="6202180">(</span><span class="ident" id="6202181">args</span>&nbsp;<span class="op" id="6202186">...</span><span class="keyword" id="6202189">interface</span><span class="op" id="6202198">{</span><span class="op" id="6202199">}</span><span class="op" id="6202200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202203">SkipNow</span><span class="op" id="6202210">(</span><span class="op" id="6202211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202214">Skipf</span><span class="op" id="6202219">(</span><span class="ident" id="6202220">format</span>&nbsp;<span class="builtintype" id="6202227">string</span><span class="op" id="6202233">,</span>&nbsp;<span class="ident" id="6202235">args</span>&nbsp;<span class="op" id="6202240">...</span><span class="keyword" id="6202243">interface</span><span class="op" id="6202252">{</span><span class="op" id="6202253">}</span><span class="op" id="6202254">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202257">Skipped</span><span class="op" id="6202264">(</span><span class="op" id="6202265">)</span>&nbsp;<span class="builtintype" id="6202267">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202274">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202329">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202382">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202414">private</span><span class="op" id="6202421">(</span><span class="op" id="6202422">)</span><br>
<span class="lineno"></span><span class="op" id="6202424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6202427">var</span>&nbsp;<span class="ident" id="6202431">_</span>&nbsp;<span class="ident" id="6202433">TB</span>&nbsp;<span class="op" id="6202436">=</span>&nbsp;<span class="op" id="6202438">(</span><span class="op" id="6202439">*</span><span class="ident" id="6202440">T</span><span class="op" id="6202441">)</span><span class="op" id="6202442">(</span><span class="ident" id="6202443">nil</span><span class="op" id="6202446">)</span><br>
<span class="lineno"></span><span class="keyword" id="6202448">var</span>&nbsp;<span class="ident" id="6202452">_</span>&nbsp;<span class="ident" id="6202454">TB</span>&nbsp;<span class="op" id="6202457">=</span>&nbsp;<span class="op" id="6202459">(</span><span class="op" id="6202460">*</span><span class="ident" id="6202461">B</span><span class="op" id="6202462">)</span><span class="op" id="6202463">(</span><span class="ident" id="6202464">nil</span><span class="op" id="6202467">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6202470">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6202564">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6202645">type</span>&nbsp;<span class="ident" id="6202650">T</span>&nbsp;<span class="keyword" id="6202652">struct</span>&nbsp;<span class="op" id="6202659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202662">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202670">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6202684">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6202694">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202712">startParallel</span>&nbsp;<span class="keyword" id="6202726">chan</span>&nbsp;<span class="builtintype" id="6202731">bool</span>&nbsp;<span class="comment" id="6202736">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6202773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6202776">func</span>&nbsp;<span class="op" id="6202781">(</span><span class="ident" id="6202782">c</span>&nbsp;<span class="op" id="6202784">*</span><span class="ident" id="6202785">common</span><span class="op" id="6202791">)</span>&nbsp;<span class="ident" id="6202793">private</span><span class="op" id="6202800">(</span><span class="op" id="6202801">)</span>&nbsp;<span class="op" id="6202803">{</span><span class="op" id="6202804">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6202807">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6202876">func</span>&nbsp;<span class="op" id="6202881">(</span><span class="ident" id="6202882">c</span>&nbsp;<span class="op" id="6202884">*</span><span class="ident" id="6202885">common</span><span class="op" id="6202891">)</span>&nbsp;<span class="ident" id="6202893">Fail</span><span class="op" id="6202897">(</span><span class="op" id="6202898">)</span>&nbsp;<span class="op" id="6202900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202903">c</span><span class="op" id="6202904">.</span><span class="ident" id="6202905">mu</span><span class="op" id="6202907">.</span><span class="ident" id="6202908">Lock</span><span class="op" id="6202912">(</span><span class="op" id="6202913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202916">defer</span>&nbsp;<span class="ident" id="6202922">c</span><span class="op" id="6202923">.</span><span class="ident" id="6202924">mu</span><span class="op" id="6202926">.</span><span class="ident" id="6202927">Unlock</span><span class="op" id="6202933">(</span><span class="op" id="6202934">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202937">c</span><span class="op" id="6202938">.</span><span class="ident" id="6202939">failed</span>&nbsp;<span class="op" id="6202946">=</span>&nbsp;<span class="builtintype" id="6202948">true</span><br>
<span class="lineno"></span><span class="op" id="6202953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6202956">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6203007">func</span>&nbsp;<span class="op" id="6203012">(</span><span class="ident" id="6203013">c</span>&nbsp;<span class="op" id="6203015">*</span><span class="ident" id="6203016">common</span><span class="op" id="6203022">)</span>&nbsp;<span class="ident" id="6203024">Failed</span><span class="op" id="6203030">(</span><span class="op" id="6203031">)</span>&nbsp;<span class="builtintype" id="6203033">bool</span>&nbsp;<span class="op" id="6203038">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203041">c</span><span class="op" id="6203042">.</span><span class="ident" id="6203043">mu</span><span class="op" id="6203045">.</span><span class="ident" id="6203046">RLock</span><span class="op" id="6203051">(</span><span class="op" id="6203052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203055">defer</span>&nbsp;<span class="ident" id="6203061">c</span><span class="op" id="6203062">.</span><span class="ident" id="6203063">mu</span><span class="op" id="6203065">.</span><span class="ident" id="6203066">RUnlock</span><span class="op" id="6203073">(</span><span class="op" id="6203074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203077">return</span>&nbsp;<span class="ident" id="6203084">c</span><span class="op" id="6203085">.</span><span class="ident" id="6203086">failed</span><br>
<span class="lineno"></span><span class="op" id="6203093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6203096">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6203168">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6203226">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6203283">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6203340">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6203398">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6203425">func</span>&nbsp;<span class="op" id="6203430">(</span><span class="ident" id="6203431">c</span>&nbsp;<span class="op" id="6203433">*</span><span class="ident" id="6203434">common</span><span class="op" id="6203440">)</span>&nbsp;<span class="ident" id="6203442">FailNow</span><span class="op" id="6203449">(</span><span class="op" id="6203450">)</span>&nbsp;<span class="op" id="6203452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203455">c</span><span class="op" id="6203456">.</span><span class="ident" id="6203457">Fail</span><span class="op" id="6203461">(</span><span class="op" id="6203462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203466">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203524">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203579">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203640">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203703">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203707">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203749">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203753">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203774">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203797">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203818">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203822">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203884">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203946">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204008">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204077">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204146">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204218">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204282">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204346">c</span><span class="op" id="6204347">.</span><span class="ident" id="6204348">finished</span>&nbsp;<span class="op" id="6204357">=</span>&nbsp;<span class="builtintype" id="6204359">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204365">runtime</span><span class="op" id="6204372">.</span><span class="ident" id="6204373">Goexit</span><span class="op" id="6204379">(</span><span class="op" id="6204380">)</span><br>
<span class="lineno">330</span><span class="op" id="6204382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6204385">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6204451">func</span>&nbsp;<span class="op" id="6204456">(</span><span class="ident" id="6204457">c</span>&nbsp;<span class="op" id="6204459">*</span><span class="ident" id="6204460">common</span><span class="op" id="6204466">)</span>&nbsp;<span class="ident" id="6204468">log</span><span class="op" id="6204471">(</span><span class="ident" id="6204472">s</span>&nbsp;<span class="builtintype" id="6204474">string</span><span class="op" id="6204480">)</span>&nbsp;<span class="op" id="6204482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204485">c</span><span class="op" id="6204486">.</span><span class="ident" id="6204487">mu</span><span class="op" id="6204489">.</span><span class="ident" id="6204490">Lock</span><span class="op" id="6204494">(</span><span class="op" id="6204495">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204498">defer</span>&nbsp;<span class="ident" id="6204504">c</span><span class="op" id="6204505">.</span><span class="ident" id="6204506">mu</span><span class="op" id="6204508">.</span><span class="ident" id="6204509">Unlock</span><span class="op" id="6204515">(</span><span class="op" id="6204516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204519">c</span><span class="op" id="6204520">.</span><span class="ident" id="6204521">output</span>&nbsp;<span class="op" id="6204528">=</span>&nbsp;<span class="builtinfunc" id="6204530">append</span><span class="op" id="6204536">(</span><span class="ident" id="6204537">c</span><span class="op" id="6204538">.</span><span class="ident" id="6204539">output</span><span class="op" id="6204545">,</span>&nbsp;<span class="ident" id="6204547">decorate</span><span class="op" id="6204555">(</span><span class="ident" id="6204556">s</span><span class="op" id="6204557">)</span><span class="op" id="6204558">...</span><span class="op" id="6204561">)</span><br>
<span class="lineno"></span><span class="op" id="6204563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6204566">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6204643">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6204718">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6204764">func</span>&nbsp;<span class="op" id="6204769">(</span><span class="ident" id="6204770">c</span>&nbsp;<span class="op" id="6204772">*</span><span class="ident" id="6204773">common</span><span class="op" id="6204779">)</span>&nbsp;<span class="ident" id="6204781">Log</span><span class="op" id="6204784">(</span><span class="ident" id="6204785">args</span>&nbsp;<span class="op" id="6204790">...</span><span class="keyword" id="6204793">interface</span><span class="op" id="6204802">{</span><span class="op" id="6204803">}</span><span class="op" id="6204804">)</span>&nbsp;<span class="op" id="6204806">{</span>&nbsp;<span class="ident" id="6204808">c</span><span class="op" id="6204809">.</span><span class="ident" id="6204810">log</span><span class="op" id="6204813">(</span><span class="ident" id="6204814">fmt</span><span class="op" id="6204817">.</span><span class="ident" id="6204818">Sprintln</span><span class="op" id="6204826">(</span><span class="ident" id="6204827">args</span><span class="op" id="6204831">...</span><span class="op" id="6204834">)</span><span class="op" id="6204835">)</span>&nbsp;<span class="op" id="6204837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6204840">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6204916">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6204991">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6205037">func</span>&nbsp;<span class="op" id="6205042">(</span><span class="ident" id="6205043">c</span>&nbsp;<span class="op" id="6205045">*</span><span class="ident" id="6205046">common</span><span class="op" id="6205052">)</span>&nbsp;<span class="ident" id="6205054">Logf</span><span class="op" id="6205058">(</span><span class="ident" id="6205059">format</span>&nbsp;<span class="builtintype" id="6205066">string</span><span class="op" id="6205072">,</span>&nbsp;<span class="ident" id="6205074">args</span>&nbsp;<span class="op" id="6205079">...</span><span class="keyword" id="6205082">interface</span><span class="op" id="6205091">{</span><span class="op" id="6205092">}</span><span class="op" id="6205093">)</span>&nbsp;<span class="op" id="6205095">{</span>&nbsp;<span class="ident" id="6205097">c</span><span class="op" id="6205098">.</span><span class="ident" id="6205099">log</span><span class="op" id="6205102">(</span><span class="ident" id="6205103">fmt</span><span class="op" id="6205106">.</span><span class="ident" id="6205107">Sprintf</span><span class="op" id="6205114">(</span><span class="ident" id="6205115">format</span><span class="op" id="6205121">,</span>&nbsp;<span class="ident" id="6205123">args</span><span class="op" id="6205127">...</span><span class="op" id="6205130">)</span><span class="op" id="6205131">)</span>&nbsp;<span class="op" id="6205133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6205136">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6205184">func</span>&nbsp;<span class="op" id="6205189">(</span><span class="ident" id="6205190">c</span>&nbsp;<span class="op" id="6205192">*</span><span class="ident" id="6205193">common</span><span class="op" id="6205199">)</span>&nbsp;<span class="ident" id="6205201">Error</span><span class="op" id="6205206">(</span><span class="ident" id="6205207">args</span>&nbsp;<span class="op" id="6205212">...</span><span class="keyword" id="6205215">interface</span><span class="op" id="6205224">{</span><span class="op" id="6205225">}</span><span class="op" id="6205226">)</span>&nbsp;<span class="op" id="6205228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205231">c</span><span class="op" id="6205232">.</span><span class="ident" id="6205233">log</span><span class="op" id="6205236">(</span><span class="ident" id="6205237">fmt</span><span class="op" id="6205240">.</span><span class="ident" id="6205241">Sprintln</span><span class="op" id="6205249">(</span><span class="ident" id="6205250">args</span><span class="op" id="6205254">...</span><span class="op" id="6205257">)</span><span class="op" id="6205258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205261">c</span><span class="op" id="6205262">.</span><span class="ident" id="6205263">Fail</span><span class="op" id="6205267">(</span><span class="op" id="6205268">)</span><br>
<span class="lineno"></span><span class="op" id="6205270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6205273">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6205323">func</span>&nbsp;<span class="op" id="6205328">(</span><span class="ident" id="6205329">c</span>&nbsp;<span class="op" id="6205331">*</span><span class="ident" id="6205332">common</span><span class="op" id="6205338">)</span>&nbsp;<span class="ident" id="6205340">Errorf</span><span class="op" id="6205346">(</span><span class="ident" id="6205347">format</span>&nbsp;<span class="builtintype" id="6205354">string</span><span class="op" id="6205360">,</span>&nbsp;<span class="ident" id="6205362">args</span>&nbsp;<span class="op" id="6205367">...</span><span class="keyword" id="6205370">interface</span><span class="op" id="6205379">{</span><span class="op" id="6205380">}</span><span class="op" id="6205381">)</span>&nbsp;<span class="op" id="6205383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205386">c</span><span class="op" id="6205387">.</span><span class="ident" id="6205388">log</span><span class="op" id="6205391">(</span><span class="ident" id="6205392">fmt</span><span class="op" id="6205395">.</span><span class="ident" id="6205396">Sprintf</span><span class="op" id="6205403">(</span><span class="ident" id="6205404">format</span><span class="op" id="6205410">,</span>&nbsp;<span class="ident" id="6205412">args</span><span class="op" id="6205416">...</span><span class="op" id="6205419">)</span><span class="op" id="6205420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205423">c</span><span class="op" id="6205424">.</span><span class="ident" id="6205425">Fail</span><span class="op" id="6205429">(</span><span class="op" id="6205430">)</span><br>
<span class="lineno"></span><span class="op" id="6205432">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6205435">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6205486">func</span>&nbsp;<span class="op" id="6205491">(</span><span class="ident" id="6205492">c</span>&nbsp;<span class="op" id="6205494">*</span><span class="ident" id="6205495">common</span><span class="op" id="6205501">)</span>&nbsp;<span class="ident" id="6205503">Fatal</span><span class="op" id="6205508">(</span><span class="ident" id="6205509">args</span>&nbsp;<span class="op" id="6205514">...</span><span class="keyword" id="6205517">interface</span><span class="op" id="6205526">{</span><span class="op" id="6205527">}</span><span class="op" id="6205528">)</span>&nbsp;<span class="op" id="6205530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205533">c</span><span class="op" id="6205534">.</span><span class="ident" id="6205535">log</span><span class="op" id="6205538">(</span><span class="ident" id="6205539">fmt</span><span class="op" id="6205542">.</span><span class="ident" id="6205543">Sprintln</span><span class="op" id="6205551">(</span><span class="ident" id="6205552">args</span><span class="op" id="6205556">...</span><span class="op" id="6205559">)</span><span class="op" id="6205560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205563">c</span><span class="op" id="6205564">.</span><span class="ident" id="6205565">FailNow</span><span class="op" id="6205572">(</span><span class="op" id="6205573">)</span><br>
<span class="lineno">365</span><span class="op" id="6205575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6205578">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6205631">func</span>&nbsp;<span class="op" id="6205636">(</span><span class="ident" id="6205637">c</span>&nbsp;<span class="op" id="6205639">*</span><span class="ident" id="6205640">common</span><span class="op" id="6205646">)</span>&nbsp;<span class="ident" id="6205648">Fatalf</span><span class="op" id="6205654">(</span><span class="ident" id="6205655">format</span>&nbsp;<span class="builtintype" id="6205662">string</span><span class="op" id="6205668">,</span>&nbsp;<span class="ident" id="6205670">args</span>&nbsp;<span class="op" id="6205675">...</span><span class="keyword" id="6205678">interface</span><span class="op" id="6205687">{</span><span class="op" id="6205688">}</span><span class="op" id="6205689">)</span>&nbsp;<span class="op" id="6205691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205694">c</span><span class="op" id="6205695">.</span><span class="ident" id="6205696">log</span><span class="op" id="6205699">(</span><span class="ident" id="6205700">fmt</span><span class="op" id="6205703">.</span><span class="ident" id="6205704">Sprintf</span><span class="op" id="6205711">(</span><span class="ident" id="6205712">format</span><span class="op" id="6205718">,</span>&nbsp;<span class="ident" id="6205720">args</span><span class="op" id="6205724">...</span><span class="op" id="6205727">)</span><span class="op" id="6205728">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205731">c</span><span class="op" id="6205732">.</span><span class="ident" id="6205733">FailNow</span><span class="op" id="6205740">(</span><span class="op" id="6205741">)</span><br>
<span class="lineno"></span><span class="op" id="6205743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6205746">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6205796">func</span>&nbsp;<span class="op" id="6205801">(</span><span class="ident" id="6205802">c</span>&nbsp;<span class="op" id="6205804">*</span><span class="ident" id="6205805">common</span><span class="op" id="6205811">)</span>&nbsp;<span class="ident" id="6205813">Skip</span><span class="op" id="6205817">(</span><span class="ident" id="6205818">args</span>&nbsp;<span class="op" id="6205823">...</span><span class="keyword" id="6205826">interface</span><span class="op" id="6205835">{</span><span class="op" id="6205836">}</span><span class="op" id="6205837">)</span>&nbsp;<span class="op" id="6205839">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205842">c</span><span class="op" id="6205843">.</span><span class="ident" id="6205844">log</span><span class="op" id="6205847">(</span><span class="ident" id="6205848">fmt</span><span class="op" id="6205851">.</span><span class="ident" id="6205852">Sprintln</span><span class="op" id="6205860">(</span><span class="ident" id="6205861">args</span><span class="op" id="6205865">...</span><span class="op" id="6205868">)</span><span class="op" id="6205869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205872">c</span><span class="op" id="6205873">.</span><span class="ident" id="6205874">SkipNow</span><span class="op" id="6205881">(</span><span class="op" id="6205882">)</span><br>
<span class="lineno"></span><span class="op" id="6205884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6205887">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6205939">func</span>&nbsp;<span class="op" id="6205944">(</span><span class="ident" id="6205945">c</span>&nbsp;<span class="op" id="6205947">*</span><span class="ident" id="6205948">common</span><span class="op" id="6205954">)</span>&nbsp;<span class="ident" id="6205956">Skipf</span><span class="op" id="6205961">(</span><span class="ident" id="6205962">format</span>&nbsp;<span class="builtintype" id="6205969">string</span><span class="op" id="6205975">,</span>&nbsp;<span class="ident" id="6205977">args</span>&nbsp;<span class="op" id="6205982">...</span><span class="keyword" id="6205985">interface</span><span class="op" id="6205994">{</span><span class="op" id="6205995">}</span><span class="op" id="6205996">)</span>&nbsp;<span class="op" id="6205998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206001">c</span><span class="op" id="6206002">.</span><span class="ident" id="6206003">log</span><span class="op" id="6206006">(</span><span class="ident" id="6206007">fmt</span><span class="op" id="6206010">.</span><span class="ident" id="6206011">Sprintf</span><span class="op" id="6206018">(</span><span class="ident" id="6206019">format</span><span class="op" id="6206025">,</span>&nbsp;<span class="ident" id="6206027">args</span><span class="op" id="6206031">...</span><span class="op" id="6206034">)</span><span class="op" id="6206035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206038">c</span><span class="op" id="6206039">.</span><span class="ident" id="6206040">SkipNow</span><span class="op" id="6206047">(</span><span class="op" id="6206048">)</span><br>
<span class="lineno"></span><span class="op" id="6206050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6206053">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6206127">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6206203">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6206275">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6206350">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6206377">func</span>&nbsp;<span class="op" id="6206382">(</span><span class="ident" id="6206383">c</span>&nbsp;<span class="op" id="6206385">*</span><span class="ident" id="6206386">common</span><span class="op" id="6206392">)</span>&nbsp;<span class="ident" id="6206394">SkipNow</span><span class="op" id="6206401">(</span><span class="op" id="6206402">)</span>&nbsp;<span class="op" id="6206404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206407">c</span><span class="op" id="6206408">.</span><span class="ident" id="6206409">skip</span><span class="op" id="6206413">(</span><span class="op" id="6206414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206417">c</span><span class="op" id="6206418">.</span><span class="ident" id="6206419">finished</span>&nbsp;<span class="op" id="6206428">=</span>&nbsp;<span class="builtintype" id="6206430">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206436">runtime</span><span class="op" id="6206443">.</span><span class="ident" id="6206444">Goexit</span><span class="op" id="6206450">(</span><span class="op" id="6206451">)</span><br>
<span class="lineno"></span><span class="op" id="6206453">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6206456">func</span>&nbsp;<span class="op" id="6206461">(</span><span class="ident" id="6206462">c</span>&nbsp;<span class="op" id="6206464">*</span><span class="ident" id="6206465">common</span><span class="op" id="6206471">)</span>&nbsp;<span class="ident" id="6206473">skip</span><span class="op" id="6206477">(</span><span class="op" id="6206478">)</span>&nbsp;<span class="op" id="6206480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206483">c</span><span class="op" id="6206484">.</span><span class="ident" id="6206485">mu</span><span class="op" id="6206487">.</span><span class="ident" id="6206488">Lock</span><span class="op" id="6206492">(</span><span class="op" id="6206493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206496">defer</span>&nbsp;<span class="ident" id="6206502">c</span><span class="op" id="6206503">.</span><span class="ident" id="6206504">mu</span><span class="op" id="6206506">.</span><span class="ident" id="6206507">Unlock</span><span class="op" id="6206513">(</span><span class="op" id="6206514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206517">c</span><span class="op" id="6206518">.</span><span class="ident" id="6206519">skipped</span>&nbsp;<span class="op" id="6206527">=</span>&nbsp;<span class="builtintype" id="6206529">true</span><br>
<span class="lineno">400</span><span class="op" id="6206534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206537">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6206586">func</span>&nbsp;<span class="op" id="6206591">(</span><span class="ident" id="6206592">c</span>&nbsp;<span class="op" id="6206594">*</span><span class="ident" id="6206595">common</span><span class="op" id="6206601">)</span>&nbsp;<span class="ident" id="6206603">Skipped</span><span class="op" id="6206610">(</span><span class="op" id="6206611">)</span>&nbsp;<span class="builtintype" id="6206613">bool</span>&nbsp;<span class="op" id="6206618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206621">c</span><span class="op" id="6206622">.</span><span class="ident" id="6206623">mu</span><span class="op" id="6206625">.</span><span class="ident" id="6206626">RLock</span><span class="op" id="6206631">(</span><span class="op" id="6206632">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206635">defer</span>&nbsp;<span class="ident" id="6206641">c</span><span class="op" id="6206642">.</span><span class="ident" id="6206643">mu</span><span class="op" id="6206645">.</span><span class="ident" id="6206646">RUnlock</span><span class="op" id="6206653">(</span><span class="op" id="6206654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206657">return</span>&nbsp;<span class="ident" id="6206664">c</span><span class="op" id="6206665">.</span><span class="ident" id="6206666">skipped</span><br>
<span class="lineno"></span><span class="op" id="6206674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206677">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6206758">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6206783">func</span>&nbsp;<span class="op" id="6206788">(</span><span class="ident" id="6206789">t</span>&nbsp;<span class="op" id="6206791">*</span><span class="ident" id="6206792">T</span><span class="op" id="6206793">)</span>&nbsp;<span class="ident" id="6206795">Parallel</span><span class="op" id="6206803">(</span><span class="op" id="6206804">)</span>&nbsp;<span class="op" id="6206806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206809">t</span><span class="op" id="6206810">.</span><span class="ident" id="6206811">signal</span>&nbsp;<span class="op" id="6206818">&lt;-</span>&nbsp;<span class="op" id="6206821">(</span><span class="op" id="6206822">*</span><span class="ident" id="6206823">T</span><span class="op" id="6206824">)</span><span class="op" id="6206825">(</span><span class="ident" id="6206826">nil</span><span class="op" id="6206829">)</span>&nbsp;<span class="comment" id="6206831">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6206861">&lt;-</span><span class="ident" id="6206863">t</span><span class="op" id="6206864">.</span><span class="ident" id="6206865">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6206883">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6206919">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6206994">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207069">t</span><span class="op" id="6207070">.</span><span class="ident" id="6207071">start</span>&nbsp;<span class="op" id="6207077">=</span>&nbsp;<span class="ident" id="6207079">time</span><span class="op" id="6207083">.</span><span class="ident" id="6207084">Now</span><span class="op" id="6207087">(</span><span class="op" id="6207088">)</span><br>
<span class="lineno"></span><span class="op" id="6207090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6207093">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6207182">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6207211">type</span>&nbsp;<span class="ident" id="6207216">InternalTest</span>&nbsp;<span class="keyword" id="6207229">struct</span>&nbsp;<span class="op" id="6207236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207239">Name</span>&nbsp;<span class="builtintype" id="6207244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207252">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6207257">func</span><span class="op" id="6207261">(</span><span class="op" id="6207262">*</span><span class="ident" id="6207263">T</span><span class="op" id="6207264">)</span><br>
<span class="lineno"></span><span class="op" id="6207266">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6207269">func</span>&nbsp;<span class="ident" id="6207274">tRunner</span><span class="op" id="6207281">(</span><span class="ident" id="6207282">t</span>&nbsp;<span class="op" id="6207284">*</span><span class="ident" id="6207285">T</span><span class="op" id="6207286">,</span>&nbsp;<span class="ident" id="6207288">test</span>&nbsp;<span class="op" id="6207293">*</span><span class="ident" id="6207294">InternalTest</span><span class="op" id="6207306">)</span>&nbsp;<span class="op" id="6207308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207311">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207369">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207427">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207486">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207529">defer</span>&nbsp;<span class="keyword" id="6207535">func</span><span class="op" id="6207539">(</span><span class="op" id="6207540">)</span>&nbsp;<span class="op" id="6207542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207546">t</span><span class="op" id="6207547">.</span><span class="ident" id="6207548">duration</span>&nbsp;<span class="op" id="6207557">=</span>&nbsp;<span class="ident" id="6207559">time</span><span class="op" id="6207563">.</span><span class="ident" id="6207564">Now</span><span class="op" id="6207567">(</span><span class="op" id="6207568">)</span><span class="op" id="6207569">.</span><span class="ident" id="6207570">Sub</span><span class="op" id="6207573">(</span><span class="ident" id="6207574">t</span><span class="op" id="6207575">.</span><span class="ident" id="6207576">start</span><span class="op" id="6207581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207585">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207648">err</span>&nbsp;<span class="op" id="6207652">:=</span>&nbsp;<span class="builtinfunc" id="6207655">recover</span><span class="op" id="6207662">(</span><span class="op" id="6207663">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207667">if</span>&nbsp;<span class="op" id="6207670">!</span><span class="ident" id="6207671">t</span><span class="op" id="6207672">.</span><span class="ident" id="6207673">finished</span>&nbsp;<span class="op" id="6207682">&amp;&amp;</span>&nbsp;<span class="ident" id="6207685">err</span>&nbsp;<span class="op" id="6207689">==</span>&nbsp;<span class="ident" id="6207692">nil</span>&nbsp;<span class="op" id="6207696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207701">err</span>&nbsp;<span class="op" id="6207705">=</span>&nbsp;<span class="ident" id="6207707">fmt</span><span class="op" id="6207710">.</span><span class="ident" id="6207711">Errorf</span><span class="op" id="6207717">(</span><span class="string" id="6207718">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6207762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207770">if</span>&nbsp;<span class="ident" id="6207773">err</span>&nbsp;<span class="op" id="6207777">!=</span>&nbsp;<span class="ident" id="6207780">nil</span>&nbsp;<span class="op" id="6207784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207789">t</span><span class="op" id="6207790">.</span><span class="ident" id="6207791">Fail</span><span class="op" id="6207795">(</span><span class="op" id="6207796">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207801">t</span><span class="op" id="6207802">.</span><span class="ident" id="6207803">report</span><span class="op" id="6207809">(</span><span class="op" id="6207810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6207815">panic</span><span class="op" id="6207820">(</span><span class="ident" id="6207821">err</span><span class="op" id="6207824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207832">t</span><span class="op" id="6207833">.</span><span class="ident" id="6207834">signal</span>&nbsp;<span class="op" id="6207841">&lt;-</span>&nbsp;<span class="ident" id="6207844">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207847">}</span><span class="op" id="6207848">(</span><span class="op" id="6207849">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207853">t</span><span class="op" id="6207854">.</span><span class="ident" id="6207855">start</span>&nbsp;<span class="op" id="6207861">=</span>&nbsp;<span class="ident" id="6207863">time</span><span class="op" id="6207867">.</span><span class="ident" id="6207868">Now</span><span class="op" id="6207871">(</span><span class="op" id="6207872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207875">test</span><span class="op" id="6207879">.</span><span class="ident" id="6207880">F</span><span class="op" id="6207881">(</span><span class="ident" id="6207882">t</span><span class="op" id="6207883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207886">t</span><span class="op" id="6207887">.</span><span class="ident" id="6207888">finished</span>&nbsp;<span class="op" id="6207897">=</span>&nbsp;<span class="builtintype" id="6207899">true</span><br>
<span class="lineno"></span><span class="op" id="6207904">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6207907">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6208000">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6208029">func</span>&nbsp;<span class="ident" id="6208034">Main</span><span class="op" id="6208038">(</span><span class="ident" id="6208039">matchString</span>&nbsp;<span class="keyword" id="6208051">func</span><span class="op" id="6208055">(</span><span class="ident" id="6208056">pat</span><span class="op" id="6208059">,</span>&nbsp;<span class="ident" id="6208061">str</span>&nbsp;<span class="builtintype" id="6208065">string</span><span class="op" id="6208071">)</span>&nbsp;<span class="op" id="6208073">(</span><span class="builtintype" id="6208074">bool</span><span class="op" id="6208078">,</span>&nbsp;<span class="builtintype" id="6208080">error</span><span class="op" id="6208085">)</span><span class="op" id="6208086">,</span>&nbsp;<span class="ident" id="6208088">tests</span>&nbsp;<span class="op" id="6208094">[</span><span class="op" id="6208095">]</span><span class="ident" id="6208096">InternalTest</span><span class="op" id="6208108">,</span>&nbsp;<span class="ident" id="6208110">benchmarks</span>&nbsp;<span class="op" id="6208121">[</span><span class="op" id="6208122">]</span><span class="ident" id="6208123">InternalBenchmark</span><span class="op" id="6208140">,</span>&nbsp;<span class="ident" id="6208142">examples</span>&nbsp;<span class="op" id="6208151">[</span><span class="op" id="6208152">]</span><span class="ident" id="6208153">InternalExample</span><span class="op" id="6208168">)</span>&nbsp;<span class="op" id="6208170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208173">os</span><span class="op" id="6208175">.</span><span class="ident" id="6208176">Exit</span><span class="op" id="6208180">(</span><span class="ident" id="6208181">MainStart</span><span class="op" id="6208190">(</span><span class="ident" id="6208191">matchString</span><span class="op" id="6208202">,</span>&nbsp;<span class="ident" id="6208204">tests</span><span class="op" id="6208209">,</span>&nbsp;<span class="ident" id="6208211">benchmarks</span><span class="op" id="6208221">,</span>&nbsp;<span class="ident" id="6208223">examples</span><span class="op" id="6208231">)</span><span class="op" id="6208232">.</span><span class="ident" id="6208233">Run</span><span class="op" id="6208236">(</span><span class="op" id="6208237">)</span><span class="op" id="6208238">)</span><br>
<span class="lineno">455</span><span class="op" id="6208240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6208243">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6208313">type</span>&nbsp;<span class="ident" id="6208318">M</span>&nbsp;<span class="keyword" id="6208320">struct</span>&nbsp;<span class="op" id="6208327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208330">matchString</span>&nbsp;<span class="keyword" id="6208342">func</span><span class="op" id="6208346">(</span><span class="ident" id="6208347">pat</span><span class="op" id="6208350">,</span>&nbsp;<span class="ident" id="6208352">str</span>&nbsp;<span class="builtintype" id="6208356">string</span><span class="op" id="6208362">)</span>&nbsp;<span class="op" id="6208364">(</span><span class="builtintype" id="6208365">bool</span><span class="op" id="6208369">,</span>&nbsp;<span class="builtintype" id="6208371">error</span><span class="op" id="6208376">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208379">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6208391">[</span><span class="op" id="6208392">]</span><span class="ident" id="6208393">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208407">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6208419">[</span><span class="op" id="6208420">]</span><span class="ident" id="6208421">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208440">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6208452">[</span><span class="op" id="6208453">]</span><span class="ident" id="6208454">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6208470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6208473">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6208536">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6208632">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6208684">func</span>&nbsp;<span class="ident" id="6208689">MainStart</span><span class="op" id="6208698">(</span><span class="ident" id="6208699">matchString</span>&nbsp;<span class="keyword" id="6208711">func</span><span class="op" id="6208715">(</span><span class="ident" id="6208716">pat</span><span class="op" id="6208719">,</span>&nbsp;<span class="ident" id="6208721">str</span>&nbsp;<span class="builtintype" id="6208725">string</span><span class="op" id="6208731">)</span>&nbsp;<span class="op" id="6208733">(</span><span class="builtintype" id="6208734">bool</span><span class="op" id="6208738">,</span>&nbsp;<span class="builtintype" id="6208740">error</span><span class="op" id="6208745">)</span><span class="op" id="6208746">,</span>&nbsp;<span class="ident" id="6208748">tests</span>&nbsp;<span class="op" id="6208754">[</span><span class="op" id="6208755">]</span><span class="ident" id="6208756">InternalTest</span><span class="op" id="6208768">,</span>&nbsp;<span class="ident" id="6208770">benchmarks</span>&nbsp;<span class="op" id="6208781">[</span><span class="op" id="6208782">]</span><span class="ident" id="6208783">InternalBenchmark</span><span class="op" id="6208800">,</span>&nbsp;<span class="ident" id="6208802">examples</span>&nbsp;<span class="op" id="6208811">[</span><span class="op" id="6208812">]</span><span class="ident" id="6208813">InternalExample</span><span class="op" id="6208828">)</span>&nbsp;<span class="op" id="6208830">*</span><span class="ident" id="6208831">M</span>&nbsp;<span class="op" id="6208833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208836">return</span>&nbsp;<span class="op" id="6208843">&amp;</span><span class="ident" id="6208844">M</span><span class="op" id="6208845">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208849">matchString</span><span class="op" id="6208860">:</span>&nbsp;<span class="ident" id="6208862">matchString</span><span class="op" id="6208873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208877">tests</span><span class="op" id="6208882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6208890">tests</span><span class="op" id="6208895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208899">benchmarks</span><span class="op" id="6208909">:</span>&nbsp;&nbsp;<span class="ident" id="6208912">benchmarks</span><span class="op" id="6208922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208926">examples</span><span class="op" id="6208934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6208939">examples</span><span class="op" id="6208947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208950">}</span><br>
<span class="lineno">475</span><span class="op" id="6208952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6208955">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6209022">func</span>&nbsp;<span class="op" id="6209027">(</span><span class="ident" id="6209028">m</span>&nbsp;<span class="op" id="6209030">*</span><span class="ident" id="6209031">M</span><span class="op" id="6209032">)</span>&nbsp;<span class="ident" id="6209034">Run</span><span class="op" id="6209037">(</span><span class="op" id="6209038">)</span>&nbsp;<span class="builtintype" id="6209040">int</span>&nbsp;<span class="op" id="6209044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209047">flag</span><span class="op" id="6209051">.</span><span class="ident" id="6209052">Parse</span><span class="op" id="6209057">(</span><span class="op" id="6209058">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209061">parseCpuList</span><span class="op" id="6209073">(</span><span class="op" id="6209074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209078">before</span><span class="op" id="6209084">(</span><span class="op" id="6209085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209088">startAlarm</span><span class="op" id="6209098">(</span><span class="op" id="6209099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209102">haveExamples</span>&nbsp;<span class="op" id="6209115">=</span>&nbsp;<span class="builtinfunc" id="6209117">len</span><span class="op" id="6209120">(</span><span class="ident" id="6209121">m</span><span class="op" id="6209122">.</span><span class="ident" id="6209123">examples</span><span class="op" id="6209131">)</span>&nbsp;<span class="op" id="6209133">&gt;</span>&nbsp;<span class="num" id="6209135">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209138">testOk</span>&nbsp;<span class="op" id="6209145">:=</span>&nbsp;<span class="ident" id="6209148">RunTests</span><span class="op" id="6209156">(</span><span class="ident" id="6209157">m</span><span class="op" id="6209158">.</span><span class="ident" id="6209159">matchString</span><span class="op" id="6209170">,</span>&nbsp;<span class="ident" id="6209172">m</span><span class="op" id="6209173">.</span><span class="ident" id="6209174">tests</span><span class="op" id="6209179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209182">exampleOk</span>&nbsp;<span class="op" id="6209192">:=</span>&nbsp;<span class="ident" id="6209195">RunExamples</span><span class="op" id="6209206">(</span><span class="ident" id="6209207">m</span><span class="op" id="6209208">.</span><span class="ident" id="6209209">matchString</span><span class="op" id="6209220">,</span>&nbsp;<span class="ident" id="6209222">m</span><span class="op" id="6209223">.</span><span class="ident" id="6209224">examples</span><span class="op" id="6209232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209235">stopAlarm</span><span class="op" id="6209244">(</span><span class="op" id="6209245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209248">if</span>&nbsp;<span class="op" id="6209251">!</span><span class="ident" id="6209252">testOk</span>&nbsp;<span class="op" id="6209259">||</span>&nbsp;<span class="op" id="6209262">!</span><span class="ident" id="6209263">exampleOk</span>&nbsp;<span class="op" id="6209273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209277">fmt</span><span class="op" id="6209280">.</span><span class="ident" id="6209281">Println</span><span class="op" id="6209288">(</span><span class="string" id="6209289">&#34;FAIL&#34;</span><span class="op" id="6209295">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209299">after</span><span class="op" id="6209304">(</span><span class="op" id="6209305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209309">return</span>&nbsp;<span class="num" id="6209316">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209322">fmt</span><span class="op" id="6209325">.</span><span class="ident" id="6209326">Println</span><span class="op" id="6209333">(</span><span class="string" id="6209334">&#34;PASS&#34;</span><span class="op" id="6209340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209343">RunBenchmarks</span><span class="op" id="6209356">(</span><span class="ident" id="6209357">m</span><span class="op" id="6209358">.</span><span class="ident" id="6209359">matchString</span><span class="op" id="6209370">,</span>&nbsp;<span class="ident" id="6209372">m</span><span class="op" id="6209373">.</span><span class="ident" id="6209374">benchmarks</span><span class="op" id="6209384">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209387">after</span><span class="op" id="6209392">(</span><span class="op" id="6209393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209396">return</span>&nbsp;<span class="num" id="6209403">0</span><br>
<span class="lineno"></span><span class="op" id="6209405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209408">func</span>&nbsp;<span class="op" id="6209413">(</span><span class="ident" id="6209414">t</span>&nbsp;<span class="op" id="6209416">*</span><span class="ident" id="6209417">T</span><span class="op" id="6209418">)</span>&nbsp;<span class="ident" id="6209420">report</span><span class="op" id="6209426">(</span><span class="op" id="6209427">)</span>&nbsp;<span class="op" id="6209429">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209432">dstr</span>&nbsp;<span class="op" id="6209437">:=</span>&nbsp;<span class="ident" id="6209440">fmtDuration</span><span class="op" id="6209451">(</span><span class="ident" id="6209452">t</span><span class="op" id="6209453">.</span><span class="ident" id="6209454">duration</span><span class="op" id="6209462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209465">format</span>&nbsp;<span class="op" id="6209472">:=</span>&nbsp;<span class="string" id="6209475">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209498">if</span>&nbsp;<span class="ident" id="6209501">t</span><span class="op" id="6209502">.</span><span class="ident" id="6209503">Failed</span><span class="op" id="6209509">(</span><span class="op" id="6209510">)</span>&nbsp;<span class="op" id="6209512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209516">fmt</span><span class="op" id="6209519">.</span><span class="ident" id="6209520">Printf</span><span class="op" id="6209526">(</span><span class="ident" id="6209527">format</span><span class="op" id="6209533">,</span>&nbsp;<span class="string" id="6209535">&#34;FAIL&#34;</span><span class="op" id="6209541">,</span>&nbsp;<span class="ident" id="6209543">t</span><span class="op" id="6209544">.</span><span class="ident" id="6209545">name</span><span class="op" id="6209549">,</span>&nbsp;<span class="ident" id="6209551">dstr</span><span class="op" id="6209555">,</span>&nbsp;<span class="ident" id="6209557">t</span><span class="op" id="6209558">.</span><span class="ident" id="6209559">output</span><span class="op" id="6209565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209568">}</span>&nbsp;<span class="keyword" id="6209570">else</span>&nbsp;<span class="keyword" id="6209575">if</span>&nbsp;<span class="op" id="6209578">*</span><span class="ident" id="6209579">chatty</span>&nbsp;<span class="op" id="6209586">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209590">if</span>&nbsp;<span class="ident" id="6209593">t</span><span class="op" id="6209594">.</span><span class="ident" id="6209595">Skipped</span><span class="op" id="6209602">(</span><span class="op" id="6209603">)</span>&nbsp;<span class="op" id="6209605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209610">fmt</span><span class="op" id="6209613">.</span><span class="ident" id="6209614">Printf</span><span class="op" id="6209620">(</span><span class="ident" id="6209621">format</span><span class="op" id="6209627">,</span>&nbsp;<span class="string" id="6209629">&#34;SKIP&#34;</span><span class="op" id="6209635">,</span>&nbsp;<span class="ident" id="6209637">t</span><span class="op" id="6209638">.</span><span class="ident" id="6209639">name</span><span class="op" id="6209643">,</span>&nbsp;<span class="ident" id="6209645">dstr</span><span class="op" id="6209649">,</span>&nbsp;<span class="ident" id="6209651">t</span><span class="op" id="6209652">.</span><span class="ident" id="6209653">output</span><span class="op" id="6209659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209663">}</span>&nbsp;<span class="keyword" id="6209665">else</span>&nbsp;<span class="op" id="6209670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209675">fmt</span><span class="op" id="6209678">.</span><span class="ident" id="6209679">Printf</span><span class="op" id="6209685">(</span><span class="ident" id="6209686">format</span><span class="op" id="6209692">,</span>&nbsp;<span class="string" id="6209694">&#34;PASS&#34;</span><span class="op" id="6209700">,</span>&nbsp;<span class="ident" id="6209702">t</span><span class="op" id="6209703">.</span><span class="ident" id="6209704">name</span><span class="op" id="6209708">,</span>&nbsp;<span class="ident" id="6209710">dstr</span><span class="op" id="6209714">,</span>&nbsp;<span class="ident" id="6209716">t</span><span class="op" id="6209717">.</span><span class="ident" id="6209718">output</span><span class="op" id="6209724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209728">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209731">}</span><br>
<span class="lineno"></span><span class="op" id="6209733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209736">func</span>&nbsp;<span class="ident" id="6209741">RunTests</span><span class="op" id="6209749">(</span><span class="ident" id="6209750">matchString</span>&nbsp;<span class="keyword" id="6209762">func</span><span class="op" id="6209766">(</span><span class="ident" id="6209767">pat</span><span class="op" id="6209770">,</span>&nbsp;<span class="ident" id="6209772">str</span>&nbsp;<span class="builtintype" id="6209776">string</span><span class="op" id="6209782">)</span>&nbsp;<span class="op" id="6209784">(</span><span class="builtintype" id="6209785">bool</span><span class="op" id="6209789">,</span>&nbsp;<span class="builtintype" id="6209791">error</span><span class="op" id="6209796">)</span><span class="op" id="6209797">,</span>&nbsp;<span class="ident" id="6209799">tests</span>&nbsp;<span class="op" id="6209805">[</span><span class="op" id="6209806">]</span><span class="ident" id="6209807">InternalTest</span><span class="op" id="6209819">)</span>&nbsp;<span class="op" id="6209821">(</span><span class="ident" id="6209822">ok</span>&nbsp;<span class="builtintype" id="6209825">bool</span><span class="op" id="6209829">)</span>&nbsp;<span class="op" id="6209831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209834">ok</span>&nbsp;<span class="op" id="6209837">=</span>&nbsp;<span class="builtintype" id="6209839">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209845">if</span>&nbsp;<span class="builtinfunc" id="6209848">len</span><span class="op" id="6209851">(</span><span class="ident" id="6209852">tests</span><span class="op" id="6209857">)</span>&nbsp;<span class="op" id="6209859">==</span>&nbsp;<span class="num" id="6209862">0</span>&nbsp;<span class="op" id="6209864">&amp;&amp;</span>&nbsp;<span class="op" id="6209867">!</span><span class="ident" id="6209868">haveExamples</span>&nbsp;<span class="op" id="6209881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209885">fmt</span><span class="op" id="6209888">.</span><span class="ident" id="6209889">Fprintln</span><span class="op" id="6209897">(</span><span class="ident" id="6209898">os</span><span class="op" id="6209900">.</span><span class="ident" id="6209901">Stderr</span><span class="op" id="6209907">,</span>&nbsp;<span class="string" id="6209909">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6209944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209948">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209959">for</span>&nbsp;<span class="ident" id="6209963">_</span><span class="op" id="6209964">,</span>&nbsp;<span class="ident" id="6209966">procs</span>&nbsp;<span class="op" id="6209972">:=</span>&nbsp;<span class="keyword" id="6209975">range</span>&nbsp;<span class="ident" id="6209981">cpuList</span>&nbsp;<span class="op" id="6209989">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209993">runtime</span><span class="op" id="6210000">.</span><span class="ident" id="6210001">GOMAXPROCS</span><span class="op" id="6210011">(</span><span class="ident" id="6210012">procs</span><span class="op" id="6210017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210021">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210080">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210163">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210236">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210324">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210355">var</span>&nbsp;<span class="ident" id="6210359">collector</span>&nbsp;<span class="op" id="6210369">=</span>&nbsp;<span class="builtinfunc" id="6210371">make</span><span class="op" id="6210375">(</span><span class="keyword" id="6210376">chan</span>&nbsp;<span class="keyword" id="6210381">interface</span><span class="op" id="6210390">{</span><span class="op" id="6210391">}</span><span class="op" id="6210392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210397">numParallel</span>&nbsp;<span class="op" id="6210409">:=</span>&nbsp;<span class="num" id="6210412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210416">startParallel</span>&nbsp;<span class="op" id="6210430">:=</span>&nbsp;<span class="builtinfunc" id="6210433">make</span><span class="op" id="6210437">(</span><span class="keyword" id="6210438">chan</span>&nbsp;<span class="builtintype" id="6210443">bool</span><span class="op" id="6210447">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210452">for</span>&nbsp;<span class="ident" id="6210456">i</span>&nbsp;<span class="op" id="6210458">:=</span>&nbsp;<span class="num" id="6210461">0</span><span class="op" id="6210462">;</span>&nbsp;<span class="ident" id="6210464">i</span>&nbsp;<span class="op" id="6210466">&lt;</span>&nbsp;<span class="builtinfunc" id="6210468">len</span><span class="op" id="6210471">(</span><span class="ident" id="6210472">tests</span><span class="op" id="6210477">)</span><span class="op" id="6210478">;</span>&nbsp;<span class="ident" id="6210480">i</span><span class="op" id="6210481">++</span>&nbsp;<span class="op" id="6210484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210489">matched</span><span class="op" id="6210496">,</span>&nbsp;<span class="ident" id="6210498">err</span>&nbsp;<span class="op" id="6210502">:=</span>&nbsp;<span class="ident" id="6210505">matchString</span><span class="op" id="6210516">(</span><span class="op" id="6210517">*</span><span class="ident" id="6210518">match</span><span class="op" id="6210523">,</span>&nbsp;<span class="ident" id="6210525">tests</span><span class="op" id="6210530">[</span><span class="ident" id="6210531">i</span><span class="op" id="6210532">]</span><span class="op" id="6210533">.</span><span class="ident" id="6210534">Name</span><span class="op" id="6210538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210543">if</span>&nbsp;<span class="ident" id="6210546">err</span>&nbsp;<span class="op" id="6210550">!=</span>&nbsp;<span class="ident" id="6210553">nil</span>&nbsp;<span class="op" id="6210557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210563">fmt</span><span class="op" id="6210566">.</span><span class="ident" id="6210567">Fprintf</span><span class="op" id="6210574">(</span><span class="ident" id="6210575">os</span><span class="op" id="6210577">.</span><span class="ident" id="6210578">Stderr</span><span class="op" id="6210584">,</span>&nbsp;<span class="string" id="6210586">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6210631">,</span>&nbsp;<span class="ident" id="6210633">err</span><span class="op" id="6210636">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210642">os</span><span class="op" id="6210644">.</span><span class="ident" id="6210645">Exit</span><span class="op" id="6210649">(</span><span class="num" id="6210650">1</span><span class="op" id="6210651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210661">if</span>&nbsp;<span class="op" id="6210664">!</span><span class="ident" id="6210665">matched</span>&nbsp;<span class="op" id="6210673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210679">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210691">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210696">testName</span>&nbsp;<span class="op" id="6210705">:=</span>&nbsp;<span class="ident" id="6210708">tests</span><span class="op" id="6210713">[</span><span class="ident" id="6210714">i</span><span class="op" id="6210715">]</span><span class="op" id="6210716">.</span><span class="ident" id="6210717">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210725">if</span>&nbsp;<span class="ident" id="6210728">procs</span>&nbsp;<span class="op" id="6210734">!=</span>&nbsp;<span class="num" id="6210737">1</span>&nbsp;<span class="op" id="6210739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210745">testName</span>&nbsp;<span class="op" id="6210754">=</span>&nbsp;<span class="ident" id="6210756">fmt</span><span class="op" id="6210759">.</span><span class="ident" id="6210760">Sprintf</span><span class="op" id="6210767">(</span><span class="string" id="6210768">&#34;%s-%d&#34;</span><span class="op" id="6210775">,</span>&nbsp;<span class="ident" id="6210777">tests</span><span class="op" id="6210782">[</span><span class="ident" id="6210783">i</span><span class="op" id="6210784">]</span><span class="op" id="6210785">.</span><span class="ident" id="6210786">Name</span><span class="op" id="6210790">,</span>&nbsp;<span class="ident" id="6210792">procs</span><span class="op" id="6210797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210807">t</span>&nbsp;<span class="op" id="6210809">:=</span>&nbsp;<span class="op" id="6210812">&amp;</span><span class="ident" id="6210813">T</span><span class="op" id="6210814">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210820">common</span><span class="op" id="6210826">:</span>&nbsp;<span class="ident" id="6210828">common</span><span class="op" id="6210834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210841">signal</span><span class="op" id="6210847">:</span>&nbsp;<span class="builtinfunc" id="6210849">make</span><span class="op" id="6210853">(</span><span class="keyword" id="6210854">chan</span>&nbsp;<span class="keyword" id="6210859">interface</span><span class="op" id="6210868">{</span><span class="op" id="6210869">}</span><span class="op" id="6210870">)</span><span class="op" id="6210871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210877">}</span><span class="op" id="6210878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210884">name</span><span class="op" id="6210888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6210899">testName</span><span class="op" id="6210907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210913">startParallel</span><span class="op" id="6210926">:</span>&nbsp;<span class="ident" id="6210928">startParallel</span><span class="op" id="6210941">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210951">t</span><span class="op" id="6210952">.</span><span class="ident" id="6210953">self</span>&nbsp;<span class="op" id="6210958">=</span>&nbsp;<span class="ident" id="6210960">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210965">if</span>&nbsp;<span class="op" id="6210968">*</span><span class="ident" id="6210969">chatty</span>&nbsp;<span class="op" id="6210976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210982">fmt</span><span class="op" id="6210985">.</span><span class="ident" id="6210986">Printf</span><span class="op" id="6210992">(</span><span class="string" id="6210993">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6211007">,</span>&nbsp;<span class="ident" id="6211009">t</span><span class="op" id="6211010">.</span><span class="ident" id="6211011">name</span><span class="op" id="6211015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211020">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211025">go</span>&nbsp;<span class="ident" id="6211028">tRunner</span><span class="op" id="6211035">(</span><span class="ident" id="6211036">t</span><span class="op" id="6211037">,</span>&nbsp;<span class="op" id="6211039">&amp;</span><span class="ident" id="6211040">tests</span><span class="op" id="6211045">[</span><span class="ident" id="6211046">i</span><span class="op" id="6211047">]</span><span class="op" id="6211048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211053">out</span>&nbsp;<span class="op" id="6211057">:=</span>&nbsp;<span class="op" id="6211060">(</span><span class="op" id="6211061">&lt;-</span><span class="ident" id="6211063">t</span><span class="op" id="6211064">.</span><span class="ident" id="6211065">signal</span><span class="op" id="6211071">)</span><span class="op" id="6211072">.</span><span class="op" id="6211073">(</span><span class="op" id="6211074">*</span><span class="ident" id="6211075">T</span><span class="op" id="6211076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211081">if</span>&nbsp;<span class="ident" id="6211084">out</span>&nbsp;<span class="op" id="6211088">==</span>&nbsp;<span class="ident" id="6211091">nil</span>&nbsp;<span class="op" id="6211095">{</span>&nbsp;<span class="comment" id="6211097">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211118">go</span>&nbsp;<span class="keyword" id="6211121">func</span><span class="op" id="6211125">(</span><span class="op" id="6211126">)</span>&nbsp;<span class="op" id="6211128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211135">collector</span>&nbsp;<span class="op" id="6211145">&lt;-</span>&nbsp;<span class="op" id="6211148">&lt;-</span><span class="ident" id="6211150">t</span><span class="op" id="6211151">.</span><span class="ident" id="6211152">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211163">}</span><span class="op" id="6211164">(</span><span class="op" id="6211165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211171">numParallel</span><span class="op" id="6211182">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211189">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211206">t</span><span class="op" id="6211207">.</span><span class="ident" id="6211208">report</span><span class="op" id="6211214">(</span><span class="op" id="6211215">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211220">ok</span>&nbsp;<span class="op" id="6211223">=</span>&nbsp;<span class="ident" id="6211225">ok</span>&nbsp;<span class="op" id="6211228">&amp;&amp;</span>&nbsp;<span class="op" id="6211231">!</span><span class="ident" id="6211232">out</span><span class="op" id="6211235">.</span><span class="ident" id="6211236">Failed</span><span class="op" id="6211242">(</span><span class="op" id="6211243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211252">running</span>&nbsp;<span class="op" id="6211260">:=</span>&nbsp;<span class="num" id="6211263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211267">for</span>&nbsp;<span class="ident" id="6211271">numParallel</span><span class="op" id="6211282">+</span><span class="ident" id="6211283">running</span>&nbsp;<span class="op" id="6211291">&gt;</span>&nbsp;<span class="num" id="6211293">0</span>&nbsp;<span class="op" id="6211295">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211300">if</span>&nbsp;<span class="ident" id="6211303">running</span>&nbsp;<span class="op" id="6211311">&lt;</span>&nbsp;<span class="op" id="6211313">*</span><span class="ident" id="6211314">parallel</span>&nbsp;<span class="op" id="6211323">&amp;&amp;</span>&nbsp;<span class="ident" id="6211326">numParallel</span>&nbsp;<span class="op" id="6211338">&gt;</span>&nbsp;<span class="num" id="6211340">0</span>&nbsp;<span class="op" id="6211342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211348">startParallel</span>&nbsp;<span class="op" id="6211362">&lt;-</span>&nbsp;<span class="builtintype" id="6211365">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211374">running</span><span class="op" id="6211381">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211388">numParallel</span><span class="op" id="6211399">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211406">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211423">t</span>&nbsp;<span class="op" id="6211425">:=</span>&nbsp;<span class="op" id="6211428">(</span><span class="op" id="6211429">&lt;-</span><span class="ident" id="6211431">collector</span><span class="op" id="6211440">)</span><span class="op" id="6211441">.</span><span class="op" id="6211442">(</span><span class="op" id="6211443">*</span><span class="ident" id="6211444">T</span><span class="op" id="6211445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211450">t</span><span class="op" id="6211451">.</span><span class="ident" id="6211452">report</span><span class="op" id="6211458">(</span><span class="op" id="6211459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211464">ok</span>&nbsp;<span class="op" id="6211467">=</span>&nbsp;<span class="ident" id="6211469">ok</span>&nbsp;<span class="op" id="6211472">&amp;&amp;</span>&nbsp;<span class="op" id="6211475">!</span><span class="ident" id="6211476">t</span><span class="op" id="6211477">.</span><span class="ident" id="6211478">Failed</span><span class="op" id="6211484">(</span><span class="op" id="6211485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211490">running</span><span class="op" id="6211497">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211508">return</span><br>
<span class="lineno"></span><span class="op" id="6211515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6211518">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6211553">func</span>&nbsp;<span class="ident" id="6211558">before</span><span class="op" id="6211564">(</span><span class="op" id="6211565">)</span>&nbsp;<span class="op" id="6211567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211570">if</span>&nbsp;<span class="op" id="6211573">*</span><span class="ident" id="6211574">memProfileRate</span>&nbsp;<span class="op" id="6211589">&gt;</span>&nbsp;<span class="num" id="6211591">0</span>&nbsp;<span class="op" id="6211593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211597">runtime</span><span class="op" id="6211604">.</span><span class="ident" id="6211605">MemProfileRate</span>&nbsp;<span class="op" id="6211620">=</span>&nbsp;<span class="op" id="6211622">*</span><span class="ident" id="6211623">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211639">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211642">if</span>&nbsp;<span class="op" id="6211645">*</span><span class="ident" id="6211646">cpuProfile</span>&nbsp;<span class="op" id="6211657">!=</span>&nbsp;<span class="string" id="6211660">&#34;&#34;</span>&nbsp;<span class="op" id="6211663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211667">f</span><span class="op" id="6211668">,</span>&nbsp;<span class="ident" id="6211670">err</span>&nbsp;<span class="op" id="6211674">:=</span>&nbsp;<span class="ident" id="6211677">os</span><span class="op" id="6211679">.</span><span class="ident" id="6211680">Create</span><span class="op" id="6211686">(</span><span class="ident" id="6211687">toOutputDir</span><span class="op" id="6211698">(</span><span class="op" id="6211699">*</span><span class="ident" id="6211700">cpuProfile</span><span class="op" id="6211710">)</span><span class="op" id="6211711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211715">if</span>&nbsp;<span class="ident" id="6211718">err</span>&nbsp;<span class="op" id="6211722">!=</span>&nbsp;<span class="ident" id="6211725">nil</span>&nbsp;<span class="op" id="6211729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211734">fmt</span><span class="op" id="6211737">.</span><span class="ident" id="6211738">Fprintf</span><span class="op" id="6211745">(</span><span class="ident" id="6211746">os</span><span class="op" id="6211748">.</span><span class="ident" id="6211749">Stderr</span><span class="op" id="6211755">,</span>&nbsp;<span class="string" id="6211757">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6211770">,</span>&nbsp;<span class="ident" id="6211772">err</span><span class="op" id="6211775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211780">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211793">if</span>&nbsp;<span class="ident" id="6211796">err</span>&nbsp;<span class="op" id="6211800">:=</span>&nbsp;<span class="ident" id="6211803">pprof</span><span class="op" id="6211808">.</span><span class="ident" id="6211809">StartCPUProfile</span><span class="op" id="6211824">(</span><span class="ident" id="6211825">f</span><span class="op" id="6211826">)</span><span class="op" id="6211827">;</span>&nbsp;<span class="ident" id="6211829">err</span>&nbsp;<span class="op" id="6211833">!=</span>&nbsp;<span class="ident" id="6211836">nil</span>&nbsp;<span class="op" id="6211840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211845">fmt</span><span class="op" id="6211848">.</span><span class="ident" id="6211849">Fprintf</span><span class="op" id="6211856">(</span><span class="ident" id="6211857">os</span><span class="op" id="6211859">.</span><span class="ident" id="6211860">Stderr</span><span class="op" id="6211866">,</span>&nbsp;<span class="string" id="6211868">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6211906">,</span>&nbsp;<span class="ident" id="6211908">err</span><span class="op" id="6211911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211916">f</span><span class="op" id="6211917">.</span><span class="ident" id="6211918">Close</span><span class="op" id="6211923">(</span><span class="op" id="6211924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211929">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211942">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212011">if</span>&nbsp;<span class="op" id="6212014">*</span><span class="ident" id="6212015">blockProfile</span>&nbsp;<span class="op" id="6212028">!=</span>&nbsp;<span class="string" id="6212031">&#34;&#34;</span>&nbsp;<span class="op" id="6212034">&amp;&amp;</span>&nbsp;<span class="op" id="6212037">*</span><span class="ident" id="6212038">blockProfileRate</span>&nbsp;<span class="op" id="6212055">&gt;=</span>&nbsp;<span class="num" id="6212058">0</span>&nbsp;<span class="op" id="6212060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212064">runtime</span><span class="op" id="6212071">.</span><span class="ident" id="6212072">SetBlockProfileRate</span><span class="op" id="6212091">(</span><span class="op" id="6212092">*</span><span class="ident" id="6212093">blockProfileRate</span><span class="op" id="6212109">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212115">if</span>&nbsp;<span class="op" id="6212118">*</span><span class="ident" id="6212119">coverProfile</span>&nbsp;<span class="op" id="6212132">!=</span>&nbsp;<span class="string" id="6212135">&#34;&#34;</span>&nbsp;<span class="op" id="6212138">&amp;&amp;</span>&nbsp;<span class="ident" id="6212141">cover</span><span class="op" id="6212146">.</span><span class="ident" id="6212147">Mode</span>&nbsp;<span class="op" id="6212152">==</span>&nbsp;<span class="string" id="6212155">&#34;&#34;</span>&nbsp;<span class="op" id="6212158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212162">fmt</span><span class="op" id="6212165">.</span><span class="ident" id="6212166">Fprintf</span><span class="op" id="6212173">(</span><span class="ident" id="6212174">os</span><span class="op" id="6212176">.</span><span class="ident" id="6212177">Stderr</span><span class="op" id="6212183">,</span>&nbsp;<span class="string" id="6212185">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6212283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212287">os</span><span class="op" id="6212289">.</span><span class="ident" id="6212290">Exit</span><span class="op" id="6212294">(</span><span class="num" id="6212295">2</span><span class="op" id="6212296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212299">}</span><br>
<span class="lineno">610</span><span class="op" id="6212301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6212304">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6212337">func</span>&nbsp;<span class="ident" id="6212342">after</span><span class="op" id="6212347">(</span><span class="op" id="6212348">)</span>&nbsp;<span class="op" id="6212350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212353">if</span>&nbsp;<span class="op" id="6212356">*</span><span class="ident" id="6212357">cpuProfile</span>&nbsp;<span class="op" id="6212368">!=</span>&nbsp;<span class="string" id="6212371">&#34;&#34;</span>&nbsp;<span class="op" id="6212374">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212378">pprof</span><span class="op" id="6212383">.</span><span class="ident" id="6212384">StopCPUProfile</span><span class="op" id="6212398">(</span><span class="op" id="6212399">)</span>&nbsp;<span class="comment" id="6212401">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212432">if</span>&nbsp;<span class="op" id="6212435">*</span><span class="ident" id="6212436">memProfile</span>&nbsp;<span class="op" id="6212447">!=</span>&nbsp;<span class="string" id="6212450">&#34;&#34;</span>&nbsp;<span class="op" id="6212453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212457">f</span><span class="op" id="6212458">,</span>&nbsp;<span class="ident" id="6212460">err</span>&nbsp;<span class="op" id="6212464">:=</span>&nbsp;<span class="ident" id="6212467">os</span><span class="op" id="6212469">.</span><span class="ident" id="6212470">Create</span><span class="op" id="6212476">(</span><span class="ident" id="6212477">toOutputDir</span><span class="op" id="6212488">(</span><span class="op" id="6212489">*</span><span class="ident" id="6212490">memProfile</span><span class="op" id="6212500">)</span><span class="op" id="6212501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212505">if</span>&nbsp;<span class="ident" id="6212508">err</span>&nbsp;<span class="op" id="6212512">!=</span>&nbsp;<span class="ident" id="6212515">nil</span>&nbsp;<span class="op" id="6212519">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212524">fmt</span><span class="op" id="6212527">.</span><span class="ident" id="6212528">Fprintf</span><span class="op" id="6212535">(</span><span class="ident" id="6212536">os</span><span class="op" id="6212538">.</span><span class="ident" id="6212539">Stderr</span><span class="op" id="6212545">,</span>&nbsp;<span class="string" id="6212547">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6212562">,</span>&nbsp;<span class="ident" id="6212564">err</span><span class="op" id="6212567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212572">os</span><span class="op" id="6212574">.</span><span class="ident" id="6212575">Exit</span><span class="op" id="6212579">(</span><span class="num" id="6212580">2</span><span class="op" id="6212581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212589">runtime</span><span class="op" id="6212596">.</span><span class="ident" id="6212597">GC</span><span class="op" id="6212599">(</span><span class="op" id="6212600">)</span>&nbsp;<span class="comment" id="6212602">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212634">if</span>&nbsp;<span class="ident" id="6212637">err</span>&nbsp;<span class="op" id="6212641">=</span>&nbsp;<span class="ident" id="6212643">pprof</span><span class="op" id="6212648">.</span><span class="ident" id="6212649">WriteHeapProfile</span><span class="op" id="6212665">(</span><span class="ident" id="6212666">f</span><span class="op" id="6212667">)</span><span class="op" id="6212668">;</span>&nbsp;<span class="ident" id="6212670">err</span>&nbsp;<span class="op" id="6212674">!=</span>&nbsp;<span class="ident" id="6212677">nil</span>&nbsp;<span class="op" id="6212681">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212686">fmt</span><span class="op" id="6212689">.</span><span class="ident" id="6212690">Fprintf</span><span class="op" id="6212697">(</span><span class="ident" id="6212698">os</span><span class="op" id="6212700">.</span><span class="ident" id="6212701">Stderr</span><span class="op" id="6212707">,</span>&nbsp;<span class="string" id="6212709">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6212740">,</span>&nbsp;<span class="op" id="6212742">*</span><span class="ident" id="6212743">memProfile</span><span class="op" id="6212753">,</span>&nbsp;<span class="ident" id="6212755">err</span><span class="op" id="6212758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212763">os</span><span class="op" id="6212765">.</span><span class="ident" id="6212766">Exit</span><span class="op" id="6212770">(</span><span class="num" id="6212771">2</span><span class="op" id="6212772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212780">f</span><span class="op" id="6212781">.</span><span class="ident" id="6212782">Close</span><span class="op" id="6212787">(</span><span class="op" id="6212788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212791">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212794">if</span>&nbsp;<span class="op" id="6212797">*</span><span class="ident" id="6212798">blockProfile</span>&nbsp;<span class="op" id="6212811">!=</span>&nbsp;<span class="string" id="6212814">&#34;&#34;</span>&nbsp;<span class="op" id="6212817">&amp;&amp;</span>&nbsp;<span class="op" id="6212820">*</span><span class="ident" id="6212821">blockProfileRate</span>&nbsp;<span class="op" id="6212838">&gt;=</span>&nbsp;<span class="num" id="6212841">0</span>&nbsp;<span class="op" id="6212843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212847">f</span><span class="op" id="6212848">,</span>&nbsp;<span class="ident" id="6212850">err</span>&nbsp;<span class="op" id="6212854">:=</span>&nbsp;<span class="ident" id="6212857">os</span><span class="op" id="6212859">.</span><span class="ident" id="6212860">Create</span><span class="op" id="6212866">(</span><span class="ident" id="6212867">toOutputDir</span><span class="op" id="6212878">(</span><span class="op" id="6212879">*</span><span class="ident" id="6212880">blockProfile</span><span class="op" id="6212892">)</span><span class="op" id="6212893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212897">if</span>&nbsp;<span class="ident" id="6212900">err</span>&nbsp;<span class="op" id="6212904">!=</span>&nbsp;<span class="ident" id="6212907">nil</span>&nbsp;<span class="op" id="6212911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212916">fmt</span><span class="op" id="6212919">.</span><span class="ident" id="6212920">Fprintf</span><span class="op" id="6212927">(</span><span class="ident" id="6212928">os</span><span class="op" id="6212930">.</span><span class="ident" id="6212931">Stderr</span><span class="op" id="6212937">,</span>&nbsp;<span class="string" id="6212939">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6212954">,</span>&nbsp;<span class="ident" id="6212956">err</span><span class="op" id="6212959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212964">os</span><span class="op" id="6212966">.</span><span class="ident" id="6212967">Exit</span><span class="op" id="6212971">(</span><span class="num" id="6212972">2</span><span class="op" id="6212973">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212981">if</span>&nbsp;<span class="ident" id="6212984">err</span>&nbsp;<span class="op" id="6212988">=</span>&nbsp;<span class="ident" id="6212990">pprof</span><span class="op" id="6212995">.</span><span class="ident" id="6212996">Lookup</span><span class="op" id="6213002">(</span><span class="string" id="6213003">&#34;block&#34;</span><span class="op" id="6213010">)</span><span class="op" id="6213011">.</span><span class="ident" id="6213012">WriteTo</span><span class="op" id="6213019">(</span><span class="ident" id="6213020">f</span><span class="op" id="6213021">,</span>&nbsp;<span class="num" id="6213023">0</span><span class="op" id="6213024">)</span><span class="op" id="6213025">;</span>&nbsp;<span class="ident" id="6213027">err</span>&nbsp;<span class="op" id="6213031">!=</span>&nbsp;<span class="ident" id="6213034">nil</span>&nbsp;<span class="op" id="6213038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213043">fmt</span><span class="op" id="6213046">.</span><span class="ident" id="6213047">Fprintf</span><span class="op" id="6213054">(</span><span class="ident" id="6213055">os</span><span class="op" id="6213057">.</span><span class="ident" id="6213058">Stderr</span><span class="op" id="6213064">,</span>&nbsp;<span class="string" id="6213066">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6213097">,</span>&nbsp;<span class="op" id="6213099">*</span><span class="ident" id="6213100">blockProfile</span><span class="op" id="6213112">,</span>&nbsp;<span class="ident" id="6213114">err</span><span class="op" id="6213117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213122">os</span><span class="op" id="6213124">.</span><span class="ident" id="6213125">Exit</span><span class="op" id="6213129">(</span><span class="num" id="6213130">2</span><span class="op" id="6213131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213135">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213139">f</span><span class="op" id="6213140">.</span><span class="ident" id="6213141">Close</span><span class="op" id="6213146">(</span><span class="op" id="6213147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213153">if</span>&nbsp;<span class="ident" id="6213156">cover</span><span class="op" id="6213161">.</span><span class="ident" id="6213162">Mode</span>&nbsp;<span class="op" id="6213167">!=</span>&nbsp;<span class="string" id="6213170">&#34;&#34;</span>&nbsp;<span class="op" id="6213173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213177">coverReport</span><span class="op" id="6213188">(</span><span class="op" id="6213189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213192">}</span><br>
<span class="lineno">645</span><span class="op" id="6213194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6213197">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6213272">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6213332">func</span>&nbsp;<span class="ident" id="6213337">toOutputDir</span><span class="op" id="6213348">(</span><span class="ident" id="6213349">path</span>&nbsp;<span class="builtintype" id="6213354">string</span><span class="op" id="6213360">)</span>&nbsp;<span class="builtintype" id="6213362">string</span>&nbsp;<span class="op" id="6213369">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213372">if</span>&nbsp;<span class="op" id="6213375">*</span><span class="ident" id="6213376">outputDir</span>&nbsp;<span class="op" id="6213386">==</span>&nbsp;<span class="string" id="6213389">&#34;&#34;</span>&nbsp;<span class="op" id="6213392">||</span>&nbsp;<span class="ident" id="6213395">path</span>&nbsp;<span class="op" id="6213400">==</span>&nbsp;<span class="string" id="6213403">&#34;&#34;</span>&nbsp;<span class="op" id="6213406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213410">return</span>&nbsp;<span class="ident" id="6213417">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213426">if</span>&nbsp;<span class="ident" id="6213429">runtime</span><span class="op" id="6213436">.</span><span class="ident" id="6213437">GOOS</span>&nbsp;<span class="op" id="6213442">==</span>&nbsp;<span class="string" id="6213445">&#34;windows&#34;</span>&nbsp;<span class="op" id="6213455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213459">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213525">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213578">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213641">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213710">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213769">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213838">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213876">if</span>&nbsp;<span class="builtinfunc" id="6213879">len</span><span class="op" id="6213882">(</span><span class="ident" id="6213883">path</span><span class="op" id="6213887">)</span>&nbsp;<span class="op" id="6213889">&gt;=</span>&nbsp;<span class="num" id="6213892">2</span>&nbsp;<span class="op" id="6213894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213899">letter</span><span class="op" id="6213905">,</span>&nbsp;<span class="ident" id="6213907">colon</span>&nbsp;<span class="op" id="6213913">:=</span>&nbsp;<span class="ident" id="6213916">path</span><span class="op" id="6213920">[</span><span class="num" id="6213921">0</span><span class="op" id="6213922">]</span><span class="op" id="6213923">,</span>&nbsp;<span class="ident" id="6213925">path</span><span class="op" id="6213929">[</span><span class="num" id="6213930">1</span><span class="op" id="6213931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213936">if</span>&nbsp;<span class="op" id="6213939">(</span><span class="string" id="6213940">&#39;a&#39;</span>&nbsp;<span class="op" id="6213944">&lt;=</span>&nbsp;<span class="ident" id="6213947">letter</span>&nbsp;<span class="op" id="6213954">&amp;&amp;</span>&nbsp;<span class="ident" id="6213957">letter</span>&nbsp;<span class="op" id="6213964">&lt;=</span>&nbsp;<span class="string" id="6213967">&#39;z&#39;</span>&nbsp;<span class="op" id="6213971">||</span>&nbsp;<span class="string" id="6213974">&#39;A&#39;</span>&nbsp;<span class="op" id="6213978">&lt;=</span>&nbsp;<span class="ident" id="6213981">letter</span>&nbsp;<span class="op" id="6213988">&amp;&amp;</span>&nbsp;<span class="ident" id="6213991">letter</span>&nbsp;<span class="op" id="6213998">&lt;=</span>&nbsp;<span class="string" id="6214001">&#39;Z&#39;</span><span class="op" id="6214004">)</span>&nbsp;<span class="op" id="6214006">&amp;&amp;</span>&nbsp;<span class="ident" id="6214009">colon</span>&nbsp;<span class="op" id="6214015">==</span>&nbsp;<span class="string" id="6214018">&#39;:&#39;</span>&nbsp;<span class="op" id="6214022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6214028">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214102">return</span>&nbsp;<span class="ident" id="6214109">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214127">if</span>&nbsp;<span class="ident" id="6214130">os</span><span class="op" id="6214132">.</span><span class="ident" id="6214133">IsPathSeparator</span><span class="op" id="6214148">(</span><span class="ident" id="6214149">path</span><span class="op" id="6214153">[</span><span class="num" id="6214154">0</span><span class="op" id="6214155">]</span><span class="op" id="6214156">)</span>&nbsp;<span class="op" id="6214158">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214162">return</span>&nbsp;<span class="ident" id="6214169">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214178">return</span>&nbsp;<span class="ident" id="6214185">fmt</span><span class="op" id="6214188">.</span><span class="ident" id="6214189">Sprintf</span><span class="op" id="6214196">(</span><span class="string" id="6214197">&#34;%s%c%s&#34;</span><span class="op" id="6214205">,</span>&nbsp;<span class="op" id="6214207">*</span><span class="ident" id="6214208">outputDir</span><span class="op" id="6214217">,</span>&nbsp;<span class="ident" id="6214219">os</span><span class="op" id="6214221">.</span><span class="ident" id="6214222">PathSeparator</span><span class="op" id="6214235">,</span>&nbsp;<span class="ident" id="6214237">path</span><span class="op" id="6214241">)</span><br>
<span class="lineno"></span><span class="op" id="6214243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6214246">var</span>&nbsp;<span class="ident" id="6214250">timer</span>&nbsp;<span class="op" id="6214256">*</span><span class="ident" id="6214257">time</span><span class="op" id="6214261">.</span><span class="ident" id="6214262">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6214269">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6214313">func</span>&nbsp;<span class="ident" id="6214318">startAlarm</span><span class="op" id="6214328">(</span><span class="op" id="6214329">)</span>&nbsp;<span class="op" id="6214331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214334">if</span>&nbsp;<span class="op" id="6214337">*</span><span class="ident" id="6214338">timeout</span>&nbsp;<span class="op" id="6214346">&gt;</span>&nbsp;<span class="num" id="6214348">0</span>&nbsp;<span class="op" id="6214350">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214354">timer</span>&nbsp;<span class="op" id="6214360">=</span>&nbsp;<span class="ident" id="6214362">time</span><span class="op" id="6214366">.</span><span class="ident" id="6214367">AfterFunc</span><span class="op" id="6214376">(</span><span class="op" id="6214377">*</span><span class="ident" id="6214378">timeout</span><span class="op" id="6214385">,</span>&nbsp;<span class="keyword" id="6214387">func</span><span class="op" id="6214391">(</span><span class="op" id="6214392">)</span>&nbsp;<span class="op" id="6214394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6214399">panic</span><span class="op" id="6214404">(</span><span class="ident" id="6214405">fmt</span><span class="op" id="6214408">.</span><span class="ident" id="6214409">Sprintf</span><span class="op" id="6214416">(</span><span class="string" id="6214417">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6214442">,</span>&nbsp;<span class="op" id="6214444">*</span><span class="ident" id="6214445">timeout</span><span class="op" id="6214452">)</span><span class="op" id="6214453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214457">}</span><span class="op" id="6214458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214461">}</span><br>
<span class="lineno"></span><span class="op" id="6214463">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6214466">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6214500">func</span>&nbsp;<span class="ident" id="6214505">stopAlarm</span><span class="op" id="6214514">(</span><span class="op" id="6214515">)</span>&nbsp;<span class="op" id="6214517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214520">if</span>&nbsp;<span class="op" id="6214523">*</span><span class="ident" id="6214524">timeout</span>&nbsp;<span class="op" id="6214532">&gt;</span>&nbsp;<span class="num" id="6214534">0</span>&nbsp;<span class="op" id="6214536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214540">timer</span><span class="op" id="6214545">.</span><span class="ident" id="6214546">Stop</span><span class="op" id="6214550">(</span><span class="op" id="6214551">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214554">}</span><br>
<span class="lineno"></span><span class="op" id="6214556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6214559">func</span>&nbsp;<span class="ident" id="6214564">parseCpuList</span><span class="op" id="6214576">(</span><span class="op" id="6214577">)</span>&nbsp;<span class="op" id="6214579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214582">for</span>&nbsp;<span class="ident" id="6214586">_</span><span class="op" id="6214587">,</span>&nbsp;<span class="ident" id="6214589">val</span>&nbsp;<span class="op" id="6214593">:=</span>&nbsp;<span class="keyword" id="6214596">range</span>&nbsp;<span class="ident" id="6214602">strings</span><span class="op" id="6214609">.</span><span class="ident" id="6214610">Split</span><span class="op" id="6214615">(</span><span class="op" id="6214616">*</span><span class="ident" id="6214617">cpuListStr</span><span class="op" id="6214627">,</span>&nbsp;<span class="string" id="6214629">&#34;,&#34;</span><span class="op" id="6214632">)</span>&nbsp;<span class="op" id="6214634">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214638">val</span>&nbsp;<span class="op" id="6214642">=</span>&nbsp;<span class="ident" id="6214644">strings</span><span class="op" id="6214651">.</span><span class="ident" id="6214652">TrimSpace</span><span class="op" id="6214661">(</span><span class="ident" id="6214662">val</span><span class="op" id="6214665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214669">if</span>&nbsp;<span class="ident" id="6214672">val</span>&nbsp;<span class="op" id="6214676">==</span>&nbsp;<span class="string" id="6214679">&#34;&#34;</span>&nbsp;<span class="op" id="6214682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214687">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214702">cpu</span><span class="op" id="6214705">,</span>&nbsp;<span class="ident" id="6214707">err</span>&nbsp;<span class="op" id="6214711">:=</span>&nbsp;<span class="ident" id="6214714">strconv</span><span class="op" id="6214721">.</span><span class="ident" id="6214722">Atoi</span><span class="op" id="6214726">(</span><span class="ident" id="6214727">val</span><span class="op" id="6214730">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214734">if</span>&nbsp;<span class="ident" id="6214737">err</span>&nbsp;<span class="op" id="6214741">!=</span>&nbsp;<span class="ident" id="6214744">nil</span>&nbsp;<span class="op" id="6214748">||</span>&nbsp;<span class="ident" id="6214751">cpu</span>&nbsp;<span class="op" id="6214755">&lt;=</span>&nbsp;<span class="num" id="6214758">0</span>&nbsp;<span class="op" id="6214760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214765">fmt</span><span class="op" id="6214768">.</span><span class="ident" id="6214769">Fprintf</span><span class="op" id="6214776">(</span><span class="ident" id="6214777">os</span><span class="op" id="6214779">.</span><span class="ident" id="6214780">Stderr</span><span class="op" id="6214786">,</span>&nbsp;<span class="string" id="6214788">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6214831">,</span>&nbsp;<span class="ident" id="6214833">val</span><span class="op" id="6214836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214841">os</span><span class="op" id="6214843">.</span><span class="ident" id="6214844">Exit</span><span class="op" id="6214848">(</span><span class="num" id="6214849">1</span><span class="op" id="6214850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214858">cpuList</span>&nbsp;<span class="op" id="6214866">=</span>&nbsp;<span class="builtinfunc" id="6214868">append</span><span class="op" id="6214874">(</span><span class="ident" id="6214875">cpuList</span><span class="op" id="6214882">,</span>&nbsp;<span class="ident" id="6214884">cpu</span><span class="op" id="6214887">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214893">if</span>&nbsp;<span class="ident" id="6214896">cpuList</span>&nbsp;<span class="op" id="6214904">==</span>&nbsp;<span class="ident" id="6214907">nil</span>&nbsp;<span class="op" id="6214911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214915">cpuList</span>&nbsp;<span class="op" id="6214923">=</span>&nbsp;<span class="builtinfunc" id="6214925">append</span><span class="op" id="6214931">(</span><span class="ident" id="6214932">cpuList</span><span class="op" id="6214939">,</span>&nbsp;<span class="ident" id="6214941">runtime</span><span class="op" id="6214948">.</span><span class="ident" id="6214949">GOMAXPROCS</span><span class="op" id="6214959">(</span><span class="op" id="6214960">-</span><span class="num" id="6214961">1</span><span class="op" id="6214962">)</span><span class="op" id="6214963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214966">}</span><br>
<span class="lineno"></span><span class="op" id="6214968">}</span>
</div>
</body>
</html>
