<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5536111">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5536167">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5536221">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5536272">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5536342">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5536378">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5536419">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="5536466">package</span>&nbsp;<span class="ident" id="5536474">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5536481">import</span>&nbsp;<span class="op" id="5536488">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536491">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536500">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536509">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536516">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536522">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536533">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536541">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536552">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5536560">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="5536577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536580">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="5536652">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5536702">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="5536774">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="5536842">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="5536914">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="5536993">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="5537020">//</span><br>
<span class="lineno"></span><span class="comment" id="5537023">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="5537101">//</span><br>
<span class="lineno"></span><span class="comment" id="5537104">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="5537171">//</span><br>
<span class="lineno"></span><span class="comment" id="5537174">//&nbsp;&nbsp;&nbsp;&nbspgoroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5537231">//&nbsp;&nbsp;&nbsp;&nbspheap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="5537284">//&nbsp;&nbsp;&nbsp;&nbspthreadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5537358">//&nbsp;&nbsp;&nbsp;&nbspblock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="5537440">//</span><br>
<span class="lineno"></span><span class="comment" id="5537443">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="5537517">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="5537547">//</span><br>
<span class="lineno"></span><span class="comment" id="5537550">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="5537623">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="5537695">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="5537735">//</span><br>
<span class="lineno"></span><span class="keyword" id="5537738">type</span>&nbsp;<span class="ident" id="5537743">Profile</span>&nbsp;<span class="keyword" id="5537751">struct</span>&nbsp;<span class="op" id="5537758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537761">name</span>&nbsp;&nbsp;<span class="builtintype" id="5537767">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537775">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537781">sync</span><span class="op" id="5537785">.</span><span class="ident" id="5537786">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537793">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537799">map</span><span class="op" id="5537802">[</span><span class="keyword" id="5537803">interface</span><span class="op" id="5537812">{</span><span class="op" id="5537813">}</span><span class="op" id="5537814">]</span><span class="op" id="5537815">[</span><span class="op" id="5537816">]</span><span class="builtintype" id="5537817">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537826">count</span>&nbsp;<span class="keyword" id="5537832">func</span><span class="op" id="5537836">(</span><span class="op" id="5537837">)</span>&nbsp;<span class="builtintype" id="5537839">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537844">write</span>&nbsp;<span class="keyword" id="5537850">func</span><span class="op" id="5537854">(</span><span class="ident" id="5537855">io</span><span class="op" id="5537857">.</span><span class="ident" id="5537858">Writer</span><span class="op" id="5537864">,</span>&nbsp;<span class="builtintype" id="5537866">int</span><span class="op" id="5537869">)</span>&nbsp;<span class="builtintype" id="5537871">error</span><br>
<span class="lineno"></span><span class="op" id="5537877">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="5537880">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5537925">var</span>&nbsp;<span class="ident" id="5537929">profiles</span>&nbsp;<span class="keyword" id="5537938">struct</span>&nbsp;<span class="op" id="5537945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537948">mu</span>&nbsp;<span class="ident" id="5537951">sync</span><span class="op" id="5537955">.</span><span class="ident" id="5537956">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537963">m</span>&nbsp;&nbsp;<span class="keyword" id="5537966">map</span><span class="op" id="5537969">[</span><span class="builtintype" id="5537970">string</span><span class="op" id="5537976">]</span><span class="op" id="5537977">*</span><span class="ident" id="5537978">Profile</span><br>
<span class="lineno">60</span><span class="op" id="5537986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537989">var</span>&nbsp;<span class="ident" id="5537993">goroutineProfile</span>&nbsp;<span class="op" id="5538010">=</span>&nbsp;<span class="op" id="5538012">&amp;</span><span class="ident" id="5538013">Profile</span><span class="op" id="5538020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538023">name</span><span class="op" id="5538027">:</span>&nbsp;&nbsp;<span class="string" id="5538030">&#34;goroutine&#34;</span><span class="op" id="5538041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538044">count</span><span class="op" id="5538049">:</span>&nbsp;<span class="ident" id="5538051">countGoroutine</span><span class="op" id="5538065">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538068">write</span><span class="op" id="5538073">:</span>&nbsp;<span class="ident" id="5538075">writeGoroutine</span><span class="op" id="5538089">,</span><br>
<span class="lineno"></span><span class="op" id="5538091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538094">var</span>&nbsp;<span class="ident" id="5538098">threadcreateProfile</span>&nbsp;<span class="op" id="5538118">=</span>&nbsp;<span class="op" id="5538120">&amp;</span><span class="ident" id="5538121">Profile</span><span class="op" id="5538128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538131">name</span><span class="op" id="5538135">:</span>&nbsp;&nbsp;<span class="string" id="5538138">&#34;threadcreate&#34;</span><span class="op" id="5538152">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538155">count</span><span class="op" id="5538160">:</span>&nbsp;<span class="ident" id="5538162">countThreadCreate</span><span class="op" id="5538179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538182">write</span><span class="op" id="5538187">:</span>&nbsp;<span class="ident" id="5538189">writeThreadCreate</span><span class="op" id="5538206">,</span><br>
<span class="lineno"></span><span class="op" id="5538208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538211">var</span>&nbsp;<span class="ident" id="5538215">heapProfile</span>&nbsp;<span class="op" id="5538227">=</span>&nbsp;<span class="op" id="5538229">&amp;</span><span class="ident" id="5538230">Profile</span><span class="op" id="5538237">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538240">name</span><span class="op" id="5538244">:</span>&nbsp;&nbsp;<span class="string" id="5538247">&#34;heap&#34;</span><span class="op" id="5538253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538256">count</span><span class="op" id="5538261">:</span>&nbsp;<span class="ident" id="5538263">countHeap</span><span class="op" id="5538272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538275">write</span><span class="op" id="5538280">:</span>&nbsp;<span class="ident" id="5538282">writeHeap</span><span class="op" id="5538291">,</span><br>
<span class="lineno"></span><span class="op" id="5538293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5538296">var</span>&nbsp;<span class="ident" id="5538300">blockProfile</span>&nbsp;<span class="op" id="5538313">=</span>&nbsp;<span class="op" id="5538315">&amp;</span><span class="ident" id="5538316">Profile</span><span class="op" id="5538323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538326">name</span><span class="op" id="5538330">:</span>&nbsp;&nbsp;<span class="string" id="5538333">&#34;block&#34;</span><span class="op" id="5538340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538343">count</span><span class="op" id="5538348">:</span>&nbsp;<span class="ident" id="5538350">countBlock</span><span class="op" id="5538360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538363">write</span><span class="op" id="5538368">:</span>&nbsp;<span class="ident" id="5538370">writeBlock</span><span class="op" id="5538380">,</span><br>
<span class="lineno"></span><span class="op" id="5538382">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="5538385">func</span>&nbsp;<span class="ident" id="5538390">lockProfiles</span><span class="op" id="5538402">(</span><span class="op" id="5538403">)</span>&nbsp;<span class="op" id="5538405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538408">profiles</span><span class="op" id="5538416">.</span><span class="ident" id="5538417">mu</span><span class="op" id="5538419">.</span><span class="ident" id="5538420">Lock</span><span class="op" id="5538424">(</span><span class="op" id="5538425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538428">if</span>&nbsp;<span class="ident" id="5538431">profiles</span><span class="op" id="5538439">.</span><span class="ident" id="5538440">m</span>&nbsp;<span class="op" id="5538442">==</span>&nbsp;<span class="ident" id="5538445">nil</span>&nbsp;<span class="op" id="5538449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538453">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538485">profiles</span><span class="op" id="5538493">.</span><span class="ident" id="5538494">m</span>&nbsp;<span class="op" id="5538496">=</span>&nbsp;<span class="keyword" id="5538498">map</span><span class="op" id="5538501">[</span><span class="builtintype" id="5538502">string</span><span class="op" id="5538508">]</span><span class="op" id="5538509">*</span><span class="ident" id="5538510">Profile</span><span class="op" id="5538517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538522">&#34;goroutine&#34;</span><span class="op" id="5538533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538538">goroutineProfile</span><span class="op" id="5538554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538559">&#34;threadcreate&#34;</span><span class="op" id="5538573">:</span>&nbsp;<span class="ident" id="5538575">threadcreateProfile</span><span class="op" id="5538594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538599">&#34;heap&#34;</span><span class="op" id="5538605">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538615">heapProfile</span><span class="op" id="5538626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538631">&#34;block&#34;</span><span class="op" id="5538638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538647">blockProfile</span><span class="op" id="5538659">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538666">}</span><br>
<span class="lineno"></span><span class="op" id="5538668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538671">func</span>&nbsp;<span class="ident" id="5538676">unlockProfiles</span><span class="op" id="5538690">(</span><span class="op" id="5538691">)</span>&nbsp;<span class="op" id="5538693">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538696">profiles</span><span class="op" id="5538704">.</span><span class="ident" id="5538705">mu</span><span class="op" id="5538707">.</span><span class="ident" id="5538708">Unlock</span><span class="op" id="5538714">(</span><span class="op" id="5538715">)</span><br>
<span class="lineno"></span><span class="op" id="5538717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538720">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5538777">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="5538843">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="5538905">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5538947">func</span>&nbsp;<span class="ident" id="5538952">NewProfile</span><span class="op" id="5538962">(</span><span class="ident" id="5538963">name</span>&nbsp;<span class="builtintype" id="5538968">string</span><span class="op" id="5538974">)</span>&nbsp;<span class="op" id="5538976">*</span><span class="ident" id="5538977">Profile</span>&nbsp;<span class="op" id="5538985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538988">lockProfiles</span><span class="op" id="5539000">(</span><span class="op" id="5539001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539004">defer</span>&nbsp;<span class="ident" id="5539010">unlockProfiles</span><span class="op" id="5539024">(</span><span class="op" id="5539025">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539028">if</span>&nbsp;<span class="ident" id="5539031">name</span>&nbsp;<span class="op" id="5539036">==</span>&nbsp;<span class="string" id="5539039">&#34;&#34;</span>&nbsp;<span class="op" id="5539042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5539046">panic</span><span class="op" id="5539051">(</span><span class="string" id="5539052">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5539087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539093">if</span>&nbsp;<span class="ident" id="5539096">profiles</span><span class="op" id="5539104">.</span><span class="ident" id="5539105">m</span><span class="op" id="5539106">[</span><span class="ident" id="5539107">name</span><span class="op" id="5539111">]</span>&nbsp;<span class="op" id="5539113">!=</span>&nbsp;<span class="ident" id="5539116">nil</span>&nbsp;<span class="op" id="5539120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5539124">panic</span><span class="op" id="5539129">(</span><span class="string" id="5539130">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="5539172">+</span>&nbsp;<span class="ident" id="5539174">name</span><span class="op" id="5539178">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539184">p</span>&nbsp;<span class="op" id="5539186">:=</span>&nbsp;<span class="op" id="5539189">&amp;</span><span class="ident" id="5539190">Profile</span><span class="op" id="5539197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539201">name</span><span class="op" id="5539205">:</span>&nbsp;<span class="ident" id="5539207">name</span><span class="op" id="5539211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539215">m</span><span class="op" id="5539216">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5539221">map</span><span class="op" id="5539224">[</span><span class="keyword" id="5539225">interface</span><span class="op" id="5539234">{</span><span class="op" id="5539235">}</span><span class="op" id="5539236">]</span><span class="op" id="5539237">[</span><span class="op" id="5539238">]</span><span class="builtintype" id="5539239">uintptr</span><span class="op" id="5539246">{</span><span class="op" id="5539247">}</span><span class="op" id="5539248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539251">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539254">profiles</span><span class="op" id="5539262">.</span><span class="ident" id="5539263">m</span><span class="op" id="5539264">[</span><span class="ident" id="5539265">name</span><span class="op" id="5539269">]</span>&nbsp;<span class="op" id="5539271">=</span>&nbsp;<span class="ident" id="5539273">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539276">return</span>&nbsp;<span class="ident" id="5539283">p</span><br>
<span class="lineno"></span><span class="op" id="5539285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539288">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="5539373">func</span>&nbsp;<span class="ident" id="5539378">Lookup</span><span class="op" id="5539384">(</span><span class="ident" id="5539385">name</span>&nbsp;<span class="builtintype" id="5539390">string</span><span class="op" id="5539396">)</span>&nbsp;<span class="op" id="5539398">*</span><span class="ident" id="5539399">Profile</span>&nbsp;<span class="op" id="5539407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539410">lockProfiles</span><span class="op" id="5539422">(</span><span class="op" id="5539423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539426">defer</span>&nbsp;<span class="ident" id="5539432">unlockProfiles</span><span class="op" id="5539446">(</span><span class="op" id="5539447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539450">return</span>&nbsp;<span class="ident" id="5539457">profiles</span><span class="op" id="5539465">.</span><span class="ident" id="5539466">m</span><span class="op" id="5539467">[</span><span class="ident" id="5539468">name</span><span class="op" id="5539472">]</span><br>
<span class="lineno"></span><span class="op" id="5539474">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5539477">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5539548">func</span>&nbsp;<span class="ident" id="5539553">Profiles</span><span class="op" id="5539561">(</span><span class="op" id="5539562">)</span>&nbsp;<span class="op" id="5539564">[</span><span class="op" id="5539565">]</span><span class="op" id="5539566">*</span><span class="ident" id="5539567">Profile</span>&nbsp;<span class="op" id="5539575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539578">lockProfiles</span><span class="op" id="5539590">(</span><span class="op" id="5539591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539594">defer</span>&nbsp;<span class="ident" id="5539600">unlockProfiles</span><span class="op" id="5539614">(</span><span class="op" id="5539615">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539619">var</span>&nbsp;<span class="ident" id="5539623">all</span>&nbsp;<span class="op" id="5539627">[</span><span class="op" id="5539628">]</span><span class="op" id="5539629">*</span><span class="ident" id="5539630">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539639">for</span>&nbsp;<span class="ident" id="5539643">_</span><span class="op" id="5539644">,</span>&nbsp;<span class="ident" id="5539646">p</span>&nbsp;<span class="op" id="5539648">:=</span>&nbsp;<span class="keyword" id="5539651">range</span>&nbsp;<span class="ident" id="5539657">profiles</span><span class="op" id="5539665">.</span><span class="ident" id="5539666">m</span>&nbsp;<span class="op" id="5539668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539672">all</span>&nbsp;<span class="op" id="5539676">=</span>&nbsp;<span class="builtinfunc" id="5539678">append</span><span class="op" id="5539684">(</span><span class="ident" id="5539685">all</span><span class="op" id="5539688">,</span>&nbsp;<span class="ident" id="5539690">p</span><span class="op" id="5539691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539694">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539698">sort</span><span class="op" id="5539702">.</span><span class="ident" id="5539703">Sort</span><span class="op" id="5539707">(</span><span class="ident" id="5539708">byName</span><span class="op" id="5539714">(</span><span class="ident" id="5539715">all</span><span class="op" id="5539718">)</span><span class="op" id="5539719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539722">return</span>&nbsp;<span class="ident" id="5539729">all</span><br>
<span class="lineno"></span><span class="op" id="5539733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5539736">type</span>&nbsp;<span class="ident" id="5539741">byName</span>&nbsp;<span class="op" id="5539748">[</span><span class="op" id="5539749">]</span><span class="op" id="5539750">*</span><span class="ident" id="5539751">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5539760">func</span>&nbsp;<span class="op" id="5539765">(</span><span class="ident" id="5539766">x</span>&nbsp;<span class="ident" id="5539768">byName</span><span class="op" id="5539774">)</span>&nbsp;<span class="ident" id="5539776">Len</span><span class="op" id="5539779">(</span><span class="op" id="5539780">)</span>&nbsp;<span class="builtintype" id="5539782">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5539796">{</span>&nbsp;<span class="keyword" id="5539798">return</span>&nbsp;<span class="builtinfunc" id="5539805">len</span><span class="op" id="5539808">(</span><span class="ident" id="5539809">x</span><span class="op" id="5539810">)</span>&nbsp;<span class="op" id="5539812">}</span><br>
<span class="lineno"></span><span class="keyword" id="5539814">func</span>&nbsp;<span class="op" id="5539819">(</span><span class="ident" id="5539820">x</span>&nbsp;<span class="ident" id="5539822">byName</span><span class="op" id="5539828">)</span>&nbsp;<span class="ident" id="5539830">Swap</span><span class="op" id="5539834">(</span><span class="ident" id="5539835">i</span><span class="op" id="5539836">,</span>&nbsp;<span class="ident" id="5539838">j</span>&nbsp;<span class="builtintype" id="5539840">int</span><span class="op" id="5539843">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5539850">{</span>&nbsp;<span class="ident" id="5539852">x</span><span class="op" id="5539853">[</span><span class="ident" id="5539854">i</span><span class="op" id="5539855">]</span><span class="op" id="5539856">,</span>&nbsp;<span class="ident" id="5539858">x</span><span class="op" id="5539859">[</span><span class="ident" id="5539860">j</span><span class="op" id="5539861">]</span>&nbsp;<span class="op" id="5539863">=</span>&nbsp;<span class="ident" id="5539865">x</span><span class="op" id="5539866">[</span><span class="ident" id="5539867">j</span><span class="op" id="5539868">]</span><span class="op" id="5539869">,</span>&nbsp;<span class="ident" id="5539871">x</span><span class="op" id="5539872">[</span><span class="ident" id="5539873">i</span><span class="op" id="5539874">]</span>&nbsp;<span class="op" id="5539876">}</span><br>
<span class="lineno"></span><span class="keyword" id="5539878">func</span>&nbsp;<span class="op" id="5539883">(</span><span class="ident" id="5539884">x</span>&nbsp;<span class="ident" id="5539886">byName</span><span class="op" id="5539892">)</span>&nbsp;<span class="ident" id="5539894">Less</span><span class="op" id="5539898">(</span><span class="ident" id="5539899">i</span><span class="op" id="5539900">,</span>&nbsp;<span class="ident" id="5539902">j</span>&nbsp;<span class="builtintype" id="5539904">int</span><span class="op" id="5539907">)</span>&nbsp;<span class="builtintype" id="5539909">bool</span>&nbsp;<span class="op" id="5539914">{</span>&nbsp;<span class="keyword" id="5539916">return</span>&nbsp;<span class="ident" id="5539923">x</span><span class="op" id="5539924">[</span><span class="ident" id="5539925">i</span><span class="op" id="5539926">]</span><span class="op" id="5539927">.</span><span class="ident" id="5539928">name</span>&nbsp;<span class="op" id="5539933">&lt;</span>&nbsp;<span class="ident" id="5539935">x</span><span class="op" id="5539936">[</span><span class="ident" id="5539937">j</span><span class="op" id="5539938">]</span><span class="op" id="5539939">.</span><span class="ident" id="5539940">name</span>&nbsp;<span class="op" id="5539945">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5539948">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5540040">func</span>&nbsp;<span class="op" id="5540045">(</span><span class="ident" id="5540046">p</span>&nbsp;<span class="op" id="5540048">*</span><span class="ident" id="5540049">Profile</span><span class="op" id="5540056">)</span>&nbsp;<span class="ident" id="5540058">Name</span><span class="op" id="5540062">(</span><span class="op" id="5540063">)</span>&nbsp;<span class="builtintype" id="5540065">string</span>&nbsp;<span class="op" id="5540072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540075">return</span>&nbsp;<span class="ident" id="5540082">p</span><span class="op" id="5540083">.</span><span class="ident" id="5540084">name</span><br>
<span class="lineno"></span><span class="op" id="5540089">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="5540092">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5540166">func</span>&nbsp;<span class="op" id="5540171">(</span><span class="ident" id="5540172">p</span>&nbsp;<span class="op" id="5540174">*</span><span class="ident" id="5540175">Profile</span><span class="op" id="5540182">)</span>&nbsp;<span class="ident" id="5540184">Count</span><span class="op" id="5540189">(</span><span class="op" id="5540190">)</span>&nbsp;<span class="builtintype" id="5540192">int</span>&nbsp;<span class="op" id="5540196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540199">p</span><span class="op" id="5540200">.</span><span class="ident" id="5540201">mu</span><span class="op" id="5540203">.</span><span class="ident" id="5540204">Lock</span><span class="op" id="5540208">(</span><span class="op" id="5540209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540212">defer</span>&nbsp;<span class="ident" id="5540218">p</span><span class="op" id="5540219">.</span><span class="ident" id="5540220">mu</span><span class="op" id="5540222">.</span><span class="ident" id="5540223">Unlock</span><span class="op" id="5540229">(</span><span class="op" id="5540230">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540233">if</span>&nbsp;<span class="ident" id="5540236">p</span><span class="op" id="5540237">.</span><span class="ident" id="5540238">count</span>&nbsp;<span class="op" id="5540244">!=</span>&nbsp;<span class="ident" id="5540247">nil</span>&nbsp;<span class="op" id="5540251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540255">return</span>&nbsp;<span class="ident" id="5540262">p</span><span class="op" id="5540263">.</span><span class="ident" id="5540264">count</span><span class="op" id="5540269">(</span><span class="op" id="5540270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540276">return</span>&nbsp;<span class="builtinfunc" id="5540283">len</span><span class="op" id="5540286">(</span><span class="ident" id="5540287">p</span><span class="op" id="5540288">.</span><span class="ident" id="5540289">m</span><span class="op" id="5540290">)</span><br>
<span class="lineno"></span><span class="op" id="5540292">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5540295">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5540374">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5540451">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5540522">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="5540604">//</span><br>
<span class="lineno"></span><span class="comment" id="5540607">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5540675">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5540748">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="5540811">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="5540831">//</span><br>
<span class="lineno"></span><span class="comment" id="5540834">//&nbsp;&nbsp;&nbsp;&nbspAdd</span><br>
<span class="lineno"></span><span class="comment" id="5540841">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="5540870">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="5540895">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="5540920">//</span><br>
<span class="lineno"></span><span class="comment" id="5540923">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="5541005">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="5541089">//</span><br>
<span class="lineno"></span><span class="keyword" id="5541092">func</span>&nbsp;<span class="op" id="5541097">(</span><span class="ident" id="5541098">p</span>&nbsp;<span class="op" id="5541100">*</span><span class="ident" id="5541101">Profile</span><span class="op" id="5541108">)</span>&nbsp;<span class="ident" id="5541110">Add</span><span class="op" id="5541113">(</span><span class="ident" id="5541114">value</span>&nbsp;<span class="keyword" id="5541120">interface</span><span class="op" id="5541129">{</span><span class="op" id="5541130">}</span><span class="op" id="5541131">,</span>&nbsp;<span class="ident" id="5541133">skip</span>&nbsp;<span class="builtintype" id="5541138">int</span><span class="op" id="5541141">)</span>&nbsp;<span class="op" id="5541143">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541146">if</span>&nbsp;<span class="ident" id="5541149">p</span><span class="op" id="5541150">.</span><span class="ident" id="5541151">name</span>&nbsp;<span class="op" id="5541156">==</span>&nbsp;<span class="string" id="5541159">&#34;&#34;</span>&nbsp;<span class="op" id="5541162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5541166">panic</span><span class="op" id="5541171">(</span><span class="string" id="5541172">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="5541209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541215">if</span>&nbsp;<span class="ident" id="5541218">p</span><span class="op" id="5541219">.</span><span class="ident" id="5541220">write</span>&nbsp;<span class="op" id="5541226">!=</span>&nbsp;<span class="ident" id="5541229">nil</span>&nbsp;<span class="op" id="5541233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5541237">panic</span><span class="op" id="5541242">(</span><span class="string" id="5541243">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="5541284">+</span>&nbsp;<span class="ident" id="5541286">p</span><span class="op" id="5541287">.</span><span class="ident" id="5541288">name</span><span class="op" id="5541292">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541299">stk</span>&nbsp;<span class="op" id="5541303">:=</span>&nbsp;<span class="builtinfunc" id="5541306">make</span><span class="op" id="5541310">(</span><span class="op" id="5541311">[</span><span class="op" id="5541312">]</span><span class="builtintype" id="5541313">uintptr</span><span class="op" id="5541320">,</span>&nbsp;<span class="num" id="5541322">32</span><span class="op" id="5541324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541327">n</span>&nbsp;<span class="op" id="5541329">:=</span>&nbsp;<span class="ident" id="5541332">runtime</span><span class="op" id="5541339">.</span><span class="ident" id="5541340">Callers</span><span class="op" id="5541347">(</span><span class="ident" id="5541348">skip</span><span class="op" id="5541352">+</span><span class="num" id="5541353">1</span><span class="op" id="5541354">,</span>&nbsp;<span class="ident" id="5541356">stk</span><span class="op" id="5541359">[</span><span class="op" id="5541360">:</span><span class="op" id="5541361">]</span><span class="op" id="5541362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541366">p</span><span class="op" id="5541367">.</span><span class="ident" id="5541368">mu</span><span class="op" id="5541370">.</span><span class="ident" id="5541371">Lock</span><span class="op" id="5541375">(</span><span class="op" id="5541376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541379">defer</span>&nbsp;<span class="ident" id="5541385">p</span><span class="op" id="5541386">.</span><span class="ident" id="5541387">mu</span><span class="op" id="5541389">.</span><span class="ident" id="5541390">Unlock</span><span class="op" id="5541396">(</span><span class="op" id="5541397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541400">if</span>&nbsp;<span class="ident" id="5541403">p</span><span class="op" id="5541404">.</span><span class="ident" id="5541405">m</span><span class="op" id="5541406">[</span><span class="ident" id="5541407">value</span><span class="op" id="5541412">]</span>&nbsp;<span class="op" id="5541414">!=</span>&nbsp;<span class="ident" id="5541417">nil</span>&nbsp;<span class="op" id="5541421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5541425">panic</span><span class="op" id="5541430">(</span><span class="string" id="5541431">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="5541470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541473">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541476">p</span><span class="op" id="5541477">.</span><span class="ident" id="5541478">m</span><span class="op" id="5541479">[</span><span class="ident" id="5541480">value</span><span class="op" id="5541485">]</span>&nbsp;<span class="op" id="5541487">=</span>&nbsp;<span class="ident" id="5541489">stk</span><span class="op" id="5541492">[</span><span class="op" id="5541493">:</span><span class="ident" id="5541494">n</span><span class="op" id="5541495">]</span><br>
<span class="lineno"></span><span class="op" id="5541497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541500">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5541578">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="5541631">func</span>&nbsp;<span class="op" id="5541636">(</span><span class="ident" id="5541637">p</span>&nbsp;<span class="op" id="5541639">*</span><span class="ident" id="5541640">Profile</span><span class="op" id="5541647">)</span>&nbsp;<span class="ident" id="5541649">Remove</span><span class="op" id="5541655">(</span><span class="ident" id="5541656">value</span>&nbsp;<span class="keyword" id="5541662">interface</span><span class="op" id="5541671">{</span><span class="op" id="5541672">}</span><span class="op" id="5541673">)</span>&nbsp;<span class="op" id="5541675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541678">p</span><span class="op" id="5541679">.</span><span class="ident" id="5541680">mu</span><span class="op" id="5541682">.</span><span class="ident" id="5541683">Lock</span><span class="op" id="5541687">(</span><span class="op" id="5541688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541691">defer</span>&nbsp;<span class="ident" id="5541697">p</span><span class="op" id="5541698">.</span><span class="ident" id="5541699">mu</span><span class="op" id="5541701">.</span><span class="ident" id="5541702">Unlock</span><span class="op" id="5541708">(</span><span class="op" id="5541709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5541712">delete</span><span class="op" id="5541718">(</span><span class="ident" id="5541719">p</span><span class="op" id="5541720">.</span><span class="ident" id="5541721">m</span><span class="op" id="5541722">,</span>&nbsp;<span class="ident" id="5541724">value</span><span class="op" id="5541729">)</span><br>
<span class="lineno"></span><span class="op" id="5541731">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="5541734">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5541800">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5541865">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5541900">//</span><br>
<span class="lineno">215</span><span class="comment" id="5541903">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5541953">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="5542028">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="5542101">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="5542179">//</span><br>
<span class="lineno">220</span><span class="comment" id="5542182">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="5542251">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5542323">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="5542393">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="5542436">func</span>&nbsp;<span class="op" id="5542441">(</span><span class="ident" id="5542442">p</span>&nbsp;<span class="op" id="5542444">*</span><span class="ident" id="5542445">Profile</span><span class="op" id="5542452">)</span>&nbsp;<span class="ident" id="5542454">WriteTo</span><span class="op" id="5542461">(</span><span class="ident" id="5542462">w</span>&nbsp;<span class="ident" id="5542464">io</span><span class="op" id="5542466">.</span><span class="ident" id="5542467">Writer</span><span class="op" id="5542473">,</span>&nbsp;<span class="ident" id="5542475">debug</span>&nbsp;<span class="builtintype" id="5542481">int</span><span class="op" id="5542484">)</span>&nbsp;<span class="builtintype" id="5542486">error</span>&nbsp;<span class="op" id="5542492">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542495">if</span>&nbsp;<span class="ident" id="5542498">p</span><span class="op" id="5542499">.</span><span class="ident" id="5542500">name</span>&nbsp;<span class="op" id="5542505">==</span>&nbsp;<span class="string" id="5542508">&#34;&#34;</span>&nbsp;<span class="op" id="5542511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5542515">panic</span><span class="op" id="5542520">(</span><span class="string" id="5542521">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="5542549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542555">if</span>&nbsp;<span class="ident" id="5542558">p</span><span class="op" id="5542559">.</span><span class="ident" id="5542560">write</span>&nbsp;<span class="op" id="5542566">!=</span>&nbsp;<span class="ident" id="5542569">nil</span>&nbsp;<span class="op" id="5542573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542577">return</span>&nbsp;<span class="ident" id="5542584">p</span><span class="op" id="5542585">.</span><span class="ident" id="5542586">write</span><span class="op" id="5542591">(</span><span class="ident" id="5542592">w</span><span class="op" id="5542593">,</span>&nbsp;<span class="ident" id="5542595">debug</span><span class="op" id="5542600">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5542607">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542677">var</span>&nbsp;<span class="ident" id="5542681">all</span>&nbsp;<span class="op" id="5542685">[</span><span class="op" id="5542686">]</span><span class="op" id="5542687">[</span><span class="op" id="5542688">]</span><span class="builtintype" id="5542689">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542698">p</span><span class="op" id="5542699">.</span><span class="ident" id="5542700">mu</span><span class="op" id="5542702">.</span><span class="ident" id="5542703">Lock</span><span class="op" id="5542707">(</span><span class="op" id="5542708">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542711">for</span>&nbsp;<span class="ident" id="5542715">_</span><span class="op" id="5542716">,</span>&nbsp;<span class="ident" id="5542718">stk</span>&nbsp;<span class="op" id="5542722">:=</span>&nbsp;<span class="keyword" id="5542725">range</span>&nbsp;<span class="ident" id="5542731">p</span><span class="op" id="5542732">.</span><span class="ident" id="5542733">m</span>&nbsp;<span class="op" id="5542735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542739">all</span>&nbsp;<span class="op" id="5542743">=</span>&nbsp;<span class="builtinfunc" id="5542745">append</span><span class="op" id="5542751">(</span><span class="ident" id="5542752">all</span><span class="op" id="5542755">,</span>&nbsp;<span class="ident" id="5542757">stk</span><span class="op" id="5542760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542766">p</span><span class="op" id="5542767">.</span><span class="ident" id="5542768">mu</span><span class="op" id="5542770">.</span><span class="ident" id="5542771">Unlock</span><span class="op" id="5542777">(</span><span class="op" id="5542778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5542782">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542845">sort</span><span class="op" id="5542849">.</span><span class="ident" id="5542850">Sort</span><span class="op" id="5542854">(</span><span class="ident" id="5542855">stackProfile</span><span class="op" id="5542867">(</span><span class="ident" id="5542868">all</span><span class="op" id="5542871">)</span><span class="op" id="5542872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542876">return</span>&nbsp;<span class="ident" id="5542883">printCountProfile</span><span class="op" id="5542900">(</span><span class="ident" id="5542901">w</span><span class="op" id="5542902">,</span>&nbsp;<span class="ident" id="5542904">debug</span><span class="op" id="5542909">,</span>&nbsp;<span class="ident" id="5542911">p</span><span class="op" id="5542912">.</span><span class="ident" id="5542913">name</span><span class="op" id="5542917">,</span>&nbsp;<span class="ident" id="5542919">stackProfile</span><span class="op" id="5542931">(</span><span class="ident" id="5542932">all</span><span class="op" id="5542935">)</span><span class="op" id="5542936">)</span><br>
<span class="lineno"></span><span class="op" id="5542938">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5542941">type</span>&nbsp;<span class="ident" id="5542946">stackProfile</span>&nbsp;<span class="op" id="5542959">[</span><span class="op" id="5542960">]</span><span class="op" id="5542961">[</span><span class="op" id="5542962">]</span><span class="builtintype" id="5542963">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5542972">func</span>&nbsp;<span class="op" id="5542977">(</span><span class="ident" id="5542978">x</span>&nbsp;<span class="ident" id="5542980">stackProfile</span><span class="op" id="5542992">)</span>&nbsp;<span class="ident" id="5542994">Len</span><span class="op" id="5542997">(</span><span class="op" id="5542998">)</span>&nbsp;<span class="builtintype" id="5543000">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5543017">{</span>&nbsp;<span class="keyword" id="5543019">return</span>&nbsp;<span class="builtinfunc" id="5543026">len</span><span class="op" id="5543029">(</span><span class="ident" id="5543030">x</span><span class="op" id="5543031">)</span>&nbsp;<span class="op" id="5543033">}</span><br>
<span class="lineno"></span><span class="keyword" id="5543035">func</span>&nbsp;<span class="op" id="5543040">(</span><span class="ident" id="5543041">x</span>&nbsp;<span class="ident" id="5543043">stackProfile</span><span class="op" id="5543055">)</span>&nbsp;<span class="ident" id="5543057">Stack</span><span class="op" id="5543062">(</span><span class="ident" id="5543063">i</span>&nbsp;<span class="builtintype" id="5543065">int</span><span class="op" id="5543068">)</span>&nbsp;<span class="op" id="5543070">[</span><span class="op" id="5543071">]</span><span class="builtintype" id="5543072">uintptr</span>&nbsp;<span class="op" id="5543080">{</span>&nbsp;<span class="keyword" id="5543082">return</span>&nbsp;<span class="ident" id="5543089">x</span><span class="op" id="5543090">[</span><span class="ident" id="5543091">i</span><span class="op" id="5543092">]</span>&nbsp;<span class="op" id="5543094">}</span><br>
<span class="lineno">250</span><span class="keyword" id="5543096">func</span>&nbsp;<span class="op" id="5543101">(</span><span class="ident" id="5543102">x</span>&nbsp;<span class="ident" id="5543104">stackProfile</span><span class="op" id="5543116">)</span>&nbsp;<span class="ident" id="5543118">Swap</span><span class="op" id="5543122">(</span><span class="ident" id="5543123">i</span><span class="op" id="5543124">,</span>&nbsp;<span class="ident" id="5543126">j</span>&nbsp;<span class="builtintype" id="5543128">int</span><span class="op" id="5543131">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5543141">{</span>&nbsp;<span class="ident" id="5543143">x</span><span class="op" id="5543144">[</span><span class="ident" id="5543145">i</span><span class="op" id="5543146">]</span><span class="op" id="5543147">,</span>&nbsp;<span class="ident" id="5543149">x</span><span class="op" id="5543150">[</span><span class="ident" id="5543151">j</span><span class="op" id="5543152">]</span>&nbsp;<span class="op" id="5543154">=</span>&nbsp;<span class="ident" id="5543156">x</span><span class="op" id="5543157">[</span><span class="ident" id="5543158">j</span><span class="op" id="5543159">]</span><span class="op" id="5543160">,</span>&nbsp;<span class="ident" id="5543162">x</span><span class="op" id="5543163">[</span><span class="ident" id="5543164">i</span><span class="op" id="5543165">]</span>&nbsp;<span class="op" id="5543167">}</span><br>
<span class="lineno"></span><span class="keyword" id="5543169">func</span>&nbsp;<span class="op" id="5543174">(</span><span class="ident" id="5543175">x</span>&nbsp;<span class="ident" id="5543177">stackProfile</span><span class="op" id="5543189">)</span>&nbsp;<span class="ident" id="5543191">Less</span><span class="op" id="5543195">(</span><span class="ident" id="5543196">i</span><span class="op" id="5543197">,</span>&nbsp;<span class="ident" id="5543199">j</span>&nbsp;<span class="builtintype" id="5543201">int</span><span class="op" id="5543204">)</span>&nbsp;<span class="builtintype" id="5543206">bool</span>&nbsp;<span class="op" id="5543211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543214">t</span><span class="op" id="5543215">,</span>&nbsp;<span class="ident" id="5543217">u</span>&nbsp;<span class="op" id="5543219">:=</span>&nbsp;<span class="ident" id="5543222">x</span><span class="op" id="5543223">[</span><span class="ident" id="5543224">i</span><span class="op" id="5543225">]</span><span class="op" id="5543226">,</span>&nbsp;<span class="ident" id="5543228">x</span><span class="op" id="5543229">[</span><span class="ident" id="5543230">j</span><span class="op" id="5543231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543234">for</span>&nbsp;<span class="ident" id="5543238">k</span>&nbsp;<span class="op" id="5543240">:=</span>&nbsp;<span class="num" id="5543243">0</span><span class="op" id="5543244">;</span>&nbsp;<span class="ident" id="5543246">k</span>&nbsp;<span class="op" id="5543248">&lt;</span>&nbsp;<span class="builtinfunc" id="5543250">len</span><span class="op" id="5543253">(</span><span class="ident" id="5543254">t</span><span class="op" id="5543255">)</span>&nbsp;<span class="op" id="5543257">&amp;&amp;</span>&nbsp;<span class="ident" id="5543260">k</span>&nbsp;<span class="op" id="5543262">&lt;</span>&nbsp;<span class="builtinfunc" id="5543264">len</span><span class="op" id="5543267">(</span><span class="ident" id="5543268">u</span><span class="op" id="5543269">)</span><span class="op" id="5543270">;</span>&nbsp;<span class="ident" id="5543272">k</span><span class="op" id="5543273">++</span>&nbsp;<span class="op" id="5543276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543280">if</span>&nbsp;<span class="ident" id="5543283">t</span><span class="op" id="5543284">[</span><span class="ident" id="5543285">k</span><span class="op" id="5543286">]</span>&nbsp;<span class="op" id="5543288">!=</span>&nbsp;<span class="ident" id="5543291">u</span><span class="op" id="5543292">[</span><span class="ident" id="5543293">k</span><span class="op" id="5543294">]</span>&nbsp;<span class="op" id="5543296">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543301">return</span>&nbsp;<span class="ident" id="5543308">t</span><span class="op" id="5543309">[</span><span class="ident" id="5543310">k</span><span class="op" id="5543311">]</span>&nbsp;<span class="op" id="5543313">&lt;</span>&nbsp;<span class="ident" id="5543315">u</span><span class="op" id="5543316">[</span><span class="ident" id="5543317">k</span><span class="op" id="5543318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543328">return</span>&nbsp;<span class="builtinfunc" id="5543335">len</span><span class="op" id="5543338">(</span><span class="ident" id="5543339">t</span><span class="op" id="5543340">)</span>&nbsp;<span class="op" id="5543342">&lt;</span>&nbsp;<span class="builtinfunc" id="5543344">len</span><span class="op" id="5543347">(</span><span class="ident" id="5543348">u</span><span class="op" id="5543349">)</span><br>
<span class="lineno"></span><span class="op" id="5543351">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5543354">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="5543421">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="5543485">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5543555">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="5543589">type</span>&nbsp;<span class="ident" id="5543594">countProfile</span>&nbsp;<span class="keyword" id="5543607">interface</span>&nbsp;<span class="op" id="5543617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543620">Len</span><span class="op" id="5543623">(</span><span class="op" id="5543624">)</span>&nbsp;<span class="builtintype" id="5543626">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543631">Stack</span><span class="op" id="5543636">(</span><span class="ident" id="5543637">i</span>&nbsp;<span class="builtintype" id="5543639">int</span><span class="op" id="5543642">)</span>&nbsp;<span class="op" id="5543644">[</span><span class="op" id="5543645">]</span><span class="builtintype" id="5543646">uintptr</span><br>
<span class="lineno"></span><span class="op" id="5543654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5543657">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="5543730">func</span>&nbsp;<span class="ident" id="5543735">printCountProfile</span><span class="op" id="5543752">(</span><span class="ident" id="5543753">w</span>&nbsp;<span class="ident" id="5543755">io</span><span class="op" id="5543757">.</span><span class="ident" id="5543758">Writer</span><span class="op" id="5543764">,</span>&nbsp;<span class="ident" id="5543766">debug</span>&nbsp;<span class="builtintype" id="5543772">int</span><span class="op" id="5543775">,</span>&nbsp;<span class="ident" id="5543777">name</span>&nbsp;<span class="builtintype" id="5543782">string</span><span class="op" id="5543788">,</span>&nbsp;<span class="ident" id="5543790">p</span>&nbsp;<span class="ident" id="5543792">countProfile</span><span class="op" id="5543804">)</span>&nbsp;<span class="builtintype" id="5543806">error</span>&nbsp;<span class="op" id="5543812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543815">b</span>&nbsp;<span class="op" id="5543817">:=</span>&nbsp;<span class="ident" id="5543820">bufio</span><span class="op" id="5543825">.</span><span class="ident" id="5543826">NewWriter</span><span class="op" id="5543835">(</span><span class="ident" id="5543836">w</span><span class="op" id="5543837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543840">var</span>&nbsp;<span class="ident" id="5543844">tw</span>&nbsp;<span class="op" id="5543847">*</span><span class="ident" id="5543848">tabwriter</span><span class="op" id="5543857">.</span><span class="ident" id="5543858">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543866">w</span>&nbsp;<span class="op" id="5543868">=</span>&nbsp;<span class="ident" id="5543870">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543873">if</span>&nbsp;<span class="ident" id="5543876">debug</span>&nbsp;<span class="op" id="5543882">&gt;</span>&nbsp;<span class="num" id="5543884">0</span>&nbsp;<span class="op" id="5543886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543890">tw</span>&nbsp;<span class="op" id="5543893">=</span>&nbsp;<span class="ident" id="5543895">tabwriter</span><span class="op" id="5543904">.</span><span class="ident" id="5543905">NewWriter</span><span class="op" id="5543914">(</span><span class="ident" id="5543915">w</span><span class="op" id="5543916">,</span>&nbsp;<span class="num" id="5543918">1</span><span class="op" id="5543919">,</span>&nbsp;<span class="num" id="5543921">8</span><span class="op" id="5543922">,</span>&nbsp;<span class="num" id="5543924">1</span><span class="op" id="5543925">,</span>&nbsp;<span class="string" id="5543927">&#39;\t&#39;</span><span class="op" id="5543931">,</span>&nbsp;<span class="num" id="5543933">0</span><span class="op" id="5543934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543938">w</span>&nbsp;<span class="op" id="5543940">=</span>&nbsp;<span class="ident" id="5543942">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543950">fmt</span><span class="op" id="5543953">.</span><span class="ident" id="5543954">Fprintf</span><span class="op" id="5543961">(</span><span class="ident" id="5543962">w</span><span class="op" id="5543963">,</span>&nbsp;<span class="string" id="5543965">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="5543989">,</span>&nbsp;<span class="ident" id="5543991">name</span><span class="op" id="5543995">,</span>&nbsp;<span class="ident" id="5543997">p</span><span class="op" id="5543998">.</span><span class="ident" id="5543999">Len</span><span class="op" id="5544002">(</span><span class="op" id="5544003">)</span><span class="op" id="5544004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544008">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544039">var</span>&nbsp;<span class="ident" id="5544043">buf</span>&nbsp;<span class="ident" id="5544047">bytes</span><span class="op" id="5544052">.</span><span class="ident" id="5544053">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544061">key</span>&nbsp;<span class="op" id="5544065">:=</span>&nbsp;<span class="keyword" id="5544068">func</span><span class="op" id="5544072">(</span><span class="ident" id="5544073">stk</span>&nbsp;<span class="op" id="5544077">[</span><span class="op" id="5544078">]</span><span class="builtintype" id="5544079">uintptr</span><span class="op" id="5544086">)</span>&nbsp;<span class="builtintype" id="5544088">string</span>&nbsp;<span class="op" id="5544095">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544099">buf</span><span class="op" id="5544102">.</span><span class="ident" id="5544103">Reset</span><span class="op" id="5544108">(</span><span class="op" id="5544109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544113">fmt</span><span class="op" id="5544116">.</span><span class="ident" id="5544117">Fprintf</span><span class="op" id="5544124">(</span><span class="op" id="5544125">&amp;</span><span class="ident" id="5544126">buf</span><span class="op" id="5544129">,</span>&nbsp;<span class="string" id="5544131">&#34;@&#34;</span><span class="op" id="5544134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544138">for</span>&nbsp;<span class="ident" id="5544142">_</span><span class="op" id="5544143">,</span>&nbsp;<span class="ident" id="5544145">pc</span>&nbsp;<span class="op" id="5544148">:=</span>&nbsp;<span class="keyword" id="5544151">range</span>&nbsp;<span class="ident" id="5544157">stk</span>&nbsp;<span class="op" id="5544161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544166">fmt</span><span class="op" id="5544169">.</span><span class="ident" id="5544170">Fprintf</span><span class="op" id="5544177">(</span><span class="op" id="5544178">&amp;</span><span class="ident" id="5544179">buf</span><span class="op" id="5544182">,</span>&nbsp;<span class="string" id="5544184">&#34;&nbsp;%#x&#34;</span><span class="op" id="5544190">,</span>&nbsp;<span class="ident" id="5544192">pc</span><span class="op" id="5544194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544198">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544202">return</span>&nbsp;<span class="ident" id="5544209">buf</span><span class="op" id="5544212">.</span><span class="ident" id="5544213">String</span><span class="op" id="5544219">(</span><span class="op" id="5544220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544226">m</span>&nbsp;<span class="op" id="5544228">:=</span>&nbsp;<span class="keyword" id="5544231">map</span><span class="op" id="5544234">[</span><span class="builtintype" id="5544235">string</span><span class="op" id="5544241">]</span><span class="builtintype" id="5544242">int</span><span class="op" id="5544245">{</span><span class="op" id="5544246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544249">n</span>&nbsp;<span class="op" id="5544251">:=</span>&nbsp;<span class="ident" id="5544254">p</span><span class="op" id="5544255">.</span><span class="ident" id="5544256">Len</span><span class="op" id="5544259">(</span><span class="op" id="5544260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544263">for</span>&nbsp;<span class="ident" id="5544267">i</span>&nbsp;<span class="op" id="5544269">:=</span>&nbsp;<span class="num" id="5544272">0</span><span class="op" id="5544273">;</span>&nbsp;<span class="ident" id="5544275">i</span>&nbsp;<span class="op" id="5544277">&lt;</span>&nbsp;<span class="ident" id="5544279">n</span><span class="op" id="5544280">;</span>&nbsp;<span class="ident" id="5544282">i</span><span class="op" id="5544283">++</span>&nbsp;<span class="op" id="5544286">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544290">m</span><span class="op" id="5544291">[</span><span class="ident" id="5544292">key</span><span class="op" id="5544295">(</span><span class="ident" id="5544296">p</span><span class="op" id="5544297">.</span><span class="ident" id="5544298">Stack</span><span class="op" id="5544303">(</span><span class="ident" id="5544304">i</span><span class="op" id="5544305">)</span><span class="op" id="5544306">)</span><span class="op" id="5544307">]</span><span class="op" id="5544308">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544316">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544387">for</span>&nbsp;<span class="ident" id="5544391">i</span>&nbsp;<span class="op" id="5544393">:=</span>&nbsp;<span class="num" id="5544396">0</span><span class="op" id="5544397">;</span>&nbsp;<span class="ident" id="5544399">i</span>&nbsp;<span class="op" id="5544401">&lt;</span>&nbsp;<span class="ident" id="5544403">n</span><span class="op" id="5544404">;</span>&nbsp;<span class="ident" id="5544406">i</span><span class="op" id="5544407">++</span>&nbsp;<span class="op" id="5544410">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544414">stk</span>&nbsp;<span class="op" id="5544418">:=</span>&nbsp;<span class="ident" id="5544421">p</span><span class="op" id="5544422">.</span><span class="ident" id="5544423">Stack</span><span class="op" id="5544428">(</span><span class="ident" id="5544429">i</span><span class="op" id="5544430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544434">s</span>&nbsp;<span class="op" id="5544436">:=</span>&nbsp;<span class="ident" id="5544439">key</span><span class="op" id="5544442">(</span><span class="ident" id="5544443">stk</span><span class="op" id="5544446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544450">if</span>&nbsp;<span class="ident" id="5544453">count</span>&nbsp;<span class="op" id="5544459">:=</span>&nbsp;<span class="ident" id="5544462">m</span><span class="op" id="5544463">[</span><span class="ident" id="5544464">s</span><span class="op" id="5544465">]</span><span class="op" id="5544466">;</span>&nbsp;<span class="ident" id="5544468">count</span>&nbsp;<span class="op" id="5544474">!=</span>&nbsp;<span class="num" id="5544477">0</span>&nbsp;<span class="op" id="5544479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544484">fmt</span><span class="op" id="5544487">.</span><span class="ident" id="5544488">Fprintf</span><span class="op" id="5544495">(</span><span class="ident" id="5544496">w</span><span class="op" id="5544497">,</span>&nbsp;<span class="string" id="5544499">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5544508">,</span>&nbsp;<span class="ident" id="5544510">count</span><span class="op" id="5544515">,</span>&nbsp;<span class="ident" id="5544517">s</span><span class="op" id="5544518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544523">if</span>&nbsp;<span class="ident" id="5544526">debug</span>&nbsp;<span class="op" id="5544532">&gt;</span>&nbsp;<span class="num" id="5544534">0</span>&nbsp;<span class="op" id="5544536">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544542">printStackRecord</span><span class="op" id="5544558">(</span><span class="ident" id="5544559">w</span><span class="op" id="5544560">,</span>&nbsp;<span class="ident" id="5544562">stk</span><span class="op" id="5544565">,</span>&nbsp;<span class="builtintype" id="5544567">false</span><span class="op" id="5544572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5544582">delete</span><span class="op" id="5544588">(</span><span class="ident" id="5544589">m</span><span class="op" id="5544590">,</span>&nbsp;<span class="ident" id="5544592">s</span><span class="op" id="5544593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544600">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544604">if</span>&nbsp;<span class="ident" id="5544607">tw</span>&nbsp;<span class="op" id="5544610">!=</span>&nbsp;<span class="ident" id="5544613">nil</span>&nbsp;<span class="op" id="5544617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544621">tw</span><span class="op" id="5544623">.</span><span class="ident" id="5544624">Flush</span><span class="op" id="5544629">(</span><span class="op" id="5544630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544636">return</span>&nbsp;<span class="ident" id="5544643">b</span><span class="op" id="5544644">.</span><span class="ident" id="5544645">Flush</span><span class="op" id="5544650">(</span><span class="op" id="5544651">)</span><br>
<span class="lineno">315</span><span class="op" id="5544653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5544656">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5544722">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="5544751">func</span>&nbsp;<span class="ident" id="5544756">printStackRecord</span><span class="op" id="5544772">(</span><span class="ident" id="5544773">w</span>&nbsp;<span class="ident" id="5544775">io</span><span class="op" id="5544777">.</span><span class="ident" id="5544778">Writer</span><span class="op" id="5544784">,</span>&nbsp;<span class="ident" id="5544786">stk</span>&nbsp;<span class="op" id="5544790">[</span><span class="op" id="5544791">]</span><span class="builtintype" id="5544792">uintptr</span><span class="op" id="5544799">,</span>&nbsp;<span class="ident" id="5544801">allFrames</span>&nbsp;<span class="builtintype" id="5544811">bool</span><span class="op" id="5544815">)</span>&nbsp;<span class="op" id="5544817">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544820">show</span>&nbsp;<span class="op" id="5544825">:=</span>&nbsp;<span class="ident" id="5544828">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544839">wasPanic</span>&nbsp;<span class="op" id="5544848">:=</span>&nbsp;<span class="builtintype" id="5544851">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544858">for</span>&nbsp;<span class="ident" id="5544862">i</span><span class="op" id="5544863">,</span>&nbsp;<span class="ident" id="5544865">pc</span>&nbsp;<span class="op" id="5544868">:=</span>&nbsp;<span class="keyword" id="5544871">range</span>&nbsp;<span class="ident" id="5544877">stk</span>&nbsp;<span class="op" id="5544881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544885">f</span>&nbsp;<span class="op" id="5544887">:=</span>&nbsp;<span class="ident" id="5544890">runtime</span><span class="op" id="5544897">.</span><span class="ident" id="5544898">FuncForPC</span><span class="op" id="5544907">(</span><span class="ident" id="5544908">pc</span><span class="op" id="5544910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544914">if</span>&nbsp;<span class="ident" id="5544917">f</span>&nbsp;<span class="op" id="5544919">==</span>&nbsp;<span class="ident" id="5544922">nil</span>&nbsp;<span class="op" id="5544926">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544931">show</span>&nbsp;<span class="op" id="5544936">=</span>&nbsp;<span class="builtintype" id="5544938">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544946">fmt</span><span class="op" id="5544949">.</span><span class="ident" id="5544950">Fprintf</span><span class="op" id="5544957">(</span><span class="ident" id="5544958">w</span><span class="op" id="5544959">,</span>&nbsp;<span class="string" id="5544961">&#34;#\t%#x\n&#34;</span><span class="op" id="5544971">,</span>&nbsp;<span class="ident" id="5544973">pc</span><span class="op" id="5544975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544980">wasPanic</span>&nbsp;<span class="op" id="5544989">=</span>&nbsp;<span class="builtintype" id="5544991">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544999">}</span>&nbsp;<span class="keyword" id="5545001">else</span>&nbsp;<span class="op" id="5545006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545011">tracepc</span>&nbsp;<span class="op" id="5545019">:=</span>&nbsp;<span class="ident" id="5545022">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545028">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545063">if</span>&nbsp;<span class="ident" id="5545066">i</span>&nbsp;<span class="op" id="5545068">&gt;</span>&nbsp;<span class="num" id="5545070">0</span>&nbsp;<span class="op" id="5545072">&amp;&amp;</span>&nbsp;<span class="ident" id="5545075">pc</span>&nbsp;<span class="op" id="5545078">&gt;</span>&nbsp;<span class="ident" id="5545080">f</span><span class="op" id="5545081">.</span><span class="ident" id="5545082">Entry</span><span class="op" id="5545087">(</span><span class="op" id="5545088">)</span>&nbsp;<span class="op" id="5545090">&amp;&amp;</span>&nbsp;<span class="op" id="5545093">!</span><span class="ident" id="5545094">wasPanic</span>&nbsp;<span class="op" id="5545103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545109">if</span>&nbsp;<span class="ident" id="5545112">runtime</span><span class="op" id="5545119">.</span><span class="ident" id="5545120">GOARCH</span>&nbsp;<span class="op" id="5545127">==</span>&nbsp;<span class="string" id="5545130">&#34;386&#34;</span>&nbsp;<span class="op" id="5545136">||</span>&nbsp;<span class="ident" id="5545139">runtime</span><span class="op" id="5545146">.</span><span class="ident" id="5545147">GOARCH</span>&nbsp;<span class="op" id="5545154">==</span>&nbsp;<span class="string" id="5545157">&#34;amd64&#34;</span>&nbsp;<span class="op" id="5545165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545172">tracepc</span><span class="op" id="5545179">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545186">}</span>&nbsp;<span class="keyword" id="5545188">else</span>&nbsp;<span class="op" id="5545193">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545200">tracepc</span>&nbsp;<span class="op" id="5545208">-=</span>&nbsp;<span class="num" id="5545211">4</span>&nbsp;<span class="comment" id="5545213">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545239">file</span><span class="op" id="5545243">,</span>&nbsp;<span class="ident" id="5545245">line</span>&nbsp;<span class="op" id="5545250">:=</span>&nbsp;<span class="ident" id="5545253">f</span><span class="op" id="5545254">.</span><span class="ident" id="5545255">FileLine</span><span class="op" id="5545263">(</span><span class="ident" id="5545264">tracepc</span><span class="op" id="5545271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545276">name</span>&nbsp;<span class="op" id="5545281">:=</span>&nbsp;<span class="ident" id="5545284">f</span><span class="op" id="5545285">.</span><span class="ident" id="5545286">Name</span><span class="op" id="5545290">(</span><span class="op" id="5545291">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545296">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545366">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545417">wasPanic</span>&nbsp;<span class="op" id="5545426">=</span>&nbsp;<span class="ident" id="5545428">name</span>&nbsp;<span class="op" id="5545433">==</span>&nbsp;<span class="string" id="5545436">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545455">if</span>&nbsp;<span class="ident" id="5545458">name</span>&nbsp;<span class="op" id="5545463">==</span>&nbsp;<span class="string" id="5545466">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="5545483">||</span>&nbsp;<span class="op" id="5545486">!</span><span class="ident" id="5545487">show</span>&nbsp;<span class="op" id="5545492">&amp;&amp;</span>&nbsp;<span class="ident" id="5545495">strings</span><span class="op" id="5545502">.</span><span class="ident" id="5545503">HasPrefix</span><span class="op" id="5545512">(</span><span class="ident" id="5545513">name</span><span class="op" id="5545517">,</span>&nbsp;<span class="string" id="5545519">&#34;runtime.&#34;</span><span class="op" id="5545529">)</span>&nbsp;<span class="op" id="5545531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545537">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545554">show</span>&nbsp;<span class="op" id="5545559">=</span>&nbsp;<span class="builtintype" id="5545561">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545569">fmt</span><span class="op" id="5545572">.</span><span class="ident" id="5545573">Fprintf</span><span class="op" id="5545580">(</span><span class="ident" id="5545581">w</span><span class="op" id="5545582">,</span>&nbsp;<span class="string" id="5545584">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="5545609">,</span>&nbsp;<span class="ident" id="5545611">pc</span><span class="op" id="5545613">,</span>&nbsp;<span class="ident" id="5545615">name</span><span class="op" id="5545619">,</span>&nbsp;<span class="ident" id="5545621">pc</span><span class="op" id="5545623">-</span><span class="ident" id="5545624">f</span><span class="op" id="5545625">.</span><span class="ident" id="5545626">Entry</span><span class="op" id="5545631">(</span><span class="op" id="5545632">)</span><span class="op" id="5545633">,</span>&nbsp;<span class="ident" id="5545635">file</span><span class="op" id="5545639">,</span>&nbsp;<span class="ident" id="5545641">line</span><span class="op" id="5545645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545652">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545655">if</span>&nbsp;<span class="op" id="5545658">!</span><span class="ident" id="5545659">show</span>&nbsp;<span class="op" id="5545664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545668">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545712">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545758">printStackRecord</span><span class="op" id="5545774">(</span><span class="ident" id="5545775">w</span><span class="op" id="5545776">,</span>&nbsp;<span class="ident" id="5545778">stk</span><span class="op" id="5545781">,</span>&nbsp;<span class="builtintype" id="5545783">true</span><span class="op" id="5545787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545791">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545802">fmt</span><span class="op" id="5545805">.</span><span class="ident" id="5545806">Fprintf</span><span class="op" id="5545813">(</span><span class="ident" id="5545814">w</span><span class="op" id="5545815">,</span>&nbsp;<span class="string" id="5545817">&#34;\n&#34;</span><span class="op" id="5545821">)</span><br>
<span class="lineno"></span><span class="op" id="5545823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5545826">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5545860">type</span>&nbsp;<span class="ident" id="5545865">byInUseBytes</span>&nbsp;<span class="op" id="5545878">[</span><span class="op" id="5545879">]</span><span class="ident" id="5545880">runtime</span><span class="op" id="5545887">.</span><span class="ident" id="5545888">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5545906">func</span>&nbsp;<span class="op" id="5545911">(</span><span class="ident" id="5545912">x</span>&nbsp;<span class="ident" id="5545914">byInUseBytes</span><span class="op" id="5545926">)</span>&nbsp;<span class="ident" id="5545928">Len</span><span class="op" id="5545931">(</span><span class="op" id="5545932">)</span>&nbsp;<span class="builtintype" id="5545934">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545948">{</span>&nbsp;<span class="keyword" id="5545950">return</span>&nbsp;<span class="builtinfunc" id="5545957">len</span><span class="op" id="5545960">(</span><span class="ident" id="5545961">x</span><span class="op" id="5545962">)</span>&nbsp;<span class="op" id="5545964">}</span><br>
<span class="lineno"></span><span class="keyword" id="5545966">func</span>&nbsp;<span class="op" id="5545971">(</span><span class="ident" id="5545972">x</span>&nbsp;<span class="ident" id="5545974">byInUseBytes</span><span class="op" id="5545986">)</span>&nbsp;<span class="ident" id="5545988">Swap</span><span class="op" id="5545992">(</span><span class="ident" id="5545993">i</span><span class="op" id="5545994">,</span>&nbsp;<span class="ident" id="5545996">j</span>&nbsp;<span class="builtintype" id="5545998">int</span><span class="op" id="5546001">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546008">{</span>&nbsp;<span class="ident" id="5546010">x</span><span class="op" id="5546011">[</span><span class="ident" id="5546012">i</span><span class="op" id="5546013">]</span><span class="op" id="5546014">,</span>&nbsp;<span class="ident" id="5546016">x</span><span class="op" id="5546017">[</span><span class="ident" id="5546018">j</span><span class="op" id="5546019">]</span>&nbsp;<span class="op" id="5546021">=</span>&nbsp;<span class="ident" id="5546023">x</span><span class="op" id="5546024">[</span><span class="ident" id="5546025">j</span><span class="op" id="5546026">]</span><span class="op" id="5546027">,</span>&nbsp;<span class="ident" id="5546029">x</span><span class="op" id="5546030">[</span><span class="ident" id="5546031">i</span><span class="op" id="5546032">]</span>&nbsp;<span class="op" id="5546034">}</span><br>
<span class="lineno">365</span><span class="keyword" id="5546036">func</span>&nbsp;<span class="op" id="5546041">(</span><span class="ident" id="5546042">x</span>&nbsp;<span class="ident" id="5546044">byInUseBytes</span><span class="op" id="5546056">)</span>&nbsp;<span class="ident" id="5546058">Less</span><span class="op" id="5546062">(</span><span class="ident" id="5546063">i</span><span class="op" id="5546064">,</span>&nbsp;<span class="ident" id="5546066">j</span>&nbsp;<span class="builtintype" id="5546068">int</span><span class="op" id="5546071">)</span>&nbsp;<span class="builtintype" id="5546073">bool</span>&nbsp;<span class="op" id="5546078">{</span>&nbsp;<span class="keyword" id="5546080">return</span>&nbsp;<span class="ident" id="5546087">x</span><span class="op" id="5546088">[</span><span class="ident" id="5546089">i</span><span class="op" id="5546090">]</span><span class="op" id="5546091">.</span><span class="ident" id="5546092">InUseBytes</span><span class="op" id="5546102">(</span><span class="op" id="5546103">)</span>&nbsp;<span class="op" id="5546105">&gt;</span>&nbsp;<span class="ident" id="5546107">x</span><span class="op" id="5546108">[</span><span class="ident" id="5546109">j</span><span class="op" id="5546110">]</span><span class="op" id="5546111">.</span><span class="ident" id="5546112">InUseBytes</span><span class="op" id="5546122">(</span><span class="op" id="5546123">)</span>&nbsp;<span class="op" id="5546125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546128">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="5546195">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="5546243">func</span>&nbsp;<span class="ident" id="5546248">WriteHeapProfile</span><span class="op" id="5546264">(</span><span class="ident" id="5546265">w</span>&nbsp;<span class="ident" id="5546267">io</span><span class="op" id="5546269">.</span><span class="ident" id="5546270">Writer</span><span class="op" id="5546276">)</span>&nbsp;<span class="builtintype" id="5546278">error</span>&nbsp;<span class="op" id="5546284">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546287">return</span>&nbsp;<span class="ident" id="5546294">writeHeap</span><span class="op" id="5546303">(</span><span class="ident" id="5546304">w</span><span class="op" id="5546305">,</span>&nbsp;<span class="num" id="5546307">0</span><span class="op" id="5546308">)</span><br>
<span class="lineno"></span><span class="op" id="5546310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546313">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5546377">func</span>&nbsp;<span class="ident" id="5546382">countHeap</span><span class="op" id="5546391">(</span><span class="op" id="5546392">)</span>&nbsp;<span class="builtintype" id="5546394">int</span>&nbsp;<span class="op" id="5546398">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546401">n</span><span class="op" id="5546402">,</span>&nbsp;<span class="ident" id="5546404">_</span>&nbsp;<span class="op" id="5546406">:=</span>&nbsp;<span class="ident" id="5546409">runtime</span><span class="op" id="5546416">.</span><span class="ident" id="5546417">MemProfile</span><span class="op" id="5546427">(</span><span class="ident" id="5546428">nil</span><span class="op" id="5546431">,</span>&nbsp;<span class="builtintype" id="5546433">true</span><span class="op" id="5546437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546440">return</span>&nbsp;<span class="ident" id="5546447">n</span><br>
<span class="lineno"></span><span class="op" id="5546449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546452">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="5546511">func</span>&nbsp;<span class="ident" id="5546516">writeHeap</span><span class="op" id="5546525">(</span><span class="ident" id="5546526">w</span>&nbsp;<span class="ident" id="5546528">io</span><span class="op" id="5546530">.</span><span class="ident" id="5546531">Writer</span><span class="op" id="5546537">,</span>&nbsp;<span class="ident" id="5546539">debug</span>&nbsp;<span class="builtintype" id="5546545">int</span><span class="op" id="5546548">)</span>&nbsp;<span class="builtintype" id="5546550">error</span>&nbsp;<span class="op" id="5546556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546559">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546624">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546674">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546731">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546794">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546840">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546907">var</span>&nbsp;<span class="ident" id="5546911">p</span>&nbsp;<span class="op" id="5546913">[</span><span class="op" id="5546914">]</span><span class="ident" id="5546915">runtime</span><span class="op" id="5546922">.</span><span class="ident" id="5546923">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546941">n</span><span class="op" id="5546942">,</span>&nbsp;<span class="ident" id="5546944">ok</span>&nbsp;<span class="op" id="5546947">:=</span>&nbsp;<span class="ident" id="5546950">runtime</span><span class="op" id="5546957">.</span><span class="ident" id="5546958">MemProfile</span><span class="op" id="5546968">(</span><span class="ident" id="5546969">nil</span><span class="op" id="5546972">,</span>&nbsp;<span class="builtintype" id="5546974">true</span><span class="op" id="5546978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546981">for</span>&nbsp;<span class="op" id="5546985">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546989">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547039">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547087">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547122">p</span>&nbsp;<span class="op" id="5547124">=</span>&nbsp;<span class="builtinfunc" id="5547126">make</span><span class="op" id="5547130">(</span><span class="op" id="5547131">[</span><span class="op" id="5547132">]</span><span class="ident" id="5547133">runtime</span><span class="op" id="5547140">.</span><span class="ident" id="5547141">MemProfileRecord</span><span class="op" id="5547157">,</span>&nbsp;<span class="ident" id="5547159">n</span><span class="op" id="5547160">+</span><span class="num" id="5547161">50</span><span class="op" id="5547163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547167">n</span><span class="op" id="5547168">,</span>&nbsp;<span class="ident" id="5547170">ok</span>&nbsp;<span class="op" id="5547173">=</span>&nbsp;<span class="ident" id="5547175">runtime</span><span class="op" id="5547182">.</span><span class="ident" id="5547183">MemProfile</span><span class="op" id="5547193">(</span><span class="ident" id="5547194">p</span><span class="op" id="5547195">,</span>&nbsp;<span class="builtintype" id="5547197">true</span><span class="op" id="5547201">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547205">if</span>&nbsp;<span class="ident" id="5547208">ok</span>&nbsp;<span class="op" id="5547211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547216">p</span>&nbsp;<span class="op" id="5547218">=</span>&nbsp;<span class="ident" id="5547220">p</span><span class="op" id="5547221">[</span><span class="num" id="5547222">0</span><span class="op" id="5547223">:</span><span class="ident" id="5547224">n</span><span class="op" id="5547225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547230">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547242">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547275">sort</span><span class="op" id="5547279">.</span><span class="ident" id="5547280">Sort</span><span class="op" id="5547284">(</span><span class="ident" id="5547285">byInUseBytes</span><span class="op" id="5547297">(</span><span class="ident" id="5547298">p</span><span class="op" id="5547299">)</span><span class="op" id="5547300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547304">b</span>&nbsp;<span class="op" id="5547306">:=</span>&nbsp;<span class="ident" id="5547309">bufio</span><span class="op" id="5547314">.</span><span class="ident" id="5547315">NewWriter</span><span class="op" id="5547324">(</span><span class="ident" id="5547325">w</span><span class="op" id="5547326">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547329">var</span>&nbsp;<span class="ident" id="5547333">tw</span>&nbsp;<span class="op" id="5547336">*</span><span class="ident" id="5547337">tabwriter</span><span class="op" id="5547346">.</span><span class="ident" id="5547347">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547355">w</span>&nbsp;<span class="op" id="5547357">=</span>&nbsp;<span class="ident" id="5547359">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547362">if</span>&nbsp;<span class="ident" id="5547365">debug</span>&nbsp;<span class="op" id="5547371">&gt;</span>&nbsp;<span class="num" id="5547373">0</span>&nbsp;<span class="op" id="5547375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547379">tw</span>&nbsp;<span class="op" id="5547382">=</span>&nbsp;<span class="ident" id="5547384">tabwriter</span><span class="op" id="5547393">.</span><span class="ident" id="5547394">NewWriter</span><span class="op" id="5547403">(</span><span class="ident" id="5547404">w</span><span class="op" id="5547405">,</span>&nbsp;<span class="num" id="5547407">1</span><span class="op" id="5547408">,</span>&nbsp;<span class="num" id="5547410">8</span><span class="op" id="5547411">,</span>&nbsp;<span class="num" id="5547413">1</span><span class="op" id="5547414">,</span>&nbsp;<span class="string" id="5547416">&#39;\t&#39;</span><span class="op" id="5547420">,</span>&nbsp;<span class="num" id="5547422">0</span><span class="op" id="5547423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547427">w</span>&nbsp;<span class="op" id="5547429">=</span>&nbsp;<span class="ident" id="5547431">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547439">var</span>&nbsp;<span class="ident" id="5547443">total</span>&nbsp;<span class="ident" id="5547449">runtime</span><span class="op" id="5547456">.</span><span class="ident" id="5547457">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547475">for</span>&nbsp;<span class="ident" id="5547479">i</span>&nbsp;<span class="op" id="5547481">:=</span>&nbsp;<span class="keyword" id="5547484">range</span>&nbsp;<span class="ident" id="5547490">p</span>&nbsp;<span class="op" id="5547492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547496">r</span>&nbsp;<span class="op" id="5547498">:=</span>&nbsp;<span class="op" id="5547501">&amp;</span><span class="ident" id="5547502">p</span><span class="op" id="5547503">[</span><span class="ident" id="5547504">i</span><span class="op" id="5547505">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547509">total</span><span class="op" id="5547514">.</span><span class="ident" id="5547515">AllocBytes</span>&nbsp;<span class="op" id="5547526">+=</span>&nbsp;<span class="ident" id="5547529">r</span><span class="op" id="5547530">.</span><span class="ident" id="5547531">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547544">total</span><span class="op" id="5547549">.</span><span class="ident" id="5547550">AllocObjects</span>&nbsp;<span class="op" id="5547563">+=</span>&nbsp;<span class="ident" id="5547566">r</span><span class="op" id="5547567">.</span><span class="ident" id="5547568">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547583">total</span><span class="op" id="5547588">.</span><span class="ident" id="5547589">FreeBytes</span>&nbsp;<span class="op" id="5547599">+=</span>&nbsp;<span class="ident" id="5547602">r</span><span class="op" id="5547603">.</span><span class="ident" id="5547604">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547616">total</span><span class="op" id="5547621">.</span><span class="ident" id="5547622">FreeObjects</span>&nbsp;<span class="op" id="5547634">+=</span>&nbsp;<span class="ident" id="5547637">r</span><span class="op" id="5547638">.</span><span class="ident" id="5547639">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547652">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547656">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547721">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5547796">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547841">fmt</span><span class="op" id="5547844">.</span><span class="ident" id="5547845">Fprintf</span><span class="op" id="5547852">(</span><span class="ident" id="5547853">w</span><span class="op" id="5547854">,</span>&nbsp;<span class="string" id="5547856">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="5547899">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547903">total</span><span class="op" id="5547908">.</span><span class="ident" id="5547909">InUseObjects</span><span class="op" id="5547921">(</span><span class="op" id="5547922">)</span><span class="op" id="5547923">,</span>&nbsp;<span class="ident" id="5547925">total</span><span class="op" id="5547930">.</span><span class="ident" id="5547931">InUseBytes</span><span class="op" id="5547941">(</span><span class="op" id="5547942">)</span><span class="op" id="5547943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547947">total</span><span class="op" id="5547952">.</span><span class="ident" id="5547953">AllocObjects</span><span class="op" id="5547965">,</span>&nbsp;<span class="ident" id="5547967">total</span><span class="op" id="5547972">.</span><span class="ident" id="5547973">AllocBytes</span><span class="op" id="5547983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5547987">2</span><span class="op" id="5547988">*</span><span class="ident" id="5547989">runtime</span><span class="op" id="5547996">.</span><span class="ident" id="5547997">MemProfileRate</span><span class="op" id="5548011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548015">for</span>&nbsp;<span class="ident" id="5548019">i</span>&nbsp;<span class="op" id="5548021">:=</span>&nbsp;<span class="keyword" id="5548024">range</span>&nbsp;<span class="ident" id="5548030">p</span>&nbsp;<span class="op" id="5548032">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548036">r</span>&nbsp;<span class="op" id="5548038">:=</span>&nbsp;<span class="op" id="5548041">&amp;</span><span class="ident" id="5548042">p</span><span class="op" id="5548043">[</span><span class="ident" id="5548044">i</span><span class="op" id="5548045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548049">fmt</span><span class="op" id="5548052">.</span><span class="ident" id="5548053">Fprintf</span><span class="op" id="5548060">(</span><span class="ident" id="5548061">w</span><span class="op" id="5548062">,</span>&nbsp;<span class="string" id="5548064">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="5548083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548088">r</span><span class="op" id="5548089">.</span><span class="ident" id="5548090">InUseObjects</span><span class="op" id="5548102">(</span><span class="op" id="5548103">)</span><span class="op" id="5548104">,</span>&nbsp;<span class="ident" id="5548106">r</span><span class="op" id="5548107">.</span><span class="ident" id="5548108">InUseBytes</span><span class="op" id="5548118">(</span><span class="op" id="5548119">)</span><span class="op" id="5548120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548125">r</span><span class="op" id="5548126">.</span><span class="ident" id="5548127">AllocObjects</span><span class="op" id="5548139">,</span>&nbsp;<span class="ident" id="5548141">r</span><span class="op" id="5548142">.</span><span class="ident" id="5548143">AllocBytes</span><span class="op" id="5548153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548157">for</span>&nbsp;<span class="ident" id="5548161">_</span><span class="op" id="5548162">,</span>&nbsp;<span class="ident" id="5548164">pc</span>&nbsp;<span class="op" id="5548167">:=</span>&nbsp;<span class="keyword" id="5548170">range</span>&nbsp;<span class="ident" id="5548176">r</span><span class="op" id="5548177">.</span><span class="ident" id="5548178">Stack</span><span class="op" id="5548183">(</span><span class="op" id="5548184">)</span>&nbsp;<span class="op" id="5548186">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548191">fmt</span><span class="op" id="5548194">.</span><span class="ident" id="5548195">Fprintf</span><span class="op" id="5548202">(</span><span class="ident" id="5548203">w</span><span class="op" id="5548204">,</span>&nbsp;<span class="string" id="5548206">&#34;&nbsp;%#x&#34;</span><span class="op" id="5548212">,</span>&nbsp;<span class="ident" id="5548214">pc</span><span class="op" id="5548216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548224">fmt</span><span class="op" id="5548227">.</span><span class="ident" id="5548228">Fprintf</span><span class="op" id="5548235">(</span><span class="ident" id="5548236">w</span><span class="op" id="5548237">,</span>&nbsp;<span class="string" id="5548239">&#34;\n&#34;</span><span class="op" id="5548243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548247">if</span>&nbsp;<span class="ident" id="5548250">debug</span>&nbsp;<span class="op" id="5548256">&gt;</span>&nbsp;<span class="num" id="5548258">0</span>&nbsp;<span class="op" id="5548260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548265">printStackRecord</span><span class="op" id="5548281">(</span><span class="ident" id="5548282">w</span><span class="op" id="5548283">,</span>&nbsp;<span class="ident" id="5548285">r</span><span class="op" id="5548286">.</span><span class="ident" id="5548287">Stack</span><span class="op" id="5548292">(</span><span class="op" id="5548293">)</span><span class="op" id="5548294">,</span>&nbsp;<span class="builtintype" id="5548296">false</span><span class="op" id="5548301">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548312">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548348">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548393">if</span>&nbsp;<span class="ident" id="5548396">debug</span>&nbsp;<span class="op" id="5548402">&gt;</span>&nbsp;<span class="num" id="5548404">0</span>&nbsp;<span class="op" id="5548406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548410">s</span>&nbsp;<span class="op" id="5548412">:=</span>&nbsp;<span class="builtinfunc" id="5548415">new</span><span class="op" id="5548418">(</span><span class="ident" id="5548419">runtime</span><span class="op" id="5548426">.</span><span class="ident" id="5548427">MemStats</span><span class="op" id="5548435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548439">runtime</span><span class="op" id="5548446">.</span><span class="ident" id="5548447">ReadMemStats</span><span class="op" id="5548459">(</span><span class="ident" id="5548460">s</span><span class="op" id="5548461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548465">fmt</span><span class="op" id="5548468">.</span><span class="ident" id="5548469">Fprintf</span><span class="op" id="5548476">(</span><span class="ident" id="5548477">w</span><span class="op" id="5548478">,</span>&nbsp;<span class="string" id="5548480">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="5548504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548508">fmt</span><span class="op" id="5548511">.</span><span class="ident" id="5548512">Fprintf</span><span class="op" id="5548519">(</span><span class="ident" id="5548520">w</span><span class="op" id="5548521">,</span>&nbsp;<span class="string" id="5548523">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548539">,</span>&nbsp;<span class="ident" id="5548541">s</span><span class="op" id="5548542">.</span><span class="ident" id="5548543">Alloc</span><span class="op" id="5548548">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548552">fmt</span><span class="op" id="5548555">.</span><span class="ident" id="5548556">Fprintf</span><span class="op" id="5548563">(</span><span class="ident" id="5548564">w</span><span class="op" id="5548565">,</span>&nbsp;<span class="string" id="5548567">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548588">,</span>&nbsp;<span class="ident" id="5548590">s</span><span class="op" id="5548591">.</span><span class="ident" id="5548592">TotalAlloc</span><span class="op" id="5548602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548606">fmt</span><span class="op" id="5548609">.</span><span class="ident" id="5548610">Fprintf</span><span class="op" id="5548617">(</span><span class="ident" id="5548618">w</span><span class="op" id="5548619">,</span>&nbsp;<span class="string" id="5548621">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548635">,</span>&nbsp;<span class="ident" id="5548637">s</span><span class="op" id="5548638">.</span><span class="ident" id="5548639">Sys</span><span class="op" id="5548642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548646">fmt</span><span class="op" id="5548649">.</span><span class="ident" id="5548650">Fprintf</span><span class="op" id="5548657">(</span><span class="ident" id="5548658">w</span><span class="op" id="5548659">,</span>&nbsp;<span class="string" id="5548661">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548679">,</span>&nbsp;<span class="ident" id="5548681">s</span><span class="op" id="5548682">.</span><span class="ident" id="5548683">Lookups</span><span class="op" id="5548690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548694">fmt</span><span class="op" id="5548697">.</span><span class="ident" id="5548698">Fprintf</span><span class="op" id="5548705">(</span><span class="ident" id="5548706">w</span><span class="op" id="5548707">,</span>&nbsp;<span class="string" id="5548709">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548727">,</span>&nbsp;<span class="ident" id="5548729">s</span><span class="op" id="5548730">.</span><span class="ident" id="5548731">Mallocs</span><span class="op" id="5548738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548742">fmt</span><span class="op" id="5548745">.</span><span class="ident" id="5548746">Fprintf</span><span class="op" id="5548753">(</span><span class="ident" id="5548754">w</span><span class="op" id="5548755">,</span>&nbsp;<span class="string" id="5548757">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548773">,</span>&nbsp;<span class="ident" id="5548775">s</span><span class="op" id="5548776">.</span><span class="ident" id="5548777">Frees</span><span class="op" id="5548782">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548787">fmt</span><span class="op" id="5548790">.</span><span class="ident" id="5548791">Fprintf</span><span class="op" id="5548798">(</span><span class="ident" id="5548799">w</span><span class="op" id="5548800">,</span>&nbsp;<span class="string" id="5548802">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548822">,</span>&nbsp;<span class="ident" id="5548824">s</span><span class="op" id="5548825">.</span><span class="ident" id="5548826">HeapAlloc</span><span class="op" id="5548835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548839">fmt</span><span class="op" id="5548842">.</span><span class="ident" id="5548843">Fprintf</span><span class="op" id="5548850">(</span><span class="ident" id="5548851">w</span><span class="op" id="5548852">,</span>&nbsp;<span class="string" id="5548854">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548872">,</span>&nbsp;<span class="ident" id="5548874">s</span><span class="op" id="5548875">.</span><span class="ident" id="5548876">HeapSys</span><span class="op" id="5548883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548887">fmt</span><span class="op" id="5548890">.</span><span class="ident" id="5548891">Fprintf</span><span class="op" id="5548898">(</span><span class="ident" id="5548899">w</span><span class="op" id="5548900">,</span>&nbsp;<span class="string" id="5548902">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548921">,</span>&nbsp;<span class="ident" id="5548923">s</span><span class="op" id="5548924">.</span><span class="ident" id="5548925">HeapIdle</span><span class="op" id="5548933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548937">fmt</span><span class="op" id="5548940">.</span><span class="ident" id="5548941">Fprintf</span><span class="op" id="5548948">(</span><span class="ident" id="5548949">w</span><span class="op" id="5548950">,</span>&nbsp;<span class="string" id="5548952">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5548972">,</span>&nbsp;<span class="ident" id="5548974">s</span><span class="op" id="5548975">.</span><span class="ident" id="5548976">HeapInuse</span><span class="op" id="5548985">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548989">fmt</span><span class="op" id="5548992">.</span><span class="ident" id="5548993">Fprintf</span><span class="op" id="5549000">(</span><span class="ident" id="5549001">w</span><span class="op" id="5549002">,</span>&nbsp;<span class="string" id="5549004">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549027">,</span>&nbsp;<span class="ident" id="5549029">s</span><span class="op" id="5549030">.</span><span class="ident" id="5549031">HeapReleased</span><span class="op" id="5549043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549047">fmt</span><span class="op" id="5549050">.</span><span class="ident" id="5549051">Fprintf</span><span class="op" id="5549058">(</span><span class="ident" id="5549059">w</span><span class="op" id="5549060">,</span>&nbsp;<span class="string" id="5549062">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549084">,</span>&nbsp;<span class="ident" id="5549086">s</span><span class="op" id="5549087">.</span><span class="ident" id="5549088">HeapObjects</span><span class="op" id="5549099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549104">fmt</span><span class="op" id="5549107">.</span><span class="ident" id="5549108">Fprintf</span><span class="op" id="5549115">(</span><span class="ident" id="5549116">w</span><span class="op" id="5549117">,</span>&nbsp;<span class="string" id="5549119">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="5549140">,</span>&nbsp;<span class="ident" id="5549142">s</span><span class="op" id="5549143">.</span><span class="ident" id="5549144">StackInuse</span><span class="op" id="5549154">,</span>&nbsp;<span class="ident" id="5549156">s</span><span class="op" id="5549157">.</span><span class="ident" id="5549158">StackSys</span><span class="op" id="5549166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549170">fmt</span><span class="op" id="5549173">.</span><span class="ident" id="5549174">Fprintf</span><span class="op" id="5549181">(</span><span class="ident" id="5549182">w</span><span class="op" id="5549183">,</span>&nbsp;<span class="string" id="5549185">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="5549206">,</span>&nbsp;<span class="ident" id="5549208">s</span><span class="op" id="5549209">.</span><span class="ident" id="5549210">MSpanInuse</span><span class="op" id="5549220">,</span>&nbsp;<span class="ident" id="5549222">s</span><span class="op" id="5549223">.</span><span class="ident" id="5549224">MSpanSys</span><span class="op" id="5549232">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549236">fmt</span><span class="op" id="5549239">.</span><span class="ident" id="5549240">Fprintf</span><span class="op" id="5549247">(</span><span class="ident" id="5549248">w</span><span class="op" id="5549249">,</span>&nbsp;<span class="string" id="5549251">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="5549273">,</span>&nbsp;<span class="ident" id="5549275">s</span><span class="op" id="5549276">.</span><span class="ident" id="5549277">MCacheInuse</span><span class="op" id="5549288">,</span>&nbsp;<span class="ident" id="5549290">s</span><span class="op" id="5549291">.</span><span class="ident" id="5549292">MCacheSys</span><span class="op" id="5549301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549305">fmt</span><span class="op" id="5549308">.</span><span class="ident" id="5549309">Fprintf</span><span class="op" id="5549316">(</span><span class="ident" id="5549317">w</span><span class="op" id="5549318">,</span>&nbsp;<span class="string" id="5549320">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549342">,</span>&nbsp;<span class="ident" id="5549344">s</span><span class="op" id="5549345">.</span><span class="ident" id="5549346">BuckHashSys</span><span class="op" id="5549357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549362">fmt</span><span class="op" id="5549365">.</span><span class="ident" id="5549366">Fprintf</span><span class="op" id="5549373">(</span><span class="ident" id="5549374">w</span><span class="op" id="5549375">,</span>&nbsp;<span class="string" id="5549377">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549394">,</span>&nbsp;<span class="ident" id="5549396">s</span><span class="op" id="5549397">.</span><span class="ident" id="5549398">NextGC</span><span class="op" id="5549404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549408">fmt</span><span class="op" id="5549411">.</span><span class="ident" id="5549412">Fprintf</span><span class="op" id="5549419">(</span><span class="ident" id="5549420">w</span><span class="op" id="5549421">,</span>&nbsp;<span class="string" id="5549423">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549441">,</span>&nbsp;<span class="ident" id="5549443">s</span><span class="op" id="5549444">.</span><span class="ident" id="5549445">PauseNs</span><span class="op" id="5549452">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549456">fmt</span><span class="op" id="5549459">.</span><span class="ident" id="5549460">Fprintf</span><span class="op" id="5549467">(</span><span class="ident" id="5549468">w</span><span class="op" id="5549469">,</span>&nbsp;<span class="string" id="5549471">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="5549487">,</span>&nbsp;<span class="ident" id="5549489">s</span><span class="op" id="5549490">.</span><span class="ident" id="5549491">NumGC</span><span class="op" id="5549496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549500">fmt</span><span class="op" id="5549503">.</span><span class="ident" id="5549504">Fprintf</span><span class="op" id="5549511">(</span><span class="ident" id="5549512">w</span><span class="op" id="5549513">,</span>&nbsp;<span class="string" id="5549515">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="5549534">,</span>&nbsp;<span class="ident" id="5549536">s</span><span class="op" id="5549537">.</span><span class="ident" id="5549538">EnableGC</span><span class="op" id="5549546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549550">fmt</span><span class="op" id="5549553">.</span><span class="ident" id="5549554">Fprintf</span><span class="op" id="5549561">(</span><span class="ident" id="5549562">w</span><span class="op" id="5549563">,</span>&nbsp;<span class="string" id="5549565">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="5549583">,</span>&nbsp;<span class="ident" id="5549585">s</span><span class="op" id="5549586">.</span><span class="ident" id="5549587">DebugGC</span><span class="op" id="5549594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549601">if</span>&nbsp;<span class="ident" id="5549604">tw</span>&nbsp;<span class="op" id="5549607">!=</span>&nbsp;<span class="ident" id="5549610">nil</span>&nbsp;<span class="op" id="5549614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549618">tw</span><span class="op" id="5549620">.</span><span class="ident" id="5549621">Flush</span><span class="op" id="5549626">(</span><span class="op" id="5549627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549633">return</span>&nbsp;<span class="ident" id="5549640">b</span><span class="op" id="5549641">.</span><span class="ident" id="5549642">Flush</span><span class="op" id="5549647">(</span><span class="op" id="5549648">)</span><br>
<span class="lineno"></span><span class="op" id="5549650">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5549653">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="5549727">func</span>&nbsp;<span class="ident" id="5549732">countThreadCreate</span><span class="op" id="5549749">(</span><span class="op" id="5549750">)</span>&nbsp;<span class="builtintype" id="5549752">int</span>&nbsp;<span class="op" id="5549756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549759">n</span><span class="op" id="5549760">,</span>&nbsp;<span class="ident" id="5549762">_</span>&nbsp;<span class="op" id="5549764">:=</span>&nbsp;<span class="ident" id="5549767">runtime</span><span class="op" id="5549774">.</span><span class="ident" id="5549775">ThreadCreateProfile</span><span class="op" id="5549794">(</span><span class="ident" id="5549795">nil</span><span class="op" id="5549798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549801">return</span>&nbsp;<span class="ident" id="5549808">n</span><br>
<span class="lineno">485</span><span class="op" id="5549810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549813">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5549887">func</span>&nbsp;<span class="ident" id="5549892">writeThreadCreate</span><span class="op" id="5549909">(</span><span class="ident" id="5549910">w</span>&nbsp;<span class="ident" id="5549912">io</span><span class="op" id="5549914">.</span><span class="ident" id="5549915">Writer</span><span class="op" id="5549921">,</span>&nbsp;<span class="ident" id="5549923">debug</span>&nbsp;<span class="builtintype" id="5549929">int</span><span class="op" id="5549932">)</span>&nbsp;<span class="builtintype" id="5549934">error</span>&nbsp;<span class="op" id="5549940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549943">return</span>&nbsp;<span class="ident" id="5549950">writeRuntimeProfile</span><span class="op" id="5549969">(</span><span class="ident" id="5549970">w</span><span class="op" id="5549971">,</span>&nbsp;<span class="ident" id="5549973">debug</span><span class="op" id="5549978">,</span>&nbsp;<span class="string" id="5549980">&#34;threadcreate&#34;</span><span class="op" id="5549994">,</span>&nbsp;<span class="ident" id="5549996">runtime</span><span class="op" id="5550003">.</span><span class="ident" id="5550004">ThreadCreateProfile</span><span class="op" id="5550023">)</span><br>
<span class="lineno">490</span><span class="op" id="5550025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5550028">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5550080">func</span>&nbsp;<span class="ident" id="5550085">countGoroutine</span><span class="op" id="5550099">(</span><span class="op" id="5550100">)</span>&nbsp;<span class="builtintype" id="5550102">int</span>&nbsp;<span class="op" id="5550106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550109">return</span>&nbsp;<span class="ident" id="5550116">runtime</span><span class="op" id="5550123">.</span><span class="ident" id="5550124">NumGoroutine</span><span class="op" id="5550136">(</span><span class="op" id="5550137">)</span><br>
<span class="lineno">495</span><span class="op" id="5550139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5550142">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5550210">func</span>&nbsp;<span class="ident" id="5550215">writeGoroutine</span><span class="op" id="5550229">(</span><span class="ident" id="5550230">w</span>&nbsp;<span class="ident" id="5550232">io</span><span class="op" id="5550234">.</span><span class="ident" id="5550235">Writer</span><span class="op" id="5550241">,</span>&nbsp;<span class="ident" id="5550243">debug</span>&nbsp;<span class="builtintype" id="5550249">int</span><span class="op" id="5550252">)</span>&nbsp;<span class="builtintype" id="5550254">error</span>&nbsp;<span class="op" id="5550260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550263">if</span>&nbsp;<span class="ident" id="5550266">debug</span>&nbsp;<span class="op" id="5550272">&gt;=</span>&nbsp;<span class="num" id="5550275">2</span>&nbsp;<span class="op" id="5550277">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550281">return</span>&nbsp;<span class="ident" id="5550288">writeGoroutineStacks</span><span class="op" id="5550308">(</span><span class="ident" id="5550309">w</span><span class="op" id="5550310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550316">return</span>&nbsp;<span class="ident" id="5550323">writeRuntimeProfile</span><span class="op" id="5550342">(</span><span class="ident" id="5550343">w</span><span class="op" id="5550344">,</span>&nbsp;<span class="ident" id="5550346">debug</span><span class="op" id="5550351">,</span>&nbsp;<span class="string" id="5550353">&#34;goroutine&#34;</span><span class="op" id="5550364">,</span>&nbsp;<span class="ident" id="5550366">runtime</span><span class="op" id="5550373">.</span><span class="ident" id="5550374">GoroutineProfile</span><span class="op" id="5550390">)</span><br>
<span class="lineno"></span><span class="op" id="5550392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="5550395">func</span>&nbsp;<span class="ident" id="5550400">writeGoroutineStacks</span><span class="op" id="5550420">(</span><span class="ident" id="5550421">w</span>&nbsp;<span class="ident" id="5550423">io</span><span class="op" id="5550425">.</span><span class="ident" id="5550426">Writer</span><span class="op" id="5550432">)</span>&nbsp;<span class="builtintype" id="5550434">error</span>&nbsp;<span class="op" id="5550440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550443">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550503">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550585">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550647">buf</span>&nbsp;<span class="op" id="5550651">:=</span>&nbsp;<span class="builtinfunc" id="5550654">make</span><span class="op" id="5550658">(</span><span class="op" id="5550659">[</span><span class="op" id="5550660">]</span><span class="builtintype" id="5550661">byte</span><span class="op" id="5550665">,</span>&nbsp;<span class="num" id="5550667">1</span><span class="op" id="5550668">&lt;&lt;</span><span class="num" id="5550670">20</span><span class="op" id="5550672">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550675">for</span>&nbsp;<span class="ident" id="5550679">i</span>&nbsp;<span class="op" id="5550681">:=</span>&nbsp;<span class="num" id="5550684">0</span><span class="op" id="5550685">;</span>&nbsp;<span class="op" id="5550687">;</span>&nbsp;<span class="ident" id="5550689">i</span><span class="op" id="5550690">++</span>&nbsp;<span class="op" id="5550693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550697">n</span>&nbsp;<span class="op" id="5550699">:=</span>&nbsp;<span class="ident" id="5550702">runtime</span><span class="op" id="5550709">.</span><span class="ident" id="5550710">Stack</span><span class="op" id="5550715">(</span><span class="ident" id="5550716">buf</span><span class="op" id="5550719">,</span>&nbsp;<span class="builtintype" id="5550721">true</span><span class="op" id="5550725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550729">if</span>&nbsp;<span class="ident" id="5550732">n</span>&nbsp;<span class="op" id="5550734">&lt;</span>&nbsp;<span class="builtinfunc" id="5550736">len</span><span class="op" id="5550739">(</span><span class="ident" id="5550740">buf</span><span class="op" id="5550743">)</span>&nbsp;<span class="op" id="5550745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550750">buf</span>&nbsp;<span class="op" id="5550754">=</span>&nbsp;<span class="ident" id="5550756">buf</span><span class="op" id="5550759">[</span><span class="op" id="5550760">:</span><span class="ident" id="5550761">n</span><span class="op" id="5550762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550767">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550779">if</span>&nbsp;<span class="builtinfunc" id="5550782">len</span><span class="op" id="5550785">(</span><span class="ident" id="5550786">buf</span><span class="op" id="5550789">)</span>&nbsp;<span class="op" id="5550791">&gt;=</span>&nbsp;<span class="num" id="5550794">64</span><span class="op" id="5550796">&lt;&lt;</span><span class="num" id="5550798">20</span>&nbsp;<span class="op" id="5550801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550806">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550839">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550847">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550851">buf</span>&nbsp;<span class="op" id="5550855">=</span>&nbsp;<span class="builtinfunc" id="5550857">make</span><span class="op" id="5550861">(</span><span class="op" id="5550862">[</span><span class="op" id="5550863">]</span><span class="builtintype" id="5550864">byte</span><span class="op" id="5550868">,</span>&nbsp;<span class="num" id="5550870">2</span><span class="op" id="5550871">*</span><span class="builtinfunc" id="5550872">len</span><span class="op" id="5550875">(</span><span class="ident" id="5550876">buf</span><span class="op" id="5550879">)</span><span class="op" id="5550880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550886">_</span><span class="op" id="5550887">,</span>&nbsp;<span class="ident" id="5550889">err</span>&nbsp;<span class="op" id="5550893">:=</span>&nbsp;<span class="ident" id="5550896">w</span><span class="op" id="5550897">.</span><span class="ident" id="5550898">Write</span><span class="op" id="5550903">(</span><span class="ident" id="5550904">buf</span><span class="op" id="5550907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550910">return</span>&nbsp;<span class="ident" id="5550917">err</span><br>
<span class="lineno"></span><span class="op" id="5550921">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="5550924">func</span>&nbsp;<span class="ident" id="5550929">writeRuntimeProfile</span><span class="op" id="5550948">(</span><span class="ident" id="5550949">w</span>&nbsp;<span class="ident" id="5550951">io</span><span class="op" id="5550953">.</span><span class="ident" id="5550954">Writer</span><span class="op" id="5550960">,</span>&nbsp;<span class="ident" id="5550962">debug</span>&nbsp;<span class="builtintype" id="5550968">int</span><span class="op" id="5550971">,</span>&nbsp;<span class="ident" id="5550973">name</span>&nbsp;<span class="builtintype" id="5550978">string</span><span class="op" id="5550984">,</span>&nbsp;<span class="ident" id="5550986">fetch</span>&nbsp;<span class="keyword" id="5550992">func</span><span class="op" id="5550996">(</span><span class="op" id="5550997">[</span><span class="op" id="5550998">]</span><span class="ident" id="5550999">runtime</span><span class="op" id="5551006">.</span><span class="ident" id="5551007">StackRecord</span><span class="op" id="5551018">)</span>&nbsp;<span class="op" id="5551020">(</span><span class="builtintype" id="5551021">int</span><span class="op" id="5551024">,</span>&nbsp;<span class="builtintype" id="5551026">bool</span><span class="op" id="5551030">)</span><span class="op" id="5551031">)</span>&nbsp;<span class="builtintype" id="5551033">error</span>&nbsp;<span class="op" id="5551039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551042">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551096">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551146">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551203">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551266">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551312">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551379">var</span>&nbsp;<span class="ident" id="5551383">p</span>&nbsp;<span class="op" id="5551385">[</span><span class="op" id="5551386">]</span><span class="ident" id="5551387">runtime</span><span class="op" id="5551394">.</span><span class="ident" id="5551395">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551408">n</span><span class="op" id="5551409">,</span>&nbsp;<span class="ident" id="5551411">ok</span>&nbsp;<span class="op" id="5551414">:=</span>&nbsp;<span class="ident" id="5551417">fetch</span><span class="op" id="5551422">(</span><span class="ident" id="5551423">nil</span><span class="op" id="5551426">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551429">for</span>&nbsp;<span class="op" id="5551433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551437">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551487">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551535">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551573">p</span>&nbsp;<span class="op" id="5551575">=</span>&nbsp;<span class="builtinfunc" id="5551577">make</span><span class="op" id="5551581">(</span><span class="op" id="5551582">[</span><span class="op" id="5551583">]</span><span class="ident" id="5551584">runtime</span><span class="op" id="5551591">.</span><span class="ident" id="5551592">StackRecord</span><span class="op" id="5551603">,</span>&nbsp;<span class="ident" id="5551605">n</span><span class="op" id="5551606">+</span><span class="num" id="5551607">10</span><span class="op" id="5551609">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551613">n</span><span class="op" id="5551614">,</span>&nbsp;<span class="ident" id="5551616">ok</span>&nbsp;<span class="op" id="5551619">=</span>&nbsp;<span class="ident" id="5551621">fetch</span><span class="op" id="5551626">(</span><span class="ident" id="5551627">p</span><span class="op" id="5551628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551632">if</span>&nbsp;<span class="ident" id="5551635">ok</span>&nbsp;<span class="op" id="5551638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551643">p</span>&nbsp;<span class="op" id="5551645">=</span>&nbsp;<span class="ident" id="5551647">p</span><span class="op" id="5551648">[</span><span class="num" id="5551649">0</span><span class="op" id="5551650">:</span><span class="ident" id="5551651">n</span><span class="op" id="5551652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551657">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551665">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551669">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551702">return</span>&nbsp;<span class="ident" id="5551709">printCountProfile</span><span class="op" id="5551726">(</span><span class="ident" id="5551727">w</span><span class="op" id="5551728">,</span>&nbsp;<span class="ident" id="5551730">debug</span><span class="op" id="5551735">,</span>&nbsp;<span class="ident" id="5551737">name</span><span class="op" id="5551741">,</span>&nbsp;<span class="ident" id="5551743">runtimeProfile</span><span class="op" id="5551757">(</span><span class="ident" id="5551758">p</span><span class="op" id="5551759">)</span><span class="op" id="5551760">)</span><br>
<span class="lineno"></span><span class="op" id="5551762">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="5551765">type</span>&nbsp;<span class="ident" id="5551770">runtimeProfile</span>&nbsp;<span class="op" id="5551785">[</span><span class="op" id="5551786">]</span><span class="ident" id="5551787">runtime</span><span class="op" id="5551794">.</span><span class="ident" id="5551795">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5551808">func</span>&nbsp;<span class="op" id="5551813">(</span><span class="ident" id="5551814">p</span>&nbsp;<span class="ident" id="5551816">runtimeProfile</span><span class="op" id="5551830">)</span>&nbsp;<span class="ident" id="5551832">Len</span><span class="op" id="5551835">(</span><span class="op" id="5551836">)</span>&nbsp;<span class="builtintype" id="5551838">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551855">{</span>&nbsp;<span class="keyword" id="5551857">return</span>&nbsp;<span class="builtinfunc" id="5551864">len</span><span class="op" id="5551867">(</span><span class="ident" id="5551868">p</span><span class="op" id="5551869">)</span>&nbsp;<span class="op" id="5551871">}</span><br>
<span class="lineno"></span><span class="keyword" id="5551873">func</span>&nbsp;<span class="op" id="5551878">(</span><span class="ident" id="5551879">p</span>&nbsp;<span class="ident" id="5551881">runtimeProfile</span><span class="op" id="5551895">)</span>&nbsp;<span class="ident" id="5551897">Stack</span><span class="op" id="5551902">(</span><span class="ident" id="5551903">i</span>&nbsp;<span class="builtintype" id="5551905">int</span><span class="op" id="5551908">)</span>&nbsp;<span class="op" id="5551910">[</span><span class="op" id="5551911">]</span><span class="builtintype" id="5551912">uintptr</span>&nbsp;<span class="op" id="5551920">{</span>&nbsp;<span class="keyword" id="5551922">return</span>&nbsp;<span class="ident" id="5551929">p</span><span class="op" id="5551930">[</span><span class="ident" id="5551931">i</span><span class="op" id="5551932">]</span><span class="op" id="5551933">.</span><span class="ident" id="5551934">Stack</span><span class="op" id="5551939">(</span><span class="op" id="5551940">)</span>&nbsp;<span class="op" id="5551942">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="5551945">var</span>&nbsp;<span class="ident" id="5551949">cpu</span>&nbsp;<span class="keyword" id="5551953">struct</span>&nbsp;<span class="op" id="5551960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551963">sync</span><span class="op" id="5551967">.</span><span class="ident" id="5551968">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551975">profiling</span>&nbsp;<span class="builtintype" id="5551985">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551991">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552001">chan</span>&nbsp;<span class="builtintype" id="5552006">bool</span><br>
<span class="lineno">560</span><span class="op" id="5552011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5552014">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="5552080">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5552147">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="5552216">func</span>&nbsp;<span class="ident" id="5552221">StartCPUProfile</span><span class="op" id="5552236">(</span><span class="ident" id="5552237">w</span>&nbsp;<span class="ident" id="5552239">io</span><span class="op" id="5552241">.</span><span class="ident" id="5552242">Writer</span><span class="op" id="5552248">)</span>&nbsp;<span class="builtintype" id="5552250">error</span>&nbsp;<span class="op" id="5552256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552259">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552317">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552378">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552435">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552493">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552553">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552610">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552665">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552725">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552784">const</span>&nbsp;<span class="ident" id="5552790">hz</span>&nbsp;<span class="op" id="5552793">=</span>&nbsp;<span class="num" id="5552795">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552801">cpu</span><span class="op" id="5552804">.</span><span class="ident" id="5552805">Lock</span><span class="op" id="5552809">(</span><span class="op" id="5552810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552813">defer</span>&nbsp;<span class="ident" id="5552819">cpu</span><span class="op" id="5552822">.</span><span class="ident" id="5552823">Unlock</span><span class="op" id="5552829">(</span><span class="op" id="5552830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552833">if</span>&nbsp;<span class="ident" id="5552836">cpu</span><span class="op" id="5552839">.</span><span class="ident" id="5552840">done</span>&nbsp;<span class="op" id="5552845">==</span>&nbsp;<span class="ident" id="5552848">nil</span>&nbsp;<span class="op" id="5552852">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552856">cpu</span><span class="op" id="5552859">.</span><span class="ident" id="5552860">done</span>&nbsp;<span class="op" id="5552865">=</span>&nbsp;<span class="builtinfunc" id="5552867">make</span><span class="op" id="5552871">(</span><span class="keyword" id="5552872">chan</span>&nbsp;<span class="builtintype" id="5552877">bool</span><span class="op" id="5552881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552887">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552905">if</span>&nbsp;<span class="ident" id="5552908">cpu</span><span class="op" id="5552911">.</span><span class="ident" id="5552912">profiling</span>&nbsp;<span class="op" id="5552922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552926">return</span>&nbsp;<span class="ident" id="5552933">fmt</span><span class="op" id="5552936">.</span><span class="ident" id="5552937">Errorf</span><span class="op" id="5552943">(</span><span class="string" id="5552944">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="5552974">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552980">cpu</span><span class="op" id="5552983">.</span><span class="ident" id="5552984">profiling</span>&nbsp;<span class="op" id="5552994">=</span>&nbsp;<span class="builtintype" id="5552996">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553002">runtime</span><span class="op" id="5553009">.</span><span class="ident" id="5553010">SetCPUProfileRate</span><span class="op" id="5553027">(</span><span class="ident" id="5553028">hz</span><span class="op" id="5553030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553033">go</span>&nbsp;<span class="ident" id="5553036">profileWriter</span><span class="op" id="5553049">(</span><span class="ident" id="5553050">w</span><span class="op" id="5553051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553054">return</span>&nbsp;<span class="ident" id="5553061">nil</span><br>
<span class="lineno">590</span><span class="op" id="5553065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5553068">func</span>&nbsp;<span class="ident" id="5553073">profileWriter</span><span class="op" id="5553086">(</span><span class="ident" id="5553087">w</span>&nbsp;<span class="ident" id="5553089">io</span><span class="op" id="5553091">.</span><span class="ident" id="5553092">Writer</span><span class="op" id="5553098">)</span>&nbsp;<span class="op" id="5553100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553103">for</span>&nbsp;<span class="op" id="5553107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553111">data</span>&nbsp;<span class="op" id="5553116">:=</span>&nbsp;<span class="ident" id="5553119">runtime</span><span class="op" id="5553126">.</span><span class="ident" id="5553127">CPUProfile</span><span class="op" id="5553137">(</span><span class="op" id="5553138">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553142">if</span>&nbsp;<span class="ident" id="5553145">data</span>&nbsp;<span class="op" id="5553150">==</span>&nbsp;<span class="ident" id="5553153">nil</span>&nbsp;<span class="op" id="5553157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553162">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553174">w</span><span class="op" id="5553175">.</span><span class="ident" id="5553176">Write</span><span class="op" id="5553181">(</span><span class="ident" id="5553182">data</span><span class="op" id="5553186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553189">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553192">cpu</span><span class="op" id="5553195">.</span><span class="ident" id="5553196">done</span>&nbsp;<span class="op" id="5553201">&lt;-</span>&nbsp;<span class="builtintype" id="5553204">true</span><br>
<span class="lineno"></span><span class="op" id="5553209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5553212">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="5553269">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="5553329">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="5553356">func</span>&nbsp;<span class="ident" id="5553361">StopCPUProfile</span><span class="op" id="5553375">(</span><span class="op" id="5553376">)</span>&nbsp;<span class="op" id="5553378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553381">cpu</span><span class="op" id="5553384">.</span><span class="ident" id="5553385">Lock</span><span class="op" id="5553389">(</span><span class="op" id="5553390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553393">defer</span>&nbsp;<span class="ident" id="5553399">cpu</span><span class="op" id="5553402">.</span><span class="ident" id="5553403">Unlock</span><span class="op" id="5553409">(</span><span class="op" id="5553410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553414">if</span>&nbsp;<span class="op" id="5553417">!</span><span class="ident" id="5553418">cpu</span><span class="op" id="5553421">.</span><span class="ident" id="5553422">profiling</span>&nbsp;<span class="op" id="5553432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553436">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553447">cpu</span><span class="op" id="5553450">.</span><span class="ident" id="5553451">profiling</span>&nbsp;<span class="op" id="5553461">=</span>&nbsp;<span class="builtintype" id="5553463">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553470">runtime</span><span class="op" id="5553477">.</span><span class="ident" id="5553478">SetCPUProfileRate</span><span class="op" id="5553495">(</span><span class="num" id="5553496">0</span><span class="op" id="5553497">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5553500">&lt;-</span><span class="ident" id="5553502">cpu</span><span class="op" id="5553505">.</span><span class="ident" id="5553506">done</span><br>
<span class="lineno"></span><span class="op" id="5553511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5553514">type</span>&nbsp;<span class="ident" id="5553519">byCycles</span>&nbsp;<span class="op" id="5553528">[</span><span class="op" id="5553529">]</span><span class="ident" id="5553530">runtime</span><span class="op" id="5553537">.</span><span class="ident" id="5553538">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="5553558">func</span>&nbsp;<span class="op" id="5553563">(</span><span class="ident" id="5553564">x</span>&nbsp;<span class="ident" id="5553566">byCycles</span><span class="op" id="5553574">)</span>&nbsp;<span class="ident" id="5553576">Len</span><span class="op" id="5553579">(</span><span class="op" id="5553580">)</span>&nbsp;<span class="builtintype" id="5553582">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553596">{</span>&nbsp;<span class="keyword" id="5553598">return</span>&nbsp;<span class="builtinfunc" id="5553605">len</span><span class="op" id="5553608">(</span><span class="ident" id="5553609">x</span><span class="op" id="5553610">)</span>&nbsp;<span class="op" id="5553612">}</span><br>
<span class="lineno"></span><span class="keyword" id="5553614">func</span>&nbsp;<span class="op" id="5553619">(</span><span class="ident" id="5553620">x</span>&nbsp;<span class="ident" id="5553622">byCycles</span><span class="op" id="5553630">)</span>&nbsp;<span class="ident" id="5553632">Swap</span><span class="op" id="5553636">(</span><span class="ident" id="5553637">i</span><span class="op" id="5553638">,</span>&nbsp;<span class="ident" id="5553640">j</span>&nbsp;<span class="builtintype" id="5553642">int</span><span class="op" id="5553645">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553652">{</span>&nbsp;<span class="ident" id="5553654">x</span><span class="op" id="5553655">[</span><span class="ident" id="5553656">i</span><span class="op" id="5553657">]</span><span class="op" id="5553658">,</span>&nbsp;<span class="ident" id="5553660">x</span><span class="op" id="5553661">[</span><span class="ident" id="5553662">j</span><span class="op" id="5553663">]</span>&nbsp;<span class="op" id="5553665">=</span>&nbsp;<span class="ident" id="5553667">x</span><span class="op" id="5553668">[</span><span class="ident" id="5553669">j</span><span class="op" id="5553670">]</span><span class="op" id="5553671">,</span>&nbsp;<span class="ident" id="5553673">x</span><span class="op" id="5553674">[</span><span class="ident" id="5553675">i</span><span class="op" id="5553676">]</span>&nbsp;<span class="op" id="5553678">}</span><br>
<span class="lineno"></span><span class="keyword" id="5553680">func</span>&nbsp;<span class="op" id="5553685">(</span><span class="ident" id="5553686">x</span>&nbsp;<span class="ident" id="5553688">byCycles</span><span class="op" id="5553696">)</span>&nbsp;<span class="ident" id="5553698">Less</span><span class="op" id="5553702">(</span><span class="ident" id="5553703">i</span><span class="op" id="5553704">,</span>&nbsp;<span class="ident" id="5553706">j</span>&nbsp;<span class="builtintype" id="5553708">int</span><span class="op" id="5553711">)</span>&nbsp;<span class="builtintype" id="5553713">bool</span>&nbsp;<span class="op" id="5553718">{</span>&nbsp;<span class="keyword" id="5553720">return</span>&nbsp;<span class="ident" id="5553727">x</span><span class="op" id="5553728">[</span><span class="ident" id="5553729">i</span><span class="op" id="5553730">]</span><span class="op" id="5553731">.</span><span class="ident" id="5553732">Cycles</span>&nbsp;<span class="op" id="5553739">&gt;</span>&nbsp;<span class="ident" id="5553741">x</span><span class="op" id="5553742">[</span><span class="ident" id="5553743">j</span><span class="op" id="5553744">]</span><span class="op" id="5553745">.</span><span class="ident" id="5553746">Cycles</span>&nbsp;<span class="op" id="5553753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5553756">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="5553825">func</span>&nbsp;<span class="ident" id="5553830">countBlock</span><span class="op" id="5553840">(</span><span class="op" id="5553841">)</span>&nbsp;<span class="builtintype" id="5553843">int</span>&nbsp;<span class="op" id="5553847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5553850">n</span><span class="op" id="5553851">,</span>&nbsp;<span class="ident" id="5553853">_</span>&nbsp;<span class="op" id="5553855">:=</span>&nbsp;<span class="ident" id="5553858">runtime</span><span class="op" id="5553865">.</span><span class="ident" id="5553866">BlockProfile</span><span class="op" id="5553878">(</span><span class="ident" id="5553879">nil</span><span class="op" id="5553882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5553885">return</span>&nbsp;<span class="ident" id="5553892">n</span><br>
<span class="lineno"></span><span class="op" id="5553894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="5553897">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5553953">func</span>&nbsp;<span class="ident" id="5553958">writeBlock</span><span class="op" id="5553968">(</span><span class="ident" id="5553969">w</span>&nbsp;<span class="ident" id="5553971">io</span><span class="op" id="5553973">.</span><span class="ident" id="5553974">Writer</span><span class="op" id="5553980">,</span>&nbsp;<span class="ident" id="5553982">debug</span>&nbsp;<span class="builtintype" id="5553988">int</span><span class="op" id="5553991">)</span>&nbsp;<span class="builtintype" id="5553993">error</span>&nbsp;<span class="op" id="5553999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554002">var</span>&nbsp;<span class="ident" id="5554006">p</span>&nbsp;<span class="op" id="5554008">[</span><span class="op" id="5554009">]</span><span class="ident" id="5554010">runtime</span><span class="op" id="5554017">.</span><span class="ident" id="5554018">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554038">n</span><span class="op" id="5554039">,</span>&nbsp;<span class="ident" id="5554041">ok</span>&nbsp;<span class="op" id="5554044">:=</span>&nbsp;<span class="ident" id="5554047">runtime</span><span class="op" id="5554054">.</span><span class="ident" id="5554055">BlockProfile</span><span class="op" id="5554067">(</span><span class="ident" id="5554068">nil</span><span class="op" id="5554071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554074">for</span>&nbsp;<span class="op" id="5554078">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554082">p</span>&nbsp;<span class="op" id="5554084">=</span>&nbsp;<span class="builtinfunc" id="5554086">make</span><span class="op" id="5554090">(</span><span class="op" id="5554091">[</span><span class="op" id="5554092">]</span><span class="ident" id="5554093">runtime</span><span class="op" id="5554100">.</span><span class="ident" id="5554101">BlockProfileRecord</span><span class="op" id="5554119">,</span>&nbsp;<span class="ident" id="5554121">n</span><span class="op" id="5554122">+</span><span class="num" id="5554123">50</span><span class="op" id="5554125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554129">n</span><span class="op" id="5554130">,</span>&nbsp;<span class="ident" id="5554132">ok</span>&nbsp;<span class="op" id="5554135">=</span>&nbsp;<span class="ident" id="5554137">runtime</span><span class="op" id="5554144">.</span><span class="ident" id="5554145">BlockProfile</span><span class="op" id="5554157">(</span><span class="ident" id="5554158">p</span><span class="op" id="5554159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554163">if</span>&nbsp;<span class="ident" id="5554166">ok</span>&nbsp;<span class="op" id="5554169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554174">p</span>&nbsp;<span class="op" id="5554176">=</span>&nbsp;<span class="ident" id="5554178">p</span><span class="op" id="5554179">[</span><span class="op" id="5554180">:</span><span class="ident" id="5554181">n</span><span class="op" id="5554182">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554187">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554202">sort</span><span class="op" id="5554206">.</span><span class="ident" id="5554207">Sort</span><span class="op" id="5554211">(</span><span class="ident" id="5554212">byCycles</span><span class="op" id="5554220">(</span><span class="ident" id="5554221">p</span><span class="op" id="5554222">)</span><span class="op" id="5554223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554227">b</span>&nbsp;<span class="op" id="5554229">:=</span>&nbsp;<span class="ident" id="5554232">bufio</span><span class="op" id="5554237">.</span><span class="ident" id="5554238">NewWriter</span><span class="op" id="5554247">(</span><span class="ident" id="5554248">w</span><span class="op" id="5554249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554252">var</span>&nbsp;<span class="ident" id="5554256">tw</span>&nbsp;<span class="op" id="5554259">*</span><span class="ident" id="5554260">tabwriter</span><span class="op" id="5554269">.</span><span class="ident" id="5554270">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554278">w</span>&nbsp;<span class="op" id="5554280">=</span>&nbsp;<span class="ident" id="5554282">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554285">if</span>&nbsp;<span class="ident" id="5554288">debug</span>&nbsp;<span class="op" id="5554294">&gt;</span>&nbsp;<span class="num" id="5554296">0</span>&nbsp;<span class="op" id="5554298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554302">tw</span>&nbsp;<span class="op" id="5554305">=</span>&nbsp;<span class="ident" id="5554307">tabwriter</span><span class="op" id="5554316">.</span><span class="ident" id="5554317">NewWriter</span><span class="op" id="5554326">(</span><span class="ident" id="5554327">w</span><span class="op" id="5554328">,</span>&nbsp;<span class="num" id="5554330">1</span><span class="op" id="5554331">,</span>&nbsp;<span class="num" id="5554333">8</span><span class="op" id="5554334">,</span>&nbsp;<span class="num" id="5554336">1</span><span class="op" id="5554337">,</span>&nbsp;<span class="string" id="5554339">&#39;\t&#39;</span><span class="op" id="5554343">,</span>&nbsp;<span class="num" id="5554345">0</span><span class="op" id="5554346">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554350">w</span>&nbsp;<span class="op" id="5554352">=</span>&nbsp;<span class="ident" id="5554354">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554362">fmt</span><span class="op" id="5554365">.</span><span class="ident" id="5554366">Fprintf</span><span class="op" id="5554373">(</span><span class="ident" id="5554374">w</span><span class="op" id="5554375">,</span>&nbsp;<span class="string" id="5554377">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="5554396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554399">fmt</span><span class="op" id="5554402">.</span><span class="ident" id="5554403">Fprintf</span><span class="op" id="5554410">(</span><span class="ident" id="5554411">w</span><span class="op" id="5554412">,</span>&nbsp;<span class="string" id="5554414">&#34;cycles/second=%v\n&#34;</span><span class="op" id="5554434">,</span>&nbsp;<span class="ident" id="5554436">runtime_cyclesPerSecond</span><span class="op" id="5554459">(</span><span class="op" id="5554460">)</span><span class="op" id="5554461">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554464">for</span>&nbsp;<span class="ident" id="5554468">i</span>&nbsp;<span class="op" id="5554470">:=</span>&nbsp;<span class="keyword" id="5554473">range</span>&nbsp;<span class="ident" id="5554479">p</span>&nbsp;<span class="op" id="5554481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554485">r</span>&nbsp;<span class="op" id="5554487">:=</span>&nbsp;<span class="op" id="5554490">&amp;</span><span class="ident" id="5554491">p</span><span class="op" id="5554492">[</span><span class="ident" id="5554493">i</span><span class="op" id="5554494">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554498">fmt</span><span class="op" id="5554501">.</span><span class="ident" id="5554502">Fprintf</span><span class="op" id="5554509">(</span><span class="ident" id="5554510">w</span><span class="op" id="5554511">,</span>&nbsp;<span class="string" id="5554513">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="5554522">,</span>&nbsp;<span class="ident" id="5554524">r</span><span class="op" id="5554525">.</span><span class="ident" id="5554526">Cycles</span><span class="op" id="5554532">,</span>&nbsp;<span class="ident" id="5554534">r</span><span class="op" id="5554535">.</span><span class="ident" id="5554536">Count</span><span class="op" id="5554541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554545">for</span>&nbsp;<span class="ident" id="5554549">_</span><span class="op" id="5554550">,</span>&nbsp;<span class="ident" id="5554552">pc</span>&nbsp;<span class="op" id="5554555">:=</span>&nbsp;<span class="keyword" id="5554558">range</span>&nbsp;<span class="ident" id="5554564">r</span><span class="op" id="5554565">.</span><span class="ident" id="5554566">Stack</span><span class="op" id="5554571">(</span><span class="op" id="5554572">)</span>&nbsp;<span class="op" id="5554574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554579">fmt</span><span class="op" id="5554582">.</span><span class="ident" id="5554583">Fprintf</span><span class="op" id="5554590">(</span><span class="ident" id="5554591">w</span><span class="op" id="5554592">,</span>&nbsp;<span class="string" id="5554594">&#34;&nbsp;%#x&#34;</span><span class="op" id="5554600">,</span>&nbsp;<span class="ident" id="5554602">pc</span><span class="op" id="5554604">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554612">fmt</span><span class="op" id="5554615">.</span><span class="ident" id="5554616">Fprint</span><span class="op" id="5554622">(</span><span class="ident" id="5554623">w</span><span class="op" id="5554624">,</span>&nbsp;<span class="string" id="5554626">&#34;\n&#34;</span><span class="op" id="5554630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554634">if</span>&nbsp;<span class="ident" id="5554637">debug</span>&nbsp;<span class="op" id="5554643">&gt;</span>&nbsp;<span class="num" id="5554645">0</span>&nbsp;<span class="op" id="5554647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554652">printStackRecord</span><span class="op" id="5554668">(</span><span class="ident" id="5554669">w</span><span class="op" id="5554670">,</span>&nbsp;<span class="ident" id="5554672">r</span><span class="op" id="5554673">.</span><span class="ident" id="5554674">Stack</span><span class="op" id="5554679">(</span><span class="op" id="5554680">)</span><span class="op" id="5554681">,</span>&nbsp;<span class="builtintype" id="5554683">true</span><span class="op" id="5554687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554691">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554698">if</span>&nbsp;<span class="ident" id="5554701">tw</span>&nbsp;<span class="op" id="5554704">!=</span>&nbsp;<span class="ident" id="5554707">nil</span>&nbsp;<span class="op" id="5554711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5554715">tw</span><span class="op" id="5554717">.</span><span class="ident" id="5554718">Flush</span><span class="op" id="5554723">(</span><span class="op" id="5554724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5554727">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5554730">return</span>&nbsp;<span class="ident" id="5554737">b</span><span class="op" id="5554738">.</span><span class="ident" id="5554739">Flush</span><span class="op" id="5554744">(</span><span class="op" id="5554745">)</span><br>
<span class="lineno"></span><span class="op" id="5554747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5554750">func</span>&nbsp;<span class="ident" id="5554755">runtime_cyclesPerSecond</span><span class="op" id="5554778">(</span><span class="op" id="5554779">)</span>&nbsp;<span class="ident" id="5554781">int64</span>
</div>
</body>
</html>
