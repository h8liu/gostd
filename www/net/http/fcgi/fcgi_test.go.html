<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6567701">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6567756">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6567810">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6567861">package</span>&nbsp;<span class="ident" id="6567869">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6567875">import</span>&nbsp;<span class="op" id="6567882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6567885">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6567894">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6567904">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6567910">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6567920">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6567923">var</span>&nbsp;<span class="ident" id="6567927">sizeTests</span>&nbsp;<span class="op" id="6567937">=</span>&nbsp;<span class="op" id="6567939">[</span><span class="op" id="6567940">]</span><span class="keyword" id="6567941">struct</span>&nbsp;<span class="op" id="6567948">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6567951">size</span>&nbsp;&nbsp;<span class="builtintype" id="6567957">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6567965">bytes</span>&nbsp;<span class="op" id="6567971">[</span><span class="op" id="6567972">]</span><span class="builtintype" id="6567973">byte</span><br>
<span class="lineno"></span><span class="op" id="6567978">}</span><span class="op" id="6567979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6567982">{</span><span class="num" id="6567983">0</span><span class="op" id="6567984">,</span>&nbsp;<span class="op" id="6567986">[</span><span class="op" id="6567987">]</span><span class="builtintype" id="6567988">byte</span><span class="op" id="6567992">{</span><span class="num" id="6567993">0x00</span><span class="op" id="6567997">}</span><span class="op" id="6567998">}</span><span class="op" id="6567999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568002">{</span><span class="num" id="6568003">127</span><span class="op" id="6568006">,</span>&nbsp;<span class="op" id="6568008">[</span><span class="op" id="6568009">]</span><span class="builtintype" id="6568010">byte</span><span class="op" id="6568014">{</span><span class="num" id="6568015">0x7F</span><span class="op" id="6568019">}</span><span class="op" id="6568020">}</span><span class="op" id="6568021">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568024">{</span><span class="num" id="6568025">128</span><span class="op" id="6568028">,</span>&nbsp;<span class="op" id="6568030">[</span><span class="op" id="6568031">]</span><span class="builtintype" id="6568032">byte</span><span class="op" id="6568036">{</span><span class="num" id="6568037">0x80</span><span class="op" id="6568041">,</span>&nbsp;<span class="num" id="6568043">0x00</span><span class="op" id="6568047">,</span>&nbsp;<span class="num" id="6568049">0x00</span><span class="op" id="6568053">,</span>&nbsp;<span class="num" id="6568055">0x80</span><span class="op" id="6568059">}</span><span class="op" id="6568060">}</span><span class="op" id="6568061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568064">{</span><span class="num" id="6568065">1000</span><span class="op" id="6568069">,</span>&nbsp;<span class="op" id="6568071">[</span><span class="op" id="6568072">]</span><span class="builtintype" id="6568073">byte</span><span class="op" id="6568077">{</span><span class="num" id="6568078">0x80</span><span class="op" id="6568082">,</span>&nbsp;<span class="num" id="6568084">0x00</span><span class="op" id="6568088">,</span>&nbsp;<span class="num" id="6568090">0x03</span><span class="op" id="6568094">,</span>&nbsp;<span class="num" id="6568096">0xE8</span><span class="op" id="6568100">}</span><span class="op" id="6568101">}</span><span class="op" id="6568102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568105">{</span><span class="num" id="6568106">33554431</span><span class="op" id="6568114">,</span>&nbsp;<span class="op" id="6568116">[</span><span class="op" id="6568117">]</span><span class="builtintype" id="6568118">byte</span><span class="op" id="6568122">{</span><span class="num" id="6568123">0x81</span><span class="op" id="6568127">,</span>&nbsp;<span class="num" id="6568129">0xFF</span><span class="op" id="6568133">,</span>&nbsp;<span class="num" id="6568135">0xFF</span><span class="op" id="6568139">,</span>&nbsp;<span class="num" id="6568141">0xFF</span><span class="op" id="6568145">}</span><span class="op" id="6568146">}</span><span class="op" id="6568147">,</span><br>
<span class="lineno"></span><span class="op" id="6568149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6568152">func</span>&nbsp;<span class="ident" id="6568157">TestSize</span><span class="op" id="6568165">(</span><span class="ident" id="6568166">t</span>&nbsp;<span class="op" id="6568168">*</span><span class="ident" id="6568169"><a href="/net/http/fcgi/fcgi_test.go.html#6567910">testing</a></span><span class="op" id="6568176">.</span><span class="ident" id="6568177">T</span><span class="op" id="6568178">)</span>&nbsp;<span class="op" id="6568180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568183">b</span>&nbsp;<span class="op" id="6568185">:=</span>&nbsp;<span class="builtinfunc" id="6568188">make</span><span class="op" id="6568192">(</span><span class="op" id="6568193">[</span><span class="op" id="6568194">]</span><span class="builtintype" id="6568195">byte</span><span class="op" id="6568199">,</span>&nbsp;<span class="num" id="6568201">4</span><span class="op" id="6568202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6568205">for</span>&nbsp;<span class="ident" id="6568209">i</span><span class="op" id="6568210">,</span>&nbsp;<span class="ident" id="6568212">test</span>&nbsp;<span class="op" id="6568217">:=</span>&nbsp;<span class="keyword" id="6568220">range</span>&nbsp;<span class="ident" id="6568226"><a href="/net/http/fcgi/fcgi_test.go.html#6567927">sizeTests</a></span>&nbsp;<span class="op" id="6568236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568240">n</span>&nbsp;<span class="op" id="6568242">:=</span>&nbsp;<span class="ident" id="6568245"><a href="/net/http/fcgi/fcgi.go.html#6136831">encodeSize</a></span><span class="op" id="6568255">(</span><span class="ident" id="6568256"><a href="/net/http/fcgi/fcgi_test.go.html#6568183">b</a></span><span class="op" id="6568257">,</span>&nbsp;<span class="ident" id="6568259"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568263">.</span><span class="ident" id="6568264">size</span><span class="op" id="6568268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6568272">if</span>&nbsp;<span class="op" id="6568275">!</span><span class="ident" id="6568276"><a href="/net/http/fcgi/fcgi_test.go.html#6567885">bytes</a></span><span class="op" id="6568281">.</span><span class="ident" id="6568282">Equal</span><span class="op" id="6568287">(</span><span class="ident" id="6568288"><a href="/net/http/fcgi/fcgi_test.go.html#6568183">b</a></span><span class="op" id="6568289">[</span><span class="op" id="6568290">:</span><span class="ident" id="6568291"><a href="/net/http/fcgi/fcgi_test.go.html#6568240">n</a></span><span class="op" id="6568292">]</span><span class="op" id="6568293">,</span>&nbsp;<span class="ident" id="6568295"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568299">.</span><span class="ident" id="6568300">bytes</span><span class="op" id="6568305">)</span>&nbsp;<span class="op" id="6568307">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568312"><a href="/net/http/fcgi/fcgi_test.go.html#6568166">t</a></span><span class="op" id="6568313">.</span><span class="ident" id="6568314">Errorf</span><span class="op" id="6568320">(</span><span class="string" id="6568321">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6568349">,</span>&nbsp;<span class="ident" id="6568351"><a href="/net/http/fcgi/fcgi_test.go.html#6568209">i</a></span><span class="op" id="6568352">,</span>&nbsp;<span class="ident" id="6568354"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568358">.</span><span class="ident" id="6568359">bytes</span><span class="op" id="6568364">,</span>&nbsp;<span class="ident" id="6568366"><a href="/net/http/fcgi/fcgi_test.go.html#6568183">b</a></span><span class="op" id="6568367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568375">size</span><span class="op" id="6568379">,</span>&nbsp;<span class="ident" id="6568381"><a href="/net/http/fcgi/fcgi_test.go.html#6568240">n</a></span>&nbsp;<span class="op" id="6568383">:=</span>&nbsp;<span class="ident" id="6568386"><a href="/net/http/fcgi/fcgi.go.html#6136464">readSize</a></span><span class="op" id="6568394">(</span><span class="ident" id="6568395"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568399">.</span><span class="ident" id="6568400">bytes</span><span class="op" id="6568405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6568409">if</span>&nbsp;<span class="ident" id="6568412"><a href="/net/http/fcgi/fcgi_test.go.html#6568375">size</a></span>&nbsp;<span class="op" id="6568417">!=</span>&nbsp;<span class="ident" id="6568420"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568424">.</span><span class="ident" id="6568425">size</span>&nbsp;<span class="op" id="6568430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568435"><a href="/net/http/fcgi/fcgi_test.go.html#6568166">t</a></span><span class="op" id="6568436">.</span><span class="ident" id="6568437">Errorf</span><span class="op" id="6568443">(</span><span class="string" id="6568444">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6568469">,</span>&nbsp;<span class="ident" id="6568471"><a href="/net/http/fcgi/fcgi_test.go.html#6568209">i</a></span><span class="op" id="6568472">,</span>&nbsp;<span class="ident" id="6568474"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568478">.</span><span class="ident" id="6568479">size</span><span class="op" id="6568483">,</span>&nbsp;<span class="ident" id="6568485"><a href="/net/http/fcgi/fcgi_test.go.html#6568375">size</a></span><span class="op" id="6568489">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6568497">if</span>&nbsp;<span class="builtinfunc" id="6568500">len</span><span class="op" id="6568503">(</span><span class="ident" id="6568504"><a href="/net/http/fcgi/fcgi_test.go.html#6568212">test</a></span><span class="op" id="6568508">.</span><span class="ident" id="6568509">bytes</span><span class="op" id="6568514">)</span>&nbsp;<span class="op" id="6568516">!=</span>&nbsp;<span class="ident" id="6568519"><a href="/net/http/fcgi/fcgi_test.go.html#6568240">n</a></span>&nbsp;<span class="op" id="6568521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568526"><a href="/net/http/fcgi/fcgi_test.go.html#6568166">t</a></span><span class="op" id="6568527">.</span><span class="ident" id="6568528">Errorf</span><span class="op" id="6568534">(</span><span class="string" id="6568535">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6568569">,</span>&nbsp;<span class="ident" id="6568571"><a href="/net/http/fcgi/fcgi_test.go.html#6568209">i</a></span><span class="op" id="6568572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568579">}</span><br>
<span class="lineno">40</span><span class="op" id="6568581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6568584">var</span>&nbsp;<span class="ident" id="6568588">streamTests</span>&nbsp;<span class="op" id="6568600">=</span>&nbsp;<span class="op" id="6568602">[</span><span class="op" id="6568603">]</span><span class="keyword" id="6568604">struct</span>&nbsp;<span class="op" id="6568611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568614">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6568622">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568630">recType</span>&nbsp;<span class="ident" id="6568638"><a href="/net/http/fcgi/fcgi.go.html#6132670">recType</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568647">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6568655">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568663">content</span>&nbsp;<span class="op" id="6568671">[</span><span class="op" id="6568672">]</span><span class="builtintype" id="6568673">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568679">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568687">[</span><span class="op" id="6568688">]</span><span class="builtintype" id="6568689">byte</span><br>
<span class="lineno"></span><span class="op" id="6568694">}</span><span class="op" id="6568695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568698">{</span><span class="string" id="6568699">&#34;single&nbsp;record&#34;</span><span class="op" id="6568714">,</span>&nbsp;<span class="ident" id="6568716"><a href="/net/http/fcgi/fcgi.go.html#6132859">typeStdout</a></span><span class="op" id="6568726">,</span>&nbsp;<span class="num" id="6568728">1</span><span class="op" id="6568729">,</span>&nbsp;<span class="ident" id="6568731">nil</span><span class="op" id="6568734">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568738">[</span><span class="op" id="6568739">]</span><span class="builtintype" id="6568740">byte</span><span class="op" id="6568744">{</span><span class="num" id="6568745">1</span><span class="op" id="6568746">,</span>&nbsp;<span class="builtintype" id="6568748">byte</span><span class="op" id="6568752">(</span><span class="ident" id="6568753"><a href="/net/http/fcgi/fcgi.go.html#6132859">typeStdout</a></span><span class="op" id="6568763">)</span><span class="op" id="6568764">,</span>&nbsp;<span class="num" id="6568766">0</span><span class="op" id="6568767">,</span>&nbsp;<span class="num" id="6568769">1</span><span class="op" id="6568770">,</span>&nbsp;<span class="num" id="6568772">0</span><span class="op" id="6568773">,</span>&nbsp;<span class="num" id="6568775">0</span><span class="op" id="6568776">,</span>&nbsp;<span class="num" id="6568778">0</span><span class="op" id="6568779">,</span>&nbsp;<span class="num" id="6568781">0</span><span class="op" id="6568782">}</span><span class="op" id="6568783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568786">}</span><span class="op" id="6568787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6568790">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568843">{</span><span class="string" id="6568844">&#34;two&nbsp;records&#34;</span><span class="op" id="6568857">,</span>&nbsp;<span class="ident" id="6568859"><a href="/net/http/fcgi/fcgi.go.html#6132826">typeStdin</a></span><span class="op" id="6568868">,</span>&nbsp;<span class="num" id="6568870">300</span><span class="op" id="6568873">,</span>&nbsp;<span class="builtinfunc" id="6568875">make</span><span class="op" id="6568879">(</span><span class="op" id="6568880">[</span><span class="op" id="6568881">]</span><span class="builtintype" id="6568882">byte</span><span class="op" id="6568886">,</span>&nbsp;<span class="num" id="6568888">66000</span><span class="op" id="6568893">)</span><span class="op" id="6568894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6568898"><a href="/net/http/fcgi/fcgi_test.go.html#6567885">bytes</a></span><span class="op" id="6568903">.</span><span class="ident" id="6568904">Join</span><span class="op" id="6568908">(</span><span class="op" id="6568909">[</span><span class="op" id="6568910">]</span><span class="op" id="6568911">[</span><span class="op" id="6568912">]</span><span class="builtintype" id="6568913">byte</span><span class="op" id="6568917">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6568922">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6568956">{</span><span class="num" id="6568957">1</span><span class="op" id="6568958">,</span>&nbsp;<span class="builtintype" id="6568960">byte</span><span class="op" id="6568964">(</span><span class="ident" id="6568965"><a href="/net/http/fcgi/fcgi.go.html#6132826">typeStdin</a></span><span class="op" id="6568974">)</span><span class="op" id="6568975">,</span>&nbsp;<span class="num" id="6568977">0x01</span><span class="op" id="6568981">,</span>&nbsp;<span class="num" id="6568983">0x2C</span><span class="op" id="6568987">,</span>&nbsp;<span class="num" id="6568989">0xFF</span><span class="op" id="6568993">,</span>&nbsp;<span class="num" id="6568995">0xFF</span><span class="op" id="6568999">,</span>&nbsp;<span class="num" id="6569001">1</span><span class="op" id="6569002">,</span>&nbsp;<span class="num" id="6569004">0</span><span class="op" id="6569005">}</span><span class="op" id="6569006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6569011">make</span><span class="op" id="6569015">(</span><span class="op" id="6569016">[</span><span class="op" id="6569017">]</span><span class="builtintype" id="6569018">byte</span><span class="op" id="6569022">,</span>&nbsp;<span class="num" id="6569024">65536</span><span class="op" id="6569029">)</span><span class="op" id="6569030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6569035">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569063">{</span><span class="num" id="6569064">1</span><span class="op" id="6569065">,</span>&nbsp;<span class="builtintype" id="6569067">byte</span><span class="op" id="6569071">(</span><span class="ident" id="6569072"><a href="/net/http/fcgi/fcgi.go.html#6132826">typeStdin</a></span><span class="op" id="6569081">)</span><span class="op" id="6569082">,</span>&nbsp;<span class="num" id="6569084">0x01</span><span class="op" id="6569088">,</span>&nbsp;<span class="num" id="6569090">0x2C</span><span class="op" id="6569094">,</span>&nbsp;<span class="num" id="6569096">0x01</span><span class="op" id="6569100">,</span>&nbsp;<span class="num" id="6569102">0xD1</span><span class="op" id="6569106">,</span>&nbsp;<span class="num" id="6569108">7</span><span class="op" id="6569109">,</span>&nbsp;<span class="num" id="6569111">0</span><span class="op" id="6569112">}</span><span class="op" id="6569113">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6569118">make</span><span class="op" id="6569122">(</span><span class="op" id="6569123">[</span><span class="op" id="6569124">]</span><span class="builtintype" id="6569125">byte</span><span class="op" id="6569129">,</span>&nbsp;<span class="num" id="6569131">472</span><span class="op" id="6569134">)</span><span class="op" id="6569135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6569140">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569174">{</span><span class="num" id="6569175">1</span><span class="op" id="6569176">,</span>&nbsp;<span class="builtintype" id="6569178">byte</span><span class="op" id="6569182">(</span><span class="ident" id="6569183"><a href="/net/http/fcgi/fcgi.go.html#6132826">typeStdin</a></span><span class="op" id="6569192">)</span><span class="op" id="6569193">,</span>&nbsp;<span class="num" id="6569195">0x01</span><span class="op" id="6569199">,</span>&nbsp;<span class="num" id="6569201">0x2C</span><span class="op" id="6569205">,</span>&nbsp;<span class="num" id="6569207">0</span><span class="op" id="6569208">,</span>&nbsp;<span class="num" id="6569210">0</span><span class="op" id="6569211">,</span>&nbsp;<span class="num" id="6569213">0</span><span class="op" id="6569214">,</span>&nbsp;<span class="num" id="6569216">0</span><span class="op" id="6569217">}</span><span class="op" id="6569218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569222">}</span><span class="op" id="6569223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569228">nil</span><span class="op" id="6569231">)</span><span class="op" id="6569232">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569235">}</span><span class="op" id="6569236">,</span><br>
<span class="lineno"></span><span class="op" id="6569238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569241">type</span>&nbsp;<span class="ident" id="6569246">nilCloser</span>&nbsp;<span class="keyword" id="6569256">struct</span>&nbsp;<span class="op" id="6569263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569266"><a href="/net/http/fcgi/fcgi_test.go.html#6567904">io</a></span><span class="op" id="6569268">.</span><span class="ident" id="6569269">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6569280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569283">func</span>&nbsp;<span class="op" id="6569288">(</span><span class="ident" id="6569289">c</span>&nbsp;<span class="op" id="6569291">*</span><span class="ident" id="6569292"><a href="/net/http/fcgi/fcgi_test.go.html#6569246">nilCloser</a></span><span class="op" id="6569301">)</span>&nbsp;<span class="ident" id="6569303">Close</span><span class="op" id="6569308">(</span><span class="op" id="6569309">)</span>&nbsp;<span class="builtintype" id="6569311">error</span>&nbsp;<span class="op" id="6569317">{</span>&nbsp;<span class="keyword" id="6569319">return</span>&nbsp;<span class="ident" id="6569326">nil</span>&nbsp;<span class="op" id="6569330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569333">func</span>&nbsp;<span class="ident" id="6569338">TestStreams</span><span class="op" id="6569349">(</span><span class="ident" id="6569350">t</span>&nbsp;<span class="op" id="6569352">*</span><span class="ident" id="6569353"><a href="/net/http/fcgi/fcgi_test.go.html#6567910">testing</a></span><span class="op" id="6569360">.</span><span class="ident" id="6569361">T</span><span class="op" id="6569362">)</span>&nbsp;<span class="op" id="6569364">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569367">var</span>&nbsp;<span class="ident" id="6569371">rec</span>&nbsp;<span class="ident" id="6569375"><a href="/net/http/fcgi/fcgi.go.html#6134584">record</a></span><br>
<span class="lineno"></span><span class="ident" id="6569382">outer</span><span class="op" id="6569387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569390">for</span>&nbsp;<span class="ident" id="6569394">_</span><span class="op" id="6569395">,</span>&nbsp;<span class="ident" id="6569397">test</span>&nbsp;<span class="op" id="6569402">:=</span>&nbsp;<span class="keyword" id="6569405">range</span>&nbsp;<span class="ident" id="6569411"><a href="/net/http/fcgi/fcgi_test.go.html#6568588">streamTests</a></span>&nbsp;<span class="op" id="6569423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569427">buf</span>&nbsp;<span class="op" id="6569431">:=</span>&nbsp;<span class="ident" id="6569434"><a href="/net/http/fcgi/fcgi_test.go.html#6567885">bytes</a></span><span class="op" id="6569439">.</span><span class="ident" id="6569440">NewBuffer</span><span class="op" id="6569449">(</span><span class="ident" id="6569450"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569454">.</span><span class="ident" id="6569455">raw</span><span class="op" id="6569458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569462">var</span>&nbsp;<span class="ident" id="6569466">content</span>&nbsp;<span class="op" id="6569474">[</span><span class="op" id="6569475">]</span><span class="builtintype" id="6569476">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569483">for</span>&nbsp;<span class="ident" id="6569487"><a href="/net/http/fcgi/fcgi_test.go.html#6569427">buf</a></span><span class="op" id="6569490">.</span><span class="ident" id="6569491">Len</span><span class="op" id="6569494">(</span><span class="op" id="6569495">)</span>&nbsp;<span class="op" id="6569497">&gt;</span>&nbsp;<span class="num" id="6569499">0</span>&nbsp;<span class="op" id="6569501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569506">if</span>&nbsp;<span class="ident" id="6569509">err</span>&nbsp;<span class="op" id="6569513">:=</span>&nbsp;<span class="ident" id="6569516"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569519">.</span><span class="ident" id="6569520">read</span><span class="op" id="6569524">(</span><span class="ident" id="6569525"><a href="/net/http/fcgi/fcgi_test.go.html#6569427">buf</a></span><span class="op" id="6569528">)</span><span class="op" id="6569529">;</span>&nbsp;<span class="ident" id="6569531"><a href="/net/http/fcgi/fcgi_test.go.html#6569509">err</a></span>&nbsp;<span class="op" id="6569535">!=</span>&nbsp;<span class="ident" id="6569538">nil</span>&nbsp;<span class="op" id="6569542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569548"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6569549">.</span><span class="ident" id="6569550">Errorf</span><span class="op" id="6569556">(</span><span class="string" id="6569557">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6569587">,</span>&nbsp;<span class="ident" id="6569589"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569593">.</span><span class="ident" id="6569594">desc</span><span class="op" id="6569598">,</span>&nbsp;<span class="ident" id="6569600"><a href="/net/http/fcgi/fcgi_test.go.html#6569509">err</a></span><span class="op" id="6569603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569609">continue</span>&nbsp;<span class="ident" id="6569618">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569627">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569632"><a href="/net/http/fcgi/fcgi_test.go.html#6569466">content</a></span>&nbsp;<span class="op" id="6569640">=</span>&nbsp;<span class="builtinfunc" id="6569642">append</span><span class="op" id="6569648">(</span><span class="ident" id="6569649"><a href="/net/http/fcgi/fcgi_test.go.html#6569466">content</a></span><span class="op" id="6569656">,</span>&nbsp;<span class="ident" id="6569658"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569661">.</span><span class="ident" id="6569662">content</span><span class="op" id="6569669">(</span><span class="op" id="6569670">)</span><span class="op" id="6569671">...</span><span class="op" id="6569674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569682">if</span>&nbsp;<span class="ident" id="6569685"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569688">.</span><span class="ident" id="6569689">h</span><span class="op" id="6569690">.</span><span class="ident" id="6569691">Type</span>&nbsp;<span class="op" id="6569696">!=</span>&nbsp;<span class="ident" id="6569699"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569703">.</span><span class="ident" id="6569704">recType</span>&nbsp;<span class="op" id="6569712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569717"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6569718">.</span><span class="ident" id="6569719">Errorf</span><span class="op" id="6569725">(</span><span class="string" id="6569726">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6569755">,</span>&nbsp;<span class="ident" id="6569757"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569761">.</span><span class="ident" id="6569762">desc</span><span class="op" id="6569766">,</span>&nbsp;<span class="ident" id="6569768"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569771">.</span><span class="ident" id="6569772">h</span><span class="op" id="6569773">.</span><span class="ident" id="6569774">Type</span><span class="op" id="6569778">,</span>&nbsp;<span class="ident" id="6569780"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569784">.</span><span class="ident" id="6569785">recType</span><span class="op" id="6569792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569797">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569812">if</span>&nbsp;<span class="ident" id="6569815"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569818">.</span><span class="ident" id="6569819">h</span><span class="op" id="6569820">.</span><span class="ident" id="6569821">Id</span>&nbsp;<span class="op" id="6569824">!=</span>&nbsp;<span class="ident" id="6569827"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569831">.</span><span class="ident" id="6569832">reqId</span>&nbsp;<span class="op" id="6569838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569843"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6569844">.</span><span class="ident" id="6569845">Errorf</span><span class="op" id="6569851">(</span><span class="string" id="6569852">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6569887">,</span>&nbsp;<span class="ident" id="6569889"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569893">.</span><span class="ident" id="6569894">desc</span><span class="op" id="6569898">,</span>&nbsp;<span class="ident" id="6569900"><a href="/net/http/fcgi/fcgi_test.go.html#6569371">rec</a></span><span class="op" id="6569903">.</span><span class="ident" id="6569904">h</span><span class="op" id="6569905">.</span><span class="ident" id="6569906">Id</span><span class="op" id="6569908">,</span>&nbsp;<span class="ident" id="6569910"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569914">.</span><span class="ident" id="6569915">reqId</span><span class="op" id="6569920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569925">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569936">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569940">if</span>&nbsp;<span class="op" id="6569943">!</span><span class="ident" id="6569944"><a href="/net/http/fcgi/fcgi_test.go.html#6567885">bytes</a></span><span class="op" id="6569949">.</span><span class="ident" id="6569950">Equal</span><span class="op" id="6569955">(</span><span class="ident" id="6569956"><a href="/net/http/fcgi/fcgi_test.go.html#6569466">content</a></span><span class="op" id="6569963">,</span>&nbsp;<span class="ident" id="6569965"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6569969">.</span><span class="ident" id="6569970">content</span><span class="op" id="6569977">)</span>&nbsp;<span class="op" id="6569979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569984"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6569985">.</span><span class="ident" id="6569986">Errorf</span><span class="op" id="6569992">(</span><span class="string" id="6569993">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6570017">,</span>&nbsp;<span class="ident" id="6570019"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570023">.</span><span class="ident" id="6570024">desc</span><span class="op" id="6570028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570048"><a href="/net/http/fcgi/fcgi_test.go.html#6569427">buf</a></span><span class="op" id="6570051">.</span><span class="ident" id="6570052">Reset</span><span class="op" id="6570057">(</span><span class="op" id="6570058">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570062">c</span>&nbsp;<span class="op" id="6570064">:=</span>&nbsp;<span class="ident" id="6570067"><a href="/net/http/fcgi/fcgi.go.html#6134416">newConn</a></span><span class="op" id="6570074">(</span><span class="op" id="6570075">&amp;</span><span class="ident" id="6570076"><a href="/net/http/fcgi/fcgi_test.go.html#6569246">nilCloser</a></span><span class="op" id="6570085">{</span><span class="ident" id="6570086"><a href="/net/http/fcgi/fcgi_test.go.html#6569427">buf</a></span><span class="op" id="6570089">}</span><span class="op" id="6570090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570094">w</span>&nbsp;<span class="op" id="6570096">:=</span>&nbsp;<span class="ident" id="6570099"><a href="/net/http/fcgi/fcgi.go.html#6137289">newWriter</a></span><span class="op" id="6570108">(</span><span class="ident" id="6570109"><a href="/net/http/fcgi/fcgi_test.go.html#6570062">c</a></span><span class="op" id="6570110">,</span>&nbsp;<span class="ident" id="6570112"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570116">.</span><span class="ident" id="6570117">recType</span><span class="op" id="6570124">,</span>&nbsp;<span class="ident" id="6570126"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570130">.</span><span class="ident" id="6570131">reqId</span><span class="op" id="6570136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570140">if</span>&nbsp;<span class="ident" id="6570143">_</span><span class="op" id="6570144">,</span>&nbsp;<span class="ident" id="6570146">err</span>&nbsp;<span class="op" id="6570150">:=</span>&nbsp;<span class="ident" id="6570153"><a href="/net/http/fcgi/fcgi_test.go.html#6570094">w</a></span><span class="op" id="6570154">.</span><span class="ident" id="6570155">Write</span><span class="op" id="6570160">(</span><span class="ident" id="6570161"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570165">.</span><span class="ident" id="6570166">content</span><span class="op" id="6570173">)</span><span class="op" id="6570174">;</span>&nbsp;<span class="ident" id="6570176"><a href="/net/http/fcgi/fcgi_test.go.html#6570146">err</a></span>&nbsp;<span class="op" id="6570180">!=</span>&nbsp;<span class="ident" id="6570183">nil</span>&nbsp;<span class="op" id="6570187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570192"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6570193">.</span><span class="ident" id="6570194">Errorf</span><span class="op" id="6570200">(</span><span class="string" id="6570201">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6570231">,</span>&nbsp;<span class="ident" id="6570233"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570237">.</span><span class="ident" id="6570238">desc</span><span class="op" id="6570242">,</span>&nbsp;<span class="ident" id="6570244"><a href="/net/http/fcgi/fcgi_test.go.html#6570146">err</a></span><span class="op" id="6570247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570252">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570267">if</span>&nbsp;<span class="ident" id="6570270">err</span>&nbsp;<span class="op" id="6570274">:=</span>&nbsp;<span class="ident" id="6570277"><a href="/net/http/fcgi/fcgi_test.go.html#6570094">w</a></span><span class="op" id="6570278">.</span><span class="ident" id="6570279">Close</span><span class="op" id="6570284">(</span><span class="op" id="6570285">)</span><span class="op" id="6570286">;</span>&nbsp;<span class="ident" id="6570288"><a href="/net/http/fcgi/fcgi_test.go.html#6570270">err</a></span>&nbsp;<span class="op" id="6570292">!=</span>&nbsp;<span class="ident" id="6570295">nil</span>&nbsp;<span class="op" id="6570299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570304"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6570305">.</span><span class="ident" id="6570306">Errorf</span><span class="op" id="6570312">(</span><span class="string" id="6570313">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6570343">,</span>&nbsp;<span class="ident" id="6570345"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570349">.</span><span class="ident" id="6570350">desc</span><span class="op" id="6570354">,</span>&nbsp;<span class="ident" id="6570356"><a href="/net/http/fcgi/fcgi_test.go.html#6570270">err</a></span><span class="op" id="6570359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570364">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570375">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570379">if</span>&nbsp;<span class="op" id="6570382">!</span><span class="ident" id="6570383"><a href="/net/http/fcgi/fcgi_test.go.html#6567885">bytes</a></span><span class="op" id="6570388">.</span><span class="ident" id="6570389">Equal</span><span class="op" id="6570394">(</span><span class="ident" id="6570395"><a href="/net/http/fcgi/fcgi_test.go.html#6569427">buf</a></span><span class="op" id="6570398">.</span><span class="ident" id="6570399">Bytes</span><span class="op" id="6570404">(</span><span class="op" id="6570405">)</span><span class="op" id="6570406">,</span>&nbsp;<span class="ident" id="6570408"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570412">.</span><span class="ident" id="6570413">raw</span><span class="op" id="6570416">)</span>&nbsp;<span class="op" id="6570418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570423"><a href="/net/http/fcgi/fcgi_test.go.html#6569350">t</a></span><span class="op" id="6570424">.</span><span class="ident" id="6570425">Errorf</span><span class="op" id="6570431">(</span><span class="string" id="6570432">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6570457">,</span>&nbsp;<span class="ident" id="6570459"><a href="/net/http/fcgi/fcgi_test.go.html#6569397">test</a></span><span class="op" id="6570463">.</span><span class="ident" id="6570464">desc</span><span class="op" id="6570468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570475">}</span><br>
<span class="lineno"></span><span class="op" id="6570477">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6570480">type</span>&nbsp;<span class="ident" id="6570485">writeOnlyConn</span>&nbsp;<span class="keyword" id="6570499">struct</span>&nbsp;<span class="op" id="6570506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570509">buf</span>&nbsp;<span class="op" id="6570513">[</span><span class="op" id="6570514">]</span><span class="builtintype" id="6570515">byte</span><br>
<span class="lineno"></span><span class="op" id="6570520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6570523">func</span>&nbsp;<span class="op" id="6570528">(</span><span class="ident" id="6570529">c</span>&nbsp;<span class="op" id="6570531">*</span><span class="ident" id="6570532"><a href="/net/http/fcgi/fcgi_test.go.html#6570485">writeOnlyConn</a></span><span class="op" id="6570545">)</span>&nbsp;<span class="ident" id="6570547">Write</span><span class="op" id="6570552">(</span><span class="ident" id="6570553">p</span>&nbsp;<span class="op" id="6570555">[</span><span class="op" id="6570556">]</span><span class="builtintype" id="6570557">byte</span><span class="op" id="6570561">)</span>&nbsp;<span class="op" id="6570563">(</span><span class="builtintype" id="6570564">int</span><span class="op" id="6570567">,</span>&nbsp;<span class="builtintype" id="6570569">error</span><span class="op" id="6570574">)</span>&nbsp;<span class="op" id="6570576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570579"><a href="/net/http/fcgi/fcgi_test.go.html#6570529">c</a></span><span class="op" id="6570580">.</span><span class="ident" id="6570581">buf</span>&nbsp;<span class="op" id="6570585">=</span>&nbsp;<span class="builtinfunc" id="6570587">append</span><span class="op" id="6570593">(</span><span class="ident" id="6570594"><a href="/net/http/fcgi/fcgi_test.go.html#6570529">c</a></span><span class="op" id="6570595">.</span><span class="ident" id="6570596">buf</span><span class="op" id="6570599">,</span>&nbsp;<span class="ident" id="6570601"><a href="/net/http/fcgi/fcgi_test.go.html#6570553">p</a></span><span class="op" id="6570602">...</span><span class="op" id="6570605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570608">return</span>&nbsp;<span class="builtinfunc" id="6570615">len</span><span class="op" id="6570618">(</span><span class="ident" id="6570619"><a href="/net/http/fcgi/fcgi_test.go.html#6570553">p</a></span><span class="op" id="6570620">)</span><span class="op" id="6570621">,</span>&nbsp;<span class="ident" id="6570623">nil</span><br>
<span class="lineno"></span><span class="op" id="6570627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6570630">func</span>&nbsp;<span class="op" id="6570635">(</span><span class="ident" id="6570636">c</span>&nbsp;<span class="op" id="6570638">*</span><span class="ident" id="6570639"><a href="/net/http/fcgi/fcgi_test.go.html#6570485">writeOnlyConn</a></span><span class="op" id="6570652">)</span>&nbsp;<span class="ident" id="6570654">Read</span><span class="op" id="6570658">(</span><span class="ident" id="6570659">p</span>&nbsp;<span class="op" id="6570661">[</span><span class="op" id="6570662">]</span><span class="builtintype" id="6570663">byte</span><span class="op" id="6570667">)</span>&nbsp;<span class="op" id="6570669">(</span><span class="builtintype" id="6570670">int</span><span class="op" id="6570673">,</span>&nbsp;<span class="builtintype" id="6570675">error</span><span class="op" id="6570680">)</span>&nbsp;<span class="op" id="6570682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570685">return</span>&nbsp;<span class="num" id="6570692">0</span><span class="op" id="6570693">,</span>&nbsp;<span class="ident" id="6570695"><a href="/net/http/fcgi/fcgi_test.go.html#6567894">errors</a></span><span class="op" id="6570701">.</span><span class="ident" id="6570702">New</span><span class="op" id="6570705">(</span><span class="string" id="6570706">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6570726">)</span><br>
<span class="lineno"></span><span class="op" id="6570728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6570731">func</span>&nbsp;<span class="op" id="6570736">(</span><span class="ident" id="6570737">c</span>&nbsp;<span class="op" id="6570739">*</span><span class="ident" id="6570740"><a href="/net/http/fcgi/fcgi_test.go.html#6570485">writeOnlyConn</a></span><span class="op" id="6570753">)</span>&nbsp;<span class="ident" id="6570755">Close</span><span class="op" id="6570760">(</span><span class="op" id="6570761">)</span>&nbsp;<span class="builtintype" id="6570763">error</span>&nbsp;<span class="op" id="6570769">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570772">return</span>&nbsp;<span class="ident" id="6570779">nil</span><br>
<span class="lineno"></span><span class="op" id="6570783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6570786">func</span>&nbsp;<span class="ident" id="6570791">TestGetValues</span><span class="op" id="6570804">(</span><span class="ident" id="6570805">t</span>&nbsp;<span class="op" id="6570807">*</span><span class="ident" id="6570808"><a href="/net/http/fcgi/fcgi_test.go.html#6567910">testing</a></span><span class="op" id="6570815">.</span><span class="ident" id="6570816">T</span><span class="op" id="6570817">)</span>&nbsp;<span class="op" id="6570819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570822">var</span>&nbsp;<span class="ident" id="6570826">rec</span>&nbsp;<span class="ident" id="6570830"><a href="/net/http/fcgi/fcgi.go.html#6134584">record</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570838"><a href="/net/http/fcgi/fcgi_test.go.html#6570826">rec</a></span><span class="op" id="6570841">.</span><span class="ident" id="6570842">h</span><span class="op" id="6570843">.</span><span class="ident" id="6570844">Type</span>&nbsp;<span class="op" id="6570849">=</span>&nbsp;<span class="ident" id="6570851"><a href="/net/http/fcgi/fcgi.go.html#6132958">typeGetValues</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570867">wc</span>&nbsp;<span class="op" id="6570870">:=</span>&nbsp;<span class="builtinfunc" id="6570873">new</span><span class="op" id="6570876">(</span><span class="ident" id="6570877"><a href="/net/http/fcgi/fcgi_test.go.html#6570485">writeOnlyConn</a></span><span class="op" id="6570890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570893">c</span>&nbsp;<span class="op" id="6570895">:=</span>&nbsp;<span class="ident" id="6570898"><a href="/net/http/fcgi/child.go.html#6127602">newChild</a></span><span class="op" id="6570906">(</span><span class="ident" id="6570907"><a href="/net/http/fcgi/fcgi_test.go.html#6570867">wc</a></span><span class="op" id="6570909">,</span>&nbsp;<span class="ident" id="6570911">nil</span><span class="op" id="6570914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570917">err</span>&nbsp;<span class="op" id="6570921">:=</span>&nbsp;<span class="ident" id="6570924"><a href="/net/http/fcgi/fcgi_test.go.html#6570893">c</a></span><span class="op" id="6570925">.</span><span class="ident" id="6570926">handleRecord</span><span class="op" id="6570938">(</span><span class="op" id="6570939">&amp;</span><span class="ident" id="6570940"><a href="/net/http/fcgi/fcgi_test.go.html#6570826">rec</a></span><span class="op" id="6570943">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570946">if</span>&nbsp;<span class="ident" id="6570949"><a href="/net/http/fcgi/fcgi_test.go.html#6570917">err</a></span>&nbsp;<span class="op" id="6570953">!=</span>&nbsp;<span class="ident" id="6570956">nil</span>&nbsp;<span class="op" id="6570960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570964"><a href="/net/http/fcgi/fcgi_test.go.html#6570805">t</a></span><span class="op" id="6570965">.</span><span class="ident" id="6570966">Fatalf</span><span class="op" id="6570972">(</span><span class="string" id="6570973">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6570991">,</span>&nbsp;<span class="ident" id="6570993"><a href="/net/http/fcgi/fcgi_test.go.html#6570917">err</a></span><span class="op" id="6570996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571003">const</span>&nbsp;<span class="ident" id="6571009">want</span>&nbsp;<span class="op" id="6571014">=</span>&nbsp;<span class="string" id="6571016">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6571049">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6571053">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6571080">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6571084">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571142">if</span>&nbsp;<span class="ident" id="6571145">got</span>&nbsp;<span class="op" id="6571149">:=</span>&nbsp;<span class="builtintype" id="6571152">string</span><span class="op" id="6571158">(</span><span class="ident" id="6571159"><a href="/net/http/fcgi/fcgi_test.go.html#6570867">wc</a></span><span class="op" id="6571161">.</span><span class="ident" id="6571162">buf</span><span class="op" id="6571165">)</span><span class="op" id="6571166">;</span>&nbsp;<span class="ident" id="6571168"><a href="/net/http/fcgi/fcgi_test.go.html#6571145">got</a></span>&nbsp;<span class="op" id="6571172">!=</span>&nbsp;<span class="ident" id="6571175"><a href="/net/http/fcgi/fcgi_test.go.html#6571009">want</a></span>&nbsp;<span class="op" id="6571180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571184"><a href="/net/http/fcgi/fcgi_test.go.html#6570805">t</a></span><span class="op" id="6571185">.</span><span class="ident" id="6571186">Errorf</span><span class="op" id="6571192">(</span><span class="string" id="6571193">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6571215">,</span>&nbsp;<span class="ident" id="6571217"><a href="/net/http/fcgi/fcgi_test.go.html#6571145">got</a></span><span class="op" id="6571220">,</span>&nbsp;<span class="ident" id="6571222"><a href="/net/http/fcgi/fcgi_test.go.html#6571009">want</a></span><span class="op" id="6571226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571229">}</span><br>
<span class="lineno">150</span><span class="op" id="6571231">}</span>
</div>
</body>
</html>
