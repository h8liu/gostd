<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2381855">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2381911">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2381965">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2382016">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382049">package</span>&nbsp;<span class="ident" id="2382057">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382066">import</span>&nbsp;<span class="string" id="2382073">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2382083">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2382149">func</span>&nbsp;<span class="ident" id="2382154">nlmAlignOf</span><span class="op" id="2382164">(</span><span class="ident" id="2382165">msglen</span>&nbsp;<span class="builtintype" id="2382172">int</span><span class="op" id="2382175">)</span>&nbsp;<span class="builtintype" id="2382177">int</span>&nbsp;<span class="op" id="2382181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382184">return</span>&nbsp;<span class="op" id="2382191">(</span><span class="ident" id="2382192">msglen</span>&nbsp;<span class="op" id="2382199">+</span>&nbsp;<span class="ident" id="2382201">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2382215">-</span>&nbsp;<span class="num" id="2382217">1</span><span class="op" id="2382218">)</span>&nbsp;<span class="op" id="2382220">&amp;</span>&nbsp;<span class="op" id="2382222">^</span><span class="op" id="2382223">(</span><span class="ident" id="2382224">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2382238">-</span>&nbsp;<span class="num" id="2382240">1</span><span class="op" id="2382241">)</span><br>
<span class="lineno"></span><span class="op" id="2382243">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2382246">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2382310">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2382323">func</span>&nbsp;<span class="ident" id="2382328">rtaAlignOf</span><span class="op" id="2382338">(</span><span class="ident" id="2382339">attrlen</span>&nbsp;<span class="builtintype" id="2382347">int</span><span class="op" id="2382350">)</span>&nbsp;<span class="builtintype" id="2382352">int</span>&nbsp;<span class="op" id="2382356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382359">return</span>&nbsp;<span class="op" id="2382366">(</span><span class="ident" id="2382367">attrlen</span>&nbsp;<span class="op" id="2382375">+</span>&nbsp;<span class="ident" id="2382377">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2382389">-</span>&nbsp;<span class="num" id="2382391">1</span><span class="op" id="2382392">)</span>&nbsp;<span class="op" id="2382394">&amp;</span>&nbsp;<span class="op" id="2382396">^</span><span class="op" id="2382397">(</span><span class="ident" id="2382398">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2382410">-</span>&nbsp;<span class="num" id="2382412">1</span><span class="op" id="2382413">)</span><br>
<span class="lineno">20</span><span class="op" id="2382415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2382418">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2382489">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2382525">type</span>&nbsp;<span class="ident" id="2382530">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2382550">struct</span>&nbsp;<span class="op" id="2382557">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382560">Header</span>&nbsp;<span class="ident" id="2382567">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382577">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2382584">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2382593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382596">func</span>&nbsp;<span class="op" id="2382601">(</span><span class="ident" id="2382602">rr</span>&nbsp;<span class="op" id="2382605">*</span><span class="ident" id="2382606">NetlinkRouteRequest</span><span class="op" id="2382625">)</span>&nbsp;<span class="ident" id="2382627">toWireFormat</span><span class="op" id="2382639">(</span><span class="op" id="2382640">)</span>&nbsp;<span class="op" id="2382642">[</span><span class="op" id="2382643">]</span><span class="builtintype" id="2382644">byte</span>&nbsp;<span class="op" id="2382649">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382652">b</span>&nbsp;<span class="op" id="2382654">:=</span>&nbsp;<span class="builtinfunc" id="2382657">make</span><span class="op" id="2382661">(</span><span class="op" id="2382662">[</span><span class="op" id="2382663">]</span><span class="builtintype" id="2382664">byte</span><span class="op" id="2382668">,</span>&nbsp;<span class="ident" id="2382670">rr</span><span class="op" id="2382672">.</span><span class="ident" id="2382673">Header</span><span class="op" id="2382679">.</span><span class="ident" id="2382680">Len</span><span class="op" id="2382683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382686">*</span><span class="op" id="2382687">(</span><span class="op" id="2382688">*</span><span class="builtintype" id="2382689">uint32</span><span class="op" id="2382695">)</span><span class="op" id="2382696">(</span><span class="ident" id="2382697">unsafe</span><span class="op" id="2382703">.</span><span class="ident" id="2382704">Pointer</span><span class="op" id="2382711">(</span><span class="op" id="2382712">&amp;</span><span class="ident" id="2382713">b</span><span class="op" id="2382714">[</span><span class="num" id="2382715">0</span><span class="op" id="2382716">:</span><span class="num" id="2382717">4</span><span class="op" id="2382718">]</span><span class="op" id="2382719">[</span><span class="num" id="2382720">0</span><span class="op" id="2382721">]</span><span class="op" id="2382722">)</span><span class="op" id="2382723">)</span>&nbsp;<span class="op" id="2382725">=</span>&nbsp;<span class="ident" id="2382727">rr</span><span class="op" id="2382729">.</span><span class="ident" id="2382730">Header</span><span class="op" id="2382736">.</span><span class="ident" id="2382737">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382742">*</span><span class="op" id="2382743">(</span><span class="op" id="2382744">*</span><span class="builtintype" id="2382745">uint16</span><span class="op" id="2382751">)</span><span class="op" id="2382752">(</span><span class="ident" id="2382753">unsafe</span><span class="op" id="2382759">.</span><span class="ident" id="2382760">Pointer</span><span class="op" id="2382767">(</span><span class="op" id="2382768">&amp;</span><span class="ident" id="2382769">b</span><span class="op" id="2382770">[</span><span class="num" id="2382771">4</span><span class="op" id="2382772">:</span><span class="num" id="2382773">6</span><span class="op" id="2382774">]</span><span class="op" id="2382775">[</span><span class="num" id="2382776">0</span><span class="op" id="2382777">]</span><span class="op" id="2382778">)</span><span class="op" id="2382779">)</span>&nbsp;<span class="op" id="2382781">=</span>&nbsp;<span class="ident" id="2382783">rr</span><span class="op" id="2382785">.</span><span class="ident" id="2382786">Header</span><span class="op" id="2382792">.</span><span class="ident" id="2382793">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382799">*</span><span class="op" id="2382800">(</span><span class="op" id="2382801">*</span><span class="builtintype" id="2382802">uint16</span><span class="op" id="2382808">)</span><span class="op" id="2382809">(</span><span class="ident" id="2382810">unsafe</span><span class="op" id="2382816">.</span><span class="ident" id="2382817">Pointer</span><span class="op" id="2382824">(</span><span class="op" id="2382825">&amp;</span><span class="ident" id="2382826">b</span><span class="op" id="2382827">[</span><span class="num" id="2382828">6</span><span class="op" id="2382829">:</span><span class="num" id="2382830">8</span><span class="op" id="2382831">]</span><span class="op" id="2382832">[</span><span class="num" id="2382833">0</span><span class="op" id="2382834">]</span><span class="op" id="2382835">)</span><span class="op" id="2382836">)</span>&nbsp;<span class="op" id="2382838">=</span>&nbsp;<span class="ident" id="2382840">rr</span><span class="op" id="2382842">.</span><span class="ident" id="2382843">Header</span><span class="op" id="2382849">.</span><span class="ident" id="2382850">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382857">*</span><span class="op" id="2382858">(</span><span class="op" id="2382859">*</span><span class="builtintype" id="2382860">uint32</span><span class="op" id="2382866">)</span><span class="op" id="2382867">(</span><span class="ident" id="2382868">unsafe</span><span class="op" id="2382874">.</span><span class="ident" id="2382875">Pointer</span><span class="op" id="2382882">(</span><span class="op" id="2382883">&amp;</span><span class="ident" id="2382884">b</span><span class="op" id="2382885">[</span><span class="num" id="2382886">8</span><span class="op" id="2382887">:</span><span class="num" id="2382888">12</span><span class="op" id="2382890">]</span><span class="op" id="2382891">[</span><span class="num" id="2382892">0</span><span class="op" id="2382893">]</span><span class="op" id="2382894">)</span><span class="op" id="2382895">)</span>&nbsp;<span class="op" id="2382897">=</span>&nbsp;<span class="ident" id="2382899">rr</span><span class="op" id="2382901">.</span><span class="ident" id="2382902">Header</span><span class="op" id="2382908">.</span><span class="ident" id="2382909">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382914">*</span><span class="op" id="2382915">(</span><span class="op" id="2382916">*</span><span class="builtintype" id="2382917">uint32</span><span class="op" id="2382923">)</span><span class="op" id="2382924">(</span><span class="ident" id="2382925">unsafe</span><span class="op" id="2382931">.</span><span class="ident" id="2382932">Pointer</span><span class="op" id="2382939">(</span><span class="op" id="2382940">&amp;</span><span class="ident" id="2382941">b</span><span class="op" id="2382942">[</span><span class="num" id="2382943">12</span><span class="op" id="2382945">:</span><span class="num" id="2382946">16</span><span class="op" id="2382948">]</span><span class="op" id="2382949">[</span><span class="num" id="2382950">0</span><span class="op" id="2382951">]</span><span class="op" id="2382952">)</span><span class="op" id="2382953">)</span>&nbsp;<span class="op" id="2382955">=</span>&nbsp;<span class="ident" id="2382957">rr</span><span class="op" id="2382959">.</span><span class="ident" id="2382960">Header</span><span class="op" id="2382966">.</span><span class="ident" id="2382967">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382972">b</span><span class="op" id="2382973">[</span><span class="num" id="2382974">16</span><span class="op" id="2382976">]</span>&nbsp;<span class="op" id="2382978">=</span>&nbsp;<span class="builtintype" id="2382980">byte</span><span class="op" id="2382984">(</span><span class="ident" id="2382985">rr</span><span class="op" id="2382987">.</span><span class="ident" id="2382988">Data</span><span class="op" id="2382992">.</span><span class="ident" id="2382993">Family</span><span class="op" id="2382999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383002">return</span>&nbsp;<span class="ident" id="2383009">b</span><br>
<span class="lineno"></span><span class="op" id="2383011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2383014">func</span>&nbsp;<span class="ident" id="2383019">newNetlinkRouteRequest</span><span class="op" id="2383041">(</span><span class="ident" id="2383042">proto</span><span class="op" id="2383047">,</span>&nbsp;<span class="ident" id="2383049">seq</span><span class="op" id="2383052">,</span>&nbsp;<span class="ident" id="2383054">family</span>&nbsp;<span class="builtintype" id="2383061">int</span><span class="op" id="2383064">)</span>&nbsp;<span class="op" id="2383066">[</span><span class="op" id="2383067">]</span><span class="builtintype" id="2383068">byte</span>&nbsp;<span class="op" id="2383073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383076">rr</span>&nbsp;<span class="op" id="2383079">:=</span>&nbsp;<span class="op" id="2383082">&amp;</span><span class="ident" id="2383083">NetlinkRouteRequest</span><span class="op" id="2383102">{</span><span class="op" id="2383103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383106">rr</span><span class="op" id="2383108">.</span><span class="ident" id="2383109">Header</span><span class="op" id="2383115">.</span><span class="ident" id="2383116">Len</span>&nbsp;<span class="op" id="2383120">=</span>&nbsp;<span class="builtintype" id="2383122">uint32</span><span class="op" id="2383128">(</span><span class="ident" id="2383129">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2383142">+</span>&nbsp;<span class="ident" id="2383144">SizeofRtGenmsg</span><span class="op" id="2383158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383161">rr</span><span class="op" id="2383163">.</span><span class="ident" id="2383164">Header</span><span class="op" id="2383170">.</span><span class="ident" id="2383171">Type</span>&nbsp;<span class="op" id="2383176">=</span>&nbsp;<span class="builtintype" id="2383178">uint16</span><span class="op" id="2383184">(</span><span class="ident" id="2383185">proto</span><span class="op" id="2383190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383193">rr</span><span class="op" id="2383195">.</span><span class="ident" id="2383196">Header</span><span class="op" id="2383202">.</span><span class="ident" id="2383203">Flags</span>&nbsp;<span class="op" id="2383209">=</span>&nbsp;<span class="ident" id="2383211">NLM_F_DUMP</span>&nbsp;<span class="op" id="2383222">|</span>&nbsp;<span class="ident" id="2383224">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383239">rr</span><span class="op" id="2383241">.</span><span class="ident" id="2383242">Header</span><span class="op" id="2383248">.</span><span class="ident" id="2383249">Seq</span>&nbsp;<span class="op" id="2383253">=</span>&nbsp;<span class="builtintype" id="2383255">uint32</span><span class="op" id="2383261">(</span><span class="ident" id="2383262">seq</span><span class="op" id="2383265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383268">rr</span><span class="op" id="2383270">.</span><span class="ident" id="2383271">Data</span><span class="op" id="2383275">.</span><span class="ident" id="2383276">Family</span>&nbsp;<span class="op" id="2383283">=</span>&nbsp;<span class="builtintype" id="2383285">uint8</span><span class="op" id="2383290">(</span><span class="ident" id="2383291">family</span><span class="op" id="2383297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383300">return</span>&nbsp;<span class="ident" id="2383307">rr</span><span class="op" id="2383309">.</span><span class="ident" id="2383310">toWireFormat</span><span class="op" id="2383322">(</span><span class="op" id="2383323">)</span><br>
<span class="lineno"></span><span class="op" id="2383325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2383328">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2383399">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2383467">func</span>&nbsp;<span class="ident" id="2383472">NetlinkRIB</span><span class="op" id="2383482">(</span><span class="ident" id="2383483">proto</span><span class="op" id="2383488">,</span>&nbsp;<span class="ident" id="2383490">family</span>&nbsp;<span class="builtintype" id="2383497">int</span><span class="op" id="2383500">)</span>&nbsp;<span class="op" id="2383502">(</span><span class="op" id="2383503">[</span><span class="op" id="2383504">]</span><span class="builtintype" id="2383505">byte</span><span class="op" id="2383509">,</span>&nbsp;<span class="builtintype" id="2383511">error</span><span class="op" id="2383516">)</span>&nbsp;<span class="op" id="2383518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383521">s</span><span class="op" id="2383522">,</span>&nbsp;<span class="ident" id="2383524">err</span>&nbsp;<span class="op" id="2383528">:=</span>&nbsp;<span class="ident" id="2383531">Socket</span><span class="op" id="2383537">(</span><span class="ident" id="2383538">AF_NETLINK</span><span class="op" id="2383548">,</span>&nbsp;<span class="ident" id="2383550">SOCK_RAW</span><span class="op" id="2383558">,</span>&nbsp;<span class="ident" id="2383560">NETLINK_ROUTE</span><span class="op" id="2383573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383576">if</span>&nbsp;<span class="ident" id="2383579">err</span>&nbsp;<span class="op" id="2383583">!=</span>&nbsp;<span class="ident" id="2383586">nil</span>&nbsp;<span class="op" id="2383590">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383594">return</span>&nbsp;<span class="ident" id="2383601">nil</span><span class="op" id="2383604">,</span>&nbsp;<span class="ident" id="2383606">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383614">defer</span>&nbsp;<span class="ident" id="2383620">Close</span><span class="op" id="2383625">(</span><span class="ident" id="2383626">s</span><span class="op" id="2383627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383630">lsa</span>&nbsp;<span class="op" id="2383634">:=</span>&nbsp;<span class="op" id="2383637">&amp;</span><span class="ident" id="2383638">SockaddrNetlink</span><span class="op" id="2383653">{</span><span class="ident" id="2383654">Family</span><span class="op" id="2383660">:</span>&nbsp;<span class="ident" id="2383662">AF_NETLINK</span><span class="op" id="2383672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383675">if</span>&nbsp;<span class="ident" id="2383678">err</span>&nbsp;<span class="op" id="2383682">:=</span>&nbsp;<span class="ident" id="2383685">Bind</span><span class="op" id="2383689">(</span><span class="ident" id="2383690">s</span><span class="op" id="2383691">,</span>&nbsp;<span class="ident" id="2383693">lsa</span><span class="op" id="2383696">)</span><span class="op" id="2383697">;</span>&nbsp;<span class="ident" id="2383699">err</span>&nbsp;<span class="op" id="2383703">!=</span>&nbsp;<span class="ident" id="2383706">nil</span>&nbsp;<span class="op" id="2383710">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383714">return</span>&nbsp;<span class="ident" id="2383721">nil</span><span class="op" id="2383724">,</span>&nbsp;<span class="ident" id="2383726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383734">wb</span>&nbsp;<span class="op" id="2383737">:=</span>&nbsp;<span class="ident" id="2383740">newNetlinkRouteRequest</span><span class="op" id="2383762">(</span><span class="ident" id="2383763">proto</span><span class="op" id="2383768">,</span>&nbsp;<span class="num" id="2383770">1</span><span class="op" id="2383771">,</span>&nbsp;<span class="ident" id="2383773">family</span><span class="op" id="2383779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383782">if</span>&nbsp;<span class="ident" id="2383785">err</span>&nbsp;<span class="op" id="2383789">:=</span>&nbsp;<span class="ident" id="2383792">Sendto</span><span class="op" id="2383798">(</span><span class="ident" id="2383799">s</span><span class="op" id="2383800">,</span>&nbsp;<span class="ident" id="2383802">wb</span><span class="op" id="2383804">,</span>&nbsp;<span class="num" id="2383806">0</span><span class="op" id="2383807">,</span>&nbsp;<span class="ident" id="2383809">lsa</span><span class="op" id="2383812">)</span><span class="op" id="2383813">;</span>&nbsp;<span class="ident" id="2383815">err</span>&nbsp;<span class="op" id="2383819">!=</span>&nbsp;<span class="ident" id="2383822">nil</span>&nbsp;<span class="op" id="2383826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383830">return</span>&nbsp;<span class="ident" id="2383837">nil</span><span class="op" id="2383840">,</span>&nbsp;<span class="ident" id="2383842">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383850">var</span>&nbsp;<span class="ident" id="2383854">tab</span>&nbsp;<span class="op" id="2383858">[</span><span class="op" id="2383859">]</span><span class="builtintype" id="2383860">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383866">rbNew</span>&nbsp;<span class="op" id="2383872">:=</span>&nbsp;<span class="builtinfunc" id="2383875">make</span><span class="op" id="2383879">(</span><span class="op" id="2383880">[</span><span class="op" id="2383881">]</span><span class="builtintype" id="2383882">byte</span><span class="op" id="2383886">,</span>&nbsp;<span class="ident" id="2383888">Getpagesize</span><span class="op" id="2383899">(</span><span class="op" id="2383900">)</span><span class="op" id="2383901">)</span><br>
<span class="lineno"></span><span class="ident" id="2383903">done</span><span class="op" id="2383907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383910">for</span>&nbsp;<span class="op" id="2383914">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383918">rb</span>&nbsp;<span class="op" id="2383921">:=</span>&nbsp;<span class="ident" id="2383924">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383932">nr</span><span class="op" id="2383934">,</span>&nbsp;<span class="ident" id="2383936">_</span><span class="op" id="2383937">,</span>&nbsp;<span class="ident" id="2383939">err</span>&nbsp;<span class="op" id="2383943">:=</span>&nbsp;<span class="ident" id="2383946">Recvfrom</span><span class="op" id="2383954">(</span><span class="ident" id="2383955">s</span><span class="op" id="2383956">,</span>&nbsp;<span class="ident" id="2383958">rb</span><span class="op" id="2383960">,</span>&nbsp;<span class="num" id="2383962">0</span><span class="op" id="2383963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383967">if</span>&nbsp;<span class="ident" id="2383970">err</span>&nbsp;<span class="op" id="2383974">!=</span>&nbsp;<span class="ident" id="2383977">nil</span>&nbsp;<span class="op" id="2383981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383986">return</span>&nbsp;<span class="ident" id="2383993">nil</span><span class="op" id="2383996">,</span>&nbsp;<span class="ident" id="2383998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384004">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384008">if</span>&nbsp;<span class="ident" id="2384011">nr</span>&nbsp;<span class="op" id="2384014">&lt;</span>&nbsp;<span class="ident" id="2384016">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2384029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384034">return</span>&nbsp;<span class="ident" id="2384041">nil</span><span class="op" id="2384044">,</span>&nbsp;<span class="ident" id="2384046">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384059">rb</span>&nbsp;<span class="op" id="2384062">=</span>&nbsp;<span class="ident" id="2384064">rb</span><span class="op" id="2384066">[</span><span class="op" id="2384067">:</span><span class="ident" id="2384068">nr</span><span class="op" id="2384070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384074">tab</span>&nbsp;<span class="op" id="2384078">=</span>&nbsp;<span class="builtinfunc" id="2384080">append</span><span class="op" id="2384086">(</span><span class="ident" id="2384087">tab</span><span class="op" id="2384090">,</span>&nbsp;<span class="ident" id="2384092">rb</span><span class="op" id="2384094">...</span><span class="op" id="2384097">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384101">msgs</span><span class="op" id="2384105">,</span>&nbsp;<span class="ident" id="2384107">err</span>&nbsp;<span class="op" id="2384111">:=</span>&nbsp;<span class="ident" id="2384114">ParseNetlinkMessage</span><span class="op" id="2384133">(</span><span class="ident" id="2384134">rb</span><span class="op" id="2384136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384140">if</span>&nbsp;<span class="ident" id="2384143">err</span>&nbsp;<span class="op" id="2384147">!=</span>&nbsp;<span class="ident" id="2384150">nil</span>&nbsp;<span class="op" id="2384154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384159">return</span>&nbsp;<span class="ident" id="2384166">nil</span><span class="op" id="2384169">,</span>&nbsp;<span class="ident" id="2384171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384181">for</span>&nbsp;<span class="ident" id="2384185">_</span><span class="op" id="2384186">,</span>&nbsp;<span class="ident" id="2384188">m</span>&nbsp;<span class="op" id="2384190">:=</span>&nbsp;<span class="keyword" id="2384193">range</span>&nbsp;<span class="ident" id="2384199">msgs</span>&nbsp;<span class="op" id="2384204">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384209">lsa</span><span class="op" id="2384212">,</span>&nbsp;<span class="ident" id="2384214">err</span>&nbsp;<span class="op" id="2384218">:=</span>&nbsp;<span class="ident" id="2384221">Getsockname</span><span class="op" id="2384232">(</span><span class="ident" id="2384233">s</span><span class="op" id="2384234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384239">if</span>&nbsp;<span class="ident" id="2384242">err</span>&nbsp;<span class="op" id="2384246">!=</span>&nbsp;<span class="ident" id="2384249">nil</span>&nbsp;<span class="op" id="2384253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384259">return</span>&nbsp;<span class="ident" id="2384266">nil</span><span class="op" id="2384269">,</span>&nbsp;<span class="ident" id="2384271">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384283">switch</span>&nbsp;<span class="ident" id="2384290">v</span>&nbsp;<span class="op" id="2384292">:=</span>&nbsp;<span class="ident" id="2384295">lsa</span><span class="op" id="2384298">.</span><span class="op" id="2384299">(</span><span class="keyword" id="2384300">type</span><span class="op" id="2384304">)</span>&nbsp;<span class="op" id="2384306">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384311">case</span>&nbsp;<span class="op" id="2384316">*</span><span class="ident" id="2384317">SockaddrNetlink</span><span class="op" id="2384332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384338">if</span>&nbsp;<span class="ident" id="2384341">m</span><span class="op" id="2384342">.</span><span class="ident" id="2384343">Header</span><span class="op" id="2384349">.</span><span class="ident" id="2384350">Seq</span>&nbsp;<span class="op" id="2384354">!=</span>&nbsp;<span class="num" id="2384357">1</span>&nbsp;<span class="op" id="2384359">||</span>&nbsp;<span class="ident" id="2384362">m</span><span class="op" id="2384363">.</span><span class="ident" id="2384364">Header</span><span class="op" id="2384370">.</span><span class="ident" id="2384371">Pid</span>&nbsp;<span class="op" id="2384375">!=</span>&nbsp;<span class="ident" id="2384378">v</span><span class="op" id="2384379">.</span><span class="ident" id="2384380">Pid</span>&nbsp;<span class="op" id="2384384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384391">return</span>&nbsp;<span class="ident" id="2384398">nil</span><span class="op" id="2384401">,</span>&nbsp;<span class="ident" id="2384403">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384419">default</span><span class="op" id="2384426">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384432">return</span>&nbsp;<span class="ident" id="2384439">nil</span><span class="op" id="2384442">,</span>&nbsp;<span class="ident" id="2384444">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384459">if</span>&nbsp;<span class="ident" id="2384462">m</span><span class="op" id="2384463">.</span><span class="ident" id="2384464">Header</span><span class="op" id="2384470">.</span><span class="ident" id="2384471">Type</span>&nbsp;<span class="op" id="2384476">==</span>&nbsp;<span class="ident" id="2384479">NLMSG_DONE</span>&nbsp;<span class="op" id="2384490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384496">break</span>&nbsp;<span class="ident" id="2384502">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384510">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384515">if</span>&nbsp;<span class="ident" id="2384518">m</span><span class="op" id="2384519">.</span><span class="ident" id="2384520">Header</span><span class="op" id="2384526">.</span><span class="ident" id="2384527">Type</span>&nbsp;<span class="op" id="2384532">==</span>&nbsp;<span class="ident" id="2384535">NLMSG_ERROR</span>&nbsp;<span class="op" id="2384547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384553">return</span>&nbsp;<span class="ident" id="2384560">nil</span><span class="op" id="2384563">,</span>&nbsp;<span class="ident" id="2384565">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384582">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384585">return</span>&nbsp;<span class="ident" id="2384592">tab</span><span class="op" id="2384595">,</span>&nbsp;<span class="ident" id="2384597">nil</span><br>
<span class="lineno"></span><span class="op" id="2384601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384604">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2384652">type</span>&nbsp;<span class="ident" id="2384657">NetlinkMessage</span>&nbsp;<span class="keyword" id="2384672">struct</span>&nbsp;<span class="op" id="2384679">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384682">Header</span>&nbsp;<span class="ident" id="2384689">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384699">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2384706">[</span><span class="op" id="2384707">]</span><span class="builtintype" id="2384708">byte</span><br>
<span class="lineno"></span><span class="op" id="2384713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384716">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2384784">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2384847">func</span>&nbsp;<span class="ident" id="2384852">ParseNetlinkMessage</span><span class="op" id="2384871">(</span><span class="ident" id="2384872">b</span>&nbsp;<span class="op" id="2384874">[</span><span class="op" id="2384875">]</span><span class="builtintype" id="2384876">byte</span><span class="op" id="2384880">)</span>&nbsp;<span class="op" id="2384882">(</span><span class="op" id="2384883">[</span><span class="op" id="2384884">]</span><span class="ident" id="2384885">NetlinkMessage</span><span class="op" id="2384899">,</span>&nbsp;<span class="builtintype" id="2384901">error</span><span class="op" id="2384906">)</span>&nbsp;<span class="op" id="2384908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384911">var</span>&nbsp;<span class="ident" id="2384915">msgs</span>&nbsp;<span class="op" id="2384920">[</span><span class="op" id="2384921">]</span><span class="ident" id="2384922">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384938">for</span>&nbsp;<span class="builtinfunc" id="2384942">len</span><span class="op" id="2384945">(</span><span class="ident" id="2384946">b</span><span class="op" id="2384947">)</span>&nbsp;<span class="op" id="2384949">&gt;=</span>&nbsp;<span class="ident" id="2384952">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2384965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384969">h</span><span class="op" id="2384970">,</span>&nbsp;<span class="ident" id="2384972">dbuf</span><span class="op" id="2384976">,</span>&nbsp;<span class="ident" id="2384978">dlen</span><span class="op" id="2384982">,</span>&nbsp;<span class="ident" id="2384984">err</span>&nbsp;<span class="op" id="2384988">:=</span>&nbsp;<span class="ident" id="2384991">netlinkMessageHeaderAndData</span><span class="op" id="2385018">(</span><span class="ident" id="2385019">b</span><span class="op" id="2385020">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385024">if</span>&nbsp;<span class="ident" id="2385027">err</span>&nbsp;<span class="op" id="2385031">!=</span>&nbsp;<span class="ident" id="2385034">nil</span>&nbsp;<span class="op" id="2385038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385043">return</span>&nbsp;<span class="ident" id="2385050">nil</span><span class="op" id="2385053">,</span>&nbsp;<span class="ident" id="2385055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385065">m</span>&nbsp;<span class="op" id="2385067">:=</span>&nbsp;<span class="ident" id="2385070">NetlinkMessage</span><span class="op" id="2385084">{</span><span class="ident" id="2385085">Header</span><span class="op" id="2385091">:</span>&nbsp;<span class="op" id="2385093">*</span><span class="ident" id="2385094">h</span><span class="op" id="2385095">,</span>&nbsp;<span class="ident" id="2385097">Data</span><span class="op" id="2385101">:</span>&nbsp;<span class="ident" id="2385103">dbuf</span><span class="op" id="2385107">[</span><span class="op" id="2385108">:</span><span class="builtintype" id="2385109">int</span><span class="op" id="2385112">(</span><span class="ident" id="2385113">h</span><span class="op" id="2385114">.</span><span class="ident" id="2385115">Len</span><span class="op" id="2385118">)</span><span class="op" id="2385119">-</span><span class="ident" id="2385120">NLMSG_HDRLEN</span><span class="op" id="2385132">]</span><span class="op" id="2385133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385137">msgs</span>&nbsp;<span class="op" id="2385142">=</span>&nbsp;<span class="builtinfunc" id="2385144">append</span><span class="op" id="2385150">(</span><span class="ident" id="2385151">msgs</span><span class="op" id="2385155">,</span>&nbsp;<span class="ident" id="2385157">m</span><span class="op" id="2385158">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385162">b</span>&nbsp;<span class="op" id="2385164">=</span>&nbsp;<span class="ident" id="2385166">b</span><span class="op" id="2385167">[</span><span class="ident" id="2385168">dlen</span><span class="op" id="2385172">:</span><span class="op" id="2385173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385179">return</span>&nbsp;<span class="ident" id="2385186">msgs</span><span class="op" id="2385190">,</span>&nbsp;<span class="ident" id="2385192">nil</span><br>
<span class="lineno"></span><span class="op" id="2385196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2385199">func</span>&nbsp;<span class="ident" id="2385204">netlinkMessageHeaderAndData</span><span class="op" id="2385231">(</span><span class="ident" id="2385232">b</span>&nbsp;<span class="op" id="2385234">[</span><span class="op" id="2385235">]</span><span class="builtintype" id="2385236">byte</span><span class="op" id="2385240">)</span>&nbsp;<span class="op" id="2385242">(</span><span class="op" id="2385243">*</span><span class="ident" id="2385244">NlMsghdr</span><span class="op" id="2385252">,</span>&nbsp;<span class="op" id="2385254">[</span><span class="op" id="2385255">]</span><span class="builtintype" id="2385256">byte</span><span class="op" id="2385260">,</span>&nbsp;<span class="builtintype" id="2385262">int</span><span class="op" id="2385265">,</span>&nbsp;<span class="builtintype" id="2385267">error</span><span class="op" id="2385272">)</span>&nbsp;<span class="op" id="2385274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385277">h</span>&nbsp;<span class="op" id="2385279">:=</span>&nbsp;<span class="op" id="2385282">(</span><span class="op" id="2385283">*</span><span class="ident" id="2385284">NlMsghdr</span><span class="op" id="2385292">)</span><span class="op" id="2385293">(</span><span class="ident" id="2385294">unsafe</span><span class="op" id="2385300">.</span><span class="ident" id="2385301">Pointer</span><span class="op" id="2385308">(</span><span class="op" id="2385309">&amp;</span><span class="ident" id="2385310">b</span><span class="op" id="2385311">[</span><span class="num" id="2385312">0</span><span class="op" id="2385313">]</span><span class="op" id="2385314">)</span><span class="op" id="2385315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385318">if</span>&nbsp;<span class="builtintype" id="2385321">int</span><span class="op" id="2385324">(</span><span class="ident" id="2385325">h</span><span class="op" id="2385326">.</span><span class="ident" id="2385327">Len</span><span class="op" id="2385330">)</span>&nbsp;<span class="op" id="2385332">&lt;</span>&nbsp;<span class="ident" id="2385334">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2385347">||</span>&nbsp;<span class="builtintype" id="2385350">int</span><span class="op" id="2385353">(</span><span class="ident" id="2385354">h</span><span class="op" id="2385355">.</span><span class="ident" id="2385356">Len</span><span class="op" id="2385359">)</span>&nbsp;<span class="op" id="2385361">&gt;</span>&nbsp;<span class="builtinfunc" id="2385363">len</span><span class="op" id="2385366">(</span><span class="ident" id="2385367">b</span><span class="op" id="2385368">)</span>&nbsp;<span class="op" id="2385370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385374">return</span>&nbsp;<span class="ident" id="2385381">nil</span><span class="op" id="2385384">,</span>&nbsp;<span class="ident" id="2385386">nil</span><span class="op" id="2385389">,</span>&nbsp;<span class="num" id="2385391">0</span><span class="op" id="2385392">,</span>&nbsp;<span class="ident" id="2385394">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385402">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385405">return</span>&nbsp;<span class="ident" id="2385412">h</span><span class="op" id="2385413">,</span>&nbsp;<span class="ident" id="2385415">b</span><span class="op" id="2385416">[</span><span class="ident" id="2385417">NLMSG_HDRLEN</span><span class="op" id="2385429">:</span><span class="op" id="2385430">]</span><span class="op" id="2385431">,</span>&nbsp;<span class="ident" id="2385433">nlmAlignOf</span><span class="op" id="2385443">(</span><span class="builtintype" id="2385444">int</span><span class="op" id="2385447">(</span><span class="ident" id="2385448">h</span><span class="op" id="2385449">.</span><span class="ident" id="2385450">Len</span><span class="op" id="2385453">)</span><span class="op" id="2385454">)</span><span class="op" id="2385455">,</span>&nbsp;<span class="ident" id="2385457">nil</span><br>
<span class="lineno"></span><span class="op" id="2385461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2385464">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2385522">type</span>&nbsp;<span class="ident" id="2385527">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2385544">struct</span>&nbsp;<span class="op" id="2385551">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385554">Attr</span>&nbsp;&nbsp;<span class="ident" id="2385560">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385568">Value</span>&nbsp;<span class="op" id="2385574">[</span><span class="op" id="2385575">]</span><span class="builtintype" id="2385576">byte</span><br>
<span class="lineno"></span><span class="op" id="2385581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2385584">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2385651">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2385708">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2385740">func</span>&nbsp;<span class="ident" id="2385745">ParseNetlinkRouteAttr</span><span class="op" id="2385766">(</span><span class="ident" id="2385767">m</span>&nbsp;<span class="op" id="2385769">*</span><span class="ident" id="2385770">NetlinkMessage</span><span class="op" id="2385784">)</span>&nbsp;<span class="op" id="2385786">(</span><span class="op" id="2385787">[</span><span class="op" id="2385788">]</span><span class="ident" id="2385789">NetlinkRouteAttr</span><span class="op" id="2385805">,</span>&nbsp;<span class="builtintype" id="2385807">error</span><span class="op" id="2385812">)</span>&nbsp;<span class="op" id="2385814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385817">var</span>&nbsp;<span class="ident" id="2385821">b</span>&nbsp;<span class="op" id="2385823">[</span><span class="op" id="2385824">]</span><span class="builtintype" id="2385825">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385831">switch</span>&nbsp;<span class="ident" id="2385838">m</span><span class="op" id="2385839">.</span><span class="ident" id="2385840">Header</span><span class="op" id="2385846">.</span><span class="ident" id="2385847">Type</span>&nbsp;<span class="op" id="2385852">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385855">case</span>&nbsp;<span class="ident" id="2385860">RTM_NEWLINK</span><span class="op" id="2385871">,</span>&nbsp;<span class="ident" id="2385873">RTM_DELLINK</span><span class="op" id="2385884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385888">b</span>&nbsp;<span class="op" id="2385890">=</span>&nbsp;<span class="ident" id="2385892">m</span><span class="op" id="2385893">.</span><span class="ident" id="2385894">Data</span><span class="op" id="2385898">[</span><span class="ident" id="2385899">SizeofIfInfomsg</span><span class="op" id="2385914">:</span><span class="op" id="2385915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385918">case</span>&nbsp;<span class="ident" id="2385923">RTM_NEWADDR</span><span class="op" id="2385934">,</span>&nbsp;<span class="ident" id="2385936">RTM_DELADDR</span><span class="op" id="2385947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385951">b</span>&nbsp;<span class="op" id="2385953">=</span>&nbsp;<span class="ident" id="2385955">m</span><span class="op" id="2385956">.</span><span class="ident" id="2385957">Data</span><span class="op" id="2385961">[</span><span class="ident" id="2385962">SizeofIfAddrmsg</span><span class="op" id="2385977">:</span><span class="op" id="2385978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385981">case</span>&nbsp;<span class="ident" id="2385986">RTM_NEWROUTE</span><span class="op" id="2385998">,</span>&nbsp;<span class="ident" id="2386000">RTM_DELROUTE</span><span class="op" id="2386012">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386016">b</span>&nbsp;<span class="op" id="2386018">=</span>&nbsp;<span class="ident" id="2386020">m</span><span class="op" id="2386021">.</span><span class="ident" id="2386022">Data</span><span class="op" id="2386026">[</span><span class="ident" id="2386027">SizeofRtMsg</span><span class="op" id="2386038">:</span><span class="op" id="2386039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386042">default</span><span class="op" id="2386049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386053">return</span>&nbsp;<span class="ident" id="2386060">nil</span><span class="op" id="2386063">,</span>&nbsp;<span class="ident" id="2386065">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386076">var</span>&nbsp;<span class="ident" id="2386080">attrs</span>&nbsp;<span class="op" id="2386086">[</span><span class="op" id="2386087">]</span><span class="ident" id="2386088">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386106">for</span>&nbsp;<span class="builtinfunc" id="2386110">len</span><span class="op" id="2386113">(</span><span class="ident" id="2386114">b</span><span class="op" id="2386115">)</span>&nbsp;<span class="op" id="2386117">&gt;=</span>&nbsp;<span class="ident" id="2386120">SizeofRtAttr</span>&nbsp;<span class="op" id="2386133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386137">a</span><span class="op" id="2386138">,</span>&nbsp;<span class="ident" id="2386140">vbuf</span><span class="op" id="2386144">,</span>&nbsp;<span class="ident" id="2386146">alen</span><span class="op" id="2386150">,</span>&nbsp;<span class="ident" id="2386152">err</span>&nbsp;<span class="op" id="2386156">:=</span>&nbsp;<span class="ident" id="2386159">netlinkRouteAttrAndValue</span><span class="op" id="2386183">(</span><span class="ident" id="2386184">b</span><span class="op" id="2386185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386189">if</span>&nbsp;<span class="ident" id="2386192">err</span>&nbsp;<span class="op" id="2386196">!=</span>&nbsp;<span class="ident" id="2386199">nil</span>&nbsp;<span class="op" id="2386203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386208">return</span>&nbsp;<span class="ident" id="2386215">nil</span><span class="op" id="2386218">,</span>&nbsp;<span class="ident" id="2386220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386226">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386230">ra</span>&nbsp;<span class="op" id="2386233">:=</span>&nbsp;<span class="ident" id="2386236">NetlinkRouteAttr</span><span class="op" id="2386252">{</span><span class="ident" id="2386253">Attr</span><span class="op" id="2386257">:</span>&nbsp;<span class="op" id="2386259">*</span><span class="ident" id="2386260">a</span><span class="op" id="2386261">,</span>&nbsp;<span class="ident" id="2386263">Value</span><span class="op" id="2386268">:</span>&nbsp;<span class="ident" id="2386270">vbuf</span><span class="op" id="2386274">[</span><span class="op" id="2386275">:</span><span class="builtintype" id="2386276">int</span><span class="op" id="2386279">(</span><span class="ident" id="2386280">a</span><span class="op" id="2386281">.</span><span class="ident" id="2386282">Len</span><span class="op" id="2386285">)</span><span class="op" id="2386286">-</span><span class="ident" id="2386287">SizeofRtAttr</span><span class="op" id="2386299">]</span><span class="op" id="2386300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386304">attrs</span>&nbsp;<span class="op" id="2386310">=</span>&nbsp;<span class="builtinfunc" id="2386312">append</span><span class="op" id="2386318">(</span><span class="ident" id="2386319">attrs</span><span class="op" id="2386324">,</span>&nbsp;<span class="ident" id="2386326">ra</span><span class="op" id="2386328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386332">b</span>&nbsp;<span class="op" id="2386334">=</span>&nbsp;<span class="ident" id="2386336">b</span><span class="op" id="2386337">[</span><span class="ident" id="2386338">alen</span><span class="op" id="2386342">:</span><span class="op" id="2386343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386349">return</span>&nbsp;<span class="ident" id="2386356">attrs</span><span class="op" id="2386361">,</span>&nbsp;<span class="ident" id="2386363">nil</span><br>
<span class="lineno">170</span><span class="op" id="2386367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2386370">func</span>&nbsp;<span class="ident" id="2386375">netlinkRouteAttrAndValue</span><span class="op" id="2386399">(</span><span class="ident" id="2386400">b</span>&nbsp;<span class="op" id="2386402">[</span><span class="op" id="2386403">]</span><span class="builtintype" id="2386404">byte</span><span class="op" id="2386408">)</span>&nbsp;<span class="op" id="2386410">(</span><span class="op" id="2386411">*</span><span class="ident" id="2386412">RtAttr</span><span class="op" id="2386418">,</span>&nbsp;<span class="op" id="2386420">[</span><span class="op" id="2386421">]</span><span class="builtintype" id="2386422">byte</span><span class="op" id="2386426">,</span>&nbsp;<span class="builtintype" id="2386428">int</span><span class="op" id="2386431">,</span>&nbsp;<span class="builtintype" id="2386433">error</span><span class="op" id="2386438">)</span>&nbsp;<span class="op" id="2386440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386443">a</span>&nbsp;<span class="op" id="2386445">:=</span>&nbsp;<span class="op" id="2386448">(</span><span class="op" id="2386449">*</span><span class="ident" id="2386450">RtAttr</span><span class="op" id="2386456">)</span><span class="op" id="2386457">(</span><span class="ident" id="2386458">unsafe</span><span class="op" id="2386464">.</span><span class="ident" id="2386465">Pointer</span><span class="op" id="2386472">(</span><span class="op" id="2386473">&amp;</span><span class="ident" id="2386474">b</span><span class="op" id="2386475">[</span><span class="num" id="2386476">0</span><span class="op" id="2386477">]</span><span class="op" id="2386478">)</span><span class="op" id="2386479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386482">if</span>&nbsp;<span class="builtintype" id="2386485">int</span><span class="op" id="2386488">(</span><span class="ident" id="2386489">a</span><span class="op" id="2386490">.</span><span class="ident" id="2386491">Len</span><span class="op" id="2386494">)</span>&nbsp;<span class="op" id="2386496">&lt;</span>&nbsp;<span class="ident" id="2386498">SizeofRtAttr</span>&nbsp;<span class="op" id="2386511">||</span>&nbsp;<span class="builtintype" id="2386514">int</span><span class="op" id="2386517">(</span><span class="ident" id="2386518">a</span><span class="op" id="2386519">.</span><span class="ident" id="2386520">Len</span><span class="op" id="2386523">)</span>&nbsp;<span class="op" id="2386525">&gt;</span>&nbsp;<span class="builtinfunc" id="2386527">len</span><span class="op" id="2386530">(</span><span class="ident" id="2386531">b</span><span class="op" id="2386532">)</span>&nbsp;<span class="op" id="2386534">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386538">return</span>&nbsp;<span class="ident" id="2386545">nil</span><span class="op" id="2386548">,</span>&nbsp;<span class="ident" id="2386550">nil</span><span class="op" id="2386553">,</span>&nbsp;<span class="num" id="2386555">0</span><span class="op" id="2386556">,</span>&nbsp;<span class="ident" id="2386558">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386569">return</span>&nbsp;<span class="ident" id="2386576">a</span><span class="op" id="2386577">,</span>&nbsp;<span class="ident" id="2386579">b</span><span class="op" id="2386580">[</span><span class="ident" id="2386581">SizeofRtAttr</span><span class="op" id="2386593">:</span><span class="op" id="2386594">]</span><span class="op" id="2386595">,</span>&nbsp;<span class="ident" id="2386597">rtaAlignOf</span><span class="op" id="2386607">(</span><span class="builtintype" id="2386608">int</span><span class="op" id="2386611">(</span><span class="ident" id="2386612">a</span><span class="op" id="2386613">.</span><span class="ident" id="2386614">Len</span><span class="op" id="2386617">)</span><span class="op" id="2386618">)</span><span class="op" id="2386619">,</span>&nbsp;<span class="ident" id="2386621">nil</span><br>
<span class="lineno"></span><span class="op" id="2386625">}</span>
</div>
</body>
</html>
