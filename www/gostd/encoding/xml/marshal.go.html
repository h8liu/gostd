<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html" class="current">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5810279">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5810334">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5810388">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5810439">package</span>&nbsp;<span class="ident" id="5810447">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5810452">import</span>&nbsp;<span class="op" id="5810459">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810462">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810471">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810480">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810492">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810499">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810505">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810516">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5810527">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5810537">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5810540">const</span>&nbsp;<span class="op" id="5810546">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5810549">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5810619">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5810686">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5810723">Header</span>&nbsp;<span class="op" id="5810730">=</span>&nbsp;<span class="string" id="5810732">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="5810773">+</span>&nbsp;<span class="string" id="5810775">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="5810780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5810783">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5810825">//</span><br>
<span class="lineno"></span><span class="comment" id="5810828">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5810902">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5810980">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="5811058">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5811133">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="5811212">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5811245">//</span><br>
<span class="lineno"></span><span class="comment" id="5811248">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="5811320">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="5811383">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="5811440">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5811501">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5811563">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="5811604">//</span><br>
<span class="lineno"></span><span class="comment" id="5811607">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5811684">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="5811741">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="5811798">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="5811840">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5811904">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5811948">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5812012">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5812052">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="5812120">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5812152">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="5812223">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="5812268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5812339">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="5812412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5812448">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="5812520">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5812593">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5812664">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="5812696">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5812766">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="5812812">//</span><br>
<span class="lineno"></span><span class="comment" id="5812815">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="5812890">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="5812967">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="5813023">//</span><br>
<span class="lineno"></span><span class="comment" id="5813026">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="5813063">//</span><br>
<span class="lineno"></span><span class="comment" id="5813066">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="5813147">func</span>&nbsp;<span class="ident" id="5813152">Marshal</span><span class="op" id="5813159">(</span><span class="ident" id="5813160">v</span>&nbsp;<span class="keyword" id="5813162">interface</span><span class="op" id="5813171">{</span><span class="op" id="5813172">}</span><span class="op" id="5813173">)</span>&nbsp;<span class="op" id="5813175">(</span><span class="op" id="5813176">[</span><span class="op" id="5813177">]</span><span class="builtintype" id="5813178">byte</span><span class="op" id="5813182">,</span>&nbsp;<span class="builtintype" id="5813184">error</span><span class="op" id="5813189">)</span>&nbsp;<span class="op" id="5813191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813194">var</span>&nbsp;<span class="ident" id="5813198">b</span>&nbsp;<span class="ident" id="5813200">bytes</span><span class="op" id="5813205">.</span><span class="ident" id="5813206">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813214">if</span>&nbsp;<span class="ident" id="5813217">err</span>&nbsp;<span class="op" id="5813221">:=</span>&nbsp;<span class="ident" id="5813224">NewEncoder</span><span class="op" id="5813234">(</span><span class="op" id="5813235">&amp;</span><span class="ident" id="5813236">b</span><span class="op" id="5813237">)</span><span class="op" id="5813238">.</span><span class="ident" id="5813239">Encode</span><span class="op" id="5813245">(</span><span class="ident" id="5813246">v</span><span class="op" id="5813247">)</span><span class="op" id="5813248">;</span>&nbsp;<span class="ident" id="5813250">err</span>&nbsp;<span class="op" id="5813254">!=</span>&nbsp;<span class="ident" id="5813257">nil</span>&nbsp;<span class="op" id="5813261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813265">return</span>&nbsp;<span class="ident" id="5813272">nil</span><span class="op" id="5813275">,</span>&nbsp;<span class="ident" id="5813277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813282">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813285">return</span>&nbsp;<span class="ident" id="5813292">b</span><span class="op" id="5813293">.</span><span class="ident" id="5813294">Bytes</span><span class="op" id="5813299">(</span><span class="op" id="5813300">)</span><span class="op" id="5813301">,</span>&nbsp;<span class="ident" id="5813303">nil</span><br>
<span class="lineno"></span><span class="op" id="5813307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5813310">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5813380">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="5813419">//</span><br>
<span class="lineno"></span><span class="comment" id="5813422">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="5813487">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5813558">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5813589">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="5813653">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5813719">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="5813736">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="5813801">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5813866">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="5813905">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="5813974">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5814025">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="5814091">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5814108">type</span>&nbsp;<span class="ident" id="5814113">Marshaler</span>&nbsp;<span class="keyword" id="5814123">interface</span>&nbsp;<span class="op" id="5814133">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814136">MarshalXML</span><span class="op" id="5814146">(</span><span class="ident" id="5814147">e</span>&nbsp;<span class="op" id="5814149">*</span><span class="ident" id="5814150">Encoder</span><span class="op" id="5814157">,</span>&nbsp;<span class="ident" id="5814159">start</span>&nbsp;<span class="ident" id="5814165">StartElement</span><span class="op" id="5814177">)</span>&nbsp;<span class="builtintype" id="5814179">error</span><br>
<span class="lineno"></span><span class="op" id="5814185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5814188">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="5814262">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="5814303">//</span><br>
<span class="lineno"></span><span class="comment" id="5814306">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="5814389">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5814455">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="5814518">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="5814535">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="5814604">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5814640">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5814698">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="5814733">type</span>&nbsp;<span class="ident" id="5814738">MarshalerAttr</span>&nbsp;<span class="keyword" id="5814752">interface</span>&nbsp;<span class="op" id="5814762">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814765">MarshalXMLAttr</span><span class="op" id="5814779">(</span><span class="ident" id="5814780">name</span>&nbsp;<span class="ident" id="5814785">Name</span><span class="op" id="5814789">)</span>&nbsp;<span class="op" id="5814791">(</span><span class="ident" id="5814792">Attr</span><span class="op" id="5814796">,</span>&nbsp;<span class="builtintype" id="5814798">error</span><span class="op" id="5814803">)</span><br>
<span class="lineno"></span><span class="op" id="5814805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5814808">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="5814882">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="5814954">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5815006">func</span>&nbsp;<span class="ident" id="5815011">MarshalIndent</span><span class="op" id="5815024">(</span><span class="ident" id="5815025">v</span>&nbsp;<span class="keyword" id="5815027">interface</span><span class="op" id="5815036">{</span><span class="op" id="5815037">}</span><span class="op" id="5815038">,</span>&nbsp;<span class="ident" id="5815040">prefix</span><span class="op" id="5815046">,</span>&nbsp;<span class="ident" id="5815048">indent</span>&nbsp;<span class="builtintype" id="5815055">string</span><span class="op" id="5815061">)</span>&nbsp;<span class="op" id="5815063">(</span><span class="op" id="5815064">[</span><span class="op" id="5815065">]</span><span class="builtintype" id="5815066">byte</span><span class="op" id="5815070">,</span>&nbsp;<span class="builtintype" id="5815072">error</span><span class="op" id="5815077">)</span>&nbsp;<span class="op" id="5815079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815082">var</span>&nbsp;<span class="ident" id="5815086">b</span>&nbsp;<span class="ident" id="5815088">bytes</span><span class="op" id="5815093">.</span><span class="ident" id="5815094">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815102">enc</span>&nbsp;<span class="op" id="5815106">:=</span>&nbsp;<span class="ident" id="5815109">NewEncoder</span><span class="op" id="5815119">(</span><span class="op" id="5815120">&amp;</span><span class="ident" id="5815121">b</span><span class="op" id="5815122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815125">enc</span><span class="op" id="5815128">.</span><span class="ident" id="5815129">Indent</span><span class="op" id="5815135">(</span><span class="ident" id="5815136">prefix</span><span class="op" id="5815142">,</span>&nbsp;<span class="ident" id="5815144">indent</span><span class="op" id="5815150">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815153">if</span>&nbsp;<span class="ident" id="5815156">err</span>&nbsp;<span class="op" id="5815160">:=</span>&nbsp;<span class="ident" id="5815163">enc</span><span class="op" id="5815166">.</span><span class="ident" id="5815167">Encode</span><span class="op" id="5815173">(</span><span class="ident" id="5815174">v</span><span class="op" id="5815175">)</span><span class="op" id="5815176">;</span>&nbsp;<span class="ident" id="5815178">err</span>&nbsp;<span class="op" id="5815182">!=</span>&nbsp;<span class="ident" id="5815185">nil</span>&nbsp;<span class="op" id="5815189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815193">return</span>&nbsp;<span class="ident" id="5815200">nil</span><span class="op" id="5815203">,</span>&nbsp;<span class="ident" id="5815205">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815213">return</span>&nbsp;<span class="ident" id="5815220">b</span><span class="op" id="5815221">.</span><span class="ident" id="5815222">Bytes</span><span class="op" id="5815227">(</span><span class="op" id="5815228">)</span><span class="op" id="5815229">,</span>&nbsp;<span class="ident" id="5815231">nil</span><br>
<span class="lineno"></span><span class="op" id="5815235">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="5815238">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5815289">type</span>&nbsp;<span class="ident" id="5815294">Encoder</span>&nbsp;<span class="keyword" id="5815302">struct</span>&nbsp;<span class="op" id="5815309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815312">p</span>&nbsp;<span class="ident" id="5815314">printer</span><br>
<span class="lineno"></span><span class="op" id="5815322">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5815325">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5815379">func</span>&nbsp;<span class="ident" id="5815384">NewEncoder</span><span class="op" id="5815394">(</span><span class="ident" id="5815395">w</span>&nbsp;<span class="ident" id="5815397">io</span><span class="op" id="5815399">.</span><span class="ident" id="5815400">Writer</span><span class="op" id="5815406">)</span>&nbsp;<span class="op" id="5815408">*</span><span class="ident" id="5815409">Encoder</span>&nbsp;<span class="op" id="5815417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815420">e</span>&nbsp;<span class="op" id="5815422">:=</span>&nbsp;<span class="op" id="5815425">&amp;</span><span class="ident" id="5815426">Encoder</span><span class="op" id="5815433">{</span><span class="ident" id="5815434">printer</span><span class="op" id="5815441">{</span><span class="ident" id="5815442">Writer</span><span class="op" id="5815448">:</span>&nbsp;<span class="ident" id="5815450">bufio</span><span class="op" id="5815455">.</span><span class="ident" id="5815456">NewWriter</span><span class="op" id="5815465">(</span><span class="ident" id="5815466">w</span><span class="op" id="5815467">)</span><span class="op" id="5815468">}</span><span class="op" id="5815469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815472">e</span><span class="op" id="5815473">.</span><span class="ident" id="5815474">p</span><span class="op" id="5815475">.</span><span class="ident" id="5815476">encoder</span>&nbsp;<span class="op" id="5815484">=</span>&nbsp;<span class="ident" id="5815486">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815489">return</span>&nbsp;<span class="ident" id="5815496">e</span><br>
<span class="lineno"></span><span class="op" id="5815498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5815501">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="5815566">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="5815642">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5815706">func</span>&nbsp;<span class="op" id="5815711">(</span><span class="ident" id="5815712">enc</span>&nbsp;<span class="op" id="5815716">*</span><span class="ident" id="5815717">Encoder</span><span class="op" id="5815724">)</span>&nbsp;<span class="ident" id="5815726">Indent</span><span class="op" id="5815732">(</span><span class="ident" id="5815733">prefix</span><span class="op" id="5815739">,</span>&nbsp;<span class="ident" id="5815741">indent</span>&nbsp;<span class="builtintype" id="5815748">string</span><span class="op" id="5815754">)</span>&nbsp;<span class="op" id="5815756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815759">enc</span><span class="op" id="5815762">.</span><span class="ident" id="5815763">p</span><span class="op" id="5815764">.</span><span class="ident" id="5815765">prefix</span>&nbsp;<span class="op" id="5815772">=</span>&nbsp;<span class="ident" id="5815774">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815782">enc</span><span class="op" id="5815785">.</span><span class="ident" id="5815786">p</span><span class="op" id="5815787">.</span><span class="ident" id="5815788">indent</span>&nbsp;<span class="op" id="5815795">=</span>&nbsp;<span class="ident" id="5815797">indent</span><br>
<span class="lineno"></span><span class="op" id="5815804">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="5815807">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5815861">//</span><br>
<span class="lineno"></span><span class="comment" id="5815864">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5815934">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="5815958">//</span><br>
<span class="lineno"></span><span class="comment" id="5815961">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5816001">func</span>&nbsp;<span class="op" id="5816006">(</span><span class="ident" id="5816007">enc</span>&nbsp;<span class="op" id="5816011">*</span><span class="ident" id="5816012">Encoder</span><span class="op" id="5816019">)</span>&nbsp;<span class="ident" id="5816021">Encode</span><span class="op" id="5816027">(</span><span class="ident" id="5816028">v</span>&nbsp;<span class="keyword" id="5816030">interface</span><span class="op" id="5816039">{</span><span class="op" id="5816040">}</span><span class="op" id="5816041">)</span>&nbsp;<span class="builtintype" id="5816043">error</span>&nbsp;<span class="op" id="5816049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816052">err</span>&nbsp;<span class="op" id="5816056">:=</span>&nbsp;<span class="ident" id="5816059">enc</span><span class="op" id="5816062">.</span><span class="ident" id="5816063">p</span><span class="op" id="5816064">.</span><span class="ident" id="5816065">marshalValue</span><span class="op" id="5816077">(</span><span class="ident" id="5816078">reflect</span><span class="op" id="5816085">.</span><span class="ident" id="5816086">ValueOf</span><span class="op" id="5816093">(</span><span class="ident" id="5816094">v</span><span class="op" id="5816095">)</span><span class="op" id="5816096">,</span>&nbsp;<span class="ident" id="5816098">nil</span><span class="op" id="5816101">,</span>&nbsp;<span class="ident" id="5816103">nil</span><span class="op" id="5816106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816109">if</span>&nbsp;<span class="ident" id="5816112">err</span>&nbsp;<span class="op" id="5816116">!=</span>&nbsp;<span class="ident" id="5816119">nil</span>&nbsp;<span class="op" id="5816123">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816127">return</span>&nbsp;<span class="ident" id="5816134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5816139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816142">return</span>&nbsp;<span class="ident" id="5816149">enc</span><span class="op" id="5816152">.</span><span class="ident" id="5816153">p</span><span class="op" id="5816154">.</span><span class="ident" id="5816155">Flush</span><span class="op" id="5816160">(</span><span class="op" id="5816161">)</span><br>
<span class="lineno"></span><span class="op" id="5816163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5816166">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5816227">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="5816280">//</span><br>
<span class="lineno"></span><span class="comment" id="5816283">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="5816353">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="5816377">//</span><br>
<span class="lineno"></span><span class="comment" id="5816380">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="5816427">func</span>&nbsp;<span class="op" id="5816432">(</span><span class="ident" id="5816433">enc</span>&nbsp;<span class="op" id="5816437">*</span><span class="ident" id="5816438">Encoder</span><span class="op" id="5816445">)</span>&nbsp;<span class="ident" id="5816447">EncodeElement</span><span class="op" id="5816460">(</span><span class="ident" id="5816461">v</span>&nbsp;<span class="keyword" id="5816463">interface</span><span class="op" id="5816472">{</span><span class="op" id="5816473">}</span><span class="op" id="5816474">,</span>&nbsp;<span class="ident" id="5816476">start</span>&nbsp;<span class="ident" id="5816482">StartElement</span><span class="op" id="5816494">)</span>&nbsp;<span class="builtintype" id="5816496">error</span>&nbsp;<span class="op" id="5816502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816505">err</span>&nbsp;<span class="op" id="5816509">:=</span>&nbsp;<span class="ident" id="5816512">enc</span><span class="op" id="5816515">.</span><span class="ident" id="5816516">p</span><span class="op" id="5816517">.</span><span class="ident" id="5816518">marshalValue</span><span class="op" id="5816530">(</span><span class="ident" id="5816531">reflect</span><span class="op" id="5816538">.</span><span class="ident" id="5816539">ValueOf</span><span class="op" id="5816546">(</span><span class="ident" id="5816547">v</span><span class="op" id="5816548">)</span><span class="op" id="5816549">,</span>&nbsp;<span class="ident" id="5816551">nil</span><span class="op" id="5816554">,</span>&nbsp;<span class="op" id="5816556">&amp;</span><span class="ident" id="5816557">start</span><span class="op" id="5816562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816565">if</span>&nbsp;<span class="ident" id="5816568">err</span>&nbsp;<span class="op" id="5816572">!=</span>&nbsp;<span class="ident" id="5816575">nil</span>&nbsp;<span class="op" id="5816579">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816583">return</span>&nbsp;<span class="ident" id="5816590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5816595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816598">return</span>&nbsp;<span class="ident" id="5816605">enc</span><span class="op" id="5816608">.</span><span class="ident" id="5816609">p</span><span class="op" id="5816610">.</span><span class="ident" id="5816611">Flush</span><span class="op" id="5816616">(</span><span class="op" id="5816617">)</span><br>
<span class="lineno"></span><span class="op" id="5816619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="5816622">var</span>&nbsp;<span class="op" id="5816626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816629">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5816642">=</span>&nbsp;<span class="op" id="5816644">[</span><span class="op" id="5816645">]</span><span class="builtintype" id="5816646">byte</span><span class="op" id="5816650">(</span><span class="string" id="5816651">&#34;--&gt;&#34;</span><span class="op" id="5816656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816659">endProcInst</span>&nbsp;&nbsp;<span class="op" id="5816672">=</span>&nbsp;<span class="op" id="5816674">[</span><span class="op" id="5816675">]</span><span class="builtintype" id="5816676">byte</span><span class="op" id="5816680">(</span><span class="string" id="5816681">&#34;?&gt;&#34;</span><span class="op" id="5816685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816688">endDirective</span>&nbsp;<span class="op" id="5816701">=</span>&nbsp;<span class="op" id="5816703">[</span><span class="op" id="5816704">]</span><span class="builtintype" id="5816705">byte</span><span class="op" id="5816709">(</span><span class="string" id="5816710">&#34;&gt;&#34;</span><span class="op" id="5816713">)</span><br>
<span class="lineno"></span><span class="op" id="5816715">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="5816718">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5816775">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="5816862">//</span><br>
<span class="lineno"></span><span class="comment" id="5816865">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="5816950">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="5817029">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="5817088">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5817168">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5817245">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="5817298">//</span><br>
<span class="lineno"></span><span class="comment" id="5817301">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5817391">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5817409">func</span>&nbsp;<span class="op" id="5817414">(</span><span class="ident" id="5817415">enc</span>&nbsp;<span class="op" id="5817419">*</span><span class="ident" id="5817420">Encoder</span><span class="op" id="5817427">)</span>&nbsp;<span class="ident" id="5817429">EncodeToken</span><span class="op" id="5817440">(</span><span class="ident" id="5817441">t</span>&nbsp;<span class="ident" id="5817443">Token</span><span class="op" id="5817448">)</span>&nbsp;<span class="builtintype" id="5817450">error</span>&nbsp;<span class="op" id="5817456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817459">p</span>&nbsp;<span class="op" id="5817461">:=</span>&nbsp;<span class="op" id="5817464">&amp;</span><span class="ident" id="5817465">enc</span><span class="op" id="5817468">.</span><span class="ident" id="5817469">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817472">switch</span>&nbsp;<span class="ident" id="5817479">t</span>&nbsp;<span class="op" id="5817481">:=</span>&nbsp;<span class="ident" id="5817484">t</span><span class="op" id="5817485">.</span><span class="op" id="5817486">(</span><span class="keyword" id="5817487">type</span><span class="op" id="5817491">)</span>&nbsp;<span class="op" id="5817493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817496">case</span>&nbsp;<span class="ident" id="5817501">StartElement</span><span class="op" id="5817513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817517">if</span>&nbsp;<span class="ident" id="5817520">err</span>&nbsp;<span class="op" id="5817524">:=</span>&nbsp;<span class="ident" id="5817527">p</span><span class="op" id="5817528">.</span><span class="ident" id="5817529">writeStart</span><span class="op" id="5817539">(</span><span class="op" id="5817540">&amp;</span><span class="ident" id="5817541">t</span><span class="op" id="5817542">)</span><span class="op" id="5817543">;</span>&nbsp;<span class="ident" id="5817545">err</span>&nbsp;<span class="op" id="5817549">!=</span>&nbsp;<span class="ident" id="5817552">nil</span>&nbsp;<span class="op" id="5817556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817561">return</span>&nbsp;<span class="ident" id="5817568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5817574">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817577">case</span>&nbsp;<span class="ident" id="5817582">EndElement</span><span class="op" id="5817592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817596">if</span>&nbsp;<span class="ident" id="5817599">err</span>&nbsp;<span class="op" id="5817603">:=</span>&nbsp;<span class="ident" id="5817606">p</span><span class="op" id="5817607">.</span><span class="ident" id="5817608">writeEnd</span><span class="op" id="5817616">(</span><span class="ident" id="5817617">t</span><span class="op" id="5817618">.</span><span class="ident" id="5817619">Name</span><span class="op" id="5817623">)</span><span class="op" id="5817624">;</span>&nbsp;<span class="ident" id="5817626">err</span>&nbsp;<span class="op" id="5817630">!=</span>&nbsp;<span class="ident" id="5817633">nil</span>&nbsp;<span class="op" id="5817637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817642">return</span>&nbsp;<span class="ident" id="5817649">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5817655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817658">case</span>&nbsp;<span class="ident" id="5817663">CharData</span><span class="op" id="5817671">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817675">EscapeText</span><span class="op" id="5817685">(</span><span class="ident" id="5817686">p</span><span class="op" id="5817687">,</span>&nbsp;<span class="ident" id="5817689">t</span><span class="op" id="5817690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817693">case</span>&nbsp;<span class="ident" id="5817698">Comment</span><span class="op" id="5817705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817709">if</span>&nbsp;<span class="ident" id="5817712">bytes</span><span class="op" id="5817717">.</span><span class="ident" id="5817718">Contains</span><span class="op" id="5817726">(</span><span class="ident" id="5817727">t</span><span class="op" id="5817728">,</span>&nbsp;<span class="ident" id="5817730">endComment</span><span class="op" id="5817740">)</span>&nbsp;<span class="op" id="5817742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817747">return</span>&nbsp;<span class="ident" id="5817754">fmt</span><span class="op" id="5817757">.</span><span class="ident" id="5817758">Errorf</span><span class="op" id="5817764">(</span><span class="string" id="5817765">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="5817816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5817820">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817824">p</span><span class="op" id="5817825">.</span><span class="ident" id="5817826">WriteString</span><span class="op" id="5817837">(</span><span class="string" id="5817838">&#34;&lt;!--&#34;</span><span class="op" id="5817844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817848">p</span><span class="op" id="5817849">.</span><span class="ident" id="5817850">Write</span><span class="op" id="5817855">(</span><span class="ident" id="5817856">t</span><span class="op" id="5817857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817861">p</span><span class="op" id="5817862">.</span><span class="ident" id="5817863">WriteString</span><span class="op" id="5817874">(</span><span class="string" id="5817875">&#34;--&gt;&#34;</span><span class="op" id="5817880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817884">return</span>&nbsp;<span class="ident" id="5817891">p</span><span class="op" id="5817892">.</span><span class="ident" id="5817893">cachedWriteError</span><span class="op" id="5817909">(</span><span class="op" id="5817910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817913">case</span>&nbsp;<span class="ident" id="5817918">ProcInst</span><span class="op" id="5817926">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5817930">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818005">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818085">if</span>&nbsp;<span class="ident" id="5818088">t</span><span class="op" id="5818089">.</span><span class="ident" id="5818090">Target</span>&nbsp;<span class="op" id="5818097">==</span>&nbsp;<span class="string" id="5818100">&#34;xml&#34;</span>&nbsp;<span class="op" id="5818106">&amp;&amp;</span>&nbsp;<span class="ident" id="5818109">p</span><span class="op" id="5818110">.</span><span class="ident" id="5818111">Buffered</span><span class="op" id="5818119">(</span><span class="op" id="5818120">)</span>&nbsp;<span class="op" id="5818122">!=</span>&nbsp;<span class="num" id="5818125">0</span>&nbsp;<span class="op" id="5818127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818132">return</span>&nbsp;<span class="ident" id="5818139">fmt</span><span class="op" id="5818142">.</span><span class="ident" id="5818143">Errorf</span><span class="op" id="5818149">(</span><span class="string" id="5818150">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="5818243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818247">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818251">if</span>&nbsp;<span class="op" id="5818254">!</span><span class="ident" id="5818255">isNameString</span><span class="op" id="5818267">(</span><span class="ident" id="5818268">t</span><span class="op" id="5818269">.</span><span class="ident" id="5818270">Target</span><span class="op" id="5818276">)</span>&nbsp;<span class="op" id="5818278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818283">return</span>&nbsp;<span class="ident" id="5818290">fmt</span><span class="op" id="5818293">.</span><span class="ident" id="5818294">Errorf</span><span class="op" id="5818300">(</span><span class="string" id="5818301">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="5818351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818359">if</span>&nbsp;<span class="ident" id="5818362">bytes</span><span class="op" id="5818367">.</span><span class="ident" id="5818368">Contains</span><span class="op" id="5818376">(</span><span class="ident" id="5818377">t</span><span class="op" id="5818378">.</span><span class="ident" id="5818379">Inst</span><span class="op" id="5818383">,</span>&nbsp;<span class="ident" id="5818385">endProcInst</span><span class="op" id="5818396">)</span>&nbsp;<span class="op" id="5818398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818403">return</span>&nbsp;<span class="ident" id="5818410">fmt</span><span class="op" id="5818413">.</span><span class="ident" id="5818414">Errorf</span><span class="op" id="5818420">(</span><span class="string" id="5818421">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="5818472">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818480">p</span><span class="op" id="5818481">.</span><span class="ident" id="5818482">WriteString</span><span class="op" id="5818493">(</span><span class="string" id="5818494">&#34;&lt;?&#34;</span><span class="op" id="5818498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818502">p</span><span class="op" id="5818503">.</span><span class="ident" id="5818504">WriteString</span><span class="op" id="5818515">(</span><span class="ident" id="5818516">t</span><span class="op" id="5818517">.</span><span class="ident" id="5818518">Target</span><span class="op" id="5818524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818528">if</span>&nbsp;<span class="builtinfunc" id="5818531">len</span><span class="op" id="5818534">(</span><span class="ident" id="5818535">t</span><span class="op" id="5818536">.</span><span class="ident" id="5818537">Inst</span><span class="op" id="5818541">)</span>&nbsp;<span class="op" id="5818543">&gt;</span>&nbsp;<span class="num" id="5818545">0</span>&nbsp;<span class="op" id="5818547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818552">p</span><span class="op" id="5818553">.</span><span class="ident" id="5818554">WriteByte</span><span class="op" id="5818563">(</span><span class="string" id="5818564">&#39;&nbsp;&#39;</span><span class="op" id="5818567">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818572">p</span><span class="op" id="5818573">.</span><span class="ident" id="5818574">Write</span><span class="op" id="5818579">(</span><span class="ident" id="5818580">t</span><span class="op" id="5818581">.</span><span class="ident" id="5818582">Inst</span><span class="op" id="5818586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818594">p</span><span class="op" id="5818595">.</span><span class="ident" id="5818596">WriteString</span><span class="op" id="5818607">(</span><span class="string" id="5818608">&#34;?&gt;&#34;</span><span class="op" id="5818612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818615">case</span>&nbsp;<span class="ident" id="5818620">Directive</span><span class="op" id="5818629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818633">if</span>&nbsp;<span class="ident" id="5818636">bytes</span><span class="op" id="5818641">.</span><span class="ident" id="5818642">Contains</span><span class="op" id="5818650">(</span><span class="ident" id="5818651">t</span><span class="op" id="5818652">,</span>&nbsp;<span class="ident" id="5818654">endDirective</span><span class="op" id="5818666">)</span>&nbsp;<span class="op" id="5818668">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818673">return</span>&nbsp;<span class="ident" id="5818680">fmt</span><span class="op" id="5818683">.</span><span class="ident" id="5818684">Errorf</span><span class="op" id="5818690">(</span><span class="string" id="5818691">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="5818742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818750">p</span><span class="op" id="5818751">.</span><span class="ident" id="5818752">WriteString</span><span class="op" id="5818763">(</span><span class="string" id="5818764">&#34;&lt;!&#34;</span><span class="op" id="5818768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818772">p</span><span class="op" id="5818773">.</span><span class="ident" id="5818774">Write</span><span class="op" id="5818779">(</span><span class="ident" id="5818780">t</span><span class="op" id="5818781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818785">p</span><span class="op" id="5818786">.</span><span class="ident" id="5818787">WriteString</span><span class="op" id="5818798">(</span><span class="string" id="5818799">&#34;&gt;&#34;</span><span class="op" id="5818802">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818808">return</span>&nbsp;<span class="ident" id="5818815">p</span><span class="op" id="5818816">.</span><span class="ident" id="5818817">cachedWriteError</span><span class="op" id="5818833">(</span><span class="op" id="5818834">)</span><br>
<span class="lineno"></span><span class="op" id="5818836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5818839">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="5818899">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5818976">func</span>&nbsp;<span class="op" id="5818981">(</span><span class="ident" id="5818982">enc</span>&nbsp;<span class="op" id="5818986">*</span><span class="ident" id="5818987">Encoder</span><span class="op" id="5818994">)</span>&nbsp;<span class="ident" id="5818996">Flush</span><span class="op" id="5819001">(</span><span class="op" id="5819002">)</span>&nbsp;<span class="builtintype" id="5819004">error</span>&nbsp;<span class="op" id="5819010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819013">return</span>&nbsp;<span class="ident" id="5819020">enc</span><span class="op" id="5819023">.</span><span class="ident" id="5819024">p</span><span class="op" id="5819025">.</span><span class="ident" id="5819026">Flush</span><span class="op" id="5819031">(</span><span class="op" id="5819032">)</span><br>
<span class="lineno"></span><span class="op" id="5819034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="5819037">type</span>&nbsp;<span class="ident" id="5819042">printer</span>&nbsp;<span class="keyword" id="5819050">struct</span>&nbsp;<span class="op" id="5819057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819060">*</span><span class="ident" id="5819061">bufio</span><span class="op" id="5819066">.</span><span class="ident" id="5819067">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819075">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819086">*</span><span class="ident" id="5819087">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819096">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5819107">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819112">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5819123">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819131">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5819142">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819150">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5819161">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819166">indentedIn</span>&nbsp;<span class="builtintype" id="5819177">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819183">putNewline</span>&nbsp;<span class="builtintype" id="5819194">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819200">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819211">map</span><span class="op" id="5819214">[</span><span class="builtintype" id="5819215">string</span><span class="op" id="5819221">]</span><span class="builtintype" id="5819222">string</span>&nbsp;<span class="comment" id="5819229">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819258">attrPrefix</span>&nbsp;<span class="keyword" id="5819269">map</span><span class="op" id="5819272">[</span><span class="builtintype" id="5819273">string</span><span class="op" id="5819279">]</span><span class="builtintype" id="5819280">string</span>&nbsp;<span class="comment" id="5819287">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819316">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5819327">[</span><span class="op" id="5819328">]</span><span class="builtintype" id="5819329">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819337">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819348">[</span><span class="op" id="5819349">]</span><span class="ident" id="5819350">Name</span><br>
<span class="lineno"></span><span class="op" id="5819355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="5819358">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="5819449">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5819511">func</span>&nbsp;<span class="op" id="5819516">(</span><span class="ident" id="5819517">p</span>&nbsp;<span class="op" id="5819519">*</span><span class="ident" id="5819520">printer</span><span class="op" id="5819527">)</span>&nbsp;<span class="ident" id="5819529">createAttrPrefix</span><span class="op" id="5819545">(</span><span class="ident" id="5819546">url</span>&nbsp;<span class="builtintype" id="5819550">string</span><span class="op" id="5819556">)</span>&nbsp;<span class="builtintype" id="5819558">string</span>&nbsp;<span class="op" id="5819565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819568">if</span>&nbsp;<span class="ident" id="5819571">prefix</span>&nbsp;<span class="op" id="5819578">:=</span>&nbsp;<span class="ident" id="5819581">p</span><span class="op" id="5819582">.</span><span class="ident" id="5819583">attrPrefix</span><span class="op" id="5819593">[</span><span class="ident" id="5819594">url</span><span class="op" id="5819597">]</span><span class="op" id="5819598">;</span>&nbsp;<span class="ident" id="5819600">prefix</span>&nbsp;<span class="op" id="5819607">!=</span>&nbsp;<span class="string" id="5819610">&#34;&#34;</span>&nbsp;<span class="op" id="5819613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819617">return</span>&nbsp;<span class="ident" id="5819624">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819636">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819717">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819755">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819838">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819917">if</span>&nbsp;<span class="ident" id="5819920">url</span>&nbsp;<span class="op" id="5819924">==</span>&nbsp;<span class="ident" id="5819927">xmlURL</span>&nbsp;<span class="op" id="5819934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819938">return</span>&nbsp;<span class="string" id="5819945">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819956">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819993">if</span>&nbsp;<span class="ident" id="5819996">p</span><span class="op" id="5819997">.</span><span class="ident" id="5819998">attrPrefix</span>&nbsp;<span class="op" id="5820009">==</span>&nbsp;<span class="ident" id="5820012">nil</span>&nbsp;<span class="op" id="5820016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820020">p</span><span class="op" id="5820021">.</span><span class="ident" id="5820022">attrPrefix</span>&nbsp;<span class="op" id="5820033">=</span>&nbsp;<span class="builtinfunc" id="5820035">make</span><span class="op" id="5820039">(</span><span class="keyword" id="5820040">map</span><span class="op" id="5820043">[</span><span class="builtintype" id="5820044">string</span><span class="op" id="5820050">]</span><span class="builtintype" id="5820051">string</span><span class="op" id="5820057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820061">p</span><span class="op" id="5820062">.</span><span class="ident" id="5820063">attrNS</span>&nbsp;<span class="op" id="5820070">=</span>&nbsp;<span class="builtinfunc" id="5820072">make</span><span class="op" id="5820076">(</span><span class="keyword" id="5820077">map</span><span class="op" id="5820080">[</span><span class="builtintype" id="5820081">string</span><span class="op" id="5820087">]</span><span class="builtintype" id="5820088">string</span><span class="op" id="5820094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820097">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820101">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820162">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820186">prefix</span>&nbsp;<span class="op" id="5820193">:=</span>&nbsp;<span class="ident" id="5820196">strings</span><span class="op" id="5820203">.</span><span class="ident" id="5820204">TrimRight</span><span class="op" id="5820213">(</span><span class="ident" id="5820214">url</span><span class="op" id="5820217">,</span>&nbsp;<span class="string" id="5820219">&#34;/&#34;</span><span class="op" id="5820222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820225">if</span>&nbsp;<span class="ident" id="5820228">i</span>&nbsp;<span class="op" id="5820230">:=</span>&nbsp;<span class="ident" id="5820233">strings</span><span class="op" id="5820240">.</span><span class="ident" id="5820241">LastIndex</span><span class="op" id="5820250">(</span><span class="ident" id="5820251">prefix</span><span class="op" id="5820257">,</span>&nbsp;<span class="string" id="5820259">&#34;/&#34;</span><span class="op" id="5820262">)</span><span class="op" id="5820263">;</span>&nbsp;<span class="ident" id="5820265">i</span>&nbsp;<span class="op" id="5820267">&gt;=</span>&nbsp;<span class="num" id="5820270">0</span>&nbsp;<span class="op" id="5820272">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820276">prefix</span>&nbsp;<span class="op" id="5820283">=</span>&nbsp;<span class="ident" id="5820285">prefix</span><span class="op" id="5820291">[</span><span class="ident" id="5820292">i</span><span class="op" id="5820293">+</span><span class="num" id="5820294">1</span><span class="op" id="5820295">:</span><span class="op" id="5820296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820302">if</span>&nbsp;<span class="ident" id="5820305">prefix</span>&nbsp;<span class="op" id="5820312">==</span>&nbsp;<span class="string" id="5820315">&#34;&#34;</span>&nbsp;<span class="op" id="5820318">||</span>&nbsp;<span class="op" id="5820321">!</span><span class="ident" id="5820322">isName</span><span class="op" id="5820328">(</span><span class="op" id="5820329">[</span><span class="op" id="5820330">]</span><span class="builtintype" id="5820331">byte</span><span class="op" id="5820335">(</span><span class="ident" id="5820336">prefix</span><span class="op" id="5820342">)</span><span class="op" id="5820343">)</span>&nbsp;<span class="op" id="5820345">||</span>&nbsp;<span class="ident" id="5820348">strings</span><span class="op" id="5820355">.</span><span class="ident" id="5820356">Contains</span><span class="op" id="5820364">(</span><span class="ident" id="5820365">prefix</span><span class="op" id="5820371">,</span>&nbsp;<span class="string" id="5820373">&#34;:&#34;</span><span class="op" id="5820376">)</span>&nbsp;<span class="op" id="5820378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820382">prefix</span>&nbsp;<span class="op" id="5820389">=</span>&nbsp;<span class="string" id="5820391">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820396">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820399">if</span>&nbsp;<span class="ident" id="5820402">strings</span><span class="op" id="5820409">.</span><span class="ident" id="5820410">HasPrefix</span><span class="op" id="5820419">(</span><span class="ident" id="5820420">prefix</span><span class="op" id="5820426">,</span>&nbsp;<span class="string" id="5820428">&#34;xml&#34;</span><span class="op" id="5820433">)</span>&nbsp;<span class="op" id="5820435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820439">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820469">prefix</span>&nbsp;<span class="op" id="5820476">=</span>&nbsp;<span class="string" id="5820478">&#34;_&#34;</span>&nbsp;<span class="op" id="5820482">+</span>&nbsp;<span class="ident" id="5820484">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820495">if</span>&nbsp;<span class="ident" id="5820498">p</span><span class="op" id="5820499">.</span><span class="ident" id="5820500">attrNS</span><span class="op" id="5820506">[</span><span class="ident" id="5820507">prefix</span><span class="op" id="5820513">]</span>&nbsp;<span class="op" id="5820515">!=</span>&nbsp;<span class="string" id="5820518">&#34;&#34;</span>&nbsp;<span class="op" id="5820521">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820525">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820564">for</span>&nbsp;<span class="ident" id="5820568">p</span><span class="op" id="5820569">.</span><span class="ident" id="5820570">seq</span><span class="op" id="5820573">++</span><span class="op" id="5820575">;</span>&nbsp;<span class="op" id="5820577">;</span>&nbsp;<span class="ident" id="5820579">p</span><span class="op" id="5820580">.</span><span class="ident" id="5820581">seq</span><span class="op" id="5820584">++</span>&nbsp;<span class="op" id="5820587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820592">if</span>&nbsp;<span class="ident" id="5820595">id</span>&nbsp;<span class="op" id="5820598">:=</span>&nbsp;<span class="ident" id="5820601">prefix</span>&nbsp;<span class="op" id="5820608">+</span>&nbsp;<span class="string" id="5820610">&#34;_&#34;</span>&nbsp;<span class="op" id="5820614">+</span>&nbsp;<span class="ident" id="5820616">strconv</span><span class="op" id="5820623">.</span><span class="ident" id="5820624">Itoa</span><span class="op" id="5820628">(</span><span class="ident" id="5820629">p</span><span class="op" id="5820630">.</span><span class="ident" id="5820631">seq</span><span class="op" id="5820634">)</span><span class="op" id="5820635">;</span>&nbsp;<span class="ident" id="5820637">p</span><span class="op" id="5820638">.</span><span class="ident" id="5820639">attrNS</span><span class="op" id="5820645">[</span><span class="ident" id="5820646">id</span><span class="op" id="5820648">]</span>&nbsp;<span class="op" id="5820650">==</span>&nbsp;<span class="string" id="5820653">&#34;&#34;</span>&nbsp;<span class="op" id="5820656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820662">prefix</span>&nbsp;<span class="op" id="5820669">=</span>&nbsp;<span class="ident" id="5820671">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820678">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820698">p</span><span class="op" id="5820699">.</span><span class="ident" id="5820700">attrPrefix</span><span class="op" id="5820710">[</span><span class="ident" id="5820711">url</span><span class="op" id="5820714">]</span>&nbsp;<span class="op" id="5820716">=</span>&nbsp;<span class="ident" id="5820718">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820726">p</span><span class="op" id="5820727">.</span><span class="ident" id="5820728">attrNS</span><span class="op" id="5820734">[</span><span class="ident" id="5820735">prefix</span><span class="op" id="5820741">]</span>&nbsp;<span class="op" id="5820743">=</span>&nbsp;<span class="ident" id="5820745">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820751">p</span><span class="op" id="5820752">.</span><span class="ident" id="5820753">WriteString</span><span class="op" id="5820764">(</span><span class="string" id="5820765">`xmlns:`</span><span class="op" id="5820773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820776">p</span><span class="op" id="5820777">.</span><span class="ident" id="5820778">WriteString</span><span class="op" id="5820789">(</span><span class="ident" id="5820790">prefix</span><span class="op" id="5820796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820799">p</span><span class="op" id="5820800">.</span><span class="ident" id="5820801">WriteString</span><span class="op" id="5820812">(</span><span class="string" id="5820813">`=&#34;`</span><span class="op" id="5820817">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820820">EscapeText</span><span class="op" id="5820830">(</span><span class="ident" id="5820831">p</span><span class="op" id="5820832">,</span>&nbsp;<span class="op" id="5820834">[</span><span class="op" id="5820835">]</span><span class="builtintype" id="5820836">byte</span><span class="op" id="5820840">(</span><span class="ident" id="5820841">url</span><span class="op" id="5820844">)</span><span class="op" id="5820845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820848">p</span><span class="op" id="5820849">.</span><span class="ident" id="5820850">WriteString</span><span class="op" id="5820861">(</span><span class="string" id="5820862">`&#34;&nbsp;`</span><span class="op" id="5820866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820870">p</span><span class="op" id="5820871">.</span><span class="ident" id="5820872">prefixes</span>&nbsp;<span class="op" id="5820881">=</span>&nbsp;<span class="builtinfunc" id="5820883">append</span><span class="op" id="5820889">(</span><span class="ident" id="5820890">p</span><span class="op" id="5820891">.</span><span class="ident" id="5820892">prefixes</span><span class="op" id="5820900">,</span>&nbsp;<span class="ident" id="5820902">prefix</span><span class="op" id="5820908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820912">return</span>&nbsp;<span class="ident" id="5820919">prefix</span><br>
<span class="lineno"></span><span class="op" id="5820926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5820929">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5820989">func</span>&nbsp;<span class="op" id="5820994">(</span><span class="ident" id="5820995">p</span>&nbsp;<span class="op" id="5820997">*</span><span class="ident" id="5820998">printer</span><span class="op" id="5821005">)</span>&nbsp;<span class="ident" id="5821007">deleteAttrPrefix</span><span class="op" id="5821023">(</span><span class="ident" id="5821024">prefix</span>&nbsp;<span class="builtintype" id="5821031">string</span><span class="op" id="5821037">)</span>&nbsp;<span class="op" id="5821039">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5821042">delete</span><span class="op" id="5821048">(</span><span class="ident" id="5821049">p</span><span class="op" id="5821050">.</span><span class="ident" id="5821051">attrPrefix</span><span class="op" id="5821061">,</span>&nbsp;<span class="ident" id="5821063">p</span><span class="op" id="5821064">.</span><span class="ident" id="5821065">attrNS</span><span class="op" id="5821071">[</span><span class="ident" id="5821072">prefix</span><span class="op" id="5821078">]</span><span class="op" id="5821079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5821082">delete</span><span class="op" id="5821088">(</span><span class="ident" id="5821089">p</span><span class="op" id="5821090">.</span><span class="ident" id="5821091">attrNS</span><span class="op" id="5821097">,</span>&nbsp;<span class="ident" id="5821099">prefix</span><span class="op" id="5821105">)</span><br>
<span class="lineno"></span><span class="op" id="5821107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5821110">func</span>&nbsp;<span class="op" id="5821115">(</span><span class="ident" id="5821116">p</span>&nbsp;<span class="op" id="5821118">*</span><span class="ident" id="5821119">printer</span><span class="op" id="5821126">)</span>&nbsp;<span class="ident" id="5821128">markPrefix</span><span class="op" id="5821138">(</span><span class="op" id="5821139">)</span>&nbsp;<span class="op" id="5821141">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821144">p</span><span class="op" id="5821145">.</span><span class="ident" id="5821146">prefixes</span>&nbsp;<span class="op" id="5821155">=</span>&nbsp;<span class="builtinfunc" id="5821157">append</span><span class="op" id="5821163">(</span><span class="ident" id="5821164">p</span><span class="op" id="5821165">.</span><span class="ident" id="5821166">prefixes</span><span class="op" id="5821174">,</span>&nbsp;<span class="string" id="5821176">&#34;&#34;</span><span class="op" id="5821178">)</span><br>
<span class="lineno"></span><span class="op" id="5821180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5821183">func</span>&nbsp;<span class="op" id="5821188">(</span><span class="ident" id="5821189">p</span>&nbsp;<span class="op" id="5821191">*</span><span class="ident" id="5821192">printer</span><span class="op" id="5821199">)</span>&nbsp;<span class="ident" id="5821201">popPrefix</span><span class="op" id="5821210">(</span><span class="op" id="5821211">)</span>&nbsp;<span class="op" id="5821213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821216">for</span>&nbsp;<span class="builtinfunc" id="5821220">len</span><span class="op" id="5821223">(</span><span class="ident" id="5821224">p</span><span class="op" id="5821225">.</span><span class="ident" id="5821226">prefixes</span><span class="op" id="5821234">)</span>&nbsp;<span class="op" id="5821236">&gt;</span>&nbsp;<span class="num" id="5821238">0</span>&nbsp;<span class="op" id="5821240">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821244">prefix</span>&nbsp;<span class="op" id="5821251">:=</span>&nbsp;<span class="ident" id="5821254">p</span><span class="op" id="5821255">.</span><span class="ident" id="5821256">prefixes</span><span class="op" id="5821264">[</span><span class="builtinfunc" id="5821265">len</span><span class="op" id="5821268">(</span><span class="ident" id="5821269">p</span><span class="op" id="5821270">.</span><span class="ident" id="5821271">prefixes</span><span class="op" id="5821279">)</span><span class="op" id="5821280">-</span><span class="num" id="5821281">1</span><span class="op" id="5821282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821286">p</span><span class="op" id="5821287">.</span><span class="ident" id="5821288">prefixes</span>&nbsp;<span class="op" id="5821297">=</span>&nbsp;<span class="ident" id="5821299">p</span><span class="op" id="5821300">.</span><span class="ident" id="5821301">prefixes</span><span class="op" id="5821309">[</span><span class="op" id="5821310">:</span><span class="builtinfunc" id="5821311">len</span><span class="op" id="5821314">(</span><span class="ident" id="5821315">p</span><span class="op" id="5821316">.</span><span class="ident" id="5821317">prefixes</span><span class="op" id="5821325">)</span><span class="op" id="5821326">-</span><span class="num" id="5821327">1</span><span class="op" id="5821328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821332">if</span>&nbsp;<span class="ident" id="5821335">prefix</span>&nbsp;<span class="op" id="5821342">==</span>&nbsp;<span class="string" id="5821345">&#34;&#34;</span>&nbsp;<span class="op" id="5821348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821353">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821361">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821365">p</span><span class="op" id="5821366">.</span><span class="ident" id="5821367">deleteAttrPrefix</span><span class="op" id="5821383">(</span><span class="ident" id="5821384">prefix</span><span class="op" id="5821390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821393">}</span><br>
<span class="lineno"></span><span class="op" id="5821395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5821398">var</span>&nbsp;<span class="op" id="5821402">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821405">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821423">=</span>&nbsp;<span class="ident" id="5821425">reflect</span><span class="op" id="5821432">.</span><span class="ident" id="5821433">TypeOf</span><span class="op" id="5821439">(</span><span class="op" id="5821440">(</span><span class="op" id="5821441">*</span><span class="ident" id="5821442">Marshaler</span><span class="op" id="5821451">)</span><span class="op" id="5821452">(</span><span class="ident" id="5821453">nil</span><span class="op" id="5821456">)</span><span class="op" id="5821457">)</span><span class="op" id="5821458">.</span><span class="ident" id="5821459">Elem</span><span class="op" id="5821463">(</span><span class="op" id="5821464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821467">marshalerAttrType</span>&nbsp;<span class="op" id="5821485">=</span>&nbsp;<span class="ident" id="5821487">reflect</span><span class="op" id="5821494">.</span><span class="ident" id="5821495">TypeOf</span><span class="op" id="5821501">(</span><span class="op" id="5821502">(</span><span class="op" id="5821503">*</span><span class="ident" id="5821504">MarshalerAttr</span><span class="op" id="5821517">)</span><span class="op" id="5821518">(</span><span class="ident" id="5821519">nil</span><span class="op" id="5821522">)</span><span class="op" id="5821523">)</span><span class="op" id="5821524">.</span><span class="ident" id="5821525">Elem</span><span class="op" id="5821529">(</span><span class="op" id="5821530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821533">textMarshalerType</span>&nbsp;<span class="op" id="5821551">=</span>&nbsp;<span class="ident" id="5821553">reflect</span><span class="op" id="5821560">.</span><span class="ident" id="5821561">TypeOf</span><span class="op" id="5821567">(</span><span class="op" id="5821568">(</span><span class="op" id="5821569">*</span><span class="ident" id="5821570">encoding</span><span class="op" id="5821578">.</span><span class="ident" id="5821579">TextMarshaler</span><span class="op" id="5821592">)</span><span class="op" id="5821593">(</span><span class="ident" id="5821594">nil</span><span class="op" id="5821597">)</span><span class="op" id="5821598">)</span><span class="op" id="5821599">.</span><span class="ident" id="5821600">Elem</span><span class="op" id="5821604">(</span><span class="op" id="5821605">)</span><br>
<span class="lineno"></span><span class="op" id="5821607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="5821610">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="5821676">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="5821749">func</span>&nbsp;<span class="op" id="5821754">(</span><span class="ident" id="5821755">p</span>&nbsp;<span class="op" id="5821757">*</span><span class="ident" id="5821758">printer</span><span class="op" id="5821765">)</span>&nbsp;<span class="ident" id="5821767">marshalValue</span><span class="op" id="5821779">(</span><span class="ident" id="5821780">val</span>&nbsp;<span class="ident" id="5821784">reflect</span><span class="op" id="5821791">.</span><span class="ident" id="5821792">Value</span><span class="op" id="5821797">,</span>&nbsp;<span class="ident" id="5821799">finfo</span>&nbsp;<span class="op" id="5821805">*</span><span class="ident" id="5821806">fieldInfo</span><span class="op" id="5821815">,</span>&nbsp;<span class="ident" id="5821817">startTemplate</span>&nbsp;<span class="op" id="5821831">*</span><span class="ident" id="5821832">StartElement</span><span class="op" id="5821844">)</span>&nbsp;<span class="builtintype" id="5821846">error</span>&nbsp;<span class="op" id="5821852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821855">if</span>&nbsp;<span class="ident" id="5821858">startTemplate</span>&nbsp;<span class="op" id="5821872">!=</span>&nbsp;<span class="ident" id="5821875">nil</span>&nbsp;<span class="op" id="5821879">&amp;&amp;</span>&nbsp;<span class="ident" id="5821882">startTemplate</span><span class="op" id="5821895">.</span><span class="ident" id="5821896">Name</span><span class="op" id="5821900">.</span><span class="ident" id="5821901">Local</span>&nbsp;<span class="op" id="5821907">==</span>&nbsp;<span class="string" id="5821910">&#34;&#34;</span>&nbsp;<span class="op" id="5821913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821917">return</span>&nbsp;<span class="ident" id="5821924">fmt</span><span class="op" id="5821927">.</span><span class="ident" id="5821928">Errorf</span><span class="op" id="5821934">(</span><span class="string" id="5821935">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="5821989">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821996">if</span>&nbsp;<span class="op" id="5821999">!</span><span class="ident" id="5822000">val</span><span class="op" id="5822003">.</span><span class="ident" id="5822004">IsValid</span><span class="op" id="5822011">(</span><span class="op" id="5822012">)</span>&nbsp;<span class="op" id="5822014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822018">return</span>&nbsp;<span class="ident" id="5822025">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822030">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822033">if</span>&nbsp;<span class="ident" id="5822036">finfo</span>&nbsp;<span class="op" id="5822042">!=</span>&nbsp;<span class="ident" id="5822045">nil</span>&nbsp;<span class="op" id="5822049">&amp;&amp;</span>&nbsp;<span class="ident" id="5822052">finfo</span><span class="op" id="5822057">.</span><span class="ident" id="5822058">flags</span><span class="op" id="5822063">&amp;</span><span class="ident" id="5822064">fOmitEmpty</span>&nbsp;<span class="op" id="5822075">!=</span>&nbsp;<span class="num" id="5822078">0</span>&nbsp;<span class="op" id="5822080">&amp;&amp;</span>&nbsp;<span class="ident" id="5822083">isEmptyValue</span><span class="op" id="5822095">(</span><span class="ident" id="5822096">val</span><span class="op" id="5822099">)</span>&nbsp;<span class="op" id="5822101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822105">return</span>&nbsp;<span class="ident" id="5822112">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822121">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822161">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822223">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822261">for</span>&nbsp;<span class="ident" id="5822265">val</span><span class="op" id="5822268">.</span><span class="ident" id="5822269">Kind</span><span class="op" id="5822273">(</span><span class="op" id="5822274">)</span>&nbsp;<span class="op" id="5822276">==</span>&nbsp;<span class="ident" id="5822279">reflect</span><span class="op" id="5822286">.</span><span class="ident" id="5822287">Interface</span>&nbsp;<span class="op" id="5822297">||</span>&nbsp;<span class="ident" id="5822300">val</span><span class="op" id="5822303">.</span><span class="ident" id="5822304">Kind</span><span class="op" id="5822308">(</span><span class="op" id="5822309">)</span>&nbsp;<span class="op" id="5822311">==</span>&nbsp;<span class="ident" id="5822314">reflect</span><span class="op" id="5822321">.</span><span class="ident" id="5822322">Ptr</span>&nbsp;<span class="op" id="5822326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822330">if</span>&nbsp;<span class="ident" id="5822333">val</span><span class="op" id="5822336">.</span><span class="ident" id="5822337">IsNil</span><span class="op" id="5822342">(</span><span class="op" id="5822343">)</span>&nbsp;<span class="op" id="5822345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822350">return</span>&nbsp;<span class="ident" id="5822357">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822367">val</span>&nbsp;<span class="op" id="5822371">=</span>&nbsp;<span class="ident" id="5822373">val</span><span class="op" id="5822376">.</span><span class="ident" id="5822377">Elem</span><span class="op" id="5822381">(</span><span class="op" id="5822382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822389">kind</span>&nbsp;<span class="op" id="5822394">:=</span>&nbsp;<span class="ident" id="5822397">val</span><span class="op" id="5822400">.</span><span class="ident" id="5822401">Kind</span><span class="op" id="5822405">(</span><span class="op" id="5822406">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822409">typ</span>&nbsp;<span class="op" id="5822413">:=</span>&nbsp;<span class="ident" id="5822416">val</span><span class="op" id="5822419">.</span><span class="ident" id="5822420">Type</span><span class="op" id="5822424">(</span><span class="op" id="5822425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822429">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822454">if</span>&nbsp;<span class="ident" id="5822457">val</span><span class="op" id="5822460">.</span><span class="ident" id="5822461">CanInterface</span><span class="op" id="5822473">(</span><span class="op" id="5822474">)</span>&nbsp;<span class="op" id="5822476">&amp;&amp;</span>&nbsp;<span class="ident" id="5822479">typ</span><span class="op" id="5822482">.</span><span class="ident" id="5822483">Implements</span><span class="op" id="5822493">(</span><span class="ident" id="5822494">marshalerType</span><span class="op" id="5822507">)</span>&nbsp;<span class="op" id="5822509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822513">return</span>&nbsp;<span class="ident" id="5822520">p</span><span class="op" id="5822521">.</span><span class="ident" id="5822522">marshalInterface</span><span class="op" id="5822538">(</span><span class="ident" id="5822539">val</span><span class="op" id="5822542">.</span><span class="ident" id="5822543">Interface</span><span class="op" id="5822552">(</span><span class="op" id="5822553">)</span><span class="op" id="5822554">.</span><span class="op" id="5822555">(</span><span class="ident" id="5822556">Marshaler</span><span class="op" id="5822565">)</span><span class="op" id="5822566">,</span>&nbsp;<span class="ident" id="5822568">defaultStart</span><span class="op" id="5822580">(</span><span class="ident" id="5822581">typ</span><span class="op" id="5822584">,</span>&nbsp;<span class="ident" id="5822586">finfo</span><span class="op" id="5822591">,</span>&nbsp;<span class="ident" id="5822593">startTemplate</span><span class="op" id="5822606">)</span><span class="op" id="5822607">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822613">if</span>&nbsp;<span class="ident" id="5822616">val</span><span class="op" id="5822619">.</span><span class="ident" id="5822620">CanAddr</span><span class="op" id="5822627">(</span><span class="op" id="5822628">)</span>&nbsp;<span class="op" id="5822630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822634">pv</span>&nbsp;<span class="op" id="5822637">:=</span>&nbsp;<span class="ident" id="5822640">val</span><span class="op" id="5822643">.</span><span class="ident" id="5822644">Addr</span><span class="op" id="5822648">(</span><span class="op" id="5822649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822653">if</span>&nbsp;<span class="ident" id="5822656">pv</span><span class="op" id="5822658">.</span><span class="ident" id="5822659">CanInterface</span><span class="op" id="5822671">(</span><span class="op" id="5822672">)</span>&nbsp;<span class="op" id="5822674">&amp;&amp;</span>&nbsp;<span class="ident" id="5822677">pv</span><span class="op" id="5822679">.</span><span class="ident" id="5822680">Type</span><span class="op" id="5822684">(</span><span class="op" id="5822685">)</span><span class="op" id="5822686">.</span><span class="ident" id="5822687">Implements</span><span class="op" id="5822697">(</span><span class="ident" id="5822698">marshalerType</span><span class="op" id="5822711">)</span>&nbsp;<span class="op" id="5822713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822718">return</span>&nbsp;<span class="ident" id="5822725">p</span><span class="op" id="5822726">.</span><span class="ident" id="5822727">marshalInterface</span><span class="op" id="5822743">(</span><span class="ident" id="5822744">pv</span><span class="op" id="5822746">.</span><span class="ident" id="5822747">Interface</span><span class="op" id="5822756">(</span><span class="op" id="5822757">)</span><span class="op" id="5822758">.</span><span class="op" id="5822759">(</span><span class="ident" id="5822760">Marshaler</span><span class="op" id="5822769">)</span><span class="op" id="5822770">,</span>&nbsp;<span class="ident" id="5822772">defaultStart</span><span class="op" id="5822784">(</span><span class="ident" id="5822785">pv</span><span class="op" id="5822787">.</span><span class="ident" id="5822788">Type</span><span class="op" id="5822792">(</span><span class="op" id="5822793">)</span><span class="op" id="5822794">,</span>&nbsp;<span class="ident" id="5822796">finfo</span><span class="op" id="5822801">,</span>&nbsp;<span class="ident" id="5822803">startTemplate</span><span class="op" id="5822816">)</span><span class="op" id="5822817">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822828">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822858">if</span>&nbsp;<span class="ident" id="5822861">val</span><span class="op" id="5822864">.</span><span class="ident" id="5822865">CanInterface</span><span class="op" id="5822877">(</span><span class="op" id="5822878">)</span>&nbsp;<span class="op" id="5822880">&amp;&amp;</span>&nbsp;<span class="ident" id="5822883">typ</span><span class="op" id="5822886">.</span><span class="ident" id="5822887">Implements</span><span class="op" id="5822897">(</span><span class="ident" id="5822898">textMarshalerType</span><span class="op" id="5822915">)</span>&nbsp;<span class="op" id="5822917">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822921">return</span>&nbsp;<span class="ident" id="5822928">p</span><span class="op" id="5822929">.</span><span class="ident" id="5822930">marshalTextInterface</span><span class="op" id="5822950">(</span><span class="ident" id="5822951">val</span><span class="op" id="5822954">.</span><span class="ident" id="5822955">Interface</span><span class="op" id="5822964">(</span><span class="op" id="5822965">)</span><span class="op" id="5822966">.</span><span class="op" id="5822967">(</span><span class="ident" id="5822968">encoding</span><span class="op" id="5822976">.</span><span class="ident" id="5822977">TextMarshaler</span><span class="op" id="5822990">)</span><span class="op" id="5822991">,</span>&nbsp;<span class="ident" id="5822993">defaultStart</span><span class="op" id="5823005">(</span><span class="ident" id="5823006">typ</span><span class="op" id="5823009">,</span>&nbsp;<span class="ident" id="5823011">finfo</span><span class="op" id="5823016">,</span>&nbsp;<span class="ident" id="5823018">startTemplate</span><span class="op" id="5823031">)</span><span class="op" id="5823032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823038">if</span>&nbsp;<span class="ident" id="5823041">val</span><span class="op" id="5823044">.</span><span class="ident" id="5823045">CanAddr</span><span class="op" id="5823052">(</span><span class="op" id="5823053">)</span>&nbsp;<span class="op" id="5823055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823059">pv</span>&nbsp;<span class="op" id="5823062">:=</span>&nbsp;<span class="ident" id="5823065">val</span><span class="op" id="5823068">.</span><span class="ident" id="5823069">Addr</span><span class="op" id="5823073">(</span><span class="op" id="5823074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823078">if</span>&nbsp;<span class="ident" id="5823081">pv</span><span class="op" id="5823083">.</span><span class="ident" id="5823084">CanInterface</span><span class="op" id="5823096">(</span><span class="op" id="5823097">)</span>&nbsp;<span class="op" id="5823099">&amp;&amp;</span>&nbsp;<span class="ident" id="5823102">pv</span><span class="op" id="5823104">.</span><span class="ident" id="5823105">Type</span><span class="op" id="5823109">(</span><span class="op" id="5823110">)</span><span class="op" id="5823111">.</span><span class="ident" id="5823112">Implements</span><span class="op" id="5823122">(</span><span class="ident" id="5823123">textMarshalerType</span><span class="op" id="5823140">)</span>&nbsp;<span class="op" id="5823142">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823147">return</span>&nbsp;<span class="ident" id="5823154">p</span><span class="op" id="5823155">.</span><span class="ident" id="5823156">marshalTextInterface</span><span class="op" id="5823176">(</span><span class="ident" id="5823177">pv</span><span class="op" id="5823179">.</span><span class="ident" id="5823180">Interface</span><span class="op" id="5823189">(</span><span class="op" id="5823190">)</span><span class="op" id="5823191">.</span><span class="op" id="5823192">(</span><span class="ident" id="5823193">encoding</span><span class="op" id="5823201">.</span><span class="ident" id="5823202">TextMarshaler</span><span class="op" id="5823215">)</span><span class="op" id="5823216">,</span>&nbsp;<span class="ident" id="5823218">defaultStart</span><span class="op" id="5823230">(</span><span class="ident" id="5823231">pv</span><span class="op" id="5823233">.</span><span class="ident" id="5823234">Type</span><span class="op" id="5823238">(</span><span class="op" id="5823239">)</span><span class="op" id="5823240">,</span>&nbsp;<span class="ident" id="5823242">finfo</span><span class="op" id="5823247">,</span>&nbsp;<span class="ident" id="5823249">startTemplate</span><span class="op" id="5823262">)</span><span class="op" id="5823263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823274">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823358">if</span>&nbsp;<span class="op" id="5823361">(</span><span class="ident" id="5823362">kind</span>&nbsp;<span class="op" id="5823367">==</span>&nbsp;<span class="ident" id="5823370">reflect</span><span class="op" id="5823377">.</span><span class="ident" id="5823378">Slice</span>&nbsp;<span class="op" id="5823384">||</span>&nbsp;<span class="ident" id="5823387">kind</span>&nbsp;<span class="op" id="5823392">==</span>&nbsp;<span class="ident" id="5823395">reflect</span><span class="op" id="5823402">.</span><span class="ident" id="5823403">Array</span><span class="op" id="5823408">)</span>&nbsp;<span class="op" id="5823410">&amp;&amp;</span>&nbsp;<span class="ident" id="5823413">typ</span><span class="op" id="5823416">.</span><span class="ident" id="5823417">Elem</span><span class="op" id="5823421">(</span><span class="op" id="5823422">)</span><span class="op" id="5823423">.</span><span class="ident" id="5823424">Kind</span><span class="op" id="5823428">(</span><span class="op" id="5823429">)</span>&nbsp;<span class="op" id="5823431">!=</span>&nbsp;<span class="ident" id="5823434">reflect</span><span class="op" id="5823441">.</span><span class="ident" id="5823442">Uint8</span>&nbsp;<span class="op" id="5823448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823452">for</span>&nbsp;<span class="ident" id="5823456">i</span><span class="op" id="5823457">,</span>&nbsp;<span class="ident" id="5823459">n</span>&nbsp;<span class="op" id="5823461">:=</span>&nbsp;<span class="num" id="5823464">0</span><span class="op" id="5823465">,</span>&nbsp;<span class="ident" id="5823467">val</span><span class="op" id="5823470">.</span><span class="ident" id="5823471">Len</span><span class="op" id="5823474">(</span><span class="op" id="5823475">)</span><span class="op" id="5823476">;</span>&nbsp;<span class="ident" id="5823478">i</span>&nbsp;<span class="op" id="5823480">&lt;</span>&nbsp;<span class="ident" id="5823482">n</span><span class="op" id="5823483">;</span>&nbsp;<span class="ident" id="5823485">i</span><span class="op" id="5823486">++</span>&nbsp;<span class="op" id="5823489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823494">if</span>&nbsp;<span class="ident" id="5823497">err</span>&nbsp;<span class="op" id="5823501">:=</span>&nbsp;<span class="ident" id="5823504">p</span><span class="op" id="5823505">.</span><span class="ident" id="5823506">marshalValue</span><span class="op" id="5823518">(</span><span class="ident" id="5823519">val</span><span class="op" id="5823522">.</span><span class="ident" id="5823523">Index</span><span class="op" id="5823528">(</span><span class="ident" id="5823529">i</span><span class="op" id="5823530">)</span><span class="op" id="5823531">,</span>&nbsp;<span class="ident" id="5823533">finfo</span><span class="op" id="5823538">,</span>&nbsp;<span class="ident" id="5823540">startTemplate</span><span class="op" id="5823553">)</span><span class="op" id="5823554">;</span>&nbsp;<span class="ident" id="5823556">err</span>&nbsp;<span class="op" id="5823560">!=</span>&nbsp;<span class="ident" id="5823563">nil</span>&nbsp;<span class="op" id="5823567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823573">return</span>&nbsp;<span class="ident" id="5823580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823587">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823595">return</span>&nbsp;<span class="ident" id="5823602">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823611">tinfo</span><span class="op" id="5823616">,</span>&nbsp;<span class="ident" id="5823618">err</span>&nbsp;<span class="op" id="5823622">:=</span>&nbsp;<span class="ident" id="5823625">getTypeInfo</span><span class="op" id="5823636">(</span><span class="ident" id="5823637">typ</span><span class="op" id="5823640">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823643">if</span>&nbsp;<span class="ident" id="5823646">err</span>&nbsp;<span class="op" id="5823650">!=</span>&nbsp;<span class="ident" id="5823653">nil</span>&nbsp;<span class="op" id="5823657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823661">return</span>&nbsp;<span class="ident" id="5823668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823677">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823703">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823747">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823768">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823811">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823858">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823875">var</span>&nbsp;<span class="ident" id="5823879">start</span>&nbsp;<span class="ident" id="5823885">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823900">if</span>&nbsp;<span class="ident" id="5823903">startTemplate</span>&nbsp;<span class="op" id="5823917">!=</span>&nbsp;<span class="ident" id="5823920">nil</span>&nbsp;<span class="op" id="5823924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823928">start</span><span class="op" id="5823933">.</span><span class="ident" id="5823934">Name</span>&nbsp;<span class="op" id="5823939">=</span>&nbsp;<span class="ident" id="5823941">startTemplate</span><span class="op" id="5823954">.</span><span class="ident" id="5823955">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823962">start</span><span class="op" id="5823967">.</span><span class="ident" id="5823968">Attr</span>&nbsp;<span class="op" id="5823973">=</span>&nbsp;<span class="builtinfunc" id="5823975">append</span><span class="op" id="5823981">(</span><span class="ident" id="5823982">start</span><span class="op" id="5823987">.</span><span class="ident" id="5823988">Attr</span><span class="op" id="5823992">,</span>&nbsp;<span class="ident" id="5823994">startTemplate</span><span class="op" id="5824007">.</span><span class="ident" id="5824008">Attr</span><span class="op" id="5824012">...</span><span class="op" id="5824015">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824018">}</span>&nbsp;<span class="keyword" id="5824020">else</span>&nbsp;<span class="keyword" id="5824025">if</span>&nbsp;<span class="ident" id="5824028">tinfo</span><span class="op" id="5824033">.</span><span class="ident" id="5824034">xmlname</span>&nbsp;<span class="op" id="5824042">!=</span>&nbsp;<span class="ident" id="5824045">nil</span>&nbsp;<span class="op" id="5824049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824053">xmlname</span>&nbsp;<span class="op" id="5824061">:=</span>&nbsp;<span class="ident" id="5824064">tinfo</span><span class="op" id="5824069">.</span><span class="ident" id="5824070">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824080">if</span>&nbsp;<span class="ident" id="5824083">xmlname</span><span class="op" id="5824090">.</span><span class="ident" id="5824091">name</span>&nbsp;<span class="op" id="5824096">!=</span>&nbsp;<span class="string" id="5824099">&#34;&#34;</span>&nbsp;<span class="op" id="5824102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824107">start</span><span class="op" id="5824112">.</span><span class="ident" id="5824113">Name</span><span class="op" id="5824117">.</span><span class="ident" id="5824118">Space</span><span class="op" id="5824123">,</span>&nbsp;<span class="ident" id="5824125">start</span><span class="op" id="5824130">.</span><span class="ident" id="5824131">Name</span><span class="op" id="5824135">.</span><span class="ident" id="5824136">Local</span>&nbsp;<span class="op" id="5824142">=</span>&nbsp;<span class="ident" id="5824144">xmlname</span><span class="op" id="5824151">.</span><span class="ident" id="5824152">xmlns</span><span class="op" id="5824157">,</span>&nbsp;<span class="ident" id="5824159">xmlname</span><span class="op" id="5824166">.</span><span class="ident" id="5824167">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824174">}</span>&nbsp;<span class="keyword" id="5824176">else</span>&nbsp;<span class="keyword" id="5824181">if</span>&nbsp;<span class="ident" id="5824184">v</span><span class="op" id="5824185">,</span>&nbsp;<span class="ident" id="5824187">ok</span>&nbsp;<span class="op" id="5824190">:=</span>&nbsp;<span class="ident" id="5824193">xmlname</span><span class="op" id="5824200">.</span><span class="ident" id="5824201">value</span><span class="op" id="5824206">(</span><span class="ident" id="5824207">val</span><span class="op" id="5824210">)</span><span class="op" id="5824211">.</span><span class="ident" id="5824212">Interface</span><span class="op" id="5824221">(</span><span class="op" id="5824222">)</span><span class="op" id="5824223">.</span><span class="op" id="5824224">(</span><span class="ident" id="5824225">Name</span><span class="op" id="5824229">)</span><span class="op" id="5824230">;</span>&nbsp;<span class="ident" id="5824232">ok</span>&nbsp;<span class="op" id="5824235">&amp;&amp;</span>&nbsp;<span class="ident" id="5824238">v</span><span class="op" id="5824239">.</span><span class="ident" id="5824240">Local</span>&nbsp;<span class="op" id="5824246">!=</span>&nbsp;<span class="string" id="5824249">&#34;&#34;</span>&nbsp;<span class="op" id="5824252">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824257">start</span><span class="op" id="5824262">.</span><span class="ident" id="5824263">Name</span>&nbsp;<span class="op" id="5824268">=</span>&nbsp;<span class="ident" id="5824270">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824280">if</span>&nbsp;<span class="ident" id="5824283">start</span><span class="op" id="5824288">.</span><span class="ident" id="5824289">Name</span><span class="op" id="5824293">.</span><span class="ident" id="5824294">Local</span>&nbsp;<span class="op" id="5824300">==</span>&nbsp;<span class="string" id="5824303">&#34;&#34;</span>&nbsp;<span class="op" id="5824306">&amp;&amp;</span>&nbsp;<span class="ident" id="5824309">finfo</span>&nbsp;<span class="op" id="5824315">!=</span>&nbsp;<span class="ident" id="5824318">nil</span>&nbsp;<span class="op" id="5824322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824326">start</span><span class="op" id="5824331">.</span><span class="ident" id="5824332">Name</span><span class="op" id="5824336">.</span><span class="ident" id="5824337">Space</span><span class="op" id="5824342">,</span>&nbsp;<span class="ident" id="5824344">start</span><span class="op" id="5824349">.</span><span class="ident" id="5824350">Name</span><span class="op" id="5824354">.</span><span class="ident" id="5824355">Local</span>&nbsp;<span class="op" id="5824361">=</span>&nbsp;<span class="ident" id="5824363">finfo</span><span class="op" id="5824368">.</span><span class="ident" id="5824369">xmlns</span><span class="op" id="5824374">,</span>&nbsp;<span class="ident" id="5824376">finfo</span><span class="op" id="5824381">.</span><span class="ident" id="5824382">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824391">if</span>&nbsp;<span class="ident" id="5824394">start</span><span class="op" id="5824399">.</span><span class="ident" id="5824400">Name</span><span class="op" id="5824404">.</span><span class="ident" id="5824405">Local</span>&nbsp;<span class="op" id="5824411">==</span>&nbsp;<span class="string" id="5824414">&#34;&#34;</span>&nbsp;<span class="op" id="5824417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824421">name</span>&nbsp;<span class="op" id="5824426">:=</span>&nbsp;<span class="ident" id="5824429">typ</span><span class="op" id="5824432">.</span><span class="ident" id="5824433">Name</span><span class="op" id="5824437">(</span><span class="op" id="5824438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824442">if</span>&nbsp;<span class="ident" id="5824445">name</span>&nbsp;<span class="op" id="5824450">==</span>&nbsp;<span class="string" id="5824453">&#34;&#34;</span>&nbsp;<span class="op" id="5824456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824461">return</span>&nbsp;<span class="op" id="5824468">&amp;</span><span class="ident" id="5824469">UnsupportedTypeError</span><span class="op" id="5824489">{</span><span class="ident" id="5824490">typ</span><span class="op" id="5824493">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824501">start</span><span class="op" id="5824506">.</span><span class="ident" id="5824507">Name</span><span class="op" id="5824511">.</span><span class="ident" id="5824512">Local</span>&nbsp;<span class="op" id="5824518">=</span>&nbsp;<span class="ident" id="5824520">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5824530">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824545">for</span>&nbsp;<span class="ident" id="5824549">i</span>&nbsp;<span class="op" id="5824551">:=</span>&nbsp;<span class="keyword" id="5824554">range</span>&nbsp;<span class="ident" id="5824560">tinfo</span><span class="op" id="5824565">.</span><span class="ident" id="5824566">fields</span>&nbsp;<span class="op" id="5824573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824577">finfo</span>&nbsp;<span class="op" id="5824583">:=</span>&nbsp;<span class="op" id="5824586">&amp;</span><span class="ident" id="5824587">tinfo</span><span class="op" id="5824592">.</span><span class="ident" id="5824593">fields</span><span class="op" id="5824599">[</span><span class="ident" id="5824600">i</span><span class="op" id="5824601">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824605">if</span>&nbsp;<span class="ident" id="5824608">finfo</span><span class="op" id="5824613">.</span><span class="ident" id="5824614">flags</span><span class="op" id="5824619">&amp;</span><span class="ident" id="5824620">fAttr</span>&nbsp;<span class="op" id="5824626">==</span>&nbsp;<span class="num" id="5824629">0</span>&nbsp;<span class="op" id="5824631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824636">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824647">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824651">fv</span>&nbsp;<span class="op" id="5824654">:=</span>&nbsp;<span class="ident" id="5824657">finfo</span><span class="op" id="5824662">.</span><span class="ident" id="5824663">value</span><span class="op" id="5824668">(</span><span class="ident" id="5824669">val</span><span class="op" id="5824672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824676">name</span>&nbsp;<span class="op" id="5824681">:=</span>&nbsp;<span class="ident" id="5824684">Name</span><span class="op" id="5824688">{</span><span class="ident" id="5824689">Space</span><span class="op" id="5824694">:</span>&nbsp;<span class="ident" id="5824696">finfo</span><span class="op" id="5824701">.</span><span class="ident" id="5824702">xmlns</span><span class="op" id="5824707">,</span>&nbsp;<span class="ident" id="5824709">Local</span><span class="op" id="5824714">:</span>&nbsp;<span class="ident" id="5824716">finfo</span><span class="op" id="5824721">.</span><span class="ident" id="5824722">name</span><span class="op" id="5824726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824731">if</span>&nbsp;<span class="ident" id="5824734">finfo</span><span class="op" id="5824739">.</span><span class="ident" id="5824740">flags</span><span class="op" id="5824745">&amp;</span><span class="ident" id="5824746">fOmitEmpty</span>&nbsp;<span class="op" id="5824757">!=</span>&nbsp;<span class="num" id="5824760">0</span>&nbsp;<span class="op" id="5824762">&amp;&amp;</span>&nbsp;<span class="ident" id="5824765">isEmptyValue</span><span class="op" id="5824777">(</span><span class="ident" id="5824778">fv</span><span class="op" id="5824780">)</span>&nbsp;<span class="op" id="5824782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824787">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824803">if</span>&nbsp;<span class="ident" id="5824806">fv</span><span class="op" id="5824808">.</span><span class="ident" id="5824809">Kind</span><span class="op" id="5824813">(</span><span class="op" id="5824814">)</span>&nbsp;<span class="op" id="5824816">==</span>&nbsp;<span class="ident" id="5824819">reflect</span><span class="op" id="5824826">.</span><span class="ident" id="5824827">Interface</span>&nbsp;<span class="op" id="5824837">&amp;&amp;</span>&nbsp;<span class="ident" id="5824840">fv</span><span class="op" id="5824842">.</span><span class="ident" id="5824843">IsNil</span><span class="op" id="5824848">(</span><span class="op" id="5824849">)</span>&nbsp;<span class="op" id="5824851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824856">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824867">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824872">if</span>&nbsp;<span class="ident" id="5824875">fv</span><span class="op" id="5824877">.</span><span class="ident" id="5824878">CanInterface</span><span class="op" id="5824890">(</span><span class="op" id="5824891">)</span>&nbsp;<span class="op" id="5824893">&amp;&amp;</span>&nbsp;<span class="ident" id="5824896">fv</span><span class="op" id="5824898">.</span><span class="ident" id="5824899">Type</span><span class="op" id="5824903">(</span><span class="op" id="5824904">)</span><span class="op" id="5824905">.</span><span class="ident" id="5824906">Implements</span><span class="op" id="5824916">(</span><span class="ident" id="5824917">marshalerAttrType</span><span class="op" id="5824934">)</span>&nbsp;<span class="op" id="5824936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824941">attr</span><span class="op" id="5824945">,</span>&nbsp;<span class="ident" id="5824947">err</span>&nbsp;<span class="op" id="5824951">:=</span>&nbsp;<span class="ident" id="5824954">fv</span><span class="op" id="5824956">.</span><span class="ident" id="5824957">Interface</span><span class="op" id="5824966">(</span><span class="op" id="5824967">)</span><span class="op" id="5824968">.</span><span class="op" id="5824969">(</span><span class="ident" id="5824970">MarshalerAttr</span><span class="op" id="5824983">)</span><span class="op" id="5824984">.</span><span class="ident" id="5824985">MarshalXMLAttr</span><span class="op" id="5824999">(</span><span class="ident" id="5825000">name</span><span class="op" id="5825004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825009">if</span>&nbsp;<span class="ident" id="5825012">err</span>&nbsp;<span class="op" id="5825016">!=</span>&nbsp;<span class="ident" id="5825019">nil</span>&nbsp;<span class="op" id="5825023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825029">return</span>&nbsp;<span class="ident" id="5825036">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825048">if</span>&nbsp;<span class="ident" id="5825051">attr</span><span class="op" id="5825055">.</span><span class="ident" id="5825056">Name</span><span class="op" id="5825060">.</span><span class="ident" id="5825061">Local</span>&nbsp;<span class="op" id="5825067">!=</span>&nbsp;<span class="string" id="5825070">&#34;&#34;</span>&nbsp;<span class="op" id="5825073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825079">start</span><span class="op" id="5825084">.</span><span class="ident" id="5825085">Attr</span>&nbsp;<span class="op" id="5825090">=</span>&nbsp;<span class="builtinfunc" id="5825092">append</span><span class="op" id="5825098">(</span><span class="ident" id="5825099">start</span><span class="op" id="5825104">.</span><span class="ident" id="5825105">Attr</span><span class="op" id="5825109">,</span>&nbsp;<span class="ident" id="5825111">attr</span><span class="op" id="5825115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825125">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825141">if</span>&nbsp;<span class="ident" id="5825144">fv</span><span class="op" id="5825146">.</span><span class="ident" id="5825147">CanAddr</span><span class="op" id="5825154">(</span><span class="op" id="5825155">)</span>&nbsp;<span class="op" id="5825157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825162">pv</span>&nbsp;<span class="op" id="5825165">:=</span>&nbsp;<span class="ident" id="5825168">fv</span><span class="op" id="5825170">.</span><span class="ident" id="5825171">Addr</span><span class="op" id="5825175">(</span><span class="op" id="5825176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825181">if</span>&nbsp;<span class="ident" id="5825184">pv</span><span class="op" id="5825186">.</span><span class="ident" id="5825187">CanInterface</span><span class="op" id="5825199">(</span><span class="op" id="5825200">)</span>&nbsp;<span class="op" id="5825202">&amp;&amp;</span>&nbsp;<span class="ident" id="5825205">pv</span><span class="op" id="5825207">.</span><span class="ident" id="5825208">Type</span><span class="op" id="5825212">(</span><span class="op" id="5825213">)</span><span class="op" id="5825214">.</span><span class="ident" id="5825215">Implements</span><span class="op" id="5825225">(</span><span class="ident" id="5825226">marshalerAttrType</span><span class="op" id="5825243">)</span>&nbsp;<span class="op" id="5825245">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825251">attr</span><span class="op" id="5825255">,</span>&nbsp;<span class="ident" id="5825257">err</span>&nbsp;<span class="op" id="5825261">:=</span>&nbsp;<span class="ident" id="5825264">pv</span><span class="op" id="5825266">.</span><span class="ident" id="5825267">Interface</span><span class="op" id="5825276">(</span><span class="op" id="5825277">)</span><span class="op" id="5825278">.</span><span class="op" id="5825279">(</span><span class="ident" id="5825280">MarshalerAttr</span><span class="op" id="5825293">)</span><span class="op" id="5825294">.</span><span class="ident" id="5825295">MarshalXMLAttr</span><span class="op" id="5825309">(</span><span class="ident" id="5825310">name</span><span class="op" id="5825314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825320">if</span>&nbsp;<span class="ident" id="5825323">err</span>&nbsp;<span class="op" id="5825327">!=</span>&nbsp;<span class="ident" id="5825330">nil</span>&nbsp;<span class="op" id="5825334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825341">return</span>&nbsp;<span class="ident" id="5825348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825362">if</span>&nbsp;<span class="ident" id="5825365">attr</span><span class="op" id="5825369">.</span><span class="ident" id="5825370">Name</span><span class="op" id="5825374">.</span><span class="ident" id="5825375">Local</span>&nbsp;<span class="op" id="5825381">!=</span>&nbsp;<span class="string" id="5825384">&#34;&#34;</span>&nbsp;<span class="op" id="5825387">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825394">start</span><span class="op" id="5825399">.</span><span class="ident" id="5825400">Attr</span>&nbsp;<span class="op" id="5825405">=</span>&nbsp;<span class="builtinfunc" id="5825407">append</span><span class="op" id="5825413">(</span><span class="ident" id="5825414">start</span><span class="op" id="5825419">.</span><span class="ident" id="5825420">Attr</span><span class="op" id="5825424">,</span>&nbsp;<span class="ident" id="5825426">attr</span><span class="op" id="5825430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825442">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825458">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825463">if</span>&nbsp;<span class="ident" id="5825466">fv</span><span class="op" id="5825468">.</span><span class="ident" id="5825469">CanInterface</span><span class="op" id="5825481">(</span><span class="op" id="5825482">)</span>&nbsp;<span class="op" id="5825484">&amp;&amp;</span>&nbsp;<span class="ident" id="5825487">fv</span><span class="op" id="5825489">.</span><span class="ident" id="5825490">Type</span><span class="op" id="5825494">(</span><span class="op" id="5825495">)</span><span class="op" id="5825496">.</span><span class="ident" id="5825497">Implements</span><span class="op" id="5825507">(</span><span class="ident" id="5825508">textMarshalerType</span><span class="op" id="5825525">)</span>&nbsp;<span class="op" id="5825527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825532">text</span><span class="op" id="5825536">,</span>&nbsp;<span class="ident" id="5825538">err</span>&nbsp;<span class="op" id="5825542">:=</span>&nbsp;<span class="ident" id="5825545">fv</span><span class="op" id="5825547">.</span><span class="ident" id="5825548">Interface</span><span class="op" id="5825557">(</span><span class="op" id="5825558">)</span><span class="op" id="5825559">.</span><span class="op" id="5825560">(</span><span class="ident" id="5825561">encoding</span><span class="op" id="5825569">.</span><span class="ident" id="5825570">TextMarshaler</span><span class="op" id="5825583">)</span><span class="op" id="5825584">.</span><span class="ident" id="5825585">MarshalText</span><span class="op" id="5825596">(</span><span class="op" id="5825597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825602">if</span>&nbsp;<span class="ident" id="5825605">err</span>&nbsp;<span class="op" id="5825609">!=</span>&nbsp;<span class="ident" id="5825612">nil</span>&nbsp;<span class="op" id="5825616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825622">return</span>&nbsp;<span class="ident" id="5825629">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825641">start</span><span class="op" id="5825646">.</span><span class="ident" id="5825647">Attr</span>&nbsp;<span class="op" id="5825652">=</span>&nbsp;<span class="builtinfunc" id="5825654">append</span><span class="op" id="5825660">(</span><span class="ident" id="5825661">start</span><span class="op" id="5825666">.</span><span class="ident" id="5825667">Attr</span><span class="op" id="5825671">,</span>&nbsp;<span class="ident" id="5825673">Attr</span><span class="op" id="5825677">{</span><span class="ident" id="5825678">name</span><span class="op" id="5825682">,</span>&nbsp;<span class="builtintype" id="5825684">string</span><span class="op" id="5825690">(</span><span class="ident" id="5825691">text</span><span class="op" id="5825695">)</span><span class="op" id="5825696">}</span><span class="op" id="5825697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825702">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825718">if</span>&nbsp;<span class="ident" id="5825721">fv</span><span class="op" id="5825723">.</span><span class="ident" id="5825724">CanAddr</span><span class="op" id="5825731">(</span><span class="op" id="5825732">)</span>&nbsp;<span class="op" id="5825734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825739">pv</span>&nbsp;<span class="op" id="5825742">:=</span>&nbsp;<span class="ident" id="5825745">fv</span><span class="op" id="5825747">.</span><span class="ident" id="5825748">Addr</span><span class="op" id="5825752">(</span><span class="op" id="5825753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825758">if</span>&nbsp;<span class="ident" id="5825761">pv</span><span class="op" id="5825763">.</span><span class="ident" id="5825764">CanInterface</span><span class="op" id="5825776">(</span><span class="op" id="5825777">)</span>&nbsp;<span class="op" id="5825779">&amp;&amp;</span>&nbsp;<span class="ident" id="5825782">pv</span><span class="op" id="5825784">.</span><span class="ident" id="5825785">Type</span><span class="op" id="5825789">(</span><span class="op" id="5825790">)</span><span class="op" id="5825791">.</span><span class="ident" id="5825792">Implements</span><span class="op" id="5825802">(</span><span class="ident" id="5825803">textMarshalerType</span><span class="op" id="5825820">)</span>&nbsp;<span class="op" id="5825822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825828">text</span><span class="op" id="5825832">,</span>&nbsp;<span class="ident" id="5825834">err</span>&nbsp;<span class="op" id="5825838">:=</span>&nbsp;<span class="ident" id="5825841">pv</span><span class="op" id="5825843">.</span><span class="ident" id="5825844">Interface</span><span class="op" id="5825853">(</span><span class="op" id="5825854">)</span><span class="op" id="5825855">.</span><span class="op" id="5825856">(</span><span class="ident" id="5825857">encoding</span><span class="op" id="5825865">.</span><span class="ident" id="5825866">TextMarshaler</span><span class="op" id="5825879">)</span><span class="op" id="5825880">.</span><span class="ident" id="5825881">MarshalText</span><span class="op" id="5825892">(</span><span class="op" id="5825893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825899">if</span>&nbsp;<span class="ident" id="5825902">err</span>&nbsp;<span class="op" id="5825906">!=</span>&nbsp;<span class="ident" id="5825909">nil</span>&nbsp;<span class="op" id="5825913">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5825920">return</span>&nbsp;<span class="ident" id="5825927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5825935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5825941">start</span><span class="op" id="5825946">.</span><span class="ident" id="5825947">Attr</span>&nbsp;<span class="op" id="5825952">=</span>&nbsp;<span class="builtinfunc" id="5825954">append</span><span class="op" id="5825960">(</span><span class="ident" id="5825961">start</span><span class="op" id="5825966">.</span><span class="ident" id="5825967">Attr</span><span class="op" id="5825971">,</span>&nbsp;<span class="ident" id="5825973">Attr</span><span class="op" id="5825977">{</span><span class="ident" id="5825978">name</span><span class="op" id="5825982">,</span>&nbsp;<span class="builtintype" id="5825984">string</span><span class="op" id="5825990">(</span><span class="ident" id="5825991">text</span><span class="op" id="5825995">)</span><span class="op" id="5825996">}</span><span class="op" id="5825997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826003">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826015">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5826024">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826080">switch</span>&nbsp;<span class="ident" id="5826087">fv</span><span class="op" id="5826089">.</span><span class="ident" id="5826090">Kind</span><span class="op" id="5826094">(</span><span class="op" id="5826095">)</span>&nbsp;<span class="op" id="5826097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826101">case</span>&nbsp;<span class="ident" id="5826106">reflect</span><span class="op" id="5826113">.</span><span class="ident" id="5826114">Ptr</span><span class="op" id="5826117">,</span>&nbsp;<span class="ident" id="5826119">reflect</span><span class="op" id="5826126">.</span><span class="ident" id="5826127">Interface</span><span class="op" id="5826136">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826141">if</span>&nbsp;<span class="ident" id="5826144">fv</span><span class="op" id="5826146">.</span><span class="ident" id="5826147">IsNil</span><span class="op" id="5826152">(</span><span class="op" id="5826153">)</span>&nbsp;<span class="op" id="5826155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826161">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826178">fv</span>&nbsp;<span class="op" id="5826181">=</span>&nbsp;<span class="ident" id="5826183">fv</span><span class="op" id="5826185">.</span><span class="ident" id="5826186">Elem</span><span class="op" id="5826190">(</span><span class="op" id="5826191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826195">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826200">s</span><span class="op" id="5826201">,</span>&nbsp;<span class="ident" id="5826203">b</span><span class="op" id="5826204">,</span>&nbsp;<span class="ident" id="5826206">err</span>&nbsp;<span class="op" id="5826210">:=</span>&nbsp;<span class="ident" id="5826213">p</span><span class="op" id="5826214">.</span><span class="ident" id="5826215">marshalSimple</span><span class="op" id="5826228">(</span><span class="ident" id="5826229">fv</span><span class="op" id="5826231">.</span><span class="ident" id="5826232">Type</span><span class="op" id="5826236">(</span><span class="op" id="5826237">)</span><span class="op" id="5826238">,</span>&nbsp;<span class="ident" id="5826240">fv</span><span class="op" id="5826242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826246">if</span>&nbsp;<span class="ident" id="5826249">err</span>&nbsp;<span class="op" id="5826253">!=</span>&nbsp;<span class="ident" id="5826256">nil</span>&nbsp;<span class="op" id="5826260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826265">return</span>&nbsp;<span class="ident" id="5826272">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826278">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826282">if</span>&nbsp;<span class="ident" id="5826285">b</span>&nbsp;<span class="op" id="5826287">!=</span>&nbsp;<span class="ident" id="5826290">nil</span>&nbsp;<span class="op" id="5826294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826299">s</span>&nbsp;<span class="op" id="5826301">=</span>&nbsp;<span class="builtintype" id="5826303">string</span><span class="op" id="5826309">(</span><span class="ident" id="5826310">b</span><span class="op" id="5826311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826319">start</span><span class="op" id="5826324">.</span><span class="ident" id="5826325">Attr</span>&nbsp;<span class="op" id="5826330">=</span>&nbsp;<span class="builtinfunc" id="5826332">append</span><span class="op" id="5826338">(</span><span class="ident" id="5826339">start</span><span class="op" id="5826344">.</span><span class="ident" id="5826345">Attr</span><span class="op" id="5826349">,</span>&nbsp;<span class="ident" id="5826351">Attr</span><span class="op" id="5826355">{</span><span class="ident" id="5826356">name</span><span class="op" id="5826360">,</span>&nbsp;<span class="ident" id="5826362">s</span><span class="op" id="5826363">}</span><span class="op" id="5826364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826367">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826371">if</span>&nbsp;<span class="ident" id="5826374">err</span>&nbsp;<span class="op" id="5826378">:=</span>&nbsp;<span class="ident" id="5826381">p</span><span class="op" id="5826382">.</span><span class="ident" id="5826383">writeStart</span><span class="op" id="5826393">(</span><span class="op" id="5826394">&amp;</span><span class="ident" id="5826395">start</span><span class="op" id="5826400">)</span><span class="op" id="5826401">;</span>&nbsp;<span class="ident" id="5826403">err</span>&nbsp;<span class="op" id="5826407">!=</span>&nbsp;<span class="ident" id="5826410">nil</span>&nbsp;<span class="op" id="5826414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826418">return</span>&nbsp;<span class="ident" id="5826425">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826434">if</span>&nbsp;<span class="ident" id="5826437">val</span><span class="op" id="5826440">.</span><span class="ident" id="5826441">Kind</span><span class="op" id="5826445">(</span><span class="op" id="5826446">)</span>&nbsp;<span class="op" id="5826448">==</span>&nbsp;<span class="ident" id="5826451">reflect</span><span class="op" id="5826458">.</span><span class="ident" id="5826459">Struct</span>&nbsp;<span class="op" id="5826466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826470">err</span>&nbsp;<span class="op" id="5826474">=</span>&nbsp;<span class="ident" id="5826476">p</span><span class="op" id="5826477">.</span><span class="ident" id="5826478">marshalStruct</span><span class="op" id="5826491">(</span><span class="ident" id="5826492">tinfo</span><span class="op" id="5826497">,</span>&nbsp;<span class="ident" id="5826499">val</span><span class="op" id="5826502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826505">}</span>&nbsp;<span class="keyword" id="5826507">else</span>&nbsp;<span class="op" id="5826512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826516">s</span><span class="op" id="5826517">,</span>&nbsp;<span class="ident" id="5826519">b</span><span class="op" id="5826520">,</span>&nbsp;<span class="ident" id="5826522">err1</span>&nbsp;<span class="op" id="5826527">:=</span>&nbsp;<span class="ident" id="5826530">p</span><span class="op" id="5826531">.</span><span class="ident" id="5826532">marshalSimple</span><span class="op" id="5826545">(</span><span class="ident" id="5826546">typ</span><span class="op" id="5826549">,</span>&nbsp;<span class="ident" id="5826551">val</span><span class="op" id="5826554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826558">if</span>&nbsp;<span class="ident" id="5826561">err1</span>&nbsp;<span class="op" id="5826566">!=</span>&nbsp;<span class="ident" id="5826569">nil</span>&nbsp;<span class="op" id="5826573">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826578">err</span>&nbsp;<span class="op" id="5826582">=</span>&nbsp;<span class="ident" id="5826584">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826591">}</span>&nbsp;<span class="keyword" id="5826593">else</span>&nbsp;<span class="keyword" id="5826598">if</span>&nbsp;<span class="ident" id="5826601">b</span>&nbsp;<span class="op" id="5826603">!=</span>&nbsp;<span class="ident" id="5826606">nil</span>&nbsp;<span class="op" id="5826610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826615">EscapeText</span><span class="op" id="5826625">(</span><span class="ident" id="5826626">p</span><span class="op" id="5826627">,</span>&nbsp;<span class="ident" id="5826629">b</span><span class="op" id="5826630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826634">}</span>&nbsp;<span class="keyword" id="5826636">else</span>&nbsp;<span class="op" id="5826641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5826646">p</span><span class="op" id="5826647">.</span><span class="ident" id="5826648">EscapeString</span><span class="op" id="5826660">(</span><span class="ident" id="5826661">s</span><span class="op" id="5826662">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826672">if</span>&nbsp;<span class="ident" id="5826675">err</span>&nbsp;<span class="op" id="5826679">!=</span>&nbsp;<span class="ident" id="5826682">nil</span>&nbsp;<span class="op" id="5826686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826690">return</span>&nbsp;<span class="ident" id="5826697">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826702">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826706">if</span>&nbsp;<span class="ident" id="5826709">err</span>&nbsp;<span class="op" id="5826713">:=</span>&nbsp;<span class="ident" id="5826716">p</span><span class="op" id="5826717">.</span><span class="ident" id="5826718">writeEnd</span><span class="op" id="5826726">(</span><span class="ident" id="5826727">start</span><span class="op" id="5826732">.</span><span class="ident" id="5826733">Name</span><span class="op" id="5826737">)</span><span class="op" id="5826738">;</span>&nbsp;<span class="ident" id="5826740">err</span>&nbsp;<span class="op" id="5826744">!=</span>&nbsp;<span class="ident" id="5826747">nil</span>&nbsp;<span class="op" id="5826751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826755">return</span>&nbsp;<span class="ident" id="5826762">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5826767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5826771">return</span>&nbsp;<span class="ident" id="5826778">p</span><span class="op" id="5826779">.</span><span class="ident" id="5826780">cachedWriteError</span><span class="op" id="5826796">(</span><span class="op" id="5826797">)</span><br>
<span class="lineno"></span><span class="op" id="5826799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5826802">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="5826860">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="5826919">func</span>&nbsp;<span class="ident" id="5826924">defaultStart</span><span class="op" id="5826936">(</span><span class="ident" id="5826937">typ</span>&nbsp;<span class="ident" id="5826941">reflect</span><span class="op" id="5826948">.</span><span class="ident" id="5826949">Type</span><span class="op" id="5826953">,</span>&nbsp;<span class="ident" id="5826955">finfo</span>&nbsp;<span class="op" id="5826961">*</span><span class="ident" id="5826962">fieldInfo</span><span class="op" id="5826971">,</span>&nbsp;<span class="ident" id="5826973">startTemplate</span>&nbsp;<span class="op" id="5826987">*</span><span class="ident" id="5826988">StartElement</span><span class="op" id="5827000">)</span>&nbsp;<span class="ident" id="5827002">StartElement</span>&nbsp;<span class="op" id="5827015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5827018">var</span>&nbsp;<span class="ident" id="5827022">start</span>&nbsp;<span class="ident" id="5827028">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827042">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827095">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5827162">if</span>&nbsp;<span class="ident" id="5827165">startTemplate</span>&nbsp;<span class="op" id="5827179">!=</span>&nbsp;<span class="ident" id="5827182">nil</span>&nbsp;<span class="op" id="5827186">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827190">start</span><span class="op" id="5827195">.</span><span class="ident" id="5827196">Name</span>&nbsp;<span class="op" id="5827201">=</span>&nbsp;<span class="ident" id="5827203">startTemplate</span><span class="op" id="5827216">.</span><span class="ident" id="5827217">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827224">start</span><span class="op" id="5827229">.</span><span class="ident" id="5827230">Attr</span>&nbsp;<span class="op" id="5827235">=</span>&nbsp;<span class="builtinfunc" id="5827237">append</span><span class="op" id="5827243">(</span><span class="ident" id="5827244">start</span><span class="op" id="5827249">.</span><span class="ident" id="5827250">Attr</span><span class="op" id="5827254">,</span>&nbsp;<span class="ident" id="5827256">startTemplate</span><span class="op" id="5827269">.</span><span class="ident" id="5827270">Attr</span><span class="op" id="5827274">...</span><span class="op" id="5827277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5827280">}</span>&nbsp;<span class="keyword" id="5827282">else</span>&nbsp;<span class="keyword" id="5827287">if</span>&nbsp;<span class="ident" id="5827290">finfo</span>&nbsp;<span class="op" id="5827296">!=</span>&nbsp;<span class="ident" id="5827299">nil</span>&nbsp;<span class="op" id="5827303">&amp;&amp;</span>&nbsp;<span class="ident" id="5827306">finfo</span><span class="op" id="5827311">.</span><span class="ident" id="5827312">name</span>&nbsp;<span class="op" id="5827317">!=</span>&nbsp;<span class="string" id="5827320">&#34;&#34;</span>&nbsp;<span class="op" id="5827323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827327">start</span><span class="op" id="5827332">.</span><span class="ident" id="5827333">Name</span><span class="op" id="5827337">.</span><span class="ident" id="5827338">Local</span>&nbsp;<span class="op" id="5827344">=</span>&nbsp;<span class="ident" id="5827346">finfo</span><span class="op" id="5827351">.</span><span class="ident" id="5827352">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827359">start</span><span class="op" id="5827364">.</span><span class="ident" id="5827365">Name</span><span class="op" id="5827369">.</span><span class="ident" id="5827370">Space</span>&nbsp;<span class="op" id="5827376">=</span>&nbsp;<span class="ident" id="5827378">finfo</span><span class="op" id="5827383">.</span><span class="ident" id="5827384">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5827391">}</span>&nbsp;<span class="keyword" id="5827393">else</span>&nbsp;<span class="keyword" id="5827398">if</span>&nbsp;<span class="ident" id="5827401">typ</span><span class="op" id="5827404">.</span><span class="ident" id="5827405">Name</span><span class="op" id="5827409">(</span><span class="op" id="5827410">)</span>&nbsp;<span class="op" id="5827412">!=</span>&nbsp;<span class="string" id="5827415">&#34;&#34;</span>&nbsp;<span class="op" id="5827418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827422">start</span><span class="op" id="5827427">.</span><span class="ident" id="5827428">Name</span><span class="op" id="5827432">.</span><span class="ident" id="5827433">Local</span>&nbsp;<span class="op" id="5827439">=</span>&nbsp;<span class="ident" id="5827441">typ</span><span class="op" id="5827444">.</span><span class="ident" id="5827445">Name</span><span class="op" id="5827449">(</span><span class="op" id="5827450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5827453">}</span>&nbsp;<span class="keyword" id="5827455">else</span>&nbsp;<span class="op" id="5827460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827464">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827504">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827545">start</span><span class="op" id="5827550">.</span><span class="ident" id="5827551">Name</span><span class="op" id="5827555">.</span><span class="ident" id="5827556">Local</span>&nbsp;<span class="op" id="5827562">=</span>&nbsp;<span class="ident" id="5827564">typ</span><span class="op" id="5827567">.</span><span class="ident" id="5827568">Elem</span><span class="op" id="5827572">(</span><span class="op" id="5827573">)</span><span class="op" id="5827574">.</span><span class="ident" id="5827575">Name</span><span class="op" id="5827579">(</span><span class="op" id="5827580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5827583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5827586">return</span>&nbsp;<span class="ident" id="5827593">start</span><br>
<span class="lineno"></span><span class="op" id="5827599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="5827602">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5827660">func</span>&nbsp;<span class="op" id="5827665">(</span><span class="ident" id="5827666">p</span>&nbsp;<span class="op" id="5827668">*</span><span class="ident" id="5827669">printer</span><span class="op" id="5827676">)</span>&nbsp;<span class="ident" id="5827678">marshalInterface</span><span class="op" id="5827694">(</span><span class="ident" id="5827695">val</span>&nbsp;<span class="ident" id="5827699">Marshaler</span><span class="op" id="5827708">,</span>&nbsp;<span class="ident" id="5827710">start</span>&nbsp;<span class="ident" id="5827716">StartElement</span><span class="op" id="5827728">)</span>&nbsp;<span class="builtintype" id="5827730">error</span>&nbsp;<span class="op" id="5827736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827739">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827795">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827847">p</span><span class="op" id="5827848">.</span><span class="ident" id="5827849">tags</span>&nbsp;<span class="op" id="5827854">=</span>&nbsp;<span class="builtinfunc" id="5827856">append</span><span class="op" id="5827862">(</span><span class="ident" id="5827863">p</span><span class="op" id="5827864">.</span><span class="ident" id="5827865">tags</span><span class="op" id="5827869">,</span>&nbsp;<span class="ident" id="5827871">Name</span><span class="op" id="5827875">{</span><span class="op" id="5827876">}</span><span class="op" id="5827877">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827880">n</span>&nbsp;<span class="op" id="5827882">:=</span>&nbsp;<span class="builtinfunc" id="5827885">len</span><span class="op" id="5827888">(</span><span class="ident" id="5827889">p</span><span class="op" id="5827890">.</span><span class="ident" id="5827891">tags</span><span class="op" id="5827895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827899">err</span>&nbsp;<span class="op" id="5827903">:=</span>&nbsp;<span class="ident" id="5827906">val</span><span class="op" id="5827909">.</span><span class="ident" id="5827910">MarshalXML</span><span class="op" id="5827920">(</span><span class="ident" id="5827921">p</span><span class="op" id="5827922">.</span><span class="ident" id="5827923">encoder</span><span class="op" id="5827930">,</span>&nbsp;<span class="ident" id="5827932">start</span><span class="op" id="5827937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5827940">if</span>&nbsp;<span class="ident" id="5827943">err</span>&nbsp;<span class="op" id="5827947">!=</span>&nbsp;<span class="ident" id="5827950">nil</span>&nbsp;<span class="op" id="5827954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5827958">return</span>&nbsp;<span class="ident" id="5827965">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5827970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5827974">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828045">if</span>&nbsp;<span class="builtinfunc" id="5828048">len</span><span class="op" id="5828051">(</span><span class="ident" id="5828052">p</span><span class="op" id="5828053">.</span><span class="ident" id="5828054">tags</span><span class="op" id="5828058">)</span>&nbsp;<span class="op" id="5828060">&gt;</span>&nbsp;<span class="ident" id="5828062">n</span>&nbsp;<span class="op" id="5828064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828068">return</span>&nbsp;<span class="ident" id="5828075">fmt</span><span class="op" id="5828078">.</span><span class="ident" id="5828079">Errorf</span><span class="op" id="5828085">(</span><span class="string" id="5828086">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="5828141">,</span>&nbsp;<span class="ident" id="5828143">receiverType</span><span class="op" id="5828155">(</span><span class="ident" id="5828156">val</span><span class="op" id="5828159">)</span><span class="op" id="5828160">,</span>&nbsp;<span class="ident" id="5828162">p</span><span class="op" id="5828163">.</span><span class="ident" id="5828164">tags</span><span class="op" id="5828168">[</span><span class="builtinfunc" id="5828169">len</span><span class="op" id="5828172">(</span><span class="ident" id="5828173">p</span><span class="op" id="5828174">.</span><span class="ident" id="5828175">tags</span><span class="op" id="5828179">)</span><span class="op" id="5828180">-</span><span class="num" id="5828181">1</span><span class="op" id="5828182">]</span><span class="op" id="5828183">.</span><span class="ident" id="5828184">Local</span><span class="op" id="5828189">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5828192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828195">p</span><span class="op" id="5828196">.</span><span class="ident" id="5828197">tags</span>&nbsp;<span class="op" id="5828202">=</span>&nbsp;<span class="ident" id="5828204">p</span><span class="op" id="5828205">.</span><span class="ident" id="5828206">tags</span><span class="op" id="5828210">[</span><span class="op" id="5828211">:</span><span class="ident" id="5828212">n</span><span class="op" id="5828213">-</span><span class="num" id="5828214">1</span><span class="op" id="5828215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828218">return</span>&nbsp;<span class="ident" id="5828225">nil</span><br>
<span class="lineno"></span><span class="op" id="5828229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5828232">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5828298">func</span>&nbsp;<span class="op" id="5828303">(</span><span class="ident" id="5828304">p</span>&nbsp;<span class="op" id="5828306">*</span><span class="ident" id="5828307">printer</span><span class="op" id="5828314">)</span>&nbsp;<span class="ident" id="5828316">marshalTextInterface</span><span class="op" id="5828336">(</span><span class="ident" id="5828337">val</span>&nbsp;<span class="ident" id="5828341">encoding</span><span class="op" id="5828349">.</span><span class="ident" id="5828350">TextMarshaler</span><span class="op" id="5828363">,</span>&nbsp;<span class="ident" id="5828365">start</span>&nbsp;<span class="ident" id="5828371">StartElement</span><span class="op" id="5828383">)</span>&nbsp;<span class="builtintype" id="5828385">error</span>&nbsp;<span class="op" id="5828391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828394">if</span>&nbsp;<span class="ident" id="5828397">err</span>&nbsp;<span class="op" id="5828401">:=</span>&nbsp;<span class="ident" id="5828404">p</span><span class="op" id="5828405">.</span><span class="ident" id="5828406">writeStart</span><span class="op" id="5828416">(</span><span class="op" id="5828417">&amp;</span><span class="ident" id="5828418">start</span><span class="op" id="5828423">)</span><span class="op" id="5828424">;</span>&nbsp;<span class="ident" id="5828426">err</span>&nbsp;<span class="op" id="5828430">!=</span>&nbsp;<span class="ident" id="5828433">nil</span>&nbsp;<span class="op" id="5828437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828441">return</span>&nbsp;<span class="ident" id="5828448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5828453">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828456">text</span><span class="op" id="5828460">,</span>&nbsp;<span class="ident" id="5828462">err</span>&nbsp;<span class="op" id="5828466">:=</span>&nbsp;<span class="ident" id="5828469">val</span><span class="op" id="5828472">.</span><span class="ident" id="5828473">MarshalText</span><span class="op" id="5828484">(</span><span class="op" id="5828485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828488">if</span>&nbsp;<span class="ident" id="5828491">err</span>&nbsp;<span class="op" id="5828495">!=</span>&nbsp;<span class="ident" id="5828498">nil</span>&nbsp;<span class="op" id="5828502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828506">return</span>&nbsp;<span class="ident" id="5828513">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5828518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828521">EscapeText</span><span class="op" id="5828531">(</span><span class="ident" id="5828532">p</span><span class="op" id="5828533">,</span>&nbsp;<span class="ident" id="5828535">text</span><span class="op" id="5828539">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828542">return</span>&nbsp;<span class="ident" id="5828549">p</span><span class="op" id="5828550">.</span><span class="ident" id="5828551">writeEnd</span><span class="op" id="5828559">(</span><span class="ident" id="5828560">start</span><span class="op" id="5828565">.</span><span class="ident" id="5828566">Name</span><span class="op" id="5828570">)</span><br>
<span class="lineno"></span><span class="op" id="5828572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5828575">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="5828621">func</span>&nbsp;<span class="op" id="5828626">(</span><span class="ident" id="5828627">p</span>&nbsp;<span class="op" id="5828629">*</span><span class="ident" id="5828630">printer</span><span class="op" id="5828637">)</span>&nbsp;<span class="ident" id="5828639">writeStart</span><span class="op" id="5828649">(</span><span class="ident" id="5828650">start</span>&nbsp;<span class="op" id="5828656">*</span><span class="ident" id="5828657">StartElement</span><span class="op" id="5828669">)</span>&nbsp;<span class="builtintype" id="5828671">error</span>&nbsp;<span class="op" id="5828677">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828680">if</span>&nbsp;<span class="ident" id="5828683">start</span><span class="op" id="5828688">.</span><span class="ident" id="5828689">Name</span><span class="op" id="5828693">.</span><span class="ident" id="5828694">Local</span>&nbsp;<span class="op" id="5828700">==</span>&nbsp;<span class="string" id="5828703">&#34;&#34;</span>&nbsp;<span class="op" id="5828706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828710">return</span>&nbsp;<span class="ident" id="5828717">fmt</span><span class="op" id="5828720">.</span><span class="ident" id="5828721">Errorf</span><span class="op" id="5828727">(</span><span class="string" id="5828728">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5828757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5828760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828764">p</span><span class="op" id="5828765">.</span><span class="ident" id="5828766">tags</span>&nbsp;<span class="op" id="5828771">=</span>&nbsp;<span class="builtinfunc" id="5828773">append</span><span class="op" id="5828779">(</span><span class="ident" id="5828780">p</span><span class="op" id="5828781">.</span><span class="ident" id="5828782">tags</span><span class="op" id="5828786">,</span>&nbsp;<span class="ident" id="5828788">start</span><span class="op" id="5828793">.</span><span class="ident" id="5828794">Name</span><span class="op" id="5828798">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828801">p</span><span class="op" id="5828802">.</span><span class="ident" id="5828803">markPrefix</span><span class="op" id="5828813">(</span><span class="op" id="5828814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828818">p</span><span class="op" id="5828819">.</span><span class="ident" id="5828820">writeIndent</span><span class="op" id="5828831">(</span><span class="num" id="5828832">1</span><span class="op" id="5828833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828836">p</span><span class="op" id="5828837">.</span><span class="ident" id="5828838">WriteByte</span><span class="op" id="5828847">(</span><span class="string" id="5828848">&#39;&lt;&#39;</span><span class="op" id="5828851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828854">p</span><span class="op" id="5828855">.</span><span class="ident" id="5828856">WriteString</span><span class="op" id="5828867">(</span><span class="ident" id="5828868">start</span><span class="op" id="5828873">.</span><span class="ident" id="5828874">Name</span><span class="op" id="5828878">.</span><span class="ident" id="5828879">Local</span><span class="op" id="5828884">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5828888">if</span>&nbsp;<span class="ident" id="5828891">start</span><span class="op" id="5828896">.</span><span class="ident" id="5828897">Name</span><span class="op" id="5828901">.</span><span class="ident" id="5828902">Space</span>&nbsp;<span class="op" id="5828908">!=</span>&nbsp;<span class="string" id="5828911">&#34;&#34;</span>&nbsp;<span class="op" id="5828914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828918">p</span><span class="op" id="5828919">.</span><span class="ident" id="5828920">WriteString</span><span class="op" id="5828931">(</span><span class="string" id="5828932">`&nbsp;xmlns=&#34;`</span><span class="op" id="5828942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828946">p</span><span class="op" id="5828947">.</span><span class="ident" id="5828948">EscapeString</span><span class="op" id="5828960">(</span><span class="ident" id="5828961">start</span><span class="op" id="5828966">.</span><span class="ident" id="5828967">Name</span><span class="op" id="5828971">.</span><span class="ident" id="5828972">Space</span><span class="op" id="5828977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5828981">p</span><span class="op" id="5828982">.</span><span class="ident" id="5828983">WriteByte</span><span class="op" id="5828992">(</span><span class="string" id="5828993">&#39;&#34;&#39;</span><span class="op" id="5828996">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5828999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5829003">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829018">for</span>&nbsp;<span class="ident" id="5829022">_</span><span class="op" id="5829023">,</span>&nbsp;<span class="ident" id="5829025">attr</span>&nbsp;<span class="op" id="5829030">:=</span>&nbsp;<span class="keyword" id="5829033">range</span>&nbsp;<span class="ident" id="5829039">start</span><span class="op" id="5829044">.</span><span class="ident" id="5829045">Attr</span>&nbsp;<span class="op" id="5829050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829054">name</span>&nbsp;<span class="op" id="5829059">:=</span>&nbsp;<span class="ident" id="5829062">attr</span><span class="op" id="5829066">.</span><span class="ident" id="5829067">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829074">if</span>&nbsp;<span class="ident" id="5829077">name</span><span class="op" id="5829081">.</span><span class="ident" id="5829082">Local</span>&nbsp;<span class="op" id="5829088">==</span>&nbsp;<span class="string" id="5829091">&#34;&#34;</span>&nbsp;<span class="op" id="5829094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829099">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829114">p</span><span class="op" id="5829115">.</span><span class="ident" id="5829116">WriteByte</span><span class="op" id="5829125">(</span><span class="string" id="5829126">&#39;&nbsp;&#39;</span><span class="op" id="5829129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829133">if</span>&nbsp;<span class="ident" id="5829136">name</span><span class="op" id="5829140">.</span><span class="ident" id="5829141">Space</span>&nbsp;<span class="op" id="5829147">!=</span>&nbsp;<span class="string" id="5829150">&#34;&#34;</span>&nbsp;<span class="op" id="5829153">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829158">p</span><span class="op" id="5829159">.</span><span class="ident" id="5829160">WriteString</span><span class="op" id="5829171">(</span><span class="ident" id="5829172">p</span><span class="op" id="5829173">.</span><span class="ident" id="5829174">createAttrPrefix</span><span class="op" id="5829190">(</span><span class="ident" id="5829191">name</span><span class="op" id="5829195">.</span><span class="ident" id="5829196">Space</span><span class="op" id="5829201">)</span><span class="op" id="5829202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829207">p</span><span class="op" id="5829208">.</span><span class="ident" id="5829209">WriteByte</span><span class="op" id="5829218">(</span><span class="string" id="5829219">&#39;:&#39;</span><span class="op" id="5829222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829230">p</span><span class="op" id="5829231">.</span><span class="ident" id="5829232">WriteString</span><span class="op" id="5829243">(</span><span class="ident" id="5829244">name</span><span class="op" id="5829248">.</span><span class="ident" id="5829249">Local</span><span class="op" id="5829254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829258">p</span><span class="op" id="5829259">.</span><span class="ident" id="5829260">WriteString</span><span class="op" id="5829271">(</span><span class="string" id="5829272">`=&#34;`</span><span class="op" id="5829276">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829280">p</span><span class="op" id="5829281">.</span><span class="ident" id="5829282">EscapeString</span><span class="op" id="5829294">(</span><span class="ident" id="5829295">attr</span><span class="op" id="5829299">.</span><span class="ident" id="5829300">Value</span><span class="op" id="5829305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829309">p</span><span class="op" id="5829310">.</span><span class="ident" id="5829311">WriteByte</span><span class="op" id="5829320">(</span><span class="string" id="5829321">&#39;&#34;&#39;</span><span class="op" id="5829324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829330">p</span><span class="op" id="5829331">.</span><span class="ident" id="5829332">WriteByte</span><span class="op" id="5829341">(</span><span class="string" id="5829342">&#39;&gt;&#39;</span><span class="op" id="5829345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829348">return</span>&nbsp;<span class="ident" id="5829355">nil</span><br>
<span class="lineno">645</span><span class="op" id="5829359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5829362">func</span>&nbsp;<span class="op" id="5829367">(</span><span class="ident" id="5829368">p</span>&nbsp;<span class="op" id="5829370">*</span><span class="ident" id="5829371">printer</span><span class="op" id="5829378">)</span>&nbsp;<span class="ident" id="5829380">writeEnd</span><span class="op" id="5829388">(</span><span class="ident" id="5829389">name</span>&nbsp;<span class="ident" id="5829394">Name</span><span class="op" id="5829398">)</span>&nbsp;<span class="builtintype" id="5829400">error</span>&nbsp;<span class="op" id="5829406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829409">if</span>&nbsp;<span class="ident" id="5829412">name</span><span class="op" id="5829416">.</span><span class="ident" id="5829417">Local</span>&nbsp;<span class="op" id="5829423">==</span>&nbsp;<span class="string" id="5829426">&#34;&#34;</span>&nbsp;<span class="op" id="5829429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829433">return</span>&nbsp;<span class="ident" id="5829440">fmt</span><span class="op" id="5829443">.</span><span class="ident" id="5829444">Errorf</span><span class="op" id="5829450">(</span><span class="string" id="5829451">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="5829478">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829484">if</span>&nbsp;<span class="builtinfunc" id="5829487">len</span><span class="op" id="5829490">(</span><span class="ident" id="5829491">p</span><span class="op" id="5829492">.</span><span class="ident" id="5829493">tags</span><span class="op" id="5829497">)</span>&nbsp;<span class="op" id="5829499">==</span>&nbsp;<span class="num" id="5829502">0</span>&nbsp;<span class="op" id="5829504">||</span>&nbsp;<span class="ident" id="5829507">p</span><span class="op" id="5829508">.</span><span class="ident" id="5829509">tags</span><span class="op" id="5829513">[</span><span class="builtinfunc" id="5829514">len</span><span class="op" id="5829517">(</span><span class="ident" id="5829518">p</span><span class="op" id="5829519">.</span><span class="ident" id="5829520">tags</span><span class="op" id="5829524">)</span><span class="op" id="5829525">-</span><span class="num" id="5829526">1</span><span class="op" id="5829527">]</span><span class="op" id="5829528">.</span><span class="ident" id="5829529">Local</span>&nbsp;<span class="op" id="5829535">==</span>&nbsp;<span class="string" id="5829538">&#34;&#34;</span>&nbsp;<span class="op" id="5829541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829545">return</span>&nbsp;<span class="ident" id="5829552">fmt</span><span class="op" id="5829555">.</span><span class="ident" id="5829556">Errorf</span><span class="op" id="5829562">(</span><span class="string" id="5829563">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="5829601">,</span>&nbsp;<span class="ident" id="5829603">name</span><span class="op" id="5829607">.</span><span class="ident" id="5829608">Local</span><span class="op" id="5829613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829619">if</span>&nbsp;<span class="ident" id="5829622">top</span>&nbsp;<span class="op" id="5829626">:=</span>&nbsp;<span class="ident" id="5829629">p</span><span class="op" id="5829630">.</span><span class="ident" id="5829631">tags</span><span class="op" id="5829635">[</span><span class="builtinfunc" id="5829636">len</span><span class="op" id="5829639">(</span><span class="ident" id="5829640">p</span><span class="op" id="5829641">.</span><span class="ident" id="5829642">tags</span><span class="op" id="5829646">)</span><span class="op" id="5829647">-</span><span class="num" id="5829648">1</span><span class="op" id="5829649">]</span><span class="op" id="5829650">;</span>&nbsp;<span class="ident" id="5829652">top</span>&nbsp;<span class="op" id="5829656">!=</span>&nbsp;<span class="ident" id="5829659">name</span>&nbsp;<span class="op" id="5829664">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829668">if</span>&nbsp;<span class="ident" id="5829671">top</span><span class="op" id="5829674">.</span><span class="ident" id="5829675">Local</span>&nbsp;<span class="op" id="5829681">!=</span>&nbsp;<span class="ident" id="5829684">name</span><span class="op" id="5829688">.</span><span class="ident" id="5829689">Local</span>&nbsp;<span class="op" id="5829695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829700">return</span>&nbsp;<span class="ident" id="5829707">fmt</span><span class="op" id="5829710">.</span><span class="ident" id="5829711">Errorf</span><span class="op" id="5829717">(</span><span class="string" id="5829718">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="5829768">,</span>&nbsp;<span class="ident" id="5829770">name</span><span class="op" id="5829774">.</span><span class="ident" id="5829775">Local</span><span class="op" id="5829780">,</span>&nbsp;<span class="ident" id="5829782">top</span><span class="op" id="5829785">.</span><span class="ident" id="5829786">Local</span><span class="op" id="5829791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5829799">return</span>&nbsp;<span class="ident" id="5829806">fmt</span><span class="op" id="5829809">.</span><span class="ident" id="5829810">Errorf</span><span class="op" id="5829816">(</span><span class="string" id="5829817">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="5829899">,</span>&nbsp;<span class="ident" id="5829901">name</span><span class="op" id="5829905">.</span><span class="ident" id="5829906">Local</span><span class="op" id="5829911">,</span>&nbsp;<span class="ident" id="5829913">name</span><span class="op" id="5829917">.</span><span class="ident" id="5829918">Space</span><span class="op" id="5829923">,</span>&nbsp;<span class="ident" id="5829925">top</span><span class="op" id="5829928">.</span><span class="ident" id="5829929">Local</span><span class="op" id="5829934">,</span>&nbsp;<span class="ident" id="5829936">top</span><span class="op" id="5829939">.</span><span class="ident" id="5829940">Space</span><span class="op" id="5829945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5829948">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829951">p</span><span class="op" id="5829952">.</span><span class="ident" id="5829953">tags</span>&nbsp;<span class="op" id="5829958">=</span>&nbsp;<span class="ident" id="5829960">p</span><span class="op" id="5829961">.</span><span class="ident" id="5829962">tags</span><span class="op" id="5829966">[</span><span class="op" id="5829967">:</span><span class="builtinfunc" id="5829968">len</span><span class="op" id="5829971">(</span><span class="ident" id="5829972">p</span><span class="op" id="5829973">.</span><span class="ident" id="5829974">tags</span><span class="op" id="5829978">)</span><span class="op" id="5829979">-</span><span class="num" id="5829980">1</span><span class="op" id="5829981">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5829985">p</span><span class="op" id="5829986">.</span><span class="ident" id="5829987">writeIndent</span><span class="op" id="5829998">(</span><span class="op" id="5829999">-</span><span class="num" id="5830000">1</span><span class="op" id="5830001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830004">p</span><span class="op" id="5830005">.</span><span class="ident" id="5830006">WriteByte</span><span class="op" id="5830015">(</span><span class="string" id="5830016">&#39;&lt;&#39;</span><span class="op" id="5830019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830022">p</span><span class="op" id="5830023">.</span><span class="ident" id="5830024">WriteByte</span><span class="op" id="5830033">(</span><span class="string" id="5830034">&#39;/&#39;</span><span class="op" id="5830037">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830040">p</span><span class="op" id="5830041">.</span><span class="ident" id="5830042">WriteString</span><span class="op" id="5830053">(</span><span class="ident" id="5830054">name</span><span class="op" id="5830058">.</span><span class="ident" id="5830059">Local</span><span class="op" id="5830064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830067">p</span><span class="op" id="5830068">.</span><span class="ident" id="5830069">WriteByte</span><span class="op" id="5830078">(</span><span class="string" id="5830079">&#39;&gt;&#39;</span><span class="op" id="5830082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830085">p</span><span class="op" id="5830086">.</span><span class="ident" id="5830087">popPrefix</span><span class="op" id="5830096">(</span><span class="op" id="5830097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830100">return</span>&nbsp;<span class="ident" id="5830107">nil</span><br>
<span class="lineno"></span><span class="op" id="5830111">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="5830114">func</span>&nbsp;<span class="op" id="5830119">(</span><span class="ident" id="5830120">p</span>&nbsp;<span class="op" id="5830122">*</span><span class="ident" id="5830123">printer</span><span class="op" id="5830130">)</span>&nbsp;<span class="ident" id="5830132">marshalSimple</span><span class="op" id="5830145">(</span><span class="ident" id="5830146">typ</span>&nbsp;<span class="ident" id="5830150">reflect</span><span class="op" id="5830157">.</span><span class="ident" id="5830158">Type</span><span class="op" id="5830162">,</span>&nbsp;<span class="ident" id="5830164">val</span>&nbsp;<span class="ident" id="5830168">reflect</span><span class="op" id="5830175">.</span><span class="ident" id="5830176">Value</span><span class="op" id="5830181">)</span>&nbsp;<span class="op" id="5830183">(</span><span class="builtintype" id="5830184">string</span><span class="op" id="5830190">,</span>&nbsp;<span class="op" id="5830192">[</span><span class="op" id="5830193">]</span><span class="builtintype" id="5830194">byte</span><span class="op" id="5830198">,</span>&nbsp;<span class="builtintype" id="5830200">error</span><span class="op" id="5830205">)</span>&nbsp;<span class="op" id="5830207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830210">switch</span>&nbsp;<span class="ident" id="5830217">val</span><span class="op" id="5830220">.</span><span class="ident" id="5830221">Kind</span><span class="op" id="5830225">(</span><span class="op" id="5830226">)</span>&nbsp;<span class="op" id="5830228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830231">case</span>&nbsp;<span class="ident" id="5830236">reflect</span><span class="op" id="5830243">.</span><span class="ident" id="5830244">Int</span><span class="op" id="5830247">,</span>&nbsp;<span class="ident" id="5830249">reflect</span><span class="op" id="5830256">.</span><span class="ident" id="5830257">Int8</span><span class="op" id="5830261">,</span>&nbsp;<span class="ident" id="5830263">reflect</span><span class="op" id="5830270">.</span><span class="ident" id="5830271">Int16</span><span class="op" id="5830276">,</span>&nbsp;<span class="ident" id="5830278">reflect</span><span class="op" id="5830285">.</span><span class="ident" id="5830286">Int32</span><span class="op" id="5830291">,</span>&nbsp;<span class="ident" id="5830293">reflect</span><span class="op" id="5830300">.</span><span class="ident" id="5830301">Int64</span><span class="op" id="5830306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830310">return</span>&nbsp;<span class="ident" id="5830317">strconv</span><span class="op" id="5830324">.</span><span class="ident" id="5830325">FormatInt</span><span class="op" id="5830334">(</span><span class="ident" id="5830335">val</span><span class="op" id="5830338">.</span><span class="ident" id="5830339">Int</span><span class="op" id="5830342">(</span><span class="op" id="5830343">)</span><span class="op" id="5830344">,</span>&nbsp;<span class="num" id="5830346">10</span><span class="op" id="5830348">)</span><span class="op" id="5830349">,</span>&nbsp;<span class="ident" id="5830351">nil</span><span class="op" id="5830354">,</span>&nbsp;<span class="ident" id="5830356">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830361">case</span>&nbsp;<span class="ident" id="5830366">reflect</span><span class="op" id="5830373">.</span><span class="ident" id="5830374">Uint</span><span class="op" id="5830378">,</span>&nbsp;<span class="ident" id="5830380">reflect</span><span class="op" id="5830387">.</span><span class="ident" id="5830388">Uint8</span><span class="op" id="5830393">,</span>&nbsp;<span class="ident" id="5830395">reflect</span><span class="op" id="5830402">.</span><span class="ident" id="5830403">Uint16</span><span class="op" id="5830409">,</span>&nbsp;<span class="ident" id="5830411">reflect</span><span class="op" id="5830418">.</span><span class="ident" id="5830419">Uint32</span><span class="op" id="5830425">,</span>&nbsp;<span class="ident" id="5830427">reflect</span><span class="op" id="5830434">.</span><span class="ident" id="5830435">Uint64</span><span class="op" id="5830441">,</span>&nbsp;<span class="ident" id="5830443">reflect</span><span class="op" id="5830450">.</span><span class="ident" id="5830451">Uintptr</span><span class="op" id="5830458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830462">return</span>&nbsp;<span class="ident" id="5830469">strconv</span><span class="op" id="5830476">.</span><span class="ident" id="5830477">FormatUint</span><span class="op" id="5830487">(</span><span class="ident" id="5830488">val</span><span class="op" id="5830491">.</span><span class="ident" id="5830492">Uint</span><span class="op" id="5830496">(</span><span class="op" id="5830497">)</span><span class="op" id="5830498">,</span>&nbsp;<span class="num" id="5830500">10</span><span class="op" id="5830502">)</span><span class="op" id="5830503">,</span>&nbsp;<span class="ident" id="5830505">nil</span><span class="op" id="5830508">,</span>&nbsp;<span class="ident" id="5830510">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830515">case</span>&nbsp;<span class="ident" id="5830520">reflect</span><span class="op" id="5830527">.</span><span class="ident" id="5830528">Float32</span><span class="op" id="5830535">,</span>&nbsp;<span class="ident" id="5830537">reflect</span><span class="op" id="5830544">.</span><span class="ident" id="5830545">Float64</span><span class="op" id="5830552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830556">return</span>&nbsp;<span class="ident" id="5830563">strconv</span><span class="op" id="5830570">.</span><span class="ident" id="5830571">FormatFloat</span><span class="op" id="5830582">(</span><span class="ident" id="5830583">val</span><span class="op" id="5830586">.</span><span class="ident" id="5830587">Float</span><span class="op" id="5830592">(</span><span class="op" id="5830593">)</span><span class="op" id="5830594">,</span>&nbsp;<span class="string" id="5830596">&#39;g&#39;</span><span class="op" id="5830599">,</span>&nbsp;<span class="op" id="5830601">-</span><span class="num" id="5830602">1</span><span class="op" id="5830603">,</span>&nbsp;<span class="ident" id="5830605">val</span><span class="op" id="5830608">.</span><span class="ident" id="5830609">Type</span><span class="op" id="5830613">(</span><span class="op" id="5830614">)</span><span class="op" id="5830615">.</span><span class="ident" id="5830616">Bits</span><span class="op" id="5830620">(</span><span class="op" id="5830621">)</span><span class="op" id="5830622">)</span><span class="op" id="5830623">,</span>&nbsp;<span class="ident" id="5830625">nil</span><span class="op" id="5830628">,</span>&nbsp;<span class="ident" id="5830630">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830635">case</span>&nbsp;<span class="ident" id="5830640">reflect</span><span class="op" id="5830647">.</span><span class="ident" id="5830648">String</span><span class="op" id="5830654">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830658">return</span>&nbsp;<span class="ident" id="5830665">val</span><span class="op" id="5830668">.</span><span class="ident" id="5830669">String</span><span class="op" id="5830675">(</span><span class="op" id="5830676">)</span><span class="op" id="5830677">,</span>&nbsp;<span class="ident" id="5830679">nil</span><span class="op" id="5830682">,</span>&nbsp;<span class="ident" id="5830684">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830689">case</span>&nbsp;<span class="ident" id="5830694">reflect</span><span class="op" id="5830701">.</span><span class="ident" id="5830702">Bool</span><span class="op" id="5830706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830710">return</span>&nbsp;<span class="ident" id="5830717">strconv</span><span class="op" id="5830724">.</span><span class="ident" id="5830725">FormatBool</span><span class="op" id="5830735">(</span><span class="ident" id="5830736">val</span><span class="op" id="5830739">.</span><span class="ident" id="5830740">Bool</span><span class="op" id="5830744">(</span><span class="op" id="5830745">)</span><span class="op" id="5830746">)</span><span class="op" id="5830747">,</span>&nbsp;<span class="ident" id="5830749">nil</span><span class="op" id="5830752">,</span>&nbsp;<span class="ident" id="5830754">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830759">case</span>&nbsp;<span class="ident" id="5830764">reflect</span><span class="op" id="5830771">.</span><span class="ident" id="5830772">Array</span><span class="op" id="5830777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830781">if</span>&nbsp;<span class="ident" id="5830784">typ</span><span class="op" id="5830787">.</span><span class="ident" id="5830788">Elem</span><span class="op" id="5830792">(</span><span class="op" id="5830793">)</span><span class="op" id="5830794">.</span><span class="ident" id="5830795">Kind</span><span class="op" id="5830799">(</span><span class="op" id="5830800">)</span>&nbsp;<span class="op" id="5830802">!=</span>&nbsp;<span class="ident" id="5830805">reflect</span><span class="op" id="5830812">.</span><span class="ident" id="5830813">Uint8</span>&nbsp;<span class="op" id="5830819">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830824">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5830832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5830836">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830851">var</span>&nbsp;<span class="ident" id="5830855">bytes</span>&nbsp;<span class="op" id="5830861">[</span><span class="op" id="5830862">]</span><span class="builtintype" id="5830863">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5830870">if</span>&nbsp;<span class="ident" id="5830873">val</span><span class="op" id="5830876">.</span><span class="ident" id="5830877">CanAddr</span><span class="op" id="5830884">(</span><span class="op" id="5830885">)</span>&nbsp;<span class="op" id="5830887">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830892">bytes</span>&nbsp;<span class="op" id="5830898">=</span>&nbsp;<span class="ident" id="5830900">val</span><span class="op" id="5830903">.</span><span class="ident" id="5830904">Slice</span><span class="op" id="5830909">(</span><span class="num" id="5830910">0</span><span class="op" id="5830911">,</span>&nbsp;<span class="ident" id="5830913">val</span><span class="op" id="5830916">.</span><span class="ident" id="5830917">Len</span><span class="op" id="5830920">(</span><span class="op" id="5830921">)</span><span class="op" id="5830922">)</span><span class="op" id="5830923">.</span><span class="ident" id="5830924">Bytes</span><span class="op" id="5830929">(</span><span class="op" id="5830930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5830934">}</span>&nbsp;<span class="keyword" id="5830936">else</span>&nbsp;<span class="op" id="5830941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830946">bytes</span>&nbsp;<span class="op" id="5830952">=</span>&nbsp;<span class="builtinfunc" id="5830954">make</span><span class="op" id="5830958">(</span><span class="op" id="5830959">[</span><span class="op" id="5830960">]</span><span class="builtintype" id="5830961">byte</span><span class="op" id="5830965">,</span>&nbsp;<span class="ident" id="5830967">val</span><span class="op" id="5830970">.</span><span class="ident" id="5830971">Len</span><span class="op" id="5830974">(</span><span class="op" id="5830975">)</span><span class="op" id="5830976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5830981">reflect</span><span class="op" id="5830988">.</span><span class="ident" id="5830989">Copy</span><span class="op" id="5830993">(</span><span class="ident" id="5830994">reflect</span><span class="op" id="5831001">.</span><span class="ident" id="5831002">ValueOf</span><span class="op" id="5831009">(</span><span class="ident" id="5831010">bytes</span><span class="op" id="5831015">)</span><span class="op" id="5831016">,</span>&nbsp;<span class="ident" id="5831018">val</span><span class="op" id="5831021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831025">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831029">return</span>&nbsp;<span class="string" id="5831036">&#34;&#34;</span><span class="op" id="5831038">,</span>&nbsp;<span class="ident" id="5831040">bytes</span><span class="op" id="5831045">,</span>&nbsp;<span class="ident" id="5831047">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831052">case</span>&nbsp;<span class="ident" id="5831057">reflect</span><span class="op" id="5831064">.</span><span class="ident" id="5831065">Slice</span><span class="op" id="5831070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831074">if</span>&nbsp;<span class="ident" id="5831077">typ</span><span class="op" id="5831080">.</span><span class="ident" id="5831081">Elem</span><span class="op" id="5831085">(</span><span class="op" id="5831086">)</span><span class="op" id="5831087">.</span><span class="ident" id="5831088">Kind</span><span class="op" id="5831092">(</span><span class="op" id="5831093">)</span>&nbsp;<span class="op" id="5831095">!=</span>&nbsp;<span class="ident" id="5831098">reflect</span><span class="op" id="5831105">.</span><span class="ident" id="5831106">Uint8</span>&nbsp;<span class="op" id="5831112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831117">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831125">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5831129">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831141">return</span>&nbsp;<span class="string" id="5831148">&#34;&#34;</span><span class="op" id="5831150">,</span>&nbsp;<span class="ident" id="5831152">val</span><span class="op" id="5831155">.</span><span class="ident" id="5831156">Bytes</span><span class="op" id="5831161">(</span><span class="op" id="5831162">)</span><span class="op" id="5831163">,</span>&nbsp;<span class="ident" id="5831165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831173">return</span>&nbsp;<span class="string" id="5831180">&#34;&#34;</span><span class="op" id="5831182">,</span>&nbsp;<span class="ident" id="5831184">nil</span><span class="op" id="5831187">,</span>&nbsp;<span class="op" id="5831189">&amp;</span><span class="ident" id="5831190">UnsupportedTypeError</span><span class="op" id="5831210">{</span><span class="ident" id="5831211">typ</span><span class="op" id="5831214">}</span><br>
<span class="lineno"></span><span class="op" id="5831216">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="5831219">var</span>&nbsp;<span class="ident" id="5831223">ddBytes</span>&nbsp;<span class="op" id="5831231">=</span>&nbsp;<span class="op" id="5831233">[</span><span class="op" id="5831234">]</span><span class="builtintype" id="5831235">byte</span><span class="op" id="5831239">(</span><span class="string" id="5831240">&#34;--&#34;</span><span class="op" id="5831244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5831247">func</span>&nbsp;<span class="op" id="5831252">(</span><span class="ident" id="5831253">p</span>&nbsp;<span class="op" id="5831255">*</span><span class="ident" id="5831256">printer</span><span class="op" id="5831263">)</span>&nbsp;<span class="ident" id="5831265">marshalStruct</span><span class="op" id="5831278">(</span><span class="ident" id="5831279">tinfo</span>&nbsp;<span class="op" id="5831285">*</span><span class="ident" id="5831286">typeInfo</span><span class="op" id="5831294">,</span>&nbsp;<span class="ident" id="5831296">val</span>&nbsp;<span class="ident" id="5831300">reflect</span><span class="op" id="5831307">.</span><span class="ident" id="5831308">Value</span><span class="op" id="5831313">)</span>&nbsp;<span class="builtintype" id="5831315">error</span>&nbsp;<span class="op" id="5831321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831324">s</span>&nbsp;<span class="op" id="5831326">:=</span>&nbsp;<span class="ident" id="5831329">parentStack</span><span class="op" id="5831340">{</span><span class="ident" id="5831341">p</span><span class="op" id="5831342">:</span>&nbsp;<span class="ident" id="5831344">p</span><span class="op" id="5831345">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831348">for</span>&nbsp;<span class="ident" id="5831352">i</span>&nbsp;<span class="op" id="5831354">:=</span>&nbsp;<span class="keyword" id="5831357">range</span>&nbsp;<span class="ident" id="5831363">tinfo</span><span class="op" id="5831368">.</span><span class="ident" id="5831369">fields</span>&nbsp;<span class="op" id="5831376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831380">finfo</span>&nbsp;<span class="op" id="5831386">:=</span>&nbsp;<span class="op" id="5831389">&amp;</span><span class="ident" id="5831390">tinfo</span><span class="op" id="5831395">.</span><span class="ident" id="5831396">fields</span><span class="op" id="5831402">[</span><span class="ident" id="5831403">i</span><span class="op" id="5831404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831408">if</span>&nbsp;<span class="ident" id="5831411">finfo</span><span class="op" id="5831416">.</span><span class="ident" id="5831417">flags</span><span class="op" id="5831422">&amp;</span><span class="ident" id="5831423">fAttr</span>&nbsp;<span class="op" id="5831429">!=</span>&nbsp;<span class="num" id="5831432">0</span>&nbsp;<span class="op" id="5831434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831450">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831454">vf</span>&nbsp;<span class="op" id="5831457">:=</span>&nbsp;<span class="ident" id="5831460">finfo</span><span class="op" id="5831465">.</span><span class="ident" id="5831466">value</span><span class="op" id="5831471">(</span><span class="ident" id="5831472">val</span><span class="op" id="5831475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5831480">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831536">switch</span>&nbsp;<span class="ident" id="5831543">vf</span><span class="op" id="5831545">.</span><span class="ident" id="5831546">Kind</span><span class="op" id="5831550">(</span><span class="op" id="5831551">)</span>&nbsp;<span class="op" id="5831553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831557">case</span>&nbsp;<span class="ident" id="5831562">reflect</span><span class="op" id="5831569">.</span><span class="ident" id="5831570">Ptr</span><span class="op" id="5831573">,</span>&nbsp;<span class="ident" id="5831575">reflect</span><span class="op" id="5831582">.</span><span class="ident" id="5831583">Interface</span><span class="op" id="5831592">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831597">if</span>&nbsp;<span class="op" id="5831600">!</span><span class="ident" id="5831601">vf</span><span class="op" id="5831603">.</span><span class="ident" id="5831604">IsNil</span><span class="op" id="5831609">(</span><span class="op" id="5831610">)</span>&nbsp;<span class="op" id="5831612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831618">vf</span>&nbsp;<span class="op" id="5831621">=</span>&nbsp;<span class="ident" id="5831623">vf</span><span class="op" id="5831625">.</span><span class="ident" id="5831626">Elem</span><span class="op" id="5831630">(</span><span class="op" id="5831631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831645">switch</span>&nbsp;<span class="ident" id="5831652">finfo</span><span class="op" id="5831657">.</span><span class="ident" id="5831658">flags</span>&nbsp;<span class="op" id="5831664">&amp;</span>&nbsp;<span class="ident" id="5831666">fMode</span>&nbsp;<span class="op" id="5831672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831676">case</span>&nbsp;<span class="ident" id="5831681">fCharData</span><span class="op" id="5831690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831695">if</span>&nbsp;<span class="ident" id="5831698">vf</span><span class="op" id="5831700">.</span><span class="ident" id="5831701">CanInterface</span><span class="op" id="5831713">(</span><span class="op" id="5831714">)</span>&nbsp;<span class="op" id="5831716">&amp;&amp;</span>&nbsp;<span class="ident" id="5831719">vf</span><span class="op" id="5831721">.</span><span class="ident" id="5831722">Type</span><span class="op" id="5831726">(</span><span class="op" id="5831727">)</span><span class="op" id="5831728">.</span><span class="ident" id="5831729">Implements</span><span class="op" id="5831739">(</span><span class="ident" id="5831740">textMarshalerType</span><span class="op" id="5831757">)</span>&nbsp;<span class="op" id="5831759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831765">data</span><span class="op" id="5831769">,</span>&nbsp;<span class="ident" id="5831771">err</span>&nbsp;<span class="op" id="5831775">:=</span>&nbsp;<span class="ident" id="5831778">vf</span><span class="op" id="5831780">.</span><span class="ident" id="5831781">Interface</span><span class="op" id="5831790">(</span><span class="op" id="5831791">)</span><span class="op" id="5831792">.</span><span class="op" id="5831793">(</span><span class="ident" id="5831794">encoding</span><span class="op" id="5831802">.</span><span class="ident" id="5831803">TextMarshaler</span><span class="op" id="5831816">)</span><span class="op" id="5831817">.</span><span class="ident" id="5831818">MarshalText</span><span class="op" id="5831829">(</span><span class="op" id="5831830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831836">if</span>&nbsp;<span class="ident" id="5831839">err</span>&nbsp;<span class="op" id="5831843">!=</span>&nbsp;<span class="ident" id="5831846">nil</span>&nbsp;<span class="op" id="5831850">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831857">return</span>&nbsp;<span class="ident" id="5831864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831878">Escape</span><span class="op" id="5831884">(</span><span class="ident" id="5831885">p</span><span class="op" id="5831886">,</span>&nbsp;<span class="ident" id="5831888">data</span><span class="op" id="5831892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831898">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5831910">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831915">if</span>&nbsp;<span class="ident" id="5831918">vf</span><span class="op" id="5831920">.</span><span class="ident" id="5831921">CanAddr</span><span class="op" id="5831928">(</span><span class="op" id="5831929">)</span>&nbsp;<span class="op" id="5831931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5831937">pv</span>&nbsp;<span class="op" id="5831940">:=</span>&nbsp;<span class="ident" id="5831943">vf</span><span class="op" id="5831945">.</span><span class="ident" id="5831946">Addr</span><span class="op" id="5831950">(</span><span class="op" id="5831951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5831957">if</span>&nbsp;<span class="ident" id="5831960">pv</span><span class="op" id="5831962">.</span><span class="ident" id="5831963">CanInterface</span><span class="op" id="5831975">(</span><span class="op" id="5831976">)</span>&nbsp;<span class="op" id="5831978">&amp;&amp;</span>&nbsp;<span class="ident" id="5831981">pv</span><span class="op" id="5831983">.</span><span class="ident" id="5831984">Type</span><span class="op" id="5831988">(</span><span class="op" id="5831989">)</span><span class="op" id="5831990">.</span><span class="ident" id="5831991">Implements</span><span class="op" id="5832001">(</span><span class="ident" id="5832002">textMarshalerType</span><span class="op" id="5832019">)</span>&nbsp;<span class="op" id="5832021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832028">data</span><span class="op" id="5832032">,</span>&nbsp;<span class="ident" id="5832034">err</span>&nbsp;<span class="op" id="5832038">:=</span>&nbsp;<span class="ident" id="5832041">pv</span><span class="op" id="5832043">.</span><span class="ident" id="5832044">Interface</span><span class="op" id="5832053">(</span><span class="op" id="5832054">)</span><span class="op" id="5832055">.</span><span class="op" id="5832056">(</span><span class="ident" id="5832057">encoding</span><span class="op" id="5832065">.</span><span class="ident" id="5832066">TextMarshaler</span><span class="op" id="5832079">)</span><span class="op" id="5832080">.</span><span class="ident" id="5832081">MarshalText</span><span class="op" id="5832092">(</span><span class="op" id="5832093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832100">if</span>&nbsp;<span class="ident" id="5832103">err</span>&nbsp;<span class="op" id="5832107">!=</span>&nbsp;<span class="ident" id="5832110">nil</span>&nbsp;<span class="op" id="5832114">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832122">return</span>&nbsp;<span class="ident" id="5832129">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5832138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832145">Escape</span><span class="op" id="5832151">(</span><span class="ident" id="5832152">p</span><span class="op" id="5832153">,</span>&nbsp;<span class="ident" id="5832155">data</span><span class="op" id="5832159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832166">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5832179">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5832184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832189">var</span>&nbsp;<span class="ident" id="5832193">scratch</span>&nbsp;<span class="op" id="5832201">[</span><span class="num" id="5832202">64</span><span class="op" id="5832204">]</span><span class="builtintype" id="5832205">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832213">switch</span>&nbsp;<span class="ident" id="5832220">vf</span><span class="op" id="5832222">.</span><span class="ident" id="5832223">Kind</span><span class="op" id="5832227">(</span><span class="op" id="5832228">)</span>&nbsp;<span class="op" id="5832230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832235">case</span>&nbsp;<span class="ident" id="5832240">reflect</span><span class="op" id="5832247">.</span><span class="ident" id="5832248">Int</span><span class="op" id="5832251">,</span>&nbsp;<span class="ident" id="5832253">reflect</span><span class="op" id="5832260">.</span><span class="ident" id="5832261">Int8</span><span class="op" id="5832265">,</span>&nbsp;<span class="ident" id="5832267">reflect</span><span class="op" id="5832274">.</span><span class="ident" id="5832275">Int16</span><span class="op" id="5832280">,</span>&nbsp;<span class="ident" id="5832282">reflect</span><span class="op" id="5832289">.</span><span class="ident" id="5832290">Int32</span><span class="op" id="5832295">,</span>&nbsp;<span class="ident" id="5832297">reflect</span><span class="op" id="5832304">.</span><span class="ident" id="5832305">Int64</span><span class="op" id="5832310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832316">Escape</span><span class="op" id="5832322">(</span><span class="ident" id="5832323">p</span><span class="op" id="5832324">,</span>&nbsp;<span class="ident" id="5832326">strconv</span><span class="op" id="5832333">.</span><span class="ident" id="5832334">AppendInt</span><span class="op" id="5832343">(</span><span class="ident" id="5832344">scratch</span><span class="op" id="5832351">[</span><span class="op" id="5832352">:</span><span class="num" id="5832353">0</span><span class="op" id="5832354">]</span><span class="op" id="5832355">,</span>&nbsp;<span class="ident" id="5832357">vf</span><span class="op" id="5832359">.</span><span class="ident" id="5832360">Int</span><span class="op" id="5832363">(</span><span class="op" id="5832364">)</span><span class="op" id="5832365">,</span>&nbsp;<span class="num" id="5832367">10</span><span class="op" id="5832369">)</span><span class="op" id="5832370">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832375">case</span>&nbsp;<span class="ident" id="5832380">reflect</span><span class="op" id="5832387">.</span><span class="ident" id="5832388">Uint</span><span class="op" id="5832392">,</span>&nbsp;<span class="ident" id="5832394">reflect</span><span class="op" id="5832401">.</span><span class="ident" id="5832402">Uint8</span><span class="op" id="5832407">,</span>&nbsp;<span class="ident" id="5832409">reflect</span><span class="op" id="5832416">.</span><span class="ident" id="5832417">Uint16</span><span class="op" id="5832423">,</span>&nbsp;<span class="ident" id="5832425">reflect</span><span class="op" id="5832432">.</span><span class="ident" id="5832433">Uint32</span><span class="op" id="5832439">,</span>&nbsp;<span class="ident" id="5832441">reflect</span><span class="op" id="5832448">.</span><span class="ident" id="5832449">Uint64</span><span class="op" id="5832455">,</span>&nbsp;<span class="ident" id="5832457">reflect</span><span class="op" id="5832464">.</span><span class="ident" id="5832465">Uintptr</span><span class="op" id="5832472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832478">Escape</span><span class="op" id="5832484">(</span><span class="ident" id="5832485">p</span><span class="op" id="5832486">,</span>&nbsp;<span class="ident" id="5832488">strconv</span><span class="op" id="5832495">.</span><span class="ident" id="5832496">AppendUint</span><span class="op" id="5832506">(</span><span class="ident" id="5832507">scratch</span><span class="op" id="5832514">[</span><span class="op" id="5832515">:</span><span class="num" id="5832516">0</span><span class="op" id="5832517">]</span><span class="op" id="5832518">,</span>&nbsp;<span class="ident" id="5832520">vf</span><span class="op" id="5832522">.</span><span class="ident" id="5832523">Uint</span><span class="op" id="5832527">(</span><span class="op" id="5832528">)</span><span class="op" id="5832529">,</span>&nbsp;<span class="num" id="5832531">10</span><span class="op" id="5832533">)</span><span class="op" id="5832534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832539">case</span>&nbsp;<span class="ident" id="5832544">reflect</span><span class="op" id="5832551">.</span><span class="ident" id="5832552">Float32</span><span class="op" id="5832559">,</span>&nbsp;<span class="ident" id="5832561">reflect</span><span class="op" id="5832568">.</span><span class="ident" id="5832569">Float64</span><span class="op" id="5832576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832582">Escape</span><span class="op" id="5832588">(</span><span class="ident" id="5832589">p</span><span class="op" id="5832590">,</span>&nbsp;<span class="ident" id="5832592">strconv</span><span class="op" id="5832599">.</span><span class="ident" id="5832600">AppendFloat</span><span class="op" id="5832611">(</span><span class="ident" id="5832612">scratch</span><span class="op" id="5832619">[</span><span class="op" id="5832620">:</span><span class="num" id="5832621">0</span><span class="op" id="5832622">]</span><span class="op" id="5832623">,</span>&nbsp;<span class="ident" id="5832625">vf</span><span class="op" id="5832627">.</span><span class="ident" id="5832628">Float</span><span class="op" id="5832633">(</span><span class="op" id="5832634">)</span><span class="op" id="5832635">,</span>&nbsp;<span class="string" id="5832637">&#39;g&#39;</span><span class="op" id="5832640">,</span>&nbsp;<span class="op" id="5832642">-</span><span class="num" id="5832643">1</span><span class="op" id="5832644">,</span>&nbsp;<span class="ident" id="5832646">vf</span><span class="op" id="5832648">.</span><span class="ident" id="5832649">Type</span><span class="op" id="5832653">(</span><span class="op" id="5832654">)</span><span class="op" id="5832655">.</span><span class="ident" id="5832656">Bits</span><span class="op" id="5832660">(</span><span class="op" id="5832661">)</span><span class="op" id="5832662">)</span><span class="op" id="5832663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832668">case</span>&nbsp;<span class="ident" id="5832673">reflect</span><span class="op" id="5832680">.</span><span class="ident" id="5832681">Bool</span><span class="op" id="5832685">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5832691">Escape</span><span class="op" id="5832697">(</span><span class="ident" id="5832698">p</span><span class="op" id="5832699">,</span>&nbsp;<span class="ident" id="5832701">strconv</span><span class="op" id="5832708">.</span><span class="ident" id="5832709">AppendBool</span><span class="op" id="5832719">(</span><span class="ident" id="5832720">scratch</span><span class="op" id="5832727">[</span><span class="op" id="5832728">:</span><span class="num" id="5832729">0</span><span class="op" id="5832730">]</span><span class="op" id="5832731">,</span>&nbsp;<span class="ident" id="5832733">vf</span><span class="op" id="5832735">.</span><span class="ident" id="5832736">Bool</span><span class="op" id="5832740">(</span><span class="op" id="5832741">)</span><span class="op" id="5832742">)</span><span class="op" id="5832743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832748">case</span>&nbsp;<span class="ident" id="5832753">reflect</span><span class="op" id="5832760">.</span><span class="ident" id="5832761">String</span><span class="op" id="5832767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832773">if</span>&nbsp;<span class="ident" id="5832776">err</span>&nbsp;<span class="op" id="5832780">:=</span>&nbsp;<span class="ident" id="5832783">EscapeText</span><span class="op" id="5832793">(</span><span class="ident" id="5832794">p</span><span class="op" id="5832795">,</span>&nbsp;<span class="op" id="5832797">[</span><span class="op" id="5832798">]</span><span class="builtintype" id="5832799">byte</span><span class="op" id="5832803">(</span><span class="ident" id="5832804">vf</span><span class="op" id="5832806">.</span><span class="ident" id="5832807">String</span><span class="op" id="5832813">(</span><span class="op" id="5832814">)</span><span class="op" id="5832815">)</span><span class="op" id="5832816">)</span><span class="op" id="5832817">;</span>&nbsp;<span class="ident" id="5832819">err</span>&nbsp;<span class="op" id="5832823">!=</span>&nbsp;<span class="ident" id="5832826">nil</span>&nbsp;<span class="op" id="5832830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832837">return</span>&nbsp;<span class="ident" id="5832844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5832852">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832857">case</span>&nbsp;<span class="ident" id="5832862">reflect</span><span class="op" id="5832869">.</span><span class="ident" id="5832870">Slice</span><span class="op" id="5832875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832881">if</span>&nbsp;<span class="ident" id="5832884">elem</span><span class="op" id="5832888">,</span>&nbsp;<span class="ident" id="5832890">ok</span>&nbsp;<span class="op" id="5832893">:=</span>&nbsp;<span class="ident" id="5832896">vf</span><span class="op" id="5832898">.</span><span class="ident" id="5832899">Interface</span><span class="op" id="5832908">(</span><span class="op" id="5832909">)</span><span class="op" id="5832910">.</span><span class="op" id="5832911">(</span><span class="op" id="5832912">[</span><span class="op" id="5832913">]</span><span class="builtintype" id="5832914">byte</span><span class="op" id="5832918">)</span><span class="op" id="5832919">;</span>&nbsp;<span class="ident" id="5832921">ok</span>&nbsp;<span class="op" id="5832924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832931">if</span>&nbsp;<span class="ident" id="5832934">err</span>&nbsp;<span class="op" id="5832938">:=</span>&nbsp;<span class="ident" id="5832941">EscapeText</span><span class="op" id="5832951">(</span><span class="ident" id="5832952">p</span><span class="op" id="5832953">,</span>&nbsp;<span class="ident" id="5832955">elem</span><span class="op" id="5832959">)</span><span class="op" id="5832960">;</span>&nbsp;<span class="ident" id="5832962">err</span>&nbsp;<span class="op" id="5832966">!=</span>&nbsp;<span class="ident" id="5832969">nil</span>&nbsp;<span class="op" id="5832973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5832981">return</span>&nbsp;<span class="ident" id="5832988">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5832997">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833013">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833025">case</span>&nbsp;<span class="ident" id="5833030">fComment</span><span class="op" id="5833038">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833043">k</span>&nbsp;<span class="op" id="5833045">:=</span>&nbsp;<span class="ident" id="5833048">vf</span><span class="op" id="5833050">.</span><span class="ident" id="5833051">Kind</span><span class="op" id="5833055">(</span><span class="op" id="5833056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833061">if</span>&nbsp;<span class="op" id="5833064">!</span><span class="op" id="5833065">(</span><span class="ident" id="5833066">k</span>&nbsp;<span class="op" id="5833068">==</span>&nbsp;<span class="ident" id="5833071">reflect</span><span class="op" id="5833078">.</span><span class="ident" id="5833079">String</span>&nbsp;<span class="op" id="5833086">||</span>&nbsp;<span class="ident" id="5833089">k</span>&nbsp;<span class="op" id="5833091">==</span>&nbsp;<span class="ident" id="5833094">reflect</span><span class="op" id="5833101">.</span><span class="ident" id="5833102">Slice</span>&nbsp;<span class="op" id="5833108">&amp;&amp;</span>&nbsp;<span class="ident" id="5833111">vf</span><span class="op" id="5833113">.</span><span class="ident" id="5833114">Type</span><span class="op" id="5833118">(</span><span class="op" id="5833119">)</span><span class="op" id="5833120">.</span><span class="ident" id="5833121">Elem</span><span class="op" id="5833125">(</span><span class="op" id="5833126">)</span><span class="op" id="5833127">.</span><span class="ident" id="5833128">Kind</span><span class="op" id="5833132">(</span><span class="op" id="5833133">)</span>&nbsp;<span class="op" id="5833135">==</span>&nbsp;<span class="ident" id="5833138">reflect</span><span class="op" id="5833145">.</span><span class="ident" id="5833146">Uint8</span><span class="op" id="5833151">)</span>&nbsp;<span class="op" id="5833153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833159">return</span>&nbsp;<span class="ident" id="5833166">fmt</span><span class="op" id="5833169">.</span><span class="ident" id="5833170">Errorf</span><span class="op" id="5833176">(</span><span class="string" id="5833177">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="5833216">,</span>&nbsp;<span class="ident" id="5833218">val</span><span class="op" id="5833221">.</span><span class="ident" id="5833222">Type</span><span class="op" id="5833226">(</span><span class="op" id="5833227">)</span><span class="op" id="5833228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833238">if</span>&nbsp;<span class="ident" id="5833241">vf</span><span class="op" id="5833243">.</span><span class="ident" id="5833244">Len</span><span class="op" id="5833247">(</span><span class="op" id="5833248">)</span>&nbsp;<span class="op" id="5833250">==</span>&nbsp;<span class="num" id="5833253">0</span>&nbsp;<span class="op" id="5833255">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833261">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833278">p</span><span class="op" id="5833279">.</span><span class="ident" id="5833280">writeIndent</span><span class="op" id="5833291">(</span><span class="num" id="5833292">0</span><span class="op" id="5833293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833298">p</span><span class="op" id="5833299">.</span><span class="ident" id="5833300">WriteString</span><span class="op" id="5833311">(</span><span class="string" id="5833312">&#34;&lt;!--&#34;</span><span class="op" id="5833318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833323">dashDash</span>&nbsp;<span class="op" id="5833332">:=</span>&nbsp;<span class="builtintype" id="5833335">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833344">dashLast</span>&nbsp;<span class="op" id="5833353">:=</span>&nbsp;<span class="builtintype" id="5833356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833365">switch</span>&nbsp;<span class="ident" id="5833372">k</span>&nbsp;<span class="op" id="5833374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833379">case</span>&nbsp;<span class="ident" id="5833384">reflect</span><span class="op" id="5833391">.</span><span class="ident" id="5833392">String</span><span class="op" id="5833398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833404">s</span>&nbsp;<span class="op" id="5833406">:=</span>&nbsp;<span class="ident" id="5833409">vf</span><span class="op" id="5833411">.</span><span class="ident" id="5833412">String</span><span class="op" id="5833418">(</span><span class="op" id="5833419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833425">dashDash</span>&nbsp;<span class="op" id="5833434">=</span>&nbsp;<span class="ident" id="5833436">strings</span><span class="op" id="5833443">.</span><span class="ident" id="5833444">Index</span><span class="op" id="5833449">(</span><span class="ident" id="5833450">s</span><span class="op" id="5833451">,</span>&nbsp;<span class="string" id="5833453">&#34;--&#34;</span><span class="op" id="5833457">)</span>&nbsp;<span class="op" id="5833459">&gt;=</span>&nbsp;<span class="num" id="5833462">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833468">dashLast</span>&nbsp;<span class="op" id="5833477">=</span>&nbsp;<span class="ident" id="5833479">s</span><span class="op" id="5833480">[</span><span class="builtinfunc" id="5833481">len</span><span class="op" id="5833484">(</span><span class="ident" id="5833485">s</span><span class="op" id="5833486">)</span><span class="op" id="5833487">-</span><span class="num" id="5833488">1</span><span class="op" id="5833489">]</span>&nbsp;<span class="op" id="5833491">==</span>&nbsp;<span class="string" id="5833494">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833502">if</span>&nbsp;<span class="op" id="5833505">!</span><span class="ident" id="5833506">dashDash</span>&nbsp;<span class="op" id="5833515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833522">p</span><span class="op" id="5833523">.</span><span class="ident" id="5833524">WriteString</span><span class="op" id="5833535">(</span><span class="ident" id="5833536">s</span><span class="op" id="5833537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833548">case</span>&nbsp;<span class="ident" id="5833553">reflect</span><span class="op" id="5833560">.</span><span class="ident" id="5833561">Slice</span><span class="op" id="5833566">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833572">b</span>&nbsp;<span class="op" id="5833574">:=</span>&nbsp;<span class="ident" id="5833577">vf</span><span class="op" id="5833579">.</span><span class="ident" id="5833580">Bytes</span><span class="op" id="5833585">(</span><span class="op" id="5833586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833592">dashDash</span>&nbsp;<span class="op" id="5833601">=</span>&nbsp;<span class="ident" id="5833603">bytes</span><span class="op" id="5833608">.</span><span class="ident" id="5833609">Index</span><span class="op" id="5833614">(</span><span class="ident" id="5833615">b</span><span class="op" id="5833616">,</span>&nbsp;<span class="ident" id="5833618">ddBytes</span><span class="op" id="5833625">)</span>&nbsp;<span class="op" id="5833627">&gt;=</span>&nbsp;<span class="num" id="5833630">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833636">dashLast</span>&nbsp;<span class="op" id="5833645">=</span>&nbsp;<span class="ident" id="5833647">b</span><span class="op" id="5833648">[</span><span class="builtinfunc" id="5833649">len</span><span class="op" id="5833652">(</span><span class="ident" id="5833653">b</span><span class="op" id="5833654">)</span><span class="op" id="5833655">-</span><span class="num" id="5833656">1</span><span class="op" id="5833657">]</span>&nbsp;<span class="op" id="5833659">==</span>&nbsp;<span class="string" id="5833662">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833670">if</span>&nbsp;<span class="op" id="5833673">!</span><span class="ident" id="5833674">dashDash</span>&nbsp;<span class="op" id="5833683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833690">p</span><span class="op" id="5833691">.</span><span class="ident" id="5833692">Write</span><span class="op" id="5833697">(</span><span class="ident" id="5833698">b</span><span class="op" id="5833699">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833710">default</span><span class="op" id="5833717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5833723">panic</span><span class="op" id="5833728">(</span><span class="string" id="5833729">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="5833743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833753">if</span>&nbsp;<span class="ident" id="5833756">dashDash</span>&nbsp;<span class="op" id="5833765">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833771">return</span>&nbsp;<span class="ident" id="5833778">fmt</span><span class="op" id="5833781">.</span><span class="ident" id="5833782">Errorf</span><span class="op" id="5833788">(</span><span class="string" id="5833789">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="5833826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833836">if</span>&nbsp;<span class="ident" id="5833839">dashLast</span>&nbsp;<span class="op" id="5833848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5833854">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833904">p</span><span class="op" id="5833905">.</span><span class="ident" id="5833906">WriteByte</span><span class="op" id="5833915">(</span><span class="string" id="5833916">&#39;&nbsp;&#39;</span><span class="op" id="5833919">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833929">p</span><span class="op" id="5833930">.</span><span class="ident" id="5833931">WriteString</span><span class="op" id="5833942">(</span><span class="string" id="5833943">&#34;--&gt;&#34;</span><span class="op" id="5833948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833953">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5833965">case</span>&nbsp;<span class="ident" id="5833970">fInnerXml</span><span class="op" id="5833979">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833984">iface</span>&nbsp;<span class="op" id="5833990">:=</span>&nbsp;<span class="ident" id="5833993">vf</span><span class="op" id="5833995">.</span><span class="ident" id="5833996">Interface</span><span class="op" id="5834005">(</span><span class="op" id="5834006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834011">switch</span>&nbsp;<span class="ident" id="5834018">raw</span>&nbsp;<span class="op" id="5834022">:=</span>&nbsp;<span class="ident" id="5834025">iface</span><span class="op" id="5834030">.</span><span class="op" id="5834031">(</span><span class="keyword" id="5834032">type</span><span class="op" id="5834036">)</span>&nbsp;<span class="op" id="5834038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834043">case</span>&nbsp;<span class="op" id="5834048">[</span><span class="op" id="5834049">]</span><span class="builtintype" id="5834050">byte</span><span class="op" id="5834054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834060">p</span><span class="op" id="5834061">.</span><span class="ident" id="5834062">Write</span><span class="op" id="5834067">(</span><span class="ident" id="5834068">raw</span><span class="op" id="5834071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834077">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834089">case</span>&nbsp;<span class="builtintype" id="5834094">string</span><span class="op" id="5834100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834106">p</span><span class="op" id="5834107">.</span><span class="ident" id="5834108">WriteString</span><span class="op" id="5834119">(</span><span class="ident" id="5834120">raw</span><span class="op" id="5834123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834129">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834146">case</span>&nbsp;<span class="ident" id="5834151">fElement</span><span class="op" id="5834159">,</span>&nbsp;<span class="ident" id="5834161">fElement</span>&nbsp;<span class="op" id="5834170">|</span>&nbsp;<span class="ident" id="5834172">fAny</span><span class="op" id="5834176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834181">if</span>&nbsp;<span class="ident" id="5834184">err</span>&nbsp;<span class="op" id="5834188">:=</span>&nbsp;<span class="ident" id="5834191">s</span><span class="op" id="5834192">.</span><span class="ident" id="5834193">trim</span><span class="op" id="5834197">(</span><span class="ident" id="5834198">finfo</span><span class="op" id="5834203">.</span><span class="ident" id="5834204">parents</span><span class="op" id="5834211">)</span><span class="op" id="5834212">;</span>&nbsp;<span class="ident" id="5834214">err</span>&nbsp;<span class="op" id="5834218">!=</span>&nbsp;<span class="ident" id="5834221">nil</span>&nbsp;<span class="op" id="5834225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834231">return</span>&nbsp;<span class="ident" id="5834238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834250">if</span>&nbsp;<span class="builtinfunc" id="5834253">len</span><span class="op" id="5834256">(</span><span class="ident" id="5834257">finfo</span><span class="op" id="5834262">.</span><span class="ident" id="5834263">parents</span><span class="op" id="5834270">)</span>&nbsp;<span class="op" id="5834272">&gt;</span>&nbsp;<span class="builtinfunc" id="5834274">len</span><span class="op" id="5834277">(</span><span class="ident" id="5834278">s</span><span class="op" id="5834279">.</span><span class="ident" id="5834280">stack</span><span class="op" id="5834285">)</span>&nbsp;<span class="op" id="5834287">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834293">if</span>&nbsp;<span class="ident" id="5834296">vf</span><span class="op" id="5834298">.</span><span class="ident" id="5834299">Kind</span><span class="op" id="5834303">(</span><span class="op" id="5834304">)</span>&nbsp;<span class="op" id="5834306">!=</span>&nbsp;<span class="ident" id="5834309">reflect</span><span class="op" id="5834316">.</span><span class="ident" id="5834317">Ptr</span>&nbsp;<span class="op" id="5834321">&amp;&amp;</span>&nbsp;<span class="ident" id="5834324">vf</span><span class="op" id="5834326">.</span><span class="ident" id="5834327">Kind</span><span class="op" id="5834331">(</span><span class="op" id="5834332">)</span>&nbsp;<span class="op" id="5834334">!=</span>&nbsp;<span class="ident" id="5834337">reflect</span><span class="op" id="5834344">.</span><span class="ident" id="5834345">Interface</span>&nbsp;<span class="op" id="5834355">||</span>&nbsp;<span class="op" id="5834358">!</span><span class="ident" id="5834359">vf</span><span class="op" id="5834361">.</span><span class="ident" id="5834362">IsNil</span><span class="op" id="5834367">(</span><span class="op" id="5834368">)</span>&nbsp;<span class="op" id="5834370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834377">if</span>&nbsp;<span class="ident" id="5834380">err</span>&nbsp;<span class="op" id="5834384">:=</span>&nbsp;<span class="ident" id="5834387">s</span><span class="op" id="5834388">.</span><span class="ident" id="5834389">push</span><span class="op" id="5834393">(</span><span class="ident" id="5834394">finfo</span><span class="op" id="5834399">.</span><span class="ident" id="5834400">parents</span><span class="op" id="5834407">[</span><span class="builtinfunc" id="5834408">len</span><span class="op" id="5834411">(</span><span class="ident" id="5834412">s</span><span class="op" id="5834413">.</span><span class="ident" id="5834414">stack</span><span class="op" id="5834419">)</span><span class="op" id="5834420">:</span><span class="op" id="5834421">]</span><span class="op" id="5834422">)</span><span class="op" id="5834423">;</span>&nbsp;<span class="ident" id="5834425">err</span>&nbsp;<span class="op" id="5834429">!=</span>&nbsp;<span class="ident" id="5834432">nil</span>&nbsp;<span class="op" id="5834436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834444">return</span>&nbsp;<span class="ident" id="5834451">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834466">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834479">if</span>&nbsp;<span class="ident" id="5834482">err</span>&nbsp;<span class="op" id="5834486">:=</span>&nbsp;<span class="ident" id="5834489">p</span><span class="op" id="5834490">.</span><span class="ident" id="5834491">marshalValue</span><span class="op" id="5834503">(</span><span class="ident" id="5834504">vf</span><span class="op" id="5834506">,</span>&nbsp;<span class="ident" id="5834508">finfo</span><span class="op" id="5834513">,</span>&nbsp;<span class="ident" id="5834515">nil</span><span class="op" id="5834518">)</span><span class="op" id="5834519">;</span>&nbsp;<span class="ident" id="5834521">err</span>&nbsp;<span class="op" id="5834525">!=</span>&nbsp;<span class="ident" id="5834528">nil</span>&nbsp;<span class="op" id="5834532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834537">return</span>&nbsp;<span class="ident" id="5834544">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834550">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834556">s</span><span class="op" id="5834557">.</span><span class="ident" id="5834558">trim</span><span class="op" id="5834562">(</span><span class="ident" id="5834563">nil</span><span class="op" id="5834566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834569">return</span>&nbsp;<span class="ident" id="5834576">p</span><span class="op" id="5834577">.</span><span class="ident" id="5834578">cachedWriteError</span><span class="op" id="5834594">(</span><span class="op" id="5834595">)</span><br>
<span class="lineno"></span><span class="op" id="5834597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5834600">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="5834648">func</span>&nbsp;<span class="op" id="5834653">(</span><span class="ident" id="5834654">p</span>&nbsp;<span class="op" id="5834656">*</span><span class="ident" id="5834657">printer</span><span class="op" id="5834664">)</span>&nbsp;<span class="ident" id="5834666">cachedWriteError</span><span class="op" id="5834682">(</span><span class="op" id="5834683">)</span>&nbsp;<span class="builtintype" id="5834685">error</span>&nbsp;<span class="op" id="5834691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834694">_</span><span class="op" id="5834695">,</span>&nbsp;<span class="ident" id="5834697">err</span>&nbsp;<span class="op" id="5834701">:=</span>&nbsp;<span class="ident" id="5834704">p</span><span class="op" id="5834705">.</span><span class="ident" id="5834706">Write</span><span class="op" id="5834711">(</span><span class="ident" id="5834712">nil</span><span class="op" id="5834715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834718">return</span>&nbsp;<span class="ident" id="5834725">err</span><br>
<span class="lineno"></span><span class="op" id="5834729">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5834732">func</span>&nbsp;<span class="op" id="5834737">(</span><span class="ident" id="5834738">p</span>&nbsp;<span class="op" id="5834740">*</span><span class="ident" id="5834741">printer</span><span class="op" id="5834748">)</span>&nbsp;<span class="ident" id="5834750">writeIndent</span><span class="op" id="5834761">(</span><span class="ident" id="5834762">depthDelta</span>&nbsp;<span class="builtintype" id="5834773">int</span><span class="op" id="5834776">)</span>&nbsp;<span class="op" id="5834778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834781">if</span>&nbsp;<span class="builtinfunc" id="5834784">len</span><span class="op" id="5834787">(</span><span class="ident" id="5834788">p</span><span class="op" id="5834789">.</span><span class="ident" id="5834790">prefix</span><span class="op" id="5834796">)</span>&nbsp;<span class="op" id="5834798">==</span>&nbsp;<span class="num" id="5834801">0</span>&nbsp;<span class="op" id="5834803">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5834806">len</span><span class="op" id="5834809">(</span><span class="ident" id="5834810">p</span><span class="op" id="5834811">.</span><span class="ident" id="5834812">indent</span><span class="op" id="5834818">)</span>&nbsp;<span class="op" id="5834820">==</span>&nbsp;<span class="num" id="5834823">0</span>&nbsp;<span class="op" id="5834825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834829">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834837">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834840">if</span>&nbsp;<span class="ident" id="5834843">depthDelta</span>&nbsp;<span class="op" id="5834854">&lt;</span>&nbsp;<span class="num" id="5834856">0</span>&nbsp;<span class="op" id="5834858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834862">p</span><span class="op" id="5834863">.</span><span class="ident" id="5834864">depth</span><span class="op" id="5834869">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834874">if</span>&nbsp;<span class="ident" id="5834877">p</span><span class="op" id="5834878">.</span><span class="ident" id="5834879">indentedIn</span>&nbsp;<span class="op" id="5834890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834895">p</span><span class="op" id="5834896">.</span><span class="ident" id="5834897">indentedIn</span>&nbsp;<span class="op" id="5834908">=</span>&nbsp;<span class="builtintype" id="5834910">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834919">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834932">p</span><span class="op" id="5834933">.</span><span class="ident" id="5834934">indentedIn</span>&nbsp;<span class="op" id="5834945">=</span>&nbsp;<span class="builtintype" id="5834947">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834957">if</span>&nbsp;<span class="ident" id="5834960">p</span><span class="op" id="5834961">.</span><span class="ident" id="5834962">putNewline</span>&nbsp;<span class="op" id="5834973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834977">p</span><span class="op" id="5834978">.</span><span class="ident" id="5834979">WriteByte</span><span class="op" id="5834988">(</span><span class="string" id="5834989">&#39;\n&#39;</span><span class="op" id="5834993">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834996">}</span>&nbsp;<span class="keyword" id="5834998">else</span>&nbsp;<span class="op" id="5835003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835007">p</span><span class="op" id="5835008">.</span><span class="ident" id="5835009">putNewline</span>&nbsp;<span class="op" id="5835020">=</span>&nbsp;<span class="builtintype" id="5835022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835031">if</span>&nbsp;<span class="builtinfunc" id="5835034">len</span><span class="op" id="5835037">(</span><span class="ident" id="5835038">p</span><span class="op" id="5835039">.</span><span class="ident" id="5835040">prefix</span><span class="op" id="5835046">)</span>&nbsp;<span class="op" id="5835048">&gt;</span>&nbsp;<span class="num" id="5835050">0</span>&nbsp;<span class="op" id="5835052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835056">p</span><span class="op" id="5835057">.</span><span class="ident" id="5835058">WriteString</span><span class="op" id="5835069">(</span><span class="ident" id="5835070">p</span><span class="op" id="5835071">.</span><span class="ident" id="5835072">prefix</span><span class="op" id="5835078">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835084">if</span>&nbsp;<span class="builtinfunc" id="5835087">len</span><span class="op" id="5835090">(</span><span class="ident" id="5835091">p</span><span class="op" id="5835092">.</span><span class="ident" id="5835093">indent</span><span class="op" id="5835099">)</span>&nbsp;<span class="op" id="5835101">&gt;</span>&nbsp;<span class="num" id="5835103">0</span>&nbsp;<span class="op" id="5835105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835109">for</span>&nbsp;<span class="ident" id="5835113">i</span>&nbsp;<span class="op" id="5835115">:=</span>&nbsp;<span class="num" id="5835118">0</span><span class="op" id="5835119">;</span>&nbsp;<span class="ident" id="5835121">i</span>&nbsp;<span class="op" id="5835123">&lt;</span>&nbsp;<span class="ident" id="5835125">p</span><span class="op" id="5835126">.</span><span class="ident" id="5835127">depth</span><span class="op" id="5835132">;</span>&nbsp;<span class="ident" id="5835134">i</span><span class="op" id="5835135">++</span>&nbsp;<span class="op" id="5835138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835143">p</span><span class="op" id="5835144">.</span><span class="ident" id="5835145">WriteString</span><span class="op" id="5835156">(</span><span class="ident" id="5835157">p</span><span class="op" id="5835158">.</span><span class="ident" id="5835159">indent</span><span class="op" id="5835165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835169">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835175">if</span>&nbsp;<span class="ident" id="5835178">depthDelta</span>&nbsp;<span class="op" id="5835189">&gt;</span>&nbsp;<span class="num" id="5835191">0</span>&nbsp;<span class="op" id="5835193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835197">p</span><span class="op" id="5835198">.</span><span class="ident" id="5835199">depth</span><span class="op" id="5835204">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835209">p</span><span class="op" id="5835210">.</span><span class="ident" id="5835211">indentedIn</span>&nbsp;<span class="op" id="5835222">=</span>&nbsp;<span class="builtintype" id="5835224">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835230">}</span><br>
<span class="lineno">875</span><span class="op" id="5835232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5835235">type</span>&nbsp;<span class="ident" id="5835240">parentStack</span>&nbsp;<span class="keyword" id="5835252">struct</span>&nbsp;<span class="op" id="5835259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835262">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835268">*</span><span class="ident" id="5835269">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835278">stack</span>&nbsp;<span class="op" id="5835284">[</span><span class="op" id="5835285">]</span><span class="builtintype" id="5835286">string</span><br>
<span class="lineno">880</span><span class="op" id="5835293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5835296">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5835376">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="5835450">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="5835519">func</span>&nbsp;<span class="op" id="5835524">(</span><span class="ident" id="5835525">s</span>&nbsp;<span class="op" id="5835527">*</span><span class="ident" id="5835528">parentStack</span><span class="op" id="5835539">)</span>&nbsp;<span class="ident" id="5835541">trim</span><span class="op" id="5835545">(</span><span class="ident" id="5835546">parents</span>&nbsp;<span class="op" id="5835554">[</span><span class="op" id="5835555">]</span><span class="builtintype" id="5835556">string</span><span class="op" id="5835562">)</span>&nbsp;<span class="builtintype" id="5835564">error</span>&nbsp;<span class="op" id="5835570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835573">split</span>&nbsp;<span class="op" id="5835579">:=</span>&nbsp;<span class="num" id="5835582">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835585">for</span>&nbsp;<span class="op" id="5835589">;</span>&nbsp;<span class="ident" id="5835591">split</span>&nbsp;<span class="op" id="5835597">&lt;</span>&nbsp;<span class="builtinfunc" id="5835599">len</span><span class="op" id="5835602">(</span><span class="ident" id="5835603">parents</span><span class="op" id="5835610">)</span>&nbsp;<span class="op" id="5835612">&amp;&amp;</span>&nbsp;<span class="ident" id="5835615">split</span>&nbsp;<span class="op" id="5835621">&lt;</span>&nbsp;<span class="builtinfunc" id="5835623">len</span><span class="op" id="5835626">(</span><span class="ident" id="5835627">s</span><span class="op" id="5835628">.</span><span class="ident" id="5835629">stack</span><span class="op" id="5835634">)</span><span class="op" id="5835635">;</span>&nbsp;<span class="ident" id="5835637">split</span><span class="op" id="5835642">++</span>&nbsp;<span class="op" id="5835645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835649">if</span>&nbsp;<span class="ident" id="5835652">parents</span><span class="op" id="5835659">[</span><span class="ident" id="5835660">split</span><span class="op" id="5835665">]</span>&nbsp;<span class="op" id="5835667">!=</span>&nbsp;<span class="ident" id="5835670">s</span><span class="op" id="5835671">.</span><span class="ident" id="5835672">stack</span><span class="op" id="5835677">[</span><span class="ident" id="5835678">split</span><span class="op" id="5835683">]</span>&nbsp;<span class="op" id="5835685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835690">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835704">for</span>&nbsp;<span class="ident" id="5835708">i</span>&nbsp;<span class="op" id="5835710">:=</span>&nbsp;<span class="builtinfunc" id="5835713">len</span><span class="op" id="5835716">(</span><span class="ident" id="5835717">s</span><span class="op" id="5835718">.</span><span class="ident" id="5835719">stack</span><span class="op" id="5835724">)</span>&nbsp;<span class="op" id="5835726">-</span>&nbsp;<span class="num" id="5835728">1</span><span class="op" id="5835729">;</span>&nbsp;<span class="ident" id="5835731">i</span>&nbsp;<span class="op" id="5835733">&gt;=</span>&nbsp;<span class="ident" id="5835736">split</span><span class="op" id="5835741">;</span>&nbsp;<span class="ident" id="5835743">i</span><span class="op" id="5835744">--</span>&nbsp;<span class="op" id="5835747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835751">if</span>&nbsp;<span class="ident" id="5835754">err</span>&nbsp;<span class="op" id="5835758">:=</span>&nbsp;<span class="ident" id="5835761">s</span><span class="op" id="5835762">.</span><span class="ident" id="5835763">p</span><span class="op" id="5835764">.</span><span class="ident" id="5835765">writeEnd</span><span class="op" id="5835773">(</span><span class="ident" id="5835774">Name</span><span class="op" id="5835778">{</span><span class="ident" id="5835779">Local</span><span class="op" id="5835784">:</span>&nbsp;<span class="ident" id="5835786">s</span><span class="op" id="5835787">.</span><span class="ident" id="5835788">stack</span><span class="op" id="5835793">[</span><span class="ident" id="5835794">i</span><span class="op" id="5835795">]</span><span class="op" id="5835796">}</span><span class="op" id="5835797">)</span><span class="op" id="5835798">;</span>&nbsp;<span class="ident" id="5835800">err</span>&nbsp;<span class="op" id="5835804">!=</span>&nbsp;<span class="ident" id="5835807">nil</span>&nbsp;<span class="op" id="5835811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835816">return</span>&nbsp;<span class="ident" id="5835823">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835835">s</span><span class="op" id="5835836">.</span><span class="ident" id="5835837">stack</span>&nbsp;<span class="op" id="5835843">=</span>&nbsp;<span class="ident" id="5835845">parents</span><span class="op" id="5835852">[</span><span class="op" id="5835853">:</span><span class="ident" id="5835854">split</span><span class="op" id="5835859">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835862">return</span>&nbsp;<span class="ident" id="5835869">nil</span><br>
<span class="lineno"></span><span class="op" id="5835873">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="5835876">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="5835940">func</span>&nbsp;<span class="op" id="5835945">(</span><span class="ident" id="5835946">s</span>&nbsp;<span class="op" id="5835948">*</span><span class="ident" id="5835949">parentStack</span><span class="op" id="5835960">)</span>&nbsp;<span class="ident" id="5835962">push</span><span class="op" id="5835966">(</span><span class="ident" id="5835967">parents</span>&nbsp;<span class="op" id="5835975">[</span><span class="op" id="5835976">]</span><span class="builtintype" id="5835977">string</span><span class="op" id="5835983">)</span>&nbsp;<span class="builtintype" id="5835985">error</span>&nbsp;<span class="op" id="5835991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835994">for</span>&nbsp;<span class="ident" id="5835998">i</span>&nbsp;<span class="op" id="5836000">:=</span>&nbsp;<span class="num" id="5836003">0</span><span class="op" id="5836004">;</span>&nbsp;<span class="ident" id="5836006">i</span>&nbsp;<span class="op" id="5836008">&lt;</span>&nbsp;<span class="builtinfunc" id="5836010">len</span><span class="op" id="5836013">(</span><span class="ident" id="5836014">parents</span><span class="op" id="5836021">)</span><span class="op" id="5836022">;</span>&nbsp;<span class="ident" id="5836024">i</span><span class="op" id="5836025">++</span>&nbsp;<span class="op" id="5836028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836032">if</span>&nbsp;<span class="ident" id="5836035">err</span>&nbsp;<span class="op" id="5836039">:=</span>&nbsp;<span class="ident" id="5836042">s</span><span class="op" id="5836043">.</span><span class="ident" id="5836044">p</span><span class="op" id="5836045">.</span><span class="ident" id="5836046">writeStart</span><span class="op" id="5836056">(</span><span class="op" id="5836057">&amp;</span><span class="ident" id="5836058">StartElement</span><span class="op" id="5836070">{</span><span class="ident" id="5836071">Name</span><span class="op" id="5836075">:</span>&nbsp;<span class="ident" id="5836077">Name</span><span class="op" id="5836081">{</span><span class="ident" id="5836082">Local</span><span class="op" id="5836087">:</span>&nbsp;<span class="ident" id="5836089">parents</span><span class="op" id="5836096">[</span><span class="ident" id="5836097">i</span><span class="op" id="5836098">]</span><span class="op" id="5836099">}</span><span class="op" id="5836100">}</span><span class="op" id="5836101">)</span><span class="op" id="5836102">;</span>&nbsp;<span class="ident" id="5836104">err</span>&nbsp;<span class="op" id="5836108">!=</span>&nbsp;<span class="ident" id="5836111">nil</span>&nbsp;<span class="op" id="5836115">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836120">return</span>&nbsp;<span class="ident" id="5836127">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836139">s</span><span class="op" id="5836140">.</span><span class="ident" id="5836141">stack</span>&nbsp;<span class="op" id="5836147">=</span>&nbsp;<span class="builtinfunc" id="5836149">append</span><span class="op" id="5836155">(</span><span class="ident" id="5836156">s</span><span class="op" id="5836157">.</span><span class="ident" id="5836158">stack</span><span class="op" id="5836163">,</span>&nbsp;<span class="ident" id="5836165">parents</span><span class="op" id="5836172">...</span><span class="op" id="5836175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836178">return</span>&nbsp;<span class="ident" id="5836185">nil</span><br>
<span class="lineno">910</span><span class="op" id="5836189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5836192">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5836256">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="5836294">type</span>&nbsp;<span class="ident" id="5836299">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="5836320">struct</span>&nbsp;<span class="op" id="5836327">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836330">Type</span>&nbsp;<span class="ident" id="5836335">reflect</span><span class="op" id="5836342">.</span><span class="ident" id="5836343">Type</span><br>
<span class="lineno"></span><span class="op" id="5836348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5836351">func</span>&nbsp;<span class="op" id="5836356">(</span><span class="ident" id="5836357">e</span>&nbsp;<span class="op" id="5836359">*</span><span class="ident" id="5836360">UnsupportedTypeError</span><span class="op" id="5836380">)</span>&nbsp;<span class="ident" id="5836382">Error</span><span class="op" id="5836387">(</span><span class="op" id="5836388">)</span>&nbsp;<span class="builtintype" id="5836390">string</span>&nbsp;<span class="op" id="5836397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836400">return</span>&nbsp;<span class="string" id="5836407">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5836433">+</span>&nbsp;<span class="ident" id="5836435">e</span><span class="op" id="5836436">.</span><span class="ident" id="5836437">Type</span><span class="op" id="5836441">.</span><span class="ident" id="5836442">String</span><span class="op" id="5836448">(</span><span class="op" id="5836449">)</span><br>
<span class="lineno">920</span><span class="op" id="5836451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5836454">func</span>&nbsp;<span class="ident" id="5836459">isEmptyValue</span><span class="op" id="5836471">(</span><span class="ident" id="5836472">v</span>&nbsp;<span class="ident" id="5836474">reflect</span><span class="op" id="5836481">.</span><span class="ident" id="5836482">Value</span><span class="op" id="5836487">)</span>&nbsp;<span class="builtintype" id="5836489">bool</span>&nbsp;<span class="op" id="5836494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836497">switch</span>&nbsp;<span class="ident" id="5836504">v</span><span class="op" id="5836505">.</span><span class="ident" id="5836506">Kind</span><span class="op" id="5836510">(</span><span class="op" id="5836511">)</span>&nbsp;<span class="op" id="5836513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836516">case</span>&nbsp;<span class="ident" id="5836521">reflect</span><span class="op" id="5836528">.</span><span class="ident" id="5836529">Array</span><span class="op" id="5836534">,</span>&nbsp;<span class="ident" id="5836536">reflect</span><span class="op" id="5836543">.</span><span class="ident" id="5836544">Map</span><span class="op" id="5836547">,</span>&nbsp;<span class="ident" id="5836549">reflect</span><span class="op" id="5836556">.</span><span class="ident" id="5836557">Slice</span><span class="op" id="5836562">,</span>&nbsp;<span class="ident" id="5836564">reflect</span><span class="op" id="5836571">.</span><span class="ident" id="5836572">String</span><span class="op" id="5836578">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836582">return</span>&nbsp;<span class="ident" id="5836589">v</span><span class="op" id="5836590">.</span><span class="ident" id="5836591">Len</span><span class="op" id="5836594">(</span><span class="op" id="5836595">)</span>&nbsp;<span class="op" id="5836597">==</span>&nbsp;<span class="num" id="5836600">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836603">case</span>&nbsp;<span class="ident" id="5836608">reflect</span><span class="op" id="5836615">.</span><span class="ident" id="5836616">Bool</span><span class="op" id="5836620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836624">return</span>&nbsp;<span class="op" id="5836631">!</span><span class="ident" id="5836632">v</span><span class="op" id="5836633">.</span><span class="ident" id="5836634">Bool</span><span class="op" id="5836638">(</span><span class="op" id="5836639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836642">case</span>&nbsp;<span class="ident" id="5836647">reflect</span><span class="op" id="5836654">.</span><span class="ident" id="5836655">Int</span><span class="op" id="5836658">,</span>&nbsp;<span class="ident" id="5836660">reflect</span><span class="op" id="5836667">.</span><span class="ident" id="5836668">Int8</span><span class="op" id="5836672">,</span>&nbsp;<span class="ident" id="5836674">reflect</span><span class="op" id="5836681">.</span><span class="ident" id="5836682">Int16</span><span class="op" id="5836687">,</span>&nbsp;<span class="ident" id="5836689">reflect</span><span class="op" id="5836696">.</span><span class="ident" id="5836697">Int32</span><span class="op" id="5836702">,</span>&nbsp;<span class="ident" id="5836704">reflect</span><span class="op" id="5836711">.</span><span class="ident" id="5836712">Int64</span><span class="op" id="5836717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836721">return</span>&nbsp;<span class="ident" id="5836728">v</span><span class="op" id="5836729">.</span><span class="ident" id="5836730">Int</span><span class="op" id="5836733">(</span><span class="op" id="5836734">)</span>&nbsp;<span class="op" id="5836736">==</span>&nbsp;<span class="num" id="5836739">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836742">case</span>&nbsp;<span class="ident" id="5836747">reflect</span><span class="op" id="5836754">.</span><span class="ident" id="5836755">Uint</span><span class="op" id="5836759">,</span>&nbsp;<span class="ident" id="5836761">reflect</span><span class="op" id="5836768">.</span><span class="ident" id="5836769">Uint8</span><span class="op" id="5836774">,</span>&nbsp;<span class="ident" id="5836776">reflect</span><span class="op" id="5836783">.</span><span class="ident" id="5836784">Uint16</span><span class="op" id="5836790">,</span>&nbsp;<span class="ident" id="5836792">reflect</span><span class="op" id="5836799">.</span><span class="ident" id="5836800">Uint32</span><span class="op" id="5836806">,</span>&nbsp;<span class="ident" id="5836808">reflect</span><span class="op" id="5836815">.</span><span class="ident" id="5836816">Uint64</span><span class="op" id="5836822">,</span>&nbsp;<span class="ident" id="5836824">reflect</span><span class="op" id="5836831">.</span><span class="ident" id="5836832">Uintptr</span><span class="op" id="5836839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836843">return</span>&nbsp;<span class="ident" id="5836850">v</span><span class="op" id="5836851">.</span><span class="ident" id="5836852">Uint</span><span class="op" id="5836856">(</span><span class="op" id="5836857">)</span>&nbsp;<span class="op" id="5836859">==</span>&nbsp;<span class="num" id="5836862">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836865">case</span>&nbsp;<span class="ident" id="5836870">reflect</span><span class="op" id="5836877">.</span><span class="ident" id="5836878">Float32</span><span class="op" id="5836885">,</span>&nbsp;<span class="ident" id="5836887">reflect</span><span class="op" id="5836894">.</span><span class="ident" id="5836895">Float64</span><span class="op" id="5836902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836906">return</span>&nbsp;<span class="ident" id="5836913">v</span><span class="op" id="5836914">.</span><span class="ident" id="5836915">Float</span><span class="op" id="5836920">(</span><span class="op" id="5836921">)</span>&nbsp;<span class="op" id="5836923">==</span>&nbsp;<span class="num" id="5836926">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836929">case</span>&nbsp;<span class="ident" id="5836934">reflect</span><span class="op" id="5836941">.</span><span class="ident" id="5836942">Interface</span><span class="op" id="5836951">,</span>&nbsp;<span class="ident" id="5836953">reflect</span><span class="op" id="5836960">.</span><span class="ident" id="5836961">Ptr</span><span class="op" id="5836964">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836968">return</span>&nbsp;<span class="ident" id="5836975">v</span><span class="op" id="5836976">.</span><span class="ident" id="5836977">IsNil</span><span class="op" id="5836982">(</span><span class="op" id="5836983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836989">return</span>&nbsp;<span class="builtintype" id="5836996">false</span><br>
<span class="lineno"></span><span class="op" id="5837002">}</span>
</div>
</body>
</html>
