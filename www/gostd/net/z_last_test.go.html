<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html" class="current">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6838236">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6838291">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6838345">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6838396">package</span>&nbsp;<span class="ident" id="6838404">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6838409">import</span>&nbsp;<span class="op" id="6838416">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6838419">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6838427">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6838434">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6838445">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6838452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6838455">var</span>&nbsp;<span class="ident" id="6838459">testDNSFlood</span>&nbsp;<span class="op" id="6838472">=</span>&nbsp;<span class="ident" id="6838474">flag</span><span class="op" id="6838478">.</span><span class="ident" id="6838479">Bool</span><span class="op" id="6838483">(</span><span class="string" id="6838484">&#34;dnsflood&#34;</span><span class="op" id="6838494">,</span>&nbsp;<span class="builtintype" id="6838496">false</span><span class="op" id="6838501">,</span>&nbsp;<span class="string" id="6838503">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="6838539">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6838542">func</span>&nbsp;<span class="ident" id="6838547">TestDNSThreadLimit</span><span class="op" id="6838565">(</span><span class="ident" id="6838566">t</span>&nbsp;<span class="op" id="6838568">*</span><span class="ident" id="6838569">testing</span><span class="op" id="6838576">.</span><span class="ident" id="6838577">T</span><span class="op" id="6838578">)</span>&nbsp;<span class="op" id="6838580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838583">if</span>&nbsp;<span class="op" id="6838586">!</span><span class="op" id="6838587">*</span><span class="ident" id="6838588">testDNSFlood</span>&nbsp;<span class="op" id="6838601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6838605">t</span><span class="op" id="6838606">.</span><span class="ident" id="6838607">Skip</span><span class="op" id="6838611">(</span><span class="string" id="6838612">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6838652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838655">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838659">const</span>&nbsp;<span class="ident" id="6838665">N</span>&nbsp;<span class="op" id="6838667">=</span>&nbsp;<span class="num" id="6838669">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6838676">c</span>&nbsp;<span class="op" id="6838678">:=</span>&nbsp;<span class="builtinfunc" id="6838681">make</span><span class="op" id="6838685">(</span><span class="keyword" id="6838686">chan</span>&nbsp;<span class="builtintype" id="6838691">int</span><span class="op" id="6838694">,</span>&nbsp;<span class="ident" id="6838696">N</span><span class="op" id="6838697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838700">for</span>&nbsp;<span class="ident" id="6838704">i</span>&nbsp;<span class="op" id="6838706">:=</span>&nbsp;<span class="num" id="6838709">0</span><span class="op" id="6838710">;</span>&nbsp;<span class="ident" id="6838712">i</span>&nbsp;<span class="op" id="6838714">&lt;</span>&nbsp;<span class="ident" id="6838716">N</span><span class="op" id="6838717">;</span>&nbsp;<span class="ident" id="6838719">i</span><span class="op" id="6838720">++</span>&nbsp;<span class="op" id="6838723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838727">go</span>&nbsp;<span class="keyword" id="6838730">func</span><span class="op" id="6838734">(</span><span class="ident" id="6838735">i</span>&nbsp;<span class="builtintype" id="6838737">int</span><span class="op" id="6838740">)</span>&nbsp;<span class="op" id="6838742">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6838747">LookupIP</span><span class="op" id="6838755">(</span><span class="ident" id="6838756">fmt</span><span class="op" id="6838759">.</span><span class="ident" id="6838760">Sprintf</span><span class="op" id="6838767">(</span><span class="string" id="6838768">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6838792">,</span>&nbsp;<span class="ident" id="6838794">i</span><span class="op" id="6838795">)</span><span class="op" id="6838796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6838801">c</span>&nbsp;<span class="op" id="6838803">&lt;-</span>&nbsp;<span class="num" id="6838806">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838810">}</span><span class="op" id="6838811">(</span><span class="ident" id="6838812">i</span><span class="op" id="6838813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6838819">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838879">for</span>&nbsp;<span class="ident" id="6838883">i</span>&nbsp;<span class="op" id="6838885">:=</span>&nbsp;<span class="num" id="6838888">0</span><span class="op" id="6838889">;</span>&nbsp;<span class="ident" id="6838891">i</span>&nbsp;<span class="op" id="6838893">&lt;</span>&nbsp;<span class="ident" id="6838895">N</span><span class="op" id="6838896">*</span><span class="num" id="6838897">9</span><span class="op" id="6838898">/</span><span class="num" id="6838899">10</span><span class="op" id="6838901">;</span>&nbsp;<span class="ident" id="6838903">i</span><span class="op" id="6838904">++</span>&nbsp;<span class="op" id="6838907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6838911">if</span>&nbsp;<span class="ident" id="6838914">i</span><span class="op" id="6838915">%</span><span class="num" id="6838916">100</span>&nbsp;<span class="op" id="6838920">==</span>&nbsp;<span class="num" id="6838923">0</span>&nbsp;<span class="op" id="6838925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6838930">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838972">&lt;-</span><span class="ident" id="6838974">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6838977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6838981">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="6839016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6839019">func</span>&nbsp;<span class="ident" id="6839024">TestLookupIPDeadline</span><span class="op" id="6839044">(</span><span class="ident" id="6839045">t</span>&nbsp;<span class="op" id="6839047">*</span><span class="ident" id="6839048">testing</span><span class="op" id="6839055">.</span><span class="ident" id="6839056">T</span><span class="op" id="6839057">)</span>&nbsp;<span class="op" id="6839059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839062">if</span>&nbsp;<span class="op" id="6839065">!</span><span class="op" id="6839066">*</span><span class="ident" id="6839067">testDNSFlood</span>&nbsp;<span class="op" id="6839080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839084">t</span><span class="op" id="6839085">.</span><span class="ident" id="6839086">Skip</span><span class="op" id="6839090">(</span><span class="string" id="6839091">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6839131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839138">const</span>&nbsp;<span class="ident" id="6839144">N</span>&nbsp;<span class="op" id="6839146">=</span>&nbsp;<span class="num" id="6839148">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839154">const</span>&nbsp;<span class="ident" id="6839160">timeout</span>&nbsp;<span class="op" id="6839168">=</span>&nbsp;<span class="num" id="6839170">3</span>&nbsp;<span class="op" id="6839172">*</span>&nbsp;<span class="ident" id="6839174">time</span><span class="op" id="6839178">.</span><span class="ident" id="6839179">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839187">c</span>&nbsp;<span class="op" id="6839189">:=</span>&nbsp;<span class="builtinfunc" id="6839192">make</span><span class="op" id="6839196">(</span><span class="keyword" id="6839197">chan</span>&nbsp;<span class="builtintype" id="6839202">error</span><span class="op" id="6839207">,</span>&nbsp;<span class="num" id="6839209">2</span><span class="op" id="6839210">*</span><span class="ident" id="6839211">N</span><span class="op" id="6839212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839215">for</span>&nbsp;<span class="ident" id="6839219">i</span>&nbsp;<span class="op" id="6839221">:=</span>&nbsp;<span class="num" id="6839224">0</span><span class="op" id="6839225">;</span>&nbsp;<span class="ident" id="6839227">i</span>&nbsp;<span class="op" id="6839229">&lt;</span>&nbsp;<span class="ident" id="6839231">N</span><span class="op" id="6839232">;</span>&nbsp;<span class="ident" id="6839234">i</span><span class="op" id="6839235">++</span>&nbsp;<span class="op" id="6839238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839242">name</span>&nbsp;<span class="op" id="6839247">:=</span>&nbsp;<span class="ident" id="6839250">fmt</span><span class="op" id="6839253">.</span><span class="ident" id="6839254">Sprintf</span><span class="op" id="6839261">(</span><span class="string" id="6839262">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6839286">,</span>&nbsp;<span class="ident" id="6839288">i</span><span class="op" id="6839289">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839293">go</span>&nbsp;<span class="keyword" id="6839296">func</span><span class="op" id="6839300">(</span><span class="op" id="6839301">)</span>&nbsp;<span class="op" id="6839303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839308">_</span><span class="op" id="6839309">,</span>&nbsp;<span class="ident" id="6839311">err</span>&nbsp;<span class="op" id="6839315">:=</span>&nbsp;<span class="ident" id="6839318">lookupIPDeadline</span><span class="op" id="6839334">(</span><span class="ident" id="6839335">name</span><span class="op" id="6839339">,</span>&nbsp;<span class="ident" id="6839341">time</span><span class="op" id="6839345">.</span><span class="ident" id="6839346">Now</span><span class="op" id="6839349">(</span><span class="op" id="6839350">)</span><span class="op" id="6839351">.</span><span class="ident" id="6839352">Add</span><span class="op" id="6839355">(</span><span class="ident" id="6839356">timeout</span><span class="op" id="6839363">/</span><span class="num" id="6839364">2</span><span class="op" id="6839365">)</span><span class="op" id="6839366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839371">c</span>&nbsp;<span class="op" id="6839373">&lt;-</span>&nbsp;<span class="ident" id="6839376">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839382">}</span><span class="op" id="6839383">(</span><span class="op" id="6839384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839388">go</span>&nbsp;<span class="keyword" id="6839391">func</span><span class="op" id="6839395">(</span><span class="op" id="6839396">)</span>&nbsp;<span class="op" id="6839398">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839403">_</span><span class="op" id="6839404">,</span>&nbsp;<span class="ident" id="6839406">err</span>&nbsp;<span class="op" id="6839410">:=</span>&nbsp;<span class="ident" id="6839413">lookupIPDeadline</span><span class="op" id="6839429">(</span><span class="ident" id="6839430">name</span><span class="op" id="6839434">,</span>&nbsp;<span class="ident" id="6839436">time</span><span class="op" id="6839440">.</span><span class="ident" id="6839441">Now</span><span class="op" id="6839444">(</span><span class="op" id="6839445">)</span><span class="op" id="6839446">.</span><span class="ident" id="6839447">Add</span><span class="op" id="6839450">(</span><span class="ident" id="6839451">timeout</span><span class="op" id="6839458">)</span><span class="op" id="6839459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839464">c</span>&nbsp;<span class="op" id="6839466">&lt;-</span>&nbsp;<span class="ident" id="6839469">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839475">}</span><span class="op" id="6839476">(</span><span class="op" id="6839477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839483">qstats</span>&nbsp;<span class="op" id="6839490">:=</span>&nbsp;<span class="keyword" id="6839493">struct</span>&nbsp;<span class="op" id="6839500">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839504">succeeded</span><span class="op" id="6839513">,</span>&nbsp;<span class="ident" id="6839515">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6839530">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839536">timeout</span><span class="op" id="6839543">,</span>&nbsp;<span class="ident" id="6839545">temporary</span><span class="op" id="6839554">,</span>&nbsp;<span class="ident" id="6839556">other</span>&nbsp;<span class="builtintype" id="6839562">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839568">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6839594">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839599">}</span><span class="op" id="6839600">{</span><span class="op" id="6839601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839604">deadline</span>&nbsp;<span class="op" id="6839613">:=</span>&nbsp;<span class="ident" id="6839616">time</span><span class="op" id="6839620">.</span><span class="ident" id="6839621">After</span><span class="op" id="6839626">(</span><span class="ident" id="6839627">timeout</span>&nbsp;<span class="op" id="6839635">+</span>&nbsp;<span class="ident" id="6839637">time</span><span class="op" id="6839641">.</span><span class="ident" id="6839642">Second</span><span class="op" id="6839648">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839651">for</span>&nbsp;<span class="ident" id="6839655">i</span>&nbsp;<span class="op" id="6839657">:=</span>&nbsp;<span class="num" id="6839660">0</span><span class="op" id="6839661">;</span>&nbsp;<span class="ident" id="6839663">i</span>&nbsp;<span class="op" id="6839665">&lt;</span>&nbsp;<span class="num" id="6839667">2</span><span class="op" id="6839668">*</span><span class="ident" id="6839669">N</span><span class="op" id="6839670">;</span>&nbsp;<span class="ident" id="6839672">i</span><span class="op" id="6839673">++</span>&nbsp;<span class="op" id="6839676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839680">select</span>&nbsp;<span class="op" id="6839687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839691">case</span>&nbsp;<span class="op" id="6839696">&lt;-</span><span class="ident" id="6839698">deadline</span><span class="op" id="6839706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839711">t</span><span class="op" id="6839712">.</span><span class="ident" id="6839713">Fatal</span><span class="op" id="6839718">(</span><span class="string" id="6839719">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="6839738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839742">case</span>&nbsp;<span class="ident" id="6839747">err</span>&nbsp;<span class="op" id="6839751">:=</span>&nbsp;<span class="op" id="6839754">&lt;-</span><span class="ident" id="6839756">c</span><span class="op" id="6839757">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839762">switch</span>&nbsp;<span class="ident" id="6839769">err</span>&nbsp;<span class="op" id="6839773">:=</span>&nbsp;<span class="ident" id="6839776">err</span><span class="op" id="6839779">.</span><span class="op" id="6839780">(</span><span class="keyword" id="6839781">type</span><span class="op" id="6839785">)</span>&nbsp;<span class="op" id="6839787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839792">case</span>&nbsp;<span class="builtintype" id="6839797">nil</span><span class="op" id="6839800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839806">qstats</span><span class="op" id="6839812">.</span><span class="ident" id="6839813">succeeded</span><span class="op" id="6839822">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839828">case</span>&nbsp;<span class="ident" id="6839833">Error</span><span class="op" id="6839838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839844">qstats</span><span class="op" id="6839850">.</span><span class="ident" id="6839851">failed</span><span class="op" id="6839857">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839864">if</span>&nbsp;<span class="ident" id="6839867">err</span><span class="op" id="6839870">.</span><span class="ident" id="6839871">Timeout</span><span class="op" id="6839878">(</span><span class="op" id="6839879">)</span>&nbsp;<span class="op" id="6839881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839888">qstats</span><span class="op" id="6839894">.</span><span class="ident" id="6839895">timeout</span><span class="op" id="6839902">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839915">if</span>&nbsp;<span class="ident" id="6839918">err</span><span class="op" id="6839921">.</span><span class="ident" id="6839922">Temporary</span><span class="op" id="6839931">(</span><span class="op" id="6839932">)</span>&nbsp;<span class="op" id="6839934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6839941">qstats</span><span class="op" id="6839947">.</span><span class="ident" id="6839948">temporary</span><span class="op" id="6839957">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6839964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6839970">if</span>&nbsp;<span class="op" id="6839973">!</span><span class="ident" id="6839974">err</span><span class="op" id="6839977">.</span><span class="ident" id="6839978">Timeout</span><span class="op" id="6839985">(</span><span class="op" id="6839986">)</span>&nbsp;<span class="op" id="6839988">&amp;&amp;</span>&nbsp;<span class="op" id="6839991">!</span><span class="ident" id="6839992">err</span><span class="op" id="6839995">.</span><span class="ident" id="6839996">Temporary</span><span class="op" id="6840005">(</span><span class="op" id="6840006">)</span>&nbsp;<span class="op" id="6840008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6840015">qstats</span><span class="op" id="6840021">.</span><span class="ident" id="6840022">other</span><span class="op" id="6840027">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6840034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6840039">default</span><span class="op" id="6840046">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6840052">qstats</span><span class="op" id="6840058">.</span><span class="ident" id="6840059">failed</span><span class="op" id="6840065">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6840072">qstats</span><span class="op" id="6840078">.</span><span class="ident" id="6840079">unknown</span><span class="op" id="6840086">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6840092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6840096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6840099">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840103">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840165">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840228">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840286">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840349">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840407">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6840470">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6840508">t</span><span class="op" id="6840509">.</span><span class="ident" id="6840510">Logf</span><span class="op" id="6840514">(</span><span class="string" id="6840515">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="6840589">,</span>&nbsp;<span class="ident" id="6840591">qstats</span><span class="op" id="6840597">.</span><span class="ident" id="6840598">succeeded</span><span class="op" id="6840607">,</span>&nbsp;<span class="ident" id="6840609">qstats</span><span class="op" id="6840615">.</span><span class="ident" id="6840616">failed</span><span class="op" id="6840622">,</span>&nbsp;<span class="ident" id="6840624">qstats</span><span class="op" id="6840630">.</span><span class="ident" id="6840631">timeout</span><span class="op" id="6840638">,</span>&nbsp;<span class="ident" id="6840640">qstats</span><span class="op" id="6840646">.</span><span class="ident" id="6840647">temporary</span><span class="op" id="6840656">,</span>&nbsp;<span class="ident" id="6840658">qstats</span><span class="op" id="6840664">.</span><span class="ident" id="6840665">other</span><span class="op" id="6840670">,</span>&nbsp;<span class="ident" id="6840672">qstats</span><span class="op" id="6840678">.</span><span class="ident" id="6840679">unknown</span><span class="op" id="6840686">)</span><br>
<span class="lineno"></span><span class="op" id="6840688">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
