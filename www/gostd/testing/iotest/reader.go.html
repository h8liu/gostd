<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6065655">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6065710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6065764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6065815">//&nbsp;Package&nbsp;iotest&nbsp;implements&nbsp;Readers&nbsp;and&nbsp;Writers&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6065891">package</span>&nbsp;<span class="ident" id="6065899">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065907">import</span>&nbsp;<span class="op" id="6065914">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6065917">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6065927">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6065932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6065935">//&nbsp;OneByteReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="6065985">//&nbsp;each&nbsp;non-empty&nbsp;Read&nbsp;by&nbsp;reading&nbsp;one&nbsp;byte&nbsp;from&nbsp;r.</span><br>
<span class="lineno">15</span><span class="keyword" id="6066036">func</span>&nbsp;<span class="ident" id="6066041">OneByteReader</span><span class="op" id="6066054">(</span><span class="ident" id="6066055">r</span>&nbsp;<span class="ident" id="6066057"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066059">.</span><span class="ident" id="6066060"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6066066">)</span>&nbsp;<span class="ident" id="6066068"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066070">.</span><span class="ident" id="6066071"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="6066078">{</span>&nbsp;<span class="keyword" id="6066080">return</span>&nbsp;<span class="op" id="6066087">&amp;</span><span class="ident" id="6066088"><a href="/gostd/testing/iotest/reader.go.html#6066113">oneByteReader</a></span><span class="op" id="6066101">{</span><span class="ident" id="6066102"><a href="/gostd/testing/iotest/reader.go.html#6066055">r</a></span><span class="op" id="6066103">}</span>&nbsp;<span class="op" id="6066105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6066108">type</span>&nbsp;<span class="ident" id="6066113">oneByteReader</span>&nbsp;<span class="keyword" id="6066127">struct</span>&nbsp;<span class="op" id="6066134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066137">r</span>&nbsp;<span class="ident" id="6066139"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066141">.</span><span class="ident" id="6066142"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span><span class="op" id="6066149">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6066152">func</span>&nbsp;<span class="op" id="6066157">(</span><span class="ident" id="6066158">r</span>&nbsp;<span class="op" id="6066160">*</span><span class="ident" id="6066161"><a href="/gostd/testing/iotest/reader.go.html#6066113">oneByteReader</a></span><span class="op" id="6066174">)</span>&nbsp;<span class="ident" id="6066176">Read</span><span class="op" id="6066180">(</span><span class="ident" id="6066181">p</span>&nbsp;<span class="op" id="6066183">[</span><span class="op" id="6066184">]</span><span class="builtintype" id="6066185">byte</span><span class="op" id="6066189">)</span>&nbsp;<span class="op" id="6066191">(</span><span class="builtintype" id="6066192">int</span><span class="op" id="6066195">,</span>&nbsp;<span class="builtintype" id="6066197">error</span><span class="op" id="6066202">)</span>&nbsp;<span class="op" id="6066204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066207">if</span>&nbsp;<span class="builtinfunc" id="6066210">len</span><span class="op" id="6066213">(</span><span class="ident" id="6066214"><a href="/gostd/testing/iotest/reader.go.html#6066181">p</a></span><span class="op" id="6066215">)</span>&nbsp;<span class="op" id="6066217">==</span>&nbsp;<span class="num" id="6066220">0</span>&nbsp;<span class="op" id="6066222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066226">return</span>&nbsp;<span class="num" id="6066233">0</span><span class="op" id="6066234">,</span>&nbsp;<span class="builtintype" id="6066236">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066241">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066244">return</span>&nbsp;<span class="ident" id="6066251"><a href="/gostd/testing/iotest/reader.go.html#6066158">r</a></span><span class="op" id="6066252">.</span><span class="ident" id="6066253"><a href="/gostd/testing/iotest/reader.go.html#6066137">r</a></span><span class="op" id="6066254">.</span><span class="ident" id="6066255"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="6066259">(</span><span class="ident" id="6066260"><a href="/gostd/testing/iotest/reader.go.html#6066181">p</a></span><span class="op" id="6066261">[</span><span class="num" id="6066262">0</span><span class="op" id="6066263">:</span><span class="num" id="6066264">1</span><span class="op" id="6066265">]</span><span class="op" id="6066266">)</span><br>
<span class="lineno"></span><span class="op" id="6066268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066271">//&nbsp;HalfReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="6066323">//&nbsp;by&nbsp;reading&nbsp;half&nbsp;as&nbsp;many&nbsp;requested&nbsp;bytes&nbsp;from&nbsp;r.</span><br>
<span class="lineno">30</span><span class="keyword" id="6066374">func</span>&nbsp;<span class="ident" id="6066379">HalfReader</span><span class="op" id="6066389">(</span><span class="ident" id="6066390">r</span>&nbsp;<span class="ident" id="6066392"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066394">.</span><span class="ident" id="6066395"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6066401">)</span>&nbsp;<span class="ident" id="6066403"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066405">.</span><span class="ident" id="6066406"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="6066413">{</span>&nbsp;<span class="keyword" id="6066415">return</span>&nbsp;<span class="op" id="6066422">&amp;</span><span class="ident" id="6066423"><a href="/gostd/testing/iotest/reader.go.html#6066445">halfReader</a></span><span class="op" id="6066433">{</span><span class="ident" id="6066434"><a href="/gostd/testing/iotest/reader.go.html#6066390">r</a></span><span class="op" id="6066435">}</span>&nbsp;<span class="op" id="6066437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6066440">type</span>&nbsp;<span class="ident" id="6066445">halfReader</span>&nbsp;<span class="keyword" id="6066456">struct</span>&nbsp;<span class="op" id="6066463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066466">r</span>&nbsp;<span class="ident" id="6066468"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066470">.</span><span class="ident" id="6066471"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span><span class="op" id="6066478">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6066481">func</span>&nbsp;<span class="op" id="6066486">(</span><span class="ident" id="6066487">r</span>&nbsp;<span class="op" id="6066489">*</span><span class="ident" id="6066490"><a href="/gostd/testing/iotest/reader.go.html#6066445">halfReader</a></span><span class="op" id="6066500">)</span>&nbsp;<span class="ident" id="6066502">Read</span><span class="op" id="6066506">(</span><span class="ident" id="6066507">p</span>&nbsp;<span class="op" id="6066509">[</span><span class="op" id="6066510">]</span><span class="builtintype" id="6066511">byte</span><span class="op" id="6066515">)</span>&nbsp;<span class="op" id="6066517">(</span><span class="builtintype" id="6066518">int</span><span class="op" id="6066521">,</span>&nbsp;<span class="builtintype" id="6066523">error</span><span class="op" id="6066528">)</span>&nbsp;<span class="op" id="6066530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066533">return</span>&nbsp;<span class="ident" id="6066540"><a href="/gostd/testing/iotest/reader.go.html#6066487">r</a></span><span class="op" id="6066541">.</span><span class="ident" id="6066542"><a href="/gostd/testing/iotest/reader.go.html#6066466">r</a></span><span class="op" id="6066543">.</span><span class="ident" id="6066544"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="6066548">(</span><span class="ident" id="6066549"><a href="/gostd/testing/iotest/reader.go.html#6066507">p</a></span><span class="op" id="6066550">[</span><span class="num" id="6066551">0</span>&nbsp;<span class="op" id="6066553">:</span>&nbsp;<span class="op" id="6066555">(</span><span class="builtinfunc" id="6066556">len</span><span class="op" id="6066559">(</span><span class="ident" id="6066560"><a href="/gostd/testing/iotest/reader.go.html#6066507">p</a></span><span class="op" id="6066561">)</span><span class="op" id="6066562">+</span><span class="num" id="6066563">1</span><span class="op" id="6066564">)</span><span class="op" id="6066565">/</span><span class="num" id="6066566">2</span><span class="op" id="6066567">]</span><span class="op" id="6066568">)</span><br>
<span class="lineno"></span><span class="op" id="6066570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="6066573">//&nbsp;DataErrReader&nbsp;changes&nbsp;the&nbsp;way&nbsp;errors&nbsp;are&nbsp;handled&nbsp;by&nbsp;a&nbsp;Reader.&nbsp;Normally,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6066650">//&nbsp;Reader&nbsp;returns&nbsp;an&nbsp;error&nbsp;(typically&nbsp;EOF)&nbsp;from&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6066728">//&nbsp;last&nbsp;piece&nbsp;of&nbsp;data&nbsp;is&nbsp;read.&nbsp;DataErrReader&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;and&nbsp;changes&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6066804">//&nbsp;behavior&nbsp;so&nbsp;the&nbsp;final&nbsp;error&nbsp;is&nbsp;returned&nbsp;along&nbsp;with&nbsp;the&nbsp;final&nbsp;data,&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="6066882">//&nbsp;of&nbsp;in&nbsp;the&nbsp;first&nbsp;call&nbsp;after&nbsp;the&nbsp;final&nbsp;data.</span><br>
<span class="lineno">45</span><span class="keyword" id="6066928">func</span>&nbsp;<span class="ident" id="6066933">DataErrReader</span><span class="op" id="6066946">(</span><span class="ident" id="6066947">r</span>&nbsp;<span class="ident" id="6066949"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066951">.</span><span class="ident" id="6066952"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6066958">)</span>&nbsp;<span class="ident" id="6066960"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6066962">.</span><span class="ident" id="6066963"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="6066970">{</span>&nbsp;<span class="keyword" id="6066972">return</span>&nbsp;<span class="op" id="6066979">&amp;</span><span class="ident" id="6066980"><a href="/gostd/testing/iotest/reader.go.html#6067030">dataErrReader</a></span><span class="op" id="6066993">{</span><span class="ident" id="6066994"><a href="/gostd/testing/iotest/reader.go.html#6066947">r</a></span><span class="op" id="6066995">,</span>&nbsp;<span class="builtintype" id="6066997">nil</span><span class="op" id="6067000">,</span>&nbsp;<span class="builtinfunc" id="6067002">make</span><span class="op" id="6067006">(</span><span class="op" id="6067007">[</span><span class="op" id="6067008">]</span><span class="builtintype" id="6067009">byte</span><span class="op" id="6067013">,</span>&nbsp;<span class="num" id="6067015">1024</span><span class="op" id="6067019">)</span><span class="op" id="6067020">}</span>&nbsp;<span class="op" id="6067022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067025">type</span>&nbsp;<span class="ident" id="6067030">dataErrReader</span>&nbsp;<span class="keyword" id="6067044">struct</span>&nbsp;<span class="op" id="6067051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067054">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067061"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6067063">.</span><span class="ident" id="6067064"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067072">unread</span>&nbsp;<span class="op" id="6067079">[</span><span class="op" id="6067080">]</span><span class="builtintype" id="6067081">byte</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067087">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6067094">[</span><span class="op" id="6067095">]</span><span class="builtintype" id="6067096">byte</span><br>
<span class="lineno"></span><span class="op" id="6067101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067104">func</span>&nbsp;<span class="op" id="6067109">(</span><span class="ident" id="6067110">r</span>&nbsp;<span class="op" id="6067112">*</span><span class="ident" id="6067113"><a href="/gostd/testing/iotest/reader.go.html#6067030">dataErrReader</a></span><span class="op" id="6067126">)</span>&nbsp;<span class="ident" id="6067128">Read</span><span class="op" id="6067132">(</span><span class="ident" id="6067133">p</span>&nbsp;<span class="op" id="6067135">[</span><span class="op" id="6067136">]</span><span class="builtintype" id="6067137">byte</span><span class="op" id="6067141">)</span>&nbsp;<span class="op" id="6067143">(</span><span class="ident" id="6067144">n</span>&nbsp;<span class="builtintype" id="6067146">int</span><span class="op" id="6067149">,</span>&nbsp;<span class="ident" id="6067151">err</span>&nbsp;<span class="builtintype" id="6067155">error</span><span class="op" id="6067160">)</span>&nbsp;<span class="op" id="6067162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6067165">//&nbsp;loop&nbsp;because&nbsp;first&nbsp;call&nbsp;needs&nbsp;two&nbsp;reads:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6067210">//&nbsp;one&nbsp;to&nbsp;get&nbsp;data&nbsp;and&nbsp;a&nbsp;second&nbsp;to&nbsp;look&nbsp;for&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067265">for</span>&nbsp;<span class="op" id="6067269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067273">if</span>&nbsp;<span class="builtinfunc" id="6067276">len</span><span class="op" id="6067279">(</span><span class="ident" id="6067280"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067281">.</span><span class="ident" id="6067282"><a href="/gostd/testing/iotest/reader.go.html#6067072">unread</a></span><span class="op" id="6067288">)</span>&nbsp;<span class="op" id="6067290">==</span>&nbsp;<span class="num" id="6067293">0</span>&nbsp;<span class="op" id="6067295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067300">n1</span><span class="op" id="6067302">,</span>&nbsp;<span class="ident" id="6067304">err1</span>&nbsp;<span class="op" id="6067309">:=</span>&nbsp;<span class="ident" id="6067312"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067313">.</span><span class="ident" id="6067314"><a href="/gostd/testing/iotest/reader.go.html#6067054">r</a></span><span class="op" id="6067315">.</span><span class="ident" id="6067316"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="6067320">(</span><span class="ident" id="6067321"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067322">.</span><span class="ident" id="6067323"><a href="/gostd/testing/iotest/reader.go.html#6067087">data</a></span><span class="op" id="6067327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067332"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067333">.</span><span class="ident" id="6067334"><a href="/gostd/testing/iotest/reader.go.html#6067072">unread</a></span>&nbsp;<span class="op" id="6067341">=</span>&nbsp;<span class="ident" id="6067343"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067344">.</span><span class="ident" id="6067345"><a href="/gostd/testing/iotest/reader.go.html#6067087">data</a></span><span class="op" id="6067349">[</span><span class="num" id="6067350">0</span><span class="op" id="6067351">:</span><span class="ident" id="6067352"><a href="/gostd/testing/iotest/reader.go.html#6067300">n1</a></span><span class="op" id="6067354">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067359"><a href="/gostd/testing/iotest/reader.go.html#6067151">err</a></span>&nbsp;<span class="op" id="6067363">=</span>&nbsp;<span class="ident" id="6067365"><a href="/gostd/testing/iotest/reader.go.html#6067304">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067376">if</span>&nbsp;<span class="ident" id="6067379"><a href="/gostd/testing/iotest/reader.go.html#6067144">n</a></span>&nbsp;<span class="op" id="6067381">&gt;</span>&nbsp;<span class="num" id="6067383">0</span>&nbsp;<span class="op" id="6067385">||</span>&nbsp;<span class="ident" id="6067388"><a href="/gostd/testing/iotest/reader.go.html#6067151">err</a></span>&nbsp;<span class="op" id="6067392">!=</span>&nbsp;<span class="builtintype" id="6067395">nil</span>&nbsp;<span class="op" id="6067399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067404">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067412">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067416"><a href="/gostd/testing/iotest/reader.go.html#6067144">n</a></span>&nbsp;<span class="op" id="6067418">=</span>&nbsp;<span class="builtinfunc" id="6067420">copy</span><span class="op" id="6067424">(</span><span class="ident" id="6067425"><a href="/gostd/testing/iotest/reader.go.html#6067133">p</a></span><span class="op" id="6067426">,</span>&nbsp;<span class="ident" id="6067428"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067429">.</span><span class="ident" id="6067430"><a href="/gostd/testing/iotest/reader.go.html#6067072">unread</a></span><span class="op" id="6067436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067440"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067441">.</span><span class="ident" id="6067442"><a href="/gostd/testing/iotest/reader.go.html#6067072">unread</a></span>&nbsp;<span class="op" id="6067449">=</span>&nbsp;<span class="ident" id="6067451"><a href="/gostd/testing/iotest/reader.go.html#6067110">r</a></span><span class="op" id="6067452">.</span><span class="ident" id="6067453"><a href="/gostd/testing/iotest/reader.go.html#6067072">unread</a></span><span class="op" id="6067459">[</span><span class="ident" id="6067460"><a href="/gostd/testing/iotest/reader.go.html#6067144">n</a></span><span class="op" id="6067461">:</span><span class="op" id="6067462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067468">return</span><br>
<span class="lineno"></span><span class="op" id="6067475">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="6067478">var</span>&nbsp;<span class="ident" id="6067482">ErrTimeout</span>&nbsp;<span class="op" id="6067493">=</span>&nbsp;<span class="ident" id="6067495"><a href="/gostd/testing/iotest/reader.go.html#6065917">errors</a></span><span class="op" id="6067501">.</span><span class="ident" id="6067502"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6067505">(</span><span class="string" id="6067506">&#34;timeout&#34;</span><span class="op" id="6067515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067518">//&nbsp;TimeoutReader&nbsp;returns&nbsp;ErrTimeout&nbsp;on&nbsp;the&nbsp;second&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="6067573">//&nbsp;with&nbsp;no&nbsp;data.&nbsp;&nbsp;Subsequent&nbsp;calls&nbsp;to&nbsp;read&nbsp;succeed.</span><br>
<span class="lineno">75</span><span class="keyword" id="6067625">func</span>&nbsp;<span class="ident" id="6067630">TimeoutReader</span><span class="op" id="6067643">(</span><span class="ident" id="6067644">r</span>&nbsp;<span class="ident" id="6067646"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6067648">.</span><span class="ident" id="6067649"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6067655">)</span>&nbsp;<span class="ident" id="6067657"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6067659">.</span><span class="ident" id="6067660"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="6067667">{</span>&nbsp;<span class="keyword" id="6067669">return</span>&nbsp;<span class="op" id="6067676">&amp;</span><span class="ident" id="6067677"><a href="/gostd/testing/iotest/reader.go.html#6067705">timeoutReader</a></span><span class="op" id="6067690">{</span><span class="ident" id="6067691"><a href="/gostd/testing/iotest/reader.go.html#6067644">r</a></span><span class="op" id="6067692">,</span>&nbsp;<span class="num" id="6067694">0</span><span class="op" id="6067695">}</span>&nbsp;<span class="op" id="6067697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067700">type</span>&nbsp;<span class="ident" id="6067705">timeoutReader</span>&nbsp;<span class="keyword" id="6067719">struct</span>&nbsp;<span class="op" id="6067726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067729">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067735"><a href="/gostd/testing/iotest/reader.go.html#6065927">io</a></span><span class="op" id="6067737">.</span><span class="ident" id="6067738"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067746">count</span>&nbsp;<span class="builtintype" id="6067752">int</span><br>
<span class="lineno">80</span><span class="op" id="6067756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067759">func</span>&nbsp;<span class="op" id="6067764">(</span><span class="ident" id="6067765">r</span>&nbsp;<span class="op" id="6067767">*</span><span class="ident" id="6067768"><a href="/gostd/testing/iotest/reader.go.html#6067705">timeoutReader</a></span><span class="op" id="6067781">)</span>&nbsp;<span class="ident" id="6067783">Read</span><span class="op" id="6067787">(</span><span class="ident" id="6067788">p</span>&nbsp;<span class="op" id="6067790">[</span><span class="op" id="6067791">]</span><span class="builtintype" id="6067792">byte</span><span class="op" id="6067796">)</span>&nbsp;<span class="op" id="6067798">(</span><span class="builtintype" id="6067799">int</span><span class="op" id="6067802">,</span>&nbsp;<span class="builtintype" id="6067804">error</span><span class="op" id="6067809">)</span>&nbsp;<span class="op" id="6067811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067814"><a href="/gostd/testing/iotest/reader.go.html#6067765">r</a></span><span class="op" id="6067815">.</span><span class="ident" id="6067816"><a href="/gostd/testing/iotest/reader.go.html#6067746">count</a></span><span class="op" id="6067821">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067825">if</span>&nbsp;<span class="ident" id="6067828"><a href="/gostd/testing/iotest/reader.go.html#6067765">r</a></span><span class="op" id="6067829">.</span><span class="ident" id="6067830"><a href="/gostd/testing/iotest/reader.go.html#6067746">count</a></span>&nbsp;<span class="op" id="6067836">==</span>&nbsp;<span class="num" id="6067839">2</span>&nbsp;<span class="op" id="6067841">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067845">return</span>&nbsp;<span class="num" id="6067852">0</span><span class="op" id="6067853">,</span>&nbsp;<span class="ident" id="6067855"><a href="/gostd/testing/iotest/reader.go.html#6067482">ErrTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067870">return</span>&nbsp;<span class="ident" id="6067877"><a href="/gostd/testing/iotest/reader.go.html#6067765">r</a></span><span class="op" id="6067878">.</span><span class="ident" id="6067879"><a href="/gostd/testing/iotest/reader.go.html#6067729">r</a></span><span class="op" id="6067880">.</span><span class="ident" id="6067881"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="6067885">(</span><span class="ident" id="6067886"><a href="/gostd/testing/iotest/reader.go.html#6067788">p</a></span><span class="op" id="6067887">)</span><br>
<span class="lineno"></span><span class="op" id="6067889">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
