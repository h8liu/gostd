<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3944231">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3944287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3944341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3944392">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3944429">package</span>&nbsp;<span class="ident" id="3944437">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3944442">import</span>&nbsp;<span class="op" id="3944449">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3944452">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3944462">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3944469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3944472">var</span>&nbsp;<span class="op" id="3944476">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944479">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944539">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944569">supportsIPv4</span>&nbsp;<span class="builtintype" id="3944582">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944589">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944649">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944679">supportsIPv6</span>&nbsp;<span class="builtintype" id="3944692">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944699">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944757">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3944821">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944880">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3944896">bool</span><br>
<span class="lineno"></span><span class="op" id="3944901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3944904">func</span>&nbsp;<span class="ident" id="3944909">init</span><span class="op" id="3944913">(</span><span class="op" id="3944914">)</span>&nbsp;<span class="op" id="3944916">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944919">sysInit</span><span class="op" id="3944926">(</span><span class="op" id="3944927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944930">supportsIPv4</span>&nbsp;<span class="op" id="3944943">=</span>&nbsp;<span class="ident" id="3944945">probeIPv4Stack</span><span class="op" id="3944959">(</span><span class="op" id="3944960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3944963">supportsIPv6</span><span class="op" id="3944975">,</span>&nbsp;<span class="ident" id="3944977">supportsIPv4map</span>&nbsp;<span class="op" id="3944993">=</span>&nbsp;<span class="ident" id="3944995">probeIPv6Stack</span><span class="op" id="3945009">(</span><span class="op" id="3945010">)</span><br>
<span class="lineno"></span><span class="op" id="3945012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3945015">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3945079">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3945110">type</span>&nbsp;<span class="ident" id="3945115">netaddr</span>&nbsp;<span class="keyword" id="3945123">interface</span>&nbsp;<span class="op" id="3945133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945136">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945198">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3945254">toAddr</span><span class="op" id="3945260">(</span><span class="op" id="3945261">)</span>&nbsp;<span class="ident" id="3945263">Addr</span><br>
<span class="lineno"></span><span class="op" id="3945268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3945271">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3945335">type</span>&nbsp;<span class="ident" id="3945340">addrList</span>&nbsp;<span class="op" id="3945349">[</span><span class="op" id="3945350">]</span><span class="ident" id="3945351">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3945360">func</span>&nbsp;<span class="op" id="3945365">(</span><span class="ident" id="3945366">al</span>&nbsp;<span class="ident" id="3945369">addrList</span><span class="op" id="3945377">)</span>&nbsp;<span class="ident" id="3945379">toAddr</span><span class="op" id="3945385">(</span><span class="op" id="3945386">)</span>&nbsp;<span class="ident" id="3945388">Addr</span>&nbsp;<span class="op" id="3945393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945396">switch</span>&nbsp;<span class="builtinfunc" id="3945403">len</span><span class="op" id="3945406">(</span><span class="ident" id="3945407">al</span><span class="op" id="3945409">)</span>&nbsp;<span class="op" id="3945411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945414">case</span>&nbsp;<span class="num" id="3945419">0</span><span class="op" id="3945420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945424">return</span>&nbsp;<span class="builtintype" id="3945431">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945436">case</span>&nbsp;<span class="num" id="3945441">1</span><span class="op" id="3945442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945446">return</span>&nbsp;<span class="ident" id="3945453">al</span><span class="op" id="3945455">[</span><span class="num" id="3945456">0</span><span class="op" id="3945457">]</span><span class="op" id="3945458">.</span><span class="ident" id="3945459">toAddr</span><span class="op" id="3945465">(</span><span class="op" id="3945466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945469">default</span><span class="op" id="3945476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945480">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945531">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945585">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945639">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3945657">return</span>&nbsp;<span class="ident" id="3945664">al</span><span class="op" id="3945666">[</span><span class="num" id="3945667">0</span><span class="op" id="3945668">]</span><span class="op" id="3945669">.</span><span class="ident" id="3945670">toAddr</span><span class="op" id="3945676">(</span><span class="op" id="3945677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3945680">}</span><br>
<span class="lineno"></span><span class="op" id="3945682">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3945685">var</span>&nbsp;<span class="ident" id="3945689">errNoSuitableAddress</span>&nbsp;<span class="op" id="3945710">=</span>&nbsp;<span class="ident" id="3945712">errors</span><span class="op" id="3945718">.</span><span class="ident" id="3945719">New</span><span class="op" id="3945722">(</span><span class="string" id="3945723">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3945750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3945753">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3945821">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3945889">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3945960">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3946012">func</span>&nbsp;<span class="ident" id="3946017">firstFavoriteAddr</span><span class="op" id="3946034">(</span><span class="ident" id="3946035">filter</span>&nbsp;<span class="keyword" id="3946042">func</span><span class="op" id="3946046">(</span><span class="ident" id="3946047">IP</span><span class="op" id="3946049">)</span>&nbsp;<span class="ident" id="3946051">IP</span><span class="op" id="3946053">,</span>&nbsp;<span class="ident" id="3946055">ips</span>&nbsp;<span class="op" id="3946059">[</span><span class="op" id="3946060">]</span><span class="ident" id="3946061">IP</span><span class="op" id="3946063">,</span>&nbsp;<span class="ident" id="3946065">inetaddr</span>&nbsp;<span class="keyword" id="3946074">func</span><span class="op" id="3946078">(</span><span class="ident" id="3946079">IP</span><span class="op" id="3946081">)</span>&nbsp;<span class="ident" id="3946083">netaddr</span><span class="op" id="3946090">)</span>&nbsp;<span class="op" id="3946092">(</span><span class="ident" id="3946093">netaddr</span><span class="op" id="3946100">,</span>&nbsp;<span class="builtintype" id="3946102">error</span><span class="op" id="3946107">)</span>&nbsp;<span class="op" id="3946109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946112">if</span>&nbsp;<span class="ident" id="3946115">filter</span>&nbsp;<span class="op" id="3946122">!=</span>&nbsp;<span class="builtintype" id="3946125">nil</span>&nbsp;<span class="op" id="3946129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946133">return</span>&nbsp;<span class="ident" id="3946140">firstSupportedAddr</span><span class="op" id="3946158">(</span><span class="ident" id="3946159">filter</span><span class="op" id="3946165">,</span>&nbsp;<span class="ident" id="3946167">ips</span><span class="op" id="3946170">,</span>&nbsp;<span class="ident" id="3946172">inetaddr</span><span class="op" id="3946180">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946186">var</span>&nbsp;<span class="op" id="3946190">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946194">ipv4</span><span class="op" id="3946198">,</span>&nbsp;<span class="ident" id="3946200">ipv6</span><span class="op" id="3946204">,</span>&nbsp;<span class="ident" id="3946206">swap</span>&nbsp;<span class="builtintype" id="3946211">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946218">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946235">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946245">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946248">for</span>&nbsp;<span class="ident" id="3946252">_</span><span class="op" id="3946253">,</span>&nbsp;<span class="ident" id="3946255">ip</span>&nbsp;<span class="op" id="3946258">:=</span>&nbsp;<span class="keyword" id="3946261">range</span>&nbsp;<span class="ident" id="3946267">ips</span>&nbsp;<span class="op" id="3946271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946275">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946329">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946375">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946426">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946482">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946537">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946589">if</span>&nbsp;<span class="ident" id="3946592">ip4</span>&nbsp;<span class="op" id="3946596">:=</span>&nbsp;<span class="ident" id="3946599">ipv4only</span><span class="op" id="3946607">(</span><span class="ident" id="3946608">ip</span><span class="op" id="3946610">)</span><span class="op" id="3946611">;</span>&nbsp;<span class="ident" id="3946613">ip4</span>&nbsp;<span class="op" id="3946617">!=</span>&nbsp;<span class="builtintype" id="3946620">nil</span>&nbsp;<span class="op" id="3946624">&amp;&amp;</span>&nbsp;<span class="op" id="3946627">!</span><span class="ident" id="3946628">ipv4</span>&nbsp;<span class="op" id="3946633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946638">list</span>&nbsp;<span class="op" id="3946643">=</span>&nbsp;<span class="builtinfunc" id="3946645">append</span><span class="op" id="3946651">(</span><span class="ident" id="3946652">list</span><span class="op" id="3946656">,</span>&nbsp;<span class="ident" id="3946658">inetaddr</span><span class="op" id="3946666">(</span><span class="ident" id="3946667">ip4</span><span class="op" id="3946670">)</span><span class="op" id="3946671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946676">ipv4</span>&nbsp;<span class="op" id="3946681">=</span>&nbsp;<span class="builtintype" id="3946683">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946691">if</span>&nbsp;<span class="ident" id="3946694">ipv6</span>&nbsp;<span class="op" id="3946699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946705">swap</span>&nbsp;<span class="op" id="3946710">=</span>&nbsp;<span class="builtintype" id="3946712">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946724">}</span>&nbsp;<span class="keyword" id="3946726">else</span>&nbsp;<span class="keyword" id="3946731">if</span>&nbsp;<span class="ident" id="3946734">ip6</span>&nbsp;<span class="op" id="3946738">:=</span>&nbsp;<span class="ident" id="3946741">ipv6only</span><span class="op" id="3946749">(</span><span class="ident" id="3946750">ip</span><span class="op" id="3946752">)</span><span class="op" id="3946753">;</span>&nbsp;<span class="ident" id="3946755">ip6</span>&nbsp;<span class="op" id="3946759">!=</span>&nbsp;<span class="builtintype" id="3946762">nil</span>&nbsp;<span class="op" id="3946766">&amp;&amp;</span>&nbsp;<span class="op" id="3946769">!</span><span class="ident" id="3946770">ipv6</span>&nbsp;<span class="op" id="3946775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946780">list</span>&nbsp;<span class="op" id="3946785">=</span>&nbsp;<span class="builtinfunc" id="3946787">append</span><span class="op" id="3946793">(</span><span class="ident" id="3946794">list</span><span class="op" id="3946798">,</span>&nbsp;<span class="ident" id="3946800">inetaddr</span><span class="op" id="3946808">(</span><span class="ident" id="3946809">ip6</span><span class="op" id="3946812">)</span><span class="op" id="3946813">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946818">ipv6</span>&nbsp;<span class="op" id="3946823">=</span>&nbsp;<span class="builtintype" id="3946825">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946836">if</span>&nbsp;<span class="ident" id="3946839">ipv4</span>&nbsp;<span class="op" id="3946844">&amp;&amp;</span>&nbsp;<span class="ident" id="3946847">ipv6</span>&nbsp;<span class="op" id="3946852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946857">if</span>&nbsp;<span class="ident" id="3946860">swap</span>&nbsp;<span class="op" id="3946865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3946871">list</span><span class="op" id="3946875">[</span><span class="num" id="3946876">0</span><span class="op" id="3946877">]</span><span class="op" id="3946878">,</span>&nbsp;<span class="ident" id="3946880">list</span><span class="op" id="3946884">[</span><span class="num" id="3946885">1</span><span class="op" id="3946886">]</span>&nbsp;<span class="op" id="3946888">=</span>&nbsp;<span class="ident" id="3946890">list</span><span class="op" id="3946894">[</span><span class="num" id="3946895">1</span><span class="op" id="3946896">]</span><span class="op" id="3946897">,</span>&nbsp;<span class="ident" id="3946899">list</span><span class="op" id="3946903">[</span><span class="num" id="3946904">0</span><span class="op" id="3946905">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946915">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3946926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946929">switch</span>&nbsp;<span class="builtinfunc" id="3946936">len</span><span class="op" id="3946939">(</span><span class="ident" id="3946940">list</span><span class="op" id="3946944">)</span>&nbsp;<span class="op" id="3946946">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946949">case</span>&nbsp;<span class="num" id="3946954">0</span><span class="op" id="3946955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946959">return</span>&nbsp;<span class="builtintype" id="3946966">nil</span><span class="op" id="3946969">,</span>&nbsp;<span class="ident" id="3946971">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3946993">case</span>&nbsp;<span class="num" id="3946998">1</span><span class="op" id="3946999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947003">return</span>&nbsp;<span class="ident" id="3947010">list</span><span class="op" id="3947014">[</span><span class="num" id="3947015">0</span><span class="op" id="3947016">]</span><span class="op" id="3947017">,</span>&nbsp;<span class="builtintype" id="3947019">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947024">default</span><span class="op" id="3947031">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947035">return</span>&nbsp;<span class="ident" id="3947042">list</span><span class="op" id="3947046">,</span>&nbsp;<span class="builtintype" id="3947048">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3947053">}</span><br>
<span class="lineno"></span><span class="op" id="3947055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3947058">func</span>&nbsp;<span class="ident" id="3947063">firstSupportedAddr</span><span class="op" id="3947081">(</span><span class="ident" id="3947082">filter</span>&nbsp;<span class="keyword" id="3947089">func</span><span class="op" id="3947093">(</span><span class="ident" id="3947094">IP</span><span class="op" id="3947096">)</span>&nbsp;<span class="ident" id="3947098">IP</span><span class="op" id="3947100">,</span>&nbsp;<span class="ident" id="3947102">ips</span>&nbsp;<span class="op" id="3947106">[</span><span class="op" id="3947107">]</span><span class="ident" id="3947108">IP</span><span class="op" id="3947110">,</span>&nbsp;<span class="ident" id="3947112">inetaddr</span>&nbsp;<span class="keyword" id="3947121">func</span><span class="op" id="3947125">(</span><span class="ident" id="3947126">IP</span><span class="op" id="3947128">)</span>&nbsp;<span class="ident" id="3947130">netaddr</span><span class="op" id="3947137">)</span>&nbsp;<span class="op" id="3947139">(</span><span class="ident" id="3947140">netaddr</span><span class="op" id="3947147">,</span>&nbsp;<span class="builtintype" id="3947149">error</span><span class="op" id="3947154">)</span>&nbsp;<span class="op" id="3947156">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947159">for</span>&nbsp;<span class="ident" id="3947163">_</span><span class="op" id="3947164">,</span>&nbsp;<span class="ident" id="3947166">ip</span>&nbsp;<span class="op" id="3947169">:=</span>&nbsp;<span class="keyword" id="3947172">range</span>&nbsp;<span class="ident" id="3947178">ips</span>&nbsp;<span class="op" id="3947182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947186">if</span>&nbsp;<span class="ident" id="3947189">ip</span>&nbsp;<span class="op" id="3947192">:=</span>&nbsp;<span class="ident" id="3947195">filter</span><span class="op" id="3947201">(</span><span class="ident" id="3947202">ip</span><span class="op" id="3947204">)</span><span class="op" id="3947205">;</span>&nbsp;<span class="ident" id="3947207">ip</span>&nbsp;<span class="op" id="3947210">!=</span>&nbsp;<span class="builtintype" id="3947213">nil</span>&nbsp;<span class="op" id="3947217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947222">return</span>&nbsp;<span class="ident" id="3947229">inetaddr</span><span class="op" id="3947237">(</span><span class="ident" id="3947238">ip</span><span class="op" id="3947240">)</span><span class="op" id="3947241">,</span>&nbsp;<span class="builtintype" id="3947243">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3947249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3947252">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947255">return</span>&nbsp;<span class="builtintype" id="3947262">nil</span><span class="op" id="3947265">,</span>&nbsp;<span class="ident" id="3947267">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3947288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3947291">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3947360">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3947433">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3947462">func</span>&nbsp;<span class="ident" id="3947467">ipv4only</span><span class="op" id="3947475">(</span><span class="ident" id="3947476">ip</span>&nbsp;<span class="ident" id="3947479">IP</span><span class="op" id="3947481">)</span>&nbsp;<span class="ident" id="3947483">IP</span>&nbsp;<span class="op" id="3947486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947489">if</span>&nbsp;<span class="ident" id="3947492">supportsIPv4</span>&nbsp;<span class="op" id="3947505">&amp;&amp;</span>&nbsp;<span class="ident" id="3947508">ip</span><span class="op" id="3947510">.</span><span class="ident" id="3947511">To4</span><span class="op" id="3947514">(</span><span class="op" id="3947515">)</span>&nbsp;<span class="op" id="3947517">!=</span>&nbsp;<span class="builtintype" id="3947520">nil</span>&nbsp;<span class="op" id="3947524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947528">return</span>&nbsp;<span class="ident" id="3947535">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3947539">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947542">return</span>&nbsp;<span class="builtintype" id="3947549">nil</span><br>
<span class="lineno"></span><span class="op" id="3947553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3947556">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3947625">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3947693">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3947757">func</span>&nbsp;<span class="ident" id="3947762">ipv6only</span><span class="op" id="3947770">(</span><span class="ident" id="3947771">ip</span>&nbsp;<span class="ident" id="3947774">IP</span><span class="op" id="3947776">)</span>&nbsp;<span class="ident" id="3947778">IP</span>&nbsp;<span class="op" id="3947781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947784">if</span>&nbsp;<span class="ident" id="3947787">supportsIPv6</span>&nbsp;<span class="op" id="3947800">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3947803">len</span><span class="op" id="3947806">(</span><span class="ident" id="3947807">ip</span><span class="op" id="3947809">)</span>&nbsp;<span class="op" id="3947811">==</span>&nbsp;<span class="ident" id="3947814">IPv6len</span>&nbsp;<span class="op" id="3947822">&amp;&amp;</span>&nbsp;<span class="ident" id="3947825">ip</span><span class="op" id="3947827">.</span><span class="ident" id="3947828">To4</span><span class="op" id="3947831">(</span><span class="op" id="3947832">)</span>&nbsp;<span class="op" id="3947834">==</span>&nbsp;<span class="builtintype" id="3947837">nil</span>&nbsp;<span class="op" id="3947841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947845">return</span>&nbsp;<span class="ident" id="3947852">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3947856">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947859">return</span>&nbsp;<span class="builtintype" id="3947866">nil</span><br>
<span class="lineno"></span><span class="op" id="3947870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3947873">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3947940">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3947997">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3948066">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3948124">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3948172">func</span>&nbsp;<span class="ident" id="3948177">SplitHostPort</span><span class="op" id="3948190">(</span><span class="ident" id="3948191">hostport</span>&nbsp;<span class="builtintype" id="3948200">string</span><span class="op" id="3948206">)</span>&nbsp;<span class="op" id="3948208">(</span><span class="ident" id="3948209">host</span><span class="op" id="3948213">,</span>&nbsp;<span class="ident" id="3948215">port</span>&nbsp;<span class="builtintype" id="3948220">string</span><span class="op" id="3948226">,</span>&nbsp;<span class="ident" id="3948228">err</span>&nbsp;<span class="builtintype" id="3948232">error</span><span class="op" id="3948237">)</span>&nbsp;<span class="op" id="3948239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948242">j</span><span class="op" id="3948243">,</span>&nbsp;<span class="ident" id="3948245">k</span>&nbsp;<span class="op" id="3948247">:=</span>&nbsp;<span class="num" id="3948250">0</span><span class="op" id="3948251">,</span>&nbsp;<span class="num" id="3948253">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948257">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948299">i</span>&nbsp;<span class="op" id="3948301">:=</span>&nbsp;<span class="ident" id="3948304">last</span><span class="op" id="3948308">(</span><span class="ident" id="3948309">hostport</span><span class="op" id="3948317">,</span>&nbsp;<span class="string" id="3948319">&#39;:&#39;</span><span class="op" id="3948322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948325">if</span>&nbsp;<span class="ident" id="3948328">i</span>&nbsp;<span class="op" id="3948330">&lt;</span>&nbsp;<span class="num" id="3948332">0</span>&nbsp;<span class="op" id="3948334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948338">goto</span>&nbsp;<span class="ident" id="3948343">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3948356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948360">if</span>&nbsp;<span class="ident" id="3948363">hostport</span><span class="op" id="3948371">[</span><span class="num" id="3948372">0</span><span class="op" id="3948373">]</span>&nbsp;<span class="op" id="3948375">==</span>&nbsp;<span class="string" id="3948378">&#39;[&#39;</span>&nbsp;<span class="op" id="3948382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948386">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948438">end</span>&nbsp;<span class="op" id="3948442">:=</span>&nbsp;<span class="ident" id="3948445">byteIndex</span><span class="op" id="3948454">(</span><span class="ident" id="3948455">hostport</span><span class="op" id="3948463">,</span>&nbsp;<span class="string" id="3948465">&#39;]&#39;</span><span class="op" id="3948468">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948472">if</span>&nbsp;<span class="ident" id="3948475">end</span>&nbsp;<span class="op" id="3948479">&lt;</span>&nbsp;<span class="num" id="3948481">0</span>&nbsp;<span class="op" id="3948483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948488">err</span>&nbsp;<span class="op" id="3948492">=</span>&nbsp;<span class="op" id="3948494">&amp;</span><span class="ident" id="3948495">AddrError</span><span class="op" id="3948504">{</span><span class="string" id="3948505">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3948529">,</span>&nbsp;<span class="ident" id="3948531">hostport</span><span class="op" id="3948539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948544">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3948553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948557">switch</span>&nbsp;<span class="ident" id="3948564">end</span>&nbsp;<span class="op" id="3948568">+</span>&nbsp;<span class="num" id="3948570">1</span>&nbsp;<span class="op" id="3948572">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948576">case</span>&nbsp;<span class="builtinfunc" id="3948581">len</span><span class="op" id="3948584">(</span><span class="ident" id="3948585">hostport</span><span class="op" id="3948593">)</span><span class="op" id="3948594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948599">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948646">goto</span>&nbsp;<span class="ident" id="3948651">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948665">case</span>&nbsp;<span class="ident" id="3948670">i</span><span class="op" id="3948671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948676">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948702">default</span><span class="op" id="3948709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948714">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948767">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948819">if</span>&nbsp;<span class="ident" id="3948822">hostport</span><span class="op" id="3948830">[</span><span class="ident" id="3948831">end</span><span class="op" id="3948834">+</span><span class="num" id="3948835">1</span><span class="op" id="3948836">]</span>&nbsp;<span class="op" id="3948838">==</span>&nbsp;<span class="string" id="3948841">&#39;:&#39;</span>&nbsp;<span class="op" id="3948845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948851">goto</span>&nbsp;<span class="ident" id="3948856">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3948873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3948878">goto</span>&nbsp;<span class="ident" id="3948883">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3948897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948901">host</span>&nbsp;<span class="op" id="3948906">=</span>&nbsp;<span class="ident" id="3948908">hostport</span><span class="op" id="3948916">[</span><span class="num" id="3948917">1</span><span class="op" id="3948918">:</span><span class="ident" id="3948919">end</span><span class="op" id="3948922">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3948926">j</span><span class="op" id="3948927">,</span>&nbsp;<span class="ident" id="3948929">k</span>&nbsp;<span class="op" id="3948931">=</span>&nbsp;<span class="num" id="3948933">1</span><span class="op" id="3948934">,</span>&nbsp;<span class="ident" id="3948936">end</span><span class="op" id="3948939">+</span><span class="num" id="3948940">1</span>&nbsp;<span class="comment" id="3948942">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949000">}</span>&nbsp;<span class="keyword" id="3949002">else</span>&nbsp;<span class="op" id="3949007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949011">host</span>&nbsp;<span class="op" id="3949016">=</span>&nbsp;<span class="ident" id="3949018">hostport</span><span class="op" id="3949026">[</span><span class="op" id="3949027">:</span><span class="ident" id="3949028">i</span><span class="op" id="3949029">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949033">if</span>&nbsp;<span class="ident" id="3949036">byteIndex</span><span class="op" id="3949045">(</span><span class="ident" id="3949046">host</span><span class="op" id="3949050">,</span>&nbsp;<span class="string" id="3949052">&#39;:&#39;</span><span class="op" id="3949055">)</span>&nbsp;<span class="op" id="3949057">&gt;=</span>&nbsp;<span class="num" id="3949060">0</span>&nbsp;<span class="op" id="3949062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949067">goto</span>&nbsp;<span class="ident" id="3949072">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949088">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949092">if</span>&nbsp;<span class="ident" id="3949095">byteIndex</span><span class="op" id="3949104">(</span><span class="ident" id="3949105">host</span><span class="op" id="3949109">,</span>&nbsp;<span class="string" id="3949111">&#39;%&#39;</span><span class="op" id="3949114">)</span>&nbsp;<span class="op" id="3949116">&gt;=</span>&nbsp;<span class="num" id="3949119">0</span>&nbsp;<span class="op" id="3949121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949126">goto</span>&nbsp;<span class="ident" id="3949131">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949155">if</span>&nbsp;<span class="ident" id="3949158">byteIndex</span><span class="op" id="3949167">(</span><span class="ident" id="3949168">hostport</span><span class="op" id="3949176">[</span><span class="ident" id="3949177">j</span><span class="op" id="3949178">:</span><span class="op" id="3949179">]</span><span class="op" id="3949180">,</span>&nbsp;<span class="string" id="3949182">&#39;[&#39;</span><span class="op" id="3949185">)</span>&nbsp;<span class="op" id="3949187">&gt;=</span>&nbsp;<span class="num" id="3949190">0</span>&nbsp;<span class="op" id="3949192">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949196">err</span>&nbsp;<span class="op" id="3949200">=</span>&nbsp;<span class="op" id="3949202">&amp;</span><span class="ident" id="3949203">AddrError</span><span class="op" id="3949212">{</span><span class="string" id="3949213">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3949240">,</span>&nbsp;<span class="ident" id="3949242">hostport</span><span class="op" id="3949250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949254">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949265">if</span>&nbsp;<span class="ident" id="3949268">byteIndex</span><span class="op" id="3949277">(</span><span class="ident" id="3949278">hostport</span><span class="op" id="3949286">[</span><span class="ident" id="3949287">k</span><span class="op" id="3949288">:</span><span class="op" id="3949289">]</span><span class="op" id="3949290">,</span>&nbsp;<span class="string" id="3949292">&#39;]&#39;</span><span class="op" id="3949295">)</span>&nbsp;<span class="op" id="3949297">&gt;=</span>&nbsp;<span class="num" id="3949300">0</span>&nbsp;<span class="op" id="3949302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949306">err</span>&nbsp;<span class="op" id="3949310">=</span>&nbsp;<span class="op" id="3949312">&amp;</span><span class="ident" id="3949313">AddrError</span><span class="op" id="3949322">{</span><span class="string" id="3949323">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3949350">,</span>&nbsp;<span class="ident" id="3949352">hostport</span><span class="op" id="3949360">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949364">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949376">port</span>&nbsp;<span class="op" id="3949381">=</span>&nbsp;<span class="ident" id="3949383">hostport</span><span class="op" id="3949391">[</span><span class="ident" id="3949392">i</span><span class="op" id="3949393">+</span><span class="num" id="3949394">1</span><span class="op" id="3949395">:</span><span class="op" id="3949396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949399">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3949407">missingPort</span><span class="op" id="3949418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949421">err</span>&nbsp;<span class="op" id="3949425">=</span>&nbsp;<span class="op" id="3949427">&amp;</span><span class="ident" id="3949428">AddrError</span><span class="op" id="3949437">{</span><span class="string" id="3949438">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3949463">,</span>&nbsp;<span class="ident" id="3949465">hostport</span><span class="op" id="3949473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949476">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3949484">tooManyColons</span><span class="op" id="3949497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949500">err</span>&nbsp;<span class="op" id="3949504">=</span>&nbsp;<span class="op" id="3949506">&amp;</span><span class="ident" id="3949507">AddrError</span><span class="op" id="3949516">{</span><span class="string" id="3949517">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3949545">,</span>&nbsp;<span class="ident" id="3949547">hostport</span><span class="op" id="3949555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949558">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3949566">missingBrackets</span><span class="op" id="3949581">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949584">err</span>&nbsp;<span class="op" id="3949588">=</span>&nbsp;<span class="op" id="3949590">&amp;</span><span class="ident" id="3949591">AddrError</span><span class="op" id="3949600">{</span><span class="string" id="3949601">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3949630">,</span>&nbsp;<span class="ident" id="3949632">hostport</span><span class="op" id="3949640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949643">return</span><br>
<span class="lineno"></span><span class="op" id="3949650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3949653">func</span>&nbsp;<span class="ident" id="3949658">splitHostZone</span><span class="op" id="3949671">(</span><span class="ident" id="3949672">s</span>&nbsp;<span class="builtintype" id="3949674">string</span><span class="op" id="3949680">)</span>&nbsp;<span class="op" id="3949682">(</span><span class="ident" id="3949683">host</span><span class="op" id="3949687">,</span>&nbsp;<span class="ident" id="3949689">zone</span>&nbsp;<span class="builtintype" id="3949694">string</span><span class="op" id="3949700">)</span>&nbsp;<span class="op" id="3949702">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3949705">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3949769">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949792">if</span>&nbsp;<span class="ident" id="3949795">i</span>&nbsp;<span class="op" id="3949797">:=</span>&nbsp;<span class="ident" id="3949800">last</span><span class="op" id="3949804">(</span><span class="ident" id="3949805">s</span><span class="op" id="3949806">,</span>&nbsp;<span class="string" id="3949808">&#39;%&#39;</span><span class="op" id="3949811">)</span><span class="op" id="3949812">;</span>&nbsp;<span class="ident" id="3949814">i</span>&nbsp;<span class="op" id="3949816">&gt;</span>&nbsp;<span class="num" id="3949818">0</span>&nbsp;<span class="op" id="3949820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949824">host</span><span class="op" id="3949828">,</span>&nbsp;<span class="ident" id="3949830">zone</span>&nbsp;<span class="op" id="3949835">=</span>&nbsp;<span class="ident" id="3949837">s</span><span class="op" id="3949838">[</span><span class="op" id="3949839">:</span><span class="ident" id="3949840">i</span><span class="op" id="3949841">]</span><span class="op" id="3949842">,</span>&nbsp;<span class="ident" id="3949844">s</span><span class="op" id="3949845">[</span><span class="ident" id="3949846">i</span><span class="op" id="3949847">+</span><span class="num" id="3949848">1</span><span class="op" id="3949849">:</span><span class="op" id="3949850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949853">}</span>&nbsp;<span class="keyword" id="3949855">else</span>&nbsp;<span class="op" id="3949860">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949864">host</span>&nbsp;<span class="op" id="3949869">=</span>&nbsp;<span class="ident" id="3949871">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3949874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3949877">return</span><br>
<span class="lineno"></span><span class="op" id="3949884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3949887">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3949956">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3950024">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3950042">func</span>&nbsp;<span class="ident" id="3950047">JoinHostPort</span><span class="op" id="3950059">(</span><span class="ident" id="3950060">host</span><span class="op" id="3950064">,</span>&nbsp;<span class="ident" id="3950066">port</span>&nbsp;<span class="builtintype" id="3950071">string</span><span class="op" id="3950077">)</span>&nbsp;<span class="builtintype" id="3950079">string</span>&nbsp;<span class="op" id="3950086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3950089">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950151">if</span>&nbsp;<span class="ident" id="3950154">byteIndex</span><span class="op" id="3950163">(</span><span class="ident" id="3950164">host</span><span class="op" id="3950168">,</span>&nbsp;<span class="string" id="3950170">&#39;:&#39;</span><span class="op" id="3950173">)</span>&nbsp;<span class="op" id="3950175">&gt;=</span>&nbsp;<span class="num" id="3950178">0</span>&nbsp;<span class="op" id="3950180">||</span>&nbsp;<span class="ident" id="3950183">byteIndex</span><span class="op" id="3950192">(</span><span class="ident" id="3950193">host</span><span class="op" id="3950197">,</span>&nbsp;<span class="string" id="3950199">&#39;%&#39;</span><span class="op" id="3950202">)</span>&nbsp;<span class="op" id="3950204">&gt;=</span>&nbsp;<span class="num" id="3950207">0</span>&nbsp;<span class="op" id="3950209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950213">return</span>&nbsp;<span class="string" id="3950220">&#34;[&#34;</span>&nbsp;<span class="op" id="3950224">+</span>&nbsp;<span class="ident" id="3950226">host</span>&nbsp;<span class="op" id="3950231">+</span>&nbsp;<span class="string" id="3950233">&#34;]:&#34;</span>&nbsp;<span class="op" id="3950238">+</span>&nbsp;<span class="ident" id="3950240">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3950246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950249">return</span>&nbsp;<span class="ident" id="3950256">host</span>&nbsp;<span class="op" id="3950261">+</span>&nbsp;<span class="string" id="3950263">&#34;:&#34;</span>&nbsp;<span class="op" id="3950267">+</span>&nbsp;<span class="ident" id="3950269">port</span><br>
<span class="lineno"></span><span class="op" id="3950274">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3950277">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3950342">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3950407">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3950471">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3950540">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3950609">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3950639">func</span>&nbsp;<span class="ident" id="3950644">resolveInternetAddr</span><span class="op" id="3950663">(</span><span class="ident" id="3950664">net</span><span class="op" id="3950667">,</span>&nbsp;<span class="ident" id="3950669">addr</span>&nbsp;<span class="builtintype" id="3950674">string</span><span class="op" id="3950680">,</span>&nbsp;<span class="ident" id="3950682">deadline</span>&nbsp;<span class="ident" id="3950691">time</span><span class="op" id="3950695">.</span><span class="ident" id="3950696">Time</span><span class="op" id="3950700">)</span>&nbsp;<span class="op" id="3950702">(</span><span class="ident" id="3950703">netaddr</span><span class="op" id="3950710">,</span>&nbsp;<span class="builtintype" id="3950712">error</span><span class="op" id="3950717">)</span>&nbsp;<span class="op" id="3950719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950722">var</span>&nbsp;<span class="op" id="3950726">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950730">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3950747">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950755">host</span><span class="op" id="3950759">,</span>&nbsp;<span class="ident" id="3950761">port</span><span class="op" id="3950765">,</span>&nbsp;<span class="ident" id="3950767">zone</span>&nbsp;<span class="builtintype" id="3950772">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950781">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3950798">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3950803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950806">switch</span>&nbsp;<span class="ident" id="3950813">net</span>&nbsp;<span class="op" id="3950817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950820">case</span>&nbsp;<span class="string" id="3950825">&#34;tcp&#34;</span><span class="op" id="3950830">,</span>&nbsp;<span class="string" id="3950832">&#34;tcp4&#34;</span><span class="op" id="3950838">,</span>&nbsp;<span class="string" id="3950840">&#34;tcp6&#34;</span><span class="op" id="3950846">,</span>&nbsp;<span class="string" id="3950848">&#34;udp&#34;</span><span class="op" id="3950853">,</span>&nbsp;<span class="string" id="3950855">&#34;udp4&#34;</span><span class="op" id="3950861">,</span>&nbsp;<span class="string" id="3950863">&#34;udp6&#34;</span><span class="op" id="3950869">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950873">if</span>&nbsp;<span class="ident" id="3950876">addr</span>&nbsp;<span class="op" id="3950881">!=</span>&nbsp;<span class="string" id="3950884">&#34;&#34;</span>&nbsp;<span class="op" id="3950887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950892">if</span>&nbsp;<span class="ident" id="3950895">host</span><span class="op" id="3950899">,</span>&nbsp;<span class="ident" id="3950901">port</span><span class="op" id="3950905">,</span>&nbsp;<span class="ident" id="3950907">err</span>&nbsp;<span class="op" id="3950911">=</span>&nbsp;<span class="ident" id="3950913">SplitHostPort</span><span class="op" id="3950926">(</span><span class="ident" id="3950927">addr</span><span class="op" id="3950931">)</span><span class="op" id="3950932">;</span>&nbsp;<span class="ident" id="3950934">err</span>&nbsp;<span class="op" id="3950938">!=</span>&nbsp;<span class="builtintype" id="3950941">nil</span>&nbsp;<span class="op" id="3950945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950951">return</span>&nbsp;<span class="builtintype" id="3950958">nil</span><span class="op" id="3950961">,</span>&nbsp;<span class="ident" id="3950963">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3950970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3950975">if</span>&nbsp;<span class="ident" id="3950978">portnum</span><span class="op" id="3950985">,</span>&nbsp;<span class="ident" id="3950987">err</span>&nbsp;<span class="op" id="3950991">=</span>&nbsp;<span class="ident" id="3950993">parsePort</span><span class="op" id="3951002">(</span><span class="ident" id="3951003">net</span><span class="op" id="3951006">,</span>&nbsp;<span class="ident" id="3951008">port</span><span class="op" id="3951012">)</span><span class="op" id="3951013">;</span>&nbsp;<span class="ident" id="3951015">err</span>&nbsp;<span class="op" id="3951019">!=</span>&nbsp;<span class="builtintype" id="3951022">nil</span>&nbsp;<span class="op" id="3951026">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951032">return</span>&nbsp;<span class="builtintype" id="3951039">nil</span><span class="op" id="3951042">,</span>&nbsp;<span class="ident" id="3951044">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951058">case</span>&nbsp;<span class="string" id="3951063">&#34;ip&#34;</span><span class="op" id="3951067">,</span>&nbsp;<span class="string" id="3951069">&#34;ip4&#34;</span><span class="op" id="3951074">,</span>&nbsp;<span class="string" id="3951076">&#34;ip6&#34;</span><span class="op" id="3951081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951085">if</span>&nbsp;<span class="ident" id="3951088">addr</span>&nbsp;<span class="op" id="3951093">!=</span>&nbsp;<span class="string" id="3951096">&#34;&#34;</span>&nbsp;<span class="op" id="3951099">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951104">host</span>&nbsp;<span class="op" id="3951109">=</span>&nbsp;<span class="ident" id="3951111">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951121">default</span><span class="op" id="3951128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951132">return</span>&nbsp;<span class="builtintype" id="3951139">nil</span><span class="op" id="3951142">,</span>&nbsp;<span class="ident" id="3951144">UnknownNetworkError</span><span class="op" id="3951163">(</span><span class="ident" id="3951164">net</span><span class="op" id="3951167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951170">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951173">inetaddr</span>&nbsp;<span class="op" id="3951182">:=</span>&nbsp;<span class="keyword" id="3951185">func</span><span class="op" id="3951189">(</span><span class="ident" id="3951190">ip</span>&nbsp;<span class="ident" id="3951193">IP</span><span class="op" id="3951195">)</span>&nbsp;<span class="ident" id="3951197">netaddr</span>&nbsp;<span class="op" id="3951205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951209">switch</span>&nbsp;<span class="ident" id="3951216">net</span>&nbsp;<span class="op" id="3951220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951224">case</span>&nbsp;<span class="string" id="3951229">&#34;tcp&#34;</span><span class="op" id="3951234">,</span>&nbsp;<span class="string" id="3951236">&#34;tcp4&#34;</span><span class="op" id="3951242">,</span>&nbsp;<span class="string" id="3951244">&#34;tcp6&#34;</span><span class="op" id="3951250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951255">return</span>&nbsp;<span class="op" id="3951262">&amp;</span><span class="ident" id="3951263">TCPAddr</span><span class="op" id="3951270">{</span><span class="ident" id="3951271">IP</span><span class="op" id="3951273">:</span>&nbsp;<span class="ident" id="3951275">ip</span><span class="op" id="3951277">,</span>&nbsp;<span class="ident" id="3951279">Port</span><span class="op" id="3951283">:</span>&nbsp;<span class="ident" id="3951285">portnum</span><span class="op" id="3951292">,</span>&nbsp;<span class="ident" id="3951294">Zone</span><span class="op" id="3951298">:</span>&nbsp;<span class="ident" id="3951300">zone</span><span class="op" id="3951304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951308">case</span>&nbsp;<span class="string" id="3951313">&#34;udp&#34;</span><span class="op" id="3951318">,</span>&nbsp;<span class="string" id="3951320">&#34;udp4&#34;</span><span class="op" id="3951326">,</span>&nbsp;<span class="string" id="3951328">&#34;udp6&#34;</span><span class="op" id="3951334">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951339">return</span>&nbsp;<span class="op" id="3951346">&amp;</span><span class="ident" id="3951347">UDPAddr</span><span class="op" id="3951354">{</span><span class="ident" id="3951355">IP</span><span class="op" id="3951357">:</span>&nbsp;<span class="ident" id="3951359">ip</span><span class="op" id="3951361">,</span>&nbsp;<span class="ident" id="3951363">Port</span><span class="op" id="3951367">:</span>&nbsp;<span class="ident" id="3951369">portnum</span><span class="op" id="3951376">,</span>&nbsp;<span class="ident" id="3951378">Zone</span><span class="op" id="3951382">:</span>&nbsp;<span class="ident" id="3951384">zone</span><span class="op" id="3951388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951392">case</span>&nbsp;<span class="string" id="3951397">&#34;ip&#34;</span><span class="op" id="3951401">,</span>&nbsp;<span class="string" id="3951403">&#34;ip4&#34;</span><span class="op" id="3951408">,</span>&nbsp;<span class="string" id="3951410">&#34;ip6&#34;</span><span class="op" id="3951415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951420">return</span>&nbsp;<span class="op" id="3951427">&amp;</span><span class="ident" id="3951428">IPAddr</span><span class="op" id="3951434">{</span><span class="ident" id="3951435">IP</span><span class="op" id="3951437">:</span>&nbsp;<span class="ident" id="3951439">ip</span><span class="op" id="3951441">,</span>&nbsp;<span class="ident" id="3951443">Zone</span><span class="op" id="3951447">:</span>&nbsp;<span class="ident" id="3951449">zone</span><span class="op" id="3951453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951457">default</span><span class="op" id="3951464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3951469">panic</span><span class="op" id="3951474">(</span><span class="string" id="3951475">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3951498">+</span>&nbsp;<span class="ident" id="3951500">net</span><span class="op" id="3951503">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951513">if</span>&nbsp;<span class="ident" id="3951516">host</span>&nbsp;<span class="op" id="3951521">==</span>&nbsp;<span class="string" id="3951524">&#34;&#34;</span>&nbsp;<span class="op" id="3951527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951531">return</span>&nbsp;<span class="ident" id="3951538">inetaddr</span><span class="op" id="3951546">(</span><span class="builtintype" id="3951547">nil</span><span class="op" id="3951550">)</span><span class="op" id="3951551">,</span>&nbsp;<span class="builtintype" id="3951553">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951558">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3951561">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951594">var</span>&nbsp;<span class="ident" id="3951598">ip</span>&nbsp;<span class="ident" id="3951601">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951605">if</span>&nbsp;<span class="ident" id="3951608">ip</span>&nbsp;<span class="op" id="3951611">=</span>&nbsp;<span class="ident" id="3951613">parseIPv4</span><span class="op" id="3951622">(</span><span class="ident" id="3951623">host</span><span class="op" id="3951627">)</span><span class="op" id="3951628">;</span>&nbsp;<span class="ident" id="3951630">ip</span>&nbsp;<span class="op" id="3951633">!=</span>&nbsp;<span class="builtintype" id="3951636">nil</span>&nbsp;<span class="op" id="3951640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951644">return</span>&nbsp;<span class="ident" id="3951651">inetaddr</span><span class="op" id="3951659">(</span><span class="ident" id="3951660">ip</span><span class="op" id="3951662">)</span><span class="op" id="3951663">,</span>&nbsp;<span class="builtintype" id="3951665">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951670">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951673">if</span>&nbsp;<span class="ident" id="3951676">ip</span><span class="op" id="3951678">,</span>&nbsp;<span class="ident" id="3951680">zone</span>&nbsp;<span class="op" id="3951685">=</span>&nbsp;<span class="ident" id="3951687">parseIPv6</span><span class="op" id="3951696">(</span><span class="ident" id="3951697">host</span><span class="op" id="3951701">,</span>&nbsp;<span class="builtintype" id="3951703">true</span><span class="op" id="3951707">)</span><span class="op" id="3951708">;</span>&nbsp;<span class="ident" id="3951710">ip</span>&nbsp;<span class="op" id="3951713">!=</span>&nbsp;<span class="builtintype" id="3951716">nil</span>&nbsp;<span class="op" id="3951720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951724">return</span>&nbsp;<span class="ident" id="3951731">inetaddr</span><span class="op" id="3951739">(</span><span class="ident" id="3951740">ip</span><span class="op" id="3951742">)</span><span class="op" id="3951743">,</span>&nbsp;<span class="builtintype" id="3951745">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3951753">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951776">host</span><span class="op" id="3951780">,</span>&nbsp;<span class="ident" id="3951782">zone</span>&nbsp;<span class="op" id="3951787">=</span>&nbsp;<span class="ident" id="3951789">splitHostZone</span><span class="op" id="3951802">(</span><span class="ident" id="3951803">host</span><span class="op" id="3951807">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951810">ips</span><span class="op" id="3951813">,</span>&nbsp;<span class="ident" id="3951815">err</span>&nbsp;<span class="op" id="3951819">:=</span>&nbsp;<span class="ident" id="3951822">lookupIPDeadline</span><span class="op" id="3951838">(</span><span class="ident" id="3951839">host</span><span class="op" id="3951843">,</span>&nbsp;<span class="ident" id="3951845">deadline</span><span class="op" id="3951853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951856">if</span>&nbsp;<span class="ident" id="3951859">err</span>&nbsp;<span class="op" id="3951863">!=</span>&nbsp;<span class="builtintype" id="3951866">nil</span>&nbsp;<span class="op" id="3951870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951874">return</span>&nbsp;<span class="builtintype" id="3951881">nil</span><span class="op" id="3951884">,</span>&nbsp;<span class="ident" id="3951886">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951894">var</span>&nbsp;<span class="ident" id="3951898">filter</span>&nbsp;<span class="keyword" id="3951905">func</span><span class="op" id="3951909">(</span><span class="ident" id="3951910">IP</span><span class="op" id="3951912">)</span>&nbsp;<span class="ident" id="3951914">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951918">if</span>&nbsp;<span class="ident" id="3951921">net</span>&nbsp;<span class="op" id="3951925">!=</span>&nbsp;<span class="string" id="3951928">&#34;&#34;</span>&nbsp;<span class="op" id="3951931">&amp;&amp;</span>&nbsp;<span class="ident" id="3951934">net</span><span class="op" id="3951937">[</span><span class="builtinfunc" id="3951938">len</span><span class="op" id="3951941">(</span><span class="ident" id="3951942">net</span><span class="op" id="3951945">)</span><span class="op" id="3951946">-</span><span class="num" id="3951947">1</span><span class="op" id="3951948">]</span>&nbsp;<span class="op" id="3951950">==</span>&nbsp;<span class="string" id="3951953">&#39;4&#39;</span>&nbsp;<span class="op" id="3951957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951961">filter</span>&nbsp;<span class="op" id="3951968">=</span>&nbsp;<span class="ident" id="3951970">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951983">if</span>&nbsp;<span class="ident" id="3951986">net</span>&nbsp;<span class="op" id="3951990">!=</span>&nbsp;<span class="string" id="3951993">&#34;&#34;</span>&nbsp;<span class="op" id="3951996">&amp;&amp;</span>&nbsp;<span class="ident" id="3951999">net</span><span class="op" id="3952002">[</span><span class="builtinfunc" id="3952003">len</span><span class="op" id="3952006">(</span><span class="ident" id="3952007">net</span><span class="op" id="3952010">)</span><span class="op" id="3952011">-</span><span class="num" id="3952012">1</span><span class="op" id="3952013">]</span>&nbsp;<span class="op" id="3952015">==</span>&nbsp;<span class="string" id="3952018">&#39;6&#39;</span>&nbsp;<span class="op" id="3952022">||</span>&nbsp;<span class="ident" id="3952025">zone</span>&nbsp;<span class="op" id="3952030">!=</span>&nbsp;<span class="string" id="3952033">&#34;&#34;</span>&nbsp;<span class="op" id="3952036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952040">filter</span>&nbsp;<span class="op" id="3952047">=</span>&nbsp;<span class="ident" id="3952049">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952062">return</span>&nbsp;<span class="ident" id="3952069">firstFavoriteAddr</span><span class="op" id="3952086">(</span><span class="ident" id="3952087">filter</span><span class="op" id="3952093">,</span>&nbsp;<span class="ident" id="3952095">ips</span><span class="op" id="3952098">,</span>&nbsp;<span class="ident" id="3952100">inetaddr</span><span class="op" id="3952108">)</span><br>
<span class="lineno"></span><span class="op" id="3952110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3952113">func</span>&nbsp;<span class="ident" id="3952118">zoneToString</span><span class="op" id="3952130">(</span><span class="ident" id="3952131">zone</span>&nbsp;<span class="builtintype" id="3952136">int</span><span class="op" id="3952139">)</span>&nbsp;<span class="builtintype" id="3952141">string</span>&nbsp;<span class="op" id="3952148">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952151">if</span>&nbsp;<span class="ident" id="3952154">zone</span>&nbsp;<span class="op" id="3952159">==</span>&nbsp;<span class="num" id="3952162">0</span>&nbsp;<span class="op" id="3952164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952168">return</span>&nbsp;<span class="string" id="3952175">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952182">if</span>&nbsp;<span class="ident" id="3952185">ifi</span><span class="op" id="3952188">,</span>&nbsp;<span class="ident" id="3952190">err</span>&nbsp;<span class="op" id="3952194">:=</span>&nbsp;<span class="ident" id="3952197">InterfaceByIndex</span><span class="op" id="3952213">(</span><span class="ident" id="3952214">zone</span><span class="op" id="3952218">)</span><span class="op" id="3952219">;</span>&nbsp;<span class="ident" id="3952221">err</span>&nbsp;<span class="op" id="3952225">==</span>&nbsp;<span class="builtintype" id="3952228">nil</span>&nbsp;<span class="op" id="3952232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952236">return</span>&nbsp;<span class="ident" id="3952243">ifi</span><span class="op" id="3952246">.</span><span class="ident" id="3952247">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952256">return</span>&nbsp;<span class="ident" id="3952263">itod</span><span class="op" id="3952267">(</span><span class="builtintype" id="3952268">uint</span><span class="op" id="3952272">(</span><span class="ident" id="3952273">zone</span><span class="op" id="3952277">)</span><span class="op" id="3952278">)</span><br>
<span class="lineno"></span><span class="op" id="3952280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3952283">func</span>&nbsp;<span class="ident" id="3952288">zoneToInt</span><span class="op" id="3952297">(</span><span class="ident" id="3952298">zone</span>&nbsp;<span class="builtintype" id="3952303">string</span><span class="op" id="3952309">)</span>&nbsp;<span class="builtintype" id="3952311">int</span>&nbsp;<span class="op" id="3952315">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952318">if</span>&nbsp;<span class="ident" id="3952321">zone</span>&nbsp;<span class="op" id="3952326">==</span>&nbsp;<span class="string" id="3952329">&#34;&#34;</span>&nbsp;<span class="op" id="3952332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952336">return</span>&nbsp;<span class="num" id="3952343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952349">if</span>&nbsp;<span class="ident" id="3952352">ifi</span><span class="op" id="3952355">,</span>&nbsp;<span class="ident" id="3952357">err</span>&nbsp;<span class="op" id="3952361">:=</span>&nbsp;<span class="ident" id="3952364">InterfaceByName</span><span class="op" id="3952379">(</span><span class="ident" id="3952380">zone</span><span class="op" id="3952384">)</span><span class="op" id="3952385">;</span>&nbsp;<span class="ident" id="3952387">err</span>&nbsp;<span class="op" id="3952391">==</span>&nbsp;<span class="builtintype" id="3952394">nil</span>&nbsp;<span class="op" id="3952398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952402">return</span>&nbsp;<span class="ident" id="3952409">ifi</span><span class="op" id="3952412">.</span><span class="ident" id="3952413">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952423">n</span><span class="op" id="3952424">,</span>&nbsp;<span class="ident" id="3952426">_</span><span class="op" id="3952427">,</span>&nbsp;<span class="ident" id="3952429">_</span>&nbsp;<span class="op" id="3952431">:=</span>&nbsp;<span class="ident" id="3952434">dtoi</span><span class="op" id="3952438">(</span><span class="ident" id="3952439">zone</span><span class="op" id="3952443">,</span>&nbsp;<span class="num" id="3952445">0</span><span class="op" id="3952446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952449">return</span>&nbsp;<span class="ident" id="3952456">n</span><br>
<span class="lineno"></span><span class="op" id="3952458">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
