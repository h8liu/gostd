<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1338869">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1338924">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1338978">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1339029">package</span>&nbsp;<span class="ident" id="1339037">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339044">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1339088">import</span>&nbsp;<span class="op" id="1339095">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1339098">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1339108">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1339114">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1339129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1339132">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1339209">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1339271">type</span>&nbsp;<span class="ident" id="1339276">Buffer</span>&nbsp;<span class="keyword" id="1339283">struct</span>&nbsp;<span class="op" id="1339290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339293">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339303">[</span><span class="op" id="1339304">]</span><span class="builtintype" id="1339305">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339321">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339368">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1339378">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339396">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339443">runeBytes</span>&nbsp;<span class="op" id="1339453">[</span><span class="ident" id="1339454">utf8</span><span class="op" id="1339458">.</span><span class="ident" id="1339459">UTFMax</span><span class="op" id="1339465">]</span><span class="builtintype" id="1339466">byte</span>&nbsp;<span class="comment" id="1339471">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339527">bootstrap</span>&nbsp;<span class="op" id="1339537">[</span><span class="num" id="1339538">64</span><span class="op" id="1339540">]</span><span class="builtintype" id="1339541">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339555">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339634">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1339644">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339662">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1339722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1339725">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1339787">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1339840">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1339868">type</span>&nbsp;<span class="ident" id="1339873">readOp</span>&nbsp;<span class="builtintype" id="1339880">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1339885">const</span>&nbsp;<span class="op" id="1339891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339894">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1339905">readOp</span>&nbsp;<span class="op" id="1339912">=</span>&nbsp;<span class="ident" id="1339914">iota</span>&nbsp;<span class="comment" id="1339919">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339943">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339968">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339983">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340008">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1340037">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1340040">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1340131">var</span>&nbsp;<span class="ident" id="1340135">ErrTooLarge</span>&nbsp;<span class="op" id="1340147">=</span>&nbsp;<span class="ident" id="1340149">errors</span><span class="op" id="1340155">.</span><span class="ident" id="1340156">New</span><span class="op" id="1340159">(</span><span class="string" id="1340160">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1340185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1340188">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1340266">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1340339">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1340412">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1340462">func</span>&nbsp;<span class="op" id="1340467">(</span><span class="ident" id="1340468">b</span>&nbsp;<span class="op" id="1340470">*</span><span class="ident" id="1340471">Buffer</span><span class="op" id="1340477">)</span>&nbsp;<span class="ident" id="1340479">Bytes</span><span class="op" id="1340484">(</span><span class="op" id="1340485">)</span>&nbsp;<span class="op" id="1340487">[</span><span class="op" id="1340488">]</span><span class="builtintype" id="1340489">byte</span>&nbsp;<span class="op" id="1340494">{</span>&nbsp;<span class="keyword" id="1340496">return</span>&nbsp;<span class="ident" id="1340503">b</span><span class="op" id="1340504">.</span><span class="ident" id="1340505">buf</span><span class="op" id="1340508">[</span><span class="ident" id="1340509">b</span><span class="op" id="1340510">.</span><span class="ident" id="1340511">off</span><span class="op" id="1340514">:</span><span class="op" id="1340515">]</span>&nbsp;<span class="op" id="1340517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1340520">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1340587">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1340656">func</span>&nbsp;<span class="op" id="1340661">(</span><span class="ident" id="1340662">b</span>&nbsp;<span class="op" id="1340664">*</span><span class="ident" id="1340665">Buffer</span><span class="op" id="1340671">)</span>&nbsp;<span class="ident" id="1340673">String</span><span class="op" id="1340679">(</span><span class="op" id="1340680">)</span>&nbsp;<span class="builtintype" id="1340682">string</span>&nbsp;<span class="op" id="1340689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340692">if</span>&nbsp;<span class="ident" id="1340695">b</span>&nbsp;<span class="op" id="1340697">==</span>&nbsp;<span class="ident" id="1340700">nil</span>&nbsp;<span class="op" id="1340704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340708">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340748">return</span>&nbsp;<span class="string" id="1340755">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340767">return</span>&nbsp;<span class="builtintype" id="1340774">string</span><span class="op" id="1340780">(</span><span class="ident" id="1340781">b</span><span class="op" id="1340782">.</span><span class="ident" id="1340783">buf</span><span class="op" id="1340786">[</span><span class="ident" id="1340787">b</span><span class="op" id="1340788">.</span><span class="ident" id="1340789">off</span><span class="op" id="1340792">:</span><span class="op" id="1340793">]</span><span class="op" id="1340794">)</span><br>
<span class="lineno"></span><span class="op" id="1340796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1340799">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1340871">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1340901">func</span>&nbsp;<span class="op" id="1340906">(</span><span class="ident" id="1340907">b</span>&nbsp;<span class="op" id="1340909">*</span><span class="ident" id="1340910">Buffer</span><span class="op" id="1340916">)</span>&nbsp;<span class="ident" id="1340918">Len</span><span class="op" id="1340921">(</span><span class="op" id="1340922">)</span>&nbsp;<span class="builtintype" id="1340924">int</span>&nbsp;<span class="op" id="1340928">{</span>&nbsp;<span class="keyword" id="1340930">return</span>&nbsp;<span class="builtinfunc" id="1340937">len</span><span class="op" id="1340940">(</span><span class="ident" id="1340941">b</span><span class="op" id="1340942">.</span><span class="ident" id="1340943">buf</span><span class="op" id="1340946">)</span>&nbsp;<span class="op" id="1340948">-</span>&nbsp;<span class="ident" id="1340950">b</span><span class="op" id="1340951">.</span><span class="ident" id="1340952">off</span>&nbsp;<span class="op" id="1340956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1340959">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1341030">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1341102">func</span>&nbsp;<span class="op" id="1341107">(</span><span class="ident" id="1341108">b</span>&nbsp;<span class="op" id="1341110">*</span><span class="ident" id="1341111">Buffer</span><span class="op" id="1341117">)</span>&nbsp;<span class="ident" id="1341119">Truncate</span><span class="op" id="1341127">(</span><span class="ident" id="1341128">n</span>&nbsp;<span class="builtintype" id="1341130">int</span><span class="op" id="1341133">)</span>&nbsp;<span class="op" id="1341135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341138">b</span><span class="op" id="1341139">.</span><span class="ident" id="1341140">lastRead</span>&nbsp;<span class="op" id="1341149">=</span>&nbsp;<span class="ident" id="1341151">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341162">switch</span>&nbsp;<span class="op" id="1341169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341172">case</span>&nbsp;<span class="ident" id="1341177">n</span>&nbsp;<span class="op" id="1341179">&lt;</span>&nbsp;<span class="num" id="1341181">0</span>&nbsp;<span class="op" id="1341183">||</span>&nbsp;<span class="ident" id="1341186">n</span>&nbsp;<span class="op" id="1341188">&gt;</span>&nbsp;<span class="ident" id="1341190">b</span><span class="op" id="1341191">.</span><span class="ident" id="1341192">Len</span><span class="op" id="1341195">(</span><span class="op" id="1341196">)</span><span class="op" id="1341197">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1341201">panic</span><span class="op" id="1341206">(</span><span class="string" id="1341207">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1341246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341249">case</span>&nbsp;<span class="ident" id="1341254">n</span>&nbsp;<span class="op" id="1341256">==</span>&nbsp;<span class="num" id="1341259">0</span><span class="op" id="1341260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341264">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341289">b</span><span class="op" id="1341290">.</span><span class="ident" id="1341291">off</span>&nbsp;<span class="op" id="1341295">=</span>&nbsp;<span class="num" id="1341297">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341300">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341303">b</span><span class="op" id="1341304">.</span><span class="ident" id="1341305">buf</span>&nbsp;<span class="op" id="1341309">=</span>&nbsp;<span class="ident" id="1341311">b</span><span class="op" id="1341312">.</span><span class="ident" id="1341313">buf</span><span class="op" id="1341316">[</span><span class="num" id="1341317">0</span>&nbsp;<span class="op" id="1341319">:</span>&nbsp;<span class="ident" id="1341321">b</span><span class="op" id="1341322">.</span><span class="ident" id="1341323">off</span><span class="op" id="1341326">+</span><span class="ident" id="1341327">n</span><span class="op" id="1341328">]</span><br>
<span class="lineno"></span><span class="op" id="1341330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1341333">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1341382">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1341425">func</span>&nbsp;<span class="op" id="1341430">(</span><span class="ident" id="1341431">b</span>&nbsp;<span class="op" id="1341433">*</span><span class="ident" id="1341434">Buffer</span><span class="op" id="1341440">)</span>&nbsp;<span class="ident" id="1341442">Reset</span><span class="op" id="1341447">(</span><span class="op" id="1341448">)</span>&nbsp;<span class="op" id="1341450">{</span>&nbsp;<span class="ident" id="1341452">b</span><span class="op" id="1341453">.</span><span class="ident" id="1341454">Truncate</span><span class="op" id="1341462">(</span><span class="num" id="1341463">0</span><span class="op" id="1341464">)</span>&nbsp;<span class="op" id="1341466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1341469">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1341531">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1341586">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1341646">func</span>&nbsp;<span class="op" id="1341651">(</span><span class="ident" id="1341652">b</span>&nbsp;<span class="op" id="1341654">*</span><span class="ident" id="1341655">Buffer</span><span class="op" id="1341661">)</span>&nbsp;<span class="ident" id="1341663">grow</span><span class="op" id="1341667">(</span><span class="ident" id="1341668">n</span>&nbsp;<span class="builtintype" id="1341670">int</span><span class="op" id="1341673">)</span>&nbsp;<span class="builtintype" id="1341675">int</span>&nbsp;<span class="op" id="1341679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341682">m</span>&nbsp;<span class="op" id="1341684">:=</span>&nbsp;<span class="ident" id="1341687">b</span><span class="op" id="1341688">.</span><span class="ident" id="1341689">Len</span><span class="op" id="1341692">(</span><span class="op" id="1341693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341696">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341744">if</span>&nbsp;<span class="ident" id="1341747">m</span>&nbsp;<span class="op" id="1341749">==</span>&nbsp;<span class="num" id="1341752">0</span>&nbsp;<span class="op" id="1341754">&amp;&amp;</span>&nbsp;<span class="ident" id="1341757">b</span><span class="op" id="1341758">.</span><span class="ident" id="1341759">off</span>&nbsp;<span class="op" id="1341763">!=</span>&nbsp;<span class="num" id="1341766">0</span>&nbsp;<span class="op" id="1341768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341772">b</span><span class="op" id="1341773">.</span><span class="ident" id="1341774">Truncate</span><span class="op" id="1341782">(</span><span class="num" id="1341783">0</span><span class="op" id="1341784">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341790">if</span>&nbsp;<span class="builtinfunc" id="1341793">len</span><span class="op" id="1341796">(</span><span class="ident" id="1341797">b</span><span class="op" id="1341798">.</span><span class="ident" id="1341799">buf</span><span class="op" id="1341802">)</span><span class="op" id="1341803">+</span><span class="ident" id="1341804">n</span>&nbsp;<span class="op" id="1341806">&gt;</span>&nbsp;<span class="builtinfunc" id="1341808">cap</span><span class="op" id="1341811">(</span><span class="ident" id="1341812">b</span><span class="op" id="1341813">.</span><span class="ident" id="1341814">buf</span><span class="op" id="1341817">)</span>&nbsp;<span class="op" id="1341819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341823">var</span>&nbsp;<span class="ident" id="1341827">buf</span>&nbsp;<span class="op" id="1341831">[</span><span class="op" id="1341832">]</span><span class="builtintype" id="1341833">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341840">if</span>&nbsp;<span class="ident" id="1341843">b</span><span class="op" id="1341844">.</span><span class="ident" id="1341845">buf</span>&nbsp;<span class="op" id="1341849">==</span>&nbsp;<span class="ident" id="1341852">nil</span>&nbsp;<span class="op" id="1341856">&amp;&amp;</span>&nbsp;<span class="ident" id="1341859">n</span>&nbsp;<span class="op" id="1341861">&lt;=</span>&nbsp;<span class="builtinfunc" id="1341864">len</span><span class="op" id="1341867">(</span><span class="ident" id="1341868">b</span><span class="op" id="1341869">.</span><span class="ident" id="1341870">bootstrap</span><span class="op" id="1341879">)</span>&nbsp;<span class="op" id="1341881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341886">buf</span>&nbsp;<span class="op" id="1341890">=</span>&nbsp;<span class="ident" id="1341892">b</span><span class="op" id="1341893">.</span><span class="ident" id="1341894">bootstrap</span><span class="op" id="1341903">[</span><span class="num" id="1341904">0</span><span class="op" id="1341905">:</span><span class="op" id="1341906">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341910">}</span>&nbsp;<span class="keyword" id="1341912">else</span>&nbsp;<span class="keyword" id="1341917">if</span>&nbsp;<span class="ident" id="1341920">m</span><span class="op" id="1341921">+</span><span class="ident" id="1341922">n</span>&nbsp;<span class="op" id="1341924">&lt;=</span>&nbsp;<span class="builtinfunc" id="1341927">cap</span><span class="op" id="1341930">(</span><span class="ident" id="1341931">b</span><span class="op" id="1341932">.</span><span class="ident" id="1341933">buf</span><span class="op" id="1341936">)</span><span class="op" id="1341937">/</span><span class="num" id="1341938">2</span>&nbsp;<span class="op" id="1341940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341945">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342004">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342062">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342117">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1342157">copy</span><span class="op" id="1342161">(</span><span class="ident" id="1342162">b</span><span class="op" id="1342163">.</span><span class="ident" id="1342164">buf</span><span class="op" id="1342167">[</span><span class="op" id="1342168">:</span><span class="op" id="1342169">]</span><span class="op" id="1342170">,</span>&nbsp;<span class="ident" id="1342172">b</span><span class="op" id="1342173">.</span><span class="ident" id="1342174">buf</span><span class="op" id="1342177">[</span><span class="ident" id="1342178">b</span><span class="op" id="1342179">.</span><span class="ident" id="1342180">off</span><span class="op" id="1342183">:</span><span class="op" id="1342184">]</span><span class="op" id="1342185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342190">buf</span>&nbsp;<span class="op" id="1342194">=</span>&nbsp;<span class="ident" id="1342196">b</span><span class="op" id="1342197">.</span><span class="ident" id="1342198">buf</span><span class="op" id="1342201">[</span><span class="op" id="1342202">:</span><span class="ident" id="1342203">m</span><span class="op" id="1342204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342208">}</span>&nbsp;<span class="keyword" id="1342210">else</span>&nbsp;<span class="op" id="1342215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342220">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342252">buf</span>&nbsp;<span class="op" id="1342256">=</span>&nbsp;<span class="ident" id="1342258">makeSlice</span><span class="op" id="1342267">(</span><span class="num" id="1342268">2</span><span class="op" id="1342269">*</span><span class="builtinfunc" id="1342270">cap</span><span class="op" id="1342273">(</span><span class="ident" id="1342274">b</span><span class="op" id="1342275">.</span><span class="ident" id="1342276">buf</span><span class="op" id="1342279">)</span>&nbsp;<span class="op" id="1342281">+</span>&nbsp;<span class="ident" id="1342283">n</span><span class="op" id="1342284">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1342289">copy</span><span class="op" id="1342293">(</span><span class="ident" id="1342294">buf</span><span class="op" id="1342297">,</span>&nbsp;<span class="ident" id="1342299">b</span><span class="op" id="1342300">.</span><span class="ident" id="1342301">buf</span><span class="op" id="1342304">[</span><span class="ident" id="1342305">b</span><span class="op" id="1342306">.</span><span class="ident" id="1342307">off</span><span class="op" id="1342310">:</span><span class="op" id="1342311">]</span><span class="op" id="1342312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342320">b</span><span class="op" id="1342321">.</span><span class="ident" id="1342322">buf</span>&nbsp;<span class="op" id="1342326">=</span>&nbsp;<span class="ident" id="1342328">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342334">b</span><span class="op" id="1342335">.</span><span class="ident" id="1342336">off</span>&nbsp;<span class="op" id="1342340">=</span>&nbsp;<span class="num" id="1342342">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342345">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342348">b</span><span class="op" id="1342349">.</span><span class="ident" id="1342350">buf</span>&nbsp;<span class="op" id="1342354">=</span>&nbsp;<span class="ident" id="1342356">b</span><span class="op" id="1342357">.</span><span class="ident" id="1342358">buf</span><span class="op" id="1342361">[</span><span class="num" id="1342362">0</span>&nbsp;<span class="op" id="1342364">:</span>&nbsp;<span class="ident" id="1342366">b</span><span class="op" id="1342367">.</span><span class="ident" id="1342368">off</span><span class="op" id="1342371">+</span><span class="ident" id="1342372">m</span><span class="op" id="1342373">+</span><span class="ident" id="1342374">n</span><span class="op" id="1342375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342378">return</span>&nbsp;<span class="ident" id="1342385">b</span><span class="op" id="1342386">.</span><span class="ident" id="1342387">off</span>&nbsp;<span class="op" id="1342391">+</span>&nbsp;<span class="ident" id="1342393">m</span><br>
<span class="lineno"></span><span class="op" id="1342395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342398">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1342472">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1342546">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1342584">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1342622">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1342682">func</span>&nbsp;<span class="op" id="1342687">(</span><span class="ident" id="1342688">b</span>&nbsp;<span class="op" id="1342690">*</span><span class="ident" id="1342691">Buffer</span><span class="op" id="1342697">)</span>&nbsp;<span class="ident" id="1342699">Grow</span><span class="op" id="1342703">(</span><span class="ident" id="1342704">n</span>&nbsp;<span class="builtintype" id="1342706">int</span><span class="op" id="1342709">)</span>&nbsp;<span class="op" id="1342711">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342714">if</span>&nbsp;<span class="ident" id="1342717">n</span>&nbsp;<span class="op" id="1342719">&lt;</span>&nbsp;<span class="num" id="1342721">0</span>&nbsp;<span class="op" id="1342723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1342727">panic</span><span class="op" id="1342732">(</span><span class="string" id="1342733">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1342768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342774">m</span>&nbsp;<span class="op" id="1342776">:=</span>&nbsp;<span class="ident" id="1342779">b</span><span class="op" id="1342780">.</span><span class="ident" id="1342781">grow</span><span class="op" id="1342785">(</span><span class="ident" id="1342786">n</span><span class="op" id="1342787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342790">b</span><span class="op" id="1342791">.</span><span class="ident" id="1342792">buf</span>&nbsp;<span class="op" id="1342796">=</span>&nbsp;<span class="ident" id="1342798">b</span><span class="op" id="1342799">.</span><span class="ident" id="1342800">buf</span><span class="op" id="1342803">[</span><span class="num" id="1342804">0</span><span class="op" id="1342805">:</span><span class="ident" id="1342806">m</span><span class="op" id="1342807">]</span><br>
<span class="lineno">120</span><span class="op" id="1342809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342812">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1342884">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1342960">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1343024">func</span>&nbsp;<span class="op" id="1343029">(</span><span class="ident" id="1343030">b</span>&nbsp;<span class="op" id="1343032">*</span><span class="ident" id="1343033">Buffer</span><span class="op" id="1343039">)</span>&nbsp;<span class="ident" id="1343041">Write</span><span class="op" id="1343046">(</span><span class="ident" id="1343047">p</span>&nbsp;<span class="op" id="1343049">[</span><span class="op" id="1343050">]</span><span class="builtintype" id="1343051">byte</span><span class="op" id="1343055">)</span>&nbsp;<span class="op" id="1343057">(</span><span class="ident" id="1343058">n</span>&nbsp;<span class="builtintype" id="1343060">int</span><span class="op" id="1343063">,</span>&nbsp;<span class="ident" id="1343065">err</span>&nbsp;<span class="builtintype" id="1343069">error</span><span class="op" id="1343074">)</span>&nbsp;<span class="op" id="1343076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343079">b</span><span class="op" id="1343080">.</span><span class="ident" id="1343081">lastRead</span>&nbsp;<span class="op" id="1343090">=</span>&nbsp;<span class="ident" id="1343092">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343103">m</span>&nbsp;<span class="op" id="1343105">:=</span>&nbsp;<span class="ident" id="1343108">b</span><span class="op" id="1343109">.</span><span class="ident" id="1343110">grow</span><span class="op" id="1343114">(</span><span class="builtinfunc" id="1343115">len</span><span class="op" id="1343118">(</span><span class="ident" id="1343119">p</span><span class="op" id="1343120">)</span><span class="op" id="1343121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343124">return</span>&nbsp;<span class="builtinfunc" id="1343131">copy</span><span class="op" id="1343135">(</span><span class="ident" id="1343136">b</span><span class="op" id="1343137">.</span><span class="ident" id="1343138">buf</span><span class="op" id="1343141">[</span><span class="ident" id="1343142">m</span><span class="op" id="1343143">:</span><span class="op" id="1343144">]</span><span class="op" id="1343145">,</span>&nbsp;<span class="ident" id="1343147">p</span><span class="op" id="1343148">)</span><span class="op" id="1343149">,</span>&nbsp;<span class="ident" id="1343151">nil</span><br>
<span class="lineno"></span><span class="op" id="1343155">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1343158">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1343236">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1343312">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1343382">func</span>&nbsp;<span class="op" id="1343387">(</span><span class="ident" id="1343388">b</span>&nbsp;<span class="op" id="1343390">*</span><span class="ident" id="1343391">Buffer</span><span class="op" id="1343397">)</span>&nbsp;<span class="ident" id="1343399">WriteString</span><span class="op" id="1343410">(</span><span class="ident" id="1343411">s</span>&nbsp;<span class="builtintype" id="1343413">string</span><span class="op" id="1343419">)</span>&nbsp;<span class="op" id="1343421">(</span><span class="ident" id="1343422">n</span>&nbsp;<span class="builtintype" id="1343424">int</span><span class="op" id="1343427">,</span>&nbsp;<span class="ident" id="1343429">err</span>&nbsp;<span class="builtintype" id="1343433">error</span><span class="op" id="1343438">)</span>&nbsp;<span class="op" id="1343440">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343443">b</span><span class="op" id="1343444">.</span><span class="ident" id="1343445">lastRead</span>&nbsp;<span class="op" id="1343454">=</span>&nbsp;<span class="ident" id="1343456">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343467">m</span>&nbsp;<span class="op" id="1343469">:=</span>&nbsp;<span class="ident" id="1343472">b</span><span class="op" id="1343473">.</span><span class="ident" id="1343474">grow</span><span class="op" id="1343478">(</span><span class="builtinfunc" id="1343479">len</span><span class="op" id="1343482">(</span><span class="ident" id="1343483">s</span><span class="op" id="1343484">)</span><span class="op" id="1343485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343488">return</span>&nbsp;<span class="builtinfunc" id="1343495">copy</span><span class="op" id="1343499">(</span><span class="ident" id="1343500">b</span><span class="op" id="1343501">.</span><span class="ident" id="1343502">buf</span><span class="op" id="1343505">[</span><span class="ident" id="1343506">m</span><span class="op" id="1343507">:</span><span class="op" id="1343508">]</span><span class="op" id="1343509">,</span>&nbsp;<span class="ident" id="1343511">s</span><span class="op" id="1343512">)</span><span class="op" id="1343513">,</span>&nbsp;<span class="ident" id="1343515">nil</span><br>
<span class="lineno"></span><span class="op" id="1343519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1343522">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1343584">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1343661">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1343735">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1343757">const</span>&nbsp;<span class="ident" id="1343763">MinRead</span>&nbsp;<span class="op" id="1343771">=</span>&nbsp;<span class="num" id="1343773">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1343778">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1343856">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1343933">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1344009">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1344076">func</span>&nbsp;<span class="op" id="1344081">(</span><span class="ident" id="1344082">b</span>&nbsp;<span class="op" id="1344084">*</span><span class="ident" id="1344085">Buffer</span><span class="op" id="1344091">)</span>&nbsp;<span class="ident" id="1344093">ReadFrom</span><span class="op" id="1344101">(</span><span class="ident" id="1344102">r</span>&nbsp;<span class="ident" id="1344104">io</span><span class="op" id="1344106">.</span><span class="ident" id="1344107">Reader</span><span class="op" id="1344113">)</span>&nbsp;<span class="op" id="1344115">(</span><span class="ident" id="1344116">n</span>&nbsp;<span class="ident" id="1344118">int64</span><span class="op" id="1344123">,</span>&nbsp;<span class="ident" id="1344125">err</span>&nbsp;<span class="builtintype" id="1344129">error</span><span class="op" id="1344134">)</span>&nbsp;<span class="op" id="1344136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344139">b</span><span class="op" id="1344140">.</span><span class="ident" id="1344141">lastRead</span>&nbsp;<span class="op" id="1344150">=</span>&nbsp;<span class="ident" id="1344152">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1344163">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344211">if</span>&nbsp;<span class="ident" id="1344214">b</span><span class="op" id="1344215">.</span><span class="ident" id="1344216">off</span>&nbsp;<span class="op" id="1344220">&gt;=</span>&nbsp;<span class="builtinfunc" id="1344223">len</span><span class="op" id="1344226">(</span><span class="ident" id="1344227">b</span><span class="op" id="1344228">.</span><span class="ident" id="1344229">buf</span><span class="op" id="1344232">)</span>&nbsp;<span class="op" id="1344234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344238">b</span><span class="op" id="1344239">.</span><span class="ident" id="1344240">Truncate</span><span class="op" id="1344248">(</span><span class="num" id="1344249">0</span><span class="op" id="1344250">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344256">for</span>&nbsp;<span class="op" id="1344260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344264">if</span>&nbsp;<span class="ident" id="1344267">free</span>&nbsp;<span class="op" id="1344272">:=</span>&nbsp;<span class="builtinfunc" id="1344275">cap</span><span class="op" id="1344278">(</span><span class="ident" id="1344279">b</span><span class="op" id="1344280">.</span><span class="ident" id="1344281">buf</span><span class="op" id="1344284">)</span>&nbsp;<span class="op" id="1344286">-</span>&nbsp;<span class="builtinfunc" id="1344288">len</span><span class="op" id="1344291">(</span><span class="ident" id="1344292">b</span><span class="op" id="1344293">.</span><span class="ident" id="1344294">buf</span><span class="op" id="1344297">)</span><span class="op" id="1344298">;</span>&nbsp;<span class="ident" id="1344300">free</span>&nbsp;<span class="op" id="1344305">&lt;</span>&nbsp;<span class="ident" id="1344307">MinRead</span>&nbsp;<span class="op" id="1344315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1344320">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344350">newBuf</span>&nbsp;<span class="op" id="1344357">:=</span>&nbsp;<span class="ident" id="1344360">b</span><span class="op" id="1344361">.</span><span class="ident" id="1344362">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344369">if</span>&nbsp;<span class="ident" id="1344372">b</span><span class="op" id="1344373">.</span><span class="ident" id="1344374">off</span><span class="op" id="1344377">+</span><span class="ident" id="1344378">free</span>&nbsp;<span class="op" id="1344383">&lt;</span>&nbsp;<span class="ident" id="1344385">MinRead</span>&nbsp;<span class="op" id="1344393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1344399">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1344450">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344480">newBuf</span>&nbsp;<span class="op" id="1344487">=</span>&nbsp;<span class="ident" id="1344489">makeSlice</span><span class="op" id="1344498">(</span><span class="num" id="1344499">2</span><span class="op" id="1344500">*</span><span class="builtinfunc" id="1344501">cap</span><span class="op" id="1344504">(</span><span class="ident" id="1344505">b</span><span class="op" id="1344506">.</span><span class="ident" id="1344507">buf</span><span class="op" id="1344510">)</span>&nbsp;<span class="op" id="1344512">+</span>&nbsp;<span class="ident" id="1344514">MinRead</span><span class="op" id="1344521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344526">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1344531">copy</span><span class="op" id="1344535">(</span><span class="ident" id="1344536">newBuf</span><span class="op" id="1344542">,</span>&nbsp;<span class="ident" id="1344544">b</span><span class="op" id="1344545">.</span><span class="ident" id="1344546">buf</span><span class="op" id="1344549">[</span><span class="ident" id="1344550">b</span><span class="op" id="1344551">.</span><span class="ident" id="1344552">off</span><span class="op" id="1344555">:</span><span class="op" id="1344556">]</span><span class="op" id="1344557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344562">b</span><span class="op" id="1344563">.</span><span class="ident" id="1344564">buf</span>&nbsp;<span class="op" id="1344568">=</span>&nbsp;<span class="ident" id="1344570">newBuf</span><span class="op" id="1344576">[</span><span class="op" id="1344577">:</span><span class="builtinfunc" id="1344578">len</span><span class="op" id="1344581">(</span><span class="ident" id="1344582">b</span><span class="op" id="1344583">.</span><span class="ident" id="1344584">buf</span><span class="op" id="1344587">)</span><span class="op" id="1344588">-</span><span class="ident" id="1344589">b</span><span class="op" id="1344590">.</span><span class="ident" id="1344591">off</span><span class="op" id="1344594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344599">b</span><span class="op" id="1344600">.</span><span class="ident" id="1344601">off</span>&nbsp;<span class="op" id="1344605">=</span>&nbsp;<span class="num" id="1344607">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344615">m</span><span class="op" id="1344616">,</span>&nbsp;<span class="ident" id="1344618">e</span>&nbsp;<span class="op" id="1344620">:=</span>&nbsp;<span class="ident" id="1344623">r</span><span class="op" id="1344624">.</span><span class="ident" id="1344625">Read</span><span class="op" id="1344629">(</span><span class="ident" id="1344630">b</span><span class="op" id="1344631">.</span><span class="ident" id="1344632">buf</span><span class="op" id="1344635">[</span><span class="builtinfunc" id="1344636">len</span><span class="op" id="1344639">(</span><span class="ident" id="1344640">b</span><span class="op" id="1344641">.</span><span class="ident" id="1344642">buf</span><span class="op" id="1344645">)</span><span class="op" id="1344646">:</span><span class="builtinfunc" id="1344647">cap</span><span class="op" id="1344650">(</span><span class="ident" id="1344651">b</span><span class="op" id="1344652">.</span><span class="ident" id="1344653">buf</span><span class="op" id="1344656">)</span><span class="op" id="1344657">]</span><span class="op" id="1344658">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344662">b</span><span class="op" id="1344663">.</span><span class="ident" id="1344664">buf</span>&nbsp;<span class="op" id="1344668">=</span>&nbsp;<span class="ident" id="1344670">b</span><span class="op" id="1344671">.</span><span class="ident" id="1344672">buf</span><span class="op" id="1344675">[</span><span class="num" id="1344676">0</span>&nbsp;<span class="op" id="1344678">:</span>&nbsp;<span class="builtinfunc" id="1344680">len</span><span class="op" id="1344683">(</span><span class="ident" id="1344684">b</span><span class="op" id="1344685">.</span><span class="ident" id="1344686">buf</span><span class="op" id="1344689">)</span><span class="op" id="1344690">+</span><span class="ident" id="1344691">m</span><span class="op" id="1344692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344696">n</span>&nbsp;<span class="op" id="1344698">+=</span>&nbsp;<span class="ident" id="1344701">int64</span><span class="op" id="1344706">(</span><span class="ident" id="1344707">m</span><span class="op" id="1344708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344712">if</span>&nbsp;<span class="ident" id="1344715">e</span>&nbsp;<span class="op" id="1344717">==</span>&nbsp;<span class="ident" id="1344720">io</span><span class="op" id="1344722">.</span><span class="ident" id="1344723">EOF</span>&nbsp;<span class="op" id="1344727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344732">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344740">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344744">if</span>&nbsp;<span class="ident" id="1344747">e</span>&nbsp;<span class="op" id="1344749">!=</span>&nbsp;<span class="ident" id="1344752">nil</span>&nbsp;<span class="op" id="1344756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344761">return</span>&nbsp;<span class="ident" id="1344768">n</span><span class="op" id="1344769">,</span>&nbsp;<span class="ident" id="1344771">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344781">return</span>&nbsp;<span class="ident" id="1344788">n</span><span class="op" id="1344789">,</span>&nbsp;<span class="ident" id="1344791">nil</span>&nbsp;<span class="comment" id="1344795">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1344835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344838">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1344915">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1344936">func</span>&nbsp;<span class="ident" id="1344941">makeSlice</span><span class="op" id="1344950">(</span><span class="ident" id="1344951">n</span>&nbsp;<span class="builtintype" id="1344953">int</span><span class="op" id="1344956">)</span>&nbsp;<span class="op" id="1344958">[</span><span class="op" id="1344959">]</span><span class="builtintype" id="1344960">byte</span>&nbsp;<span class="op" id="1344965">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1344968">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345011">defer</span>&nbsp;<span class="keyword" id="1345017">func</span><span class="op" id="1345021">(</span><span class="op" id="1345022">)</span>&nbsp;<span class="op" id="1345024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345028">if</span>&nbsp;<span class="builtinfunc" id="1345031">recover</span><span class="op" id="1345038">(</span><span class="op" id="1345039">)</span>&nbsp;<span class="op" id="1345041">!=</span>&nbsp;<span class="ident" id="1345044">nil</span>&nbsp;<span class="op" id="1345048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1345053">panic</span><span class="op" id="1345058">(</span><span class="ident" id="1345059">ErrTooLarge</span><span class="op" id="1345070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345074">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345077">}</span><span class="op" id="1345078">(</span><span class="op" id="1345079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345082">return</span>&nbsp;<span class="builtinfunc" id="1345089">make</span><span class="op" id="1345093">(</span><span class="op" id="1345094">[</span><span class="op" id="1345095">]</span><span class="builtintype" id="1345096">byte</span><span class="op" id="1345100">,</span>&nbsp;<span class="ident" id="1345102">n</span><span class="op" id="1345103">)</span><br>
<span class="lineno"></span><span class="op" id="1345105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345108">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1345184">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1345261">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1345331">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1345381">func</span>&nbsp;<span class="op" id="1345386">(</span><span class="ident" id="1345387">b</span>&nbsp;<span class="op" id="1345389">*</span><span class="ident" id="1345390">Buffer</span><span class="op" id="1345396">)</span>&nbsp;<span class="ident" id="1345398">WriteTo</span><span class="op" id="1345405">(</span><span class="ident" id="1345406">w</span>&nbsp;<span class="ident" id="1345408">io</span><span class="op" id="1345410">.</span><span class="ident" id="1345411">Writer</span><span class="op" id="1345417">)</span>&nbsp;<span class="op" id="1345419">(</span><span class="ident" id="1345420">n</span>&nbsp;<span class="ident" id="1345422">int64</span><span class="op" id="1345427">,</span>&nbsp;<span class="ident" id="1345429">err</span>&nbsp;<span class="builtintype" id="1345433">error</span><span class="op" id="1345438">)</span>&nbsp;<span class="op" id="1345440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345443">b</span><span class="op" id="1345444">.</span><span class="ident" id="1345445">lastRead</span>&nbsp;<span class="op" id="1345454">=</span>&nbsp;<span class="ident" id="1345456">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345467">if</span>&nbsp;<span class="ident" id="1345470">b</span><span class="op" id="1345471">.</span><span class="ident" id="1345472">off</span>&nbsp;<span class="op" id="1345476">&lt;</span>&nbsp;<span class="builtinfunc" id="1345478">len</span><span class="op" id="1345481">(</span><span class="ident" id="1345482">b</span><span class="op" id="1345483">.</span><span class="ident" id="1345484">buf</span><span class="op" id="1345487">)</span>&nbsp;<span class="op" id="1345489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345493">nBytes</span>&nbsp;<span class="op" id="1345500">:=</span>&nbsp;<span class="ident" id="1345503">b</span><span class="op" id="1345504">.</span><span class="ident" id="1345505">Len</span><span class="op" id="1345508">(</span><span class="op" id="1345509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345513">m</span><span class="op" id="1345514">,</span>&nbsp;<span class="ident" id="1345516">e</span>&nbsp;<span class="op" id="1345518">:=</span>&nbsp;<span class="ident" id="1345521">w</span><span class="op" id="1345522">.</span><span class="ident" id="1345523">Write</span><span class="op" id="1345528">(</span><span class="ident" id="1345529">b</span><span class="op" id="1345530">.</span><span class="ident" id="1345531">buf</span><span class="op" id="1345534">[</span><span class="ident" id="1345535">b</span><span class="op" id="1345536">.</span><span class="ident" id="1345537">off</span><span class="op" id="1345540">:</span><span class="op" id="1345541">]</span><span class="op" id="1345542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345546">if</span>&nbsp;<span class="ident" id="1345549">m</span>&nbsp;<span class="op" id="1345551">&gt;</span>&nbsp;<span class="ident" id="1345553">nBytes</span>&nbsp;<span class="op" id="1345560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1345565">panic</span><span class="op" id="1345570">(</span><span class="string" id="1345571">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1345614">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345622">b</span><span class="op" id="1345623">.</span><span class="ident" id="1345624">off</span>&nbsp;<span class="op" id="1345628">+=</span>&nbsp;<span class="ident" id="1345631">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345635">n</span>&nbsp;<span class="op" id="1345637">=</span>&nbsp;<span class="ident" id="1345639">int64</span><span class="op" id="1345644">(</span><span class="ident" id="1345645">m</span><span class="op" id="1345646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345650">if</span>&nbsp;<span class="ident" id="1345653">e</span>&nbsp;<span class="op" id="1345655">!=</span>&nbsp;<span class="ident" id="1345658">nil</span>&nbsp;<span class="op" id="1345662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345667">return</span>&nbsp;<span class="ident" id="1345674">n</span><span class="op" id="1345675">,</span>&nbsp;<span class="ident" id="1345677">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345685">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345743">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345774">if</span>&nbsp;<span class="ident" id="1345777">m</span>&nbsp;<span class="op" id="1345779">!=</span>&nbsp;<span class="ident" id="1345782">nBytes</span>&nbsp;<span class="op" id="1345789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345794">return</span>&nbsp;<span class="ident" id="1345801">n</span><span class="op" id="1345802">,</span>&nbsp;<span class="ident" id="1345804">io</span><span class="op" id="1345806">.</span><span class="ident" id="1345807">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345829">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345861">b</span><span class="op" id="1345862">.</span><span class="ident" id="1345863">Truncate</span><span class="op" id="1345871">(</span><span class="num" id="1345872">0</span><span class="op" id="1345873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345876">return</span><br>
<span class="lineno">220</span><span class="op" id="1345883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345886">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1345963">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1346040">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1346113">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1346129">func</span>&nbsp;<span class="op" id="1346134">(</span><span class="ident" id="1346135">b</span>&nbsp;<span class="op" id="1346137">*</span><span class="ident" id="1346138">Buffer</span><span class="op" id="1346144">)</span>&nbsp;<span class="ident" id="1346146">WriteByte</span><span class="op" id="1346155">(</span><span class="ident" id="1346156">c</span>&nbsp;<span class="builtintype" id="1346158">byte</span><span class="op" id="1346162">)</span>&nbsp;<span class="builtintype" id="1346164">error</span>&nbsp;<span class="op" id="1346170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346173">b</span><span class="op" id="1346174">.</span><span class="ident" id="1346175">lastRead</span>&nbsp;<span class="op" id="1346184">=</span>&nbsp;<span class="ident" id="1346186">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346197">m</span>&nbsp;<span class="op" id="1346199">:=</span>&nbsp;<span class="ident" id="1346202">b</span><span class="op" id="1346203">.</span><span class="ident" id="1346204">grow</span><span class="op" id="1346208">(</span><span class="num" id="1346209">1</span><span class="op" id="1346210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346213">b</span><span class="op" id="1346214">.</span><span class="ident" id="1346215">buf</span><span class="op" id="1346218">[</span><span class="ident" id="1346219">m</span><span class="op" id="1346220">]</span>&nbsp;<span class="op" id="1346222">=</span>&nbsp;<span class="ident" id="1346224">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346227">return</span>&nbsp;<span class="ident" id="1346234">nil</span><br>
<span class="lineno"></span><span class="op" id="1346238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346241">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1346312">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1346385">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1346463">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1346530">func</span>&nbsp;<span class="op" id="1346535">(</span><span class="ident" id="1346536">b</span>&nbsp;<span class="op" id="1346538">*</span><span class="ident" id="1346539">Buffer</span><span class="op" id="1346545">)</span>&nbsp;<span class="ident" id="1346547">WriteRune</span><span class="op" id="1346556">(</span><span class="ident" id="1346557">r</span>&nbsp;<span class="builtintype" id="1346559">rune</span><span class="op" id="1346563">)</span>&nbsp;<span class="op" id="1346565">(</span><span class="ident" id="1346566">n</span>&nbsp;<span class="builtintype" id="1346568">int</span><span class="op" id="1346571">,</span>&nbsp;<span class="ident" id="1346573">err</span>&nbsp;<span class="builtintype" id="1346577">error</span><span class="op" id="1346582">)</span>&nbsp;<span class="op" id="1346584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346587">if</span>&nbsp;<span class="ident" id="1346590">r</span>&nbsp;<span class="op" id="1346592">&lt;</span>&nbsp;<span class="ident" id="1346594">utf8</span><span class="op" id="1346598">.</span><span class="ident" id="1346599">RuneSelf</span>&nbsp;<span class="op" id="1346608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346612">b</span><span class="op" id="1346613">.</span><span class="ident" id="1346614">WriteByte</span><span class="op" id="1346623">(</span><span class="builtintype" id="1346624">byte</span><span class="op" id="1346628">(</span><span class="ident" id="1346629">r</span><span class="op" id="1346630">)</span><span class="op" id="1346631">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346635">return</span>&nbsp;<span class="num" id="1346642">1</span><span class="op" id="1346643">,</span>&nbsp;<span class="ident" id="1346645">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346653">n</span>&nbsp;<span class="op" id="1346655">=</span>&nbsp;<span class="ident" id="1346657">utf8</span><span class="op" id="1346661">.</span><span class="ident" id="1346662">EncodeRune</span><span class="op" id="1346672">(</span><span class="ident" id="1346673">b</span><span class="op" id="1346674">.</span><span class="ident" id="1346675">runeBytes</span><span class="op" id="1346684">[</span><span class="num" id="1346685">0</span><span class="op" id="1346686">:</span><span class="op" id="1346687">]</span><span class="op" id="1346688">,</span>&nbsp;<span class="ident" id="1346690">r</span><span class="op" id="1346691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346694">b</span><span class="op" id="1346695">.</span><span class="ident" id="1346696">Write</span><span class="op" id="1346701">(</span><span class="ident" id="1346702">b</span><span class="op" id="1346703">.</span><span class="ident" id="1346704">runeBytes</span><span class="op" id="1346713">[</span><span class="num" id="1346714">0</span><span class="op" id="1346715">:</span><span class="ident" id="1346716">n</span><span class="op" id="1346717">]</span><span class="op" id="1346718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346721">return</span>&nbsp;<span class="ident" id="1346728">n</span><span class="op" id="1346729">,</span>&nbsp;<span class="ident" id="1346731">nil</span><br>
<span class="lineno">245</span><span class="op" id="1346735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346738">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1346810">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1346882">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1346954">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1346978">func</span>&nbsp;<span class="op" id="1346983">(</span><span class="ident" id="1346984">b</span>&nbsp;<span class="op" id="1346986">*</span><span class="ident" id="1346987">Buffer</span><span class="op" id="1346993">)</span>&nbsp;<span class="ident" id="1346995">Read</span><span class="op" id="1346999">(</span><span class="ident" id="1347000">p</span>&nbsp;<span class="op" id="1347002">[</span><span class="op" id="1347003">]</span><span class="builtintype" id="1347004">byte</span><span class="op" id="1347008">)</span>&nbsp;<span class="op" id="1347010">(</span><span class="ident" id="1347011">n</span>&nbsp;<span class="builtintype" id="1347013">int</span><span class="op" id="1347016">,</span>&nbsp;<span class="ident" id="1347018">err</span>&nbsp;<span class="builtintype" id="1347022">error</span><span class="op" id="1347027">)</span>&nbsp;<span class="op" id="1347029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347032">b</span><span class="op" id="1347033">.</span><span class="ident" id="1347034">lastRead</span>&nbsp;<span class="op" id="1347043">=</span>&nbsp;<span class="ident" id="1347045">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347056">if</span>&nbsp;<span class="ident" id="1347059">b</span><span class="op" id="1347060">.</span><span class="ident" id="1347061">off</span>&nbsp;<span class="op" id="1347065">&gt;=</span>&nbsp;<span class="builtinfunc" id="1347068">len</span><span class="op" id="1347071">(</span><span class="ident" id="1347072">b</span><span class="op" id="1347073">.</span><span class="ident" id="1347074">buf</span><span class="op" id="1347077">)</span>&nbsp;<span class="op" id="1347079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347083">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347129">b</span><span class="op" id="1347130">.</span><span class="ident" id="1347131">Truncate</span><span class="op" id="1347139">(</span><span class="num" id="1347140">0</span><span class="op" id="1347141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347145">if</span>&nbsp;<span class="builtinfunc" id="1347148">len</span><span class="op" id="1347151">(</span><span class="ident" id="1347152">p</span><span class="op" id="1347153">)</span>&nbsp;<span class="op" id="1347155">==</span>&nbsp;<span class="num" id="1347158">0</span>&nbsp;<span class="op" id="1347160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347165">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347178">return</span>&nbsp;<span class="num" id="1347185">0</span><span class="op" id="1347186">,</span>&nbsp;<span class="ident" id="1347188">io</span><span class="op" id="1347190">.</span><span class="ident" id="1347191">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347199">n</span>&nbsp;<span class="op" id="1347201">=</span>&nbsp;<span class="builtinfunc" id="1347203">copy</span><span class="op" id="1347207">(</span><span class="ident" id="1347208">p</span><span class="op" id="1347209">,</span>&nbsp;<span class="ident" id="1347211">b</span><span class="op" id="1347212">.</span><span class="ident" id="1347213">buf</span><span class="op" id="1347216">[</span><span class="ident" id="1347217">b</span><span class="op" id="1347218">.</span><span class="ident" id="1347219">off</span><span class="op" id="1347222">:</span><span class="op" id="1347223">]</span><span class="op" id="1347224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347227">b</span><span class="op" id="1347228">.</span><span class="ident" id="1347229">off</span>&nbsp;<span class="op" id="1347233">+=</span>&nbsp;<span class="ident" id="1347236">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347239">if</span>&nbsp;<span class="ident" id="1347242">n</span>&nbsp;<span class="op" id="1347244">&gt;</span>&nbsp;<span class="num" id="1347246">0</span>&nbsp;<span class="op" id="1347248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347252">b</span><span class="op" id="1347253">.</span><span class="ident" id="1347254">lastRead</span>&nbsp;<span class="op" id="1347263">=</span>&nbsp;<span class="ident" id="1347265">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347276">return</span><br>
<span class="lineno"></span><span class="op" id="1347283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1347286">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1347355">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1347422">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1347504">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1347578">func</span>&nbsp;<span class="op" id="1347583">(</span><span class="ident" id="1347584">b</span>&nbsp;<span class="op" id="1347586">*</span><span class="ident" id="1347587">Buffer</span><span class="op" id="1347593">)</span>&nbsp;<span class="ident" id="1347595">Next</span><span class="op" id="1347599">(</span><span class="ident" id="1347600">n</span>&nbsp;<span class="builtintype" id="1347602">int</span><span class="op" id="1347605">)</span>&nbsp;<span class="op" id="1347607">[</span><span class="op" id="1347608">]</span><span class="builtintype" id="1347609">byte</span>&nbsp;<span class="op" id="1347614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347617">b</span><span class="op" id="1347618">.</span><span class="ident" id="1347619">lastRead</span>&nbsp;<span class="op" id="1347628">=</span>&nbsp;<span class="ident" id="1347630">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347641">m</span>&nbsp;<span class="op" id="1347643">:=</span>&nbsp;<span class="ident" id="1347646">b</span><span class="op" id="1347647">.</span><span class="ident" id="1347648">Len</span><span class="op" id="1347651">(</span><span class="op" id="1347652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347655">if</span>&nbsp;<span class="ident" id="1347658">n</span>&nbsp;<span class="op" id="1347660">&gt;</span>&nbsp;<span class="ident" id="1347662">m</span>&nbsp;<span class="op" id="1347664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347668">n</span>&nbsp;<span class="op" id="1347670">=</span>&nbsp;<span class="ident" id="1347672">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347678">data</span>&nbsp;<span class="op" id="1347683">:=</span>&nbsp;<span class="ident" id="1347686">b</span><span class="op" id="1347687">.</span><span class="ident" id="1347688">buf</span><span class="op" id="1347691">[</span><span class="ident" id="1347692">b</span><span class="op" id="1347693">.</span><span class="ident" id="1347694">off</span>&nbsp;<span class="op" id="1347698">:</span>&nbsp;<span class="ident" id="1347700">b</span><span class="op" id="1347701">.</span><span class="ident" id="1347702">off</span><span class="op" id="1347705">+</span><span class="ident" id="1347706">n</span><span class="op" id="1347707">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347710">b</span><span class="op" id="1347711">.</span><span class="ident" id="1347712">off</span>&nbsp;<span class="op" id="1347716">+=</span>&nbsp;<span class="ident" id="1347719">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347722">if</span>&nbsp;<span class="ident" id="1347725">n</span>&nbsp;<span class="op" id="1347727">&gt;</span>&nbsp;<span class="num" id="1347729">0</span>&nbsp;<span class="op" id="1347731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347735">b</span><span class="op" id="1347736">.</span><span class="ident" id="1347737">lastRead</span>&nbsp;<span class="op" id="1347746">=</span>&nbsp;<span class="ident" id="1347748">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347759">return</span>&nbsp;<span class="ident" id="1347766">data</span><br>
<span class="lineno">285</span><span class="op" id="1347771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1347774">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1347835">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1347888">func</span>&nbsp;<span class="op" id="1347893">(</span><span class="ident" id="1347894">b</span>&nbsp;<span class="op" id="1347896">*</span><span class="ident" id="1347897">Buffer</span><span class="op" id="1347903">)</span>&nbsp;<span class="ident" id="1347905">ReadByte</span><span class="op" id="1347913">(</span><span class="op" id="1347914">)</span>&nbsp;<span class="op" id="1347916">(</span><span class="ident" id="1347917">c</span>&nbsp;<span class="builtintype" id="1347919">byte</span><span class="op" id="1347923">,</span>&nbsp;<span class="ident" id="1347925">err</span>&nbsp;<span class="builtintype" id="1347929">error</span><span class="op" id="1347934">)</span>&nbsp;<span class="op" id="1347936">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347939">b</span><span class="op" id="1347940">.</span><span class="ident" id="1347941">lastRead</span>&nbsp;<span class="op" id="1347950">=</span>&nbsp;<span class="ident" id="1347952">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347963">if</span>&nbsp;<span class="ident" id="1347966">b</span><span class="op" id="1347967">.</span><span class="ident" id="1347968">off</span>&nbsp;<span class="op" id="1347972">&gt;=</span>&nbsp;<span class="builtinfunc" id="1347975">len</span><span class="op" id="1347978">(</span><span class="ident" id="1347979">b</span><span class="op" id="1347980">.</span><span class="ident" id="1347981">buf</span><span class="op" id="1347984">)</span>&nbsp;<span class="op" id="1347986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347990">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348036">b</span><span class="op" id="1348037">.</span><span class="ident" id="1348038">Truncate</span><span class="op" id="1348046">(</span><span class="num" id="1348047">0</span><span class="op" id="1348048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348052">return</span>&nbsp;<span class="num" id="1348059">0</span><span class="op" id="1348060">,</span>&nbsp;<span class="ident" id="1348062">io</span><span class="op" id="1348064">.</span><span class="ident" id="1348065">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348073">c</span>&nbsp;<span class="op" id="1348075">=</span>&nbsp;<span class="ident" id="1348077">b</span><span class="op" id="1348078">.</span><span class="ident" id="1348079">buf</span><span class="op" id="1348082">[</span><span class="ident" id="1348083">b</span><span class="op" id="1348084">.</span><span class="ident" id="1348085">off</span><span class="op" id="1348088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348091">b</span><span class="op" id="1348092">.</span><span class="ident" id="1348093">off</span><span class="op" id="1348096">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348100">b</span><span class="op" id="1348101">.</span><span class="ident" id="1348102">lastRead</span>&nbsp;<span class="op" id="1348111">=</span>&nbsp;<span class="ident" id="1348113">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348121">return</span>&nbsp;<span class="ident" id="1348128">c</span><span class="op" id="1348129">,</span>&nbsp;<span class="ident" id="1348131">nil</span><br>
<span class="lineno">300</span><span class="op" id="1348135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348138">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1348191">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1348230">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1348290">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1348342">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1348386">func</span>&nbsp;<span class="op" id="1348391">(</span><span class="ident" id="1348392">b</span>&nbsp;<span class="op" id="1348394">*</span><span class="ident" id="1348395">Buffer</span><span class="op" id="1348401">)</span>&nbsp;<span class="ident" id="1348403">ReadRune</span><span class="op" id="1348411">(</span><span class="op" id="1348412">)</span>&nbsp;<span class="op" id="1348414">(</span><span class="ident" id="1348415">r</span>&nbsp;<span class="builtintype" id="1348417">rune</span><span class="op" id="1348421">,</span>&nbsp;<span class="ident" id="1348423">size</span>&nbsp;<span class="builtintype" id="1348428">int</span><span class="op" id="1348431">,</span>&nbsp;<span class="ident" id="1348433">err</span>&nbsp;<span class="builtintype" id="1348437">error</span><span class="op" id="1348442">)</span>&nbsp;<span class="op" id="1348444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348447">b</span><span class="op" id="1348448">.</span><span class="ident" id="1348449">lastRead</span>&nbsp;<span class="op" id="1348458">=</span>&nbsp;<span class="ident" id="1348460">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348471">if</span>&nbsp;<span class="ident" id="1348474">b</span><span class="op" id="1348475">.</span><span class="ident" id="1348476">off</span>&nbsp;<span class="op" id="1348480">&gt;=</span>&nbsp;<span class="builtinfunc" id="1348483">len</span><span class="op" id="1348486">(</span><span class="ident" id="1348487">b</span><span class="op" id="1348488">.</span><span class="ident" id="1348489">buf</span><span class="op" id="1348492">)</span>&nbsp;<span class="op" id="1348494">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348498">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348544">b</span><span class="op" id="1348545">.</span><span class="ident" id="1348546">Truncate</span><span class="op" id="1348554">(</span><span class="num" id="1348555">0</span><span class="op" id="1348556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348560">return</span>&nbsp;<span class="num" id="1348567">0</span><span class="op" id="1348568">,</span>&nbsp;<span class="num" id="1348570">0</span><span class="op" id="1348571">,</span>&nbsp;<span class="ident" id="1348573">io</span><span class="op" id="1348575">.</span><span class="ident" id="1348576">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348584">b</span><span class="op" id="1348585">.</span><span class="ident" id="1348586">lastRead</span>&nbsp;<span class="op" id="1348595">=</span>&nbsp;<span class="ident" id="1348597">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348609">c</span>&nbsp;<span class="op" id="1348611">:=</span>&nbsp;<span class="ident" id="1348614">b</span><span class="op" id="1348615">.</span><span class="ident" id="1348616">buf</span><span class="op" id="1348619">[</span><span class="ident" id="1348620">b</span><span class="op" id="1348621">.</span><span class="ident" id="1348622">off</span><span class="op" id="1348625">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348628">if</span>&nbsp;<span class="ident" id="1348631">c</span>&nbsp;<span class="op" id="1348633">&lt;</span>&nbsp;<span class="ident" id="1348635">utf8</span><span class="op" id="1348639">.</span><span class="ident" id="1348640">RuneSelf</span>&nbsp;<span class="op" id="1348649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348653">b</span><span class="op" id="1348654">.</span><span class="ident" id="1348655">off</span><span class="op" id="1348658">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348663">return</span>&nbsp;<span class="builtintype" id="1348670">rune</span><span class="op" id="1348674">(</span><span class="ident" id="1348675">c</span><span class="op" id="1348676">)</span><span class="op" id="1348677">,</span>&nbsp;<span class="num" id="1348679">1</span><span class="op" id="1348680">,</span>&nbsp;<span class="ident" id="1348682">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348687">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348690">r</span><span class="op" id="1348691">,</span>&nbsp;<span class="ident" id="1348693">n</span>&nbsp;<span class="op" id="1348695">:=</span>&nbsp;<span class="ident" id="1348698">utf8</span><span class="op" id="1348702">.</span><span class="ident" id="1348703">DecodeRune</span><span class="op" id="1348713">(</span><span class="ident" id="1348714">b</span><span class="op" id="1348715">.</span><span class="ident" id="1348716">buf</span><span class="op" id="1348719">[</span><span class="ident" id="1348720">b</span><span class="op" id="1348721">.</span><span class="ident" id="1348722">off</span><span class="op" id="1348725">:</span><span class="op" id="1348726">]</span><span class="op" id="1348727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348730">b</span><span class="op" id="1348731">.</span><span class="ident" id="1348732">off</span>&nbsp;<span class="op" id="1348736">+=</span>&nbsp;<span class="ident" id="1348739">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348742">return</span>&nbsp;<span class="ident" id="1348749">r</span><span class="op" id="1348750">,</span>&nbsp;<span class="ident" id="1348752">n</span><span class="op" id="1348753">,</span>&nbsp;<span class="ident" id="1348755">nil</span><br>
<span class="lineno"></span><span class="op" id="1348759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1348762">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1348820">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1348884">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1348949">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1349016">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1349045">func</span>&nbsp;<span class="op" id="1349050">(</span><span class="ident" id="1349051">b</span>&nbsp;<span class="op" id="1349053">*</span><span class="ident" id="1349054">Buffer</span><span class="op" id="1349060">)</span>&nbsp;<span class="ident" id="1349062">UnreadRune</span><span class="op" id="1349072">(</span><span class="op" id="1349073">)</span>&nbsp;<span class="builtintype" id="1349075">error</span>&nbsp;<span class="op" id="1349081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349084">if</span>&nbsp;<span class="ident" id="1349087">b</span><span class="op" id="1349088">.</span><span class="ident" id="1349089">lastRead</span>&nbsp;<span class="op" id="1349098">!=</span>&nbsp;<span class="ident" id="1349101">opReadRune</span>&nbsp;<span class="op" id="1349112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349116">return</span>&nbsp;<span class="ident" id="1349123">errors</span><span class="op" id="1349129">.</span><span class="ident" id="1349130">New</span><span class="op" id="1349133">(</span><span class="string" id="1349134">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1349197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349203">b</span><span class="op" id="1349204">.</span><span class="ident" id="1349205">lastRead</span>&nbsp;<span class="op" id="1349214">=</span>&nbsp;<span class="ident" id="1349216">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349227">if</span>&nbsp;<span class="ident" id="1349230">b</span><span class="op" id="1349231">.</span><span class="ident" id="1349232">off</span>&nbsp;<span class="op" id="1349236">&gt;</span>&nbsp;<span class="num" id="1349238">0</span>&nbsp;<span class="op" id="1349240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349244">_</span><span class="op" id="1349245">,</span>&nbsp;<span class="ident" id="1349247">n</span>&nbsp;<span class="op" id="1349249">:=</span>&nbsp;<span class="ident" id="1349252">utf8</span><span class="op" id="1349256">.</span><span class="ident" id="1349257">DecodeLastRune</span><span class="op" id="1349271">(</span><span class="ident" id="1349272">b</span><span class="op" id="1349273">.</span><span class="ident" id="1349274">buf</span><span class="op" id="1349277">[</span><span class="num" id="1349278">0</span><span class="op" id="1349279">:</span><span class="ident" id="1349280">b</span><span class="op" id="1349281">.</span><span class="ident" id="1349282">off</span><span class="op" id="1349285">]</span><span class="op" id="1349286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349290">b</span><span class="op" id="1349291">.</span><span class="ident" id="1349292">off</span>&nbsp;<span class="op" id="1349296">-=</span>&nbsp;<span class="ident" id="1349299">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349305">return</span>&nbsp;<span class="ident" id="1349312">nil</span><br>
<span class="lineno">340</span><span class="op" id="1349316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349319">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1349383">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1349457">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1349478">func</span>&nbsp;<span class="op" id="1349483">(</span><span class="ident" id="1349484">b</span>&nbsp;<span class="op" id="1349486">*</span><span class="ident" id="1349487">Buffer</span><span class="op" id="1349493">)</span>&nbsp;<span class="ident" id="1349495">UnreadByte</span><span class="op" id="1349505">(</span><span class="op" id="1349506">)</span>&nbsp;<span class="builtintype" id="1349508">error</span>&nbsp;<span class="op" id="1349514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349517">if</span>&nbsp;<span class="ident" id="1349520">b</span><span class="op" id="1349521">.</span><span class="ident" id="1349522">lastRead</span>&nbsp;<span class="op" id="1349531">!=</span>&nbsp;<span class="ident" id="1349534">opReadRune</span>&nbsp;<span class="op" id="1349545">&amp;&amp;</span>&nbsp;<span class="ident" id="1349548">b</span><span class="op" id="1349549">.</span><span class="ident" id="1349550">lastRead</span>&nbsp;<span class="op" id="1349559">!=</span>&nbsp;<span class="ident" id="1349562">opRead</span>&nbsp;<span class="op" id="1349569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349573">return</span>&nbsp;<span class="ident" id="1349580">errors</span><span class="op" id="1349586">.</span><span class="ident" id="1349587">New</span><span class="op" id="1349590">(</span><span class="string" id="1349591">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1349652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349658">b</span><span class="op" id="1349659">.</span><span class="ident" id="1349660">lastRead</span>&nbsp;<span class="op" id="1349669">=</span>&nbsp;<span class="ident" id="1349671">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349682">if</span>&nbsp;<span class="ident" id="1349685">b</span><span class="op" id="1349686">.</span><span class="ident" id="1349687">off</span>&nbsp;<span class="op" id="1349691">&gt;</span>&nbsp;<span class="num" id="1349693">0</span>&nbsp;<span class="op" id="1349695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349699">b</span><span class="op" id="1349700">.</span><span class="ident" id="1349701">off</span><span class="op" id="1349704">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349711">return</span>&nbsp;<span class="ident" id="1349718">nil</span><br>
<span class="lineno"></span><span class="op" id="1349722">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1349725">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1349794">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1349870">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1349934">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1350016">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1350097">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1350107">func</span>&nbsp;<span class="op" id="1350112">(</span><span class="ident" id="1350113">b</span>&nbsp;<span class="op" id="1350115">*</span><span class="ident" id="1350116">Buffer</span><span class="op" id="1350122">)</span>&nbsp;<span class="ident" id="1350124">ReadBytes</span><span class="op" id="1350133">(</span><span class="ident" id="1350134">delim</span>&nbsp;<span class="builtintype" id="1350140">byte</span><span class="op" id="1350144">)</span>&nbsp;<span class="op" id="1350146">(</span><span class="ident" id="1350147">line</span>&nbsp;<span class="op" id="1350152">[</span><span class="op" id="1350153">]</span><span class="builtintype" id="1350154">byte</span><span class="op" id="1350158">,</span>&nbsp;<span class="ident" id="1350160">err</span>&nbsp;<span class="builtintype" id="1350164">error</span><span class="op" id="1350169">)</span>&nbsp;<span class="op" id="1350171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350174">slice</span><span class="op" id="1350179">,</span>&nbsp;<span class="ident" id="1350181">err</span>&nbsp;<span class="op" id="1350185">:=</span>&nbsp;<span class="ident" id="1350188">b</span><span class="op" id="1350189">.</span><span class="ident" id="1350190">readSlice</span><span class="op" id="1350199">(</span><span class="ident" id="1350200">delim</span><span class="op" id="1350205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350208">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350267">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350302">line</span>&nbsp;<span class="op" id="1350307">=</span>&nbsp;<span class="builtinfunc" id="1350309">append</span><span class="op" id="1350315">(</span><span class="ident" id="1350316">line</span><span class="op" id="1350320">,</span>&nbsp;<span class="ident" id="1350322">slice</span><span class="op" id="1350327">...</span><span class="op" id="1350330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350333">return</span><br>
<span class="lineno"></span><span class="op" id="1350340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1350343">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1350423">func</span>&nbsp;<span class="op" id="1350428">(</span><span class="ident" id="1350429">b</span>&nbsp;<span class="op" id="1350431">*</span><span class="ident" id="1350432">Buffer</span><span class="op" id="1350438">)</span>&nbsp;<span class="ident" id="1350440">readSlice</span><span class="op" id="1350449">(</span><span class="ident" id="1350450">delim</span>&nbsp;<span class="builtintype" id="1350456">byte</span><span class="op" id="1350460">)</span>&nbsp;<span class="op" id="1350462">(</span><span class="ident" id="1350463">line</span>&nbsp;<span class="op" id="1350468">[</span><span class="op" id="1350469">]</span><span class="builtintype" id="1350470">byte</span><span class="op" id="1350474">,</span>&nbsp;<span class="ident" id="1350476">err</span>&nbsp;<span class="builtintype" id="1350480">error</span><span class="op" id="1350485">)</span>&nbsp;<span class="op" id="1350487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350490">i</span>&nbsp;<span class="op" id="1350492">:=</span>&nbsp;<span class="ident" id="1350495">IndexByte</span><span class="op" id="1350504">(</span><span class="ident" id="1350505">b</span><span class="op" id="1350506">.</span><span class="ident" id="1350507">buf</span><span class="op" id="1350510">[</span><span class="ident" id="1350511">b</span><span class="op" id="1350512">.</span><span class="ident" id="1350513">off</span><span class="op" id="1350516">:</span><span class="op" id="1350517">]</span><span class="op" id="1350518">,</span>&nbsp;<span class="ident" id="1350520">delim</span><span class="op" id="1350525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350528">end</span>&nbsp;<span class="op" id="1350532">:=</span>&nbsp;<span class="ident" id="1350535">b</span><span class="op" id="1350536">.</span><span class="ident" id="1350537">off</span>&nbsp;<span class="op" id="1350541">+</span>&nbsp;<span class="ident" id="1350543">i</span>&nbsp;<span class="op" id="1350545">+</span>&nbsp;<span class="num" id="1350547">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350550">if</span>&nbsp;<span class="ident" id="1350553">i</span>&nbsp;<span class="op" id="1350555">&lt;</span>&nbsp;<span class="num" id="1350557">0</span>&nbsp;<span class="op" id="1350559">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350563">end</span>&nbsp;<span class="op" id="1350567">=</span>&nbsp;<span class="builtinfunc" id="1350569">len</span><span class="op" id="1350572">(</span><span class="ident" id="1350573">b</span><span class="op" id="1350574">.</span><span class="ident" id="1350575">buf</span><span class="op" id="1350578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350582">err</span>&nbsp;<span class="op" id="1350586">=</span>&nbsp;<span class="ident" id="1350588">io</span><span class="op" id="1350590">.</span><span class="ident" id="1350591">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350599">line</span>&nbsp;<span class="op" id="1350604">=</span>&nbsp;<span class="ident" id="1350606">b</span><span class="op" id="1350607">.</span><span class="ident" id="1350608">buf</span><span class="op" id="1350611">[</span><span class="ident" id="1350612">b</span><span class="op" id="1350613">.</span><span class="ident" id="1350614">off</span><span class="op" id="1350617">:</span><span class="ident" id="1350618">end</span><span class="op" id="1350621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350624">b</span><span class="op" id="1350625">.</span><span class="ident" id="1350626">off</span>&nbsp;<span class="op" id="1350630">=</span>&nbsp;<span class="ident" id="1350632">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350637">b</span><span class="op" id="1350638">.</span><span class="ident" id="1350639">lastRead</span>&nbsp;<span class="op" id="1350648">=</span>&nbsp;<span class="ident" id="1350650">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350658">return</span>&nbsp;<span class="ident" id="1350665">line</span><span class="op" id="1350669">,</span>&nbsp;<span class="ident" id="1350671">err</span><br>
<span class="lineno"></span><span class="op" id="1350675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1350678">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1350748">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1350825">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1350890">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1350972">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1351051">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1351064">func</span>&nbsp;<span class="op" id="1351069">(</span><span class="ident" id="1351070">b</span>&nbsp;<span class="op" id="1351072">*</span><span class="ident" id="1351073">Buffer</span><span class="op" id="1351079">)</span>&nbsp;<span class="ident" id="1351081">ReadString</span><span class="op" id="1351091">(</span><span class="ident" id="1351092">delim</span>&nbsp;<span class="builtintype" id="1351098">byte</span><span class="op" id="1351102">)</span>&nbsp;<span class="op" id="1351104">(</span><span class="ident" id="1351105">line</span>&nbsp;<span class="builtintype" id="1351110">string</span><span class="op" id="1351116">,</span>&nbsp;<span class="ident" id="1351118">err</span>&nbsp;<span class="builtintype" id="1351122">error</span><span class="op" id="1351127">)</span>&nbsp;<span class="op" id="1351129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351132">slice</span><span class="op" id="1351137">,</span>&nbsp;<span class="ident" id="1351139">err</span>&nbsp;<span class="op" id="1351143">:=</span>&nbsp;<span class="ident" id="1351146">b</span><span class="op" id="1351147">.</span><span class="ident" id="1351148">readSlice</span><span class="op" id="1351157">(</span><span class="ident" id="1351158">delim</span><span class="op" id="1351163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351166">return</span>&nbsp;<span class="builtintype" id="1351173">string</span><span class="op" id="1351179">(</span><span class="ident" id="1351180">slice</span><span class="op" id="1351185">)</span><span class="op" id="1351186">,</span>&nbsp;<span class="ident" id="1351188">err</span><br>
<span class="lineno"></span><span class="op" id="1351192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1351195">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1351270">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1351346">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1351419">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1351481">//</span><br>
<span class="lineno">400</span><span class="comment" id="1351484">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1351555">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1351593">func</span>&nbsp;<span class="ident" id="1351598">NewBuffer</span><span class="op" id="1351607">(</span><span class="ident" id="1351608">buf</span>&nbsp;<span class="op" id="1351612">[</span><span class="op" id="1351613">]</span><span class="builtintype" id="1351614">byte</span><span class="op" id="1351618">)</span>&nbsp;<span class="op" id="1351620">*</span><span class="ident" id="1351621">Buffer</span>&nbsp;<span class="op" id="1351628">{</span>&nbsp;<span class="keyword" id="1351630">return</span>&nbsp;<span class="op" id="1351637">&amp;</span><span class="ident" id="1351638">Buffer</span><span class="op" id="1351644">{</span><span class="ident" id="1351645">buf</span><span class="op" id="1351648">:</span>&nbsp;<span class="ident" id="1351650">buf</span><span class="op" id="1351653">}</span>&nbsp;<span class="op" id="1351655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1351658">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1351736">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1351812">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1351823">//</span><br>
<span class="lineno"></span><span class="comment" id="1351826">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1351897">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1351935">func</span>&nbsp;<span class="ident" id="1351940">NewBufferString</span><span class="op" id="1351955">(</span><span class="ident" id="1351956">s</span>&nbsp;<span class="builtintype" id="1351958">string</span><span class="op" id="1351964">)</span>&nbsp;<span class="op" id="1351966">*</span><span class="ident" id="1351967">Buffer</span>&nbsp;<span class="op" id="1351974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351977">return</span>&nbsp;<span class="op" id="1351984">&amp;</span><span class="ident" id="1351985">Buffer</span><span class="op" id="1351991">{</span><span class="ident" id="1351992">buf</span><span class="op" id="1351995">:</span>&nbsp;<span class="op" id="1351997">[</span><span class="op" id="1351998">]</span><span class="builtintype" id="1351999">byte</span><span class="op" id="1352003">(</span><span class="ident" id="1352004">s</span><span class="op" id="1352005">)</span><span class="op" id="1352006">}</span><br>
<span class="lineno"></span><span class="op" id="1352008">}</span>
</div>
</body>
</html>
