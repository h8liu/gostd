<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4590464">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4590519">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4590573">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4590624">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4590674">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4590751">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4590831">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4590843">package</span>&nbsp;<span class="ident" id="4590851">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4590858">import</span>&nbsp;<span class="op" id="4590865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4590868">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4590877">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4590883">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4590893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4590896">const</span>&nbsp;<span class="op" id="4590902">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590905">maxCodeLen</span>&nbsp;<span class="op" id="4590916">=</span>&nbsp;<span class="num" id="4590918">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590924">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590955">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590966">=</span>&nbsp;<span class="num" id="4590968">32768</span>&nbsp;<span class="comment" id="4590974">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4590999">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591060">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4591069">=</span>&nbsp;<span class="num" id="4591071">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591076">maxDist</span>&nbsp;&nbsp;<span class="op" id="4591085">=</span>&nbsp;<span class="num" id="4591087">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591091">numCodes</span>&nbsp;<span class="op" id="4591100">=</span>&nbsp;<span class="num" id="4591102">19</span>&nbsp;<span class="comment" id="4591105">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4591145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4591148">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4591228">type</span>&nbsp;<span class="ident" id="4591233">CorruptInputError</span>&nbsp;<span class="ident" id="4591251">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4591258">func</span>&nbsp;<span class="op" id="4591263">(</span><span class="ident" id="4591264">e</span>&nbsp;<span class="ident" id="4591266">CorruptInputError</span><span class="op" id="4591283">)</span>&nbsp;<span class="ident" id="4591285">Error</span><span class="op" id="4591290">(</span><span class="op" id="4591291">)</span>&nbsp;<span class="builtintype" id="4591293">string</span>&nbsp;<span class="op" id="4591300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4591303">return</span>&nbsp;<span class="string" id="4591310">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4591348">+</span>&nbsp;<span class="ident" id="4591350">strconv</span><span class="op" id="4591357">.</span><span class="ident" id="4591358">FormatInt</span><span class="op" id="4591367">(</span><span class="ident" id="4591368">int64</span><span class="op" id="4591373">(</span><span class="ident" id="4591374">e</span><span class="op" id="4591375">)</span><span class="op" id="4591376">,</span>&nbsp;<span class="num" id="4591378">10</span><span class="op" id="4591380">)</span><br>
<span class="lineno"></span><span class="op" id="4591382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4591385">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4591448">type</span>&nbsp;<span class="ident" id="4591453">InternalError</span>&nbsp;<span class="builtintype" id="4591467">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4591475">func</span>&nbsp;<span class="op" id="4591480">(</span><span class="ident" id="4591481">e</span>&nbsp;<span class="ident" id="4591483">InternalError</span><span class="op" id="4591496">)</span>&nbsp;<span class="ident" id="4591498">Error</span><span class="op" id="4591503">(</span><span class="op" id="4591504">)</span>&nbsp;<span class="builtintype" id="4591506">string</span>&nbsp;<span class="op" id="4591513">{</span>&nbsp;<span class="keyword" id="4591515">return</span>&nbsp;<span class="string" id="4591522">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4591548">+</span>&nbsp;<span class="builtintype" id="4591550">string</span><span class="op" id="4591556">(</span><span class="ident" id="4591557">e</span><span class="op" id="4591558">)</span>&nbsp;<span class="op" id="4591560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4591563">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4591628">type</span>&nbsp;<span class="ident" id="4591633">ReadError</span>&nbsp;<span class="keyword" id="4591643">struct</span>&nbsp;<span class="op" id="4591650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591653">Offset</span>&nbsp;<span class="ident" id="4591660">int64</span>&nbsp;<span class="comment" id="4591666">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591703">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4591710">error</span>&nbsp;<span class="comment" id="4591716">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4591753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4591756">func</span>&nbsp;<span class="op" id="4591761">(</span><span class="ident" id="4591762">e</span>&nbsp;<span class="op" id="4591764">*</span><span class="ident" id="4591765">ReadError</span><span class="op" id="4591774">)</span>&nbsp;<span class="ident" id="4591776">Error</span><span class="op" id="4591781">(</span><span class="op" id="4591782">)</span>&nbsp;<span class="builtintype" id="4591784">string</span>&nbsp;<span class="op" id="4591791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4591794">return</span>&nbsp;<span class="string" id="4591801">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4591832">+</span>&nbsp;<span class="ident" id="4591834">strconv</span><span class="op" id="4591841">.</span><span class="ident" id="4591842">FormatInt</span><span class="op" id="4591851">(</span><span class="ident" id="4591852">e</span><span class="op" id="4591853">.</span><span class="ident" id="4591854">Offset</span><span class="op" id="4591860">,</span>&nbsp;<span class="num" id="4591862">10</span><span class="op" id="4591864">)</span>&nbsp;<span class="op" id="4591866">+</span>&nbsp;<span class="string" id="4591868">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4591873">+</span>&nbsp;<span class="ident" id="4591875">e</span><span class="op" id="4591876">.</span><span class="ident" id="4591877">Err</span><span class="op" id="4591880">.</span><span class="ident" id="4591881">Error</span><span class="op" id="4591886">(</span><span class="op" id="4591887">)</span><br>
<span class="lineno"></span><span class="op" id="4591889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4591892">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4591959">type</span>&nbsp;<span class="ident" id="4591964">WriteError</span>&nbsp;<span class="keyword" id="4591975">struct</span>&nbsp;<span class="op" id="4591982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591985">Offset</span>&nbsp;<span class="ident" id="4591992">int64</span>&nbsp;<span class="comment" id="4591998">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592035">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4592042">error</span>&nbsp;<span class="comment" id="4592048">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4592086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4592089">func</span>&nbsp;<span class="op" id="4592094">(</span><span class="ident" id="4592095">e</span>&nbsp;<span class="op" id="4592097">*</span><span class="ident" id="4592098">WriteError</span><span class="op" id="4592108">)</span>&nbsp;<span class="ident" id="4592110">Error</span><span class="op" id="4592115">(</span><span class="op" id="4592116">)</span>&nbsp;<span class="builtintype" id="4592118">string</span>&nbsp;<span class="op" id="4592125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4592128">return</span>&nbsp;<span class="string" id="4592135">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4592167">+</span>&nbsp;<span class="ident" id="4592169">strconv</span><span class="op" id="4592176">.</span><span class="ident" id="4592177">FormatInt</span><span class="op" id="4592186">(</span><span class="ident" id="4592187">e</span><span class="op" id="4592188">.</span><span class="ident" id="4592189">Offset</span><span class="op" id="4592195">,</span>&nbsp;<span class="num" id="4592197">10</span><span class="op" id="4592199">)</span>&nbsp;<span class="op" id="4592201">+</span>&nbsp;<span class="string" id="4592203">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4592208">+</span>&nbsp;<span class="ident" id="4592210">e</span><span class="op" id="4592211">.</span><span class="ident" id="4592212">Err</span><span class="op" id="4592215">.</span><span class="ident" id="4592216">Error</span><span class="op" id="4592221">(</span><span class="op" id="4592222">)</span><br>
<span class="lineno"></span><span class="op" id="4592224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592227">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4592301">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4592376">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4592412">type</span>&nbsp;<span class="ident" id="4592417">Resetter</span>&nbsp;<span class="keyword" id="4592426">interface</span>&nbsp;<span class="op" id="4592436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4592439">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4592513">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592558">Reset</span><span class="op" id="4592563">(</span><span class="ident" id="4592564">r</span>&nbsp;<span class="ident" id="4592566">io</span><span class="op" id="4592568">.</span><span class="ident" id="4592569">Reader</span><span class="op" id="4592575">,</span>&nbsp;<span class="ident" id="4592577">dict</span>&nbsp;<span class="op" id="4592582">[</span><span class="op" id="4592583">]</span><span class="builtintype" id="4592584">byte</span><span class="op" id="4592588">)</span>&nbsp;<span class="builtintype" id="4592590">error</span><br>
<span class="lineno"></span><span class="op" id="4592596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592599">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4592672">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4592741">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592802">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4592872">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4592946">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4593016">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4593085">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4593158">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4593230">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4593262">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4593330">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4593402">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4593471">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4593539">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4593559">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4593591">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4593637">const</span>&nbsp;<span class="op" id="4593643">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593646">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4593664">=</span>&nbsp;<span class="num" id="4593666">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593669">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4593687">=</span>&nbsp;<span class="num" id="4593689">1</span>&nbsp;<span class="op" id="4593691">&lt;&lt;</span>&nbsp;<span class="ident" id="4593694">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593712">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4593730">=</span>&nbsp;<span class="num" id="4593732">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593736">huffmanValueShift</span>&nbsp;<span class="op" id="4593754">=</span>&nbsp;<span class="num" id="4593756">4</span><br>
<span class="lineno"></span><span class="op" id="4593758">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4593761">type</span>&nbsp;<span class="ident" id="4593766">huffmanDecoder</span>&nbsp;<span class="keyword" id="4593781">struct</span>&nbsp;<span class="op" id="4593788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593791">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4593800">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593825">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593853">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4593862">[</span><span class="ident" id="4593863">huffmanNumChunks</span><span class="op" id="4593879">]</span><span class="builtintype" id="4593880">uint32</span>&nbsp;<span class="comment" id="4593887">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593917">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4593926">[</span><span class="op" id="4593927">]</span><span class="op" id="4593928">[</span><span class="op" id="4593929">]</span><span class="builtintype" id="4593930">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4593951">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593970">linkMask</span>&nbsp;<span class="builtintype" id="4593979">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4594004">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4594040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4594043">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4594109">func</span>&nbsp;<span class="op" id="4594114">(</span><span class="ident" id="4594115">h</span>&nbsp;<span class="op" id="4594117">*</span><span class="ident" id="4594118">huffmanDecoder</span><span class="op" id="4594132">)</span>&nbsp;<span class="ident" id="4594134">init</span><span class="op" id="4594138">(</span><span class="ident" id="4594139">bits</span>&nbsp;<span class="op" id="4594144">[</span><span class="op" id="4594145">]</span><span class="builtintype" id="4594146">int</span><span class="op" id="4594149">)</span>&nbsp;<span class="builtintype" id="4594151">bool</span>&nbsp;<span class="op" id="4594156">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594159">if</span>&nbsp;<span class="ident" id="4594162">h</span><span class="op" id="4594163">.</span><span class="ident" id="4594164">min</span>&nbsp;<span class="op" id="4594168">!=</span>&nbsp;<span class="num" id="4594171">0</span>&nbsp;<span class="op" id="4594173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594177">*</span><span class="ident" id="4594178">h</span>&nbsp;<span class="op" id="4594180">=</span>&nbsp;<span class="ident" id="4594182">huffmanDecoder</span><span class="op" id="4594196">{</span><span class="op" id="4594197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594204">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594246">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594278">var</span>&nbsp;<span class="ident" id="4594282">count</span>&nbsp;<span class="op" id="4594288">[</span><span class="ident" id="4594289">maxCodeLen</span><span class="op" id="4594299">]</span><span class="builtintype" id="4594300">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594305">var</span>&nbsp;<span class="ident" id="4594309">min</span><span class="op" id="4594312">,</span>&nbsp;<span class="ident" id="4594314">max</span>&nbsp;<span class="builtintype" id="4594318">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594323">for</span>&nbsp;<span class="ident" id="4594327">_</span><span class="op" id="4594328">,</span>&nbsp;<span class="ident" id="4594330">n</span>&nbsp;<span class="op" id="4594332">:=</span>&nbsp;<span class="keyword" id="4594335">range</span>&nbsp;<span class="ident" id="4594341">bits</span>&nbsp;<span class="op" id="4594346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594350">if</span>&nbsp;<span class="ident" id="4594353">n</span>&nbsp;<span class="op" id="4594355">==</span>&nbsp;<span class="num" id="4594358">0</span>&nbsp;<span class="op" id="4594360">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594365">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594380">if</span>&nbsp;<span class="ident" id="4594383">min</span>&nbsp;<span class="op" id="4594387">==</span>&nbsp;<span class="num" id="4594390">0</span>&nbsp;<span class="op" id="4594392">||</span>&nbsp;<span class="ident" id="4594395">n</span>&nbsp;<span class="op" id="4594397">&lt;</span>&nbsp;<span class="ident" id="4594399">min</span>&nbsp;<span class="op" id="4594403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594408">min</span>&nbsp;<span class="op" id="4594412">=</span>&nbsp;<span class="ident" id="4594414">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594418">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594422">if</span>&nbsp;<span class="ident" id="4594425">n</span>&nbsp;<span class="op" id="4594427">&gt;</span>&nbsp;<span class="ident" id="4594429">max</span>&nbsp;<span class="op" id="4594433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594438">max</span>&nbsp;<span class="op" id="4594442">=</span>&nbsp;<span class="ident" id="4594444">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594452">count</span><span class="op" id="4594457">[</span><span class="ident" id="4594458">n</span><span class="op" id="4594459">]</span><span class="op" id="4594460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594464">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594467">if</span>&nbsp;<span class="ident" id="4594470">max</span>&nbsp;<span class="op" id="4594474">==</span>&nbsp;<span class="num" id="4594477">0</span>&nbsp;<span class="op" id="4594479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594483">return</span>&nbsp;<span class="builtintype" id="4594490">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594501">h</span><span class="op" id="4594502">.</span><span class="ident" id="4594503">min</span>&nbsp;<span class="op" id="4594507">=</span>&nbsp;<span class="ident" id="4594509">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594514">var</span>&nbsp;<span class="ident" id="4594518">linkBits</span>&nbsp;<span class="builtintype" id="4594527">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594533">var</span>&nbsp;<span class="ident" id="4594537">numLinks</span>&nbsp;<span class="builtintype" id="4594546">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594551">if</span>&nbsp;<span class="ident" id="4594554">max</span>&nbsp;<span class="op" id="4594558">&gt;</span>&nbsp;<span class="ident" id="4594560">huffmanChunkBits</span>&nbsp;<span class="op" id="4594577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594581">linkBits</span>&nbsp;<span class="op" id="4594590">=</span>&nbsp;<span class="builtintype" id="4594592">uint</span><span class="op" id="4594596">(</span><span class="ident" id="4594597">max</span><span class="op" id="4594600">)</span>&nbsp;<span class="op" id="4594602">-</span>&nbsp;<span class="ident" id="4594604">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594623">numLinks</span>&nbsp;<span class="op" id="4594632">=</span>&nbsp;<span class="num" id="4594634">1</span>&nbsp;<span class="op" id="4594636">&lt;&lt;</span>&nbsp;<span class="ident" id="4594639">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594650">h</span><span class="op" id="4594651">.</span><span class="ident" id="4594652">linkMask</span>&nbsp;<span class="op" id="4594661">=</span>&nbsp;<span class="builtintype" id="4594663">uint32</span><span class="op" id="4594669">(</span><span class="ident" id="4594670">numLinks</span>&nbsp;<span class="op" id="4594679">-</span>&nbsp;<span class="num" id="4594681">1</span><span class="op" id="4594682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594688">code</span>&nbsp;<span class="op" id="4594693">:=</span>&nbsp;<span class="num" id="4594696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594699">var</span>&nbsp;<span class="ident" id="4594703">nextcode</span>&nbsp;<span class="op" id="4594712">[</span><span class="ident" id="4594713">maxCodeLen</span><span class="op" id="4594723">]</span><span class="builtintype" id="4594724">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594729">for</span>&nbsp;<span class="ident" id="4594733">i</span>&nbsp;<span class="op" id="4594735">:=</span>&nbsp;<span class="ident" id="4594738">min</span><span class="op" id="4594741">;</span>&nbsp;<span class="ident" id="4594743">i</span>&nbsp;<span class="op" id="4594745">&lt;=</span>&nbsp;<span class="ident" id="4594748">max</span><span class="op" id="4594751">;</span>&nbsp;<span class="ident" id="4594753">i</span><span class="op" id="4594754">++</span>&nbsp;<span class="op" id="4594757">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594761">if</span>&nbsp;<span class="ident" id="4594764">i</span>&nbsp;<span class="op" id="4594766">==</span>&nbsp;<span class="ident" id="4594769">huffmanChunkBits</span><span class="op" id="4594785">+</span><span class="num" id="4594786">1</span>&nbsp;<span class="op" id="4594788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594793">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594818">link</span>&nbsp;<span class="op" id="4594823">:=</span>&nbsp;<span class="ident" id="4594826">code</span>&nbsp;<span class="op" id="4594831">&gt;&gt;</span>&nbsp;<span class="num" id="4594834">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594839">if</span>&nbsp;<span class="ident" id="4594842">huffmanNumChunks</span>&nbsp;<span class="op" id="4594859">&lt;</span>&nbsp;<span class="ident" id="4594861">link</span>&nbsp;<span class="op" id="4594866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594872">return</span>&nbsp;<span class="builtintype" id="4594879">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594893">h</span><span class="op" id="4594894">.</span><span class="ident" id="4594895">links</span>&nbsp;<span class="op" id="4594901">=</span>&nbsp;<span class="builtinfunc" id="4594903">make</span><span class="op" id="4594907">(</span><span class="op" id="4594908">[</span><span class="op" id="4594909">]</span><span class="op" id="4594910">[</span><span class="op" id="4594911">]</span><span class="builtintype" id="4594912">uint32</span><span class="op" id="4594918">,</span>&nbsp;<span class="ident" id="4594920">huffmanNumChunks</span><span class="op" id="4594936">-</span><span class="ident" id="4594937">link</span><span class="op" id="4594941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594946">for</span>&nbsp;<span class="ident" id="4594950">j</span>&nbsp;<span class="op" id="4594952">:=</span>&nbsp;<span class="builtintype" id="4594955">uint</span><span class="op" id="4594959">(</span><span class="ident" id="4594960">link</span><span class="op" id="4594964">)</span><span class="op" id="4594965">;</span>&nbsp;<span class="ident" id="4594967">j</span>&nbsp;<span class="op" id="4594969">&lt;</span>&nbsp;<span class="ident" id="4594971">huffmanNumChunks</span><span class="op" id="4594987">;</span>&nbsp;<span class="ident" id="4594989">j</span><span class="op" id="4594990">++</span>&nbsp;<span class="op" id="4594993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594999">reverse</span>&nbsp;<span class="op" id="4595007">:=</span>&nbsp;<span class="builtintype" id="4595010">int</span><span class="op" id="4595013">(</span><span class="ident" id="4595014">reverseByte</span><span class="op" id="4595025">[</span><span class="ident" id="4595026">j</span><span class="op" id="4595027">&gt;&gt;</span><span class="num" id="4595029">8</span><span class="op" id="4595030">]</span><span class="op" id="4595031">)</span>&nbsp;<span class="op" id="4595033">|</span>&nbsp;<span class="builtintype" id="4595035">int</span><span class="op" id="4595038">(</span><span class="ident" id="4595039">reverseByte</span><span class="op" id="4595050">[</span><span class="ident" id="4595051">j</span><span class="op" id="4595052">&amp;</span><span class="num" id="4595053">0xff</span><span class="op" id="4595057">]</span><span class="op" id="4595058">)</span><span class="op" id="4595059">&lt;&lt;</span><span class="num" id="4595061">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595067">reverse</span>&nbsp;<span class="op" id="4595075">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4595079">uint</span><span class="op" id="4595083">(</span><span class="num" id="4595084">16</span>&nbsp;<span class="op" id="4595087">-</span>&nbsp;<span class="ident" id="4595089">huffmanChunkBits</span><span class="op" id="4595105">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595111">off</span>&nbsp;<span class="op" id="4595115">:=</span>&nbsp;<span class="ident" id="4595118">j</span>&nbsp;<span class="op" id="4595120">-</span>&nbsp;<span class="builtintype" id="4595122">uint</span><span class="op" id="4595126">(</span><span class="ident" id="4595127">link</span><span class="op" id="4595131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595137">h</span><span class="op" id="4595138">.</span><span class="ident" id="4595139">chunks</span><span class="op" id="4595145">[</span><span class="ident" id="4595146">reverse</span><span class="op" id="4595153">]</span>&nbsp;<span class="op" id="4595155">=</span>&nbsp;<span class="builtintype" id="4595157">uint32</span><span class="op" id="4595163">(</span><span class="ident" id="4595164">off</span><span class="op" id="4595167">&lt;&lt;</span><span class="ident" id="4595169">huffmanValueShift</span>&nbsp;<span class="op" id="4595187">+</span>&nbsp;<span class="builtintype" id="4595189">uint</span><span class="op" id="4595193">(</span><span class="ident" id="4595194">i</span><span class="op" id="4595195">)</span><span class="op" id="4595196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595202">h</span><span class="op" id="4595203">.</span><span class="ident" id="4595204">links</span><span class="op" id="4595209">[</span><span class="ident" id="4595210">off</span><span class="op" id="4595213">]</span>&nbsp;<span class="op" id="4595215">=</span>&nbsp;<span class="builtinfunc" id="4595217">make</span><span class="op" id="4595221">(</span><span class="op" id="4595222">[</span><span class="op" id="4595223">]</span><span class="builtintype" id="4595224">uint32</span><span class="op" id="4595230">,</span>&nbsp;<span class="num" id="4595232">1</span><span class="op" id="4595233">&lt;&lt;</span><span class="ident" id="4595235">linkBits</span><span class="op" id="4595243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595252">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595256">n</span>&nbsp;<span class="op" id="4595258">:=</span>&nbsp;<span class="ident" id="4595261">count</span><span class="op" id="4595266">[</span><span class="ident" id="4595267">i</span><span class="op" id="4595268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595272">nextcode</span><span class="op" id="4595280">[</span><span class="ident" id="4595281">i</span><span class="op" id="4595282">]</span>&nbsp;<span class="op" id="4595284">=</span>&nbsp;<span class="ident" id="4595286">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595293">code</span>&nbsp;<span class="op" id="4595298">+=</span>&nbsp;<span class="ident" id="4595301">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595305">code</span>&nbsp;<span class="op" id="4595310">&lt;&lt;=</span>&nbsp;<span class="num" id="4595314">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595317">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595321">for</span>&nbsp;<span class="ident" id="4595325">i</span><span class="op" id="4595326">,</span>&nbsp;<span class="ident" id="4595328">n</span>&nbsp;<span class="op" id="4595330">:=</span>&nbsp;<span class="keyword" id="4595333">range</span>&nbsp;<span class="ident" id="4595339">bits</span>&nbsp;<span class="op" id="4595344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595348">if</span>&nbsp;<span class="ident" id="4595351">n</span>&nbsp;<span class="op" id="4595353">==</span>&nbsp;<span class="num" id="4595356">0</span>&nbsp;<span class="op" id="4595358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595363">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595374">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595378">code</span>&nbsp;<span class="op" id="4595383">:=</span>&nbsp;<span class="ident" id="4595386">nextcode</span><span class="op" id="4595394">[</span><span class="ident" id="4595395">n</span><span class="op" id="4595396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595400">nextcode</span><span class="op" id="4595408">[</span><span class="ident" id="4595409">n</span><span class="op" id="4595410">]</span><span class="op" id="4595411">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595416">chunk</span>&nbsp;<span class="op" id="4595422">:=</span>&nbsp;<span class="builtintype" id="4595425">uint32</span><span class="op" id="4595431">(</span><span class="ident" id="4595432">i</span><span class="op" id="4595433">&lt;&lt;</span><span class="ident" id="4595435">huffmanValueShift</span>&nbsp;<span class="op" id="4595453">|</span>&nbsp;<span class="ident" id="4595455">n</span><span class="op" id="4595456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595460">reverse</span>&nbsp;<span class="op" id="4595468">:=</span>&nbsp;<span class="builtintype" id="4595471">int</span><span class="op" id="4595474">(</span><span class="ident" id="4595475">reverseByte</span><span class="op" id="4595486">[</span><span class="ident" id="4595487">code</span><span class="op" id="4595491">&gt;&gt;</span><span class="num" id="4595493">8</span><span class="op" id="4595494">]</span><span class="op" id="4595495">)</span>&nbsp;<span class="op" id="4595497">|</span>&nbsp;<span class="builtintype" id="4595499">int</span><span class="op" id="4595502">(</span><span class="ident" id="4595503">reverseByte</span><span class="op" id="4595514">[</span><span class="ident" id="4595515">code</span><span class="op" id="4595519">&amp;</span><span class="num" id="4595520">0xff</span><span class="op" id="4595524">]</span><span class="op" id="4595525">)</span><span class="op" id="4595526">&lt;&lt;</span><span class="num" id="4595528">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595532">reverse</span>&nbsp;<span class="op" id="4595540">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4595544">uint</span><span class="op" id="4595548">(</span><span class="num" id="4595549">16</span>&nbsp;<span class="op" id="4595552">-</span>&nbsp;<span class="ident" id="4595554">n</span><span class="op" id="4595555">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595559">if</span>&nbsp;<span class="ident" id="4595562">n</span>&nbsp;<span class="op" id="4595564">&lt;=</span>&nbsp;<span class="ident" id="4595567">huffmanChunkBits</span>&nbsp;<span class="op" id="4595584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595589">for</span>&nbsp;<span class="ident" id="4595593">off</span>&nbsp;<span class="op" id="4595597">:=</span>&nbsp;<span class="ident" id="4595600">reverse</span><span class="op" id="4595607">;</span>&nbsp;<span class="ident" id="4595609">off</span>&nbsp;<span class="op" id="4595613">&lt;</span>&nbsp;<span class="ident" id="4595615">huffmanNumChunks</span><span class="op" id="4595631">;</span>&nbsp;<span class="ident" id="4595633">off</span>&nbsp;<span class="op" id="4595637">+=</span>&nbsp;<span class="num" id="4595640">1</span>&nbsp;<span class="op" id="4595642">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4595645">uint</span><span class="op" id="4595649">(</span><span class="ident" id="4595650">n</span><span class="op" id="4595651">)</span>&nbsp;<span class="op" id="4595653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595659">h</span><span class="op" id="4595660">.</span><span class="ident" id="4595661">chunks</span><span class="op" id="4595667">[</span><span class="ident" id="4595668">off</span><span class="op" id="4595671">]</span>&nbsp;<span class="op" id="4595673">=</span>&nbsp;<span class="ident" id="4595675">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595688">}</span>&nbsp;<span class="keyword" id="4595690">else</span>&nbsp;<span class="op" id="4595695">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595700">value</span>&nbsp;<span class="op" id="4595706">:=</span>&nbsp;<span class="ident" id="4595709">h</span><span class="op" id="4595710">.</span><span class="ident" id="4595711">chunks</span><span class="op" id="4595717">[</span><span class="ident" id="4595718">reverse</span><span class="op" id="4595725">&amp;</span><span class="op" id="4595726">(</span><span class="ident" id="4595727">huffmanNumChunks</span><span class="op" id="4595743">-</span><span class="num" id="4595744">1</span><span class="op" id="4595745">)</span><span class="op" id="4595746">]</span>&nbsp;<span class="op" id="4595748">&gt;&gt;</span>&nbsp;<span class="ident" id="4595751">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595772">if</span>&nbsp;<span class="ident" id="4595775">value</span>&nbsp;<span class="op" id="4595781">&gt;=</span>&nbsp;<span class="builtintype" id="4595784">uint32</span><span class="op" id="4595790">(</span><span class="builtinfunc" id="4595791">len</span><span class="op" id="4595794">(</span><span class="ident" id="4595795">h</span><span class="op" id="4595796">.</span><span class="ident" id="4595797">links</span><span class="op" id="4595802">)</span><span class="op" id="4595803">)</span>&nbsp;<span class="op" id="4595805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595811">return</span>&nbsp;<span class="builtintype" id="4595818">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595832">linktab</span>&nbsp;<span class="op" id="4595840">:=</span>&nbsp;<span class="ident" id="4595843">h</span><span class="op" id="4595844">.</span><span class="ident" id="4595845">links</span><span class="op" id="4595850">[</span><span class="ident" id="4595851">value</span><span class="op" id="4595856">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595861">reverse</span>&nbsp;<span class="op" id="4595869">&gt;&gt;=</span>&nbsp;<span class="ident" id="4595873">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595893">for</span>&nbsp;<span class="ident" id="4595897">off</span>&nbsp;<span class="op" id="4595901">:=</span>&nbsp;<span class="ident" id="4595904">reverse</span><span class="op" id="4595911">;</span>&nbsp;<span class="ident" id="4595913">off</span>&nbsp;<span class="op" id="4595917">&lt;</span>&nbsp;<span class="ident" id="4595919">numLinks</span><span class="op" id="4595927">;</span>&nbsp;<span class="ident" id="4595929">off</span>&nbsp;<span class="op" id="4595933">+=</span>&nbsp;<span class="num" id="4595936">1</span>&nbsp;<span class="op" id="4595938">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4595941">uint</span><span class="op" id="4595945">(</span><span class="ident" id="4595946">n</span><span class="op" id="4595947">-</span><span class="ident" id="4595948">huffmanChunkBits</span><span class="op" id="4595964">)</span>&nbsp;<span class="op" id="4595966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595972">linktab</span><span class="op" id="4595979">[</span><span class="ident" id="4595980">off</span><span class="op" id="4595983">]</span>&nbsp;<span class="op" id="4595985">=</span>&nbsp;<span class="ident" id="4595987">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596000">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596006">return</span>&nbsp;<span class="builtintype" id="4596013">true</span><br>
<span class="lineno"></span><span class="op" id="4596018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596021">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4596071">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4596130">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4596181">type</span>&nbsp;<span class="ident" id="4596186">Reader</span>&nbsp;<span class="keyword" id="4596193">interface</span>&nbsp;<span class="op" id="4596203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596206">io</span><span class="op" id="4596208">.</span><span class="ident" id="4596209">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596217">io</span><span class="op" id="4596219">.</span><span class="ident" id="4596220">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4596231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596234">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4596255">type</span>&nbsp;<span class="ident" id="4596260">decompressor</span>&nbsp;<span class="keyword" id="4596273">struct</span>&nbsp;<span class="op" id="4596280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596283">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596301">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4596309">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596317">roffset</span>&nbsp;<span class="ident" id="4596325">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596332">woffset</span>&nbsp;<span class="ident" id="4596340">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596348">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596377">b</span>&nbsp;&nbsp;<span class="builtintype" id="4596380">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596388">nb</span>&nbsp;<span class="builtintype" id="4596391">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596398">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596449">h1</span><span class="op" id="4596451">,</span>&nbsp;<span class="ident" id="4596453">h2</span>&nbsp;<span class="ident" id="4596456">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596473">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596521">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4596530">*</span><span class="op" id="4596531">[</span><span class="ident" id="4596532">maxLit</span>&nbsp;<span class="op" id="4596539">+</span>&nbsp;<span class="ident" id="4596541">maxDist</span><span class="op" id="4596548">]</span><span class="builtintype" id="4596549">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596554">codebits</span>&nbsp;<span class="op" id="4596563">*</span><span class="op" id="4596564">[</span><span class="ident" id="4596565">numCodes</span><span class="op" id="4596573">]</span><span class="builtintype" id="4596574">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596580">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596608">hist</span>&nbsp;&nbsp;<span class="op" id="4596614">*</span><span class="op" id="4596615">[</span><span class="ident" id="4596616">maxHist</span><span class="op" id="4596623">]</span><span class="builtintype" id="4596624">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596630">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4596636">int</span>&nbsp;&nbsp;<span class="comment" id="4596641">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596679">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4596685">int</span>&nbsp;&nbsp;<span class="comment" id="4596690">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596726">hfull</span>&nbsp;<span class="builtintype" id="4596732">bool</span>&nbsp;<span class="comment" id="4596737">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596774">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596825">buf</span>&nbsp;<span class="op" id="4596829">[</span><span class="num" id="4596830">4</span><span class="op" id="4596831">]</span><span class="builtintype" id="4596832">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596839">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596875">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596904">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4596913">func</span><span class="op" id="4596917">(</span><span class="op" id="4596918">*</span><span class="ident" id="4596919">decompressor</span><span class="op" id="4596931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596934">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4596943">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596949">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4596958">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596965">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4596974">[</span><span class="op" id="4596975">]</span><span class="builtintype" id="4596976">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596982">hl</span><span class="op" id="4596984">,</span>&nbsp;<span class="ident" id="4596986">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4596991">*</span><span class="ident" id="4596992">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597008">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4597017">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597022">copyDist</span>&nbsp;<span class="builtintype" id="4597031">int</span><br>
<span class="lineno"></span><span class="op" id="4597035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4597038">func</span>&nbsp;<span class="op" id="4597043">(</span><span class="ident" id="4597044">f</span>&nbsp;<span class="op" id="4597046">*</span><span class="ident" id="4597047">decompressor</span><span class="op" id="4597059">)</span>&nbsp;<span class="ident" id="4597061">nextBlock</span><span class="op" id="4597070">(</span><span class="op" id="4597071">)</span>&nbsp;<span class="op" id="4597073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597076">if</span>&nbsp;<span class="ident" id="4597079">f</span><span class="op" id="4597080">.</span><span class="ident" id="4597081">final</span>&nbsp;<span class="op" id="4597087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597091">if</span>&nbsp;<span class="ident" id="4597094">f</span><span class="op" id="4597095">.</span><span class="ident" id="4597096">hw</span>&nbsp;<span class="op" id="4597099">!=</span>&nbsp;<span class="ident" id="4597102">f</span><span class="op" id="4597103">.</span><span class="ident" id="4597104">hp</span>&nbsp;<span class="op" id="4597107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597112">f</span><span class="op" id="4597113">.</span><span class="ident" id="4597114">flush</span><span class="op" id="4597119">(</span><span class="op" id="4597120">(</span><span class="op" id="4597121">*</span><span class="ident" id="4597122">decompressor</span><span class="op" id="4597134">)</span><span class="op" id="4597135">.</span><span class="ident" id="4597136">nextBlock</span><span class="op" id="4597145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597150">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597163">f</span><span class="op" id="4597164">.</span><span class="ident" id="4597165">err</span>&nbsp;<span class="op" id="4597169">=</span>&nbsp;<span class="ident" id="4597171">io</span><span class="op" id="4597173">.</span><span class="ident" id="4597174">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597191">for</span>&nbsp;<span class="ident" id="4597195">f</span><span class="op" id="4597196">.</span><span class="ident" id="4597197">nb</span>&nbsp;<span class="op" id="4597200">&lt;</span>&nbsp;<span class="num" id="4597202">1</span><span class="op" id="4597203">+</span><span class="num" id="4597204">2</span>&nbsp;<span class="op" id="4597206">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597210">if</span>&nbsp;<span class="ident" id="4597213">f</span><span class="op" id="4597214">.</span><span class="ident" id="4597215">err</span>&nbsp;<span class="op" id="4597219">=</span>&nbsp;<span class="ident" id="4597221">f</span><span class="op" id="4597222">.</span><span class="ident" id="4597223">moreBits</span><span class="op" id="4597231">(</span><span class="op" id="4597232">)</span><span class="op" id="4597233">;</span>&nbsp;<span class="ident" id="4597235">f</span><span class="op" id="4597236">.</span><span class="ident" id="4597237">err</span>&nbsp;<span class="op" id="4597241">!=</span>&nbsp;<span class="ident" id="4597244">nil</span>&nbsp;<span class="op" id="4597248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597253">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597268">f</span><span class="op" id="4597269">.</span><span class="ident" id="4597270">final</span>&nbsp;<span class="op" id="4597276">=</span>&nbsp;<span class="ident" id="4597278">f</span><span class="op" id="4597279">.</span><span class="ident" id="4597280">b</span><span class="op" id="4597281">&amp;</span><span class="num" id="4597282">1</span>&nbsp;<span class="op" id="4597284">==</span>&nbsp;<span class="num" id="4597287">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597290">f</span><span class="op" id="4597291">.</span><span class="ident" id="4597292">b</span>&nbsp;<span class="op" id="4597294">&gt;&gt;=</span>&nbsp;<span class="num" id="4597298">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597301">typ</span>&nbsp;<span class="op" id="4597305">:=</span>&nbsp;<span class="ident" id="4597308">f</span><span class="op" id="4597309">.</span><span class="ident" id="4597310">b</span>&nbsp;<span class="op" id="4597312">&amp;</span>&nbsp;<span class="num" id="4597314">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597317">f</span><span class="op" id="4597318">.</span><span class="ident" id="4597319">b</span>&nbsp;<span class="op" id="4597321">&gt;&gt;=</span>&nbsp;<span class="num" id="4597325">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597328">f</span><span class="op" id="4597329">.</span><span class="ident" id="4597330">nb</span>&nbsp;<span class="op" id="4597333">-=</span>&nbsp;<span class="num" id="4597336">1</span>&nbsp;<span class="op" id="4597338">+</span>&nbsp;<span class="num" id="4597340">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597343">switch</span>&nbsp;<span class="ident" id="4597350">typ</span>&nbsp;<span class="op" id="4597354">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597357">case</span>&nbsp;<span class="num" id="4597362">0</span><span class="op" id="4597363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597367">f</span><span class="op" id="4597368">.</span><span class="ident" id="4597369">dataBlock</span><span class="op" id="4597378">(</span><span class="op" id="4597379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597382">case</span>&nbsp;<span class="num" id="4597387">1</span><span class="op" id="4597388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4597392">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597430">f</span><span class="op" id="4597431">.</span><span class="ident" id="4597432">hl</span>&nbsp;<span class="op" id="4597435">=</span>&nbsp;<span class="op" id="4597437">&amp;</span><span class="ident" id="4597438">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597460">f</span><span class="op" id="4597461">.</span><span class="ident" id="4597462">hd</span>&nbsp;<span class="op" id="4597465">=</span>&nbsp;<span class="ident" id="4597467">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597473">f</span><span class="op" id="4597474">.</span><span class="ident" id="4597475">huffmanBlock</span><span class="op" id="4597487">(</span><span class="op" id="4597488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597491">case</span>&nbsp;<span class="num" id="4597496">2</span><span class="op" id="4597497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4597501">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597541">if</span>&nbsp;<span class="ident" id="4597544">f</span><span class="op" id="4597545">.</span><span class="ident" id="4597546">err</span>&nbsp;<span class="op" id="4597550">=</span>&nbsp;<span class="ident" id="4597552">f</span><span class="op" id="4597553">.</span><span class="ident" id="4597554">readHuffman</span><span class="op" id="4597565">(</span><span class="op" id="4597566">)</span><span class="op" id="4597567">;</span>&nbsp;<span class="ident" id="4597569">f</span><span class="op" id="4597570">.</span><span class="ident" id="4597571">err</span>&nbsp;<span class="op" id="4597575">!=</span>&nbsp;<span class="ident" id="4597578">nil</span>&nbsp;<span class="op" id="4597582">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597587">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597599">f</span><span class="op" id="4597600">.</span><span class="ident" id="4597601">hl</span>&nbsp;<span class="op" id="4597604">=</span>&nbsp;<span class="op" id="4597606">&amp;</span><span class="ident" id="4597607">f</span><span class="op" id="4597608">.</span><span class="ident" id="4597609">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597614">f</span><span class="op" id="4597615">.</span><span class="ident" id="4597616">hd</span>&nbsp;<span class="op" id="4597619">=</span>&nbsp;<span class="op" id="4597621">&amp;</span><span class="ident" id="4597622">f</span><span class="op" id="4597623">.</span><span class="ident" id="4597624">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597629">f</span><span class="op" id="4597630">.</span><span class="ident" id="4597631">huffmanBlock</span><span class="op" id="4597643">(</span><span class="op" id="4597644">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597647">default</span><span class="op" id="4597654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4597658">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597678">f</span><span class="op" id="4597679">.</span><span class="ident" id="4597680">err</span>&nbsp;<span class="op" id="4597684">=</span>&nbsp;<span class="ident" id="4597686">CorruptInputError</span><span class="op" id="4597703">(</span><span class="ident" id="4597704">f</span><span class="op" id="4597705">.</span><span class="ident" id="4597706">roffset</span><span class="op" id="4597713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597716">}</span><br>
<span class="lineno"></span><span class="op" id="4597718">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4597721">func</span>&nbsp;<span class="op" id="4597726">(</span><span class="ident" id="4597727">f</span>&nbsp;<span class="op" id="4597729">*</span><span class="ident" id="4597730">decompressor</span><span class="op" id="4597742">)</span>&nbsp;<span class="ident" id="4597744">Read</span><span class="op" id="4597748">(</span><span class="ident" id="4597749">b</span>&nbsp;<span class="op" id="4597751">[</span><span class="op" id="4597752">]</span><span class="builtintype" id="4597753">byte</span><span class="op" id="4597757">)</span>&nbsp;<span class="op" id="4597759">(</span><span class="builtintype" id="4597760">int</span><span class="op" id="4597763">,</span>&nbsp;<span class="builtintype" id="4597765">error</span><span class="op" id="4597770">)</span>&nbsp;<span class="op" id="4597772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597775">for</span>&nbsp;<span class="op" id="4597779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597783">if</span>&nbsp;<span class="builtinfunc" id="4597786">len</span><span class="op" id="4597789">(</span><span class="ident" id="4597790">f</span><span class="op" id="4597791">.</span><span class="ident" id="4597792">toRead</span><span class="op" id="4597798">)</span>&nbsp;<span class="op" id="4597800">&gt;</span>&nbsp;<span class="num" id="4597802">0</span>&nbsp;<span class="op" id="4597804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597809">n</span>&nbsp;<span class="op" id="4597811">:=</span>&nbsp;<span class="builtinfunc" id="4597814">copy</span><span class="op" id="4597818">(</span><span class="ident" id="4597819">b</span><span class="op" id="4597820">,</span>&nbsp;<span class="ident" id="4597822">f</span><span class="op" id="4597823">.</span><span class="ident" id="4597824">toRead</span><span class="op" id="4597830">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597835">f</span><span class="op" id="4597836">.</span><span class="ident" id="4597837">toRead</span>&nbsp;<span class="op" id="4597844">=</span>&nbsp;<span class="ident" id="4597846">f</span><span class="op" id="4597847">.</span><span class="ident" id="4597848">toRead</span><span class="op" id="4597854">[</span><span class="ident" id="4597855">n</span><span class="op" id="4597856">:</span><span class="op" id="4597857">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597862">return</span>&nbsp;<span class="ident" id="4597869">n</span><span class="op" id="4597870">,</span>&nbsp;<span class="ident" id="4597872">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597882">if</span>&nbsp;<span class="ident" id="4597885">f</span><span class="op" id="4597886">.</span><span class="ident" id="4597887">err</span>&nbsp;<span class="op" id="4597891">!=</span>&nbsp;<span class="ident" id="4597894">nil</span>&nbsp;<span class="op" id="4597898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597903">return</span>&nbsp;<span class="num" id="4597910">0</span><span class="op" id="4597911">,</span>&nbsp;<span class="ident" id="4597913">f</span><span class="op" id="4597914">.</span><span class="ident" id="4597915">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597925">f</span><span class="op" id="4597926">.</span><span class="ident" id="4597927">step</span><span class="op" id="4597931">(</span><span class="ident" id="4597932">f</span><span class="op" id="4597933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597936">}</span><br>
<span class="lineno"></span><span class="op" id="4597938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4597941">func</span>&nbsp;<span class="op" id="4597946">(</span><span class="ident" id="4597947">f</span>&nbsp;<span class="op" id="4597949">*</span><span class="ident" id="4597950">decompressor</span><span class="op" id="4597962">)</span>&nbsp;<span class="ident" id="4597964">Close</span><span class="op" id="4597969">(</span><span class="op" id="4597970">)</span>&nbsp;<span class="builtintype" id="4597972">error</span>&nbsp;<span class="op" id="4597978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597981">if</span>&nbsp;<span class="ident" id="4597984">f</span><span class="op" id="4597985">.</span><span class="ident" id="4597986">err</span>&nbsp;<span class="op" id="4597990">==</span>&nbsp;<span class="ident" id="4597993">io</span><span class="op" id="4597995">.</span><span class="ident" id="4597996">EOF</span>&nbsp;<span class="op" id="4598000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598004">return</span>&nbsp;<span class="ident" id="4598011">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598019">return</span>&nbsp;<span class="ident" id="4598026">f</span><span class="op" id="4598027">.</span><span class="ident" id="4598028">err</span><br>
<span class="lineno">295</span><span class="op" id="4598032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4598035">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4598062">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4598105">var</span>&nbsp;<span class="ident" id="4598109">codeOrder</span>&nbsp;<span class="op" id="4598119">=</span>&nbsp;<span class="op" id="4598121">[</span><span class="op" id="4598122">...</span><span class="op" id="4598125">]</span><span class="builtintype" id="4598126">int</span><span class="op" id="4598129">{</span><span class="num" id="4598130">16</span><span class="op" id="4598132">,</span>&nbsp;<span class="num" id="4598134">17</span><span class="op" id="4598136">,</span>&nbsp;<span class="num" id="4598138">18</span><span class="op" id="4598140">,</span>&nbsp;<span class="num" id="4598142">0</span><span class="op" id="4598143">,</span>&nbsp;<span class="num" id="4598145">8</span><span class="op" id="4598146">,</span>&nbsp;<span class="num" id="4598148">7</span><span class="op" id="4598149">,</span>&nbsp;<span class="num" id="4598151">9</span><span class="op" id="4598152">,</span>&nbsp;<span class="num" id="4598154">6</span><span class="op" id="4598155">,</span>&nbsp;<span class="num" id="4598157">10</span><span class="op" id="4598159">,</span>&nbsp;<span class="num" id="4598161">5</span><span class="op" id="4598162">,</span>&nbsp;<span class="num" id="4598164">11</span><span class="op" id="4598166">,</span>&nbsp;<span class="num" id="4598168">4</span><span class="op" id="4598169">,</span>&nbsp;<span class="num" id="4598171">12</span><span class="op" id="4598173">,</span>&nbsp;<span class="num" id="4598175">3</span><span class="op" id="4598176">,</span>&nbsp;<span class="num" id="4598178">13</span><span class="op" id="4598180">,</span>&nbsp;<span class="num" id="4598182">2</span><span class="op" id="4598183">,</span>&nbsp;<span class="num" id="4598185">14</span><span class="op" id="4598187">,</span>&nbsp;<span class="num" id="4598189">1</span><span class="op" id="4598190">,</span>&nbsp;<span class="num" id="4598192">15</span><span class="op" id="4598194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4598197">func</span>&nbsp;<span class="op" id="4598202">(</span><span class="ident" id="4598203">f</span>&nbsp;<span class="op" id="4598205">*</span><span class="ident" id="4598206">decompressor</span><span class="op" id="4598218">)</span>&nbsp;<span class="ident" id="4598220">readHuffman</span><span class="op" id="4598231">(</span><span class="op" id="4598232">)</span>&nbsp;<span class="builtintype" id="4598234">error</span>&nbsp;<span class="op" id="4598240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598243">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598276">for</span>&nbsp;<span class="ident" id="4598280">f</span><span class="op" id="4598281">.</span><span class="ident" id="4598282">nb</span>&nbsp;<span class="op" id="4598285">&lt;</span>&nbsp;<span class="num" id="4598287">5</span><span class="op" id="4598288">+</span><span class="num" id="4598289">5</span><span class="op" id="4598290">+</span><span class="num" id="4598291">4</span>&nbsp;<span class="op" id="4598293">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598297">if</span>&nbsp;<span class="ident" id="4598300">err</span>&nbsp;<span class="op" id="4598304">:=</span>&nbsp;<span class="ident" id="4598307">f</span><span class="op" id="4598308">.</span><span class="ident" id="4598309">moreBits</span><span class="op" id="4598317">(</span><span class="op" id="4598318">)</span><span class="op" id="4598319">;</span>&nbsp;<span class="ident" id="4598321">err</span>&nbsp;<span class="op" id="4598325">!=</span>&nbsp;<span class="ident" id="4598328">nil</span>&nbsp;<span class="op" id="4598332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598337">return</span>&nbsp;<span class="ident" id="4598344">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598356">nlit</span>&nbsp;<span class="op" id="4598361">:=</span>&nbsp;<span class="builtintype" id="4598364">int</span><span class="op" id="4598367">(</span><span class="ident" id="4598368">f</span><span class="op" id="4598369">.</span><span class="ident" id="4598370">b</span><span class="op" id="4598371">&amp;</span><span class="num" id="4598372">0x1F</span><span class="op" id="4598376">)</span>&nbsp;<span class="op" id="4598378">+</span>&nbsp;<span class="num" id="4598380">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598385">if</span>&nbsp;<span class="ident" id="4598388">nlit</span>&nbsp;<span class="op" id="4598393">&gt;</span>&nbsp;<span class="ident" id="4598395">maxLit</span>&nbsp;<span class="op" id="4598402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598406">return</span>&nbsp;<span class="ident" id="4598413">CorruptInputError</span><span class="op" id="4598430">(</span><span class="ident" id="4598431">f</span><span class="op" id="4598432">.</span><span class="ident" id="4598433">roffset</span><span class="op" id="4598440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598446">f</span><span class="op" id="4598447">.</span><span class="ident" id="4598448">b</span>&nbsp;<span class="op" id="4598450">&gt;&gt;=</span>&nbsp;<span class="num" id="4598454">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598457">ndist</span>&nbsp;<span class="op" id="4598463">:=</span>&nbsp;<span class="builtintype" id="4598466">int</span><span class="op" id="4598469">(</span><span class="ident" id="4598470">f</span><span class="op" id="4598471">.</span><span class="ident" id="4598472">b</span><span class="op" id="4598473">&amp;</span><span class="num" id="4598474">0x1F</span><span class="op" id="4598478">)</span>&nbsp;<span class="op" id="4598480">+</span>&nbsp;<span class="num" id="4598482">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598485">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598530">f</span><span class="op" id="4598531">.</span><span class="ident" id="4598532">b</span>&nbsp;<span class="op" id="4598534">&gt;&gt;=</span>&nbsp;<span class="num" id="4598538">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598541">nclen</span>&nbsp;<span class="op" id="4598547">:=</span>&nbsp;<span class="builtintype" id="4598550">int</span><span class="op" id="4598553">(</span><span class="ident" id="4598554">f</span><span class="op" id="4598555">.</span><span class="ident" id="4598556">b</span><span class="op" id="4598557">&amp;</span><span class="num" id="4598558">0xF</span><span class="op" id="4598561">)</span>&nbsp;<span class="op" id="4598563">+</span>&nbsp;<span class="num" id="4598565">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598568">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598614">f</span><span class="op" id="4598615">.</span><span class="ident" id="4598616">b</span>&nbsp;<span class="op" id="4598618">&gt;&gt;=</span>&nbsp;<span class="num" id="4598622">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598625">f</span><span class="op" id="4598626">.</span><span class="ident" id="4598627">nb</span>&nbsp;<span class="op" id="4598630">-=</span>&nbsp;<span class="num" id="4598633">5</span>&nbsp;<span class="op" id="4598635">+</span>&nbsp;<span class="num" id="4598637">5</span>&nbsp;<span class="op" id="4598639">+</span>&nbsp;<span class="num" id="4598641">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598645">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598710">for</span>&nbsp;<span class="ident" id="4598714">i</span>&nbsp;<span class="op" id="4598716">:=</span>&nbsp;<span class="num" id="4598719">0</span><span class="op" id="4598720">;</span>&nbsp;<span class="ident" id="4598722">i</span>&nbsp;<span class="op" id="4598724">&lt;</span>&nbsp;<span class="ident" id="4598726">nclen</span><span class="op" id="4598731">;</span>&nbsp;<span class="ident" id="4598733">i</span><span class="op" id="4598734">++</span>&nbsp;<span class="op" id="4598737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598741">for</span>&nbsp;<span class="ident" id="4598745">f</span><span class="op" id="4598746">.</span><span class="ident" id="4598747">nb</span>&nbsp;<span class="op" id="4598750">&lt;</span>&nbsp;<span class="num" id="4598752">3</span>&nbsp;<span class="op" id="4598754">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598759">if</span>&nbsp;<span class="ident" id="4598762">err</span>&nbsp;<span class="op" id="4598766">:=</span>&nbsp;<span class="ident" id="4598769">f</span><span class="op" id="4598770">.</span><span class="ident" id="4598771">moreBits</span><span class="op" id="4598779">(</span><span class="op" id="4598780">)</span><span class="op" id="4598781">;</span>&nbsp;<span class="ident" id="4598783">err</span>&nbsp;<span class="op" id="4598787">!=</span>&nbsp;<span class="ident" id="4598790">nil</span>&nbsp;<span class="op" id="4598794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598800">return</span>&nbsp;<span class="ident" id="4598807">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598822">f</span><span class="op" id="4598823">.</span><span class="ident" id="4598824">codebits</span><span class="op" id="4598832">[</span><span class="ident" id="4598833">codeOrder</span><span class="op" id="4598842">[</span><span class="ident" id="4598843">i</span><span class="op" id="4598844">]</span><span class="op" id="4598845">]</span>&nbsp;<span class="op" id="4598847">=</span>&nbsp;<span class="builtintype" id="4598849">int</span><span class="op" id="4598852">(</span><span class="ident" id="4598853">f</span><span class="op" id="4598854">.</span><span class="ident" id="4598855">b</span>&nbsp;<span class="op" id="4598857">&amp;</span>&nbsp;<span class="num" id="4598859">0x7</span><span class="op" id="4598862">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598866">f</span><span class="op" id="4598867">.</span><span class="ident" id="4598868">b</span>&nbsp;<span class="op" id="4598870">&gt;&gt;=</span>&nbsp;<span class="num" id="4598874">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598878">f</span><span class="op" id="4598879">.</span><span class="ident" id="4598880">nb</span>&nbsp;<span class="op" id="4598883">-=</span>&nbsp;<span class="num" id="4598886">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598892">for</span>&nbsp;<span class="ident" id="4598896">i</span>&nbsp;<span class="op" id="4598898">:=</span>&nbsp;<span class="ident" id="4598901">nclen</span><span class="op" id="4598906">;</span>&nbsp;<span class="ident" id="4598908">i</span>&nbsp;<span class="op" id="4598910">&lt;</span>&nbsp;<span class="builtinfunc" id="4598912">len</span><span class="op" id="4598915">(</span><span class="ident" id="4598916">codeOrder</span><span class="op" id="4598925">)</span><span class="op" id="4598926">;</span>&nbsp;<span class="ident" id="4598928">i</span><span class="op" id="4598929">++</span>&nbsp;<span class="op" id="4598932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598936">f</span><span class="op" id="4598937">.</span><span class="ident" id="4598938">codebits</span><span class="op" id="4598946">[</span><span class="ident" id="4598947">codeOrder</span><span class="op" id="4598956">[</span><span class="ident" id="4598957">i</span><span class="op" id="4598958">]</span><span class="op" id="4598959">]</span>&nbsp;<span class="op" id="4598961">=</span>&nbsp;<span class="num" id="4598963">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598969">if</span>&nbsp;<span class="op" id="4598972">!</span><span class="ident" id="4598973">f</span><span class="op" id="4598974">.</span><span class="ident" id="4598975">h1</span><span class="op" id="4598977">.</span><span class="ident" id="4598978">init</span><span class="op" id="4598982">(</span><span class="ident" id="4598983">f</span><span class="op" id="4598984">.</span><span class="ident" id="4598985">codebits</span><span class="op" id="4598993">[</span><span class="num" id="4598994">0</span><span class="op" id="4598995">:</span><span class="op" id="4598996">]</span><span class="op" id="4598997">)</span>&nbsp;<span class="op" id="4598999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599003">return</span>&nbsp;<span class="ident" id="4599010">CorruptInputError</span><span class="op" id="4599027">(</span><span class="ident" id="4599028">f</span><span class="op" id="4599029">.</span><span class="ident" id="4599030">roffset</span><span class="op" id="4599037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599044">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599097">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599137">for</span>&nbsp;<span class="ident" id="4599141">i</span><span class="op" id="4599142">,</span>&nbsp;<span class="ident" id="4599144">n</span>&nbsp;<span class="op" id="4599146">:=</span>&nbsp;<span class="num" id="4599149">0</span><span class="op" id="4599150">,</span>&nbsp;<span class="ident" id="4599152">nlit</span><span class="op" id="4599156">+</span><span class="ident" id="4599157">ndist</span><span class="op" id="4599162">;</span>&nbsp;<span class="ident" id="4599164">i</span>&nbsp;<span class="op" id="4599166">&lt;</span>&nbsp;<span class="ident" id="4599168">n</span><span class="op" id="4599169">;</span>&nbsp;<span class="op" id="4599171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599175">x</span><span class="op" id="4599176">,</span>&nbsp;<span class="ident" id="4599178">err</span>&nbsp;<span class="op" id="4599182">:=</span>&nbsp;<span class="ident" id="4599185">f</span><span class="op" id="4599186">.</span><span class="ident" id="4599187">huffSym</span><span class="op" id="4599194">(</span><span class="op" id="4599195">&amp;</span><span class="ident" id="4599196">f</span><span class="op" id="4599197">.</span><span class="ident" id="4599198">h1</span><span class="op" id="4599200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599204">if</span>&nbsp;<span class="ident" id="4599207">err</span>&nbsp;<span class="op" id="4599211">!=</span>&nbsp;<span class="ident" id="4599214">nil</span>&nbsp;<span class="op" id="4599218">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599223">return</span>&nbsp;<span class="ident" id="4599230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599240">if</span>&nbsp;<span class="ident" id="4599243">x</span>&nbsp;<span class="op" id="4599245">&lt;</span>&nbsp;<span class="num" id="4599247">16</span>&nbsp;<span class="op" id="4599250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599255">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599276">f</span><span class="op" id="4599277">.</span><span class="ident" id="4599278">bits</span><span class="op" id="4599282">[</span><span class="ident" id="4599283">i</span><span class="op" id="4599284">]</span>&nbsp;<span class="op" id="4599286">=</span>&nbsp;<span class="ident" id="4599288">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599293">i</span><span class="op" id="4599294">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599300">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599315">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599352">var</span>&nbsp;<span class="ident" id="4599356">rep</span>&nbsp;<span class="builtintype" id="4599360">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599366">var</span>&nbsp;<span class="ident" id="4599370">nb</span>&nbsp;<span class="builtintype" id="4599373">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599380">var</span>&nbsp;<span class="ident" id="4599384">b</span>&nbsp;<span class="builtintype" id="4599386">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599392">switch</span>&nbsp;<span class="ident" id="4599399">x</span>&nbsp;<span class="op" id="4599401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599405">default</span><span class="op" id="4599412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599417">return</span>&nbsp;<span class="ident" id="4599424">InternalError</span><span class="op" id="4599437">(</span><span class="string" id="4599438">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4599462">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599466">case</span>&nbsp;<span class="num" id="4599471">16</span><span class="op" id="4599473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599478">rep</span>&nbsp;<span class="op" id="4599482">=</span>&nbsp;<span class="num" id="4599484">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599489">nb</span>&nbsp;<span class="op" id="4599492">=</span>&nbsp;<span class="num" id="4599494">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599499">if</span>&nbsp;<span class="ident" id="4599502">i</span>&nbsp;<span class="op" id="4599504">==</span>&nbsp;<span class="num" id="4599507">0</span>&nbsp;<span class="op" id="4599509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599515">return</span>&nbsp;<span class="ident" id="4599522">CorruptInputError</span><span class="op" id="4599539">(</span><span class="ident" id="4599540">f</span><span class="op" id="4599541">.</span><span class="ident" id="4599542">roffset</span><span class="op" id="4599549">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599559">b</span>&nbsp;<span class="op" id="4599561">=</span>&nbsp;<span class="ident" id="4599563">f</span><span class="op" id="4599564">.</span><span class="ident" id="4599565">bits</span><span class="op" id="4599569">[</span><span class="ident" id="4599570">i</span><span class="op" id="4599571">-</span><span class="num" id="4599572">1</span><span class="op" id="4599573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599577">case</span>&nbsp;<span class="num" id="4599582">17</span><span class="op" id="4599584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599589">rep</span>&nbsp;<span class="op" id="4599593">=</span>&nbsp;<span class="num" id="4599595">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599600">nb</span>&nbsp;<span class="op" id="4599603">=</span>&nbsp;<span class="num" id="4599605">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599610">b</span>&nbsp;<span class="op" id="4599612">=</span>&nbsp;<span class="num" id="4599614">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599618">case</span>&nbsp;<span class="num" id="4599623">18</span><span class="op" id="4599625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599630">rep</span>&nbsp;<span class="op" id="4599634">=</span>&nbsp;<span class="num" id="4599636">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599642">nb</span>&nbsp;<span class="op" id="4599645">=</span>&nbsp;<span class="num" id="4599647">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599652">b</span>&nbsp;<span class="op" id="4599654">=</span>&nbsp;<span class="num" id="4599656">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599664">for</span>&nbsp;<span class="ident" id="4599668">f</span><span class="op" id="4599669">.</span><span class="ident" id="4599670">nb</span>&nbsp;<span class="op" id="4599673">&lt;</span>&nbsp;<span class="ident" id="4599675">nb</span>&nbsp;<span class="op" id="4599678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599683">if</span>&nbsp;<span class="ident" id="4599686">err</span>&nbsp;<span class="op" id="4599690">:=</span>&nbsp;<span class="ident" id="4599693">f</span><span class="op" id="4599694">.</span><span class="ident" id="4599695">moreBits</span><span class="op" id="4599703">(</span><span class="op" id="4599704">)</span><span class="op" id="4599705">;</span>&nbsp;<span class="ident" id="4599707">err</span>&nbsp;<span class="op" id="4599711">!=</span>&nbsp;<span class="ident" id="4599714">nil</span>&nbsp;<span class="op" id="4599718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599724">return</span>&nbsp;<span class="ident" id="4599731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599738">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599746">rep</span>&nbsp;<span class="op" id="4599750">+=</span>&nbsp;<span class="builtintype" id="4599753">int</span><span class="op" id="4599756">(</span><span class="ident" id="4599757">f</span><span class="op" id="4599758">.</span><span class="ident" id="4599759">b</span>&nbsp;<span class="op" id="4599761">&amp;</span>&nbsp;<span class="builtintype" id="4599763">uint32</span><span class="op" id="4599769">(</span><span class="num" id="4599770">1</span><span class="op" id="4599771">&lt;&lt;</span><span class="ident" id="4599773">nb</span><span class="op" id="4599775">-</span><span class="num" id="4599776">1</span><span class="op" id="4599777">)</span><span class="op" id="4599778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599782">f</span><span class="op" id="4599783">.</span><span class="ident" id="4599784">b</span>&nbsp;<span class="op" id="4599786">&gt;&gt;=</span>&nbsp;<span class="ident" id="4599790">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599795">f</span><span class="op" id="4599796">.</span><span class="ident" id="4599797">nb</span>&nbsp;<span class="op" id="4599800">-=</span>&nbsp;<span class="ident" id="4599803">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599808">if</span>&nbsp;<span class="ident" id="4599811">i</span><span class="op" id="4599812">+</span><span class="ident" id="4599813">rep</span>&nbsp;<span class="op" id="4599817">&gt;</span>&nbsp;<span class="ident" id="4599819">n</span>&nbsp;<span class="op" id="4599821">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599826">return</span>&nbsp;<span class="ident" id="4599833">CorruptInputError</span><span class="op" id="4599850">(</span><span class="ident" id="4599851">f</span><span class="op" id="4599852">.</span><span class="ident" id="4599853">roffset</span><span class="op" id="4599860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599868">for</span>&nbsp;<span class="ident" id="4599872">j</span>&nbsp;<span class="op" id="4599874">:=</span>&nbsp;<span class="num" id="4599877">0</span><span class="op" id="4599878">;</span>&nbsp;<span class="ident" id="4599880">j</span>&nbsp;<span class="op" id="4599882">&lt;</span>&nbsp;<span class="ident" id="4599884">rep</span><span class="op" id="4599887">;</span>&nbsp;<span class="ident" id="4599889">j</span><span class="op" id="4599890">++</span>&nbsp;<span class="op" id="4599893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599898">f</span><span class="op" id="4599899">.</span><span class="ident" id="4599900">bits</span><span class="op" id="4599904">[</span><span class="ident" id="4599905">i</span><span class="op" id="4599906">]</span>&nbsp;<span class="op" id="4599908">=</span>&nbsp;<span class="ident" id="4599910">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599915">i</span><span class="op" id="4599916">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599928">if</span>&nbsp;<span class="op" id="4599931">!</span><span class="ident" id="4599932">f</span><span class="op" id="4599933">.</span><span class="ident" id="4599934">h1</span><span class="op" id="4599936">.</span><span class="ident" id="4599937">init</span><span class="op" id="4599941">(</span><span class="ident" id="4599942">f</span><span class="op" id="4599943">.</span><span class="ident" id="4599944">bits</span><span class="op" id="4599948">[</span><span class="num" id="4599949">0</span><span class="op" id="4599950">:</span><span class="ident" id="4599951">nlit</span><span class="op" id="4599955">]</span><span class="op" id="4599956">)</span>&nbsp;<span class="op" id="4599958">||</span>&nbsp;<span class="op" id="4599961">!</span><span class="ident" id="4599962">f</span><span class="op" id="4599963">.</span><span class="ident" id="4599964">h2</span><span class="op" id="4599966">.</span><span class="ident" id="4599967">init</span><span class="op" id="4599971">(</span><span class="ident" id="4599972">f</span><span class="op" id="4599973">.</span><span class="ident" id="4599974">bits</span><span class="op" id="4599978">[</span><span class="ident" id="4599979">nlit</span><span class="op" id="4599983">:</span><span class="ident" id="4599984">nlit</span><span class="op" id="4599988">+</span><span class="ident" id="4599989">ndist</span><span class="op" id="4599994">]</span><span class="op" id="4599995">)</span>&nbsp;<span class="op" id="4599997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600001">return</span>&nbsp;<span class="ident" id="4600008">CorruptInputError</span><span class="op" id="4600025">(</span><span class="ident" id="4600026">f</span><span class="op" id="4600027">.</span><span class="ident" id="4600028">roffset</span><span class="op" id="4600035">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600042">return</span>&nbsp;<span class="ident" id="4600049">nil</span><br>
<span class="lineno"></span><span class="op" id="4600053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4600056">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4600097">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4600159">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4600226">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4600291">func</span>&nbsp;<span class="op" id="4600296">(</span><span class="ident" id="4600297">f</span>&nbsp;<span class="op" id="4600299">*</span><span class="ident" id="4600300">decompressor</span><span class="op" id="4600312">)</span>&nbsp;<span class="ident" id="4600314">huffmanBlock</span><span class="op" id="4600326">(</span><span class="op" id="4600327">)</span>&nbsp;<span class="op" id="4600329">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600332">for</span>&nbsp;<span class="op" id="4600336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600340">v</span><span class="op" id="4600341">,</span>&nbsp;<span class="ident" id="4600343">err</span>&nbsp;<span class="op" id="4600347">:=</span>&nbsp;<span class="ident" id="4600350">f</span><span class="op" id="4600351">.</span><span class="ident" id="4600352">huffSym</span><span class="op" id="4600359">(</span><span class="ident" id="4600360">f</span><span class="op" id="4600361">.</span><span class="ident" id="4600362">hl</span><span class="op" id="4600364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600368">if</span>&nbsp;<span class="ident" id="4600371">err</span>&nbsp;<span class="op" id="4600375">!=</span>&nbsp;<span class="ident" id="4600378">nil</span>&nbsp;<span class="op" id="4600382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600387">f</span><span class="op" id="4600388">.</span><span class="ident" id="4600389">err</span>&nbsp;<span class="op" id="4600393">=</span>&nbsp;<span class="ident" id="4600395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600402">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600415">var</span>&nbsp;<span class="ident" id="4600419">n</span>&nbsp;<span class="builtintype" id="4600421">uint</span>&nbsp;<span class="comment" id="4600426">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600452">var</span>&nbsp;<span class="ident" id="4600456">length</span>&nbsp;<span class="builtintype" id="4600463">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600469">switch</span>&nbsp;<span class="op" id="4600476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600480">case</span>&nbsp;<span class="ident" id="4600485">v</span>&nbsp;<span class="op" id="4600487">&lt;</span>&nbsp;<span class="num" id="4600489">256</span><span class="op" id="4600492">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600497">f</span><span class="op" id="4600498">.</span><span class="ident" id="4600499">hist</span><span class="op" id="4600503">[</span><span class="ident" id="4600504">f</span><span class="op" id="4600505">.</span><span class="ident" id="4600506">hp</span><span class="op" id="4600508">]</span>&nbsp;<span class="op" id="4600510">=</span>&nbsp;<span class="builtintype" id="4600512">byte</span><span class="op" id="4600516">(</span><span class="ident" id="4600517">v</span><span class="op" id="4600518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600523">f</span><span class="op" id="4600524">.</span><span class="ident" id="4600525">hp</span><span class="op" id="4600527">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600533">if</span>&nbsp;<span class="ident" id="4600536">f</span><span class="op" id="4600537">.</span><span class="ident" id="4600538">hp</span>&nbsp;<span class="op" id="4600541">==</span>&nbsp;<span class="builtinfunc" id="4600544">len</span><span class="op" id="4600547">(</span><span class="ident" id="4600548">f</span><span class="op" id="4600549">.</span><span class="ident" id="4600550">hist</span><span class="op" id="4600554">)</span>&nbsp;<span class="op" id="4600556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600562">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600606">f</span><span class="op" id="4600607">.</span><span class="ident" id="4600608">flush</span><span class="op" id="4600613">(</span><span class="op" id="4600614">(</span><span class="op" id="4600615">*</span><span class="ident" id="4600616">decompressor</span><span class="op" id="4600628">)</span><span class="op" id="4600629">.</span><span class="ident" id="4600630">huffmanBlock</span><span class="op" id="4600642">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600648">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600663">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600674">case</span>&nbsp;<span class="ident" id="4600679">v</span>&nbsp;<span class="op" id="4600681">==</span>&nbsp;<span class="num" id="4600684">256</span><span class="op" id="4600687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600692">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600740">f</span><span class="op" id="4600741">.</span><span class="ident" id="4600742">step</span>&nbsp;<span class="op" id="4600747">=</span>&nbsp;<span class="op" id="4600749">(</span><span class="op" id="4600750">*</span><span class="ident" id="4600751">decompressor</span><span class="op" id="4600763">)</span><span class="op" id="4600764">.</span><span class="ident" id="4600765">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600778">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600787">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600827">case</span>&nbsp;<span class="ident" id="4600832">v</span>&nbsp;<span class="op" id="4600834">&lt;</span>&nbsp;<span class="num" id="4600836">265</span><span class="op" id="4600839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600844">length</span>&nbsp;<span class="op" id="4600851">=</span>&nbsp;<span class="ident" id="4600853">v</span>&nbsp;<span class="op" id="4600855">-</span>&nbsp;<span class="op" id="4600857">(</span><span class="num" id="4600858">257</span>&nbsp;<span class="op" id="4600862">-</span>&nbsp;<span class="num" id="4600864">3</span><span class="op" id="4600865">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600870">n</span>&nbsp;<span class="op" id="4600872">=</span>&nbsp;<span class="num" id="4600874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600878">case</span>&nbsp;<span class="ident" id="4600883">v</span>&nbsp;<span class="op" id="4600885">&lt;</span>&nbsp;<span class="num" id="4600887">269</span><span class="op" id="4600890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600895">length</span>&nbsp;<span class="op" id="4600902">=</span>&nbsp;<span class="ident" id="4600904">v</span><span class="op" id="4600905">*</span><span class="num" id="4600906">2</span>&nbsp;<span class="op" id="4600908">-</span>&nbsp;<span class="op" id="4600910">(</span><span class="num" id="4600911">265</span><span class="op" id="4600914">*</span><span class="num" id="4600915">2</span>&nbsp;<span class="op" id="4600917">-</span>&nbsp;<span class="num" id="4600919">11</span><span class="op" id="4600921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600926">n</span>&nbsp;<span class="op" id="4600928">=</span>&nbsp;<span class="num" id="4600930">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600934">case</span>&nbsp;<span class="ident" id="4600939">v</span>&nbsp;<span class="op" id="4600941">&lt;</span>&nbsp;<span class="num" id="4600943">273</span><span class="op" id="4600946">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600951">length</span>&nbsp;<span class="op" id="4600958">=</span>&nbsp;<span class="ident" id="4600960">v</span><span class="op" id="4600961">*</span><span class="num" id="4600962">4</span>&nbsp;<span class="op" id="4600964">-</span>&nbsp;<span class="op" id="4600966">(</span><span class="num" id="4600967">269</span><span class="op" id="4600970">*</span><span class="num" id="4600971">4</span>&nbsp;<span class="op" id="4600973">-</span>&nbsp;<span class="num" id="4600975">19</span><span class="op" id="4600977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600982">n</span>&nbsp;<span class="op" id="4600984">=</span>&nbsp;<span class="num" id="4600986">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600990">case</span>&nbsp;<span class="ident" id="4600995">v</span>&nbsp;<span class="op" id="4600997">&lt;</span>&nbsp;<span class="num" id="4600999">277</span><span class="op" id="4601002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601007">length</span>&nbsp;<span class="op" id="4601014">=</span>&nbsp;<span class="ident" id="4601016">v</span><span class="op" id="4601017">*</span><span class="num" id="4601018">8</span>&nbsp;<span class="op" id="4601020">-</span>&nbsp;<span class="op" id="4601022">(</span><span class="num" id="4601023">273</span><span class="op" id="4601026">*</span><span class="num" id="4601027">8</span>&nbsp;<span class="op" id="4601029">-</span>&nbsp;<span class="num" id="4601031">35</span><span class="op" id="4601033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601038">n</span>&nbsp;<span class="op" id="4601040">=</span>&nbsp;<span class="num" id="4601042">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601046">case</span>&nbsp;<span class="ident" id="4601051">v</span>&nbsp;<span class="op" id="4601053">&lt;</span>&nbsp;<span class="num" id="4601055">281</span><span class="op" id="4601058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601063">length</span>&nbsp;<span class="op" id="4601070">=</span>&nbsp;<span class="ident" id="4601072">v</span><span class="op" id="4601073">*</span><span class="num" id="4601074">16</span>&nbsp;<span class="op" id="4601077">-</span>&nbsp;<span class="op" id="4601079">(</span><span class="num" id="4601080">277</span><span class="op" id="4601083">*</span><span class="num" id="4601084">16</span>&nbsp;<span class="op" id="4601087">-</span>&nbsp;<span class="num" id="4601089">67</span><span class="op" id="4601091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601096">n</span>&nbsp;<span class="op" id="4601098">=</span>&nbsp;<span class="num" id="4601100">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601104">case</span>&nbsp;<span class="ident" id="4601109">v</span>&nbsp;<span class="op" id="4601111">&lt;</span>&nbsp;<span class="num" id="4601113">285</span><span class="op" id="4601116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601121">length</span>&nbsp;<span class="op" id="4601128">=</span>&nbsp;<span class="ident" id="4601130">v</span><span class="op" id="4601131">*</span><span class="num" id="4601132">32</span>&nbsp;<span class="op" id="4601135">-</span>&nbsp;<span class="op" id="4601137">(</span><span class="num" id="4601138">281</span><span class="op" id="4601141">*</span><span class="num" id="4601142">32</span>&nbsp;<span class="op" id="4601145">-</span>&nbsp;<span class="num" id="4601147">131</span><span class="op" id="4601150">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601155">n</span>&nbsp;<span class="op" id="4601157">=</span>&nbsp;<span class="num" id="4601159">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601163">default</span><span class="op" id="4601170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601175">length</span>&nbsp;<span class="op" id="4601182">=</span>&nbsp;<span class="num" id="4601184">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601191">n</span>&nbsp;<span class="op" id="4601193">=</span>&nbsp;<span class="num" id="4601195">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601199">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601203">if</span>&nbsp;<span class="ident" id="4601206">n</span>&nbsp;<span class="op" id="4601208">&gt;</span>&nbsp;<span class="num" id="4601210">0</span>&nbsp;<span class="op" id="4601212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601217">for</span>&nbsp;<span class="ident" id="4601221">f</span><span class="op" id="4601222">.</span><span class="ident" id="4601223">nb</span>&nbsp;<span class="op" id="4601226">&lt;</span>&nbsp;<span class="ident" id="4601228">n</span>&nbsp;<span class="op" id="4601230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601236">if</span>&nbsp;<span class="ident" id="4601239">err</span>&nbsp;<span class="op" id="4601243">=</span>&nbsp;<span class="ident" id="4601245">f</span><span class="op" id="4601246">.</span><span class="ident" id="4601247">moreBits</span><span class="op" id="4601255">(</span><span class="op" id="4601256">)</span><span class="op" id="4601257">;</span>&nbsp;<span class="ident" id="4601259">err</span>&nbsp;<span class="op" id="4601263">!=</span>&nbsp;<span class="ident" id="4601266">nil</span>&nbsp;<span class="op" id="4601270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601277">f</span><span class="op" id="4601278">.</span><span class="ident" id="4601279">err</span>&nbsp;<span class="op" id="4601283">=</span>&nbsp;<span class="ident" id="4601285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601294">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601315">length</span>&nbsp;<span class="op" id="4601322">+=</span>&nbsp;<span class="builtintype" id="4601325">int</span><span class="op" id="4601328">(</span><span class="ident" id="4601329">f</span><span class="op" id="4601330">.</span><span class="ident" id="4601331">b</span>&nbsp;<span class="op" id="4601333">&amp;</span>&nbsp;<span class="builtintype" id="4601335">uint32</span><span class="op" id="4601341">(</span><span class="num" id="4601342">1</span><span class="op" id="4601343">&lt;&lt;</span><span class="ident" id="4601345">n</span><span class="op" id="4601346">-</span><span class="num" id="4601347">1</span><span class="op" id="4601348">)</span><span class="op" id="4601349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601354">f</span><span class="op" id="4601355">.</span><span class="ident" id="4601356">b</span>&nbsp;<span class="op" id="4601358">&gt;&gt;=</span>&nbsp;<span class="ident" id="4601362">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601367">f</span><span class="op" id="4601368">.</span><span class="ident" id="4601369">nb</span>&nbsp;<span class="op" id="4601372">-=</span>&nbsp;<span class="ident" id="4601375">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601384">var</span>&nbsp;<span class="ident" id="4601388">dist</span>&nbsp;<span class="builtintype" id="4601393">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601399">if</span>&nbsp;<span class="ident" id="4601402">f</span><span class="op" id="4601403">.</span><span class="ident" id="4601404">hd</span>&nbsp;<span class="op" id="4601407">==</span>&nbsp;<span class="ident" id="4601410">nil</span>&nbsp;<span class="op" id="4601414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601419">for</span>&nbsp;<span class="ident" id="4601423">f</span><span class="op" id="4601424">.</span><span class="ident" id="4601425">nb</span>&nbsp;<span class="op" id="4601428">&lt;</span>&nbsp;<span class="num" id="4601430">5</span>&nbsp;<span class="op" id="4601432">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601438">if</span>&nbsp;<span class="ident" id="4601441">err</span>&nbsp;<span class="op" id="4601445">=</span>&nbsp;<span class="ident" id="4601447">f</span><span class="op" id="4601448">.</span><span class="ident" id="4601449">moreBits</span><span class="op" id="4601457">(</span><span class="op" id="4601458">)</span><span class="op" id="4601459">;</span>&nbsp;<span class="ident" id="4601461">err</span>&nbsp;<span class="op" id="4601465">!=</span>&nbsp;<span class="ident" id="4601468">nil</span>&nbsp;<span class="op" id="4601472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601479">f</span><span class="op" id="4601480">.</span><span class="ident" id="4601481">err</span>&nbsp;<span class="op" id="4601485">=</span>&nbsp;<span class="ident" id="4601487">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601496">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601512">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601517">dist</span>&nbsp;<span class="op" id="4601522">=</span>&nbsp;<span class="builtintype" id="4601524">int</span><span class="op" id="4601527">(</span><span class="ident" id="4601528">reverseByte</span><span class="op" id="4601539">[</span><span class="op" id="4601540">(</span><span class="ident" id="4601541">f</span><span class="op" id="4601542">.</span><span class="ident" id="4601543">b</span><span class="op" id="4601544">&amp;</span><span class="num" id="4601545">0x1F</span><span class="op" id="4601549">)</span><span class="op" id="4601550">&lt;&lt;</span><span class="num" id="4601552">3</span><span class="op" id="4601553">]</span><span class="op" id="4601554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601559">f</span><span class="op" id="4601560">.</span><span class="ident" id="4601561">b</span>&nbsp;<span class="op" id="4601563">&gt;&gt;=</span>&nbsp;<span class="num" id="4601567">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601572">f</span><span class="op" id="4601573">.</span><span class="ident" id="4601574">nb</span>&nbsp;<span class="op" id="4601577">-=</span>&nbsp;<span class="num" id="4601580">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601584">}</span>&nbsp;<span class="keyword" id="4601586">else</span>&nbsp;<span class="op" id="4601591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601596">if</span>&nbsp;<span class="ident" id="4601599">dist</span><span class="op" id="4601603">,</span>&nbsp;<span class="ident" id="4601605">err</span>&nbsp;<span class="op" id="4601609">=</span>&nbsp;<span class="ident" id="4601611">f</span><span class="op" id="4601612">.</span><span class="ident" id="4601613">huffSym</span><span class="op" id="4601620">(</span><span class="ident" id="4601621">f</span><span class="op" id="4601622">.</span><span class="ident" id="4601623">hd</span><span class="op" id="4601625">)</span><span class="op" id="4601626">;</span>&nbsp;<span class="ident" id="4601628">err</span>&nbsp;<span class="op" id="4601632">!=</span>&nbsp;<span class="ident" id="4601635">nil</span>&nbsp;<span class="op" id="4601639">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601645">f</span><span class="op" id="4601646">.</span><span class="ident" id="4601647">err</span>&nbsp;<span class="op" id="4601651">=</span>&nbsp;<span class="ident" id="4601653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601661">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601680">switch</span>&nbsp;<span class="op" id="4601687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601691">case</span>&nbsp;<span class="ident" id="4601696">dist</span>&nbsp;<span class="op" id="4601701">&lt;</span>&nbsp;<span class="num" id="4601703">4</span><span class="op" id="4601704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601709">dist</span><span class="op" id="4601713">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601718">case</span>&nbsp;<span class="ident" id="4601723">dist</span>&nbsp;<span class="op" id="4601728">&gt;=</span>&nbsp;<span class="num" id="4601731">30</span><span class="op" id="4601733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601738">f</span><span class="op" id="4601739">.</span><span class="ident" id="4601740">err</span>&nbsp;<span class="op" id="4601744">=</span>&nbsp;<span class="ident" id="4601746">CorruptInputError</span><span class="op" id="4601763">(</span><span class="ident" id="4601764">f</span><span class="op" id="4601765">.</span><span class="ident" id="4601766">roffset</span><span class="op" id="4601773">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601778">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601787">default</span><span class="op" id="4601794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601799">nb</span>&nbsp;<span class="op" id="4601802">:=</span>&nbsp;<span class="builtintype" id="4601805">uint</span><span class="op" id="4601809">(</span><span class="ident" id="4601810">dist</span><span class="op" id="4601814">-</span><span class="num" id="4601815">2</span><span class="op" id="4601816">)</span>&nbsp;<span class="op" id="4601818">&gt;&gt;</span>&nbsp;<span class="num" id="4601821">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601826">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601876">extra</span>&nbsp;<span class="op" id="4601882">:=</span>&nbsp;<span class="op" id="4601885">(</span><span class="ident" id="4601886">dist</span>&nbsp;<span class="op" id="4601891">&amp;</span>&nbsp;<span class="num" id="4601893">1</span><span class="op" id="4601894">)</span>&nbsp;<span class="op" id="4601896">&lt;&lt;</span>&nbsp;<span class="ident" id="4601899">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601905">for</span>&nbsp;<span class="ident" id="4601909">f</span><span class="op" id="4601910">.</span><span class="ident" id="4601911">nb</span>&nbsp;<span class="op" id="4601914">&lt;</span>&nbsp;<span class="ident" id="4601916">nb</span>&nbsp;<span class="op" id="4601919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601925">if</span>&nbsp;<span class="ident" id="4601928">err</span>&nbsp;<span class="op" id="4601932">=</span>&nbsp;<span class="ident" id="4601934">f</span><span class="op" id="4601935">.</span><span class="ident" id="4601936">moreBits</span><span class="op" id="4601944">(</span><span class="op" id="4601945">)</span><span class="op" id="4601946">;</span>&nbsp;<span class="ident" id="4601948">err</span>&nbsp;<span class="op" id="4601952">!=</span>&nbsp;<span class="ident" id="4601955">nil</span>&nbsp;<span class="op" id="4601959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601966">f</span><span class="op" id="4601967">.</span><span class="ident" id="4601968">err</span>&nbsp;<span class="op" id="4601972">=</span>&nbsp;<span class="ident" id="4601974">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601983">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601994">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602004">extra</span>&nbsp;<span class="op" id="4602010">|=</span>&nbsp;<span class="builtintype" id="4602013">int</span><span class="op" id="4602016">(</span><span class="ident" id="4602017">f</span><span class="op" id="4602018">.</span><span class="ident" id="4602019">b</span>&nbsp;<span class="op" id="4602021">&amp;</span>&nbsp;<span class="builtintype" id="4602023">uint32</span><span class="op" id="4602029">(</span><span class="num" id="4602030">1</span><span class="op" id="4602031">&lt;&lt;</span><span class="ident" id="4602033">nb</span><span class="op" id="4602035">-</span><span class="num" id="4602036">1</span><span class="op" id="4602037">)</span><span class="op" id="4602038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602043">f</span><span class="op" id="4602044">.</span><span class="ident" id="4602045">b</span>&nbsp;<span class="op" id="4602047">&gt;&gt;=</span>&nbsp;<span class="ident" id="4602051">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602057">f</span><span class="op" id="4602058">.</span><span class="ident" id="4602059">nb</span>&nbsp;<span class="op" id="4602062">-=</span>&nbsp;<span class="ident" id="4602065">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602071">dist</span>&nbsp;<span class="op" id="4602076">=</span>&nbsp;<span class="num" id="4602078">1</span><span class="op" id="4602079">&lt;&lt;</span><span class="op" id="4602081">(</span><span class="ident" id="4602082">nb</span><span class="op" id="4602084">+</span><span class="num" id="4602085">1</span><span class="op" id="4602086">)</span>&nbsp;<span class="op" id="4602088">+</span>&nbsp;<span class="num" id="4602090">1</span>&nbsp;<span class="op" id="4602092">+</span>&nbsp;<span class="ident" id="4602094">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602107">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602158">if</span>&nbsp;<span class="ident" id="4602161">dist</span>&nbsp;<span class="op" id="4602166">&gt;</span>&nbsp;<span class="builtinfunc" id="4602168">len</span><span class="op" id="4602171">(</span><span class="ident" id="4602172">f</span><span class="op" id="4602173">.</span><span class="ident" id="4602174">hist</span><span class="op" id="4602178">)</span>&nbsp;<span class="op" id="4602180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602185">f</span><span class="op" id="4602186">.</span><span class="ident" id="4602187">err</span>&nbsp;<span class="op" id="4602191">=</span>&nbsp;<span class="ident" id="4602193">InternalError</span><span class="op" id="4602206">(</span><span class="string" id="4602207">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4602229">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602234">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602248">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602300">if</span>&nbsp;<span class="op" id="4602303">!</span><span class="ident" id="4602304">f</span><span class="op" id="4602305">.</span><span class="ident" id="4602306">hfull</span>&nbsp;<span class="op" id="4602312">&amp;&amp;</span>&nbsp;<span class="ident" id="4602315">dist</span>&nbsp;<span class="op" id="4602320">&gt;</span>&nbsp;<span class="ident" id="4602322">f</span><span class="op" id="4602323">.</span><span class="ident" id="4602324">hp</span>&nbsp;<span class="op" id="4602327">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602332">f</span><span class="op" id="4602333">.</span><span class="ident" id="4602334">err</span>&nbsp;<span class="op" id="4602338">=</span>&nbsp;<span class="ident" id="4602340">CorruptInputError</span><span class="op" id="4602357">(</span><span class="ident" id="4602358">f</span><span class="op" id="4602359">.</span><span class="ident" id="4602360">roffset</span><span class="op" id="4602367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602372">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602386">f</span><span class="op" id="4602387">.</span><span class="ident" id="4602388">copyLen</span><span class="op" id="4602395">,</span>&nbsp;<span class="ident" id="4602397">f</span><span class="op" id="4602398">.</span><span class="ident" id="4602399">copyDist</span>&nbsp;<span class="op" id="4602408">=</span>&nbsp;<span class="ident" id="4602410">length</span><span class="op" id="4602416">,</span>&nbsp;<span class="ident" id="4602418">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602425">if</span>&nbsp;<span class="ident" id="4602428">f</span><span class="op" id="4602429">.</span><span class="ident" id="4602430">copyHist</span><span class="op" id="4602438">(</span><span class="op" id="4602439">)</span>&nbsp;<span class="op" id="4602441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602458">}</span><br>
<span class="lineno"></span><span class="op" id="4602460">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4602463">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4602544">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4602593">func</span>&nbsp;<span class="op" id="4602598">(</span><span class="ident" id="4602599">f</span>&nbsp;<span class="op" id="4602601">*</span><span class="ident" id="4602602">decompressor</span><span class="op" id="4602614">)</span>&nbsp;<span class="ident" id="4602616">copyHist</span><span class="op" id="4602624">(</span><span class="op" id="4602625">)</span>&nbsp;<span class="builtintype" id="4602627">bool</span>&nbsp;<span class="op" id="4602632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602635">p</span>&nbsp;<span class="op" id="4602637">:=</span>&nbsp;<span class="ident" id="4602640">f</span><span class="op" id="4602641">.</span><span class="ident" id="4602642">hp</span>&nbsp;<span class="op" id="4602645">-</span>&nbsp;<span class="ident" id="4602647">f</span><span class="op" id="4602648">.</span><span class="ident" id="4602649">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602659">if</span>&nbsp;<span class="ident" id="4602662">p</span>&nbsp;<span class="op" id="4602664">&lt;</span>&nbsp;<span class="num" id="4602666">0</span>&nbsp;<span class="op" id="4602668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602672">p</span>&nbsp;<span class="op" id="4602674">+=</span>&nbsp;<span class="builtinfunc" id="4602677">len</span><span class="op" id="4602680">(</span><span class="ident" id="4602681">f</span><span class="op" id="4602682">.</span><span class="ident" id="4602683">hist</span><span class="op" id="4602687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602693">for</span>&nbsp;<span class="ident" id="4602697">f</span><span class="op" id="4602698">.</span><span class="ident" id="4602699">copyLen</span>&nbsp;<span class="op" id="4602707">&gt;</span>&nbsp;<span class="num" id="4602709">0</span>&nbsp;<span class="op" id="4602711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602715">n</span>&nbsp;<span class="op" id="4602717">:=</span>&nbsp;<span class="ident" id="4602720">f</span><span class="op" id="4602721">.</span><span class="ident" id="4602722">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602732">if</span>&nbsp;<span class="ident" id="4602735">x</span>&nbsp;<span class="op" id="4602737">:=</span>&nbsp;<span class="builtinfunc" id="4602740">len</span><span class="op" id="4602743">(</span><span class="ident" id="4602744">f</span><span class="op" id="4602745">.</span><span class="ident" id="4602746">hist</span><span class="op" id="4602750">)</span>&nbsp;<span class="op" id="4602752">-</span>&nbsp;<span class="ident" id="4602754">f</span><span class="op" id="4602755">.</span><span class="ident" id="4602756">hp</span><span class="op" id="4602758">;</span>&nbsp;<span class="ident" id="4602760">n</span>&nbsp;<span class="op" id="4602762">&gt;</span>&nbsp;<span class="ident" id="4602764">x</span>&nbsp;<span class="op" id="4602766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602771">n</span>&nbsp;<span class="op" id="4602773">=</span>&nbsp;<span class="ident" id="4602775">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602783">if</span>&nbsp;<span class="ident" id="4602786">x</span>&nbsp;<span class="op" id="4602788">:=</span>&nbsp;<span class="builtinfunc" id="4602791">len</span><span class="op" id="4602794">(</span><span class="ident" id="4602795">f</span><span class="op" id="4602796">.</span><span class="ident" id="4602797">hist</span><span class="op" id="4602801">)</span>&nbsp;<span class="op" id="4602803">-</span>&nbsp;<span class="ident" id="4602805">p</span><span class="op" id="4602806">;</span>&nbsp;<span class="ident" id="4602808">n</span>&nbsp;<span class="op" id="4602810">&gt;</span>&nbsp;<span class="ident" id="4602812">x</span>&nbsp;<span class="op" id="4602814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602819">n</span>&nbsp;<span class="op" id="4602821">=</span>&nbsp;<span class="ident" id="4602823">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602831">forwardCopy</span><span class="op" id="4602842">(</span><span class="ident" id="4602843">f</span><span class="op" id="4602844">.</span><span class="ident" id="4602845">hist</span><span class="op" id="4602849">[</span><span class="op" id="4602850">:</span><span class="op" id="4602851">]</span><span class="op" id="4602852">,</span>&nbsp;<span class="ident" id="4602854">f</span><span class="op" id="4602855">.</span><span class="ident" id="4602856">hp</span><span class="op" id="4602858">,</span>&nbsp;<span class="ident" id="4602860">p</span><span class="op" id="4602861">,</span>&nbsp;<span class="ident" id="4602863">n</span><span class="op" id="4602864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602868">p</span>&nbsp;<span class="op" id="4602870">+=</span>&nbsp;<span class="ident" id="4602873">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602877">f</span><span class="op" id="4602878">.</span><span class="ident" id="4602879">hp</span>&nbsp;<span class="op" id="4602882">+=</span>&nbsp;<span class="ident" id="4602885">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602889">f</span><span class="op" id="4602890">.</span><span class="ident" id="4602891">copyLen</span>&nbsp;<span class="op" id="4602899">-=</span>&nbsp;<span class="ident" id="4602902">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602906">if</span>&nbsp;<span class="ident" id="4602909">f</span><span class="op" id="4602910">.</span><span class="ident" id="4602911">hp</span>&nbsp;<span class="op" id="4602914">==</span>&nbsp;<span class="builtinfunc" id="4602917">len</span><span class="op" id="4602920">(</span><span class="ident" id="4602921">f</span><span class="op" id="4602922">.</span><span class="ident" id="4602923">hist</span><span class="op" id="4602927">)</span>&nbsp;<span class="op" id="4602929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602934">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602985">f</span><span class="op" id="4602986">.</span><span class="ident" id="4602987">flush</span><span class="op" id="4602992">(</span><span class="op" id="4602993">(</span><span class="op" id="4602994">*</span><span class="ident" id="4602995">decompressor</span><span class="op" id="4603007">)</span><span class="op" id="4603008">.</span><span class="ident" id="4603009">copyHuff</span><span class="op" id="4603017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603022">return</span>&nbsp;<span class="builtintype" id="4603029">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603036">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603040">if</span>&nbsp;<span class="ident" id="4603043">p</span>&nbsp;<span class="op" id="4603045">==</span>&nbsp;<span class="builtinfunc" id="4603048">len</span><span class="op" id="4603051">(</span><span class="ident" id="4603052">f</span><span class="op" id="4603053">.</span><span class="ident" id="4603054">hist</span><span class="op" id="4603058">)</span>&nbsp;<span class="op" id="4603060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603065">p</span>&nbsp;<span class="op" id="4603067">=</span>&nbsp;<span class="num" id="4603069">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603079">return</span>&nbsp;<span class="builtintype" id="4603086">false</span><br>
<span class="lineno">550</span><span class="op" id="4603092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4603095">func</span>&nbsp;<span class="op" id="4603100">(</span><span class="ident" id="4603101">f</span>&nbsp;<span class="op" id="4603103">*</span><span class="ident" id="4603104">decompressor</span><span class="op" id="4603116">)</span>&nbsp;<span class="ident" id="4603118">copyHuff</span><span class="op" id="4603126">(</span><span class="op" id="4603127">)</span>&nbsp;<span class="op" id="4603129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603132">if</span>&nbsp;<span class="ident" id="4603135">f</span><span class="op" id="4603136">.</span><span class="ident" id="4603137">copyHist</span><span class="op" id="4603145">(</span><span class="op" id="4603146">)</span>&nbsp;<span class="op" id="4603148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603152">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603163">f</span><span class="op" id="4603164">.</span><span class="ident" id="4603165">huffmanBlock</span><span class="op" id="4603177">(</span><span class="op" id="4603178">)</span><br>
<span class="lineno"></span><span class="op" id="4603180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4603183">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4603246">func</span>&nbsp;<span class="op" id="4603251">(</span><span class="ident" id="4603252">f</span>&nbsp;<span class="op" id="4603254">*</span><span class="ident" id="4603255">decompressor</span><span class="op" id="4603267">)</span>&nbsp;<span class="ident" id="4603269">dataBlock</span><span class="op" id="4603278">(</span><span class="op" id="4603279">)</span>&nbsp;<span class="op" id="4603281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4603284">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4603302">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603333">f</span><span class="op" id="4603334">.</span><span class="ident" id="4603335">nb</span>&nbsp;<span class="op" id="4603338">=</span>&nbsp;<span class="num" id="4603340">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603343">f</span><span class="op" id="4603344">.</span><span class="ident" id="4603345">b</span>&nbsp;<span class="op" id="4603347">=</span>&nbsp;<span class="num" id="4603349">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4603353">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603396">nr</span><span class="op" id="4603398">,</span>&nbsp;<span class="ident" id="4603400">err</span>&nbsp;<span class="op" id="4603404">:=</span>&nbsp;<span class="ident" id="4603407">io</span><span class="op" id="4603409">.</span><span class="ident" id="4603410">ReadFull</span><span class="op" id="4603418">(</span><span class="ident" id="4603419">f</span><span class="op" id="4603420">.</span><span class="ident" id="4603421">r</span><span class="op" id="4603422">,</span>&nbsp;<span class="ident" id="4603424">f</span><span class="op" id="4603425">.</span><span class="ident" id="4603426">buf</span><span class="op" id="4603429">[</span><span class="num" id="4603430">0</span><span class="op" id="4603431">:</span><span class="num" id="4603432">4</span><span class="op" id="4603433">]</span><span class="op" id="4603434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603437">f</span><span class="op" id="4603438">.</span><span class="ident" id="4603439">roffset</span>&nbsp;<span class="op" id="4603447">+=</span>&nbsp;<span class="ident" id="4603450">int64</span><span class="op" id="4603455">(</span><span class="ident" id="4603456">nr</span><span class="op" id="4603458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603461">if</span>&nbsp;<span class="ident" id="4603464">err</span>&nbsp;<span class="op" id="4603468">!=</span>&nbsp;<span class="ident" id="4603471">nil</span>&nbsp;<span class="op" id="4603475">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603479">f</span><span class="op" id="4603480">.</span><span class="ident" id="4603481">err</span>&nbsp;<span class="op" id="4603485">=</span>&nbsp;<span class="op" id="4603487">&amp;</span><span class="ident" id="4603488">ReadError</span><span class="op" id="4603497">{</span><span class="ident" id="4603498">f</span><span class="op" id="4603499">.</span><span class="ident" id="4603500">roffset</span><span class="op" id="4603507">,</span>&nbsp;<span class="ident" id="4603509">err</span><span class="op" id="4603512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603516">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603527">n</span>&nbsp;<span class="op" id="4603529">:=</span>&nbsp;<span class="builtintype" id="4603532">int</span><span class="op" id="4603535">(</span><span class="ident" id="4603536">f</span><span class="op" id="4603537">.</span><span class="ident" id="4603538">buf</span><span class="op" id="4603541">[</span><span class="num" id="4603542">0</span><span class="op" id="4603543">]</span><span class="op" id="4603544">)</span>&nbsp;<span class="op" id="4603546">|</span>&nbsp;<span class="builtintype" id="4603548">int</span><span class="op" id="4603551">(</span><span class="ident" id="4603552">f</span><span class="op" id="4603553">.</span><span class="ident" id="4603554">buf</span><span class="op" id="4603557">[</span><span class="num" id="4603558">1</span><span class="op" id="4603559">]</span><span class="op" id="4603560">)</span><span class="op" id="4603561">&lt;&lt;</span><span class="num" id="4603563">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603566">nn</span>&nbsp;<span class="op" id="4603569">:=</span>&nbsp;<span class="builtintype" id="4603572">int</span><span class="op" id="4603575">(</span><span class="ident" id="4603576">f</span><span class="op" id="4603577">.</span><span class="ident" id="4603578">buf</span><span class="op" id="4603581">[</span><span class="num" id="4603582">2</span><span class="op" id="4603583">]</span><span class="op" id="4603584">)</span>&nbsp;<span class="op" id="4603586">|</span>&nbsp;<span class="builtintype" id="4603588">int</span><span class="op" id="4603591">(</span><span class="ident" id="4603592">f</span><span class="op" id="4603593">.</span><span class="ident" id="4603594">buf</span><span class="op" id="4603597">[</span><span class="num" id="4603598">3</span><span class="op" id="4603599">]</span><span class="op" id="4603600">)</span><span class="op" id="4603601">&lt;&lt;</span><span class="num" id="4603603">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603606">if</span>&nbsp;<span class="builtintype" id="4603609">uint16</span><span class="op" id="4603615">(</span><span class="ident" id="4603616">nn</span><span class="op" id="4603618">)</span>&nbsp;<span class="op" id="4603620">!=</span>&nbsp;<span class="builtintype" id="4603623">uint16</span><span class="op" id="4603629">(</span><span class="op" id="4603630">^</span><span class="ident" id="4603631">n</span><span class="op" id="4603632">)</span>&nbsp;<span class="op" id="4603634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603638">f</span><span class="op" id="4603639">.</span><span class="ident" id="4603640">err</span>&nbsp;<span class="op" id="4603644">=</span>&nbsp;<span class="ident" id="4603646">CorruptInputError</span><span class="op" id="4603663">(</span><span class="ident" id="4603664">f</span><span class="op" id="4603665">.</span><span class="ident" id="4603666">roffset</span><span class="op" id="4603673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603677">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603689">if</span>&nbsp;<span class="ident" id="4603692">n</span>&nbsp;<span class="op" id="4603694">==</span>&nbsp;<span class="num" id="4603697">0</span>&nbsp;<span class="op" id="4603699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4603703">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603734">f</span><span class="op" id="4603735">.</span><span class="ident" id="4603736">flush</span><span class="op" id="4603741">(</span><span class="op" id="4603742">(</span><span class="op" id="4603743">*</span><span class="ident" id="4603744">decompressor</span><span class="op" id="4603756">)</span><span class="op" id="4603757">.</span><span class="ident" id="4603758">nextBlock</span><span class="op" id="4603767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603779">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603783">f</span><span class="op" id="4603784">.</span><span class="ident" id="4603785">copyLen</span>&nbsp;<span class="op" id="4603793">=</span>&nbsp;<span class="ident" id="4603795">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603798">f</span><span class="op" id="4603799">.</span><span class="ident" id="4603800">copyData</span><span class="op" id="4603808">(</span><span class="op" id="4603809">)</span><br>
<span class="lineno"></span><span class="op" id="4603811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4603814">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4603889">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4603933">func</span>&nbsp;<span class="op" id="4603938">(</span><span class="ident" id="4603939">f</span>&nbsp;<span class="op" id="4603941">*</span><span class="ident" id="4603942">decompressor</span><span class="op" id="4603954">)</span>&nbsp;<span class="ident" id="4603956">copyData</span><span class="op" id="4603964">(</span><span class="op" id="4603965">)</span>&nbsp;<span class="op" id="4603967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4603970">n</span>&nbsp;<span class="op" id="4603972">:=</span>&nbsp;<span class="ident" id="4603975">f</span><span class="op" id="4603976">.</span><span class="ident" id="4603977">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603986">for</span>&nbsp;<span class="ident" id="4603990">n</span>&nbsp;<span class="op" id="4603992">&gt;</span>&nbsp;<span class="num" id="4603994">0</span>&nbsp;<span class="op" id="4603996">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604000">m</span>&nbsp;<span class="op" id="4604002">:=</span>&nbsp;<span class="builtinfunc" id="4604005">len</span><span class="op" id="4604008">(</span><span class="ident" id="4604009">f</span><span class="op" id="4604010">.</span><span class="ident" id="4604011">hist</span><span class="op" id="4604015">)</span>&nbsp;<span class="op" id="4604017">-</span>&nbsp;<span class="ident" id="4604019">f</span><span class="op" id="4604020">.</span><span class="ident" id="4604021">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604026">if</span>&nbsp;<span class="ident" id="4604029">m</span>&nbsp;<span class="op" id="4604031">&gt;</span>&nbsp;<span class="ident" id="4604033">n</span>&nbsp;<span class="op" id="4604035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604040">m</span>&nbsp;<span class="op" id="4604042">=</span>&nbsp;<span class="ident" id="4604044">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604052">m</span><span class="op" id="4604053">,</span>&nbsp;<span class="ident" id="4604055">err</span>&nbsp;<span class="op" id="4604059">:=</span>&nbsp;<span class="ident" id="4604062">io</span><span class="op" id="4604064">.</span><span class="ident" id="4604065">ReadFull</span><span class="op" id="4604073">(</span><span class="ident" id="4604074">f</span><span class="op" id="4604075">.</span><span class="ident" id="4604076">r</span><span class="op" id="4604077">,</span>&nbsp;<span class="ident" id="4604079">f</span><span class="op" id="4604080">.</span><span class="ident" id="4604081">hist</span><span class="op" id="4604085">[</span><span class="ident" id="4604086">f</span><span class="op" id="4604087">.</span><span class="ident" id="4604088">hp</span><span class="op" id="4604090">:</span><span class="ident" id="4604091">f</span><span class="op" id="4604092">.</span><span class="ident" id="4604093">hp</span><span class="op" id="4604095">+</span><span class="ident" id="4604096">m</span><span class="op" id="4604097">]</span><span class="op" id="4604098">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604102">f</span><span class="op" id="4604103">.</span><span class="ident" id="4604104">roffset</span>&nbsp;<span class="op" id="4604112">+=</span>&nbsp;<span class="ident" id="4604115">int64</span><span class="op" id="4604120">(</span><span class="ident" id="4604121">m</span><span class="op" id="4604122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604126">if</span>&nbsp;<span class="ident" id="4604129">err</span>&nbsp;<span class="op" id="4604133">!=</span>&nbsp;<span class="ident" id="4604136">nil</span>&nbsp;<span class="op" id="4604140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604145">f</span><span class="op" id="4604146">.</span><span class="ident" id="4604147">err</span>&nbsp;<span class="op" id="4604151">=</span>&nbsp;<span class="op" id="4604153">&amp;</span><span class="ident" id="4604154">ReadError</span><span class="op" id="4604163">{</span><span class="ident" id="4604164">f</span><span class="op" id="4604165">.</span><span class="ident" id="4604166">roffset</span><span class="op" id="4604173">,</span>&nbsp;<span class="ident" id="4604175">err</span><span class="op" id="4604178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604183">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604192">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604196">n</span>&nbsp;<span class="op" id="4604198">-=</span>&nbsp;<span class="ident" id="4604201">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604205">f</span><span class="op" id="4604206">.</span><span class="ident" id="4604207">hp</span>&nbsp;<span class="op" id="4604210">+=</span>&nbsp;<span class="ident" id="4604213">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604217">if</span>&nbsp;<span class="ident" id="4604220">f</span><span class="op" id="4604221">.</span><span class="ident" id="4604222">hp</span>&nbsp;<span class="op" id="4604225">==</span>&nbsp;<span class="builtinfunc" id="4604228">len</span><span class="op" id="4604231">(</span><span class="ident" id="4604232">f</span><span class="op" id="4604233">.</span><span class="ident" id="4604234">hist</span><span class="op" id="4604238">)</span>&nbsp;<span class="op" id="4604240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604245">f</span><span class="op" id="4604246">.</span><span class="ident" id="4604247">copyLen</span>&nbsp;<span class="op" id="4604255">=</span>&nbsp;<span class="ident" id="4604257">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604262">f</span><span class="op" id="4604263">.</span><span class="ident" id="4604264">flush</span><span class="op" id="4604269">(</span><span class="op" id="4604270">(</span><span class="op" id="4604271">*</span><span class="ident" id="4604272">decompressor</span><span class="op" id="4604284">)</span><span class="op" id="4604285">.</span><span class="ident" id="4604286">copyData</span><span class="op" id="4604294">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604299">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604314">f</span><span class="op" id="4604315">.</span><span class="ident" id="4604316">step</span>&nbsp;<span class="op" id="4604321">=</span>&nbsp;<span class="op" id="4604323">(</span><span class="op" id="4604324">*</span><span class="ident" id="4604325">decompressor</span><span class="op" id="4604337">)</span><span class="op" id="4604338">.</span><span class="ident" id="4604339">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4604349">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4604352">func</span>&nbsp;<span class="op" id="4604357">(</span><span class="ident" id="4604358">f</span>&nbsp;<span class="op" id="4604360">*</span><span class="ident" id="4604361">decompressor</span><span class="op" id="4604373">)</span>&nbsp;<span class="ident" id="4604375">setDict</span><span class="op" id="4604382">(</span><span class="ident" id="4604383">dict</span>&nbsp;<span class="op" id="4604388">[</span><span class="op" id="4604389">]</span><span class="builtintype" id="4604390">byte</span><span class="op" id="4604394">)</span>&nbsp;<span class="op" id="4604396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604399">if</span>&nbsp;<span class="builtinfunc" id="4604402">len</span><span class="op" id="4604405">(</span><span class="ident" id="4604406">dict</span><span class="op" id="4604410">)</span>&nbsp;<span class="op" id="4604412">&gt;</span>&nbsp;<span class="builtinfunc" id="4604414">len</span><span class="op" id="4604417">(</span><span class="ident" id="4604418">f</span><span class="op" id="4604419">.</span><span class="ident" id="4604420">hist</span><span class="op" id="4604424">)</span>&nbsp;<span class="op" id="4604426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4604430">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604464">dict</span>&nbsp;<span class="op" id="4604469">=</span>&nbsp;<span class="ident" id="4604471">dict</span><span class="op" id="4604475">[</span><span class="builtinfunc" id="4604476">len</span><span class="op" id="4604479">(</span><span class="ident" id="4604480">dict</span><span class="op" id="4604484">)</span><span class="op" id="4604485">-</span><span class="builtinfunc" id="4604486">len</span><span class="op" id="4604489">(</span><span class="ident" id="4604490">f</span><span class="op" id="4604491">.</span><span class="ident" id="4604492">hist</span><span class="op" id="4604496">)</span><span class="op" id="4604497">:</span><span class="op" id="4604498">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604505">f</span><span class="op" id="4604506">.</span><span class="ident" id="4604507">hp</span>&nbsp;<span class="op" id="4604510">=</span>&nbsp;<span class="builtinfunc" id="4604512">copy</span><span class="op" id="4604516">(</span><span class="ident" id="4604517">f</span><span class="op" id="4604518">.</span><span class="ident" id="4604519">hist</span><span class="op" id="4604523">[</span><span class="op" id="4604524">:</span><span class="op" id="4604525">]</span><span class="op" id="4604526">,</span>&nbsp;<span class="ident" id="4604528">dict</span><span class="op" id="4604532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604535">if</span>&nbsp;<span class="ident" id="4604538">f</span><span class="op" id="4604539">.</span><span class="ident" id="4604540">hp</span>&nbsp;<span class="op" id="4604543">==</span>&nbsp;<span class="builtinfunc" id="4604546">len</span><span class="op" id="4604549">(</span><span class="ident" id="4604550">f</span><span class="op" id="4604551">.</span><span class="ident" id="4604552">hist</span><span class="op" id="4604556">)</span>&nbsp;<span class="op" id="4604558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604562">f</span><span class="op" id="4604563">.</span><span class="ident" id="4604564">hp</span>&nbsp;<span class="op" id="4604567">=</span>&nbsp;<span class="num" id="4604569">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604573">f</span><span class="op" id="4604574">.</span><span class="ident" id="4604575">hfull</span>&nbsp;<span class="op" id="4604581">=</span>&nbsp;<span class="builtintype" id="4604583">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604592">f</span><span class="op" id="4604593">.</span><span class="ident" id="4604594">hw</span>&nbsp;<span class="op" id="4604597">=</span>&nbsp;<span class="ident" id="4604599">f</span><span class="op" id="4604600">.</span><span class="ident" id="4604601">hp</span><br>
<span class="lineno"></span><span class="op" id="4604604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4604607">func</span>&nbsp;<span class="op" id="4604612">(</span><span class="ident" id="4604613">f</span>&nbsp;<span class="op" id="4604615">*</span><span class="ident" id="4604616">decompressor</span><span class="op" id="4604628">)</span>&nbsp;<span class="ident" id="4604630">moreBits</span><span class="op" id="4604638">(</span><span class="op" id="4604639">)</span>&nbsp;<span class="builtintype" id="4604641">error</span>&nbsp;<span class="op" id="4604647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604650">c</span><span class="op" id="4604651">,</span>&nbsp;<span class="ident" id="4604653">err</span>&nbsp;<span class="op" id="4604657">:=</span>&nbsp;<span class="ident" id="4604660">f</span><span class="op" id="4604661">.</span><span class="ident" id="4604662">r</span><span class="op" id="4604663">.</span><span class="ident" id="4604664">ReadByte</span><span class="op" id="4604672">(</span><span class="op" id="4604673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604676">if</span>&nbsp;<span class="ident" id="4604679">err</span>&nbsp;<span class="op" id="4604683">!=</span>&nbsp;<span class="ident" id="4604686">nil</span>&nbsp;<span class="op" id="4604690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604694">if</span>&nbsp;<span class="ident" id="4604697">err</span>&nbsp;<span class="op" id="4604701">==</span>&nbsp;<span class="ident" id="4604704">io</span><span class="op" id="4604706">.</span><span class="ident" id="4604707">EOF</span>&nbsp;<span class="op" id="4604711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604716">err</span>&nbsp;<span class="op" id="4604720">=</span>&nbsp;<span class="ident" id="4604722">io</span><span class="op" id="4604724">.</span><span class="ident" id="4604725">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604748">return</span>&nbsp;<span class="ident" id="4604755">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604763">f</span><span class="op" id="4604764">.</span><span class="ident" id="4604765">roffset</span><span class="op" id="4604772">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604776">f</span><span class="op" id="4604777">.</span><span class="ident" id="4604778">b</span>&nbsp;<span class="op" id="4604780">|=</span>&nbsp;<span class="builtintype" id="4604783">uint32</span><span class="op" id="4604789">(</span><span class="ident" id="4604790">c</span><span class="op" id="4604791">)</span>&nbsp;<span class="op" id="4604793">&lt;&lt;</span>&nbsp;<span class="ident" id="4604796">f</span><span class="op" id="4604797">.</span><span class="ident" id="4604798">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604802">f</span><span class="op" id="4604803">.</span><span class="ident" id="4604804">nb</span>&nbsp;<span class="op" id="4604807">+=</span>&nbsp;<span class="num" id="4604810">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604813">return</span>&nbsp;<span class="ident" id="4604820">nil</span><br>
<span class="lineno"></span><span class="op" id="4604824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4604827">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4604890">func</span>&nbsp;<span class="op" id="4604895">(</span><span class="ident" id="4604896">f</span>&nbsp;<span class="op" id="4604898">*</span><span class="ident" id="4604899">decompressor</span><span class="op" id="4604911">)</span>&nbsp;<span class="ident" id="4604913">huffSym</span><span class="op" id="4604920">(</span><span class="ident" id="4604921">h</span>&nbsp;<span class="op" id="4604923">*</span><span class="ident" id="4604924">huffmanDecoder</span><span class="op" id="4604938">)</span>&nbsp;<span class="op" id="4604940">(</span><span class="builtintype" id="4604941">int</span><span class="op" id="4604944">,</span>&nbsp;<span class="builtintype" id="4604946">error</span><span class="op" id="4604951">)</span>&nbsp;<span class="op" id="4604953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604956">n</span>&nbsp;<span class="op" id="4604958">:=</span>&nbsp;<span class="builtintype" id="4604961">uint</span><span class="op" id="4604965">(</span><span class="ident" id="4604966">h</span><span class="op" id="4604967">.</span><span class="ident" id="4604968">min</span><span class="op" id="4604971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604974">for</span>&nbsp;<span class="op" id="4604978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604982">for</span>&nbsp;<span class="ident" id="4604986">f</span><span class="op" id="4604987">.</span><span class="ident" id="4604988">nb</span>&nbsp;<span class="op" id="4604991">&lt;</span>&nbsp;<span class="ident" id="4604993">n</span>&nbsp;<span class="op" id="4604995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605000">if</span>&nbsp;<span class="ident" id="4605003">err</span>&nbsp;<span class="op" id="4605007">:=</span>&nbsp;<span class="ident" id="4605010">f</span><span class="op" id="4605011">.</span><span class="ident" id="4605012">moreBits</span><span class="op" id="4605020">(</span><span class="op" id="4605021">)</span><span class="op" id="4605022">;</span>&nbsp;<span class="ident" id="4605024">err</span>&nbsp;<span class="op" id="4605028">!=</span>&nbsp;<span class="ident" id="4605031">nil</span>&nbsp;<span class="op" id="4605035">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605041">return</span>&nbsp;<span class="num" id="4605048">0</span><span class="op" id="4605049">,</span>&nbsp;<span class="ident" id="4605051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605066">chunk</span>&nbsp;<span class="op" id="4605072">:=</span>&nbsp;<span class="ident" id="4605075">h</span><span class="op" id="4605076">.</span><span class="ident" id="4605077">chunks</span><span class="op" id="4605083">[</span><span class="ident" id="4605084">f</span><span class="op" id="4605085">.</span><span class="ident" id="4605086">b</span><span class="op" id="4605087">&amp;</span><span class="op" id="4605088">(</span><span class="ident" id="4605089">huffmanNumChunks</span><span class="op" id="4605105">-</span><span class="num" id="4605106">1</span><span class="op" id="4605107">)</span><span class="op" id="4605108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605112">n</span>&nbsp;<span class="op" id="4605114">=</span>&nbsp;<span class="builtintype" id="4605116">uint</span><span class="op" id="4605120">(</span><span class="ident" id="4605121">chunk</span>&nbsp;<span class="op" id="4605127">&amp;</span>&nbsp;<span class="ident" id="4605129">huffmanCountMask</span><span class="op" id="4605145">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605149">if</span>&nbsp;<span class="ident" id="4605152">n</span>&nbsp;<span class="op" id="4605154">&gt;</span>&nbsp;<span class="ident" id="4605156">huffmanChunkBits</span>&nbsp;<span class="op" id="4605173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605178">chunk</span>&nbsp;<span class="op" id="4605184">=</span>&nbsp;<span class="ident" id="4605186">h</span><span class="op" id="4605187">.</span><span class="ident" id="4605188">links</span><span class="op" id="4605193">[</span><span class="ident" id="4605194">chunk</span><span class="op" id="4605199">&gt;&gt;</span><span class="ident" id="4605201">huffmanValueShift</span><span class="op" id="4605218">]</span><span class="op" id="4605219">[</span><span class="op" id="4605220">(</span><span class="ident" id="4605221">f</span><span class="op" id="4605222">.</span><span class="ident" id="4605223">b</span><span class="op" id="4605224">&gt;&gt;</span><span class="ident" id="4605226">huffmanChunkBits</span><span class="op" id="4605242">)</span><span class="op" id="4605243">&amp;</span><span class="ident" id="4605244">h</span><span class="op" id="4605245">.</span><span class="ident" id="4605246">linkMask</span><span class="op" id="4605254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605259">n</span>&nbsp;<span class="op" id="4605261">=</span>&nbsp;<span class="builtintype" id="4605263">uint</span><span class="op" id="4605267">(</span><span class="ident" id="4605268">chunk</span>&nbsp;<span class="op" id="4605274">&amp;</span>&nbsp;<span class="ident" id="4605276">huffmanCountMask</span><span class="op" id="4605292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605297">if</span>&nbsp;<span class="ident" id="4605300">n</span>&nbsp;<span class="op" id="4605302">==</span>&nbsp;<span class="num" id="4605305">0</span>&nbsp;<span class="op" id="4605307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605313">f</span><span class="op" id="4605314">.</span><span class="ident" id="4605315">err</span>&nbsp;<span class="op" id="4605319">=</span>&nbsp;<span class="ident" id="4605321">CorruptInputError</span><span class="op" id="4605338">(</span><span class="ident" id="4605339">f</span><span class="op" id="4605340">.</span><span class="ident" id="4605341">roffset</span><span class="op" id="4605348">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605354">return</span>&nbsp;<span class="num" id="4605361">0</span><span class="op" id="4605362">,</span>&nbsp;<span class="ident" id="4605364">f</span><span class="op" id="4605365">.</span><span class="ident" id="4605366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605381">if</span>&nbsp;<span class="ident" id="4605384">n</span>&nbsp;<span class="op" id="4605386">&lt;=</span>&nbsp;<span class="ident" id="4605389">f</span><span class="op" id="4605390">.</span><span class="ident" id="4605391">nb</span>&nbsp;<span class="op" id="4605394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605399">f</span><span class="op" id="4605400">.</span><span class="ident" id="4605401">b</span>&nbsp;<span class="op" id="4605403">&gt;&gt;=</span>&nbsp;<span class="ident" id="4605407">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605412">f</span><span class="op" id="4605413">.</span><span class="ident" id="4605414">nb</span>&nbsp;<span class="op" id="4605417">-=</span>&nbsp;<span class="ident" id="4605420">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605425">return</span>&nbsp;<span class="builtintype" id="4605432">int</span><span class="op" id="4605435">(</span><span class="ident" id="4605436">chunk</span>&nbsp;<span class="op" id="4605442">&gt;&gt;</span>&nbsp;<span class="ident" id="4605445">huffmanValueShift</span><span class="op" id="4605462">)</span><span class="op" id="4605463">,</span>&nbsp;<span class="ident" id="4605465">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605474">}</span><br>
<span class="lineno"></span><span class="op" id="4605476">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4605479">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4605534">func</span>&nbsp;<span class="op" id="4605539">(</span><span class="ident" id="4605540">f</span>&nbsp;<span class="op" id="4605542">*</span><span class="ident" id="4605543">decompressor</span><span class="op" id="4605555">)</span>&nbsp;<span class="ident" id="4605557">flush</span><span class="op" id="4605562">(</span><span class="ident" id="4605563">step</span>&nbsp;<span class="keyword" id="4605568">func</span><span class="op" id="4605572">(</span><span class="op" id="4605573">*</span><span class="ident" id="4605574">decompressor</span><span class="op" id="4605586">)</span><span class="op" id="4605587">)</span>&nbsp;<span class="op" id="4605589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605592">f</span><span class="op" id="4605593">.</span><span class="ident" id="4605594">toRead</span>&nbsp;<span class="op" id="4605601">=</span>&nbsp;<span class="ident" id="4605603">f</span><span class="op" id="4605604">.</span><span class="ident" id="4605605">hist</span><span class="op" id="4605609">[</span><span class="ident" id="4605610">f</span><span class="op" id="4605611">.</span><span class="ident" id="4605612">hw</span><span class="op" id="4605614">:</span><span class="ident" id="4605615">f</span><span class="op" id="4605616">.</span><span class="ident" id="4605617">hp</span><span class="op" id="4605619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605622">f</span><span class="op" id="4605623">.</span><span class="ident" id="4605624">woffset</span>&nbsp;<span class="op" id="4605632">+=</span>&nbsp;<span class="ident" id="4605635">int64</span><span class="op" id="4605640">(</span><span class="ident" id="4605641">f</span><span class="op" id="4605642">.</span><span class="ident" id="4605643">hp</span>&nbsp;<span class="op" id="4605646">-</span>&nbsp;<span class="ident" id="4605648">f</span><span class="op" id="4605649">.</span><span class="ident" id="4605650">hw</span><span class="op" id="4605652">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605655">f</span><span class="op" id="4605656">.</span><span class="ident" id="4605657">hw</span>&nbsp;<span class="op" id="4605660">=</span>&nbsp;<span class="ident" id="4605662">f</span><span class="op" id="4605663">.</span><span class="ident" id="4605664">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605668">if</span>&nbsp;<span class="ident" id="4605671">f</span><span class="op" id="4605672">.</span><span class="ident" id="4605673">hp</span>&nbsp;<span class="op" id="4605676">==</span>&nbsp;<span class="builtinfunc" id="4605679">len</span><span class="op" id="4605682">(</span><span class="ident" id="4605683">f</span><span class="op" id="4605684">.</span><span class="ident" id="4605685">hist</span><span class="op" id="4605689">)</span>&nbsp;<span class="op" id="4605691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605695">f</span><span class="op" id="4605696">.</span><span class="ident" id="4605697">hp</span>&nbsp;<span class="op" id="4605700">=</span>&nbsp;<span class="num" id="4605702">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605706">f</span><span class="op" id="4605707">.</span><span class="ident" id="4605708">hw</span>&nbsp;<span class="op" id="4605711">=</span>&nbsp;<span class="num" id="4605713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605717">f</span><span class="op" id="4605718">.</span><span class="ident" id="4605719">hfull</span>&nbsp;<span class="op" id="4605725">=</span>&nbsp;<span class="builtintype" id="4605727">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605736">f</span><span class="op" id="4605737">.</span><span class="ident" id="4605738">step</span>&nbsp;<span class="op" id="4605743">=</span>&nbsp;<span class="ident" id="4605745">step</span><br>
<span class="lineno"></span><span class="op" id="4605750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4605753">func</span>&nbsp;<span class="ident" id="4605758">makeReader</span><span class="op" id="4605768">(</span><span class="ident" id="4605769">r</span>&nbsp;<span class="ident" id="4605771">io</span><span class="op" id="4605773">.</span><span class="ident" id="4605774">Reader</span><span class="op" id="4605780">)</span>&nbsp;<span class="ident" id="4605782">Reader</span>&nbsp;<span class="op" id="4605789">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605792">if</span>&nbsp;<span class="ident" id="4605795">rr</span><span class="op" id="4605797">,</span>&nbsp;<span class="ident" id="4605799">ok</span>&nbsp;<span class="op" id="4605802">:=</span>&nbsp;<span class="ident" id="4605805">r</span><span class="op" id="4605806">.</span><span class="op" id="4605807">(</span><span class="ident" id="4605808">Reader</span><span class="op" id="4605814">)</span><span class="op" id="4605815">;</span>&nbsp;<span class="ident" id="4605817">ok</span>&nbsp;<span class="op" id="4605820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605824">return</span>&nbsp;<span class="ident" id="4605831">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605838">return</span>&nbsp;<span class="ident" id="4605845">bufio</span><span class="op" id="4605850">.</span><span class="ident" id="4605851">NewReader</span><span class="op" id="4605860">(</span><span class="ident" id="4605861">r</span><span class="op" id="4605862">)</span><br>
<span class="lineno"></span><span class="op" id="4605864">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4605867">func</span>&nbsp;<span class="op" id="4605872">(</span><span class="ident" id="4605873">f</span>&nbsp;<span class="op" id="4605875">*</span><span class="ident" id="4605876">decompressor</span><span class="op" id="4605888">)</span>&nbsp;<span class="ident" id="4605890">Reset</span><span class="op" id="4605895">(</span><span class="ident" id="4605896">r</span>&nbsp;<span class="ident" id="4605898">io</span><span class="op" id="4605900">.</span><span class="ident" id="4605901">Reader</span><span class="op" id="4605907">,</span>&nbsp;<span class="ident" id="4605909">dict</span>&nbsp;<span class="op" id="4605914">[</span><span class="op" id="4605915">]</span><span class="builtintype" id="4605916">byte</span><span class="op" id="4605920">)</span>&nbsp;<span class="builtintype" id="4605922">error</span>&nbsp;<span class="op" id="4605928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605931">*</span><span class="ident" id="4605932">f</span>&nbsp;<span class="op" id="4605934">=</span>&nbsp;<span class="ident" id="4605936">decompressor</span><span class="op" id="4605948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605952">r</span><span class="op" id="4605953">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605962">makeReader</span><span class="op" id="4605972">(</span><span class="ident" id="4605973">r</span><span class="op" id="4605974">)</span><span class="op" id="4605975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605979">bits</span><span class="op" id="4605983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4605989">f</span><span class="op" id="4605990">.</span><span class="ident" id="4605991">bits</span><span class="op" id="4605995">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605999">codebits</span><span class="op" id="4606007">:</span>&nbsp;<span class="ident" id="4606009">f</span><span class="op" id="4606010">.</span><span class="ident" id="4606011">codebits</span><span class="op" id="4606019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606023">hist</span><span class="op" id="4606027">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4606033">f</span><span class="op" id="4606034">.</span><span class="ident" id="4606035">hist</span><span class="op" id="4606039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606043">step</span><span class="op" id="4606047">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606053">(</span><span class="op" id="4606054">*</span><span class="ident" id="4606055">decompressor</span><span class="op" id="4606067">)</span><span class="op" id="4606068">.</span><span class="ident" id="4606069">nextBlock</span><span class="op" id="4606078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4606081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606084">if</span>&nbsp;<span class="ident" id="4606087">dict</span>&nbsp;<span class="op" id="4606092">!=</span>&nbsp;<span class="ident" id="4606095">nil</span>&nbsp;<span class="op" id="4606099">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606103">f</span><span class="op" id="4606104">.</span><span class="ident" id="4606105">setDict</span><span class="op" id="4606112">(</span><span class="ident" id="4606113">dict</span><span class="op" id="4606117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4606120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606123">return</span>&nbsp;<span class="ident" id="4606130">nil</span><br>
<span class="lineno"></span><span class="op" id="4606134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4606137">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4606192">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4606234">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4606281">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4606343">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4606412">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4606438">//</span><br>
<span class="lineno"></span><span class="comment" id="4606441">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4606507">func</span>&nbsp;<span class="ident" id="4606512">NewReader</span><span class="op" id="4606521">(</span><span class="ident" id="4606522">r</span>&nbsp;<span class="ident" id="4606524">io</span><span class="op" id="4606526">.</span><span class="ident" id="4606527">Reader</span><span class="op" id="4606533">)</span>&nbsp;<span class="ident" id="4606535">io</span><span class="op" id="4606537">.</span><span class="ident" id="4606538">ReadCloser</span>&nbsp;<span class="op" id="4606549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606552">var</span>&nbsp;<span class="ident" id="4606556">f</span>&nbsp;<span class="ident" id="4606558">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606572">f</span><span class="op" id="4606573">.</span><span class="ident" id="4606574">bits</span>&nbsp;<span class="op" id="4606579">=</span>&nbsp;<span class="builtinfunc" id="4606581">new</span><span class="op" id="4606584">(</span><span class="op" id="4606585">[</span><span class="ident" id="4606586">maxLit</span>&nbsp;<span class="op" id="4606593">+</span>&nbsp;<span class="ident" id="4606595">maxDist</span><span class="op" id="4606602">]</span><span class="builtintype" id="4606603">int</span><span class="op" id="4606606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606609">f</span><span class="op" id="4606610">.</span><span class="ident" id="4606611">codebits</span>&nbsp;<span class="op" id="4606620">=</span>&nbsp;<span class="builtinfunc" id="4606622">new</span><span class="op" id="4606625">(</span><span class="op" id="4606626">[</span><span class="ident" id="4606627">numCodes</span><span class="op" id="4606635">]</span><span class="builtintype" id="4606636">int</span><span class="op" id="4606639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606642">f</span><span class="op" id="4606643">.</span><span class="ident" id="4606644">r</span>&nbsp;<span class="op" id="4606646">=</span>&nbsp;<span class="ident" id="4606648">makeReader</span><span class="op" id="4606658">(</span><span class="ident" id="4606659">r</span><span class="op" id="4606660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606663">f</span><span class="op" id="4606664">.</span><span class="ident" id="4606665">hist</span>&nbsp;<span class="op" id="4606670">=</span>&nbsp;<span class="builtinfunc" id="4606672">new</span><span class="op" id="4606675">(</span><span class="op" id="4606676">[</span><span class="ident" id="4606677">maxHist</span><span class="op" id="4606684">]</span><span class="builtintype" id="4606685">byte</span><span class="op" id="4606689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606692">f</span><span class="op" id="4606693">.</span><span class="ident" id="4606694">step</span>&nbsp;<span class="op" id="4606699">=</span>&nbsp;<span class="op" id="4606701">(</span><span class="op" id="4606702">*</span><span class="ident" id="4606703">decompressor</span><span class="op" id="4606715">)</span><span class="op" id="4606716">.</span><span class="ident" id="4606717">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606728">return</span>&nbsp;<span class="op" id="4606735">&amp;</span><span class="ident" id="4606736">f</span><br>
<span class="lineno"></span><span class="op" id="4606738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4606741">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4606803">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4606867">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4606934">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4606999">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4607044">//</span><br>
<span class="lineno"></span><span class="comment" id="4607047">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4607113">func</span>&nbsp;<span class="ident" id="4607118">NewReaderDict</span><span class="op" id="4607131">(</span><span class="ident" id="4607132">r</span>&nbsp;<span class="ident" id="4607134">io</span><span class="op" id="4607136">.</span><span class="ident" id="4607137">Reader</span><span class="op" id="4607143">,</span>&nbsp;<span class="ident" id="4607145">dict</span>&nbsp;<span class="op" id="4607150">[</span><span class="op" id="4607151">]</span><span class="builtintype" id="4607152">byte</span><span class="op" id="4607156">)</span>&nbsp;<span class="ident" id="4607158">io</span><span class="op" id="4607160">.</span><span class="ident" id="4607161">ReadCloser</span>&nbsp;<span class="op" id="4607172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4607175">var</span>&nbsp;<span class="ident" id="4607179">f</span>&nbsp;<span class="ident" id="4607181">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607195">f</span><span class="op" id="4607196">.</span><span class="ident" id="4607197">r</span>&nbsp;<span class="op" id="4607199">=</span>&nbsp;<span class="ident" id="4607201">makeReader</span><span class="op" id="4607211">(</span><span class="ident" id="4607212">r</span><span class="op" id="4607213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607216">f</span><span class="op" id="4607217">.</span><span class="ident" id="4607218">hist</span>&nbsp;<span class="op" id="4607223">=</span>&nbsp;<span class="builtinfunc" id="4607225">new</span><span class="op" id="4607228">(</span><span class="op" id="4607229">[</span><span class="ident" id="4607230">maxHist</span><span class="op" id="4607237">]</span><span class="builtintype" id="4607238">byte</span><span class="op" id="4607242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607245">f</span><span class="op" id="4607246">.</span><span class="ident" id="4607247">bits</span>&nbsp;<span class="op" id="4607252">=</span>&nbsp;<span class="builtinfunc" id="4607254">new</span><span class="op" id="4607257">(</span><span class="op" id="4607258">[</span><span class="ident" id="4607259">maxLit</span>&nbsp;<span class="op" id="4607266">+</span>&nbsp;<span class="ident" id="4607268">maxDist</span><span class="op" id="4607275">]</span><span class="builtintype" id="4607276">int</span><span class="op" id="4607279">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607282">f</span><span class="op" id="4607283">.</span><span class="ident" id="4607284">codebits</span>&nbsp;<span class="op" id="4607293">=</span>&nbsp;<span class="builtinfunc" id="4607295">new</span><span class="op" id="4607298">(</span><span class="op" id="4607299">[</span><span class="ident" id="4607300">numCodes</span><span class="op" id="4607308">]</span><span class="builtintype" id="4607309">int</span><span class="op" id="4607312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607315">f</span><span class="op" id="4607316">.</span><span class="ident" id="4607317">step</span>&nbsp;<span class="op" id="4607322">=</span>&nbsp;<span class="op" id="4607324">(</span><span class="op" id="4607325">*</span><span class="ident" id="4607326">decompressor</span><span class="op" id="4607338">)</span><span class="op" id="4607339">.</span><span class="ident" id="4607340">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607351">f</span><span class="op" id="4607352">.</span><span class="ident" id="4607353">setDict</span><span class="op" id="4607360">(</span><span class="ident" id="4607361">dict</span><span class="op" id="4607365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4607368">return</span>&nbsp;<span class="op" id="4607375">&amp;</span><span class="ident" id="4607376">f</span><br>
<span class="lineno"></span><span class="op" id="4607378">}</span>
</div>
</body>
</html>
