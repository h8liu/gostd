<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5666150">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5666205">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5666259">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5666310">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5666384">package</span>&nbsp;<span class="ident" id="5666392">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666398">import</span>&nbsp;<span class="op" id="5666405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666408">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666417">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666428">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5666443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666446">type</span>&nbsp;<span class="ident" id="5666451">writer</span>&nbsp;<span class="keyword" id="5666458">interface</span>&nbsp;<span class="op" id="5666468">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666471">WriteString</span><span class="op" id="5666482">(</span><span class="builtintype" id="5666483">string</span><span class="op" id="5666489">)</span>&nbsp;<span class="op" id="5666491">(</span><span class="builtintype" id="5666492">int</span><span class="op" id="5666495">,</span>&nbsp;<span class="builtintype" id="5666497">error</span><span class="op" id="5666502">)</span><br>
<span class="lineno"></span><span class="op" id="5666504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5666507">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5666581">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5666615">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5666726">var</span>&nbsp;<span class="ident" id="5666730">replacementTable</span>&nbsp;<span class="op" id="5666747">=</span>&nbsp;<span class="op" id="5666749">[</span><span class="op" id="5666750">...</span><span class="op" id="5666753">]</span><span class="builtintype" id="5666754">rune</span><span class="op" id="5666758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666761">&#39;\u20AC&#39;</span><span class="op" id="5666769">,</span>&nbsp;<span class="comment" id="5666771">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666825">&#39;\u0081&#39;</span><span class="op" id="5666833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666836">&#39;\u201A&#39;</span><span class="op" id="5666844">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666847">&#39;\u0192&#39;</span><span class="op" id="5666855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666858">&#39;\u201E&#39;</span><span class="op" id="5666866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666869">&#39;\u2026&#39;</span><span class="op" id="5666877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666880">&#39;\u2020&#39;</span><span class="op" id="5666888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666891">&#39;\u2021&#39;</span><span class="op" id="5666899">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666902">&#39;\u02C6&#39;</span><span class="op" id="5666910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666913">&#39;\u2030&#39;</span><span class="op" id="5666921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666924">&#39;\u0160&#39;</span><span class="op" id="5666932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666935">&#39;\u2039&#39;</span><span class="op" id="5666943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666946">&#39;\u0152&#39;</span><span class="op" id="5666954">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666957">&#39;\u008D&#39;</span><span class="op" id="5666965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666968">&#39;\u017D&#39;</span><span class="op" id="5666976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666979">&#39;\u008F&#39;</span><span class="op" id="5666987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5666990">&#39;\u0090&#39;</span><span class="op" id="5666998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667001">&#39;\u2018&#39;</span><span class="op" id="5667009">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667012">&#39;\u2019&#39;</span><span class="op" id="5667020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667023">&#39;\u201C&#39;</span><span class="op" id="5667031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667034">&#39;\u201D&#39;</span><span class="op" id="5667042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667045">&#39;\u2022&#39;</span><span class="op" id="5667053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667056">&#39;\u2013&#39;</span><span class="op" id="5667064">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667067">&#39;\u2014&#39;</span><span class="op" id="5667075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667078">&#39;\u02DC&#39;</span><span class="op" id="5667086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667089">&#39;\u2122&#39;</span><span class="op" id="5667097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667100">&#39;\u0161&#39;</span><span class="op" id="5667108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667111">&#39;\u203A&#39;</span><span class="op" id="5667119">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667122">&#39;\u0153&#39;</span><span class="op" id="5667130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667133">&#39;\u009D&#39;</span><span class="op" id="5667141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667144">&#39;\u017E&#39;</span><span class="op" id="5667152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5667155">&#39;\u0178&#39;</span><span class="op" id="5667163">,</span>&nbsp;<span class="comment" id="5667165">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667189">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667237">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5667267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5667270">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5667344">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5667424">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5667470">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5667529">func</span>&nbsp;<span class="ident" id="5667534">unescapeEntity</span><span class="op" id="5667548">(</span><span class="ident" id="5667549">b</span>&nbsp;<span class="op" id="5667551">[</span><span class="op" id="5667552">]</span><span class="builtintype" id="5667553">byte</span><span class="op" id="5667557">,</span>&nbsp;<span class="ident" id="5667559">dst</span><span class="op" id="5667562">,</span>&nbsp;<span class="ident" id="5667564">src</span>&nbsp;<span class="builtintype" id="5667568">int</span><span class="op" id="5667571">,</span>&nbsp;<span class="ident" id="5667573">attribute</span>&nbsp;<span class="builtintype" id="5667583">bool</span><span class="op" id="5667587">)</span>&nbsp;<span class="op" id="5667589">(</span><span class="ident" id="5667590">dst1</span><span class="op" id="5667594">,</span>&nbsp;<span class="ident" id="5667596">src1</span>&nbsp;<span class="builtintype" id="5667601">int</span><span class="op" id="5667604">)</span>&nbsp;<span class="op" id="5667606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667609">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667722">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667782">i</span><span class="op" id="5667783">,</span>&nbsp;<span class="ident" id="5667785">s</span>&nbsp;<span class="op" id="5667787">:=</span>&nbsp;<span class="num" id="5667790">1</span><span class="op" id="5667791">,</span>&nbsp;<span class="ident" id="5667793">b</span><span class="op" id="5667794">[</span><span class="ident" id="5667795">src</span><span class="op" id="5667798">:</span><span class="op" id="5667799">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667803">if</span>&nbsp;<span class="builtinfunc" id="5667806">len</span><span class="op" id="5667809">(</span><span class="ident" id="5667810">s</span><span class="op" id="5667811">)</span>&nbsp;<span class="op" id="5667813">&lt;=</span>&nbsp;<span class="num" id="5667816">1</span>&nbsp;<span class="op" id="5667818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667822">b</span><span class="op" id="5667823">[</span><span class="ident" id="5667824">dst</span><span class="op" id="5667827">]</span>&nbsp;<span class="op" id="5667829">=</span>&nbsp;<span class="ident" id="5667831">b</span><span class="op" id="5667832">[</span><span class="ident" id="5667833">src</span><span class="op" id="5667836">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667840">return</span>&nbsp;<span class="ident" id="5667847">dst</span>&nbsp;<span class="op" id="5667851">+</span>&nbsp;<span class="num" id="5667853">1</span><span class="op" id="5667854">,</span>&nbsp;<span class="ident" id="5667856">src</span>&nbsp;<span class="op" id="5667860">+</span>&nbsp;<span class="num" id="5667862">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667869">if</span>&nbsp;<span class="ident" id="5667872">s</span><span class="op" id="5667873">[</span><span class="ident" id="5667874">i</span><span class="op" id="5667875">]</span>&nbsp;<span class="op" id="5667877">==</span>&nbsp;<span class="string" id="5667880">&#39;#&#39;</span>&nbsp;<span class="op" id="5667884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667888">if</span>&nbsp;<span class="builtinfunc" id="5667891">len</span><span class="op" id="5667894">(</span><span class="ident" id="5667895">s</span><span class="op" id="5667896">)</span>&nbsp;<span class="op" id="5667898">&lt;=</span>&nbsp;<span class="num" id="5667901">3</span>&nbsp;<span class="op" id="5667903">{</span>&nbsp;<span class="comment" id="5667905">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667943">b</span><span class="op" id="5667944">[</span><span class="ident" id="5667945">dst</span><span class="op" id="5667948">]</span>&nbsp;<span class="op" id="5667950">=</span>&nbsp;<span class="ident" id="5667952">b</span><span class="op" id="5667953">[</span><span class="ident" id="5667954">src</span><span class="op" id="5667957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667962">return</span>&nbsp;<span class="ident" id="5667969">dst</span>&nbsp;<span class="op" id="5667973">+</span>&nbsp;<span class="num" id="5667975">1</span><span class="op" id="5667976">,</span>&nbsp;<span class="ident" id="5667978">src</span>&nbsp;<span class="op" id="5667982">+</span>&nbsp;<span class="num" id="5667984">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667992">i</span><span class="op" id="5667993">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667998">c</span>&nbsp;<span class="op" id="5668000">:=</span>&nbsp;<span class="ident" id="5668003">s</span><span class="op" id="5668004">[</span><span class="ident" id="5668005">i</span><span class="op" id="5668006">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668010">hex</span>&nbsp;<span class="op" id="5668014">:=</span>&nbsp;<span class="builtintype" id="5668017">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668025">if</span>&nbsp;<span class="ident" id="5668028">c</span>&nbsp;<span class="op" id="5668030">==</span>&nbsp;<span class="string" id="5668033">&#39;x&#39;</span>&nbsp;<span class="op" id="5668037">||</span>&nbsp;<span class="ident" id="5668040">c</span>&nbsp;<span class="op" id="5668042">==</span>&nbsp;<span class="string" id="5668045">&#39;X&#39;</span>&nbsp;<span class="op" id="5668049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668054">hex</span>&nbsp;<span class="op" id="5668058">=</span>&nbsp;<span class="builtintype" id="5668060">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668068">i</span><span class="op" id="5668069">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668074">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668079">x</span>&nbsp;<span class="op" id="5668081">:=</span>&nbsp;<span class="string" id="5668084">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668093">for</span>&nbsp;<span class="ident" id="5668097">i</span>&nbsp;<span class="op" id="5668099">&lt;</span>&nbsp;<span class="builtinfunc" id="5668101">len</span><span class="op" id="5668104">(</span><span class="ident" id="5668105">s</span><span class="op" id="5668106">)</span>&nbsp;<span class="op" id="5668108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668113">c</span>&nbsp;<span class="op" id="5668115">=</span>&nbsp;<span class="ident" id="5668117">s</span><span class="op" id="5668118">[</span><span class="ident" id="5668119">i</span><span class="op" id="5668120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668125">i</span><span class="op" id="5668126">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668132">if</span>&nbsp;<span class="ident" id="5668135">hex</span>&nbsp;<span class="op" id="5668139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668145">if</span>&nbsp;<span class="string" id="5668148">&#39;0&#39;</span>&nbsp;<span class="op" id="5668152">&lt;=</span>&nbsp;<span class="ident" id="5668155">c</span>&nbsp;<span class="op" id="5668157">&amp;&amp;</span>&nbsp;<span class="ident" id="5668160">c</span>&nbsp;<span class="op" id="5668162">&lt;=</span>&nbsp;<span class="string" id="5668165">&#39;9&#39;</span>&nbsp;<span class="op" id="5668169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668176">x</span>&nbsp;<span class="op" id="5668178">=</span>&nbsp;<span class="num" id="5668180">16</span><span class="op" id="5668182">*</span><span class="ident" id="5668183">x</span>&nbsp;<span class="op" id="5668185">+</span>&nbsp;<span class="builtintype" id="5668187">rune</span><span class="op" id="5668191">(</span><span class="ident" id="5668192">c</span><span class="op" id="5668193">)</span>&nbsp;<span class="op" id="5668195">-</span>&nbsp;<span class="string" id="5668197">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668206">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668219">}</span>&nbsp;<span class="keyword" id="5668221">else</span>&nbsp;<span class="keyword" id="5668226">if</span>&nbsp;<span class="string" id="5668229">&#39;a&#39;</span>&nbsp;<span class="op" id="5668233">&lt;=</span>&nbsp;<span class="ident" id="5668236">c</span>&nbsp;<span class="op" id="5668238">&amp;&amp;</span>&nbsp;<span class="ident" id="5668241">c</span>&nbsp;<span class="op" id="5668243">&lt;=</span>&nbsp;<span class="string" id="5668246">&#39;f&#39;</span>&nbsp;<span class="op" id="5668250">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668257">x</span>&nbsp;<span class="op" id="5668259">=</span>&nbsp;<span class="num" id="5668261">16</span><span class="op" id="5668263">*</span><span class="ident" id="5668264">x</span>&nbsp;<span class="op" id="5668266">+</span>&nbsp;<span class="builtintype" id="5668268">rune</span><span class="op" id="5668272">(</span><span class="ident" id="5668273">c</span><span class="op" id="5668274">)</span>&nbsp;<span class="op" id="5668276">-</span>&nbsp;<span class="string" id="5668278">&#39;a&#39;</span>&nbsp;<span class="op" id="5668282">+</span>&nbsp;<span class="num" id="5668284">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668292">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668305">}</span>&nbsp;<span class="keyword" id="5668307">else</span>&nbsp;<span class="keyword" id="5668312">if</span>&nbsp;<span class="string" id="5668315">&#39;A&#39;</span>&nbsp;<span class="op" id="5668319">&lt;=</span>&nbsp;<span class="ident" id="5668322">c</span>&nbsp;<span class="op" id="5668324">&amp;&amp;</span>&nbsp;<span class="ident" id="5668327">c</span>&nbsp;<span class="op" id="5668329">&lt;=</span>&nbsp;<span class="string" id="5668332">&#39;F&#39;</span>&nbsp;<span class="op" id="5668336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668343">x</span>&nbsp;<span class="op" id="5668345">=</span>&nbsp;<span class="num" id="5668347">16</span><span class="op" id="5668349">*</span><span class="ident" id="5668350">x</span>&nbsp;<span class="op" id="5668352">+</span>&nbsp;<span class="builtintype" id="5668354">rune</span><span class="op" id="5668358">(</span><span class="ident" id="5668359">c</span><span class="op" id="5668360">)</span>&nbsp;<span class="op" id="5668362">-</span>&nbsp;<span class="string" id="5668364">&#39;A&#39;</span>&nbsp;<span class="op" id="5668368">+</span>&nbsp;<span class="num" id="5668370">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668378">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668396">}</span>&nbsp;<span class="keyword" id="5668398">else</span>&nbsp;<span class="keyword" id="5668403">if</span>&nbsp;<span class="string" id="5668406">&#39;0&#39;</span>&nbsp;<span class="op" id="5668410">&lt;=</span>&nbsp;<span class="ident" id="5668413">c</span>&nbsp;<span class="op" id="5668415">&amp;&amp;</span>&nbsp;<span class="ident" id="5668418">c</span>&nbsp;<span class="op" id="5668420">&lt;=</span>&nbsp;<span class="string" id="5668423">&#39;9&#39;</span>&nbsp;<span class="op" id="5668427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668433">x</span>&nbsp;<span class="op" id="5668435">=</span>&nbsp;<span class="num" id="5668437">10</span><span class="op" id="5668439">*</span><span class="ident" id="5668440">x</span>&nbsp;<span class="op" id="5668442">+</span>&nbsp;<span class="builtintype" id="5668444">rune</span><span class="op" id="5668448">(</span><span class="ident" id="5668449">c</span><span class="op" id="5668450">)</span>&nbsp;<span class="op" id="5668452">-</span>&nbsp;<span class="string" id="5668454">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668462">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668474">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668479">if</span>&nbsp;<span class="ident" id="5668482">c</span>&nbsp;<span class="op" id="5668484">!=</span>&nbsp;<span class="string" id="5668487">&#39;;&#39;</span>&nbsp;<span class="op" id="5668491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668497">i</span><span class="op" id="5668498">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668509">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668517">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668522">if</span>&nbsp;<span class="ident" id="5668525">i</span>&nbsp;<span class="op" id="5668527">&lt;=</span>&nbsp;<span class="num" id="5668530">3</span>&nbsp;<span class="op" id="5668532">{</span>&nbsp;<span class="comment" id="5668534">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668563">b</span><span class="op" id="5668564">[</span><span class="ident" id="5668565">dst</span><span class="op" id="5668568">]</span>&nbsp;<span class="op" id="5668570">=</span>&nbsp;<span class="ident" id="5668572">b</span><span class="op" id="5668573">[</span><span class="ident" id="5668574">src</span><span class="op" id="5668577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668582">return</span>&nbsp;<span class="ident" id="5668589">dst</span>&nbsp;<span class="op" id="5668593">+</span>&nbsp;<span class="num" id="5668595">1</span><span class="op" id="5668596">,</span>&nbsp;<span class="ident" id="5668598">src</span>&nbsp;<span class="op" id="5668602">+</span>&nbsp;<span class="num" id="5668604">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668608">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668613">if</span>&nbsp;<span class="num" id="5668616">0x80</span>&nbsp;<span class="op" id="5668621">&lt;=</span>&nbsp;<span class="ident" id="5668624">x</span>&nbsp;<span class="op" id="5668626">&amp;&amp;</span>&nbsp;<span class="ident" id="5668629">x</span>&nbsp;<span class="op" id="5668631">&lt;=</span>&nbsp;<span class="num" id="5668634">0x9F</span>&nbsp;<span class="op" id="5668639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668644">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668711">x</span>&nbsp;<span class="op" id="5668713">=</span>&nbsp;<span class="ident" id="5668715">replacementTable</span><span class="op" id="5668731">[</span><span class="ident" id="5668732">x</span><span class="op" id="5668733">-</span><span class="num" id="5668734">0x80</span><span class="op" id="5668738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668742">}</span>&nbsp;<span class="keyword" id="5668744">else</span>&nbsp;<span class="keyword" id="5668749">if</span>&nbsp;<span class="ident" id="5668752">x</span>&nbsp;<span class="op" id="5668754">==</span>&nbsp;<span class="num" id="5668757">0</span>&nbsp;<span class="op" id="5668759">||</span>&nbsp;<span class="op" id="5668762">(</span><span class="num" id="5668763">0xD800</span>&nbsp;<span class="op" id="5668770">&lt;=</span>&nbsp;<span class="ident" id="5668773">x</span>&nbsp;<span class="op" id="5668775">&amp;&amp;</span>&nbsp;<span class="ident" id="5668778">x</span>&nbsp;<span class="op" id="5668780">&lt;=</span>&nbsp;<span class="num" id="5668783">0xDFFF</span><span class="op" id="5668789">)</span>&nbsp;<span class="op" id="5668791">||</span>&nbsp;<span class="ident" id="5668794">x</span>&nbsp;<span class="op" id="5668796">&gt;</span>&nbsp;<span class="num" id="5668798">0x10FFFF</span>&nbsp;<span class="op" id="5668807">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668812">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668877">x</span>&nbsp;<span class="op" id="5668879">=</span>&nbsp;<span class="string" id="5668881">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668897">return</span>&nbsp;<span class="ident" id="5668904">dst</span>&nbsp;<span class="op" id="5668908">+</span>&nbsp;<span class="ident" id="5668910">utf8</span><span class="op" id="5668914">.</span><span class="ident" id="5668915">EncodeRune</span><span class="op" id="5668925">(</span><span class="ident" id="5668926">b</span><span class="op" id="5668927">[</span><span class="ident" id="5668928">dst</span><span class="op" id="5668931">:</span><span class="op" id="5668932">]</span><span class="op" id="5668933">,</span>&nbsp;<span class="ident" id="5668935">x</span><span class="op" id="5668936">)</span><span class="op" id="5668937">,</span>&nbsp;<span class="ident" id="5668939">src</span>&nbsp;<span class="op" id="5668943">+</span>&nbsp;<span class="ident" id="5668945">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668952">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669016">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669079">for</span>&nbsp;<span class="ident" id="5669083">i</span>&nbsp;<span class="op" id="5669085">&lt;</span>&nbsp;<span class="builtinfunc" id="5669087">len</span><span class="op" id="5669090">(</span><span class="ident" id="5669091">s</span><span class="op" id="5669092">)</span>&nbsp;<span class="op" id="5669094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669098">c</span>&nbsp;<span class="op" id="5669100">:=</span>&nbsp;<span class="ident" id="5669103">s</span><span class="op" id="5669104">[</span><span class="ident" id="5669105">i</span><span class="op" id="5669106">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669110">i</span><span class="op" id="5669111">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669116">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669201">if</span>&nbsp;<span class="string" id="5669204">&#39;a&#39;</span>&nbsp;<span class="op" id="5669208">&lt;=</span>&nbsp;<span class="ident" id="5669211">c</span>&nbsp;<span class="op" id="5669213">&amp;&amp;</span>&nbsp;<span class="ident" id="5669216">c</span>&nbsp;<span class="op" id="5669218">&lt;=</span>&nbsp;<span class="string" id="5669221">&#39;z&#39;</span>&nbsp;<span class="op" id="5669225">||</span>&nbsp;<span class="string" id="5669228">&#39;A&#39;</span>&nbsp;<span class="op" id="5669232">&lt;=</span>&nbsp;<span class="ident" id="5669235">c</span>&nbsp;<span class="op" id="5669237">&amp;&amp;</span>&nbsp;<span class="ident" id="5669240">c</span>&nbsp;<span class="op" id="5669242">&lt;=</span>&nbsp;<span class="string" id="5669245">&#39;Z&#39;</span>&nbsp;<span class="op" id="5669249">||</span>&nbsp;<span class="string" id="5669252">&#39;0&#39;</span>&nbsp;<span class="op" id="5669256">&lt;=</span>&nbsp;<span class="ident" id="5669259">c</span>&nbsp;<span class="op" id="5669261">&amp;&amp;</span>&nbsp;<span class="ident" id="5669264">c</span>&nbsp;<span class="op" id="5669266">&lt;=</span>&nbsp;<span class="string" id="5669269">&#39;9&#39;</span>&nbsp;<span class="op" id="5669273">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669278">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669293">if</span>&nbsp;<span class="ident" id="5669296">c</span>&nbsp;<span class="op" id="5669298">!=</span>&nbsp;<span class="string" id="5669301">&#39;;&#39;</span>&nbsp;<span class="op" id="5669305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669310">i</span><span class="op" id="5669311">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669316">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669320">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669331">entityName</span>&nbsp;<span class="op" id="5669342">:=</span>&nbsp;<span class="builtintype" id="5669345">string</span><span class="op" id="5669351">(</span><span class="ident" id="5669352">s</span><span class="op" id="5669353">[</span><span class="num" id="5669354">1</span><span class="op" id="5669355">:</span><span class="ident" id="5669356">i</span><span class="op" id="5669357">]</span><span class="op" id="5669358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669361">if</span>&nbsp;<span class="ident" id="5669364">entityName</span>&nbsp;<span class="op" id="5669375">==</span>&nbsp;<span class="string" id="5669378">&#34;&#34;</span>&nbsp;<span class="op" id="5669381">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669385">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669396">}</span>&nbsp;<span class="keyword" id="5669398">else</span>&nbsp;<span class="keyword" id="5669403">if</span>&nbsp;<span class="ident" id="5669406">attribute</span>&nbsp;<span class="op" id="5669416">&amp;&amp;</span>&nbsp;<span class="ident" id="5669419">entityName</span><span class="op" id="5669429">[</span><span class="builtinfunc" id="5669430">len</span><span class="op" id="5669433">(</span><span class="ident" id="5669434">entityName</span><span class="op" id="5669444">)</span><span class="op" id="5669445">-</span><span class="num" id="5669446">1</span><span class="op" id="5669447">]</span>&nbsp;<span class="op" id="5669449">!=</span>&nbsp;<span class="string" id="5669452">&#39;;&#39;</span>&nbsp;<span class="op" id="5669456">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5669459">len</span><span class="op" id="5669462">(</span><span class="ident" id="5669463">s</span><span class="op" id="5669464">)</span>&nbsp;<span class="op" id="5669466">&gt;</span>&nbsp;<span class="ident" id="5669468">i</span>&nbsp;<span class="op" id="5669470">&amp;&amp;</span>&nbsp;<span class="ident" id="5669473">s</span><span class="op" id="5669474">[</span><span class="ident" id="5669475">i</span><span class="op" id="5669476">]</span>&nbsp;<span class="op" id="5669478">==</span>&nbsp;<span class="string" id="5669481">&#39;=&#39;</span>&nbsp;<span class="op" id="5669485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669489">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669500">}</span>&nbsp;<span class="keyword" id="5669502">else</span>&nbsp;<span class="keyword" id="5669507">if</span>&nbsp;<span class="ident" id="5669510">x</span>&nbsp;<span class="op" id="5669512">:=</span>&nbsp;<span class="ident" id="5669515">entity</span><span class="op" id="5669521">[</span><span class="ident" id="5669522">entityName</span><span class="op" id="5669532">]</span><span class="op" id="5669533">;</span>&nbsp;<span class="ident" id="5669535">x</span>&nbsp;<span class="op" id="5669537">!=</span>&nbsp;<span class="num" id="5669540">0</span>&nbsp;<span class="op" id="5669542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669546">return</span>&nbsp;<span class="ident" id="5669553">dst</span>&nbsp;<span class="op" id="5669557">+</span>&nbsp;<span class="ident" id="5669559">utf8</span><span class="op" id="5669563">.</span><span class="ident" id="5669564">EncodeRune</span><span class="op" id="5669574">(</span><span class="ident" id="5669575">b</span><span class="op" id="5669576">[</span><span class="ident" id="5669577">dst</span><span class="op" id="5669580">:</span><span class="op" id="5669581">]</span><span class="op" id="5669582">,</span>&nbsp;<span class="ident" id="5669584">x</span><span class="op" id="5669585">)</span><span class="op" id="5669586">,</span>&nbsp;<span class="ident" id="5669588">src</span>&nbsp;<span class="op" id="5669592">+</span>&nbsp;<span class="ident" id="5669594">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669597">}</span>&nbsp;<span class="keyword" id="5669599">else</span>&nbsp;<span class="keyword" id="5669604">if</span>&nbsp;<span class="ident" id="5669607">x</span>&nbsp;<span class="op" id="5669609">:=</span>&nbsp;<span class="ident" id="5669612">entity2</span><span class="op" id="5669619">[</span><span class="ident" id="5669620">entityName</span><span class="op" id="5669630">]</span><span class="op" id="5669631">;</span>&nbsp;<span class="ident" id="5669633">x</span><span class="op" id="5669634">[</span><span class="num" id="5669635">0</span><span class="op" id="5669636">]</span>&nbsp;<span class="op" id="5669638">!=</span>&nbsp;<span class="num" id="5669641">0</span>&nbsp;<span class="op" id="5669643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669647">dst1</span>&nbsp;<span class="op" id="5669652">:=</span>&nbsp;<span class="ident" id="5669655">dst</span>&nbsp;<span class="op" id="5669659">+</span>&nbsp;<span class="ident" id="5669661">utf8</span><span class="op" id="5669665">.</span><span class="ident" id="5669666">EncodeRune</span><span class="op" id="5669676">(</span><span class="ident" id="5669677">b</span><span class="op" id="5669678">[</span><span class="ident" id="5669679">dst</span><span class="op" id="5669682">:</span><span class="op" id="5669683">]</span><span class="op" id="5669684">,</span>&nbsp;<span class="ident" id="5669686">x</span><span class="op" id="5669687">[</span><span class="num" id="5669688">0</span><span class="op" id="5669689">]</span><span class="op" id="5669690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669694">return</span>&nbsp;<span class="ident" id="5669701">dst1</span>&nbsp;<span class="op" id="5669706">+</span>&nbsp;<span class="ident" id="5669708">utf8</span><span class="op" id="5669712">.</span><span class="ident" id="5669713">EncodeRune</span><span class="op" id="5669723">(</span><span class="ident" id="5669724">b</span><span class="op" id="5669725">[</span><span class="ident" id="5669726">dst1</span><span class="op" id="5669730">:</span><span class="op" id="5669731">]</span><span class="op" id="5669732">,</span>&nbsp;<span class="ident" id="5669734">x</span><span class="op" id="5669735">[</span><span class="num" id="5669736">1</span><span class="op" id="5669737">]</span><span class="op" id="5669738">)</span><span class="op" id="5669739">,</span>&nbsp;<span class="ident" id="5669741">src</span>&nbsp;<span class="op" id="5669745">+</span>&nbsp;<span class="ident" id="5669747">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669750">}</span>&nbsp;<span class="keyword" id="5669752">else</span>&nbsp;<span class="keyword" id="5669757">if</span>&nbsp;<span class="op" id="5669760">!</span><span class="ident" id="5669761">attribute</span>&nbsp;<span class="op" id="5669771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669775">maxLen</span>&nbsp;<span class="op" id="5669782">:=</span>&nbsp;<span class="builtinfunc" id="5669785">len</span><span class="op" id="5669788">(</span><span class="ident" id="5669789">entityName</span><span class="op" id="5669799">)</span>&nbsp;<span class="op" id="5669801">-</span>&nbsp;<span class="num" id="5669803">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669807">if</span>&nbsp;<span class="ident" id="5669810">maxLen</span>&nbsp;<span class="op" id="5669817">&gt;</span>&nbsp;<span class="ident" id="5669819">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5669849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669854">maxLen</span>&nbsp;<span class="op" id="5669861">=</span>&nbsp;<span class="ident" id="5669863">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669899">for</span>&nbsp;<span class="ident" id="5669903">j</span>&nbsp;<span class="op" id="5669905">:=</span>&nbsp;<span class="ident" id="5669908">maxLen</span><span class="op" id="5669914">;</span>&nbsp;<span class="ident" id="5669916">j</span>&nbsp;<span class="op" id="5669918">&gt;</span>&nbsp;<span class="num" id="5669920">1</span><span class="op" id="5669921">;</span>&nbsp;<span class="ident" id="5669923">j</span><span class="op" id="5669924">--</span>&nbsp;<span class="op" id="5669927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669932">if</span>&nbsp;<span class="ident" id="5669935">x</span>&nbsp;<span class="op" id="5669937">:=</span>&nbsp;<span class="ident" id="5669940">entity</span><span class="op" id="5669946">[</span><span class="ident" id="5669947">entityName</span><span class="op" id="5669957">[</span><span class="op" id="5669958">:</span><span class="ident" id="5669959">j</span><span class="op" id="5669960">]</span><span class="op" id="5669961">]</span><span class="op" id="5669962">;</span>&nbsp;<span class="ident" id="5669964">x</span>&nbsp;<span class="op" id="5669966">!=</span>&nbsp;<span class="num" id="5669969">0</span>&nbsp;<span class="op" id="5669971">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669977">return</span>&nbsp;<span class="ident" id="5669984">dst</span>&nbsp;<span class="op" id="5669988">+</span>&nbsp;<span class="ident" id="5669990">utf8</span><span class="op" id="5669994">.</span><span class="ident" id="5669995">EncodeRune</span><span class="op" id="5670005">(</span><span class="ident" id="5670006">b</span><span class="op" id="5670007">[</span><span class="ident" id="5670008">dst</span><span class="op" id="5670011">:</span><span class="op" id="5670012">]</span><span class="op" id="5670013">,</span>&nbsp;<span class="ident" id="5670015">x</span><span class="op" id="5670016">)</span><span class="op" id="5670017">,</span>&nbsp;<span class="ident" id="5670019">src</span>&nbsp;<span class="op" id="5670023">+</span>&nbsp;<span class="ident" id="5670025">j</span>&nbsp;<span class="op" id="5670027">+</span>&nbsp;<span class="num" id="5670029">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670045">dst1</span><span class="op" id="5670049">,</span>&nbsp;<span class="ident" id="5670051">src1</span>&nbsp;<span class="op" id="5670056">=</span>&nbsp;<span class="ident" id="5670058">dst</span><span class="op" id="5670061">+</span><span class="ident" id="5670062">i</span><span class="op" id="5670063">,</span>&nbsp;<span class="ident" id="5670065">src</span><span class="op" id="5670068">+</span><span class="ident" id="5670069">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5670072">copy</span><span class="op" id="5670076">(</span><span class="ident" id="5670077">b</span><span class="op" id="5670078">[</span><span class="ident" id="5670079">dst</span><span class="op" id="5670082">:</span><span class="ident" id="5670083">dst1</span><span class="op" id="5670087">]</span><span class="op" id="5670088">,</span>&nbsp;<span class="ident" id="5670090">b</span><span class="op" id="5670091">[</span><span class="ident" id="5670092">src</span><span class="op" id="5670095">:</span><span class="ident" id="5670096">src1</span><span class="op" id="5670100">]</span><span class="op" id="5670101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670104">return</span>&nbsp;<span class="ident" id="5670111">dst1</span><span class="op" id="5670115">,</span>&nbsp;<span class="ident" id="5670117">src1</span><br>
<span class="lineno"></span><span class="op" id="5670122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5670125">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5670202">func</span>&nbsp;<span class="ident" id="5670207">unescape</span><span class="op" id="5670215">(</span><span class="ident" id="5670216">b</span>&nbsp;<span class="op" id="5670218">[</span><span class="op" id="5670219">]</span><span class="builtintype" id="5670220">byte</span><span class="op" id="5670224">)</span>&nbsp;<span class="op" id="5670226">[</span><span class="op" id="5670227">]</span><span class="builtintype" id="5670228">byte</span>&nbsp;<span class="op" id="5670233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670236">for</span>&nbsp;<span class="ident" id="5670240">i</span><span class="op" id="5670241">,</span>&nbsp;<span class="ident" id="5670243">c</span>&nbsp;<span class="op" id="5670245">:=</span>&nbsp;<span class="keyword" id="5670248">range</span>&nbsp;<span class="ident" id="5670254">b</span>&nbsp;<span class="op" id="5670256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670260">if</span>&nbsp;<span class="ident" id="5670263">c</span>&nbsp;<span class="op" id="5670265">==</span>&nbsp;<span class="string" id="5670268">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5670272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670277">dst</span><span class="op" id="5670280">,</span>&nbsp;<span class="ident" id="5670282">src</span>&nbsp;<span class="op" id="5670286">:=</span>&nbsp;<span class="ident" id="5670289">unescapeEntity</span><span class="op" id="5670303">(</span><span class="ident" id="5670304">b</span><span class="op" id="5670305">,</span>&nbsp;<span class="ident" id="5670307">i</span><span class="op" id="5670308">,</span>&nbsp;<span class="ident" id="5670310">i</span><span class="op" id="5670311">,</span>&nbsp;<span class="builtintype" id="5670313">false</span><span class="op" id="5670318">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670323">for</span>&nbsp;<span class="ident" id="5670327">src</span>&nbsp;<span class="op" id="5670331">&lt;</span>&nbsp;<span class="builtinfunc" id="5670333">len</span><span class="op" id="5670336">(</span><span class="ident" id="5670337">b</span><span class="op" id="5670338">)</span>&nbsp;<span class="op" id="5670340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670346">c</span>&nbsp;<span class="op" id="5670348">:=</span>&nbsp;<span class="ident" id="5670351">b</span><span class="op" id="5670352">[</span><span class="ident" id="5670353">src</span><span class="op" id="5670356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670362">if</span>&nbsp;<span class="ident" id="5670365">c</span>&nbsp;<span class="op" id="5670367">==</span>&nbsp;<span class="string" id="5670370">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5670374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670381">dst</span><span class="op" id="5670384">,</span>&nbsp;<span class="ident" id="5670386">src</span>&nbsp;<span class="op" id="5670390">=</span>&nbsp;<span class="ident" id="5670392">unescapeEntity</span><span class="op" id="5670406">(</span><span class="ident" id="5670407">b</span><span class="op" id="5670408">,</span>&nbsp;<span class="ident" id="5670410">dst</span><span class="op" id="5670413">,</span>&nbsp;<span class="ident" id="5670415">src</span><span class="op" id="5670418">,</span>&nbsp;<span class="builtintype" id="5670420">false</span><span class="op" id="5670425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670431">}</span>&nbsp;<span class="keyword" id="5670433">else</span>&nbsp;<span class="op" id="5670438">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670445">b</span><span class="op" id="5670446">[</span><span class="ident" id="5670447">dst</span><span class="op" id="5670450">]</span>&nbsp;<span class="op" id="5670452">=</span>&nbsp;<span class="ident" id="5670454">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670461">dst</span><span class="op" id="5670464">,</span>&nbsp;<span class="ident" id="5670466">src</span>&nbsp;<span class="op" id="5670470">=</span>&nbsp;<span class="ident" id="5670472">dst</span><span class="op" id="5670475">+</span><span class="num" id="5670476">1</span><span class="op" id="5670477">,</span>&nbsp;<span class="ident" id="5670479">src</span><span class="op" id="5670482">+</span><span class="num" id="5670483">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670499">return</span>&nbsp;<span class="ident" id="5670506">b</span><span class="op" id="5670507">[</span><span class="num" id="5670508">0</span><span class="op" id="5670509">:</span><span class="ident" id="5670510">dst</span><span class="op" id="5670513">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670523">return</span>&nbsp;<span class="ident" id="5670530">b</span><br>
<span class="lineno"></span><span class="op" id="5670532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5670535">const</span>&nbsp;<span class="ident" id="5670541">escapedChars</span>&nbsp;<span class="op" id="5670554">=</span>&nbsp;<span class="string" id="5670556">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5670565">func</span>&nbsp;<span class="ident" id="5670570">escape</span><span class="op" id="5670576">(</span><span class="ident" id="5670577">w</span>&nbsp;<span class="ident" id="5670579">writer</span><span class="op" id="5670585">,</span>&nbsp;<span class="ident" id="5670587">s</span>&nbsp;<span class="builtintype" id="5670589">string</span><span class="op" id="5670595">)</span>&nbsp;<span class="builtintype" id="5670597">error</span>&nbsp;<span class="op" id="5670603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670606">i</span>&nbsp;<span class="op" id="5670608">:=</span>&nbsp;<span class="ident" id="5670611">strings</span><span class="op" id="5670618">.</span><span class="ident" id="5670619">IndexAny</span><span class="op" id="5670627">(</span><span class="ident" id="5670628">s</span><span class="op" id="5670629">,</span>&nbsp;<span class="ident" id="5670631">escapedChars</span><span class="op" id="5670643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670646">for</span>&nbsp;<span class="ident" id="5670650">i</span>&nbsp;<span class="op" id="5670652">!=</span>&nbsp;<span class="op" id="5670655">-</span><span class="num" id="5670656">1</span>&nbsp;<span class="op" id="5670658">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670662">if</span>&nbsp;<span class="ident" id="5670665">_</span><span class="op" id="5670666">,</span>&nbsp;<span class="ident" id="5670668">err</span>&nbsp;<span class="op" id="5670672">:=</span>&nbsp;<span class="ident" id="5670675">w</span><span class="op" id="5670676">.</span><span class="ident" id="5670677">WriteString</span><span class="op" id="5670688">(</span><span class="ident" id="5670689">s</span><span class="op" id="5670690">[</span><span class="op" id="5670691">:</span><span class="ident" id="5670692">i</span><span class="op" id="5670693">]</span><span class="op" id="5670694">)</span><span class="op" id="5670695">;</span>&nbsp;<span class="ident" id="5670697">err</span>&nbsp;<span class="op" id="5670701">!=</span>&nbsp;<span class="ident" id="5670704">nil</span>&nbsp;<span class="op" id="5670708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670713">return</span>&nbsp;<span class="ident" id="5670720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670730">var</span>&nbsp;<span class="ident" id="5670734">esc</span>&nbsp;<span class="builtintype" id="5670738">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670747">switch</span>&nbsp;<span class="ident" id="5670754">s</span><span class="op" id="5670755">[</span><span class="ident" id="5670756">i</span><span class="op" id="5670757">]</span>&nbsp;<span class="op" id="5670759">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670763">case</span>&nbsp;<span class="string" id="5670768">&#39;&amp;&#39;</span><span class="op" id="5670771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670776">esc</span>&nbsp;<span class="op" id="5670780">=</span>&nbsp;<span class="string" id="5670782">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670792">case</span>&nbsp;<span class="string" id="5670797">&#39;\&#39;&#39;</span><span class="op" id="5670801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670806">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670883">esc</span>&nbsp;<span class="op" id="5670887">=</span>&nbsp;<span class="string" id="5670889">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670899">case</span>&nbsp;<span class="string" id="5670904">&#39;&lt;&#39;</span><span class="op" id="5670907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670912">esc</span>&nbsp;<span class="op" id="5670916">=</span>&nbsp;<span class="string" id="5670918">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670927">case</span>&nbsp;<span class="string" id="5670932">&#39;&gt;&#39;</span><span class="op" id="5670935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670940">esc</span>&nbsp;<span class="op" id="5670944">=</span>&nbsp;<span class="string" id="5670946">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670955">case</span>&nbsp;<span class="string" id="5670960">&#39;&#34;&#39;</span><span class="op" id="5670963">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670968">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671008">esc</span>&nbsp;<span class="op" id="5671012">=</span>&nbsp;<span class="string" id="5671014">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671024">default</span><span class="op" id="5671031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5671036">panic</span><span class="op" id="5671041">(</span><span class="string" id="5671042">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5671073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671077">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671081">s</span>&nbsp;<span class="op" id="5671083">=</span>&nbsp;<span class="ident" id="5671085">s</span><span class="op" id="5671086">[</span><span class="ident" id="5671087">i</span><span class="op" id="5671088">+</span><span class="num" id="5671089">1</span><span class="op" id="5671090">:</span><span class="op" id="5671091">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671095">if</span>&nbsp;<span class="ident" id="5671098">_</span><span class="op" id="5671099">,</span>&nbsp;<span class="ident" id="5671101">err</span>&nbsp;<span class="op" id="5671105">:=</span>&nbsp;<span class="ident" id="5671108">w</span><span class="op" id="5671109">.</span><span class="ident" id="5671110">WriteString</span><span class="op" id="5671121">(</span><span class="ident" id="5671122">esc</span><span class="op" id="5671125">)</span><span class="op" id="5671126">;</span>&nbsp;<span class="ident" id="5671128">err</span>&nbsp;<span class="op" id="5671132">!=</span>&nbsp;<span class="ident" id="5671135">nil</span>&nbsp;<span class="op" id="5671139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671144">return</span>&nbsp;<span class="ident" id="5671151">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671161">i</span>&nbsp;<span class="op" id="5671163">=</span>&nbsp;<span class="ident" id="5671165">strings</span><span class="op" id="5671172">.</span><span class="ident" id="5671173">IndexAny</span><span class="op" id="5671181">(</span><span class="ident" id="5671182">s</span><span class="op" id="5671183">,</span>&nbsp;<span class="ident" id="5671185">escapedChars</span><span class="op" id="5671197">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671203">_</span><span class="op" id="5671204">,</span>&nbsp;<span class="ident" id="5671206">err</span>&nbsp;<span class="op" id="5671210">:=</span>&nbsp;<span class="ident" id="5671213">w</span><span class="op" id="5671214">.</span><span class="ident" id="5671215">WriteString</span><span class="op" id="5671226">(</span><span class="ident" id="5671227">s</span><span class="op" id="5671228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671231">return</span>&nbsp;<span class="ident" id="5671238">err</span><br>
<span class="lineno"></span><span class="op" id="5671242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5671245">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5671318">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5671374">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5671451">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5671467">func</span>&nbsp;<span class="ident" id="5671472">EscapeString</span><span class="op" id="5671484">(</span><span class="ident" id="5671485">s</span>&nbsp;<span class="builtintype" id="5671487">string</span><span class="op" id="5671493">)</span>&nbsp;<span class="builtintype" id="5671495">string</span>&nbsp;<span class="op" id="5671502">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671505">if</span>&nbsp;<span class="ident" id="5671508">strings</span><span class="op" id="5671515">.</span><span class="ident" id="5671516">IndexAny</span><span class="op" id="5671524">(</span><span class="ident" id="5671525">s</span><span class="op" id="5671526">,</span>&nbsp;<span class="ident" id="5671528">escapedChars</span><span class="op" id="5671540">)</span>&nbsp;<span class="op" id="5671542">==</span>&nbsp;<span class="op" id="5671545">-</span><span class="num" id="5671546">1</span>&nbsp;<span class="op" id="5671548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671552">return</span>&nbsp;<span class="ident" id="5671559">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671565">var</span>&nbsp;<span class="ident" id="5671569">buf</span>&nbsp;<span class="ident" id="5671573">bytes</span><span class="op" id="5671578">.</span><span class="ident" id="5671579">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671587">escape</span><span class="op" id="5671593">(</span><span class="op" id="5671594">&amp;</span><span class="ident" id="5671595">buf</span><span class="op" id="5671598">,</span>&nbsp;<span class="ident" id="5671600">s</span><span class="op" id="5671601">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671604">return</span>&nbsp;<span class="ident" id="5671611">buf</span><span class="op" id="5671614">.</span><span class="ident" id="5671615">String</span><span class="op" id="5671621">(</span><span class="op" id="5671622">)</span><br>
<span class="lineno"></span><span class="op" id="5671624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671627">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5671706">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5671785">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5671837">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5671914">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5671930">func</span>&nbsp;<span class="ident" id="5671935">UnescapeString</span><span class="op" id="5671949">(</span><span class="ident" id="5671950">s</span>&nbsp;<span class="builtintype" id="5671952">string</span><span class="op" id="5671958">)</span>&nbsp;<span class="builtintype" id="5671960">string</span>&nbsp;<span class="op" id="5671967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671970">for</span>&nbsp;<span class="ident" id="5671974">_</span><span class="op" id="5671975">,</span>&nbsp;<span class="ident" id="5671977">c</span>&nbsp;<span class="op" id="5671979">:=</span>&nbsp;<span class="keyword" id="5671982">range</span>&nbsp;<span class="ident" id="5671988">s</span>&nbsp;<span class="op" id="5671990">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671994">if</span>&nbsp;<span class="ident" id="5671997">c</span>&nbsp;<span class="op" id="5671999">==</span>&nbsp;<span class="string" id="5672002">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5672006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672011">return</span>&nbsp;<span class="builtintype" id="5672018">string</span><span class="op" id="5672024">(</span><span class="ident" id="5672025">unescape</span><span class="op" id="5672033">(</span><span class="op" id="5672034">[</span><span class="op" id="5672035">]</span><span class="builtintype" id="5672036">byte</span><span class="op" id="5672040">(</span><span class="ident" id="5672041">s</span><span class="op" id="5672042">)</span><span class="op" id="5672043">)</span><span class="op" id="5672044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672054">return</span>&nbsp;<span class="ident" id="5672061">s</span><br>
<span class="lineno">250</span><span class="op" id="5672063">}</span>
</div>
</body>
</html>
