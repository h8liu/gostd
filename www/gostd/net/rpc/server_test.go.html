<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6974446">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6974501">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6974555">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6974606">package</span>&nbsp;<span class="ident" id="6974614">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6974619">import</span>&nbsp;<span class="op" id="6974626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974629">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974639">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974646">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974652">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974659">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974666">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974687">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974698">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974709">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974717">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974732">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6974743">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6974750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6974753">var</span>&nbsp;<span class="op" id="6974757">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974760">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6974786">*</span><span class="ident" id="6974787">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974795">serverAddr</span><span class="op" id="6974805">,</span>&nbsp;<span class="ident" id="6974807">newServerAddr</span>&nbsp;<span class="builtintype" id="6974821">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974829">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6974855">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974863">once</span><span class="op" id="6974867">,</span>&nbsp;<span class="ident" id="6974869">newOnce</span><span class="op" id="6974876">,</span>&nbsp;<span class="ident" id="6974878">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6974889">sync</span><span class="op" id="6974893">.</span><span class="ident" id="6974894">Once</span><br>
<span class="lineno"></span><span class="op" id="6974899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6974902">const</span>&nbsp;<span class="op" id="6974908">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974911">newHttpPath</span>&nbsp;<span class="op" id="6974923">=</span>&nbsp;<span class="string" id="6974925">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="6974932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6974935">type</span>&nbsp;<span class="ident" id="6974940">Args</span>&nbsp;<span class="keyword" id="6974945">struct</span>&nbsp;<span class="op" id="6974952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974955">A</span><span class="op" id="6974956">,</span>&nbsp;<span class="ident" id="6974958">B</span>&nbsp;<span class="builtintype" id="6974960">int</span><br>
<span class="lineno">35</span><span class="op" id="6974964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6974967">type</span>&nbsp;<span class="ident" id="6974972">Reply</span>&nbsp;<span class="keyword" id="6974978">struct</span>&nbsp;<span class="op" id="6974985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6974988">C</span>&nbsp;<span class="builtintype" id="6974990">int</span><br>
<span class="lineno"></span><span class="op" id="6974994">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6974997">type</span>&nbsp;<span class="ident" id="6975002">Arith</span>&nbsp;<span class="builtintype" id="6975008">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6975013">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6975101">func</span>&nbsp;<span class="op" id="6975106">(</span><span class="ident" id="6975107">t</span>&nbsp;<span class="op" id="6975109">*</span><span class="ident" id="6975110">Arith</span><span class="op" id="6975115">)</span>&nbsp;<span class="ident" id="6975117">Add</span><span class="op" id="6975120">(</span><span class="ident" id="6975121">args</span>&nbsp;<span class="ident" id="6975126">Args</span><span class="op" id="6975130">,</span>&nbsp;<span class="ident" id="6975132">reply</span>&nbsp;<span class="op" id="6975138">*</span><span class="ident" id="6975139">Reply</span><span class="op" id="6975144">)</span>&nbsp;<span class="builtintype" id="6975146">error</span>&nbsp;<span class="op" id="6975152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975155">reply</span><span class="op" id="6975160">.</span><span class="ident" id="6975161">C</span>&nbsp;<span class="op" id="6975163">=</span>&nbsp;<span class="ident" id="6975165">args</span><span class="op" id="6975169">.</span><span class="ident" id="6975170">A</span>&nbsp;<span class="op" id="6975172">+</span>&nbsp;<span class="ident" id="6975174">args</span><span class="op" id="6975178">.</span><span class="ident" id="6975179">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975182">return</span>&nbsp;<span class="ident" id="6975189">nil</span><br>
<span class="lineno"></span><span class="op" id="6975193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6975196">func</span>&nbsp;<span class="op" id="6975201">(</span><span class="ident" id="6975202">t</span>&nbsp;<span class="op" id="6975204">*</span><span class="ident" id="6975205">Arith</span><span class="op" id="6975210">)</span>&nbsp;<span class="ident" id="6975212">Mul</span><span class="op" id="6975215">(</span><span class="ident" id="6975216">args</span>&nbsp;<span class="op" id="6975221">*</span><span class="ident" id="6975222">Args</span><span class="op" id="6975226">,</span>&nbsp;<span class="ident" id="6975228">reply</span>&nbsp;<span class="op" id="6975234">*</span><span class="ident" id="6975235">Reply</span><span class="op" id="6975240">)</span>&nbsp;<span class="builtintype" id="6975242">error</span>&nbsp;<span class="op" id="6975248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975251">reply</span><span class="op" id="6975256">.</span><span class="ident" id="6975257">C</span>&nbsp;<span class="op" id="6975259">=</span>&nbsp;<span class="ident" id="6975261">args</span><span class="op" id="6975265">.</span><span class="ident" id="6975266">A</span>&nbsp;<span class="op" id="6975268">*</span>&nbsp;<span class="ident" id="6975270">args</span><span class="op" id="6975274">.</span><span class="ident" id="6975275">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975278">return</span>&nbsp;<span class="ident" id="6975285">nil</span><br>
<span class="lineno"></span><span class="op" id="6975289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6975292">func</span>&nbsp;<span class="op" id="6975297">(</span><span class="ident" id="6975298">t</span>&nbsp;<span class="op" id="6975300">*</span><span class="ident" id="6975301">Arith</span><span class="op" id="6975306">)</span>&nbsp;<span class="ident" id="6975308">Div</span><span class="op" id="6975311">(</span><span class="ident" id="6975312">args</span>&nbsp;<span class="ident" id="6975317">Args</span><span class="op" id="6975321">,</span>&nbsp;<span class="ident" id="6975323">reply</span>&nbsp;<span class="op" id="6975329">*</span><span class="ident" id="6975330">Reply</span><span class="op" id="6975335">)</span>&nbsp;<span class="builtintype" id="6975337">error</span>&nbsp;<span class="op" id="6975343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975346">if</span>&nbsp;<span class="ident" id="6975349">args</span><span class="op" id="6975353">.</span><span class="ident" id="6975354">B</span>&nbsp;<span class="op" id="6975356">==</span>&nbsp;<span class="num" id="6975359">0</span>&nbsp;<span class="op" id="6975361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975365">return</span>&nbsp;<span class="ident" id="6975372">errors</span><span class="op" id="6975378">.</span><span class="ident" id="6975379">New</span><span class="op" id="6975382">(</span><span class="string" id="6975383">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6975399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6975402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975405">reply</span><span class="op" id="6975410">.</span><span class="ident" id="6975411">C</span>&nbsp;<span class="op" id="6975413">=</span>&nbsp;<span class="ident" id="6975415">args</span><span class="op" id="6975419">.</span><span class="ident" id="6975420">A</span>&nbsp;<span class="op" id="6975422">/</span>&nbsp;<span class="ident" id="6975424">args</span><span class="op" id="6975428">.</span><span class="ident" id="6975429">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975432">return</span>&nbsp;<span class="ident" id="6975439">nil</span><br>
<span class="lineno"></span><span class="op" id="6975443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6975446">func</span>&nbsp;<span class="op" id="6975451">(</span><span class="ident" id="6975452">t</span>&nbsp;<span class="op" id="6975454">*</span><span class="ident" id="6975455">Arith</span><span class="op" id="6975460">)</span>&nbsp;<span class="ident" id="6975462">String</span><span class="op" id="6975468">(</span><span class="ident" id="6975469">args</span>&nbsp;<span class="op" id="6975474">*</span><span class="ident" id="6975475">Args</span><span class="op" id="6975479">,</span>&nbsp;<span class="ident" id="6975481">reply</span>&nbsp;<span class="op" id="6975487">*</span><span class="builtintype" id="6975488">string</span><span class="op" id="6975494">)</span>&nbsp;<span class="builtintype" id="6975496">error</span>&nbsp;<span class="op" id="6975502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6975505">*</span><span class="ident" id="6975506">reply</span>&nbsp;<span class="op" id="6975512">=</span>&nbsp;<span class="ident" id="6975514">fmt</span><span class="op" id="6975517">.</span><span class="ident" id="6975518">Sprintf</span><span class="op" id="6975525">(</span><span class="string" id="6975526">&#34;%d+%d=%d&#34;</span><span class="op" id="6975536">,</span>&nbsp;<span class="ident" id="6975538">args</span><span class="op" id="6975542">.</span><span class="ident" id="6975543">A</span><span class="op" id="6975544">,</span>&nbsp;<span class="ident" id="6975546">args</span><span class="op" id="6975550">.</span><span class="ident" id="6975551">B</span><span class="op" id="6975552">,</span>&nbsp;<span class="ident" id="6975554">args</span><span class="op" id="6975558">.</span><span class="ident" id="6975559">A</span><span class="op" id="6975560">+</span><span class="ident" id="6975561">args</span><span class="op" id="6975565">.</span><span class="ident" id="6975566">B</span><span class="op" id="6975567">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975570">return</span>&nbsp;<span class="ident" id="6975577">nil</span><br>
<span class="lineno"></span><span class="op" id="6975581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6975584">func</span>&nbsp;<span class="op" id="6975589">(</span><span class="ident" id="6975590">t</span>&nbsp;<span class="op" id="6975592">*</span><span class="ident" id="6975593">Arith</span><span class="op" id="6975598">)</span>&nbsp;<span class="ident" id="6975600">Scan</span><span class="op" id="6975604">(</span><span class="ident" id="6975605">args</span>&nbsp;<span class="builtintype" id="6975610">string</span><span class="op" id="6975616">,</span>&nbsp;<span class="ident" id="6975618">reply</span>&nbsp;<span class="op" id="6975624">*</span><span class="ident" id="6975625">Reply</span><span class="op" id="6975630">)</span>&nbsp;<span class="op" id="6975632">(</span><span class="ident" id="6975633">err</span>&nbsp;<span class="builtintype" id="6975637">error</span><span class="op" id="6975642">)</span>&nbsp;<span class="op" id="6975644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975647">_</span><span class="op" id="6975648">,</span>&nbsp;<span class="ident" id="6975650">err</span>&nbsp;<span class="op" id="6975654">=</span>&nbsp;<span class="ident" id="6975656">fmt</span><span class="op" id="6975659">.</span><span class="ident" id="6975660">Sscan</span><span class="op" id="6975665">(</span><span class="ident" id="6975666">args</span><span class="op" id="6975670">,</span>&nbsp;<span class="op" id="6975672">&amp;</span><span class="ident" id="6975673">reply</span><span class="op" id="6975678">.</span><span class="ident" id="6975679">C</span><span class="op" id="6975680">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975683">return</span><br>
<span class="lineno"></span><span class="op" id="6975690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6975693">func</span>&nbsp;<span class="op" id="6975698">(</span><span class="ident" id="6975699">t</span>&nbsp;<span class="op" id="6975701">*</span><span class="ident" id="6975702">Arith</span><span class="op" id="6975707">)</span>&nbsp;<span class="ident" id="6975709">Error</span><span class="op" id="6975714">(</span><span class="ident" id="6975715">args</span>&nbsp;<span class="op" id="6975720">*</span><span class="ident" id="6975721">Args</span><span class="op" id="6975725">,</span>&nbsp;<span class="ident" id="6975727">reply</span>&nbsp;<span class="op" id="6975733">*</span><span class="ident" id="6975734">Reply</span><span class="op" id="6975739">)</span>&nbsp;<span class="builtintype" id="6975741">error</span>&nbsp;<span class="op" id="6975747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6975750">panic</span><span class="op" id="6975755">(</span><span class="string" id="6975756">&#34;ERROR&#34;</span><span class="op" id="6975763">)</span><br>
<span class="lineno">75</span><span class="op" id="6975765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6975768">func</span>&nbsp;<span class="ident" id="6975773">listenTCP</span><span class="op" id="6975782">(</span><span class="op" id="6975783">)</span>&nbsp;<span class="op" id="6975785">(</span><span class="ident" id="6975786">net</span><span class="op" id="6975789">.</span><span class="ident" id="6975790">Listener</span><span class="op" id="6975798">,</span>&nbsp;<span class="builtintype" id="6975800">string</span><span class="op" id="6975806">)</span>&nbsp;<span class="op" id="6975808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975811">l</span><span class="op" id="6975812">,</span>&nbsp;<span class="ident" id="6975814">e</span>&nbsp;<span class="op" id="6975816">:=</span>&nbsp;<span class="ident" id="6975819">net</span><span class="op" id="6975822">.</span><span class="ident" id="6975823">Listen</span><span class="op" id="6975829">(</span><span class="string" id="6975830">&#34;tcp&#34;</span><span class="op" id="6975835">,</span>&nbsp;<span class="string" id="6975837">&#34;127.0.0.1:0&#34;</span><span class="op" id="6975850">)</span>&nbsp;<span class="comment" id="6975852">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975878">if</span>&nbsp;<span class="ident" id="6975881">e</span>&nbsp;<span class="op" id="6975883">!=</span>&nbsp;<span class="ident" id="6975886">nil</span>&nbsp;<span class="op" id="6975890">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975894">log</span><span class="op" id="6975897">.</span><span class="ident" id="6975898">Fatalf</span><span class="op" id="6975904">(</span><span class="string" id="6975905">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6975928">,</span>&nbsp;<span class="ident" id="6975930">e</span><span class="op" id="6975931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6975934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6975937">return</span>&nbsp;<span class="ident" id="6975944">l</span><span class="op" id="6975945">,</span>&nbsp;<span class="ident" id="6975947">l</span><span class="op" id="6975948">.</span><span class="ident" id="6975949">Addr</span><span class="op" id="6975953">(</span><span class="op" id="6975954">)</span><span class="op" id="6975955">.</span><span class="ident" id="6975956">String</span><span class="op" id="6975962">(</span><span class="op" id="6975963">)</span><br>
<span class="lineno"></span><span class="op" id="6975965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="6975968">func</span>&nbsp;<span class="ident" id="6975973">startServer</span><span class="op" id="6975984">(</span><span class="op" id="6975985">)</span>&nbsp;<span class="op" id="6975987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6975990">Register</span><span class="op" id="6975998">(</span><span class="builtinfunc" id="6975999">new</span><span class="op" id="6976002">(</span><span class="ident" id="6976003">Arith</span><span class="op" id="6976008">)</span><span class="op" id="6976009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976012">RegisterName</span><span class="op" id="6976024">(</span><span class="string" id="6976025">&#34;net.rpc.Arith&#34;</span><span class="op" id="6976040">,</span>&nbsp;<span class="builtinfunc" id="6976042">new</span><span class="op" id="6976045">(</span><span class="ident" id="6976046">Arith</span><span class="op" id="6976051">)</span><span class="op" id="6976052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6976056">var</span>&nbsp;<span class="ident" id="6976060">l</span>&nbsp;<span class="ident" id="6976062">net</span><span class="op" id="6976065">.</span><span class="ident" id="6976066">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976076">l</span><span class="op" id="6976077">,</span>&nbsp;<span class="ident" id="6976079">serverAddr</span>&nbsp;<span class="op" id="6976090">=</span>&nbsp;<span class="ident" id="6976092">listenTCP</span><span class="op" id="6976101">(</span><span class="op" id="6976102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976105">log</span><span class="op" id="6976108">.</span><span class="ident" id="6976109">Println</span><span class="op" id="6976116">(</span><span class="string" id="6976117">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6976147">,</span>&nbsp;<span class="ident" id="6976149">serverAddr</span><span class="op" id="6976159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6976162">go</span>&nbsp;<span class="ident" id="6976165">Accept</span><span class="op" id="6976171">(</span><span class="ident" id="6976172">l</span><span class="op" id="6976173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976177">HandleHTTP</span><span class="op" id="6976187">(</span><span class="op" id="6976188">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976191">httpOnce</span><span class="op" id="6976199">.</span><span class="ident" id="6976200">Do</span><span class="op" id="6976202">(</span><span class="ident" id="6976203">startHttpServer</span><span class="op" id="6976218">)</span><br>
<span class="lineno"></span><span class="op" id="6976220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6976223">func</span>&nbsp;<span class="ident" id="6976228">startNewServer</span><span class="op" id="6976242">(</span><span class="op" id="6976243">)</span>&nbsp;<span class="op" id="6976245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976248">newServer</span>&nbsp;<span class="op" id="6976258">=</span>&nbsp;<span class="ident" id="6976260">NewServer</span><span class="op" id="6976269">(</span><span class="op" id="6976270">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976273">newServer</span><span class="op" id="6976282">.</span><span class="ident" id="6976283">Register</span><span class="op" id="6976291">(</span><span class="builtinfunc" id="6976292">new</span><span class="op" id="6976295">(</span><span class="ident" id="6976296">Arith</span><span class="op" id="6976301">)</span><span class="op" id="6976302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976305">newServer</span><span class="op" id="6976314">.</span><span class="ident" id="6976315">RegisterName</span><span class="op" id="6976327">(</span><span class="string" id="6976328">&#34;net.rpc.Arith&#34;</span><span class="op" id="6976343">,</span>&nbsp;<span class="builtinfunc" id="6976345">new</span><span class="op" id="6976348">(</span><span class="ident" id="6976349">Arith</span><span class="op" id="6976354">)</span><span class="op" id="6976355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976358">newServer</span><span class="op" id="6976367">.</span><span class="ident" id="6976368">RegisterName</span><span class="op" id="6976380">(</span><span class="string" id="6976381">&#34;newServer.Arith&#34;</span><span class="op" id="6976398">,</span>&nbsp;<span class="builtinfunc" id="6976400">new</span><span class="op" id="6976403">(</span><span class="ident" id="6976404">Arith</span><span class="op" id="6976409">)</span><span class="op" id="6976410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6976414">var</span>&nbsp;<span class="ident" id="6976418">l</span>&nbsp;<span class="ident" id="6976420">net</span><span class="op" id="6976423">.</span><span class="ident" id="6976424">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976434">l</span><span class="op" id="6976435">,</span>&nbsp;<span class="ident" id="6976437">newServerAddr</span>&nbsp;<span class="op" id="6976451">=</span>&nbsp;<span class="ident" id="6976453">listenTCP</span><span class="op" id="6976462">(</span><span class="op" id="6976463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976466">log</span><span class="op" id="6976469">.</span><span class="ident" id="6976470">Println</span><span class="op" id="6976477">(</span><span class="string" id="6976478">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6976518">,</span>&nbsp;<span class="ident" id="6976520">newServerAddr</span><span class="op" id="6976533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6976536">go</span>&nbsp;<span class="ident" id="6976539">newServer</span><span class="op" id="6976548">.</span><span class="ident" id="6976549">Accept</span><span class="op" id="6976555">(</span><span class="ident" id="6976556">l</span><span class="op" id="6976557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976561">newServer</span><span class="op" id="6976570">.</span><span class="ident" id="6976571">HandleHTTP</span><span class="op" id="6976581">(</span><span class="ident" id="6976582">newHttpPath</span><span class="op" id="6976593">,</span>&nbsp;<span class="string" id="6976595">&#34;/bar&#34;</span><span class="op" id="6976601">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976604">httpOnce</span><span class="op" id="6976612">.</span><span class="ident" id="6976613">Do</span><span class="op" id="6976615">(</span><span class="ident" id="6976616">startHttpServer</span><span class="op" id="6976631">)</span><br>
<span class="lineno"></span><span class="op" id="6976633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6976636">func</span>&nbsp;<span class="ident" id="6976641">startHttpServer</span><span class="op" id="6976656">(</span><span class="op" id="6976657">)</span>&nbsp;<span class="op" id="6976659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976662">server</span>&nbsp;<span class="op" id="6976669">:=</span>&nbsp;<span class="ident" id="6976672">httptest</span><span class="op" id="6976680">.</span><span class="ident" id="6976681">NewServer</span><span class="op" id="6976690">(</span><span class="ident" id="6976691">nil</span><span class="op" id="6976694">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976697">httpServerAddr</span>&nbsp;<span class="op" id="6976712">=</span>&nbsp;<span class="ident" id="6976714">server</span><span class="op" id="6976720">.</span><span class="ident" id="6976721">Listener</span><span class="op" id="6976729">.</span><span class="ident" id="6976730">Addr</span><span class="op" id="6976734">(</span><span class="op" id="6976735">)</span><span class="op" id="6976736">.</span><span class="ident" id="6976737">String</span><span class="op" id="6976743">(</span><span class="op" id="6976744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976747">log</span><span class="op" id="6976750">.</span><span class="ident" id="6976751">Println</span><span class="op" id="6976758">(</span><span class="string" id="6976759">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6976794">,</span>&nbsp;<span class="ident" id="6976796">httpServerAddr</span><span class="op" id="6976810">)</span><br>
<span class="lineno"></span><span class="op" id="6976812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6976815">func</span>&nbsp;<span class="ident" id="6976820">TestRPC</span><span class="op" id="6976827">(</span><span class="ident" id="6976828">t</span>&nbsp;<span class="op" id="6976830">*</span><span class="ident" id="6976831">testing</span><span class="op" id="6976838">.</span><span class="ident" id="6976839">T</span><span class="op" id="6976840">)</span>&nbsp;<span class="op" id="6976842">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976845">once</span><span class="op" id="6976849">.</span><span class="ident" id="6976850">Do</span><span class="op" id="6976852">(</span><span class="ident" id="6976853">startServer</span><span class="op" id="6976864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976867">testRPC</span><span class="op" id="6976874">(</span><span class="ident" id="6976875">t</span><span class="op" id="6976876">,</span>&nbsp;<span class="ident" id="6976878">serverAddr</span><span class="op" id="6976888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976891">newOnce</span><span class="op" id="6976898">.</span><span class="ident" id="6976899">Do</span><span class="op" id="6976901">(</span><span class="ident" id="6976902">startNewServer</span><span class="op" id="6976916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976919">testRPC</span><span class="op" id="6976926">(</span><span class="ident" id="6976927">t</span><span class="op" id="6976928">,</span>&nbsp;<span class="ident" id="6976930">newServerAddr</span><span class="op" id="6976943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6976946">testNewServerRPC</span><span class="op" id="6976962">(</span><span class="ident" id="6976963">t</span><span class="op" id="6976964">,</span>&nbsp;<span class="ident" id="6976966">newServerAddr</span><span class="op" id="6976979">)</span><br>
<span class="lineno">125</span><span class="op" id="6976981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6976984">func</span>&nbsp;<span class="ident" id="6976989">testRPC</span><span class="op" id="6976996">(</span><span class="ident" id="6976997">t</span>&nbsp;<span class="op" id="6976999">*</span><span class="ident" id="6977000">testing</span><span class="op" id="6977007">.</span><span class="ident" id="6977008">T</span><span class="op" id="6977009">,</span>&nbsp;<span class="ident" id="6977011">addr</span>&nbsp;<span class="builtintype" id="6977016">string</span><span class="op" id="6977022">)</span>&nbsp;<span class="op" id="6977024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977027">client</span><span class="op" id="6977033">,</span>&nbsp;<span class="ident" id="6977035">err</span>&nbsp;<span class="op" id="6977039">:=</span>&nbsp;<span class="ident" id="6977042">Dial</span><span class="op" id="6977046">(</span><span class="string" id="6977047">&#34;tcp&#34;</span><span class="op" id="6977052">,</span>&nbsp;<span class="ident" id="6977054">addr</span><span class="op" id="6977058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977061">if</span>&nbsp;<span class="ident" id="6977064">err</span>&nbsp;<span class="op" id="6977068">!=</span>&nbsp;<span class="ident" id="6977071">nil</span>&nbsp;<span class="op" id="6977075">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977079">t</span><span class="op" id="6977080">.</span><span class="ident" id="6977081">Fatal</span><span class="op" id="6977086">(</span><span class="string" id="6977087">&#34;dialing&#34;</span><span class="op" id="6977096">,</span>&nbsp;<span class="ident" id="6977098">err</span><span class="op" id="6977101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977107">defer</span>&nbsp;<span class="ident" id="6977113">client</span><span class="op" id="6977119">.</span><span class="ident" id="6977120">Close</span><span class="op" id="6977125">(</span><span class="op" id="6977126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6977130">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977152">args</span>&nbsp;<span class="op" id="6977157">:=</span>&nbsp;<span class="op" id="6977160">&amp;</span><span class="ident" id="6977161">Args</span><span class="op" id="6977165">{</span><span class="num" id="6977166">7</span><span class="op" id="6977167">,</span>&nbsp;<span class="num" id="6977169">8</span><span class="op" id="6977170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977173">reply</span>&nbsp;<span class="op" id="6977179">:=</span>&nbsp;<span class="builtinfunc" id="6977182">new</span><span class="op" id="6977185">(</span><span class="ident" id="6977186">Reply</span><span class="op" id="6977191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977194">err</span>&nbsp;<span class="op" id="6977198">=</span>&nbsp;<span class="ident" id="6977200">client</span><span class="op" id="6977206">.</span><span class="ident" id="6977207">Call</span><span class="op" id="6977211">(</span><span class="string" id="6977212">&#34;Arith.Add&#34;</span><span class="op" id="6977223">,</span>&nbsp;<span class="ident" id="6977225">args</span><span class="op" id="6977229">,</span>&nbsp;<span class="ident" id="6977231">reply</span><span class="op" id="6977236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977239">if</span>&nbsp;<span class="ident" id="6977242">err</span>&nbsp;<span class="op" id="6977246">!=</span>&nbsp;<span class="ident" id="6977249">nil</span>&nbsp;<span class="op" id="6977253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977257">t</span><span class="op" id="6977258">.</span><span class="ident" id="6977259">Errorf</span><span class="op" id="6977265">(</span><span class="string" id="6977266">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6977308">,</span>&nbsp;<span class="ident" id="6977310">err</span><span class="op" id="6977313">.</span><span class="ident" id="6977314">Error</span><span class="op" id="6977319">(</span><span class="op" id="6977320">)</span><span class="op" id="6977321">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977327">if</span>&nbsp;<span class="ident" id="6977330">reply</span><span class="op" id="6977335">.</span><span class="ident" id="6977336">C</span>&nbsp;<span class="op" id="6977338">!=</span>&nbsp;<span class="ident" id="6977341">args</span><span class="op" id="6977345">.</span><span class="ident" id="6977346">A</span><span class="op" id="6977347">+</span><span class="ident" id="6977348">args</span><span class="op" id="6977352">.</span><span class="ident" id="6977353">B</span>&nbsp;<span class="op" id="6977355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977359">t</span><span class="op" id="6977360">.</span><span class="ident" id="6977361">Errorf</span><span class="op" id="6977367">(</span><span class="string" id="6977368">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6977393">,</span>&nbsp;<span class="ident" id="6977395">reply</span><span class="op" id="6977400">.</span><span class="ident" id="6977401">C</span><span class="op" id="6977402">,</span>&nbsp;<span class="ident" id="6977404">args</span><span class="op" id="6977408">.</span><span class="ident" id="6977409">A</span><span class="op" id="6977410">+</span><span class="ident" id="6977411">args</span><span class="op" id="6977415">.</span><span class="ident" id="6977416">B</span><span class="op" id="6977417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6977424">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977447">args</span>&nbsp;<span class="op" id="6977452">=</span>&nbsp;<span class="op" id="6977454">&amp;</span><span class="ident" id="6977455">Args</span><span class="op" id="6977459">{</span><span class="num" id="6977460">7</span><span class="op" id="6977461">,</span>&nbsp;<span class="num" id="6977463">0</span><span class="op" id="6977464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977467">reply</span>&nbsp;<span class="op" id="6977473">=</span>&nbsp;<span class="builtinfunc" id="6977475">new</span><span class="op" id="6977478">(</span><span class="ident" id="6977479">Reply</span><span class="op" id="6977484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977487">err</span>&nbsp;<span class="op" id="6977491">=</span>&nbsp;<span class="ident" id="6977493">client</span><span class="op" id="6977499">.</span><span class="ident" id="6977500">Call</span><span class="op" id="6977504">(</span><span class="string" id="6977505">&#34;Arith.BadOperation&#34;</span><span class="op" id="6977525">,</span>&nbsp;<span class="ident" id="6977527">args</span><span class="op" id="6977531">,</span>&nbsp;<span class="ident" id="6977533">reply</span><span class="op" id="6977538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6977541">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977561">if</span>&nbsp;<span class="ident" id="6977564">err</span>&nbsp;<span class="op" id="6977568">==</span>&nbsp;<span class="ident" id="6977571">nil</span>&nbsp;<span class="op" id="6977575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977579">t</span><span class="op" id="6977580">.</span><span class="ident" id="6977581">Error</span><span class="op" id="6977586">(</span><span class="string" id="6977587">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6977617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977620">}</span>&nbsp;<span class="keyword" id="6977622">else</span>&nbsp;<span class="keyword" id="6977627">if</span>&nbsp;<span class="op" id="6977630">!</span><span class="ident" id="6977631">strings</span><span class="op" id="6977638">.</span><span class="ident" id="6977639">HasPrefix</span><span class="op" id="6977648">(</span><span class="ident" id="6977649">err</span><span class="op" id="6977652">.</span><span class="ident" id="6977653">Error</span><span class="op" id="6977658">(</span><span class="op" id="6977659">)</span><span class="op" id="6977660">,</span>&nbsp;<span class="string" id="6977662">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="6977687">)</span>&nbsp;<span class="op" id="6977689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977693">t</span><span class="op" id="6977694">.</span><span class="ident" id="6977695">Errorf</span><span class="op" id="6977701">(</span><span class="string" id="6977702">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6977758">,</span>&nbsp;<span class="ident" id="6977760">err</span><span class="op" id="6977763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977766">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6977770">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977790">args</span>&nbsp;<span class="op" id="6977795">=</span>&nbsp;<span class="op" id="6977797">&amp;</span><span class="ident" id="6977798">Args</span><span class="op" id="6977802">{</span><span class="num" id="6977803">7</span><span class="op" id="6977804">,</span>&nbsp;<span class="num" id="6977806">8</span><span class="op" id="6977807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977810">reply</span>&nbsp;<span class="op" id="6977816">=</span>&nbsp;<span class="builtinfunc" id="6977818">new</span><span class="op" id="6977821">(</span><span class="ident" id="6977822">Reply</span><span class="op" id="6977827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977830">err</span>&nbsp;<span class="op" id="6977834">=</span>&nbsp;<span class="ident" id="6977836">client</span><span class="op" id="6977842">.</span><span class="ident" id="6977843">Call</span><span class="op" id="6977847">(</span><span class="string" id="6977848">&#34;Arith.Unknown&#34;</span><span class="op" id="6977863">,</span>&nbsp;<span class="ident" id="6977865">args</span><span class="op" id="6977869">,</span>&nbsp;<span class="ident" id="6977871">reply</span><span class="op" id="6977876">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977879">if</span>&nbsp;<span class="ident" id="6977882">err</span>&nbsp;<span class="op" id="6977886">==</span>&nbsp;<span class="ident" id="6977889">nil</span>&nbsp;<span class="op" id="6977893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977897">t</span><span class="op" id="6977898">.</span><span class="ident" id="6977899">Error</span><span class="op" id="6977904">(</span><span class="string" id="6977905">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="6977945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977948">}</span>&nbsp;<span class="keyword" id="6977950">else</span>&nbsp;<span class="keyword" id="6977955">if</span>&nbsp;<span class="ident" id="6977958">strings</span><span class="op" id="6977965">.</span><span class="ident" id="6977966">Index</span><span class="op" id="6977971">(</span><span class="ident" id="6977972">err</span><span class="op" id="6977975">.</span><span class="ident" id="6977976">Error</span><span class="op" id="6977981">(</span><span class="op" id="6977982">)</span><span class="op" id="6977983">,</span>&nbsp;<span class="string" id="6977985">&#34;method&#34;</span><span class="op" id="6977993">)</span>&nbsp;<span class="op" id="6977995">&lt;</span>&nbsp;<span class="num" id="6977997">0</span>&nbsp;<span class="op" id="6977999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978003">t</span><span class="op" id="6978004">.</span><span class="ident" id="6978005">Error</span><span class="op" id="6978010">(</span><span class="string" id="6978011">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="6978045">,</span>&nbsp;<span class="ident" id="6978047">err</span><span class="op" id="6978050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978053">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6978057">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978075">args</span>&nbsp;<span class="op" id="6978080">=</span>&nbsp;<span class="op" id="6978082">&amp;</span><span class="ident" id="6978083">Args</span><span class="op" id="6978087">{</span><span class="num" id="6978088">7</span><span class="op" id="6978089">,</span>&nbsp;<span class="num" id="6978091">8</span><span class="op" id="6978092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978095">mulReply</span>&nbsp;<span class="op" id="6978104">:=</span>&nbsp;<span class="builtinfunc" id="6978107">new</span><span class="op" id="6978110">(</span><span class="ident" id="6978111">Reply</span><span class="op" id="6978116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978119">mulCall</span>&nbsp;<span class="op" id="6978127">:=</span>&nbsp;<span class="ident" id="6978130">client</span><span class="op" id="6978136">.</span><span class="ident" id="6978137">Go</span><span class="op" id="6978139">(</span><span class="string" id="6978140">&#34;Arith.Mul&#34;</span><span class="op" id="6978151">,</span>&nbsp;<span class="ident" id="6978153">args</span><span class="op" id="6978157">,</span>&nbsp;<span class="ident" id="6978159">mulReply</span><span class="op" id="6978167">,</span>&nbsp;<span class="ident" id="6978169">nil</span><span class="op" id="6978172">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978175">addReply</span>&nbsp;<span class="op" id="6978184">:=</span>&nbsp;<span class="builtinfunc" id="6978187">new</span><span class="op" id="6978190">(</span><span class="ident" id="6978191">Reply</span><span class="op" id="6978196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978199">addCall</span>&nbsp;<span class="op" id="6978207">:=</span>&nbsp;<span class="ident" id="6978210">client</span><span class="op" id="6978216">.</span><span class="ident" id="6978217">Go</span><span class="op" id="6978219">(</span><span class="string" id="6978220">&#34;Arith.Add&#34;</span><span class="op" id="6978231">,</span>&nbsp;<span class="ident" id="6978233">args</span><span class="op" id="6978237">,</span>&nbsp;<span class="ident" id="6978239">addReply</span><span class="op" id="6978247">,</span>&nbsp;<span class="ident" id="6978249">nil</span><span class="op" id="6978252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978256">addCall</span>&nbsp;<span class="op" id="6978264">=</span>&nbsp;<span class="op" id="6978266">&lt;-</span><span class="ident" id="6978268">addCall</span><span class="op" id="6978275">.</span><span class="ident" id="6978276">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978282">if</span>&nbsp;<span class="ident" id="6978285">addCall</span><span class="op" id="6978292">.</span><span class="ident" id="6978293">Error</span>&nbsp;<span class="op" id="6978299">!=</span>&nbsp;<span class="ident" id="6978302">nil</span>&nbsp;<span class="op" id="6978306">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978310">t</span><span class="op" id="6978311">.</span><span class="ident" id="6978312">Errorf</span><span class="op" id="6978318">(</span><span class="string" id="6978319">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6978361">,</span>&nbsp;<span class="ident" id="6978363">addCall</span><span class="op" id="6978370">.</span><span class="ident" id="6978371">Error</span><span class="op" id="6978376">.</span><span class="ident" id="6978377">Error</span><span class="op" id="6978382">(</span><span class="op" id="6978383">)</span><span class="op" id="6978384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978390">if</span>&nbsp;<span class="ident" id="6978393">addReply</span><span class="op" id="6978401">.</span><span class="ident" id="6978402">C</span>&nbsp;<span class="op" id="6978404">!=</span>&nbsp;<span class="ident" id="6978407">args</span><span class="op" id="6978411">.</span><span class="ident" id="6978412">A</span><span class="op" id="6978413">+</span><span class="ident" id="6978414">args</span><span class="op" id="6978418">.</span><span class="ident" id="6978419">B</span>&nbsp;<span class="op" id="6978421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978425">t</span><span class="op" id="6978426">.</span><span class="ident" id="6978427">Errorf</span><span class="op" id="6978433">(</span><span class="string" id="6978434">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6978459">,</span>&nbsp;<span class="ident" id="6978461">addReply</span><span class="op" id="6978469">.</span><span class="ident" id="6978470">C</span><span class="op" id="6978471">,</span>&nbsp;<span class="ident" id="6978473">args</span><span class="op" id="6978477">.</span><span class="ident" id="6978478">A</span><span class="op" id="6978479">+</span><span class="ident" id="6978480">args</span><span class="op" id="6978484">.</span><span class="ident" id="6978485">B</span><span class="op" id="6978486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978489">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978493">mulCall</span>&nbsp;<span class="op" id="6978501">=</span>&nbsp;<span class="op" id="6978503">&lt;-</span><span class="ident" id="6978505">mulCall</span><span class="op" id="6978512">.</span><span class="ident" id="6978513">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978519">if</span>&nbsp;<span class="ident" id="6978522">mulCall</span><span class="op" id="6978529">.</span><span class="ident" id="6978530">Error</span>&nbsp;<span class="op" id="6978536">!=</span>&nbsp;<span class="ident" id="6978539">nil</span>&nbsp;<span class="op" id="6978543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978547">t</span><span class="op" id="6978548">.</span><span class="ident" id="6978549">Errorf</span><span class="op" id="6978555">(</span><span class="string" id="6978556">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6978598">,</span>&nbsp;<span class="ident" id="6978600">mulCall</span><span class="op" id="6978607">.</span><span class="ident" id="6978608">Error</span><span class="op" id="6978613">.</span><span class="ident" id="6978614">Error</span><span class="op" id="6978619">(</span><span class="op" id="6978620">)</span><span class="op" id="6978621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978624">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978627">if</span>&nbsp;<span class="ident" id="6978630">mulReply</span><span class="op" id="6978638">.</span><span class="ident" id="6978639">C</span>&nbsp;<span class="op" id="6978641">!=</span>&nbsp;<span class="ident" id="6978644">args</span><span class="op" id="6978648">.</span><span class="ident" id="6978649">A</span><span class="op" id="6978650">*</span><span class="ident" id="6978651">args</span><span class="op" id="6978655">.</span><span class="ident" id="6978656">B</span>&nbsp;<span class="op" id="6978658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978662">t</span><span class="op" id="6978663">.</span><span class="ident" id="6978664">Errorf</span><span class="op" id="6978670">(</span><span class="string" id="6978671">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6978696">,</span>&nbsp;<span class="ident" id="6978698">mulReply</span><span class="op" id="6978706">.</span><span class="ident" id="6978707">C</span><span class="op" id="6978708">,</span>&nbsp;<span class="ident" id="6978710">args</span><span class="op" id="6978714">.</span><span class="ident" id="6978715">A</span><span class="op" id="6978716">*</span><span class="ident" id="6978717">args</span><span class="op" id="6978721">.</span><span class="ident" id="6978722">B</span><span class="op" id="6978723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6978730">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978745">args</span>&nbsp;<span class="op" id="6978750">=</span>&nbsp;<span class="op" id="6978752">&amp;</span><span class="ident" id="6978753">Args</span><span class="op" id="6978757">{</span><span class="num" id="6978758">7</span><span class="op" id="6978759">,</span>&nbsp;<span class="num" id="6978761">0</span><span class="op" id="6978762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978765">reply</span>&nbsp;<span class="op" id="6978771">=</span>&nbsp;<span class="builtinfunc" id="6978773">new</span><span class="op" id="6978776">(</span><span class="ident" id="6978777">Reply</span><span class="op" id="6978782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978785">err</span>&nbsp;<span class="op" id="6978789">=</span>&nbsp;<span class="ident" id="6978791">client</span><span class="op" id="6978797">.</span><span class="ident" id="6978798">Call</span><span class="op" id="6978802">(</span><span class="string" id="6978803">&#34;Arith.Div&#34;</span><span class="op" id="6978814">,</span>&nbsp;<span class="ident" id="6978816">args</span><span class="op" id="6978820">,</span>&nbsp;<span class="ident" id="6978822">reply</span><span class="op" id="6978827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6978830">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978863">if</span>&nbsp;<span class="ident" id="6978866">err</span>&nbsp;<span class="op" id="6978870">==</span>&nbsp;<span class="ident" id="6978873">nil</span>&nbsp;<span class="op" id="6978877">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978881">t</span><span class="op" id="6978882">.</span><span class="ident" id="6978883">Error</span><span class="op" id="6978888">(</span><span class="string" id="6978889">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6978910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978913">}</span>&nbsp;<span class="keyword" id="6978915">else</span>&nbsp;<span class="keyword" id="6978920">if</span>&nbsp;<span class="ident" id="6978923">err</span><span class="op" id="6978926">.</span><span class="ident" id="6978927">Error</span><span class="op" id="6978932">(</span><span class="op" id="6978933">)</span>&nbsp;<span class="op" id="6978935">!=</span>&nbsp;<span class="string" id="6978938">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6978955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978959">t</span><span class="op" id="6978960">.</span><span class="ident" id="6978961">Error</span><span class="op" id="6978966">(</span><span class="string" id="6978967">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6979008">,</span>&nbsp;<span class="ident" id="6979010">err</span><span class="op" id="6979013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6979020">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979034">reply</span>&nbsp;<span class="op" id="6979040">=</span>&nbsp;<span class="builtinfunc" id="6979042">new</span><span class="op" id="6979045">(</span><span class="ident" id="6979046">Reply</span><span class="op" id="6979051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979054">err</span>&nbsp;<span class="op" id="6979058">=</span>&nbsp;<span class="ident" id="6979060">client</span><span class="op" id="6979066">.</span><span class="ident" id="6979067">Call</span><span class="op" id="6979071">(</span><span class="string" id="6979072">&#34;Arith.Add&#34;</span><span class="op" id="6979083">,</span>&nbsp;<span class="ident" id="6979085">reply</span><span class="op" id="6979090">,</span>&nbsp;<span class="ident" id="6979092">reply</span><span class="op" id="6979097">)</span>&nbsp;<span class="comment" id="6979099">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979149">if</span>&nbsp;<span class="ident" id="6979152">err</span>&nbsp;<span class="op" id="6979156">==</span>&nbsp;<span class="ident" id="6979159">nil</span>&nbsp;<span class="op" id="6979163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979167">t</span><span class="op" id="6979168">.</span><span class="ident" id="6979169">Error</span><span class="op" id="6979174">(</span><span class="string" id="6979175">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="6979229">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979232">}</span>&nbsp;<span class="keyword" id="6979234">else</span>&nbsp;<span class="keyword" id="6979239">if</span>&nbsp;<span class="ident" id="6979242">strings</span><span class="op" id="6979249">.</span><span class="ident" id="6979250">Index</span><span class="op" id="6979255">(</span><span class="ident" id="6979256">err</span><span class="op" id="6979259">.</span><span class="ident" id="6979260">Error</span><span class="op" id="6979265">(</span><span class="op" id="6979266">)</span><span class="op" id="6979267">,</span>&nbsp;<span class="string" id="6979269">&#34;type&#34;</span><span class="op" id="6979275">)</span>&nbsp;<span class="op" id="6979277">&lt;</span>&nbsp;<span class="num" id="6979279">0</span>&nbsp;<span class="op" id="6979281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979285">t</span><span class="op" id="6979286">.</span><span class="ident" id="6979287">Error</span><span class="op" id="6979292">(</span><span class="string" id="6979293">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="6979325">,</span>&nbsp;<span class="ident" id="6979327">err</span><span class="op" id="6979330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6979337">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979361">const</span>&nbsp;<span class="ident" id="6979367">Val</span>&nbsp;<span class="op" id="6979371">=</span>&nbsp;<span class="num" id="6979373">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979380">str</span>&nbsp;<span class="op" id="6979384">:=</span>&nbsp;<span class="ident" id="6979387">fmt</span><span class="op" id="6979390">.</span><span class="ident" id="6979391">Sprint</span><span class="op" id="6979397">(</span><span class="ident" id="6979398">Val</span><span class="op" id="6979401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979404">reply</span>&nbsp;<span class="op" id="6979410">=</span>&nbsp;<span class="builtinfunc" id="6979412">new</span><span class="op" id="6979415">(</span><span class="ident" id="6979416">Reply</span><span class="op" id="6979421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979424">err</span>&nbsp;<span class="op" id="6979428">=</span>&nbsp;<span class="ident" id="6979430">client</span><span class="op" id="6979436">.</span><span class="ident" id="6979437">Call</span><span class="op" id="6979441">(</span><span class="string" id="6979442">&#34;Arith.Scan&#34;</span><span class="op" id="6979454">,</span>&nbsp;<span class="op" id="6979456">&amp;</span><span class="ident" id="6979457">str</span><span class="op" id="6979460">,</span>&nbsp;<span class="ident" id="6979462">reply</span><span class="op" id="6979467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979470">if</span>&nbsp;<span class="ident" id="6979473">err</span>&nbsp;<span class="op" id="6979477">!=</span>&nbsp;<span class="ident" id="6979480">nil</span>&nbsp;<span class="op" id="6979484">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979488">t</span><span class="op" id="6979489">.</span><span class="ident" id="6979490">Errorf</span><span class="op" id="6979496">(</span><span class="string" id="6979497">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6979540">,</span>&nbsp;<span class="ident" id="6979542">err</span><span class="op" id="6979545">.</span><span class="ident" id="6979546">Error</span><span class="op" id="6979551">(</span><span class="op" id="6979552">)</span><span class="op" id="6979553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979556">}</span>&nbsp;<span class="keyword" id="6979558">else</span>&nbsp;<span class="keyword" id="6979563">if</span>&nbsp;<span class="ident" id="6979566">reply</span><span class="op" id="6979571">.</span><span class="ident" id="6979572">C</span>&nbsp;<span class="op" id="6979574">!=</span>&nbsp;<span class="ident" id="6979577">Val</span>&nbsp;<span class="op" id="6979581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979585">t</span><span class="op" id="6979586">.</span><span class="ident" id="6979587">Errorf</span><span class="op" id="6979593">(</span><span class="string" id="6979594">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6979620">,</span>&nbsp;<span class="ident" id="6979622">Val</span><span class="op" id="6979625">,</span>&nbsp;<span class="ident" id="6979627">reply</span><span class="op" id="6979632">.</span><span class="ident" id="6979633">C</span><span class="op" id="6979634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6979641">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979662">args</span>&nbsp;<span class="op" id="6979667">=</span>&nbsp;<span class="op" id="6979669">&amp;</span><span class="ident" id="6979670">Args</span><span class="op" id="6979674">{</span><span class="num" id="6979675">27</span><span class="op" id="6979677">,</span>&nbsp;<span class="num" id="6979679">35</span><span class="op" id="6979681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979684">str</span>&nbsp;<span class="op" id="6979688">=</span>&nbsp;<span class="string" id="6979690">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979694">err</span>&nbsp;<span class="op" id="6979698">=</span>&nbsp;<span class="ident" id="6979700">client</span><span class="op" id="6979706">.</span><span class="ident" id="6979707">Call</span><span class="op" id="6979711">(</span><span class="string" id="6979712">&#34;Arith.String&#34;</span><span class="op" id="6979726">,</span>&nbsp;<span class="ident" id="6979728">args</span><span class="op" id="6979732">,</span>&nbsp;<span class="op" id="6979734">&amp;</span><span class="ident" id="6979735">str</span><span class="op" id="6979738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979741">if</span>&nbsp;<span class="ident" id="6979744">err</span>&nbsp;<span class="op" id="6979748">!=</span>&nbsp;<span class="ident" id="6979751">nil</span>&nbsp;<span class="op" id="6979755">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979759">t</span><span class="op" id="6979760">.</span><span class="ident" id="6979761">Errorf</span><span class="op" id="6979767">(</span><span class="string" id="6979768">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6979813">,</span>&nbsp;<span class="ident" id="6979815">err</span><span class="op" id="6979818">.</span><span class="ident" id="6979819">Error</span><span class="op" id="6979824">(</span><span class="op" id="6979825">)</span><span class="op" id="6979826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979832">expect</span>&nbsp;<span class="op" id="6979839">:=</span>&nbsp;<span class="ident" id="6979842">fmt</span><span class="op" id="6979845">.</span><span class="ident" id="6979846">Sprintf</span><span class="op" id="6979853">(</span><span class="string" id="6979854">&#34;%d+%d=%d&#34;</span><span class="op" id="6979864">,</span>&nbsp;<span class="ident" id="6979866">args</span><span class="op" id="6979870">.</span><span class="ident" id="6979871">A</span><span class="op" id="6979872">,</span>&nbsp;<span class="ident" id="6979874">args</span><span class="op" id="6979878">.</span><span class="ident" id="6979879">B</span><span class="op" id="6979880">,</span>&nbsp;<span class="ident" id="6979882">args</span><span class="op" id="6979886">.</span><span class="ident" id="6979887">A</span><span class="op" id="6979888">+</span><span class="ident" id="6979889">args</span><span class="op" id="6979893">.</span><span class="ident" id="6979894">B</span><span class="op" id="6979895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979898">if</span>&nbsp;<span class="ident" id="6979901">str</span>&nbsp;<span class="op" id="6979905">!=</span>&nbsp;<span class="ident" id="6979908">expect</span>&nbsp;<span class="op" id="6979915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979919">t</span><span class="op" id="6979920">.</span><span class="ident" id="6979921">Errorf</span><span class="op" id="6979927">(</span><span class="string" id="6979928">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6979956">,</span>&nbsp;<span class="ident" id="6979958">expect</span><span class="op" id="6979964">,</span>&nbsp;<span class="ident" id="6979966">str</span><span class="op" id="6979969">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979976">args</span>&nbsp;<span class="op" id="6979981">=</span>&nbsp;<span class="op" id="6979983">&amp;</span><span class="ident" id="6979984">Args</span><span class="op" id="6979988">{</span><span class="num" id="6979989">7</span><span class="op" id="6979990">,</span>&nbsp;<span class="num" id="6979992">8</span><span class="op" id="6979993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979996">reply</span>&nbsp;<span class="op" id="6980002">=</span>&nbsp;<span class="builtinfunc" id="6980004">new</span><span class="op" id="6980007">(</span><span class="ident" id="6980008">Reply</span><span class="op" id="6980013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980016">err</span>&nbsp;<span class="op" id="6980020">=</span>&nbsp;<span class="ident" id="6980022">client</span><span class="op" id="6980028">.</span><span class="ident" id="6980029">Call</span><span class="op" id="6980033">(</span><span class="string" id="6980034">&#34;Arith.Mul&#34;</span><span class="op" id="6980045">,</span>&nbsp;<span class="ident" id="6980047">args</span><span class="op" id="6980051">,</span>&nbsp;<span class="ident" id="6980053">reply</span><span class="op" id="6980058">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980061">if</span>&nbsp;<span class="ident" id="6980064">err</span>&nbsp;<span class="op" id="6980068">!=</span>&nbsp;<span class="ident" id="6980071">nil</span>&nbsp;<span class="op" id="6980075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980079">t</span><span class="op" id="6980080">.</span><span class="ident" id="6980081">Errorf</span><span class="op" id="6980087">(</span><span class="string" id="6980088">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6980130">,</span>&nbsp;<span class="ident" id="6980132">err</span><span class="op" id="6980135">.</span><span class="ident" id="6980136">Error</span><span class="op" id="6980141">(</span><span class="op" id="6980142">)</span><span class="op" id="6980143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980149">if</span>&nbsp;<span class="ident" id="6980152">reply</span><span class="op" id="6980157">.</span><span class="ident" id="6980158">C</span>&nbsp;<span class="op" id="6980160">!=</span>&nbsp;<span class="ident" id="6980163">args</span><span class="op" id="6980167">.</span><span class="ident" id="6980168">A</span><span class="op" id="6980169">*</span><span class="ident" id="6980170">args</span><span class="op" id="6980174">.</span><span class="ident" id="6980175">B</span>&nbsp;<span class="op" id="6980177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980181">t</span><span class="op" id="6980182">.</span><span class="ident" id="6980183">Errorf</span><span class="op" id="6980189">(</span><span class="string" id="6980190">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6980215">,</span>&nbsp;<span class="ident" id="6980217">reply</span><span class="op" id="6980222">.</span><span class="ident" id="6980223">C</span><span class="op" id="6980224">,</span>&nbsp;<span class="ident" id="6980226">args</span><span class="op" id="6980230">.</span><span class="ident" id="6980231">A</span><span class="op" id="6980232">*</span><span class="ident" id="6980233">args</span><span class="op" id="6980237">.</span><span class="ident" id="6980238">B</span><span class="op" id="6980239">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6980246">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980284">args</span>&nbsp;<span class="op" id="6980289">=</span>&nbsp;<span class="op" id="6980291">&amp;</span><span class="ident" id="6980292">Args</span><span class="op" id="6980296">{</span><span class="num" id="6980297">7</span><span class="op" id="6980298">,</span>&nbsp;<span class="num" id="6980300">8</span><span class="op" id="6980301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980304">reply</span>&nbsp;<span class="op" id="6980310">=</span>&nbsp;<span class="builtinfunc" id="6980312">new</span><span class="op" id="6980315">(</span><span class="ident" id="6980316">Reply</span><span class="op" id="6980321">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980324">err</span>&nbsp;<span class="op" id="6980328">=</span>&nbsp;<span class="ident" id="6980330">client</span><span class="op" id="6980336">.</span><span class="ident" id="6980337">Call</span><span class="op" id="6980341">(</span><span class="string" id="6980342">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="6980361">,</span>&nbsp;<span class="ident" id="6980363">args</span><span class="op" id="6980367">,</span>&nbsp;<span class="ident" id="6980369">reply</span><span class="op" id="6980374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980377">if</span>&nbsp;<span class="ident" id="6980380">err</span>&nbsp;<span class="op" id="6980384">!=</span>&nbsp;<span class="ident" id="6980387">nil</span>&nbsp;<span class="op" id="6980391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980395">t</span><span class="op" id="6980396">.</span><span class="ident" id="6980397">Errorf</span><span class="op" id="6980403">(</span><span class="string" id="6980404">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6980446">,</span>&nbsp;<span class="ident" id="6980448">err</span><span class="op" id="6980451">.</span><span class="ident" id="6980452">Error</span><span class="op" id="6980457">(</span><span class="op" id="6980458">)</span><span class="op" id="6980459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980465">if</span>&nbsp;<span class="ident" id="6980468">reply</span><span class="op" id="6980473">.</span><span class="ident" id="6980474">C</span>&nbsp;<span class="op" id="6980476">!=</span>&nbsp;<span class="ident" id="6980479">args</span><span class="op" id="6980483">.</span><span class="ident" id="6980484">A</span><span class="op" id="6980485">+</span><span class="ident" id="6980486">args</span><span class="op" id="6980490">.</span><span class="ident" id="6980491">B</span>&nbsp;<span class="op" id="6980493">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980497">t</span><span class="op" id="6980498">.</span><span class="ident" id="6980499">Errorf</span><span class="op" id="6980505">(</span><span class="string" id="6980506">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6980531">,</span>&nbsp;<span class="ident" id="6980533">reply</span><span class="op" id="6980538">.</span><span class="ident" id="6980539">C</span><span class="op" id="6980540">,</span>&nbsp;<span class="ident" id="6980542">args</span><span class="op" id="6980546">.</span><span class="ident" id="6980547">A</span><span class="op" id="6980548">+</span><span class="ident" id="6980549">args</span><span class="op" id="6980553">.</span><span class="ident" id="6980554">B</span><span class="op" id="6980555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980558">}</span><br>
<span class="lineno"></span><span class="op" id="6980560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6980563">func</span>&nbsp;<span class="ident" id="6980568">testNewServerRPC</span><span class="op" id="6980584">(</span><span class="ident" id="6980585">t</span>&nbsp;<span class="op" id="6980587">*</span><span class="ident" id="6980588">testing</span><span class="op" id="6980595">.</span><span class="ident" id="6980596">T</span><span class="op" id="6980597">,</span>&nbsp;<span class="ident" id="6980599">addr</span>&nbsp;<span class="builtintype" id="6980604">string</span><span class="op" id="6980610">)</span>&nbsp;<span class="op" id="6980612">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980615">client</span><span class="op" id="6980621">,</span>&nbsp;<span class="ident" id="6980623">err</span>&nbsp;<span class="op" id="6980627">:=</span>&nbsp;<span class="ident" id="6980630">Dial</span><span class="op" id="6980634">(</span><span class="string" id="6980635">&#34;tcp&#34;</span><span class="op" id="6980640">,</span>&nbsp;<span class="ident" id="6980642">addr</span><span class="op" id="6980646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980649">if</span>&nbsp;<span class="ident" id="6980652">err</span>&nbsp;<span class="op" id="6980656">!=</span>&nbsp;<span class="ident" id="6980659">nil</span>&nbsp;<span class="op" id="6980663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980667">t</span><span class="op" id="6980668">.</span><span class="ident" id="6980669">Fatal</span><span class="op" id="6980674">(</span><span class="string" id="6980675">&#34;dialing&#34;</span><span class="op" id="6980684">,</span>&nbsp;<span class="ident" id="6980686">err</span><span class="op" id="6980689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980695">defer</span>&nbsp;<span class="ident" id="6980701">client</span><span class="op" id="6980707">.</span><span class="ident" id="6980708">Close</span><span class="op" id="6980713">(</span><span class="op" id="6980714">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6980718">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980740">args</span>&nbsp;<span class="op" id="6980745">:=</span>&nbsp;<span class="op" id="6980748">&amp;</span><span class="ident" id="6980749">Args</span><span class="op" id="6980753">{</span><span class="num" id="6980754">7</span><span class="op" id="6980755">,</span>&nbsp;<span class="num" id="6980757">8</span><span class="op" id="6980758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980761">reply</span>&nbsp;<span class="op" id="6980767">:=</span>&nbsp;<span class="builtinfunc" id="6980770">new</span><span class="op" id="6980773">(</span><span class="ident" id="6980774">Reply</span><span class="op" id="6980779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980782">err</span>&nbsp;<span class="op" id="6980786">=</span>&nbsp;<span class="ident" id="6980788">client</span><span class="op" id="6980794">.</span><span class="ident" id="6980795">Call</span><span class="op" id="6980799">(</span><span class="string" id="6980800">&#34;newServer.Arith.Add&#34;</span><span class="op" id="6980821">,</span>&nbsp;<span class="ident" id="6980823">args</span><span class="op" id="6980827">,</span>&nbsp;<span class="ident" id="6980829">reply</span><span class="op" id="6980834">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980837">if</span>&nbsp;<span class="ident" id="6980840">err</span>&nbsp;<span class="op" id="6980844">!=</span>&nbsp;<span class="ident" id="6980847">nil</span>&nbsp;<span class="op" id="6980851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980855">t</span><span class="op" id="6980856">.</span><span class="ident" id="6980857">Errorf</span><span class="op" id="6980863">(</span><span class="string" id="6980864">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6980906">,</span>&nbsp;<span class="ident" id="6980908">err</span><span class="op" id="6980911">.</span><span class="ident" id="6980912">Error</span><span class="op" id="6980917">(</span><span class="op" id="6980918">)</span><span class="op" id="6980919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980925">if</span>&nbsp;<span class="ident" id="6980928">reply</span><span class="op" id="6980933">.</span><span class="ident" id="6980934">C</span>&nbsp;<span class="op" id="6980936">!=</span>&nbsp;<span class="ident" id="6980939">args</span><span class="op" id="6980943">.</span><span class="ident" id="6980944">A</span><span class="op" id="6980945">+</span><span class="ident" id="6980946">args</span><span class="op" id="6980950">.</span><span class="ident" id="6980951">B</span>&nbsp;<span class="op" id="6980953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980957">t</span><span class="op" id="6980958">.</span><span class="ident" id="6980959">Errorf</span><span class="op" id="6980965">(</span><span class="string" id="6980966">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6980991">,</span>&nbsp;<span class="ident" id="6980993">reply</span><span class="op" id="6980998">.</span><span class="ident" id="6980999">C</span><span class="op" id="6981000">,</span>&nbsp;<span class="ident" id="6981002">args</span><span class="op" id="6981006">.</span><span class="ident" id="6981007">A</span><span class="op" id="6981008">+</span><span class="ident" id="6981009">args</span><span class="op" id="6981013">.</span><span class="ident" id="6981014">B</span><span class="op" id="6981015">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981018">}</span><br>
<span class="lineno"></span><span class="op" id="6981020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6981023">func</span>&nbsp;<span class="ident" id="6981028">TestHTTP</span><span class="op" id="6981036">(</span><span class="ident" id="6981037">t</span>&nbsp;<span class="op" id="6981039">*</span><span class="ident" id="6981040">testing</span><span class="op" id="6981047">.</span><span class="ident" id="6981048">T</span><span class="op" id="6981049">)</span>&nbsp;<span class="op" id="6981051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981054">once</span><span class="op" id="6981058">.</span><span class="ident" id="6981059">Do</span><span class="op" id="6981061">(</span><span class="ident" id="6981062">startServer</span><span class="op" id="6981073">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981076">testHTTPRPC</span><span class="op" id="6981087">(</span><span class="ident" id="6981088">t</span><span class="op" id="6981089">,</span>&nbsp;<span class="string" id="6981091">&#34;&#34;</span><span class="op" id="6981093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981096">newOnce</span><span class="op" id="6981103">.</span><span class="ident" id="6981104">Do</span><span class="op" id="6981106">(</span><span class="ident" id="6981107">startNewServer</span><span class="op" id="6981121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981124">testHTTPRPC</span><span class="op" id="6981135">(</span><span class="ident" id="6981136">t</span><span class="op" id="6981137">,</span>&nbsp;<span class="ident" id="6981139">newHttpPath</span><span class="op" id="6981150">)</span><br>
<span class="lineno"></span><span class="op" id="6981152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6981155">func</span>&nbsp;<span class="ident" id="6981160">testHTTPRPC</span><span class="op" id="6981171">(</span><span class="ident" id="6981172">t</span>&nbsp;<span class="op" id="6981174">*</span><span class="ident" id="6981175">testing</span><span class="op" id="6981182">.</span><span class="ident" id="6981183">T</span><span class="op" id="6981184">,</span>&nbsp;<span class="ident" id="6981186">path</span>&nbsp;<span class="builtintype" id="6981191">string</span><span class="op" id="6981197">)</span>&nbsp;<span class="op" id="6981199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981202">var</span>&nbsp;<span class="ident" id="6981206">client</span>&nbsp;<span class="op" id="6981213">*</span><span class="ident" id="6981214">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981222">var</span>&nbsp;<span class="ident" id="6981226">err</span>&nbsp;<span class="builtintype" id="6981230">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981237">if</span>&nbsp;<span class="ident" id="6981240">path</span>&nbsp;<span class="op" id="6981245">==</span>&nbsp;<span class="string" id="6981248">&#34;&#34;</span>&nbsp;<span class="op" id="6981251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981255">client</span><span class="op" id="6981261">,</span>&nbsp;<span class="ident" id="6981263">err</span>&nbsp;<span class="op" id="6981267">=</span>&nbsp;<span class="ident" id="6981269">DialHTTP</span><span class="op" id="6981277">(</span><span class="string" id="6981278">&#34;tcp&#34;</span><span class="op" id="6981283">,</span>&nbsp;<span class="ident" id="6981285">httpServerAddr</span><span class="op" id="6981299">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981302">}</span>&nbsp;<span class="keyword" id="6981304">else</span>&nbsp;<span class="op" id="6981309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981313">client</span><span class="op" id="6981319">,</span>&nbsp;<span class="ident" id="6981321">err</span>&nbsp;<span class="op" id="6981325">=</span>&nbsp;<span class="ident" id="6981327">DialHTTPPath</span><span class="op" id="6981339">(</span><span class="string" id="6981340">&#34;tcp&#34;</span><span class="op" id="6981345">,</span>&nbsp;<span class="ident" id="6981347">httpServerAddr</span><span class="op" id="6981361">,</span>&nbsp;<span class="ident" id="6981363">path</span><span class="op" id="6981367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981373">if</span>&nbsp;<span class="ident" id="6981376">err</span>&nbsp;<span class="op" id="6981380">!=</span>&nbsp;<span class="ident" id="6981383">nil</span>&nbsp;<span class="op" id="6981387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981391">t</span><span class="op" id="6981392">.</span><span class="ident" id="6981393">Fatal</span><span class="op" id="6981398">(</span><span class="string" id="6981399">&#34;dialing&#34;</span><span class="op" id="6981408">,</span>&nbsp;<span class="ident" id="6981410">err</span><span class="op" id="6981413">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981419">defer</span>&nbsp;<span class="ident" id="6981425">client</span><span class="op" id="6981431">.</span><span class="ident" id="6981432">Close</span><span class="op" id="6981437">(</span><span class="op" id="6981438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6981442">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981464">args</span>&nbsp;<span class="op" id="6981469">:=</span>&nbsp;<span class="op" id="6981472">&amp;</span><span class="ident" id="6981473">Args</span><span class="op" id="6981477">{</span><span class="num" id="6981478">7</span><span class="op" id="6981479">,</span>&nbsp;<span class="num" id="6981481">8</span><span class="op" id="6981482">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981485">reply</span>&nbsp;<span class="op" id="6981491">:=</span>&nbsp;<span class="builtinfunc" id="6981494">new</span><span class="op" id="6981497">(</span><span class="ident" id="6981498">Reply</span><span class="op" id="6981503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981506">err</span>&nbsp;<span class="op" id="6981510">=</span>&nbsp;<span class="ident" id="6981512">client</span><span class="op" id="6981518">.</span><span class="ident" id="6981519">Call</span><span class="op" id="6981523">(</span><span class="string" id="6981524">&#34;Arith.Add&#34;</span><span class="op" id="6981535">,</span>&nbsp;<span class="ident" id="6981537">args</span><span class="op" id="6981541">,</span>&nbsp;<span class="ident" id="6981543">reply</span><span class="op" id="6981548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981551">if</span>&nbsp;<span class="ident" id="6981554">err</span>&nbsp;<span class="op" id="6981558">!=</span>&nbsp;<span class="ident" id="6981561">nil</span>&nbsp;<span class="op" id="6981565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981569">t</span><span class="op" id="6981570">.</span><span class="ident" id="6981571">Errorf</span><span class="op" id="6981577">(</span><span class="string" id="6981578">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6981620">,</span>&nbsp;<span class="ident" id="6981622">err</span><span class="op" id="6981625">.</span><span class="ident" id="6981626">Error</span><span class="op" id="6981631">(</span><span class="op" id="6981632">)</span><span class="op" id="6981633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981636">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981639">if</span>&nbsp;<span class="ident" id="6981642">reply</span><span class="op" id="6981647">.</span><span class="ident" id="6981648">C</span>&nbsp;<span class="op" id="6981650">!=</span>&nbsp;<span class="ident" id="6981653">args</span><span class="op" id="6981657">.</span><span class="ident" id="6981658">A</span><span class="op" id="6981659">+</span><span class="ident" id="6981660">args</span><span class="op" id="6981664">.</span><span class="ident" id="6981665">B</span>&nbsp;<span class="op" id="6981667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981671">t</span><span class="op" id="6981672">.</span><span class="ident" id="6981673">Errorf</span><span class="op" id="6981679">(</span><span class="string" id="6981680">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6981705">,</span>&nbsp;<span class="ident" id="6981707">reply</span><span class="op" id="6981712">.</span><span class="ident" id="6981713">C</span><span class="op" id="6981714">,</span>&nbsp;<span class="ident" id="6981716">args</span><span class="op" id="6981720">.</span><span class="ident" id="6981721">A</span><span class="op" id="6981722">+</span><span class="ident" id="6981723">args</span><span class="op" id="6981727">.</span><span class="ident" id="6981728">B</span><span class="op" id="6981729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981732">}</span><br>
<span class="lineno"></span><span class="op" id="6981734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="6981737">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6981810">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="6981847">type</span>&nbsp;<span class="ident" id="6981852">CodecEmulator</span>&nbsp;<span class="keyword" id="6981866">struct</span>&nbsp;<span class="op" id="6981873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981876">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981890">*</span><span class="ident" id="6981891">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981899">serviceMethod</span>&nbsp;<span class="builtintype" id="6981913">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981921">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981935">*</span><span class="ident" id="6981936">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981942">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981956">*</span><span class="ident" id="6981957">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981964">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6981978">error</span><br>
<span class="lineno"></span><span class="op" id="6981984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6981987">func</span>&nbsp;<span class="op" id="6981992">(</span><span class="ident" id="6981993">codec</span>&nbsp;<span class="op" id="6981999">*</span><span class="ident" id="6982000">CodecEmulator</span><span class="op" id="6982013">)</span>&nbsp;<span class="ident" id="6982015">Call</span><span class="op" id="6982019">(</span><span class="ident" id="6982020">serviceMethod</span>&nbsp;<span class="builtintype" id="6982034">string</span><span class="op" id="6982040">,</span>&nbsp;<span class="ident" id="6982042">args</span>&nbsp;<span class="op" id="6982047">*</span><span class="ident" id="6982048">Args</span><span class="op" id="6982052">,</span>&nbsp;<span class="ident" id="6982054">reply</span>&nbsp;<span class="op" id="6982060">*</span><span class="ident" id="6982061">Reply</span><span class="op" id="6982066">)</span>&nbsp;<span class="builtintype" id="6982068">error</span>&nbsp;<span class="op" id="6982074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982077">codec</span><span class="op" id="6982082">.</span><span class="ident" id="6982083">serviceMethod</span>&nbsp;<span class="op" id="6982097">=</span>&nbsp;<span class="ident" id="6982099">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982114">codec</span><span class="op" id="6982119">.</span><span class="ident" id="6982120">args</span>&nbsp;<span class="op" id="6982125">=</span>&nbsp;<span class="ident" id="6982127">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982133">codec</span><span class="op" id="6982138">.</span><span class="ident" id="6982139">reply</span>&nbsp;<span class="op" id="6982145">=</span>&nbsp;<span class="ident" id="6982147">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982154">codec</span><span class="op" id="6982159">.</span><span class="ident" id="6982160">err</span>&nbsp;<span class="op" id="6982164">=</span>&nbsp;<span class="ident" id="6982166">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982171">var</span>&nbsp;<span class="ident" id="6982175">serverError</span>&nbsp;<span class="builtintype" id="6982187">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982194">if</span>&nbsp;<span class="ident" id="6982197">codec</span><span class="op" id="6982202">.</span><span class="ident" id="6982203">server</span>&nbsp;<span class="op" id="6982210">==</span>&nbsp;<span class="ident" id="6982213">nil</span>&nbsp;<span class="op" id="6982217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982221">serverError</span>&nbsp;<span class="op" id="6982233">=</span>&nbsp;<span class="ident" id="6982235">ServeRequest</span><span class="op" id="6982247">(</span><span class="ident" id="6982248">codec</span><span class="op" id="6982253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982256">}</span>&nbsp;<span class="keyword" id="6982258">else</span>&nbsp;<span class="op" id="6982263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982267">serverError</span>&nbsp;<span class="op" id="6982279">=</span>&nbsp;<span class="ident" id="6982281">codec</span><span class="op" id="6982286">.</span><span class="ident" id="6982287">server</span><span class="op" id="6982293">.</span><span class="ident" id="6982294">ServeRequest</span><span class="op" id="6982306">(</span><span class="ident" id="6982307">codec</span><span class="op" id="6982312">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982318">if</span>&nbsp;<span class="ident" id="6982321">codec</span><span class="op" id="6982326">.</span><span class="ident" id="6982327">err</span>&nbsp;<span class="op" id="6982331">==</span>&nbsp;<span class="ident" id="6982334">nil</span>&nbsp;<span class="op" id="6982338">&amp;&amp;</span>&nbsp;<span class="ident" id="6982341">serverError</span>&nbsp;<span class="op" id="6982353">!=</span>&nbsp;<span class="ident" id="6982356">nil</span>&nbsp;<span class="op" id="6982360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982364">codec</span><span class="op" id="6982369">.</span><span class="ident" id="6982370">err</span>&nbsp;<span class="op" id="6982374">=</span>&nbsp;<span class="ident" id="6982376">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982392">return</span>&nbsp;<span class="ident" id="6982399">codec</span><span class="op" id="6982404">.</span><span class="ident" id="6982405">err</span><br>
<span class="lineno">330</span><span class="op" id="6982409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982412">func</span>&nbsp;<span class="op" id="6982417">(</span><span class="ident" id="6982418">codec</span>&nbsp;<span class="op" id="6982424">*</span><span class="ident" id="6982425">CodecEmulator</span><span class="op" id="6982438">)</span>&nbsp;<span class="ident" id="6982440">ReadRequestHeader</span><span class="op" id="6982457">(</span><span class="ident" id="6982458">req</span>&nbsp;<span class="op" id="6982462">*</span><span class="ident" id="6982463">Request</span><span class="op" id="6982470">)</span>&nbsp;<span class="builtintype" id="6982472">error</span>&nbsp;<span class="op" id="6982478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982481">req</span><span class="op" id="6982484">.</span><span class="ident" id="6982485">ServiceMethod</span>&nbsp;<span class="op" id="6982499">=</span>&nbsp;<span class="ident" id="6982501">codec</span><span class="op" id="6982506">.</span><span class="ident" id="6982507">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982522">req</span><span class="op" id="6982525">.</span><span class="ident" id="6982526">Seq</span>&nbsp;<span class="op" id="6982530">=</span>&nbsp;<span class="num" id="6982532">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982535">return</span>&nbsp;<span class="ident" id="6982542">nil</span><br>
<span class="lineno"></span><span class="op" id="6982546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982549">func</span>&nbsp;<span class="op" id="6982554">(</span><span class="ident" id="6982555">codec</span>&nbsp;<span class="op" id="6982561">*</span><span class="ident" id="6982562">CodecEmulator</span><span class="op" id="6982575">)</span>&nbsp;<span class="ident" id="6982577">ReadRequestBody</span><span class="op" id="6982592">(</span><span class="ident" id="6982593">argv</span>&nbsp;<span class="keyword" id="6982598">interface</span><span class="op" id="6982607">{</span><span class="op" id="6982608">}</span><span class="op" id="6982609">)</span>&nbsp;<span class="builtintype" id="6982611">error</span>&nbsp;<span class="op" id="6982617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982620">if</span>&nbsp;<span class="ident" id="6982623">codec</span><span class="op" id="6982628">.</span><span class="ident" id="6982629">args</span>&nbsp;<span class="op" id="6982634">==</span>&nbsp;<span class="ident" id="6982637">nil</span>&nbsp;<span class="op" id="6982641">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982645">return</span>&nbsp;<span class="ident" id="6982652">io</span><span class="op" id="6982654">.</span><span class="ident" id="6982655">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982676">*</span><span class="op" id="6982677">(</span><span class="ident" id="6982678">argv</span><span class="op" id="6982682">.</span><span class="op" id="6982683">(</span><span class="op" id="6982684">*</span><span class="ident" id="6982685">Args</span><span class="op" id="6982689">)</span><span class="op" id="6982690">)</span>&nbsp;<span class="op" id="6982692">=</span>&nbsp;<span class="op" id="6982694">*</span><span class="ident" id="6982695">codec</span><span class="op" id="6982700">.</span><span class="ident" id="6982701">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982707">return</span>&nbsp;<span class="ident" id="6982714">nil</span><br>
<span class="lineno"></span><span class="op" id="6982718">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6982721">func</span>&nbsp;<span class="op" id="6982726">(</span><span class="ident" id="6982727">codec</span>&nbsp;<span class="op" id="6982733">*</span><span class="ident" id="6982734">CodecEmulator</span><span class="op" id="6982747">)</span>&nbsp;<span class="ident" id="6982749">WriteResponse</span><span class="op" id="6982762">(</span><span class="ident" id="6982763">resp</span>&nbsp;<span class="op" id="6982768">*</span><span class="ident" id="6982769">Response</span><span class="op" id="6982777">,</span>&nbsp;<span class="ident" id="6982779">reply</span>&nbsp;<span class="keyword" id="6982785">interface</span><span class="op" id="6982794">{</span><span class="op" id="6982795">}</span><span class="op" id="6982796">)</span>&nbsp;<span class="builtintype" id="6982798">error</span>&nbsp;<span class="op" id="6982804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982807">if</span>&nbsp;<span class="ident" id="6982810">resp</span><span class="op" id="6982814">.</span><span class="ident" id="6982815">Error</span>&nbsp;<span class="op" id="6982821">!=</span>&nbsp;<span class="string" id="6982824">&#34;&#34;</span>&nbsp;<span class="op" id="6982827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982831">codec</span><span class="op" id="6982836">.</span><span class="ident" id="6982837">err</span>&nbsp;<span class="op" id="6982841">=</span>&nbsp;<span class="ident" id="6982843">errors</span><span class="op" id="6982849">.</span><span class="ident" id="6982850">New</span><span class="op" id="6982853">(</span><span class="ident" id="6982854">resp</span><span class="op" id="6982858">.</span><span class="ident" id="6982859">Error</span><span class="op" id="6982864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982867">}</span>&nbsp;<span class="keyword" id="6982869">else</span>&nbsp;<span class="op" id="6982874">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982878">*</span><span class="ident" id="6982879">codec</span><span class="op" id="6982884">.</span><span class="ident" id="6982885">reply</span>&nbsp;<span class="op" id="6982891">=</span>&nbsp;<span class="op" id="6982893">*</span><span class="op" id="6982894">(</span><span class="ident" id="6982895">reply</span><span class="op" id="6982900">.</span><span class="op" id="6982901">(</span><span class="op" id="6982902">*</span><span class="ident" id="6982903">Reply</span><span class="op" id="6982908">)</span><span class="op" id="6982909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982915">return</span>&nbsp;<span class="ident" id="6982922">nil</span><br>
<span class="lineno"></span><span class="op" id="6982926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="6982929">func</span>&nbsp;<span class="op" id="6982934">(</span><span class="ident" id="6982935">codec</span>&nbsp;<span class="op" id="6982941">*</span><span class="ident" id="6982942">CodecEmulator</span><span class="op" id="6982955">)</span>&nbsp;<span class="ident" id="6982957">Close</span><span class="op" id="6982962">(</span><span class="op" id="6982963">)</span>&nbsp;<span class="builtintype" id="6982965">error</span>&nbsp;<span class="op" id="6982971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982974">return</span>&nbsp;<span class="ident" id="6982981">nil</span><br>
<span class="lineno"></span><span class="op" id="6982985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982988">func</span>&nbsp;<span class="ident" id="6982993">TestServeRequest</span><span class="op" id="6983009">(</span><span class="ident" id="6983010">t</span>&nbsp;<span class="op" id="6983012">*</span><span class="ident" id="6983013">testing</span><span class="op" id="6983020">.</span><span class="ident" id="6983021">T</span><span class="op" id="6983022">)</span>&nbsp;<span class="op" id="6983024">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983027">once</span><span class="op" id="6983031">.</span><span class="ident" id="6983032">Do</span><span class="op" id="6983034">(</span><span class="ident" id="6983035">startServer</span><span class="op" id="6983046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983049">testServeRequest</span><span class="op" id="6983065">(</span><span class="ident" id="6983066">t</span><span class="op" id="6983067">,</span>&nbsp;<span class="ident" id="6983069">nil</span><span class="op" id="6983072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983075">newOnce</span><span class="op" id="6983082">.</span><span class="ident" id="6983083">Do</span><span class="op" id="6983085">(</span><span class="ident" id="6983086">startNewServer</span><span class="op" id="6983100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983103">testServeRequest</span><span class="op" id="6983119">(</span><span class="ident" id="6983120">t</span><span class="op" id="6983121">,</span>&nbsp;<span class="ident" id="6983123">newServer</span><span class="op" id="6983132">)</span><br>
<span class="lineno"></span><span class="op" id="6983134">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6983137">func</span>&nbsp;<span class="ident" id="6983142">testServeRequest</span><span class="op" id="6983158">(</span><span class="ident" id="6983159">t</span>&nbsp;<span class="op" id="6983161">*</span><span class="ident" id="6983162">testing</span><span class="op" id="6983169">.</span><span class="ident" id="6983170">T</span><span class="op" id="6983171">,</span>&nbsp;<span class="ident" id="6983173">server</span>&nbsp;<span class="op" id="6983180">*</span><span class="ident" id="6983181">Server</span><span class="op" id="6983187">)</span>&nbsp;<span class="op" id="6983189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983192">client</span>&nbsp;<span class="op" id="6983199">:=</span>&nbsp;<span class="ident" id="6983202">CodecEmulator</span><span class="op" id="6983215">{</span><span class="ident" id="6983216">server</span><span class="op" id="6983222">:</span>&nbsp;<span class="ident" id="6983224">server</span><span class="op" id="6983230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983233">defer</span>&nbsp;<span class="ident" id="6983239">client</span><span class="op" id="6983245">.</span><span class="ident" id="6983246">Close</span><span class="op" id="6983251">(</span><span class="op" id="6983252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983256">args</span>&nbsp;<span class="op" id="6983261">:=</span>&nbsp;<span class="op" id="6983264">&amp;</span><span class="ident" id="6983265">Args</span><span class="op" id="6983269">{</span><span class="num" id="6983270">7</span><span class="op" id="6983271">,</span>&nbsp;<span class="num" id="6983273">8</span><span class="op" id="6983274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983277">reply</span>&nbsp;<span class="op" id="6983283">:=</span>&nbsp;<span class="builtinfunc" id="6983286">new</span><span class="op" id="6983289">(</span><span class="ident" id="6983290">Reply</span><span class="op" id="6983295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983298">err</span>&nbsp;<span class="op" id="6983302">:=</span>&nbsp;<span class="ident" id="6983305">client</span><span class="op" id="6983311">.</span><span class="ident" id="6983312">Call</span><span class="op" id="6983316">(</span><span class="string" id="6983317">&#34;Arith.Add&#34;</span><span class="op" id="6983328">,</span>&nbsp;<span class="ident" id="6983330">args</span><span class="op" id="6983334">,</span>&nbsp;<span class="ident" id="6983336">reply</span><span class="op" id="6983341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983344">if</span>&nbsp;<span class="ident" id="6983347">err</span>&nbsp;<span class="op" id="6983351">!=</span>&nbsp;<span class="ident" id="6983354">nil</span>&nbsp;<span class="op" id="6983358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983362">t</span><span class="op" id="6983363">.</span><span class="ident" id="6983364">Errorf</span><span class="op" id="6983370">(</span><span class="string" id="6983371">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6983413">,</span>&nbsp;<span class="ident" id="6983415">err</span><span class="op" id="6983418">.</span><span class="ident" id="6983419">Error</span><span class="op" id="6983424">(</span><span class="op" id="6983425">)</span><span class="op" id="6983426">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983432">if</span>&nbsp;<span class="ident" id="6983435">reply</span><span class="op" id="6983440">.</span><span class="ident" id="6983441">C</span>&nbsp;<span class="op" id="6983443">!=</span>&nbsp;<span class="ident" id="6983446">args</span><span class="op" id="6983450">.</span><span class="ident" id="6983451">A</span><span class="op" id="6983452">+</span><span class="ident" id="6983453">args</span><span class="op" id="6983457">.</span><span class="ident" id="6983458">B</span>&nbsp;<span class="op" id="6983460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983464">t</span><span class="op" id="6983465">.</span><span class="ident" id="6983466">Errorf</span><span class="op" id="6983472">(</span><span class="string" id="6983473">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6983498">,</span>&nbsp;<span class="ident" id="6983500">reply</span><span class="op" id="6983505">.</span><span class="ident" id="6983506">C</span><span class="op" id="6983507">,</span>&nbsp;<span class="ident" id="6983509">args</span><span class="op" id="6983513">.</span><span class="ident" id="6983514">A</span><span class="op" id="6983515">+</span><span class="ident" id="6983516">args</span><span class="op" id="6983520">.</span><span class="ident" id="6983521">B</span><span class="op" id="6983522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983529">err</span>&nbsp;<span class="op" id="6983533">=</span>&nbsp;<span class="ident" id="6983535">client</span><span class="op" id="6983541">.</span><span class="ident" id="6983542">Call</span><span class="op" id="6983546">(</span><span class="string" id="6983547">&#34;Arith.Add&#34;</span><span class="op" id="6983558">,</span>&nbsp;<span class="ident" id="6983560">nil</span><span class="op" id="6983563">,</span>&nbsp;<span class="ident" id="6983565">reply</span><span class="op" id="6983570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983573">if</span>&nbsp;<span class="ident" id="6983576">err</span>&nbsp;<span class="op" id="6983580">==</span>&nbsp;<span class="ident" id="6983583">nil</span>&nbsp;<span class="op" id="6983587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6983591">t</span><span class="op" id="6983592">.</span><span class="ident" id="6983593">Errorf</span><span class="op" id="6983599">(</span><span class="string" id="6983600">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="6983647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6983650">}</span><br>
<span class="lineno"></span><span class="op" id="6983652">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="6983655">type</span>&nbsp;<span class="ident" id="6983660">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="6983676">int</span><br>
<span class="lineno"></span><span class="keyword" id="6983680">type</span>&nbsp;<span class="ident" id="6983685">ArgNotPublic</span>&nbsp;<span class="builtintype" id="6983698">int</span><br>
<span class="lineno"></span><span class="keyword" id="6983702">type</span>&nbsp;<span class="ident" id="6983707">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="6983722">int</span><br>
<span class="lineno"></span><span class="keyword" id="6983726">type</span>&nbsp;<span class="ident" id="6983731">NeedsPtrType</span>&nbsp;<span class="builtintype" id="6983744">int</span><br>
<span class="lineno">390</span><span class="keyword" id="6983748">type</span>&nbsp;<span class="ident" id="6983753">local</span>&nbsp;<span class="keyword" id="6983759">struct</span><span class="op" id="6983765">{</span><span class="op" id="6983766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6983769">func</span>&nbsp;<span class="op" id="6983774">(</span><span class="ident" id="6983775">t</span>&nbsp;<span class="op" id="6983777">*</span><span class="ident" id="6983778">ReplyNotPointer</span><span class="op" id="6983793">)</span>&nbsp;<span class="ident" id="6983795">ReplyNotPointer</span><span class="op" id="6983810">(</span><span class="ident" id="6983811">args</span>&nbsp;<span class="op" id="6983816">*</span><span class="ident" id="6983817">Args</span><span class="op" id="6983821">,</span>&nbsp;<span class="ident" id="6983823">reply</span>&nbsp;<span class="ident" id="6983829">Reply</span><span class="op" id="6983834">)</span>&nbsp;<span class="builtintype" id="6983836">error</span>&nbsp;<span class="op" id="6983842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983845">return</span>&nbsp;<span class="ident" id="6983852">nil</span><br>
<span class="lineno"></span><span class="op" id="6983856">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6983859">func</span>&nbsp;<span class="op" id="6983864">(</span><span class="ident" id="6983865">t</span>&nbsp;<span class="op" id="6983867">*</span><span class="ident" id="6983868">ArgNotPublic</span><span class="op" id="6983880">)</span>&nbsp;<span class="ident" id="6983882">ArgNotPublic</span><span class="op" id="6983894">(</span><span class="ident" id="6983895">args</span>&nbsp;<span class="op" id="6983900">*</span><span class="ident" id="6983901">local</span><span class="op" id="6983906">,</span>&nbsp;<span class="ident" id="6983908">reply</span>&nbsp;<span class="op" id="6983914">*</span><span class="ident" id="6983915">Reply</span><span class="op" id="6983920">)</span>&nbsp;<span class="builtintype" id="6983922">error</span>&nbsp;<span class="op" id="6983928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6983931">return</span>&nbsp;<span class="ident" id="6983938">nil</span><br>
<span class="lineno"></span><span class="op" id="6983942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="6983945">func</span>&nbsp;<span class="op" id="6983950">(</span><span class="ident" id="6983951">t</span>&nbsp;<span class="op" id="6983953">*</span><span class="ident" id="6983954">ReplyNotPublic</span><span class="op" id="6983968">)</span>&nbsp;<span class="ident" id="6983970">ReplyNotPublic</span><span class="op" id="6983984">(</span><span class="ident" id="6983985">args</span>&nbsp;<span class="op" id="6983990">*</span><span class="ident" id="6983991">Args</span><span class="op" id="6983995">,</span>&nbsp;<span class="ident" id="6983997">reply</span>&nbsp;<span class="op" id="6984003">*</span><span class="ident" id="6984004">local</span><span class="op" id="6984009">)</span>&nbsp;<span class="builtintype" id="6984011">error</span>&nbsp;<span class="op" id="6984017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984020">return</span>&nbsp;<span class="ident" id="6984027">nil</span><br>
<span class="lineno"></span><span class="op" id="6984031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6984034">func</span>&nbsp;<span class="op" id="6984039">(</span><span class="ident" id="6984040">t</span>&nbsp;<span class="op" id="6984042">*</span><span class="ident" id="6984043">NeedsPtrType</span><span class="op" id="6984055">)</span>&nbsp;<span class="ident" id="6984057">NeedsPtrType</span><span class="op" id="6984069">(</span><span class="ident" id="6984070">args</span>&nbsp;<span class="op" id="6984075">*</span><span class="ident" id="6984076">Args</span><span class="op" id="6984080">,</span>&nbsp;<span class="ident" id="6984082">reply</span>&nbsp;<span class="op" id="6984088">*</span><span class="ident" id="6984089">Reply</span><span class="op" id="6984094">)</span>&nbsp;<span class="builtintype" id="6984096">error</span>&nbsp;<span class="op" id="6984102">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984105">return</span>&nbsp;<span class="ident" id="6984112">nil</span><br>
<span class="lineno"></span><span class="op" id="6984116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6984119">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6984211">func</span>&nbsp;<span class="ident" id="6984216">TestRegistrationError</span><span class="op" id="6984237">(</span><span class="ident" id="6984238">t</span>&nbsp;<span class="op" id="6984240">*</span><span class="ident" id="6984241">testing</span><span class="op" id="6984248">.</span><span class="ident" id="6984249">T</span><span class="op" id="6984250">)</span>&nbsp;<span class="op" id="6984252">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984255">err</span>&nbsp;<span class="op" id="6984259">:=</span>&nbsp;<span class="ident" id="6984262">Register</span><span class="op" id="6984270">(</span><span class="builtinfunc" id="6984271">new</span><span class="op" id="6984274">(</span><span class="ident" id="6984275">ReplyNotPointer</span><span class="op" id="6984290">)</span><span class="op" id="6984291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984294">if</span>&nbsp;<span class="ident" id="6984297">err</span>&nbsp;<span class="op" id="6984301">==</span>&nbsp;<span class="ident" id="6984304">nil</span>&nbsp;<span class="op" id="6984308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984312">t</span><span class="op" id="6984313">.</span><span class="ident" id="6984314">Error</span><span class="op" id="6984319">(</span><span class="string" id="6984320">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="6984364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984370">err</span>&nbsp;<span class="op" id="6984374">=</span>&nbsp;<span class="ident" id="6984376">Register</span><span class="op" id="6984384">(</span><span class="builtinfunc" id="6984385">new</span><span class="op" id="6984388">(</span><span class="ident" id="6984389">ArgNotPublic</span><span class="op" id="6984401">)</span><span class="op" id="6984402">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984405">if</span>&nbsp;<span class="ident" id="6984408">err</span>&nbsp;<span class="op" id="6984412">==</span>&nbsp;<span class="ident" id="6984415">nil</span>&nbsp;<span class="op" id="6984419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984423">t</span><span class="op" id="6984424">.</span><span class="ident" id="6984425">Error</span><span class="op" id="6984430">(</span><span class="string" id="6984431">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="6984472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984478">err</span>&nbsp;<span class="op" id="6984482">=</span>&nbsp;<span class="ident" id="6984484">Register</span><span class="op" id="6984492">(</span><span class="builtinfunc" id="6984493">new</span><span class="op" id="6984496">(</span><span class="ident" id="6984497">ReplyNotPublic</span><span class="op" id="6984511">)</span><span class="op" id="6984512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984515">if</span>&nbsp;<span class="ident" id="6984518">err</span>&nbsp;<span class="op" id="6984522">==</span>&nbsp;<span class="ident" id="6984525">nil</span>&nbsp;<span class="op" id="6984529">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984533">t</span><span class="op" id="6984534">.</span><span class="ident" id="6984535">Error</span><span class="op" id="6984540">(</span><span class="string" id="6984541">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="6984584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984590">err</span>&nbsp;<span class="op" id="6984594">=</span>&nbsp;<span class="ident" id="6984596">Register</span><span class="op" id="6984604">(</span><span class="ident" id="6984605">NeedsPtrType</span><span class="op" id="6984617">(</span><span class="num" id="6984618">0</span><span class="op" id="6984619">)</span><span class="op" id="6984620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984623">if</span>&nbsp;<span class="ident" id="6984626">err</span>&nbsp;<span class="op" id="6984630">==</span>&nbsp;<span class="ident" id="6984633">nil</span>&nbsp;<span class="op" id="6984637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984641">t</span><span class="op" id="6984642">.</span><span class="ident" id="6984643">Error</span><span class="op" id="6984648">(</span><span class="string" id="6984649">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6984690">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984693">}</span>&nbsp;<span class="keyword" id="6984695">else</span>&nbsp;<span class="keyword" id="6984700">if</span>&nbsp;<span class="op" id="6984703">!</span><span class="ident" id="6984704">strings</span><span class="op" id="6984711">.</span><span class="ident" id="6984712">Contains</span><span class="op" id="6984720">(</span><span class="ident" id="6984721">err</span><span class="op" id="6984724">.</span><span class="ident" id="6984725">Error</span><span class="op" id="6984730">(</span><span class="op" id="6984731">)</span><span class="op" id="6984732">,</span>&nbsp;<span class="string" id="6984734">&#34;pointer&#34;</span><span class="op" id="6984743">)</span>&nbsp;<span class="op" id="6984745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6984749">t</span><span class="op" id="6984750">.</span><span class="ident" id="6984751">Error</span><span class="op" id="6984756">(</span><span class="string" id="6984757">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6984802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6984805">}</span><br>
<span class="lineno"></span><span class="op" id="6984807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6984810">type</span>&nbsp;<span class="ident" id="6984815">WriteFailCodec</span>&nbsp;<span class="builtintype" id="6984830">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6984835">func</span>&nbsp;<span class="op" id="6984840">(</span><span class="ident" id="6984841">WriteFailCodec</span><span class="op" id="6984855">)</span>&nbsp;<span class="ident" id="6984857">WriteRequest</span><span class="op" id="6984869">(</span><span class="op" id="6984870">*</span><span class="ident" id="6984871">Request</span><span class="op" id="6984878">,</span>&nbsp;<span class="keyword" id="6984880">interface</span><span class="op" id="6984889">{</span><span class="op" id="6984890">}</span><span class="op" id="6984891">)</span>&nbsp;<span class="builtintype" id="6984893">error</span>&nbsp;<span class="op" id="6984899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6984902">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6984964">return</span>&nbsp;<span class="ident" id="6984971">errors</span><span class="op" id="6984977">.</span><span class="ident" id="6984978">New</span><span class="op" id="6984981">(</span><span class="string" id="6984982">&#34;fail&#34;</span><span class="op" id="6984988">)</span><br>
<span class="lineno">435</span><span class="op" id="6984990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6984993">func</span>&nbsp;<span class="op" id="6984998">(</span><span class="ident" id="6984999">WriteFailCodec</span><span class="op" id="6985013">)</span>&nbsp;<span class="ident" id="6985015">ReadResponseHeader</span><span class="op" id="6985033">(</span><span class="op" id="6985034">*</span><span class="ident" id="6985035">Response</span><span class="op" id="6985043">)</span>&nbsp;<span class="builtintype" id="6985045">error</span>&nbsp;<span class="op" id="6985051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985054">select</span>&nbsp;<span class="op" id="6985061">{</span><span class="op" id="6985062">}</span><br>
<span class="lineno"></span><span class="op" id="6985064">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="6985067">func</span>&nbsp;<span class="op" id="6985072">(</span><span class="ident" id="6985073">WriteFailCodec</span><span class="op" id="6985087">)</span>&nbsp;<span class="ident" id="6985089">ReadResponseBody</span><span class="op" id="6985105">(</span><span class="keyword" id="6985106">interface</span><span class="op" id="6985115">{</span><span class="op" id="6985116">}</span><span class="op" id="6985117">)</span>&nbsp;<span class="builtintype" id="6985119">error</span>&nbsp;<span class="op" id="6985125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985128">select</span>&nbsp;<span class="op" id="6985135">{</span><span class="op" id="6985136">}</span><br>
<span class="lineno"></span><span class="op" id="6985138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="6985141">func</span>&nbsp;<span class="op" id="6985146">(</span><span class="ident" id="6985147">WriteFailCodec</span><span class="op" id="6985161">)</span>&nbsp;<span class="ident" id="6985163">Close</span><span class="op" id="6985168">(</span><span class="op" id="6985169">)</span>&nbsp;<span class="builtintype" id="6985171">error</span>&nbsp;<span class="op" id="6985177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985180">return</span>&nbsp;<span class="ident" id="6985187">nil</span><br>
<span class="lineno"></span><span class="op" id="6985191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985194">func</span>&nbsp;<span class="ident" id="6985199">TestSendDeadlock</span><span class="op" id="6985215">(</span><span class="ident" id="6985216">t</span>&nbsp;<span class="op" id="6985218">*</span><span class="ident" id="6985219">testing</span><span class="op" id="6985226">.</span><span class="ident" id="6985227">T</span><span class="op" id="6985228">)</span>&nbsp;<span class="op" id="6985230">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985233">client</span>&nbsp;<span class="op" id="6985240">:=</span>&nbsp;<span class="ident" id="6985243">NewClientWithCodec</span><span class="op" id="6985261">(</span><span class="ident" id="6985262">WriteFailCodec</span><span class="op" id="6985276">(</span><span class="num" id="6985277">0</span><span class="op" id="6985278">)</span><span class="op" id="6985279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985282">defer</span>&nbsp;<span class="ident" id="6985288">client</span><span class="op" id="6985294">.</span><span class="ident" id="6985295">Close</span><span class="op" id="6985300">(</span><span class="op" id="6985301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985305">done</span>&nbsp;<span class="op" id="6985310">:=</span>&nbsp;<span class="builtinfunc" id="6985313">make</span><span class="op" id="6985317">(</span><span class="keyword" id="6985318">chan</span>&nbsp;<span class="builtintype" id="6985323">bool</span><span class="op" id="6985327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985330">go</span>&nbsp;<span class="keyword" id="6985333">func</span><span class="op" id="6985337">(</span><span class="op" id="6985338">)</span>&nbsp;<span class="op" id="6985340">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985344">testSendDeadlock</span><span class="op" id="6985360">(</span><span class="ident" id="6985361">client</span><span class="op" id="6985367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985371">testSendDeadlock</span><span class="op" id="6985387">(</span><span class="ident" id="6985388">client</span><span class="op" id="6985394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985398">done</span>&nbsp;<span class="op" id="6985403">&lt;-</span>&nbsp;<span class="builtintype" id="6985406">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985412">}</span><span class="op" id="6985413">(</span><span class="op" id="6985414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985417">select</span>&nbsp;<span class="op" id="6985424">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985427">case</span>&nbsp;<span class="op" id="6985432">&lt;-</span><span class="ident" id="6985434">done</span><span class="op" id="6985438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985442">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985450">case</span>&nbsp;<span class="op" id="6985455">&lt;-</span><span class="ident" id="6985457">time</span><span class="op" id="6985461">.</span><span class="ident" id="6985462">After</span><span class="op" id="6985467">(</span><span class="num" id="6985468">5</span>&nbsp;<span class="op" id="6985470">*</span>&nbsp;<span class="ident" id="6985472">time</span><span class="op" id="6985476">.</span><span class="ident" id="6985477">Second</span><span class="op" id="6985483">)</span><span class="op" id="6985484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985488">t</span><span class="op" id="6985489">.</span><span class="ident" id="6985490">Fatal</span><span class="op" id="6985495">(</span><span class="string" id="6985496">&#34;deadlock&#34;</span><span class="op" id="6985506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985509">}</span><br>
<span class="lineno">465</span><span class="op" id="6985511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985514">func</span>&nbsp;<span class="ident" id="6985519">testSendDeadlock</span><span class="op" id="6985535">(</span><span class="ident" id="6985536">client</span>&nbsp;<span class="op" id="6985543">*</span><span class="ident" id="6985544">Client</span><span class="op" id="6985550">)</span>&nbsp;<span class="op" id="6985552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985555">defer</span>&nbsp;<span class="keyword" id="6985561">func</span><span class="op" id="6985565">(</span><span class="op" id="6985566">)</span>&nbsp;<span class="op" id="6985568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6985572">recover</span><span class="op" id="6985579">(</span><span class="op" id="6985580">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985583">}</span><span class="op" id="6985584">(</span><span class="op" id="6985585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985588">args</span>&nbsp;<span class="op" id="6985593">:=</span>&nbsp;<span class="op" id="6985596">&amp;</span><span class="ident" id="6985597">Args</span><span class="op" id="6985601">{</span><span class="num" id="6985602">7</span><span class="op" id="6985603">,</span>&nbsp;<span class="num" id="6985605">8</span><span class="op" id="6985606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985609">reply</span>&nbsp;<span class="op" id="6985615">:=</span>&nbsp;<span class="builtinfunc" id="6985618">new</span><span class="op" id="6985621">(</span><span class="ident" id="6985622">Reply</span><span class="op" id="6985627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985630">client</span><span class="op" id="6985636">.</span><span class="ident" id="6985637">Call</span><span class="op" id="6985641">(</span><span class="string" id="6985642">&#34;Arith.Add&#34;</span><span class="op" id="6985653">,</span>&nbsp;<span class="ident" id="6985655">args</span><span class="op" id="6985659">,</span>&nbsp;<span class="ident" id="6985661">reply</span><span class="op" id="6985666">)</span><br>
<span class="lineno"></span><span class="op" id="6985668">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6985671">func</span>&nbsp;<span class="ident" id="6985676">dialDirect</span><span class="op" id="6985686">(</span><span class="op" id="6985687">)</span>&nbsp;<span class="op" id="6985689">(</span><span class="op" id="6985690">*</span><span class="ident" id="6985691">Client</span><span class="op" id="6985697">,</span>&nbsp;<span class="builtintype" id="6985699">error</span><span class="op" id="6985704">)</span>&nbsp;<span class="op" id="6985706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985709">return</span>&nbsp;<span class="ident" id="6985716">Dial</span><span class="op" id="6985720">(</span><span class="string" id="6985721">&#34;tcp&#34;</span><span class="op" id="6985726">,</span>&nbsp;<span class="ident" id="6985728">serverAddr</span><span class="op" id="6985738">)</span><br>
<span class="lineno"></span><span class="op" id="6985740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6985743">func</span>&nbsp;<span class="ident" id="6985748">dialHTTP</span><span class="op" id="6985756">(</span><span class="op" id="6985757">)</span>&nbsp;<span class="op" id="6985759">(</span><span class="op" id="6985760">*</span><span class="ident" id="6985761">Client</span><span class="op" id="6985767">,</span>&nbsp;<span class="builtintype" id="6985769">error</span><span class="op" id="6985774">)</span>&nbsp;<span class="op" id="6985776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985779">return</span>&nbsp;<span class="ident" id="6985786">DialHTTP</span><span class="op" id="6985794">(</span><span class="string" id="6985795">&#34;tcp&#34;</span><span class="op" id="6985800">,</span>&nbsp;<span class="ident" id="6985802">httpServerAddr</span><span class="op" id="6985816">)</span><br>
<span class="lineno"></span><span class="op" id="6985818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985821">func</span>&nbsp;<span class="ident" id="6985826">countMallocs</span><span class="op" id="6985838">(</span><span class="ident" id="6985839">dial</span>&nbsp;<span class="keyword" id="6985844">func</span><span class="op" id="6985848">(</span><span class="op" id="6985849">)</span>&nbsp;<span class="op" id="6985851">(</span><span class="op" id="6985852">*</span><span class="ident" id="6985853">Client</span><span class="op" id="6985859">,</span>&nbsp;<span class="builtintype" id="6985861">error</span><span class="op" id="6985866">)</span><span class="op" id="6985867">,</span>&nbsp;<span class="ident" id="6985869">t</span>&nbsp;<span class="op" id="6985871">*</span><span class="ident" id="6985872">testing</span><span class="op" id="6985879">.</span><span class="ident" id="6985880">T</span><span class="op" id="6985881">)</span>&nbsp;<span class="builtintype" id="6985883">float64</span>&nbsp;<span class="op" id="6985891">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985894">once</span><span class="op" id="6985898">.</span><span class="ident" id="6985899">Do</span><span class="op" id="6985901">(</span><span class="ident" id="6985902">startServer</span><span class="op" id="6985913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985916">client</span><span class="op" id="6985922">,</span>&nbsp;<span class="ident" id="6985924">err</span>&nbsp;<span class="op" id="6985928">:=</span>&nbsp;<span class="ident" id="6985931">dial</span><span class="op" id="6985935">(</span><span class="op" id="6985936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985939">if</span>&nbsp;<span class="ident" id="6985942">err</span>&nbsp;<span class="op" id="6985946">!=</span>&nbsp;<span class="ident" id="6985949">nil</span>&nbsp;<span class="op" id="6985953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6985957">t</span><span class="op" id="6985958">.</span><span class="ident" id="6985959">Fatal</span><span class="op" id="6985964">(</span><span class="string" id="6985965">&#34;error&nbsp;dialing&#34;</span><span class="op" id="6985980">,</span>&nbsp;<span class="ident" id="6985982">err</span><span class="op" id="6985985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6985988">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6985991">defer</span>&nbsp;<span class="ident" id="6985997">client</span><span class="op" id="6986003">.</span><span class="ident" id="6986004">Close</span><span class="op" id="6986009">(</span><span class="op" id="6986010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986014">args</span>&nbsp;<span class="op" id="6986019">:=</span>&nbsp;<span class="op" id="6986022">&amp;</span><span class="ident" id="6986023">Args</span><span class="op" id="6986027">{</span><span class="num" id="6986028">7</span><span class="op" id="6986029">,</span>&nbsp;<span class="num" id="6986031">8</span><span class="op" id="6986032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986035">reply</span>&nbsp;<span class="op" id="6986041">:=</span>&nbsp;<span class="builtinfunc" id="6986044">new</span><span class="op" id="6986047">(</span><span class="ident" id="6986048">Reply</span><span class="op" id="6986053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986056">return</span>&nbsp;<span class="ident" id="6986063">testing</span><span class="op" id="6986070">.</span><span class="ident" id="6986071">AllocsPerRun</span><span class="op" id="6986083">(</span><span class="num" id="6986084">100</span><span class="op" id="6986087">,</span>&nbsp;<span class="keyword" id="6986089">func</span><span class="op" id="6986093">(</span><span class="op" id="6986094">)</span>&nbsp;<span class="op" id="6986096">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986100">err</span>&nbsp;<span class="op" id="6986104">:=</span>&nbsp;<span class="ident" id="6986107">client</span><span class="op" id="6986113">.</span><span class="ident" id="6986114">Call</span><span class="op" id="6986118">(</span><span class="string" id="6986119">&#34;Arith.Add&#34;</span><span class="op" id="6986130">,</span>&nbsp;<span class="ident" id="6986132">args</span><span class="op" id="6986136">,</span>&nbsp;<span class="ident" id="6986138">reply</span><span class="op" id="6986143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986147">if</span>&nbsp;<span class="ident" id="6986150">err</span>&nbsp;<span class="op" id="6986154">!=</span>&nbsp;<span class="ident" id="6986157">nil</span>&nbsp;<span class="op" id="6986161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986166">t</span><span class="op" id="6986167">.</span><span class="ident" id="6986168">Errorf</span><span class="op" id="6986174">(</span><span class="string" id="6986175">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6986217">,</span>&nbsp;<span class="ident" id="6986219">err</span><span class="op" id="6986222">.</span><span class="ident" id="6986223">Error</span><span class="op" id="6986228">(</span><span class="op" id="6986229">)</span><span class="op" id="6986230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986238">if</span>&nbsp;<span class="ident" id="6986241">reply</span><span class="op" id="6986246">.</span><span class="ident" id="6986247">C</span>&nbsp;<span class="op" id="6986249">!=</span>&nbsp;<span class="ident" id="6986252">args</span><span class="op" id="6986256">.</span><span class="ident" id="6986257">A</span><span class="op" id="6986258">+</span><span class="ident" id="6986259">args</span><span class="op" id="6986263">.</span><span class="ident" id="6986264">B</span>&nbsp;<span class="op" id="6986266">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986271">t</span><span class="op" id="6986272">.</span><span class="ident" id="6986273">Errorf</span><span class="op" id="6986279">(</span><span class="string" id="6986280">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6986305">,</span>&nbsp;<span class="ident" id="6986307">reply</span><span class="op" id="6986312">.</span><span class="ident" id="6986313">C</span><span class="op" id="6986314">,</span>&nbsp;<span class="ident" id="6986316">args</span><span class="op" id="6986320">.</span><span class="ident" id="6986321">A</span><span class="op" id="6986322">+</span><span class="ident" id="6986323">args</span><span class="op" id="6986327">.</span><span class="ident" id="6986328">B</span><span class="op" id="6986329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986336">}</span><span class="op" id="6986337">)</span><br>
<span class="lineno"></span><span class="op" id="6986339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6986342">func</span>&nbsp;<span class="ident" id="6986347">TestCountMallocs</span><span class="op" id="6986363">(</span><span class="ident" id="6986364">t</span>&nbsp;<span class="op" id="6986366">*</span><span class="ident" id="6986367">testing</span><span class="op" id="6986374">.</span><span class="ident" id="6986375">T</span><span class="op" id="6986376">)</span>&nbsp;<span class="op" id="6986378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986381">if</span>&nbsp;<span class="ident" id="6986384">testing</span><span class="op" id="6986391">.</span><span class="ident" id="6986392">Short</span><span class="op" id="6986397">(</span><span class="op" id="6986398">)</span>&nbsp;<span class="op" id="6986400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986404">t</span><span class="op" id="6986405">.</span><span class="ident" id="6986406">Skip</span><span class="op" id="6986410">(</span><span class="string" id="6986411">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6986448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986454">if</span>&nbsp;<span class="ident" id="6986457">runtime</span><span class="op" id="6986464">.</span><span class="ident" id="6986465">GOMAXPROCS</span><span class="op" id="6986475">(</span><span class="num" id="6986476">0</span><span class="op" id="6986477">)</span>&nbsp;<span class="op" id="6986479">&gt;</span>&nbsp;<span class="num" id="6986481">1</span>&nbsp;<span class="op" id="6986483">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986487">t</span><span class="op" id="6986488">.</span><span class="ident" id="6986489">Skip</span><span class="op" id="6986493">(</span><span class="string" id="6986494">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6986518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986524">fmt</span><span class="op" id="6986527">.</span><span class="ident" id="6986528">Printf</span><span class="op" id="6986534">(</span><span class="string" id="6986535">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6986569">,</span>&nbsp;<span class="ident" id="6986571">countMallocs</span><span class="op" id="6986583">(</span><span class="ident" id="6986584">dialDirect</span><span class="op" id="6986594">,</span>&nbsp;<span class="ident" id="6986596">t</span><span class="op" id="6986597">)</span><span class="op" id="6986598">)</span><br>
<span class="lineno"></span><span class="op" id="6986600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6986603">func</span>&nbsp;<span class="ident" id="6986608">TestCountMallocsOverHTTP</span><span class="op" id="6986632">(</span><span class="ident" id="6986633">t</span>&nbsp;<span class="op" id="6986635">*</span><span class="ident" id="6986636">testing</span><span class="op" id="6986643">.</span><span class="ident" id="6986644">T</span><span class="op" id="6986645">)</span>&nbsp;<span class="op" id="6986647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986650">if</span>&nbsp;<span class="ident" id="6986653">testing</span><span class="op" id="6986660">.</span><span class="ident" id="6986661">Short</span><span class="op" id="6986666">(</span><span class="op" id="6986667">)</span>&nbsp;<span class="op" id="6986669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986673">t</span><span class="op" id="6986674">.</span><span class="ident" id="6986675">Skip</span><span class="op" id="6986679">(</span><span class="string" id="6986680">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6986717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986723">if</span>&nbsp;<span class="ident" id="6986726">runtime</span><span class="op" id="6986733">.</span><span class="ident" id="6986734">GOMAXPROCS</span><span class="op" id="6986744">(</span><span class="num" id="6986745">0</span><span class="op" id="6986746">)</span>&nbsp;<span class="op" id="6986748">&gt;</span>&nbsp;<span class="num" id="6986750">1</span>&nbsp;<span class="op" id="6986752">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986756">t</span><span class="op" id="6986757">.</span><span class="ident" id="6986758">Skip</span><span class="op" id="6986762">(</span><span class="string" id="6986763">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6986787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6986790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986793">fmt</span><span class="op" id="6986796">.</span><span class="ident" id="6986797">Printf</span><span class="op" id="6986803">(</span><span class="string" id="6986804">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6986843">,</span>&nbsp;<span class="ident" id="6986845">countMallocs</span><span class="op" id="6986857">(</span><span class="ident" id="6986858">dialHTTP</span><span class="op" id="6986866">,</span>&nbsp;<span class="ident" id="6986868">t</span><span class="op" id="6986869">)</span><span class="op" id="6986870">)</span><br>
<span class="lineno"></span><span class="op" id="6986872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6986875">type</span>&nbsp;<span class="ident" id="6986880">writeCrasher</span>&nbsp;<span class="keyword" id="6986893">struct</span>&nbsp;<span class="op" id="6986900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6986903">done</span>&nbsp;<span class="keyword" id="6986908">chan</span>&nbsp;<span class="builtintype" id="6986913">bool</span><br>
<span class="lineno"></span><span class="op" id="6986918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6986921">func</span>&nbsp;<span class="op" id="6986926">(</span><span class="ident" id="6986927">writeCrasher</span><span class="op" id="6986939">)</span>&nbsp;<span class="ident" id="6986941">Close</span><span class="op" id="6986946">(</span><span class="op" id="6986947">)</span>&nbsp;<span class="builtintype" id="6986949">error</span>&nbsp;<span class="op" id="6986955">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6986958">return</span>&nbsp;<span class="ident" id="6986965">nil</span><br>
<span class="lineno"></span><span class="op" id="6986969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6986972">func</span>&nbsp;<span class="op" id="6986977">(</span><span class="ident" id="6986978">w</span>&nbsp;<span class="op" id="6986980">*</span><span class="ident" id="6986981">writeCrasher</span><span class="op" id="6986993">)</span>&nbsp;<span class="ident" id="6986995">Read</span><span class="op" id="6986999">(</span><span class="ident" id="6987000">p</span>&nbsp;<span class="op" id="6987002">[</span><span class="op" id="6987003">]</span><span class="builtintype" id="6987004">byte</span><span class="op" id="6987008">)</span>&nbsp;<span class="op" id="6987010">(</span><span class="builtintype" id="6987011">int</span><span class="op" id="6987014">,</span>&nbsp;<span class="builtintype" id="6987016">error</span><span class="op" id="6987021">)</span>&nbsp;<span class="op" id="6987023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987026">&lt;-</span><span class="ident" id="6987028">w</span><span class="op" id="6987029">.</span><span class="ident" id="6987030">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987036">return</span>&nbsp;<span class="num" id="6987043">0</span><span class="op" id="6987044">,</span>&nbsp;<span class="ident" id="6987046">io</span><span class="op" id="6987048">.</span><span class="ident" id="6987049">EOF</span><br>
<span class="lineno"></span><span class="op" id="6987053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987056">func</span>&nbsp;<span class="op" id="6987061">(</span><span class="ident" id="6987062">writeCrasher</span><span class="op" id="6987074">)</span>&nbsp;<span class="ident" id="6987076">Write</span><span class="op" id="6987081">(</span><span class="ident" id="6987082">p</span>&nbsp;<span class="op" id="6987084">[</span><span class="op" id="6987085">]</span><span class="builtintype" id="6987086">byte</span><span class="op" id="6987090">)</span>&nbsp;<span class="op" id="6987092">(</span><span class="builtintype" id="6987093">int</span><span class="op" id="6987096">,</span>&nbsp;<span class="builtintype" id="6987098">error</span><span class="op" id="6987103">)</span>&nbsp;<span class="op" id="6987105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987108">return</span>&nbsp;<span class="num" id="6987115">0</span><span class="op" id="6987116">,</span>&nbsp;<span class="ident" id="6987118">errors</span><span class="op" id="6987124">.</span><span class="ident" id="6987125">New</span><span class="op" id="6987128">(</span><span class="string" id="6987129">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="6987149">)</span><br>
<span class="lineno">540</span><span class="op" id="6987151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987154">func</span>&nbsp;<span class="ident" id="6987159">TestClientWriteError</span><span class="op" id="6987179">(</span><span class="ident" id="6987180">t</span>&nbsp;<span class="op" id="6987182">*</span><span class="ident" id="6987183">testing</span><span class="op" id="6987190">.</span><span class="ident" id="6987191">T</span><span class="op" id="6987192">)</span>&nbsp;<span class="op" id="6987194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987197">w</span>&nbsp;<span class="op" id="6987199">:=</span>&nbsp;<span class="op" id="6987202">&amp;</span><span class="ident" id="6987203">writeCrasher</span><span class="op" id="6987215">{</span><span class="ident" id="6987216">done</span><span class="op" id="6987220">:</span>&nbsp;<span class="builtinfunc" id="6987222">make</span><span class="op" id="6987226">(</span><span class="keyword" id="6987227">chan</span>&nbsp;<span class="builtintype" id="6987232">bool</span><span class="op" id="6987236">)</span><span class="op" id="6987237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987240">c</span>&nbsp;<span class="op" id="6987242">:=</span>&nbsp;<span class="ident" id="6987245">NewClient</span><span class="op" id="6987254">(</span><span class="ident" id="6987255">w</span><span class="op" id="6987256">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987259">defer</span>&nbsp;<span class="ident" id="6987265">c</span><span class="op" id="6987266">.</span><span class="ident" id="6987267">Close</span><span class="op" id="6987272">(</span><span class="op" id="6987273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987277">res</span>&nbsp;<span class="op" id="6987281">:=</span>&nbsp;<span class="builtintype" id="6987284">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987291">err</span>&nbsp;<span class="op" id="6987295">:=</span>&nbsp;<span class="ident" id="6987298">c</span><span class="op" id="6987299">.</span><span class="ident" id="6987300">Call</span><span class="op" id="6987304">(</span><span class="string" id="6987305">&#34;foo&#34;</span><span class="op" id="6987310">,</span>&nbsp;<span class="num" id="6987312">1</span><span class="op" id="6987313">,</span>&nbsp;<span class="op" id="6987315">&amp;</span><span class="ident" id="6987316">res</span><span class="op" id="6987319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987322">if</span>&nbsp;<span class="ident" id="6987325">err</span>&nbsp;<span class="op" id="6987329">==</span>&nbsp;<span class="ident" id="6987332">nil</span>&nbsp;<span class="op" id="6987336">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987340">t</span><span class="op" id="6987341">.</span><span class="ident" id="6987342">Fatal</span><span class="op" id="6987347">(</span><span class="string" id="6987348">&#34;expected&nbsp;error&#34;</span><span class="op" id="6987364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987370">if</span>&nbsp;<span class="ident" id="6987373">err</span><span class="op" id="6987376">.</span><span class="ident" id="6987377">Error</span><span class="op" id="6987382">(</span><span class="op" id="6987383">)</span>&nbsp;<span class="op" id="6987385">!=</span>&nbsp;<span class="string" id="6987388">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="6987409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987413">t</span><span class="op" id="6987414">.</span><span class="ident" id="6987415">Error</span><span class="op" id="6987420">(</span><span class="string" id="6987421">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="6987449">,</span>&nbsp;<span class="ident" id="6987451">err</span><span class="op" id="6987454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987457">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987460">w</span><span class="op" id="6987461">.</span><span class="ident" id="6987462">done</span>&nbsp;<span class="op" id="6987467">&lt;-</span>&nbsp;<span class="builtintype" id="6987470">true</span><br>
<span class="lineno"></span><span class="op" id="6987475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987478">func</span>&nbsp;<span class="ident" id="6987483">TestTCPClose</span><span class="op" id="6987495">(</span><span class="ident" id="6987496">t</span>&nbsp;<span class="op" id="6987498">*</span><span class="ident" id="6987499">testing</span><span class="op" id="6987506">.</span><span class="ident" id="6987507">T</span><span class="op" id="6987508">)</span>&nbsp;<span class="op" id="6987510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987513">once</span><span class="op" id="6987517">.</span><span class="ident" id="6987518">Do</span><span class="op" id="6987520">(</span><span class="ident" id="6987521">startServer</span><span class="op" id="6987532">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987536">client</span><span class="op" id="6987542">,</span>&nbsp;<span class="ident" id="6987544">err</span>&nbsp;<span class="op" id="6987548">:=</span>&nbsp;<span class="ident" id="6987551">dialHTTP</span><span class="op" id="6987559">(</span><span class="op" id="6987560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987563">if</span>&nbsp;<span class="ident" id="6987566">err</span>&nbsp;<span class="op" id="6987570">!=</span>&nbsp;<span class="ident" id="6987573">nil</span>&nbsp;<span class="op" id="6987577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987581">t</span><span class="op" id="6987582">.</span><span class="ident" id="6987583">Fatalf</span><span class="op" id="6987589">(</span><span class="string" id="6987590">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6987603">,</span>&nbsp;<span class="ident" id="6987605">err</span><span class="op" id="6987608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987611">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987614">defer</span>&nbsp;<span class="ident" id="6987620">client</span><span class="op" id="6987626">.</span><span class="ident" id="6987627">Close</span><span class="op" id="6987632">(</span><span class="op" id="6987633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987637">args</span>&nbsp;<span class="op" id="6987642">:=</span>&nbsp;<span class="ident" id="6987645">Args</span><span class="op" id="6987649">{</span><span class="num" id="6987650">17</span><span class="op" id="6987652">,</span>&nbsp;<span class="num" id="6987654">8</span><span class="op" id="6987655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987658">var</span>&nbsp;<span class="ident" id="6987662">reply</span>&nbsp;<span class="ident" id="6987668">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987675">err</span>&nbsp;<span class="op" id="6987679">=</span>&nbsp;<span class="ident" id="6987681">client</span><span class="op" id="6987687">.</span><span class="ident" id="6987688">Call</span><span class="op" id="6987692">(</span><span class="string" id="6987693">&#34;Arith.Mul&#34;</span><span class="op" id="6987704">,</span>&nbsp;<span class="ident" id="6987706">args</span><span class="op" id="6987710">,</span>&nbsp;<span class="op" id="6987712">&amp;</span><span class="ident" id="6987713">reply</span><span class="op" id="6987718">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987721">if</span>&nbsp;<span class="ident" id="6987724">err</span>&nbsp;<span class="op" id="6987728">!=</span>&nbsp;<span class="ident" id="6987731">nil</span>&nbsp;<span class="op" id="6987735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987739">t</span><span class="op" id="6987740">.</span><span class="ident" id="6987741">Fatal</span><span class="op" id="6987746">(</span><span class="string" id="6987747">&#34;arith&nbsp;error:&#34;</span><span class="op" id="6987761">,</span>&nbsp;<span class="ident" id="6987763">err</span><span class="op" id="6987766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987772">t</span><span class="op" id="6987773">.</span><span class="ident" id="6987774">Logf</span><span class="op" id="6987778">(</span><span class="string" id="6987779">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="6987798">,</span>&nbsp;<span class="ident" id="6987800">args</span><span class="op" id="6987804">.</span><span class="ident" id="6987805">A</span><span class="op" id="6987806">,</span>&nbsp;<span class="ident" id="6987808">args</span><span class="op" id="6987812">.</span><span class="ident" id="6987813">B</span><span class="op" id="6987814">,</span>&nbsp;<span class="ident" id="6987816">reply</span><span class="op" id="6987821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6987824">if</span>&nbsp;<span class="ident" id="6987827">reply</span><span class="op" id="6987832">.</span><span class="ident" id="6987833">C</span>&nbsp;<span class="op" id="6987835">!=</span>&nbsp;<span class="ident" id="6987838">args</span><span class="op" id="6987842">.</span><span class="ident" id="6987843">A</span><span class="op" id="6987844">*</span><span class="ident" id="6987845">args</span><span class="op" id="6987849">.</span><span class="ident" id="6987850">B</span>&nbsp;<span class="op" id="6987852">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987856">t</span><span class="op" id="6987857">.</span><span class="ident" id="6987858">Errorf</span><span class="op" id="6987864">(</span><span class="string" id="6987865">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6987890">,</span>&nbsp;<span class="ident" id="6987892">reply</span><span class="op" id="6987897">.</span><span class="ident" id="6987898">C</span><span class="op" id="6987899">,</span>&nbsp;<span class="ident" id="6987901">args</span><span class="op" id="6987905">.</span><span class="ident" id="6987906">A</span><span class="op" id="6987907">*</span><span class="ident" id="6987908">args</span><span class="op" id="6987912">.</span><span class="ident" id="6987913">B</span><span class="op" id="6987914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6987917">}</span><br>
<span class="lineno"></span><span class="op" id="6987919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987922">func</span>&nbsp;<span class="ident" id="6987927">TestErrorAfterClientClose</span><span class="op" id="6987952">(</span><span class="ident" id="6987953">t</span>&nbsp;<span class="op" id="6987955">*</span><span class="ident" id="6987956">testing</span><span class="op" id="6987963">.</span><span class="ident" id="6987964">T</span><span class="op" id="6987965">)</span>&nbsp;<span class="op" id="6987967">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987970">once</span><span class="op" id="6987974">.</span><span class="ident" id="6987975">Do</span><span class="op" id="6987977">(</span><span class="ident" id="6987978">startServer</span><span class="op" id="6987989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6987993">client</span><span class="op" id="6987999">,</span>&nbsp;<span class="ident" id="6988001">err</span>&nbsp;<span class="op" id="6988005">:=</span>&nbsp;<span class="ident" id="6988008">dialHTTP</span><span class="op" id="6988016">(</span><span class="op" id="6988017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988020">if</span>&nbsp;<span class="ident" id="6988023">err</span>&nbsp;<span class="op" id="6988027">!=</span>&nbsp;<span class="ident" id="6988030">nil</span>&nbsp;<span class="op" id="6988034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988038">t</span><span class="op" id="6988039">.</span><span class="ident" id="6988040">Fatalf</span><span class="op" id="6988046">(</span><span class="string" id="6988047">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6988060">,</span>&nbsp;<span class="ident" id="6988062">err</span><span class="op" id="6988065">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988071">err</span>&nbsp;<span class="op" id="6988075">=</span>&nbsp;<span class="ident" id="6988077">client</span><span class="op" id="6988083">.</span><span class="ident" id="6988084">Close</span><span class="op" id="6988089">(</span><span class="op" id="6988090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988093">if</span>&nbsp;<span class="ident" id="6988096">err</span>&nbsp;<span class="op" id="6988100">!=</span>&nbsp;<span class="ident" id="6988103">nil</span>&nbsp;<span class="op" id="6988107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988111">t</span><span class="op" id="6988112">.</span><span class="ident" id="6988113">Fatal</span><span class="op" id="6988118">(</span><span class="string" id="6988119">&#34;close&nbsp;error:&#34;</span><span class="op" id="6988133">,</span>&nbsp;<span class="ident" id="6988135">err</span><span class="op" id="6988138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988141">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988144">err</span>&nbsp;<span class="op" id="6988148">=</span>&nbsp;<span class="ident" id="6988150">client</span><span class="op" id="6988156">.</span><span class="ident" id="6988157">Call</span><span class="op" id="6988161">(</span><span class="string" id="6988162">&#34;Arith.Add&#34;</span><span class="op" id="6988173">,</span>&nbsp;<span class="op" id="6988175">&amp;</span><span class="ident" id="6988176">Args</span><span class="op" id="6988180">{</span><span class="num" id="6988181">7</span><span class="op" id="6988182">,</span>&nbsp;<span class="num" id="6988184">9</span><span class="op" id="6988185">}</span><span class="op" id="6988186">,</span>&nbsp;<span class="builtinfunc" id="6988188">new</span><span class="op" id="6988191">(</span><span class="ident" id="6988192">Reply</span><span class="op" id="6988197">)</span><span class="op" id="6988198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988201">if</span>&nbsp;<span class="ident" id="6988204">err</span>&nbsp;<span class="op" id="6988208">!=</span>&nbsp;<span class="ident" id="6988211">ErrShutdown</span>&nbsp;<span class="op" id="6988223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988227">t</span><span class="op" id="6988228">.</span><span class="ident" id="6988229">Errorf</span><span class="op" id="6988235">(</span><span class="string" id="6988236">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6988274">,</span>&nbsp;<span class="ident" id="6988276">err</span><span class="op" id="6988279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988282">}</span><br>
<span class="lineno"></span><span class="op" id="6988284">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="6988287">func</span>&nbsp;<span class="ident" id="6988292">benchmarkEndToEnd</span><span class="op" id="6988309">(</span><span class="ident" id="6988310">dial</span>&nbsp;<span class="keyword" id="6988315">func</span><span class="op" id="6988319">(</span><span class="op" id="6988320">)</span>&nbsp;<span class="op" id="6988322">(</span><span class="op" id="6988323">*</span><span class="ident" id="6988324">Client</span><span class="op" id="6988330">,</span>&nbsp;<span class="builtintype" id="6988332">error</span><span class="op" id="6988337">)</span><span class="op" id="6988338">,</span>&nbsp;<span class="ident" id="6988340">b</span>&nbsp;<span class="op" id="6988342">*</span><span class="ident" id="6988343">testing</span><span class="op" id="6988350">.</span><span class="ident" id="6988351">B</span><span class="op" id="6988352">)</span>&nbsp;<span class="op" id="6988354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988357">once</span><span class="op" id="6988361">.</span><span class="ident" id="6988362">Do</span><span class="op" id="6988364">(</span><span class="ident" id="6988365">startServer</span><span class="op" id="6988376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988379">client</span><span class="op" id="6988385">,</span>&nbsp;<span class="ident" id="6988387">err</span>&nbsp;<span class="op" id="6988391">:=</span>&nbsp;<span class="ident" id="6988394">dial</span><span class="op" id="6988398">(</span><span class="op" id="6988399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988402">if</span>&nbsp;<span class="ident" id="6988405">err</span>&nbsp;<span class="op" id="6988409">!=</span>&nbsp;<span class="ident" id="6988412">nil</span>&nbsp;<span class="op" id="6988416">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988420">b</span><span class="op" id="6988421">.</span><span class="ident" id="6988422">Fatal</span><span class="op" id="6988427">(</span><span class="string" id="6988428">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6988444">,</span>&nbsp;<span class="ident" id="6988446">err</span><span class="op" id="6988449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988455">defer</span>&nbsp;<span class="ident" id="6988461">client</span><span class="op" id="6988467">.</span><span class="ident" id="6988468">Close</span><span class="op" id="6988473">(</span><span class="op" id="6988474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6988478">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988500">args</span>&nbsp;<span class="op" id="6988505">:=</span>&nbsp;<span class="op" id="6988508">&amp;</span><span class="ident" id="6988509">Args</span><span class="op" id="6988513">{</span><span class="num" id="6988514">7</span><span class="op" id="6988515">,</span>&nbsp;<span class="num" id="6988517">8</span><span class="op" id="6988518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988521">b</span><span class="op" id="6988522">.</span><span class="ident" id="6988523">ResetTimer</span><span class="op" id="6988533">(</span><span class="op" id="6988534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988538">b</span><span class="op" id="6988539">.</span><span class="ident" id="6988540">RunParallel</span><span class="op" id="6988551">(</span><span class="keyword" id="6988552">func</span><span class="op" id="6988556">(</span><span class="ident" id="6988557">pb</span>&nbsp;<span class="op" id="6988560">*</span><span class="ident" id="6988561">testing</span><span class="op" id="6988568">.</span><span class="ident" id="6988569">PB</span><span class="op" id="6988571">)</span>&nbsp;<span class="op" id="6988573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988577">reply</span>&nbsp;<span class="op" id="6988583">:=</span>&nbsp;<span class="builtinfunc" id="6988586">new</span><span class="op" id="6988589">(</span><span class="ident" id="6988590">Reply</span><span class="op" id="6988595">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988599">for</span>&nbsp;<span class="ident" id="6988603">pb</span><span class="op" id="6988605">.</span><span class="ident" id="6988606">Next</span><span class="op" id="6988610">(</span><span class="op" id="6988611">)</span>&nbsp;<span class="op" id="6988613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988618">err</span>&nbsp;<span class="op" id="6988622">:=</span>&nbsp;<span class="ident" id="6988625">client</span><span class="op" id="6988631">.</span><span class="ident" id="6988632">Call</span><span class="op" id="6988636">(</span><span class="string" id="6988637">&#34;Arith.Add&#34;</span><span class="op" id="6988648">,</span>&nbsp;<span class="ident" id="6988650">args</span><span class="op" id="6988654">,</span>&nbsp;<span class="ident" id="6988656">reply</span><span class="op" id="6988661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988666">if</span>&nbsp;<span class="ident" id="6988669">err</span>&nbsp;<span class="op" id="6988673">!=</span>&nbsp;<span class="ident" id="6988676">nil</span>&nbsp;<span class="op" id="6988680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988686">b</span><span class="op" id="6988687">.</span><span class="ident" id="6988688">Fatalf</span><span class="op" id="6988694">(</span><span class="string" id="6988695">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6988748">,</span>&nbsp;<span class="ident" id="6988750">err</span><span class="op" id="6988753">.</span><span class="ident" id="6988754">Error</span><span class="op" id="6988759">(</span><span class="op" id="6988760">)</span><span class="op" id="6988761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988766">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988771">if</span>&nbsp;<span class="ident" id="6988774">reply</span><span class="op" id="6988779">.</span><span class="ident" id="6988780">C</span>&nbsp;<span class="op" id="6988782">!=</span>&nbsp;<span class="ident" id="6988785">args</span><span class="op" id="6988789">.</span><span class="ident" id="6988790">A</span><span class="op" id="6988791">+</span><span class="ident" id="6988792">args</span><span class="op" id="6988796">.</span><span class="ident" id="6988797">B</span>&nbsp;<span class="op" id="6988799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988805">b</span><span class="op" id="6988806">.</span><span class="ident" id="6988807">Fatalf</span><span class="op" id="6988813">(</span><span class="string" id="6988814">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6988850">,</span>&nbsp;<span class="ident" id="6988852">reply</span><span class="op" id="6988857">.</span><span class="ident" id="6988858">C</span><span class="op" id="6988859">,</span>&nbsp;<span class="ident" id="6988861">args</span><span class="op" id="6988865">.</span><span class="ident" id="6988866">A</span><span class="op" id="6988867">+</span><span class="ident" id="6988868">args</span><span class="op" id="6988872">.</span><span class="ident" id="6988873">B</span><span class="op" id="6988874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6988886">}</span><span class="op" id="6988887">)</span><br>
<span class="lineno">620</span><span class="op" id="6988889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6988892">func</span>&nbsp;<span class="ident" id="6988897">benchmarkEndToEndAsync</span><span class="op" id="6988919">(</span><span class="ident" id="6988920">dial</span>&nbsp;<span class="keyword" id="6988925">func</span><span class="op" id="6988929">(</span><span class="op" id="6988930">)</span>&nbsp;<span class="op" id="6988932">(</span><span class="op" id="6988933">*</span><span class="ident" id="6988934">Client</span><span class="op" id="6988940">,</span>&nbsp;<span class="builtintype" id="6988942">error</span><span class="op" id="6988947">)</span><span class="op" id="6988948">,</span>&nbsp;<span class="ident" id="6988950">b</span>&nbsp;<span class="op" id="6988952">*</span><span class="ident" id="6988953">testing</span><span class="op" id="6988960">.</span><span class="ident" id="6988961">B</span><span class="op" id="6988962">)</span>&nbsp;<span class="op" id="6988964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6988967">const</span>&nbsp;<span class="ident" id="6988973">MaxConcurrentCalls</span>&nbsp;<span class="op" id="6988992">=</span>&nbsp;<span class="num" id="6988994">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6988999">once</span><span class="op" id="6989003">.</span><span class="ident" id="6989004">Do</span><span class="op" id="6989006">(</span><span class="ident" id="6989007">startServer</span><span class="op" id="6989018">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989021">client</span><span class="op" id="6989027">,</span>&nbsp;<span class="ident" id="6989029">err</span>&nbsp;<span class="op" id="6989033">:=</span>&nbsp;<span class="ident" id="6989036">dial</span><span class="op" id="6989040">(</span><span class="op" id="6989041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989044">if</span>&nbsp;<span class="ident" id="6989047">err</span>&nbsp;<span class="op" id="6989051">!=</span>&nbsp;<span class="ident" id="6989054">nil</span>&nbsp;<span class="op" id="6989058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989062">b</span><span class="op" id="6989063">.</span><span class="ident" id="6989064">Fatal</span><span class="op" id="6989069">(</span><span class="string" id="6989070">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6989086">,</span>&nbsp;<span class="ident" id="6989088">err</span><span class="op" id="6989091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989097">defer</span>&nbsp;<span class="ident" id="6989103">client</span><span class="op" id="6989109">.</span><span class="ident" id="6989110">Close</span><span class="op" id="6989115">(</span><span class="op" id="6989116">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6989120">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989143">args</span>&nbsp;<span class="op" id="6989148">:=</span>&nbsp;<span class="op" id="6989151">&amp;</span><span class="ident" id="6989152">Args</span><span class="op" id="6989156">{</span><span class="num" id="6989157">7</span><span class="op" id="6989158">,</span>&nbsp;<span class="num" id="6989160">8</span><span class="op" id="6989161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989164">procs</span>&nbsp;<span class="op" id="6989170">:=</span>&nbsp;<span class="num" id="6989173">4</span>&nbsp;<span class="op" id="6989175">*</span>&nbsp;<span class="ident" id="6989177">runtime</span><span class="op" id="6989184">.</span><span class="ident" id="6989185">GOMAXPROCS</span><span class="op" id="6989195">(</span><span class="op" id="6989196">-</span><span class="num" id="6989197">1</span><span class="op" id="6989198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989201">send</span>&nbsp;<span class="op" id="6989206">:=</span>&nbsp;<span class="builtintype" id="6989209">int32</span><span class="op" id="6989214">(</span><span class="ident" id="6989215">b</span><span class="op" id="6989216">.</span><span class="ident" id="6989217">N</span><span class="op" id="6989218">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989221">recv</span>&nbsp;<span class="op" id="6989226">:=</span>&nbsp;<span class="builtintype" id="6989229">int32</span><span class="op" id="6989234">(</span><span class="ident" id="6989235">b</span><span class="op" id="6989236">.</span><span class="ident" id="6989237">N</span><span class="op" id="6989238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989241">var</span>&nbsp;<span class="ident" id="6989245">wg</span>&nbsp;<span class="ident" id="6989248">sync</span><span class="op" id="6989252">.</span><span class="ident" id="6989253">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989264">wg</span><span class="op" id="6989266">.</span><span class="ident" id="6989267">Add</span><span class="op" id="6989270">(</span><span class="ident" id="6989271">procs</span><span class="op" id="6989276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989279">gate</span>&nbsp;<span class="op" id="6989284">:=</span>&nbsp;<span class="builtinfunc" id="6989287">make</span><span class="op" id="6989291">(</span><span class="keyword" id="6989292">chan</span>&nbsp;<span class="builtintype" id="6989297">bool</span><span class="op" id="6989301">,</span>&nbsp;<span class="ident" id="6989303">MaxConcurrentCalls</span><span class="op" id="6989321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989324">res</span>&nbsp;<span class="op" id="6989328">:=</span>&nbsp;<span class="builtinfunc" id="6989331">make</span><span class="op" id="6989335">(</span><span class="keyword" id="6989336">chan</span>&nbsp;<span class="op" id="6989341">*</span><span class="ident" id="6989342">Call</span><span class="op" id="6989346">,</span>&nbsp;<span class="ident" id="6989348">MaxConcurrentCalls</span><span class="op" id="6989366">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989369">b</span><span class="op" id="6989370">.</span><span class="ident" id="6989371">ResetTimer</span><span class="op" id="6989381">(</span><span class="op" id="6989382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989386">for</span>&nbsp;<span class="ident" id="6989390">p</span>&nbsp;<span class="op" id="6989392">:=</span>&nbsp;<span class="num" id="6989395">0</span><span class="op" id="6989396">;</span>&nbsp;<span class="ident" id="6989398">p</span>&nbsp;<span class="op" id="6989400">&lt;</span>&nbsp;<span class="ident" id="6989402">procs</span><span class="op" id="6989407">;</span>&nbsp;<span class="ident" id="6989409">p</span><span class="op" id="6989410">++</span>&nbsp;<span class="op" id="6989413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989417">go</span>&nbsp;<span class="keyword" id="6989420">func</span><span class="op" id="6989424">(</span><span class="op" id="6989425">)</span>&nbsp;<span class="op" id="6989427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989432">for</span>&nbsp;<span class="ident" id="6989436">atomic</span><span class="op" id="6989442">.</span><span class="ident" id="6989443">AddInt32</span><span class="op" id="6989451">(</span><span class="op" id="6989452">&amp;</span><span class="ident" id="6989453">send</span><span class="op" id="6989457">,</span>&nbsp;<span class="op" id="6989459">-</span><span class="num" id="6989460">1</span><span class="op" id="6989461">)</span>&nbsp;<span class="op" id="6989463">&gt;=</span>&nbsp;<span class="num" id="6989466">0</span>&nbsp;<span class="op" id="6989468">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989474">gate</span>&nbsp;<span class="op" id="6989479">&lt;-</span>&nbsp;<span class="builtintype" id="6989482">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989491">reply</span>&nbsp;<span class="op" id="6989497">:=</span>&nbsp;<span class="builtinfunc" id="6989500">new</span><span class="op" id="6989503">(</span><span class="ident" id="6989504">Reply</span><span class="op" id="6989509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989515">client</span><span class="op" id="6989521">.</span><span class="ident" id="6989522">Go</span><span class="op" id="6989524">(</span><span class="string" id="6989525">&#34;Arith.Add&#34;</span><span class="op" id="6989536">,</span>&nbsp;<span class="ident" id="6989538">args</span><span class="op" id="6989542">,</span>&nbsp;<span class="ident" id="6989544">reply</span><span class="op" id="6989549">,</span>&nbsp;<span class="ident" id="6989551">res</span><span class="op" id="6989554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989563">}</span><span class="op" id="6989564">(</span><span class="op" id="6989565">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989569">go</span>&nbsp;<span class="keyword" id="6989572">func</span><span class="op" id="6989576">(</span><span class="op" id="6989577">)</span>&nbsp;<span class="op" id="6989579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989584">for</span>&nbsp;<span class="ident" id="6989588">call</span>&nbsp;<span class="op" id="6989593">:=</span>&nbsp;<span class="keyword" id="6989596">range</span>&nbsp;<span class="ident" id="6989602">res</span>&nbsp;<span class="op" id="6989606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989612">A</span>&nbsp;<span class="op" id="6989614">:=</span>&nbsp;<span class="ident" id="6989617">call</span><span class="op" id="6989621">.</span><span class="ident" id="6989622">Args</span><span class="op" id="6989626">.</span><span class="op" id="6989627">(</span><span class="op" id="6989628">*</span><span class="ident" id="6989629">Args</span><span class="op" id="6989633">)</span><span class="op" id="6989634">.</span><span class="ident" id="6989635">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989641">B</span>&nbsp;<span class="op" id="6989643">:=</span>&nbsp;<span class="ident" id="6989646">call</span><span class="op" id="6989650">.</span><span class="ident" id="6989651">Args</span><span class="op" id="6989655">.</span><span class="op" id="6989656">(</span><span class="op" id="6989657">*</span><span class="ident" id="6989658">Args</span><span class="op" id="6989662">)</span><span class="op" id="6989663">.</span><span class="ident" id="6989664">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989670">C</span>&nbsp;<span class="op" id="6989672">:=</span>&nbsp;<span class="ident" id="6989675">call</span><span class="op" id="6989679">.</span><span class="ident" id="6989680">Reply</span><span class="op" id="6989685">.</span><span class="op" id="6989686">(</span><span class="op" id="6989687">*</span><span class="ident" id="6989688">Reply</span><span class="op" id="6989693">)</span><span class="op" id="6989694">.</span><span class="ident" id="6989695">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989701">if</span>&nbsp;<span class="ident" id="6989704">A</span><span class="op" id="6989705">+</span><span class="ident" id="6989706">B</span>&nbsp;<span class="op" id="6989708">!=</span>&nbsp;<span class="ident" id="6989711">C</span>&nbsp;<span class="op" id="6989713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989720">b</span><span class="op" id="6989721">.</span><span class="ident" id="6989722">Fatalf</span><span class="op" id="6989728">(</span><span class="string" id="6989729">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6989771">,</span>&nbsp;<span class="ident" id="6989773">A</span><span class="op" id="6989774">+</span><span class="ident" id="6989775">B</span><span class="op" id="6989776">,</span>&nbsp;<span class="ident" id="6989778">C</span><span class="op" id="6989779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989791">&lt;-</span><span class="ident" id="6989793">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6989802">if</span>&nbsp;<span class="ident" id="6989805">atomic</span><span class="op" id="6989811">.</span><span class="ident" id="6989812">AddInt32</span><span class="op" id="6989820">(</span><span class="op" id="6989821">&amp;</span><span class="ident" id="6989822">recv</span><span class="op" id="6989826">,</span>&nbsp;<span class="op" id="6989828">-</span><span class="num" id="6989829">1</span><span class="op" id="6989830">)</span>&nbsp;<span class="op" id="6989832">==</span>&nbsp;<span class="num" id="6989835">0</span>&nbsp;<span class="op" id="6989837">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6989844">close</span><span class="op" id="6989849">(</span><span class="ident" id="6989850">res</span><span class="op" id="6989853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989869">wg</span><span class="op" id="6989871">.</span><span class="ident" id="6989872">Done</span><span class="op" id="6989876">(</span><span class="op" id="6989877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989881">}</span><span class="op" id="6989882">(</span><span class="op" id="6989883">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6989886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989889">wg</span><span class="op" id="6989891">.</span><span class="ident" id="6989892">Wait</span><span class="op" id="6989896">(</span><span class="op" id="6989897">)</span><br>
<span class="lineno"></span><span class="op" id="6989899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6989902">func</span>&nbsp;<span class="ident" id="6989907">BenchmarkEndToEnd</span><span class="op" id="6989924">(</span><span class="ident" id="6989925">b</span>&nbsp;<span class="op" id="6989927">*</span><span class="ident" id="6989928">testing</span><span class="op" id="6989935">.</span><span class="ident" id="6989936">B</span><span class="op" id="6989937">)</span>&nbsp;<span class="op" id="6989939">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6989942">benchmarkEndToEnd</span><span class="op" id="6989959">(</span><span class="ident" id="6989960">dialDirect</span><span class="op" id="6989970">,</span>&nbsp;<span class="ident" id="6989972">b</span><span class="op" id="6989973">)</span><br>
<span class="lineno"></span><span class="op" id="6989975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6989978">func</span>&nbsp;<span class="ident" id="6989983">BenchmarkEndToEndHTTP</span><span class="op" id="6990004">(</span><span class="ident" id="6990005">b</span>&nbsp;<span class="op" id="6990007">*</span><span class="ident" id="6990008">testing</span><span class="op" id="6990015">.</span><span class="ident" id="6990016">B</span><span class="op" id="6990017">)</span>&nbsp;<span class="op" id="6990019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6990022">benchmarkEndToEnd</span><span class="op" id="6990039">(</span><span class="ident" id="6990040">dialHTTP</span><span class="op" id="6990048">,</span>&nbsp;<span class="ident" id="6990050">b</span><span class="op" id="6990051">)</span><br>
<span class="lineno">675</span><span class="op" id="6990053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990056">func</span>&nbsp;<span class="ident" id="6990061">BenchmarkEndToEndAsync</span><span class="op" id="6990083">(</span><span class="ident" id="6990084">b</span>&nbsp;<span class="op" id="6990086">*</span><span class="ident" id="6990087">testing</span><span class="op" id="6990094">.</span><span class="ident" id="6990095">B</span><span class="op" id="6990096">)</span>&nbsp;<span class="op" id="6990098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6990101">benchmarkEndToEndAsync</span><span class="op" id="6990123">(</span><span class="ident" id="6990124">dialDirect</span><span class="op" id="6990134">,</span>&nbsp;<span class="ident" id="6990136">b</span><span class="op" id="6990137">)</span><br>
<span class="lineno"></span><span class="op" id="6990139">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="6990142">func</span>&nbsp;<span class="ident" id="6990147">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="6990173">(</span><span class="ident" id="6990174">b</span>&nbsp;<span class="op" id="6990176">*</span><span class="ident" id="6990177">testing</span><span class="op" id="6990184">.</span><span class="ident" id="6990185">B</span><span class="op" id="6990186">)</span>&nbsp;<span class="op" id="6990188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6990191">benchmarkEndToEndAsync</span><span class="op" id="6990213">(</span><span class="ident" id="6990214">dialHTTP</span><span class="op" id="6990222">,</span>&nbsp;<span class="ident" id="6990224">b</span><span class="op" id="6990225">)</span><br>
<span class="lineno"></span><span class="op" id="6990227">}</span>
</div>
</body>
</html>
