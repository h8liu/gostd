<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>reflect</h2>
<ul>
<li><a href="/gostd/reflect/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/reflect/deepequal.go.html">deepequal.go</a></li>
<li><a href="/gostd/reflect/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/reflect/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/reflect/makefunc.go.html" class="current">makefunc.go</a></li>
<li><a href="/gostd/reflect/set_test.go.html">set_test.go</a></li>
<li><a href="/gostd/reflect/tostring_test.go.html">tostring_test.go</a></li>
<li><a href="/gostd/reflect/type.go.html">type.go</a></li>
<li><a href="/gostd/reflect/value.go.html">value.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2811015">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2811071">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2811125">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2811176">//&nbsp;MakeFunc&nbsp;implementation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2811205">package</span>&nbsp;<span class="ident" id="2811213">reflect</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2811222">import</span>&nbsp;<span class="op" id="2811229">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2811232">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2811241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2811244">//&nbsp;makeFuncImpl&nbsp;is&nbsp;the&nbsp;closure&nbsp;value&nbsp;implementing&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2811307">//&nbsp;returned&nbsp;by&nbsp;MakeFunc.</span><br>
<span class="lineno">15</span><span class="keyword" id="2811332">type</span>&nbsp;<span class="ident" id="2811337">makeFuncImpl</span>&nbsp;<span class="keyword" id="2811350">struct</span>&nbsp;<span class="op" id="2811357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2811360">code</span>&nbsp;&nbsp;<span class="builtintype" id="2811366">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2811375">stack</span>&nbsp;<span class="op" id="2811381">*</span><span class="ident" id="2811382">bitVector</span>&nbsp;<span class="comment" id="2811392">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2811444">typ</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2811450">*</span><span class="ident" id="2811451">funcType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2811461">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2811467">func</span><span class="op" id="2811471">(</span><span class="op" id="2811472">[</span><span class="op" id="2811473">]</span><span class="ident" id="2811474">Value</span><span class="op" id="2811479">)</span>&nbsp;<span class="op" id="2811481">[</span><span class="op" id="2811482">]</span><span class="ident" id="2811483">Value</span><br>
<span class="lineno">20</span><span class="op" id="2811489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2811492">//&nbsp;MakeFunc&nbsp;returns&nbsp;a&nbsp;new&nbsp;function&nbsp;of&nbsp;the&nbsp;given&nbsp;Type</span><br>
<span class="lineno"></span><span class="comment" id="2811545">//&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;fn.&nbsp;When&nbsp;called,&nbsp;that&nbsp;new&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2811607">//&nbsp;does&nbsp;the&nbsp;following:</span><br>
<span class="lineno">25</span><span class="comment" id="2811630">//</span><br>
<span class="lineno"></span><span class="comment" id="2811633">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;converts&nbsp;its&nbsp;arguments&nbsp;to&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values.</span><br>
<span class="lineno"></span><span class="comment" id="2811683">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;runs&nbsp;results&nbsp;:=&nbsp;fn(args).</span><br>
<span class="lineno"></span><span class="comment" id="2811714">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;returns&nbsp;the&nbsp;results&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values,&nbsp;one&nbsp;per&nbsp;formal&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="2811784">//</span><br>
<span class="lineno">30</span><span class="comment" id="2811787">//&nbsp;The&nbsp;implementation&nbsp;fn&nbsp;can&nbsp;assume&nbsp;that&nbsp;the&nbsp;argument&nbsp;Value&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2811853">//&nbsp;has&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;arguments&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2811907">//&nbsp;If&nbsp;typ&nbsp;describes&nbsp;a&nbsp;variadic&nbsp;function,&nbsp;the&nbsp;final&nbsp;Value&nbsp;is&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2811974">//&nbsp;a&nbsp;slice&nbsp;representing&nbsp;the&nbsp;variadic&nbsp;arguments,&nbsp;as&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2812032">//&nbsp;body&nbsp;of&nbsp;a&nbsp;variadic&nbsp;function.&nbsp;The&nbsp;result&nbsp;Value&nbsp;slice&nbsp;returned&nbsp;by&nbsp;fn</span><br>
<span class="lineno">35</span><span class="comment" id="2812102">//&nbsp;must&nbsp;have&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;results&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2812160">//</span><br>
<span class="lineno"></span><span class="comment" id="2812163">//&nbsp;The&nbsp;Value.Call&nbsp;method&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;invoke&nbsp;a&nbsp;typed&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2812233">//&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values;&nbsp;in&nbsp;contrast,&nbsp;MakeFunc&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="2812309">//&nbsp;a&nbsp;typed&nbsp;function&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values.</span><br>
<span class="lineno">40</span><span class="comment" id="2812349">//</span><br>
<span class="lineno"></span><span class="comment" id="2812352">//&nbsp;The&nbsp;Examples&nbsp;section&nbsp;of&nbsp;the&nbsp;documentation&nbsp;includes&nbsp;an&nbsp;illustration</span><br>
<span class="lineno"></span><span class="comment" id="2812422">//&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;MakeFunc&nbsp;to&nbsp;build&nbsp;a&nbsp;swap&nbsp;function&nbsp;for&nbsp;different&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="2812494">//</span><br>
<span class="lineno"></span><span class="keyword" id="2812497">func</span>&nbsp;<span class="ident" id="2812502">MakeFunc</span><span class="op" id="2812510">(</span><span class="ident" id="2812511">typ</span>&nbsp;<span class="ident" id="2812515">Type</span><span class="op" id="2812519">,</span>&nbsp;<span class="ident" id="2812521">fn</span>&nbsp;<span class="keyword" id="2812524">func</span><span class="op" id="2812528">(</span><span class="ident" id="2812529">args</span>&nbsp;<span class="op" id="2812534">[</span><span class="op" id="2812535">]</span><span class="ident" id="2812536">Value</span><span class="op" id="2812541">)</span>&nbsp;<span class="op" id="2812543">(</span><span class="ident" id="2812544">results</span>&nbsp;<span class="op" id="2812552">[</span><span class="op" id="2812553">]</span><span class="ident" id="2812554">Value</span><span class="op" id="2812559">)</span><span class="op" id="2812560">)</span>&nbsp;<span class="ident" id="2812562">Value</span>&nbsp;<span class="op" id="2812568">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2812571">if</span>&nbsp;<span class="ident" id="2812574">typ</span><span class="op" id="2812577">.</span><span class="ident" id="2812578">Kind</span><span class="op" id="2812582">(</span><span class="op" id="2812583">)</span>&nbsp;<span class="op" id="2812585">!=</span>&nbsp;<span class="ident" id="2812588">Func</span>&nbsp;<span class="op" id="2812593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2812597">panic</span><span class="op" id="2812602">(</span><span class="string" id="2812603">&#34;reflect:&nbsp;call&nbsp;of&nbsp;MakeFunc&nbsp;with&nbsp;non-Func&nbsp;type&#34;</span><span class="op" id="2812649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2812652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2812656">t</span>&nbsp;<span class="op" id="2812658">:=</span>&nbsp;<span class="ident" id="2812661">typ</span><span class="op" id="2812664">.</span><span class="ident" id="2812665">common</span><span class="op" id="2812671">(</span><span class="op" id="2812672">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2812675">ftyp</span>&nbsp;<span class="op" id="2812680">:=</span>&nbsp;<span class="op" id="2812683">(</span><span class="op" id="2812684">*</span><span class="ident" id="2812685">funcType</span><span class="op" id="2812693">)</span><span class="op" id="2812694">(</span><span class="ident" id="2812695">unsafe</span><span class="op" id="2812701">.</span><span class="ident" id="2812702">Pointer</span><span class="op" id="2812709">(</span><span class="ident" id="2812710">t</span><span class="op" id="2812711">)</span><span class="op" id="2812712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2812716">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2812761">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2812816">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2812876">dummy</span>&nbsp;<span class="op" id="2812882">:=</span>&nbsp;<span class="ident" id="2812885">makeFuncStub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2812899">code</span>&nbsp;<span class="op" id="2812904">:=</span>&nbsp;<span class="op" id="2812907">*</span><span class="op" id="2812908">*</span><span class="op" id="2812909">(</span><span class="op" id="2812910">*</span><span class="op" id="2812911">*</span><span class="builtintype" id="2812912">uintptr</span><span class="op" id="2812919">)</span><span class="op" id="2812920">(</span><span class="ident" id="2812921">unsafe</span><span class="op" id="2812927">.</span><span class="ident" id="2812928">Pointer</span><span class="op" id="2812935">(</span><span class="op" id="2812936">&amp;</span><span class="ident" id="2812937">dummy</span><span class="op" id="2812942">)</span><span class="op" id="2812943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2812947">//&nbsp;makeFuncImpl&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813008">_</span><span class="op" id="2813009">,</span>&nbsp;<span class="ident" id="2813011">_</span><span class="op" id="2813012">,</span>&nbsp;<span class="ident" id="2813014">_</span><span class="op" id="2813015">,</span>&nbsp;<span class="ident" id="2813017">stack</span>&nbsp;<span class="op" id="2813023">:=</span>&nbsp;<span class="ident" id="2813026">funcLayout</span><span class="op" id="2813036">(</span><span class="ident" id="2813037">t</span><span class="op" id="2813038">,</span>&nbsp;<span class="builtintype" id="2813040">nil</span><span class="op" id="2813043">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813047">impl</span>&nbsp;<span class="op" id="2813052">:=</span>&nbsp;<span class="op" id="2813055">&amp;</span><span class="ident" id="2813056">makeFuncImpl</span><span class="op" id="2813068">{</span><span class="ident" id="2813069">code</span><span class="op" id="2813073">:</span>&nbsp;<span class="ident" id="2813075">code</span><span class="op" id="2813079">,</span>&nbsp;<span class="ident" id="2813081">stack</span><span class="op" id="2813086">:</span>&nbsp;<span class="ident" id="2813088">stack</span><span class="op" id="2813093">,</span>&nbsp;<span class="ident" id="2813095">typ</span><span class="op" id="2813098">:</span>&nbsp;<span class="ident" id="2813100">ftyp</span><span class="op" id="2813104">,</span>&nbsp;<span class="ident" id="2813106">fn</span><span class="op" id="2813108">:</span>&nbsp;<span class="ident" id="2813110">fn</span><span class="op" id="2813112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2813116">return</span>&nbsp;<span class="ident" id="2813123">Value</span><span class="op" id="2813128">{</span><span class="ident" id="2813129">t</span><span class="op" id="2813130">,</span>&nbsp;<span class="ident" id="2813132">unsafe</span><span class="op" id="2813138">.</span><span class="ident" id="2813139">Pointer</span><span class="op" id="2813146">(</span><span class="ident" id="2813147">impl</span><span class="op" id="2813151">)</span><span class="op" id="2813152">,</span>&nbsp;<span class="ident" id="2813154">flag</span><span class="op" id="2813158">(</span><span class="ident" id="2813159">Func</span><span class="op" id="2813163">)</span><span class="op" id="2813164">}</span><br>
<span class="lineno"></span><span class="op" id="2813166">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2813169">//&nbsp;makeFuncStub&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2813234">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;MakeFunc.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*callReflectFunc</span><br>
<span class="lineno"></span><span class="comment" id="2813304">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callReflect(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2813382">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno">70</span><span class="comment" id="2813456">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2813497">func</span>&nbsp;<span class="ident" id="2813502">makeFuncStub</span><span class="op" id="2813514">(</span><span class="op" id="2813515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2813518">type</span>&nbsp;<span class="ident" id="2813523">methodValue</span>&nbsp;<span class="keyword" id="2813535">struct</span>&nbsp;<span class="op" id="2813542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813545">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2813552">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813561">stack</span>&nbsp;&nbsp;<span class="op" id="2813568">*</span><span class="ident" id="2813569">bitVector</span>&nbsp;<span class="comment" id="2813579">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813631">method</span>&nbsp;<span class="builtintype" id="2813638">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2813643">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2813650">Value</span><br>
<span class="lineno"></span><span class="op" id="2813656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2813659">//&nbsp;makeMethodValue&nbsp;converts&nbsp;v&nbsp;from&nbsp;the&nbsp;rcvr+method&nbsp;index&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="2813731">//&nbsp;of&nbsp;a&nbsp;method&nbsp;value&nbsp;to&nbsp;an&nbsp;actual&nbsp;method&nbsp;func&nbsp;value,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2813793">//&nbsp;basically&nbsp;the&nbsp;receiver&nbsp;value&nbsp;with&nbsp;a&nbsp;special&nbsp;bit&nbsp;set,&nbsp;into&nbsp;a&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="2813861">//&nbsp;func&nbsp;value&nbsp;-&nbsp;a&nbsp;value&nbsp;holding&nbsp;an&nbsp;actual&nbsp;func.&nbsp;The&nbsp;output&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2813923">//&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;input&nbsp;as&nbsp;far&nbsp;as&nbsp;the&nbsp;user&nbsp;of&nbsp;package</span><br>
<span class="lineno">85</span><span class="comment" id="2813993">//&nbsp;reflect&nbsp;can&nbsp;tell,&nbsp;but&nbsp;the&nbsp;true&nbsp;func&nbsp;representation&nbsp;can&nbsp;be&nbsp;handled</span><br>
<span class="lineno"></span><span class="comment" id="2814062">//&nbsp;by&nbsp;code&nbsp;like&nbsp;Convert&nbsp;and&nbsp;Interface&nbsp;and&nbsp;Assign.</span><br>
<span class="lineno"></span><span class="keyword" id="2814112">func</span>&nbsp;<span class="ident" id="2814117">makeMethodValue</span><span class="op" id="2814132">(</span><span class="ident" id="2814133">op</span>&nbsp;<span class="builtintype" id="2814136">string</span><span class="op" id="2814142">,</span>&nbsp;<span class="ident" id="2814144">v</span>&nbsp;<span class="ident" id="2814146">Value</span><span class="op" id="2814151">)</span>&nbsp;<span class="ident" id="2814153">Value</span>&nbsp;<span class="op" id="2814159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2814162">if</span>&nbsp;<span class="ident" id="2814165">v</span><span class="op" id="2814166">.</span><span class="ident" id="2814167">flag</span><span class="op" id="2814171">&amp;</span><span class="ident" id="2814172">flagMethod</span>&nbsp;<span class="op" id="2814183">==</span>&nbsp;<span class="num" id="2814186">0</span>&nbsp;<span class="op" id="2814188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2814192">panic</span><span class="op" id="2814197">(</span><span class="string" id="2814198">&#34;reflect:&nbsp;internal&nbsp;error:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;makeMethodValue&#34;</span><span class="op" id="2814255">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2814258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814262">//&nbsp;Ignoring&nbsp;the&nbsp;flagMethod&nbsp;bit,&nbsp;v&nbsp;describes&nbsp;the&nbsp;receiver,&nbsp;not&nbsp;the&nbsp;method&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814342">fl</span>&nbsp;<span class="op" id="2814345">:=</span>&nbsp;<span class="ident" id="2814348">v</span><span class="op" id="2814349">.</span><span class="ident" id="2814350">flag</span>&nbsp;<span class="op" id="2814355">&amp;</span>&nbsp;<span class="op" id="2814357">(</span><span class="ident" id="2814358">flagRO</span>&nbsp;<span class="op" id="2814365">|</span>&nbsp;<span class="ident" id="2814367">flagAddr</span>&nbsp;<span class="op" id="2814376">|</span>&nbsp;<span class="ident" id="2814378">flagIndir</span><span class="op" id="2814387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814390">fl</span>&nbsp;<span class="op" id="2814393">|=</span>&nbsp;<span class="ident" id="2814396">flag</span><span class="op" id="2814400">(</span><span class="ident" id="2814401">v</span><span class="op" id="2814402">.</span><span class="ident" id="2814403">typ</span><span class="op" id="2814406">.</span><span class="ident" id="2814407">Kind</span><span class="op" id="2814411">(</span><span class="op" id="2814412">)</span><span class="op" id="2814413">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814416">rcvr</span>&nbsp;<span class="op" id="2814421">:=</span>&nbsp;<span class="ident" id="2814424">Value</span><span class="op" id="2814429">{</span><span class="ident" id="2814430">v</span><span class="op" id="2814431">.</span><span class="ident" id="2814432">typ</span><span class="op" id="2814435">,</span>&nbsp;<span class="ident" id="2814437">v</span><span class="op" id="2814438">.</span><span class="ident" id="2814439">ptr</span><span class="op" id="2814442">,</span>&nbsp;<span class="ident" id="2814444">fl</span><span class="op" id="2814446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814450">//&nbsp;v.Type&nbsp;returns&nbsp;the&nbsp;actual&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814506">funcType</span>&nbsp;<span class="op" id="2814515">:=</span>&nbsp;<span class="ident" id="2814518">v</span><span class="op" id="2814519">.</span><span class="ident" id="2814520">Type</span><span class="op" id="2814524">(</span><span class="op" id="2814525">)</span><span class="op" id="2814526">.</span><span class="op" id="2814527">(</span><span class="op" id="2814528">*</span><span class="ident" id="2814529">rtype</span><span class="op" id="2814534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814538">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814583">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814638">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814698">dummy</span>&nbsp;<span class="op" id="2814704">:=</span>&nbsp;<span class="ident" id="2814707">methodValueCall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814724">code</span>&nbsp;<span class="op" id="2814729">:=</span>&nbsp;<span class="op" id="2814732">*</span><span class="op" id="2814733">*</span><span class="op" id="2814734">(</span><span class="op" id="2814735">*</span><span class="op" id="2814736">*</span><span class="builtintype" id="2814737">uintptr</span><span class="op" id="2814744">)</span><span class="op" id="2814745">(</span><span class="ident" id="2814746">unsafe</span><span class="op" id="2814752">.</span><span class="ident" id="2814753">Pointer</span><span class="op" id="2814760">(</span><span class="op" id="2814761">&amp;</span><span class="ident" id="2814762">dummy</span><span class="op" id="2814767">)</span><span class="op" id="2814768">)</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814772">//&nbsp;methodValue&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814832">_</span><span class="op" id="2814833">,</span>&nbsp;<span class="ident" id="2814835">_</span><span class="op" id="2814836">,</span>&nbsp;<span class="ident" id="2814838">_</span><span class="op" id="2814839">,</span>&nbsp;<span class="ident" id="2814841">stack</span>&nbsp;<span class="op" id="2814847">:=</span>&nbsp;<span class="ident" id="2814850">funcLayout</span><span class="op" id="2814860">(</span><span class="ident" id="2814861">funcType</span><span class="op" id="2814869">,</span>&nbsp;<span class="builtintype" id="2814871">nil</span><span class="op" id="2814874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814878">fv</span>&nbsp;<span class="op" id="2814881">:=</span>&nbsp;<span class="op" id="2814884">&amp;</span><span class="ident" id="2814885">methodValue</span><span class="op" id="2814896">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814900">fn</span><span class="op" id="2814902">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814908">code</span><span class="op" id="2814912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814916">stack</span><span class="op" id="2814921">:</span>&nbsp;&nbsp;<span class="ident" id="2814924">stack</span><span class="op" id="2814929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814933">method</span><span class="op" id="2814939">:</span>&nbsp;<span class="builtintype" id="2814941">int</span><span class="op" id="2814944">(</span><span class="ident" id="2814945">v</span><span class="op" id="2814946">.</span><span class="ident" id="2814947">flag</span><span class="op" id="2814951">)</span>&nbsp;<span class="op" id="2814953">&gt;&gt;</span>&nbsp;<span class="ident" id="2814956">flagMethodShift</span><span class="op" id="2814971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814975">rcvr</span><span class="op" id="2814979">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2814983">rcvr</span><span class="op" id="2814987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2814990">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2814994">//&nbsp;Cause&nbsp;panic&nbsp;if&nbsp;method&nbsp;is&nbsp;not&nbsp;appropriate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2815040">//&nbsp;The&nbsp;panic&nbsp;would&nbsp;still&nbsp;happen&nbsp;during&nbsp;the&nbsp;call&nbsp;if&nbsp;we&nbsp;omit&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2815106">//&nbsp;but&nbsp;we&nbsp;want&nbsp;Interface()&nbsp;and&nbsp;other&nbsp;operations&nbsp;to&nbsp;fail&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815170">methodReceiver</span><span class="op" id="2815184">(</span><span class="ident" id="2815185">op</span><span class="op" id="2815187">,</span>&nbsp;<span class="ident" id="2815189">fv</span><span class="op" id="2815191">.</span><span class="ident" id="2815192">rcvr</span><span class="op" id="2815196">,</span>&nbsp;<span class="ident" id="2815198">fv</span><span class="op" id="2815200">.</span><span class="ident" id="2815201">method</span><span class="op" id="2815207">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2815211">return</span>&nbsp;<span class="ident" id="2815218">Value</span><span class="op" id="2815223">{</span><span class="ident" id="2815224">funcType</span><span class="op" id="2815232">,</span>&nbsp;<span class="ident" id="2815234">unsafe</span><span class="op" id="2815240">.</span><span class="ident" id="2815241">Pointer</span><span class="op" id="2815248">(</span><span class="ident" id="2815249">fv</span><span class="op" id="2815251">)</span><span class="op" id="2815252">,</span>&nbsp;<span class="ident" id="2815254">v</span><span class="op" id="2815255">.</span><span class="ident" id="2815256">flag</span><span class="op" id="2815260">&amp;</span><span class="ident" id="2815261">flagRO</span>&nbsp;<span class="op" id="2815268">|</span>&nbsp;<span class="ident" id="2815270">flag</span><span class="op" id="2815274">(</span><span class="ident" id="2815275">Func</span><span class="op" id="2815279">)</span><span class="op" id="2815280">}</span><br>
<span class="lineno"></span><span class="op" id="2815282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2815285">//&nbsp;methodValueCall&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno">125</span><span class="comment" id="2815353">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;makeMethodValue.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*methodValue</span><br>
<span class="lineno"></span><span class="comment" id="2815426">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callMethod(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2815503">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2815577">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2815618">func</span>&nbsp;<span class="ident" id="2815623">methodValueCall</span><span class="op" id="2815638">(</span><span class="op" id="2815639">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
