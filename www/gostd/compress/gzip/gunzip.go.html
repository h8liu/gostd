<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4970272">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4970327">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4970381">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4970432">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4970512">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4970541">package</span>&nbsp;<span class="ident" id="4970549">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4970555">import</span>&nbsp;<span class="op" id="4970562">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970565">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970574">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970592">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970602">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970610">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970624">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4970630">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4970637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4970640">const</span>&nbsp;<span class="op" id="4970646">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970649">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970661">=</span>&nbsp;<span class="num" id="4970663">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970669">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970681">=</span>&nbsp;<span class="num" id="4970683">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970689">gzipDeflate</span>&nbsp;<span class="op" id="4970701">=</span>&nbsp;<span class="num" id="4970703">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970706">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970718">=</span>&nbsp;<span class="num" id="4970720">1</span>&nbsp;<span class="op" id="4970722">&lt;&lt;</span>&nbsp;<span class="num" id="4970725">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970728">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4970740">=</span>&nbsp;<span class="num" id="4970742">1</span>&nbsp;<span class="op" id="4970744">&lt;&lt;</span>&nbsp;<span class="num" id="4970747">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970750">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4970762">=</span>&nbsp;<span class="num" id="4970764">1</span>&nbsp;<span class="op" id="4970766">&lt;&lt;</span>&nbsp;<span class="num" id="4970769">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970772">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970784">=</span>&nbsp;<span class="num" id="4970786">1</span>&nbsp;<span class="op" id="4970788">&lt;&lt;</span>&nbsp;<span class="num" id="4970791">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970794">flagComment</span>&nbsp;<span class="op" id="4970806">=</span>&nbsp;<span class="num" id="4970808">1</span>&nbsp;<span class="op" id="4970810">&lt;&lt;</span>&nbsp;<span class="num" id="4970813">4</span><br>
<span class="lineno"></span><span class="op" id="4970815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4970818">func</span>&nbsp;<span class="ident" id="4970823">makeReader</span><span class="op" id="4970833">(</span><span class="ident" id="4970834">r</span>&nbsp;<span class="ident" id="4970836">io</span><span class="op" id="4970838">.</span><span class="ident" id="4970839">Reader</span><span class="op" id="4970845">)</span>&nbsp;<span class="ident" id="4970847">flate</span><span class="op" id="4970852">.</span><span class="ident" id="4970853">Reader</span>&nbsp;<span class="op" id="4970860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970863">if</span>&nbsp;<span class="ident" id="4970866">rr</span><span class="op" id="4970868">,</span>&nbsp;<span class="ident" id="4970870">ok</span>&nbsp;<span class="op" id="4970873">:=</span>&nbsp;<span class="ident" id="4970876">r</span><span class="op" id="4970877">.</span><span class="op" id="4970878">(</span><span class="ident" id="4970879">flate</span><span class="op" id="4970884">.</span><span class="ident" id="4970885">Reader</span><span class="op" id="4970891">)</span><span class="op" id="4970892">;</span>&nbsp;<span class="ident" id="4970894">ok</span>&nbsp;<span class="op" id="4970897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970901">return</span>&nbsp;<span class="ident" id="4970908">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970915">return</span>&nbsp;<span class="ident" id="4970922">bufio</span><span class="op" id="4970927">.</span><span class="ident" id="4970928">NewReader</span><span class="op" id="4970937">(</span><span class="ident" id="4970938">r</span><span class="op" id="4970939">)</span><br>
<span class="lineno">35</span><span class="op" id="4970941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4970944">var</span>&nbsp;<span class="op" id="4970948">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970951">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971032">ErrChecksum</span>&nbsp;<span class="op" id="4971044">=</span>&nbsp;<span class="ident" id="4971046">errors</span><span class="op" id="4971052">.</span><span class="ident" id="4971053">New</span><span class="op" id="4971056">(</span><span class="string" id="4971057">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4971081">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971084">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971161">ErrHeader</span>&nbsp;<span class="op" id="4971171">=</span>&nbsp;<span class="ident" id="4971173">errors</span><span class="op" id="4971179">.</span><span class="ident" id="4971180">New</span><span class="op" id="4971183">(</span><span class="string" id="4971184">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4971206">)</span><br>
<span class="lineno"></span><span class="op" id="4971208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971211">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4971287">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4971361">type</span>&nbsp;<span class="ident" id="4971366">Header</span>&nbsp;<span class="keyword" id="4971373">struct</span>&nbsp;<span class="op" id="4971380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971383">Comment</span>&nbsp;<span class="builtintype" id="4971391">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4971401">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971413">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4971421">[</span><span class="op" id="4971422">]</span><span class="builtintype" id="4971423">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4971431">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971448">ModTime</span>&nbsp;<span class="ident" id="4971456">time</span><span class="op" id="4971460">.</span><span class="ident" id="4971461">Time</span>&nbsp;<span class="comment" id="4971466">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971488">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4971496">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4971506">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971520">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4971528">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4971538">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4971563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971566">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4971623">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4971680">//</span><br>
<span class="lineno"></span><span class="comment" id="4971683">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4971748">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4971800">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4971862">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4971921">//</span><br>
<span class="lineno"></span><span class="comment" id="4971924">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4971992">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4972042">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4972101">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4972169">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4972232">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4972264">type</span>&nbsp;<span class="ident" id="4972269">Reader</span>&nbsp;<span class="keyword" id="4972276">struct</span>&nbsp;<span class="op" id="4972283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972286">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972294">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972307">flate</span><span class="op" id="4972312">.</span><span class="ident" id="4972313">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972321">decompressor</span>&nbsp;<span class="ident" id="4972334">io</span><span class="op" id="4972336">.</span><span class="ident" id="4972337">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972349">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972362">hash</span><span class="op" id="4972366">.</span><span class="ident" id="4972367">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972375">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4972388">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972396">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4972409">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972415">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4972428">[</span><span class="num" id="4972429">512</span><span class="op" id="4972432">]</span><span class="builtintype" id="4972433">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972439">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4972452">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972459">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4972472">bool</span><br>
<span class="lineno"></span><span class="op" id="4972477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4972480">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4972540">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4972587">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4972649">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4972725">func</span>&nbsp;<span class="ident" id="4972730">NewReader</span><span class="op" id="4972739">(</span><span class="ident" id="4972740">r</span>&nbsp;<span class="ident" id="4972742">io</span><span class="op" id="4972744">.</span><span class="ident" id="4972745">Reader</span><span class="op" id="4972751">)</span>&nbsp;<span class="op" id="4972753">(</span><span class="op" id="4972754">*</span><span class="ident" id="4972755">Reader</span><span class="op" id="4972761">,</span>&nbsp;<span class="builtintype" id="4972763">error</span><span class="op" id="4972768">)</span>&nbsp;<span class="op" id="4972770">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972773">z</span>&nbsp;<span class="op" id="4972775">:=</span>&nbsp;<span class="builtinfunc" id="4972778">new</span><span class="op" id="4972781">(</span><span class="ident" id="4972782">Reader</span><span class="op" id="4972788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972791">z</span><span class="op" id="4972792">.</span><span class="ident" id="4972793">r</span>&nbsp;<span class="op" id="4972795">=</span>&nbsp;<span class="ident" id="4972797">makeReader</span><span class="op" id="4972807">(</span><span class="ident" id="4972808">r</span><span class="op" id="4972809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972812">z</span><span class="op" id="4972813">.</span><span class="ident" id="4972814">multistream</span>&nbsp;<span class="op" id="4972826">=</span>&nbsp;<span class="builtintype" id="4972828">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972834">z</span><span class="op" id="4972835">.</span><span class="ident" id="4972836">digest</span>&nbsp;<span class="op" id="4972843">=</span>&nbsp;<span class="ident" id="4972845">crc32</span><span class="op" id="4972850">.</span><span class="ident" id="4972851">NewIEEE</span><span class="op" id="4972858">(</span><span class="op" id="4972859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972862">if</span>&nbsp;<span class="ident" id="4972865">err</span>&nbsp;<span class="op" id="4972869">:=</span>&nbsp;<span class="ident" id="4972872">z</span><span class="op" id="4972873">.</span><span class="ident" id="4972874">readHeader</span><span class="op" id="4972884">(</span><span class="builtintype" id="4972885">true</span><span class="op" id="4972889">)</span><span class="op" id="4972890">;</span>&nbsp;<span class="ident" id="4972892">err</span>&nbsp;<span class="op" id="4972896">!=</span>&nbsp;<span class="ident" id="4972899">nil</span>&nbsp;<span class="op" id="4972903">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972907">return</span>&nbsp;<span class="ident" id="4972914">nil</span><span class="op" id="4972917">,</span>&nbsp;<span class="ident" id="4972919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972927">return</span>&nbsp;<span class="ident" id="4972934">z</span><span class="op" id="4972935">,</span>&nbsp;<span class="ident" id="4972937">nil</span><br>
<span class="lineno"></span><span class="op" id="4972941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4972944">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4973014">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4973090">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4973157">func</span>&nbsp;<span class="op" id="4973162">(</span><span class="ident" id="4973163">z</span>&nbsp;<span class="op" id="4973165">*</span><span class="ident" id="4973166">Reader</span><span class="op" id="4973172">)</span>&nbsp;<span class="ident" id="4973174">Reset</span><span class="op" id="4973179">(</span><span class="ident" id="4973180">r</span>&nbsp;<span class="ident" id="4973182">io</span><span class="op" id="4973184">.</span><span class="ident" id="4973185">Reader</span><span class="op" id="4973191">)</span>&nbsp;<span class="builtintype" id="4973193">error</span>&nbsp;<span class="op" id="4973199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973202">z</span><span class="op" id="4973203">.</span><span class="ident" id="4973204">r</span>&nbsp;<span class="op" id="4973206">=</span>&nbsp;<span class="ident" id="4973208">makeReader</span><span class="op" id="4973218">(</span><span class="ident" id="4973219">r</span><span class="op" id="4973220">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973223">if</span>&nbsp;<span class="ident" id="4973226">z</span><span class="op" id="4973227">.</span><span class="ident" id="4973228">digest</span>&nbsp;<span class="op" id="4973235">==</span>&nbsp;<span class="ident" id="4973238">nil</span>&nbsp;<span class="op" id="4973242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973246">z</span><span class="op" id="4973247">.</span><span class="ident" id="4973248">digest</span>&nbsp;<span class="op" id="4973255">=</span>&nbsp;<span class="ident" id="4973257">crc32</span><span class="op" id="4973262">.</span><span class="ident" id="4973263">NewIEEE</span><span class="op" id="4973270">(</span><span class="op" id="4973271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973274">}</span>&nbsp;<span class="keyword" id="4973276">else</span>&nbsp;<span class="op" id="4973281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973285">z</span><span class="op" id="4973286">.</span><span class="ident" id="4973287">digest</span><span class="op" id="4973293">.</span><span class="ident" id="4973294">Reset</span><span class="op" id="4973299">(</span><span class="op" id="4973300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973303">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973306">z</span><span class="op" id="4973307">.</span><span class="ident" id="4973308">size</span>&nbsp;<span class="op" id="4973313">=</span>&nbsp;<span class="num" id="4973315">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973318">z</span><span class="op" id="4973319">.</span><span class="ident" id="4973320">err</span>&nbsp;<span class="op" id="4973324">=</span>&nbsp;<span class="ident" id="4973326">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973331">z</span><span class="op" id="4973332">.</span><span class="ident" id="4973333">multistream</span>&nbsp;<span class="op" id="4973345">=</span>&nbsp;<span class="builtintype" id="4973347">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973353">return</span>&nbsp;<span class="ident" id="4973360">z</span><span class="op" id="4973361">.</span><span class="ident" id="4973362">readHeader</span><span class="op" id="4973372">(</span><span class="builtintype" id="4973373">true</span><span class="op" id="4973377">)</span><br>
<span class="lineno"></span><span class="op" id="4973379">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4973382">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4973453">//</span><br>
<span class="lineno"></span><span class="comment" id="4973456">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4973531">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4973601">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4973679">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4973757">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4973821">//</span><br>
<span class="lineno"></span><span class="comment" id="4973824">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4973901">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4973977">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4974043">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4974112">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4974187">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4974245">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4974324">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4974386">func</span>&nbsp;<span class="op" id="4974391">(</span><span class="ident" id="4974392">z</span>&nbsp;<span class="op" id="4974394">*</span><span class="ident" id="4974395">Reader</span><span class="op" id="4974401">)</span>&nbsp;<span class="ident" id="4974403">Multistream</span><span class="op" id="4974414">(</span><span class="ident" id="4974415">ok</span>&nbsp;<span class="builtintype" id="4974418">bool</span><span class="op" id="4974422">)</span>&nbsp;<span class="op" id="4974424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974427">z</span><span class="op" id="4974428">.</span><span class="ident" id="4974429">multistream</span>&nbsp;<span class="op" id="4974441">=</span>&nbsp;<span class="ident" id="4974443">ok</span><br>
<span class="lineno"></span><span class="op" id="4974446">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4974449">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4974510">func</span>&nbsp;<span class="ident" id="4974515">get4</span><span class="op" id="4974519">(</span><span class="ident" id="4974520">p</span>&nbsp;<span class="op" id="4974522">[</span><span class="op" id="4974523">]</span><span class="builtintype" id="4974524">byte</span><span class="op" id="4974528">)</span>&nbsp;<span class="builtintype" id="4974530">uint32</span>&nbsp;<span class="op" id="4974537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974540">return</span>&nbsp;<span class="builtintype" id="4974547">uint32</span><span class="op" id="4974553">(</span><span class="ident" id="4974554">p</span><span class="op" id="4974555">[</span><span class="num" id="4974556">0</span><span class="op" id="4974557">]</span><span class="op" id="4974558">)</span>&nbsp;<span class="op" id="4974560">|</span>&nbsp;<span class="builtintype" id="4974562">uint32</span><span class="op" id="4974568">(</span><span class="ident" id="4974569">p</span><span class="op" id="4974570">[</span><span class="num" id="4974571">1</span><span class="op" id="4974572">]</span><span class="op" id="4974573">)</span><span class="op" id="4974574">&lt;&lt;</span><span class="num" id="4974576">8</span>&nbsp;<span class="op" id="4974578">|</span>&nbsp;<span class="builtintype" id="4974580">uint32</span><span class="op" id="4974586">(</span><span class="ident" id="4974587">p</span><span class="op" id="4974588">[</span><span class="num" id="4974589">2</span><span class="op" id="4974590">]</span><span class="op" id="4974591">)</span><span class="op" id="4974592">&lt;&lt;</span><span class="num" id="4974594">16</span>&nbsp;<span class="op" id="4974597">|</span>&nbsp;<span class="builtintype" id="4974599">uint32</span><span class="op" id="4974605">(</span><span class="ident" id="4974606">p</span><span class="op" id="4974607">[</span><span class="num" id="4974608">3</span><span class="op" id="4974609">]</span><span class="op" id="4974610">)</span><span class="op" id="4974611">&lt;&lt;</span><span class="num" id="4974613">24</span><br>
<span class="lineno"></span><span class="op" id="4974616">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4974619">func</span>&nbsp;<span class="op" id="4974624">(</span><span class="ident" id="4974625">z</span>&nbsp;<span class="op" id="4974627">*</span><span class="ident" id="4974628">Reader</span><span class="op" id="4974634">)</span>&nbsp;<span class="ident" id="4974636">readString</span><span class="op" id="4974646">(</span><span class="op" id="4974647">)</span>&nbsp;<span class="op" id="4974649">(</span><span class="builtintype" id="4974650">string</span><span class="op" id="4974656">,</span>&nbsp;<span class="builtintype" id="4974658">error</span><span class="op" id="4974663">)</span>&nbsp;<span class="op" id="4974665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974668">var</span>&nbsp;<span class="ident" id="4974672">err</span>&nbsp;<span class="builtintype" id="4974676">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974683">needconv</span>&nbsp;<span class="op" id="4974692">:=</span>&nbsp;<span class="builtintype" id="4974695">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974702">for</span>&nbsp;<span class="ident" id="4974706">i</span>&nbsp;<span class="op" id="4974708">:=</span>&nbsp;<span class="num" id="4974711">0</span><span class="op" id="4974712">;</span>&nbsp;<span class="op" id="4974714">;</span>&nbsp;<span class="ident" id="4974716">i</span><span class="op" id="4974717">++</span>&nbsp;<span class="op" id="4974720">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974724">if</span>&nbsp;<span class="ident" id="4974727">i</span>&nbsp;<span class="op" id="4974729">&gt;=</span>&nbsp;<span class="builtinfunc" id="4974732">len</span><span class="op" id="4974735">(</span><span class="ident" id="4974736">z</span><span class="op" id="4974737">.</span><span class="ident" id="4974738">buf</span><span class="op" id="4974741">)</span>&nbsp;<span class="op" id="4974743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974748">return</span>&nbsp;<span class="string" id="4974755">&#34;&#34;</span><span class="op" id="4974757">,</span>&nbsp;<span class="ident" id="4974759">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974775">z</span><span class="op" id="4974776">.</span><span class="ident" id="4974777">buf</span><span class="op" id="4974780">[</span><span class="ident" id="4974781">i</span><span class="op" id="4974782">]</span><span class="op" id="4974783">,</span>&nbsp;<span class="ident" id="4974785">err</span>&nbsp;<span class="op" id="4974789">=</span>&nbsp;<span class="ident" id="4974791">z</span><span class="op" id="4974792">.</span><span class="ident" id="4974793">r</span><span class="op" id="4974794">.</span><span class="ident" id="4974795">ReadByte</span><span class="op" id="4974803">(</span><span class="op" id="4974804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974808">if</span>&nbsp;<span class="ident" id="4974811">err</span>&nbsp;<span class="op" id="4974815">!=</span>&nbsp;<span class="ident" id="4974818">nil</span>&nbsp;<span class="op" id="4974822">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974827">return</span>&nbsp;<span class="string" id="4974834">&#34;&#34;</span><span class="op" id="4974836">,</span>&nbsp;<span class="ident" id="4974838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974848">if</span>&nbsp;<span class="ident" id="4974851">z</span><span class="op" id="4974852">.</span><span class="ident" id="4974853">buf</span><span class="op" id="4974856">[</span><span class="ident" id="4974857">i</span><span class="op" id="4974858">]</span>&nbsp;<span class="op" id="4974860">&gt;</span>&nbsp;<span class="num" id="4974862">0x7f</span>&nbsp;<span class="op" id="4974867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974872">needconv</span>&nbsp;<span class="op" id="4974881">=</span>&nbsp;<span class="builtintype" id="4974883">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974890">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974894">if</span>&nbsp;<span class="ident" id="4974897">z</span><span class="op" id="4974898">.</span><span class="ident" id="4974899">buf</span><span class="op" id="4974902">[</span><span class="ident" id="4974903">i</span><span class="op" id="4974904">]</span>&nbsp;<span class="op" id="4974906">==</span>&nbsp;<span class="num" id="4974909">0</span>&nbsp;<span class="op" id="4974911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4974916">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975002">if</span>&nbsp;<span class="ident" id="4975005">needconv</span>&nbsp;<span class="op" id="4975014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975020">s</span>&nbsp;<span class="op" id="4975022">:=</span>&nbsp;<span class="builtinfunc" id="4975025">make</span><span class="op" id="4975029">(</span><span class="op" id="4975030">[</span><span class="op" id="4975031">]</span><span class="builtintype" id="4975032">rune</span><span class="op" id="4975036">,</span>&nbsp;<span class="num" id="4975038">0</span><span class="op" id="4975039">,</span>&nbsp;<span class="ident" id="4975041">i</span><span class="op" id="4975042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975048">for</span>&nbsp;<span class="ident" id="4975052">_</span><span class="op" id="4975053">,</span>&nbsp;<span class="ident" id="4975055">v</span>&nbsp;<span class="op" id="4975057">:=</span>&nbsp;<span class="keyword" id="4975060">range</span>&nbsp;<span class="ident" id="4975066">z</span><span class="op" id="4975067">.</span><span class="ident" id="4975068">buf</span><span class="op" id="4975071">[</span><span class="num" id="4975072">0</span><span class="op" id="4975073">:</span><span class="ident" id="4975074">i</span><span class="op" id="4975075">]</span>&nbsp;<span class="op" id="4975077">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975084">s</span>&nbsp;<span class="op" id="4975086">=</span>&nbsp;<span class="builtinfunc" id="4975088">append</span><span class="op" id="4975094">(</span><span class="ident" id="4975095">s</span><span class="op" id="4975096">,</span>&nbsp;<span class="builtintype" id="4975098">rune</span><span class="op" id="4975102">(</span><span class="ident" id="4975103">v</span><span class="op" id="4975104">)</span><span class="op" id="4975105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975117">return</span>&nbsp;<span class="builtintype" id="4975124">string</span><span class="op" id="4975130">(</span><span class="ident" id="4975131">s</span><span class="op" id="4975132">)</span><span class="op" id="4975133">,</span>&nbsp;<span class="ident" id="4975135">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975147">return</span>&nbsp;<span class="builtintype" id="4975154">string</span><span class="op" id="4975160">(</span><span class="ident" id="4975161">z</span><span class="op" id="4975162">.</span><span class="ident" id="4975163">buf</span><span class="op" id="4975166">[</span><span class="num" id="4975167">0</span><span class="op" id="4975168">:</span><span class="ident" id="4975169">i</span><span class="op" id="4975170">]</span><span class="op" id="4975171">)</span><span class="op" id="4975172">,</span>&nbsp;<span class="ident" id="4975174">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975183">}</span><br>
<span class="lineno"></span><span class="op" id="4975185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4975188">func</span>&nbsp;<span class="op" id="4975193">(</span><span class="ident" id="4975194">z</span>&nbsp;<span class="op" id="4975196">*</span><span class="ident" id="4975197">Reader</span><span class="op" id="4975203">)</span>&nbsp;<span class="ident" id="4975205">read2</span><span class="op" id="4975210">(</span><span class="op" id="4975211">)</span>&nbsp;<span class="op" id="4975213">(</span><span class="builtintype" id="4975214">uint32</span><span class="op" id="4975220">,</span>&nbsp;<span class="builtintype" id="4975222">error</span><span class="op" id="4975227">)</span>&nbsp;<span class="op" id="4975229">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975232">_</span><span class="op" id="4975233">,</span>&nbsp;<span class="ident" id="4975235">err</span>&nbsp;<span class="op" id="4975239">:=</span>&nbsp;<span class="ident" id="4975242">io</span><span class="op" id="4975244">.</span><span class="ident" id="4975245">ReadFull</span><span class="op" id="4975253">(</span><span class="ident" id="4975254">z</span><span class="op" id="4975255">.</span><span class="ident" id="4975256">r</span><span class="op" id="4975257">,</span>&nbsp;<span class="ident" id="4975259">z</span><span class="op" id="4975260">.</span><span class="ident" id="4975261">buf</span><span class="op" id="4975264">[</span><span class="num" id="4975265">0</span><span class="op" id="4975266">:</span><span class="num" id="4975267">2</span><span class="op" id="4975268">]</span><span class="op" id="4975269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975272">if</span>&nbsp;<span class="ident" id="4975275">err</span>&nbsp;<span class="op" id="4975279">!=</span>&nbsp;<span class="ident" id="4975282">nil</span>&nbsp;<span class="op" id="4975286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975290">return</span>&nbsp;<span class="num" id="4975297">0</span><span class="op" id="4975298">,</span>&nbsp;<span class="ident" id="4975300">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975308">return</span>&nbsp;<span class="builtintype" id="4975315">uint32</span><span class="op" id="4975321">(</span><span class="ident" id="4975322">z</span><span class="op" id="4975323">.</span><span class="ident" id="4975324">buf</span><span class="op" id="4975327">[</span><span class="num" id="4975328">0</span><span class="op" id="4975329">]</span><span class="op" id="4975330">)</span>&nbsp;<span class="op" id="4975332">|</span>&nbsp;<span class="builtintype" id="4975334">uint32</span><span class="op" id="4975340">(</span><span class="ident" id="4975341">z</span><span class="op" id="4975342">.</span><span class="ident" id="4975343">buf</span><span class="op" id="4975346">[</span><span class="num" id="4975347">1</span><span class="op" id="4975348">]</span><span class="op" id="4975349">)</span><span class="op" id="4975350">&lt;&lt;</span><span class="num" id="4975352">8</span><span class="op" id="4975353">,</span>&nbsp;<span class="ident" id="4975355">nil</span><br>
<span class="lineno">170</span><span class="op" id="4975359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4975362">func</span>&nbsp;<span class="op" id="4975367">(</span><span class="ident" id="4975368">z</span>&nbsp;<span class="op" id="4975370">*</span><span class="ident" id="4975371">Reader</span><span class="op" id="4975377">)</span>&nbsp;<span class="ident" id="4975379">readHeader</span><span class="op" id="4975389">(</span><span class="ident" id="4975390">save</span>&nbsp;<span class="builtintype" id="4975395">bool</span><span class="op" id="4975399">)</span>&nbsp;<span class="builtintype" id="4975401">error</span>&nbsp;<span class="op" id="4975407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975410">_</span><span class="op" id="4975411">,</span>&nbsp;<span class="ident" id="4975413">err</span>&nbsp;<span class="op" id="4975417">:=</span>&nbsp;<span class="ident" id="4975420">io</span><span class="op" id="4975422">.</span><span class="ident" id="4975423">ReadFull</span><span class="op" id="4975431">(</span><span class="ident" id="4975432">z</span><span class="op" id="4975433">.</span><span class="ident" id="4975434">r</span><span class="op" id="4975435">,</span>&nbsp;<span class="ident" id="4975437">z</span><span class="op" id="4975438">.</span><span class="ident" id="4975439">buf</span><span class="op" id="4975442">[</span><span class="num" id="4975443">0</span><span class="op" id="4975444">:</span><span class="num" id="4975445">10</span><span class="op" id="4975447">]</span><span class="op" id="4975448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975451">if</span>&nbsp;<span class="ident" id="4975454">err</span>&nbsp;<span class="op" id="4975458">!=</span>&nbsp;<span class="ident" id="4975461">nil</span>&nbsp;<span class="op" id="4975465">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975469">return</span>&nbsp;<span class="ident" id="4975476">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975484">if</span>&nbsp;<span class="ident" id="4975487">z</span><span class="op" id="4975488">.</span><span class="ident" id="4975489">buf</span><span class="op" id="4975492">[</span><span class="num" id="4975493">0</span><span class="op" id="4975494">]</span>&nbsp;<span class="op" id="4975496">!=</span>&nbsp;<span class="ident" id="4975499">gzipID1</span>&nbsp;<span class="op" id="4975507">||</span>&nbsp;<span class="ident" id="4975510">z</span><span class="op" id="4975511">.</span><span class="ident" id="4975512">buf</span><span class="op" id="4975515">[</span><span class="num" id="4975516">1</span><span class="op" id="4975517">]</span>&nbsp;<span class="op" id="4975519">!=</span>&nbsp;<span class="ident" id="4975522">gzipID2</span>&nbsp;<span class="op" id="4975530">||</span>&nbsp;<span class="ident" id="4975533">z</span><span class="op" id="4975534">.</span><span class="ident" id="4975535">buf</span><span class="op" id="4975538">[</span><span class="num" id="4975539">2</span><span class="op" id="4975540">]</span>&nbsp;<span class="op" id="4975542">!=</span>&nbsp;<span class="ident" id="4975545">gzipDeflate</span>&nbsp;<span class="op" id="4975557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975561">return</span>&nbsp;<span class="ident" id="4975568">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975579">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975582">z</span><span class="op" id="4975583">.</span><span class="ident" id="4975584">flg</span>&nbsp;<span class="op" id="4975588">=</span>&nbsp;<span class="ident" id="4975590">z</span><span class="op" id="4975591">.</span><span class="ident" id="4975592">buf</span><span class="op" id="4975595">[</span><span class="num" id="4975596">3</span><span class="op" id="4975597">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975600">if</span>&nbsp;<span class="ident" id="4975603">save</span>&nbsp;<span class="op" id="4975608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975612">z</span><span class="op" id="4975613">.</span><span class="ident" id="4975614">ModTime</span>&nbsp;<span class="op" id="4975622">=</span>&nbsp;<span class="ident" id="4975624">time</span><span class="op" id="4975628">.</span><span class="ident" id="4975629">Unix</span><span class="op" id="4975633">(</span><span class="ident" id="4975634">int64</span><span class="op" id="4975639">(</span><span class="ident" id="4975640">get4</span><span class="op" id="4975644">(</span><span class="ident" id="4975645">z</span><span class="op" id="4975646">.</span><span class="ident" id="4975647">buf</span><span class="op" id="4975650">[</span><span class="num" id="4975651">4</span><span class="op" id="4975652">:</span><span class="num" id="4975653">8</span><span class="op" id="4975654">]</span><span class="op" id="4975655">)</span><span class="op" id="4975656">)</span><span class="op" id="4975657">,</span>&nbsp;<span class="num" id="4975659">0</span><span class="op" id="4975660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975664">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975694">z</span><span class="op" id="4975695">.</span><span class="ident" id="4975696">OS</span>&nbsp;<span class="op" id="4975699">=</span>&nbsp;<span class="ident" id="4975701">z</span><span class="op" id="4975702">.</span><span class="ident" id="4975703">buf</span><span class="op" id="4975706">[</span><span class="num" id="4975707">9</span><span class="op" id="4975708">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975714">z</span><span class="op" id="4975715">.</span><span class="ident" id="4975716">digest</span><span class="op" id="4975722">.</span><span class="ident" id="4975723">Reset</span><span class="op" id="4975728">(</span><span class="op" id="4975729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975732">z</span><span class="op" id="4975733">.</span><span class="ident" id="4975734">digest</span><span class="op" id="4975740">.</span><span class="ident" id="4975741">Write</span><span class="op" id="4975746">(</span><span class="ident" id="4975747">z</span><span class="op" id="4975748">.</span><span class="ident" id="4975749">buf</span><span class="op" id="4975752">[</span><span class="num" id="4975753">0</span><span class="op" id="4975754">:</span><span class="num" id="4975755">10</span><span class="op" id="4975757">]</span><span class="op" id="4975758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975762">if</span>&nbsp;<span class="ident" id="4975765">z</span><span class="op" id="4975766">.</span><span class="ident" id="4975767">flg</span><span class="op" id="4975770">&amp;</span><span class="ident" id="4975771">flagExtra</span>&nbsp;<span class="op" id="4975781">!=</span>&nbsp;<span class="num" id="4975784">0</span>&nbsp;<span class="op" id="4975786">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975790">n</span><span class="op" id="4975791">,</span>&nbsp;<span class="ident" id="4975793">err</span>&nbsp;<span class="op" id="4975797">:=</span>&nbsp;<span class="ident" id="4975800">z</span><span class="op" id="4975801">.</span><span class="ident" id="4975802">read2</span><span class="op" id="4975807">(</span><span class="op" id="4975808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975812">if</span>&nbsp;<span class="ident" id="4975815">err</span>&nbsp;<span class="op" id="4975819">!=</span>&nbsp;<span class="ident" id="4975822">nil</span>&nbsp;<span class="op" id="4975826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975831">return</span>&nbsp;<span class="ident" id="4975838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975848">data</span>&nbsp;<span class="op" id="4975853">:=</span>&nbsp;<span class="builtinfunc" id="4975856">make</span><span class="op" id="4975860">(</span><span class="op" id="4975861">[</span><span class="op" id="4975862">]</span><span class="builtintype" id="4975863">byte</span><span class="op" id="4975867">,</span>&nbsp;<span class="ident" id="4975869">n</span><span class="op" id="4975870">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975874">if</span>&nbsp;<span class="ident" id="4975877">_</span><span class="op" id="4975878">,</span>&nbsp;<span class="ident" id="4975880">err</span>&nbsp;<span class="op" id="4975884">=</span>&nbsp;<span class="ident" id="4975886">io</span><span class="op" id="4975888">.</span><span class="ident" id="4975889">ReadFull</span><span class="op" id="4975897">(</span><span class="ident" id="4975898">z</span><span class="op" id="4975899">.</span><span class="ident" id="4975900">r</span><span class="op" id="4975901">,</span>&nbsp;<span class="ident" id="4975903">data</span><span class="op" id="4975907">)</span><span class="op" id="4975908">;</span>&nbsp;<span class="ident" id="4975910">err</span>&nbsp;<span class="op" id="4975914">!=</span>&nbsp;<span class="ident" id="4975917">nil</span>&nbsp;<span class="op" id="4975921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975926">return</span>&nbsp;<span class="ident" id="4975933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975943">if</span>&nbsp;<span class="ident" id="4975946">save</span>&nbsp;<span class="op" id="4975951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975956">z</span><span class="op" id="4975957">.</span><span class="ident" id="4975958">Extra</span>&nbsp;<span class="op" id="4975964">=</span>&nbsp;<span class="ident" id="4975966">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975980">var</span>&nbsp;<span class="ident" id="4975984">s</span>&nbsp;<span class="builtintype" id="4975986">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975994">if</span>&nbsp;<span class="ident" id="4975997">z</span><span class="op" id="4975998">.</span><span class="ident" id="4975999">flg</span><span class="op" id="4976002">&amp;</span><span class="ident" id="4976003">flagName</span>&nbsp;<span class="op" id="4976012">!=</span>&nbsp;<span class="num" id="4976015">0</span>&nbsp;<span class="op" id="4976017">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976021">if</span>&nbsp;<span class="ident" id="4976024">s</span><span class="op" id="4976025">,</span>&nbsp;<span class="ident" id="4976027">err</span>&nbsp;<span class="op" id="4976031">=</span>&nbsp;<span class="ident" id="4976033">z</span><span class="op" id="4976034">.</span><span class="ident" id="4976035">readString</span><span class="op" id="4976045">(</span><span class="op" id="4976046">)</span><span class="op" id="4976047">;</span>&nbsp;<span class="ident" id="4976049">err</span>&nbsp;<span class="op" id="4976053">!=</span>&nbsp;<span class="ident" id="4976056">nil</span>&nbsp;<span class="op" id="4976060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976065">return</span>&nbsp;<span class="ident" id="4976072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976082">if</span>&nbsp;<span class="ident" id="4976085">save</span>&nbsp;<span class="op" id="4976090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976095">z</span><span class="op" id="4976096">.</span><span class="ident" id="4976097">Name</span>&nbsp;<span class="op" id="4976102">=</span>&nbsp;<span class="ident" id="4976104">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976115">if</span>&nbsp;<span class="ident" id="4976118">z</span><span class="op" id="4976119">.</span><span class="ident" id="4976120">flg</span><span class="op" id="4976123">&amp;</span><span class="ident" id="4976124">flagComment</span>&nbsp;<span class="op" id="4976136">!=</span>&nbsp;<span class="num" id="4976139">0</span>&nbsp;<span class="op" id="4976141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976145">if</span>&nbsp;<span class="ident" id="4976148">s</span><span class="op" id="4976149">,</span>&nbsp;<span class="ident" id="4976151">err</span>&nbsp;<span class="op" id="4976155">=</span>&nbsp;<span class="ident" id="4976157">z</span><span class="op" id="4976158">.</span><span class="ident" id="4976159">readString</span><span class="op" id="4976169">(</span><span class="op" id="4976170">)</span><span class="op" id="4976171">;</span>&nbsp;<span class="ident" id="4976173">err</span>&nbsp;<span class="op" id="4976177">!=</span>&nbsp;<span class="ident" id="4976180">nil</span>&nbsp;<span class="op" id="4976184">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976189">return</span>&nbsp;<span class="ident" id="4976196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976206">if</span>&nbsp;<span class="ident" id="4976209">save</span>&nbsp;<span class="op" id="4976214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976219">z</span><span class="op" id="4976220">.</span><span class="ident" id="4976221">Comment</span>&nbsp;<span class="op" id="4976229">=</span>&nbsp;<span class="ident" id="4976231">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976235">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976242">if</span>&nbsp;<span class="ident" id="4976245">z</span><span class="op" id="4976246">.</span><span class="ident" id="4976247">flg</span><span class="op" id="4976250">&amp;</span><span class="ident" id="4976251">flagHdrCrc</span>&nbsp;<span class="op" id="4976262">!=</span>&nbsp;<span class="num" id="4976265">0</span>&nbsp;<span class="op" id="4976267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976271">n</span><span class="op" id="4976272">,</span>&nbsp;<span class="ident" id="4976274">err</span>&nbsp;<span class="op" id="4976278">:=</span>&nbsp;<span class="ident" id="4976281">z</span><span class="op" id="4976282">.</span><span class="ident" id="4976283">read2</span><span class="op" id="4976288">(</span><span class="op" id="4976289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976293">if</span>&nbsp;<span class="ident" id="4976296">err</span>&nbsp;<span class="op" id="4976300">!=</span>&nbsp;<span class="ident" id="4976303">nil</span>&nbsp;<span class="op" id="4976307">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976312">return</span>&nbsp;<span class="ident" id="4976319">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976329">sum</span>&nbsp;<span class="op" id="4976333">:=</span>&nbsp;<span class="ident" id="4976336">z</span><span class="op" id="4976337">.</span><span class="ident" id="4976338">digest</span><span class="op" id="4976344">.</span><span class="ident" id="4976345">Sum32</span><span class="op" id="4976350">(</span><span class="op" id="4976351">)</span>&nbsp;<span class="op" id="4976353">&amp;</span>&nbsp;<span class="num" id="4976355">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976364">if</span>&nbsp;<span class="ident" id="4976367">n</span>&nbsp;<span class="op" id="4976369">!=</span>&nbsp;<span class="ident" id="4976372">sum</span>&nbsp;<span class="op" id="4976376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976381">return</span>&nbsp;<span class="ident" id="4976388">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976407">z</span><span class="op" id="4976408">.</span><span class="ident" id="4976409">digest</span><span class="op" id="4976415">.</span><span class="ident" id="4976416">Reset</span><span class="op" id="4976421">(</span><span class="op" id="4976422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976425">if</span>&nbsp;<span class="ident" id="4976428">z</span><span class="op" id="4976429">.</span><span class="ident" id="4976430">decompressor</span>&nbsp;<span class="op" id="4976443">==</span>&nbsp;<span class="ident" id="4976446">nil</span>&nbsp;<span class="op" id="4976450">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976454">z</span><span class="op" id="4976455">.</span><span class="ident" id="4976456">decompressor</span>&nbsp;<span class="op" id="4976469">=</span>&nbsp;<span class="ident" id="4976471">flate</span><span class="op" id="4976476">.</span><span class="ident" id="4976477">NewReader</span><span class="op" id="4976486">(</span><span class="ident" id="4976487">z</span><span class="op" id="4976488">.</span><span class="ident" id="4976489">r</span><span class="op" id="4976490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976493">}</span>&nbsp;<span class="keyword" id="4976495">else</span>&nbsp;<span class="op" id="4976500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976504">z</span><span class="op" id="4976505">.</span><span class="ident" id="4976506">decompressor</span><span class="op" id="4976518">.</span><span class="op" id="4976519">(</span><span class="ident" id="4976520">flate</span><span class="op" id="4976525">.</span><span class="ident" id="4976526">Resetter</span><span class="op" id="4976534">)</span><span class="op" id="4976535">.</span><span class="ident" id="4976536">Reset</span><span class="op" id="4976541">(</span><span class="ident" id="4976542">z</span><span class="op" id="4976543">.</span><span class="ident" id="4976544">r</span><span class="op" id="4976545">,</span>&nbsp;<span class="ident" id="4976547">nil</span><span class="op" id="4976550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976556">return</span>&nbsp;<span class="ident" id="4976563">nil</span><br>
<span class="lineno">240</span><span class="op" id="4976567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976570">func</span>&nbsp;<span class="op" id="4976575">(</span><span class="ident" id="4976576">z</span>&nbsp;<span class="op" id="4976578">*</span><span class="ident" id="4976579">Reader</span><span class="op" id="4976585">)</span>&nbsp;<span class="ident" id="4976587">Read</span><span class="op" id="4976591">(</span><span class="ident" id="4976592">p</span>&nbsp;<span class="op" id="4976594">[</span><span class="op" id="4976595">]</span><span class="builtintype" id="4976596">byte</span><span class="op" id="4976600">)</span>&nbsp;<span class="op" id="4976602">(</span><span class="ident" id="4976603">n</span>&nbsp;<span class="builtintype" id="4976605">int</span><span class="op" id="4976608">,</span>&nbsp;<span class="ident" id="4976610">err</span>&nbsp;<span class="builtintype" id="4976614">error</span><span class="op" id="4976619">)</span>&nbsp;<span class="op" id="4976621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976624">if</span>&nbsp;<span class="ident" id="4976627">z</span><span class="op" id="4976628">.</span><span class="ident" id="4976629">err</span>&nbsp;<span class="op" id="4976633">!=</span>&nbsp;<span class="ident" id="4976636">nil</span>&nbsp;<span class="op" id="4976640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976644">return</span>&nbsp;<span class="num" id="4976651">0</span><span class="op" id="4976652">,</span>&nbsp;<span class="ident" id="4976654">z</span><span class="op" id="4976655">.</span><span class="ident" id="4976656">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976664">if</span>&nbsp;<span class="builtinfunc" id="4976667">len</span><span class="op" id="4976670">(</span><span class="ident" id="4976671">p</span><span class="op" id="4976672">)</span>&nbsp;<span class="op" id="4976674">==</span>&nbsp;<span class="num" id="4976677">0</span>&nbsp;<span class="op" id="4976679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976683">return</span>&nbsp;<span class="num" id="4976690">0</span><span class="op" id="4976691">,</span>&nbsp;<span class="ident" id="4976693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976702">n</span><span class="op" id="4976703">,</span>&nbsp;<span class="ident" id="4976705">err</span>&nbsp;<span class="op" id="4976709">=</span>&nbsp;<span class="ident" id="4976711">z</span><span class="op" id="4976712">.</span><span class="ident" id="4976713">decompressor</span><span class="op" id="4976725">.</span><span class="ident" id="4976726">Read</span><span class="op" id="4976730">(</span><span class="ident" id="4976731">p</span><span class="op" id="4976732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976735">z</span><span class="op" id="4976736">.</span><span class="ident" id="4976737">digest</span><span class="op" id="4976743">.</span><span class="ident" id="4976744">Write</span><span class="op" id="4976749">(</span><span class="ident" id="4976750">p</span><span class="op" id="4976751">[</span><span class="num" id="4976752">0</span><span class="op" id="4976753">:</span><span class="ident" id="4976754">n</span><span class="op" id="4976755">]</span><span class="op" id="4976756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976759">z</span><span class="op" id="4976760">.</span><span class="ident" id="4976761">size</span>&nbsp;<span class="op" id="4976766">+=</span>&nbsp;<span class="builtintype" id="4976769">uint32</span><span class="op" id="4976775">(</span><span class="ident" id="4976776">n</span><span class="op" id="4976777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976780">if</span>&nbsp;<span class="ident" id="4976783">n</span>&nbsp;<span class="op" id="4976785">!=</span>&nbsp;<span class="num" id="4976788">0</span>&nbsp;<span class="op" id="4976790">||</span>&nbsp;<span class="ident" id="4976793">err</span>&nbsp;<span class="op" id="4976797">!=</span>&nbsp;<span class="ident" id="4976800">io</span><span class="op" id="4976802">.</span><span class="ident" id="4976803">EOF</span>&nbsp;<span class="op" id="4976807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976811">z</span><span class="op" id="4976812">.</span><span class="ident" id="4976813">err</span>&nbsp;<span class="op" id="4976817">=</span>&nbsp;<span class="ident" id="4976819">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976825">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976837">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976879">if</span>&nbsp;<span class="ident" id="4976882">_</span><span class="op" id="4976883">,</span>&nbsp;<span class="ident" id="4976885">err</span>&nbsp;<span class="op" id="4976889">:=</span>&nbsp;<span class="ident" id="4976892">io</span><span class="op" id="4976894">.</span><span class="ident" id="4976895">ReadFull</span><span class="op" id="4976903">(</span><span class="ident" id="4976904">z</span><span class="op" id="4976905">.</span><span class="ident" id="4976906">r</span><span class="op" id="4976907">,</span>&nbsp;<span class="ident" id="4976909">z</span><span class="op" id="4976910">.</span><span class="ident" id="4976911">buf</span><span class="op" id="4976914">[</span><span class="num" id="4976915">0</span><span class="op" id="4976916">:</span><span class="num" id="4976917">8</span><span class="op" id="4976918">]</span><span class="op" id="4976919">)</span><span class="op" id="4976920">;</span>&nbsp;<span class="ident" id="4976922">err</span>&nbsp;<span class="op" id="4976926">!=</span>&nbsp;<span class="ident" id="4976929">nil</span>&nbsp;<span class="op" id="4976933">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976937">z</span><span class="op" id="4976938">.</span><span class="ident" id="4976939">err</span>&nbsp;<span class="op" id="4976943">=</span>&nbsp;<span class="ident" id="4976945">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976951">return</span>&nbsp;<span class="num" id="4976958">0</span><span class="op" id="4976959">,</span>&nbsp;<span class="ident" id="4976961">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976969">crc32</span><span class="op" id="4976974">,</span>&nbsp;<span class="ident" id="4976976">isize</span>&nbsp;<span class="op" id="4976982">:=</span>&nbsp;<span class="ident" id="4976985">get4</span><span class="op" id="4976989">(</span><span class="ident" id="4976990">z</span><span class="op" id="4976991">.</span><span class="ident" id="4976992">buf</span><span class="op" id="4976995">[</span><span class="num" id="4976996">0</span><span class="op" id="4976997">:</span><span class="num" id="4976998">4</span><span class="op" id="4976999">]</span><span class="op" id="4977000">)</span><span class="op" id="4977001">,</span>&nbsp;<span class="ident" id="4977003">get4</span><span class="op" id="4977007">(</span><span class="ident" id="4977008">z</span><span class="op" id="4977009">.</span><span class="ident" id="4977010">buf</span><span class="op" id="4977013">[</span><span class="num" id="4977014">4</span><span class="op" id="4977015">:</span><span class="num" id="4977016">8</span><span class="op" id="4977017">]</span><span class="op" id="4977018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977021">sum</span>&nbsp;<span class="op" id="4977025">:=</span>&nbsp;<span class="ident" id="4977028">z</span><span class="op" id="4977029">.</span><span class="ident" id="4977030">digest</span><span class="op" id="4977036">.</span><span class="ident" id="4977037">Sum32</span><span class="op" id="4977042">(</span><span class="op" id="4977043">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977046">if</span>&nbsp;<span class="ident" id="4977049">sum</span>&nbsp;<span class="op" id="4977053">!=</span>&nbsp;<span class="ident" id="4977056">crc32</span>&nbsp;<span class="op" id="4977062">||</span>&nbsp;<span class="ident" id="4977065">isize</span>&nbsp;<span class="op" id="4977071">!=</span>&nbsp;<span class="ident" id="4977074">z</span><span class="op" id="4977075">.</span><span class="ident" id="4977076">size</span>&nbsp;<span class="op" id="4977081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977085">z</span><span class="op" id="4977086">.</span><span class="ident" id="4977087">err</span>&nbsp;<span class="op" id="4977091">=</span>&nbsp;<span class="ident" id="4977093">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977107">return</span>&nbsp;<span class="num" id="4977114">0</span><span class="op" id="4977115">,</span>&nbsp;<span class="ident" id="4977117">z</span><span class="op" id="4977118">.</span><span class="ident" id="4977119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977128">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977162">if</span>&nbsp;<span class="op" id="4977165">!</span><span class="ident" id="4977166">z</span><span class="op" id="4977167">.</span><span class="ident" id="4977168">multistream</span>&nbsp;<span class="op" id="4977180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977184">return</span>&nbsp;<span class="num" id="4977191">0</span><span class="op" id="4977192">,</span>&nbsp;<span class="ident" id="4977194">io</span><span class="op" id="4977196">.</span><span class="ident" id="4977197">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977206">if</span>&nbsp;<span class="ident" id="4977209">err</span>&nbsp;<span class="op" id="4977213">=</span>&nbsp;<span class="ident" id="4977215">z</span><span class="op" id="4977216">.</span><span class="ident" id="4977217">readHeader</span><span class="op" id="4977227">(</span><span class="builtintype" id="4977228">false</span><span class="op" id="4977233">)</span><span class="op" id="4977234">;</span>&nbsp;<span class="ident" id="4977236">err</span>&nbsp;<span class="op" id="4977240">!=</span>&nbsp;<span class="ident" id="4977243">nil</span>&nbsp;<span class="op" id="4977247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977251">z</span><span class="op" id="4977252">.</span><span class="ident" id="4977253">err</span>&nbsp;<span class="op" id="4977257">=</span>&nbsp;<span class="ident" id="4977259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977265">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977277">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977311">z</span><span class="op" id="4977312">.</span><span class="ident" id="4977313">digest</span><span class="op" id="4977319">.</span><span class="ident" id="4977320">Reset</span><span class="op" id="4977325">(</span><span class="op" id="4977326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977329">z</span><span class="op" id="4977330">.</span><span class="ident" id="4977331">size</span>&nbsp;<span class="op" id="4977336">=</span>&nbsp;<span class="num" id="4977338">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977341">return</span>&nbsp;<span class="ident" id="4977348">z</span><span class="op" id="4977349">.</span><span class="ident" id="4977350">Read</span><span class="op" id="4977354">(</span><span class="ident" id="4977355">p</span><span class="op" id="4977356">)</span><br>
<span class="lineno"></span><span class="op" id="4977358">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4977361">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4977433">func</span>&nbsp;<span class="op" id="4977438">(</span><span class="ident" id="4977439">z</span>&nbsp;<span class="op" id="4977441">*</span><span class="ident" id="4977442">Reader</span><span class="op" id="4977448">)</span>&nbsp;<span class="ident" id="4977450">Close</span><span class="op" id="4977455">(</span><span class="op" id="4977456">)</span>&nbsp;<span class="builtintype" id="4977458">error</span>&nbsp;<span class="op" id="4977464">{</span>&nbsp;<span class="keyword" id="4977466">return</span>&nbsp;<span class="ident" id="4977473">z</span><span class="op" id="4977474">.</span><span class="ident" id="4977475">decompressor</span><span class="op" id="4977487">.</span><span class="ident" id="4977488">Close</span><span class="op" id="4977493">(</span><span class="op" id="4977494">)</span>&nbsp;<span class="op" id="4977496">}</span>
</div>
</body>
</html>
