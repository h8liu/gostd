<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3502845">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3502901">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3502955">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3503006">package</span>&nbsp;<span class="ident" id="3503014">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3503022">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="3503100">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="3503180">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="3503257">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="3503328">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3503402">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="3503469">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="3503537">func</span>&nbsp;<span class="op" id="3503542">(</span><span class="ident" id="3503543">re</span>&nbsp;<span class="op" id="3503546">*</span><span class="ident" id="3503547">Regexp</span><span class="op" id="3503553">)</span>&nbsp;<span class="ident" id="3503555">Simplify</span><span class="op" id="3503563">(</span><span class="op" id="3503564">)</span>&nbsp;<span class="op" id="3503566">*</span><span class="ident" id="3503567">Regexp</span>&nbsp;<span class="op" id="3503574">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503577">if</span>&nbsp;<span class="ident" id="3503580">re</span>&nbsp;<span class="op" id="3503583">==</span>&nbsp;<span class="ident" id="3503586">nil</span>&nbsp;<span class="op" id="3503590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503594">return</span>&nbsp;<span class="ident" id="3503601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503609">switch</span>&nbsp;<span class="ident" id="3503616">re</span><span class="op" id="3503618">.</span><span class="ident" id="3503619">Op</span>&nbsp;<span class="op" id="3503622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503625">case</span>&nbsp;<span class="ident" id="3503630">OpCapture</span><span class="op" id="3503639">,</span>&nbsp;<span class="ident" id="3503641">OpConcat</span><span class="op" id="3503649">,</span>&nbsp;<span class="ident" id="3503651">OpAlternate</span><span class="op" id="3503662">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3503666">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503730">nre</span>&nbsp;<span class="op" id="3503734">:=</span>&nbsp;<span class="ident" id="3503737">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503742">for</span>&nbsp;<span class="ident" id="3503746">i</span><span class="op" id="3503747">,</span>&nbsp;<span class="ident" id="3503749">sub</span>&nbsp;<span class="op" id="3503753">:=</span>&nbsp;<span class="keyword" id="3503756">range</span>&nbsp;<span class="ident" id="3503762">re</span><span class="op" id="3503764">.</span><span class="ident" id="3503765">Sub</span>&nbsp;<span class="op" id="3503769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503774">nsub</span>&nbsp;<span class="op" id="3503779">:=</span>&nbsp;<span class="ident" id="3503782">sub</span><span class="op" id="3503785">.</span><span class="ident" id="3503786">Simplify</span><span class="op" id="3503794">(</span><span class="op" id="3503795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503800">if</span>&nbsp;<span class="ident" id="3503803">nre</span>&nbsp;<span class="op" id="3503807">==</span>&nbsp;<span class="ident" id="3503810">re</span>&nbsp;<span class="op" id="3503813">&amp;&amp;</span>&nbsp;<span class="ident" id="3503816">nsub</span>&nbsp;<span class="op" id="3503821">!=</span>&nbsp;<span class="ident" id="3503824">sub</span>&nbsp;<span class="op" id="3503828">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3503834">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503855">nre</span>&nbsp;<span class="op" id="3503859">=</span>&nbsp;<span class="builtinfunc" id="3503861">new</span><span class="op" id="3503864">(</span><span class="ident" id="3503865">Regexp</span><span class="op" id="3503871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503877">*</span><span class="ident" id="3503878">nre</span>&nbsp;<span class="op" id="3503882">=</span>&nbsp;<span class="op" id="3503884">*</span><span class="ident" id="3503885">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503892">nre</span><span class="op" id="3503895">.</span><span class="ident" id="3503896">Rune</span>&nbsp;<span class="op" id="3503901">=</span>&nbsp;<span class="ident" id="3503903">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503911">nre</span><span class="op" id="3503914">.</span><span class="ident" id="3503915">Sub</span>&nbsp;<span class="op" id="3503919">=</span>&nbsp;<span class="builtinfunc" id="3503921">append</span><span class="op" id="3503927">(</span><span class="ident" id="3503928">nre</span><span class="op" id="3503931">.</span><span class="ident" id="3503932">Sub0</span><span class="op" id="3503936">[</span><span class="op" id="3503937">:</span><span class="num" id="3503938">0</span><span class="op" id="3503939">]</span><span class="op" id="3503940">,</span>&nbsp;<span class="ident" id="3503942">re</span><span class="op" id="3503944">.</span><span class="ident" id="3503945">Sub</span><span class="op" id="3503948">[</span><span class="op" id="3503949">:</span><span class="ident" id="3503950">i</span><span class="op" id="3503951">]</span><span class="op" id="3503952">...</span><span class="op" id="3503955">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503965">if</span>&nbsp;<span class="ident" id="3503968">nre</span>&nbsp;<span class="op" id="3503972">!=</span>&nbsp;<span class="ident" id="3503975">re</span>&nbsp;<span class="op" id="3503978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503984">nre</span><span class="op" id="3503987">.</span><span class="ident" id="3503988">Sub</span>&nbsp;<span class="op" id="3503992">=</span>&nbsp;<span class="builtinfunc" id="3503994">append</span><span class="op" id="3504000">(</span><span class="ident" id="3504001">nre</span><span class="op" id="3504004">.</span><span class="ident" id="3504005">Sub</span><span class="op" id="3504008">,</span>&nbsp;<span class="ident" id="3504010">nsub</span><span class="op" id="3504014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504023">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504027">return</span>&nbsp;<span class="ident" id="3504034">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504040">case</span>&nbsp;<span class="ident" id="3504045">OpStar</span><span class="op" id="3504051">,</span>&nbsp;<span class="ident" id="3504053">OpPlus</span><span class="op" id="3504059">,</span>&nbsp;<span class="ident" id="3504061">OpQuest</span><span class="op" id="3504068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504072">sub</span>&nbsp;<span class="op" id="3504076">:=</span>&nbsp;<span class="ident" id="3504079">re</span><span class="op" id="3504081">.</span><span class="ident" id="3504082">Sub</span><span class="op" id="3504085">[</span><span class="num" id="3504086">0</span><span class="op" id="3504087">]</span><span class="op" id="3504088">.</span><span class="ident" id="3504089">Simplify</span><span class="op" id="3504097">(</span><span class="op" id="3504098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504102">return</span>&nbsp;<span class="ident" id="3504109">simplify1</span><span class="op" id="3504118">(</span><span class="ident" id="3504119">re</span><span class="op" id="3504121">.</span><span class="ident" id="3504122">Op</span><span class="op" id="3504124">,</span>&nbsp;<span class="ident" id="3504126">re</span><span class="op" id="3504128">.</span><span class="ident" id="3504129">Flags</span><span class="op" id="3504134">,</span>&nbsp;<span class="ident" id="3504136">sub</span><span class="op" id="3504139">,</span>&nbsp;<span class="ident" id="3504141">re</span><span class="op" id="3504143">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504147">case</span>&nbsp;<span class="ident" id="3504152">OpRepeat</span><span class="op" id="3504160">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504164">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504221">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504263">if</span>&nbsp;<span class="ident" id="3504266">re</span><span class="op" id="3504268">.</span><span class="ident" id="3504269">Min</span>&nbsp;<span class="op" id="3504273">==</span>&nbsp;<span class="num" id="3504276">0</span>&nbsp;<span class="op" id="3504278">&amp;&amp;</span>&nbsp;<span class="ident" id="3504281">re</span><span class="op" id="3504283">.</span><span class="ident" id="3504284">Max</span>&nbsp;<span class="op" id="3504288">==</span>&nbsp;<span class="num" id="3504291">0</span>&nbsp;<span class="op" id="3504293">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504298">return</span>&nbsp;<span class="op" id="3504305">&amp;</span><span class="ident" id="3504306">Regexp</span><span class="op" id="3504312">{</span><span class="ident" id="3504313">Op</span><span class="op" id="3504315">:</span>&nbsp;<span class="ident" id="3504317">OpEmptyMatch</span><span class="op" id="3504329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504338">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504359">sub</span>&nbsp;<span class="op" id="3504363">:=</span>&nbsp;<span class="ident" id="3504366">re</span><span class="op" id="3504368">.</span><span class="ident" id="3504369">Sub</span><span class="op" id="3504372">[</span><span class="num" id="3504373">0</span><span class="op" id="3504374">]</span><span class="op" id="3504375">.</span><span class="ident" id="3504376">Simplify</span><span class="op" id="3504384">(</span><span class="op" id="3504385">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504390">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504432">if</span>&nbsp;<span class="ident" id="3504435">re</span><span class="op" id="3504437">.</span><span class="ident" id="3504438">Max</span>&nbsp;<span class="op" id="3504442">==</span>&nbsp;<span class="op" id="3504445">-</span><span class="num" id="3504446">1</span>&nbsp;<span class="op" id="3504448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504453">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504486">if</span>&nbsp;<span class="ident" id="3504489">re</span><span class="op" id="3504491">.</span><span class="ident" id="3504492">Min</span>&nbsp;<span class="op" id="3504496">==</span>&nbsp;<span class="num" id="3504499">0</span>&nbsp;<span class="op" id="3504501">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504507">return</span>&nbsp;<span class="ident" id="3504514">simplify1</span><span class="op" id="3504523">(</span><span class="ident" id="3504524">OpStar</span><span class="op" id="3504530">,</span>&nbsp;<span class="ident" id="3504532">re</span><span class="op" id="3504534">.</span><span class="ident" id="3504535">Flags</span><span class="op" id="3504540">,</span>&nbsp;<span class="ident" id="3504542">sub</span><span class="op" id="3504545">,</span>&nbsp;<span class="ident" id="3504547">nil</span><span class="op" id="3504550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504561">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504594">if</span>&nbsp;<span class="ident" id="3504597">re</span><span class="op" id="3504599">.</span><span class="ident" id="3504600">Min</span>&nbsp;<span class="op" id="3504604">==</span>&nbsp;<span class="num" id="3504607">1</span>&nbsp;<span class="op" id="3504609">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504615">return</span>&nbsp;<span class="ident" id="3504622">simplify1</span><span class="op" id="3504631">(</span><span class="ident" id="3504632">OpPlus</span><span class="op" id="3504638">,</span>&nbsp;<span class="ident" id="3504640">re</span><span class="op" id="3504642">.</span><span class="ident" id="3504643">Flags</span><span class="op" id="3504648">,</span>&nbsp;<span class="ident" id="3504650">sub</span><span class="op" id="3504653">,</span>&nbsp;<span class="ident" id="3504655">nil</span><span class="op" id="3504658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504669">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504705">nre</span>&nbsp;<span class="op" id="3504709">:=</span>&nbsp;<span class="op" id="3504712">&amp;</span><span class="ident" id="3504713">Regexp</span><span class="op" id="3504719">{</span><span class="ident" id="3504720">Op</span><span class="op" id="3504722">:</span>&nbsp;<span class="ident" id="3504724">OpConcat</span><span class="op" id="3504732">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504737">nre</span><span class="op" id="3504740">.</span><span class="ident" id="3504741">Sub</span>&nbsp;<span class="op" id="3504745">=</span>&nbsp;<span class="ident" id="3504747">nre</span><span class="op" id="3504750">.</span><span class="ident" id="3504751">Sub0</span><span class="op" id="3504755">[</span><span class="op" id="3504756">:</span><span class="num" id="3504757">0</span><span class="op" id="3504758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504763">for</span>&nbsp;<span class="ident" id="3504767">i</span>&nbsp;<span class="op" id="3504769">:=</span>&nbsp;<span class="num" id="3504772">0</span><span class="op" id="3504773">;</span>&nbsp;<span class="ident" id="3504775">i</span>&nbsp;<span class="op" id="3504777">&lt;</span>&nbsp;<span class="ident" id="3504779">re</span><span class="op" id="3504781">.</span><span class="ident" id="3504782">Min</span><span class="op" id="3504785">-</span><span class="num" id="3504786">1</span><span class="op" id="3504787">;</span>&nbsp;<span class="ident" id="3504789">i</span><span class="op" id="3504790">++</span>&nbsp;<span class="op" id="3504793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504799">nre</span><span class="op" id="3504802">.</span><span class="ident" id="3504803">Sub</span>&nbsp;<span class="op" id="3504807">=</span>&nbsp;<span class="builtinfunc" id="3504809">append</span><span class="op" id="3504815">(</span><span class="ident" id="3504816">nre</span><span class="op" id="3504819">.</span><span class="ident" id="3504820">Sub</span><span class="op" id="3504823">,</span>&nbsp;<span class="ident" id="3504825">sub</span><span class="op" id="3504828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504838">nre</span><span class="op" id="3504841">.</span><span class="ident" id="3504842">Sub</span>&nbsp;<span class="op" id="3504846">=</span>&nbsp;<span class="builtinfunc" id="3504848">append</span><span class="op" id="3504854">(</span><span class="ident" id="3504855">nre</span><span class="op" id="3504858">.</span><span class="ident" id="3504859">Sub</span><span class="op" id="3504862">,</span>&nbsp;<span class="ident" id="3504864">simplify1</span><span class="op" id="3504873">(</span><span class="ident" id="3504874">OpPlus</span><span class="op" id="3504880">,</span>&nbsp;<span class="ident" id="3504882">re</span><span class="op" id="3504884">.</span><span class="ident" id="3504885">Flags</span><span class="op" id="3504890">,</span>&nbsp;<span class="ident" id="3504892">sub</span><span class="op" id="3504895">,</span>&nbsp;<span class="ident" id="3504897">nil</span><span class="op" id="3504900">)</span><span class="op" id="3504901">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504906">return</span>&nbsp;<span class="ident" id="3504913">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504924">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504963">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504998">if</span>&nbsp;<span class="ident" id="3505001">re</span><span class="op" id="3505003">.</span><span class="ident" id="3505004">Min</span>&nbsp;<span class="op" id="3505008">==</span>&nbsp;<span class="num" id="3505011">1</span>&nbsp;<span class="op" id="3505013">&amp;&amp;</span>&nbsp;<span class="ident" id="3505016">re</span><span class="op" id="3505018">.</span><span class="ident" id="3505019">Max</span>&nbsp;<span class="op" id="3505023">==</span>&nbsp;<span class="num" id="3505026">1</span>&nbsp;<span class="op" id="3505028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505033">return</span>&nbsp;<span class="ident" id="3505040">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505051">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505116">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505182">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505220">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505251">var</span>&nbsp;<span class="ident" id="3505255">prefix</span>&nbsp;<span class="op" id="3505262">*</span><span class="ident" id="3505263">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505272">if</span>&nbsp;<span class="ident" id="3505275">re</span><span class="op" id="3505277">.</span><span class="ident" id="3505278">Min</span>&nbsp;<span class="op" id="3505282">&gt;</span>&nbsp;<span class="num" id="3505284">0</span>&nbsp;<span class="op" id="3505286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505291">prefix</span>&nbsp;<span class="op" id="3505298">=</span>&nbsp;<span class="op" id="3505300">&amp;</span><span class="ident" id="3505301">Regexp</span><span class="op" id="3505307">{</span><span class="ident" id="3505308">Op</span><span class="op" id="3505310">:</span>&nbsp;<span class="ident" id="3505312">OpConcat</span><span class="op" id="3505320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505325">prefix</span><span class="op" id="3505331">.</span><span class="ident" id="3505332">Sub</span>&nbsp;<span class="op" id="3505336">=</span>&nbsp;<span class="ident" id="3505338">prefix</span><span class="op" id="3505344">.</span><span class="ident" id="3505345">Sub0</span><span class="op" id="3505349">[</span><span class="op" id="3505350">:</span><span class="num" id="3505351">0</span><span class="op" id="3505352">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505357">for</span>&nbsp;<span class="ident" id="3505361">i</span>&nbsp;<span class="op" id="3505363">:=</span>&nbsp;<span class="num" id="3505366">0</span><span class="op" id="3505367">;</span>&nbsp;<span class="ident" id="3505369">i</span>&nbsp;<span class="op" id="3505371">&lt;</span>&nbsp;<span class="ident" id="3505373">re</span><span class="op" id="3505375">.</span><span class="ident" id="3505376">Min</span><span class="op" id="3505379">;</span>&nbsp;<span class="ident" id="3505381">i</span><span class="op" id="3505382">++</span>&nbsp;<span class="op" id="3505385">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505391">prefix</span><span class="op" id="3505397">.</span><span class="ident" id="3505398">Sub</span>&nbsp;<span class="op" id="3505402">=</span>&nbsp;<span class="builtinfunc" id="3505404">append</span><span class="op" id="3505410">(</span><span class="ident" id="3505411">prefix</span><span class="op" id="3505417">.</span><span class="ident" id="3505418">Sub</span><span class="op" id="3505421">,</span>&nbsp;<span class="ident" id="3505423">sub</span><span class="op" id="3505426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505440">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505483">if</span>&nbsp;<span class="ident" id="3505486">re</span><span class="op" id="3505488">.</span><span class="ident" id="3505489">Max</span>&nbsp;<span class="op" id="3505493">&gt;</span>&nbsp;<span class="ident" id="3505495">re</span><span class="op" id="3505497">.</span><span class="ident" id="3505498">Min</span>&nbsp;<span class="op" id="3505502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505507">suffix</span>&nbsp;<span class="op" id="3505514">:=</span>&nbsp;<span class="ident" id="3505517">simplify1</span><span class="op" id="3505526">(</span><span class="ident" id="3505527">OpQuest</span><span class="op" id="3505534">,</span>&nbsp;<span class="ident" id="3505536">re</span><span class="op" id="3505538">.</span><span class="ident" id="3505539">Flags</span><span class="op" id="3505544">,</span>&nbsp;<span class="ident" id="3505546">sub</span><span class="op" id="3505549">,</span>&nbsp;<span class="ident" id="3505551">nil</span><span class="op" id="3505554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505559">for</span>&nbsp;<span class="ident" id="3505563">i</span>&nbsp;<span class="op" id="3505565">:=</span>&nbsp;<span class="ident" id="3505568">re</span><span class="op" id="3505570">.</span><span class="ident" id="3505571">Min</span>&nbsp;<span class="op" id="3505575">+</span>&nbsp;<span class="num" id="3505577">1</span><span class="op" id="3505578">;</span>&nbsp;<span class="ident" id="3505580">i</span>&nbsp;<span class="op" id="3505582">&lt;</span>&nbsp;<span class="ident" id="3505584">re</span><span class="op" id="3505586">.</span><span class="ident" id="3505587">Max</span><span class="op" id="3505590">;</span>&nbsp;<span class="ident" id="3505592">i</span><span class="op" id="3505593">++</span>&nbsp;<span class="op" id="3505596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505602">nre2</span>&nbsp;<span class="op" id="3505607">:=</span>&nbsp;<span class="op" id="3505610">&amp;</span><span class="ident" id="3505611">Regexp</span><span class="op" id="3505617">{</span><span class="ident" id="3505618">Op</span><span class="op" id="3505620">:</span>&nbsp;<span class="ident" id="3505622">OpConcat</span><span class="op" id="3505630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505636">nre2</span><span class="op" id="3505640">.</span><span class="ident" id="3505641">Sub</span>&nbsp;<span class="op" id="3505645">=</span>&nbsp;<span class="builtinfunc" id="3505647">append</span><span class="op" id="3505653">(</span><span class="ident" id="3505654">nre2</span><span class="op" id="3505658">.</span><span class="ident" id="3505659">Sub0</span><span class="op" id="3505663">[</span><span class="op" id="3505664">:</span><span class="num" id="3505665">0</span><span class="op" id="3505666">]</span><span class="op" id="3505667">,</span>&nbsp;<span class="ident" id="3505669">sub</span><span class="op" id="3505672">,</span>&nbsp;<span class="ident" id="3505674">suffix</span><span class="op" id="3505680">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505686">suffix</span>&nbsp;<span class="op" id="3505693">=</span>&nbsp;<span class="ident" id="3505695">simplify1</span><span class="op" id="3505704">(</span><span class="ident" id="3505705">OpQuest</span><span class="op" id="3505712">,</span>&nbsp;<span class="ident" id="3505714">re</span><span class="op" id="3505716">.</span><span class="ident" id="3505717">Flags</span><span class="op" id="3505722">,</span>&nbsp;<span class="ident" id="3505724">nre2</span><span class="op" id="3505728">,</span>&nbsp;<span class="ident" id="3505730">nil</span><span class="op" id="3505733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505743">if</span>&nbsp;<span class="ident" id="3505746">prefix</span>&nbsp;<span class="op" id="3505753">==</span>&nbsp;<span class="ident" id="3505756">nil</span>&nbsp;<span class="op" id="3505760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505766">return</span>&nbsp;<span class="ident" id="3505773">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505783">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505788">prefix</span><span class="op" id="3505794">.</span><span class="ident" id="3505795">Sub</span>&nbsp;<span class="op" id="3505799">=</span>&nbsp;<span class="builtinfunc" id="3505801">append</span><span class="op" id="3505807">(</span><span class="ident" id="3505808">prefix</span><span class="op" id="3505814">.</span><span class="ident" id="3505815">Sub</span><span class="op" id="3505818">,</span>&nbsp;<span class="ident" id="3505820">suffix</span><span class="op" id="3505826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505834">if</span>&nbsp;<span class="ident" id="3505837">prefix</span>&nbsp;<span class="op" id="3505844">!=</span>&nbsp;<span class="ident" id="3505847">nil</span>&nbsp;<span class="op" id="3505851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505856">return</span>&nbsp;<span class="ident" id="3505863">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505872">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505877">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505936">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505969">return</span>&nbsp;<span class="op" id="3505976">&amp;</span><span class="ident" id="3505977">Regexp</span><span class="op" id="3505983">{</span><span class="ident" id="3505984">Op</span><span class="op" id="3505986">:</span>&nbsp;<span class="ident" id="3505988">OpNoMatch</span><span class="op" id="3505997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506000">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506004">return</span>&nbsp;<span class="ident" id="3506011">re</span><br>
<span class="lineno"></span><span class="op" id="3506014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3506017">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="3506072">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3506136">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3506153">//</span><br>
<span class="lineno"></span><span class="comment" id="3506156">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="3506200">//</span><br>
<span class="lineno">125</span><span class="comment" id="3506203">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3506259">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3506318">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="3506380">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3506403">//</span><br>
<span class="lineno">130</span><span class="comment" id="3506406">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="3506474">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="3506532">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3506595">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="3506619">func</span>&nbsp;<span class="ident" id="3506624">simplify1</span><span class="op" id="3506633">(</span><span class="ident" id="3506634">op</span>&nbsp;<span class="ident" id="3506637">Op</span><span class="op" id="3506639">,</span>&nbsp;<span class="ident" id="3506641">flags</span>&nbsp;<span class="ident" id="3506647">Flags</span><span class="op" id="3506652">,</span>&nbsp;<span class="ident" id="3506654">sub</span><span class="op" id="3506657">,</span>&nbsp;<span class="ident" id="3506659">re</span>&nbsp;<span class="op" id="3506662">*</span><span class="ident" id="3506663">Regexp</span><span class="op" id="3506669">)</span>&nbsp;<span class="op" id="3506671">*</span><span class="ident" id="3506672">Regexp</span>&nbsp;<span class="op" id="3506679">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506682">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506735">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506782">if</span>&nbsp;<span class="ident" id="3506785">sub</span><span class="op" id="3506788">.</span><span class="ident" id="3506789">Op</span>&nbsp;<span class="op" id="3506792">==</span>&nbsp;<span class="ident" id="3506795">OpEmptyMatch</span>&nbsp;<span class="op" id="3506808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506812">return</span>&nbsp;<span class="ident" id="3506819">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506824">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506827">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506880">if</span>&nbsp;<span class="ident" id="3506883">op</span>&nbsp;<span class="op" id="3506886">==</span>&nbsp;<span class="ident" id="3506889">sub</span><span class="op" id="3506892">.</span><span class="ident" id="3506893">Op</span>&nbsp;<span class="op" id="3506896">&amp;&amp;</span>&nbsp;<span class="ident" id="3506899">flags</span><span class="op" id="3506904">&amp;</span><span class="ident" id="3506905">NonGreedy</span>&nbsp;<span class="op" id="3506915">==</span>&nbsp;<span class="ident" id="3506918">sub</span><span class="op" id="3506921">.</span><span class="ident" id="3506922">Flags</span><span class="op" id="3506927">&amp;</span><span class="ident" id="3506928">NonGreedy</span>&nbsp;<span class="op" id="3506938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506942">return</span>&nbsp;<span class="ident" id="3506949">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506957">if</span>&nbsp;<span class="ident" id="3506960">re</span>&nbsp;<span class="op" id="3506963">!=</span>&nbsp;<span class="ident" id="3506966">nil</span>&nbsp;<span class="op" id="3506970">&amp;&amp;</span>&nbsp;<span class="ident" id="3506973">re</span><span class="op" id="3506975">.</span><span class="ident" id="3506976">Op</span>&nbsp;<span class="op" id="3506979">==</span>&nbsp;<span class="ident" id="3506982">op</span>&nbsp;<span class="op" id="3506985">&amp;&amp;</span>&nbsp;<span class="ident" id="3506988">re</span><span class="op" id="3506990">.</span><span class="ident" id="3506991">Flags</span><span class="op" id="3506996">&amp;</span><span class="ident" id="3506997">NonGreedy</span>&nbsp;<span class="op" id="3507007">==</span>&nbsp;<span class="ident" id="3507010">flags</span><span class="op" id="3507015">&amp;</span><span class="ident" id="3507016">NonGreedy</span>&nbsp;<span class="op" id="3507026">&amp;&amp;</span>&nbsp;<span class="ident" id="3507029">sub</span>&nbsp;<span class="op" id="3507033">==</span>&nbsp;<span class="ident" id="3507036">re</span><span class="op" id="3507038">.</span><span class="ident" id="3507039">Sub</span><span class="op" id="3507042">[</span><span class="num" id="3507043">0</span><span class="op" id="3507044">]</span>&nbsp;<span class="op" id="3507046">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507050">return</span>&nbsp;<span class="ident" id="3507057">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507065">re</span>&nbsp;<span class="op" id="3507068">=</span>&nbsp;<span class="op" id="3507070">&amp;</span><span class="ident" id="3507071">Regexp</span><span class="op" id="3507077">{</span><span class="ident" id="3507078">Op</span><span class="op" id="3507080">:</span>&nbsp;<span class="ident" id="3507082">op</span><span class="op" id="3507084">,</span>&nbsp;<span class="ident" id="3507086">Flags</span><span class="op" id="3507091">:</span>&nbsp;<span class="ident" id="3507093">flags</span><span class="op" id="3507098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507101">re</span><span class="op" id="3507103">.</span><span class="ident" id="3507104">Sub</span>&nbsp;<span class="op" id="3507108">=</span>&nbsp;<span class="builtinfunc" id="3507110">append</span><span class="op" id="3507116">(</span><span class="ident" id="3507117">re</span><span class="op" id="3507119">.</span><span class="ident" id="3507120">Sub0</span><span class="op" id="3507124">[</span><span class="op" id="3507125">:</span><span class="num" id="3507126">0</span><span class="op" id="3507127">]</span><span class="op" id="3507128">,</span>&nbsp;<span class="ident" id="3507130">sub</span><span class="op" id="3507133">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507136">return</span>&nbsp;<span class="ident" id="3507143">re</span><br>
<span class="lineno"></span><span class="op" id="3507146">}</span>
</div>
</body>
</html>
