<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment">//&nbsp;Package&nbsp;unicode&nbsp;provides&nbsp;data&nbsp;and&nbsp;functions&nbsp;to&nbsp;test&nbsp;some&nbsp;properties&nbsp;of</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword">package</span>&nbsp;<span class="ident">unicode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Tables&nbsp;are&nbsp;regenerated&nbsp;each&nbsp;time&nbsp;we&nbsp;update&nbsp;the&nbsp;Unicode&nbsp;version.</span><br>
<span class="lineno">10</span><span class="comment">//go:generate&nbsp;go&nbsp;run&nbsp;maketables.go&nbsp;-tables=all&nbsp;-output&nbsp;tables.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">MaxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ReplacementChar</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Represents&nbsp;invalid&nbsp;code&nbsp;points.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">MaxASCII</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;\u007F&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;maximum&nbsp;ASCII&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">MaxLatin1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;\u00FF&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;maximum&nbsp;Latin-1&nbsp;value.</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;RangeTable&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;by&nbsp;listing&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno">20</span><span class="comment">//&nbsp;code&nbsp;points&nbsp;within&nbsp;the&nbsp;set.&nbsp;The&nbsp;ranges&nbsp;are&nbsp;listed&nbsp;in&nbsp;two&nbsp;slices</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;save&nbsp;space:&nbsp;a&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges&nbsp;and&nbsp;a&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;two&nbsp;slices&nbsp;must&nbsp;be&nbsp;in&nbsp;sorted&nbsp;order&nbsp;and&nbsp;non-overlapping.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Also,&nbsp;R32&nbsp;should&nbsp;contain&nbsp;only&nbsp;values&nbsp;&gt;=&nbsp;0x10000&nbsp;(1&lt;&lt;16).</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">RangeTable</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">R16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">Range16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">R32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">Range32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">LatinOffset</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="comment">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;R16&nbsp;with&nbsp;Hi&nbsp;&lt;=&nbsp;MaxLatin1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment">//&nbsp;Range16&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;16-bit&nbsp;Unicode&nbsp;code&nbsp;points.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Range16</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Stride</span>&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Range32&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;and&nbsp;is&nbsp;used&nbsp;when&nbsp;one&nbsp;or</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;more&nbsp;of&nbsp;the&nbsp;values&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;16&nbsp;bits.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno">40</span><span class="comment">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.&nbsp;Lo&nbsp;and&nbsp;Hi&nbsp;must&nbsp;always&nbsp;be&nbsp;&gt;=&nbsp;1&lt;&lt;16.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Range32</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Stride</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno">45</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;for&nbsp;simple&nbsp;(one</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;code&nbsp;point&nbsp;to&nbsp;one&nbsp;code&nbsp;point)&nbsp;case&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi&nbsp;inclusive,&nbsp;with&nbsp;a&nbsp;fixed&nbsp;stride&nbsp;of&nbsp;1.&nbsp;&nbsp;Deltas</span><br>
<span class="lineno">50</span><span class="comment">//&nbsp;are&nbsp;the&nbsp;number&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;code&nbsp;point&nbsp;to&nbsp;reach&nbsp;the&nbsp;code&nbsp;point&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;different&nbsp;case&nbsp;for&nbsp;that&nbsp;character.&nbsp;&nbsp;They&nbsp;may&nbsp;be&nbsp;negative.&nbsp;&nbsp;If&nbsp;zero,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;means&nbsp;the&nbsp;character&nbsp;is&nbsp;in&nbsp;the&nbsp;corresponding&nbsp;case.&nbsp;There&nbsp;is&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;case&nbsp;representing&nbsp;sequences&nbsp;of&nbsp;alternating&nbsp;corresponding&nbsp;Upper&nbsp;and&nbsp;Lower</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;pairs.&nbsp;&nbsp;It&nbsp;appears&nbsp;with&nbsp;a&nbsp;fixed&nbsp;Delta&nbsp;of</span><br>
<span class="lineno">55</span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp{UpperLower,&nbsp;UpperLower,&nbsp;UpperLower}</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;constant&nbsp;UpperLower&nbsp;has&nbsp;an&nbsp;otherwise&nbsp;impossible&nbsp;delta&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">CaseRange</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Delta</span>&nbsp;<span class="ident">d</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;SpecialCase&nbsp;represents&nbsp;language-specific&nbsp;case&nbsp;mappings&nbsp;such&nbsp;as&nbsp;Turkish.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Methods&nbsp;of&nbsp;SpecialCase&nbsp;customize&nbsp;(by&nbsp;overriding)&nbsp;the&nbsp;standard&nbsp;mappings.</span><br>
<span class="lineno">65</span><span class="keyword">type</span>&nbsp;<span class="ident">SpecialCase</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">CaseRange</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;BUG(r):&nbsp;There&nbsp;is&nbsp;no&nbsp;mechanism&nbsp;for&nbsp;full&nbsp;case&nbsp;folding,&nbsp;that&nbsp;is,&nbsp;for</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;characters&nbsp;that&nbsp;involve&nbsp;multiple&nbsp;runes&nbsp;in&nbsp;the&nbsp;input&nbsp;or&nbsp;output.</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment">//&nbsp;Indices&nbsp;into&nbsp;the&nbsp;Delta&nbsp;arrays&nbsp;inside&nbsp;CaseRanges&nbsp;for&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">UpperCase</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TitleCase</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">MaxCase</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">[</span><span class="ident">MaxCase</span><span class="op">]</span><span class="builtintype">rune</span>&nbsp;<span class="comment">//&nbsp;to&nbsp;make&nbsp;the&nbsp;CaseRanges&nbsp;text&nbsp;shorter</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment">//&nbsp;If&nbsp;the&nbsp;Delta&nbsp;field&nbsp;of&nbsp;a&nbsp;CaseRange&nbsp;is&nbsp;UpperLower,&nbsp;it&nbsp;means</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;this&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;sequence&nbsp;of&nbsp;the&nbsp;form&nbsp;(say)</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Upper&nbsp;Lower&nbsp;Upper&nbsp;Lower.</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">UpperLower</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">MaxRune</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span>&nbsp;<span class="comment">//&nbsp;(Cannot&nbsp;be&nbsp;a&nbsp;valid&nbsp;delta.)</span><br>
<span class="lineno">85</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;linearMax&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;table&nbsp;for&nbsp;linear&nbsp;search&nbsp;for&nbsp;non-Latin1&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Derived&nbsp;by&nbsp;running&nbsp;&#39;go&nbsp;test&nbsp;-calibrate&#39;.</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">linearMax</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">18</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;is16&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">is16</span><span class="op">(</span><span class="ident">ranges</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">Range16</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ranges</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">linearMax</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxLatin1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">ranges</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">range_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">ranges</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="ident">r</span><span class="op">-</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span><span class="op">%</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Stride</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ranges</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">hi</span><span class="op">-</span><span class="ident">lo</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">range_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">ranges</span><span class="op">[</span><span class="ident">m</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="ident">r</span><span class="op">-</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span><span class="op">%</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Stride</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;is32&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno">125</span><span class="keyword">func</span>&nbsp;<span class="ident">is32</span><span class="op">(</span><span class="ident">ranges</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">Range32</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ranges</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">linearMax</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">ranges</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">range_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">ranges</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="ident">r</span><span class="op">-</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span><span class="op">%</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Stride</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ranges</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">hi</span><span class="op">-</span><span class="ident">lo</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">range_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">ranges</span><span class="op">[</span><span class="ident">m</span><span class="op">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="ident">r</span><span class="op">-</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span><span class="op">%</span><span class="ident">range_</span><span class="op">.</span><span class="ident">Stride</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">range_</span><span class="op">.</span><span class="ident">Lo</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">155</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Is&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;in&nbsp;the&nbsp;specified&nbsp;table&nbsp;of&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">Is</span><span class="op">(</span><span class="ident">rangeTab</span>&nbsp;<span class="op">*</span><span class="ident">RangeTable</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r16</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rangeTab</span><span class="op">.</span><span class="ident">R16</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r16</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">r16</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r16</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">Hi</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">is16</span><span class="op">(</span><span class="ident">r16</span><span class="op">,</span>&nbsp;<span class="builtintype">uint16</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r32</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rangeTab</span><span class="op">.</span><span class="ident">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r32</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">r32</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">is32</span><span class="op">(</span><span class="ident">r32</span><span class="op">,</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword">func</span>&nbsp;<span class="ident">isExcludingLatin</span><span class="op">(</span><span class="ident">rangeTab</span>&nbsp;<span class="op">*</span><span class="ident">RangeTable</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r16</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rangeTab</span><span class="op">.</span><span class="ident">R16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">off</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rangeTab</span><span class="op">.</span><span class="ident">LatinOffset</span><span class="op">;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r16</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">off</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">r16</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r16</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">Hi</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">is16</span><span class="op">(</span><span class="ident">r16</span><span class="op">[</span><span class="ident">off</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="builtintype">uint16</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r32</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rangeTab</span><span class="op">.</span><span class="ident">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">r32</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">r32</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">is32</span><span class="op">(</span><span class="ident">r32</span><span class="op">,</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">180</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;IsUpper&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;an&nbsp;upper&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">IsUpper</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxLatin1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">properties</span><span class="op">[</span><span class="builtintype">uint8</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">]</span><span class="op">&amp;</span><span class="ident">pLmask</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">pLu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">isExcludingLatin</span><span class="op">(</span><span class="ident">Upper</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;IsLower&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;lower&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">IsLower</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxLatin1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">properties</span><span class="op">[</span><span class="builtintype">uint8</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">]</span><span class="op">&amp;</span><span class="ident">pLmask</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">pLl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">isExcludingLatin</span><span class="op">(</span><span class="ident">Lower</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment">//&nbsp;IsTitle&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;title&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">IsTitle</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxLatin1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">isExcludingLatin</span><span class="op">(</span><span class="ident">Title</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;maps&nbsp;the&nbsp;rune&nbsp;using&nbsp;the&nbsp;specified&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">to</span><span class="op">(</span><span class="ident">_case</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">,</span>&nbsp;<span class="ident">caseRange</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">CaseRange</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">_case</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">MaxCase</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">_case</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">ReplacementChar</span>&nbsp;<span class="comment">//&nbsp;as&nbsp;reasonable&nbsp;an&nbsp;error&nbsp;as&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">caseRange</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">hi</span><span class="op">-</span><span class="ident">lo</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cr</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">caseRange</span><span class="op">[</span><span class="ident">m</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Hi</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">delta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Delta</span><span class="op">[</span><span class="ident">_case</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">delta</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">MaxRune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;In&nbsp;an&nbsp;Upper-Lower&nbsp;sequence,&nbsp;which&nbsp;always&nbsp;starts&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;an&nbsp;UpperCase&nbsp;letter,&nbsp;the&nbsp;real&nbsp;deltas&nbsp;always&nbsp;look&nbsp;like:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp{0,&nbsp;1,&nbsp;0}&nbsp;&nbsp;&nbsp;&nbsp;UpperCase&nbsp;(Lower&nbsp;is&nbsp;next)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp{-1,&nbsp;0,&nbsp;-1}&nbsp;&nbsp;LowerCase&nbsp;(Upper,&nbsp;Title&nbsp;are&nbsp;previous)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;characters&nbsp;at&nbsp;even&nbsp;offsets&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;sequence&nbsp;are&nbsp;upper&nbsp;case;&nbsp;the&nbsp;ones&nbsp;at&nbsp;odd&nbsp;offsets&nbsp;are&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;correct&nbsp;mapping&nbsp;can&nbsp;be&nbsp;done&nbsp;by&nbsp;clearing&nbsp;or&nbsp;setting&nbsp;the&nbsp;low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;bit&nbsp;in&nbsp;the&nbsp;sequence&nbsp;offset.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;constants&nbsp;UpperCase&nbsp;and&nbsp;TitleCase&nbsp;are&nbsp;even&nbsp;while&nbsp;LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;is&nbsp;odd&nbsp;so&nbsp;we&nbsp;take&nbsp;the&nbsp;low&nbsp;bit&nbsp;from&nbsp;_case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="op">(</span><span class="ident">r</span><span class="op">-</span><span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;^</span><span class="num">1</span>&nbsp;<span class="op">|</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">_case</span><span class="op">&amp;</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">delta</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">cr</span><span class="op">.</span><span class="ident">Lo</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment">//&nbsp;To&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;the&nbsp;specified&nbsp;case:&nbsp;UpperCase,&nbsp;LowerCase,&nbsp;or&nbsp;TitleCase.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">To</span><span class="op">(</span><span class="ident">_case</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">to</span><span class="op">(</span><span class="ident">_case</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">,</span>&nbsp;<span class="ident">CaseRanges</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ToUpper</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxASCII</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="string">&#39;a&#39;</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="string">&#39;z&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="string">&#39;a&#39;</span>&nbsp;<span class="op">-</span>&nbsp;<span class="string">&#39;A&#39;</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">To</span><span class="op">(</span><span class="ident">UpperCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ToLower</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxASCII</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="string">&#39;A&#39;</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="string">&#39;Z&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="string">&#39;a&#39;</span>&nbsp;<span class="op">-</span>&nbsp;<span class="string">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">To</span><span class="op">(</span><span class="ident">LowerCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno">270</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ToTitle</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">MaxASCII</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="string">&#39;a&#39;</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="string">&#39;z&#39;</span>&nbsp;<span class="op">{</span>&nbsp;<span class="comment">//&nbsp;title&nbsp;case&nbsp;is&nbsp;upper&nbsp;case&nbsp;for&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="string">&#39;a&#39;</span>&nbsp;<span class="op">-</span>&nbsp;<span class="string">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">To</span><span class="op">(</span><span class="ident">TitleCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">special</span>&nbsp;<span class="ident">SpecialCase</span><span class="op">)</span>&nbsp;<span class="ident">ToUpper</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">to</span><span class="op">(</span><span class="ident">UpperCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">CaseRange</span><span class="op">(</span><span class="ident">special</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r1</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">ToUpper</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r1</span><br>
<span class="lineno">290</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">special</span>&nbsp;<span class="ident">SpecialCase</span><span class="op">)</span>&nbsp;<span class="ident">ToTitle</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">to</span><span class="op">(</span><span class="ident">TitleCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">CaseRange</span><span class="op">(</span><span class="ident">special</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r1</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">ToTitle</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">special</span>&nbsp;<span class="ident">SpecialCase</span><span class="op">)</span>&nbsp;<span class="ident">ToLower</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">to</span><span class="op">(</span><span class="ident">LowerCase</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">CaseRange</span><span class="op">(</span><span class="ident">special</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r1</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">ToLower</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">r1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment">//&nbsp;caseOrbit&nbsp;is&nbsp;defined&nbsp;in&nbsp;tables.go&nbsp;as&nbsp;[]foldPair.&nbsp;&nbsp;Right&nbsp;now&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;entries&nbsp;fit&nbsp;in&nbsp;uint16,&nbsp;so&nbsp;use&nbsp;uint16.&nbsp;&nbsp;If&nbsp;that&nbsp;changes,&nbsp;compilation</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;will&nbsp;fail&nbsp;(the&nbsp;constants&nbsp;in&nbsp;the&nbsp;composite&nbsp;literal&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;uint16)</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;the&nbsp;types&nbsp;here&nbsp;can&nbsp;change&nbsp;to&nbsp;uint32.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">foldPair</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">From</span>&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">To</span>&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;SimpleFold&nbsp;iterates&nbsp;over&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;equivalent&nbsp;under</span><br>
<span class="lineno">320</span><span class="comment">//&nbsp;the&nbsp;Unicode-defined&nbsp;simple&nbsp;case&nbsp;folding.&nbsp;&nbsp;Among&nbsp;the&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;equivalent&nbsp;to&nbsp;rune&nbsp;(including&nbsp;rune&nbsp;itself),&nbsp;SimpleFold&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;smallest&nbsp;rune&nbsp;&gt;&nbsp;r&nbsp;if&nbsp;one&nbsp;exists,&nbsp;or&nbsp;else&nbsp;the&nbsp;smallest&nbsp;rune&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno">325</span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;A&#39;)&nbsp;=&nbsp;&#39;a&#39;</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;a&#39;)&nbsp;=&nbsp;&#39;A&#39;</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;K&#39;)&nbsp;=&nbsp;&#39;k&#39;</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;k&#39;)&nbsp;=&nbsp;&#39;\u212A&#39;&nbsp;(Kelvin&nbsp;symbol,&nbsp;)</span><br>
<span class="lineno">330</span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;\u212A&#39;)&nbsp;=&nbsp;&#39;K&#39;</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;1&#39;)&nbsp;=&nbsp;&#39;1&#39;</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">SimpleFold</span><span class="op">(</span><span class="ident">r</span>&nbsp;<span class="builtintype">rune</span><span class="op">)</span>&nbsp;<span class="builtintype">rune</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Consult&nbsp;caseOrbit&nbsp;table&nbsp;for&nbsp;special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">caseOrbit</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">hi</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">hi</span><span class="op">-</span><span class="ident">lo</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">caseOrbit</span><span class="op">[</span><span class="ident">m</span><span class="op">]</span><span class="op">.</span><span class="ident">From</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">caseOrbit</span><span class="op">)</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">caseOrbit</span><span class="op">[</span><span class="ident">lo</span><span class="op">]</span><span class="op">.</span><span class="ident">From</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">rune</span><span class="op">(</span><span class="ident">caseOrbit</span><span class="op">[</span><span class="ident">lo</span><span class="op">]</span><span class="op">.</span><span class="ident">To</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;No&nbsp;folding&nbsp;specified.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;one-&nbsp;or&nbsp;two-element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;equivalence&nbsp;class&nbsp;containing&nbsp;rune&nbsp;and&nbsp;ToLower(rune)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;ToUpper(rune)&nbsp;if&nbsp;they&nbsp;are&nbsp;different&nbsp;from&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">ToLower</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">l</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">ToUpper</span><span class="op">(</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
