<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html" class="current">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4420775">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4420830">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4420884">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4420935">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="4420991">//</span><br>
<span class="lineno"></span><span class="comment" id="4420994">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4421056">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="4421117">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="4421186">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="4421246">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="4421284">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="4421309">//</span><br>
<span class="lineno"></span><span class="comment" id="4421312">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="4421369">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="4421431">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="4421489">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4421554">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4421582">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="4421627">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="4421665">//</span><br>
<span class="lineno"></span><span class="comment" id="4421668">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="4421717">//</span><br>
<span class="lineno"></span><span class="comment" id="4421720">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="4421799">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="4421873">//</span><br>
<span class="lineno"></span><span class="comment" id="4421876">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="4421918">//</span><br>
<span class="lineno"></span><span class="comment" id="4421921">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="4421992">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="4422065">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="4422142">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="4422220">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4422295">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="4422318">//</span><br>
<span class="lineno"></span><span class="comment" id="4422321">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4422398">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="4422454">//</span><br>
<span class="lineno"></span><span class="comment" id="4422457">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="4422530">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4422600">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4422676">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="4422747">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4422824">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="4422890">//</span><br>
<span class="lineno"></span><span class="comment" id="4422893">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="4422971">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4423049">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="4423124">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="4423198">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4423269">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="4423325">//</span><br>
<span class="lineno"></span><span class="comment" id="4423328">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4423402">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="4423424">//</span><br>
<span class="lineno"></span><span class="comment" id="4423427">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="4423484">//</span><br>
<span class="lineno"></span><span class="comment" id="4423487">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4423559">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="4423632">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="4423704">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="4423725">//</span><br>
<span class="lineno"></span><span class="comment" id="4423728">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="4423795">//</span><br>
<span class="lineno">65</span><span class="keyword" id="4423798">package</span>&nbsp;<span class="ident" id="4423806">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4423814">import</span>&nbsp;<span class="op" id="4423821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423824">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423833">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423839">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423856">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423867">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423878">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423886">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423897">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4423912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4423915">var</span>&nbsp;<span class="ident" id="4423919">debug</span>&nbsp;<span class="op" id="4423925">=</span>&nbsp;<span class="builtintype" id="4423927">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4423934">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="4424000">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4424063">type</span>&nbsp;<span class="ident" id="4424068">Regexp</span>&nbsp;<span class="keyword" id="4424075">struct</span>&nbsp;<span class="op" id="4424082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424085">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424113">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424128">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424143">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424168">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4424183">*</span><span class="ident" id="4424184">syntax</span><span class="op" id="4424190">.</span><span class="ident" id="4424191">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4424198">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424219">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4424234">*</span><span class="ident" id="4424235">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4424249">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424275">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424290">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424305">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424347">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4424362">[</span><span class="op" id="4424363">]</span><span class="builtintype" id="4424364">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424377">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424401">prefixComplete</span>&nbsp;<span class="builtintype" id="4424416">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424431">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424463">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424478">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424493">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424518">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424533">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424548">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424579">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424594">syntax</span><span class="op" id="4424600">.</span><span class="ident" id="4424601">EmptyOp</span>&nbsp;<span class="comment" id="4424609">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424663">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424678">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424683">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4424698">[</span><span class="op" id="4424699">]</span><span class="builtintype" id="4424700">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424708">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4424723">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424730">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424771">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424779">sync</span><span class="op" id="4424783">.</span><span class="ident" id="4424784">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424791">machine</span>&nbsp;<span class="op" id="4424799">[</span><span class="op" id="4424800">]</span><span class="op" id="4424801">*</span><span class="ident" id="4424802">machine</span><br>
<span class="lineno">100</span><span class="op" id="4424810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4424813">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="4424887">func</span>&nbsp;<span class="op" id="4424892">(</span><span class="ident" id="4424893">re</span>&nbsp;<span class="op" id="4424896">*</span><span class="ident" id="4424897">Regexp</span><span class="op" id="4424903">)</span>&nbsp;<span class="ident" id="4424905">String</span><span class="op" id="4424911">(</span><span class="op" id="4424912">)</span>&nbsp;<span class="builtintype" id="4424914">string</span>&nbsp;<span class="op" id="4424921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424924">return</span>&nbsp;<span class="ident" id="4424931">re</span><span class="op" id="4424933">.</span><span class="ident" id="4424934">expr</span><br>
<span class="lineno">105</span><span class="op" id="4424939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4424942">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="4425009">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4425068">//</span><br>
<span class="lineno">110</span><span class="comment" id="4425071">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4425134">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="4425206">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="4425279">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="4425343">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="4425410">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="4425472">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="4425530">func</span>&nbsp;<span class="ident" id="4425535">Compile</span><span class="op" id="4425542">(</span><span class="ident" id="4425543">expr</span>&nbsp;<span class="builtintype" id="4425548">string</span><span class="op" id="4425554">)</span>&nbsp;<span class="op" id="4425556">(</span><span class="op" id="4425557">*</span><span class="ident" id="4425558">Regexp</span><span class="op" id="4425564">,</span>&nbsp;<span class="builtintype" id="4425566">error</span><span class="op" id="4425571">)</span>&nbsp;<span class="op" id="4425573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425576">return</span>&nbsp;<span class="ident" id="4425583">compile</span><span class="op" id="4425590">(</span><span class="ident" id="4425591">expr</span><span class="op" id="4425595">,</span>&nbsp;<span class="ident" id="4425597">syntax</span><span class="op" id="4425603">.</span><span class="ident" id="4425604">Perl</span><span class="op" id="4425608">,</span>&nbsp;<span class="builtintype" id="4425610">false</span><span class="op" id="4425615">)</span><br>
<span class="lineno"></span><span class="op" id="4425617">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4425620">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="4425689">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4425755">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="4425776">//</span><br>
<span class="lineno">125</span><span class="comment" id="4425779">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4425851">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="4425923">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="4425974">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="4426040">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="4426109">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="4426123">//</span><br>
<span class="lineno"></span><span class="comment" id="4426126">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4426201">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="4426265">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="4426334">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="4426408">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4426482">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="4426547">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="4426623">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="4426691">func</span>&nbsp;<span class="ident" id="4426696">CompilePOSIX</span><span class="op" id="4426708">(</span><span class="ident" id="4426709">expr</span>&nbsp;<span class="builtintype" id="4426714">string</span><span class="op" id="4426720">)</span>&nbsp;<span class="op" id="4426722">(</span><span class="op" id="4426723">*</span><span class="ident" id="4426724">Regexp</span><span class="op" id="4426730">,</span>&nbsp;<span class="builtintype" id="4426732">error</span><span class="op" id="4426737">)</span>&nbsp;<span class="op" id="4426739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426742">return</span>&nbsp;<span class="ident" id="4426749">compile</span><span class="op" id="4426756">(</span><span class="ident" id="4426757">expr</span><span class="op" id="4426761">,</span>&nbsp;<span class="ident" id="4426763">syntax</span><span class="op" id="4426769">.</span><span class="ident" id="4426770">POSIX</span><span class="op" id="4426775">,</span>&nbsp;<span class="builtintype" id="4426777">true</span><span class="op" id="4426781">)</span><br>
<span class="lineno"></span><span class="op" id="4426783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4426786">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="4426854">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4426926">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="4426998">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="4427049">func</span>&nbsp;<span class="op" id="4427054">(</span><span class="ident" id="4427055">re</span>&nbsp;<span class="op" id="4427058">*</span><span class="ident" id="4427059">Regexp</span><span class="op" id="4427065">)</span>&nbsp;<span class="ident" id="4427067">Longest</span><span class="op" id="4427074">(</span><span class="op" id="4427075">)</span>&nbsp;<span class="op" id="4427077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427080">re</span><span class="op" id="4427082">.</span><span class="ident" id="4427083">longest</span>&nbsp;<span class="op" id="4427091">=</span>&nbsp;<span class="builtintype" id="4427093">true</span><br>
<span class="lineno">150</span><span class="op" id="4427098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4427101">func</span>&nbsp;<span class="ident" id="4427106">compile</span><span class="op" id="4427113">(</span><span class="ident" id="4427114">expr</span>&nbsp;<span class="builtintype" id="4427119">string</span><span class="op" id="4427125">,</span>&nbsp;<span class="ident" id="4427127">mode</span>&nbsp;<span class="ident" id="4427132">syntax</span><span class="op" id="4427138">.</span><span class="ident" id="4427139">Flags</span><span class="op" id="4427144">,</span>&nbsp;<span class="ident" id="4427146">longest</span>&nbsp;<span class="builtintype" id="4427154">bool</span><span class="op" id="4427158">)</span>&nbsp;<span class="op" id="4427160">(</span><span class="op" id="4427161">*</span><span class="ident" id="4427162">Regexp</span><span class="op" id="4427168">,</span>&nbsp;<span class="builtintype" id="4427170">error</span><span class="op" id="4427175">)</span>&nbsp;<span class="op" id="4427177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427180">re</span><span class="op" id="4427182">,</span>&nbsp;<span class="ident" id="4427184">err</span>&nbsp;<span class="op" id="4427188">:=</span>&nbsp;<span class="ident" id="4427191">syntax</span><span class="op" id="4427197">.</span><span class="ident" id="4427198">Parse</span><span class="op" id="4427203">(</span><span class="ident" id="4427204">expr</span><span class="op" id="4427208">,</span>&nbsp;<span class="ident" id="4427210">mode</span><span class="op" id="4427214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427217">if</span>&nbsp;<span class="ident" id="4427220">err</span>&nbsp;<span class="op" id="4427224">!=</span>&nbsp;<span class="ident" id="4427227">nil</span>&nbsp;<span class="op" id="4427231">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427235">return</span>&nbsp;<span class="ident" id="4427242">nil</span><span class="op" id="4427245">,</span>&nbsp;<span class="ident" id="4427247">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427255">maxCap</span>&nbsp;<span class="op" id="4427262">:=</span>&nbsp;<span class="ident" id="4427265">re</span><span class="op" id="4427267">.</span><span class="ident" id="4427268">MaxCap</span><span class="op" id="4427274">(</span><span class="op" id="4427275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427278">capNames</span>&nbsp;<span class="op" id="4427287">:=</span>&nbsp;<span class="ident" id="4427290">re</span><span class="op" id="4427292">.</span><span class="ident" id="4427293">CapNames</span><span class="op" id="4427301">(</span><span class="op" id="4427302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427306">re</span>&nbsp;<span class="op" id="4427309">=</span>&nbsp;<span class="ident" id="4427311">re</span><span class="op" id="4427313">.</span><span class="ident" id="4427314">Simplify</span><span class="op" id="4427322">(</span><span class="op" id="4427323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427326">prog</span><span class="op" id="4427330">,</span>&nbsp;<span class="ident" id="4427332">err</span>&nbsp;<span class="op" id="4427336">:=</span>&nbsp;<span class="ident" id="4427339">syntax</span><span class="op" id="4427345">.</span><span class="ident" id="4427346">Compile</span><span class="op" id="4427353">(</span><span class="ident" id="4427354">re</span><span class="op" id="4427356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427359">if</span>&nbsp;<span class="ident" id="4427362">err</span>&nbsp;<span class="op" id="4427366">!=</span>&nbsp;<span class="ident" id="4427369">nil</span>&nbsp;<span class="op" id="4427373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427377">return</span>&nbsp;<span class="ident" id="4427384">nil</span><span class="op" id="4427387">,</span>&nbsp;<span class="ident" id="4427389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427394">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427397">regexp</span>&nbsp;<span class="op" id="4427404">:=</span>&nbsp;<span class="op" id="4427407">&amp;</span><span class="ident" id="4427408">Regexp</span><span class="op" id="4427414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427418">expr</span><span class="op" id="4427422">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4427431">expr</span><span class="op" id="4427435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427439">prog</span><span class="op" id="4427443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4427452">prog</span><span class="op" id="4427456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427460">onepass</span><span class="op" id="4427467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4427473">compileOnePass</span><span class="op" id="4427487">(</span><span class="ident" id="4427488">prog</span><span class="op" id="4427492">)</span><span class="op" id="4427493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427497">numSubexp</span><span class="op" id="4427506">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4427510">maxCap</span><span class="op" id="4427516">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427520">subexpNames</span><span class="op" id="4427531">:</span>&nbsp;<span class="ident" id="4427533">capNames</span><span class="op" id="4427541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427545">cond</span><span class="op" id="4427549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4427558">prog</span><span class="op" id="4427562">.</span><span class="ident" id="4427563">StartCond</span><span class="op" id="4427572">(</span><span class="op" id="4427573">)</span><span class="op" id="4427574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427578">longest</span><span class="op" id="4427585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4427591">longest</span><span class="op" id="4427598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427604">if</span>&nbsp;<span class="ident" id="4427607">regexp</span><span class="op" id="4427613">.</span><span class="ident" id="4427614">onepass</span>&nbsp;<span class="op" id="4427622">==</span>&nbsp;<span class="ident" id="4427625">notOnePass</span>&nbsp;<span class="op" id="4427636">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427640">regexp</span><span class="op" id="4427646">.</span><span class="ident" id="4427647">prefix</span><span class="op" id="4427653">,</span>&nbsp;<span class="ident" id="4427655">regexp</span><span class="op" id="4427661">.</span><span class="ident" id="4427662">prefixComplete</span>&nbsp;<span class="op" id="4427677">=</span>&nbsp;<span class="ident" id="4427679">prog</span><span class="op" id="4427683">.</span><span class="ident" id="4427684">Prefix</span><span class="op" id="4427690">(</span><span class="op" id="4427691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427694">}</span>&nbsp;<span class="keyword" id="4427696">else</span>&nbsp;<span class="op" id="4427701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427705">regexp</span><span class="op" id="4427711">.</span><span class="ident" id="4427712">prefix</span><span class="op" id="4427718">,</span>&nbsp;<span class="ident" id="4427720">regexp</span><span class="op" id="4427726">.</span><span class="ident" id="4427727">prefixComplete</span><span class="op" id="4427741">,</span>&nbsp;<span class="ident" id="4427743">regexp</span><span class="op" id="4427749">.</span><span class="ident" id="4427750">prefixEnd</span>&nbsp;<span class="op" id="4427760">=</span>&nbsp;<span class="ident" id="4427762">onePassPrefix</span><span class="op" id="4427775">(</span><span class="ident" id="4427776">prog</span><span class="op" id="4427780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427786">if</span>&nbsp;<span class="ident" id="4427789">regexp</span><span class="op" id="4427795">.</span><span class="ident" id="4427796">prefix</span>&nbsp;<span class="op" id="4427803">!=</span>&nbsp;<span class="string" id="4427806">&#34;&#34;</span>&nbsp;<span class="op" id="4427809">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427813">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427862">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427897">regexp</span><span class="op" id="4427903">.</span><span class="ident" id="4427904">prefixBytes</span>&nbsp;<span class="op" id="4427916">=</span>&nbsp;<span class="op" id="4427918">[</span><span class="op" id="4427919">]</span><span class="builtintype" id="4427920">byte</span><span class="op" id="4427924">(</span><span class="ident" id="4427925">regexp</span><span class="op" id="4427931">.</span><span class="ident" id="4427932">prefix</span><span class="op" id="4427938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427942">regexp</span><span class="op" id="4427948">.</span><span class="ident" id="4427949">prefixRune</span><span class="op" id="4427959">,</span>&nbsp;<span class="ident" id="4427961">_</span>&nbsp;<span class="op" id="4427963">=</span>&nbsp;<span class="ident" id="4427965">utf8</span><span class="op" id="4427969">.</span><span class="ident" id="4427970">DecodeRuneInString</span><span class="op" id="4427988">(</span><span class="ident" id="4427989">regexp</span><span class="op" id="4427995">.</span><span class="ident" id="4427996">prefix</span><span class="op" id="4428002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428005">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428008">return</span>&nbsp;<span class="ident" id="4428015">regexp</span><span class="op" id="4428021">,</span>&nbsp;<span class="ident" id="4428023">nil</span><br>
<span class="lineno"></span><span class="op" id="4428027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4428030">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="4428079">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="4428135">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="4428162">func</span>&nbsp;<span class="op" id="4428167">(</span><span class="ident" id="4428168">re</span>&nbsp;<span class="op" id="4428171">*</span><span class="ident" id="4428172">Regexp</span><span class="op" id="4428178">)</span>&nbsp;<span class="ident" id="4428180">get</span><span class="op" id="4428183">(</span><span class="op" id="4428184">)</span>&nbsp;<span class="op" id="4428186">*</span><span class="ident" id="4428187">machine</span>&nbsp;<span class="op" id="4428195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428198">re</span><span class="op" id="4428200">.</span><span class="ident" id="4428201">mu</span><span class="op" id="4428203">.</span><span class="ident" id="4428204">Lock</span><span class="op" id="4428208">(</span><span class="op" id="4428209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428212">if</span>&nbsp;<span class="ident" id="4428215">n</span>&nbsp;<span class="op" id="4428217">:=</span>&nbsp;<span class="builtinfunc" id="4428220">len</span><span class="op" id="4428223">(</span><span class="ident" id="4428224">re</span><span class="op" id="4428226">.</span><span class="ident" id="4428227">machine</span><span class="op" id="4428234">)</span><span class="op" id="4428235">;</span>&nbsp;<span class="ident" id="4428237">n</span>&nbsp;<span class="op" id="4428239">&gt;</span>&nbsp;<span class="num" id="4428241">0</span>&nbsp;<span class="op" id="4428243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428247">z</span>&nbsp;<span class="op" id="4428249">:=</span>&nbsp;<span class="ident" id="4428252">re</span><span class="op" id="4428254">.</span><span class="ident" id="4428255">machine</span><span class="op" id="4428262">[</span><span class="ident" id="4428263">n</span><span class="op" id="4428264">-</span><span class="num" id="4428265">1</span><span class="op" id="4428266">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428270">re</span><span class="op" id="4428272">.</span><span class="ident" id="4428273">machine</span>&nbsp;<span class="op" id="4428281">=</span>&nbsp;<span class="ident" id="4428283">re</span><span class="op" id="4428285">.</span><span class="ident" id="4428286">machine</span><span class="op" id="4428293">[</span><span class="op" id="4428294">:</span><span class="ident" id="4428295">n</span><span class="op" id="4428296">-</span><span class="num" id="4428297">1</span><span class="op" id="4428298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428302">re</span><span class="op" id="4428304">.</span><span class="ident" id="4428305">mu</span><span class="op" id="4428307">.</span><span class="ident" id="4428308">Unlock</span><span class="op" id="4428314">(</span><span class="op" id="4428315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428319">return</span>&nbsp;<span class="ident" id="4428326">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428332">re</span><span class="op" id="4428334">.</span><span class="ident" id="4428335">mu</span><span class="op" id="4428337">.</span><span class="ident" id="4428338">Unlock</span><span class="op" id="4428344">(</span><span class="op" id="4428345">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428348">z</span>&nbsp;<span class="op" id="4428350">:=</span>&nbsp;<span class="ident" id="4428353">progMachine</span><span class="op" id="4428364">(</span><span class="ident" id="4428365">re</span><span class="op" id="4428367">.</span><span class="ident" id="4428368">prog</span><span class="op" id="4428372">,</span>&nbsp;<span class="ident" id="4428374">re</span><span class="op" id="4428376">.</span><span class="ident" id="4428377">onepass</span><span class="op" id="4428384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428387">z</span><span class="op" id="4428388">.</span><span class="ident" id="4428389">re</span>&nbsp;<span class="op" id="4428392">=</span>&nbsp;<span class="ident" id="4428394">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428398">return</span>&nbsp;<span class="ident" id="4428405">z</span><br>
<span class="lineno"></span><span class="op" id="4428407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4428410">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="4428462">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4428528">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="4428582">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="4428652">func</span>&nbsp;<span class="op" id="4428657">(</span><span class="ident" id="4428658">re</span>&nbsp;<span class="op" id="4428661">*</span><span class="ident" id="4428662">Regexp</span><span class="op" id="4428668">)</span>&nbsp;<span class="ident" id="4428670">put</span><span class="op" id="4428673">(</span><span class="ident" id="4428674">z</span>&nbsp;<span class="op" id="4428676">*</span><span class="ident" id="4428677">machine</span><span class="op" id="4428684">)</span>&nbsp;<span class="op" id="4428686">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428689">re</span><span class="op" id="4428691">.</span><span class="ident" id="4428692">mu</span><span class="op" id="4428694">.</span><span class="ident" id="4428695">Lock</span><span class="op" id="4428699">(</span><span class="op" id="4428700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428703">re</span><span class="op" id="4428705">.</span><span class="ident" id="4428706">machine</span>&nbsp;<span class="op" id="4428714">=</span>&nbsp;<span class="builtinfunc" id="4428716">append</span><span class="op" id="4428722">(</span><span class="ident" id="4428723">re</span><span class="op" id="4428725">.</span><span class="ident" id="4428726">machine</span><span class="op" id="4428733">,</span>&nbsp;<span class="ident" id="4428735">z</span><span class="op" id="4428736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428739">re</span><span class="op" id="4428741">.</span><span class="ident" id="4428742">mu</span><span class="op" id="4428744">.</span><span class="ident" id="4428745">Unlock</span><span class="op" id="4428751">(</span><span class="op" id="4428752">)</span><br>
<span class="lineno"></span><span class="op" id="4428754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4428757">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4428835">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="4428917">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="4428933">func</span>&nbsp;<span class="ident" id="4428938">MustCompile</span><span class="op" id="4428949">(</span><span class="ident" id="4428950">str</span>&nbsp;<span class="builtintype" id="4428954">string</span><span class="op" id="4428960">)</span>&nbsp;<span class="op" id="4428962">*</span><span class="ident" id="4428963">Regexp</span>&nbsp;<span class="op" id="4428970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428973">regexp</span><span class="op" id="4428979">,</span>&nbsp;<span class="builtintype" id="4428981">error</span>&nbsp;<span class="op" id="4428987">:=</span>&nbsp;<span class="ident" id="4428990">Compile</span><span class="op" id="4428997">(</span><span class="ident" id="4428998">str</span><span class="op" id="4429001">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429004">if</span>&nbsp;<span class="builtintype" id="4429007">error</span>&nbsp;<span class="op" id="4429013">!=</span>&nbsp;<span class="ident" id="4429016">nil</span>&nbsp;<span class="op" id="4429020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429024">panic</span><span class="op" id="4429029">(</span><span class="string" id="4429030">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="4429049">+</span>&nbsp;<span class="ident" id="4429051">quote</span><span class="op" id="4429056">(</span><span class="ident" id="4429057">str</span><span class="op" id="4429060">)</span>&nbsp;<span class="op" id="4429062">+</span>&nbsp;<span class="string" id="4429064">`):&nbsp;`</span>&nbsp;<span class="op" id="4429070">+</span>&nbsp;<span class="builtintype" id="4429072">error</span><span class="op" id="4429077">.</span><span class="ident" id="4429078">Error</span><span class="op" id="4429083">(</span><span class="op" id="4429084">)</span><span class="op" id="4429085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429091">return</span>&nbsp;<span class="ident" id="4429098">regexp</span><br>
<span class="lineno"></span><span class="op" id="4429105">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4429108">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4429196">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="4429278">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="4429294">func</span>&nbsp;<span class="ident" id="4429299">MustCompilePOSIX</span><span class="op" id="4429315">(</span><span class="ident" id="4429316">str</span>&nbsp;<span class="builtintype" id="4429320">string</span><span class="op" id="4429326">)</span>&nbsp;<span class="op" id="4429328">*</span><span class="ident" id="4429329">Regexp</span>&nbsp;<span class="op" id="4429336">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429339">regexp</span><span class="op" id="4429345">,</span>&nbsp;<span class="builtintype" id="4429347">error</span>&nbsp;<span class="op" id="4429353">:=</span>&nbsp;<span class="ident" id="4429356">CompilePOSIX</span><span class="op" id="4429368">(</span><span class="ident" id="4429369">str</span><span class="op" id="4429372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429375">if</span>&nbsp;<span class="builtintype" id="4429378">error</span>&nbsp;<span class="op" id="4429384">!=</span>&nbsp;<span class="ident" id="4429387">nil</span>&nbsp;<span class="op" id="4429391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429395">panic</span><span class="op" id="4429400">(</span><span class="string" id="4429401">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="4429425">+</span>&nbsp;<span class="ident" id="4429427">quote</span><span class="op" id="4429432">(</span><span class="ident" id="4429433">str</span><span class="op" id="4429436">)</span>&nbsp;<span class="op" id="4429438">+</span>&nbsp;<span class="string" id="4429440">`):&nbsp;`</span>&nbsp;<span class="op" id="4429446">+</span>&nbsp;<span class="builtintype" id="4429448">error</span><span class="op" id="4429453">.</span><span class="ident" id="4429454">Error</span><span class="op" id="4429459">(</span><span class="op" id="4429460">)</span><span class="op" id="4429461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429467">return</span>&nbsp;<span class="ident" id="4429474">regexp</span><br>
<span class="lineno">235</span><span class="op" id="4429481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4429484">func</span>&nbsp;<span class="ident" id="4429489">quote</span><span class="op" id="4429494">(</span><span class="ident" id="4429495">s</span>&nbsp;<span class="builtintype" id="4429497">string</span><span class="op" id="4429503">)</span>&nbsp;<span class="builtintype" id="4429505">string</span>&nbsp;<span class="op" id="4429512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429515">if</span>&nbsp;<span class="ident" id="4429518">strconv</span><span class="op" id="4429525">.</span><span class="ident" id="4429526">CanBackquote</span><span class="op" id="4429538">(</span><span class="ident" id="4429539">s</span><span class="op" id="4429540">)</span>&nbsp;<span class="op" id="4429542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429546">return</span>&nbsp;<span class="string" id="4429553">&#34;`&#34;</span>&nbsp;<span class="op" id="4429557">+</span>&nbsp;<span class="ident" id="4429559">s</span>&nbsp;<span class="op" id="4429561">+</span>&nbsp;<span class="string" id="4429563">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429571">return</span>&nbsp;<span class="ident" id="4429578">strconv</span><span class="op" id="4429585">.</span><span class="ident" id="4429586">Quote</span><span class="op" id="4429591">(</span><span class="ident" id="4429592">s</span><span class="op" id="4429593">)</span><br>
<span class="lineno"></span><span class="op" id="4429595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4429598">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="4429678">func</span>&nbsp;<span class="op" id="4429683">(</span><span class="ident" id="4429684">re</span>&nbsp;<span class="op" id="4429687">*</span><span class="ident" id="4429688">Regexp</span><span class="op" id="4429694">)</span>&nbsp;<span class="ident" id="4429696">NumSubexp</span><span class="op" id="4429705">(</span><span class="op" id="4429706">)</span>&nbsp;<span class="builtintype" id="4429708">int</span>&nbsp;<span class="op" id="4429712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429715">return</span>&nbsp;<span class="ident" id="4429722">re</span><span class="op" id="4429724">.</span><span class="ident" id="4429725">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="4429735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4429738">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="4429807">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="4429878">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="4429951">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="4430018">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="4430074">func</span>&nbsp;<span class="op" id="4430079">(</span><span class="ident" id="4430080">re</span>&nbsp;<span class="op" id="4430083">*</span><span class="ident" id="4430084">Regexp</span><span class="op" id="4430090">)</span>&nbsp;<span class="ident" id="4430092">SubexpNames</span><span class="op" id="4430103">(</span><span class="op" id="4430104">)</span>&nbsp;<span class="op" id="4430106">[</span><span class="op" id="4430107">]</span><span class="builtintype" id="4430108">string</span>&nbsp;<span class="op" id="4430115">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430118">return</span>&nbsp;<span class="ident" id="4430125">re</span><span class="op" id="4430127">.</span><span class="ident" id="4430128">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="4430140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4430143">const</span>&nbsp;<span class="ident" id="4430149">endOfText</span>&nbsp;<span class="builtintype" id="4430159">rune</span>&nbsp;<span class="op" id="4430164">=</span>&nbsp;<span class="op" id="4430166">-</span><span class="num" id="4430167">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="4430170">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="4430246">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="4430274">type</span>&nbsp;<span class="ident" id="4430279">input</span>&nbsp;<span class="keyword" id="4430285">interface</span>&nbsp;<span class="op" id="4430295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430298">step</span><span class="op" id="4430302">(</span><span class="ident" id="4430303">pos</span>&nbsp;<span class="builtintype" id="4430307">int</span><span class="op" id="4430310">)</span>&nbsp;<span class="op" id="4430312">(</span><span class="ident" id="4430313">r</span>&nbsp;<span class="builtintype" id="4430315">rune</span><span class="op" id="4430319">,</span>&nbsp;<span class="ident" id="4430321">width</span>&nbsp;<span class="builtintype" id="4430327">int</span><span class="op" id="4430330">)</span>&nbsp;<span class="comment" id="4430332">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430353">canCheckPrefix</span><span class="op" id="4430367">(</span><span class="op" id="4430368">)</span>&nbsp;<span class="builtintype" id="4430370">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4430387">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430430">hasPrefix</span><span class="op" id="4430439">(</span><span class="ident" id="4430440">re</span>&nbsp;<span class="op" id="4430443">*</span><span class="ident" id="4430444">Regexp</span><span class="op" id="4430450">)</span>&nbsp;<span class="builtintype" id="4430452">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430458">index</span><span class="op" id="4430463">(</span><span class="ident" id="4430464">re</span>&nbsp;<span class="op" id="4430467">*</span><span class="ident" id="4430468">Regexp</span><span class="op" id="4430474">,</span>&nbsp;<span class="ident" id="4430476">pos</span>&nbsp;<span class="builtintype" id="4430480">int</span><span class="op" id="4430483">)</span>&nbsp;<span class="builtintype" id="4430485">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430490">context</span><span class="op" id="4430497">(</span><span class="ident" id="4430498">pos</span>&nbsp;<span class="builtintype" id="4430502">int</span><span class="op" id="4430505">)</span>&nbsp;<span class="ident" id="4430507">syntax</span><span class="op" id="4430513">.</span><span class="ident" id="4430514">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="4430522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4430525">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4430556">type</span>&nbsp;<span class="ident" id="4430561">inputString</span>&nbsp;<span class="keyword" id="4430573">struct</span>&nbsp;<span class="op" id="4430580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430583">str</span>&nbsp;<span class="builtintype" id="4430587">string</span><br>
<span class="lineno"></span><span class="op" id="4430594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="4430597">func</span>&nbsp;<span class="op" id="4430602">(</span><span class="ident" id="4430603">i</span>&nbsp;<span class="op" id="4430605">*</span><span class="ident" id="4430606">inputString</span><span class="op" id="4430617">)</span>&nbsp;<span class="ident" id="4430619">step</span><span class="op" id="4430623">(</span><span class="ident" id="4430624">pos</span>&nbsp;<span class="builtintype" id="4430628">int</span><span class="op" id="4430631">)</span>&nbsp;<span class="op" id="4430633">(</span><span class="builtintype" id="4430634">rune</span><span class="op" id="4430638">,</span>&nbsp;<span class="builtintype" id="4430640">int</span><span class="op" id="4430643">)</span>&nbsp;<span class="op" id="4430645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430648">if</span>&nbsp;<span class="ident" id="4430651">pos</span>&nbsp;<span class="op" id="4430655">&lt;</span>&nbsp;<span class="builtinfunc" id="4430657">len</span><span class="op" id="4430660">(</span><span class="ident" id="4430661">i</span><span class="op" id="4430662">.</span><span class="ident" id="4430663">str</span><span class="op" id="4430666">)</span>&nbsp;<span class="op" id="4430668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430672">c</span>&nbsp;<span class="op" id="4430674">:=</span>&nbsp;<span class="ident" id="4430677">i</span><span class="op" id="4430678">.</span><span class="ident" id="4430679">str</span><span class="op" id="4430682">[</span><span class="ident" id="4430683">pos</span><span class="op" id="4430686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430690">if</span>&nbsp;<span class="ident" id="4430693">c</span>&nbsp;<span class="op" id="4430695">&lt;</span>&nbsp;<span class="ident" id="4430697">utf8</span><span class="op" id="4430701">.</span><span class="ident" id="4430702">RuneSelf</span>&nbsp;<span class="op" id="4430711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430716">return</span>&nbsp;<span class="builtintype" id="4430723">rune</span><span class="op" id="4430727">(</span><span class="ident" id="4430728">c</span><span class="op" id="4430729">)</span><span class="op" id="4430730">,</span>&nbsp;<span class="num" id="4430732">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430740">return</span>&nbsp;<span class="ident" id="4430747">utf8</span><span class="op" id="4430751">.</span><span class="ident" id="4430752">DecodeRuneInString</span><span class="op" id="4430770">(</span><span class="ident" id="4430771">i</span><span class="op" id="4430772">.</span><span class="ident" id="4430773">str</span><span class="op" id="4430776">[</span><span class="ident" id="4430777">pos</span><span class="op" id="4430780">:</span><span class="op" id="4430781">]</span><span class="op" id="4430782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430788">return</span>&nbsp;<span class="ident" id="4430795">endOfText</span><span class="op" id="4430804">,</span>&nbsp;<span class="num" id="4430806">0</span><br>
<span class="lineno"></span><span class="op" id="4430808">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="4430811">func</span>&nbsp;<span class="op" id="4430816">(</span><span class="ident" id="4430817">i</span>&nbsp;<span class="op" id="4430819">*</span><span class="ident" id="4430820">inputString</span><span class="op" id="4430831">)</span>&nbsp;<span class="ident" id="4430833">canCheckPrefix</span><span class="op" id="4430847">(</span><span class="op" id="4430848">)</span>&nbsp;<span class="builtintype" id="4430850">bool</span>&nbsp;<span class="op" id="4430855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430858">return</span>&nbsp;<span class="builtintype" id="4430865">true</span><br>
<span class="lineno"></span><span class="op" id="4430870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4430873">func</span>&nbsp;<span class="op" id="4430878">(</span><span class="ident" id="4430879">i</span>&nbsp;<span class="op" id="4430881">*</span><span class="ident" id="4430882">inputString</span><span class="op" id="4430893">)</span>&nbsp;<span class="ident" id="4430895">hasPrefix</span><span class="op" id="4430904">(</span><span class="ident" id="4430905">re</span>&nbsp;<span class="op" id="4430908">*</span><span class="ident" id="4430909">Regexp</span><span class="op" id="4430915">)</span>&nbsp;<span class="builtintype" id="4430917">bool</span>&nbsp;<span class="op" id="4430922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430925">return</span>&nbsp;<span class="ident" id="4430932">strings</span><span class="op" id="4430939">.</span><span class="ident" id="4430940">HasPrefix</span><span class="op" id="4430949">(</span><span class="ident" id="4430950">i</span><span class="op" id="4430951">.</span><span class="ident" id="4430952">str</span><span class="op" id="4430955">,</span>&nbsp;<span class="ident" id="4430957">re</span><span class="op" id="4430959">.</span><span class="ident" id="4430960">prefix</span><span class="op" id="4430966">)</span><br>
<span class="lineno"></span><span class="op" id="4430968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4430971">func</span>&nbsp;<span class="op" id="4430976">(</span><span class="ident" id="4430977">i</span>&nbsp;<span class="op" id="4430979">*</span><span class="ident" id="4430980">inputString</span><span class="op" id="4430991">)</span>&nbsp;<span class="ident" id="4430993">index</span><span class="op" id="4430998">(</span><span class="ident" id="4430999">re</span>&nbsp;<span class="op" id="4431002">*</span><span class="ident" id="4431003">Regexp</span><span class="op" id="4431009">,</span>&nbsp;<span class="ident" id="4431011">pos</span>&nbsp;<span class="builtintype" id="4431015">int</span><span class="op" id="4431018">)</span>&nbsp;<span class="builtintype" id="4431020">int</span>&nbsp;<span class="op" id="4431024">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431027">return</span>&nbsp;<span class="ident" id="4431034">strings</span><span class="op" id="4431041">.</span><span class="ident" id="4431042">Index</span><span class="op" id="4431047">(</span><span class="ident" id="4431048">i</span><span class="op" id="4431049">.</span><span class="ident" id="4431050">str</span><span class="op" id="4431053">[</span><span class="ident" id="4431054">pos</span><span class="op" id="4431057">:</span><span class="op" id="4431058">]</span><span class="op" id="4431059">,</span>&nbsp;<span class="ident" id="4431061">re</span><span class="op" id="4431063">.</span><span class="ident" id="4431064">prefix</span><span class="op" id="4431070">)</span><br>
<span class="lineno"></span><span class="op" id="4431072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431075">func</span>&nbsp;<span class="op" id="4431080">(</span><span class="ident" id="4431081">i</span>&nbsp;<span class="op" id="4431083">*</span><span class="ident" id="4431084">inputString</span><span class="op" id="4431095">)</span>&nbsp;<span class="ident" id="4431097">context</span><span class="op" id="4431104">(</span><span class="ident" id="4431105">pos</span>&nbsp;<span class="builtintype" id="4431109">int</span><span class="op" id="4431112">)</span>&nbsp;<span class="ident" id="4431114">syntax</span><span class="op" id="4431120">.</span><span class="ident" id="4431121">EmptyOp</span>&nbsp;<span class="op" id="4431129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431132">r1</span><span class="op" id="4431134">,</span>&nbsp;<span class="ident" id="4431136">r2</span>&nbsp;<span class="op" id="4431139">:=</span>&nbsp;<span class="ident" id="4431142">endOfText</span><span class="op" id="4431151">,</span>&nbsp;<span class="ident" id="4431153">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431164">if</span>&nbsp;<span class="ident" id="4431167">pos</span>&nbsp;<span class="op" id="4431171">&gt;</span>&nbsp;<span class="num" id="4431173">0</span>&nbsp;<span class="op" id="4431175">&amp;&amp;</span>&nbsp;<span class="ident" id="4431178">pos</span>&nbsp;<span class="op" id="4431182">&lt;=</span>&nbsp;<span class="builtinfunc" id="4431185">len</span><span class="op" id="4431188">(</span><span class="ident" id="4431189">i</span><span class="op" id="4431190">.</span><span class="ident" id="4431191">str</span><span class="op" id="4431194">)</span>&nbsp;<span class="op" id="4431196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431200">r1</span><span class="op" id="4431202">,</span>&nbsp;<span class="ident" id="4431204">_</span>&nbsp;<span class="op" id="4431206">=</span>&nbsp;<span class="ident" id="4431208">utf8</span><span class="op" id="4431212">.</span><span class="ident" id="4431213">DecodeLastRuneInString</span><span class="op" id="4431235">(</span><span class="ident" id="4431236">i</span><span class="op" id="4431237">.</span><span class="ident" id="4431238">str</span><span class="op" id="4431241">[</span><span class="op" id="4431242">:</span><span class="ident" id="4431243">pos</span><span class="op" id="4431246">]</span><span class="op" id="4431247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431253">if</span>&nbsp;<span class="ident" id="4431256">pos</span>&nbsp;<span class="op" id="4431260">&lt;</span>&nbsp;<span class="builtinfunc" id="4431262">len</span><span class="op" id="4431265">(</span><span class="ident" id="4431266">i</span><span class="op" id="4431267">.</span><span class="ident" id="4431268">str</span><span class="op" id="4431271">)</span>&nbsp;<span class="op" id="4431273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431277">r2</span><span class="op" id="4431279">,</span>&nbsp;<span class="ident" id="4431281">_</span>&nbsp;<span class="op" id="4431283">=</span>&nbsp;<span class="ident" id="4431285">utf8</span><span class="op" id="4431289">.</span><span class="ident" id="4431290">DecodeRuneInString</span><span class="op" id="4431308">(</span><span class="ident" id="4431309">i</span><span class="op" id="4431310">.</span><span class="ident" id="4431311">str</span><span class="op" id="4431314">[</span><span class="ident" id="4431315">pos</span><span class="op" id="4431318">:</span><span class="op" id="4431319">]</span><span class="op" id="4431320">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431326">return</span>&nbsp;<span class="ident" id="4431333">syntax</span><span class="op" id="4431339">.</span><span class="ident" id="4431340">EmptyOpContext</span><span class="op" id="4431354">(</span><span class="ident" id="4431355">r1</span><span class="op" id="4431357">,</span>&nbsp;<span class="ident" id="4431359">r2</span><span class="op" id="4431361">)</span><br>
<span class="lineno"></span><span class="op" id="4431363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431366">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="4431400">type</span>&nbsp;<span class="ident" id="4431405">inputBytes</span>&nbsp;<span class="keyword" id="4431416">struct</span>&nbsp;<span class="op" id="4431423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431426">str</span>&nbsp;<span class="op" id="4431430">[</span><span class="op" id="4431431">]</span><span class="builtintype" id="4431432">byte</span><br>
<span class="lineno"></span><span class="op" id="4431437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431440">func</span>&nbsp;<span class="op" id="4431445">(</span><span class="ident" id="4431446">i</span>&nbsp;<span class="op" id="4431448">*</span><span class="ident" id="4431449">inputBytes</span><span class="op" id="4431459">)</span>&nbsp;<span class="ident" id="4431461">step</span><span class="op" id="4431465">(</span><span class="ident" id="4431466">pos</span>&nbsp;<span class="builtintype" id="4431470">int</span><span class="op" id="4431473">)</span>&nbsp;<span class="op" id="4431475">(</span><span class="builtintype" id="4431476">rune</span><span class="op" id="4431480">,</span>&nbsp;<span class="builtintype" id="4431482">int</span><span class="op" id="4431485">)</span>&nbsp;<span class="op" id="4431487">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431490">if</span>&nbsp;<span class="ident" id="4431493">pos</span>&nbsp;<span class="op" id="4431497">&lt;</span>&nbsp;<span class="builtinfunc" id="4431499">len</span><span class="op" id="4431502">(</span><span class="ident" id="4431503">i</span><span class="op" id="4431504">.</span><span class="ident" id="4431505">str</span><span class="op" id="4431508">)</span>&nbsp;<span class="op" id="4431510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431514">c</span>&nbsp;<span class="op" id="4431516">:=</span>&nbsp;<span class="ident" id="4431519">i</span><span class="op" id="4431520">.</span><span class="ident" id="4431521">str</span><span class="op" id="4431524">[</span><span class="ident" id="4431525">pos</span><span class="op" id="4431528">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431532">if</span>&nbsp;<span class="ident" id="4431535">c</span>&nbsp;<span class="op" id="4431537">&lt;</span>&nbsp;<span class="ident" id="4431539">utf8</span><span class="op" id="4431543">.</span><span class="ident" id="4431544">RuneSelf</span>&nbsp;<span class="op" id="4431553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431558">return</span>&nbsp;<span class="builtintype" id="4431565">rune</span><span class="op" id="4431569">(</span><span class="ident" id="4431570">c</span><span class="op" id="4431571">)</span><span class="op" id="4431572">,</span>&nbsp;<span class="num" id="4431574">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431578">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431582">return</span>&nbsp;<span class="ident" id="4431589">utf8</span><span class="op" id="4431593">.</span><span class="ident" id="4431594">DecodeRune</span><span class="op" id="4431604">(</span><span class="ident" id="4431605">i</span><span class="op" id="4431606">.</span><span class="ident" id="4431607">str</span><span class="op" id="4431610">[</span><span class="ident" id="4431611">pos</span><span class="op" id="4431614">:</span><span class="op" id="4431615">]</span><span class="op" id="4431616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431622">return</span>&nbsp;<span class="ident" id="4431629">endOfText</span><span class="op" id="4431638">,</span>&nbsp;<span class="num" id="4431640">0</span><br>
<span class="lineno"></span><span class="op" id="4431642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="4431645">func</span>&nbsp;<span class="op" id="4431650">(</span><span class="ident" id="4431651">i</span>&nbsp;<span class="op" id="4431653">*</span><span class="ident" id="4431654">inputBytes</span><span class="op" id="4431664">)</span>&nbsp;<span class="ident" id="4431666">canCheckPrefix</span><span class="op" id="4431680">(</span><span class="op" id="4431681">)</span>&nbsp;<span class="builtintype" id="4431683">bool</span>&nbsp;<span class="op" id="4431688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431691">return</span>&nbsp;<span class="builtintype" id="4431698">true</span><br>
<span class="lineno"></span><span class="op" id="4431703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431706">func</span>&nbsp;<span class="op" id="4431711">(</span><span class="ident" id="4431712">i</span>&nbsp;<span class="op" id="4431714">*</span><span class="ident" id="4431715">inputBytes</span><span class="op" id="4431725">)</span>&nbsp;<span class="ident" id="4431727">hasPrefix</span><span class="op" id="4431736">(</span><span class="ident" id="4431737">re</span>&nbsp;<span class="op" id="4431740">*</span><span class="ident" id="4431741">Regexp</span><span class="op" id="4431747">)</span>&nbsp;<span class="builtintype" id="4431749">bool</span>&nbsp;<span class="op" id="4431754">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431757">return</span>&nbsp;<span class="ident" id="4431764">bytes</span><span class="op" id="4431769">.</span><span class="ident" id="4431770">HasPrefix</span><span class="op" id="4431779">(</span><span class="ident" id="4431780">i</span><span class="op" id="4431781">.</span><span class="ident" id="4431782">str</span><span class="op" id="4431785">,</span>&nbsp;<span class="ident" id="4431787">re</span><span class="op" id="4431789">.</span><span class="ident" id="4431790">prefixBytes</span><span class="op" id="4431801">)</span><br>
<span class="lineno"></span><span class="op" id="4431803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431806">func</span>&nbsp;<span class="op" id="4431811">(</span><span class="ident" id="4431812">i</span>&nbsp;<span class="op" id="4431814">*</span><span class="ident" id="4431815">inputBytes</span><span class="op" id="4431825">)</span>&nbsp;<span class="ident" id="4431827">index</span><span class="op" id="4431832">(</span><span class="ident" id="4431833">re</span>&nbsp;<span class="op" id="4431836">*</span><span class="ident" id="4431837">Regexp</span><span class="op" id="4431843">,</span>&nbsp;<span class="ident" id="4431845">pos</span>&nbsp;<span class="builtintype" id="4431849">int</span><span class="op" id="4431852">)</span>&nbsp;<span class="builtintype" id="4431854">int</span>&nbsp;<span class="op" id="4431858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431861">return</span>&nbsp;<span class="ident" id="4431868">bytes</span><span class="op" id="4431873">.</span><span class="ident" id="4431874">Index</span><span class="op" id="4431879">(</span><span class="ident" id="4431880">i</span><span class="op" id="4431881">.</span><span class="ident" id="4431882">str</span><span class="op" id="4431885">[</span><span class="ident" id="4431886">pos</span><span class="op" id="4431889">:</span><span class="op" id="4431890">]</span><span class="op" id="4431891">,</span>&nbsp;<span class="ident" id="4431893">re</span><span class="op" id="4431895">.</span><span class="ident" id="4431896">prefixBytes</span><span class="op" id="4431907">)</span><br>
<span class="lineno">335</span><span class="op" id="4431909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431912">func</span>&nbsp;<span class="op" id="4431917">(</span><span class="ident" id="4431918">i</span>&nbsp;<span class="op" id="4431920">*</span><span class="ident" id="4431921">inputBytes</span><span class="op" id="4431931">)</span>&nbsp;<span class="ident" id="4431933">context</span><span class="op" id="4431940">(</span><span class="ident" id="4431941">pos</span>&nbsp;<span class="builtintype" id="4431945">int</span><span class="op" id="4431948">)</span>&nbsp;<span class="ident" id="4431950">syntax</span><span class="op" id="4431956">.</span><span class="ident" id="4431957">EmptyOp</span>&nbsp;<span class="op" id="4431965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431968">r1</span><span class="op" id="4431970">,</span>&nbsp;<span class="ident" id="4431972">r2</span>&nbsp;<span class="op" id="4431975">:=</span>&nbsp;<span class="ident" id="4431978">endOfText</span><span class="op" id="4431987">,</span>&nbsp;<span class="ident" id="4431989">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432000">if</span>&nbsp;<span class="ident" id="4432003">pos</span>&nbsp;<span class="op" id="4432007">&gt;</span>&nbsp;<span class="num" id="4432009">0</span>&nbsp;<span class="op" id="4432011">&amp;&amp;</span>&nbsp;<span class="ident" id="4432014">pos</span>&nbsp;<span class="op" id="4432018">&lt;=</span>&nbsp;<span class="builtinfunc" id="4432021">len</span><span class="op" id="4432024">(</span><span class="ident" id="4432025">i</span><span class="op" id="4432026">.</span><span class="ident" id="4432027">str</span><span class="op" id="4432030">)</span>&nbsp;<span class="op" id="4432032">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432036">r1</span><span class="op" id="4432038">,</span>&nbsp;<span class="ident" id="4432040">_</span>&nbsp;<span class="op" id="4432042">=</span>&nbsp;<span class="ident" id="4432044">utf8</span><span class="op" id="4432048">.</span><span class="ident" id="4432049">DecodeLastRune</span><span class="op" id="4432063">(</span><span class="ident" id="4432064">i</span><span class="op" id="4432065">.</span><span class="ident" id="4432066">str</span><span class="op" id="4432069">[</span><span class="op" id="4432070">:</span><span class="ident" id="4432071">pos</span><span class="op" id="4432074">]</span><span class="op" id="4432075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432081">if</span>&nbsp;<span class="ident" id="4432084">pos</span>&nbsp;<span class="op" id="4432088">&lt;</span>&nbsp;<span class="builtinfunc" id="4432090">len</span><span class="op" id="4432093">(</span><span class="ident" id="4432094">i</span><span class="op" id="4432095">.</span><span class="ident" id="4432096">str</span><span class="op" id="4432099">)</span>&nbsp;<span class="op" id="4432101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432105">r2</span><span class="op" id="4432107">,</span>&nbsp;<span class="ident" id="4432109">_</span>&nbsp;<span class="op" id="4432111">=</span>&nbsp;<span class="ident" id="4432113">utf8</span><span class="op" id="4432117">.</span><span class="ident" id="4432118">DecodeRune</span><span class="op" id="4432128">(</span><span class="ident" id="4432129">i</span><span class="op" id="4432130">.</span><span class="ident" id="4432131">str</span><span class="op" id="4432134">[</span><span class="ident" id="4432135">pos</span><span class="op" id="4432138">:</span><span class="op" id="4432139">]</span><span class="op" id="4432140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432143">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432146">return</span>&nbsp;<span class="ident" id="4432153">syntax</span><span class="op" id="4432159">.</span><span class="ident" id="4432160">EmptyOpContext</span><span class="op" id="4432174">(</span><span class="ident" id="4432175">r1</span><span class="op" id="4432177">,</span>&nbsp;<span class="ident" id="4432179">r2</span><span class="op" id="4432181">)</span><br>
<span class="lineno"></span><span class="op" id="4432183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4432186">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="4432221">type</span>&nbsp;<span class="ident" id="4432226">inputReader</span>&nbsp;<span class="keyword" id="4432238">struct</span>&nbsp;<span class="op" id="4432245">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432248">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4432254">io</span><span class="op" id="4432256">.</span><span class="ident" id="4432257">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432269">atEOT</span>&nbsp;<span class="builtintype" id="4432275">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432281">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4432287">int</span><br>
<span class="lineno"></span><span class="op" id="4432291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4432294">func</span>&nbsp;<span class="op" id="4432299">(</span><span class="ident" id="4432300">i</span>&nbsp;<span class="op" id="4432302">*</span><span class="ident" id="4432303">inputReader</span><span class="op" id="4432314">)</span>&nbsp;<span class="ident" id="4432316">step</span><span class="op" id="4432320">(</span><span class="ident" id="4432321">pos</span>&nbsp;<span class="builtintype" id="4432325">int</span><span class="op" id="4432328">)</span>&nbsp;<span class="op" id="4432330">(</span><span class="builtintype" id="4432331">rune</span><span class="op" id="4432335">,</span>&nbsp;<span class="builtintype" id="4432337">int</span><span class="op" id="4432340">)</span>&nbsp;<span class="op" id="4432342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432345">if</span>&nbsp;<span class="op" id="4432348">!</span><span class="ident" id="4432349">i</span><span class="op" id="4432350">.</span><span class="ident" id="4432351">atEOT</span>&nbsp;<span class="op" id="4432357">&amp;&amp;</span>&nbsp;<span class="ident" id="4432360">pos</span>&nbsp;<span class="op" id="4432364">!=</span>&nbsp;<span class="ident" id="4432367">i</span><span class="op" id="4432368">.</span><span class="ident" id="4432369">pos</span>&nbsp;<span class="op" id="4432373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432377">return</span>&nbsp;<span class="ident" id="4432384">endOfText</span><span class="op" id="4432393">,</span>&nbsp;<span class="num" id="4432395">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432399">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432402">r</span><span class="op" id="4432403">,</span>&nbsp;<span class="ident" id="4432405">w</span><span class="op" id="4432406">,</span>&nbsp;<span class="ident" id="4432408">err</span>&nbsp;<span class="op" id="4432412">:=</span>&nbsp;<span class="ident" id="4432415">i</span><span class="op" id="4432416">.</span><span class="ident" id="4432417">r</span><span class="op" id="4432418">.</span><span class="ident" id="4432419">ReadRune</span><span class="op" id="4432427">(</span><span class="op" id="4432428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432431">if</span>&nbsp;<span class="ident" id="4432434">err</span>&nbsp;<span class="op" id="4432438">!=</span>&nbsp;<span class="ident" id="4432441">nil</span>&nbsp;<span class="op" id="4432445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432449">i</span><span class="op" id="4432450">.</span><span class="ident" id="4432451">atEOT</span>&nbsp;<span class="op" id="4432457">=</span>&nbsp;<span class="builtintype" id="4432459">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432466">return</span>&nbsp;<span class="ident" id="4432473">endOfText</span><span class="op" id="4432482">,</span>&nbsp;<span class="num" id="4432484">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432487">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432490">i</span><span class="op" id="4432491">.</span><span class="ident" id="4432492">pos</span>&nbsp;<span class="op" id="4432496">+=</span>&nbsp;<span class="ident" id="4432499">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432502">return</span>&nbsp;<span class="ident" id="4432509">r</span><span class="op" id="4432510">,</span>&nbsp;<span class="ident" id="4432512">w</span><br>
<span class="lineno"></span><span class="op" id="4432514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4432517">func</span>&nbsp;<span class="op" id="4432522">(</span><span class="ident" id="4432523">i</span>&nbsp;<span class="op" id="4432525">*</span><span class="ident" id="4432526">inputReader</span><span class="op" id="4432537">)</span>&nbsp;<span class="ident" id="4432539">canCheckPrefix</span><span class="op" id="4432553">(</span><span class="op" id="4432554">)</span>&nbsp;<span class="builtintype" id="4432556">bool</span>&nbsp;<span class="op" id="4432561">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432564">return</span>&nbsp;<span class="builtintype" id="4432571">false</span><br>
<span class="lineno"></span><span class="op" id="4432577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4432580">func</span>&nbsp;<span class="op" id="4432585">(</span><span class="ident" id="4432586">i</span>&nbsp;<span class="op" id="4432588">*</span><span class="ident" id="4432589">inputReader</span><span class="op" id="4432600">)</span>&nbsp;<span class="ident" id="4432602">hasPrefix</span><span class="op" id="4432611">(</span><span class="ident" id="4432612">re</span>&nbsp;<span class="op" id="4432615">*</span><span class="ident" id="4432616">Regexp</span><span class="op" id="4432622">)</span>&nbsp;<span class="builtintype" id="4432624">bool</span>&nbsp;<span class="op" id="4432629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432632">return</span>&nbsp;<span class="builtintype" id="4432639">false</span><br>
<span class="lineno">375</span><span class="op" id="4432645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4432648">func</span>&nbsp;<span class="op" id="4432653">(</span><span class="ident" id="4432654">i</span>&nbsp;<span class="op" id="4432656">*</span><span class="ident" id="4432657">inputReader</span><span class="op" id="4432668">)</span>&nbsp;<span class="ident" id="4432670">index</span><span class="op" id="4432675">(</span><span class="ident" id="4432676">re</span>&nbsp;<span class="op" id="4432679">*</span><span class="ident" id="4432680">Regexp</span><span class="op" id="4432686">,</span>&nbsp;<span class="ident" id="4432688">pos</span>&nbsp;<span class="builtintype" id="4432692">int</span><span class="op" id="4432695">)</span>&nbsp;<span class="builtintype" id="4432697">int</span>&nbsp;<span class="op" id="4432701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432704">return</span>&nbsp;<span class="op" id="4432711">-</span><span class="num" id="4432712">1</span><br>
<span class="lineno"></span><span class="op" id="4432714">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="4432717">func</span>&nbsp;<span class="op" id="4432722">(</span><span class="ident" id="4432723">i</span>&nbsp;<span class="op" id="4432725">*</span><span class="ident" id="4432726">inputReader</span><span class="op" id="4432737">)</span>&nbsp;<span class="ident" id="4432739">context</span><span class="op" id="4432746">(</span><span class="ident" id="4432747">pos</span>&nbsp;<span class="builtintype" id="4432751">int</span><span class="op" id="4432754">)</span>&nbsp;<span class="ident" id="4432756">syntax</span><span class="op" id="4432762">.</span><span class="ident" id="4432763">EmptyOp</span>&nbsp;<span class="op" id="4432771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432774">return</span>&nbsp;<span class="num" id="4432781">0</span><br>
<span class="lineno"></span><span class="op" id="4432783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4432786">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="4432854">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4432923">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="4432982">func</span>&nbsp;<span class="op" id="4432987">(</span><span class="ident" id="4432988">re</span>&nbsp;<span class="op" id="4432991">*</span><span class="ident" id="4432992">Regexp</span><span class="op" id="4432998">)</span>&nbsp;<span class="ident" id="4433000">LiteralPrefix</span><span class="op" id="4433013">(</span><span class="op" id="4433014">)</span>&nbsp;<span class="op" id="4433016">(</span><span class="ident" id="4433017">prefix</span>&nbsp;<span class="builtintype" id="4433024">string</span><span class="op" id="4433030">,</span>&nbsp;<span class="ident" id="4433032">complete</span>&nbsp;<span class="builtintype" id="4433041">bool</span><span class="op" id="4433045">)</span>&nbsp;<span class="op" id="4433047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433050">return</span>&nbsp;<span class="ident" id="4433057">re</span><span class="op" id="4433059">.</span><span class="ident" id="4433060">prefix</span><span class="op" id="4433066">,</span>&nbsp;<span class="ident" id="4433068">re</span><span class="op" id="4433070">.</span><span class="ident" id="4433071">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="4433086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433089">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4433160">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="4433175">func</span>&nbsp;<span class="op" id="4433180">(</span><span class="ident" id="4433181">re</span>&nbsp;<span class="op" id="4433184">*</span><span class="ident" id="4433185">Regexp</span><span class="op" id="4433191">)</span>&nbsp;<span class="ident" id="4433193">MatchReader</span><span class="op" id="4433204">(</span><span class="ident" id="4433205">r</span>&nbsp;<span class="ident" id="4433207">io</span><span class="op" id="4433209">.</span><span class="ident" id="4433210">RuneReader</span><span class="op" id="4433220">)</span>&nbsp;<span class="builtintype" id="4433222">bool</span>&nbsp;<span class="op" id="4433227">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433230">return</span>&nbsp;<span class="ident" id="4433237">re</span><span class="op" id="4433239">.</span><span class="ident" id="4433240">doExecute</span><span class="op" id="4433249">(</span><span class="ident" id="4433250">r</span><span class="op" id="4433251">,</span>&nbsp;<span class="ident" id="4433253">nil</span><span class="op" id="4433256">,</span>&nbsp;<span class="string" id="4433258">&#34;&#34;</span><span class="op" id="4433260">,</span>&nbsp;<span class="num" id="4433262">0</span><span class="op" id="4433263">,</span>&nbsp;<span class="num" id="4433265">0</span><span class="op" id="4433266">)</span>&nbsp;<span class="op" id="4433268">!=</span>&nbsp;<span class="ident" id="4433271">nil</span><br>
<span class="lineno"></span><span class="op" id="4433275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433278">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4433342">func</span>&nbsp;<span class="op" id="4433347">(</span><span class="ident" id="4433348">re</span>&nbsp;<span class="op" id="4433351">*</span><span class="ident" id="4433352">Regexp</span><span class="op" id="4433358">)</span>&nbsp;<span class="ident" id="4433360">MatchString</span><span class="op" id="4433371">(</span><span class="ident" id="4433372">s</span>&nbsp;<span class="builtintype" id="4433374">string</span><span class="op" id="4433380">)</span>&nbsp;<span class="builtintype" id="4433382">bool</span>&nbsp;<span class="op" id="4433387">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433390">return</span>&nbsp;<span class="ident" id="4433397">re</span><span class="op" id="4433399">.</span><span class="ident" id="4433400">doExecute</span><span class="op" id="4433409">(</span><span class="ident" id="4433410">nil</span><span class="op" id="4433413">,</span>&nbsp;<span class="ident" id="4433415">nil</span><span class="op" id="4433418">,</span>&nbsp;<span class="ident" id="4433420">s</span><span class="op" id="4433421">,</span>&nbsp;<span class="num" id="4433423">0</span><span class="op" id="4433424">,</span>&nbsp;<span class="num" id="4433426">0</span><span class="op" id="4433427">)</span>&nbsp;<span class="op" id="4433429">!=</span>&nbsp;<span class="ident" id="4433432">nil</span><br>
<span class="lineno"></span><span class="op" id="4433436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433439">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4433501">func</span>&nbsp;<span class="op" id="4433506">(</span><span class="ident" id="4433507">re</span>&nbsp;<span class="op" id="4433510">*</span><span class="ident" id="4433511">Regexp</span><span class="op" id="4433517">)</span>&nbsp;<span class="ident" id="4433519">Match</span><span class="op" id="4433524">(</span><span class="ident" id="4433525">b</span>&nbsp;<span class="op" id="4433527">[</span><span class="op" id="4433528">]</span><span class="builtintype" id="4433529">byte</span><span class="op" id="4433533">)</span>&nbsp;<span class="builtintype" id="4433535">bool</span>&nbsp;<span class="op" id="4433540">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433543">return</span>&nbsp;<span class="ident" id="4433550">re</span><span class="op" id="4433552">.</span><span class="ident" id="4433553">doExecute</span><span class="op" id="4433562">(</span><span class="ident" id="4433563">nil</span><span class="op" id="4433566">,</span>&nbsp;<span class="ident" id="4433568">b</span><span class="op" id="4433569">,</span>&nbsp;<span class="string" id="4433571">&#34;&#34;</span><span class="op" id="4433573">,</span>&nbsp;<span class="num" id="4433575">0</span><span class="op" id="4433576">,</span>&nbsp;<span class="num" id="4433578">0</span><span class="op" id="4433579">)</span>&nbsp;<span class="op" id="4433581">!=</span>&nbsp;<span class="ident" id="4433584">nil</span><br>
<span class="lineno"></span><span class="op" id="4433588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433591">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="4433667">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="4433744">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4433774">func</span>&nbsp;<span class="ident" id="4433779">MatchReader</span><span class="op" id="4433790">(</span><span class="ident" id="4433791">pattern</span>&nbsp;<span class="builtintype" id="4433799">string</span><span class="op" id="4433805">,</span>&nbsp;<span class="ident" id="4433807">r</span>&nbsp;<span class="ident" id="4433809">io</span><span class="op" id="4433811">.</span><span class="ident" id="4433812">RuneReader</span><span class="op" id="4433822">)</span>&nbsp;<span class="op" id="4433824">(</span><span class="ident" id="4433825">matched</span>&nbsp;<span class="builtintype" id="4433833">bool</span><span class="op" id="4433837">,</span>&nbsp;<span class="ident" id="4433839">err</span>&nbsp;<span class="builtintype" id="4433843">error</span><span class="op" id="4433848">)</span>&nbsp;<span class="op" id="4433850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433853">re</span><span class="op" id="4433855">,</span>&nbsp;<span class="ident" id="4433857">err</span>&nbsp;<span class="op" id="4433861">:=</span>&nbsp;<span class="ident" id="4433864">Compile</span><span class="op" id="4433871">(</span><span class="ident" id="4433872">pattern</span><span class="op" id="4433879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433882">if</span>&nbsp;<span class="ident" id="4433885">err</span>&nbsp;<span class="op" id="4433889">!=</span>&nbsp;<span class="ident" id="4433892">nil</span>&nbsp;<span class="op" id="4433896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433900">return</span>&nbsp;<span class="builtintype" id="4433907">false</span><span class="op" id="4433912">,</span>&nbsp;<span class="ident" id="4433914">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433922">return</span>&nbsp;<span class="ident" id="4433929">re</span><span class="op" id="4433931">.</span><span class="ident" id="4433932">MatchReader</span><span class="op" id="4433943">(</span><span class="ident" id="4433944">r</span><span class="op" id="4433945">)</span><span class="op" id="4433946">,</span>&nbsp;<span class="ident" id="4433948">nil</span><br>
<span class="lineno"></span><span class="op" id="4433952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433955">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="4434014">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="4434066">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4434115">func</span>&nbsp;<span class="ident" id="4434120">MatchString</span><span class="op" id="4434131">(</span><span class="ident" id="4434132">pattern</span>&nbsp;<span class="builtintype" id="4434140">string</span><span class="op" id="4434146">,</span>&nbsp;<span class="ident" id="4434148">s</span>&nbsp;<span class="builtintype" id="4434150">string</span><span class="op" id="4434156">)</span>&nbsp;<span class="op" id="4434158">(</span><span class="ident" id="4434159">matched</span>&nbsp;<span class="builtintype" id="4434167">bool</span><span class="op" id="4434171">,</span>&nbsp;<span class="ident" id="4434173">err</span>&nbsp;<span class="builtintype" id="4434177">error</span><span class="op" id="4434182">)</span>&nbsp;<span class="op" id="4434184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434187">re</span><span class="op" id="4434189">,</span>&nbsp;<span class="ident" id="4434191">err</span>&nbsp;<span class="op" id="4434195">:=</span>&nbsp;<span class="ident" id="4434198">Compile</span><span class="op" id="4434205">(</span><span class="ident" id="4434206">pattern</span><span class="op" id="4434213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434216">if</span>&nbsp;<span class="ident" id="4434219">err</span>&nbsp;<span class="op" id="4434223">!=</span>&nbsp;<span class="ident" id="4434226">nil</span>&nbsp;<span class="op" id="4434230">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434234">return</span>&nbsp;<span class="builtintype" id="4434241">false</span><span class="op" id="4434246">,</span>&nbsp;<span class="ident" id="4434248">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434256">return</span>&nbsp;<span class="ident" id="4434263">re</span><span class="op" id="4434265">.</span><span class="ident" id="4434266">MatchString</span><span class="op" id="4434277">(</span><span class="ident" id="4434278">s</span><span class="op" id="4434279">)</span><span class="op" id="4434280">,</span>&nbsp;<span class="ident" id="4434282">nil</span><br>
<span class="lineno"></span><span class="op" id="4434286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="4434289">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="4434342">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="4434398">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4434447">func</span>&nbsp;<span class="ident" id="4434452">Match</span><span class="op" id="4434457">(</span><span class="ident" id="4434458">pattern</span>&nbsp;<span class="builtintype" id="4434466">string</span><span class="op" id="4434472">,</span>&nbsp;<span class="ident" id="4434474">b</span>&nbsp;<span class="op" id="4434476">[</span><span class="op" id="4434477">]</span><span class="builtintype" id="4434478">byte</span><span class="op" id="4434482">)</span>&nbsp;<span class="op" id="4434484">(</span><span class="ident" id="4434485">matched</span>&nbsp;<span class="builtintype" id="4434493">bool</span><span class="op" id="4434497">,</span>&nbsp;<span class="ident" id="4434499">err</span>&nbsp;<span class="builtintype" id="4434503">error</span><span class="op" id="4434508">)</span>&nbsp;<span class="op" id="4434510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434513">re</span><span class="op" id="4434515">,</span>&nbsp;<span class="ident" id="4434517">err</span>&nbsp;<span class="op" id="4434521">:=</span>&nbsp;<span class="ident" id="4434524">Compile</span><span class="op" id="4434531">(</span><span class="ident" id="4434532">pattern</span><span class="op" id="4434539">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434542">if</span>&nbsp;<span class="ident" id="4434545">err</span>&nbsp;<span class="op" id="4434549">!=</span>&nbsp;<span class="ident" id="4434552">nil</span>&nbsp;<span class="op" id="4434556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434560">return</span>&nbsp;<span class="builtintype" id="4434567">false</span><span class="op" id="4434572">,</span>&nbsp;<span class="ident" id="4434574">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434582">return</span>&nbsp;<span class="ident" id="4434589">re</span><span class="op" id="4434591">.</span><span class="ident" id="4434592">Match</span><span class="op" id="4434597">(</span><span class="ident" id="4434598">b</span><span class="op" id="4434599">)</span><span class="op" id="4434600">,</span>&nbsp;<span class="ident" id="4434602">nil</span><br>
<span class="lineno"></span><span class="op" id="4434606">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="4434609">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="4434684">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4434762">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4434838">func</span>&nbsp;<span class="op" id="4434843">(</span><span class="ident" id="4434844">re</span>&nbsp;<span class="op" id="4434847">*</span><span class="ident" id="4434848">Regexp</span><span class="op" id="4434854">)</span>&nbsp;<span class="ident" id="4434856">ReplaceAllString</span><span class="op" id="4434872">(</span><span class="ident" id="4434873">src</span><span class="op" id="4434876">,</span>&nbsp;<span class="ident" id="4434878">repl</span>&nbsp;<span class="builtintype" id="4434883">string</span><span class="op" id="4434889">)</span>&nbsp;<span class="builtintype" id="4434891">string</span>&nbsp;<span class="op" id="4434898">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434901">n</span>&nbsp;<span class="op" id="4434903">:=</span>&nbsp;<span class="num" id="4434906">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434909">if</span>&nbsp;<span class="ident" id="4434912">strings</span><span class="op" id="4434919">.</span><span class="ident" id="4434920">Index</span><span class="op" id="4434925">(</span><span class="ident" id="4434926">repl</span><span class="op" id="4434930">,</span>&nbsp;<span class="string" id="4434932">&#34;$&#34;</span><span class="op" id="4434935">)</span>&nbsp;<span class="op" id="4434937">&gt;=</span>&nbsp;<span class="num" id="4434940">0</span>&nbsp;<span class="op" id="4434942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434946">n</span>&nbsp;<span class="op" id="4434948">=</span>&nbsp;<span class="num" id="4434950">2</span>&nbsp;<span class="op" id="4434952">*</span>&nbsp;<span class="op" id="4434954">(</span><span class="ident" id="4434955">re</span><span class="op" id="4434957">.</span><span class="ident" id="4434958">numSubexp</span>&nbsp;<span class="op" id="4434968">+</span>&nbsp;<span class="num" id="4434970">1</span><span class="op" id="4434971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434977">b</span>&nbsp;<span class="op" id="4434979">:=</span>&nbsp;<span class="ident" id="4434982">re</span><span class="op" id="4434984">.</span><span class="ident" id="4434985">replaceAll</span><span class="op" id="4434995">(</span><span class="ident" id="4434996">nil</span><span class="op" id="4434999">,</span>&nbsp;<span class="ident" id="4435001">src</span><span class="op" id="4435004">,</span>&nbsp;<span class="ident" id="4435006">n</span><span class="op" id="4435007">,</span>&nbsp;<span class="keyword" id="4435009">func</span><span class="op" id="4435013">(</span><span class="ident" id="4435014">dst</span>&nbsp;<span class="op" id="4435018">[</span><span class="op" id="4435019">]</span><span class="builtintype" id="4435020">byte</span><span class="op" id="4435024">,</span>&nbsp;<span class="ident" id="4435026">match</span>&nbsp;<span class="op" id="4435032">[</span><span class="op" id="4435033">]</span><span class="builtintype" id="4435034">int</span><span class="op" id="4435037">)</span>&nbsp;<span class="op" id="4435039">[</span><span class="op" id="4435040">]</span><span class="builtintype" id="4435041">byte</span>&nbsp;<span class="op" id="4435046">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435050">return</span>&nbsp;<span class="ident" id="4435057">re</span><span class="op" id="4435059">.</span><span class="ident" id="4435060">expand</span><span class="op" id="4435066">(</span><span class="ident" id="4435067">dst</span><span class="op" id="4435070">,</span>&nbsp;<span class="ident" id="4435072">repl</span><span class="op" id="4435076">,</span>&nbsp;<span class="ident" id="4435078">nil</span><span class="op" id="4435081">,</span>&nbsp;<span class="ident" id="4435083">src</span><span class="op" id="4435086">,</span>&nbsp;<span class="ident" id="4435088">match</span><span class="op" id="4435093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435096">}</span><span class="op" id="4435097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435100">return</span>&nbsp;<span class="builtintype" id="4435107">string</span><span class="op" id="4435113">(</span><span class="ident" id="4435114">b</span><span class="op" id="4435115">)</span><br>
<span class="lineno"></span><span class="op" id="4435117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="4435120">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="4435202">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="4435286">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="4435311">func</span>&nbsp;<span class="op" id="4435316">(</span><span class="ident" id="4435317">re</span>&nbsp;<span class="op" id="4435320">*</span><span class="ident" id="4435321">Regexp</span><span class="op" id="4435327">)</span>&nbsp;<span class="ident" id="4435329">ReplaceAllLiteralString</span><span class="op" id="4435352">(</span><span class="ident" id="4435353">src</span><span class="op" id="4435356">,</span>&nbsp;<span class="ident" id="4435358">repl</span>&nbsp;<span class="builtintype" id="4435363">string</span><span class="op" id="4435369">)</span>&nbsp;<span class="builtintype" id="4435371">string</span>&nbsp;<span class="op" id="4435378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435381">return</span>&nbsp;<span class="builtintype" id="4435388">string</span><span class="op" id="4435394">(</span><span class="ident" id="4435395">re</span><span class="op" id="4435397">.</span><span class="ident" id="4435398">replaceAll</span><span class="op" id="4435408">(</span><span class="ident" id="4435409">nil</span><span class="op" id="4435412">,</span>&nbsp;<span class="ident" id="4435414">src</span><span class="op" id="4435417">,</span>&nbsp;<span class="num" id="4435419">2</span><span class="op" id="4435420">,</span>&nbsp;<span class="keyword" id="4435422">func</span><span class="op" id="4435426">(</span><span class="ident" id="4435427">dst</span>&nbsp;<span class="op" id="4435431">[</span><span class="op" id="4435432">]</span><span class="builtintype" id="4435433">byte</span><span class="op" id="4435437">,</span>&nbsp;<span class="ident" id="4435439">match</span>&nbsp;<span class="op" id="4435445">[</span><span class="op" id="4435446">]</span><span class="builtintype" id="4435447">int</span><span class="op" id="4435450">)</span>&nbsp;<span class="op" id="4435452">[</span><span class="op" id="4435453">]</span><span class="builtintype" id="4435454">byte</span>&nbsp;<span class="op" id="4435459">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435463">return</span>&nbsp;<span class="builtinfunc" id="4435470">append</span><span class="op" id="4435476">(</span><span class="ident" id="4435477">dst</span><span class="op" id="4435480">,</span>&nbsp;<span class="ident" id="4435482">repl</span><span class="op" id="4435486">...</span><span class="op" id="4435489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435492">}</span><span class="op" id="4435493">)</span><span class="op" id="4435494">)</span><br>
<span class="lineno"></span><span class="op" id="4435496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4435499">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="4435573">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="4435647">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="4435725">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="4435760">func</span>&nbsp;<span class="op" id="4435765">(</span><span class="ident" id="4435766">re</span>&nbsp;<span class="op" id="4435769">*</span><span class="ident" id="4435770">Regexp</span><span class="op" id="4435776">)</span>&nbsp;<span class="ident" id="4435778">ReplaceAllStringFunc</span><span class="op" id="4435798">(</span><span class="ident" id="4435799">src</span>&nbsp;<span class="builtintype" id="4435803">string</span><span class="op" id="4435809">,</span>&nbsp;<span class="ident" id="4435811">repl</span>&nbsp;<span class="keyword" id="4435816">func</span><span class="op" id="4435820">(</span><span class="builtintype" id="4435821">string</span><span class="op" id="4435827">)</span>&nbsp;<span class="builtintype" id="4435829">string</span><span class="op" id="4435835">)</span>&nbsp;<span class="builtintype" id="4435837">string</span>&nbsp;<span class="op" id="4435844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435847">b</span>&nbsp;<span class="op" id="4435849">:=</span>&nbsp;<span class="ident" id="4435852">re</span><span class="op" id="4435854">.</span><span class="ident" id="4435855">replaceAll</span><span class="op" id="4435865">(</span><span class="ident" id="4435866">nil</span><span class="op" id="4435869">,</span>&nbsp;<span class="ident" id="4435871">src</span><span class="op" id="4435874">,</span>&nbsp;<span class="num" id="4435876">2</span><span class="op" id="4435877">,</span>&nbsp;<span class="keyword" id="4435879">func</span><span class="op" id="4435883">(</span><span class="ident" id="4435884">dst</span>&nbsp;<span class="op" id="4435888">[</span><span class="op" id="4435889">]</span><span class="builtintype" id="4435890">byte</span><span class="op" id="4435894">,</span>&nbsp;<span class="ident" id="4435896">match</span>&nbsp;<span class="op" id="4435902">[</span><span class="op" id="4435903">]</span><span class="builtintype" id="4435904">int</span><span class="op" id="4435907">)</span>&nbsp;<span class="op" id="4435909">[</span><span class="op" id="4435910">]</span><span class="builtintype" id="4435911">byte</span>&nbsp;<span class="op" id="4435916">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435920">return</span>&nbsp;<span class="builtinfunc" id="4435927">append</span><span class="op" id="4435933">(</span><span class="ident" id="4435934">dst</span><span class="op" id="4435937">,</span>&nbsp;<span class="ident" id="4435939">repl</span><span class="op" id="4435943">(</span><span class="ident" id="4435944">src</span><span class="op" id="4435947">[</span><span class="ident" id="4435948">match</span><span class="op" id="4435953">[</span><span class="num" id="4435954">0</span><span class="op" id="4435955">]</span><span class="op" id="4435956">:</span><span class="ident" id="4435957">match</span><span class="op" id="4435962">[</span><span class="num" id="4435963">1</span><span class="op" id="4435964">]</span><span class="op" id="4435965">]</span><span class="op" id="4435966">)</span><span class="op" id="4435967">...</span><span class="op" id="4435970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435973">}</span><span class="op" id="4435974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435977">return</span>&nbsp;<span class="builtintype" id="4435984">string</span><span class="op" id="4435990">(</span><span class="ident" id="4435991">b</span><span class="op" id="4435992">)</span><br>
<span class="lineno"></span><span class="op" id="4435994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="4435997">func</span>&nbsp;<span class="op" id="4436002">(</span><span class="ident" id="4436003">re</span>&nbsp;<span class="op" id="4436006">*</span><span class="ident" id="4436007">Regexp</span><span class="op" id="4436013">)</span>&nbsp;<span class="ident" id="4436015">replaceAll</span><span class="op" id="4436025">(</span><span class="ident" id="4436026">bsrc</span>&nbsp;<span class="op" id="4436031">[</span><span class="op" id="4436032">]</span><span class="builtintype" id="4436033">byte</span><span class="op" id="4436037">,</span>&nbsp;<span class="ident" id="4436039">src</span>&nbsp;<span class="builtintype" id="4436043">string</span><span class="op" id="4436049">,</span>&nbsp;<span class="ident" id="4436051">nmatch</span>&nbsp;<span class="builtintype" id="4436058">int</span><span class="op" id="4436061">,</span>&nbsp;<span class="ident" id="4436063">repl</span>&nbsp;<span class="keyword" id="4436068">func</span><span class="op" id="4436072">(</span><span class="ident" id="4436073">dst</span>&nbsp;<span class="op" id="4436077">[</span><span class="op" id="4436078">]</span><span class="builtintype" id="4436079">byte</span><span class="op" id="4436083">,</span>&nbsp;<span class="ident" id="4436085">m</span>&nbsp;<span class="op" id="4436087">[</span><span class="op" id="4436088">]</span><span class="builtintype" id="4436089">int</span><span class="op" id="4436092">)</span>&nbsp;<span class="op" id="4436094">[</span><span class="op" id="4436095">]</span><span class="builtintype" id="4436096">byte</span><span class="op" id="4436100">)</span>&nbsp;<span class="op" id="4436102">[</span><span class="op" id="4436103">]</span><span class="builtintype" id="4436104">byte</span>&nbsp;<span class="op" id="4436109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436112">lastMatchEnd</span>&nbsp;<span class="op" id="4436125">:=</span>&nbsp;<span class="num" id="4436128">0</span>&nbsp;<span class="comment" id="4436130">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436172">searchPos</span>&nbsp;<span class="op" id="4436182">:=</span>&nbsp;<span class="num" id="4436185">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4436190">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436234">var</span>&nbsp;<span class="ident" id="4436238">buf</span>&nbsp;<span class="op" id="4436242">[</span><span class="op" id="4436243">]</span><span class="builtintype" id="4436244">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436250">var</span>&nbsp;<span class="ident" id="4436254">endPos</span>&nbsp;<span class="builtintype" id="4436261">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436266">if</span>&nbsp;<span class="ident" id="4436269">bsrc</span>&nbsp;<span class="op" id="4436274">!=</span>&nbsp;<span class="ident" id="4436277">nil</span>&nbsp;<span class="op" id="4436281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436285">endPos</span>&nbsp;<span class="op" id="4436292">=</span>&nbsp;<span class="builtinfunc" id="4436294">len</span><span class="op" id="4436297">(</span><span class="ident" id="4436298">bsrc</span><span class="op" id="4436302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436305">}</span>&nbsp;<span class="keyword" id="4436307">else</span>&nbsp;<span class="op" id="4436312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436316">endPos</span>&nbsp;<span class="op" id="4436323">=</span>&nbsp;<span class="builtinfunc" id="4436325">len</span><span class="op" id="4436328">(</span><span class="ident" id="4436329">src</span><span class="op" id="4436332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436335">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436338">for</span>&nbsp;<span class="ident" id="4436342">searchPos</span>&nbsp;<span class="op" id="4436352">&lt;=</span>&nbsp;<span class="ident" id="4436355">endPos</span>&nbsp;<span class="op" id="4436362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436366">a</span>&nbsp;<span class="op" id="4436368">:=</span>&nbsp;<span class="ident" id="4436371">re</span><span class="op" id="4436373">.</span><span class="ident" id="4436374">doExecute</span><span class="op" id="4436383">(</span><span class="ident" id="4436384">nil</span><span class="op" id="4436387">,</span>&nbsp;<span class="ident" id="4436389">bsrc</span><span class="op" id="4436393">,</span>&nbsp;<span class="ident" id="4436395">src</span><span class="op" id="4436398">,</span>&nbsp;<span class="ident" id="4436400">searchPos</span><span class="op" id="4436409">,</span>&nbsp;<span class="ident" id="4436411">nmatch</span><span class="op" id="4436417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436421">if</span>&nbsp;<span class="builtinfunc" id="4436424">len</span><span class="op" id="4436427">(</span><span class="ident" id="4436428">a</span><span class="op" id="4436429">)</span>&nbsp;<span class="op" id="4436431">==</span>&nbsp;<span class="num" id="4436434">0</span>&nbsp;<span class="op" id="4436436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436441">break</span>&nbsp;<span class="comment" id="4436447">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436468">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436473">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436527">if</span>&nbsp;<span class="ident" id="4436530">bsrc</span>&nbsp;<span class="op" id="4436535">!=</span>&nbsp;<span class="ident" id="4436538">nil</span>&nbsp;<span class="op" id="4436542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436547">buf</span>&nbsp;<span class="op" id="4436551">=</span>&nbsp;<span class="builtinfunc" id="4436553">append</span><span class="op" id="4436559">(</span><span class="ident" id="4436560">buf</span><span class="op" id="4436563">,</span>&nbsp;<span class="ident" id="4436565">bsrc</span><span class="op" id="4436569">[</span><span class="ident" id="4436570">lastMatchEnd</span><span class="op" id="4436582">:</span><span class="ident" id="4436583">a</span><span class="op" id="4436584">[</span><span class="num" id="4436585">0</span><span class="op" id="4436586">]</span><span class="op" id="4436587">]</span><span class="op" id="4436588">...</span><span class="op" id="4436591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436595">}</span>&nbsp;<span class="keyword" id="4436597">else</span>&nbsp;<span class="op" id="4436602">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436607">buf</span>&nbsp;<span class="op" id="4436611">=</span>&nbsp;<span class="builtinfunc" id="4436613">append</span><span class="op" id="4436619">(</span><span class="ident" id="4436620">buf</span><span class="op" id="4436623">,</span>&nbsp;<span class="ident" id="4436625">src</span><span class="op" id="4436628">[</span><span class="ident" id="4436629">lastMatchEnd</span><span class="op" id="4436641">:</span><span class="ident" id="4436642">a</span><span class="op" id="4436643">[</span><span class="num" id="4436644">0</span><span class="op" id="4436645">]</span><span class="op" id="4436646">]</span><span class="op" id="4436647">...</span><span class="op" id="4436650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436659">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436723">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436787">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436848">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436893">if</span>&nbsp;<span class="ident" id="4436896">a</span><span class="op" id="4436897">[</span><span class="num" id="4436898">1</span><span class="op" id="4436899">]</span>&nbsp;<span class="op" id="4436901">&gt;</span>&nbsp;<span class="ident" id="4436903">lastMatchEnd</span>&nbsp;<span class="op" id="4436916">||</span>&nbsp;<span class="ident" id="4436919">a</span><span class="op" id="4436920">[</span><span class="num" id="4436921">0</span><span class="op" id="4436922">]</span>&nbsp;<span class="op" id="4436924">==</span>&nbsp;<span class="num" id="4436927">0</span>&nbsp;<span class="op" id="4436929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436934">buf</span>&nbsp;<span class="op" id="4436938">=</span>&nbsp;<span class="ident" id="4436940">repl</span><span class="op" id="4436944">(</span><span class="ident" id="4436945">buf</span><span class="op" id="4436948">,</span>&nbsp;<span class="ident" id="4436950">a</span><span class="op" id="4436951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436955">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436959">lastMatchEnd</span>&nbsp;<span class="op" id="4436972">=</span>&nbsp;<span class="ident" id="4436974">a</span><span class="op" id="4436975">[</span><span class="num" id="4436976">1</span><span class="op" id="4436977">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436982">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437051">var</span>&nbsp;<span class="ident" id="4437055">width</span>&nbsp;<span class="builtintype" id="4437061">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437067">if</span>&nbsp;<span class="ident" id="4437070">bsrc</span>&nbsp;<span class="op" id="4437075">!=</span>&nbsp;<span class="ident" id="4437078">nil</span>&nbsp;<span class="op" id="4437082">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437087">_</span><span class="op" id="4437088">,</span>&nbsp;<span class="ident" id="4437090">width</span>&nbsp;<span class="op" id="4437096">=</span>&nbsp;<span class="ident" id="4437098">utf8</span><span class="op" id="4437102">.</span><span class="ident" id="4437103">DecodeRune</span><span class="op" id="4437113">(</span><span class="ident" id="4437114">bsrc</span><span class="op" id="4437118">[</span><span class="ident" id="4437119">searchPos</span><span class="op" id="4437128">:</span><span class="op" id="4437129">]</span><span class="op" id="4437130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437134">}</span>&nbsp;<span class="keyword" id="4437136">else</span>&nbsp;<span class="op" id="4437141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437146">_</span><span class="op" id="4437147">,</span>&nbsp;<span class="ident" id="4437149">width</span>&nbsp;<span class="op" id="4437155">=</span>&nbsp;<span class="ident" id="4437157">utf8</span><span class="op" id="4437161">.</span><span class="ident" id="4437162">DecodeRuneInString</span><span class="op" id="4437180">(</span><span class="ident" id="4437181">src</span><span class="op" id="4437184">[</span><span class="ident" id="4437185">searchPos</span><span class="op" id="4437194">:</span><span class="op" id="4437195">]</span><span class="op" id="4437196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437204">if</span>&nbsp;<span class="ident" id="4437207">searchPos</span><span class="op" id="4437216">+</span><span class="ident" id="4437217">width</span>&nbsp;<span class="op" id="4437223">&gt;</span>&nbsp;<span class="ident" id="4437225">a</span><span class="op" id="4437226">[</span><span class="num" id="4437227">1</span><span class="op" id="4437228">]</span>&nbsp;<span class="op" id="4437230">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437235">searchPos</span>&nbsp;<span class="op" id="4437245">+=</span>&nbsp;<span class="ident" id="4437248">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437256">}</span>&nbsp;<span class="keyword" id="4437258">else</span>&nbsp;<span class="keyword" id="4437263">if</span>&nbsp;<span class="ident" id="4437266">searchPos</span><span class="op" id="4437275">+</span><span class="num" id="4437276">1</span>&nbsp;<span class="op" id="4437278">&gt;</span>&nbsp;<span class="ident" id="4437280">a</span><span class="op" id="4437281">[</span><span class="num" id="4437282">1</span><span class="op" id="4437283">]</span>&nbsp;<span class="op" id="4437285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437290">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437347">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437412">searchPos</span><span class="op" id="4437421">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437426">}</span>&nbsp;<span class="keyword" id="4437428">else</span>&nbsp;<span class="op" id="4437433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437438">searchPos</span>&nbsp;<span class="op" id="4437448">=</span>&nbsp;<span class="ident" id="4437450">a</span><span class="op" id="4437451">[</span><span class="num" id="4437452">1</span><span class="op" id="4437453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437464">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437520">if</span>&nbsp;<span class="ident" id="4437523">bsrc</span>&nbsp;<span class="op" id="4437528">!=</span>&nbsp;<span class="ident" id="4437531">nil</span>&nbsp;<span class="op" id="4437535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437539">buf</span>&nbsp;<span class="op" id="4437543">=</span>&nbsp;<span class="builtinfunc" id="4437545">append</span><span class="op" id="4437551">(</span><span class="ident" id="4437552">buf</span><span class="op" id="4437555">,</span>&nbsp;<span class="ident" id="4437557">bsrc</span><span class="op" id="4437561">[</span><span class="ident" id="4437562">lastMatchEnd</span><span class="op" id="4437574">:</span><span class="op" id="4437575">]</span><span class="op" id="4437576">...</span><span class="op" id="4437579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437582">}</span>&nbsp;<span class="keyword" id="4437584">else</span>&nbsp;<span class="op" id="4437589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437593">buf</span>&nbsp;<span class="op" id="4437597">=</span>&nbsp;<span class="builtinfunc" id="4437599">append</span><span class="op" id="4437605">(</span><span class="ident" id="4437606">buf</span><span class="op" id="4437609">,</span>&nbsp;<span class="ident" id="4437611">src</span><span class="op" id="4437614">[</span><span class="ident" id="4437615">lastMatchEnd</span><span class="op" id="4437627">:</span><span class="op" id="4437628">]</span><span class="op" id="4437629">...</span><span class="op" id="4437632">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437639">return</span>&nbsp;<span class="ident" id="4437646">buf</span><br>
<span class="lineno"></span><span class="op" id="4437650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4437653">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="4437722">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4437798">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4437874">func</span>&nbsp;<span class="op" id="4437879">(</span><span class="ident" id="4437880">re</span>&nbsp;<span class="op" id="4437883">*</span><span class="ident" id="4437884">Regexp</span><span class="op" id="4437890">)</span>&nbsp;<span class="ident" id="4437892">ReplaceAll</span><span class="op" id="4437902">(</span><span class="ident" id="4437903">src</span><span class="op" id="4437906">,</span>&nbsp;<span class="ident" id="4437908">repl</span>&nbsp;<span class="op" id="4437913">[</span><span class="op" id="4437914">]</span><span class="builtintype" id="4437915">byte</span><span class="op" id="4437919">)</span>&nbsp;<span class="op" id="4437921">[</span><span class="op" id="4437922">]</span><span class="builtintype" id="4437923">byte</span>&nbsp;<span class="op" id="4437928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437931">n</span>&nbsp;<span class="op" id="4437933">:=</span>&nbsp;<span class="num" id="4437936">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437939">if</span>&nbsp;<span class="ident" id="4437942">bytes</span><span class="op" id="4437947">.</span><span class="ident" id="4437948">IndexByte</span><span class="op" id="4437957">(</span><span class="ident" id="4437958">repl</span><span class="op" id="4437962">,</span>&nbsp;<span class="string" id="4437964">&#39;$&#39;</span><span class="op" id="4437967">)</span>&nbsp;<span class="op" id="4437969">&gt;=</span>&nbsp;<span class="num" id="4437972">0</span>&nbsp;<span class="op" id="4437974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437978">n</span>&nbsp;<span class="op" id="4437980">=</span>&nbsp;<span class="num" id="4437982">2</span>&nbsp;<span class="op" id="4437984">*</span>&nbsp;<span class="op" id="4437986">(</span><span class="ident" id="4437987">re</span><span class="op" id="4437989">.</span><span class="ident" id="4437990">numSubexp</span>&nbsp;<span class="op" id="4438000">+</span>&nbsp;<span class="num" id="4438002">1</span><span class="op" id="4438003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438009">srepl</span>&nbsp;<span class="op" id="4438015">:=</span>&nbsp;<span class="string" id="4438018">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438022">b</span>&nbsp;<span class="op" id="4438024">:=</span>&nbsp;<span class="ident" id="4438027">re</span><span class="op" id="4438029">.</span><span class="ident" id="4438030">replaceAll</span><span class="op" id="4438040">(</span><span class="ident" id="4438041">src</span><span class="op" id="4438044">,</span>&nbsp;<span class="string" id="4438046">&#34;&#34;</span><span class="op" id="4438048">,</span>&nbsp;<span class="ident" id="4438050">n</span><span class="op" id="4438051">,</span>&nbsp;<span class="keyword" id="4438053">func</span><span class="op" id="4438057">(</span><span class="ident" id="4438058">dst</span>&nbsp;<span class="op" id="4438062">[</span><span class="op" id="4438063">]</span><span class="builtintype" id="4438064">byte</span><span class="op" id="4438068">,</span>&nbsp;<span class="ident" id="4438070">match</span>&nbsp;<span class="op" id="4438076">[</span><span class="op" id="4438077">]</span><span class="builtintype" id="4438078">int</span><span class="op" id="4438081">)</span>&nbsp;<span class="op" id="4438083">[</span><span class="op" id="4438084">]</span><span class="builtintype" id="4438085">byte</span>&nbsp;<span class="op" id="4438090">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438094">if</span>&nbsp;<span class="builtinfunc" id="4438097">len</span><span class="op" id="4438100">(</span><span class="ident" id="4438101">srepl</span><span class="op" id="4438106">)</span>&nbsp;<span class="op" id="4438108">!=</span>&nbsp;<span class="builtinfunc" id="4438111">len</span><span class="op" id="4438114">(</span><span class="ident" id="4438115">repl</span><span class="op" id="4438119">)</span>&nbsp;<span class="op" id="4438121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438126">srepl</span>&nbsp;<span class="op" id="4438132">=</span>&nbsp;<span class="builtintype" id="4438134">string</span><span class="op" id="4438140">(</span><span class="ident" id="4438141">repl</span><span class="op" id="4438145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438153">return</span>&nbsp;<span class="ident" id="4438160">re</span><span class="op" id="4438162">.</span><span class="ident" id="4438163">expand</span><span class="op" id="4438169">(</span><span class="ident" id="4438170">dst</span><span class="op" id="4438173">,</span>&nbsp;<span class="ident" id="4438175">srepl</span><span class="op" id="4438180">,</span>&nbsp;<span class="ident" id="4438182">src</span><span class="op" id="4438185">,</span>&nbsp;<span class="string" id="4438187">&#34;&#34;</span><span class="op" id="4438189">,</span>&nbsp;<span class="ident" id="4438191">match</span><span class="op" id="4438196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438199">}</span><span class="op" id="4438200">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438203">return</span>&nbsp;<span class="ident" id="4438210">b</span><br>
<span class="lineno"></span><span class="op" id="4438212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4438215">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="4438291">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="4438374">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="4438399">func</span>&nbsp;<span class="op" id="4438404">(</span><span class="ident" id="4438405">re</span>&nbsp;<span class="op" id="4438408">*</span><span class="ident" id="4438409">Regexp</span><span class="op" id="4438415">)</span>&nbsp;<span class="ident" id="4438417">ReplaceAllLiteral</span><span class="op" id="4438434">(</span><span class="ident" id="4438435">src</span><span class="op" id="4438438">,</span>&nbsp;<span class="ident" id="4438440">repl</span>&nbsp;<span class="op" id="4438445">[</span><span class="op" id="4438446">]</span><span class="builtintype" id="4438447">byte</span><span class="op" id="4438451">)</span>&nbsp;<span class="op" id="4438453">[</span><span class="op" id="4438454">]</span><span class="builtintype" id="4438455">byte</span>&nbsp;<span class="op" id="4438460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438463">return</span>&nbsp;<span class="ident" id="4438470">re</span><span class="op" id="4438472">.</span><span class="ident" id="4438473">replaceAll</span><span class="op" id="4438483">(</span><span class="ident" id="4438484">src</span><span class="op" id="4438487">,</span>&nbsp;<span class="string" id="4438489">&#34;&#34;</span><span class="op" id="4438491">,</span>&nbsp;<span class="num" id="4438493">2</span><span class="op" id="4438494">,</span>&nbsp;<span class="keyword" id="4438496">func</span><span class="op" id="4438500">(</span><span class="ident" id="4438501">dst</span>&nbsp;<span class="op" id="4438505">[</span><span class="op" id="4438506">]</span><span class="builtintype" id="4438507">byte</span><span class="op" id="4438511">,</span>&nbsp;<span class="ident" id="4438513">match</span>&nbsp;<span class="op" id="4438519">[</span><span class="op" id="4438520">]</span><span class="builtintype" id="4438521">int</span><span class="op" id="4438524">)</span>&nbsp;<span class="op" id="4438526">[</span><span class="op" id="4438527">]</span><span class="builtintype" id="4438528">byte</span>&nbsp;<span class="op" id="4438533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438537">return</span>&nbsp;<span class="builtinfunc" id="4438544">append</span><span class="op" id="4438550">(</span><span class="ident" id="4438551">dst</span><span class="op" id="4438554">,</span>&nbsp;<span class="ident" id="4438556">repl</span><span class="op" id="4438560">...</span><span class="op" id="4438563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438566">}</span><span class="op" id="4438567">)</span><br>
<span class="lineno">560</span><span class="op" id="4438569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4438572">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4438640">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="4438714">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="4438793">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="4438828">func</span>&nbsp;<span class="op" id="4438833">(</span><span class="ident" id="4438834">re</span>&nbsp;<span class="op" id="4438837">*</span><span class="ident" id="4438838">Regexp</span><span class="op" id="4438844">)</span>&nbsp;<span class="ident" id="4438846">ReplaceAllFunc</span><span class="op" id="4438860">(</span><span class="ident" id="4438861">src</span>&nbsp;<span class="op" id="4438865">[</span><span class="op" id="4438866">]</span><span class="builtintype" id="4438867">byte</span><span class="op" id="4438871">,</span>&nbsp;<span class="ident" id="4438873">repl</span>&nbsp;<span class="keyword" id="4438878">func</span><span class="op" id="4438882">(</span><span class="op" id="4438883">[</span><span class="op" id="4438884">]</span><span class="builtintype" id="4438885">byte</span><span class="op" id="4438889">)</span>&nbsp;<span class="op" id="4438891">[</span><span class="op" id="4438892">]</span><span class="builtintype" id="4438893">byte</span><span class="op" id="4438897">)</span>&nbsp;<span class="op" id="4438899">[</span><span class="op" id="4438900">]</span><span class="builtintype" id="4438901">byte</span>&nbsp;<span class="op" id="4438906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438909">return</span>&nbsp;<span class="ident" id="4438916">re</span><span class="op" id="4438918">.</span><span class="ident" id="4438919">replaceAll</span><span class="op" id="4438929">(</span><span class="ident" id="4438930">src</span><span class="op" id="4438933">,</span>&nbsp;<span class="string" id="4438935">&#34;&#34;</span><span class="op" id="4438937">,</span>&nbsp;<span class="num" id="4438939">2</span><span class="op" id="4438940">,</span>&nbsp;<span class="keyword" id="4438942">func</span><span class="op" id="4438946">(</span><span class="ident" id="4438947">dst</span>&nbsp;<span class="op" id="4438951">[</span><span class="op" id="4438952">]</span><span class="builtintype" id="4438953">byte</span><span class="op" id="4438957">,</span>&nbsp;<span class="ident" id="4438959">match</span>&nbsp;<span class="op" id="4438965">[</span><span class="op" id="4438966">]</span><span class="builtintype" id="4438967">int</span><span class="op" id="4438970">)</span>&nbsp;<span class="op" id="4438972">[</span><span class="op" id="4438973">]</span><span class="builtintype" id="4438974">byte</span>&nbsp;<span class="op" id="4438979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438983">return</span>&nbsp;<span class="builtinfunc" id="4438990">append</span><span class="op" id="4438996">(</span><span class="ident" id="4438997">dst</span><span class="op" id="4439000">,</span>&nbsp;<span class="ident" id="4439002">repl</span><span class="op" id="4439006">(</span><span class="ident" id="4439007">src</span><span class="op" id="4439010">[</span><span class="ident" id="4439011">match</span><span class="op" id="4439016">[</span><span class="num" id="4439017">0</span><span class="op" id="4439018">]</span><span class="op" id="4439019">:</span><span class="ident" id="4439020">match</span><span class="op" id="4439025">[</span><span class="num" id="4439026">1</span><span class="op" id="4439027">]</span><span class="op" id="4439028">]</span><span class="op" id="4439029">)</span><span class="op" id="4439030">...</span><span class="op" id="4439033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439036">}</span><span class="op" id="4439037">)</span><br>
<span class="lineno">570</span><span class="op" id="4439039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4439042">var</span>&nbsp;<span class="ident" id="4439046">specialBytes</span>&nbsp;<span class="op" id="4439059">=</span>&nbsp;<span class="op" id="4439061">[</span><span class="op" id="4439062">]</span><span class="builtintype" id="4439063">byte</span><span class="op" id="4439067">(</span><span class="string" id="4439068">`\.+*?()|[]{}^$`</span><span class="op" id="4439084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4439087">func</span>&nbsp;<span class="ident" id="4439092">special</span><span class="op" id="4439099">(</span><span class="ident" id="4439100">b</span>&nbsp;<span class="builtintype" id="4439102">byte</span><span class="op" id="4439106">)</span>&nbsp;<span class="builtintype" id="4439108">bool</span>&nbsp;<span class="op" id="4439113">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439116">return</span>&nbsp;<span class="ident" id="4439123">bytes</span><span class="op" id="4439128">.</span><span class="ident" id="4439129">IndexByte</span><span class="op" id="4439138">(</span><span class="ident" id="4439139">specialBytes</span><span class="op" id="4439151">,</span>&nbsp;<span class="ident" id="4439153">b</span><span class="op" id="4439154">)</span>&nbsp;<span class="op" id="4439156">&gt;=</span>&nbsp;<span class="num" id="4439159">0</span><br>
<span class="lineno"></span><span class="op" id="4439161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4439164">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="4439244">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="4439326">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="4439399">func</span>&nbsp;<span class="ident" id="4439404">QuoteMeta</span><span class="op" id="4439413">(</span><span class="ident" id="4439414">s</span>&nbsp;<span class="builtintype" id="4439416">string</span><span class="op" id="4439422">)</span>&nbsp;<span class="builtintype" id="4439424">string</span>&nbsp;<span class="op" id="4439431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439434">b</span>&nbsp;<span class="op" id="4439436">:=</span>&nbsp;<span class="builtinfunc" id="4439439">make</span><span class="op" id="4439443">(</span><span class="op" id="4439444">[</span><span class="op" id="4439445">]</span><span class="builtintype" id="4439446">byte</span><span class="op" id="4439450">,</span>&nbsp;<span class="num" id="4439452">2</span><span class="op" id="4439453">*</span><span class="builtinfunc" id="4439454">len</span><span class="op" id="4439457">(</span><span class="ident" id="4439458">s</span><span class="op" id="4439459">)</span><span class="op" id="4439460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439464">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439529">j</span>&nbsp;<span class="op" id="4439531">:=</span>&nbsp;<span class="num" id="4439534">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439537">for</span>&nbsp;<span class="ident" id="4439541">i</span>&nbsp;<span class="op" id="4439543">:=</span>&nbsp;<span class="num" id="4439546">0</span><span class="op" id="4439547">;</span>&nbsp;<span class="ident" id="4439549">i</span>&nbsp;<span class="op" id="4439551">&lt;</span>&nbsp;<span class="builtinfunc" id="4439553">len</span><span class="op" id="4439556">(</span><span class="ident" id="4439557">s</span><span class="op" id="4439558">)</span><span class="op" id="4439559">;</span>&nbsp;<span class="ident" id="4439561">i</span><span class="op" id="4439562">++</span>&nbsp;<span class="op" id="4439565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439569">if</span>&nbsp;<span class="ident" id="4439572">special</span><span class="op" id="4439579">(</span><span class="ident" id="4439580">s</span><span class="op" id="4439581">[</span><span class="ident" id="4439582">i</span><span class="op" id="4439583">]</span><span class="op" id="4439584">)</span>&nbsp;<span class="op" id="4439586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439591">b</span><span class="op" id="4439592">[</span><span class="ident" id="4439593">j</span><span class="op" id="4439594">]</span>&nbsp;<span class="op" id="4439596">=</span>&nbsp;<span class="string" id="4439598">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439606">j</span><span class="op" id="4439607">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439616">b</span><span class="op" id="4439617">[</span><span class="ident" id="4439618">j</span><span class="op" id="4439619">]</span>&nbsp;<span class="op" id="4439621">=</span>&nbsp;<span class="ident" id="4439623">s</span><span class="op" id="4439624">[</span><span class="ident" id="4439625">i</span><span class="op" id="4439626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439630">j</span><span class="op" id="4439631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439638">return</span>&nbsp;<span class="builtintype" id="4439645">string</span><span class="op" id="4439651">(</span><span class="ident" id="4439652">b</span><span class="op" id="4439653">[</span><span class="num" id="4439654">0</span><span class="op" id="4439655">:</span><span class="ident" id="4439656">j</span><span class="op" id="4439657">]</span><span class="op" id="4439658">)</span><br>
<span class="lineno">595</span><span class="op" id="4439660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4439663">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4439725">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="4439783">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="4439844">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4439905">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="4439973">func</span>&nbsp;<span class="op" id="4439978">(</span><span class="ident" id="4439979">re</span>&nbsp;<span class="op" id="4439982">*</span><span class="ident" id="4439983">Regexp</span><span class="op" id="4439989">)</span>&nbsp;<span class="ident" id="4439991">pad</span><span class="op" id="4439994">(</span><span class="ident" id="4439995">a</span>&nbsp;<span class="op" id="4439997">[</span><span class="op" id="4439998">]</span><span class="builtintype" id="4439999">int</span><span class="op" id="4440002">)</span>&nbsp;<span class="op" id="4440004">[</span><span class="op" id="4440005">]</span><span class="builtintype" id="4440006">int</span>&nbsp;<span class="op" id="4440010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440013">if</span>&nbsp;<span class="ident" id="4440016">a</span>&nbsp;<span class="op" id="4440018">==</span>&nbsp;<span class="ident" id="4440021">nil</span>&nbsp;<span class="op" id="4440025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440029">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440044">return</span>&nbsp;<span class="ident" id="4440051">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440059">n</span>&nbsp;<span class="op" id="4440061">:=</span>&nbsp;<span class="op" id="4440064">(</span><span class="num" id="4440065">1</span>&nbsp;<span class="op" id="4440067">+</span>&nbsp;<span class="ident" id="4440069">re</span><span class="op" id="4440071">.</span><span class="ident" id="4440072">numSubexp</span><span class="op" id="4440081">)</span>&nbsp;<span class="op" id="4440083">*</span>&nbsp;<span class="num" id="4440085">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440088">for</span>&nbsp;<span class="builtinfunc" id="4440092">len</span><span class="op" id="4440095">(</span><span class="ident" id="4440096">a</span><span class="op" id="4440097">)</span>&nbsp;<span class="op" id="4440099">&lt;</span>&nbsp;<span class="ident" id="4440101">n</span>&nbsp;<span class="op" id="4440103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440107">a</span>&nbsp;<span class="op" id="4440109">=</span>&nbsp;<span class="builtinfunc" id="4440111">append</span><span class="op" id="4440117">(</span><span class="ident" id="4440118">a</span><span class="op" id="4440119">,</span>&nbsp;<span class="op" id="4440121">-</span><span class="num" id="4440122">1</span><span class="op" id="4440123">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440129">return</span>&nbsp;<span class="ident" id="4440136">a</span><br>
<span class="lineno"></span><span class="op" id="4440138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4440141">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="4440221">func</span>&nbsp;<span class="op" id="4440226">(</span><span class="ident" id="4440227">re</span>&nbsp;<span class="op" id="4440230">*</span><span class="ident" id="4440231">Regexp</span><span class="op" id="4440237">)</span>&nbsp;<span class="ident" id="4440239">allMatches</span><span class="op" id="4440249">(</span><span class="ident" id="4440250">s</span>&nbsp;<span class="builtintype" id="4440252">string</span><span class="op" id="4440258">,</span>&nbsp;<span class="ident" id="4440260">b</span>&nbsp;<span class="op" id="4440262">[</span><span class="op" id="4440263">]</span><span class="builtintype" id="4440264">byte</span><span class="op" id="4440268">,</span>&nbsp;<span class="ident" id="4440270">n</span>&nbsp;<span class="builtintype" id="4440272">int</span><span class="op" id="4440275">,</span>&nbsp;<span class="ident" id="4440277">deliver</span>&nbsp;<span class="keyword" id="4440285">func</span><span class="op" id="4440289">(</span><span class="op" id="4440290">[</span><span class="op" id="4440291">]</span><span class="builtintype" id="4440292">int</span><span class="op" id="4440295">)</span><span class="op" id="4440296">)</span>&nbsp;<span class="op" id="4440298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440301">var</span>&nbsp;<span class="ident" id="4440305">end</span>&nbsp;<span class="builtintype" id="4440309">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440314">if</span>&nbsp;<span class="ident" id="4440317">b</span>&nbsp;<span class="op" id="4440319">==</span>&nbsp;<span class="ident" id="4440322">nil</span>&nbsp;<span class="op" id="4440326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440330">end</span>&nbsp;<span class="op" id="4440334">=</span>&nbsp;<span class="builtinfunc" id="4440336">len</span><span class="op" id="4440339">(</span><span class="ident" id="4440340">s</span><span class="op" id="4440341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440344">}</span>&nbsp;<span class="keyword" id="4440346">else</span>&nbsp;<span class="op" id="4440351">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440355">end</span>&nbsp;<span class="op" id="4440359">=</span>&nbsp;<span class="builtinfunc" id="4440361">len</span><span class="op" id="4440364">(</span><span class="ident" id="4440365">b</span><span class="op" id="4440366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440373">for</span>&nbsp;<span class="ident" id="4440377">pos</span><span class="op" id="4440380">,</span>&nbsp;<span class="ident" id="4440382">i</span><span class="op" id="4440383">,</span>&nbsp;<span class="ident" id="4440385">prevMatchEnd</span>&nbsp;<span class="op" id="4440398">:=</span>&nbsp;<span class="num" id="4440401">0</span><span class="op" id="4440402">,</span>&nbsp;<span class="num" id="4440404">0</span><span class="op" id="4440405">,</span>&nbsp;<span class="op" id="4440407">-</span><span class="num" id="4440408">1</span><span class="op" id="4440409">;</span>&nbsp;<span class="ident" id="4440411">i</span>&nbsp;<span class="op" id="4440413">&lt;</span>&nbsp;<span class="ident" id="4440415">n</span>&nbsp;<span class="op" id="4440417">&amp;&amp;</span>&nbsp;<span class="ident" id="4440420">pos</span>&nbsp;<span class="op" id="4440424">&lt;=</span>&nbsp;<span class="ident" id="4440427">end</span><span class="op" id="4440430">;</span>&nbsp;<span class="op" id="4440432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440436">matches</span>&nbsp;<span class="op" id="4440444">:=</span>&nbsp;<span class="ident" id="4440447">re</span><span class="op" id="4440449">.</span><span class="ident" id="4440450">doExecute</span><span class="op" id="4440459">(</span><span class="ident" id="4440460">nil</span><span class="op" id="4440463">,</span>&nbsp;<span class="ident" id="4440465">b</span><span class="op" id="4440466">,</span>&nbsp;<span class="ident" id="4440468">s</span><span class="op" id="4440469">,</span>&nbsp;<span class="ident" id="4440471">pos</span><span class="op" id="4440474">,</span>&nbsp;<span class="ident" id="4440476">re</span><span class="op" id="4440478">.</span><span class="ident" id="4440479">prog</span><span class="op" id="4440483">.</span><span class="ident" id="4440484">NumCap</span><span class="op" id="4440490">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440494">if</span>&nbsp;<span class="builtinfunc" id="4440497">len</span><span class="op" id="4440500">(</span><span class="ident" id="4440501">matches</span><span class="op" id="4440508">)</span>&nbsp;<span class="op" id="4440510">==</span>&nbsp;<span class="num" id="4440513">0</span>&nbsp;<span class="op" id="4440515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440520">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440533">accept</span>&nbsp;<span class="op" id="4440540">:=</span>&nbsp;<span class="builtintype" id="4440543">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440550">if</span>&nbsp;<span class="ident" id="4440553">matches</span><span class="op" id="4440560">[</span><span class="num" id="4440561">1</span><span class="op" id="4440562">]</span>&nbsp;<span class="op" id="4440564">==</span>&nbsp;<span class="ident" id="4440567">pos</span>&nbsp;<span class="op" id="4440571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440576">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440610">if</span>&nbsp;<span class="ident" id="4440613">matches</span><span class="op" id="4440620">[</span><span class="num" id="4440621">0</span><span class="op" id="4440622">]</span>&nbsp;<span class="op" id="4440624">==</span>&nbsp;<span class="ident" id="4440627">prevMatchEnd</span>&nbsp;<span class="op" id="4440640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440646">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440689">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440734">accept</span>&nbsp;<span class="op" id="4440741">=</span>&nbsp;<span class="builtintype" id="4440743">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440757">var</span>&nbsp;<span class="ident" id="4440761">width</span>&nbsp;<span class="builtintype" id="4440767">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440774">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440797">if</span>&nbsp;<span class="ident" id="4440800">b</span>&nbsp;<span class="op" id="4440802">==</span>&nbsp;<span class="ident" id="4440805">nil</span>&nbsp;<span class="op" id="4440809">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440815">_</span><span class="op" id="4440816">,</span>&nbsp;<span class="ident" id="4440818">width</span>&nbsp;<span class="op" id="4440824">=</span>&nbsp;<span class="ident" id="4440826">utf8</span><span class="op" id="4440830">.</span><span class="ident" id="4440831">DecodeRuneInString</span><span class="op" id="4440849">(</span><span class="ident" id="4440850">s</span><span class="op" id="4440851">[</span><span class="ident" id="4440852">pos</span><span class="op" id="4440855">:</span><span class="ident" id="4440856">end</span><span class="op" id="4440859">]</span><span class="op" id="4440860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440865">}</span>&nbsp;<span class="keyword" id="4440867">else</span>&nbsp;<span class="op" id="4440872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440878">_</span><span class="op" id="4440879">,</span>&nbsp;<span class="ident" id="4440881">width</span>&nbsp;<span class="op" id="4440887">=</span>&nbsp;<span class="ident" id="4440889">utf8</span><span class="op" id="4440893">.</span><span class="ident" id="4440894">DecodeRune</span><span class="op" id="4440904">(</span><span class="ident" id="4440905">b</span><span class="op" id="4440906">[</span><span class="ident" id="4440907">pos</span><span class="op" id="4440910">:</span><span class="ident" id="4440911">end</span><span class="op" id="4440914">]</span><span class="op" id="4440915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440925">if</span>&nbsp;<span class="ident" id="4440928">width</span>&nbsp;<span class="op" id="4440934">&gt;</span>&nbsp;<span class="num" id="4440936">0</span>&nbsp;<span class="op" id="4440938">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440944">pos</span>&nbsp;<span class="op" id="4440948">+=</span>&nbsp;<span class="ident" id="4440951">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440960">}</span>&nbsp;<span class="keyword" id="4440962">else</span>&nbsp;<span class="op" id="4440967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440973">pos</span>&nbsp;<span class="op" id="4440977">=</span>&nbsp;<span class="ident" id="4440979">end</span>&nbsp;<span class="op" id="4440983">+</span>&nbsp;<span class="num" id="4440985">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440994">}</span>&nbsp;<span class="keyword" id="4440996">else</span>&nbsp;<span class="op" id="4441001">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441006">pos</span>&nbsp;<span class="op" id="4441010">=</span>&nbsp;<span class="ident" id="4441012">matches</span><span class="op" id="4441019">[</span><span class="num" id="4441020">1</span><span class="op" id="4441021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441029">prevMatchEnd</span>&nbsp;<span class="op" id="4441042">=</span>&nbsp;<span class="ident" id="4441044">matches</span><span class="op" id="4441051">[</span><span class="num" id="4441052">1</span><span class="op" id="4441053">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441058">if</span>&nbsp;<span class="ident" id="4441061">accept</span>&nbsp;<span class="op" id="4441068">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441073">deliver</span><span class="op" id="4441080">(</span><span class="ident" id="4441081">re</span><span class="op" id="4441083">.</span><span class="ident" id="4441084">pad</span><span class="op" id="4441087">(</span><span class="ident" id="4441088">matches</span><span class="op" id="4441095">)</span><span class="op" id="4441096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441101">i</span><span class="op" id="4441102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441110">}</span><br>
<span class="lineno"></span><span class="op" id="4441112">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="4441115">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="4441210">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4441255">func</span>&nbsp;<span class="op" id="4441260">(</span><span class="ident" id="4441261">re</span>&nbsp;<span class="op" id="4441264">*</span><span class="ident" id="4441265">Regexp</span><span class="op" id="4441271">)</span>&nbsp;<span class="ident" id="4441273">Find</span><span class="op" id="4441277">(</span><span class="ident" id="4441278">b</span>&nbsp;<span class="op" id="4441280">[</span><span class="op" id="4441281">]</span><span class="builtintype" id="4441282">byte</span><span class="op" id="4441286">)</span>&nbsp;<span class="op" id="4441288">[</span><span class="op" id="4441289">]</span><span class="builtintype" id="4441290">byte</span>&nbsp;<span class="op" id="4441295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441298">a</span>&nbsp;<span class="op" id="4441300">:=</span>&nbsp;<span class="ident" id="4441303">re</span><span class="op" id="4441305">.</span><span class="ident" id="4441306">doExecute</span><span class="op" id="4441315">(</span><span class="ident" id="4441316">nil</span><span class="op" id="4441319">,</span>&nbsp;<span class="ident" id="4441321">b</span><span class="op" id="4441322">,</span>&nbsp;<span class="string" id="4441324">&#34;&#34;</span><span class="op" id="4441326">,</span>&nbsp;<span class="num" id="4441328">0</span><span class="op" id="4441329">,</span>&nbsp;<span class="num" id="4441331">2</span><span class="op" id="4441332">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441335">if</span>&nbsp;<span class="ident" id="4441338">a</span>&nbsp;<span class="op" id="4441340">==</span>&nbsp;<span class="ident" id="4441343">nil</span>&nbsp;<span class="op" id="4441347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441351">return</span>&nbsp;<span class="ident" id="4441358">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441366">return</span>&nbsp;<span class="ident" id="4441373">b</span><span class="op" id="4441374">[</span><span class="ident" id="4441375">a</span><span class="op" id="4441376">[</span><span class="num" id="4441377">0</span><span class="op" id="4441378">]</span><span class="op" id="4441379">:</span><span class="ident" id="4441380">a</span><span class="op" id="4441381">[</span><span class="num" id="4441382">1</span><span class="op" id="4441383">]</span><span class="op" id="4441384">]</span><br>
<span class="lineno"></span><span class="op" id="4441386">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4441389">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4441467">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4441545">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="4441566">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="4441611">func</span>&nbsp;<span class="op" id="4441616">(</span><span class="ident" id="4441617">re</span>&nbsp;<span class="op" id="4441620">*</span><span class="ident" id="4441621">Regexp</span><span class="op" id="4441627">)</span>&nbsp;<span class="ident" id="4441629">FindIndex</span><span class="op" id="4441638">(</span><span class="ident" id="4441639">b</span>&nbsp;<span class="op" id="4441641">[</span><span class="op" id="4441642">]</span><span class="builtintype" id="4441643">byte</span><span class="op" id="4441647">)</span>&nbsp;<span class="op" id="4441649">(</span><span class="ident" id="4441650">loc</span>&nbsp;<span class="op" id="4441654">[</span><span class="op" id="4441655">]</span><span class="builtintype" id="4441656">int</span><span class="op" id="4441659">)</span>&nbsp;<span class="op" id="4441661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441664">a</span>&nbsp;<span class="op" id="4441666">:=</span>&nbsp;<span class="ident" id="4441669">re</span><span class="op" id="4441671">.</span><span class="ident" id="4441672">doExecute</span><span class="op" id="4441681">(</span><span class="ident" id="4441682">nil</span><span class="op" id="4441685">,</span>&nbsp;<span class="ident" id="4441687">b</span><span class="op" id="4441688">,</span>&nbsp;<span class="string" id="4441690">&#34;&#34;</span><span class="op" id="4441692">,</span>&nbsp;<span class="num" id="4441694">0</span><span class="op" id="4441695">,</span>&nbsp;<span class="num" id="4441697">2</span><span class="op" id="4441698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441701">if</span>&nbsp;<span class="ident" id="4441704">a</span>&nbsp;<span class="op" id="4441706">==</span>&nbsp;<span class="ident" id="4441709">nil</span>&nbsp;<span class="op" id="4441713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441717">return</span>&nbsp;<span class="ident" id="4441724">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441729">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441732">return</span>&nbsp;<span class="ident" id="4441739">a</span><span class="op" id="4441740">[</span><span class="num" id="4441741">0</span><span class="op" id="4441742">:</span><span class="num" id="4441743">2</span><span class="op" id="4441744">]</span><br>
<span class="lineno"></span><span class="op" id="4441746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4441749">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="4441839">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="4441914">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="4441990">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4442062">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="4442103">func</span>&nbsp;<span class="op" id="4442108">(</span><span class="ident" id="4442109">re</span>&nbsp;<span class="op" id="4442112">*</span><span class="ident" id="4442113">Regexp</span><span class="op" id="4442119">)</span>&nbsp;<span class="ident" id="4442121">FindString</span><span class="op" id="4442131">(</span><span class="ident" id="4442132">s</span>&nbsp;<span class="builtintype" id="4442134">string</span><span class="op" id="4442140">)</span>&nbsp;<span class="builtintype" id="4442142">string</span>&nbsp;<span class="op" id="4442149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442152">a</span>&nbsp;<span class="op" id="4442154">:=</span>&nbsp;<span class="ident" id="4442157">re</span><span class="op" id="4442159">.</span><span class="ident" id="4442160">doExecute</span><span class="op" id="4442169">(</span><span class="ident" id="4442170">nil</span><span class="op" id="4442173">,</span>&nbsp;<span class="ident" id="4442175">nil</span><span class="op" id="4442178">,</span>&nbsp;<span class="ident" id="4442180">s</span><span class="op" id="4442181">,</span>&nbsp;<span class="num" id="4442183">0</span><span class="op" id="4442184">,</span>&nbsp;<span class="num" id="4442186">2</span><span class="op" id="4442187">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442190">if</span>&nbsp;<span class="ident" id="4442193">a</span>&nbsp;<span class="op" id="4442195">==</span>&nbsp;<span class="ident" id="4442198">nil</span>&nbsp;<span class="op" id="4442202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442206">return</span>&nbsp;<span class="string" id="4442213">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442220">return</span>&nbsp;<span class="ident" id="4442227">s</span><span class="op" id="4442228">[</span><span class="ident" id="4442229">a</span><span class="op" id="4442230">[</span><span class="num" id="4442231">0</span><span class="op" id="4442232">]</span><span class="op" id="4442233">:</span><span class="ident" id="4442234">a</span><span class="op" id="4442235">[</span><span class="num" id="4442236">1</span><span class="op" id="4442237">]</span><span class="op" id="4442238">]</span><br>
<span class="lineno"></span><span class="op" id="4442240">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="4442243">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4442315">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="4442392">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="4442426">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="4442471">func</span>&nbsp;<span class="op" id="4442476">(</span><span class="ident" id="4442477">re</span>&nbsp;<span class="op" id="4442480">*</span><span class="ident" id="4442481">Regexp</span><span class="op" id="4442487">)</span>&nbsp;<span class="ident" id="4442489">FindStringIndex</span><span class="op" id="4442504">(</span><span class="ident" id="4442505">s</span>&nbsp;<span class="builtintype" id="4442507">string</span><span class="op" id="4442513">)</span>&nbsp;<span class="op" id="4442515">(</span><span class="ident" id="4442516">loc</span>&nbsp;<span class="op" id="4442520">[</span><span class="op" id="4442521">]</span><span class="builtintype" id="4442522">int</span><span class="op" id="4442525">)</span>&nbsp;<span class="op" id="4442527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442530">a</span>&nbsp;<span class="op" id="4442532">:=</span>&nbsp;<span class="ident" id="4442535">re</span><span class="op" id="4442537">.</span><span class="ident" id="4442538">doExecute</span><span class="op" id="4442547">(</span><span class="ident" id="4442548">nil</span><span class="op" id="4442551">,</span>&nbsp;<span class="ident" id="4442553">nil</span><span class="op" id="4442556">,</span>&nbsp;<span class="ident" id="4442558">s</span><span class="op" id="4442559">,</span>&nbsp;<span class="num" id="4442561">0</span><span class="op" id="4442562">,</span>&nbsp;<span class="num" id="4442564">2</span><span class="op" id="4442565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442568">if</span>&nbsp;<span class="ident" id="4442571">a</span>&nbsp;<span class="op" id="4442573">==</span>&nbsp;<span class="ident" id="4442576">nil</span>&nbsp;<span class="op" id="4442580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442584">return</span>&nbsp;<span class="ident" id="4442591">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442596">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442599">return</span>&nbsp;<span class="ident" id="4442606">a</span><span class="op" id="4442607">[</span><span class="num" id="4442608">0</span><span class="op" id="4442609">:</span><span class="num" id="4442610">2</span><span class="op" id="4442611">]</span><br>
<span class="lineno"></span><span class="op" id="4442613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4442616">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4442688">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="4442766">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4442834">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="4442874">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4442919">func</span>&nbsp;<span class="op" id="4442924">(</span><span class="ident" id="4442925">re</span>&nbsp;<span class="op" id="4442928">*</span><span class="ident" id="4442929">Regexp</span><span class="op" id="4442935">)</span>&nbsp;<span class="ident" id="4442937">FindReaderIndex</span><span class="op" id="4442952">(</span><span class="ident" id="4442953">r</span>&nbsp;<span class="ident" id="4442955">io</span><span class="op" id="4442957">.</span><span class="ident" id="4442958">RuneReader</span><span class="op" id="4442968">)</span>&nbsp;<span class="op" id="4442970">(</span><span class="ident" id="4442971">loc</span>&nbsp;<span class="op" id="4442975">[</span><span class="op" id="4442976">]</span><span class="builtintype" id="4442977">int</span><span class="op" id="4442980">)</span>&nbsp;<span class="op" id="4442982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442985">a</span>&nbsp;<span class="op" id="4442987">:=</span>&nbsp;<span class="ident" id="4442990">re</span><span class="op" id="4442992">.</span><span class="ident" id="4442993">doExecute</span><span class="op" id="4443002">(</span><span class="ident" id="4443003">r</span><span class="op" id="4443004">,</span>&nbsp;<span class="ident" id="4443006">nil</span><span class="op" id="4443009">,</span>&nbsp;<span class="string" id="4443011">&#34;&#34;</span><span class="op" id="4443013">,</span>&nbsp;<span class="num" id="4443015">0</span><span class="op" id="4443016">,</span>&nbsp;<span class="num" id="4443018">2</span><span class="op" id="4443019">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443022">if</span>&nbsp;<span class="ident" id="4443025">a</span>&nbsp;<span class="op" id="4443027">==</span>&nbsp;<span class="ident" id="4443030">nil</span>&nbsp;<span class="op" id="4443034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443038">return</span>&nbsp;<span class="ident" id="4443045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443053">return</span>&nbsp;<span class="ident" id="4443060">a</span><span class="op" id="4443061">[</span><span class="num" id="4443062">0</span><span class="op" id="4443063">:</span><span class="num" id="4443064">2</span><span class="op" id="4443065">]</span><br>
<span class="lineno"></span><span class="op" id="4443067">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="4443070">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="4443145">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4443217">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4443293">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="4443305">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4443350">func</span>&nbsp;<span class="op" id="4443355">(</span><span class="ident" id="4443356">re</span>&nbsp;<span class="op" id="4443359">*</span><span class="ident" id="4443360">Regexp</span><span class="op" id="4443366">)</span>&nbsp;<span class="ident" id="4443368">FindSubmatch</span><span class="op" id="4443380">(</span><span class="ident" id="4443381">b</span>&nbsp;<span class="op" id="4443383">[</span><span class="op" id="4443384">]</span><span class="builtintype" id="4443385">byte</span><span class="op" id="4443389">)</span>&nbsp;<span class="op" id="4443391">[</span><span class="op" id="4443392">]</span><span class="op" id="4443393">[</span><span class="op" id="4443394">]</span><span class="builtintype" id="4443395">byte</span>&nbsp;<span class="op" id="4443400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443403">a</span>&nbsp;<span class="op" id="4443405">:=</span>&nbsp;<span class="ident" id="4443408">re</span><span class="op" id="4443410">.</span><span class="ident" id="4443411">doExecute</span><span class="op" id="4443420">(</span><span class="ident" id="4443421">nil</span><span class="op" id="4443424">,</span>&nbsp;<span class="ident" id="4443426">b</span><span class="op" id="4443427">,</span>&nbsp;<span class="string" id="4443429">&#34;&#34;</span><span class="op" id="4443431">,</span>&nbsp;<span class="num" id="4443433">0</span><span class="op" id="4443434">,</span>&nbsp;<span class="ident" id="4443436">re</span><span class="op" id="4443438">.</span><span class="ident" id="4443439">prog</span><span class="op" id="4443443">.</span><span class="ident" id="4443444">NumCap</span><span class="op" id="4443450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443453">if</span>&nbsp;<span class="ident" id="4443456">a</span>&nbsp;<span class="op" id="4443458">==</span>&nbsp;<span class="ident" id="4443461">nil</span>&nbsp;<span class="op" id="4443465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443469">return</span>&nbsp;<span class="ident" id="4443476">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443484">ret</span>&nbsp;<span class="op" id="4443488">:=</span>&nbsp;<span class="builtinfunc" id="4443491">make</span><span class="op" id="4443495">(</span><span class="op" id="4443496">[</span><span class="op" id="4443497">]</span><span class="op" id="4443498">[</span><span class="op" id="4443499">]</span><span class="builtintype" id="4443500">byte</span><span class="op" id="4443504">,</span>&nbsp;<span class="num" id="4443506">1</span><span class="op" id="4443507">+</span><span class="ident" id="4443508">re</span><span class="op" id="4443510">.</span><span class="ident" id="4443511">numSubexp</span><span class="op" id="4443520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443523">for</span>&nbsp;<span class="ident" id="4443527">i</span>&nbsp;<span class="op" id="4443529">:=</span>&nbsp;<span class="keyword" id="4443532">range</span>&nbsp;<span class="ident" id="4443538">ret</span>&nbsp;<span class="op" id="4443542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443546">if</span>&nbsp;<span class="num" id="4443549">2</span><span class="op" id="4443550">*</span><span class="ident" id="4443551">i</span>&nbsp;<span class="op" id="4443553">&lt;</span>&nbsp;<span class="builtinfunc" id="4443555">len</span><span class="op" id="4443558">(</span><span class="ident" id="4443559">a</span><span class="op" id="4443560">)</span>&nbsp;<span class="op" id="4443562">&amp;&amp;</span>&nbsp;<span class="ident" id="4443565">a</span><span class="op" id="4443566">[</span><span class="num" id="4443567">2</span><span class="op" id="4443568">*</span><span class="ident" id="4443569">i</span><span class="op" id="4443570">]</span>&nbsp;<span class="op" id="4443572">&gt;=</span>&nbsp;<span class="num" id="4443575">0</span>&nbsp;<span class="op" id="4443577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443582">ret</span><span class="op" id="4443585">[</span><span class="ident" id="4443586">i</span><span class="op" id="4443587">]</span>&nbsp;<span class="op" id="4443589">=</span>&nbsp;<span class="ident" id="4443591">b</span><span class="op" id="4443592">[</span><span class="ident" id="4443593">a</span><span class="op" id="4443594">[</span><span class="num" id="4443595">2</span><span class="op" id="4443596">*</span><span class="ident" id="4443597">i</span><span class="op" id="4443598">]</span><span class="op" id="4443599">:</span><span class="ident" id="4443600">a</span><span class="op" id="4443601">[</span><span class="num" id="4443602">2</span><span class="op" id="4443603">*</span><span class="ident" id="4443604">i</span><span class="op" id="4443605">+</span><span class="num" id="4443606">1</span><span class="op" id="4443607">]</span><span class="op" id="4443608">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443618">return</span>&nbsp;<span class="ident" id="4443625">ret</span><br>
<span class="lineno"></span><span class="op" id="4443629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="4443632">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4443701">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4443773">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4443846">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="4443868">//</span><br>
<span class="lineno">745</span><span class="comment" id="4443871">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4443940">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="4444008">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4444077">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4444144">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="4444209">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4444282">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="4444352">//</span><br>
<span class="lineno"></span><span class="comment" id="4444355">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4444425">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="4444504">//</span><br>
<span class="lineno"></span><span class="comment" id="4444507">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="4444571">func</span>&nbsp;<span class="op" id="4444576">(</span><span class="ident" id="4444577">re</span>&nbsp;<span class="op" id="4444580">*</span><span class="ident" id="4444581">Regexp</span><span class="op" id="4444587">)</span>&nbsp;<span class="ident" id="4444589">Expand</span><span class="op" id="4444595">(</span><span class="ident" id="4444596">dst</span>&nbsp;<span class="op" id="4444600">[</span><span class="op" id="4444601">]</span><span class="builtintype" id="4444602">byte</span><span class="op" id="4444606">,</span>&nbsp;<span class="ident" id="4444608">template</span>&nbsp;<span class="op" id="4444617">[</span><span class="op" id="4444618">]</span><span class="builtintype" id="4444619">byte</span><span class="op" id="4444623">,</span>&nbsp;<span class="ident" id="4444625">src</span>&nbsp;<span class="op" id="4444629">[</span><span class="op" id="4444630">]</span><span class="builtintype" id="4444631">byte</span><span class="op" id="4444635">,</span>&nbsp;<span class="ident" id="4444637">match</span>&nbsp;<span class="op" id="4444643">[</span><span class="op" id="4444644">]</span><span class="builtintype" id="4444645">int</span><span class="op" id="4444648">)</span>&nbsp;<span class="op" id="4444650">[</span><span class="op" id="4444651">]</span><span class="builtintype" id="4444652">byte</span>&nbsp;<span class="op" id="4444657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444660">return</span>&nbsp;<span class="ident" id="4444667">re</span><span class="op" id="4444669">.</span><span class="ident" id="4444670">expand</span><span class="op" id="4444676">(</span><span class="ident" id="4444677">dst</span><span class="op" id="4444680">,</span>&nbsp;<span class="builtintype" id="4444682">string</span><span class="op" id="4444688">(</span><span class="ident" id="4444689">template</span><span class="op" id="4444697">)</span><span class="op" id="4444698">,</span>&nbsp;<span class="ident" id="4444700">src</span><span class="op" id="4444703">,</span>&nbsp;<span class="string" id="4444705">&#34;&#34;</span><span class="op" id="4444707">,</span>&nbsp;<span class="ident" id="4444709">match</span><span class="op" id="4444714">)</span><br>
<span class="lineno"></span><span class="op" id="4444716">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="4444719">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="4444791">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4444862">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="4444895">func</span>&nbsp;<span class="op" id="4444900">(</span><span class="ident" id="4444901">re</span>&nbsp;<span class="op" id="4444904">*</span><span class="ident" id="4444905">Regexp</span><span class="op" id="4444911">)</span>&nbsp;<span class="ident" id="4444913">ExpandString</span><span class="op" id="4444925">(</span><span class="ident" id="4444926">dst</span>&nbsp;<span class="op" id="4444930">[</span><span class="op" id="4444931">]</span><span class="builtintype" id="4444932">byte</span><span class="op" id="4444936">,</span>&nbsp;<span class="ident" id="4444938">template</span>&nbsp;<span class="builtintype" id="4444947">string</span><span class="op" id="4444953">,</span>&nbsp;<span class="ident" id="4444955">src</span>&nbsp;<span class="builtintype" id="4444959">string</span><span class="op" id="4444965">,</span>&nbsp;<span class="ident" id="4444967">match</span>&nbsp;<span class="op" id="4444973">[</span><span class="op" id="4444974">]</span><span class="builtintype" id="4444975">int</span><span class="op" id="4444978">)</span>&nbsp;<span class="op" id="4444980">[</span><span class="op" id="4444981">]</span><span class="builtintype" id="4444982">byte</span>&nbsp;<span class="op" id="4444987">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444990">return</span>&nbsp;<span class="ident" id="4444997">re</span><span class="op" id="4444999">.</span><span class="ident" id="4445000">expand</span><span class="op" id="4445006">(</span><span class="ident" id="4445007">dst</span><span class="op" id="4445010">,</span>&nbsp;<span class="ident" id="4445012">template</span><span class="op" id="4445020">,</span>&nbsp;<span class="ident" id="4445022">nil</span><span class="op" id="4445025">,</span>&nbsp;<span class="ident" id="4445027">src</span><span class="op" id="4445030">,</span>&nbsp;<span class="ident" id="4445032">match</span><span class="op" id="4445037">)</span><br>
<span class="lineno"></span><span class="op" id="4445039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4445042">func</span>&nbsp;<span class="op" id="4445047">(</span><span class="ident" id="4445048">re</span>&nbsp;<span class="op" id="4445051">*</span><span class="ident" id="4445052">Regexp</span><span class="op" id="4445058">)</span>&nbsp;<span class="ident" id="4445060">expand</span><span class="op" id="4445066">(</span><span class="ident" id="4445067">dst</span>&nbsp;<span class="op" id="4445071">[</span><span class="op" id="4445072">]</span><span class="builtintype" id="4445073">byte</span><span class="op" id="4445077">,</span>&nbsp;<span class="ident" id="4445079">template</span>&nbsp;<span class="builtintype" id="4445088">string</span><span class="op" id="4445094">,</span>&nbsp;<span class="ident" id="4445096">bsrc</span>&nbsp;<span class="op" id="4445101">[</span><span class="op" id="4445102">]</span><span class="builtintype" id="4445103">byte</span><span class="op" id="4445107">,</span>&nbsp;<span class="ident" id="4445109">src</span>&nbsp;<span class="builtintype" id="4445113">string</span><span class="op" id="4445119">,</span>&nbsp;<span class="ident" id="4445121">match</span>&nbsp;<span class="op" id="4445127">[</span><span class="op" id="4445128">]</span><span class="builtintype" id="4445129">int</span><span class="op" id="4445132">)</span>&nbsp;<span class="op" id="4445134">[</span><span class="op" id="4445135">]</span><span class="builtintype" id="4445136">byte</span>&nbsp;<span class="op" id="4445141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445144">for</span>&nbsp;<span class="builtinfunc" id="4445148">len</span><span class="op" id="4445151">(</span><span class="ident" id="4445152">template</span><span class="op" id="4445160">)</span>&nbsp;<span class="op" id="4445162">&gt;</span>&nbsp;<span class="num" id="4445164">0</span>&nbsp;<span class="op" id="4445166">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445170">i</span>&nbsp;<span class="op" id="4445172">:=</span>&nbsp;<span class="ident" id="4445175">strings</span><span class="op" id="4445182">.</span><span class="ident" id="4445183">Index</span><span class="op" id="4445188">(</span><span class="ident" id="4445189">template</span><span class="op" id="4445197">,</span>&nbsp;<span class="string" id="4445199">&#34;$&#34;</span><span class="op" id="4445202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445206">if</span>&nbsp;<span class="ident" id="4445209">i</span>&nbsp;<span class="op" id="4445211">&lt;</span>&nbsp;<span class="num" id="4445213">0</span>&nbsp;<span class="op" id="4445215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445220">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445232">dst</span>&nbsp;<span class="op" id="4445236">=</span>&nbsp;<span class="builtinfunc" id="4445238">append</span><span class="op" id="4445244">(</span><span class="ident" id="4445245">dst</span><span class="op" id="4445248">,</span>&nbsp;<span class="ident" id="4445250">template</span><span class="op" id="4445258">[</span><span class="op" id="4445259">:</span><span class="ident" id="4445260">i</span><span class="op" id="4445261">]</span><span class="op" id="4445262">...</span><span class="op" id="4445265">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445269">template</span>&nbsp;<span class="op" id="4445278">=</span>&nbsp;<span class="ident" id="4445280">template</span><span class="op" id="4445288">[</span><span class="ident" id="4445289">i</span><span class="op" id="4445290">:</span><span class="op" id="4445291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445295">if</span>&nbsp;<span class="builtinfunc" id="4445298">len</span><span class="op" id="4445301">(</span><span class="ident" id="4445302">template</span><span class="op" id="4445310">)</span>&nbsp;<span class="op" id="4445312">&gt;</span>&nbsp;<span class="num" id="4445314">1</span>&nbsp;<span class="op" id="4445316">&amp;&amp;</span>&nbsp;<span class="ident" id="4445319">template</span><span class="op" id="4445327">[</span><span class="num" id="4445328">1</span><span class="op" id="4445329">]</span>&nbsp;<span class="op" id="4445331">==</span>&nbsp;<span class="string" id="4445334">&#39;$&#39;</span>&nbsp;<span class="op" id="4445338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445343">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445364">dst</span>&nbsp;<span class="op" id="4445368">=</span>&nbsp;<span class="builtinfunc" id="4445370">append</span><span class="op" id="4445376">(</span><span class="ident" id="4445377">dst</span><span class="op" id="4445380">,</span>&nbsp;<span class="string" id="4445382">&#39;$&#39;</span><span class="op" id="4445385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445390">template</span>&nbsp;<span class="op" id="4445399">=</span>&nbsp;<span class="ident" id="4445401">template</span><span class="op" id="4445409">[</span><span class="num" id="4445410">2</span><span class="op" id="4445411">:</span><span class="op" id="4445412">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445432">name</span><span class="op" id="4445436">,</span>&nbsp;<span class="ident" id="4445438">num</span><span class="op" id="4445441">,</span>&nbsp;<span class="ident" id="4445443">rest</span><span class="op" id="4445447">,</span>&nbsp;<span class="ident" id="4445449">ok</span>&nbsp;<span class="op" id="4445452">:=</span>&nbsp;<span class="ident" id="4445455">extract</span><span class="op" id="4445462">(</span><span class="ident" id="4445463">template</span><span class="op" id="4445471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445475">if</span>&nbsp;<span class="op" id="4445478">!</span><span class="ident" id="4445479">ok</span>&nbsp;<span class="op" id="4445482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445487">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445525">dst</span>&nbsp;<span class="op" id="4445529">=</span>&nbsp;<span class="builtinfunc" id="4445531">append</span><span class="op" id="4445537">(</span><span class="ident" id="4445538">dst</span><span class="op" id="4445541">,</span>&nbsp;<span class="string" id="4445543">&#39;$&#39;</span><span class="op" id="4445546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445551">template</span>&nbsp;<span class="op" id="4445560">=</span>&nbsp;<span class="ident" id="4445562">template</span><span class="op" id="4445570">[</span><span class="num" id="4445571">1</span><span class="op" id="4445572">:</span><span class="op" id="4445573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445578">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445593">template</span>&nbsp;<span class="op" id="4445602">=</span>&nbsp;<span class="ident" id="4445604">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445611">if</span>&nbsp;<span class="ident" id="4445614">num</span>&nbsp;<span class="op" id="4445618">&gt;=</span>&nbsp;<span class="num" id="4445621">0</span>&nbsp;<span class="op" id="4445623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445628">if</span>&nbsp;<span class="num" id="4445631">2</span><span class="op" id="4445632">*</span><span class="ident" id="4445633">num</span><span class="op" id="4445636">+</span><span class="num" id="4445637">1</span>&nbsp;<span class="op" id="4445639">&lt;</span>&nbsp;<span class="builtinfunc" id="4445641">len</span><span class="op" id="4445644">(</span><span class="ident" id="4445645">match</span><span class="op" id="4445650">)</span>&nbsp;<span class="op" id="4445652">&amp;&amp;</span>&nbsp;<span class="ident" id="4445655">match</span><span class="op" id="4445660">[</span><span class="num" id="4445661">2</span><span class="op" id="4445662">*</span><span class="ident" id="4445663">num</span><span class="op" id="4445666">]</span>&nbsp;<span class="op" id="4445668">&gt;=</span>&nbsp;<span class="num" id="4445671">0</span>&nbsp;<span class="op" id="4445673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445679">if</span>&nbsp;<span class="ident" id="4445682">bsrc</span>&nbsp;<span class="op" id="4445687">!=</span>&nbsp;<span class="ident" id="4445690">nil</span>&nbsp;<span class="op" id="4445694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445701">dst</span>&nbsp;<span class="op" id="4445705">=</span>&nbsp;<span class="builtinfunc" id="4445707">append</span><span class="op" id="4445713">(</span><span class="ident" id="4445714">dst</span><span class="op" id="4445717">,</span>&nbsp;<span class="ident" id="4445719">bsrc</span><span class="op" id="4445723">[</span><span class="ident" id="4445724">match</span><span class="op" id="4445729">[</span><span class="num" id="4445730">2</span><span class="op" id="4445731">*</span><span class="ident" id="4445732">num</span><span class="op" id="4445735">]</span><span class="op" id="4445736">:</span><span class="ident" id="4445737">match</span><span class="op" id="4445742">[</span><span class="num" id="4445743">2</span><span class="op" id="4445744">*</span><span class="ident" id="4445745">num</span><span class="op" id="4445748">+</span><span class="num" id="4445749">1</span><span class="op" id="4445750">]</span><span class="op" id="4445751">]</span><span class="op" id="4445752">...</span><span class="op" id="4445755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445761">}</span>&nbsp;<span class="keyword" id="4445763">else</span>&nbsp;<span class="op" id="4445768">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445775">dst</span>&nbsp;<span class="op" id="4445779">=</span>&nbsp;<span class="builtinfunc" id="4445781">append</span><span class="op" id="4445787">(</span><span class="ident" id="4445788">dst</span><span class="op" id="4445791">,</span>&nbsp;<span class="ident" id="4445793">src</span><span class="op" id="4445796">[</span><span class="ident" id="4445797">match</span><span class="op" id="4445802">[</span><span class="num" id="4445803">2</span><span class="op" id="4445804">*</span><span class="ident" id="4445805">num</span><span class="op" id="4445808">]</span><span class="op" id="4445809">:</span><span class="ident" id="4445810">match</span><span class="op" id="4445815">[</span><span class="num" id="4445816">2</span><span class="op" id="4445817">*</span><span class="ident" id="4445818">num</span><span class="op" id="4445821">+</span><span class="num" id="4445822">1</span><span class="op" id="4445823">]</span><span class="op" id="4445824">]</span><span class="op" id="4445825">...</span><span class="op" id="4445828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445843">}</span>&nbsp;<span class="keyword" id="4445845">else</span>&nbsp;<span class="op" id="4445850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445855">for</span>&nbsp;<span class="ident" id="4445859">i</span><span class="op" id="4445860">,</span>&nbsp;<span class="ident" id="4445862">namei</span>&nbsp;<span class="op" id="4445868">:=</span>&nbsp;<span class="keyword" id="4445871">range</span>&nbsp;<span class="ident" id="4445877">re</span><span class="op" id="4445879">.</span><span class="ident" id="4445880">subexpNames</span>&nbsp;<span class="op" id="4445892">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445898">if</span>&nbsp;<span class="ident" id="4445901">name</span>&nbsp;<span class="op" id="4445906">==</span>&nbsp;<span class="ident" id="4445909">namei</span>&nbsp;<span class="op" id="4445915">&amp;&amp;</span>&nbsp;<span class="num" id="4445918">2</span><span class="op" id="4445919">*</span><span class="ident" id="4445920">i</span><span class="op" id="4445921">+</span><span class="num" id="4445922">1</span>&nbsp;<span class="op" id="4445924">&lt;</span>&nbsp;<span class="builtinfunc" id="4445926">len</span><span class="op" id="4445929">(</span><span class="ident" id="4445930">match</span><span class="op" id="4445935">)</span>&nbsp;<span class="op" id="4445937">&amp;&amp;</span>&nbsp;<span class="ident" id="4445940">match</span><span class="op" id="4445945">[</span><span class="num" id="4445946">2</span><span class="op" id="4445947">*</span><span class="ident" id="4445948">i</span><span class="op" id="4445949">]</span>&nbsp;<span class="op" id="4445951">&gt;=</span>&nbsp;<span class="num" id="4445954">0</span>&nbsp;<span class="op" id="4445956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445963">if</span>&nbsp;<span class="ident" id="4445966">bsrc</span>&nbsp;<span class="op" id="4445971">!=</span>&nbsp;<span class="ident" id="4445974">nil</span>&nbsp;<span class="op" id="4445978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445986">dst</span>&nbsp;<span class="op" id="4445990">=</span>&nbsp;<span class="builtinfunc" id="4445992">append</span><span class="op" id="4445998">(</span><span class="ident" id="4445999">dst</span><span class="op" id="4446002">,</span>&nbsp;<span class="ident" id="4446004">bsrc</span><span class="op" id="4446008">[</span><span class="ident" id="4446009">match</span><span class="op" id="4446014">[</span><span class="num" id="4446015">2</span><span class="op" id="4446016">*</span><span class="ident" id="4446017">i</span><span class="op" id="4446018">]</span><span class="op" id="4446019">:</span><span class="ident" id="4446020">match</span><span class="op" id="4446025">[</span><span class="num" id="4446026">2</span><span class="op" id="4446027">*</span><span class="ident" id="4446028">i</span><span class="op" id="4446029">+</span><span class="num" id="4446030">1</span><span class="op" id="4446031">]</span><span class="op" id="4446032">]</span><span class="op" id="4446033">...</span><span class="op" id="4446036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446043">}</span>&nbsp;<span class="keyword" id="4446045">else</span>&nbsp;<span class="op" id="4446050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446058">dst</span>&nbsp;<span class="op" id="4446062">=</span>&nbsp;<span class="builtinfunc" id="4446064">append</span><span class="op" id="4446070">(</span><span class="ident" id="4446071">dst</span><span class="op" id="4446074">,</span>&nbsp;<span class="ident" id="4446076">src</span><span class="op" id="4446079">[</span><span class="ident" id="4446080">match</span><span class="op" id="4446085">[</span><span class="num" id="4446086">2</span><span class="op" id="4446087">*</span><span class="ident" id="4446088">i</span><span class="op" id="4446089">]</span><span class="op" id="4446090">:</span><span class="ident" id="4446091">match</span><span class="op" id="4446096">[</span><span class="num" id="4446097">2</span><span class="op" id="4446098">*</span><span class="ident" id="4446099">i</span><span class="op" id="4446100">+</span><span class="num" id="4446101">1</span><span class="op" id="4446102">]</span><span class="op" id="4446103">]</span><span class="op" id="4446104">...</span><span class="op" id="4446107">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446121">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446140">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446146">dst</span>&nbsp;<span class="op" id="4446150">=</span>&nbsp;<span class="builtinfunc" id="4446152">append</span><span class="op" id="4446158">(</span><span class="ident" id="4446159">dst</span><span class="op" id="4446162">,</span>&nbsp;<span class="ident" id="4446164">template</span><span class="op" id="4446172">...</span><span class="op" id="4446175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446178">return</span>&nbsp;<span class="ident" id="4446185">dst</span><br>
<span class="lineno"></span><span class="op" id="4446189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="4446192">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="4446264">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="4446346">func</span>&nbsp;<span class="ident" id="4446351">extract</span><span class="op" id="4446358">(</span><span class="ident" id="4446359">str</span>&nbsp;<span class="builtintype" id="4446363">string</span><span class="op" id="4446369">)</span>&nbsp;<span class="op" id="4446371">(</span><span class="ident" id="4446372">name</span>&nbsp;<span class="builtintype" id="4446377">string</span><span class="op" id="4446383">,</span>&nbsp;<span class="ident" id="4446385">num</span>&nbsp;<span class="builtintype" id="4446389">int</span><span class="op" id="4446392">,</span>&nbsp;<span class="ident" id="4446394">rest</span>&nbsp;<span class="builtintype" id="4446399">string</span><span class="op" id="4446405">,</span>&nbsp;<span class="ident" id="4446407">ok</span>&nbsp;<span class="builtintype" id="4446410">bool</span><span class="op" id="4446414">)</span>&nbsp;<span class="op" id="4446416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446419">if</span>&nbsp;<span class="builtinfunc" id="4446422">len</span><span class="op" id="4446425">(</span><span class="ident" id="4446426">str</span><span class="op" id="4446429">)</span>&nbsp;<span class="op" id="4446431">&lt;</span>&nbsp;<span class="num" id="4446433">2</span>&nbsp;<span class="op" id="4446435">||</span>&nbsp;<span class="ident" id="4446438">str</span><span class="op" id="4446441">[</span><span class="num" id="4446442">0</span><span class="op" id="4446443">]</span>&nbsp;<span class="op" id="4446445">!=</span>&nbsp;<span class="string" id="4446448">&#39;$&#39;</span>&nbsp;<span class="op" id="4446452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446456">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446467">brace</span>&nbsp;<span class="op" id="4446473">:=</span>&nbsp;<span class="builtintype" id="4446476">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446483">if</span>&nbsp;<span class="ident" id="4446486">str</span><span class="op" id="4446489">[</span><span class="num" id="4446490">1</span><span class="op" id="4446491">]</span>&nbsp;<span class="op" id="4446493">==</span>&nbsp;<span class="string" id="4446496">&#39;{&#39;</span>&nbsp;<span class="op" id="4446500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446504">brace</span>&nbsp;<span class="op" id="4446510">=</span>&nbsp;<span class="builtintype" id="4446512">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446519">str</span>&nbsp;<span class="op" id="4446523">=</span>&nbsp;<span class="ident" id="4446525">str</span><span class="op" id="4446528">[</span><span class="num" id="4446529">2</span><span class="op" id="4446530">:</span><span class="op" id="4446531">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446534">}</span>&nbsp;<span class="keyword" id="4446536">else</span>&nbsp;<span class="op" id="4446541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446545">str</span>&nbsp;<span class="op" id="4446549">=</span>&nbsp;<span class="ident" id="4446551">str</span><span class="op" id="4446554">[</span><span class="num" id="4446555">1</span><span class="op" id="4446556">:</span><span class="op" id="4446557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446563">i</span>&nbsp;<span class="op" id="4446565">:=</span>&nbsp;<span class="num" id="4446568">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446571">for</span>&nbsp;<span class="ident" id="4446575">i</span>&nbsp;<span class="op" id="4446577">&lt;</span>&nbsp;<span class="builtinfunc" id="4446579">len</span><span class="op" id="4446582">(</span><span class="ident" id="4446583">str</span><span class="op" id="4446586">)</span>&nbsp;<span class="op" id="4446588">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4446592">rune</span><span class="op" id="4446596">,</span>&nbsp;<span class="ident" id="4446598">size</span>&nbsp;<span class="op" id="4446603">:=</span>&nbsp;<span class="ident" id="4446606">utf8</span><span class="op" id="4446610">.</span><span class="ident" id="4446611">DecodeRuneInString</span><span class="op" id="4446629">(</span><span class="ident" id="4446630">str</span><span class="op" id="4446633">[</span><span class="ident" id="4446634">i</span><span class="op" id="4446635">:</span><span class="op" id="4446636">]</span><span class="op" id="4446637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446641">if</span>&nbsp;<span class="op" id="4446644">!</span><span class="ident" id="4446645">unicode</span><span class="op" id="4446652">.</span><span class="ident" id="4446653">IsLetter</span><span class="op" id="4446661">(</span><span class="builtintype" id="4446662">rune</span><span class="op" id="4446666">)</span>&nbsp;<span class="op" id="4446668">&amp;&amp;</span>&nbsp;<span class="op" id="4446671">!</span><span class="ident" id="4446672">unicode</span><span class="op" id="4446679">.</span><span class="ident" id="4446680">IsDigit</span><span class="op" id="4446687">(</span><span class="builtintype" id="4446688">rune</span><span class="op" id="4446692">)</span>&nbsp;<span class="op" id="4446694">&amp;&amp;</span>&nbsp;<span class="builtintype" id="4446697">rune</span>&nbsp;<span class="op" id="4446702">!=</span>&nbsp;<span class="string" id="4446705">&#39;_&#39;</span>&nbsp;<span class="op" id="4446709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446714">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446726">i</span>&nbsp;<span class="op" id="4446728">+=</span>&nbsp;<span class="ident" id="4446731">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446740">if</span>&nbsp;<span class="ident" id="4446743">i</span>&nbsp;<span class="op" id="4446745">==</span>&nbsp;<span class="num" id="4446748">0</span>&nbsp;<span class="op" id="4446750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446754">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446782">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446790">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446793">name</span>&nbsp;<span class="op" id="4446798">=</span>&nbsp;<span class="ident" id="4446800">str</span><span class="op" id="4446803">[</span><span class="op" id="4446804">:</span><span class="ident" id="4446805">i</span><span class="op" id="4446806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446809">if</span>&nbsp;<span class="ident" id="4446812">brace</span>&nbsp;<span class="op" id="4446818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446822">if</span>&nbsp;<span class="ident" id="4446825">i</span>&nbsp;<span class="op" id="4446827">&gt;=</span>&nbsp;<span class="builtinfunc" id="4446830">len</span><span class="op" id="4446833">(</span><span class="ident" id="4446834">str</span><span class="op" id="4446837">)</span>&nbsp;<span class="op" id="4446839">||</span>&nbsp;<span class="ident" id="4446842">str</span><span class="op" id="4446845">[</span><span class="ident" id="4446846">i</span><span class="op" id="4446847">]</span>&nbsp;<span class="op" id="4446849">!=</span>&nbsp;<span class="string" id="4446852">&#39;}&#39;</span>&nbsp;<span class="op" id="4446856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446861">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446889">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446902">i</span><span class="op" id="4446903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446911">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446929">num</span>&nbsp;<span class="op" id="4446933">=</span>&nbsp;<span class="num" id="4446935">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446938">for</span>&nbsp;<span class="ident" id="4446942">i</span>&nbsp;<span class="op" id="4446944">:=</span>&nbsp;<span class="num" id="4446947">0</span><span class="op" id="4446948">;</span>&nbsp;<span class="ident" id="4446950">i</span>&nbsp;<span class="op" id="4446952">&lt;</span>&nbsp;<span class="builtinfunc" id="4446954">len</span><span class="op" id="4446957">(</span><span class="ident" id="4446958">name</span><span class="op" id="4446962">)</span><span class="op" id="4446963">;</span>&nbsp;<span class="ident" id="4446965">i</span><span class="op" id="4446966">++</span>&nbsp;<span class="op" id="4446969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446973">if</span>&nbsp;<span class="ident" id="4446976">name</span><span class="op" id="4446980">[</span><span class="ident" id="4446981">i</span><span class="op" id="4446982">]</span>&nbsp;<span class="op" id="4446984">&lt;</span>&nbsp;<span class="string" id="4446986">&#39;0&#39;</span>&nbsp;<span class="op" id="4446990">||</span>&nbsp;<span class="string" id="4446993">&#39;9&#39;</span>&nbsp;<span class="op" id="4446997">&lt;</span>&nbsp;<span class="ident" id="4446999">name</span><span class="op" id="4447003">[</span><span class="ident" id="4447004">i</span><span class="op" id="4447005">]</span>&nbsp;<span class="op" id="4447007">||</span>&nbsp;<span class="ident" id="4447010">num</span>&nbsp;<span class="op" id="4447014">&gt;=</span>&nbsp;<span class="num" id="4447017">1e8</span>&nbsp;<span class="op" id="4447021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447026">num</span>&nbsp;<span class="op" id="4447030">=</span>&nbsp;<span class="op" id="4447032">-</span><span class="num" id="4447033">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447038">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447050">num</span>&nbsp;<span class="op" id="4447054">=</span>&nbsp;<span class="ident" id="4447056">num</span><span class="op" id="4447059">*</span><span class="num" id="4447060">10</span>&nbsp;<span class="op" id="4447063">+</span>&nbsp;<span class="builtintype" id="4447065">int</span><span class="op" id="4447068">(</span><span class="ident" id="4447069">name</span><span class="op" id="4447073">[</span><span class="ident" id="4447074">i</span><span class="op" id="4447075">]</span><span class="op" id="4447076">)</span>&nbsp;<span class="op" id="4447078">-</span>&nbsp;<span class="string" id="4447080">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447088">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447116">if</span>&nbsp;<span class="ident" id="4447119">name</span><span class="op" id="4447123">[</span><span class="num" id="4447124">0</span><span class="op" id="4447125">]</span>&nbsp;<span class="op" id="4447127">==</span>&nbsp;<span class="string" id="4447130">&#39;0&#39;</span>&nbsp;<span class="op" id="4447134">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4447137">len</span><span class="op" id="4447140">(</span><span class="ident" id="4447141">name</span><span class="op" id="4447145">)</span>&nbsp;<span class="op" id="4447147">&gt;</span>&nbsp;<span class="num" id="4447149">1</span>&nbsp;<span class="op" id="4447151">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447155">num</span>&nbsp;<span class="op" id="4447159">=</span>&nbsp;<span class="op" id="4447161">-</span><span class="num" id="4447162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447169">rest</span>&nbsp;<span class="op" id="4447174">=</span>&nbsp;<span class="ident" id="4447176">str</span><span class="op" id="4447179">[</span><span class="ident" id="4447180">i</span><span class="op" id="4447181">:</span><span class="op" id="4447182">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447185">ok</span>&nbsp;<span class="op" id="4447188">=</span>&nbsp;<span class="builtintype" id="4447190">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447196">return</span><br>
<span class="lineno"></span><span class="op" id="4447203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447206">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4447283">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="4447360">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="4447437">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4447464">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4447509">func</span>&nbsp;<span class="op" id="4447514">(</span><span class="ident" id="4447515">re</span>&nbsp;<span class="op" id="4447518">*</span><span class="ident" id="4447519">Regexp</span><span class="op" id="4447525">)</span>&nbsp;<span class="ident" id="4447527">FindSubmatchIndex</span><span class="op" id="4447544">(</span><span class="ident" id="4447545">b</span>&nbsp;<span class="op" id="4447547">[</span><span class="op" id="4447548">]</span><span class="builtintype" id="4447549">byte</span><span class="op" id="4447553">)</span>&nbsp;<span class="op" id="4447555">[</span><span class="op" id="4447556">]</span><span class="builtintype" id="4447557">int</span>&nbsp;<span class="op" id="4447561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447564">return</span>&nbsp;<span class="ident" id="4447571">re</span><span class="op" id="4447573">.</span><span class="ident" id="4447574">pad</span><span class="op" id="4447577">(</span><span class="ident" id="4447578">re</span><span class="op" id="4447580">.</span><span class="ident" id="4447581">doExecute</span><span class="op" id="4447590">(</span><span class="ident" id="4447591">nil</span><span class="op" id="4447594">,</span>&nbsp;<span class="ident" id="4447596">b</span><span class="op" id="4447597">,</span>&nbsp;<span class="string" id="4447599">&#34;&#34;</span><span class="op" id="4447601">,</span>&nbsp;<span class="num" id="4447603">0</span><span class="op" id="4447604">,</span>&nbsp;<span class="ident" id="4447606">re</span><span class="op" id="4447608">.</span><span class="ident" id="4447609">prog</span><span class="op" id="4447613">.</span><span class="ident" id="4447614">NumCap</span><span class="op" id="4447620">)</span><span class="op" id="4447621">)</span><br>
<span class="lineno">875</span><span class="op" id="4447623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447626">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4447699">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4447776">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="4447847">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4447867">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4447912">func</span>&nbsp;<span class="op" id="4447917">(</span><span class="ident" id="4447918">re</span>&nbsp;<span class="op" id="4447921">*</span><span class="ident" id="4447922">Regexp</span><span class="op" id="4447928">)</span>&nbsp;<span class="ident" id="4447930">FindStringSubmatch</span><span class="op" id="4447948">(</span><span class="ident" id="4447949">s</span>&nbsp;<span class="builtintype" id="4447951">string</span><span class="op" id="4447957">)</span>&nbsp;<span class="op" id="4447959">[</span><span class="op" id="4447960">]</span><span class="builtintype" id="4447961">string</span>&nbsp;<span class="op" id="4447968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447971">a</span>&nbsp;<span class="op" id="4447973">:=</span>&nbsp;<span class="ident" id="4447976">re</span><span class="op" id="4447978">.</span><span class="ident" id="4447979">doExecute</span><span class="op" id="4447988">(</span><span class="ident" id="4447989">nil</span><span class="op" id="4447992">,</span>&nbsp;<span class="ident" id="4447994">nil</span><span class="op" id="4447997">,</span>&nbsp;<span class="ident" id="4447999">s</span><span class="op" id="4448000">,</span>&nbsp;<span class="num" id="4448002">0</span><span class="op" id="4448003">,</span>&nbsp;<span class="ident" id="4448005">re</span><span class="op" id="4448007">.</span><span class="ident" id="4448008">prog</span><span class="op" id="4448012">.</span><span class="ident" id="4448013">NumCap</span><span class="op" id="4448019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448022">if</span>&nbsp;<span class="ident" id="4448025">a</span>&nbsp;<span class="op" id="4448027">==</span>&nbsp;<span class="ident" id="4448030">nil</span>&nbsp;<span class="op" id="4448034">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448038">return</span>&nbsp;<span class="ident" id="4448045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448053">ret</span>&nbsp;<span class="op" id="4448057">:=</span>&nbsp;<span class="builtinfunc" id="4448060">make</span><span class="op" id="4448064">(</span><span class="op" id="4448065">[</span><span class="op" id="4448066">]</span><span class="builtintype" id="4448067">string</span><span class="op" id="4448073">,</span>&nbsp;<span class="num" id="4448075">1</span><span class="op" id="4448076">+</span><span class="ident" id="4448077">re</span><span class="op" id="4448079">.</span><span class="ident" id="4448080">numSubexp</span><span class="op" id="4448089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448092">for</span>&nbsp;<span class="ident" id="4448096">i</span>&nbsp;<span class="op" id="4448098">:=</span>&nbsp;<span class="keyword" id="4448101">range</span>&nbsp;<span class="ident" id="4448107">ret</span>&nbsp;<span class="op" id="4448111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448115">if</span>&nbsp;<span class="num" id="4448118">2</span><span class="op" id="4448119">*</span><span class="ident" id="4448120">i</span>&nbsp;<span class="op" id="4448122">&lt;</span>&nbsp;<span class="builtinfunc" id="4448124">len</span><span class="op" id="4448127">(</span><span class="ident" id="4448128">a</span><span class="op" id="4448129">)</span>&nbsp;<span class="op" id="4448131">&amp;&amp;</span>&nbsp;<span class="ident" id="4448134">a</span><span class="op" id="4448135">[</span><span class="num" id="4448136">2</span><span class="op" id="4448137">*</span><span class="ident" id="4448138">i</span><span class="op" id="4448139">]</span>&nbsp;<span class="op" id="4448141">&gt;=</span>&nbsp;<span class="num" id="4448144">0</span>&nbsp;<span class="op" id="4448146">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448151">ret</span><span class="op" id="4448154">[</span><span class="ident" id="4448155">i</span><span class="op" id="4448156">]</span>&nbsp;<span class="op" id="4448158">=</span>&nbsp;<span class="ident" id="4448160">s</span><span class="op" id="4448161">[</span><span class="ident" id="4448162">a</span><span class="op" id="4448163">[</span><span class="num" id="4448164">2</span><span class="op" id="4448165">*</span><span class="ident" id="4448166">i</span><span class="op" id="4448167">]</span><span class="op" id="4448168">:</span><span class="ident" id="4448169">a</span><span class="op" id="4448170">[</span><span class="num" id="4448171">2</span><span class="op" id="4448172">*</span><span class="ident" id="4448173">i</span><span class="op" id="4448174">+</span><span class="num" id="4448175">1</span><span class="op" id="4448176">]</span><span class="op" id="4448177">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448187">return</span>&nbsp;<span class="ident" id="4448194">ret</span><br>
<span class="lineno"></span><span class="op" id="4448198">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="4448201">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4448268">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4448341">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4448417">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="4448465">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4448510">func</span>&nbsp;<span class="op" id="4448515">(</span><span class="ident" id="4448516">re</span>&nbsp;<span class="op" id="4448519">*</span><span class="ident" id="4448520">Regexp</span><span class="op" id="4448526">)</span>&nbsp;<span class="ident" id="4448528">FindStringSubmatchIndex</span><span class="op" id="4448551">(</span><span class="ident" id="4448552">s</span>&nbsp;<span class="builtintype" id="4448554">string</span><span class="op" id="4448560">)</span>&nbsp;<span class="op" id="4448562">[</span><span class="op" id="4448563">]</span><span class="builtintype" id="4448564">int</span>&nbsp;<span class="op" id="4448568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448571">return</span>&nbsp;<span class="ident" id="4448578">re</span><span class="op" id="4448580">.</span><span class="ident" id="4448581">pad</span><span class="op" id="4448584">(</span><span class="ident" id="4448585">re</span><span class="op" id="4448587">.</span><span class="ident" id="4448588">doExecute</span><span class="op" id="4448597">(</span><span class="ident" id="4448598">nil</span><span class="op" id="4448601">,</span>&nbsp;<span class="ident" id="4448603">nil</span><span class="op" id="4448606">,</span>&nbsp;<span class="ident" id="4448608">s</span><span class="op" id="4448609">,</span>&nbsp;<span class="num" id="4448611">0</span><span class="op" id="4448612">,</span>&nbsp;<span class="ident" id="4448614">re</span><span class="op" id="4448616">.</span><span class="ident" id="4448617">prog</span><span class="op" id="4448621">.</span><span class="ident" id="4448622">NumCap</span><span class="op" id="4448628">)</span><span class="op" id="4448629">)</span><br>
<span class="lineno"></span><span class="op" id="4448631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4448634">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4448701">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4448777">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="4448855">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="4448928">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="4448971">func</span>&nbsp;<span class="op" id="4448976">(</span><span class="ident" id="4448977">re</span>&nbsp;<span class="op" id="4448980">*</span><span class="ident" id="4448981">Regexp</span><span class="op" id="4448987">)</span>&nbsp;<span class="ident" id="4448989">FindReaderSubmatchIndex</span><span class="op" id="4449012">(</span><span class="ident" id="4449013">r</span>&nbsp;<span class="ident" id="4449015">io</span><span class="op" id="4449017">.</span><span class="ident" id="4449018">RuneReader</span><span class="op" id="4449028">)</span>&nbsp;<span class="op" id="4449030">[</span><span class="op" id="4449031">]</span><span class="builtintype" id="4449032">int</span>&nbsp;<span class="op" id="4449036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449039">return</span>&nbsp;<span class="ident" id="4449046">re</span><span class="op" id="4449048">.</span><span class="ident" id="4449049">pad</span><span class="op" id="4449052">(</span><span class="ident" id="4449053">re</span><span class="op" id="4449055">.</span><span class="ident" id="4449056">doExecute</span><span class="op" id="4449065">(</span><span class="ident" id="4449066">r</span><span class="op" id="4449067">,</span>&nbsp;<span class="ident" id="4449069">nil</span><span class="op" id="4449072">,</span>&nbsp;<span class="string" id="4449074">&#34;&#34;</span><span class="op" id="4449076">,</span>&nbsp;<span class="num" id="4449078">0</span><span class="op" id="4449079">,</span>&nbsp;<span class="ident" id="4449081">re</span><span class="op" id="4449083">.</span><span class="ident" id="4449084">prog</span><span class="op" id="4449088">.</span><span class="ident" id="4449089">NumCap</span><span class="op" id="4449095">)</span><span class="op" id="4449096">)</span><br>
<span class="lineno"></span><span class="op" id="4449098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4449101">const</span>&nbsp;<span class="ident" id="4449107">startSize</span>&nbsp;<span class="op" id="4449117">=</span>&nbsp;<span class="num" id="4449119">10</span>&nbsp;<span class="comment" id="4449122">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="4449184">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="4449262">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4449335">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4449355">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="4449400">func</span>&nbsp;<span class="op" id="4449405">(</span><span class="ident" id="4449406">re</span>&nbsp;<span class="op" id="4449409">*</span><span class="ident" id="4449410">Regexp</span><span class="op" id="4449416">)</span>&nbsp;<span class="ident" id="4449418">FindAll</span><span class="op" id="4449425">(</span><span class="ident" id="4449426">b</span>&nbsp;<span class="op" id="4449428">[</span><span class="op" id="4449429">]</span><span class="builtintype" id="4449430">byte</span><span class="op" id="4449434">,</span>&nbsp;<span class="ident" id="4449436">n</span>&nbsp;<span class="builtintype" id="4449438">int</span><span class="op" id="4449441">)</span>&nbsp;<span class="op" id="4449443">[</span><span class="op" id="4449444">]</span><span class="op" id="4449445">[</span><span class="op" id="4449446">]</span><span class="builtintype" id="4449447">byte</span>&nbsp;<span class="op" id="4449452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449455">if</span>&nbsp;<span class="ident" id="4449458">n</span>&nbsp;<span class="op" id="4449460">&lt;</span>&nbsp;<span class="num" id="4449462">0</span>&nbsp;<span class="op" id="4449464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449468">n</span>&nbsp;<span class="op" id="4449470">=</span>&nbsp;<span class="builtinfunc" id="4449472">len</span><span class="op" id="4449475">(</span><span class="ident" id="4449476">b</span><span class="op" id="4449477">)</span>&nbsp;<span class="op" id="4449479">+</span>&nbsp;<span class="num" id="4449481">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449487">result</span>&nbsp;<span class="op" id="4449494">:=</span>&nbsp;<span class="builtinfunc" id="4449497">make</span><span class="op" id="4449501">(</span><span class="op" id="4449502">[</span><span class="op" id="4449503">]</span><span class="op" id="4449504">[</span><span class="op" id="4449505">]</span><span class="builtintype" id="4449506">byte</span><span class="op" id="4449510">,</span>&nbsp;<span class="num" id="4449512">0</span><span class="op" id="4449513">,</span>&nbsp;<span class="ident" id="4449515">startSize</span><span class="op" id="4449524">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449527">re</span><span class="op" id="4449529">.</span><span class="ident" id="4449530">allMatches</span><span class="op" id="4449540">(</span><span class="string" id="4449541">&#34;&#34;</span><span class="op" id="4449543">,</span>&nbsp;<span class="ident" id="4449545">b</span><span class="op" id="4449546">,</span>&nbsp;<span class="ident" id="4449548">n</span><span class="op" id="4449549">,</span>&nbsp;<span class="keyword" id="4449551">func</span><span class="op" id="4449555">(</span><span class="ident" id="4449556">match</span>&nbsp;<span class="op" id="4449562">[</span><span class="op" id="4449563">]</span><span class="builtintype" id="4449564">int</span><span class="op" id="4449567">)</span>&nbsp;<span class="op" id="4449569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449573">result</span>&nbsp;<span class="op" id="4449580">=</span>&nbsp;<span class="builtinfunc" id="4449582">append</span><span class="op" id="4449588">(</span><span class="ident" id="4449589">result</span><span class="op" id="4449595">,</span>&nbsp;<span class="ident" id="4449597">b</span><span class="op" id="4449598">[</span><span class="ident" id="4449599">match</span><span class="op" id="4449604">[</span><span class="num" id="4449605">0</span><span class="op" id="4449606">]</span><span class="op" id="4449607">:</span><span class="ident" id="4449608">match</span><span class="op" id="4449613">[</span><span class="num" id="4449614">1</span><span class="op" id="4449615">]</span><span class="op" id="4449616">]</span><span class="op" id="4449617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449620">}</span><span class="op" id="4449621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449624">if</span>&nbsp;<span class="builtinfunc" id="4449627">len</span><span class="op" id="4449630">(</span><span class="ident" id="4449631">result</span><span class="op" id="4449637">)</span>&nbsp;<span class="op" id="4449639">==</span>&nbsp;<span class="num" id="4449642">0</span>&nbsp;<span class="op" id="4449644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449648">return</span>&nbsp;<span class="ident" id="4449655">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449663">return</span>&nbsp;<span class="ident" id="4449670">result</span><br>
<span class="lineno"></span><span class="op" id="4449677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449680">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="4449757">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="4449834">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4449861">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4449906">func</span>&nbsp;<span class="op" id="4449911">(</span><span class="ident" id="4449912">re</span>&nbsp;<span class="op" id="4449915">*</span><span class="ident" id="4449916">Regexp</span><span class="op" id="4449922">)</span>&nbsp;<span class="ident" id="4449924">FindAllIndex</span><span class="op" id="4449936">(</span><span class="ident" id="4449937">b</span>&nbsp;<span class="op" id="4449939">[</span><span class="op" id="4449940">]</span><span class="builtintype" id="4449941">byte</span><span class="op" id="4449945">,</span>&nbsp;<span class="ident" id="4449947">n</span>&nbsp;<span class="builtintype" id="4449949">int</span><span class="op" id="4449952">)</span>&nbsp;<span class="op" id="4449954">[</span><span class="op" id="4449955">]</span><span class="op" id="4449956">[</span><span class="op" id="4449957">]</span><span class="builtintype" id="4449958">int</span>&nbsp;<span class="op" id="4449962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449965">if</span>&nbsp;<span class="ident" id="4449968">n</span>&nbsp;<span class="op" id="4449970">&lt;</span>&nbsp;<span class="num" id="4449972">0</span>&nbsp;<span class="op" id="4449974">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449978">n</span>&nbsp;<span class="op" id="4449980">=</span>&nbsp;<span class="builtinfunc" id="4449982">len</span><span class="op" id="4449985">(</span><span class="ident" id="4449986">b</span><span class="op" id="4449987">)</span>&nbsp;<span class="op" id="4449989">+</span>&nbsp;<span class="num" id="4449991">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449997">result</span>&nbsp;<span class="op" id="4450004">:=</span>&nbsp;<span class="builtinfunc" id="4450007">make</span><span class="op" id="4450011">(</span><span class="op" id="4450012">[</span><span class="op" id="4450013">]</span><span class="op" id="4450014">[</span><span class="op" id="4450015">]</span><span class="builtintype" id="4450016">int</span><span class="op" id="4450019">,</span>&nbsp;<span class="num" id="4450021">0</span><span class="op" id="4450022">,</span>&nbsp;<span class="ident" id="4450024">startSize</span><span class="op" id="4450033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450036">re</span><span class="op" id="4450038">.</span><span class="ident" id="4450039">allMatches</span><span class="op" id="4450049">(</span><span class="string" id="4450050">&#34;&#34;</span><span class="op" id="4450052">,</span>&nbsp;<span class="ident" id="4450054">b</span><span class="op" id="4450055">,</span>&nbsp;<span class="ident" id="4450057">n</span><span class="op" id="4450058">,</span>&nbsp;<span class="keyword" id="4450060">func</span><span class="op" id="4450064">(</span><span class="ident" id="4450065">match</span>&nbsp;<span class="op" id="4450071">[</span><span class="op" id="4450072">]</span><span class="builtintype" id="4450073">int</span><span class="op" id="4450076">)</span>&nbsp;<span class="op" id="4450078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450082">result</span>&nbsp;<span class="op" id="4450089">=</span>&nbsp;<span class="builtinfunc" id="4450091">append</span><span class="op" id="4450097">(</span><span class="ident" id="4450098">result</span><span class="op" id="4450104">,</span>&nbsp;<span class="ident" id="4450106">match</span><span class="op" id="4450111">[</span><span class="num" id="4450112">0</span><span class="op" id="4450113">:</span><span class="num" id="4450114">2</span><span class="op" id="4450115">]</span><span class="op" id="4450116">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450119">}</span><span class="op" id="4450120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450123">if</span>&nbsp;<span class="builtinfunc" id="4450126">len</span><span class="op" id="4450129">(</span><span class="ident" id="4450130">result</span><span class="op" id="4450136">)</span>&nbsp;<span class="op" id="4450138">==</span>&nbsp;<span class="num" id="4450141">0</span>&nbsp;<span class="op" id="4450143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450147">return</span>&nbsp;<span class="ident" id="4450154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450162">return</span>&nbsp;<span class="ident" id="4450169">result</span><br>
<span class="lineno">950</span><span class="op" id="4450176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450179">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4450258">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="4450335">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="4450362">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4450407">func</span>&nbsp;<span class="op" id="4450412">(</span><span class="ident" id="4450413">re</span>&nbsp;<span class="op" id="4450416">*</span><span class="ident" id="4450417">Regexp</span><span class="op" id="4450423">)</span>&nbsp;<span class="ident" id="4450425">FindAllString</span><span class="op" id="4450438">(</span><span class="ident" id="4450439">s</span>&nbsp;<span class="builtintype" id="4450441">string</span><span class="op" id="4450447">,</span>&nbsp;<span class="ident" id="4450449">n</span>&nbsp;<span class="builtintype" id="4450451">int</span><span class="op" id="4450454">)</span>&nbsp;<span class="op" id="4450456">[</span><span class="op" id="4450457">]</span><span class="builtintype" id="4450458">string</span>&nbsp;<span class="op" id="4450465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450468">if</span>&nbsp;<span class="ident" id="4450471">n</span>&nbsp;<span class="op" id="4450473">&lt;</span>&nbsp;<span class="num" id="4450475">0</span>&nbsp;<span class="op" id="4450477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450481">n</span>&nbsp;<span class="op" id="4450483">=</span>&nbsp;<span class="builtinfunc" id="4450485">len</span><span class="op" id="4450488">(</span><span class="ident" id="4450489">s</span><span class="op" id="4450490">)</span>&nbsp;<span class="op" id="4450492">+</span>&nbsp;<span class="num" id="4450494">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450497">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450500">result</span>&nbsp;<span class="op" id="4450507">:=</span>&nbsp;<span class="builtinfunc" id="4450510">make</span><span class="op" id="4450514">(</span><span class="op" id="4450515">[</span><span class="op" id="4450516">]</span><span class="builtintype" id="4450517">string</span><span class="op" id="4450523">,</span>&nbsp;<span class="num" id="4450525">0</span><span class="op" id="4450526">,</span>&nbsp;<span class="ident" id="4450528">startSize</span><span class="op" id="4450537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450540">re</span><span class="op" id="4450542">.</span><span class="ident" id="4450543">allMatches</span><span class="op" id="4450553">(</span><span class="ident" id="4450554">s</span><span class="op" id="4450555">,</span>&nbsp;<span class="ident" id="4450557">nil</span><span class="op" id="4450560">,</span>&nbsp;<span class="ident" id="4450562">n</span><span class="op" id="4450563">,</span>&nbsp;<span class="keyword" id="4450565">func</span><span class="op" id="4450569">(</span><span class="ident" id="4450570">match</span>&nbsp;<span class="op" id="4450576">[</span><span class="op" id="4450577">]</span><span class="builtintype" id="4450578">int</span><span class="op" id="4450581">)</span>&nbsp;<span class="op" id="4450583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450587">result</span>&nbsp;<span class="op" id="4450594">=</span>&nbsp;<span class="builtinfunc" id="4450596">append</span><span class="op" id="4450602">(</span><span class="ident" id="4450603">result</span><span class="op" id="4450609">,</span>&nbsp;<span class="ident" id="4450611">s</span><span class="op" id="4450612">[</span><span class="ident" id="4450613">match</span><span class="op" id="4450618">[</span><span class="num" id="4450619">0</span><span class="op" id="4450620">]</span><span class="op" id="4450621">:</span><span class="ident" id="4450622">match</span><span class="op" id="4450627">[</span><span class="num" id="4450628">1</span><span class="op" id="4450629">]</span><span class="op" id="4450630">]</span><span class="op" id="4450631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450634">}</span><span class="op" id="4450635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450638">if</span>&nbsp;<span class="builtinfunc" id="4450641">len</span><span class="op" id="4450644">(</span><span class="ident" id="4450645">result</span><span class="op" id="4450651">)</span>&nbsp;<span class="op" id="4450653">==</span>&nbsp;<span class="num" id="4450656">0</span>&nbsp;<span class="op" id="4450658">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450662">return</span>&nbsp;<span class="ident" id="4450669">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450677">return</span>&nbsp;<span class="ident" id="4450684">result</span><br>
<span class="lineno"></span><span class="op" id="4450691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="4450694">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4450770">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="4450848">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4450887">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4450932">func</span>&nbsp;<span class="op" id="4450937">(</span><span class="ident" id="4450938">re</span>&nbsp;<span class="op" id="4450941">*</span><span class="ident" id="4450942">Regexp</span><span class="op" id="4450948">)</span>&nbsp;<span class="ident" id="4450950">FindAllStringIndex</span><span class="op" id="4450968">(</span><span class="ident" id="4450969">s</span>&nbsp;<span class="builtintype" id="4450971">string</span><span class="op" id="4450977">,</span>&nbsp;<span class="ident" id="4450979">n</span>&nbsp;<span class="builtintype" id="4450981">int</span><span class="op" id="4450984">)</span>&nbsp;<span class="op" id="4450986">[</span><span class="op" id="4450987">]</span><span class="op" id="4450988">[</span><span class="op" id="4450989">]</span><span class="builtintype" id="4450990">int</span>&nbsp;<span class="op" id="4450994">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450997">if</span>&nbsp;<span class="ident" id="4451000">n</span>&nbsp;<span class="op" id="4451002">&lt;</span>&nbsp;<span class="num" id="4451004">0</span>&nbsp;<span class="op" id="4451006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451010">n</span>&nbsp;<span class="op" id="4451012">=</span>&nbsp;<span class="builtinfunc" id="4451014">len</span><span class="op" id="4451017">(</span><span class="ident" id="4451018">s</span><span class="op" id="4451019">)</span>&nbsp;<span class="op" id="4451021">+</span>&nbsp;<span class="num" id="4451023">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451029">result</span>&nbsp;<span class="op" id="4451036">:=</span>&nbsp;<span class="builtinfunc" id="4451039">make</span><span class="op" id="4451043">(</span><span class="op" id="4451044">[</span><span class="op" id="4451045">]</span><span class="op" id="4451046">[</span><span class="op" id="4451047">]</span><span class="builtintype" id="4451048">int</span><span class="op" id="4451051">,</span>&nbsp;<span class="num" id="4451053">0</span><span class="op" id="4451054">,</span>&nbsp;<span class="ident" id="4451056">startSize</span><span class="op" id="4451065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451068">re</span><span class="op" id="4451070">.</span><span class="ident" id="4451071">allMatches</span><span class="op" id="4451081">(</span><span class="ident" id="4451082">s</span><span class="op" id="4451083">,</span>&nbsp;<span class="ident" id="4451085">nil</span><span class="op" id="4451088">,</span>&nbsp;<span class="ident" id="4451090">n</span><span class="op" id="4451091">,</span>&nbsp;<span class="keyword" id="4451093">func</span><span class="op" id="4451097">(</span><span class="ident" id="4451098">match</span>&nbsp;<span class="op" id="4451104">[</span><span class="op" id="4451105">]</span><span class="builtintype" id="4451106">int</span><span class="op" id="4451109">)</span>&nbsp;<span class="op" id="4451111">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451115">result</span>&nbsp;<span class="op" id="4451122">=</span>&nbsp;<span class="builtinfunc" id="4451124">append</span><span class="op" id="4451130">(</span><span class="ident" id="4451131">result</span><span class="op" id="4451137">,</span>&nbsp;<span class="ident" id="4451139">match</span><span class="op" id="4451144">[</span><span class="num" id="4451145">0</span><span class="op" id="4451146">:</span><span class="num" id="4451147">2</span><span class="op" id="4451148">]</span><span class="op" id="4451149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451152">}</span><span class="op" id="4451153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451156">if</span>&nbsp;<span class="builtinfunc" id="4451159">len</span><span class="op" id="4451162">(</span><span class="ident" id="4451163">result</span><span class="op" id="4451169">)</span>&nbsp;<span class="op" id="4451171">==</span>&nbsp;<span class="num" id="4451174">0</span>&nbsp;<span class="op" id="4451176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451180">return</span>&nbsp;<span class="ident" id="4451187">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451192">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451195">return</span>&nbsp;<span class="ident" id="4451202">result</span><br>
<span class="lineno"></span><span class="op" id="4451209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4451212">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4451288">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="4451360">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4451399">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4451444">func</span>&nbsp;<span class="op" id="4451449">(</span><span class="ident" id="4451450">re</span>&nbsp;<span class="op" id="4451453">*</span><span class="ident" id="4451454">Regexp</span><span class="op" id="4451460">)</span>&nbsp;<span class="ident" id="4451462">FindAllSubmatch</span><span class="op" id="4451477">(</span><span class="ident" id="4451478">b</span>&nbsp;<span class="op" id="4451480">[</span><span class="op" id="4451481">]</span><span class="builtintype" id="4451482">byte</span><span class="op" id="4451486">,</span>&nbsp;<span class="ident" id="4451488">n</span>&nbsp;<span class="builtintype" id="4451490">int</span><span class="op" id="4451493">)</span>&nbsp;<span class="op" id="4451495">[</span><span class="op" id="4451496">]</span><span class="op" id="4451497">[</span><span class="op" id="4451498">]</span><span class="op" id="4451499">[</span><span class="op" id="4451500">]</span><span class="builtintype" id="4451501">byte</span>&nbsp;<span class="op" id="4451506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451509">if</span>&nbsp;<span class="ident" id="4451512">n</span>&nbsp;<span class="op" id="4451514">&lt;</span>&nbsp;<span class="num" id="4451516">0</span>&nbsp;<span class="op" id="4451518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451522">n</span>&nbsp;<span class="op" id="4451524">=</span>&nbsp;<span class="builtinfunc" id="4451526">len</span><span class="op" id="4451529">(</span><span class="ident" id="4451530">b</span><span class="op" id="4451531">)</span>&nbsp;<span class="op" id="4451533">+</span>&nbsp;<span class="num" id="4451535">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451541">result</span>&nbsp;<span class="op" id="4451548">:=</span>&nbsp;<span class="builtinfunc" id="4451551">make</span><span class="op" id="4451555">(</span><span class="op" id="4451556">[</span><span class="op" id="4451557">]</span><span class="op" id="4451558">[</span><span class="op" id="4451559">]</span><span class="op" id="4451560">[</span><span class="op" id="4451561">]</span><span class="builtintype" id="4451562">byte</span><span class="op" id="4451566">,</span>&nbsp;<span class="num" id="4451568">0</span><span class="op" id="4451569">,</span>&nbsp;<span class="ident" id="4451571">startSize</span><span class="op" id="4451580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451583">re</span><span class="op" id="4451585">.</span><span class="ident" id="4451586">allMatches</span><span class="op" id="4451596">(</span><span class="string" id="4451597">&#34;&#34;</span><span class="op" id="4451599">,</span>&nbsp;<span class="ident" id="4451601">b</span><span class="op" id="4451602">,</span>&nbsp;<span class="ident" id="4451604">n</span><span class="op" id="4451605">,</span>&nbsp;<span class="keyword" id="4451607">func</span><span class="op" id="4451611">(</span><span class="ident" id="4451612">match</span>&nbsp;<span class="op" id="4451618">[</span><span class="op" id="4451619">]</span><span class="builtintype" id="4451620">int</span><span class="op" id="4451623">)</span>&nbsp;<span class="op" id="4451625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451629">slice</span>&nbsp;<span class="op" id="4451635">:=</span>&nbsp;<span class="builtinfunc" id="4451638">make</span><span class="op" id="4451642">(</span><span class="op" id="4451643">[</span><span class="op" id="4451644">]</span><span class="op" id="4451645">[</span><span class="op" id="4451646">]</span><span class="builtintype" id="4451647">byte</span><span class="op" id="4451651">,</span>&nbsp;<span class="builtinfunc" id="4451653">len</span><span class="op" id="4451656">(</span><span class="ident" id="4451657">match</span><span class="op" id="4451662">)</span><span class="op" id="4451663">/</span><span class="num" id="4451664">2</span><span class="op" id="4451665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451669">for</span>&nbsp;<span class="ident" id="4451673">j</span>&nbsp;<span class="op" id="4451675">:=</span>&nbsp;<span class="keyword" id="4451678">range</span>&nbsp;<span class="ident" id="4451684">slice</span>&nbsp;<span class="op" id="4451690">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451695">if</span>&nbsp;<span class="ident" id="4451698">match</span><span class="op" id="4451703">[</span><span class="num" id="4451704">2</span><span class="op" id="4451705">*</span><span class="ident" id="4451706">j</span><span class="op" id="4451707">]</span>&nbsp;<span class="op" id="4451709">&gt;=</span>&nbsp;<span class="num" id="4451712">0</span>&nbsp;<span class="op" id="4451714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451720">slice</span><span class="op" id="4451725">[</span><span class="ident" id="4451726">j</span><span class="op" id="4451727">]</span>&nbsp;<span class="op" id="4451729">=</span>&nbsp;<span class="ident" id="4451731">b</span><span class="op" id="4451732">[</span><span class="ident" id="4451733">match</span><span class="op" id="4451738">[</span><span class="num" id="4451739">2</span><span class="op" id="4451740">*</span><span class="ident" id="4451741">j</span><span class="op" id="4451742">]</span><span class="op" id="4451743">:</span><span class="ident" id="4451744">match</span><span class="op" id="4451749">[</span><span class="num" id="4451750">2</span><span class="op" id="4451751">*</span><span class="ident" id="4451752">j</span><span class="op" id="4451753">+</span><span class="num" id="4451754">1</span><span class="op" id="4451755">]</span><span class="op" id="4451756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451769">result</span>&nbsp;<span class="op" id="4451776">=</span>&nbsp;<span class="builtinfunc" id="4451778">append</span><span class="op" id="4451784">(</span><span class="ident" id="4451785">result</span><span class="op" id="4451791">,</span>&nbsp;<span class="ident" id="4451793">slice</span><span class="op" id="4451798">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451801">}</span><span class="op" id="4451802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451805">if</span>&nbsp;<span class="builtinfunc" id="4451808">len</span><span class="op" id="4451811">(</span><span class="ident" id="4451812">result</span><span class="op" id="4451818">)</span>&nbsp;<span class="op" id="4451820">==</span>&nbsp;<span class="num" id="4451823">0</span>&nbsp;<span class="op" id="4451825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451829">return</span>&nbsp;<span class="ident" id="4451836">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451844">return</span>&nbsp;<span class="ident" id="4451851">result</span><br>
<span class="lineno">1010</span><span class="op" id="4451858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4451861">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4451939">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4452013">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="4452058">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4452103">func</span>&nbsp;<span class="op" id="4452108">(</span><span class="ident" id="4452109">re</span>&nbsp;<span class="op" id="4452112">*</span><span class="ident" id="4452113">Regexp</span><span class="op" id="4452119">)</span>&nbsp;<span class="ident" id="4452121">FindAllSubmatchIndex</span><span class="op" id="4452141">(</span><span class="ident" id="4452142">b</span>&nbsp;<span class="op" id="4452144">[</span><span class="op" id="4452145">]</span><span class="builtintype" id="4452146">byte</span><span class="op" id="4452150">,</span>&nbsp;<span class="ident" id="4452152">n</span>&nbsp;<span class="builtintype" id="4452154">int</span><span class="op" id="4452157">)</span>&nbsp;<span class="op" id="4452159">[</span><span class="op" id="4452160">]</span><span class="op" id="4452161">[</span><span class="op" id="4452162">]</span><span class="builtintype" id="4452163">int</span>&nbsp;<span class="op" id="4452167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452170">if</span>&nbsp;<span class="ident" id="4452173">n</span>&nbsp;<span class="op" id="4452175">&lt;</span>&nbsp;<span class="num" id="4452177">0</span>&nbsp;<span class="op" id="4452179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452183">n</span>&nbsp;<span class="op" id="4452185">=</span>&nbsp;<span class="builtinfunc" id="4452187">len</span><span class="op" id="4452190">(</span><span class="ident" id="4452191">b</span><span class="op" id="4452192">)</span>&nbsp;<span class="op" id="4452194">+</span>&nbsp;<span class="num" id="4452196">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452199">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452202">result</span>&nbsp;<span class="op" id="4452209">:=</span>&nbsp;<span class="builtinfunc" id="4452212">make</span><span class="op" id="4452216">(</span><span class="op" id="4452217">[</span><span class="op" id="4452218">]</span><span class="op" id="4452219">[</span><span class="op" id="4452220">]</span><span class="builtintype" id="4452221">int</span><span class="op" id="4452224">,</span>&nbsp;<span class="num" id="4452226">0</span><span class="op" id="4452227">,</span>&nbsp;<span class="ident" id="4452229">startSize</span><span class="op" id="4452238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452241">re</span><span class="op" id="4452243">.</span><span class="ident" id="4452244">allMatches</span><span class="op" id="4452254">(</span><span class="string" id="4452255">&#34;&#34;</span><span class="op" id="4452257">,</span>&nbsp;<span class="ident" id="4452259">b</span><span class="op" id="4452260">,</span>&nbsp;<span class="ident" id="4452262">n</span><span class="op" id="4452263">,</span>&nbsp;<span class="keyword" id="4452265">func</span><span class="op" id="4452269">(</span><span class="ident" id="4452270">match</span>&nbsp;<span class="op" id="4452276">[</span><span class="op" id="4452277">]</span><span class="builtintype" id="4452278">int</span><span class="op" id="4452281">)</span>&nbsp;<span class="op" id="4452283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452287">result</span>&nbsp;<span class="op" id="4452294">=</span>&nbsp;<span class="builtinfunc" id="4452296">append</span><span class="op" id="4452302">(</span><span class="ident" id="4452303">result</span><span class="op" id="4452309">,</span>&nbsp;<span class="ident" id="4452311">match</span><span class="op" id="4452316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452319">}</span><span class="op" id="4452320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452323">if</span>&nbsp;<span class="builtinfunc" id="4452326">len</span><span class="op" id="4452329">(</span><span class="ident" id="4452330">result</span><span class="op" id="4452336">)</span>&nbsp;<span class="op" id="4452338">==</span>&nbsp;<span class="num" id="4452341">0</span>&nbsp;<span class="op" id="4452343">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452347">return</span>&nbsp;<span class="ident" id="4452354">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452362">return</span>&nbsp;<span class="ident" id="4452369">result</span><br>
<span class="lineno"></span><span class="op" id="4452376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="4452379">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4452451">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4452529">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4452578">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4452623">func</span>&nbsp;<span class="op" id="4452628">(</span><span class="ident" id="4452629">re</span>&nbsp;<span class="op" id="4452632">*</span><span class="ident" id="4452633">Regexp</span><span class="op" id="4452639">)</span>&nbsp;<span class="ident" id="4452641">FindAllStringSubmatch</span><span class="op" id="4452662">(</span><span class="ident" id="4452663">s</span>&nbsp;<span class="builtintype" id="4452665">string</span><span class="op" id="4452671">,</span>&nbsp;<span class="ident" id="4452673">n</span>&nbsp;<span class="builtintype" id="4452675">int</span><span class="op" id="4452678">)</span>&nbsp;<span class="op" id="4452680">[</span><span class="op" id="4452681">]</span><span class="op" id="4452682">[</span><span class="op" id="4452683">]</span><span class="builtintype" id="4452684">string</span>&nbsp;<span class="op" id="4452691">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452694">if</span>&nbsp;<span class="ident" id="4452697">n</span>&nbsp;<span class="op" id="4452699">&lt;</span>&nbsp;<span class="num" id="4452701">0</span>&nbsp;<span class="op" id="4452703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452707">n</span>&nbsp;<span class="op" id="4452709">=</span>&nbsp;<span class="builtinfunc" id="4452711">len</span><span class="op" id="4452714">(</span><span class="ident" id="4452715">s</span><span class="op" id="4452716">)</span>&nbsp;<span class="op" id="4452718">+</span>&nbsp;<span class="num" id="4452720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452726">result</span>&nbsp;<span class="op" id="4452733">:=</span>&nbsp;<span class="builtinfunc" id="4452736">make</span><span class="op" id="4452740">(</span><span class="op" id="4452741">[</span><span class="op" id="4452742">]</span><span class="op" id="4452743">[</span><span class="op" id="4452744">]</span><span class="builtintype" id="4452745">string</span><span class="op" id="4452751">,</span>&nbsp;<span class="num" id="4452753">0</span><span class="op" id="4452754">,</span>&nbsp;<span class="ident" id="4452756">startSize</span><span class="op" id="4452765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452768">re</span><span class="op" id="4452770">.</span><span class="ident" id="4452771">allMatches</span><span class="op" id="4452781">(</span><span class="ident" id="4452782">s</span><span class="op" id="4452783">,</span>&nbsp;<span class="ident" id="4452785">nil</span><span class="op" id="4452788">,</span>&nbsp;<span class="ident" id="4452790">n</span><span class="op" id="4452791">,</span>&nbsp;<span class="keyword" id="4452793">func</span><span class="op" id="4452797">(</span><span class="ident" id="4452798">match</span>&nbsp;<span class="op" id="4452804">[</span><span class="op" id="4452805">]</span><span class="builtintype" id="4452806">int</span><span class="op" id="4452809">)</span>&nbsp;<span class="op" id="4452811">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452815">slice</span>&nbsp;<span class="op" id="4452821">:=</span>&nbsp;<span class="builtinfunc" id="4452824">make</span><span class="op" id="4452828">(</span><span class="op" id="4452829">[</span><span class="op" id="4452830">]</span><span class="builtintype" id="4452831">string</span><span class="op" id="4452837">,</span>&nbsp;<span class="builtinfunc" id="4452839">len</span><span class="op" id="4452842">(</span><span class="ident" id="4452843">match</span><span class="op" id="4452848">)</span><span class="op" id="4452849">/</span><span class="num" id="4452850">2</span><span class="op" id="4452851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452855">for</span>&nbsp;<span class="ident" id="4452859">j</span>&nbsp;<span class="op" id="4452861">:=</span>&nbsp;<span class="keyword" id="4452864">range</span>&nbsp;<span class="ident" id="4452870">slice</span>&nbsp;<span class="op" id="4452876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452881">if</span>&nbsp;<span class="ident" id="4452884">match</span><span class="op" id="4452889">[</span><span class="num" id="4452890">2</span><span class="op" id="4452891">*</span><span class="ident" id="4452892">j</span><span class="op" id="4452893">]</span>&nbsp;<span class="op" id="4452895">&gt;=</span>&nbsp;<span class="num" id="4452898">0</span>&nbsp;<span class="op" id="4452900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452906">slice</span><span class="op" id="4452911">[</span><span class="ident" id="4452912">j</span><span class="op" id="4452913">]</span>&nbsp;<span class="op" id="4452915">=</span>&nbsp;<span class="ident" id="4452917">s</span><span class="op" id="4452918">[</span><span class="ident" id="4452919">match</span><span class="op" id="4452924">[</span><span class="num" id="4452925">2</span><span class="op" id="4452926">*</span><span class="ident" id="4452927">j</span><span class="op" id="4452928">]</span><span class="op" id="4452929">:</span><span class="ident" id="4452930">match</span><span class="op" id="4452935">[</span><span class="num" id="4452936">2</span><span class="op" id="4452937">*</span><span class="ident" id="4452938">j</span><span class="op" id="4452939">+</span><span class="num" id="4452940">1</span><span class="op" id="4452941">]</span><span class="op" id="4452942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452947">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452955">result</span>&nbsp;<span class="op" id="4452962">=</span>&nbsp;<span class="builtinfunc" id="4452964">append</span><span class="op" id="4452970">(</span><span class="ident" id="4452971">result</span><span class="op" id="4452977">,</span>&nbsp;<span class="ident" id="4452979">slice</span><span class="op" id="4452984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452987">}</span><span class="op" id="4452988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452991">if</span>&nbsp;<span class="builtinfunc" id="4452994">len</span><span class="op" id="4452997">(</span><span class="ident" id="4452998">result</span><span class="op" id="4453004">)</span>&nbsp;<span class="op" id="4453006">==</span>&nbsp;<span class="num" id="4453009">0</span>&nbsp;<span class="op" id="4453011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453015">return</span>&nbsp;<span class="ident" id="4453022">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453030">return</span>&nbsp;<span class="ident" id="4453037">result</span><br>
<span class="lineno"></span><span class="op" id="4453044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453047">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="4453101">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4453177">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4453247">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4453259">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4453304">func</span>&nbsp;<span class="op" id="4453309">(</span><span class="ident" id="4453310">re</span>&nbsp;<span class="op" id="4453313">*</span><span class="ident" id="4453314">Regexp</span><span class="op" id="4453320">)</span>&nbsp;<span class="ident" id="4453322">FindAllStringSubmatchIndex</span><span class="op" id="4453348">(</span><span class="ident" id="4453349">s</span>&nbsp;<span class="builtintype" id="4453351">string</span><span class="op" id="4453357">,</span>&nbsp;<span class="ident" id="4453359">n</span>&nbsp;<span class="builtintype" id="4453361">int</span><span class="op" id="4453364">)</span>&nbsp;<span class="op" id="4453366">[</span><span class="op" id="4453367">]</span><span class="op" id="4453368">[</span><span class="op" id="4453369">]</span><span class="builtintype" id="4453370">int</span>&nbsp;<span class="op" id="4453374">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453377">if</span>&nbsp;<span class="ident" id="4453380">n</span>&nbsp;<span class="op" id="4453382">&lt;</span>&nbsp;<span class="num" id="4453384">0</span>&nbsp;<span class="op" id="4453386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453390">n</span>&nbsp;<span class="op" id="4453392">=</span>&nbsp;<span class="builtinfunc" id="4453394">len</span><span class="op" id="4453397">(</span><span class="ident" id="4453398">s</span><span class="op" id="4453399">)</span>&nbsp;<span class="op" id="4453401">+</span>&nbsp;<span class="num" id="4453403">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453409">result</span>&nbsp;<span class="op" id="4453416">:=</span>&nbsp;<span class="builtinfunc" id="4453419">make</span><span class="op" id="4453423">(</span><span class="op" id="4453424">[</span><span class="op" id="4453425">]</span><span class="op" id="4453426">[</span><span class="op" id="4453427">]</span><span class="builtintype" id="4453428">int</span><span class="op" id="4453431">,</span>&nbsp;<span class="num" id="4453433">0</span><span class="op" id="4453434">,</span>&nbsp;<span class="ident" id="4453436">startSize</span><span class="op" id="4453445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453448">re</span><span class="op" id="4453450">.</span><span class="ident" id="4453451">allMatches</span><span class="op" id="4453461">(</span><span class="ident" id="4453462">s</span><span class="op" id="4453463">,</span>&nbsp;<span class="ident" id="4453465">nil</span><span class="op" id="4453468">,</span>&nbsp;<span class="ident" id="4453470">n</span><span class="op" id="4453471">,</span>&nbsp;<span class="keyword" id="4453473">func</span><span class="op" id="4453477">(</span><span class="ident" id="4453478">match</span>&nbsp;<span class="op" id="4453484">[</span><span class="op" id="4453485">]</span><span class="builtintype" id="4453486">int</span><span class="op" id="4453489">)</span>&nbsp;<span class="op" id="4453491">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453495">result</span>&nbsp;<span class="op" id="4453502">=</span>&nbsp;<span class="builtinfunc" id="4453504">append</span><span class="op" id="4453510">(</span><span class="ident" id="4453511">result</span><span class="op" id="4453517">,</span>&nbsp;<span class="ident" id="4453519">match</span><span class="op" id="4453524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453527">}</span><span class="op" id="4453528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453531">if</span>&nbsp;<span class="builtinfunc" id="4453534">len</span><span class="op" id="4453537">(</span><span class="ident" id="4453538">result</span><span class="op" id="4453544">)</span>&nbsp;<span class="op" id="4453546">==</span>&nbsp;<span class="num" id="4453549">0</span>&nbsp;<span class="op" id="4453551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453555">return</span>&nbsp;<span class="ident" id="4453562">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453567">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453570">return</span>&nbsp;<span class="ident" id="4453577">result</span><br>
<span class="lineno"></span><span class="op" id="4453584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453587">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4453672">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="4453724">//</span><br>
<span class="lineno"></span><span class="comment" id="4453727">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="4453800">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="4453886">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="4453958">//</span><br>
<span class="lineno">1080</span><span class="comment" id="4453961">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="4453973">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="4454035">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="4454077">//</span><br>
<span class="lineno"></span><span class="comment" id="4454080">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="4454140">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="4454224">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="4454273">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="4454300">func</span>&nbsp;<span class="op" id="4454305">(</span><span class="ident" id="4454306">re</span>&nbsp;<span class="op" id="4454309">*</span><span class="ident" id="4454310">Regexp</span><span class="op" id="4454316">)</span>&nbsp;<span class="ident" id="4454318">Split</span><span class="op" id="4454323">(</span><span class="ident" id="4454324">s</span>&nbsp;<span class="builtintype" id="4454326">string</span><span class="op" id="4454332">,</span>&nbsp;<span class="ident" id="4454334">n</span>&nbsp;<span class="builtintype" id="4454336">int</span><span class="op" id="4454339">)</span>&nbsp;<span class="op" id="4454341">[</span><span class="op" id="4454342">]</span><span class="builtintype" id="4454343">string</span>&nbsp;<span class="op" id="4454350">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454354">if</span>&nbsp;<span class="ident" id="4454357">n</span>&nbsp;<span class="op" id="4454359">==</span>&nbsp;<span class="num" id="4454362">0</span>&nbsp;<span class="op" id="4454364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454368">return</span>&nbsp;<span class="ident" id="4454375">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454384">if</span>&nbsp;<span class="builtinfunc" id="4454387">len</span><span class="op" id="4454390">(</span><span class="ident" id="4454391">re</span><span class="op" id="4454393">.</span><span class="ident" id="4454394">expr</span><span class="op" id="4454398">)</span>&nbsp;<span class="op" id="4454400">&gt;</span>&nbsp;<span class="num" id="4454402">0</span>&nbsp;<span class="op" id="4454404">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4454407">len</span><span class="op" id="4454410">(</span><span class="ident" id="4454411">s</span><span class="op" id="4454412">)</span>&nbsp;<span class="op" id="4454414">==</span>&nbsp;<span class="num" id="4454417">0</span>&nbsp;<span class="op" id="4454419">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454423">return</span>&nbsp;<span class="op" id="4454430">[</span><span class="op" id="4454431">]</span><span class="builtintype" id="4454432">string</span><span class="op" id="4454438">{</span><span class="string" id="4454439">&#34;&#34;</span><span class="op" id="4454441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454448">matches</span>&nbsp;<span class="op" id="4454456">:=</span>&nbsp;<span class="ident" id="4454459">re</span><span class="op" id="4454461">.</span><span class="ident" id="4454462">FindAllStringIndex</span><span class="op" id="4454480">(</span><span class="ident" id="4454481">s</span><span class="op" id="4454482">,</span>&nbsp;<span class="ident" id="4454484">n</span><span class="op" id="4454485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454488">strings</span>&nbsp;<span class="op" id="4454496">:=</span>&nbsp;<span class="builtinfunc" id="4454499">make</span><span class="op" id="4454503">(</span><span class="op" id="4454504">[</span><span class="op" id="4454505">]</span><span class="builtintype" id="4454506">string</span><span class="op" id="4454512">,</span>&nbsp;<span class="num" id="4454514">0</span><span class="op" id="4454515">,</span>&nbsp;<span class="builtinfunc" id="4454517">len</span><span class="op" id="4454520">(</span><span class="ident" id="4454521">matches</span><span class="op" id="4454528">)</span><span class="op" id="4454529">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454533">beg</span>&nbsp;<span class="op" id="4454537">:=</span>&nbsp;<span class="num" id="4454540">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454543">end</span>&nbsp;<span class="op" id="4454547">:=</span>&nbsp;<span class="num" id="4454550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454553">for</span>&nbsp;<span class="ident" id="4454557">_</span><span class="op" id="4454558">,</span>&nbsp;<span class="ident" id="4454560">match</span>&nbsp;<span class="op" id="4454566">:=</span>&nbsp;<span class="keyword" id="4454569">range</span>&nbsp;<span class="ident" id="4454575">matches</span>&nbsp;<span class="op" id="4454583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454587">if</span>&nbsp;<span class="ident" id="4454590">n</span>&nbsp;<span class="op" id="4454592">&gt;</span>&nbsp;<span class="num" id="4454594">0</span>&nbsp;<span class="op" id="4454596">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4454599">len</span><span class="op" id="4454602">(</span><span class="ident" id="4454603">strings</span><span class="op" id="4454610">)</span>&nbsp;<span class="op" id="4454612">&gt;=</span>&nbsp;<span class="ident" id="4454615">n</span><span class="op" id="4454616">-</span><span class="num" id="4454617">1</span>&nbsp;<span class="op" id="4454619">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454624">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454637">end</span>&nbsp;<span class="op" id="4454641">=</span>&nbsp;<span class="ident" id="4454643">match</span><span class="op" id="4454648">[</span><span class="num" id="4454649">0</span><span class="op" id="4454650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454654">if</span>&nbsp;<span class="ident" id="4454657">match</span><span class="op" id="4454662">[</span><span class="num" id="4454663">1</span><span class="op" id="4454664">]</span>&nbsp;<span class="op" id="4454666">!=</span>&nbsp;<span class="num" id="4454669">0</span>&nbsp;<span class="op" id="4454671">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454676">strings</span>&nbsp;<span class="op" id="4454684">=</span>&nbsp;<span class="builtinfunc" id="4454686">append</span><span class="op" id="4454692">(</span><span class="ident" id="4454693">strings</span><span class="op" id="4454700">,</span>&nbsp;<span class="ident" id="4454702">s</span><span class="op" id="4454703">[</span><span class="ident" id="4454704">beg</span><span class="op" id="4454707">:</span><span class="ident" id="4454708">end</span><span class="op" id="4454711">]</span><span class="op" id="4454712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454720">beg</span>&nbsp;<span class="op" id="4454724">=</span>&nbsp;<span class="ident" id="4454726">match</span><span class="op" id="4454731">[</span><span class="num" id="4454732">1</span><span class="op" id="4454733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454740">if</span>&nbsp;<span class="ident" id="4454743">end</span>&nbsp;<span class="op" id="4454747">!=</span>&nbsp;<span class="builtinfunc" id="4454750">len</span><span class="op" id="4454753">(</span><span class="ident" id="4454754">s</span><span class="op" id="4454755">)</span>&nbsp;<span class="op" id="4454757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454761">strings</span>&nbsp;<span class="op" id="4454769">=</span>&nbsp;<span class="builtinfunc" id="4454771">append</span><span class="op" id="4454777">(</span><span class="ident" id="4454778">strings</span><span class="op" id="4454785">,</span>&nbsp;<span class="ident" id="4454787">s</span><span class="op" id="4454788">[</span><span class="ident" id="4454789">beg</span><span class="op" id="4454792">:</span><span class="op" id="4454793">]</span><span class="op" id="4454794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454801">return</span>&nbsp;<span class="ident" id="4454808">strings</span><br>
<span class="lineno">1120</span><span class="op" id="4454816">}</span>
</div>
</body>
</html>
