<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html" class="current">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8513150">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8513205">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8513259">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8513310">package</span>&nbsp;<span class="ident" id="8513318">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8513325">import</span>&nbsp;<span class="op" id="8513332">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8513335">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8513346">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8513356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8513359">type</span>&nbsp;<span class="ident" id="8513364">T</span>&nbsp;<span class="builtintype" id="8513366">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8513371">func</span>&nbsp;<span class="op" id="8513376">(</span><span class="ident" id="8513377">t</span>&nbsp;<span class="op" id="8513379">*</span><span class="ident" id="8513380">T</span><span class="op" id="8513381">)</span>&nbsp;<span class="ident" id="8513383">ptrmethod</span><span class="op" id="8513392">(</span><span class="op" id="8513393">)</span>&nbsp;<span class="op" id="8513395">[</span><span class="op" id="8513396">]</span><span class="builtintype" id="8513397">byte</span>&nbsp;<span class="op" id="8513402">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8513405">return</span>&nbsp;<span class="ident" id="8513412">Stack</span><span class="op" id="8513417">(</span><span class="op" id="8513418">)</span><br>
<span class="lineno"></span><span class="op" id="8513420">}</span><br>
<span class="lineno"></span><span class="keyword" id="8513422">func</span>&nbsp;<span class="op" id="8513427">(</span><span class="ident" id="8513428">t</span>&nbsp;<span class="ident" id="8513430">T</span><span class="op" id="8513431">)</span>&nbsp;<span class="ident" id="8513433">method</span><span class="op" id="8513439">(</span><span class="op" id="8513440">)</span>&nbsp;<span class="op" id="8513442">[</span><span class="op" id="8513443">]</span><span class="builtintype" id="8513444">byte</span>&nbsp;<span class="op" id="8513449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8513452">return</span>&nbsp;<span class="ident" id="8513459">t</span><span class="op" id="8513460">.</span><span class="ident" id="8513461">ptrmethod</span><span class="op" id="8513470">(</span><span class="op" id="8513471">)</span><br>
<span class="lineno"></span><span class="op" id="8513473">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8513476">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Don&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8514089">func</span>&nbsp;<span class="ident" id="8514094">TestStack</span><span class="op" id="8514103">(</span><span class="ident" id="8514104">t</span>&nbsp;<span class="op" id="8514106">*</span><span class="ident" id="8514107">testing</span><span class="op" id="8514114">.</span><span class="ident" id="8514115">T</span><span class="op" id="8514116">)</span>&nbsp;<span class="op" id="8514118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514121">b</span>&nbsp;<span class="op" id="8514123">:=</span>&nbsp;<span class="ident" id="8514126">T</span><span class="op" id="8514127">(</span><span class="num" id="8514128">0</span><span class="op" id="8514129">)</span><span class="op" id="8514130">.</span><span class="ident" id="8514131">method</span><span class="op" id="8514137">(</span><span class="op" id="8514138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514141">lines</span>&nbsp;<span class="op" id="8514147">:=</span>&nbsp;<span class="ident" id="8514150">strings</span><span class="op" id="8514157">.</span><span class="ident" id="8514158">Split</span><span class="op" id="8514163">(</span><span class="builtintype" id="8514164">string</span><span class="op" id="8514170">(</span><span class="ident" id="8514171">b</span><span class="op" id="8514172">)</span><span class="op" id="8514173">,</span>&nbsp;<span class="string" id="8514175">&#34;\n&#34;</span><span class="op" id="8514179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8514182">if</span>&nbsp;<span class="builtinfunc" id="8514185">len</span><span class="op" id="8514188">(</span><span class="ident" id="8514189">lines</span><span class="op" id="8514194">)</span>&nbsp;<span class="op" id="8514196">&lt;</span>&nbsp;<span class="num" id="8514198">6</span>&nbsp;<span class="op" id="8514200">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514204">t</span><span class="op" id="8514205">.</span><span class="ident" id="8514206">Fatal</span><span class="op" id="8514211">(</span><span class="string" id="8514212">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8514227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8514230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514233">n</span>&nbsp;<span class="op" id="8514235">:=</span>&nbsp;<span class="num" id="8514238">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514241">frame</span>&nbsp;<span class="op" id="8514247">:=</span>&nbsp;<span class="keyword" id="8514250">func</span><span class="op" id="8514254">(</span><span class="ident" id="8514255">line</span><span class="op" id="8514259">,</span>&nbsp;<span class="ident" id="8514261">code</span>&nbsp;<span class="builtintype" id="8514266">string</span><span class="op" id="8514272">)</span>&nbsp;<span class="op" id="8514274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514278">check</span><span class="op" id="8514283">(</span><span class="ident" id="8514284">t</span><span class="op" id="8514285">,</span>&nbsp;<span class="ident" id="8514287">lines</span><span class="op" id="8514292">[</span><span class="ident" id="8514293">n</span><span class="op" id="8514294">]</span><span class="op" id="8514295">,</span>&nbsp;<span class="ident" id="8514297">line</span><span class="op" id="8514301">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514305">n</span><span class="op" id="8514306">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8514311">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8514374">if</span>&nbsp;<span class="ident" id="8514377">strings</span><span class="op" id="8514384">.</span><span class="ident" id="8514385">HasPrefix</span><span class="op" id="8514394">(</span><span class="ident" id="8514395">lines</span><span class="op" id="8514400">[</span><span class="ident" id="8514401">n</span><span class="op" id="8514402">]</span><span class="op" id="8514403">,</span>&nbsp;<span class="string" id="8514405">&#34;\t&#34;</span><span class="op" id="8514409">)</span>&nbsp;<span class="op" id="8514411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514416">check</span><span class="op" id="8514421">(</span><span class="ident" id="8514422">t</span><span class="op" id="8514423">,</span>&nbsp;<span class="ident" id="8514425">lines</span><span class="op" id="8514430">[</span><span class="ident" id="8514431">n</span><span class="op" id="8514432">]</span><span class="op" id="8514433">,</span>&nbsp;<span class="ident" id="8514435">code</span><span class="op" id="8514439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514444">n</span><span class="op" id="8514445">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8514450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8514453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514456">frame</span><span class="op" id="8514461">(</span><span class="string" id="8514462">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8514495">,</span>&nbsp;<span class="string" id="8514497">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8514531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514534">frame</span><span class="op" id="8514539">(</span><span class="string" id="8514540">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8514573">,</span>&nbsp;<span class="string" id="8514575">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8514609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514612">frame</span><span class="op" id="8514617">(</span><span class="string" id="8514618">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8514651">,</span>&nbsp;<span class="string" id="8514653">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8514686">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514689">frame</span><span class="op" id="8514694">(</span><span class="string" id="8514695">&#34;src/testing/testing.go&#34;</span><span class="op" id="8514719">,</span>&nbsp;<span class="string" id="8514721">&#34;&#34;</span><span class="op" id="8514723">)</span><br>
<span class="lineno"></span><span class="op" id="8514725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8514728">func</span>&nbsp;<span class="ident" id="8514733">check</span><span class="op" id="8514738">(</span><span class="ident" id="8514739">t</span>&nbsp;<span class="op" id="8514741">*</span><span class="ident" id="8514742">testing</span><span class="op" id="8514749">.</span><span class="ident" id="8514750">T</span><span class="op" id="8514751">,</span>&nbsp;<span class="ident" id="8514753">line</span><span class="op" id="8514757">,</span>&nbsp;<span class="ident" id="8514759">has</span>&nbsp;<span class="builtintype" id="8514763">string</span><span class="op" id="8514769">)</span>&nbsp;<span class="op" id="8514771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8514774">if</span>&nbsp;<span class="ident" id="8514777">strings</span><span class="op" id="8514784">.</span><span class="ident" id="8514785">Index</span><span class="op" id="8514790">(</span><span class="ident" id="8514791">line</span><span class="op" id="8514795">,</span>&nbsp;<span class="ident" id="8514797">has</span><span class="op" id="8514800">)</span>&nbsp;<span class="op" id="8514802">&lt;</span>&nbsp;<span class="num" id="8514804">0</span>&nbsp;<span class="op" id="8514806">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8514810">t</span><span class="op" id="8514811">.</span><span class="ident" id="8514812">Errorf</span><span class="op" id="8514818">(</span><span class="string" id="8514819">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8514838">,</span>&nbsp;<span class="ident" id="8514840">has</span><span class="op" id="8514843">,</span>&nbsp;<span class="ident" id="8514845">line</span><span class="op" id="8514849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8514852">}</span><br>
<span class="lineno"></span><span class="op" id="8514854">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
