<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html" class="current">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3750108">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3750163">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3750217">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3750268">package</span>&nbsp;<span class="ident" id="3750276">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750284">import</span>&nbsp;<span class="string" id="3750291">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3750297">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3750375">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3750407">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3750479">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3750534">type</span>&nbsp;<span class="ident" id="3750539">StreamReader</span>&nbsp;<span class="keyword" id="3750552">struct</span>&nbsp;<span class="op" id="3750559">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750562">S</span>&nbsp;<span class="ident" id="3750564">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750572">R</span>&nbsp;<span class="ident" id="3750574">io</span><span class="op" id="3750576">.</span><span class="ident" id="3750577">Reader</span><br>
<span class="lineno"></span><span class="op" id="3750584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750587">func</span>&nbsp;<span class="op" id="3750592">(</span><span class="ident" id="3750593">r</span>&nbsp;<span class="ident" id="3750595">StreamReader</span><span class="op" id="3750607">)</span>&nbsp;<span class="ident" id="3750609">Read</span><span class="op" id="3750613">(</span><span class="ident" id="3750614">dst</span>&nbsp;<span class="op" id="3750618">[</span><span class="op" id="3750619">]</span><span class="builtintype" id="3750620">byte</span><span class="op" id="3750624">)</span>&nbsp;<span class="op" id="3750626">(</span><span class="ident" id="3750627">n</span>&nbsp;<span class="builtintype" id="3750629">int</span><span class="op" id="3750632">,</span>&nbsp;<span class="ident" id="3750634">err</span>&nbsp;<span class="builtintype" id="3750638">error</span><span class="op" id="3750643">)</span>&nbsp;<span class="op" id="3750645">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750648">n</span><span class="op" id="3750649">,</span>&nbsp;<span class="ident" id="3750651">err</span>&nbsp;<span class="op" id="3750655">=</span>&nbsp;<span class="ident" id="3750657">r</span><span class="op" id="3750658">.</span><span class="ident" id="3750659">R</span><span class="op" id="3750660">.</span><span class="ident" id="3750661">Read</span><span class="op" id="3750665">(</span><span class="ident" id="3750666">dst</span><span class="op" id="3750669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750672">r</span><span class="op" id="3750673">.</span><span class="ident" id="3750674">S</span><span class="op" id="3750675">.</span><span class="ident" id="3750676">XORKeyStream</span><span class="op" id="3750688">(</span><span class="ident" id="3750689">dst</span><span class="op" id="3750692">[</span><span class="op" id="3750693">:</span><span class="ident" id="3750694">n</span><span class="op" id="3750695">]</span><span class="op" id="3750696">,</span>&nbsp;<span class="ident" id="3750698">dst</span><span class="op" id="3750701">[</span><span class="op" id="3750702">:</span><span class="ident" id="3750703">n</span><span class="op" id="3750704">]</span><span class="op" id="3750705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750708">return</span><br>
<span class="lineno"></span><span class="op" id="3750715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3750718">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3750790">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3750863">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3750940">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3751005">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3751042">type</span>&nbsp;<span class="ident" id="3751047">StreamWriter</span>&nbsp;<span class="keyword" id="3751060">struct</span>&nbsp;<span class="op" id="3751067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751070">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3751074">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751082">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3751086">io</span><span class="op" id="3751088">.</span><span class="ident" id="3751089">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751097">Err</span>&nbsp;<span class="builtintype" id="3751101">error</span>&nbsp;<span class="comment" id="3751107">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3751117">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3751120">func</span>&nbsp;<span class="op" id="3751125">(</span><span class="ident" id="3751126">w</span>&nbsp;<span class="ident" id="3751128">StreamWriter</span><span class="op" id="3751140">)</span>&nbsp;<span class="ident" id="3751142">Write</span><span class="op" id="3751147">(</span><span class="ident" id="3751148">src</span>&nbsp;<span class="op" id="3751152">[</span><span class="op" id="3751153">]</span><span class="builtintype" id="3751154">byte</span><span class="op" id="3751158">)</span>&nbsp;<span class="op" id="3751160">(</span><span class="ident" id="3751161">n</span>&nbsp;<span class="builtintype" id="3751163">int</span><span class="op" id="3751166">,</span>&nbsp;<span class="ident" id="3751168">err</span>&nbsp;<span class="builtintype" id="3751172">error</span><span class="op" id="3751177">)</span>&nbsp;<span class="op" id="3751179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751182">c</span>&nbsp;<span class="op" id="3751184">:=</span>&nbsp;<span class="builtinfunc" id="3751187">make</span><span class="op" id="3751191">(</span><span class="op" id="3751192">[</span><span class="op" id="3751193">]</span><span class="builtintype" id="3751194">byte</span><span class="op" id="3751198">,</span>&nbsp;<span class="builtinfunc" id="3751200">len</span><span class="op" id="3751203">(</span><span class="ident" id="3751204">src</span><span class="op" id="3751207">)</span><span class="op" id="3751208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751211">w</span><span class="op" id="3751212">.</span><span class="ident" id="3751213">S</span><span class="op" id="3751214">.</span><span class="ident" id="3751215">XORKeyStream</span><span class="op" id="3751227">(</span><span class="ident" id="3751228">c</span><span class="op" id="3751229">,</span>&nbsp;<span class="ident" id="3751231">src</span><span class="op" id="3751234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751237">n</span><span class="op" id="3751238">,</span>&nbsp;<span class="ident" id="3751240">err</span>&nbsp;<span class="op" id="3751244">=</span>&nbsp;<span class="ident" id="3751246">w</span><span class="op" id="3751247">.</span><span class="ident" id="3751248">W</span><span class="op" id="3751249">.</span><span class="ident" id="3751250">Write</span><span class="op" id="3751255">(</span><span class="ident" id="3751256">c</span><span class="op" id="3751257">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751260">if</span>&nbsp;<span class="ident" id="3751263">n</span>&nbsp;<span class="op" id="3751265">!=</span>&nbsp;<span class="builtinfunc" id="3751268">len</span><span class="op" id="3751271">(</span><span class="ident" id="3751272">src</span><span class="op" id="3751275">)</span>&nbsp;<span class="op" id="3751277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751281">if</span>&nbsp;<span class="ident" id="3751284">err</span>&nbsp;<span class="op" id="3751288">==</span>&nbsp;<span class="ident" id="3751291">nil</span>&nbsp;<span class="op" id="3751295">{</span>&nbsp;<span class="comment" id="3751297">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751323">err</span>&nbsp;<span class="op" id="3751327">=</span>&nbsp;<span class="ident" id="3751329">io</span><span class="op" id="3751331">.</span><span class="ident" id="3751332">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751351">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751354">return</span><br>
<span class="lineno"></span><span class="op" id="3751361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3751364">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3751452">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3751503">func</span>&nbsp;<span class="op" id="3751508">(</span><span class="ident" id="3751509">w</span>&nbsp;<span class="ident" id="3751511">StreamWriter</span><span class="op" id="3751523">)</span>&nbsp;<span class="ident" id="3751525">Close</span><span class="op" id="3751530">(</span><span class="op" id="3751531">)</span>&nbsp;<span class="builtintype" id="3751533">error</span>&nbsp;<span class="op" id="3751539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751542">if</span>&nbsp;<span class="ident" id="3751545">c</span><span class="op" id="3751546">,</span>&nbsp;<span class="ident" id="3751548">ok</span>&nbsp;<span class="op" id="3751551">:=</span>&nbsp;<span class="ident" id="3751554">w</span><span class="op" id="3751555">.</span><span class="ident" id="3751556">W</span><span class="op" id="3751557">.</span><span class="op" id="3751558">(</span><span class="ident" id="3751559">io</span><span class="op" id="3751561">.</span><span class="ident" id="3751562">Closer</span><span class="op" id="3751568">)</span><span class="op" id="3751569">;</span>&nbsp;<span class="ident" id="3751571">ok</span>&nbsp;<span class="op" id="3751574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751578">return</span>&nbsp;<span class="ident" id="3751585">c</span><span class="op" id="3751586">.</span><span class="ident" id="3751587">Close</span><span class="op" id="3751592">(</span><span class="op" id="3751593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751599">return</span>&nbsp;<span class="ident" id="3751606">nil</span><br>
<span class="lineno">55</span><span class="op" id="3751610">}</span>
</div>
</body>
</html>
